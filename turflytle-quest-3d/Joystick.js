pc.script.attribute("radius","number",50),pc.script.attribute("maxResHeight","number",720),pc.script.attribute("oX","number",-380),pc.script.attribute("oY","number",-127),pc.script.create("Joystick",function(a){var b=function(a){this.entity=a,this._pressed=!1,this._touchIdx=null,this._baseX=this._stickX=0,this._baseY=this._stickY=0,this._stationaryBase=!1,this._limitStickTravel=!0},c=a.graphicsDevice;return b.prototype={initialize:function(){this._baseImage=a.root.findByName("Base").script.sprite,this._stickImage=a.root.findByName("Stick").script.sprite},update:function(a){},onEnable:function(){a.touch&&(a.touch.on("touchstart",this.onTouchDown,this),a.touch.on("touchend",this.onTouchUp,this),a.touch.on("touchmove",this.onTouchMove,this),window.addEventListener("resize",this.reflow.bind(this),!1),window.addEventListener("orientationchange",this.reflow.bind(this),!1),window.addEventListener("onorientationchange",this.reflow.bind(this),!1)),WIDTH=parseInt(c.canvas.clientWidth),HEIGHT=parseInt(c.canvas.clientHeight),this._availableArea={x:0,y:0,width:WIDTH/2,height:HEIGHT},this._stickRadius=50*HEIGHT/720,this._baseImage.entity.enabled=!0,this._stickImage.entity.enabled=!0,this._touchIdx=null,this._pressed&&this._onUp()},onDisable:function(){pc.Utils.debug("Joystick","onDisable","disable joystick"),a.touch&&(a.touch.off("touchstart",this.onTouchDown,this),a.touch.off("touchend",this.onTouchUp,this),a.touch.off("touchmove",this.onTouchMove,this),window.removeEventListener("resize",this.reflow.bind(this),!1),window.removeEventListener("orientationchange",this.reflow.bind(this),!1),window.removeEventListener("onorientationchange",this.reflow.bind(this),!1))},destroy:function(){},reflow:function(){WIDTH=parseInt(a.graphicsDevice.canvas.clientWidth),HEIGHT=parseInt(a.graphicsDevice.canvas.clientHeight),this._availableArea.width=WIDTH/2,this._availableArea.height=HEIGHT,this._stickRadius=50*HEIGHT/720},deltaX:function(){return this._stickX-this._baseX},deltaY:function(){return this._stickY-this._baseY},up:function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return b>=0?!1:!(Math.abs(a)>2*Math.abs(b))},down:function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return 0>=b?!1:!(Math.abs(a)>2*Math.abs(b))},left:function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return a>=0?!1:!(Math.abs(b)>2*Math.abs(a))},right:function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return 0>=a?!1:!(Math.abs(b)>2*Math.abs(a))},cancel:function(){return!this._pressed},_onUp:function(){return this._pressed?(this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0),this._baseImage.x=this.oX,this._baseImage.y=this.oY,this._stickImage.x=this.oX,void(this._stickImage.y=this.oY)):!1},_onDown:function(a,b){if(!this._availableArea||!(a<this._availableArea.x||a>this._availableArea.x+this._availableArea.width||b<this._availableArea.y||b>this._availableArea.y+this._availableArea.height)){if(this._pressed=!0,0==this._stationaryBase&&(this._baseX=a,this._baseY=b,this._move(this._baseImage,this._baseX,this._baseY)),this._stickX=a,this._stickY=b,this._limitStickTravel===!0){var c=this.deltaX(),d=this.deltaY(),e=Math.sqrt(c*c+d*d);if(e>this._stickRadius){var f=c/e,g=d/e;this._stickX=f*this._stickRadius+this._baseX,this._stickY=g*this._stickRadius+this._baseY}}this._move(this._stickImage,this._stickX,this._stickY)}},_onMove:function(a,b){if(this._pressed===!0){if(this._stickX=a,this._stickY=b,this._limitStickTravel===!0){var c=this.deltaX(),d=this.deltaY(),e=Math.sqrt(c*c+d*d);if(e>this._stickRadius){var f=c/e,g=d/e;this._stickX=f*this._stickRadius+this._baseX,this._stickY=g*this._stickRadius+this._baseY}}this._move(this._stickImage,this._stickX,this._stickY)}},onTouchDown:function(a){if(null===this._touchIdx){var b=a.changedTouches[0];this._touchIdx=b.id;var c=b.x,d=b.y;return this._onDown(c,d)}},onTouchMove:function(a){if(null!==this._touchIdx){for(var b=a.changedTouches,c=0;c<b.length&&b[c].id!==this._touchIdx;c++);if(c!==b.length){var d=b[c];a.event.preventDefault();var e=d.x,f=d.y;return this._onMove(e,f)}}},onTouchUp:function(a){if(null!==this._touchIdx){for(var b=a.changedTouches,c=0;c<b.length&&b[c].id!==this._touchIdx;c++);if(c!==b.length)return this._touchIdx=null,this._onUp()}},_move:function(a,b,c){b=(b-WIDTH/2)/a.scaling.x,c=-(c-HEIGHT/2)/a.scaling.y,a.x=b,a.y=c}},b});