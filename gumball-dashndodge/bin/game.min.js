var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var GumballRunner;(function(GumballRunner){GumballRunner.getCameConfig=function(){var transparent=false;if(Phaser.Device["silk"])transparent=true;var renderer=Phaser.AUTO;if(Phaser.Device["iOS"])renderer=Phaser.CANVAS;var quality="hd";return{quality:quality,width:768,height:1024,renderer:renderer,canvas:document.getElementById("stage"),parent:document.getElementById("stage-container"),transparent:transparent,roundPixels:true,clearBeforeRender:false,enableDebug:false,resolution:1}};var Application=function(_super){__extends(Application,_super);function Application(localeString){var _this=_super.call(this,GumballRunner.getCameConfig())||this;_this.isRotateScreenState=false;_this.m_prevContainerW=0;_this.m_prevContainerH=0;_this.optimalRenderActive=false;_this.superOptimalRenderActive=false;var androidVersion=navigator.userAgent.match(/Android (\d+(?:\.\d+)+);/);if(androidVersion){try{var androidMajorVersion=parseInt(androidVersion[1].split(".")[0]);var androidMinorVersion=parseInt(androidVersion[1].split(".")[1]);if(androidMajorVersion==4&&androidMinorVersion<4)Application.audioEnabled=false}catch(e){}}GumballRunner.AssetHelper.qualityPrefix=GumballRunner.getCameConfig().quality;var c=_this.config;GumballRunner.ScreenUtil.init(c.width,c.height,576,c.height,c.resolution);console.log("init locale",localeString);Application.localeString=typeof localeString=="undefined"?"en":localeString;_this.state.add(GumballRunner.SceneHelper.defs.BOOT,GumballRunner.Boot,false);_this.state.add(GumballRunner.SceneHelper.defs.PRELOADER,GumballRunner.Preloader,false);_this.state.add(GumballRunner.SceneHelper.defs.TITLE,GumballRunner.Title,false);_this.state.add(GumballRunner.SceneHelper.defs.CHARACTER_SELECT,GumballRunner.CharacterSelect,false);_this.state.add(GumballRunner.SceneHelper.defs.HOW_TO_PLAY,GumballRunner.HowToPlay,false);_this.state.add(GumballRunner.SceneHelper.defs.GAME,GumballRunner.Game,false);_this.state.add(GumballRunner.SceneHelper.defs.SCORE,GumballRunner.Score,false);_this.state.start(GumballRunner.SceneHelper.defs.BOOT);return _this}Application.prototype.factoryRotateScreenElement=function(){var elem=document.createElement("div");elem.id="rotate-screen";var content=document.createElement("div");content.id="rotate-screen-content";var imgElem=document.createElement("img");imgElem.setAttribute("src",GumballRunner.AssetHelper.getAssetRoot()+"rotate-screen.png");imgElem.id="rotate-screen-img";var textElem=document.createElement("p");textElem.id="rotate-screen-text";textElem.innerHTML=GumballRunner.StringHelper.getString("rotate_screen");elem.appendChild(content);content.appendChild(imgElem);content.appendChild(textElem);GumballRunner.DomUtil.addClass(elem,"hidden");return elem};Application.prototype.goFullScreen=function(){if(this.scale.isFullScreen){this.scale.stopFullScreen()}else{this.scale.startFullScreen(false)}};Application.prototype.startMenuLoop=function(){try{if(!Application.audioEnabled)return;if(!this.menuLoop)this.menuLoop=this.sound.play("menu_loop",1,true)}catch(e){}};Application.prototype.stopMenuLoop=function(){try{if(!Application.audioEnabled)return;if(this.menuLoop){this.menuLoop.stop();this.menuLoop=null}}catch(e){}};Application.prototype.playButtonClickFX=function(){try{if(!Application.audioEnabled)return;this.sound.play("buttonclick")}catch(e){}};Application.prototype.playSelectionClickFX=function(){try{if(!Application.audioEnabled)return;this.sound.play("beep")}catch(e){}};Application.prototype.activateOptimalRender=function(){if(this.optimalRenderActive)return;else this.optimalRenderActive=true;this.stage.smoothed=false};Application.prototype.activateSuperOptimalRender=function(){if(this.superOptimalRenderActive)return;else this.superOptimalRenderActive=true;this.forceSingleUpdate=false;this.dropFrames=true;this.stage.smoothed=false};Application.prototype.deactivateOptimalRender=function(){if(this.optimalRenderActive){this.optimalRenderActive=false;this.stage.smoothed=true}else if(this.superOptimalRenderActive){this.superOptimalRenderActive=false;this.forceSingleUpdate=true;this.dropFrames=false;this.stage.smoothed=true}};Application.prototype.enterRotateScreenState=function(){this.paused=true;if(!this.rotateScreenElement){this.rotateScreenElement=this.factoryRotateScreenElement();this.canvas.parentNode.appendChild(this.rotateScreenElement)}GumballRunner.DomUtil.addClass(this.canvas,"hidden");GumballRunner.DomUtil.removeClass(this.rotateScreenElement,"hidden");this.isRotateScreenState=true};Application.prototype.exitRotateScreenState=function(){this.paused=false;GumballRunner.DomUtil.removeClass(this.canvas,"hidden");GumballRunner.DomUtil.addClass(this.rotateScreenElement,"hidden");this.isRotateScreenState=false};Application.prototype.updateOrientationState=function(){if(this.scale.isLandscape){if(!this.isRotateScreenState)this.enterRotateScreenState()}else{if(this.isRotateScreenState)this.exitRotateScreenState()}};Application.prototype.onOrientationChange=function(scale,prevOrientation,wasIncorrect){if(scale.screenOrientation!==prevOrientation)this.updateOrientationState()};Application.audioEnabled=true;return Application}(Phaser.Game);GumballRunner.Application=Application})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var AssetHelper=function(){function AssetHelper(){}AssetHelper.textButtonPaddingX=40;AssetHelper.textButtonPaddingY=20;AssetHelper.qualityPrefix="hd";AssetHelper.assetRoot="assets/{q}/";AssetHelper.dataRoot="assets/{q}/data/";AssetHelper.audioRoot="assets/{q}/audio/";AssetHelper.stringsRoot="assets/strings/";AssetHelper.gameAtlasCacheKey="atlas_game";AssetHelper.uiAtlasCacheKey="atlas_ui";AssetHelper.menuBackgroundTileKey="tile-menu";AssetHelper.roadTileKey="tile-road";AssetHelper.distanceFogTileKey="tile-dfog";AssetHelper.muteButtonSpriteSheetKey="mutebutton";AssetHelper.playerSpriteSheetKey="player";AssetHelper.physicsDataKey="physicsData";AssetHelper.localeStringsKey="localeStrings";AssetHelper.worldTilesDataKey="worldTilesData";AssetHelper.playerCharacter_GUMBALL="gumball";AssetHelper.detokenisePath=function(val){return val.replace("{q}",AssetHelper.qualityPrefix)};AssetHelper.getAssetRoot=function(){return AssetHelper.detokenisePath(AssetHelper.assetRoot)};AssetHelper.getDataRoot=function(){return AssetHelper.detokenisePath(AssetHelper.dataRoot)};AssetHelper.getAudioRoot=function(){return AssetHelper.detokenisePath(AssetHelper.audioRoot)};AssetHelper.getAssetScale=function(){return AssetHelper.qualityPrefix=="sd"?.5:1};return AssetHelper}();GumballRunner.AssetHelper=AssetHelper})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Baddie=function(_super){__extends(Baddie,_super);function Baddie(game,x,y,spritesheetKey,bodyRad,animFPS){if(animFPS===void 0){animFPS=3}var _this=_super.call(this,game,0,0,spritesheetKey)||this;_this.animFPS=animFPS;_this.animations.add("run",[0,1]);_this.baseX=x*GumballRunner.AssetHelper.getAssetScale();_this.baseY=y*GumballRunner.AssetHelper.getAssetScale();_this.game.physics.box2d.enable(_this,true);_this.body.clearFixtures();_this.body.setCircle(bodyRad*GumballRunner.AssetHelper.getAssetScale());_this.body.setCollisionCategory(GumballRunner.Game.baddieCollisionGroup);_this.body.sensor=true;_this.body.collideWorldBounds=false;_this.body.fixedRotation=true;_this.body.static=true;_this.body.x=_this.baseX;_this.body.y=_this.baseY;_this.scale.set(_this.game.resolution);return _this}Baddie.prototype.reset=function(x,y,health){_super.prototype.reset.call(this,x,y,health);this.setState(Baddie.states.RUN);return this};Baddie.prototype.setState=function(state){if(this.state==state)return;this.state=state;switch(this.state){case Baddie.states.RUN:this.animations.play("run",this.animFPS,true);break;case Baddie.states.IMPACTED:this.animations.stop();break;default:this.animations.stop()}};Baddie.prototype.onCollision=function(){this.setState(Baddie.states.IMPACTED)};Baddie.states={RUN:"run",IMPACTED:"impacted",IDLE:"idle"};return Baddie}(Phaser.Sprite);GumballRunner.Baddie=Baddie})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var PanelButtonModality;(function(PanelButtonModality){PanelButtonModality[PanelButtonModality["BUTTON"]=0]="BUTTON";PanelButtonModality[PanelButtonModality["TOGGLE"]=1]="TOGGLE"})(PanelButtonModality=GumballRunner.PanelButtonModality||(GumballRunner.PanelButtonModality={}));var PanelButton=function(_super){__extends(PanelButton,_super);function PanelButton(game,x,y,callback,callbackContext,paddingX,paddingY,viewParams,minWidth,minHeight){if(paddingX===void 0){paddingX=10}if(paddingY===void 0){paddingY=8}if(viewParams===void 0){viewParams=[]}if(minWidth===void 0){minWidth=0}if(minHeight===void 0){minHeight=0}var _this=_super.call(this,game,x,y,null,callback,callbackContext)||this;_this.isOver=false;_this.isDown=false;_this.modality=PanelButtonModality.BUTTON;_this.isToggled=false;_this.signalOnToggle=new Phaser.Signal;_this.bounds=new PIXI.Rectangle;_this.panelStyle_up={strokeColour:16777215,strokeWidth:3,strokeAlpha:1,fillColour:7130062,fillAlpha:1,radius:10};_this.panelStyle_over={strokeColour:16777215,strokeWidth:5,strokeAlpha:1,fillColour:7130062,fillAlpha:1,radius:10};_this.panelStyle_down={strokeColour:7130062,strokeWidth:3,strokeAlpha:1,fillColour:7130062,fillAlpha:1,radius:10};_this.panelStyle_up_toggled={strokeColour:16777215,strokeWidth:3,strokeAlpha:1,fillColour:16711680,fillAlpha:1,radius:10};_this.panelStyle_over_toggled={strokeColour:16777215,strokeWidth:5,strokeAlpha:1,fillColour:7130062,fillAlpha:1,radius:10};_this.panelStyle_down_toggled={strokeColour:7130062,strokeWidth:3,strokeAlpha:1,fillColour:7130062,fillAlpha:1,radius:10};_this.panelShadowStyle={offsetX:13,offsetY:13};_this.anchor.set(.5);_this.view=_this.factoryView(viewParams);if(_this.view)_this.addChild(_this.view);var vw=_this.view?Math.max(_this.view.width,minWidth):minWidth;var vh=_this.view?Math.max(_this.view.height,minHeight):minHeight;var rect=new Phaser.Rectangle(0,0,vw+paddingX*2,vh+paddingY*2);_this.panel=new GumballRunner.UIPanel(_this.game,rect,_this.panelStyle_up,_this.panelShadowStyle);_this.panel.anchor.set(.5);_this.addChildAt(_this.panel,0);_this.onInputOver.add(_this.over,_this);_this.onInputOut.add(_this.out,_this);_this.onInputDown.add(_this.down,_this);_this.onInputUp.add(_this.up,_this);return _this}PanelButton.prototype.destroy=function(destroyChildren){this.panel=null;this.view=null;_super.prototype.destroy.call(this,destroyChildren)};PanelButton.prototype.factoryView=function(params){return null};PanelButton.prototype.updateStyle=function(){var style=this.panelStyle_up;if(this.isDown){if(this.isToggled)style=this.panelStyle_down_toggled;else style=this.panelStyle_down}else if(this.isOver){if(this.isToggled)style=this.panelStyle_over_toggled;else style=this.panelStyle_over}else{if(this.isToggled)style=this.panelStyle_up_toggled;else style=this.panelStyle_up}this.panel.setStyle(style)};PanelButton.prototype.over=function(){this.isOver=true;this.updateStyle()};PanelButton.prototype.out=function(){this.isOver=false;this.updateStyle()};PanelButton.prototype.down=function(){this.isDown=true;this.updateStyle();if(this.modality==PanelButtonModality.TOGGLE)this.doToggle()};PanelButton.prototype.up=function(){this.isDown=false;this.updateStyle()};PanelButton.prototype.doToggle=function(){this.setToggleState(!this.isToggled);this.signalOnToggle.dispatch(this)};PanelButton.prototype.setToggleState=function(v){this.isToggled=v;this.updateStyle()};return PanelButton}(Phaser.Button);GumballRunner.PanelButton=PanelButton})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var ImageButton=function(_super){__extends(ImageButton,_super);function ImageButton(game,x,y,callback,callbackContext,paddingX,paddingY,key,frame,minWidth,minHeight){if(paddingX===void 0){paddingX=10}if(paddingY===void 0){paddingY=8}if(minWidth===void 0){minWidth=0}if(minHeight===void 0){minHeight=0}return _super.call(this,game,x,y,callback,callbackContext,paddingX,paddingY,[key,frame],minWidth,minHeight)||this}ImageButton.prototype.factoryView=function(params){var key=params[0];var frame=params[1];var sprite=new Phaser.Sprite(this.game,0,0,key,frame);sprite.anchor.set(.5);this.addChild(sprite);return sprite};return ImageButton}(GumballRunner.PanelButton);GumballRunner.ImageButton=ImageButton})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var CharacterSelectButton=function(_super){__extends(CharacterSelectButton,_super);function CharacterSelectButton(game,x,y,callback,callbackContext,key,characterCode){var _this=_super.call(this,game,x,y,callback,callbackContext,0,0,key,"choosechar_"+characterCode)||this;_this.data.characterCode=characterCode;_this.panel.removeDropShadow();_this.panelStyle_up=_this.getBasePanelStyle(7130062,5);_this.panelStyle_over=_this.getBasePanelStyle(12445941,6);_this.panelStyle_down=_this.getBasePanelStyle(12445941,6);_this.updateStyle();return _this}CharacterSelectButton.prototype.getBasePanelStyle=function(fill,strokeWidth){return{strokeColour:16777215,strokeWidth:strokeWidth,strokeAlpha:1,fillColour:fill,fillAlpha:1,shape:GumballRunner.UIPanelShape.circle,radius:CharacterSelectButton.radius}};CharacterSelectButton.radius=150;return CharacterSelectButton}(GumballRunner.ImageButton);GumballRunner.CharacterSelectButton=CharacterSelectButton})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var ColourHelper=function(){function ColourHelper(){}ColourHelper.BLACK="#000000";ColourHelper.WHITE="#ffffff";ColourHelper.YELLOW="#fde908";ColourHelper.BLUE="#6ccbce";ColourHelper.PINK="#d72f77";return ColourHelper}();GumballRunner.ColourHelper=ColourHelper})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Countdown=function(_super){__extends(Countdown,_super);function Countdown(game,x,y,text){var _this=_super.call(this,game,x,y,text,{font:"118px Lubalin",fill:GumballRunner.ColourHelper.WHITE,align:"center"})||this;_this.value=0;_this.tickTime=Phaser.Timer.SECOND*1;_this.goSignal=new Phaser.Signal;_this.completeSignal=new Phaser.Signal;_this.anchor.set(.5);_this.strings=[];_this.strings.unshift(GumballRunner.StringHelper.getString("countdown_3"));_this.strings.unshift(GumballRunner.StringHelper.getString("countdown_2"));_this.strings.unshift(GumballRunner.StringHelper.getString("countdown_1"));_this.strings.unshift(GumballRunner.StringHelper.getString("countdown_go"));_this.addColor(GumballRunner.ColourHelper.YELLOW,0);_this.setShadow(5,5,"rgba(0,0,0,1)",0);_this.timer=_this.game.time.create(false);return _this}Countdown.prototype.destroy=function(destroyChildren){this.stop();this.goSignal.dispose();this.goSignal=null;this.completeSignal.dispose();this.completeSignal=null;this.timer.destroy();this.timer=null;_super.prototype.destroy.call(this,destroyChildren)};Countdown.prototype.start=function(){this.setValue(this.strings.length);this.timer.loop(this.tickTime,this.onTick,this);this.timer.start();if(GumballRunner.Application.audioEnabled)this.game.sound.play("bikehorn");this.visible=true};Countdown.prototype.stop=function(){this.timer.stop(true);this.visible=false};Countdown.prototype.setValue=function(value){this.value=value;var tStr=this.value>0?this.strings[this.value-1]:"";this.setText(tStr)};Countdown.prototype.setText=function(text,immediate){var t=_super.prototype.setText.call(this,text,immediate);if(this.value>1){this.scale.set(2);this.game.add.tween(this.scale).to({x:1,y:1},900,Phaser.Easing.Bounce.Out,true)}else{this.scale.set(1);this.game.add.tween(this).to({alpha:0},450,Phaser.Easing.Linear.None,true);this.game.add.tween(this.scale).to({x:2,y:2},350,Phaser.Easing.Linear.None,true)}return t};Countdown.prototype.onTick=function(){this.setValue(this.value-1);if(this.value>1){if(GumballRunner.Application.audioEnabled)this.game.sound.play("bikehorn")}else if(this.value==1){if(GumballRunner.Application.audioEnabled)this.game.sound.play("airhorn");this.goSignal.dispatch()}else if(this.value==0){this.completeSignal.dispatch();this.stop()}};return Countdown}(Phaser.Text);GumballRunner.Countdown=Countdown})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var GameTimer=function(_super){__extends(GameTimer,_super);function GameTimer(game,styleObj,paddingX,paddingY){if(styleObj===void 0){styleObj={}}if(paddingX===void 0){paddingX=10}if(paddingY===void 0){paddingY=8}var _this=_super.call(this,game,0,0)||this;_this.panelStyle={strokeColour:16777215,strokeWidth:3,strokeAlpha:1,fillColour:0,fillAlpha:1,radius:10};_this.value=0;_this.tickTime=Phaser.Timer.SECOND*1;var style={font:"30px 04b30",fill:"#ffffff"};for(var key in styleObj)if(styleObj.hasOwnProperty(key))style[key]=styleObj[key];_this.textField=new Phaser.Text(_this.game,0,0,"",style);_this.textField.addColor(GumballRunner.ColourHelper.YELLOW,0);_this.textField.addColor(GumballRunner.ColourHelper.WHITE,1);_this.textField.addColor(GumballRunner.ColourHelper.BLUE,2);_this.textField.addColor(GumballRunner.ColourHelper.PINK,3);_this.addChild(_this.textField);_this.setText("0:00");var rect=new Phaser.Rectangle(0,0,_this.textField.width+paddingX*2,_this.textField.height+paddingY*2);_this.panel=new GumballRunner.UIPanel(_this.game,rect,_this.panelStyle);_this.addChildAt(_this.panel,0);_this.textField.anchor.set(.5);_this.textField.x+=3;_this.textField.y+=4;_this.anchor.set(.5);_this.timer=_this.game.time.create(false);return _this}GameTimer.prototype.destroy=function(destroyChildren){this.stop();this.timer.destroy();this.timer=null;_super.prototype.destroy.call(this,destroyChildren)};GameTimer.prototype.setText=function(val){this.textField.text=val};GameTimer.prototype.zero=function(){this.setValue(0)};GameTimer.prototype.restart=function(){this.setValue(0);this.timer.loop(this.tickTime,this.onTick,this);this.timer.start()};GameTimer.prototype.pause=function(){this.timer.pause()};GameTimer.prototype.resume=function(){this.timer.resume()};GameTimer.prototype.stop=function(){this.timer.stop(true)};GameTimer.prototype.setValue=function(value){this.value=value;this.setText(this.secToStr(this.value))};GameTimer.prototype.secToStr=function(value){var min=Math.floor(value/60);var sec=value%60;var minStr=min.toString();var secStr=sec.toString();if(secStr.length<2)secStr="0"+secStr;var vStr="m:ss".replace("m",minStr).replace("ss",secStr);return vStr};GameTimer.prototype.onTick=function(){this.setValue(this.value+1)};return GameTimer}(Phaser.Sprite);GumballRunner.GameTimer=GameTimer})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var HighScorePanel=function(_super){__extends(HighScorePanel,_super);function HighScorePanel(game,rect,styleObj){var _this=_super.call(this,game,0,0)||this;_this.panelStyle={strokeColour:16777215,strokeWidth:4,strokeAlpha:1,fillColour:16640264,fillAlpha:1,radius:10};_this.panelShadowStyle={offsetX:10,offsetY:10};_this.anchor.set(.5);var style={font:"30px Lubalin",fill:GumballRunner.ColourHelper.BLACK,align:"center",boundsAlignH:"center",boundsAlignV:"middle",wordWrap:true,wordWrapWidth:rect.width-25*2};for(var key in styleObj)if(styleObj.hasOwnProperty(key))style[key]=styleObj[key];var template=GumballRunner.StringHelper.getString("high_score_panel");_this.text=new Phaser.Text(_this.game,0,0,template,style);var markerIdx=template.indexOf(HighScorePanel.marker);_this.text.addColor(GumballRunner.ColourHelper.PINK,markerIdx);_this.text.anchor.set(.5);_this.panel=new GumballRunner.UIPanel(_this.game,rect,_this.panelStyle,_this.panelShadowStyle);_this.addChild(_this.panel);_this.refresh();_this.addChild(_this.text);return _this}HighScorePanel.prototype.refresh=function(){var bestTime_sec=GumballRunner.PlayerModel.instance.bestScore.gameTime_sec;var str=this.secToStr(bestTime_sec);this.text.text=GumballRunner.StringHelper.getString("high_score_panel").replace(HighScorePanel.marker,str)};HighScorePanel.prototype.secToStr=function(value){var min=Math.floor(value/60);var sec=value%60;var minStr=min.toString();var secStr=sec.toString();if(secStr.length<2)secStr="0"+secStr;var vStr="m:ss".replace("m",minStr).replace("ss",secStr);return vStr};HighScorePanel.marker="%";return HighScorePanel}(Phaser.Sprite);GumballRunner.HighScorePanel=HighScorePanel})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var MovingBaddie=function(_super){__extends(MovingBaddie,_super);function MovingBaddie(game,x,y,spritesheetKey,bodyRad,xRange,speed,ease,animFPS){if(ease===void 0){ease="Linear"}if(animFPS===void 0){animFPS=3}var _this=_super.call(this,game,x,y,spritesheetKey,bodyRad,animFPS)||this;var xrStr="-"+(xRange*GumballRunner.AssetHelper.getAssetScale()).toString();_this.tween=game.add.tween(_this.body).to({x:xrStr},1e3,ease,true,Math.random()*1e3,-1);_this.tween.timeScale=speed;_this.tween.yoyo(true);_this.body.static=false;_this.body.kinematic=true;_this.autoCull=true;return _this}MovingBaddie.prototype.stopTween=function(){if(this.tween)this.tween.pause()};MovingBaddie.prototype.startTween=function(){if(this.tween)this.tween.resume()};MovingBaddie.prototype.setState=function(state){if(this.state==state)return;_super.prototype.setState.call(this,state);switch(this.state){case GumballRunner.Baddie.states.RUN:this.startTween();break;case GumballRunner.Baddie.states.IMPACTED:this.stopTween();break;default:this.stopTween()}};MovingBaddie.prototype.onCollision=function(){_super.prototype.onCollision.call(this)};return MovingBaddie}(GumballRunner.Baddie);GumballRunner.MovingBaddie=MovingBaddie})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var MuteButtonFrame;(function(MuteButtonFrame){MuteButtonFrame["SOUND_ON"]="mute_off";MuteButtonFrame["SOUND_OFF"]="mute_on"})(MuteButtonFrame=GumballRunner.MuteButtonFrame||(GumballRunner.MuteButtonFrame={}));var MuteButton=function(_super){__extends(MuteButton,_super);function MuteButton(game,x,y){var _this=_super.call(this,game,x,y,null,null,10,8,GumballRunner.AssetHelper.uiAtlasCacheKey,MuteButtonFrame.SOUND_ON)||this;_this.modality=GumballRunner.PanelButtonModality.TOGGLE;_this.panelStyle_up=_this.getBasePanelStyle(0,3);_this.panelStyle_over=_this.getBasePanelStyle(3355443,3);_this.panelStyle_down=_this.getBasePanelStyle(3355443,4);_this.panelStyle_up_toggled=_this.getBasePanelStyle(0,3);_this.panelStyle_over_toggled=_this.getBasePanelStyle(3355443,3);_this.panelStyle_down_toggled=_this.getBasePanelStyle(0,4);_this.updateStyle();_this.panel.removeDropShadow();_this.setToggleState(_this.game.sound.mute);_this.game.sound.onMute.add(_this.onMute,_this);_this.game.sound.onUnMute.add(_this.onUnMute,_this);return _this}MuteButton.prototype.destroy=function(destroyChildren){this.game.sound.onMute.remove(this.onMute,this);this.game.sound.onUnMute.remove(this.onUnMute,this);_super.prototype.destroy.call(this,destroyChildren)};MuteButton.prototype.onMute=function(){this.setToggleState(true)};MuteButton.prototype.onUnMute=function(){this.setToggleState(false)};MuteButton.prototype.doToggle=function(){this.game.sound.mute=!this.game.sound.mute};MuteButton.prototype.setToggleState=function(val){_super.prototype.setToggleState.call(this,val);this.view.frameName=this.isToggled?MuteButtonFrame.SOUND_OFF:MuteButtonFrame.SOUND_ON};MuteButton.prototype.getBasePanelStyle=function(fill,strokeWidth){return{strokeColour:16777215,strokeWidth:strokeWidth,strokeAlpha:1,fillColour:fill,fillAlpha:1,radius:10}};return MuteButton}(GumballRunner.ImageButton);GumballRunner.MuteButton=MuteButton})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Player=function(_super){__extends(Player,_super);function Player(game,x,y){var _this=_super.call(this,game,0,0,GumballRunner.PlayerModel.instance.characterCode)||this;_this.cameraTargetDisplacementY=0;_this.animations.add("idle",[0]);_this.animations.add("run",[1,2]);_this.animations.add("dazed",[3,4]);_this.game.physics.box2d.enable(_this,true);_this.body.clearFixtures();_this.body.setCircle(Player.physRadius*GumballRunner.AssetHelper.getAssetScale());_this.body.offset.y=-40*GumballRunner.AssetHelper.getAssetScale();_this.body.setCollisionCategory(GumballRunner.Game.playerCollisionGroup);_this.body.sensor=true;_this.body.linearDamping=.995;_this.body.fixedRotation=true;_this.body.collideWorldBounds=false;_this.body.x=x*GumballRunner.AssetHelper.getAssetScale();_this.body.y=y*GumballRunner.AssetHelper.getAssetScale();_this.scale.set(_this.game.resolution);_this.cameraTarget=new Phaser.Sprite(_this.game,0,(-GumballRunner.ScreenUtil.STAGE_WIDTH/2+_this.cameraTargetDisplacementY)/GumballRunner.AssetHelper.getAssetScale());_this.addChild(_this.cameraTarget);_this.setState(Player.states.IDLE);return _this}Player.prototype.destroy=function(destroyChildren){_super.prototype.destroy.call(this,destroyChildren)};Player.prototype.setState=function(state){if(this.state==state)return;this.state=state;switch(this.state){case Player.states.RUN:this.animations.play("run",6,true);break;case Player.states.DAZED:this.body.velocity.x=this.body.velocity.y=0;this.animations.play("dazed",6,true);break;default:this.animations.play("idle",1,true)}};Player.physRadius=40;Player.states={RUN:"run",DAZED:"dazed",IDLE:"idle"};return Player}(Phaser.Sprite);GumballRunner.Player=Player})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var PlayerController=function(){function PlayerController(game,player){this.controlMode=PlayerController.controlModes.NONE;this.isStarted=false;this.gyroData={x:0,y:0,z:0,alpha:0,beta:0,gamma:0};this.game=game;this.player=player;this.initScales();this.initControls();this.maxVelocity=new Phaser.Point(this.maxVelX,this.minVelY);this.inputAcceleration=new Phaser.Point(this.baseAccelX,0)}PlayerController.prototype.destroy=function(){this.stopInput();this.game.input.keyboard.clearCaptures();this.cursors=null;this.game=null;this.player=null};PlayerController.prototype.initScales=function(){var pScale=1/(this.game.time.desiredFps/60);console.log("set control scale:",pScale);this.baseAccelX=10*pScale;this.maxVelX=20*pScale;this.minVelY=20*pScale;this.velocityIncrement=.45*pScale;this.tiltVelocityScale=28*pScale;this.peakTilt=90};PlayerController.prototype.initControls=function(){if(gyro&&gyro.hasFeature("devicemotion"))this.initGyroControls();this.initFallbackControls()};PlayerController.prototype.initGyroControls=function(){this.controlMode=PlayerController.controlModes.GYRO;gyro.frequency=50;console.log("inited GYRO")};PlayerController.prototype.initFallbackControls=function(){this.cursors=this.game.input.keyboard.createCursorKeys()};PlayerController.prototype.gyroTrackStep=function(o){this.gyroData.x=o.x;this.gyroData.y=o.y;this.gyroData.z=o.z;this.gyroData.alpha=o.alpha;this.gyroData.beta=o.beta;this.gyroData.gamma=o.gamma};PlayerController.prototype.startInput=function(){if(this.isStarted)return;switch(this.controlMode){case PlayerController.controlModes.GYRO:gyro.startTracking(this.gyroTrackStep.bind(this));break}this.isStarted=true};PlayerController.prototype.stopInput=function(){if(!this.isStarted)return;this.player.body.velocity.x=this.player.body.velocity.x=0;switch(this.controlMode){case PlayerController.controlModes.GYRO:gyro.stopTracking();break}this.isStarted=false};PlayerController.prototype.setPlayerWorldTileCoordY=function(val){this.maxVelocity.y+=this.velocityIncrement};PlayerController.prototype.getNormalisedGamma=function(val){return val/this.peakTilt};PlayerController.prototype.update=function(dt){if(!this.isStarted)return;this.player.body.velocity.y-=this.maxVelocity.y;switch(this.controlMode){case PlayerController.controlModes.GYRO:var nGamma=this.getNormalisedGamma(this.gyroData.gamma);this.player.body.velocity.x+=nGamma*this.tiltVelocityScale;break}if(this.game.input.pointer1.isDown&&this.game.input.pointer1.y>GumballRunner.ScreenUtil.STAGE_HEIGHT_HALF){if(this.game.input.pointer1.x<GumballRunner.ScreenUtil.STAGE_WIDTH_HALF)this.player.body.velocity.x-=this.inputAcceleration.x;else this.player.body.velocity.x+=this.inputAcceleration.x}if(this.cursors.left.isDown)this.player.body.velocity.x-=this.inputAcceleration.x;else if(this.cursors.right.isDown)this.player.body.velocity.x+=this.inputAcceleration.x;this.player.body.velocity.x=Math.min(this.player.body.velocity.x,this.maxVelocity.x);this.player.body.velocity.x=Math.max(this.player.body.velocity.x,-this.maxVelocity.x);this.player.body.velocity.y=Math.min(this.player.body.velocity.y,this.maxVelocity.y);this.player.body.velocity.y=Math.max(this.player.body.velocity.y,-this.maxVelocity.y)};PlayerController.controlModes={NONE:-1,KEYBOARD:0,GYRO:1};return PlayerController}();GumballRunner.PlayerController=PlayerController})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var CharacterCodes;(function(CharacterCodes){CharacterCodes["GUMBALL"]="gumball";CharacterCodes["ANAIS"]="anais";CharacterCodes["CARRIE"]="carrie";CharacterCodes["DARWIN"]="darwin"})(CharacterCodes=GumballRunner.CharacterCodes||(GumballRunner.CharacterCodes={}));var PlayerModel=function(){function PlayerModel(){this.resetLast();this.resetBest()}PlayerModel.prototype.resetLast=function(){this.lastScore={gameTime_sec:0,tileDistance:0}};PlayerModel.prototype.resetBest=function(){this.bestScore={gameTime_sec:0,tileDistance:0}};PlayerModel.prototype.setGameTime=function(val){this.lastScore.gameTime_sec=val;this.bestScore.gameTime_sec=Math.max(this.lastScore.gameTime_sec,this.bestScore.gameTime_sec)};PlayerModel.prototype.setPlayerWorldTileCoordY=function(val){this.lastScore.tileDistance=val;this.bestScore.tileDistance=Math.max(this.lastScore.tileDistance,this.bestScore.tileDistance)};PlayerModel.prototype.setCharacterCode=function(val){this.characterCode=val};return PlayerModel}();GumballRunner.PlayerModel=PlayerModel;PlayerModel.instance=new PlayerModel})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var SceneHelper=function(){function SceneHelper(){}SceneHelper.defs={BOOT:"BOOT",PRELOADER:"PRELOADER",TITLE:"TITLE",CHARACTER_SELECT:"CHARACTER_SELECT",HOW_TO_PLAY:"HOW_TO_PLAY",GAME:"GAME",SCORE:"SCORE"};return SceneHelper}();GumballRunner.SceneHelper=SceneHelper})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Static=function(_super){__extends(Static,_super);function Static(game,x,y,frame,mirror){if(mirror===void 0){mirror=false}var _this=_super.call(this,game,x,y,GumballRunner.AssetHelper.gameAtlasCacheKey,frame)||this;_this.baseX=x;_this.baseY=y;_this.game.physics.box2d.enable(_this,true);_this.body.clearFixtures();var useFrame=frame;if(mirror)useFrame+="-mirror";_this.body.loadPolygon(GumballRunner.AssetHelper.physicsDataKey,useFrame,_this);_this.body.setCollisionCategory(GumballRunner.Game.wallCollisionGroup);_this.body.sensor=true;_this.body.static=true;_this.body.fixedRotation=true;_this.body.collideWorldBounds=false;_this.body.x=_this.baseX;_this.body.y=_this.baseY;var sx=_this.game.resolution;var sy=sx;_this.scale.set(sx,sy);if(mirror)_this.scale.set(-sx,sy);_this.autoCull=true;return _this}return Static}(Phaser.Sprite);GumballRunner.Static=Static})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var StringHelper=function(){function StringHelper(){}StringHelper.getString=function(key){if(!StringHelper.model)throw new Error("StringHelper has no model");var kObj=StringHelper.model[key];var dType=typeof kObj;var rStr="";if(dType=="string")rStr=kObj;else if(dType=="object"&&kObj&&kObj.hasOwnProperty("str"))rStr=kObj["str"];return rStr};StringHelper.applyStyleOverrides=function(key,styleObj){if(!StringHelper.model)throw new Error("StringHelper has no model");var kObj=StringHelper.model[key];var dType=typeof kObj;if(dType=="string")return styleObj;else if(dType=="object"&&kObj&&kObj.hasOwnProperty("str")){styleObj=JSON.parse(JSON.stringify(styleObj));for(var pkey in kObj){if(kObj.hasOwnProperty(pkey)&&pkey!="str")styleObj[pkey]=kObj[pkey]}}return styleObj};return StringHelper}();GumballRunner.StringHelper=StringHelper})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var TextButton=function(_super){__extends(TextButton,_super);function TextButton(game,x,y,callback,callbackContext,paddingX,paddingY,text,styleObj,minWidth,minHeight){if(paddingX===void 0){paddingX=40}if(paddingY===void 0){paddingY=20}if(minWidth===void 0){minWidth=0}if(minHeight===void 0){minHeight=0}return _super.call(this,game,x,y,callback,callbackContext,paddingX,paddingY,[text,styleObj],minWidth,minHeight)||this}TextButton.prototype.factoryView=function(params){var text=params[0];var styleObj=params[1];var style={font:"35px Lubalin",fill:GumballRunner.ColourHelper.WHITE,align:"center",boundsAlignH:"center",boundsAlignV:"middle"};for(var key in styleObj)if(styleObj.hasOwnProperty(key))style[key]=styleObj[key];var t=new Phaser.Text(this.game,0,0,text,style);t.anchor.set(.5);return t};return TextButton}(GumballRunner.PanelButton);GumballRunner.TextButton=TextButton})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var UIPanelShape;(function(UIPanelShape){UIPanelShape[UIPanelShape["rectangle"]=0]="rectangle";UIPanelShape[UIPanelShape["circle"]=1]="circle";UIPanelShape[UIPanelShape["ellipse"]=2]="ellipse"})(UIPanelShape=GumballRunner.UIPanelShape||(GumballRunner.UIPanelShape={}));var UIPanel=function(_super){__extends(UIPanel,_super);function UIPanel(game,rect,style,shadowStyle){var _this=_super.call(this,game,0,0)||this;_this.shadowStyle={offsetX:10,offsetY:10};_this.rect=rect;_this.style=style;_this.shadowStyle=shadowStyle;_this.panel=new Phaser.Graphics(_this.game);_this.addChild(_this.panel);_this.redraw();return _this}UIPanel.prototype.setStyle=function(style,shadowStyle){this.style=style;if(typeof shadowStyle!=="undefined")this.shadowStyle=shadowStyle;this.redraw()};UIPanel.prototype.removeDropShadow=function(){this.shadowStyle=null;this.redraw()};UIPanel.prototype.redraw=function(){this.redrawPanel();if(this.shadowStyle)this.redrawDropShadow();else if(this.shadow){this.shadow.destroy();this.shadow=null}};UIPanel.prototype.redrawPanel=function(){this.panel.clear();this.panel.beginFill(this.style.fillColour,this.style.fillAlpha);this.panel.lineStyle(this.style.strokeWidth,this.style.strokeColour,this.style.strokeAlpha);switch(this.style.shape){case UIPanelShape.circle:this.panel.drawCircle(0,0,this.style.radius);break;case UIPanelShape.ellipse:this.panel.drawEllipse(0,0,this.rect.halfWidth,this.rect.halfHeight);break;default:if(this.style.radius>0)this.panel.drawRoundedRect(-this.rect.halfWidth+this.rect.x,-this.rect.halfHeight+this.rect.y,this.rect.width,this.rect.height,this.style.radius);else this.panel.drawRect(-this.rect.halfWidth+this.rect.x,-this.rect.halfHeight+this.rect.y,this.rect.width,this.rect.height)}};UIPanel.prototype.redrawDropShadow=function(){if(!this.shadow){this.shadow=new Phaser.Graphics(this.game);this.addChildAt(this.shadow,0)}else this.shadow.clear();this.shadow.beginFill(65793,1);switch(this.style.shape){case UIPanelShape.circle:this.shadow.drawCircle(0,0,this.style.radius);break;case UIPanelShape.ellipse:this.shadow.drawEllipse(0,0,this.rect.halfWidth,this.rect.halfHeight);break;default:if(this.style.radius>0)this.shadow.drawRoundedRect(-this.rect.halfWidth+this.rect.x,-this.rect.halfHeight+this.rect.y,this.rect.width,this.rect.height,this.style.radius);else this.shadow.drawRect(-this.rect.halfWidth+this.rect.x,-this.rect.halfHeight+this.rect.y,this.rect.width,this.rect.height)}this.shadow.x=this.panel.x+this.shadowStyle.offsetX;this.shadow.y=this.panel.y+this.shadowStyle.offsetY};return UIPanel}(Phaser.Sprite);GumballRunner.UIPanel=UIPanel})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var WorldManager=function(){function WorldManager(game){this.lookVal=1;this.baddiePresentedTilesAgo=0;this.baddieEveryNTiles=2;this.game=game;this.container=new Phaser.Group(this.game);this.initWorldTiles()}WorldManager.prototype.destroy=function(){this.container.destroy(true);this.container=null;this.game=null;while(this.worldTiles.length)this.worldTiles.pop().destroy();this.worldTiles=null;this.enqueuedWorldTiles=null;this.liveWorldTiles=null};WorldManager.prototype.initWorldTiles=function(){this.worldTiles=[];this.enqueuedWorldTiles=[];this.liveWorldTiles=[];var worldTilesData=this.game.cache.getJSON(GumballRunner.AssetHelper.worldTilesDataKey);var tileTemplates=worldTilesData.tileTemplates;var i=0;while(this.worldTiles.length<tileTemplates.length){var name="wt_"+this.worldTiles.length.toString();var schematic=tileTemplates[i];var wt=new GumballRunner.WorldTile(this.game,name,this.container,schematic);this.worldTiles.push(wt);this.enqueWorldTile(wt);i++;if(i>=tileTemplates.length)i=0}this.lookVal=Math.floor(WorldManager.nLiveWorldTiles*.5);this.updateWorldView(0)};WorldManager.prototype.updateWorldView=function(basisTileY){var currentTileTag=basisTileY<3?"safe":null;var didAddTile=false;var minTileY=basisTileY;var maxTileY=basisTileY+this.lookVal;var i=0;var wt;var tilesToAddByWorldY=[];for(i=minTileY;i<=maxTileY;i++)tilesToAddByWorldY.push(i);for(i=0;i<this.liveWorldTiles.length;i++){wt=this.liveWorldTiles[i];if(wt.worldY<minTileY||wt.worldY>maxTileY){this.enqueWorldTile(wt);i--}else{var idx=tilesToAddByWorldY.indexOf(wt.worldY);if(idx>-1)tilesToAddByWorldY.splice(idx,1)}}for(i=tilesToAddByWorldY.length-1;i>=0;i--){var wy=tilesToAddByWorldY[i];wt=this.dequeWorldTile(currentTileTag);wt.setWorldPosition(wy);this.liveWorldTiles.push(wt);didAddTile=true}};WorldManager.prototype.stopNPCTweens=function(){for(var i=this.liveWorldTiles.length-1;i>=0;i--)this.liveWorldTiles[i].stopNPCTweens()};WorldManager.prototype.startNPCTweens=function(){for(var i=this.liveWorldTiles.length-1;i>=0;i--)this.liveWorldTiles[i].startNPCTweens()};WorldManager.prototype.dequeWorldTile=function(tag){if(this.enqueuedWorldTiles.length==0)throw new Error("No more available WorldTiles!");var wt=null;if(!tag&&this.baddiePresentedTilesAgo>=this.baddieEveryNTiles)tag="baddie";if(tag){var escape=false;var maxTries=10;while(!escape||maxTries<=0){wt=this.enqueuedWorldTiles.pop();if(wt.hasTag(tag))escape=true;else this.enqueuedWorldTiles.unshift(wt);maxTries--}}else wt=this.enqueuedWorldTiles.pop();if(wt.hasTag("baddie"))this.baddiePresentedTilesAgo=0;else this.baddiePresentedTilesAgo++;wt.dequed();return wt};WorldManager.prototype.enqueWorldTile=function(wt){var idx=this.liveWorldTiles.indexOf(wt);this.liveWorldTiles.splice(idx,1);wt.enqued();var s=Math.floor(Math.random()*this.enqueuedWorldTiles.length);this.enqueuedWorldTiles.splice(s,0,wt)};WorldManager.nLiveWorldTiles=3;return WorldManager}();GumballRunner.WorldManager=WorldManager})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var WorldTile=function(){function WorldTile(game,name,container,schematic){this.worldY=-1;this.walls=[];this.baddies=[];this.tweenBaddies=[];this.positionables=[];this.game=game;this.container=container;this.group=new Phaser.Group(this.game,null);this.group.name=name;this.rect=new Phaser.Rectangle(0,0,GumballRunner.ScreenUtil.STAGE_WIDTH,GumballRunner.ScreenUtil.STAGE_HEIGHT);this.id=schematic.id;this.tags=schematic.tags;this.buildWithSchematic(schematic);this.setPosition(0,0)}WorldTile.prototype.destroy=function(){this.game=null;while(this.walls.length)this.walls.pop().destroy();this.walls=null;while(this.baddies.length)this.baddies.pop().destroy();this.baddies=null;while(this.tweenBaddies.length)this.tweenBaddies.pop().destroy();this.tweenBaddies=null;this.positionables=null;this.rect=null;this.group.destroy(true)};WorldTile.prototype.buildWithSchematic=function(schematic){var collideables=schematic.collideables;for(var i=0;i<collideables.length;i++){var cData=collideables[i];var params=cData.data;switch(cData.type){case"static":this.addWall(params.frame,params.place,params.offsetX,params.offsetY,params.mirror);break;case"baddie":this.addBaddie(params.key,params.x,params.y,params.bodyRad,params.animFPS);break;case"tweenbaddie":this.addTweenBaddie(params.key,params.x,params.y,params.bodyRad,params.xRange,params.speed,params.ease,params.animFPS);break}}};WorldTile.prototype.addDebugText=function(text,x,y){var textObj=new GumballRunner.WorldTileText(this.game,x,y,text);this.group.addChild(textObj);this.positionables.push(textObj)};WorldTile.prototype.addWall=function(frame,place,offsetX,offsetY,mirror){if(mirror===void 0){mirror=false}var x=0;var y=GumballRunner.ScreenUtil.STAGE_HEIGHT/2;switch(place){case"left":x=0;break;case"right":x=GumballRunner.ScreenUtil.STAGE_WIDTH;break}x+=offsetX*GumballRunner.AssetHelper.getAssetScale();y+=offsetY*GumballRunner.AssetHelper.getAssetScale();var wall=new GumballRunner.Static(this.game,x,y,frame,mirror);this.group.addChild(wall);this.walls.push(wall);this.positionables.push(wall)};WorldTile.prototype.addBaddie=function(spritesheetKey,x,y,bodyRad,animFPS){var baddie=new GumballRunner.Baddie(this.game,x,y,spritesheetKey,bodyRad,animFPS);this.group.addChild(baddie);this.baddies.push(baddie);this.positionables.push(baddie)};WorldTile.prototype.addTweenBaddie=function(spritesheetKey,x,y,bodyRad,xRange,speed,ease,animFPS){var baddie=new GumballRunner.MovingBaddie(this.game,x,y,spritesheetKey,bodyRad,xRange,speed,ease,animFPS);this.group.addChild(baddie);this.tweenBaddies.push(baddie);this.positionables.push(baddie)};WorldTile.prototype.stopNPCTweens=function(){for(var i=this.tweenBaddies.length-1;i>=0;i--){this.tweenBaddies[i].stopTween()}};WorldTile.prototype.startNPCTweens=function(){for(var i=this.tweenBaddies.length-1;i>=0;i--){this.tweenBaddies[i].startTween()}};WorldTile.prototype.enqued=function(){this.container.removeChild(this.group);this.worldY=-1;var i=0;for(i=this.baddies.length-1;i>=0;i--)this.baddies[i].kill();for(i=this.tweenBaddies.length-1;i>=0;i--)this.tweenBaddies[i].kill();for(i=this.walls.length-1;i>=0;i--)this.walls[i].kill()};WorldTile.prototype.dequed=function(){var i=0;for(i=this.baddies.length-1;i>=0;i--)this.baddies[i].reset(0,0);for(i=this.tweenBaddies.length-1;i>=0;i--)this.tweenBaddies[i].reset(0,0);for(i=this.walls.length-1;i>=0;i--)this.walls[i].reset(0,0);this.startNPCTweens();this.container.addChild(this.group)};WorldTile.prototype.setWorldPosition=function(y){this.worldY=y;var tx=GumballRunner.ScreenUtil.SAFE_ZONE_RECT.centerX-GumballRunner.ScreenUtil.STAGE_WIDTH_HALF;var ty=-GumballRunner.ScreenUtil.STAGE_HEIGHT*(this.worldY+1);this.setPosition(tx,ty)};WorldTile.prototype.setPosition=function(x,y){this.rect.x=x;this.rect.y=y;this.updatePosition()};WorldTile.prototype.hasTag=function(tag){return this.tags.indexOf(tag)>-1};WorldTile.prototype.updatePosition=function(){var x=this.rect.x;var y=this.rect.y;for(var i=this.positionables.length-1;i>=0;i--){var p=this.positionables[i];if(p.body){p.body.x=x+p.baseX;p.body.y=y+p.baseY}else{p.x=x+p.baseX;p.y=y+p.baseY}}};return WorldTile}();GumballRunner.WorldTile=WorldTile})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var WorldTileText=function(_super){__extends(WorldTileText,_super);function WorldTileText(game,x,y,text,style){var _this=_super.call(this,game,x,y,text,style)||this;_this.baseX=x;_this.baseY=y;return _this}return WorldTileText}(Phaser.Text);GumballRunner.WorldTileText=WorldTileText})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Boot=function(_super){__extends(Boot,_super);function Boot(){return _super!==null&&_super.apply(this,arguments)||this}Boot.prototype.init=function(){this.input.maxPointers=1;this.physics.startSystem(Phaser.Physics.BOX2D);this.time.desiredFps=Phaser.Device["desktop"]||Phaser.Device["iOS"]?60:30;this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;this.scale.windowConstraints.bottom="visual";this.scale.windowConstraints.right=null;this.scale.pageAlignHorizontally=true};Boot.prototype.preload=function(){this.load.image("loadbar",GumballRunner.AssetHelper.getAssetRoot()+"loadbar.png")};Boot.prototype.create=function(){this.game.state.start(GumballRunner.SceneHelper.defs.PRELOADER)};return Boot}(Phaser.State);GumballRunner.Boot=Boot})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var CharacterSelect=function(_super){__extends(CharacterSelect,_super);function CharacterSelect(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.textStyle_choose_char={font:"40px Lubalin",fill:GumballRunner.ColourHelper.YELLOW,wordWrapWidth:GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH-50*2,wordWrap:true,align:"center"};return _this}CharacterSelect.prototype.create=function(){this.game.startMenuLoop();this.container=new Phaser.Group(this.game,this.world);this.container.fixedToCamera=true;if(GumballRunner.Title.background)GumballRunner.Title.background.visible=true;var logo=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"gumball-logo");logo.anchor.set(.5,1);this.container.addChild(logo);logo.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.TOP_CENTER,0,-50);var chooseCharText=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString("choose_your_character"),this.textStyle_choose_char);chooseCharText.setShadow(5,5,"rgba(0,0,0,1)",0);chooseCharText.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER,0,-160);this.container.addChild(chooseCharText);var characterCodes=[GumballRunner.CharacterCodes.GUMBALL,GumballRunner.CharacterCodes.ANAIS,GumballRunner.CharacterCodes.DARWIN];this.charButtons=new Phaser.Group(this.game,this.container);var charButton;for(var i=0;i<characterCodes.length;i++){var characterCode=characterCodes[i];charButton=new GumballRunner.CharacterSelectButton(this.game,0,0,this.onCharacterSelectButton,this,GumballRunner.AssetHelper.uiAtlasCacheKey,characterCode);this.charButtons.add(charButton)}var spread=.9;this.charButtons.align(this.charButtons.children.length,1,GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH*spread/this.charButtons.children.length,charButton.height);this.charButtons.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER,0,70);this.container.addChild(this.charButtons);this.selectedIcon=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"choosechar_selected");this.selectedIcon.anchor.set(.5);this.selectedIcon.visible=false;this.container.addChild(this.selectedIcon);this.startButton=new GumballRunner.TextButton(this.game,0,0,this.onStartButton,this,GumballRunner.AssetHelper.textButtonPaddingX,GumballRunner.AssetHelper.textButtonPaddingY,GumballRunner.StringHelper.getString("start"));this.startButton.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.BOTTOM_CENTER,0,-200);this.startButton.visible=false;this.container.add(this.startButton);var cnlogo=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"cnlogo");cnlogo.anchor.set(.5,0);this.container.addChild(cnlogo);cnlogo.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.BOTTOM_CENTER,0,-50);this.world.addChild(this.container)};CharacterSelect.prototype.shutdown=function(){this.startButton=null;this.charButtons=null;this.container.destroy(true)};CharacterSelect.prototype.onCharacterSelectButton=function(button){GumballRunner.PlayerModel.instance.setCharacterCode(button.data.characterCode);this.game.playSelectionClickFX();this.selectedIcon.visible=true;var offsX=45;var offsY=-45;this.selectedIcon.x=this.charButtons.x+button.x+button.width/2+offsX;this.selectedIcon.y=this.charButtons.y+button.y-button.height/2+offsY;this.startButton.visible=true};CharacterSelect.prototype.onStartButton=function(){this.game.playButtonClickFX();var nextState=GumballRunner.HowToPlay.timesShown>0?GumballRunner.SceneHelper.defs.GAME:GumballRunner.SceneHelper.defs.HOW_TO_PLAY;this.game.state.start(nextState)};return CharacterSelect}(Phaser.State);GumballRunner.CharacterSelect=CharacterSelect})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Game=function(_super){__extends(Game,_super);function Game(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.playerStartPosition=new Phaser.Point(GumballRunner.ScreenUtil.SAFE_ZONE_RECT.centerX,-150*GumballRunner.AssetHelper.getAssetScale());_this.playerWorldTileCoordY=0;_this.prevPlayerWorldTileCoordY=-1;_this.playState=Game.states.INIT;_this.worldRefreshClock=0;return _this}Game.prototype.init=function(){var pScale=1/(this.game.time.desiredFps/60);this.worldRefreshFPS=1e3/(5*pScale);this.initPhysics()};Game.prototype.create=function(){this.game.stopMenuLoop();if(GumballRunner.Title.background)GumballRunner.Title.background.visible=false;this.container=new Phaser.Group(this.game,this.world);this.worldLayer=new Phaser.Group(this.game,this.container);this.playerLayer=new Phaser.Group(this.game,this.container);this.uiLayer=new Phaser.Group(this.game,this.container);var n=GumballRunner.MathUtil.MAX_INT;this.world.setBounds(0,-n,GumballRunner.ScreenUtil.STAGE_WIDTH,n);var playerWorldPadding=150*GumballRunner.AssetHelper.getAssetScale();this.playerBoundsLeft=this.world.bounds.x+playerWorldPadding;this.playerBoundsRight=this.world.bounds.x+(this.world.bounds.width-playerWorldPadding);this.initWorldManager();this.initTilingBackground();this.initPlayer();this.initPlayerController();this.initDistanceFog();this.initGameTimer();this.initCountdown();if(GumballRunner.Application.audioEnabled)this.initMuteButton();this.initCamera();if(!Phaser.Device["desktop"]){if(Phaser.Device["iOSVersion"]<=10)this.game.activateSuperOptimalRender();else this.game.activateOptimalRender()}this.resetGame()};Game.prototype.shutdown=function(){this.playState=Game.states.INIT;this.worldManager.destroy();this.worldManager=null;this.player.destroy(true);this.player=null;this.countdown.destroy();this.countdown=null;this.playerController.destroy();this.playerController=null;this.container.destroy(true);this.game.deactivateOptimalRender()};Game.prototype.initPhysics=function(){this.game.physics.box2d.clear();this.game.physics.box2d.frameRate=1/1;this.game.physics.box2d.velocityIterations=1;this.game.physics.box2d.positionIterations=1;this.game.physics.box2d.gravity.y=0};Game.prototype.initWorldManager=function(){this.worldManager=new GumballRunner.WorldManager(this.game);this.worldLayer.addChild(this.worldManager.container)};Game.prototype.initTilingBackground=function(){this.background=new Phaser.TileSprite(this.game,0,0,GumballRunner.ScreenUtil.STAGE_WIDTH,GumballRunner.ScreenUtil.STAGE_HEIGHT,GumballRunner.AssetHelper.roadTileKey);this.background.fixedToCamera=true;this.container.addChildAt(this.background,0)};Game.prototype.initPlayer=function(){this.player=new GumballRunner.Player(this.game,this.playerStartPosition.x,this.playerStartPosition.y);this.playerLayer.addChild(this.player);this.player.setState(GumballRunner.Player.states.RUN);this.player.body.setCategoryContactCallback(Game.wallCollisionGroup,this.onPlayerWallCollision,this);this.player.body.setCategoryContactCallback(Game.baddieCollisionGroup,this.onPlayerBaddieCollision,this)};Game.prototype.initPlayerController=function(){this.playerController=new GumballRunner.PlayerController(this.game,this.player)};Game.prototype.initDistanceFog=function(){var dFog=new Phaser.TileSprite(this.game,0,0,GumballRunner.ScreenUtil.STAGE_WIDTH,150,GumballRunner.AssetHelper.distanceFogTileKey);dFog.fixedToCamera=true;this.worldLayer.addChild(dFog)};Game.prototype.initGameTimer=function(){this.gameTimer=new GumballRunner.GameTimer(this.game,{font:"30px 04b30"});var trOffsetX=20;var trOffsetY=50;this.gameTimer.x=GumballRunner.ScreenUtil.SAFE_ZONE_RECT.x+GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH-(this.gameTimer.panel.rect.width/2+trOffsetX);this.gameTimer.y=trOffsetY;this.gameTimer.fixedToCamera=true;this.uiLayer.addChild(this.gameTimer)};Game.prototype.initMuteButton=function(){this.muteButton=new GumballRunner.MuteButton(this.game,0,0);var tlOffsetX=20;this.muteButton.alignTo(this.gameTimer,Phaser.CENTER,0,-this.muteButton.height);this.muteButton.x=GumballRunner.ScreenUtil.SAFE_ZONE_RECT.left+this.muteButton.panel.rect.width/2+tlOffsetX;this.muteButton.fixedToCamera=true;this.uiLayer.addChild(this.muteButton)};Game.prototype.initCountdown=function(){this.countdown=new GumballRunner.Countdown(this.game,0,0,"countdown");this.countdown.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER,0,-100);this.countdown.fixedToCamera=true;this.countdown.goSignal.add(this.onCountdownGo,this);this.countdown.completeSignal.add(this.onCountdownComplete,this);this.uiLayer.addChild(this.countdown)};Game.prototype.initCamera=function(){this.game.camera.follow(this.player.cameraTarget,Phaser.Camera.FOLLOW_LOCKON,.5,.5);this.camera.lerp.x=this.camera.lerp.y=.99999};Game.prototype.setPlayState=function(state){if(state==this.playState)return;this.playState=state;switch(this.playState){case Game.states.COUNTDOWN:this.countdown.start();break;case Game.states.PLAY:this.startMusic();break;case Game.states.DAZED:this.time.events.add(Phaser.Timer.SECOND*Game.playerDazedTime,this.onDazedEnd,this);break}};Game.prototype.startMusic=function(){try{if(!GumballRunner.Application.audioEnabled)return;this.musicLoop=this.game.sound.play("game_loop",1,true)}catch(e){}};Game.prototype.stopMusic=function(){try{if(!GumballRunner.Application.audioEnabled)return;if(this.musicLoop){this.musicLoop.stop();this.musicLoop=null}}catch(e){}};Game.prototype.playCollisionFX=function(){try{if(!GumballRunner.Application.audioEnabled)return;this.game.sound.play("sfx_collision")}catch(e){}};Game.prototype.resetGame=function(){this.gameTimer.zero();this.playerController.stopInput();this.player.setState(GumballRunner.Player.states.IDLE);this.resetPlayerToStart();this.worldManager.startNPCTweens();this.setPlayState(Game.states.COUNTDOWN)};Game.prototype.beginGame=function(){this.gameTimer.restart();this.player.setState(GumballRunner.Player.states.RUN);this.playerController.startInput();this.setPlayState(Game.states.PLAY)};Game.prototype.enterDazedState=function(){this.stopMusic();this.gameTimer.stop();GumballRunner.PlayerModel.instance.setPlayerWorldTileCoordY(this.playerWorldTileCoordY);GumballRunner.PlayerModel.instance.setGameTime(this.gameTimer.value);this.camera.shake(.016,450,false,Phaser.Camera.SHAKE_BOTH);this.camera.flash(16777215,250,false,.8);this.worldManager.stopNPCTweens();this.player.setState(GumballRunner.Player.states.DAZED);this.playerController.stopInput();this.player.body.velocity.x=this.player.body.velocity.y=0;this.setPlayState(Game.states.DAZED)};Game.prototype.updatePlayerControls=function(dt){this.playerController.update(dt)};Game.prototype.updateBasicCollisionDetection=function(){if(this.player.body.x<this.playerBoundsLeft||this.player.body.x>this.playerBoundsRight)this.enterDazedState()};Game.prototype.recalcPlayerTilePositionAndUpdateWorldView=function(){var ref=this.player?this.player.body.y:0;ref+=70;this.playerWorldTileCoordY=-Math.round((ref-GumballRunner.ScreenUtil.STAGE_HEIGHT_HALF)/GumballRunner.ScreenUtil.STAGE_HEIGHT)-1;if(this.playerWorldTileCoordY!=this.prevPlayerWorldTileCoordY){this.worldManager.updateWorldView(this.playerWorldTileCoordY);this.playerController.setPlayerWorldTileCoordY(this.playerWorldTileCoordY)}this.prevPlayerWorldTileCoordY=this.playerWorldTileCoordY};Game.prototype.resetPlayerToStart=function(){this.player.body.x=this.playerStartPosition.x;this.player.body.y=this.playerStartPosition.y;this.recalcPlayerTilePositionAndUpdateWorldView()};Game.prototype.update=function(){switch(this.playState){case Game.states.PLAY:this.updatePlayerControls(this.game.time.elapsed);this.updateBasicCollisionDetection();break}this.worldRefreshClock+=this.time.elapsedMS;if(this.worldRefreshClock>=this.worldRefreshFPS){this.recalcPlayerTilePositionAndUpdateWorldView();this.worldRefreshClock=0}this.background.tilePosition.y=-this.player.body.y};Game.prototype.onCountdownGo=function(){this.beginGame()};Game.prototype.onCountdownComplete=function(){};Game.prototype.onPlayerCollision=function(b1,b2){if(typeof b1.parent.sprite.onCollision=="function")b1.parent.sprite.onCollision();if(typeof b2.parent.sprite.onCollision=="function")b2.parent.sprite.onCollision();this.playCollisionFX();this.enterDazedState()};Game.prototype.onPlayerWallCollision=function(b1,b2){this.playCollisionFX();this.enterDazedState()};Game.prototype.onPlayerBaddieCollision=function(b1,b2){if(typeof b1.sprite.onCollision=="function")b1.sprite.onCollision();if(typeof b2.sprite.onCollision=="function")b2.sprite.onCollision();this.playCollisionFX();this.enterDazedState()};Game.prototype.onDazedEnd=function(){this.game.state.start(GumballRunner.SceneHelper.defs.SCORE)};Game.states={INIT:null,COUNTDOWN:0,PLAY:1,DAZED:2};Game.wallCollisionGroup=1;Game.playerCollisionGroup=2;Game.baddieCollisionGroup=3;Game.countdownTime=3;Game.playerDazedTime=3;return Game}(Phaser.State);GumballRunner.Game=Game})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var HowToPlay=function(_super){__extends(HowToPlay,_super);function HowToPlay(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.panelStyle={strokeColour:14102391,strokeWidth:0,strokeAlpha:1,fillColour:14102391,fillAlpha:1,radius:10};_this.panelShadowStyle={offsetX:15,offsetY:15};_this.textStyle_title={font:"78px Lubalin",fill:GumballRunner.ColourHelper.YELLOW,wordWrapWidth:GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH-50*2,wordWrap:true,align:"center"};_this.textStyle_tiltPhone={font:"26px Lubalin",fill:GumballRunner.ColourHelper.WHITE,wordWrapWidth:250,wordWrap:true,align:"left"};_this.textStyle_avoidObstacles={font:"32px Lubalin",fill:GumballRunner.ColourHelper.BLACK,wordWrapWidth:300,wordWrap:true,align:"left"};return _this}HowToPlay.prototype.create=function(){this.game.startMenuLoop();HowToPlay.timesShown++;this.container=new Phaser.Group(this.game,this.world);this.container.fixedToCamera=true;if(GumballRunner.Title.background)GumballRunner.Title.background.visible=true;var mainPanelRect=GumballRunner.ScreenUtil.SAFE_ZONE_RECT.clone();mainPanelRect.inflate(-45,-35);var mainPanelUIRect=mainPanelRect.clone();mainPanelUIRect.x=mainPanelUIRect.y=0;var mainPanel=new GumballRunner.UIPanel(this.game,mainPanelUIRect,this.panelStyle,this.panelShadowStyle);mainPanel.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER,mainPanel.shadowStyle.offsetX,mainPanel.shadowStyle.offsetY);this.container.addChild(mainPanel);var title=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString("how_to_play"),this.textStyle_title);title.setShadow(5,5,"rgba(0,0,0,1)",0);title.alignIn(mainPanelRect,Phaser.TOP_CENTER,0,-30);this.container.addChild(title);var tiltPhone=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString("tilt_your_phone_to_steer"),this.textStyle_tiltPhone);tiltPhone.alignIn(mainPanelRect,Phaser.CENTER,-85,-135);this.container.addChild(tiltPhone);var tiltPhoneSprite=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"phonetilt");tiltPhoneSprite.anchor.set(.5);tiltPhoneSprite.alignIn(mainPanelRect,Phaser.CENTER,120,-135);this.container.addChild(tiltPhoneSprite);this.game.add.tween(tiltPhoneSprite).to({rotation:Phaser.Math.degToRad(35)},650,Phaser.Easing.Linear.None,true,-1,-1,true);var avoidObstacles=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString("avoid_the_obstacles"),this.textStyle_avoidObstacles);avoidObstacles.alignIn(mainPanelRect,Phaser.CENTER,-0,30);this.container.addChild(avoidObstacles);var objs=["Carman","Anton","hole"];var cnlogo=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"cnlogo");var avoidGfks=new Phaser.Group(this.game,this.container);var avoidGfk;for(var i=0;i<objs.length;i++){avoidGfk=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,objs[i]);avoidGfks.add(avoidGfk)}var spread=.75;avoidGfks.align(avoidGfks.children.length,1,GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH*spread/avoidGfks.children.length,avoidGfk.height);avoidGfks.alignTo(avoidObstacles,Phaser.BOTTOM_CENTER,0,30);this.container.addChild(avoidGfks);var startButton=new GumballRunner.TextButton(this.game,0,0,this.onStartButton,this,GumballRunner.AssetHelper.textButtonPaddingX,GumballRunner.AssetHelper.textButtonPaddingY,GumballRunner.StringHelper.getString("start"));startButton.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.BOTTOM_CENTER,0,-200);this.container.add(startButton);this.world.addChild(this.container)};HowToPlay.prototype.shutdown=function(){this.container.destroy(true)};HowToPlay.prototype.onStartButton=function(){this.game.playButtonClickFX();this.game.state.start(GumballRunner.SceneHelper.defs.GAME)};HowToPlay.timesShown=0;return HowToPlay}(Phaser.State);GumballRunner.HowToPlay=HowToPlay})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Preloader=function(_super){__extends(Preloader,_super);function Preloader(){return _super!==null&&_super.apply(this,arguments)||this}Preloader.prototype.preload=function(){var preloadBar=this.add.sprite(0,0,"loadbar");preloadBar.anchor.set(0,.5);preloadBar.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER);this.load.setPreloadSprite(preloadBar);var uiAtlasPath=GumballRunner.AssetHelper.getAssetRoot()+"atlas_ui";this.load.atlas(GumballRunner.AssetHelper.uiAtlasCacheKey,uiAtlasPath+".png",uiAtlasPath+".json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH);var gameAtlasPath=GumballRunner.AssetHelper.getAssetRoot()+"atlas_game";this.load.atlas(GumballRunner.AssetHelper.gameAtlasCacheKey,gameAtlasPath+".png",gameAtlasPath+".json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH);this.load.image(GumballRunner.AssetHelper.roadTileKey,GumballRunner.AssetHelper.getAssetRoot()+"road-grass.jpg");this.load.image(GumballRunner.AssetHelper.distanceFogTileKey,GumballRunner.AssetHelper.getAssetRoot()+"tile-dfog.png");this.load.image(GumballRunner.AssetHelper.menuBackgroundTileKey,GumballRunner.AssetHelper.getAssetRoot()+"tile-menu.jpg");this.load.json(GumballRunner.AssetHelper.localeStringsKey,GumballRunner.AssetHelper.stringsRoot+GumballRunner.Application.localeString+".json");this.load.physics(GumballRunner.AssetHelper.physicsDataKey,GumballRunner.AssetHelper.getDataRoot()+"physics.json");this.load.json(GumballRunner.AssetHelper.worldTilesDataKey,GumballRunner.AssetHelper.getDataRoot()+"worldtiles.json");if(GumballRunner.Application.audioEnabled){this.load.audio("sfx_collision",GumballRunner.AssetHelper.getAudioRoot()+"collision.mp3");this.load.audio("menu_loop",GumballRunner.AssetHelper.getAudioRoot()+"menu_loop.mp3");this.load.audio("game_loop",GumballRunner.AssetHelper.getAudioRoot()+"game_loop.mp3");this.load.audio("beep",GumballRunner.AssetHelper.getAudioRoot()+"beep.mp3");this.load.audio("bikehorn",GumballRunner.AssetHelper.getAudioRoot()+"bikehorn.mp3");this.load.audio("airhorn",GumballRunner.AssetHelper.getAudioRoot()+"airhorn.mp3");this.load.audio("buttonclick",GumballRunner.AssetHelper.getAudioRoot()+"buttonclick.mp3")}var antonFrameRect=new Phaser.Rectangle(0,0,165,169);this.load.spritesheet("anton-baddie",GumballRunner.AssetHelper.getAssetRoot()+"anton-baddie.png",antonFrameRect.width,antonFrameRect.height);var bananaJoeFrameRect=new Phaser.Rectangle(0,0,145,169);this.load.spritesheet("bananajoe-baddie",GumballRunner.AssetHelper.getAssetRoot()+"bananajoe-baddie.png",bananaJoeFrameRect.width,bananaJoeFrameRect.height);var donutFrameRect=new Phaser.Rectangle(0,0,170,180);this.load.spritesheet("donut-baddie",GumballRunner.AssetHelper.getAssetRoot()+"donut-baddie.png",donutFrameRect.width,donutFrameRect.height);var carmanFrameRect=new Phaser.Rectangle(0,0,160,180);this.load.spritesheet("carman-baddie",GumballRunner.AssetHelper.getAssetRoot()+"carman-baddie.png",carmanFrameRect.width,carmanFrameRect.height);var holeFrameRect=new Phaser.Rectangle(0,0,158,152);this.load.spritesheet("hole-baddie",GumballRunner.AssetHelper.getAssetRoot()+"hole-baddie.png",holeFrameRect.width,holeFrameRect.height,2);var alanFrameRect=new Phaser.Rectangle(0,0,104,169);this.load.spritesheet("alan-baddie",GumballRunner.AssetHelper.getAssetRoot()+"alan-baddie.png",alanFrameRect.width,alanFrameRect.height);var ballFrameRect=new Phaser.Rectangle(0,0,191,139);this.load.spritesheet("ball-baddie",GumballRunner.AssetHelper.getAssetRoot()+"ball-baddie.png",ballFrameRect.width,ballFrameRect.height);var gumballFrameRect=new Phaser.Rectangle(0,0,136,169);this.load.spritesheet(GumballRunner.CharacterCodes.GUMBALL,GumballRunner.AssetHelper.getAssetRoot()+"gumball.png",gumballFrameRect.width,gumballFrameRect.height);var anaisFrameRect=new Phaser.Rectangle(0,0,135,169);this.load.spritesheet(GumballRunner.CharacterCodes.ANAIS,GumballRunner.AssetHelper.getAssetRoot()+"anais.png",anaisFrameRect.width,anaisFrameRect.height);var darwinFrameRect=new Phaser.Rectangle(0,0,135,169);this.load.spritesheet(GumballRunner.CharacterCodes.DARWIN,GumballRunner.AssetHelper.getAssetRoot()+"darwin.png",darwinFrameRect.width,darwinFrameRect.height)};Preloader.prototype.create=function(){GumballRunner.StringHelper.model=this.game.cache.getJSON(GumballRunner.AssetHelper.localeStringsKey);if(GumballRunner.Application.audioEnabled){var collision=this.game.add.audio("sfx_collision");var menuLoop=this.game.add.audio("menu_loop");var gameLoop=this.game.add.audio("game_loop");var beep=this.game.add.audio("beep");var bikehorn=this.game.add.audio("bikehorn");var airhorn=this.game.add.audio("airhorn");var buttonclick=this.game.add.audio("buttonclick");var sounds=[collision,menuLoop,gameLoop,beep,bikehorn,airhorn,buttonclick];this.game.sound.setDecodedCallback(sounds,this.start,this)}else this.start()};Preloader.prototype.start=function(){if(!Phaser.Device["desktop"]){this.scale.onOrientationChange.add(this.game.onOrientationChange,this.game);this.game.updateOrientationState()}this.game.state.start(GumballRunner.SceneHelper.defs.TITLE)};return Preloader}(Phaser.State);GumballRunner.Preloader=Preloader})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Score=function(_super){__extends(Score,_super);function Score(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.panelStyle={strokeColour:14102391,strokeWidth:0,strokeAlpha:1,fillColour:14102391,fillAlpha:1,radius:10};_this.panelShadowStyle={offsetX:15,offsetY:15};_this.textStyle_title={font:"72px Lubalin",fill:GumballRunner.ColourHelper.YELLOW,wordWrapWidth:GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH-100*2,wordWrap:true,align:"center"};_this.textStyle_youLasted={font:"30px Lubalin",fill:GumballRunner.ColourHelper.BLACK,wordWrapWidth:300,wordWrap:true,align:"center"};_this.textStyle_seconds={font:"28px Lubalin",fill:GumballRunner.ColourHelper.WHITE};return _this}Score.prototype.create=function(){this.game.startMenuLoop();this.container=new Phaser.Group(this.game,this.world);this.container.fixedToCamera=true;if(GumballRunner.Title.background)GumballRunner.Title.background.visible=true;var mainPanelRect=GumballRunner.ScreenUtil.SAFE_ZONE_RECT.clone();mainPanelRect.inflate(-45,-75);var mainPanelUIRect=mainPanelRect.clone();mainPanelUIRect.x=mainPanelUIRect.y=0;var mainPanel=new GumballRunner.UIPanel(this.game,mainPanelUIRect,this.panelStyle,this.panelShadowStyle);mainPanel.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.BOTTOM_CENTER,mainPanel.shadowStyle.offsetX,mainPanel.shadowStyle.offsetY-mainPanelRect.height/2);mainPanel.y-=50;this.container.addChild(mainPanel);mainPanelRect.x=mainPanel.x-mainPanelRect.width/2;mainPanelRect.y=mainPanel.y-mainPanelRect.height/2;var scoreTitleBand=this.getScoreBand();var scoreTitleStrRef="score_title_"+scoreTitleBand.toString();var title=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString(scoreTitleStrRef),this.textStyle_title);title.setShadow(5,5,"rgba(0,0,0,1)",0);title.alignIn(mainPanelRect,Phaser.TOP_CENTER,0,-30);this.container.addChild(title);var youLasted=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString("you_lasted"),this.textStyle_youLasted);youLasted.alignIn(mainPanelRect,Phaser.CENTER,0,-160);this.container.addChild(youLasted);var gameTimeContainer=new Phaser.Sprite(this.game,0,0);gameTimeContainer.anchor.set(.5);this.container.addChild(gameTimeContainer);var gameTimer=new GumballRunner.GameTimer(this.game,{font:"68px 04b30"},40,15);gameTimer.setValue(GumballRunner.PlayerModel.instance.lastScore.gameTime_sec);gameTimeContainer.addChild(gameTimer);var seconds=new Phaser.Text(this.game,0,0,GumballRunner.StringHelper.getString("seconds"),this.textStyle_seconds);seconds.anchor.set(.5);if(GumballRunner.PlayerModel.instance.lastScore.gameTime_sec<60)gameTimeContainer.addChild(seconds);seconds.y+=gameTimer.height/2+70;var r=Phaser.Math.degToRad(2+Math.random()*2);gameTimeContainer.rotation=Math.random()>.5?-r:r;gameTimeContainer.alignIn(mainPanelRect,Phaser.CENTER,0,-70);var hsRect=new Phaser.Rectangle(0,0,mainPanelRect.width*.67,100);var highScorePanel=new GumballRunner.HighScorePanel(this.game,hsRect);highScorePanel.alignIn(mainPanelRect,Phaser.CENTER,0,130);this.container.addChild(highScorePanel);var buttonStyle={font:"28px Lubalin"};var minWidth=mainPanelRect.width*.83;var minHeight=70;var chooseCharacterButton=new GumballRunner.TextButton(this.game,0,0,this.onChooseCharacterButton,this,0,0,GumballRunner.StringHelper.getString("choose_your_character"),buttonStyle,minWidth,minHeight);chooseCharacterButton.alignIn(mainPanelRect,Phaser.BOTTOM_CENTER,0,-minHeight*.75);chooseCharacterButton.panel.removeDropShadow();this.container.add(chooseCharacterButton);var playAgainButton=new GumballRunner.TextButton(this.game,0,0,this.onPlayAgainButton,this,0,0,GumballRunner.StringHelper.getString("play_again"),buttonStyle,minWidth,minHeight);playAgainButton.alignTo(chooseCharacterButton,Phaser.TOP_CENTER,0,minHeight*.5+20);playAgainButton.panel.removeDropShadow();this.container.add(playAgainButton);this.world.addChild(this.container)};Score.prototype.getScoreBand=function(){var s=GumballRunner.PlayerModel.instance.lastScore.gameTime_sec;if(s<30)return 0;else if(s<60)return 1;else return 2};Score.prototype.shutdown=function(){this.container.destroy(true)};Score.prototype.onPlayAgainButton=function(){this.game.playButtonClickFX();this.game.state.start(GumballRunner.SceneHelper.defs.GAME)};Score.prototype.onChooseCharacterButton=function(){this.game.playButtonClickFX();this.game.state.start(GumballRunner.SceneHelper.defs.CHARACTER_SELECT)};return Score}(Phaser.State);GumballRunner.Score=Score})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var Title=function(_super){__extends(Title,_super);function Title(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.panelStyle_title={strokeColour:0,strokeWidth:0,strokeAlpha:1,fillColour:0,fillAlpha:0,radius:0};return _this}Title.prototype.create=function(){this.container=new Phaser.Group(this.game,this.world);this.container.fixedToCamera=true;if(!Title.background){var background=Title.background=new Phaser.TileSprite(this.game,0,0,GumballRunner.ScreenUtil.STAGE_WIDTH,GumballRunner.ScreenUtil.STAGE_HEIGHT,GumballRunner.AssetHelper.menuBackgroundTileKey);background.autoScroll(10,10);this.stage.addChildAt(background,0)}var logo=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"gumball-logo");logo.anchor.set(.5,1);this.container.addChild(logo);logo.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.TOP_CENTER,0,-20);var trgfk=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"banana-joe");trgfk.anchor.set(1,1);this.container.addChild(trgfk);trgfk.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.TOP_RIGHT,30,10);var blgfk=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"menu-darwin");blgfk.anchor.set(0,0);blgfk.scale.set(.7);this.container.addChild(blgfk);blgfk.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.BOTTOM_LEFT,-10,-10);var gbgfk=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"menu-gumball");gbgfk.anchor.set(1,1);gbgfk.scale.set(.75);this.container.addChild(gbgfk);gbgfk.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.BOTTOM_RIGHT,-10,-10);var gameTitleView=this.factoryTitleView();gameTitleView.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER,15,-110);this.container.addChild(gameTitleView);var startButton=new GumballRunner.TextButton(this.game,0,0,this.onStartButton,this,GumballRunner.AssetHelper.textButtonPaddingX,GumballRunner.AssetHelper.textButtonPaddingY,GumballRunner.StringHelper.getString("start"));startButton.alignIn(GumballRunner.ScreenUtil.SAFE_ZONE_RECT,Phaser.CENTER,0,90);this.container.add(startButton);var subTitleView=this.factorySubtitleView(GumballRunner.StringHelper.getString("subtitle"));subTitleView.rotation=Phaser.Math.degToRad(-2);subTitleView.alignTo(startButton,Phaser.BOTTOM_CENTER,0,80);this.container.addChild(subTitleView);if(GumballRunner.Application.localeString!="en")subTitleView.visible=false;var cnlogo=new Phaser.Sprite(this.game,0,0,GumballRunner.AssetHelper.uiAtlasCacheKey,"cnlogo");cnlogo.anchor.set(.5,0);this.container.addChild(cnlogo);cnlogo.alignTo(subTitleView,Phaser.BOTTOM_CENTER,0,10);this.world.addChild(this.container)};Title.prototype.factoryTitleView=function(){var panelPaddingX=40;var panelPaddingY=0;var str=GumballRunner.StringHelper.getString("title");var parts=str.split("\n");var g=new Phaser.Group(this.game);var t;var panel;var lPanelHeight=0;var lPanelWidth=0;var tHeight=0;var i=0;var textStyle_title={font:"71px Lubalin",fill:GumballRunner.ColourHelper.YELLOW,align:"center",wordWrapWidth:GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH};textStyle_title=GumballRunner.StringHelper.applyStyleOverrides("title",textStyle_title);for(var i=0;i<parts.length;i++){t=new Phaser.Text(this.game,0,0,parts[i],textStyle_title);t.setShadow(5,5,"rgba(0,0,0,1)",0);var w=t.width+panelPaddingX*2;var h=t.height+panelPaddingY*2;tHeight+=h;panel=new GumballRunner.UIPanel(this.game,new Phaser.Rectangle(0,0,w,h),this.panelStyle_title);t.anchor.set(.5);panel.addChild(t);lPanelWidth=Math.max(w,lPanelWidth);lPanelHeight=Math.max(h,lPanelHeight);g.addChild(panel)}g.align(1,parts.length,lPanelWidth,lPanelHeight);for(i=0;i<g.children.length;i++){var c=g.children[i];c.y-=tHeight*.5}return g};Title.prototype.factorySubtitleView=function(str){var panelPaddingX=10;var panelPaddingY=5;var t;var panel;var textStyle_subtitle={font:"32px Lubalin",fill:GumballRunner.ColourHelper.WHITE,align:"center",wordWrapWidth:GumballRunner.ScreenUtil.SAFE_ZONE_WIDTH,wordWrap:true};t=new Phaser.Text(this.game,0,0,str,textStyle_subtitle);t.setShadow(3,3,GumballRunner.ColourHelper.PINK);return t};Title.prototype.shutdown=function(){this.container.destroy(true)};Title.prototype.onStartButton=function(){this.game.startMenuLoop();this.game.playButtonClickFX();this.game.state.start(GumballRunner.SceneHelper.defs.CHARACTER_SELECT)};return Title}(Phaser.State);GumballRunner.Title=Title})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var DomUtil=function(){function DomUtil(){}DomUtil.addClass=function(element,classToAdd){var currentClassValue=element.className;if(currentClassValue.indexOf(classToAdd)==-1){if(currentClassValue==null||currentClassValue===""){element.className=classToAdd}else{element.className+=" "+classToAdd}}};DomUtil.removeClass=function(element,classToRemove){var currentClassValue=element.className;if(currentClassValue==classToRemove){element.className="";return}var classValues=currentClassValue.split(" ");var filteredList=[];for(var i=0;i<classValues.length;i++){if(classToRemove!=classValues[i]){filteredList.push(classValues[i])}}element.className=filteredList.join(" ")};DomUtil.setPrefixedStyleOnElement=function(element,property,value){var prefixes=["webkit","moz","ms","o"];element.style[property]=value;property=property.charAt(0).toUpperCase()+property.slice(1);prefixes.forEach(function(prefix){element.style[prefix+property]=value})};return DomUtil}();GumballRunner.DomUtil=DomUtil})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var MathUtil=function(){function MathUtil(){}MathUtil.MAX_INT=9007199254740992;return MathUtil}();GumballRunner.MathUtil=MathUtil})(GumballRunner||(GumballRunner={}));var GumballRunner;(function(GumballRunner){var ScreenUtil=function(){function ScreenUtil(){}ScreenUtil.init=function(w,h,sw,sh,r){ScreenUtil.STAGE_WIDTH=w;ScreenUtil.STAGE_HEIGHT=h;ScreenUtil.STAGE_WIDTH_HALF=ScreenUtil.STAGE_WIDTH/2;ScreenUtil.STAGE_HEIGHT_HALF=ScreenUtil.STAGE_HEIGHT/2;ScreenUtil.SAFE_ZONE_WIDTH=sw;ScreenUtil.SAFE_ZONE_HEIGHT=sh;ScreenUtil.SAFE_ZONE_WIDTH_HALF=ScreenUtil.SAFE_ZONE_WIDTH/2;ScreenUtil.SAFE_ZONE_HEIGHT_HALF=ScreenUtil.SAFE_ZONE_HEIGHT/2;ScreenUtil.SAFE_ZONE_RECT=new Phaser.Rectangle(ScreenUtil.STAGE_WIDTH_HALF-ScreenUtil.SAFE_ZONE_WIDTH_HALF,0,ScreenUtil.SAFE_ZONE_WIDTH,ScreenUtil.SAFE_ZONE_HEIGHT);ScreenUtil.STAGE_RECT=new Phaser.Rectangle(0,0,ScreenUtil.STAGE_WIDTH,ScreenUtil.STAGE_HEIGHT);ScreenUtil.resolution=r};return ScreenUtil}();GumballRunner.ScreenUtil=ScreenUtil})(GumballRunner||(GumballRunner={}));
