window.Box2D=window.Box2D(),function(){"use strict";var t=include("Box2D.b2Color"),e=include("Box2D.b2Transform"),i=include("Box2D.b2Vec2"),s=include("Box2D.JSDraw"),n=include("Box2D.destroy"),r=include("Box2D.wrapPointer"),a={},o=1,h=[],l=function(e,i){var s=r(i,t),n=(255*s.get_r()|0)+","+(255*s.get_g()|0)+","+(255*s.get_b()|0);e.fillStyle="rgba("+n+",0.25)",e.strokeStyle="rgb("+n+")",e.lineWidth=.04},c=function(t,e,s,n){var a=0,o=null;for(t.beginPath(),a=0;a<s;a++)o=r(e+8*a,i),0===a?t.moveTo(o.get_x(),o.get_y()):t.lineTo(o.get_x(),o.get_y());t.closePath(),n&&t.fill(),t.stroke()},p=function(t,e,s,a,o){var h=r(e,i),l=r(a,i),c=null,p=null;t.beginPath(),t.arc(h.get_x(),h.get_y(),s,0,2*Math.PI,!1),o&&t.fill(),t.stroke(),o&&(p=new i(h.get_x(),h.get_y()),c=new i(s*l.get_x(),s*l.get_y()),p.op_add(c),t.beginPath(),t.moveTo(h.get_x(),h.get_y()),t.lineTo(p.get_x(),p.get_y()),t.stroke(),n(p),n(c))};a[0]=null,window.Box2D.helpers={getCanvasDebugDraw:function(t){var a=new s;return a.DrawSegment=function(e,s,n){l(t,n),function(t,e,s){var n=r(e,i),a=r(s,i);t.beginPath(),t.moveTo(n.get_x(),n.get_y()),t.lineTo(a.get_x(),a.get_y()),t.stroke()}(t,e,s)},a.DrawPolygon=function(e,i,s){l(t,s),c(t,e,i,!1)},a.DrawSolidPolygon=function(e,i,s){l(t,s),c(t,e,i,!0)},a.DrawCircle=function(e,s,r){var a=new i(0,0);l(t,r),p(t,e,s,a,!1),n(a)},a.DrawSolidCircle=function(e,i,s,n){l(t,n),p(t,e,i,s,!0)},a.DrawTransform=function(i){!function(t,i){var s,n=r(i,e),a=n.get_p(),o=n.get_q();t.save(),t.translate(a.get_x(),a.get_y()),t.scale(.5,.5),t.rotate(o.GetAngle()),t.lineWidth*=2,(s=t).strokeStyle="rgb(192,0,0)",s.beginPath(),s.moveTo(0,0),s.lineTo(1,0),s.stroke(),s.strokeStyle="rgb(0,192,0)",s.beginPath(),s.moveTo(0,0),s.lineTo(0,1),s.stroke(),t.restore()}(t,i)},a},getUserData:function(t){return a[t.GetUserData()]},setUserData:function(t,e){var i=t.GetUserData();i||(h.length?i=h.pop():(i=o,o+=1),t.SetUserData(i)),a[i]=e},clearUserData:function(t){var e=t.GetUserData();e&&(a.hasOwnProperty(e)&&h.indexOf(e)<0?(h.push(e),a[e]=null):platypus.debug.warn("Box2D `userData` Helper: Tried to clear userData with an invalid ID."))}}}(),platypus.Badger=function(){"use strict";var t=[],e=function(e,i,s,n){var r=null,a=0,o="",h=0,l="",c={},p=null,d={},u=null;for(o in this.badgesAwarded=[],this.keys=c,this.userData=s,this.badges=d,this.loading=!0,this.gameId=i,e)if(e.hasOwnProperty(o))for(r=e[o].badges,d[o]=[],h=r.length;h--;){for(l in u=r[h],d[o][u.id]=p={},u)u.hasOwnProperty(l)&&(p[l]=u[l]);if(p.subgoals)for(a=p.subgoals.length;a--;)c[p.subgoals[a].key]||(c[p.subgoals[a].key]=[]),c[p.subgoals[a].key].push(p)}s.readGameData("SpaceScouts","BadgeProgress",function(e){var i="",s=e||{},r=t.length;for(i in this.progress=s,s.badges||(s.badges={}),s)s.hasOwnProperty(i)&&"badges"!==i&&this.setProgress(i,s[i]);for(this.loading=!1;r--;)t[r]();t=null,n&&n(this.badges,this.getBadgeStatusForLAP())}.bind(this))},i=e.prototype;return i.increment=function(e){this.loading?t.push(this.increment.bind(this,e)):this.setProgress(e,(this.progress[e]||0)+1)},i.setProgress=function(t,e){var i=this.keys[t],s=!1,n=0,r=0,a=!this.loading,o=0,h=this.progress,l=null;if(i){for(n=i.length,a&&platypus.debug.orange&&platypus.debug.orange('Badger: "'+t+'" badge subgoal incremented for '+n+" badge"+(n>1?"s":"")+".");n--;){for(r=(l=i[n].subgoals).length,s=!0;r--;)l[r].key===t&&(o=l[r].progress||0,l[r].progress=Math.min(e,+l[r].count),l[r].progress===+l[r].count&&(l[r].completed=!0),a&&o!==l[r].progress&&(platypus.game.currentScene?platypus.game.currentScene.triggerOnChildren("badge-incremented",{badge:i[n],subgoal:t,originalProgress:o,progress:l[r].progress,count:+l[r].count}):platypus.debug.warn("Badger: just tried to show a badge notification, but there is no current scene."))),l[r].completed||(s=!1);!s||i[n].completed||this.gameId&&this.gameId!==i[n]["game-id"]||(i[n].completed=!0,h.badges[i[n].name]||this.badgesAwarded.push(i[n]))}this.loading||(h[t]=e,this.userData.writeGameData("SpaceScouts","BadgeProgress",h)),this.badgesAwarded.length&&platypus.game.currentScene.triggerOnChildren("there-is-a-badge-to-award")}else platypus.debug.warn('Badger: There are no badges that have a "'+t+'" subgoal. Progress for this key will not be saved.')},i.award=function(){var t=this.badgesAwarded,e=t.length,i=this.progress,s=null;if(e){for(s=t.greenSlice(),t.length=0;e--;)this.increment("earned-badge"),this.increment("earned-food-farmer-badge"),i.badges[s[e].name]=!0;return this.userData.writeGameData("SpaceScouts","BadgeProgress",i),s}return null},i.getBadges=function(t){return t?this.badges[t]:this.badges},i.getBadgeStatusForLAP=function(t){var e=[],i=this.badges,s=null,n=null,r="",a=0,o=null,h=null,l=0,c=0,p=0;for(r in i)if(i.hasOwnProperty(r))for(c=(s=i[r]).length;c--;)if(p=(h=(n=s[c]).subgoals).length,l=0,a=0,o={},t){if(t===n.name){for(;p--;)o[h[p].key]=h[p].completed||!1;return{name:n.name,unlocked:n.completed||!1,steps:o}}}else{for(;p--;)o[h[p].key]=h[p].completed||!1,l+=+h[p].count,a+=h[p].progress||0;e.push({name:n.name,unlocked:n.completed||!1,progress:a/l,steps:o})}return e},e}(),platypus.DragGroup=function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Vector"),i=function(t,e){return t*t+e*e},s=function(t,e){for(var i=e.length,s=0,n=0,r=t.getPinnedEntities(),a=null;i--;)for(a=e[i].getPinnedEntities(),s=r.length;s--;)for(n=a.length;n--;)if(r[s]===a[n])return!1;return!0},n=function(t,e){return t.distance-e.distance},r=function(e){this.effected=Array.setUp(),this.immobile=!1,this.valid=!1,this.lastValidPosition=null,this.validSnaps=Array.setUp(),this.entities=Array.setUp(),this.offsets=Array.setUp(),this.saOrigin=t.setUp("x",e.x,"y",e.y),this.lastPosition=null,this.state=0,this.snap=null,this.snappingEnabled=!1,this.readyToEnd=null,this.collisionComplete=!1,this.originalEntityCount=0},a=r.prototype;return a.addEntity=function(t){t.inDragGroup&&t.inDragGroup!==this&&platypus.debug.warn("Attempting to add an entity to a new drag group that is already in a drag group."),this.entities.indexOf(t)<0&&(this.entities.push(t),this.offsets.push(e.setUp(t.x-this.saOrigin.x,t.y-this.saOrigin.y)),t.inDragGroup=this)},a.checkValidity=function(){var t,e,i=this.entities,s=null,n=this.effected,r=i.length,a=0;for(i[0].parent.world.Step(0,1,1);r--;){if(!(s=i[r]).inBuildingArea||s.overlaps&&!this.lastValidPosition||s.inTrash&&(t=s.inTrash,e=s.body.GetPosition(),t[0].TestPoint(e))){a=2;break}s.overlaps&&(a=1)}if(0===a&&n.length>i.length)for(r=n.length;r--;)if(n[r].overlaps){a=1;break}this.state=a,this.lastPosition&&(0===a?this.lastValidPosition=this.lastPosition:this.lastPosition.recycle(),this.lastPosition=null)},a.startMovement=function(t){var i=this.entities,s=null,n=i.length;for(this.originalEntityCount=n;n--;)(s=i[n]).startMovement(s);this.state=0,this.immobile=!1,this.snappingEnabled=!0,this.lastPosition=e.setUp(t.x,t.y)},a.selectAll=function(){var t=this.entities,e=null,i=t.length,s=this.originalEntityCount;if(i!==s)for(this.snappingEnabled=!1,s=this.originalEntityCount;s<i;s++)(e=t[s]).startMovement(e)},a.validateMotion=function(n,r){for(var a,o=this.entities,h=o.length,l=3+h,c=null,p=this.offsets,d=null,u=t.setUp("adjusted",null,"valid",!0,"movable",!0,"entity",null,"position",e.setUp(),"forSnap",!!n.pinTo),g=null,m=u.position;l--;){for(h=o.length;h--;){if(c=p[h],m.x=n.x+c.x,m.y=n.y+c.y,u.entity=o[h],u.valid=!0,u.adjusted=null,o[h].validateMotion(u,3),!u.valid){u.movable||(this.immobile=!0);break}if(u.adjusted){if(n.pinTo){u.valid=!1;break}n.x=u.adjusted.x-c.x,n.y=u.adjusted.y-c.y;break}}if(!u.valid||!u.adjusted)break}if(a=u.valid&&!u.adjusted,u.recycle(),a&&n.pinTo){for((g=Array.setUp()).push(n.pinTo),h=0;h<r.length;h++)if((d=r[h]).pinFrom&&d!==n&&.9>i(n.x-d.x,n.y-d.y)){if(!s(d.pinTo,g))return g.recycle(),!1;g.push(d.pinTo)}return g.recycle(),!0}return a},a.continueMovement=function(t,i){for(var s=this.entities,n=s.length,r=null,a=this.offsets,o=e.setUp();n--;)r=a[n],o.x=t.x+r.x,o.y=t.y+r.y,s[n].continueMovement(o);for(n=s.length;n--;)s[n].triggerEvent("resolve-bodies");for(n=s.length;n--;)s[n].triggerEvent("resolve-joints");if(i&&i.length)for(n=s.length;n--;)s[n].triggerEvent("resolve-snaps",i);this.lastPosition=e.setUp(t.x,t.y),o.recycle()},a.endMovement=function(t){for(var i=this.entities,s=i.length,n=null,r=this.offsets,a=e.setUp(),o=this.validSnaps,h=o.length;s--;)i[s].destroyed||(n=r[s],a.x=t.x+n.x,a.y=t.y+n.y,i[s].endMovement(a,this.state,this.immobile)),i[s].inDragGroup=null;if(0===this.state){for(;h--;)o[h].panel?(o[h].pinFrom.state.set("panelled",!0),o[h].pinFrom.panelled=o[h].pinTo,o[h].pinFrom.tint=null):o[h].pinFrom.triggerEvent("snap-to-pin",o[h].pinTo),o[h].recycle();o.length=0}else{for(;h--;)o[h].pinFrom.destroyed||(o[h].pinFrom.tint=null),o[h].recycle();o.length=0}a.recycle()},a.getSnap=function(e,s,n){var r=platypus.game.app.config.pins.snapDistance,a=r*r,o=0,h=null,l=null,c=null,p=n.length;if(e.destroyed)return null;for(;p--;)e!==(c=n[p])&&(o=i(c.x-s.x,c.y-s.y))<a&&(l=t.setUp("pinFrom",e,"pinTo",c,"snappable",!0),e.canSnapTo(l,0)&&(a=o,h=c),l.recycle());return h?t.setUp("distance",a,"pinTo",h,"pinFrom",e):null},a.getSnaps=function(t,s,r,a){var o=null,h=this.entities,l=h.length,c=null,p=this.offsets,d=this.saOrigin,u=null,g=null;if(this.snappingEnabled){for(g=e.setUp();l--;)"pin"===(o=h[l]).type&&(c=p[l],g.x=s.x+c.x,g.y=s.y+c.y,(u=this.getSnap(o,g,r))&&(u.x=u.pinTo.x-c.x,u.y=u.pinTo.y-c.y,t.push(u)));t.length>1&&t.sort(n),g.recycle()}return a&&i(s.x-d.x,s.y-d.y)<25?t.push(e.setUp(d.x,d.y)):t.push(e.setUp(s.x,s.y)),t},a.getPanelSnaps=function(e,i){for(var s=null,n=this.entities,r=n.length,a=null,o=this.offsets,h=t.setUp("x",0,"y",0,"panelled",null);r--;)"pin"===(s=n[r]).type&&(a=o[r],h.x=i.x+a.x,h.y=i.y+a.y,s.panelled=!1,s.state.set("panelled",!1),s.parent.triggerEventOnChildren("pin-on-panel",h),h.panelled&&(e.push(t.setUp("pinTo",h.panelled,"pinFrom",s,"panel",!0)),h.panelled=!1));return h.recycle(),e},recycle.add(r,!!springroll.Debug,"DragGroup",function(){this.lastValidPosition&&this.lastValidPosition.recycle(),this.readyToEnd&&this.readyToEnd.recycle(),this.effected.recycle(),this.validSnaps.recycle(),this.entities.recycle(),this.offsets.recycle(),this.saOrigin.recycle(),r.recycle(this)}),r}(),platypus.LabRetriever=function(){"use strict";var t=[],e=function(e,i){this.labItemsUnlocked=[],this.userData=e,this.loading=!0,this.onLoaded=!1,e.readGameData("space-scouts-lab","LabUnlocks",function(e){var s=e||{},n=t.length;for(this.progress=s,this.loading=!1;n--;)t[n]();t=null,i&&i(this),this.onLoaded&&this.onLoaded()}.bind(this))},i=e.prototype;return i.has=function(t){return!!this.progress[t]},i.isNew=function(t){return!(this.progress[t]&&this.progress[t].used)},i.unlock=function(e){this.loading?t.push(this.unlock.bind(this,e)):this.progress[e]||(this.labItemsUnlocked.push(e),this.progress[e]={},this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress))},i.use=function(t){"space-scouts-lab"===platypus.game.app.name?this.loading||!this.progress[t]||this.progress[t].used||(this.progress[t].used=!0,this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress)):platypus.debug.warn('LabRetriever: Only the Lab is allowed to mark "'+t+'" as a used item.')},i.award=function(){var t=this.labItemsUnlocked;return t.length?t:null},e}(),function(){"use strict";var t,e,i,s,n,r,a,o,h=window.navigator.userAgent.toLowerCase(),l=include("platypus.Data"),c=[["os 9_","","ios935"],["os 10_","","ios935"],["kfgiwi","","small"],["kfdowi","","small"],["os 11_","","small"],["iphone","dpi2","small"],["iphone","dpi3","small"],["ipad; cpu os 12_","scr4:3","small"],["ipad; cpu os 13_","scr4:3","small"],["android 4.","","small"],["android 5.","","small"],["android 6.","","small"]],p=0,d=null,u="",g=platypus.PIXIAnimation.formatSpriteSheet.bind(platypus.PIXIAnimation);for(p=0;p<c.length;p++)if(d=c[p],h.indexOf(d[0])>=0&&(!d[1]||"scr4:3"===d[1]&&window.screen.height/window.screen.width==1024/768||"dpi2"===d[1]&&2===window.devicePixelRatio||"dpi3"===d[1]&&3===window.devicePixelRatio)){u=d[2];break}u?(platypus.modifyAllAssets={ios935:4,small:2}[u],springroll.Task.prototype.filter=(o="/"+u+"/",function(t){var e=t.lastIndexOf("/"),i=t.substring(t.lastIndexOf(".")+1),s=t.substring(e+1);return"png"===i||"jpg"===i?t.substring(0,e)+o+s:t}),platypus.PIXIAnimation.formatSpriteSheet=(t=/([\w-]+)\.(\w+)$/,e=function(t,e,i){var s=platypus.modifyAllAssets,n=null,r=0;for(r=0;r<t.length;r++)n=t[r],e.push(Array.setUp(n[0]/s>>0,n[1]/s>>0,n[2]/s>>0,n[3]/s>>0,n[4]+i,n[5]/s>>0,n[6]/s>>0))},i=function(t){for(var e=t.length,i="",s="";e--;)i+=s+(t[e].src||t[e]).substring(0,128),s=",";return i},s=function(t,s){var a=s.animations,o=s.images,h=s.framerate||60,l=s.frames,c=0,p=Array.setUp(),d=o.length,u=l.length,m=t.animations,y=t.images,f=t.framerate||60,v=t.frames,w=null;for(s.id?s.id+=";"+(t.id||i(t.images)):s.id=t.id||i(t.images),c=0;c<y.length;c++)p.push(r(y[c])),o.push(p[c]);return Array.isArray(v)?e(v,l,d):(w=g(t),e(w.frames,l,d),w.recycleSpriteSheet()),function(t,e,i,s,r){var a="";for(a in t)t.hasOwnProperty(a)&&(e[a]&&(e[a].frames.recycle(),e[a].recycle(),platypus.debug.olive('PIXIAnimation "'+r+'": Overwriting duplicate animation for "'+a+'".')),e[a]=n(a,t[a],i,s))}(m,a,f/h,u,s.id),p.recycle(),s},n=function(t,e,i,s){var n=0,r=0,a=Array.setUp(),o=0;if("number"==typeof e)return a.push(e+s),l.setUp("frames",a,"next",t,"speed",i);if(Array.isArray(e)){for(r=e[0]||0,o=(e[1]||r)+1+s,n=r+=s;n<o;n++)a.push(n);return l.setUp("frames",a,"next",e[2]||t,"speed",(e[3]||1)*i)}for(n=0;n<e.frames.length;n++)a.push(e.frames[n]+s);return l.setUp("frames",a,"next",e.next||t,"speed",(e.speed||1)*i)},r=function(e){var i=!1;return"string"==typeof e&&(i=e.match(t))?i[1]:e},a=function(){var t=this.animations,e="";for(e in t)t.hasOwnProperty(e)&&t[e].frames.recycle(),t[e].recycle();this.frames.recycle(2),this.images.recycle(),this.recycle()},function(t){var e=platypus.PIXIAnimation.EmptySpriteSheet,i=t;if("string"==typeof i&&(i=platypus.game.settings.spriteSheets[t]),i){if(e=l.setUp("animations",l.setUp(),"framerate",60,"frames",Array.setUp(),"id","","images",Array.setUp(),"recycleSpriteSheet",a),Array.isArray(i))return function(t,e){for(var i=t.length,n=null;i--;)"string"==typeof(n=t[i])&&(n=platypus.game.settings.spriteSheets[n]),n&&s(n,e);return e}(i,e);if(i)return s(i,e)}return e})):platypus.modifyAllAssets=1}(),function(){"use strict";include("platypus.Entity").prototype.removeSelf=function(){!this.destroyed&&this.parent&&this.parent.removeEntity(this)}}(),function(){"use strict";var t=include("springroll.SavedData"),e=include("springroll.UserData").prototype;e.readGameData=function(e,i,s){this.container.supported?this.container.fetch("userDataRead",function(t){s(t.data)},e+i,!0):s(t.read(e+i))},e.writeGameData=function(e,i,s,n){if(!this.container.supported)return t.write(e+i,s),void(n&&n());this.container.fetch("userDataWrite",function(){n&&n()},{name:e+i,value:s},!0)},e.removeGameData=function(e,i,s){if(!this.container.supported)return t.remove(e+i),void(s&&s());this.container.fetch("userDataRemove",function(){s&&s()},e+i,!0)},e.fixFetch=function(){var t,e,i,s=this.container;s.___fetch||(s.___fetch=s.fetch,s.fetch=(t=!1,e=function(s,n){var r=null;s(n),i.length?(r=i.shift(),this.___fetch(r.event,e.bind(this,r.callback),r.options,r.once)):t=!1},i=[],function(s,n,r,a){t?i.push({event:s,callback:n,options:r,once:a}):(t=!0,this.___fetch(s,e.bind(this,n),r,a))}))}}(),function(){"use strict";var t,e="file:"===window.location.protocol||"ionic:"===window.location.protocol||"localhost:8080"===window.location.host,i=window.navigator.userAgent.toLowerCase(),s=i.indexOf("os 9_")>=0||i.indexOf("os 10_")>=0,n=include("springroll.Application"),r=include("platypus.Badger"),a=include("springroll.pixi.PixiDisplay"),o=include("springroll.Debug",!1),h=include("platypus.LabRetriever"),l=document.getElementById("interaction"),c=function(){l.style.display="none",p=!1,d.paused=!1;try{document.body.removeChild(l)}catch(t){}},p=!e||i.indexOf("os 9_")>=0,d=new n({name:"food-farmer",canvasId:"stage",captions:"captions",configPath:"assets/config/config.json",display:a,displayOptions:{clearView:!0,preserveDrawingBuffer:!0},enableHiDPI:!0,brainpoints:{callback:function(t){d.trigger("brainpoint",t)},apiOverride:"https://proxy.services.pbskids.org/enlearn",appData:{releaseBuild:!o}},preload:(t=[],s||t.push({id:"ScreenBadge_Standard",src:"assets/images/ScreenBadge_Standard.png"}),t),resizeElement:"content",responsive:!0,uniformResize:!1,state:"menu",version:"1.0.2"}),u=function(){var t=document.getElementById("frame"),e=window.innerHeight,i=window.innerWidth,s=.75*i>>0,n=2*e>>0;e>s?(t.style.height=s+"px",t.style.top=((e-s)/2>>0)+"px",t.style.width="",t.style.left=""):i>n?(t.style.width=n+"px",t.style.left=((i-n)/2>>0)+"px",t.style.height="",t.style.top=""):(t.style.height="",t.style.top="",t.style.width="",t.style.left="")};if(d.userData.fixFetch(),d.on("init",function(){var t=new r(d.config["badge-list"],"space-scouts-home-base"!==d.name?d.name:"",d.userData,function(t,e){o&&d.analyticsEmitter.enableLogging(),d.userData.read("-"+d.options.version+"-levels-complete",function(t){d.analyticsEmitter.startGame(d.options.version,{earth:t&&t.indexOf&&t.indexOf("level-1")>=0,mars:t&&t.indexOf&&t.indexOf("level-4")>=0,mercury:t&&t.indexOf&&t.indexOf("level-5")>=0},e)}),d.googleAnalytics.event(d.name,"StartGame")});d.container.on("download-complete",function(){d.sound.play("download-complete")}),d.paused=p,platypus.labRetriever=new h(d.userData),platypus.badger=t,t.increment("tried-"+d.name),d.captions.data=d.config.captions,platypus.game.settings.entities["action-layer"].maxStepsPerTick=60/platypus.modifyAllAssets,d.getEnlearnData=function(t){var e="",i={mini_game_instance_id:Date.now().toString(16),level_id:"",level_instance_id:""};if(t)for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i}}),d.once("endGame",function(t){d.analyticsEmitter.endGame(t,[],platypus.badger.getBadgeStatusForLAP()),d.googleAnalytics.event(d.name,"EndGame")}),d.on("resize",function(t,e){d.transition?(d.transition.x=t/2,d.transition.y=e/2,d.transition.scale.x=d.transition.scale.y=e/880):(platypus.savedWidth=t,platypus.savedHeight=e)}),platypus.savedGame=sessionStorage.getItem("load-saved-game")||null,platypus.savedGame){sessionStorage.removeItem("load-saved-game");try{platypus.savedGame=JSON.parse(platypus.savedGame)}catch(t){platypus.savedGame=null}}d.on("brainpoint",function(t){platypus.debug.log('Brain Point "'+t.type+'" received! '+t.message,t),d.analyticsEmitter.receivedBrainPoint(d.levelId||"",t),d.googleAnalytics.event(d.name,"ReceivedBrainPoint"),platypus.badger&&d.config.brainPoints[t.type]&&platypus.badger.increment(d.config.brainPoints[t.type])}),window.app=d,window.addEventListener("resize",u,!1),window.addEventListener("orientationchange",u,!1),window.addEventListener("focus",u,!1),window.addEventListener("load",u,!1);try{!p||window.AudioContext&&"running"!==(new window.AudioContext).state||window.webkitAudioContext&&"running"!==(new window.webkitAudioContext).state||(p=!1)}catch(t){platypus.debug.warn("Unlocking audio error: "+t.message)}p&&(l.addEventListener("pointerdown",c),l.addEventListener("mousedown",c),l.addEventListener("touchstart",c),l.style.display="block")}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data");platypus.createComponentClass({id:"ActionButton",properties:{onPress:"",onRelease:"",onCancel:"",onHover:"",useOnce:!1,disabled:!1,toggle:!1,pressed:!1},publicProperties:{bottom:null,left:null,right:null,top:null},initialize:function(){var e=this.owner.state;this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.state=e,e.set("disabled",this.disabled),e.set("released",!this.pressed),e.set("pressed",this.pressed),e.set("highlighted",!1),this.owner.buttonMode=!this.disabled,this.cancelled=!1,this.readyToToggle=!1,this.coolDown=0,this.dragging=[]},events:{"handle-logic":function(t){var e=this.bottom,i=this.left,s=this.right,n=this.top;this.lastBottom===e&&this.lastLeft===i&&this.lastRight===s&&this.lastTop===n||(this.updatePosition(this.aabb),this.lastBottom=e,this.lastLeft=i,this.lastRight=s,this.lastTop=n),this.coolDown>0&&(this.coolDown-=t.delta,this.coolDown<0&&(this.coolDown=0))},"camera-update":function(t){this.aabb.set(t.viewport),this.updatePosition(this.aabb)},pointerdown:function(t){this.state.get("disabled")||(this.toggle?this.coolDown||(this.readyToToggle=!0):(this.onPress&&this.owner.trigger(this.onPress),this.updateStateAndTrigger("pressed"),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&this.removeEventListener("pointerdown")))},pressup:function(t){var e=this.state;e.get("disabled")||(this.cancelled?(this.onCancel&&this.owner.trigger(this.onCancel),this.updateStateAndTrigger("cancelled")):this.toggle?this.readyToToggle&&(this.coolDown=500,e.get("pressed")?this.updateStateAndTrigger("released"):this.updateStateAndTrigger("pressed")):(this.onRelease&&this.owner.trigger(this.onRelease),this.updateStateAndTrigger("released")),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&(this.removeEventListener("pressup"),this.state.set("disabled",!0),this.owner.buttonMode=!1)),this.cancelled=!1,this.readyToToggle=!1},disable:function(){this.state.set("disabled",!0),this.owner.buttonMode=!1},enable:function(){this.state.set("disabled",!1),this.owner.buttonMode=!0},"toggle-disabled":function(){var t=this.state.get("disabled");this.owner.buttonMode=t,this.state.set("disabled",!t)},highlight:function(){this.state.set("highlighted",!0)},unhighlight:function(){this.state.set("highlighted",!1)},"toggle-highlight":function(){var t=this.state;t.set("highlighted",!t.get("highlighted"))},"dragging-taking-place":function(){this.owner.triggerEvent("disable")},"no-dragging-taking-place":function(){this.owner.triggerEvent("enable")}},methods:{updatePosition:function(t){var e=this.bottom,i=this.left,s=this.owner,n=this.right,r=this.top;"number"==typeof i?s.x=t.left+i:"number"==typeof n&&(s.x=t.right-n),"number"==typeof r?s.y=t.top+r:"number"==typeof e&&(s.y=t.bottom-e)},updateStateAndTrigger:function(t){var i=null,s=this.owner,n=this.state,r=n.get("pressed"),a=n.get("released"),o=!1;a&&"pressed"===t?(n.set("pressed",!0),n.set("released",!1),o=!0):!r||"released"!==t&&"cancelled"!==t||(n.set("pressed",!1),n.set("released",!0),o=!0),o&&(i=e.setUp("released",r,"pressed",a,"triggered",a,"entity",s),s.triggerEvent(t,i),i.recycle())},destroy:function(){this.aabb.recycle(),this.aabb=null,this.owner.buttonMode=!1,this.state=null}}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"ActionCancelLogic",properties:{name:""},initialize:function(){this.rotC=0,this.active=!1,this.bigRedX=null,this.remove=!1,this.totalButtons=0,this.buttonNum=0},events:{"button-added":function(t){this.totalButtons++,t===this.name&&(this.buttonNum=this.totalButtons)},"button-removed":function(){this.totalButtons--,this.totalButtons<0&&(this.totalButtons=0)},"clicked-compost":function(){"compost"===this.name&&(this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),this.owner.parent.parent.layers[0].triggerEvent("cancel-action",this.name),this.remove=!0)},"clicked-water":function(){"water"===this.name&&(this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),this.owner.parent.parent.layers[0].triggerEvent("cancel-action",this.name),this.remove=!0)},"clicked-shovel":function(){"shovel"===this.name&&(this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),this.owner.parent.parent.layers[0].triggerEvent("cancel-action",this.name),this.remove=!0)},"clicked-seed":function(){"seed"===this.name&&(this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),this.owner.parent.parent.layers[0].triggerEvent("cancel-action",this.name),this.remove=!0)},"force-cancel":function(t){t===this.name&&(this.remove=!0)},adopted:function(){this.owner.triggerEvent("hide-sprite"),this.active=!1},"show-action":function(e){e===this.name&&(this.owner.scaleX=.01,this.owner.scaleY=.01,t.get(this.owner).to({scaleX:.75,scaleY:.75},250,createjs.Ease.backOut),this.active||this.owner.parent.triggerEvent("button-added",this.name),this.owner.triggerEvent("show-sprite"),this.active=!0,this.bigRedX?this.bigRedX.triggerEvent("show-sprite"):this.bigRedX=this.owner.parent.addEntity({id:"cancel",components:[{type:"RenderSprite",spriteSheet:"farmer",animationMap:{default:"cancel"},interactive:!0},{type:"LogicButton",passthroughOnMovement:!0,onPress:"cancel-button-clicked"},{type:"RelayLinker",linkId:"cancel",events:{"cancel-button-clicked":["clicked-"+this.name]}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"}],properties:{scaleX:.01,scaleY:.01,x:this.owner.x,y:this.owner.y,z:this.owner.z+1,opacity:.75}}),t.get(this.bigRedX).to({scaleX:.4,scaleY:.4},500,createjs.Ease.backOut))},"handle-logic":function(){if(this.bigRedX&&(this.bigRedX.x=this.owner.x),this.remove)return this.active?(this.remove=!1,t.get(this.owner).to({scaleX:.01,scaleY:.01},250,createjs.Ease.sineOut).call(function(){this.owner&&!this.owner.destroyed&&(this.owner.triggerEvent("hide-sprite"),this.active=!1,this.owner.parent.triggerEvent("button-removed",this.name,this.buttonNum))}.bind(this)),void(this.bigRedX&&t.get(this.bigRedX).to({scaleX:.01,scaleY:.01},500,createjs.Ease.sineOut).call(function(){this.bigRedX.destroyed||this.bigRedX.triggerEvent("hide-sprite")}.bind(this)))):void(this.remove=!1);this.active&&(this.rotC+=.01,this.owner.rotation+=.1*Math.cos(this.rotC))}}})}(),function(){"use strict";platypus.createComponentClass({id:"ActionSelectorButtonLogic",properties:{callback:null},events:{"selector-button-clicked":function(){this.callback.call()},"handle-logic":function(){}}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"ActionSelectorLogic",properties:{options:[],targetEntity:null},initialize:function(){platypus.game.app.display.renderer.plugins.interaction.on("pointerdown",function(){}),this.buttons=[],this.needCleanup=!1,this.bg=null,this.tweenTime=200,this.cleaningUp=!1},events:{adopted:function(){var e=null;switch(t.get(this.owner).to({scaleX:.85,scaleY:.85},this.tweenTime,createjs.Ease.backOut),this.bg=this.owner.parent.addEntity({id:"bg",components:[{type:"RenderSprite",spriteSheet:"farmer",animationMap:{default:"select"},interactive:!0},{type:"LogicButton",passthroughOnMovement:!0,onPress:"bg-pressed"},{type:"RelayLinker",linkId:"selector",events:{"selector-button-clicked":["cancel-global-click","clean-up"],"bg-pressed":["cancel-global-click","clean-up"]}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"}],properties:{scaleX:25,scaleY:25,opacity:0,x:this.owner.x,y:this.owner.y,z:5e4}}),this.options.length){case 1:e=[90];break;case 2:e=[60,120];break;case 3:e=[45,90,135];break;case 4:e=[0,45,90,135];break;case 5:e=[0,45,90,135,180];break;case 6:e=[0,45,90,135,180,225];break;case 7:e=[-45,0,45,90,135,180,225];break;case 8:e=[-45,0,45,90,135,180,225,270];break;case 9:e=[0,40,80,120,160,200,240,280,320];break;case 10:e=[0,36,72,108,144,180,216,252,288,324];break;case 11:e=[0,33,66,99,131,164,196,230,263,296,329]}for(var i=0;i<this.options.length;i++){var s=this.options[i],n="farmer",r=s.id;s.id.includes("seed")&&(n="seedSelect",r=s.id.split("-")[1]);var a=this.owner.parent.addEntity({id:r,components:[{type:"RenderSprite",spriteSheet:n,animationMap:{default:r},interactive:!0},{type:"LogicButton",passthroughOnMovement:!0,onPress:"selector-button-clicked"},{type:"RelayLinker",linkId:"selector",events:{"selector-button-clicked":["cancel-global-click","clean-up"]}},{type:"ActionSelectorButtonLogic",callback:s.callback},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPSelectAnswer",action:s.id,position:Math.round(this.owner.x),aliases:{pressed:"pointer-event"}},{type:"LAPDwellTimer"}],properties:{scaleX:.8,scaleY:.8,x:this.owner.x,y:this.owner.y,z:50001,opacity:0}});"seed-info"===r&&(a.flag="seedInfo"),this.buttons.push(a),t.get(a).to({x:this.owner.x+125*Math.cos(.0174533*e[i]),y:this.owner.y+125*Math.sin(.0174533*e[i]),opacity:1},this.tweenTime,createjs.Ease.backOut)}},"clean-up":function(){this.needCleanup=!0},"handle-logic":function(){var e=this.owner,i=this.buttons,s=i.length;if(!this.cleaningUp&&(this.needCleanup||this.targetEntity&&this.targetEntity.destroyed)){for(;s--;)t.get(i[s]).to({x:e.x,y:e.y,opacity:0,scaleX:.01,scaleY:.01},this.tweenTime,createjs.Ease.sineIn);this.bg.removeSelf(),t.get(e).to({scaleX:.01,scaleY:.01},333,createjs.Ease.sineOut).call(function(){var t=0;if(this.owner&&!this.owner.destroyed){for(t=0;t<this.buttons.length;t++)this.buttons[t].removeSelf();this.owner.removeSelf()}}.bind(this)),this.needCleanup=!1,this.cleaningUp=!0}}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("Box2D.b2Vec2");platypus.createComponentClass({id:"AphidLogic",properties:{dir:1},publicProperties:{},initialize:function(){this.remove=!1,this.camera=t.setUp(),this.pausingC=0,this.climbDir=0,this.climbMax=0,this.removingC=0,this.plant=null,this.scale=.8,this.speed=.2*Math.random()+.3},events:{adopted:function(){},clicked:function(){if(!this.removingC){this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),this.removingC=1,this.owner.body.SetGravityScale(1);var t=.75*-Math.PI+Math.random()*Math.PI*.5;this.owner.body.ApplyLinearImpulse(new e(.1*Math.cos(t),.1*Math.sin(t)),this.owner.body.GetWorldCenter())}},"handle-logic":function(t){if(this.removingC>0)return this.removingC++,this.owner.orientation+=.02,this.owner.opacity-=.004,void(this.owner.body.GetLinearVelocity().get_y()>1&&this.owner.y>990&&this.removingC>15&&(this.owner.parent.triggerEvent("aphid-removed"),this.owner.removeSelf()));this.owner.x+=this.dir*this.speed,this.owner.y+=this.climbDir*this.speed,-1==this.climbDir&&this.owner.y<this.climbMax?(this.plant&&!this.plant.destroyed&&this.plant.triggerEvent("aphid-damage"),this.climbDir=1,this.owner.rotation+=180):1==this.climbDir&&this.owner.y>1e3&&(this.climbDir=0,this.dir=Math.random()<.5?-1:1,this.owner.rotation=0,this.owner.y=1040),this.dir&&(this.owner.scaleX=this.dir*this.scale),this.climbDir&&(this.climbDir<0?this.owner.rotation=this.owner.scaleX<0?90:-90:this.owner.rotation=this.owner.scaleX<0?-90:90),(this.owner.x>this.camera.right+100||this.owner.x<this.camera.left-100)&&(this.remove=!0),(this.owner.x>2900||this.owner.x<100)&&(this.remove=!0),this.remove&&(this.owner.parent.triggerEvent("aphid-removed"),this.owner.removeSelf())},"camera-update":function(t){this.camera.set(t.viewport)},"collide-with-plant":function(t){this.plant=t.entity,0!==this.climbDir||this.plant.isWeed||!this.plant.getStageNum||this.plant.getStageNum()<2||Math.random()<.5&&(this.climbMax=this.owner.y-this.plant.getHeight(),this.dir=0,this.climbDir=-1)}},methods:{destroy:function(){this.plant=null}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=function(t,e){return t.time-e.time},i=function(i,s){var n=0;for(n=0;n<i.length;n++)s.push(t.setUp("event",i[n].event,"time",i[n].time||0,"message",i[n].message));return n&&s.sort(e),s},s=function(i,s,n){var r=0,a=n.getElapsed();for(r=0;r<i.length;r++)s.push(t.setUp("event",i[r].event,"time",(i[r].time||0)+a,"message",i[r].message||null));r&&s.sort(e)},n=function(t,e,i){var n=0,r=Array.setUp();for(n=0;n<t.length;n++)t[n].sound?(t[n].events&&r.push(s.bind(this,t[n].events,e,i)),r.push(t[n].sound)):r.push(t[n]);return r},r=function(t,e){this.playingAudio=!1,this.player.unloadSound(),this.owner.destroyed||(this.checkTimeEvents(!0),this.owner.triggerEvent("sequence-complete")),e.recycle()},a=function(t,e){var s=null,a=Array.setUp(),o=this.player;"string"==typeof t?s=Array.setUp(t):Array.isArray(t)?s=n(t,a,o):(t.events&&i(t.events,a),s=Array.isArray(t.sound)?n(t.sound,a,o):Array.setUp(t.sound)),e&&e.events&&i(e.events,a),o.play(s,r.bind(this,!0,s),r.bind(this,!1,s)),this.eventList.recycle(),this.eventList=a,this.playingAudio=!0};platypus.createComponentClass({id:"AudioVO",properties:{audioMap:null},initialize:function(){var t="";if(this.eventList=Array.setUp(),this.playingAudio=!1,this.player=platypus.game.app.voPlayer,this.player.trackSound=platypus.supports.iOS,this.audioMap)for(t in this.audioMap)this.audioMap.hasOwnProperty(t)&&this.addEventListener(t,a.bind(this,this.audioMap[t]));this.paused=!1},events:{"handle-render":function(){this.paused||this.checkTimeEvents(!1)},"stop-audio":function(){this.player.stop(),this.player.voList=[]}},methods:{checkTimeEvents:function(t){var e=null,i=this.eventList,s=0,n=this.owner;if(i&&i.length)for(s=this.player.getElapsed();i.length&&(t||i[0].time<=s);)e=i.greenSplice(0),n.trigger(e.event,e.message),e.recycle()},destroy:function(){this.playingAudio&&(this.player.stop(),this.player.voList=[]),this.eventList.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeAward",properties:{},publicProperties:{},initialize:function(){this.badgeList=null,this.lastState="",this.hiding=!0,this.exitOnClose=!1},events:{"earned-badge":function(t){this.badgeList=t,this.owner.triggerEvent("show-next-badge")},"show-next-badge":function(){var t=platypus.game.app,e=null,i=this.owner.state;this.hiding?(this.owner.triggerEvent("show-earned-badge-dialog"),this.hiding=!1,e=this.badgeList.greenSplice(0),this.badgeList.length||this.owner.triggerEvent("last-badge-showing"),t.analyticsEmitter.unlockedBadge(t.levelId||"",e.name),t.googleAnalytics.event(t.name,"BadgeUnlocked",e.name,1),this.lastState&&i.set(this.lastState,!1),this.lastState=e["game-id"]+"-"+e.id,i.set(this.lastState,!0),this.owner.triggerEvent("set-text",e.name),this.owner.triggerEvent(this.lastState),"3"!==e.id&&"4"!==e.id||(this.exitOnClose=!0)):(this.badgeList.length?this.owner.triggerEvent("hide-earned-badge-dialog-and-next"):(this.owner.triggerEvent("hide-earned-badge-dialog"),this.exitOnClose&&this.owner.triggerEvent("rl-go-to-next-level")),this.hiding=!0)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeBannerBuilder",properties:{bannerPositions:null,toBuild:"all",zoomOutWidth:1816,zoomOutHeight:1360,zoomInWidth:908,zoomInHeight:680},publicProperties:{},initialize:function(){var t=platypus.game.app,e=t.name,i=platypus.badger.getBadges(),s=0,n=null;if(this.showEverything="space-scouts-home-base"===e,this.zoomBanners=[],this.banners=[],this.badges={},this.badgeHighlight=null,this.collectedBadges=0,this.zooming=!1,this.cameraX=0,this.cameraY=0,this.tweenWidth=1816,this.tweenHeight=1360,this.targetBanner=null,this.zoomed="out",this.showEverything)for(n in i)i.hasOwnProperty(n)&&(this.buildBanner(n,i[n],s),s++);else this.buildBanner(e,i[e],s);this.badgeHighlight=this.owner.addEntity({type:"badge-highlight",properties:{x:0,y:0,z:100.5,opacity:.001}}),t.music="jam",t.musicInstance.volume=.5,this.badgeTime=Date.now(),t.googleAnalytics.event(t.name,"EnterBadgeScreen","BadgesCollected",this.collectedBadges)},events:{"scene-live":function(t){var e=0;if(this.showEverything){if(t&&t.banner)for(e=this.banners.length;e--;)if(this.banners[e].game===t.banner){this.owner.triggerEvent("zoom-in",this.banners[e]);break}}else this.owner.triggerEvent("zoom-in",this.banners[0])},tick:function(){this.zooming&&this.resizeCamera()},"camera-update":function(t){this.tweenWidth=t.viewport.width,this.tweenHeight=t.viewport.height,this.cameraX=t.viewport.x,this.cameraY=t.viewport.y},"zoom-out":function(){this.zooming||("out"!==this.zoomed&&this.showEverything?(this.zooming=!0,this.owner.triggerEvent("rl-hide-info-panel"),this.targetBanner.zoomBanner.triggerEvent("show-sprite"),this.targetBanner=null,this.badgeHighlight.opacity=.001,t.get(this).to({cameraX:0,cameraY:0,tweenWidth:this.zoomOutWidth,tweenHeight:this.zoomOutHeight},1e3,e.sineInOut).call(function(){this.zoomed="out",this.zooming=!1,this.resizeCamera()}.bind(this))):this.owner.triggerEvent("new-scene"))},"zoom-in":function(i){this.zooming||"out"!==this.zoomed||(this.zooming=!0,this.targetBanner=i,this.showEverything?i.state.get("app")?t.get(this).to({cameraX:this.targetBanner.x+225,cameraY:this.targetBanner.y,tweenWidth:this.zoomInWidth,tweenHeight:this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):t.get(this).to({cameraX:this.targetBanner.x+180,cameraY:this.targetBanner.y,tweenWidth:.8*this.zoomInWidth,tweenHeight:.8*this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):(this.cameraX=this.targetBanner.x+225,this.cameraY=this.targetBanner.y,this.tweenWidth=this.zoomInWidth,this.tweenHeight=this.zoomInHeight,this.zoomInComplete(i,!0)))}},methods:{zoomInComplete:function(t,e){this.zoomed="in",this.zooming=!1,this.resizeCamera(),this.targetBanner.zoomBanner.triggerEvent("hide-sprite"),this.badges[t.game][0].triggerEvent("send-highlight-info"),this.owner.triggerEvent("rl-show-info-panel",e)},resizeCamera:function(){this.owner.triggerEvent("resize-camera",{width:this.tweenWidth,height:this.tweenHeight}),this.owner.triggerEvent("relocate",{x:this.cameraX,y:this.cameraY})},buildBanner:function(t,e,i){var s=null,n=this.bannerPositions&&this.bannerPositions[t],r=null,a=450*(i%3),o=650*Math.floor(i/3);this.showEverything?n?(a=n.x,o=n.y):(a+=-450,o+=-325):a-=225,(s=this.owner.addEntity({type:"badge-banner",properties:{x:a,y:o,z:100,game:t}})).state.set(t,!0),r=this.owner.addEntity({type:"zoom-banner",properties:{x:a,y:o,z:102}}),s.zoomBanner=r,r.banner=s,this.banners.push(s),this.zoomBanners.push(r),this.buildBadges(t,e,a,o,n)},buildBadges:function(t,e,i,s,n){var r=0,a=0,o=null,h=null,l=0,c=0,p=0,d="",u="",g=n&&n.badgeOffsetX?n.badgeOffsetX:-91,m=n&&n.badgeOffsetY?n.badgeOffsetY:-70;for(r=0;r<e.length;r++)h=e[r],n.specials&&n.specials[r]?(a-=1,c=i+n.specials[r].x,p=s+n.specials[r].y):(l=Math.floor((r+a)/3),c=i+g+91*((r+a)%3),p=s+m+91*l),d=h.name,u=h.description,o=this.owner.addEntity({type:"badge",properties:{x:c,y:p,z:101,animation:t+"-"+h.id,highlight:h.highlight||"circle",name:d||t+"-"+h.id,description:u||"Undescribed",level:h.level,collected:h.completed,game:t,directive:h.directive,progress:this.getProgress(h)}}),this.addGroupInfo(h,o,"group1"),this.addGroupInfo(h,o,"group2"),this.addGroupInfo(h,o,"group3"),this.addGroupInfo(h,o,"group4"),o.collected?(o.state.set(o.animation,!0),this.collectedBadges+=1):o.opacity=.2,h.highlight?(o.state.set(h.highlight,!0),o.collected?o.scaleX=o.scaleY=.203452:o.scaleX=o.scaleY=.203452/.6):o.scaleX=o.scaleY=.6344*.38,this.badges[t]||(this.badges[t]=[]),this.badges[t].push(o)},addGroupInfo:function(t,e,i){var s=0,n=0,r=null,a=0,o=0;if(t[i]){if(e[i]=t[i],e[i+"-directive"]=t[i+"-directive"],!t.subgoals)return e[i+"-complete"]=!1,void(e[i+"-progress"]=0);for(s=(r=t[i+"-subgoals"].split(",")).length;s--;)for(n=t.subgoals.length;n--;)if(t.subgoals[n].key===r[s]){o+=Math.min(t.subgoals[n].progress||0,+(t.subgoals[n].count||0)),a+=+(t.subgoals[n].count||0);break}o!==a?(e[i+"-complete"]=!1,e[i+"-progress"]=o/a):e[i+"-complete"]=!0}},getProgress:function(t){var e=0,i=0,s=0;if(!t.subgoals)return 0;for(e=t.subgoals.length;e--;)s+=Math.min(t.subgoals[e].progress||0,+(t.subgoals[e].count||0)),i+=+(t.subgoals[e].count||0);return s/i},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitBadgeScreen","BadgeScreenTime",Date.now()-this.badgeTime>>0)}},publicMethods:{},getAssetList:function(){for(var t=null,e=["badge-banner","badge","badge-highlight","zoom-banner"],s=e.length,n=Array.setUp();s--;)t=i.getAssetList({type:e[s]}),n.union(t),t.recycle();return n}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeHighlightLogic",properties:{},publicProperties:{},initialize:function(){this.prevAnimation=null},events:{"highlight-badge":function(t){this.owner.opacity=1,this.owner.x=t.x,this.owner.y=t.y,this.owner.triggerEvent("set-animation",t.highlight)},"set-animation":function(t){""!==this.prevAnimation&&this.owner.state.set(this.prevAnimation,!1),this.owner.state.set(t,!0),this.prevAnimation=t}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("platypus.Data"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeInfoPanelLogic",properties:{},publicProperties:{},initialize:function(){this.highlightedBadge=null,this.prevAnimation="",this.badgeInfo=null,this.rows=Array.setUp()},events:{"scene-loaded":function(){var t=platypus.game.app,e=t.name,i=null,s=t.config["badge-list"],n=null,r=null;if(this.highlightedBadge=this.owner.parent.addEntity({type:"highlighted-badge",properties:{x:this.owner.x,y:this.owner.y+-270,z:101}}),this.rows.push(this.createGoRow(0),this.createGoRow(1),this.createGoRow(2),this.createGoRow(3)),"space-scouts-home-base"===e){for(i in s)if(s.hasOwnProperty(i)){r={name:(n=s[i].badges[0]).name,description:n.description,level:n.level,animation:i+"-"+n.id,game:i};break}}else r={name:(n=s[e].badges[0]).name,description:n.description,level:n.level,animation:e+"-"+n.id,game:e};this.owner.triggerEvent("highlight-badge",r,!0),this.owner.triggerEvent("hide-sprite"),this.highlightedBadge.triggerEvent("hide-sprite"),this.rows[0].checkmark.triggerEvent("hide-sprite"),this.rows[1].checkmark.triggerEvent("hide-sprite"),this.rows[2].checkmark.triggerEvent("hide-sprite"),this.rows[3].checkmark.triggerEvent("hide-sprite")},"highlight-badge":function(t,e){var i=this.highlightedBadge;this.badgeInfo=t,i.scaleX=i.scaleY=1,t.collected?(this.owner.triggerEvent("set-badge-animation",t.animation),"circle"!==t.highlight&&(i.scaleX=i.scaleY=2/3),this.owner.state.set("earned",!0),e||(this.owner.triggerEvent(t.animation+"-earned"),platypus.game.app.voPlayer.play(t.animation))):(this.owner.triggerEvent("set-badge-animation",t.highlight||"empty"),this.owner.state.set("earned",!1),e||(this.owner.triggerEvent(t.animation),platypus.game.app.voPlayer.play([t.animation,t.game+"-to-earn-badge",t.animation+"-requirements"]))),this.owner.triggerEvent("set-title-text",t.name),this.loadRows(t)},"set-badge-animation":function(t){""!==this.prevAnimation&&this.highlightedBadge.state.set(this.prevAnimation,!1),this.highlightedBadge.state.set(t,!0),this.prevAnimation=t},"hide-info-panel":function(){this.tweenHide(this.owner),this.tweenHide(this.highlightedBadge),this.tweenHide(this.rows[0].checkmark),this.tweenHide(this.rows[1].checkmark),this.tweenHide(this.rows[2].checkmark),this.tweenHide(this.rows[3].checkmark)},"show-info-panel":function(e){var i=e?0:300;this.owner.triggerEvent("show-sprite"),this.highlightedBadge.triggerEvent("show-sprite"),this.rows[0].checkmark.triggerEvent("show-sprite"),this.rows[1].checkmark.triggerEvent("show-sprite"),this.rows[2].checkmark.triggerEvent("show-sprite"),this.rows[3].checkmark.triggerEvent("show-sprite"),this.owner.opacity=.001,this.highlightedBadge.opacity=.001,this.rows[0].checkmark.opacity=.001,this.rows[1].checkmark.opacity=.001,this.rows[2].checkmark.opacity=.001,this.rows[3].checkmark.opacity=.001,t.get(this.owner).to({opacity:1},i),t.get(this.highlightedBadge).to({opacity:1},i),t.get(this.rows[0].checkmark).to({opacity:1},i),t.get(this.rows[1].checkmark).to({opacity:1},i),t.get(this.rows[2].checkmark).to({opacity:1},i),t.get(this.rows[3].checkmark).to({opacity:1},i)},"get-badge":function(t){var e=null,i=this.badgeInfo.game,s=platypus.game.app.config.games;t.directive?(i=(e=t.directive.split(":"))&&e[0]||this.badgeInfo.game,platypus.debug.olive("This one has a directive! "+t.directive)):platypus.debug.olive("Wants to achieve badge. Opening Level Select for all cases at this point."),"space-scouts-home-base"===platypus.game.app.name?"app"===i?this.owner.triggerEvent("look-at-all-badges"):"true"===sessionStorage.getItem("space-scouts-home-base-loaded-by-app")?platypus.game.app.container.send("load-game",{game:i,getBadge:e}):s[i]?(this.loadSavedGame&&sessionStorage.setItem("get-badge",JSON.stringify(e)),window.top.location=s[i]):platypus.debug.warn('"'+i+'" does not seem to be a valid game id.'):platypus.game.loadScene("level-select")}},methods:{createGoRow:function(t){var i=this.owner,s=e.setUp("checkmark",i.parent.addEntity({type:"go-to-badge-button",properties:{x:i.x+-300,y:i.y+100+100*t,z:101}}),"directive","","visible",!1);return s.checkmark.on("released",i.triggerEvent.bind(i,"get-badge",s)),s},loadRows:function(t){for(var e=["group1","group2","group3","group4"],i=e.length,s=0,n=null,r=null,a=null;i--;){for(a=(r=(n=this.rows[i]).checkmark).state,s=1;s<=16;s++)a.set("filled-"+s,!1);t[e[i]]?(r.x=this.owner.x+-300,r.triggerEvent("set-text",t[e[i]]),n.visible=!0,n.directive=t[e[i]+"-directive"],t[e[i]+"-complete"]?r.triggerEvent("disable"):(a.set("filled-"+(Math.ceil(16*t[e[i]+"-progress"])||1),!0),r.triggerEvent("enable"))):(r.x=-6e3,n.visible=!1)}t.group1?(r.components[3].sprite.y=0,r.components[3].sprite.anchor.y=.5):((r=(n=this.rows[0]).checkmark).x=this.owner.x+-300,r.triggerEvent("set-text",t.description),n.visible=!0,n.directive=t.directive,t.collected?r.triggerEvent("disable"):(a.set("filled-"+(Math.ceil(16*t.progress)||1),!0),r.triggerEvent("enable")),r.components[3].sprite.y=-24,r.components[3].sprite.anchor.y=0)},tweenHide:function(e){t.get(e).to({opacity:0},300).call(function(){e.triggerEvent("hide-sprite")})}},publicMethods:{},getAssetList:function(){for(var t=null,e=["highlighted-badge","go-to-badge-button"],s=e.length,n=Array.setUp();s--;)t=i.getAssetList({type:e[s]}),n.union(t),t.recycle();return n}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeLogic",properties:{},publicProperties:{animation:"",highlight:"circle",name:"default name",description:"default description",level:"",collected:!1,game:""},initialize:function(){},events:{"send-highlight-info":function(){this.owner.triggerEvent("rl-highlight-badge",this.owner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Ease"),i=include("PIXI.Graphics"),s=include("createjs.Tween"),n=function(t,e,s){var n=new i;return t.mask=n,n.isMask=!0,n.z=1,e.addChild(n),n.clear(),n.beginFill(0,1),n.r(s.left,s.top,s.width,s.height),n.endFill(),n};platypus.createComponentClass({id:"BadgeNotifier",properties:{},publicProperties:{showLength:5e3},initialize:function(){this.hideSoon=0,this.hiding=!0,this.lastState=null,this.list=Array.setUp()},events:{load:function(){this.progressMask=n(this.owner.components[3].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.activeMask=n(this.owner.components[5].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.progressMask.y=170,this.activeMask.y=170},adopted:function(){this.handler=function(t){for(var e=this.list,i=e.length;i--;)if(t.badge===e[i].badge)return;e.push(t)}.bind(this),this.owner.parent.on("badge-incremented",this.handler)},"handle-logic":function(t){var e=null,i=null,s=0,n=this.owner.state;if(this.hiding){if(this.list.length){if(i=(e=this.list.pop()).badge,this.lastState&&n.set(this.lastState,!1),this.lastState=i["game-id"]+"-"+i.id,n.set(this.lastState,!0),s="app-1"===this.lastState||"app-2"===this.lastState||"app-3"===this.lastState||"app-4"===this.lastState,this.createProgress(i,e,!s),s)return;this.owner.triggerEvent("show-progress"),this.owner.triggerEvent("set-text",i.name),this.hiding=!1,this.hideSoon=this.showLength}}else this.hideSoon>0&&(this.hideSoon-=t.delta,this.hideSoon<=0&&this.owner.triggerEvent("hide-progress"))},hiding:function(){this.hiding=!0}},methods:{createProgress:function(t,i,n){for(var r=platypus.game.app,a=t.subgoals,o=a.length,h=0,l=0,c=0;o--;)h+=+a[o].count,l+=a[o].progress||0;r.analyticsEmitter.progressBadge(r.levelId||"",t.name,l/h),r.googleAnalytics.event(r.name,"BadgeProgress",t.name,l-i.originalProgress),n&&(c=(l-i.progress+i.originalProgress)/h*400,this.activeMask.x=c,this.progressMask.x=c,s.get(this.activeMask).wait(500).to({x:l/h*400},1200,e.sineInOut))},destroy:function(){this.owner.parent.off("badge-incremented",this.handler),this.list.recycle(),this.list=null}},publicMethods:{}})}(),function(){"use strict";var t={static:0,kinematic:1,dynamic:2},e=include("Box2D.b2Vec2"),i=include("Box2D.b2BodyDef"),s=include("Box2D.b2Filter"),n=include("Box2D.b2FixtureDef"),r=include("Box2D.b2PolygonShape"),a=include("Box2D.b2CircleShape"),o=include("platypus.Data"),h=include("platypus.Async"),l=include("Box2D.helpers.clearUserData"),c=include("Box2D.destroy"),p=include("Box2D.getPointer"),d=include("Box2D.helpers.setUserData"),u=include("decomp.quickDecomp"),g=new n,m={distance:Box2D.b2DistanceJoint,revolute:Box2D.b2RevoluteJoint,prismatic:Box2D.b2PrismaticJoint,pulley:Box2D.b2PulleyJoint,gear:Box2D.b2GearJoint,mouse:Box2D.b2MouseJoint,wheel:Box2D.b2WheelJoint,weld:Box2D.b2WeldJoint,rope:Box2D.b2RopeJoint,friction:Box2D.b2FrictionJoint,motor:Box2D.b2MotorJoint},y={distance:new Box2D.b2DistanceJointDef,revolute:new Box2D.b2RevoluteJointDef,prismatic:new Box2D.b2PrismaticJointDef,pulley:new Box2D.b2PulleyJointDef,gear:new Box2D.b2GearJointDef,mouse:new Box2D.b2MouseJointDef,wheel:new Box2D.b2WheelJointDef,weld:new Box2D.b2WeldJointDef,rope:new Box2D.b2RopeJointDef,friction:new Box2D.b2FrictionJointDef,motor:new Box2D.b2MotorJointDef},f=function(t){return Math.round(16384*t)/16384},v=function(t){for(var i=Array.setUp(),s=t.length,n=null;s--;)(n=new e).Set(t[s][0],t[s][1]),i[s]=n;return i},w=function(t,e,i,s,n){for(var r=function(t,e){for(var i=Array.setUp(),s=t.length;s--;)i[s]=Array.setUp(t[s].x/e,t[s].y/e);return i}(e,s),a=null,o=r.length<=4?[r]:u(r),h=null,l=null,p=o.length,g=0;p--;){if(o[p].length>8){for(a=[],g=o[p].length-6;g<o[p].length;g++)a.push(o[p][g]);o[p].length-=5,o[p].push(a[5]),p+=1,o.splice(p,0,a)}for(l=v(o[p]),t.set_shape(x(l)),h=i.CreateFixture(t),d(h,n),g=l.length;g--;)c(l[g]);l.recycle()}r.recycle(2)},b=function(t){return"string"==typeof t?function(e){this.owner.triggerEvent(t,e)}:t.length?function(e){this.owner.trigger(t,e)}:null},x=function(t){var e,i=new r,s=Box2D._malloc(8*t.length),n=0,a=0;for(a=0;a<t.length;a++)Box2D.HEAPF32[s+n>>2]=t[a].get_x(),Box2D.HEAPF32[s+(n+4)>>2]=t[a].get_y(),n+=8;return e=Box2D.wrapPointer(s,Box2D.b2Vec2),i.Set(e,t.length),i},S=function(t,e){var i=this.owner.parent.addEntity(t,e);this.connectedEntities.push(i)};platypus.createComponentClass({id:"BoxCollision",properties:{bodyDefinition:null,connectingEntities:null,joints:null,resolution:null},publicProperties:{shape:null},initialize:function(e,s){var n=null,r=null,a=this.resolution,o="",l="",c="",p=new i,u=this.bodyDefinition,g=null,m=u.fixtureDefinitions,y=0,f=null,v=null,w=null,x=0,E=[];if(this.owner.body=null,this.world=this.owner.parent.world,this.drawScale=this.owner.parent.drawScale,this.owner.orientation=this.owner.orientation||0,this.connectedEntities=[],a)for(o in a)if(a.hasOwnProperty(o))for(l in"default"===(r=o)&&(r=this.owner.type),a[o])if(a[o].hasOwnProperty(l))if("beginContact"===l)for(c in n=a[o][l])n.hasOwnProperty(c)&&this.addEventListener("begin-contact-"+r+"-and-"+c,b(n[c]));else if("endContact"===l)for(c in n=a[o][l])n.hasOwnProperty(c)&&this.addEventListener("end-contact-"+r+"-and-"+c,b(n[c]));else if("preSolve"===l)for(c in n=a[o][l])n.hasOwnProperty(c)&&this.addEventListener("pre-solve-"+r+"-and-"+c,b(n[c]));else if("postSolve"===l)for(c in n=a[o][l])n.hasOwnProperty(c)&&this.addEventListener("post-solve-"+r+"-and-"+c,b(n[c]));if(u){if(void 0!==u.type&&p.set_type(t[u.type]),void 0!==u.active&&p.set_active(u.active),void 0!==u.allowSleep&&p.set_allowSleep(u.allowSleep),void 0!==u.angle?p.set_angle(u.angle):this.owner.orientation&&p.set_angle(this.owner.orientation),void 0!==u.angularDamping&&p.set_angularDamping(u.angularDamping),void 0!==u.angularVelocity&&p.set_angularVelocity(u.angularVelocity),void 0!==u.awake&&p.set_awake(u.awake),void 0!==u.bullet&&p.set_bullet(u.bullet),void 0!==u.fixedRotation&&p.set_fixedRotation(u.fixedRotation),void 0!==u.inertiaScale&&p.set_inertiaScale(u.inertiaScale),void 0!==u.linearDamping&&p.set_linearDamping(u.linearDamping),void 0!==u.gravityScale&&p.set_gravityScale(u.gravityScale),g=p.get_position(),u.position?(g.set_x((this.owner.x||u.position.x||0)/this.drawScale),g.set_y((this.owner.y||u.position.y||0)/this.drawScale)):(g.set_x((this.owner.x||0)/this.drawScale),g.set_y((this.owner.y||0)/this.drawScale)),this.owner.body=this.world.CreateBody(p),this.matchEntityToBody(),d(this.owner.body,{entity:this.owner}),!this.owner.body)return platypus.debug.warn('Unable to create Box2D Body for "'+this.owner.type+'".'),!1;for(y=0;y<m.length;y++)this.createFixture(m[y],u.defaultFixtureData||{})}else platypus.debug.warn(this.owner.type+": This entity has no defined body.");if(this.connectingEntities)for(x=0;x<this.connectingEntities.length;x++){for(w in v={},(f=this.connectingEntities[x]).properties)f.properties.hasOwnProperty(w)&&(v[w]=f.properties[w]);v.x=this.owner.x,v.y=this.owner.y,v.z=this.owner.z,f.offset&&(v.x+=f.offset.x||0,v.y+=f.offset.y||0,v.z+=f.offset.z||0),v.joinId=f.joinId||"entity-"+x,E.push(S.bind(this,{type:f.type,properties:v}))}return h.setUp(E,function(t){var e=null,i=null;if(this.joints)for(i=0;i<this.joints.length;i++)e=this.joints[i],this.createJoint(e.type,e);this.owner.triggerEvent("box2d-body-initialized",this.owner.body),t()}.bind(this,s)),!0},events:{"before-box2d-update":function(){this.matchBodyToEntity()},"after-box2d-update":function(){this.matchEntityToBody()},"add-collision-listener":function(t){var e=t,i=e.thisType||this.owner.type;"beginContact"===e.when&&this.addEventListener("begin-contact-"+i+"-and-"+e.otherType,b(e.message)),"endContact"===e.when&&this.addEventListener("end-contact-"+i+"-and-"+e.otherType,b(e.message)),"preSolve"===e.when&&this.addEventListener("pre-solve-"+i+"-and-"+e.otherType,b(e.message)),"postSolve"===e.when&&this.addEventListener("post-solve-"+i+"-and-"+e.otherType,b(e.message))}},methods:{destroy:function(){var t=0,e=this.owner,i=this.owner.body,s=i.GetFixtureList();for(this.owner.destroyThePins&&this.owner.destroyThePins(),e.parent.triggerEvent("body-removed",i),l(i);0!==p(s);)l(s),s=s.GetNext();for(e.body=null,this.world=null,t=0;t<this.connectedEntities.length;t++)this.owner.parent.removeEntity(this.connectedEntities[t]);this.connectedEntities.length=0}},publicMethods:{createFixture:function(t,i){var n=g,h=null,l="",c=this.owner,p=null,u=null,m=new s,y=t.shape||this.shape||c;if(y=o.setUp("radius",y.radius,"points",y.points,"halfHeight",y.halfHeight||(y.height||0)/2,"halfWidth",y.halfWidth||(y.width||0)/2,"x",(y===c?0:y.x)||0,"y",(y===c?0:y.y)||0),void 0!==t.density?n.set_density(t.density):void 0!==i.density?n.set_density(i.density):n.set_density(1),void 0!==t.friction?n.set_friction(t.friction):void 0!==i.friction?n.set_friction(i.friction):n.set_friction(.5),void 0!==t.restitution?n.set_restitution(t.restitution):void 0!==i.restitution?n.set_restitution(i.restitution):n.set_restitution(.2),t.filter&&void 0!==t.filter.categoryBits?m.set_categoryBits(t.filter.categoryBits):i.filter&&void 0!==i.filter.categoryBits?m.set_categoryBits(i.filter.categoryBits):m.set_categoryBits(1),t.filter&&void 0!==t.filter.groupIndex?m.set_groupIndex(t.filter.groupIndex):i.filter&&void 0!==i.filter.groupIndex?m.set_groupIndex(i.filter.groupIndex):m.set_groupIndex(0),t.filter&&void 0!==t.filter.maskBits?m.set_maskBits(t.filter.maskBits):i.filter&&void 0!==i.filter.maskBits?m.set_maskBits(i.filter.maskBits):m.set_maskBits(65535),n.set_filter(m),void 0!==t.isSensor?n.set_isSensor(t.isSensor):void 0!==i.isSensor?n.set_isSensor(i.isSensor):n.set_isSensor(!1),u={collisionType:this.owner.type},void 0!==t.userData)for(l in t.userData)t.userData.hasOwnProperty(l)&&(u[l]=t.userData[l]);else if(void 0!==i.userData)for(l in i.userData)i.userData.hasOwnProperty(l)&&(u[l]=i.userData[l]);y.radius?((p=new a).set_m_radius(y.radius/this.drawScale),(y.x||y.y)&&p.get_m_p().Set((y.x||0)/this.drawScale,(y.y||0)/this.drawScale),n.set_shape(p),h=c.body.CreateFixture(n),d(h,u)):y.points?w(n,y.points,c.body,this.drawScale,u):y.halfWidth&&y.halfHeight?((p=new r).SetAsBox(y.halfWidth/this.drawScale,y.halfHeight/this.drawScale,new e((y.x||0)/this.drawScale,(y.y||0)/this.drawScale),0),n.set_shape(p),h=c.body.CreateFixture(n),d(h,u)):platypus.debug.warn(c.type+": Unhandled shape definition.",y),y.recycle()},findConnectedByJoinId:function(t){var e=null,i=0;for(i=0;i<this.connectedEntities.length;i++)if(this.connectedEntities[i].joinId===t){e=this.connectedEntities[i];break}return e},createJoint:function(t,i,s,n){var r=y[t],a=new e(0,0),o=new e(0,0),h=null,l=null,c=null,p="",u=null,g=null;switch(void 0===n&&(n=this.drawScale),s?(h=this.owner,l=s):"string"==typeof i.join?(h=this.owner,l=this.findConnectedByJoinId(i.join)):i.join?(h=i.join.A?this.findConnectedByJoinId(i.join.A):this.owner,l=i.join.B?this.findConnectedByJoinId(i.join.B):this.owner):(h=this.owner,l=this.findConnectedByJoinId("entity-0")),i.anchor?(a.set_x(i.anchor.x),a.set_y(i.anchor.y),r.Initialize(h.body,l.body,a)):(r.set_bodyA(h.body),r.set_bodyB(l.body),i.localAnchorA&&a.Set(i.localAnchorA.x/n,i.localAnchorA.y/n),r.set_localAnchorA(a),i.localAnchorB&&o.Set(i.localAnchorB.x/n,i.localAnchorB.y/n),r.set_localAnchorB(o)),r.set_collideConnected(!!i.collideConnected),t){case"distance":r.set_length(i.length/this.drawScale||1),r.set_dampingRatio(i.dampingRatio||0),r.set_frequencyHz(i.frequencyHz||0);break;case"revolute":r.set_referenceAngle(i.referenceAngle||0),r.set_enableLimit(!!i.enableLimit),r.set_lowerAngle(i.lowerAngle||0),r.set_upperAngle(i.upperAngle||0),r.set_enableMotor(!!i.enableMotor),r.set_maxMotorTorque(i.maxMotorTorque||0),r.set_motorSpeed(i.motorSpeed||0);break;case"prismatic":g=new e(1,0),i.localAxisA&&g.Set(i.localAxisA.x,i.localAxisA.y),r.set_localAxisA(g),r.set_referenceAngle(i.referenceAngle||0),r.set_enableLimit(!!i.enableLimit),r.set_lowerTranslation(i.lowerTranslation/this.drawScale||0),r.set_upperTranslation(i.upperTranslation/this.drawScale||0),r.set_enableMotor(!!i.enableMotor),r.set_maxMotorForce(i.maxMotorForce||0),r.set_motorSpeed(i.motorSpeed||0);break;case"weld":r.set_referenceAngle(i.referenceAngle||0);break;case"pulley":case"gear":case"mouse":case"wheel":case"rope":case"friction":case"motor":default:platypus.debug.warn(t+" joints are not implemented at this point")}if(u={},i.userData)for(p in i.userData)i.userData.hasOwnProperty(p)&&(u[p]=i.userData[p]);return c=this.world.CreateJoint(r),c=Box2D.castObject(c,m[t]),d(c,u),h.triggerEvent("joint-attached",c),l.triggerEvent("joint-attached",c),c},removeJoint:function(t){l(t),this.world.DestroyJoint(t)},matchEntityToBody:function(t,e){var i=this.owner.body,s=t||i.GetPosition(),n=e||i.GetAngle(),r=s.get_x(),a=s.get_y();r===this.lastBodyX&&a===this.lastBodyY&&n===this.lastBodyAngle||(this.lastBodyX=r,this.lastBodyY=a,this.lastBodyAngle=n,this.lastX=this.owner.x=f(r*this.drawScale),this.lastY=this.owner.y=f(a*this.drawScale),this.lastOrientation=this.owner.orientation=f(n),this.owner.rotation=180*n/Math.PI)},matchBodyToEntity:function(){var t=this.owner,i=null,s=0,n=0;return(t.x!==this.lastX||t.y!==this.lastY||t.orientation!==this.lastOrientation)&&(this.lastX=t.x,this.lastY=t.y,this.lastOrientation=t.orientation,this.lastBodyX=s=f(t.x/this.drawScale),this.lastBodyY=n=f(t.y/this.drawScale),this.lastBodyAngle=f(t.orientation),i=new e(s,n),t.body.SetAwake(!0),t.body.SetTransform(i,this.lastBodyAngle),c(i),!0)}}})}(),function(){"use strict";var t=include("Box2D.b2AABB"),e=include("Box2D.b2Contact"),i=include("Box2D.b2Fixture"),s=include("Box2D.b2Vec2"),n=include("Box2D.b2World"),r=include("Box2D.JSContactListener"),a=include("Box2D.JSQueryCallback"),o=include("springroll.Debug",!1),h=include("Box2D.helpers.getCanvasDebugDraw"),l=include("Box2D.helpers.getUserData"),c=include("Box2D.destroy"),p={collisionType:"none",entity:null},d=include("Box2D.wrapPointer"),u={entity:null,contact:null,thisFixture:null,otherFixture:null,oldManifold:null,impulse:null},g=function(t){var i=d(t,e),s=i.GetFixtureA(),n=i.GetFixtureB(),r=l(s).collisionType,a=l(n).collisionType,o=l(s.GetBody()).entity,h=l(n.GetBody()).entity;u.contact=i,u.oldManifold=null,u.impulse=null,u.thisFixture=s,u.otherFixture=n,u.entity=h,o.triggerEvent("begin-contact-"+r+"-and-"+a,u),u.thisFixture=n,u.otherFixture=s,u.entity=o,h.triggerEvent("begin-contact-"+a+"-and-"+r,u)},m=function(t){var i=d(t,e),s=i.GetFixtureA(),n=i.GetFixtureB(),r=(l(s)||p).collisionType,a=(l(n)||p).collisionType,o=(l(s.GetBody())||p).entity,h=(l(n.GetBody())||p).entity;u.contact=i,u.oldManifold=null,u.impulse=null,o&&(u.thisFixture=s,u.otherFixture=n,u.entity=h,o.triggerEvent("end-contact-"+r+"-and-"+a,u)),h&&(u.thisFixture=n,u.otherFixture=s,u.entity=o,h.triggerEvent("end-contact-"+a+"-and-"+r,u))},y=function(t,i){var s=d(t,e),n=s.GetFixtureA(),r=s.GetFixtureB(),a=l(n).collisionType,o=l(r).collisionType,h=l(n.GetBody()).entity,c=l(r.GetBody()).entity;u.contact=s,u.oldManifold=i,u.impulse=null,u.thisFixture=n,u.otherFixture=r,u.entity=c,h.triggerEvent("pre-solve-"+a+"-and-"+o,u),u.thisFixture=r,u.otherFixture=n,u.entity=h,c.triggerEvent("pre-solve-"+o+"-and-"+a,u)},f=function(t,i){var s=d(t,e),n=s.GetFixtureA(),r=s.GetFixtureB(),a=l(n).collisionType,o=l(r).collisionType,h=l(n.GetBody()).entity,c=l(r.GetBody()).entity;u.contact=s,u.oldManifold=null,u.impulse=i,u.thisFixture=n,u.otherFixture=r,u.entity=c,h.triggerEvent("post-solve-"+a+"-and-"+o,u),u.thisFixture=r,u.otherFixture=n,u.entity=h,c.triggerEvent("post-solve-"+o+"-and-"+a,u)};platypus.createComponentClass({id:"BoxHandler",properties:{gravity:null,simulationFrequency:1/60,velocityIterations:2,positionIterations:2,debugFlags:null},publicProperties:{world:null,drawScale:30,logicStepsPerBox2DStep:1},initialize:function(t){var e=this.gravity||{x:0,y:0},i=new r,a=void 0===t.allowSleep||t.allowSleep;this.destroyBodies=[],this.inCollisionLoop=!1,this.paused=!1,this.totalTime=0,this.world=new n(new s(e.x,e.y),a),i.BeginContact=g,i.EndContact=m,i.PreSolve=y,i.PostSolve=f,this.world.SetContactListener(i),(t.debug||!1!==t.debug&&(this.owner.debug||o))&&(this.debugCanvas=document.createElement("canvas"),this.debugCanvas.style.pointerEvents="none",this.debugCanvas.id="box2D-debug-canvas",this.ctx=this.debugCanvas.getContext("2d"),document.body.appendChild(this.debugCanvas),this.debugDraw=h(this.ctx),this.debugDraw.SetFlags(this.debugFlags?this.debugFlags:3),this.world.SetDebugDraw(this.debugDraw))},events:{"body-removed":function(t){this.inCollisionLoop?this.destroyBodies.push(t):this.world.DestroyBody(t)},"check-collision-group":function(t){var e=this.debugCanvas,i=this.destroyBodies,s=0,n=this.owner,r=this.simulationFrequency,a=this.world;if(i.length){for(s=0;s<i.length;s++)a.DestroyBody(i[s]);i.length=0}if(!this.paused)for(this.totalTime+=t.delta/(1e3*r);this.totalTime>0;)this.totalTime-=this.logicStepsPerBox2DStep,n.triggerEvent("before-box2d-update",t,r),n.triggerEventOnChildren("before-box2d-update",t,r),this.inCollisionLoop=!0,a.Step(r,this.velocityIterations,this.positionIterations),this.inCollisionLoop=!1,e&&(this.ctx.clearRect(0,0,e.width,e.height),a.DrawDebugData()),a.ClearForces(),n.triggerEventOnChildren("after-box2d-update",t,r),n.triggerEvent("after-box2d-update",t,r),n.triggerEventOnChildren("box2d-step-complete")},"camera-update":function(t){var e=window.devicePixelRatio||1,i=t.scaleY*this.drawScale/e,s=t.scaleX*this.drawScale/e;this.debugCanvas&&(this.debugCanvas.width===this.debugCanvas.offsetWidth&&this.debugCanvas.height===this.debugCanvas.offsetHeight||(this.debugCanvas.width=this.debugCanvas.offsetWidth,this.debugCanvas.height=this.debugCanvas.offsetHeight),this.ctx.restore(),this.ctx.save(),this.ctx.translate(-t.viewport.left*t.scaleX/e,-t.viewport.top*t.scaleY/e),this.ctx.scale(i,s))},"pause-collision":function(){this.paused=!0},"unpause-collision":function(){this.paused=!1}},methods:{destroy:function(){c(this.world),this.world=null,this.debugCanvas&&this.debugCanvas.parentNode&&this.debugCanvas.parentNode.removeChild(this.debugCanvas),this.debugCanvas=null,this.debugDraw=null,this.ctx=null}},publicMethods:{getEntitiesAtPoint:function(e,n){var r=new t,o=Array.setUp(),h=e/this.drawScale,p=n/this.drawScale,u=new s(h-.01,p-.01),g=new s(h+.01,p+.01),m=new a,y=null;return r.set_lowerBound(u),r.set_upperBound(g),m.ReportFixture=function(t){var e=d(t,i);return e.TestPoint(this.m_point)&&(y=l(e.GetBody()))&&y.entity&&o.push(y.entity),!0},m.m_point=new s(h,p),this.world.QueryAABB(m,r),c(u),c(g),c(r),o}}})}(),function(){"use strict";var t,e=include("platypus.AABB"),i=include("Box2D.b2Vec2"),s=include("PIXI.Graphics"),n=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},r=include("Box2D.destroy");platypus.createComponentClass({id:"BoxStateSaver",properties:{renderDebug:!1,useStressSignals:!0},publicProperties:{buildingArea:null,engine:null,world:null,gravityMultiplier:1},initialize:function(){this.busySaving=!1,this.simulationStarted=!1,this.initialCamera=e.setUp(0,0,960,720),this.mask=null,this.level=null,this.stage=null,this.gravityStrength=50,this.gravity=new i(0,this.gravityStrength),this.noGravity=new i(0,0),springroll.Debug&&(window.makeEverythingMovable=this.makeEverythingMovable.bind(this),window.exportLevel=this.exportLevel.bind(this)),this.owner.stickyClick=null},events:{"set-gravity":function(t){this.gravityMultiplier=t},"hover-state":function(t){if(this.stage!==t)switch(this.stage=t,t){case 2:this.updateFilter(1,0,0);break;case 1:this.updateFilter(1,.6,.6);break;default:this.updateFilter(1,1,.4)}},"render-world":function(t){var e=t.renderGroups,i=t.world;e[0].z=0,this.mask=function(t,e){var i=new s;return t.mask=i,i.isMask=!0,i.z=1,e.addChild(i),i}(e[0],i),t.world.reorder=!0},"world-loaded":function(t){var e=0,i=null,s=platypus.labRetriever,n=this.owner.labUnlocks;if(this.level=t.level,n)for(e=(n=n.split(",")).length;e--;)i=n[e],s.has(i)||platypus.labRetriever.unlock(i);this.height=t.level.height,this.width=t.level.width,this.startSimulation()},"start-simulation":function(){this.simulationStarted?platypus.debug.warn("Simulation asked to start, but it is already started."):this.startSimulation()},"stop-simulation":function(){this.simulationStarted?this.stopSimulation():platypus.debug.warn("Simulation asked to stop, but it is not started.")},"camera-update":function(t){var i=e.setUp(t.viewport);!function(t,e){e.clear(),e.beginFill(0,1),e.r(t.left-1,t.top-1,t.width+2,t.height+2),e.endFill()}(i,this.mask),i.recycle()},"building-area-ready":function(t){this.buildingArea=t},"stop-following-if-simulating":function(){this.followingItem&&(this.followingItem=!1,this.owner.triggerEvent("follow",{mode:"static"}))},"child-entity-removed":function(t){this.simulationStarted||this.owner.triggerEvent("entity-discarded",t.type)},"recycle-everything":function(){for(var t=this.owner,e=(t.parent.app,t.entities.greenSlice()),i=null,s=e.length;s--;)!(i=e[s]).destroyed&&i.savable&&(t.removeEntity(i),1);e.recycle()},"photo-ready":(t=function(t,e,i){var s=platypus.game.app.config.journal,n={thumbnail:null,level:e},r=-1;try{n.thumbnail=function(t,e,i){var s=0,n=0,r=t.width,a=t.height,o=document.createElement("canvas"),h=o.getContext("2d");o.width=e,o.height=i,r/a>e/i?(s=i*(r/a),n=i):r/a<e/i?(s=e,n=e*(a/r)):(s=e,n=i);try{return h.drawImage(t,0,0,r,a,(e-s)/2,(i-n)/2,s,n),o.toDataURL()}catch(t){return null}}(platypus.game.app.display.renderer.extract.canvas(this.owner.worldContainer.parent),s.thumbnail.width/2,s.thumbnail.height/2)}catch(t){return}switch(e){case"level-4":r=0;break;case"level-5":r=1;break;case"level-6":r=2}Array.isArray(i)||(i=[]),i[r]=n;try{t.write(s.storageKey,i)}catch(e){n.thumbnail=null,t.write(s.storageKey,i)}},function(e){var i=this.owner.parent.app.userData,s=platypus.game.app.config.journal,n=Date.now();n-(this.lastSnapShot||0)>2e4&&("level-4"===e||"level-5"===e||"level-6"===e)&&(this.lastSnapShot=n,i.read(s.storageKey,t.bind(this,i,e)))})},methods:{getSaveState:function(){var t,e=this.owner,i=Array.setUp();return e.triggerEventOnChildren("retrieve-save-state",i,this.editingLevel),t=function(t,e,i){var s=JSON.parse(JSON.stringify(e)),r=null,a=null,o=s.layers,h=o.length,l=0,c=null;for(delete s.assets;h--;)if(o[h].objects){a=o[h].objects;break}for(h=a.length;h--;)r=a[h],n(r.properties,"savable")||i&&n(r.properties,"movable")?a.splice(h,1):l=Math.max(l,r.id+1);for(h=s.tilesets.length;h--;)c=s.tilesets[h],s.tilesets[h]={firstgid:c.firstgid,source:c.source||c.name+".json"};return t.forEach(function(t){t.id=l++,a.push(t)}),s}(i,this.level,this.editingLevel),i.recycle(),t},startSimulation:function(){var t=this.owner,e=0,i=null,s=this.useStressSignals;for(this.simulationStarted=!0,this.gravity.set_y(this.gravityStrength*this.gravityMultiplier),this.world.SetGravity(this.gravity),this.level=this.getSaveState(),this.owner.triggerEvent("pre-simulation-started"),e=t.pins&&t.pins.length;e--;)t.pins[e].getConstraints().length>0&&(i={},t.pins[e].panelled?(i.distance=.45,s=!1):t.pins[e].handshake?(i.distance=.35,s=!1):(i.angle="default",i.reaction="default",i.distance="default",s=this.useStressSignals),this.owner.triggerEvent("add-joint-cluster",t.pins[e].getConstraints(),i,s));this.owner.triggerEvent("simulation-started")},stopSimulation:function(){this.simulationStarted=!1,this.world.SetGravity(this.noGravity),this.owner.triggerEventOnChildren("restore-save-state"),this.owner.triggerEvent("simulation-stopped")},updateFilter:function(t,e,i){var s=this.hover.filters[0].matrix;s[0]=t,s[6]=e,s[12]=i},destroy:function(){r(this.gravity),r(this.noGravity),this.initialCamera.recycle(),this.initialCamera=null}},publicMethods:{makeEverythingMovable:function(){for(var t=this.owner.entities,e=t.length,i=null;e--;)!(i=t[e]).hasOwnProperty("movable")||i.neverSave||i.movable||(i.movable=!0)},exportLevel:function(){return this.simulationStarted?"Restart simulation before attempting to export.":(this.editingLevel=!0,JSON.stringify(this.getSaveState()))},getSavedLevel:function(){return this.level}}})}(),function(){"use strict";var t,e,i,s,n,r,a,o,h,l,c=include("platypus.AABB"),p=include("platypus.Data"),d=include("platypus.Vector"),u=function(){return!1};platypus.createComponentClass({id:"Camera",properties:{width:0,height:0,mode:"static",overflow:!1,stretch:!1,threshold:1,rotate:!1,x:0,y:0},publicProperties:{canvas:null,transitionX:400,transitionY:600,transitionAngle:600},initialize:function(t){var e=c.setUp(this.x,this.y,this.width,this.height),i=p.setUp("viewport",e,"orientation",t.orientation||0);this.viewport=c.setUp(0,0,0,0),this.worldCamera=i,this.worldDimensions=c.setUp(),this.message=p.setUp("viewport",c.setUp(),"scaleX",0,"scaleY",0,"orientation",0,"stationary",!1,"world",this.worldDimensions),this.cameraLoadedMessage=p.setUp("viewport",this.message.viewport,"world",this.worldDimensions),this.worldIsLoaded=!1,this.following=null,this.state="static","pan"===this.mode&&(this.state="mouse-pan"),this.boundingBox=c.setUp(e.x,e.y,e.width/2,e.height/2),this.lastX=e.x,this.lastY=e.y,this.lastOrientation=i.orientation,this.forwardX=0,this.forwardY=0,this.forwardAngle=0,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=0,this.offsetY=0,this.offsetAngle=0,this.forwardFollower=p.setUp("x",this.lastX,"y",this.lastY,"orientation",this.lastOrientation),this.lastFollow=p.setUp("entity",null,"mode",null,"offsetX",0,"offsetY",0,"begin",0),this.xMagnitude=0,this.yMagnitude=0,this.xWaveLength=0,this.yWaveLength=0,this.xShakeTime=0,this.yShakeTime=0,this.shakeTime=0,this.shakeIncrementor=0,this.direction=!0,this.stationary=!1,this.viewportUpdate=!1,this.owner.container?this.parentContainer=this.owner.container:this.owner.stage?(this.canvas=this.canvas||platypus.game.app.display.canvas,this.parentContainer=this.owner.stage,this.owner.width=this.canvas.width,this.owner.height=this.canvas.height):platypus.debug.warn("Camera: There appears to be no Container on this entity for the camera to display."),this.container=new PIXI.Container,this.container.visible=!1,this.parentContainer.addChild(this.container),this.movedCamera=!1},events:{load:function(){this.resize()},"render-world":function(t){this.world=t.world,this.container.addChild(this.world)},"child-entity-added":function(t){this.viewportUpdate=!0,this.worldIsLoaded&&t.triggerEvent("camera-loaded",this.cameraLoadedMessage)},"child-entity-updated":function(t){this.viewportUpdate=!0,this.worldIsLoaded&&t.triggerEvent("camera-update",this.message)},"world-loaded":function(t){this.message.viewport.set(this.worldCamera.viewport),this.worldDimensions.set(t.world),this.worldIsLoaded=!0,t.camera&&this.follow(t.camera),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-loaded",this.cameraLoadedMessage),this.updateMovementMethods()},pointerdown:function(t){var e=this.worldCamera.viewport;"mouse-pan"===this.state&&(this.mouseVector||(this.mouseVector=d.setUp(),this.mouseWorldOrigin=d.setUp()),this.mouse=this.mouseVector,this.mouse.x=t.event.clientX,this.mouse.y=t.event.clientY,this.mouseWorldOrigin.x=e.x,this.mouseWorldOrigin.y=e.y,t.pixiEvent.stopPropagation())},pressmove:function(t){this.mouse&&this.move(this.mouseWorldOrigin.x+(this.mouse.x-t.event.clientX)/this.world.transform.worldTransform.a,this.mouseWorldOrigin.y+(this.mouse.y-t.event.clientY)/this.world.transform.worldTransform.d)&&(this.viewportUpdate=!0,this.movedCamera=!0,t.pixiEvent.stopPropagation())},pressup:function(t){this.mouse&&(this.mouse=null,this.movedCamera&&(this.movedCamera=!1,t.pixiEvent.stopPropagation()))},tick:function(t){var e=this.message,i=e.viewport,s=this.worldCamera;"following"===this.state&&this.followingFunction(this.following,t.delta)&&(this.viewportUpdate=!0),this.canvas&&(this.owner.width=this.canvas.width,this.owner.height=this.canvas.height),this.owner.width===this.lastWidth&&this.owner.height===this.lastHeight||(this.resize(),this.lastWidth=this.owner.width,this.lastHeight=this.owner.height),this.viewportUpdate?(this.viewportUpdate=!1,this.stationary=!1,e.stationary=!1,i.set(s.viewport),this.shakeIncrementor<this.shakeTime&&(this.viewportUpdate=!0,this.shakeIncrementor+=t.delta,this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime),this.shakeIncrementor<this.xShakeTime&&i.moveX(i.x+Math.sin(this.shakeIncrementor/this.xWaveLength*(2*Math.PI))*this.xMagnitude),this.shakeIncrementor<this.yShakeTime&&i.moveY(i.y+Math.sin(this.shakeIncrementor/this.yWaveLength*(2*Math.PI))*this.yMagnitude)),e.scaleX=this.windowPerWorldUnitWidth,e.scaleY=this.windowPerWorldUnitHeight,e.orientation=s.orientation,this.world.setTransform(-i.x,-i.y,1,1,0),this.container.setTransform(i.halfWidth*e.scaleX,i.halfHeight*e.scaleY,e.scaleX,e.scaleY,e.orientation),this.container.visible=!0,this.owner.triggerEvent("camera-update",e),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",e)):this.stationary||(this.stationary=!0,e.stationary=!0,this.owner.triggerEvent("camera-update",e),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",e)),this.lastFollow.begin&&this.lastFollow.begin<Date.now()&&this.follow(this.lastFollow)},"resize-camera":function(t){this.width=t.width,this.height=t.height,this.resize()},relocate:function(t){var e=null,i=this.worldCamera.viewport;t.time&&window.createjs&&createjs.Tween?(e=d.setUp(i.x,i.y),createjs.Tween.get(e).to({x:t.x,y:t.y},t.time,t.ease).on("change",function(t){this.move(t.x,t.y)&&(this.viewportUpdate=!0)}.bind(this,e)).call(function(){this.recycle()}.bind(e))):this.move(t.x,t.y)&&(this.viewportUpdate=!0)},follow:function(t){this.follow(t)},shake:function(t){var e=t||{},i=e.xMagnitude||0,s=e.yMagnitude||0,n=e.xFrequency||0,r=e.yFrequency||0,a=e.time||0;this.viewportUpdate=!0,this.shakeIncrementor=0,this.xMagnitude=i,this.yMagnitude=s,0===n?(this.xWaveLength=1,this.xShakeTime=0):(this.xWaveLength=1e3/n,this.xShakeTime=Math.ceil(a/this.xWaveLength)*this.xWaveLength),0===r?(this.yWaveLength=1,this.yShakeTime=0):(this.yWaveLength=1e3/r,this.yShakeTime=Math.ceil(a/this.yWaveLength)*this.yWaveLength),this.shakeTime=Math.max(this.xShakeTime,this.yShakeTime)}},methods:{follow:function(t){switch(t.time?(this.lastFollow.begin||(this.lastFollow.entity=this.following,this.lastFollow.mode=this.mode,this.lastFollow.offsetX=this.offsetX,this.lastFollow.offsetY=this.offsetY),this.lastFollow.begin=Date.now()+t.time):this.lastFollow.begin&&(this.lastFollow.begin=0),this.mode=t.mode,t.mode){case"locked":this.state="following",this.following=t.entity,this.followingFunction=this.lockedFollow,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetAngle=t.offsetAngle||0;break;case"forward":this.state="following",this.followFocused=!1,this.following=t.entity,this.lastX=t.entity.x-t.offsetX||0,this.lastY=t.entity.y-t.offsetY||0,this.lastOrientation=t.entity.orientation||0,this.forwardX=t.movementX||.1*this.transitionX,this.forwardY=t.movementY||.1*this.transitionY,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetAngle=t.offsetAngle||0,this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following",this.following=t.entity,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetAngle=t.offsetAngle||0,this.boundingBox.setAll(t.x,t.y,t.width,t.height),this.followingFunction=this.boundingFollow;break;case"anchor-bound":this.state="following",this.following=t.entity,this.followingFunction=function(t,e,i,s){var n=c.setUp(s.x+e,s.y+i,s.width,s.height),r=t.x,a=t.y;return n.top<t.top?a-=t.top-n.top:n.bottom>t.bottom&&(a+=t.bottom-n.bottom),n.left<t.left?r-=t.left-n.left:n.right>t.right&&(r+=t.right-n.right),n.recycle(),this.move(r,a,0)}.bind(this,t.anchorAABB,t.offsetX||0,t.offsetY||0);break;case"pan":this.state="mouse-pan",this.following=null,this.followingFunction=null,t&&"number"==typeof t.x&&"number"==typeof t.y&&(this.move(t.x,t.y,t.orientation||0),this.viewportUpdate=!0);break;default:this.state="static",this.following=null,this.followingFunction=null,t&&"number"==typeof t.x&&"number"==typeof t.y&&(this.move(t.x,t.y,t.orientation||0),this.viewportUpdate=!0)}t.begin&&(t.begin=0)},move:function(t,e,i){var s=this.moveX(t);return s=this.moveY(e)||s,this.rotate&&(s=this.reorient(i||0)||s),s},moveX:u,moveY:u,reorient:function(t){var e=this.worldCamera;return Math.abs(e.orientation-t)>1e-4&&(e.orientation=t,!0)},lockedFollow:(o=Math.min,h=function(t,e,i){return i*e+(1-i)*t},l=function(t,e){return t?o(e/t,1):1},function(t,e){var i=this.worldCamera,s=i.viewport,n=h(s.x,t.x+this.offsetX,l(this.transitionX,e)),r=h(s.y,t.y+this.offsetY,l(this.transitionY,e));return this.rotate?this.move(n,r,h(i.orientation,-(t.orientation||0),l(this.transitionAngle,e))):this.move(n,r,0)}),forwardFollow:function(t,e){var i=this.forwardFollower,s=!1,n=15/e,r=this.worldCamera,a=r.viewport,o=t.x+this.offsetX,h=t.y+this.offsetY,l=(t.orientation||0)+this.offsetAngle;return this.followFocused&&this.lastX===o&&this.lastY===h?this.lockedFollow(i,e):(this.averageOffsetX*=.9,this.averageOffsetY*=.9,this.averageOffsetX+=(1-.9)*(o-this.lastX)*n,this.averageOffsetY+=(1-.9)*(h-this.lastY)*n,Math.abs(this.averageOffsetX)>a.width/(2*this.forwardX)&&(this.averageOffsetX=0),Math.abs(this.averageOffsetY)>a.height/(2*this.forwardY)&&(this.averageOffsetY=0),this.rotate&&(this.averageOffsetAngle*=.9,this.averageOffsetAngle+=(1-.9)*(l-this.lastOrientation)*n,Math.abs(this.averageOffsetAngle)>r.orientation/(2*this.forwardAngle)&&(this.averageOffsetAngle=0)),i.x=this.averageOffsetX*this.forwardX+o,i.y=this.averageOffsetY*this.forwardY+h,i.orientation=this.averageOffsetAngle*this.forwardAngle+l,this.lastX=o,this.lastY=h,this.lastOrientation=l,s=this.lockedFollow(i,e),this.followFocused||s||(this.followFocused=!0),s)},boundingFollow:function(t,e){var i=0,s=0,n=this.transitionX?Math.min(e/this.transitionX,1):1,r=1-n,a=this.transitionY?Math.min(e/this.transitionY,1):1,o=1-a,h=this.worldCamera.viewport;return this.boundingBox.move(h.x,h.y),t.x>this.boundingBox.right?i=t.x-this.boundingBox.halfWidth:t.x<this.boundingBox.left&&(i=t.x+this.boundingBox.halfWidth),t.y>this.boundingBox.bottom?s=t.y-this.boundingBox.halfHeight:t.y<this.boundingBox.top&&(s=t.y+this.boundingBox.halfHeight),0!==i&&(i=this.moveX(n*i+r*h.x)),0!==s&&(s=this.moveY(a*s+o*h.y)),i||s},resize:function(){var t=this.width/this.height,e=this.owner.width/this.owner.height,i=this.worldCamera.viewport;this.viewport.setAll(this.owner.width/2,this.owner.height/2,this.owner.width,this.owner.height),this.stretch||(e>t?this.overflow?i.resize(this.height*e,this.height):this.viewport.resize(this.viewport.height*t,this.viewport.height):this.overflow?i.resize(this.width,this.width/e):this.viewport.resize(this.viewport.width,this.viewport.width/t)),this.worldPerWindowUnitWidth=i.width/this.viewport.width,this.worldPerWindowUnitHeight=i.height/this.viewport.height,this.windowPerWorldUnitWidth=this.viewport.width/i.width,this.windowPerWorldUnitHeight=this.viewport.height/i.height,this.container.setTransform(this.viewport.x-this.viewport.halfWidth,this.viewport.y-this.viewport.halfHeight),this.viewportUpdate=!0,this.updateMovementMethods()},updateMovementMethods:(t=u,e=function(){var e=this.worldDimensions;return this.worldCamera.viewport.moveX(e.width/2+e.left),this.moveX=t,!0},i=function(){var e=this.worldDimensions;return this.worldCamera.viewport.moveY(e.height/2+e.top),this.moveY=t,!0},s=function(t){var e=this.worldCamera.viewport,i=this.worldDimensions,s=i.width,n=i.left;return Math.abs(e.x-t)>this.threshold&&(t+e.halfWidth>s+n?e.moveX(s-e.halfWidth+n):t<e.halfWidth+n?e.moveX(e.halfWidth+n):e.moveX(t),!0)},n=function(t){var e=this.worldCamera.viewport,i=this.worldDimensions,s=i.height,n=i.top;return Math.abs(e.y-t)>this.threshold&&(t+e.halfHeight>s+n?e.moveY(s-e.halfHeight+n):t<e.halfHeight+n?e.moveY(e.halfHeight+n):e.moveY(t),!0)},r=function(t){var e=this.worldCamera.viewport;return Math.abs(e.x-t)>this.threshold&&(e.moveX(t),!0)},a=function(t){var e=this.worldCamera.viewport;return Math.abs(e.y-t)>this.threshold&&(e.moveY(t),!0)},function(){var t=this.threshold,o=this.worldCamera.viewport,h=this.worldDimensions,l=h.width,c=h.height;l?l<o.width?this.moveX=e:this.moveX=s:this.moveX=r,c?c<o.height?this.moveY=i:this.moveY=n:this.moveY=a,this.threshold=-1,this.moveX(o.x),this.moveY(o.y),this.threshold=t}),destroy:function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.mouseVector&&(this.mouseVector.recycle(),this.mouseWorldOrigin.recycle()),this.boundingBox.recycle(),this.viewport.recycle(),this.worldCamera.viewport.recycle(),this.worldCamera.recycle(),this.message.viewport.recycle(),this.message.recycle(),this.cameraLoadedMessage.recycle(),this.worldDimensions.recycle(),this.forwardFollower.recycle(),this.lastFollow.recycle()}},publicMethods:{isOnCanvas:function(t){var e=this.canvas;return!t||!(t.x+t.width<0||t.x>e.width||t.y+t.height<0||t.y>e.height)},windowToWorld:function(t,e,i){var s=i||d.setUp();return s.x=t.x*this.worldPerWindowUnitWidth,s.y=t.y*this.worldPerWindowUnitHeight,!1!==e&&(s.x+=this.worldCamera.viewport.left,s.y+=this.worldCamera.viewport.top),s},worldToWindow:function(t,e,i){var s=i||d.setUp();return s.x=t.x*this.windowPerWorldUnitWidth,s.y=t.y*this.windowPerWorldUnitHeight,!1!==e&&(s.x+=this.viewport.x,s.y+=this.viewport.y),s}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",properties:{propertyName1:"property-value"},publicProperties:{propertyName2:"property-value"},initialize:function(){},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"Conveyor",properties:{},publicProperties:{speed:-5},initialize:function(){var t=this.owner.state,e=t.get("reversed");this.simulationStarted=!1,"boolean"!=typeof e?t.set("reversed",!1):e&&(this.speed=-this.speed)},events:{"handle-logic":function(){var t=this.owner,e=!1,i=t.state;!this.simulationStarted&&t.pointA&&t.pointB&&(e=t.pointB.x-t.pointA.x<0)!==i.get("reversed")&&(i.set("reversed",e),this.speed=-this.speed)},"prepare-for-simulation":function(){this.simulationStarted=!0},"convey-on-collision":function(t){this.simulationStarted&&t.contact.SetTangentSpeed(this.speed)}}})}(),function(){"use strict";var t=include("PIXI.filters.ColorMatrixFilter");platypus.createComponentClass({id:"Desaturator",publicProperties:{disabled:!1},initialize:function(){this.colorMatrix=new t,this.owner.container.filters=[this.colorMatrix],this.colorMatrix.saturate(0),this.colorMatrix.enabled=!0},events:{"handle-logic":function(){},"desat-disable":function(){this.disabled=!0},"desat-enable":function(){this.disabled=!1},desaturate:function(t){this.colorMatrix.saturate(t-1)}},methods:{checkDisabled:function(){this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.colorMatrix.enabled=this.disabled)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Entity"),i=[],s={};platypus.getActionQueues=function(){var t={},e="",i=null;for(e in s)s.hasOwnProperty(e)&&(i=s[e]()).length&&(t[e]=i);return t},platypus.createComponentClass({id:"FarmerLogic",properties:{name:"",selected:!1},publicProperties:{skill:""},initialize:function(){this.owner.selected=!1,this.needSeedPlanted=!1,this.touching=[],this.touchingRocks=0,this.manager=null,this.uiActive=!1,this.seedID="carrot",this.busy=!1,this.moving=!1,this.wandering=!1,this.targetX=0,this.speed=1.5,this.currentRequest="",this.currentRequestData=null,this.tempHole=null,this.q=[],this.scale=Math.abs(this.owner.scaleX),this.busyPrev=!1,this.movingPrev=!1,this.stillTimer=0,this.waving=!1,this.camera=t.setUp(),this.forceDirCooldown=0,this.wanderC=1e4,s[this.skill]=function(t){var e=[],i=0;for(i=0;i<t.length;i++)e[i]={action:t[i].id,position:t[i].x>>0};return e}.bind(this,this.q)},events:{pointerup:function(){this.tryToWave=!0},"camera-update":function(t){this.camera.set(t.viewport)},"dig-request":function(t){"shovel"==this.skill&&(""!==this.currentRequest||this.q.length>0?this.addToQ({x:t,id:"dig",data:null,skill:"shovel"}):(this.hustleTo(t),this.currentRequest="dig"),this.manager.addDigRequest(t))},"seed-info":function(){this.playTutorial("tutorial-seed-select-3")},"sun-clicked":function(){this.cancelNextClick=!0},"force-wander":function(t){this.skill!=t||this.busy||this.moving||0!==this.q.length||this.wander()},adopted:function(){this.speed=1.25+.5*Math.random(),this.targetX=this.owner.x,this.owner.state.set(this.name,!0),this.currentScene=this.owner.parent.parent},"farming-manager-exists":function(t){this.manager=t,this.manager.registerFarmer(this.owner)},"cancel-action":function(t){this.skill==t&&(this.cancelQ(),"shovel"==this.skill&&this.manager.removeAllDigRequests())},"animation-ended":function(){this.waving&&(this.owner.state.set("waving",!1),this.owner.state.set("action",!1),this.owner.state.set("walking",!1),this.waving=!1)},"handle-logic":function(t){var e=!0;if(this.targetX&&!this.busy){if(Math.abs(this.owner.x-this.targetX)>50)this.moving=!0,this.owner.x<this.targetX?(this.owner.x+=this.speed*this.wandering?.5:1,this.owner.scaleX=this.scale):(this.owner.x-=this.speed*this.wandering?.5:1,this.owner.scaleX=-this.scale);else if(this.moving=!1,this.wandering=!1,"dig"==this.currentRequest&&"shovel"==this.skill)this.manager.canDig(this.targetX,!1)?(this.manager.holeDug(this.targetX),this.manager.save({type:"hole",x:this.targetX}),this.tempHole=this.digHole(this.targetX,this.owner.y+40),this.manager.removeDigRequest(this.targetX),this.timerEvent(2,function(){this.tempHole.complete(),this.tempHole=null,"level-1"==this.manager.getLevel()&&this.playTutorial("level-1-hole-dug"),this.finishCurrentTask()}.bind(this),.666,function(){this.tempHole.increment()}.bind(this))):this.finishCurrentTask();!this.movingPrev&&this.moving?(e=!1,this.waving=!1,this.owner.state.set("waving",!1),this.owner.state.set("action",!1),this.owner.state.set("walking",!0)):this.movingPrev&&!this.moving&&(this.waving=!1,this.owner.state.set("waving",!1),this.owner.state.set("action",!1),this.owner.state.set("walking",!1))}this.wanderC>0?this.wanderC-=t.delta:!this.moving&&!this.busy&&0===this.q.length&&Math.random()<.001&&this.wander(),this.needSeedPlanted&&(this.needSeedPlanted=!1,this.plantSeed(this.targetX,this.owner.y+40+5)),e&&!this.moving&&(this.busy&&!this.busyPrev?(this.waving=!1,this.owner.state.set("waving",!1),this.owner.state.set("action",!0),this.owner.state.set("walking",!1)):!this.busy&&this.busyPrev&&(this.waving=!1,this.owner.state.set("waving",!1),this.owner.state.set("action",!1),this.owner.state.set("walking",!1))),this.busy||this.moving||this.waving||(this.tryToWave||Math.random()<3e-4)&&(this.owner.state.set("waving",!0),this.waving=!0,this.tryToWave&&(this.tryToWave=!1,this.owner.triggerEvent("greet-up"))),this.busyPrev=this.busy,this.movingPrev=this.moving,null!==this.currentRequest&&""!==this.currentRequest||(this.owner.x<this.camera.left&&this.wander(1),this.owner.x>this.camera.right&&this.wander(-1)),this.forceDirCooldown&&this.forceDirCooldown--},"hole-clicked":function(t,e){"seed"==this.skill&&(""!==this.currentRequest||this.q.length>0?this.addToQ({x:t.x,id:"seedInHole",data:t.holeID,data2:e,skill:"seed",ent:t}):(this.seedID=e,this.isTouching(t)?this.startSeedInHole(t):(this.hustleTo(t.x),this.currentRequest="seedInHole",this.currentRequestData=t.holeID)))},"collide-with-hole":function(t){var e=t.entity,i=e.holeID;"seed"==this.skill&&this.touching.push(e),"seed"==this.skill&&"seedInHole"==this.currentRequest&&this.currentRequestData==i?this.startSeedInHole(e):this.wander()},"rock-clicked":function(t){t.removeMe=!0},"collide-with-rock":function(t){var e=t.entity;e.isParticle||e.fromHole||(e.removeMe=!0)},"end-collide-with-rock":function(t){var e=t.entity.rockID;this.isTouching(e)&&this.removeTouching(e)},"seed-clicked":function(t,e){if("water"===this.skill&&"water"===e){if(""!==this.currentRequest||this.q.length>0)return void this.addToQ({x:t.x,id:"waterSeed",data:t.seedID,skill:"seed",ent:t});this.isTouching(t)?this.waterSeed(t):(this.hustleTo(t.x),this.currentRequest="waterSeed",this.currentRequestData=t.seedID)}if("compost"===this.skill&&"compost"==e){if(""!==this.currentRequest||this.q.length>0)return void this.addToQ({x:t.x,id:"applyCompostToSeed",data:t.seedID,skill:"seed",ent:t});this.isTouching(t)?this.applyCompostToSeed(t):(this.hustleTo(t.x),this.currentRequest="applyCompostToSeed",this.currentRequestData=t.seedID)}if("shovel"==this.skill&&"shovel"==e){if(""!==this.currentRequest||this.q.length>0)return void this.addToQ({x:t.x,id:"removeSeed",data:t.seedID,skill:"shovel",ent:t});this.isTouching(t)?t.triggerEvent("remove"):(this.hustleTo(t.x),this.currentRequest="removeSeed",this.currentRequestData=t.seedID)}},"collide-with-seed":function(t){var e=t.entity,i=e.seedID;this.touching.push(e);var s=!1;"water"==this.skill&&"waterSeed"==this.currentRequest&&this.currentRequestData==i&&(this.waterSeed(e),s=!0),"compost"===this.skill&&"applyCompostToSeed"==this.currentRequest&&this.currentRequestData==i&&(this.applyCompostToSeed(e),s=!0),"shovel"==this.skill&&"removeSeed"==this.currentRequest&&this.currentRequestData==i&&(this.digUpSeed(e),s=!0),s||this.wander()},"plant-clicked":function(t,e){if("water"==this.skill&&"water"==e){if(""!==this.currentRequest||this.q.length>0)return void this.addToQ({x:t.x,id:"waterPlant",data:t.plantID,skill:"water",ent:t});this.isTouching(t)?this.waterPlant(t):(this.hustleTo(t.x),this.currentRequest="waterPlant",this.currentRequestData=t.plantID)}if("compost"===this.skill&&"compost"==e){if(""!==this.currentRequest||this.q.length>0)return void this.addToQ({x:t.x,id:"applyCompostToPlant",data:t.plantID,skill:"compost",ent:t});this.isTouching(t)?this.applyCompostToPlant(t):(this.hustleTo(t.x),this.currentRequest="applyCompostToPlant",this.currentRequestData=t.plantID)}if("shovel"==this.skill&&"shovel"==e){if(""!==this.currentRequest||this.q.length>0)return void this.addToQ({x:t.x,id:"removePlant",data:t.plantID,skill:"shovel",ent:t});this.isTouching(t)?this.digUpPlant(t):(this.hustleTo(t.x),this.currentRequest="removePlant",this.currentRequestData=t.plantID)}},"collide-with-plant":function(t){var e=t.entity,i=e.plantID;this.touching.push(e);"water"==this.skill&&"waterPlant"==this.currentRequest&&this.currentRequestData==i&&(this.waterPlant(e),this.didSomething=!0),"compost"===this.skill&&"applyCompostToPlant"==this.currentRequest&&this.currentRequestData==i&&(this.applyCompostToPlant(e),this.didSomething=!0),"shovel"==this.skill&&"removePlant"==this.currentRequest&&this.currentRequestData==i&&(this.digUpPlant(e),this.didSomething=!0),this.wander2()},"end-collide-with-seed":function(t){this.removeTouching(t.entity)},"end-collide-with-plant":function(t){this.removeTouching(t.entity)},"end-collide-with-hole":function(t){this.removeTouching(t.entity)},"close-seed-select":function(){this.uiActive=!1},"seed-selected":function(t){"seed"==this.skill&&("level-3"==this.manager.getLevel()&&this.playTutorial("tutorial-seed-select-4"),this.seedID=t.entity.seedID,this.uiActive=!1,this.owner.triggerEvent("hole-clicked",this.manager.currentHole,t.entity.seedID))},"collide-with-farmer":function(){var t=this.getRandomInt(100,200);Math.random()<.5&&(t*=-1),this.targetX+=t},"dig-hole-from-save":function(t){"shovel"==this.skill&&this.digHole(t,this.owner.y+40)},"seed-removed":function(t){t=Math.round(t);for(var e=0;e<this.q.length;e++){var i=this.q[e];if(Math.round(i.x)==t)return this.q.splice(e,1),void(0===this.q.length&&this.currentScene.layers[1].triggerEvent("force-cancel",this.skill))}},"seed-sprout":function(t){t=Math.round(t);for(var e=0;e<this.q.length;e++){var i=this.q[e];if(Math.round(i.x)==t)return this.q.splice(e,1),void(0===this.q.length&&this.currentScene.layers[1].triggerEvent("force-cancel",this.skill))}}},methods:{isTouching:function(t){for(var e in this.touching){if(this.touching[e]==t)return!0}return!1},removeTouching:function(t){var e=this.touching.indexOf(t);-1!=e&&this.touching.splice(e,1)},addToQ:function(t){if(Math.round(t.x)!=Math.round(this.targetX)){for(var e=0;e<this.q.length;e++){if(this.q[e].x==t.x)return}this.q.length>=1&&this.playTutorial("tutorial-q",!0),this.q.push(t),this.currentScene.layers[1].triggerEvent("show-action",this.skill)}},cancelQ:function(){this.q.length=0,this.currentRequest="",this.currentRequestData=null,this.targetX=this.owner.x},finishCurrentTask:function(){if(this.busy=!1,this.currentRequest="",this.q.length>0){var t=this.q.shift();this.currentRequest=t.id,this.currentRequestData=t.data,void 0!==t.data2&&(this.seedID=t.data2),this.isTouching(t.ent)?this.owner.triggerEvent("collide-with-"+t.ent.type.split("-")[0],{entity:t.ent}):this.hustleTo(t.x)}else this.cancelQ(),this.currentScene.layers[1].triggerEvent("force-cancel",this.skill),this.getOutOfTheWay()},hustleTo:function(t){this.targetX=t,this.wandering=!1},wander:function(t){this.moving&&!this.wandering&&!t||this.q.length>0||""!==this.currentRequest||(t?this.forceDirCooldown<=0&&(this.owner.scaleX=this.scale*t,this.targetX+=this.getRandomInt(100,300)*this.owner.scaleX,this.wandering=!0,this.forceDirCooldown=200):(this.owner.scaleX=Math.random()<.5?-this.scale:this.scale,this.owner.x<1e3&&(this.owner.scaleX=this.scale),this.owner.x>2500&&(this.owner.scaleX=-this.scale),this.targetX+=this.getRandomInt(50,300)*this.owner.scaleX,this.wandering=!0))},wander2:function(){this.moving&&!this.wandering||this.q.length>0||""!==this.currentRequest||(this.owner.scaleX=Math.random()<.5?-this.scale:this.scale,this.owner.x<1e3&&(this.owner.scaleX=this.scale),this.owner.x>2500&&(this.owner.scaleX=-this.scale),this.targetX+=this.getRandomInt(200,400)*this.owner.scaleX,this.wandering=!0)},getOutOfTheWay:function(){this.targetX+=this.getRandomInt(100,200)*this.owner.scaleX,this.wandering=!0},playTutorial:function(t,e){var s=i;-1===s.indexOf(t)&&(e?this.currentScene.layers[1].triggerEvent(t):this.owner.parent.triggerEvent(t),s.push(t))},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},face:function(t){this.owner.x<t?this.owner.scaleX=this.scale:this.owner.scaleX=-this.scale},waterSeed:function(t){"level-2"===this.manager.getLevel()&&this.playTutorial("tutorial-water-seed-2"),this.wateringCan(t,1)},waterPlant:function(t){this.wateringCan(t,t.getEffort())},wateringCan:function(t,e){var i=platypus.game.app;this.face(t.x),this.timerEvent(e,function(t){t.triggerEvent("watered"),this.finishCurrentTask()}.bind(this,t)),this.currentScene.layers[0].triggerEvent("applyWater"),i.analyticsEmitter.wateringCan(i.levelId||"",i.getPlots(),platypus.getActionQueues())},applyCompostToSeed:function(t){var e=platypus.game.app;this.face(t.x),this.timerEvent(5,function(){t.triggerEvent("compostApplied"),this.finishCurrentTask(),this.currentScene.layers[0].triggerEvent("healthBoost")}.bind(this)),e.analyticsEmitter.compostDrop(e.levelId||"",e.getPlots(),platypus.getActionQueues())},applyCompostToPlant:function(t){var e=platypus.game.app;this.face(t.x),this.timerEvent(Math.max(2*t.getEffort(),5),function(){t.triggerEvent("compostApplied"),this.finishCurrentTask(),this.currentScene.layers[0].triggerEvent("healthBoost")}.bind(this)),e.analyticsEmitter.compostDrop(e.levelId||"",e.getPlots(),platypus.getActionQueues())},digUpSeed:function(t){var e=platypus.game.app;this.face(t.x),this.timerEvent(2,function(){t.triggerEvent("remove"),this.finishCurrentTask()}.bind(this)),this.currentScene.layers[0].triggerEvent("digPlant"),e.analyticsEmitter.compostPlant(e.levelId||"",e.getPlots(),platypus.getActionQueues(),e.getEnlearnData({obstacle_types:t.obstacles&&t.obstacles.length?t.obstacles:["no-obstacles"],parts:t.parts||[],score:.01}))},digUpPlant:function(t){var e=platypus.game.app,i=t.getScore?t.getScore():0;this.face(t.x),this.timerEvent(t.getEffort(),function(){t.triggerEvent("remove"),this.finishCurrentTask()}.bind(this),.5,function(){this.rockParticles()}.bind(this)),this.currentScene.layers[0].triggerEvent("digPlant"),t.canHarvest?e.analyticsEmitter.harvestPlant(e.levelId||"",e.getPlots(),platypus.getActionQueues(),i,{position:t.x>>0,duration:t.age||0,seed:"seed"===t.type?t.seedType:"hole"===t.type?"none":t.type,stage:t.getStageNum?"stage-"+t.getStageNum():t.type,score:i,fertilizer:t.compostApplied||!1,pollinated:t.pollinated||!1,watered:t.watered||!1},e.getEnlearnData({obstacle_types:t.obstacles&&t.obstacles.length?t.obstacles:["no-obstacles"],parts:t.parts,score:1})):e.analyticsEmitter.compostPlant(e.levelId||"",e.getPlots(),platypus.getActionQueues(),e.getEnlearnData({obstacle_types:t.obstacles&&t.obstacles.length?t.obstacles:["no-obstacles"],parts:t.parts,score:t.scale}))},rockParticles:function(){for(var t=0;t<5;t++)this.owner.parent.addEntity({type:"rock",properties:{x:this.owner.x,y:this.owner.y,z:5001,particle:!0}})},timerEvent:function(t,e,i,s){this.currentRequestData="",this.busy=!0,this.moving=!1,this.owner.addComponent(new platypus.components.Timer(this.owner,{xo:-60,yo:-225,length:t,onComplete:e,subLength:void 0===i?0:i,subFunction:void 0===s?null:s}))},digHole:function(t,e){var i=platypus.game.app,s=this.owner.parent.addEntity({type:"soil",properties:{x:t,y:e,z:5e3,scaleX:1.5,scaleY:1.5}}),n=this.owner.parent.addEntity({type:"hole",properties:{x:t,y:e,z:5001,soil:s,supressBigRocks:"level-1"===this.manager.getLevel(),manager:this.manager}});return this.currentScene.layers[0].triggerEvent("digHole"),i.analyticsEmitter.diggingHole(i.levelId||"",i.getPlots(),platypus.getActionQueues()),n},startSeedInHole:function(t){this.needSeedPlanted=!0,this.hustleTo(t.x),this.currentRequestData=null,this.tempHole=t},plantSeed:function(t,e){var i=platypus.game.app;this.timerEvent(2,function(){"level-1"===this.manager.getLevel()&&this.playTutorial("tutorial-seed-planted-1"),this.owner.parent.addEntity({type:"seed",properties:{x:t,y:e+10,z:5e3,seedType:this.seedID,plantData:this.manager.getPlantData(this.seedID),speedMod:this.manager.speedMod,soil:this.tempHole.soil,manager:this.manager}}),this.tempHole.removeMe=!0,this.tempHole=null,this.manager.seedPlanted(Math.round(t),!1,this.seedID),this.finishCurrentTask()}.bind(this)),this.currentScene.layers[0].triggerEvent("plantSeed"),i.analyticsEmitter.plantSeed(i.levelId||"",i.getPlots(),platypus.getActionQueues(),this.seedID,i.getEnlearnData())},destroy:function(){this.manager=null,this.currentRequestData=null,this.tempHole=null,this.boundClick=null,this.q.length=0},selectSeed:function(){if(!this.uiActive){"level-3"==this.manager.getLevel()&&this.playTutorial("tutorial-seed-select-2-ALT");this.currentScene.layers[0].addEntity({type:"seedSelect",properties:{x:this.owner.x,y:this.owner.y-200,z:5e4,showDetails:this.manager.showSeedDetails,manager:this.manager}});this.uiActive=!0}}},getAssetList:function(){for(var t=null,i=["rock","soil","hole","seed","seedSelect"],s=i.length,n=Array.setUp("assets/images/farmer.png");s--;)t=e.getAssetList({type:i[s]}),n.union(t),t.recycle();return n}})}(),function(){"use strict";var t=Date.now().toString(16),e=include("platypus.AABB"),i=include("createjs.Tween"),s=include("createjs.Ease"),n=include("platypus.Entity"),r={},a=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null};platypus.createComponentClass({id:"FarmingManager",properties:{},publicProperties:{showSeedDetails:!0,showSeedSelector:!0,available:null,speedMod:1,cancelGlobalClick:!1,currentHole:null,needRecalc:!1},initialize:function(t,i){var s=platypus.game.app,n=this.interaction=s.display.renderer.plugins.interaction;this.roundTime=Date.now(),this.boundClick=this.click.bind(this),n.on("pointerdown",this.boundClick),this.broadcastedExistence=!1,this.holes=[],this.seeds=[],this.firstSeedPlanted=!1,this.began=Date.now(),this.sunDuration=0,this.sunning=!1,this.chanceOfSunFloater=.0125,this.rainDuration=0,this.raining=!1,this.rain=[],this.calmDuration=0,this.calming=!1,this.sunDir=-1,this.currentLevel="",this.nextLevel="",this.plantData={carrot:{water:4,sun:6,space:1.5,score:10},potato:{water:5,sun:5,space:5,score:20},pumpkin:{water:8,sun:8,space:7,score:50},corn:{water:7,sun:8,space:5,score:60},lettuce:{water:7,sun:3,space:3,score:40},radish:{water:4,sun:3,space:4,score:25},beet:{water:5,sun:3,space:3,score:30},tomato:{water:5,sun:5,space:6,score:40},watermelon:{water:10,sun:5,space:10,score:100},strawberry:{water:6,sun:10,space:5,score:75}},this.camera=e.setUp(),this.rainTimer=0,this.next="rain",this.calmMod=2,this.sunBG=null,this.rainBG=null,this.bees=0,this.butterflies=0,this.aphids=0,this.firstRain=!0,this.sunFloatersNeeded=6,this.initC=0,this.levelCompleteTimer=0,this.farmers=[],this.spacingC=0,this.currentSeedInfoIndex=-1,this.digMarkers=[],this.saveSlot="",this.recalcTimer=0,this.entities=null,this.floweringC=0,this.activePlants=[],this.numFlowering=0,this.aphidBuddyChance=.5,this.aphidBuddyC=0,this.consistentTicker=0,this.savedState=null,s.userData.read("-"+s.options.version+"-saved-states",function(t){this.savedState=t||{},i()}.bind(this)),platypus.game.app.predictSeedInfo=function(t){var e=this.currentSeedInfoIndex;(e+=1)===this.available.length&&(e=0),t.seed=this.available[e],t.information=this.getPlantData(t.seed)}.bind(this),platypus.game.app.getPlots=function(){for(var t=["hole","seed","plant-carrot","plant-potato","plant-pumpkin","plant-radish","plant-beet","plant-corn","plant-strawberry","plant-tomato","plant-watermelon","plant-lettuce"],e=[],i=null,s=this.owner.entities,n=s.length,r=0;n--;)for(r=t.length;r--;)if(t[r]===s[n].type){i=s[n],e.push({position:i.x>>0,duration:i.age||0,seed:"seed"===i.type?i.seedType:"hole"===i.type?"none":i.type,stage:i.getStageNum?"stage-"+i.getStageNum():i.type,score:i.getScore?i.getScore():0,fertilizer:i.compostApplied||!1,pollinated:i.pollinated||!1,watered:i.watered||!1});break}return e}.bind(this)},events:{"round-ended-home":function(){for(var t=platypus.game.app,e=[],i=this.farmers.length;i--;)e.push(this.farmers[i].skill);t.analyticsEmitter.endRound(t.levelId||"",Date.now()-this.began,this.available,e,platypus.score,t.getPlots()),t.levelId="",t.googleAnalytics.event(t.name,"Abandon-"+this.currentLevel,"LevelTime",Date.now()-this.roundTime>>0)},"plant-added":function(t){this.activePlants.indexOf(t)>-1&&this.activePlants.push(t),this.activePlants.length>=8&&platypus.badger.increment("growing-8-simultaneously")},"plant-removed":function(t,e){var i=this.activePlants.indexOf(t);i>-1&&this.activePlants.splice(i,1),e&&this.save({type:"weedRemove",x:e})},"add-to-available":function(t){var e=platypus.game.app;-1===this.available.indexOf(t)&&(this.available.push(t),e.userData.write("-"+e.options.version+"-seed-packets",this.available))},"seed-removed":function(t){this.seedRemoved(t)},"world-loaded":function(e){var i,s=platypus.game.app,n=null,r="earth",o="",h=[],l=0;switch(this.sunBG=this.owner.parent.getEntitiesByType("sun")[0],this.rainBG=this.owner.parent.getEntitiesByType("rain")[0],"string"==typeof e.level?this.currentLevel=e.level:(this.currentLevel=a(e.level.properties,"levelId"),this.nextLevel=a(e.level.properties,"next")),this.level=e.level,this.height=e.level.height,this.width=e.level.width,this.saveSlot="level-1"===this.currentLevel||"level-2"===this.currentLevel||"level-3"===this.currentLevel?"tutorial":this.currentLevel,this.savedState[this.saveSlot]||(this.savedState[this.saveSlot]=[]),i=this.currentLevel.split("-")[1],s.userData.write("-"+s.options.version+"-last-level-played",i),this.currentLevel){case"level-1":this.chanceOfRain=0,this.showSeedDetails=!1,this.showSeedSelector=!1,this.available=["carrot"],this.speedMod=1.5,this.playTutorial("level-1-begin",!0),n={carrot:1,reward:25},platypus.game.app.music="bg-tut",platypus.game.app.musicInstance.volume=.5;break;case"level-2":this.showSeedDetails=!1,this.showSeedSelector=!1,this.available=["carrot"],this.speedMod=1,this.playTutorial("tutorial-rocks",!0),this.calmMod=1,n={carrot:3,reward:100},platypus.game.app.music="bg-tut",platypus.game.app.musicInstance.volume=.5;break;case"level-3":this.speedMod=1,this.showSeedDetails=!0,this.available=["carrot","potato","pumpkin"],n={carrot:5,potato:2,pumpkin:1,reward:250},platypus.game.app.music="bg-tut",platypus.game.app.musicInstance.volume=.5;break;case"level-4":this.speedMod=1,this.showSeedDetails=!0,this.available=["carrot","potato","pumpkin"],this.playTutorial("weeds"),platypus.game.app.music="bg-level-4",platypus.game.app.musicInstance.volume=.66;break;case"level-5":this.speedMod=.5,this.playTutorial("mars"),this.showSeedDetails=!0,this.available=["carrot","potato","pumpkin","corn"],platypus.game.app.music="bg-level-5",platypus.game.app.musicInstance.volume=1;break;case"level-6":this.speedMod=.5,this.playTutorial("mercury"),this.showSeedDetails=!0,this.available=["carrot","potato","pumpkin","corn","lettuce","tomato"],platypus.game.app.music="bg-level-6",platypus.game.app.musicInstance.volume=.7}for(s.userData.read("-"+s.options.version+"-seed-packets",function(t){null!==t&&(this.available=t),this.owner.parent.layers[2].triggerEvent("init-harvest",[this.available,n,this.currentLevel])}.bind(this)),this.broadcastedExistence||(this.owner.triggerEvent("farming-manager-exists",this.owner),this.broadcastedExistence=!0),"level-5"===this.currentLevel&&(r="mars"),"level-6"===this.currentLevel&&(r="mercury"),l=0;l<3;l++)this.owner.addEntity({id:"top",components:[{type:"RenderSprite",spriteSheet:"groundTops",animationMap:{default:r}}],properties:{x:1024*l,y:1024,z:5e3}});if("earth"===r){switch(this.currentLevel){case"level-1":o="ball";break;case"level-2":o="wheels";break;case"level-3":o="cone";break;case"level-4":o="ball"}for(this.owner.addEntity({id:o,components:[{type:"RenderSprite",spriteSheet:o}],properties:{x:this.getRandomInt(100,600),y:1050,z:1990,scaleX:1.5,scaleY:1.5}}),l=0;l<24;l++)this.owner.addEntity({id:"grass",components:[{type:"RenderSprite",spriteSheet:"grass"}],properties:{x:134*l,y:1024,z:2e3,scaleX:.5,scaleY:.5}})}if("mars"===r)for(this.owner.addEntity({id:"mg",components:[{type:"RenderSprite",spriteSheet:"mars_rock"}],properties:{x:this.getRandomInt(0,500),y:1025,z:1990,scaleX:2.5,scaleY:2.5}}),this.owner.addEntity({id:"mg",components:[{type:"RenderSprite",spriteSheet:"mars_rock"}],properties:{x:this.getRandomInt(2e3,3e3),y:1075,z:1990,scaleX:-2.5,scaleY:2.5}}),l=0;l<6;l++)this.owner.addEntity({id:"glass",components:[{type:"RenderSprite",spriteSheet:"glassMars"}],properties:{x:500*l*1.2,y:1024,z:2e3,scaleX:1.2,scaleY:1.2}});if("mercury"===r)for(this.owner.addEntity({id:"mg",components:[{type:"RenderSprite",spriteSheet:"mercury_rock"}],properties:{x:this.getRandomInt(2e3,3e3),y:1160,z:1990,scaleX:1.5,scaleY:1.5}}),this.owner.addEntity({id:"mg",components:[{type:"RenderSprite",spriteSheet:"mercury_rock"}],properties:{x:this.getRandomInt(0,500),y:1200,z:1990,scaleX:-1.5,scaleY:1.5}}),l=0;l<6;l++)this.owner.addEntity({id:"grass",components:[{type:"RenderSprite",spriteSheet:"glassMercury"}],properties:{x:500*l*1.2,y:1024,z:2e3,scaleX:1.2,scaleY:1.2}});for(this.savedState[this.saveSlot].length&&(this.firstSeedPlanted=!0,this.populateWorldFromSave(this.savedState[this.saveSlot])),this.needRecalc=!0,l=this.farmers.length;l--;)h.push(this.farmers[l].skill);s.levelId=r,s.levelInstanceId=(r||"unspecified")+"-"+Date.now().toString(16),s.getEnlearnData=function(e){var i="",n={mini_game_instance_id:t,level_id:s.levelId,level_instance_id:s.levelInstanceId};if(e)for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n},s.analyticsEmitter.startRound(s.levelId||"",this.available,h,s.getEnlearnData()),s.googleAnalytics.event(s.name,"Enter-"+this.currentLevel)},"seed-info":function(t){var e;"hole"===t.type&&(this.currentHole=t),this.currentSeedInfoIndex++,this.currentSeedInfoIndex===this.available.length&&(this.currentSeedInfoIndex=0),e=this.available[this.currentSeedInfoIndex],this.owner.parent.layers[1].addEntity({type:"seedInfo",properties:{scaleX:.5,scaleY:.5,opacity:0,x:0,y:50,z:1e4,seedID:e,needs:this.getPlantData(e)}})},"seed-info-prev":function(){var t;this.currentSeedInfoIndex--,this.currentSeedInfoIndex<0&&(this.currentSeedInfoIndex=this.available.length-1),t=this.available[this.currentSeedInfoIndex],this.owner.parent.layers[1].addEntity({type:"seedInfo",properties:{scaleX:.5,scaleY:.5,opacity:0,x:0,y:50,z:1e4,seedID:t,needs:this.getPlantData(t)}})},"camera-update":function(t){this.camera.set(t.viewport)},"bee-removed":function(){this.bees--},"butterfly-removed":function(){this.butterflies--},"aphid-removed":function(){this.aphids--},tick:function(t){var e=t.delta;platypus.fxModifier=e>15?15/e:1},"logic-tick":function(t){var e=platypus.game.app,n=null,r=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1,o=null,h=null,l=!1,c=0,p=0,d=0,u=0,g=0,m=0,y=null,f=0;if(this.entities=t.entities,this.consistentTicker+=1,!(this.consistentTicker%3)){if(this.consistentTicker=0,this.recalcTimer++,this.recalcTimer%200==0&&(this.needRecalc=!0),this.spacingC++,this.spacingC%200==0)for(u=0;u<this.farmers.length;u++)for(y=(h=this.farmers[u]).skill,f=h.x,d=0;d<this.farmers.length;d++)m=this.farmers[d].x,u!==d&&Math.abs(f-m)<100&&this.owner.triggerEvent("force-wander",y);if(this.levelCompleteTimer>0&&(this.levelCompleteTimer--,0===this.levelCompleteTimer&&(e.userData.read("-"+e.options.version+"-levels-complete",function(t){var i=t||[];i.includes(this.currentLevel)||i.push(this.currentLevel),e.userData.write("-"+e.options.version+"-levels-complete",i)}.bind(this)),e.googleAnalytics.event(e.name,"Complete-"+this.currentLevel,"LevelTime",Date.now()-this.roundTime>>0),platypus.game.loadScene("scene-level",{level:this.nextLevel}))),this.needRecalc&&(this.recalculateSpace(),this.needRecalc=!1),this.floweringC++,this.floweringC%100==0)for(this.numFlowering=0,g=0;g<this.entities.length;g++)(o=this.entities[g]).flowers&&!o.pollinated&&o.activeStageNum>1&&this.numFlowering++;for(this.numFlowering>0&&this.bees<this.numFlowering+2&&Math.random()<.001*(this.numFlowering+1)&&(this.numFlowering>0&&this.playTutorial("tutorial-bee"),this.owner.addEntity({type:"bee",properties:{x:1===r?this.camera.left-50:this.camera.right+50,y:this.getRandomInt(this.camera.top+50,850),z:1e4,dir:r}}),this.owner.parent.layers[0].triggerEvent("beeBuzz"),this.bees++,4===this.bees&&platypus.badger.increment("attract-bees")),this.initC++,this.aphidBuddyC>0&&(this.aphidBuddyC--,0===this.aphidBuddyC&&(l=!0)),(l||"level-1"!==this.currentLevel&&"level-2"!==this.currentLevel&&"level-3"!==this.currentLevel&&this.aphids<2&&Math.random()<3e-4&&this.initC>1e3)&&(this.playTutorial("tutorial-aphid"),this.owner.addEntity({type:"aphid",properties:{x:1===a?Math.max(50,this.camera.left-50):Math.min(2950,this.camera.right+50),y:1040,z:1e4,dir:a}}),this.aphids++,Math.round()<this.aphidBuddyChance?(this.aphidBuddyC=50,this.aphidBuddyChance*=.5):this.aphidBuddyChance=.5),this.raining?(this.owner.triggerEvent("rain",this.speedMod),this.rainDuration--,0===this.rainDuration&&(this.raining=!1,"level-1"===this.currentLevel?this.startSun():this.startCalm(),i.get(this.rainBG).to({opacity:0},2e3,s.sineInOut)),Math.random()<.25*platypus.fxModifier&&this.rain.push(this.owner.addEntity({id:"drop",components:[{type:"RenderSprite",spriteSheet:"plantFeedback",animationMap:{default:"water"}}],properties:{x:this.getRandomInt(0,3e3),y:0,z:1e4,scaleX:.6,scaleY:.6,opacity:.5}}))):"level-5"===this.currentLevel?this.owner.triggerEvent("sun",this.speedMod,.5):"level-6"===this.currentLevel?this.owner.triggerEvent("sun",this.speedMod,2):this.owner.triggerEvent("sun",this.speedMod,1),c=this.rain.length;c--;)(n=this.rain[c]).y+=25,n.y>1050&&(this.owner.removeEntity(n),this.rain.splice(c,1),this.owner.addEntity({type:"fx",properties:{x:n.x,y:n.y-42,z:6e3,sy:.15,sx:.75,fxType:"water",intensity:.4}}));if(this.sunning&&(Math.random()<this.chanceOfSunFloater*("level-6"===this.currentLevel?2:1)&&(this.addSunFloater(),this.sunFloatersNeeded--),this.sunDuration--,0===this.sunDuration)){if(this.sunFloatersNeeded>0)for(p=0;p<this.sunFloatersNeeded;p++)this.addSunFloater();this.sunning=!1,this.startCalm(),i.removeTweens(this.sunBG),i.get(this.sunBG).to({opacity:0},2e3,s.sineInOut)}this.rainTimer>0&&(this.rainTimer--,0===this.rainTimer&&this.startRain()),this.calming&&(this.calmDuration--,0===this.calmDuration&&(this.calming=!1,"level-5"===this.currentLevel||"level-6"===this.currentLevel?this.startSun():"rain"===this.next&&"level-2"!==this.currentLevel?this.startRain():this.startSun()))}},"rock-exists":function(t){},"rock-removed":function(t){},"seed-planted":function(t,e){this.seedPlanted(t,e)},"level-complete":function(){var t=platypus.game.app;"level-1"===this.currentLevel||"level-2"===this.currentLevel||"level-3"===this.currentLevel?this.levelCompleteTimer="level-1"===this.currentLevel||"level-2"===this.currentLevel?450:180:t.userData.read("-"+t.options.version+"-levels-complete",function(e){var i=e||[];i.includes(this.currentLevel)||i.push(this.currentLevel),t.userData.write("-"+t.options.version+"-levels-complete",i)}.bind(this))},"go-to-next-level":function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"Complete-"+this.currentLevel,"LevelTime",Date.now()-this.roundTime>>0),platypus.game.loadScene("scene-level",{level:this.nextLevel})},"cancel-global-click":function(){this.cancelGlobalClick=!0},"save-plant-state-2":function(t){this.ammendSave(t)}},methods:{populateWorldFromSave:function(){var t=this.savedState[this.saveSlot]||[],e=t.length,i=null,s=null;for(platypus.debug.log("Recreate this.",this.savedState),this.doNotSaveYet=!0;e--;)switch((i=t[e]).type){case"hole":this.holeDug(i.x),s=this.owner.addEntity({type:"soil",properties:{x:i.x,y:1030,z:5e3,scaleX:1.5,scaleY:1.5}}),this.owner.addEntity({type:"hole",properties:{x:i.x,y:1020,z:5001,soil:s,supressBigRocks:"level-1"===this.currentLevel,manager:this}}).complete();break;case"seed":this.seedPlanted(i.x,!1,i.id),s=this.owner.addEntity({type:"soil",properties:{x:i.x,y:1040,z:5e3,scaleX:1.5,scaleY:1.5}}),this.owner.addEntity({type:"seed",properties:{x:i.x,y:1040,z:5e3,seedType:i.id,plantData:this.getPlantData(i.id),speedMod:this.speedMod,soil:s,manager:this}});break;case"plant":if(null===i.health){t.splice(e,1);break}this.seedPlanted(i.x,!1,i.id),s=this.owner.addEntity({type:"soil",properties:{x:i.x,y:1030,z:5e3,scaleX:1.5,scaleY:1.5}}),this.owner.addEntity({type:"plant-"+i.id,properties:{x:i.x,y:1030,z:5003,speedMod:this.speedMod,soil:s,score:this.plantData[i.id].score,manager:this,savedData:i}});break;case"weedRemove":this.owner.triggerEvent("remove-weed",i.x)}this.doNotSaveYet=!1},click:function(t){var e,i;this.cancelGlobalClick?this.cancelGlobalClick=!1:(e=platypus.Vector.setUp(t.data.global.x,t.data.global.y),(i=this.owner.windowToWorld(e,!0)).y>980&&i.y<1300&&this.canDig(i.x,!0)&&(this.owner.addEntity({type:"action-select",properties:{targetEntity:null,x:i.x,y:1020,options:[{id:"shovel",callback:function(){this.owner.triggerEvent("dig-request",i.x)}.bind(this)}]}}),this.playTutorial("level-1-action-select")),t.stopPropagation())},addSunFloater:function(){var t="level-6"===this.currentLevel&&Math.random()<.15?"mercury-sun":"sun";"sun"===t?(this.owner.addEntity({type:"floater-"+t,properties:{x:1===this.sunDir?this.camera.left-50:this.camera.right+50,dir:this.sunDir,y:this.getRandomInt(this.camera.top+50,750),z:1001}}),"level-1"===this.currentLevel&&"sun"===t&&this.playTutorial("tutorial-sun")):("level-6"===this.currentLevel&&"mercury-sun"===t&&this.playTutorial("mercury-sun"),this.owner.addEntity({type:"floater-"+t,properties:{x:this.getRandomInt(this.camera.left+100,this.camera.right-100),y:this.camera.top-50,z:1001,fall:!0}}))},playTutorial:function(t,e){!e&&r[t]||(r[t]=!0,this.owner.parent.layers[0].triggerEvent(t))},destroy:function(){this.farmers=null,this.interaction.off("pointerdown",this.boundClick)},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},startSun:function(){this.sunFloatersNeeded=6,this.next="rain",this.sunning=!0,this.sunDir=Math.random()<.5?-1:1,this.sunDuration=this.getRandomInt(350,700),"level-5"===this.currentLevel&&(this.sunDuration=Math.round(.66*this.sunDuration),this.sunFloatersNeeded=Math.round(.66*this.sunFloatersNeeded)),i.get(this.sunBG).to({opacity:.5},2e3,s.sineInOut).call(this.sunTweenDown.bind(this))},sunTweenDown:function(){this.sunBG&&!this.sunBG.destroyed&&i.get(this.sunBG).to({opacity:.25},2e3,s.sineInOut).call(this.sunTweenUp.bind(this))},sunTweenUp:function(){this.sunBG&&!this.sunBG.destroyed&&i.get(this.sunBG).to({opacity:.5},2e3,s.sineInOut).call(this.sunTweenDown.bind(this))},startRain:function(){this.next="sun",this.raining=!0,this.rainDuration=this.firstRain&&"level-1"===this.currentLevel?600:this.getRandomInt(250,500),this.firstRain=!1,i.get(this.rainBG).to({opacity:.5},2e3,s.sineInOut),this.owner.parent.layers[0].triggerEvent("rainStart")},startCalm:function(){this.calming=!0,this.calmDuration=this.getRandomInt(200,375)*this.calmMod}},publicMethods:{addDigRequest:function(t){var e=this.owner.addEntity({id:"digReq",components:[{type:"RenderSprite",spriteSheet:"farmer",animationMap:{default:"shovel"}}],properties:{scaleX:.5,scaleY:.5,opacity:.5,x:Math.round(t),y:1030,z:1e4}});this.digMarkers.push(e)},removeDigRequest:function(t){var e=0,i=null;for(e=0;e<this.digMarkers.length;e++)if((i=this.digMarkers[e]).x===Math.round(t))return i.removeSelf(),void this.digMarkers.splice(e,1)},removeAllDigRequests:function(){var t=0;for(t=0;t<this.digMarkers.length;t++)this.digMarkers[t].removeSelf();this.digMarkers.length=0},registerFarmer:function(t){this.farmers.push(t)},canDig:function(t,e){var i=null,s=0,n=0;for(s=0;s<this.holes.length;s++)if(i=this.holes[s],Math.abs(i-t)<60)return!1;if(e)for(n=0;n<this.digMarkers.length;n++)if(i=this.digMarkers[n].x,Math.abs(i-t)<60)return!1;return!0},holeDug:function(t){this.holes.push(Math.round(t))},ammendSave:function(t){var e="",i=this.savedState[this.saveSlot],s=i.length,n=null;if(!this.doNotSaveYet){for(t.x=Math.round(t.x);s--;)if(n=i[s]){if(n.x===t.x){for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);break}}else i.splice(s,1);this.flush()}},save:function(t){this.doNotSaveYet||(t.x=Math.round(t.x),this.unsave(t),this.savedState[this.saveSlot].push(t),this.flush())},unsave:function(t){var e=this.savedState[this.saveSlot],i=e.length,s=null;if(!this.doNotSaveYet){for(t.x=Math.round(t.x);i--;)(s=e[i])&&s.x!==t.x||e.splice(i,1);this.flush()}},flush:function(){var t=platypus.game.app;t.userData.write("-"+t.options.version+"-saved-states",this.savedState),this.owner.triggerEvent("photo-ready",this.currentLevel)},seedPlanted:function(t,e,i){this.seeds.push(t),this.needRecalc=!0,e?this.holeDug(Math.round(t)):(this.save({type:"seed",id:i,x:t}),this.firstSeedPlanted?this.startCalm():(this.firstSeedPlanted=!0,"level-1"===this.currentLevel?this.startRain():"level-2"===this.currentLevel?this.startCalm():Math.random()<.5||"level-5"===this.currentLevel||"level-6"===this.currentLevel?this.startSun():this.startRain()))},seedRemoved:function(t){var e=this.seeds.indexOf(t);e>-1&&this.seeds.splice(e,1),this.holeRemoved(t),this.needRecalc=!0,this.unsave({type:"seed",x:t})},recalculateSpace:function(){var t=0,e=0,i=0,s=0,n=0,r=0,a=0;if(this.seeds.sort(function(t,e){return t-e}),1===this.seeds.length)this.owner.triggerEvent("space-recalculated",this.seeds[0],100);else if(2===this.seeds.length)e=Math.abs(this.seeds[0]-this.seeds[1])/40,this.owner.triggerEvent("space-recalculated",this.seeds[0],e),this.owner.triggerEvent("space-recalculated",this.seeds[1],e);else for(t=0;t<this.seeds.length;t++)n=this.seeds[t],0===t?this.owner.triggerEvent("space-recalculated",n,Math.abs(n-this.seeds[1])/40):t===this.seeds.length-1?this.owner.triggerEvent("space-recalculated",n,Math.abs(this.seeds[t-1]-n)/40):(r=this.seeds[t+1],a=this.seeds[t-1],i=Math.abs(n-a)/40,s=Math.abs(n-r)/40,this.owner.triggerEvent("space-recalculated",n,Math.min(i,s)))},holeRemoved:function(t){var e=this.holes.indexOf(t);e>-1&&this.holes.splice(e,1)},getPlantData:function(t){return this.plantData[t]},getAllPlantData:function(){return this.plantData},getLevel:function(){return this.currentLevel}},getAssetList:function(){for(var t=null,e=["seedInfo","bee","aphid","soil","hole","seed","action-select","floater-sun","fx"],i=e.length,s=Array.setUp("assets/images/groundTops.png","assets/images/plants-0.png","assets/images/plants-1.png","assets/images/plantFeedback.png","assets/images/farmer.png");i--;)t=n.getAssetList({type:e[i]}),s.union(t),t.recycle();return s},getLateAssetList:function(t,e,i,s){var n=null;if(s&&s.level)switch("string"!=typeof(n=s.level)&&(n=a(n.properties,"levelId")),n){case"level-1":case"level-2":case"level-3":case"level-4":return Array.setUp("assets/images/ball.png","assets/images/wheels.png","assets/images/cone.png","assets/images/grass.png");case"level-5":return Array.setUp("assets/images/mars_rock.png","assets/images/glassMars.png");case"level-6":return Array.setUp("assets/images/mercury_rock.png","assets/images/glassMercury.png")}return Array.setUp()}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"FindMovables",properties:{useNodes:!1},initialize:function(){this.activeEntities=null},events:{"handle-logic":function(t){this.activeEntities=t.entities},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&(t.invalid=!0)},pointerdown:function(){for(var e=this.activeEntities,i=e.length,s=null;i--;)(s=e[i]).movable&&("number"!=typeof s.opacity&&(s.opacity=1),t.get(s).to({opacity:.01},250).to({opacity:1},250).to({opacity:.01},250).to({opacity:1},250).to({opacity:.01},250).to({opacity:1},250))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off")},"restore-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-on")}}})}(),function(){"use strict";platypus.createComponentClass({id:"Flipper",properties:{leftHair:"",rightHair:"",hairSlot:"",leftBadge:"",rightBadge:"",badgeSlot:""},initialize:function(){this.direction=0,this.spine=null},events:{load:function(){for(var t=this.owner.components,e=t.length;e--;)if(t[e].spine){this.spine=t[e].spine;break}},"handle-render":function(){this.spine&&this.direction!==this.owner.scaleX&&(this.direction=this.owner.scaleX,this.direction>0?(this.hairSlot&&this.spine.skeleton.setAttachment(this.hairSlot,this.rightHair),this.badgeSlot&&this.spine.skeleton.setAttachment(this.badgeSlot,this.rightBadge)):(this.hairSlot&&this.spine.skeleton.setAttachment(this.hairSlot,this.leftHair),this.badgeSlot&&this.spine.skeleton.setAttachment(this.badgeSlot,this.leftBadge)))}}})}(),function(){"use strict";platypus.createComponentClass({id:"FloaterLogic",properties:{dir:0,fall:!1},publicProperties:{},initialize:function(){this.oscC=0,this.oscI=.01*Math.random()+.005,this.oscF=.4*Math.random(),this.dropSpeed=.6*Math.random()+.3,this.remove=!1,this.shade=null},events:{adopted:function(){this.fall?this.owner.z=2e4:this.owner&&!this.owner.destroyed&&(this.shade=this.owner.parent.addEntity({id:"floater-sun",components:[{type:"RenderSprite",spriteSheet:"floaters",animationMap:{default:"shade"}}],properties:{opacity:.75,scaleX:.8,scaleY:.8,alwaysOn:!0,z:1e3}}))},clicked:function(){var t,e,i=4*platypus.fxModifier>>0,s=8*platypus.fxModifier>>0,n=16*platypus.fxModifier>>0;this.owner.parent.triggerEvent("sun-clicked"),this.remove=!0,this.owner.parent.parent.layers[0].triggerEvent("healthBoost");var r=0;if(s<3)s+=i;else for(e=2*Math.PI/i,t=0;t<i;t++)this.addSunParticle(.25,r),r+=e;if(n<3)n+=s;else for(r=0,e=2*Math.PI/s,t=0;t<s;t++)this.addSunParticle(.5,r),r+=e;for(r=0,e=2*Math.PI/n,t=0;t<n;t++)this.addSunParticle(.75,r),r+=e},"handle-logic":function(){if(this.fall)return this.owner.opacity=Math.abs(Math.cos(4*this.oscC)),this.owner.y+=.75*this.dropSpeed,this.oscC+=this.oscI,this.owner.x+=Math.cos(this.oscC)*this.oscF,this.owner.y>1e3&&(this.owner.parent.triggerEvent("mercury-sun-damage"),this.remove=!0,this.owner.parent.parent.layers[0].triggerEvent("plantDamage")),void(this.remove&&(this.remove=!1,this.owner.removeSelf()));this.shade.x=this.owner.x,this.shade.y=this.owner.y,this.oscC+=this.oscI,this.owner.y+=Math.cos(this.oscC)*this.oscF,this.owner.x+=1.75*this.dropSpeed*this.dir,(1===this.dir&&this.owner.x>3e3||-1===this.dir&&this.owner.x<0||this.remove)&&(this.remove=!1,this.shade.removeSelf(),this.shade=null,this.owner.removeSelf())}},methods:{addSunParticle:function(t,e){this.owner.parent.addEntity({id:"sun-particle",components:[{type:"RenderSprite",spriteSheet:"fx2",animationMap:{default:"sun"}},{type:"ParticleLogic",speed:t,duration:750,angle:e}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+1,scaleX:.33,scaleY:.33,opacity:.4}})}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"FlyerLogic",properties:{dir:1,id:""},publicProperties:{},initialize:function(){this.oscC=0,this.oscI=.02*Math.random()+.01,this.oscF=.3*Math.random(),this.remove=!1,this.camera=t.setUp(),this.targetPosX=0,this.targetPosY=0,this.entities=null,this.targetedMove=!1,this.target=null,this.pausingC=0},events:{adopted:function(){this.targetPosX=this.owner.x,this.targetPosY=this.owner.y},clicked:function(){var t=[];for(var e in this.entities){var i=this.entities[e];"bee"==this.id?i.flowers&&!i.pollinated&&i.activeStageNum>1&&t.push(i):i.isDecoFlower&&!i.pollinated&&t.push(i)}this.gotoNearestCandidate(t)},"handle-logic":function(t){this.entities=t.entities;var e=75;this.pausingC>0?this.pausingC--:this.targetedMove?(e=150,Math.abs(this.owner.x-this.targetPosX)<10&&Math.abs(this.owner.y-this.targetPosY)<10&&(this.reachedTargetDestination(),this.targetedMove=!1,this.pausingC=200)):(Math.random()<.001&&(this.dir*=-1),this.targetPosX+=this.dir*Math.random()*2,this.targetPosY+=6*Math.random()-3,this.targetPosY<this.camera.top&&(this.targetPosY+=50),this.targetPosY>900&&(this.targetPosY-=50)),this.owner.x+=(this.targetPosX-this.owner.x)/e,this.owner.y+=(this.targetPosY-this.owner.y)/e,this.oscC+=this.oscI,this.owner.y+=Math.sin(this.oscC)*this.oscF,this.owner.scaleX=.55*this.dir,(this.owner.x>this.camera.right+100||this.owner.x<this.camera.left-100)&&(this.remove=!0),this.remove&&("bee"==this.id?this.owner.parent.triggerEvent("bee-removed"):this.owner.parent.triggerEvent("butterfly-removed"),this.owner.removeSelf())},"camera-update":function(t){this.camera.set(t.viewport)}},methods:{destroy:function(){this.entities=null,this.target=null},gotoNearestCandidate:function(t){if(0!==t.length){var e=1e9;for(var i in t){var s=t[i],n=(s.x-this.owner.x)*(s.x-this.owner.x);n<e&&(e=n,this.target=s)}this.targetPosX=this.target.x,this.targetPosY=this.target.y-150,this.dir=this.target.x>this.owner.x?1:-1,this.targetedMove=!0}},reachedTargetDestination:function(){this.target.triggerEvent("pollinated")}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"FXLogic",properties:{intensity:1,sy:1,sx:1},publicProperties:{fxType:"",complete:!1},initialize:function(){this.opacityI=0},events:{adopted:function(){this.complete=!1,this.owner.opacity=this.intensity+.25,this.opacityI=.025*this.intensity,this.owner.state.set(this.fxType,!0),this.owner.scaleX=.66*this.sx,this.owner.scaleY=.66*this.sy},"handle-logic":function(){this.owner.scaleX*=1.01,this.owner.scaleY*=1.01,this.owner.opacity-=this.opacityI,this.owner.opacity<0&&(this.complete=!0,this.owner.removeSelf())}}})}(),function(){"use strict";var t=include("platypus.Entity"),e=include("createjs.Tween"),i=include("createjs.Ease"),s={};platypus.createComponentClass({id:"Harvest",initialize:function(t,e){var i=platypus.game.app;return this.nums=[],this.score=0,this.subgoals={},this.levelID="",this.savedNums={},this.milestones=[],this.nextLevelC=0,this.scoreID="",this.storedScores=null,i.userData.read("-"+i.options.version+"-scores",function(t){this.storedScores=t||{},e()}.bind(this)),!0},events:{"there-is-a-badge-to-award":function(){var t=platypus.badger.award();t&&t.length&&this.owner.parent.triggerEvent("earned-badge",t)},"init-harvest":function(t){var e=platypus.game.app,i=t[0],s=t[2];switch(this.levelID=s,this.milestones=[],s){case"level-1":this.milestones=[{goal:10,rewardText:"Watering Can Unlocked",id:"water",tutorial:!0}];break;case"level-2":this.milestones=[{goal:50,rewardText:"Potatoes & Pumpkins Unlocked",id:"potatoesPumpkins",tutorial:!0,milestone:"milestones-1"}];break;case"level-3":this.milestones=[{goal:125,rewardText:"Compost Unlocked",id:"compost",tutorial:!0,milestone:"milestones-2"}];break;case"level-4":this.milestones=[{goal:150,rewardText:"Corn Unlocked",id:"corn",milestone:"milestones-3"},{goal:325,rewardText:"Mars Unlocked",id:"mars",milestone:"milestones-4"}];break;case"level-5":this.milestones=[{goal:150,rewardText:"Lettuce Unlocked",id:"lettuce",milestone:"milestones-5"},{goal:350,rewardText:"Tomatoes Unlocked",id:"tomato",milestone:"milestones-6"},{goal:600,rewardText:"Mercury Unlocked",id:"mercury",milestone:"milestones-7"}];break;case"level-6":this.milestones=[{goal:150,rewardText:"Radishes Unlocked",id:"radish",milestone:"milestones-8"},{goal:300,rewardText:"Beets Unlocked",id:"beet",milestone:"milestones-9"},{goal:500,rewardText:"Watermelons Unlocked",id:"watermelon",milestone:"milestones-10"},{goal:800,rewardText:"Strawberries Unlocked",id:"strawberry",milestone:"milestones-11"}]}for(e.userData.read("-"+e.options.version+"-harvest",function(t){var e=0,s="";for(null===t&&(t={}),this.savedNums=t,e=0;e<i.length;e++)s=i[e],this.addNum(s,e)}.bind(this)),this.scoreID="level-1"===s||"level-2"===s||"level-3"===s?"score-for-tutorial":"score-for-"+s,platypus.score=this.score=this.storedScores[this.scoreID]||0;this.milestones[0].goal<this.score&&(this.checkMilestones(!0),0!==this.milestones.length););this.owner.triggerEvent("set-goal-text",""),this.addToScore(0)},"add-to-harvest":function(t){var s,n=platypus.game.app,r=this.nums.indexOf(t),a=this.nums[r+1],o=null;-1!==r?(a++,this.nums[r+1]=a,this.savedNums[t]=a,n.userData.write("-"+n.options.version+"-harvest",this.savedNums),o=this.nums[r+2],s=a>99?"num-100":"num-"+a,o.triggerEvent(s),e.get(o).to({scaleX:1.33,scaleY:1.33},150,i.sineOut).to({scaleX:.66,scaleY:.66},150,i.sineIn),platypus.badger.increment("grow-"+t)):platypus.debug.warn("Harvest: Tried to harvest a "+t+", but there is no counter for it.")},"add-to-score":function(t){var e=platypus.game.app;this.addToScore(t),this.storedScores[this.scoreID]=this.score,e.userData.write("-"+e.options.version+"-scores",this.storedScores)},"handle-logic":function(){this.nextLevelC>0&&(this.nextLevelC--,0===this.nextLevelC&&this.owner.parent.parent.layers[0].triggerEvent("level-complete"))}},methods:{addNum:function(t,e){var i,s=this.owner.parent.addEntity({id:"plant-item",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:t}},{type:"ResizeSnapper",top:44+100*Math.floor(e/15),left:250+e%15*75}],properties:{scaleX:.65,scaleY:.65,z:this.owner.z,opacity:1}}),n=this.owner.parent.addEntity({id:"num"+e,components:[{type:"RenderSprite",spriteSheet:"nums",stateBased:!1,eventBased:!0},{type:"ResizeSnapper",top:64+100*Math.floor(e/15),left:277+e%15*75}],properties:{z:this.owner.z+1,scaleX:.7,scaleY:.7,opacity:1}}),r=0;void 0!==this.savedNums[t]&&(r=this.savedNums[t]),i=r>99?"num-100":"num-"+r,n.triggerEvent(i),this.nums.push(s),this.nums.push(t),this.nums.push(r),this.nums.push(n)},addToScore:function(t){var e;this.score+=t,platypus.score=this.score,this.checkMilestones(),e=this.getNextMilestone(),this.owner.triggerEvent("set-score-text",this.score.toString()),this.owner.triggerEvent("set-reward-text",e||""),this.owner.triggerEvent("set-reward-text-2",e?"Next Reward:":"")},destroy:function(){this.nums=null},getNextMilestone:function(){return 0===this.milestones.length?null:this.milestones[0].goal},checkMilestones:function(t){var e=platypus.game.app,i="",n=platypus.labRetriever,r=this.milestones[0];if(0!==this.milestones.length&&(this.score>=r.goal&&0===this.nextLevelC||t))switch(this.milestones.shift(),t||(e.googleAnalytics.event(e.name,"MilestoneReached-"+r.id),this.owner.parent.parent.layers[2].addEntity({type:"instructions",properties:{customText:"Milestone reached! \n"+r.rewardText,x:0,y:0,z:2e4}}),void 0!==r.milestone&&(i=r.milestone,s[i]||(s[i]=!0,this.owner.parent.parent.layers[0].triggerEvent(i)))),r.id){case"water":case"potatoesPumpkins":case"compost":t||(this.nextLevelC=300),t||platypus.badger.increment("create-earth-garden");break;case"mars":t||(this.nextLevelC=1),t||platypus.badger.increment("create-mars-greenhouse");break;case"mercury":t||platypus.badger.increment("create-mercury-greenhouse"),t||(this.nextLevelC=1);break;case"corn":case"lettuce":case"tomato":case"radish":case"beet":case"watermelon":case"strawberry":n.has(r.id)||n.unlock(r.id),-1===this.nums.indexOf(r.id)&&(this.owner.parent.parent.layers[0].triggerEvent("add-to-available",r.id),this.addNum(r.id,this.nums.length/4))}}},getAssetList:function(){for(var e=null,i=["instructions"],s=i.length,n=Array.setUp("assets/images/seedSelect.png","assets/images/nums.png");s--;)e=t.getAssetList({type:i[s]}),n.union(e),e.recycle();return n}})}(),function(){"use strict";var t=include("createjs.Tween"),e=!1;platypus.createComponentClass({id:"HealthLogic",properties:{waterNeed:0,waterLvl:0,sunNeed:0,sunLvl:0,spaceNeed:0,spaceLvl:100,health:.5,speedMod:1},publicProperties:{},initialize:function(){this.c=0,this.isSeed=!1,this.complete=!1,this.sproutMeterBG=null,this.sproutMeterFG=null,this.report=[],this.sproutTimer=null,this.reportingOrder=["water","sun","space"],this.reportingI=-1,this.currentlyReporting="water",this.reportC=0,this.reportMax=540,this.waterStatus="",this.sunStatus="",this.spaceStatus="",this.fx=null,this.scale=0},events:{"handle-logic":function(){var i=this.waterNeed-this.waterLvl,s=Math.max(0,this.sunNeed-this.sunLvl)*(this.scale+.25),n=2*Math.max(0,this.spaceNeed*(this.scale+.66)-this.spaceLvl),r=0,a=null,o=null,h=null,l=0,c=0,p=0,d=0;i<-4&&(i*=-1),r=1e-5*(i+s+n)-5e-5,"canHarvest"===this.owner.flag&&r>0&&(r*=.15),this.health-=r,this.health=this.clamp(this.health,-1,1),this.c++,this.c%100==0&&(h=this.translate(this.health,-1,1,0,1,!0),this.owner.triggerEvent("desaturate-parts",h),this.owner.triggerEvent("adjust-max-size",h)),this.c%500==0&&this.owner.triggerEvent("save-plant-state",{health:this.health,spaceLvl:this.spaceLvl,waterLvl:this.waterLvl,sunLvl:this.sunLvl,spaceNeed:this.spaceNeed,waterNeed:this.waterNeed,sunNeed:this.sunNeed,speedMod:this.speedMod}),this.reportC++,this.reportC===this.reportMax-180&&(this.report.length>0&&(a=this.report[0],t.get(a).to({scaleX:.01,scaleY:.01},250,createjs.Ease.sineOut).call(a.removeSelf.bind(a)),o=this.report[1],t.get(o).to({scaleX:.01,scaleY:.01},250,createjs.Ease.sineOut).call(o.removeSelf.bind(o))),this.report=[]),this.reportC>=this.reportMax&&"canHarvest"!==this.owner.flag&&(this.reportingI++,this.reportC=0,this.reportingI>2&&(this.reportingI=0),this.currentlyReporting=this.reportingOrder[this.reportingI],"space"===this.currentlyReporting&&"sad"===this.updateSpaceStatus()&&(this.report.push(this.addFeedback("statsBGS",0,-25,1,.75,.75,1)),this.report.push(this.addFeedback(this.currentlyReporting,0,-95,2,1,1,1)),this.owner.flag="needsSpace",e||(e=!0,this.owner.parent.triggerEvent("need-space")))),this.isSeed&&!this.complete&&this.sproutTimer&&(l=this.sunNeed+this.waterNeed,c=Math.min(this.sunLvl,this.sunNeed),p=Math.min(this.waterLvl,this.waterNeed),d=this.clamp((c+p)/l,.01,1),this.sproutTimer.updateVal(d),this.owner.triggerEvent("sprout-percent",d),d>=1&&(this.complete=!0,this.sproutTimer.remove(),this.owner.triggerEvent("sprout-seed"))),this.fx&&this.fx.complete&&(this.fx=null)},compostApplied:function(){this.health+=.5,this.showFX("compost"),this.owner.compostApplied=!0},pollinated:function(){this.health+=.25,this.owner.pollinated=!0},watered:function(){this.waterLvl=this.waterNeed+1,this.showFX("water"),this.owner.triggerEvent("water-level-adjusted",this.waterLvl,!0),this.owner.watered=!0},rain:function(t){this.showFX("water",.25),this.waterLvl+=.005*t,this.waterLvl>this.waterNeed+1&&(this.waterLvl=this.waterNeed+1),this.owner.triggerEvent("water-level-adjusted",this.waterLvl),this.owner.watered=!0},sun:function(t,e){this.waterLvl-=5e-4*e,2===e&&(this.waterLvl-=66e-5),this.owner.triggerEvent("water-level-adjusted",this.waterLvl),this.sunLvl+=.005*t*e},"sun-clicked":function(){this.sunLvl+=1,this.sunLvl<this.sunNeed+.5&&this.showFX("sun")},dark:function(){this.sunLvl-=.002},"health-data":function(t,e,i,s){this.waterNeed=t,this.sunNeed=e,this.spaceNeed=i,this.isSeed=s,this.isSeed&&(this.sproutTimer=this.owner.addComponent(new platypus.components.Timer(this.owner,{xo:-60,yo:55,manual:!0})))},"health-transfer-init":function(t,e){t.addComponent(new platypus.components.HealthLogic(t,{sunLvl:0,sunNeed:this.sunNeed,waterLvl:this.waterLvl/2,waterNeed:this.waterNeed,spaceLvl:this.spaceLvl,spaceNeed:this.spaceNeed,health:this.health,speedMod:e}))},"space-recalc-2":function(t){var e=t[0],i=t[1];this.scale=t[2],this.isSeed?this.spaceLvl=100:Math.round(this.owner.x)===e&&(this.spaceLvl=i)},"seed-removed":function(t){Math.round(this.owner.x)===t&&(this.sproutTimer&&this.sproutTimer.remove(),this.sproutTimer=null)},"mercury-sun-damage":function(){this.health-=.1},"aphid-damage":function(){this.health-=.2,this.owner.parent.parent.layers[0].triggerEvent("plantDamage")}},methods:{updateWaterStatus:function(){var t=this.waterLvl/this.waterNeed;return this.waterStatus=t<.33?"sad":t>=.33&&t<.66?"neutral":"happy",this.waterStatus},updateSunStatus:function(){var t=this.sunLvl/this.sunNeed;return this.sunStatus=t<.33?"sad":t>=.33&&t<.66?"neutral":"happy",this.sunStatus},updateSpaceStatus:function(){var t=this.spaceLvl/(this.spaceNeed*(this.scale+.5));return this.spaceStatus=t<.66?"sad":t>=.66&&t<1?"neutral":"happy",this.spaceStatus},addFeedback:function(e,i,s,n,r,a,o){var h=this.owner.parent.addEntity({id:"spr",components:[{type:"RenderSprite",spriteSheet:"plantFeedback",animationMap:{default:e}}],properties:{x:this.owner.x+i,y:this.owner.y+s,z:this.owner.z+n,scaleX:.01,scaleY:.01,opacity:o}});return t.get(h).to({scaleX:r,scaleY:a},250,createjs.Ease.backOut),h},destroy:function(){var t=0;for(t=0;t<this.report.length;t++)this.report[t].removeSelf();this.report.length=0},showFX:function(t,e){this.fx||(void 0===e&&(e=.5),this.fx=this.owner.parent.addEntity({type:"fx",properties:{x:this.owner.x,y:this.owner.y,z:6e3,fxType:t,intensity:e}}))},clamp:function(t,e,i){return t<e?e:t>i?i:t},translate:function(t,e,i,s,n,r){var a=(t-e)/(i-e)*(n-s)+s;return r?s<n?this.clamp(a,s,n):this.clamp(a,n,s):a}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Entity"),e=!1;platypus.createComponentClass({id:"HoleLogic",properties:{soil:null,supressBigRocks:!1,manager:null},publicProperties:{holeID:0,ready:!1},initialize:function(){this.holeID=this.getRandomInt(1,1e6),this.stage=0,this.type="earth","level-5"==this.manager.getLevel()&&(this.type="mars"),"level-6"==this.manager.getLevel()&&(this.type="mercury")},events:{"hole-click":function(){var t=null;if(this.ready){this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),t=[],"level-3"!==this.manager.getLevel()||e||(e=!0,this.owner.parent.parent.layers[0].triggerEvent("tutorial-seed-info-1"));for(var i=0;i<this.manager.available.length;i++){var s=this.manager.available[i];t.push({id:"seed-"+s,callback:this.getFunc(s)})}this.owner.parent.addEntity({type:"action-select",properties:{targetEntity:this.owner,x:this.owner.x,y:this.owner.y,options:t}})}},adopted:function(){this.owner.state.set((this.type+"-"+this.stage).toString(),!0)},"handle-logic":function(t){},"collide-with-seed":function(){},"prepare-logic":function(){!0===this.owner.removeMe&&this.owner.removeSelf()}},methods:{getFunc:function(t){return function(){this.owner.parent.triggerEvent("hole-clicked",this.owner,t)}.bind(this)},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},destroy:function(){this.soil=null,this.manager=null}},publicMethods:{getSoil:function(){return this.soil},increment:function(){this.stage++,this.stage>2&&(this.stage=2),this.digEvent()},complete:function(){this.ready=!0,this.stage=3,this.digEvent()},rockParticles:function(){for(var t=0;t<5*platypus.fxModifier;t++)this.owner.parent.addEntity({type:"rock",properties:{x:this.owner.x,y:this.owner.y,z:5001,particle:!0}})},digEvent:function(){this.stage>0&&this.owner.state.set((this.type+"-"+(this.stage-1)).toString(),!1),this.owner.state.set((this.type+"-"+this.stage).toString(),!0),this.rockParticles(),!this.supressBigRocks&&Math.random()<.2&&this.owner.parent.addEntity({type:"rock",properties:{x:this.owner.x,y:this.owner.y,z:5001,fromHole:!0}})}},getAssetList:function(){for(var e=null,i=["action-select","rock"],s=i.length,n=Array.setUp();s--;)e=t.getAssetList({type:i[s]}),n.union(e),e.recycle();return n}})}(),function(){"use strict";platypus.createComponentClass({id:"HomePlay",publicProperties:{},initialize:function(){platypus.game.app.music="bg-title",platypus.game.app.musicInstance.volume=.75},events:{"play-clicked":function(){this.owner.parent.triggerEvent("start-scaling"),platypus.game.app.musicInstance.volume=.25,this.owner.parent.addEntity({id:"glow",components:[{type:"RenderSprite",spriteSheet:"shrink-ray-fx",animationMap:{default:"glow"}},{type:"TitleScaler",increment:.99999,auto:!0}],properties:{scaleX:1.58,scaleY:1.58,x:-450,y:540,z:1}});for(var t=0;t<10;t++)this.owner.parent.addEntity({id:"ring",components:[{type:"RenderSprite",spriteSheet:"shrink-ray-fx",rotate:!0,animationMap:{default:"ring"}},{type:"RingMover",pos:t}],properties:{z:100}})}},getAssetList:function(){return Array.setUp("assets/images/shrink-ray-fx.png")}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"Instructions",properties:{customText:null,downTo:0},publicProperties:{},initialize:function(){this.c=500},events:{adopted:function(){null!==this.customText&&this.owner.triggerEvent("set-text",this.customText),this.c=10*this.customText.length,this.c<500&&(this.c=500),this.show()},"handle-logic":function(){this.c--,this.c<1&&(this.hide(),this.c=1e4)}},methods:{destroy:function(){},hide:function(){this.tweening=!0,t.get(this.owner).to({y:-480},500,e.sineOut).call(function(){this.tweening=!1,this.owner&&!this.owner.destroyed&&this.owner.removeSelf()}.bind(this))},show:function(){this.tweening=!0,this.owner.y=-480,t.get(this.owner).to({y:this.downTo},500,e.sineOut).call(function(){this.tweening=!1}.bind(this))}},publicMethods:{}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),s=e?[]:[{type:"magnifying-glass"},{type:"magnification-dialog"},{type:"magnification-dialog-blind"},{type:"badge-notifier"}];platypus.createComponentClass({id:"IOS935",events:{load:function(){for(var t=s.length,e=this.owner;t--;)e.addEntity(s[t])}},getAssetList:function(){for(var t=Array.setUp(),e=null,n=s.length;n--;)e=i.getAssetList(s[n]),t.union(e),e.recycle();return t}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.helpers.getUserData"),i=Math.PI/4;platypus.createComponentClass({id:"JointWatcher",properties:{enactStress:!0,stressModifiers:null},publicProperties:{},initialize:function(){this.watchJoints=!1,this.jointClusters=Array.setUp(),this.stressSignals=Array.setUp(),this.stressSignalsToRemove=Array.setUp(),this.firstBreak=!0,this.firstPass=!0,this.usesAnchors=!1,this.stressModifiers?this.modify=this.modifiedStress.bind(this,this.stressModifiers):this.modify=this.unmodifiedStress.bind(this)},events:{"logic-tick":function(){var t=0,e=0;if(this.stressSignalsToRemove.length){for(t=this.stressSignalsToRemove.length-1;t>=0;t--)for(e=this.stressSignals.length-1;e>=0;e--)if(this.stressSignalsToRemove[t]===this.stressSignals[e]){this.owner.removeEntity(this.stressSignals.splice(e,1)[0]);break}this.stressSignalsToRemove.length=0}},"after-box2d-update":function(i,s){var n=0,r=0,a=0,o=null,h=null,l=null,c=null,p=null,d=null,u=[],g=null,m=null,y=null,f=0,v=1,w=0,b=0,x=0,S=null,E=null,C=0,k=0,A=null,P=null;if(this.enactStress&&this.watchJoints){for(n=this.jointClusters.length-1;n>=0;n--){for(o=this.jointClusters[n],h=t.setUp(),r=0;r<o.length;r++)c=(p=o[r]).joint,0===r&&(C=30*(c.GetAnchorA().get_x()+c.GetAnchorB().get_x())/2,k=30*(c.GetAnchorA().get_y()+c.GetAnchorB().get_y())/2,this.stressSignals.length&&(this.stressSignals[n].x=C,this.stressSignals[n].y=k)),h[p.entityA.id]||(h[p.entityA.id]=Array.setUp(0,0,0)),h[p.entityB.id]||(h[p.entityB.id]=Array.setUp(0,0,0)),"number"==typeof p.stressValues.angle&&(E=e(c),!this.firstPass||"piston-beam"!==p.entityA.type&&"piston-beam"!==p.entityB.type||(E.oAngle=c.GetJointAngle()),v=(f=c.GetJointAngle()-E.oAngle)>0?1:-1,"piston-beam"===p.entityA.type||"piston-beam"===p.entityB.type?c.SetMotorSpeed(Math.max(-.25,-10*Math.pow(f,2))*v):c.SetMotorSpeed(-20*v*Math.pow(f,2)),w=Math.min(Math.abs(f)/p.stressValues.angle,1),h[p.entityA.id][2]=Math.max(w,h[p.entityA.id][2]),h[p.entityB.id][2]=Math.max(w,h[p.entityB.id][2])),"number"==typeof p.stressValues.reaction&&(b=p.joint.GetReactionForce(1/s).Length(),b=Math.min(this.modify(b,p.entityA.jointType,p.stressValues.reaction),this.modify(b,p.entityB.jointType,p.stressValues.reaction),1),h[p.entityA.id][0]=Math.max(b,h[p.entityA.id][0]),h[p.entityB.id][0]=Math.max(b,h[p.entityB.id][0])),"number"==typeof p.stressValues.distance&&(x=Math.pow(c.GetAnchorA().get_x()-c.GetAnchorB().get_x(),2)+Math.pow(c.GetAnchorA().get_y()-c.GetAnchorB().get_y(),2),x/=p.stressValues.distance,x=Math.min(1,x),h[p.entityA.id][1]=Math.max(x,h[p.entityA.id][1]),h[p.entityB.id][1]=Math.max(x,h[p.entityB.id][1]));for(d in h)1!==h[d][0]&&1!==h[d][1]&&1!==h[d][2]||(u.push(d),this.firstBreak&&(this.firstBreak=!1,this.owner.triggerEvent("slo-mo"))),this.stressSignals.length&&this.stressSignals[n].triggerEvent("stress",Math.max(Math.max(h[d][2],h[d][0]),h[d][1]));for(l in h)h[l].recycle();for(h.recycle(),r=0;r<u.length;r++)for(g=u[r],a=o.length-1;a>=0;a--)m=o[a].entityA.id,y=o[a].entityB.id,m!==g&&y!==g||(A=o[a].entityA.type,P=o[a].entityB.type,"wheel"!==A&&"wheel-powered"!==A&&"wheel-small"!==A&&"rocket"!==A||o[a].entityA.state.set("axeled",!1),"wheel"!==P&&"wheel-powered"!==P&&"wheel-small"!==P&&"rocket"!==P||o[a].entityB.state.set("axeled",!1),this.owner.world.DestroyJoint(o[a].joint),o[a].entityA=null,o[a].entityB=null,o[a].joint=null,o.splice(a,1));u.length&&(this.owner.triggerEvent("play-break"),S={type:"explosion",properties:{x:C,y:k,z:3110}},this.owner.addEntity(S)),u=[],0===o.length&&(this.jointClusters.splice(n,1),this.stressSignals.length&&this.stressSignalsToRemove.push(this.stressSignals[n]))}this.firstPass=!1}},"simulation-started":function(){this.watchJoints=!0,this.usesAnchors&&this.owner.triggerEvent("uses-anchors")},"simulation-stopped":function(){var t=null,e=this.jointClusters,i=e.length,s=0,n=this.owner,r=this.stressSignals,a=this.stressSignalsToRemove,o=n.world;for(this.usesAnchors=!1;i--;)for(s=(t=e[i]).length;s--;)o.DestroyJoint(t[s].joint);for(i=r.length;i--;)a.push(r[i]);this.owner.triggerEvent("watched-joints-removed"),e.length=0,this.owner.triggerEvent("normal-mo"),this.watchJoints=!1,this.firstBreak=!0,this.firstPass=!0},"add-joint-cluster":function(t,s,n){var r=0,a=[],o=null,h=null,l=null,c=null;for("default"===s.angle&&(s.angle=i),"default"===s.reaction&&(s.reaction=60),"default"===s.distance&&(s.distance=.8),r=0;r<t.length;r++)a[r]={},a[r].stressValues=s,a[r].joint=t[r],a[r].entityA=e(t[r].GetBodyA()).entity,a[r].entityB=e(t[r].GetBodyB()).entity,l=a[r].entityA.type,c=a[r].entityB.type,"anchor"!==l&&"anchor"!==c||(this.usesAnchors=!0),"wheel"!==l&&"wheel-powered"!==l&&"wheel-small"!==l&&"rocket"!==l||a[r].entityA.state.set("axeled",!0),"wheel"!==c&&"wheel-powered"!==c&&"wheel-small"!==c&&"rocket"!==c||a[r].entityB.state.set("axeled",!0);a.length&&(this.jointClusters.push(a),n&&(o={type:"stress-signal",properties:{x:0,y:0,z:3020}},h=this.owner.addEntity(o),this.stressSignals.push(h)))}},methods:{destroy:function(){this.jointClusters.recycle(),this.jointClusters=null,this.stressSignals.recycle(),this.stressSignals=null,this.stressSignalsToRemove.recycle(),this.stressSignalsToRemove=null},modifiedStress:function(t,e,i,s){return e/(s*(t[i]||1))},unmodifiedStress:function(t,e,i){return t/i}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPActionButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},e.getLayout(),e.isReallyReady())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPBadgeButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=platypus.badger.getBadgeStatusForLAP();e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},n)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPDwellTimer",publicProperties:{hover:!0},initialize:function(){this.camera=t.setUp(),this.time=-1,this.x=0,this.y=0,this.xs=0,this.ys=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(t){var e=t.delta;this.time>=0&&(this.time+=e,this.xs+=this.x*e,this.ys+=this.y*e)},pointerover:function(t){this.time=0,this.x=t.x,this.y=t.y,this.ys=0,this.xs=0},pointermove:function(t){this.x=t.x,this.y=t.y},pointerout:function(t){var e=platypus.game.app;t&&t.event&&"mouse"===t.event.pointerType&&this.time>=1e3&&e.analyticsEmitter.dwellTime(e.levelId||"",this.time>>0,this.owner.plantMaster?this.owner.plantMaster.type:this.owner.type,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.xs/this.time-this.camera.left>>0,y:this.ys/this.time-this.camera.top>>0}),this.time=-1}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPHelpButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},e.getPlots(),platypus.getActionQueues(),e.getHint(),e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPPointerEvent",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPRecycleButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=e.getLayout();delete n.player_placed_objects,e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},n,e.getResources(),e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSavedGame",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.owner.totalSaves)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPScrollButton",initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.coords=null},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=t&&"number"==typeof t.x?t.x:this.x,i=t&&"number"==typeof t.y?t.y:this.y;this.coords={stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:e-this.camera.left>>0,y:i-this.camera.top>>0}},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y},"new-scroll-position":function(t){var e=platypus.game.app;this.coords&&(e.analyticsEmitter.scrollin(e.levelId||"",this.coords,["Earth","Mars","Mercury"][t]),this.coords=null)}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSeedInfo",properties:{lapEvent:"",information:null,seed:"",began:0},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.changes=!this.seed&&!this.information},events:{"camera-update":function(t){this.camera.set(t.viewport)},released:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;this.began?e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.information,this.seed,Date.now()-this.began):e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.information,this.seed)},pointerdown:function(t){this.x=t.x,this.y=t.y,this.changes&&platypus.game.app.predictSeedInfo(this)},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSelectAnswer",properties:{lapEvent:"selectAnswer",action:"",position:0},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.action,this.position,e.getPlots(),platypus.getActionQueues())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSelectLevel",properties:{lapEvent:"",lapLevel:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](this.lapLevel,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPTapBonus",properties:{lapEvent:"tapBonus",action:"",position:0},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},pointerdown:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.owner.type,e.getPlots())},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.Entity");platypus.createComponentClass({id:"LevelSelectManager",properties:{levelButtonData:[]},initialize:function(t,e){var i=platypus.game.app,s=3;return this.newUnlocks=[],this.progress=null,i.userData.read("-"+i.options.version+"-levels-complete",function(t){this.progress=t,0===--s&&e()}.bind(this)),i.userData.read("-"+i.options.version+"-scores",function(t){this.tutScore=t&&t["score-for-tutorial"]||0,0===--s&&e()}.bind(this)),i.userData.read("-"+i.options.version+"-last-level-played",function(t){this.lastPlayed=t,0===--s&&e()}.bind(this)),!0},events:{"scene-loaded":function(){var t=platypus.game.app,e=!1,i=!0,s=!1,n="level-1",r=0,a=0,o=null,h=-1,l=!0,c=!1,p=[];for(this.tutScore>10&&(n="level-2"),this.tutScore>50&&(n="level-3"),this.tutScore>200&&(this.progress.length<3&&(this.progress=["level-1","level-2","level-3"]),i=!1),i&&this.owner.triggerEvent("level-select-first-visit"),r=0;r<this.levelButtonData.length;r++)if(s="level-1"===this.levelButtonData[r].level||"level-2"===this.levelButtonData[r].level||"level-3"===this.levelButtonData[r].level,e="level-4"===this.levelButtonData[r].level,!(s&&!i||e&&i)){if(o=this.owner.addEntity({type:this.levelButtonData[r].buttonType||"level-button",properties:{x:this.levelButtonData[r].x,y:this.levelButtonData[r].y,persistentData:{level:s?n:this.levelButtonData[r].level}}}),p.push(o),l=!0,c=!1,this.levelButtonData[r].toUnlock)for(a=0;a<this.levelButtonData[r].toUnlock.length;a++)if(!this.progress||-1===this.progress.indexOf(this.levelButtonData[r].toUnlock[a])){l=!1;break}l&&(h+=1,c?this.newUnlocks.push(o):(o.triggerEvent("enable"),o.state.set("default",!1),o.state.set(s?"complete-star":"unlocked",!0),o.scaleX=1.5,o.scaleY=1.5))}this.owner.parent.app.userData.write("Recently-Completed-Level",""),t.googleAnalytics.event(t.name,"EnterLevelSelect","CompletedLevels",h),this.lsTime=Date.now();var d=0;for(var u in 5==this.lastPlayed&&(d=1),6==this.lastPlayed&&(d=2),this.owner.triggerEvent("ls-jump",d),this.owner.triggerEvent("new-scroll-position",d),p)p[u].triggerEvent("ls-jump2",d)},"show-unlocked-levels":function(){var t=0;for(t=0;t<this.newUnlocks.length;t++)this.newUnlocks[t].triggerEvent("unlock-level");this.newUnlocks=[]}},methods:{destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitLevelSelect","LevelSelectTime",Date.now()-this.lsTime>>0)}},getAssetList:function(){return t.getAssetList({type:"level-button"})}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"LevelSelectScrollable",properties:{scrollScale:1,name:""},publicProperties:{},initialize:function(){this.originX=0,this.scrolledX=0,this.scrolledPos=0,this.scrolling=!1,this.ignoreAdopt=!1,this.fx=[],this.fxc=0,this.hoverC=0},events:{"ls-scroll-right":function(){2===this.scrolledPos||this.scrolling||(this.scrolling=!0,this.scrolledPos++,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,t.get(this.owner).to({x:this.scrolledX},1e3,e.sineInOut).call(function(){this.scrolling=!1,this.owner&&!this.owner.destroyed&&this.owner.parent.triggerEvent("new-scroll-position",this.scrolledPos)}.bind(this)))},"jet2-jump":function(){var i=0,s=0;if("Jet2"===this.name){for(t.get(this.owner).to({y:this.owner.y-100,scaleX:.75,scaleY:.75},300,e.sineOut).to({y:this.owner.y+100,scaleX:.6,scaleY:.6},300,e.sineIn),s=0;s<8;s++)i=45*s,this.fx.push(this.owner.parent.addEntity({id:"starFX",components:[{type:"RenderSprite",spriteSheet:"star",rotate:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z-1,scaleX:.75,scaleY:.75,opacity:.5,speedX:2*Math.cos(i*(Math.PI/180)),speedY:2*Math.sin(i*(Math.PI/180))}}));this.owner.parent.triggerEvent("star")}},"boop-jump":function(){var i=0,s=0;if("Boop"===this.name){for(t.get(this.owner).to({y:this.owner.y-100,scaleX:.9,scaleY:.9},300,e.sineOut).to({y:this.owner.y+100,scaleX:.6,scaleY:.6},300,e.sineIn),s=0;s<8;s++)i=45*s,this.fx.push(this.owner.parent.addEntity({id:"starFX",components:[{type:"RenderSprite",spriteSheet:"star",rotate:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z-1,scaleX:.75,scaleY:.75,opacity:.5,speedX:3.5*Math.cos(i*(Math.PI/180)),speedY:3.5*Math.sin(i*(Math.PI/180))}}));this.owner.parent.triggerEvent("star")}},"ls-scroll-left":function(){0===this.scrolledPos||this.scrolling||(this.scrolling=!0,this.scrolledPos--,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,t.get(this.owner).to({x:this.scrolledX},1e3,e.sineInOut).call(function(){this.scrolling=!1,this.owner&&!this.owner.destroyed&&this.owner.parent.triggerEvent("new-scroll-position",this.scrolledPos)}.bind(this)))},"ls-jump":function(t){this.scrolledPos=t,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,this.owner.x=this.scrolledX},"ls-jump2":function(t){this.originX=this.owner.x,this.scrolledPos=t,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,this.owner.x=this.scrolledX,this.ignoreAdopt=!0},adopted:function(){this.ignoreAdopt||(this.originX=this.owner.x)},"handle-logic":function(){var t=0,e=null;if("ship"===this.name&&(this.hoverC+=.01,this.owner.y+=.1*Math.sin(this.hoverC)),this.fx.length>0)if(this.fxc++,this.fxc>400){for(t=0;t<this.fx.length;t++)this.fx[t].removeSelf();this.fx.length=0,this.fxc=0}else for(t=0;t<this.fx.length;t++)(e=this.fx[t]).x+=e.speedX,e.y+=e.speedY,e.opacity-=.00125,e.speedX*=.99,e.speedY*=.99,e.rotation+=1}}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Entity");platypus.createComponentClass({id:"ListItem",properties:{infinite:!1,opacity:1},publicProperties:{count:1,z:0,spawns:""},initialize:function(e){this.item=this.owner.item||e.item,this.generatedItem=!1,this.dragging=!1,this.readyToDrag=null,this.pointerIsDown=!1,this.show=this.owner.left,this.hide=-this.owner.left,this.motion=t.setUp("x",0,"y",0),this.owner.state.set("infinite",this.infinite),this.updateCount(this.count)},events:{"increase-count":function(){this.updateCount(this.count+1)},"decrease-count":function(){this.updateCount(this.count-1)},"item-returned":function(t){t===this.spawns&&this.updateCount(this.count+1)},pointerdown:function(t){this.readyToDrag=!0,this.motion.x=t.x,this.motion.y=t.y,this.pointerIsDown=!0},pointermove:function(t){var e=0,i=0;this.pointerIsDown&&!this.generatedItem&&(this.readyToDrag?(e=Math.abs(this.motion.x-t.x),i=Math.abs(this.motion.y-t.y),this.owner.parent.scrollable?2*e>i&&e>7?this.createEntity(t)||(this.readyToDrag=!1,this.scroll(t)):i>2*e&&i>7&&(this.readyToDrag=!1,this.scroll(t)):this.createEntity(t)):this.scroll(t))},pointerup:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointerupoutside:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointercancel:function(t){this.scrolling&&(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{createEntity:function(t){return!!this.count&&(this.generatedItem=!0,this.owner.triggerEvent("generate-item",t),this.owner.triggerEvent("decrease-count"),this.dragging=!0,!0)},scroll:function(t){this.owner.parent.triggerEvent("swipe",t),this.scrolling=!0},updateCount:function(t){var e="";this.infinite||(t>0?(e+=t,this.owner.opacity=1):0===t&&(e="0",this.owner.opacity=.2),this.count=t,this.owner.triggerEvent("set-text",e))}},getAssetList:function(t,i,s){var n=t.spawns||i.spawns||s&&s.spawns;return n?e.getAssetList({type:n}):Array.setUp()}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data");platypus.createComponentClass({id:"LogicButton",properties:{onPress:"",onRelease:"",onCancel:"",onHover:"",useOnce:!1,disabled:!1,toggle:!1,pressed:!1,passthroughOnMovement:!1},publicProperties:{bottom:null,left:null,right:null,top:null},initialize:function(){var e=this.owner.state;this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.state=e,e.set("disabled",this.disabled),e.set("released",!this.pressed),e.set("pressed",this.pressed),e.set("highlighted",!1),this.owner.buttonMode=!this.disabled,this.cancelled=!1,this.readyToToggle=!1,this.savedForPassthrough=null},events:{"handle-logic":function(){var t=this.bottom,e=this.left,i=this.right,s=this.top;this.lastBottom===t&&this.lastLeft===e&&this.lastRight===i&&this.lastTop===s||(this.updatePosition(this.aabb),this.lastBottom=t,this.lastLeft=e,this.lastRight=i,this.lastTop=s)},"camera-update":function(t){this.aabb.set(t.viewport),this.updatePosition(this.aabb)},pointerdown:function(t){this.state.get("disabled")||(this.toggle?this.readyToToggle=!0:(this.onPress&&this.owner.trigger(this.onPress),this.updateStateAndTrigger("pressed"),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&this.removeEventListener("pointerdown")),this.passthroughOnMovement&&(this.savedForPassthrough=e.setUp("entity",t.entity,"event",t.event,"pixiEvent",t.pixiEvent,"x",t.x,"y",t.y),this.motion=e.setUp("x",t.x,"y",t.y)))},pointermove:function(t){var e=0,i=0;this.passthroughOnMovement&&(this.motion&&(e=Math.abs(this.motion.x-t.x),i=Math.abs(this.motion.y-t.y),(e>5||i>5)&&(this.cancelled=!0,this.state.set("pressed",!1),this.savedForPassthrough&&(this.owner.parent.triggerEvent("pointerdown",this.savedForPassthrough),this.savedForPassthrough.recycle(),this.savedForPassthrough=null),this.motion.recycle(),this.motion=null)),this.cancelled&&this.owner.parent.triggerEvent("pressmove",t))},pressup:function(t){var e=this.state;e.get("disabled")||(this.cancelled?(this.passthroughOnMovement&&this.owner.parent.triggerEvent("pressup",t),this.onCancel&&this.owner.trigger(this.onCancel),this.updateStateAndTrigger("cancelled")):this.toggle?this.readyToToggle&&(e.get("pressed")?this.updateStateAndTrigger("released"):this.updateStateAndTrigger("pressed")):(this.onRelease&&this.owner.trigger(this.onRelease),this.updateStateAndTrigger("released")),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&(this.removeEventListener("pressup"),this.state.set("disabled",!0),this.owner.buttonMode=!1)),this.cancelled=!1,this.readyToToggle=!1},pointerover:function(){this.onHover&&this.owner.trigger(this.onHover),this.state.get("pressed")&&(this.cancelled=!1)},pointerout:function(){this.state.get("pressed")&&(this.cancelled=!0)},disable:function(){this.state.set("disabled",!0),this.owner.buttonMode=!1},enable:function(){this.state.set("disabled",!1),this.owner.buttonMode=!0},"toggle-disabled":function(){var t=this.state.get("disabled");this.owner.buttonMode=t,this.state.set("disabled",!t)},highlight:function(){this.state.set("highlighted",!0)},unhighlight:function(){this.state.set("highlighted",!1)},"toggle-highlight":function(){var t=this.state;t.set("highlighted",!t.get("highlighted"))}},methods:{updatePosition:function(t){var e=this.bottom,i=this.left,s=this.owner,n=this.right,r=this.top;"number"==typeof i?s.x=t.left+i:"number"==typeof n&&(s.x=t.right-n),"number"==typeof r?s.y=t.top+r:"number"==typeof e&&(s.y=t.bottom-e)},updateStateAndTrigger:function(t){var i=null,s=this.owner,n=this.state,r=n.get("pressed"),a=n.get("released"),o=!1;a&&"pressed"===t?(n.set("pressed",!0),n.set("released",!1),o=!0):r&&"released"===t?(n.set("pressed",!1),n.set("released",!0),o=!0):"cancelled"===t&&(n.set("pressed",!1),n.set("released",!0),o=!0),o&&(i=e.setUp("released",r,"pressed",a,"triggered",a,"entity",s),s.triggerEvent(t,i),i.recycle())},destroy:function(){this.aabb.recycle(),this.aabb=null,this.owner.buttonMode=!1,this.state=null}}})}(),function(){"use strict";platypus.createComponentClass({id:"LSScroller",properties:{hideAtPos:0},publicProperties:{},initialize:function(t,e){},events:{adopted:function(){0===this.hideAtPos&&this.owner.triggerEvent("hide-sprite"),platypus.game.app.music="bg-level-select",platypus.game.app.musicInstance.volume=1},"new-scroll-position":function(t){var e=platypus.game.app;this.hideAtPos==t?this.owner.triggerEvent("hide-sprite"):this.owner.triggerEvent("show-sprite"),e.userData.read("-"+e.options.version+"-level-select-vo",function(i){null===i&&(i=[]);var s=["earth","mars","mercury"][t];-1==i.indexOf(s)&&(this.owner.triggerEvent(s),i.push(s),e.userData.write("-"+e.options.version+"-level-select-vo",i))}.bind(this))}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Vector");platypus.createComponentClass({id:"Magnifier",properties:{offsetX:56,offsetY:-61},publicProperties:{dragging:!1},initialize:function(){this.details=platypus.game.app.config["magnify-list"],Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.sensorState=!1,this.groupMovement=null,this.locked=!1,this.ignoreInput=!1,this.top=this.owner.top,this.left=this.owner.left,this.detail=null,this.detailEntity=null,this.wentOutsideTheScreen=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(){var t=null,e=this.camera,s=null,n=null,r=this.owner,a=r.parent,o=null,h=r.parent.parent.layers,l=r.state,c=this.vector,p=null,d=null,u=null,g=h.length,m=0,y=0;if(l.get("focus")&&l.set("focus",!1),c&&l.get("dragging")){for(this.detail=null,c=i.setUp(c.x+this.offsetX,c.y+this.offsetY),m=0;m<g;m++)if((o=h[m])!==a&&(p=o.windowToWorld(a.worldToWindow(c)),y=(t=o.getEntitiesAtPoint?o.getEntitiesAtPoint(p.x,p.y):this.getEntitiesAtPoint(o,p.x,p.y)).length)){for(;y--;)n=t[y],(s=this.details[n.spawns||n.type])&&(l.set("focus",!0),this.detail=s,d=o.windowToWorld(a.worldToWindow(i.setUp(e.left,e.top))),u=o.windowToWorld(a.worldToWindow(i.setUp(e.width,e.height))),this.detailEntity={kitchen_w:u.x>>0,kitchen_h:u.y>>0,x:n.x-d.x>>0,y:n.y-d.y>>0},this.time=Date.now(),d.recycle(),u.recycle());if(s)break}c.recycle()}},pointerdown:function(t){var i=null;this.owner.parent.zooming||this.locked?this.ignoreInput=!0:(this.dragged=!1,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick?(this.ignoreInput=!0,this.stickyClick(t),this.stickyClick=null):(i=function(t){var i=this.camera,s=this.owner.container.parent.transform.worldTransform,n=e.setUp("event",t.data.originalEvent,"pixiEvent",t,"x",t.data.global.x/s.a+i.left,"y",t.data.global.y/s.d+i.top,"entity",this.owner);this.continueInputMovement(n),n.recycle()}.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",i),this.stickyClick=function(t,e){this.owner.container.removeListener("pointermove",t),e&&this.endInputMovement(e)}.bind(this,i))):this.startInputMovement(t))},pointermove:function(t){this.ignoreInput||this.vector.x===t.x&&this.vector.y===t.y||(this.dragged=!0,this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.continueInputMovement(t))},pointerup:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointerupoutside:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointercancel:function(t){this.vector&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t))},"unlock-magnifying-glass":function(){var t=this.owner;t.top=this.top,t.left=this.left,this.locked=!1,t.state.set("dragging",!1),this.dragging=!1},hide:function(){var t=platypus.game.app;this.detail&&(t.analyticsEmitter.closeMagnificationDialog(t.levelId,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,!t.voPlayer.playing,Date.now()-this.time>>0,t.getEnlearnData()),this.detail=null,this.detailEntity=null),this.time=0}},methods:{getEntitiesAtPoint:function(e,i,s){for(var n=t.setUp(),r=Array.setUp(),a=e.entities,o=null,h=a.length;h--;)o=a[h],n.setAll(o.x||0,o.y||0,o.width||0,o.height||0),n.containsPoint(i,s)&&r.push(o);return n.recycle(),r},startInputMovement:function(t){var e=this.owner;this.vector&&this.vector.recycle(),this.vector=i.setUp(t.x,t.y),e.parent.triggerEvent("pause-zooming"),this.dragging=!0},continueInputMovement:function(t){var e=this.owner,i=e.state;this.dragging&&!i.get("dragging")&&(i.set("dragging",!0),e.triggerEvent("magnifying"),this.owner.top=null,this.owner.left=null),void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.detail=null,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),this.vector&&(this.vector.x=t.x,this.vector.y=t.y),e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endInputMovement:function(t){var e=platypus.game.app,i=this.owner,s=this.detail,n="";this.continueInputMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,i.parent.triggerEvent("unpause-zooming"),s?(e.analyticsEmitter.magnifyAnEntity(e.levelId,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,this.detailEntity),i.triggerEvent("send-title",s.title),i.triggerEvent("set-photo",s.id),i.triggerEvent("show-magnification"),platypus.game.app.voPlayer.play(s["vo-id"]||"mag-"+s.id),"cracker-a"!==(n=s.id)&&"cracker-b"!==n&&"cracker-c"!==n&&"cracker-d"!==n||(n="cracker"),platypus.badger.increment("inspected-"+n),this.time=Date.now()):i.triggerEvent("early-reset-magnification")},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"MagnifierPhotoSetter",initialize:function(){this.photos=platypus.game.app.config["magnify-list"]},events:{"set-photo-id":function(t){var e=this.photos[t],i=platypus.modifyAllAssets;this.scale||(this.scale=function(t){for(var e=t.length;e--;)if(1===t[e].offsetZ)return t[e].sprite.scale}(this.owner.components)),e&&(this.owner.triggerEvent(e.image),e.credit&&(this.scale.x=i,this.scale.y=i,e["image-title"]?"*"+e["image-title"]+"* by ":"This photo is by ",e.credit+" at "+e.link),e.scale?(this.scale.x=+e.scale*i,this.scale.y=+e.scale*i):(this.scale.x=i,this.scale.y=i))}}})}(),function(){"use strict";platypus.createComponentClass({id:"Motor",properties:{accel:40,damping:.8},publicProperties:{},initialize:function(){this.simulationStarted=!1,this.torque=0,this.direction=0,this.batteryDrain=.0013,this.owner.state.set("powered",!1)},events:{load:function(){this.torque=this.owner.body.GetMass()*this.accel*(this.owner.radius/30)},"simulation-started":function(){this.simulationStarted=!0},"simulation-stopped":function(){this.simulationStarted=!1},"motor-cw-start":function(){this.owner.state.get("connected-to-battery")&&(this.direction=1,this.owner.body.SetAngularDamping(this.damping))},"motor-cw-stop":function(){this.owner.state.get("connected-to-battery")&&1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"motor-ccw-start":function(){this.owner.state.get("connected-to-battery")&&(this.direction=-1,this.owner.body.SetAngularDamping(this.damping))},"motor-ccw-stop":function(){this.owner.state.get("connected-to-battery")&&-1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"before-box2d-update":function(){this.simulationStarted&&this.direction&&this.owner.state.get("connected-to-battery")&&this.owner.drainBattery(this.batteryDrain)&&(this.owner.body.SetAwake(!0),this.owner.body.ApplyTorque(this.direction*this.torque))}},methods:{},publicMethods:{}})}(),function(){"use strict";var t;platypus.createComponentClass({id:"Mouth",properties:{animationMap:null,slotName:"Mouth"},initialize:(t=function(t){this.spine&&this.spine.skeleton.setAttachment(this.slotName,t)},function(){var e="",i=this.animationMap;for(e in this.spine=null,i)i.hasOwnProperty(e)&&this.addEventListener(e,t.bind(this,i[e]))}),events:{load:function(){for(var t=this.owner.components,e=t.length;e--;)if(t[e].spine){this.spine=t[e].spine;break}}}})}(),function(){"use strict";platypus.createComponentClass({id:"ParticleFloatLogic",properties:{},publicProperties:{},initialize:function(){this.alphaDecrement=0,this.duration=this.getRandomInt(100,200),this.speed=.01*this.getRandomInt(50,100),this.angle=Math.random()*Math.PI*2},events:{adopted:function(){this.alphaDecrement=1/this.duration},"handle-logic":function(t){this.owner.opacity-=this.alphaDecrement,this.angle+=.01*Math.random(),this.velX=Math.cos(this.angle)*this.speed,this.velY=Math.sin(this.angle)*this.speed,this.owner.x+=this.velX,this.owner.y+=this.velY,this.owner.opacity<=0&&this.owner.removeSelf(),this.owner.orientation+=1}},methods:{getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"ParticleLogic",properties:{angle:0,duration:0,speed:0,spin:!1},publicProperties:{},initialize:function(){this.alphaDecrement=0,this.velX=Math.cos(this.angle)*this.speed,this.velY=Math.sin(this.angle)*this.speed},events:{adopted:function(){this.alphaDecrement=1/this.duration},"handle-logic":function(t){this.owner.opacity-=this.alphaDecrement,this.owner.x+=this.velX,this.owner.y+=this.velY,this.owner.opacity<=0&&this.owner.removeSelf(),this.spin&&(this.owner.orientation+=1)}},methods:{getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),s=new(include("Box2D.b2Vec2"))(0,0),n=-6e3;platypus.createComponentClass({id:"Pin",properties:{},publicProperties:{handshake:0,vertical:!1,weld:!1},initialize:function(){this.constraints=Array.setUp(),this.temporaryConstraints=Array.setUp(),this.entities=Array.setUp(),this.defaultZ=this.handshake?3015:this.owner.z,this.pinnedZ=this.defaultZ-.1,this.owner.parent.addPin(this.owner),this.hiding=!1,this.handshake&&this.owner.state.set("block",!0),this.vertical&&this.owner.state.set("vertical",!0),this.weld&&(this.owner.scaleX=.5,this.owner.scaleY=.5)},events:{adopted:function(){this.owner.parent.triggerEvent("pin-on-panel",this.owner)},"snap-to-pin":function(t){for(var e=this.entities,i=e.length,s=null;i--;)s=e[i],this.detach(s),t.attach(s,!1,!0);this.owner.parent.removeEntity(this.owner)},"validate-motion":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("validate-constraint",t)},dragged:function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("pin-moved",t);this.destroyTemporaryJoints()},"resolve-bodies":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-bodies")},"resolve-joints":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-joints")},"resolve-snaps":function(e){for(var i=this.entities,s=null,n=null,r=this.temporaryConstraints,a=e.length,o=0,h=0;a--;)if((s=e[a]).pinFrom===this.owner&&!s.panel)for(o=(n=s.pinTo.getPinnedEntities()).length;o--;)for(h=i.length;h--;)r.push(t.setUp("pinned",n[o],"entity",i[h]))},"motion-ended":function(){var t=this.entities,e=t.length;for(this.destroyTemporaryJoints();e--;)t[e].triggerEvent("pin-motion-ended",this.owner)},"update-group-id":function(t){var e=this.entities,i=e.length;if(!t||t!==this.owner.groupId){for(t?this.owner.groupId=t:(this.owner.groupId=--n,t=this.owner.groupId);i--;)e[i].groupId!==t&&e[i].triggerEvent("update-group-id",t);this.owner.panelled&&this.owner.panelled.triggerEvent("update-group-id",t)}},"pre-simulation-started":function(){this.owner.panelled&&this.attach(this.owner.panelled)},"prepare-for-simulation":function(){var t=0,e=null;for(t=0;t<this.constraints.length;t++)e=this.constraints[t],this.owner.handshake||this.owner.panelled||(e.EnableMotor(!0),e.SetMaxMotorTorque(15),i(e).oAngle=e.GetJointAngle());this.owner.parent.removeEntity(this.owner)},"throw-away":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("lost-pin",this.owner)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("begin-pin-group-movement",t)},"before-box2d-update":function(){for(var t=null,e=this.temporaryConstraints,i=e.length;i--;)(t=e[i]).joint=this.createJoint(t.pinned,t.entity)},"after-box2d-update":function(){for(var t=this.owner,e=null,i=this.temporaryConstraints,s=i.length;s--;)e=i[s],t.removeJoint(e.joint),e.joint=null},"handle-render":function(){!this.hiding&&this.owner.immobile?(this.owner.triggerEvent("hide-sprite"),this.hiding=!0):this.hiding&&!this.owner.immobile&&(this.owner.triggerEvent("show-sprite"),this.hiding=!1)},"can-you-pin-to-this-panel":function(t){var i=null,n=[0,-2,2],r=0;if(!this.owner.handshake&&-1===this.owner.getPinnedEntities().indexOf(t.panel))for(i=t.panel.body.GetFixtureList();0!==e(i);){for(r=0;r<n.length;r++)if(s.Set((this.owner.x+n[r])/30,(this.owner.y+n[r])/30),i.TestPoint(s))return t.pin=this.owner,this.owner.panelled=t.panel,this.owner.state&&this.owner.state.set("panelled",!0),void t.panel.velcroed.push(this.owner);i=i.GetNext()}}},methods:{createJoint:function(t,e){var i=this.owner,s=i.x/30,n=i.y/30;return this.handshake||this.weld?t.createJoint("weld",{anchor:{x:s,y:n}},e,1):t.createJoint("revolute",{anchor:{x:s,y:n}},e,1)},destroyTemporaryJoints:function(){for(var t=this.temporaryConstraints,e=t.length;e--;)t[e].recycle();t.length=0},updateRendering:function(){var t=this.entities.length>1;this.owner.state.set("pinned",t),this.owner.z=t?this.pinnedZ:this.defaultZ},destroy:function(){var t=this.owner.parent;t.removePin&&t.removePin(this.owner),this.constraints.recycle(),this.constraints=null,this.entities.recycle(),this.entities=null},detachPinAndJoint:function(t){var e=t.body,i=this.owner,s=this.constraints,n=null,r=this.entities,a=r.indexOf(t),o=0;if(a>=0){for(o=s.length;o--;)if(e===(n=s[o]).GetBodyA()||e===n.GetBodyB()){s.greenSplice(o);try{i.removeJoint(n)}catch(t){platypus.debug.warn("Joint removal caused an error.",t)}}if(r.greenSplice(a),this.owner.immobile&&!t.movable)for(a=r.length,this.owner.immobile=!1;a--;)if(!r[a].movable){this.owner.immobile=!0;break}t.triggerEvent("pin-removed",i)}else platypus.debug.warn("Attempting to detach an unattached entity. This is incorrect; please fix.")}},publicMethods:{getConstraints:function(){return this.constraints},attach:function(t,e,i){var s=this.constraints,n=this.entities,r=n.length;for(i&&this.handshake&&(this.handshake+=1e3);r--;)s.push(this.createJoint(t,n[r]));n.push(t),t.movable||(this.owner.immobile=!0),e||t.triggerEvent("pin-added",this.owner),this.owner.loadingComponents?t.groupId&&!this.owner.groupId&&(this.owner.groupId=t.groupId):this.owner.groupId?t.triggerEvent("update-group-id",this.owner.groupId):this.owner.triggerEvent("update-group-id"),this.updateRendering()},canSnapTo:function(t,e){var i=this.entities,s=i.length,n=!0,r=t.pinTo.getPinnedEntities(),a=r.length;if(t.pinFrom.handshake+t.pinTo.handshake!==0)return!1;if(t.pinFrom.inDragGroup&&t.pinTo.inDragGroup)return!1;for(;s--;)for(a=r.length;a--;)if(i[s]===r[a])return!1;for(s=i.length;s--;)if(i[s].triggerEvent("valid-snap",t,e),!t.snappable){n=!1;break}return n},isConstrained:function(){return!!this.entities.length},hasJoint:function(t){for(var i=this.constraints,s=i.length;s--;)if(e(i[s])===e(t))return!0;return!1},detach:function(t){this.detachPinAndJoint(t)&&(this.owner.triggerEvent("update-group-id"),this.updateRendering())},getPinnedEntities:function(){return this.entities},resetJoints:function(){for(var t=this.owner,e=this.constraints,i=e.length,s=this.entities,n=0;i--;)t.removeJoint(e[i]);for(e.length=0,i=s.length;i--;)for(n=i;n--;)e.push(this.createJoint(s[i],s[n]))},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake?9999999:0,vertical:t.vertical||!1,weld:t.weld||!1}})},split:function(t){var e=this.owner.parent,i=this.entities,s=i.length,n=null,r=null;if(1===s)return null;for(this.owner.immobile&&t.movable&&(this.owner.immobile=!1),r=this.createPin(this.owner,e);s--;)i[s]!==t&&(n=i[s],this.detachPinAndJoint(n),r.attach(n,!1),this.handshake&&(this.handshake-=1e3,0===s?(this.handshake*=-1,r.handshake=-this.handshake):r.handshake=-this.handshake,r.state.set("block",!0)));return this.owner.triggerEvent("update-group-id"),this.updateRendering(),r},detachPermanently:function(t){this.detach(t),this.entities.length?this.updateRendering():this.owner.parent.removeEntity(this.owner)}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",initialize:function(){this.pins=this.owner.pins=Array.setUp()},events:{},methods:{destroy:function(){this.pins.recycle(),this.pins=this.owner.pins=null}},publicMethods:{addPin:function(t){this.pins.push(t),this.owner.pinsImmovable&&(t.triggerEvent("input-off"),t.interactive=!1)},removePin:function(t){var e=this.pins,i=e.indexOf(t);i>=0&&e.greenSplice(i)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.getPointer"),i=new t(0,0),s=function(t){var s=t.pin||t,n=this.owner.velcroed.indexOf(s),r=null,a=[0,-2,2],o=0;if(-1===s.getPinnedEntities().indexOf(this.owner)){for(r=this.owner.body.GetFixtureList();0!==e(r);){for(o=0;o<a.length;o++)if(i.Set((t.x+a[o])/30,(t.y+a[o])/30),r.TestPoint(i))return t.panelled=this.owner,t.state&&t.state.set("panelled",!0),void(-1===n&&this.owner.velcroed.push(s));r=r.GetNext()}-1!==n&&this.owner.velcroed.splice(n,1)}};platypus.createComponentClass({id:"Pinnable",properties:{pinLocations:null,validate:!0},publicProperties:{z:0,velcro:!1,velcroed:null},initialize:function(){this.owner.parent.pins;var t=this.pinLocations,e=0,i=t&&t.length||0;for(this.onlyRemovingComponentSoDontDropThePins=!1,this.pins=Array.setUp(),e=0;e<i;e++)this.addPin(t[e]);this.velcroed=[],this.velcro&&this.addEventListener("pin-on-panel",s)},events:{"peer-entity-added":function(t){"pin"!==t.type||t.handshake||this.owner.triggerEvent("pin-on-panel",t)},"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.PinnableFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.validate&&t.valid&&this.tryAdjustment(t.entity,t)},"update-group-id":function(t){var e=this.pins,i=e.length,s=this.velcroed.length;for(this.owner.groupId=t;i--;)t!==e[i].groupId&&e[i].triggerEvent("update-group-id",t);for(;s--;)t!==this.velcroed[s].groupId&&this.velcroed[s].triggerEvent("update-group-id",t)},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){this.pins.push(t)},"resolve-bodies":function(){var t=this.owner;t.body&&t.matchBodyToEntity()},"pin-removed":function(t){for(var e=this.pins,i=e.length;i--;)if(t===e[i])return void e.greenSplice(i)},"begin-pin-group-movement":function(t){var e=this.pins,i=e.length;for(this.owner.triggerEvent("include-in-group",t);i--;)e[i].triggerEvent("include-in-group",t)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.pins,i=e.length,s=!1;i--;)e[i].triggerEvent("include-in-group",t),e[i].immobile&&(s=!0);if(this.owner.movable&&s)for(i=e.length;i--;)e[i].split(this.owner);else this.prepareForBreakage=!0},"break-away":function(){var t=this.pins,e=t.length;if(this.prepareForBreakage)for(this.prepareForBreakage=!1;e--;)t[e].split(this.owner)},"include-in-group":function(){this.prepareForBreakage=!1},"remove-pinnable-component":function(){this.owner.removeComponent(this),this.owner.parent.triggerEvent("child-entity-updated",this.owner)}},methods:{addPin:function(t){var e=this.owner,i=this.createOrFindPin({x:e.x+t.x,y:e.y+t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1},e.parent);return this.pins.push(i),i.getPinnedEntities().length?i.attach(e,!0,!0):i.attach(e,!0),i},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins),s=this.pins.indexOf(i);return i&&s<0?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1}})},findPin:function(t,e){var i,s,n=platypus.game.app.config.pins.mergeDistance,r=0,a=null,o=e&&e.length,h=n*n,l=null;if(o)for(;o--;)a=e[o],i=a.x-t.x,s=a.y-t.y,(r=i*i+s*s)<h&&a.handshake+t.handshake===0&&(h=r,l=a);return l},tryAdjustment:function(t,e){var i=this.pins,s=i.length;if(!this.alreadyTryingAdjustment){for(this.alreadyTryingAdjustment=!0;s--;)t!==i[s]&&i[s].triggerEvent("validate-constraint",e);this.alreadyTryingAdjustment=!1}}},publicMethods:{destroyThePins:function(){var t=this.pins,e=t.length;if(!this.onlyRemovingComponentSoDontDropThePins)try{for(;e--;)t[e].detachPermanently(this.owner)}catch(t){}t.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinnableFrozen",initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.removeComponent(this),t.addComponent(new platypus.components.Pinnable(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Entity"),i=include("createjs.Tween"),s=include("createjs.Ease"),n=!1,r=!1;platypus.createComponentClass({id:"PlantLogic",properties:{name:"",sunLvl:0,speedMod:1,soil:null,compostOnly:!1,effort:1,score:0,size:1,speed:.1,noStages:!1,manager:null,flowers:!1,savedData:null},publicProperties:{age:0,canHarvest:!1,plantID:0,parts:null,obstacles:null,scale:0},initialize:function(){this.finalSize=0,this.maxSize=1,this.plantID=this.getRandomInt(1,1e6),this.bigBumping=!1,this.revBumping=!1,this.canHarvestC=0,this.sizeBumping=!1,this.activeStageNum=1,this.activeStage=null,this.lastBump=0,this.startScale=.4,this.desat=1,this.stars=[],this.parts=[],this.obstacles=[],this.camera=t.setUp()},events:{"camera-update":function(t){this.camera.set(t.viewport)},"space-recalculated":function(t,e){this.owner.triggerEvent("space-recalc-2",[t,e,this.scale])},"save-plant-state":function(t){t.stageNum=this.activeStageNum,t.scale=this.scale,t.x=this.owner.x,t.maxSize=this.maxSize,this.owner.parent.triggerEvent("save-plant-state-2",t)},adopted:function(){var t=null,e=0,i=1,s="",n=this.noStages?1:4,r=0,a=this.owner,o=null;for(this.owner.parent.triggerEvent("plant-added",this.name),this.flowers?this.noStages?this.owner.isDecoFlower=!0:this.owner.flowers=!0:this.noStages&&(this.owner.isWeed=!0),this.compostOnly&&this.owner.parent.triggerEvent("seed-planted",Math.round(this.owner.x),!0),this.size*=.2*Math.random()+.9,this.speed*=.2*Math.random()+.9,this.soil&&(this.soil.opacity=0,this.soil.z=5008),null!==this.savedData&&(this.scale=this.savedData.scale||1,i=this.savedData.stageNum||1,this.activeStageNum=i,this.oldStageNum=i,this.maxSize=this.savedData.maxSize,this.owner.addComponent(new platypus.components.HealthLogic(this.owner,{sunLvl:this.savedData.sunLvl,sunNeed:this.savedData.sunNeed,waterLvl:this.savedData.waterLvl,waterNeed:this.savedData.waterNeed,spaceLvl:this.savedData.spaceLvl,spaceNeed:this.savedData.spaceNeed,health:this.savedData.health,speedMod:this.savedData.speedMod}))),this.stages=[],e=1;e<=n;e++){switch(this.name){case"weed":t={width:250,height:300,x:-175,y:-300};break;case"corn":t={width:300,height:700,x:-100,y:-500};break;case"lettuce":case"strawberry":t={width:350,height:300,x:-150,y:-175};break;case"potato":case"tomato":t={width:300,height:500,x:-150,y:-250};break;case"pumpkin":case"watermelon":t={radius:225};break;default:t={width:100,height:300,x:-50,y:-150}}if(!this.noStages){switch(e){case 1:r=.5;break;case 2:r=.7;break;case 3:r=.85;break;case 4:r=1}for(s in t)t.hasOwnProperty(s)&&(t[s]*=r)}o=a.parent.addEntity({id:"stage"+e,components:[{type:"Desaturator"},{type:"RenderSprite",spriteSheet:"plant-"+this.name,rotate:!0,interactive:!0,animationMap:{default:this.owner.isWeed?this.getRandomInt(1,6).toString():e.toString()}},{type:"PlantStageLogic",plantMaster:this.owner,stage:e},{type:"LogicButton",onPress:"plant-click",passthroughOnMovement:!0},{type:"LAPDwellTimer"}],properties:{x:a.x,y:a.y,z:4990+e-this.effort,hitArea:t}}),e===i?this.activateStage(o,0!==this.scale?this.scale:this.startScale,1):this.deactivateStage(o),this.stages.push(o)}},"adjust-max-size":function(t){this.maxSize=t},"desaturate-parts":function(t){this.desat=t,this.activeStage?this.activeStage.triggerEvent("desaturate",t):platypus.debug.warn("PlantLogic: No active stage.")},"sun-clicked":function(){this.canHarvest||this.sizeBumping||this.compostOnly||(this.activeStage.sunAnim(),this.owner.isWeed||this.parts.push({part_type:"sunlight",mini_game:platypus.game.app.name,location:{x:this.owner.x,y:this.owner.y}}))},"handle-logic":function(t){var e=66,r=0,a=0,o=0,h=0,l=0,c=0,p=this.activeStageNum,d=0,u=this.activeStage,g=null,m=!1;if(!this.removing){if(this.age+=t.delta,this.bigBumping||(this.scale<this.maxSize&&(this.scale+=.0018*this.speed*this.speedMod*this.maxSize),d=this.translate(this.scale,0,1,this.startScale,1,!0)*this.maxSize*this.size,this.scale>this.lastBump+.05&&(this.noStages||(this.scale>.25&&this.scale<.4?this.activeStageNum=2:this.scale>.45&&this.scale<.65?this.activeStageNum=3:this.scale>=.7&&this.scale<1&&(this.activeStageNum=4),p!==this.activeStageNum&&(m=!0,this.activateStage(this.stages[this.activeStageNum-1],d,0))),this.sizeBumping=!0,this.lastBump=this.scale,u.scaleX<d?(m?this.bigBump(u):i.get(u).to({scaleX:d,scaleY:d},750,s.backInOut).call(function(){this.sizeBumping=!1}.bind(this)),m&&(i.get(u).to({opacity:0},750,s.backInOut).call(function(){u.destroyed||this.deactivateStage(u)}.bind(this)),i.get(this.activeStage).to({opacity:1},750,s.backInOut),this.bigBump(this.activeStage),this.owner.parent.parent.layers[0].triggerEvent("changeStage"))):this.sizeBumping=!1)),this.owner.activeStageNum=this.activeStageNum,4===this.activeStageNum&&!this.canHarvest&&!this.compostOnly){for(this.canHarvest=!0,this.owner.flag="canHarvest",n||(n=!0,this.owner.parent.parent.layers[0].triggerEvent("plant-good-1")),h=0;h<Math.max(8*platypus.fxModifier,2);h++)this.stars.push(this.addStarParticle());this.activeStage.z=4999,this.owner.parent.parent.layers[0].triggerEvent("plantReady")}if(this.canHarvest)for(this.canHarvestC+=.01,this.canHarvestC>2*Math.PI&&(this.canHarvestC-=2*Math.PI),l=2*Math.PI/this.stars.length,"watermelon"!==this.name&&"pumpkin"!==this.name&&"lettuce"!==this.name||(e=120),r=e+10*Math.cos(this.canHarvestC),c=0;c<this.stars.length;c++)g=this.stars[c],(o=this.canHarvestC+a)>2*Math.PI&&(o-=2*Math.PI),o>0&&g.z<this.owner.z&&(g.z=9990),o>Math.PI&&g.z>this.owner.z&&(g.z=4900),g.x=this.owner.x+Math.cos(o)*r,g.y=this.owner.y-15+Math.sin(o)*r*.5,a+=l}},"prepare-logic":function(){var t=0;if(!this.removing){if(this.removeThisNow){for(this.removeThisNow=!1,this.owner.parent.triggerEvent("seed-removed",Math.round(this.owner.x)),t=0;t<this.stages.length;t++)this.stages[t].removeSelf();this.soil&&this.soil.removeSelf(),this.owner.removeSelf()}if(this.removeThis){for(this.removeThis=!1,this.removing=!0,t=0;t<this.stages.length;t++)i.get(this.stages[t]).to({opacity:0,scaleX:.1,scaleY:.1},500,s.sineIn);this.soil&&i.get(this.soil).to({opacity:0},500,s.sineIn).call(function(){this.soil&&!this.soil.destroyed&&this.soil.removeSelf()}.bind(this)),i.get(this.owner).to({opacity:0},500,s.sineIn).call(function(){var t=0;for(t=0;t<this.stages.length;t++)this.stages[t]&&!this.stages[t].destroyed&&this.stages[t].removeSelf();this.owner&&!this.owner.destroyed&&this.owner.removeSelf()}.bind(this))}}},"remove-weed":function(t){this.owner.isWeed&&Math.round(this.owner.x)===t&&(this.removeThisNow=!0)},remove:function(){var t=0,e="Composted",n=null,a=0;if(this.owner.parent.triggerEvent("seed-removed",Math.round(this.owner.x)),this.owner.parent.triggerEvent("plant-removed",this.name,this.owner.isWeed?Math.round(this.owner.x):0),this.removeThis=!0,this.canHarvest){for(t=0;t<this.stars.length;t++)this.stars[t].removeSelf();this.stars=null}this.canHarvest&&(e="Harvested",this.owner.flag="canHarvest",r||(r=!0,this.owner.parent.parent.layers[0].triggerEvent("plant-good-2")),this.owner.parent.parent.layers[0].triggerEvent("addToHarvest")),n=this.owner.parent.parent.layers[0].addEntity({id:"veg",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:this.name}}],properties:{x:this.owner.x,y:this.owner.y,z:1e5}}),"Harvested"===e?(e+=": "+(a=this.getScore())+" Points!",i.get(n).to({x:(this.camera.left+this.camera.right)/2,y:-100},1e3,s.sineInOut).call(function(){platypus.game.currentScene&&platypus.game.currentScene.layers[2]&&(platypus.game.currentScene.layers[2].triggerEvent("add-to-harvest",this.name),platypus.game.currentScene.layers[2].triggerEvent("add-to-score",a),n&&!n.destroyed&&n.removeSelf())}.bind(this))):i.get(n).to({x:2e3,y:800},1e3,s.sineInOut).call(function(){n&&!n.destroyed&&n.removeSelf()}.bind(this)),this.owner.parent.parent.layers[2].addEntity({type:"instructions",properties:{customText:e,x:0,y:0,z:9e4}})},"water-level-adjusted":function(t,e){this.soil&&(this.soil.opacity=.05*t),!this.owner.isWeed&&e&&this.parts.push({part_type:"water",mini_game:platypus.game.app.name,location:{x:this.owner.x,y:this.owner.y}})},compostApplied:function(){this.owner.parent.parent.layers[0].triggerEvent("healthBoost"),this.healthStars(),this.owner.isWeed||this.parts.push({part_type:"compost",mini_game:platypus.game.app.name,location:{x:this.owner.x,y:this.owner.y}})},pollinated:function(){this.owner.parent.parent.layers[0].triggerEvent("healthBoost"),this.healthStars(),this.owner.isWeed||this.parts.push({part_type:"pollination",mini_game:platypus.game.app.name,location:{x:this.owner.x,y:this.owner.y}})},"mercury-sun-damage":function(){var t=platypus.game.app;this.revBump(),!this.owner.isWeed&&this.obstacles.indexOf("mercury-sun")<0&&this.obstacles.push("mercury-sun"),t.analyticsEmitter.ouchOnPlant(t.name,t.getPlots(),platypus.getActionQueues(),"heatwave")},"aphid-damage":function(){var t=platypus.game.app;this.revBump(),!this.owner.isWeed&&this.obstacles.indexOf("aphid-damage")<0&&this.obstacles.push("aphid-damage"),t.analyticsEmitter.ouchOnPlant(t.name,t.getPlots(),platypus.getActionQueues(),"aphid")}},methods:{bigBump:function(t){this.bigBumping=!0,t.bigBump(function(){this.bigBumping=!1}.bind(this))},revBump:function(){this.revBumping||this.owner.isWeed||(this.activeStage.triggerEvent("desaturate",0),this.revBumping=!0,this.activeStage.revBump(function(){this.revBumping=!1}.bind(this)))},healthStars:function(){var t=(15*this.scale+5)*platypus.fxModifier>>0,e=0;for(e=0;e<t;e++)this.owner.parent.addEntity({id:"star",components:[{type:"RenderSprite",spriteSheet:"fx2",animationMap:{default:"star"},rotate:!0},{type:"ParticleFloatLogic"}],properties:{x:this.owner.x+this.getRandomInt(-75*this.scale,75*this.scale),y:this.owner.y-this.getRandomInt(0,200*this.scale),z:this.owner.z+1,scaleX:.25,scaleY:.25,opacity:1}})},addStarParticle:function(){return this.owner.parent.addEntity({id:"star-particle",components:[{type:"RenderSprite",spriteSheet:"fx2",animationMap:{default:"star"},rotate:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+2e3,scaleX:.15,scaleY:.15,opacity:.66}})},destroy:function(){this.soil=null,this.activeStage=null,this.manager=null},activateStage:function(t,e,i){this.activeStage=t,t.active=!0,t.triggerEvent("show-sprite"),t.scaleX=t.scaleY=e,t.opacity=i,t.triggerEvent("desaturate",this.desat)},deactivateStage:function(t){t.active=!1,t.triggerEvent("hide-sprite")}},publicMethods:{getStageNum:function(){return this.activeStageNum},getHeight:function(){return 33*this.activeStageNum},getScore:function(){return Math.round(this.score*this.size)},clicked:function(){var t=null;this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),t=[{id:this.canHarvest?"sendToHarvest":"sendToCompost",callback:function(){this.owner&&!this.owner.destroyed&&this.owner.parent.triggerEvent("plant-clicked",this.owner,"shovel")}.bind(this)}],this.noStages||this.canHarvest||("level-1"!==this.manager.getLevel()&&t.push({id:"water",callback:function(){this.owner&&!this.owner.destroyed&&this.owner.parent.triggerEvent("plant-clicked",this.owner,"water")}.bind(this)}),"level-1"===this.manager.getLevel()||"level-2"===this.manager.getLevel()||"level-3"===this.manager.getLevel()||this.owner.compostApplied||t.push({id:"compost",callback:function(){this.owner&&!this.owner.destroyed&&this.owner.parent.triggerEvent("plant-clicked",this.owner,"compost")}.bind(this)})),this.owner.parent.addEntity({type:"action-select",properties:{targetEntity:this.owner,x:this.owner.x,y:this.owner.y,options:t}})},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},getEffort:function(){return this.effort},clamp:function(t,e,i){return t<e?e:t>i?i:t},translate:function(t,e,i,s,n,r){var a=(t-e)/(i-e)*(n-s)+s;return r?s<n?this.clamp(a,s,n):this.clamp(a,n,s):a}},getAssetList:function(){for(var t=null,i=["action-select","instructions"],s=i.length,n=Array.setUp("assets/images/seedSelect.png","assets/images/plants-0.png","assets/images/plants-1.png","assets/images/fx2.png");s--;)t=e.getAssetList({type:i[s]}),n.union(t),t.recycle();return n}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"PlantStageLogic",properties:{stage:0},publicProperties:{active:!1,plantMaster:null},initialize:function(){this.tweening=!1},events:{"plant-click":function(){this.plantMaster.clicked?this.plantMaster.clicked(this.owner):this.owner.removeSelf()}},publicMethods:{bigBump:function(i){var s=this.owner.scaleX,n=this.owner.scaleY;this.tweening?i():(this.tweening=!0,t.get(this.owner).to({scaleX:s+.25,scaleY:n+.25},500,e.sineOut).call(i).to({scaleX:s,scaleY:n},250,e.sineIn).call(function(){this.tweening=!1}.bind(this)))},revBump:function(i){var s=this.owner.scaleX,n=this.owner.scaleY;this.tweening?i():(this.tweening=!0,t.get(this.owner).to({scaleX:.75*s,scaleY:.75*n},250,e.sineOut).call(i).to({scaleX:s,scaleY:n},250,e.sineIn).call(function(){this.tweening=!1}.bind(this)))},sunAnim:function(){var i=this.owner.scaleX,s=this.owner.scaleY;this.tweening||(this.tweening=!0,t.get(this.owner).to({scaleX:i+.1,scaleY:s+.1},100,e.sineOut).to({scaleX:i,scaleY:s},100,e.sineIn).call(function(){this.tweening=!1}.bind(this)))}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.AABB");platypus.createComponentClass({id:"PointerBehaviors",properties:{bounceDistance:30,scaleBy:1.25},initialize:function(){this.degToRad=Math.PI/180,this.originalX=this.owner.x,this.originalY=this.owner.y,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY,this.camera=i.setUp(),this.ox=0,this.oy=0,this.entities=null},events:{"handle-logic":function(t){this.entities=t.entities},next:function(t){this.owner.parent.triggerEvent(t)},move:function(t){var e=null,i=0,s=0,n=0,r=null,a=null;if(this.owner.x=t.x,this.owner.y=t.y,t.left&&(this.owner.x=this.camera.left+t.left),t.top&&(this.owner.y=this.camera.top+t.top),t.right&&(this.owner.x=this.camera.right-t.right),t.bottom&&(this.owner.y=this.camera.bottom-t.bottom),t.entity)for(a=t.entity[0],i=t.entity[1],s=t.entity[2],n=0;n<this.entities.length;n++)if((r=this.entities[n]).type===a){this.owner.x=r.x+i,this.owner.y=r.y+s;break}if(t.entityFlagged)for(e=t.entityFlagged[0],i=t.entityFlagged[1],s=t.entityFlagged[2],n=0;n<this.entities.length;n++)if((r=this.entities[n]).flag===e){this.owner.x=r.x+i,this.owner.y=r.y+s;break}this.owner.rotation=t.rotation||this.owner.rotation,this.originalX=this.owner.x,this.originalY=this.owner.y},"smooth-move":function(i){this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner).to({x:i.x,y:i.y,rotation:i.rotation||this.owner.rotation},i.time||250,e.sineInOut).call(function(){this.originalX=this.owner.x,this.originalY=this.owner.y}.bind(this))},show:function(){t.get(this.owner).to({opacity:1},100)},hide:function(){t.get(this.owner).to({opacity:0},100)},"start-pulse":function(i){i=i||-1,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY,t.get(this.owner,{loop:i}).to({scaleX:this.originalScaleX*this.scaleBy,scaleY:this.originalScaleY*this.scaleBy},250,e.sineInOut).to({scaleX:this.originalScaleX,scaleY:this.originalScaleY},250,e.sineInOut)},"start-bounce":function(i){i=i||-1,this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner,{loop:i}).to({x:this.originalX+Math.cos(this.owner.rotation*this.degToRad)*this.bounceDistance,y:this.originalY+Math.sin(this.owner.rotation*this.degToRad)*this.bounceDistance},250,e.sineInOut).to({x:this.originalX,y:this.originalY},250,e.sineInOut)},stop:function(){t.removeTweens(this.owner),this.owner.x=this.originalX,this.owner.y=this.originalY,this.owner.scaleX=this.originalScaleX,this.owner.scaleY=this.originalScaleY},"set-state":function(t){this.owner.state.set(t.state,t.value)},"camera-update":function(t){this.camera.set(t.viewport)}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.Data"),e=0,i=function(t,e,i){t.worldToWindow(i,!0,i),e.windowToWorld(i,!0,i),i.pixiEvent.stopPropagation()},s=function(t){t.pixiEvent.stopPropagation()},n=function(i){this.owner.parent.zooming||this.newEntity||(this.convert(i),this.newEntityReady=!1,this.storedInputs.length=0,this.newEntity=this.targetLayer.addEntity({type:this.spawns,properties:{savable:!0,movable:!0,neverMovedPreviously:this.owner,x:i.x,y:i.y}},function(t,i){var s=!1,n=this.storedInputs,r=0;for(i.relayPointer?(this.newEntity=i.relayPointer,i.relayPointer=null):this.newEntity=i,this.newEntityReady=!0,this.newEntity.triggerEvent("pointerdown",t),r=0;r<n.length;r++)this.newEntity.triggerEvent(n[r].event.type,n[r]),s=s||n[r].done,n[r].recycle();n.length=0,"pointerup"!==t.event.type&&"touchend"!==t.event.type||(this.newEntity.triggerEvent("pointerup",t),this.newEntity=null),"pointerupoutside"===t.event.type&&(this.newEntity.triggerEvent("pointerupoutside",t),this.newEntity=null),"pointercancel"===t.event.type&&(this.newEntity.triggerEvent("pointercancel",t),this.newEntity=null),s&&(this.newEntity=null),t.recycle(),e+=1e-6,i.z+=e}.bind(this,t.setUp("entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y))))};platypus.createComponentClass({id:"PointerPassalong",properties:{spawnEvent:"pointerdown",targetLayerType:"action-layer"},publicProperties:{spawns:""},initialize:function(){this.newEntity=null,this.targetLayer=null,this.convert=s,this.storedInputs=Array.setUp(),this.addEventListener(this.spawnEvent,n.bind(this))},events:{adopted:function(){var t=this.owner.parent.parent.layers,e=t.length,s=this.targetLayerType;if(s){for(;e--;)if(s===t[e].type){this.targetLayer=t[e],this.convert=i.bind(null,this.owner.parent,this.targetLayer);break}this.targetLayer||platypus.debug.warn('PointerPassalong: "'+s+'" is not an available layer in this scene. Entity will be spawned on the same layer.')}},pointermove:function(t){this.passEvent("pointermove",t)},pointerup:function(t){this.passEvent("pointerup",t,!0)},pointerupoutside:function(t){this.passEvent("pointerupoutside",t,!0)},pointercancel:function(t){this.passEvent("pointercancel",t,!0)}},methods:{passEvent:function(e,i,s){this.newEntity&&(this.convert(i),this.newEntityReady?(this.newEntity.triggerEvent(e,i),s&&(this.newEntity=null)):this.storedInputs.push(t.setUp("done",s,"entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y)))},destroy:function(){this.storedInputs.recycle(),this.storedInputs=null}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Region",properties:{},publicProperties:{height:0,width:0,x:0,y:0},initialize:function(){this.aabb=t.setUp(this.x,this.y,this.width,this.height),this.entities=Array.setUp()},events:{adopted:function(){var t=this.owner,e=t.parent;this.addBorderingRegions(),e.triggerEvent("building-area-ready",t),e.triggerEvent("relocate",t)},"prepare-for-simulation":function(){for(var t=this.entities,e=t.length;e--;)this.owner.parent.removeEntity(t[e]);t.length=0,this.owner.body.SetActive(!1)},"simulation-stopped":function(){this.addBorderingRegions(),this.owner.body.SetActive(!0)},"handle-logic":function(){this.x===this.aabb.x&&this.y===this.aabb.y||this.aabb.move(this.x,this.y)}},methods:{addBorderingRegions:function(){var t=this.aabb,e=this.entities,i=this.owner.parent;e.push(i.addEntity({type:"trash",properties:{width:500,height:2e3,x:-500,y:0}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.left-250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.top-250}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.right+250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.bottom+250}}))},destroy:function(){this.aabb.recycle(),this.aabb=null,this.entities.recycle(),this.entities=null}},publicMethods:{inBounds:function(t,e){return this.aabb.containsPoint(t,e)}}})}(),function(){"use strict";var t,e=include("PIXI.Graphics"),i=include("platypus.components.RenderContainer"),s=(t=function(t,e){var i=0,s=e.indexOf("("),n=e.substring(0,s),r=e.substring(s+1,e.indexOf(")"));if(r.length){for(i=(r=r.greenSplit(",")).length;i--;)r[i]=+r[i];t[n].apply(t,r),r.recycle()}else t[n]()},function(e,i){var s=0,n=i.greenSplit(".");for(s=0;s<n.length;s++)t(e,n[s]);n.recycle()});platypus.createComponentClass({id:"RenderGraphics",properties:{offsetX:0,offsetY:0,offsetZ:0,shape:""},publicProperties:{color:16776960,width:100,height:100},initialize:function(t){var e,n,r,a,o;"string"==typeof this.color&&(this.color=parseInt(this.color.replace("#","0x"),16)),e=this,n=this.shape,r=this.color,a=this.width,o=this.height,e.beginFill(r,1),n&&"string"==typeof n?s(e,n):n&&n.radius?e.dc(n.x||0,n.y||0,n.radius):n&&n.width&&n.height?e.r(n.x||0,n.y||0,n.width,n.height):e.r(-a/2,-o/2,a,o),e.endFill(),this.x=this.offsetX,this.y=this.offsetY,this.z=this.offsetZ,this.owner.container?this.addToContainer():this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this)))},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this),t.reorder=!0},destroy:function(){this.owner.container.removeChild(this)}}},e)}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.components.RenderContainer"),i=include("PIXI.Graphics"),s=include("platypus.Vector");platypus.createComponentClass({id:"RenderShape",properties:{mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,rotate:!1,mirror:!1,flip:!1,visible:!0,cache:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0,shape:null},initialize:function(){var n=null,r=this.owner,a=r.shape,o=a&&a.points||null,h=this.gfx=new i,l=a&&a.translation?s.setUp(a.translation.x,a.translation.y):s.setUp(0,0);h.beginFill(16777215,1),o?h.drawPolygon(function(t,e){var i=Array.setUp(),s=0;for(s=0;s<t.length;s++)i.push(t[s].x+e.x,t[s].y+e.y);return i}(o,{x:l.x,y:l.y})):a&&"circle"===a.type?h.drawCircle(this.offsetX,this.offsetY,a.radius||r.radius||r.width/2):h.drawRect(this.offsetX-r.width/2,this.offsetY-r.height/2,r.width,r.height),h.endFill(),l.recycle(),this.owner.container?this.addToContainer():(n=t.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new e(this.owner,n,this.addToContainer.bind(this))),n.recycle())},events:{},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.gfx),t.reorder=!0}}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.RenderContainer"),s=include("platypus.PIXIAnimation");platypus.createComponentClass({id:"RenderSpan",properties:{spriteSheet:null,offsetX:0,offsetY:0,offsetZ:0,endA:"end-a",endAReversed:"",endALength:40,endB:"end-b",endBReversed:"",endBLength:40,middle:"middle",middleReversed:"",middleLength:120,scaleLength:!1},publicProperties:{scaleX:1,stretchLength:0},initialize:function(){var t=null,n=s.formatSpriteSheet(this.spriteSheet),r=this.reversed=this.owner.state.get("reversed");n===s.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),this.endAReversed||(this.endAReversed=this.endA),this.middleReversed||(this.middleReversed=this.middle),this.endBReversed||(this.endBReversed=this.endB),this.sprite=new s(n,r?this.middleReversed:this.middle),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=platypus.modifyAllAssets,this.sprite.scale.y=platypus.modifyAllAssets,this.spriteEndA=new s(n,r?this.endAReversed:this.endA),this.spriteEndA.y=this.offsetY,this.spriteEndA.z=this.offsetZ+.01,this.spriteEndA.scale.x=platypus.modifyAllAssets,this.spriteEndA.scale.y=platypus.modifyAllAssets,this.spriteEndB=new s(n,r?this.endBReversed:this.endB),this.spriteEndB.y=this.offsetY,this.spriteEndB.z=this.offsetZ+.02,this.spriteEndB.scale.x=platypus.modifyAllAssets,this.spriteEndB.scale.y=platypus.modifyAllAssets,this.currentStretchLength=0,this.stretch(this.stretchLength),this.owner.container?this.addToContainer():(t=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this))),t.recycle()),n.recycleSpriteSheet()},events:{"handle-render":function(){this.sprite&&this.stretchLength!==this.currentStretchLength&&this.stretch(this.stretchLength)},"state-changed":function(){var t=this.owner.state.get("reversed");this.reversed!==t&&(this.reversed=t,t?(this.spriteEndA.gotoAndPlay(this.endAReversed),this.sprite.gotoAndPlay(this.middleReversed),this.spriteEndB.gotoAndPlay(this.endBReversed)):(this.spriteEndA.gotoAndPlay(this.endA),this.sprite.gotoAndPlay(this.middle),this.spriteEndB.gotoAndPlay(this.endB)))}},methods:{stretch:function(t){var e=this.scaleLength?1:1/this.scaleX,i=(t||this.middleLength+(this.endALength+this.endBLength)/2)*e,s=this.sprite,n=this.spriteEndA,r=this.spriteEndB,a=i/2-1;n.x=-a+this.offsetX,r.x=a+this.offsetX,s.scale.x=platypus.modifyAllAssets*(i-this.endALength/2-this.endBLength/2)/this.middleLength},addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.addChild(this.spriteEndA),t.addChild(this.spriteEndB),t.reorder=!0},destroy:function(){var t=this.owner.container;t.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null,t.removeChild(this.spriteEndA),this.spriteEndA.destroy(),this.spriteEndA=null,t.removeChild(this.spriteEndB),this.spriteEndB.destroy(),this.spriteEndB=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,s){var n=null,r=0,a=null,o=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||s.spriteSheet;if(Array.isArray(h)){for(r=h.length,a=Array.setUp();r--;)n=t(h[r],o),a.union(n),n.recycle();return a}return t(h,o)})})}(),function(){"use strict";var t,e,i=include("PIXI.spine.core.TextureAtlas",!1),s=include("PIXI.spine.core.AtlasAttachmentLoader",!1),n=include("PIXI.BaseTexture"),r=include("platypus.Data"),a=include("platypus.components.EventRender"),o=include("platypus.components.RenderContainer"),h=include("PIXI.spine.core.SkeletonJson",!1),l=include("PIXI.spine.Spine",!1),c=include("platypus.components.StateRender");l&&platypus.createComponentClass({id:"RenderSpine",properties:{animationMap:null,mask:null,interactive:!1,mixTimes:0,offsetX:0,offsetY:0,offsetZ:0,atlas:"",skeleton:null,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0},publicProperties:{dragMode:!1,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,x:0,y:0,z:0},initialize:(e=function(t,e,i){var s,r,a=(s=e,(r=platypus.game.app.assetManager.cache.read(s.substring(s.lastIndexOf("/")+1,s.lastIndexOf("."))))||platypus.debug.warn('RenderSpine: "'+s+'" is not a loaded asset.'),new n(r));i(a),a.isLoading?a.on("loaded",t):t()},function(t,n){var p,d="",u=null,g=platypus.game.settings,m=g.atlases[this.atlas+"-"+platypus.modifyAllAssets],y=g.skeletons[this.skeleton],f=new i(m,e.bind(null,n)),v=new h(new s(f)).readSkeletonData(y),w=this.spine=new l(v);return w.state.addListener({event:function(t,e){var i=e.data.name;this.playAnimation(i)&&this.spine.update(1e-6),this.owner.trigger(i,e.data)}.bind(this),complete:function(){this.owner.triggerEvent("animation-ended",this.currentAnimation)}.bind(this)}),w.autoUpdate=!1,p=function(t,e){var i=null,s="";if(t)return t;for(s in i={},e)e.hasOwnProperty(s)&&(i[s]=s);return i}(this.animationMap,y.animations),this.stateBased=p&&this.stateBased,this.eventBased=p&&this.eventBased,p&&(d=p.default||"",this.eventBased&&(u=r.setUp("animationMap",p,"component",this),this.owner.addComponent(new a(this.owner,u)),u.recycle()),this.stateBased&&(u=r.setUp("animationMap",p,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new c(this.owner,u)),u.recycle())),this.mixTimes&&this.setMixTimes(this.mixTimes),d&&(this.currentAnimation=d,w.state.setAnimation(0,d,!0)),w.x=this.offsetX,w.y=this.offsetY,w.z=this.offsetZ,this.owner.container?this.addToContainer():(u=r.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new o(this.owner,u,this.addToContainer.bind(this))),u.recycle()),!0}),events:{"handle-render":function(t){this.spine&&(this.owner.triggerEvent("update-animation",!0),this.spine.update(t.delta/1e3))},"set-mix-times":function(t){this.setMixTimes(t)},hide:function(){this.visible=!1},show:function(){this.visible=!0},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t){this.playAnimation(t)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.spine),t.reorder=!0},playAnimation:function(t){var e=this.spine;return!(!t||!e.state.hasAnimation(t))&&(this.currentAnimation=t,e.state.setAnimation(0,t,!0),this.paused=!1,!0)},stopAnimation:function(t){var e=this.spine;t&&e.state.hasAnimation(t)&&(this.currentAnimation=t,e.state.setAnimation(0,t,!1)),this.paused=!0},setMixTimes:function(t){var e=this.spine,i=e.spineData.animations,s=0,n=0,r=0,a="",o=e.stateData;if("number"==typeof t)for(n=i.length;n--;)for(r=i.length;r--;)n!==r&&o.setMix(i[n].name,i[r].name,t);else for(a in t)t.hasOwnProperty(a)&&(s=a.indexOf(":"))>=0&&o.setMix(a.substring(0,s),a.substring(s+1),t[a]);this.mixTimes=o.animationToMixTime},destroy:function(){this.owner.container.removeChild(this.spine),this.spine.destroy(),this.spine=null,this.mixTimes=null}},getAssetList:(t=function(t,e){var i=Array.setUp(),s=null,n=0;if(t){if(1===(s=t.split("\n")).length){if(!(t=e[t+"-"+platypus.modifyAllAssets]))return i;s=t.split("\n")}for(n=s.length;n--;)".png"===s[n].substr(s[n].length-4)&&i.push(s[n])}return i},function(e,i,s){var n=null,r=0,a=null,o=platypus.game.settings.atlases,h=e.atlas||i.atlas||s.atlas;if(Array.isArray(h)){for(r=h.length,a=Array.setUp();r--;)n=t(h[r],o),a.union(n),n.recycle();return a}return t(h,o)})})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.EventRender"),s=include("platypus.components.RenderContainer"),n=include("platypus.PIXIAnimation"),r=include("platypus.components.StateRender");platypus.createComponentClass({id:"RenderSprite",properties:{localScaleX:1,localScaleY:1,spriteSheet:null,animationMap:null,mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,restart:!0,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0,cache:!1,forcePlayThrough:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0},initialize:function(){var t,a="",o=null,h=n.formatSpriteSheet(this.spriteSheet);h===n.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),t=function(t,e){var i=null,s="",n=null,r=0;if(t)return t;if(Array.isArray(e.frames)&&1===e.frames.length)return null;for(s in i={},n=Array.setUp(),e.animations)e.animations.hasOwnProperty(s)&&(n.push(s),i[s]=s);if("default"===n[0])for(r=n.length,i={};r--;)i[n[r]]=n[r];return n.recycle(),i}(this.animationMap,h),this.stateBased=t&&this.stateBased,this.eventBased=t&&this.eventBased,t&&(a=t.default||"",this.eventBased&&(o=e.setUp("animationMap",t,"restart",this.restart,"component",this),this.owner.addComponent(new i(this.owner,o)),o.recycle()),this.stateBased&&(o=e.setUp("animationMap",t,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new r(this.owner,o)),o.recycle())),this.sprite=new n(h,a),this.sprite.on("complete",function(t){this.owner.triggerEvent("animation-ended",t)}.bind(this)),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=this.localScaleX*platypus.modifyAllAssets,this.sprite.scale.y=this.localScaleY*platypus.modifyAllAssets,this.owner.container?this.addToContainer():(o=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new s(this.owner,o,this.addToContainer.bind(this))),o.recycle()),h.recycleSpriteSheet()},events:{"handle-render":function(t){this.sprite&&(this.owner.triggerEvent("update-animation",!0),this.sprite.update(t.delta))},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t,e){this.playAnimation(t,e)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.reorder=!0},playAnimation:function(t,e){var i=this.sprite;t&&i.has(t)?i.gotoAndPlay(t,e):i.play()},stopAnimation:function(t){var e=this.sprite;t&&e.has(t)?e.gotoAndStop(t):e.stop()},destroy:function(){this.owner.container.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,s){var n=null,r=0,a=null,o=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||s.spriteSheet;if(Array.isArray(h)){for(r=h.length,a=Array.setUp();r--;)n=t(h[r],o),a.union(n),n.recycle();return a}return t(h,o)})})}(),function(){"use strict";var t,e=include("platypus.AABB"),i=include("platypus.PIXIAnimation"),s=include("springroll.Application"),n=include("PIXI.CanvasRenderer"),r=include("PIXI.Container"),a=include("PIXI.Graphics"),o=r,h=include("PIXI.Rectangle"),l=include("platypus.components.RenderContainer"),c=include("PIXI.RenderTexture"),p=include("PIXI.Sprite"),d=function(t,e,i){var s=e.baseTexture._glRenderTargets[t.CONTEXT_UID];s&&s.clear(i)},u=function(){return null},g=e.setUp(),m=function(t,e){return t.z-e.z},y=function(t){for(var e=1;e<t;)e*=2;return e},f=function(t,e){this.id=e,this.instances=Array.setUp(t),this.index=0,t.template=this},v={getNext:u,destroy:u},w=f.prototype;w.getNext=function(){var t=this.instances[this.index],e=null;return t||(e=this.instances[0],(t=this.instances[this.index]=new p(e.texture)).scale=e.scale,t.rotation=e.rotation,t.anchor=e.anchor),this.index+=1,t},w.clear=function(){this.index=0},w.destroy=function(){var t=0;for(t=0;t<this.instances.length;t++)this.instances[t].destroy();this.instances.recycle(),this.recycle()},recycle.add(f,!!springroll.Debug,"Template"),platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10,top:0,left:0},initialize:function(t){var a=platypus.modifyAllAssets,h=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=s.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=e.setUp(),this.tileWidth/=a,this.tileHeight/=a,this.scaleX*=a,this.scaleY*=a,this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=e.setUp(),this.cachePixels=e.setUp(),this.spriteSheet=i.formatSpriteSheet(this.spriteSheet),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof n?new r:new o(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new r,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=Array.setUp(this.createMap(h)),this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(y(this.layerWidth+2),this.maximumBuffer),this.cacheHeight=Math.min(y(this.layerHeight+2),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1),this.ready=!1,this.owner.container?this.addToContainer():this.owner.addComponent(new l(this.owner,t,this.addToContainer.bind(this)))},events:{"cache-sprite":function(t){this.cacheSprite(t)},"peer-entity-added":function(t){this.cacheSprite(t)},"add-tiles":function(t){var e=t.imageMap;e&&(this.imageMap.push(this.createMap(e)),this.updateCache=!0)},"change-tile":function(t,e,i,s){var n=this.imageMap;n&&(this.updateTile(t,n[s||0],e,i),this.updateCache=!0)},"camera-loaded":function(t){this.worldWidth=t.world.width,this.worldHeight=t.world.height,this.buffer&&!this.cacheAll&&this.updateBufferRegion(t.viewport)},"camera-update":function(t){this.ready&&this.updateCamera(t)},"handle-render":function(){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{addToContainer:function(){var t=this.container=this.owner.container,e=this.mapContainer,i=null,s=this.owner.z;t.reorder=!0,this.ready=!0,this.updateRegion(0),this.tileCache?(this.mapContainerWrapper=new r,this.mapContainerWrapper.addChild(e),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.render=this.renderCache,this.cacheTexture=c.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=i=new p(this.cacheTexture),i.scale.x=this.scaleX,i.scale.y=this.scaleY,i.z=s,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),t.addChild(i)):(this.render=this.renderCache,this.cacheAll=!1,this.cacheTexture=c.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=new p(this.cacheTexture),this.tilesSprite.scale.x=this.scaleX,this.tilesSprite.scale.y=this.scaleY,this.tilesSprite.z=s,this.cacheTexture.alternate=c.create(this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new p(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,t.addChild(this.tilesSprite))):(this.render=u,e.scale.x=this.scaleX,e.scale.y=this.scaleY,e.x=this.left,e.y=this.top,e.z=s,t.addChild(e))},cacheSprite:function(t){var e=0,i=0,s=t.cacheRender,n=null,r=0,a=0,o=0,h=0;if(this.entityCache&&s){for(this.doMap||(this.doMap=Array.setUp(),this.cachedDisplayObjects=Array.setUp(),this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(s),(n=s.getBounds(s.transformMatrix)).x-=this.left,n.y-=this.top,r=Math.max(0,Math.floor(n.y/this.tileHeight)),a=Math.min(this.tilesHeight,Math.ceil((n.y+n.height)/this.tileHeight)),h=Math.max(0,Math.floor(n.x/this.tileWidth)),o=Math.min(this.tilesWidth,Math.ceil((n.x+n.width)/this.tileWidth)),e=h;e<o;e++)for(this.doMap[e]||(this.doMap[e]=Array.setUp()),i=r;i<a;i++)this.doMap[e][i]||(this.doMap[e][i]=Array.setUp()),this.doMap[e][i].push(s);t.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(t){var e=this.layerWidth*this.scaleX,i=this.layerHeight*this.scaleY,s=this.worldWidth,n=s-t.width,r=this.worldHeight,a=r-t.height,o=this.laxCam;return s!==e&&n?o.moveX((t.left-this.left)*(e-t.width)/n+t.halfWidth+this.left):o.moveX(t.x),r!==i&&a?o.moveY((t.top-this.top)*(i-t.height)/a+t.halfHeight+this.top):o.moveY(t.y),t.width===o.width&&t.height===o.height||o.resize(t.width,t.height),o},createTile:function(t){var e,s=null;return"tile-1"===t?v:(e="tile"+function(t,e){var i=+t.substring(4),s=0;return 2147483648&i&&(e.scale.x=-1),1073741824&i&&(e.scale.y=-1),536870912&i&&(s=e.scale.x,e.scale.x=e.scale.y,e.scale.y=-s,e.rotation=Math.PI/2),268435455&i}(t,s=new i(this.spriteSheet)),s.gotoAndStop(e),f.setUp(s,t))},createMap:function(t){var e=0,i=0,s="",n=null;if("string"!=typeof t[0][0])return t;for(n=Array.setUp(),e=0;e<t.length;e++)for(n[e]=Array.setUp(),i=0;i<t[e].length;i++)s=t[e][i],this.updateTile(s,n,e,i);return n},updateCamera:function(t){var e=0,i=0,s=!1,n=null,r=0,a=0,o=0,h=0,l=this.cache,c=this.cachePixels,p=t.viewport,d=this.buffer&&(p.width!==this.laxCam.width||p.height!==this.laxCam.height),u=g,m=this.convertCamera(p);if(!this.cacheAll&&(c.empty||!c.contains(m))&&this.imageMap.length>0&&(d&&this.updateBufferRegion(m),o=(r=this.cacheTilesWidth-1)/2,h=(a=this.cacheTilesHeight-1)/2,u.setAll(Math.round((m.x-this.left)/(this.tileWidth*this.scaleX)-o)+o,Math.round((m.y-this.top)/(this.tileHeight*this.scaleY)-h)+h,r,a),u.left<0?u.moveX(u.halfWidth):u.right>this.tilesWidth-1&&u.moveX(this.tilesWidth-1-u.halfWidth),u.top<0?u.moveY(u.halfHeight):u.bottom>this.tilesHeight-1&&u.moveY(this.tilesHeight-1-u.halfHeight),this.tileCache?!l.empty&&u.contains(l)||(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,u,this.tilesSpriteCache,l)):this.update(null,u),c.setAll((l.x+.5)*this.tileWidth+this.left,(l.y+.5)*this.tileHeight+this.top,(l.width+1)*this.tileWidth,(l.height+1)*this.tileHeight)),this.cacheGrid)for(e=0;e<this.cacheGrid.length;e++)for(i=0;i<this.cacheGrid[e].length;i++)n=this.cacheGrid[e][i],c.setAll((e+.5)*this.cacheClipWidth+this.left,(i+.5)*this.cacheClipHeight+this.top,this.cacheClipWidth,this.cacheClipHeight),s=c.intersects(m),n.visible&&!s?n.visible=!1:!n.visible&&s&&(n.visible=!0),n.visible&&s&&(n.x=p.left-m.left+e*this.cacheClipWidth+this.left,n.y=p.top-m.top+i*this.cacheClipHeight+this.top);else this.tileCache&&(this.tilesSprite.x=p.left-m.left+l.left*this.tileWidth*this.scaleX+this.left,this.tilesSprite.y=p.top-m.top+l.top*this.tileHeight*this.scaleY+this.top)},updateTile:function(t,e,i,s){var n=null,r=this.tiles;t.id&&(t=t.id),(n=r[t])||null===n||(n=r[t]=this.createTile(t)),e[i][s]=n},createGrid:function(t){var e=this.cacheHeight,i=this.cacheWidth,s=this.cacheTilesHeight,n=this.cacheTilesWidth,r=0,a=0,o=null,l=this.scaleX,d=this.scaleY,u=this.tileHeight,g=this.tileWidth,m=this.tilesHeight,f=this.tilesWidth,v=0,w=0,b=this.owner.z,x=null,S=null,E=Array.setUp();for(v=0;v<f;v+=n)for(x=Array.setUp(),E.push(x),w=0;w<m;w+=s)a=Math.min(y((f-v)*g+2),i),r=Math.min(y((m-w)*u+2),e),(o=c.create(a,r)).frame=new h(1,1,((a-2)/g>>0)*g+1,((r-2)/u>>0)*u+1),(S=new p(o)).z=b,S.scale.x=l,S.scale.y=d,x.push(S),t.addChild(S),b-=1e-6;return E},updateRegion:function(t){var e=this.tileWidth,i=this.tileHeight,s=Math.min(this.tilesWidth,(this.cacheWidth-2)/e>>0),n=Math.min(this.tilesHeight,(this.cacheHeight-2)/i>>0);s||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+e+"px wide which is larger than "+(this.cacheWidth-2)+"px (maximum cache size of "+this.cacheWidth+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),n||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+i+"px high which is larger than "+(this.cacheHeight-2)+"px (maximum cache size of "+this.cacheHeight+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),this.cacheTilesWidth=s,this.cacheTilesHeight=n,this.cacheClipWidth=s*e,this.cacheClipHeight=n*i,this.tileCache&&(this.mapContainer.mask=(new a).beginFill(0).drawRect(0,0,this.cacheClipWidth+t,this.cacheClipHeight+t).endFill())},updateBufferRegion:function(t){var e=this.tileWidth,i=this.tileHeight;this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((t.width+2*this.buffer)/e),this.cacheWidth/e>>0),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((t.height+2*this.buffer)/i),this.cacheHeight/i>>0),this.cacheClipWidth=this.cacheTilesWidth*e,this.cacheClipHeight=this.cacheTilesHeight*i,this.mapContainer.mask=(new a).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(t,e,i,s){this.populate(e,s),this.render(e,t,this.mapContainer,this.mapContainerWrapper,i,s),s&&s.set(e)},populateTiles:function(t,e){var i=0,s=0,n=0,r=0,a=null,o=Array.setUp();for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(s=t.top;s<=t.bottom;s++)if(!e||e.empty||s>e.bottom||s<e.top||i>e.right||i<e.left)for(r=0;r<this.imageMap.length;r++)(a=this.imageMap[r][i][s].getNext())&&(a.template&&o.push(a.template),a.x=(i+.5)*this.tileWidth,a.y=(s+.5)*this.tileHeight,this.tileContainer.addChild(a));for(n=0;n<o.length;n++)o[n].clear();o.recycle()},populateTilesAndEntities:function(t,e){var i=0,s=0,n=0,r=0,a=null,o=null,h=Array.setUp(),l=Array.setUp(),c=null;for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(s=t.top;s<=t.bottom;s++)if(!e||e.empty||s>e.bottom||s<e.top||i>e.right||i<e.left){for(r=0;r<this.imageMap.length;r++)(a=this.imageMap[r][i][s].getNext())&&(a.template&&l.push(a.template),a.x=(i+.5)*this.tileWidth,a.y=(s+.5)*this.tileHeight,this.tileContainer.addChild(a));if(this.doMap[i]&&this.doMap[i][s])for(c=this.doMap[i][s],n=0;n<c.length;n++)c[n].drawn||(c[n].drawn=!0,h.push(c[n]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),h.length)for(h.sort(m),n=0;n<h.length;n++)delete(o=h[n]).drawn,this.mapContainer.addChild(o),o.mask&&this.mapContainer.addChild(o.mask);for(n=0;n<l.length;n++)l[n].clear();l.recycle(),h.recycle()},renderCache:function(t,e,i,s,n,r){var a=this.renderer;n&&!r.empty&&(n.x=r.left*this.tileWidth,n.y=r.top*this.tileHeight,i.addChild(n)),d(a,e),i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight,a.render(s,e),e.requiresUpdate=!0},renderCacheWithExtrusion:function(t,e,i,s){var n=new a,r=this.renderer;n.lineStyle(1,0),n.drawRect(.5,.5,this.cacheClipWidth+1,this.cacheClipHeight+1),d(r,e),s.mask=n,i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight+1,r.render(s,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight,r.render(s,e),i.x=-t.left*this.tileWidth+2,i.y=-t.top*this.tileHeight+1,r.render(s,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+2,r.render(s,e),s.mask=null,i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+1,r.render(s,e),e.requiresUpdate=!0},updateGrid:function(){var t=this.cache,e=this.cacheTilesHeight,i=this.cacheTilesWidth,s=this.tilesHeight-1,n=this.tilesWidth-1,r=0,a=0,o=this.cacheGrid;for(r=0;r<o.length;r++)for(a=0;a<o[r].length;a++)t.setBounds(r*i,a*e,Math.min((r+1)*i,n),Math.min((a+1)*e,s)),this.update(o[r][a].texture,t)},toJSON:function(){for(var t=this.imageMap[0],e=[],i=t.length,s=0;i--;)for(s=t[i].length,e[i]=[];s--;)e[i][s]=t[i][s].id;return{type:"RenderTiles",buffer:this.buffer,cacheAll:this.cacheAll,entityCache:this.entityCache,imageMap:e,maximumBuffer:this.maximumBuffer,scaleX:this.scaleX,scaleY:this.scaleY,spriteSheet:this.spriteSheet,tileCache:this.tileCache,tileHeight:this.tileHeight,tileWidth:this.tileWidth,top:this.top,left:this.left}},destroy:function(){var t=0,e=0,i="",s=this.cacheGrid,n=this.doMap,r=this.imageMap;if(s){for(t=0;t<s.length;t++)for(e=0;e<s[t].length;e++)s[t][e].texture.destroy(!0),this.container.removeChild(s[t][e]);s.recycle(2),delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.container.removeChild(this.tilesSprite)):this.container.removeChild(this.mapContainer);for(i in r.recycle(2),this.tiles)this.tiles.hasOwnProperty(i)&&this.tiles[i].destroy();if(this.tiles=null,this.container=null,this.tilesSprite=null,this.spriteSheet.recycleSpriteSheet(),n){for(t=0;t<this.cachedDisplayObjects.length;t++)this.cachedDisplayObjects[t].destroy();for(this.cachedDisplayObjects.recycle(),t=0;t<n.length;t++)if(n[t]){for(e=0;e<n.length;e++)n[t][e]&&n[t][e].recycle();n[t].recycle()}n.recycle()}this.laxCam.recycle(),this.cache.recycle(),this.cachePixels.recycle()}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,s){var n=null,r=0,a=null,o=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||s.spriteSheet;if(h){if("string"==typeof h&&"import"!==h)return t(h,o);if(Array.isArray(h)){for(r=h.length,a=Array.setUp();r--;)n=t(h[r],o),a.union(n),n.recycle();return a}if(h.images)return h.images.greenSlice()}return Array.setUp()})})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ResizeSnapper",properties:{cameraSizes:null},publicProperties:{bottom:null,left:null,right:null,top:null,x:0,y:0},initialize:function(){this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.cameraSizesIndex=-1},events:{"handle-logic":function(){if(!1!==this.owner.shouldSnap){var t=this.bottom,e=this.left,i=this.right,s=this.top;this.lastBottom===t&&this.lastLeft===e&&this.lastRight===i&&this.lastTop===s||(this.updatePosition(this.aabb),this.lastBottom=t,this.lastLeft=e,this.lastRight=i,this.lastTop=s)}},"camera-update":function(t){!1!==this.owner.shouldSnap&&(this.aabb.set(t.viewport),this.cameraSizes&&this.checkCamera(this.aabb),this.updatePosition(this.aabb))}},methods:{checkCamera:function(t){var e=this.cameraSizes,i=0,s=t.width/t.height;for(i=0;i<e.length;i++)if(s>e[i].minRatio){i!==this.cameraSizesIndex&&(this.updateProperties(e[i]),this.cameraSizesIndex=i);break}},updateProperties:function(t){this.right="number"==typeof t.right?t.right:null,this.left="number"==typeof t.left?t.left:null,this.top="number"==typeof t.top?t.top:null,this.bottom="number"==typeof t.bottom?t.bottom:null,"number"==typeof t.x&&(this.x=t.x),"number"==typeof t.y&&(this.y=t.y)},updatePosition:function(t){var e=this.bottom,i=this.left,s=this.owner,n=this.right,r=this.top;"number"==typeof i?s.x=t.left+i:"number"==typeof n&&(s.x=t.right-n),"number"==typeof r?s.y=t.top+r:"number"==typeof e&&(s.y=t.bottom-e),this.owner.triggerEvent("position-updated")},destroy:function(){this.aabb.recycle(),this.aabb=null}}})}(),function(){"use strict";platypus.createComponentClass({id:"RingMover",properties:{pos:0},initialize:function(){},events:{adopted:function(){this.pos*=75,this.owner.x=500-this.pos,this.owner.y=.8*this.pos-300,this.owner.scaleX=this.pos/200+.3,this.owner.scaleY=this.pos/200+.3,this.owner.rotation=-35,this.owner.opacity=.5},"handle-logic":function(){this.pos+=2,this.pos>700&&(this.pos=0),this.owner.x=500-this.pos,this.owner.y=.8*this.pos-300,this.owner.scaleX=this.pos/200+.3,this.owner.scaleY=this.pos/200+.3}}})}(),function(){"use strict";platypus.createComponentClass({id:"RockLogic",properties:{fromHole:!1,particle:!1},publicProperties:{rockID:0},initialize:function(){this.rockID=this.getRandomInt(1,1e6),this.removingC=0,this.velX=0,this.velY=0,this.alphaDecrement=0},events:{adopted:function(){this.owner.state.set(this.getRandomInt(1,5).toString(),!0);var t=this.getRandomInt(7,10)*(this.particle?.025:.075);this.owner.y+=30-30*t,this.owner.scaleX=t,this.owner.scaleY=t,this.particle&&(this.owner.isParticle=!0,this.owner.fromHole=!1),this.fromHole?(this.owner.fromHole=!0,this.velX=6*Math.random()-3,this.velY=3*Math.random()-6,this.owner.z=1e4):this.particle?(this.owner.isParticle=!0,this.removingC=this.getRandomInt(100,200),this.alphaDecrement=1/this.removingC,this.velX=2*Math.random()-1,this.velY=1*Math.random()-2):this.owner.parent.triggerEvent("rock-exists",Math.round(this.owner.x))},"rock-click":function(){this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),this.owner.parent.triggerEvent("rock-clicked",this.owner)},"handle-logic":function(t){this.removingC>0&&(this.removingC--,this.owner.opacity-=this.alphaDecrement,this.velY+=this.particle?.015:.033,this.owner.x+=this.velX,this.owner.y+=this.velY,0===this.removingC&&this.owner.removeSelf()),this.fromHole&&(this.velY+=.033,this.owner.x+=this.velX,this.owner.y+=this.velY,this.velY>0&&this.owner.y>1e3&&(this.fromHole=!1,this.owner.fromHole=!1,this.owner.parent.triggerEvent("rock-exists",Math.round(this.owner.x))))},"prepare-logic":function(){this.particle||!0===this.owner.removeMe&&(this.owner.removeMe=!1,this.owner.parent.triggerEvent("rock-removed",Math.round(this.owner.x)),this.removingC=this.getRandomInt(200,350),this.alphaDecrement=1/this.removingC,this.velX=6*Math.random()-3,this.velY=3*Math.random()-6)}},methods:{getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Vector"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),s=function(t,e){return t*t+e*e},n={x:0,y:0},r={points:[n,n,n,n,n,n,n,n]},a=1+Math.SQRT2;platypus.createComponentClass({id:"Rod",properties:{faceUpward:!1,maximum:500,minimum:50,width:100,height:40,unpinnable:!1},publicProperties:{z:0,pointA:null,pointB:null,shape:null,trussLength:0,rotation:0,stretchLength:0,movable:!0},initialize:function(){var t,e=this.shape||r,i=this.owner.parent,s=e.points,n=s.length;for(this.shape={points:[]};n--;)this.shape.points.unshift({x:s[n].x,y:s[n].y});this.unpinnable&&this.movable&&(this.unpinnable=!1),this.onlyRemovingComponentSoDontDropThePins=!1,this.trussLength=this.trussLength||this.owner.width||this.minimum,t=this.trussLength/2,this.pointA=this.pointA||{x:this.owner.x-t,y:this.owner.y},this.unpinnable||(this.pinA=this.createOrFindPin(this.pointA,i)),this.pointB?this.unpinnable||(this.pinB=this.createOrFindPin(this.pointB,i)):(this.pointB={x:this.owner.x+t,y:this.owner.y},this.unpinnable||(this.pinB=this.createPin(this.pointB,i))),this.graceMargin=platypus.game.app.config.pins.snapGraceMargin,this.originalMax=this.maximum,this.originalMin=this.minimum,this.graceMax=2*this.maximum,this.graceMin=this.minimum/2,this.enactAdjustment(),this.owner.matchBodyToEntity(),this.unpinnable||(this.pinA.attach(this.owner,!0,!1),this.pinB.attach(this.owner,!0,!1)),this.inMotion=!1},events:{"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.RodFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.unpinnable||(t.entity===this.pinA?this.tryAdjustment(this.pinA,this.pinB,t):t.entity===this.pinB?this.tryAdjustment(this.pinB,this.pinA,t):platypus.debug.warn("Something odd occurred: notified about an unattached constraint movement."))},"pin-moved":function(){var t=this.pinA,e=this.pinB,i=this.pointA,s=this.pointB;t.x===i.x&&t.y===i.y&&e.x===s.x&&e.y===s.y||this.enactAdjustment()},"resolve-bodies":function(){this.owner.matchBodyToEntity()},"resolve-joints":function(){this.unpinnable||(this.pinA.resetJoints(),this.pinB.resetJoints())},"update-group-id":function(t){this.owner.groupId=t,this.unpinnable||(t!==this.pinA.groupId&&this.pinA.triggerEvent("update-group-id",t),t!==this.pinB.groupId&&this.pinB.triggerEvent("update-group-id",t))},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){var e=this.closestPin(t);this.unpinnable||(e===this.pointA?this.pinA=t:e===this.pointB?this.pinB=t:platypus.debug.warn("Rod: uh, this is odd."))},"pin-removed":function(t){t===this.pinA?this.pinA=null:t===this.pinB?this.pinB=null:platypus.debug.warn("Rod: A pin was removed that cannot be removed so it was not removed.")},"validate-begin-group-movement":function(t){this.unpinnable||t.invalid||!this.pinA.inDragGroup&&!this.pinB.inDragGroup||(t.invalid=!0)},"begin-group-movement":function(t){this.unpinnable||(this.pinA.triggerEvent("include-in-group",t),this.pinB.triggerEvent("include-in-group",t),this.inMotion=!0,this.owner.movable&&(this.pinA.immobile||this.pinB.immobile)?(this.pinA.split(this.owner),this.pinB.split(this.owner)):this.prepareForBreakage=!0)},"break-away":function(){this.prepareForBreakage&&(this.prepareForBreakage=!1,this.pinA.split(this.owner),this.pinB.split(this.owner))},"include-in-group":function(){this.prepareForBreakage=!1,this.inMotion=!0},"motion-ended":function(){this.inMotion=!1},"pin-motion-ended":function(){this.minimum=Math.min(this.trussLength,this.originalMin),this.maximum=Math.max(this.trussLength,this.originalMax)},"valid-snap":function(t,e){var i=t.pinFrom,s=t.pinTo;0===e?i===this.pinA?t.snappable=this.pinB.canSnapTo(t,e+1):i===this.pinB&&(t.snappable=this.pinA.canSnapTo(t,e+1)):1===e&&(this.pinA!==s&&this.pinB!==s||(t.snappable=!1))}},methods:{closestPin:function(t){var e=this.pointA,i=this.pointB;return s(e.x-t.x,e.y-t.y)>s(i.x-t.x,i.y-t.y)?i:e},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins);return i&&i!==this.pinA&&i!==this.pinB?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y}})},findPin:function(t,e){var i=platypus.game.app.config.pins.mergeDistance,n=0,r=null,a=e&&e.length,o=i*i,h=null;if(a)for(;a--;)r=e[a],(n=s(r.x-t.x,r.y-t.y))<o&&(o=n,h=r);return h},stretch:function(t,s){var n=this.owner,r=n.body,o=null,h=null,l=null,c=this.shape.points,p=this.pointA,d=this.pointB;if(4===c.length)!function(t,e,i){var s=t[0],n=t[1],r=t[2],a=t[3];s.x=-e,s.y=-i,n.x=e,n.y=-i,r.x=e,r.y=i,a.x=-e,a.y=i}(c,t/2,s/2);else if(6===c.length)!function(t,e,i){var s=t[0],n=t[1],r=t[2],a=t[3],o=t[4],h=t[5];s.x=-e,s.y=-i,n.x=e,n.y=-i,r.x=e+i,r.y=0,a.x=e,a.y=i,o.x=-e,o.y=i,h.x=-e-i,h.y=0}(c,t/2,s/2);else{if(8!==c.length)return void platypus.debug.warn(this.owner.type+": This entity is not using a rectangle for stretching.");!function(t,e,i){var s=i/a,n=t[0],r=t[1],o=t[2],h=t[3],l=t[4],c=t[5],p=t[6],d=t[7];n.x=-e-s,n.y=-i,r.x=e+s,r.y=-i,o.x=e+i,o.y=-s,h.x=e+i,h.y=s,l.x=e+s,l.y=i,c.x=-e-s,c.y=i,p.x=-e-i,p.y=s,d.x=-e-i,d.y=-s}(c,t/2,s/2)}n.x=(p.x+d.x)/2,n.y=(p.y+d.y)/2,r&&(l={},h=r.GetFixtureList(),0!==e(h)&&(o=h.GetFilterData(),l.filter={categoryBits:o.get_categoryBits(),groupIndex:o.get_groupIndex(),maskBits:o.get_maskBits()},l.density=h.GetDensity(),l.friction=h.GetFriction(),l.restitution=h.GetRestitution(),l.isSensor=h.IsSensor(),l.userData=i(h),r.DestroyFixture(h)),this.owner.createFixture(l,{}))},tryAdjustment:function(e,i,n){var r,a=null,o=n.position,h=o.x,l=o.y,c=null,p=this.minimum,d=this.maximum;this.inMotion||(this.owner.movable?(n.forSnap&&((p-=this.graceMargin)<this.graceMin&&(p=this.graceMin),(d+=this.graceMargin)>this.graceMax&&(d=this.graceMax)),(r=Math.sqrt(s(h-i.x,l-i.y)))<p?(c=t.setUp(i.x,i.y),n.adjusted=a=t.setUp(h,l),a.subtractVector(c).normalize(),0!==a.magnitude()?a.multiply(p).addVector(c):(a.x=p,a.addVector(c))):r>d&&(c=t.setUp(i.x,i.y),n.adjusted=a=t.setUp(h,l),a.subtractVector(c).normalize(),a.multiply(d).addVector(c))):n.adjusted=t.setUp(e.x,e.y))},enactAdjustment:function(){var t=this.owner,e=this.pinA,i=this.pinB,n=this.pointA,r=this.pointB,a=e?n.x=e.x:n.x,o=e?n.y=e.y:n.y,h=(i?r.x=i.x:r.x)-a,l=(i?r.y=i.y:r.y)-o,c=Math.sqrt(s(h,l)),p=Math.atan(l/h);!this.faceUpward&&h<0&&(p+=Math.PI),this.stretch(c,this.height),t.orientation=p,this.trussLength=c,this.stretchLength=c,this.rotation=180*p/Math.PI},destroy:function(){var t=this.pinA,e=this.pinB;this.onlyRemovingComponentSoDontDropThePins||(t&&!t.destroyed&&t.detachPermanently(this.owner),e&&!e.destroyed&&e.detachPermanently(this.owner))}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"RodFrozen",initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.pinA=null,t.pinB=null,t.removeComponent(this),t.addComponent(new platypus.components.Rod(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)}}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),s=include("PIXI.spine.core.TextureAtlas",!1),n=include("PIXI.spine.core.AtlasAttachmentLoader",!1),r=include("PIXI.BaseTexture"),a=include("PIXI.spine.core.SkeletonJson",!1),o=include("PIXI.spine.Spine",!1),h=function(){var t=platypus.game.app,e=t.config.platypus;t.transition=new o(new a(new n(new s(e.atlases["ScreenBadge_Standard-"+platypus.modifyAllAssets],function(t,e){var i,s;e((i=t,(s=platypus.game.app.assetManager.cache.read(i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."))))||platypus.debug.warn('SavedGameChecker: "'+i+'" is not a loaded asset.'),new r(s)))}))).readSkeletonData(e.skeletons.ScreenBadge_Standard)),t.transition.children[0].mask=t.transition.children[2].children[0],platypus.savedWidth&&platypus.savedHeight&&(t.transition.x=platypus.savedWidth/2,t.transition.y=platypus.savedHeight/2,t.transition.scale.x=t.transition.scale.y=platypus.savedHeight/880),t.transition.visible=!1};platypus.createComponentClass({id:"SavedGameChecker",events:{"scene-live":function(){var t=platypus.game.app,i=platypus.savedGame;t.transition||e||setTimeout(h,100),i?platypus.game.loadScene("scene-level",{level:i.level}):this.owner.triggerEvent("relocate",{x:0,y:0}),springroll.Debug&&(this.owner.addEntity("debug-reset"),this.owner.addEntity("debug-unlock"))},"unlock-levels":function(){var t=platypus.game.app,e=t.userData,i=t.options.version;e.write("-"+i+"-levels-complete",["level-1","level-2","level-3","level-4","level-5"]),e.write("-"+i+"-scores",{"score-for-tutorial":237,"score-for-level-4":600,"score-for-level-5":700,"score-for-level-6":800}),e.write("-"+i+"-seed-packets",["carrot","potato","pumpkin","corn","lettuce","tomato","radish","beet","watermelon","strawberry"]),t.sound.play("badge-tada")},"reset-game":function(){var t=platypus.game.app,e=t.userData,i=t.options.version;e.remove("-"+i+"-harvest"),e.remove("-"+i+"-last-level-played"),e.remove("-"+i+"-level-select-vo"),e.remove("-"+i+"-levels-complete"),e.remove("-"+i+"-saved-states"),e.remove("-"+i+"-scores"),e.remove("-"+i+"-seed-packets"),e.remove("LevelSaves"),t.sound.play("reset"),t.sound.play("snap-photo")}},getAssetList:function(){return springroll.Debug?i.getAssetList({type:"debug-reset"}):Array.setUp()}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=0;platypus.createComponentClass({id:"SavedGameLister",properties:{},publicProperties:{},initialize:function(t,e){var i=platypus.game.app,s=platypus.game.app.config.journal;return this.saves=null,this.savesTotal=0,this.saveTime=Date.now(),this.buttons=[],this.owner.parent.app.userData.read(s.storageKey,function(t){var i=platypus.game.app,n=0,r=this.buttons,a=s.maxSavesPerGame;for(this.saves=t,n=0;n<a;n++)t&&t[n]?r.push(this.addSave(t[n],0,0,n)):r.push(this.addEmpty(0,0));this.tableColumns=this.tableColumns||3,this.updateLocations(),i.googleAnalytics.event(i.name,"EnterSaveMenu","NumberOfSaves",this.savesTotal),e()}.bind(this)),i.music="jam",i.musicInstance.volume=.5,platypus.badger.increment("tried-journal"),!0},events:{"camera-update":function(t){var e=t.viewport,i=e.width/e.height>1.766?3:2;this.tableColumns!==i&&(this.tableColumns=i,this.updateLocations())},"scene-loaded":function(t){var e=t.insertSave,i=null,s=this.owner.getEntitiesByType("journal-insert")[0];e?(this.insertSave=e,this.savedEntry=this.addSave(e,0,s.y,-1,function(){this.triggerEvent("insert-incoming")}.bind(this.owner),s.cameraSizes),(i=this.savedEntry.deletes).scaleX=.5,i.scaleY=.5,i.z=20,i.on("handle-render",function(t){t.x=this.x+135}.bind(i,this.savedEntry)),this.savedEntry.y=-550,this.savedEntry.z=30):this.saves&&this.saves.length?this.owner.triggerEvent("journal-some"):this.owner.triggerEvent("journal-none")},"return-to-game":function(){this.returnToGame&&this.returnToGame.deletes.triggerEvent("new-scene")},"delete-me":(t=function(t){this.removeEntity(t.deletes),this.removeEntity(t)},function(e){var i=platypus.game.app,s=i.userData,n=e.entity,r=this.savedEntry,a=i.config.journal;if(r){if(-1===n.deletes.saveIndex)return void n.deletes.triggerEvent("new-scene");this.saves[n.deletes.saveIndex]=this.insertSave,this.buttons[n.deletes.saveIndex]=this.returnToGame=this.addSave(this.insertSave,n.deletes.x,n.deletes.y,n.deletes.saveIndex),r.on("prepare-logic",t.bind(this.owner,r)),this.insertSave=null,this.savedEntry=null,this.owner.triggerEvent("inserted-save")}else this.saves[n.deletes.saveIndex]=null,this.buttons[n.deletes.saveIndex]=this.addEmpty(n.deletes.x,n.deletes.y);try{s.write(a.storageKey,this.saves)}catch(t){this.saves[n.deletes.saveIndex]&&(this.saves[n.deletes.saveIndex].thumbnail=null,s.write(a.storageKey,this.saves))}n.on("prepare-logic",t.bind(this.owner,n))})},methods:{addEmpty:function(t,e){var i=platypus.game.app.config.journal.thumbnail;return this.owner.addEntity({type:"saved-game-empty",properties:{width:i.width,height:i.height,x:t,y:e,z:8}})},addSave:function(t,s,n,r,a,o){var h=null,l=null,c=new Image,p=platypus.game.app.config.journal,d=platypus.modifyAllAssets,u=p.thumbnail.width/2,g=p.thumbnail.height/2,m=u/2,y=g/2;return this.savesTotal+=1,a&&(h=function(t,e){t.count-=1,t.count||(t.recycle(),e())}.bind(null,e.setUp("count",2),a)),t.thumbnail?c.src=t.thumbnail:c="thumbnail-backup",l=this.owner.addEntity({type:"saved-game-button",properties:{x:s,y:n,z:15,cameraSizes:o,spriteSheet:{id:"saved-ss-"+i,images:[c],frames:[[0,0,u*d,g*d,0,m*d,y*d]]},persistentData:{level:t.level},events:null,saveIndex:r}},h),i+=1,l.components[l.components.length-3].sprite.scale.x=2,l.components[l.components.length-3].sprite.scale.y=2,this.owner.addEntity({type:"delete-saved-game-button",properties:{deletes:l,x:s+m,y:n-y,z:16}},h)},updateLocations:function(){for(var t=this.buttons,e=null,i=t.length,s=platypus.game.app.config.journal,n=s.thumbnail.width,r=n/2,a=s.thumbnail.height,o=a/2,h=s.maxSavesPerGame,l=this.tableColumns,c=(h/l-1)/2,p=0,d=0,u=s.spacing+n,g=s.spacing+a;i--;)p=(i%l-(l-1)/2)*u,d=((i/l>>0)-c)*g,(e=t[i]).deletes&&(e.x=p+r,e.y=d-o,e=e.deletes),e.x=p,e.y=d,e.totalSaves=this.savesTotal},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitSaveMenu","SaveMenuTime",Date.now()-this.saveTime>>0)}},getAssetList:function(){return Array.setUp("assets/images/delete-button.png","assets/images/journal-frame.png","assets/images/thumbnail-backup.png")}})}(),function(){"use strict";var t=include("platypus.Data");platypus.createComponentClass({id:"SceneChanger",properties:{scene:"",persistentData:null},initialize:function(){this.persistentData=t.setUp(this.persistentData),this.loadingScene=!1},events:{"new-scene":function(t){var e=t||this,i=e.scene||this.scene,s=e.persistentData||this.persistentData;this.loadingScene||(this.loadingScene=!0,platypus.game.loadScene(i,s))},"set-scene":function(t){this.scene=t},"set-persistent-scene-data":function(t){var e=this.persistentData,i="";for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}},methods:{destroy:function(){}}})}(),function(){"use strict";platypus.createComponentClass({id:"Scroller",properties:{direction:""},publicProperties:{},initialize:function(){this.show=this.owner.left,this.hide=-this.owner.left},events:{adopted:function(){this.owner.state.set(this.direction,!0)},pointerdown:function(){this.owner.parent.triggerEvent("scroll-"+this.direction),this.owner.state.set(this.direction,!1),this.owner.state.set(this.direction+"-pressed",!0)},pointerup:function(){this.release()},pointerupoutside:function(){this.release()},pointercancel:function(){this.release()},"hide-sprite":function(){this.release()},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{release:function(){this.owner.state.set(this.direction+"-pressed",!1),this.owner.state.set(this.direction,!0)}},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=!1;platypus.createComponentClass({id:"SeedInfoLogic",properties:{seedID:"",needs:{}},publicProperties:{},initialize:function(){this.elements=[],this.water=0,this.sun=0,this.space=0,this.needsClose=!1},events:{adopted:function(){t.get(this.owner).to({scaleX:1,scaleY:1,opacity:1},250,createjs.Ease.backOut).call(function(){this.owner&&!this.owner.destroyed&&this.elements&&this.populate()}.bind(this))},"close-seed-info":function(){this.needsClose=!0},"seed-selected":function(){this.needsClose=!0},"handle-logic":function(){this.needsClose&&this.elements&&(this.needsClose=!1,this.closeThis())}},methods:{populate:function(){var t="",i=this.elements,s="",n=["water","sun","space"],r=0;for(e||(e=!0,this.owner.parent.parent.layers[0].triggerEvent("tutorial-seed-info-2")),r=0;r<n.length;r++)t="","water"===(s=n[r])&&(t="B"),"sun"===s&&(t="Y"),i.push(this.addFeedback("barBG",-40,100*r-50,1,.5,.75,1)),i.push(this.addFeedback("barFG"+t,-36,100*r-50,2,this.translate(this.needs[s],0,10,0,.5),.75,1));i.push(this.owner.parent.addEntity({id:"plant",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:this.seedID}}],properties:{scaleX:1,scaleY:1,x:this.owner.x,y:this.owner.y-175,z:this.owner.z+1}}),this.owner.parent.addEntity({id:"closeButton",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:"close"},interactive:!0},{type:"LogicButton"},{type:"RelayLinker",linkId:"ui",events:{released:"close-seed-info"}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"},{type:"LAPSeedInfo",lapEvent:"closeSeedInfo",information:this.needs,seed:this.seedID,began:Date.now()}],properties:{scaleX:20,scaleY:10,x:this.owner.x,y:this.owner.y,z:this.owner.z-10,opacity:0}}),this.owner.parent.addEntity({id:"nextButton",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:"arrow"},interactive:!0},{type:"LogicButton"},{type:"RelayLinker",linkId:"ui",events:{released:["close-seed-info","seed-info"]}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"},{type:"LAPSeedInfo",lapEvent:"nextSeedInfo",information:this.needs,seed:this.seedID}],properties:{scaleX:.66,scaleY:.66,x:this.owner.x+250,y:this.owner.y,z:this.owner.z+5}}),this.owner.parent.addEntity({id:"nextButton",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:"arrow"},interactive:!0},{type:"LogicButton"},{type:"RelayLinker",linkId:"ui",events:{released:["close-seed-info","seed-info-prev"]}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"},{type:"LAPSeedInfo",lapEvent:"nextSeedInfo",information:this.needs,seed:this.seedID}],properties:{scaleX:-.66,scaleY:.66,x:this.owner.x-250,y:this.owner.y,z:this.owner.z+5}}))},closeThis:function(){for(var e=this.elements,i=e.length;i--;)e[i].removeSelf();e.length=0,this.elements=null,t.get(this.owner).to({scaleX:.5,scaleY:.5,opacity:0},250,createjs.Ease.sineOut).call(function(){this.removeSelf()}.bind(this.owner))},addFeedback:function(t,e,i,s,n,r,a){return this.owner.parent.addEntity({id:"spr",components:[{type:"RenderSprite",spriteSheet:"plantFeedback",animationMap:{default:t}}],properties:{x:this.owner.x+e,y:this.owner.y+i,z:this.owner.z+s,scaleX:n,scaleY:r,opacity:a}})},translate:function(t,e,i,s,n,r){var a=(t-e)/(i-e)*(n-s)+s;return r?s<n?this.clamp(a,s,n):this.clamp(a,n,s):a},clamp:function(t,e,i){return t<e?e:t>i?i:t}}})}(),function(){"use strict";var t=!1;platypus.createComponentClass({id:"SeedLogic",properties:{plantData:{},speedMod:1,soil:null,manager:null},publicProperties:{seedID:0},initialize:function(){this.seedID=this.getRandomInt(1,1e6),this.removeThis=!1,this.sproutGFX=null},events:{adopted:function(){this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{type:"RenderSprite",spriteSheet:"plant-"+this.owner.seedType,interactive:!0,animationMap:{default:"seed"}})),this.owner.scaleX=this.owner.scaleY=.33,this.owner.triggerEvent("health-data",this.plantData.water,this.plantData.sun,this.plantData.space,!0),this.sproutGFX=this.owner.parent.addEntity({id:"sprout",components:[{type:"RenderSprite",spriteSheet:"plant-"+this.owner.seedType,animationMap:{default:"1"}}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z-1,scaleX:.35,scaleY:.35}})},"seed-click":function(){var t=[{id:"shovel",callback:function(t){this.destroyed||t.triggerEvent("seed-clicked",this,"shovel")}.bind(this.owner,this.owner.parent)}];this.owner.parent.parent.layers[0].triggerEvent("cancel-global-click"),"level-1"!==this.manager.getLevel()&&t.push({id:"water",callback:function(t){this.destroyed||t.triggerEvent("seed-clicked",this,"water")}.bind(this.owner,this.owner.parent)}),this.owner.parent.addEntity({type:"action-select",properties:{targetEntity:this.owner,x:this.owner.x,y:this.owner.y,options:t}})},"sprout-percent":function(t){this.sproutGFX&&(this.sproutGFX.scaleX=this.sproutGFX.scaleY=.35*t)},"prepare-logic":function(){this.removeThis&&(this.owner.parent.triggerEvent("seed-removed",Math.round(this.owner.x)),this.removeThis=!1,this.sproutGFX.removeSelf(),this.soil.removeSelf(),this.owner.removeSelf(),this.sproutGFX=null)},"sprout-seed":function(){this.sprout()},remove:function(){this.removeThis=!0},"water-level-adjusted":function(t){this.soil.opacity=.05*t}},methods:{sprout:function(){var e,i=16*platypus.fxModifier>>0,s=this.owner.parent.parent,n=0,r=0,a=2*Math.PI/i;for(s.layers[0].triggerEvent("seedSprout"),this.owner.parent.triggerEvent("seed-sprout",Math.round(this.owner.x)),t||(t=!0,s.layers[0].triggerEvent("tutorial-sprout")),e=this.owner.parent.addEntity({type:"plant-"+this.owner.seedType,properties:{x:this.owner.x,y:this.owner.y-10,z:5003,speedMod:this.speedMod,soil:this.soil,score:this.plantData.score,manager:this.manager}}),this.manager.save({type:"plant",id:this.owner.seedType,x:this.owner.x}),this.owner.triggerEvent("health-transfer-init",e,this.speedMod),this.owner.parent.parent.layers[2].triggerEvent("add-to-score",Math.round(.1*this.plantData.score)),this.manager.needRecalc=!0,n=0;n<i;n++)this.addStarParticle(1,r),r+=a;this.sproutGFX.removeSelf(),this.owner.removeSelf()},addStarParticle:function(t,e){this.owner.parent.addEntity({id:"sun-particle",components:[{type:"RenderSprite",spriteSheet:"fx2",animationMap:{default:"star"},rotate:!0},{type:"ParticleLogic",speed:t,duration:200,angle:e,spin:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+1,scaleX:.25,scaleY:.25,opacity:1}})},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},destroy:function(){this.manager=null}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SeedSelectLogic",properties:{showDetails:!1,manager:null},publicProperties:{},initialize:function(){this.buttons=[],this.info=null,this.needClose=!1},events:{adopted:function(){for(var t=this.manager.available,e=0;e<t.length;e++){var i=t[e],s=this.owner.parent.addEntity({id:"seedButton",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:i},interactive:!0},{type:"LogicButton"},{type:"RelayLinker",linkId:"ui",events:{released:this.showDetails?"seed-info":"seed-selected"}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"}],properties:{scaleX:1,scaleY:1,x:this.owner.x-210+100*e,y:this.owner.y-40,z:this.owner.z+1,seedID:i}});this.buttons.push(s)}var n=this.owner.parent.addEntity({id:"closeButton",components:[{type:"RenderSprite",spriteSheet:"seedSelect",animationMap:{default:"close"},interactive:!0},{type:"LogicButton"},{type:"RelayLinker",linkId:"ui",events:{released:"close-seed-select"}},{type:"AudioSFX",audioMap:{pressed:{sound:"click",volume:1}}},{type:"LAPDwellTimer"}],properties:{scaleX:.75,scaleY:.75,x:this.owner.x+270,y:this.owner.y-110,z:this.owner.z+1}});this.buttons.push(n)},"close-seed-select":function(){this.closeThis(),null!==this.info&&this.info.triggerEvent("close-seed-info")},"close-seed-info":function(){this.info=null},"seed-info":function(t){null!==this.info&&this.info.triggerEvent("close-seed-info"),this.info=this.owner.parent.addEntity({type:"seedInfo",properties:{scaleX:1,scaleY:1,x:t.entity.x,y:t.entity.y-50,z:t.entity.z+1,seedID:t.entity.seedID,needs:this.manager.getPlantData(t.entity.seedID)}})},"seed-selected":function(){this.needClose=!0},"handle-logic":function(){},"prepare-logic":function(){this.needClose&&(this.closeThis(),this.needClose=!1)}},methods:{closeThis:function(){for(var t in this.buttons)this.buttons[t].removeSelf();this.buttons=null,this.owner.removeSelf()},destroy:function(){this.manager=null}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SeedsLogic",properties:{},publicProperties:{},initialize:function(){},events:{"seeds-click":function(){this.owner.parent.triggerEvent("seeds-clicked")},"handle-logic":function(t){}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"ShovelLogic",properties:{},publicProperties:{},initialize:function(){},events:{"shovel-click":function(){this.owner.parent.triggerEvent("shovel-clicked")},"handle-logic":function(t){}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=2,e={pointA:"json",pointB:"json",radius:"string",renderGroup:"string",stretchLength:"string",trussLength:"string"},i=include("Box2D.b2Vec2"),s=include("Box2D.destroy"),n=include("Box2D.getPointer"),r=function(t,e,i,s){switch(t){case"json":a(e,i,s);break;default:o(e,i,s)}},a=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:JSON.stringify(e[i])})},o=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:e[i]+""})};platypus.createComponentClass({id:"Sim",properties:{},publicProperties:{movable:!0,savable:!1,inBuildingArea:!1,interactive:!1,simulating:!1},initialize:function(){this.allowSleep=!1,this.sensors=Array.setUp(),this.activeType=0,this.snapShot=null},events:{load:function(){!this.simulating&&this.movable||this.owner.triggerEvent("remove-dragging",!0,this.simulating)},"box2d-body-initialized":function(){var e=this.owner.body,i=e.GetFixtureList(),s=this.sensors;if(!this.simulating)for(e.IsSleepingAllowed()&&(this.allowSleep=!0,e.SetSleepingAllowed(!1)),this.activeType=e.GetType(),this.interactive&&this.activeType!==t&&(e.SetType(t),this.owner.parent.buildingArea&&(this.inBuildingArea=this.owner.parent.buildingArea.body.GetFixtureList().TestPoint(e.GetPosition())));0!==n(i);)s.push(i.IsSensor()),i.SetSensor(!0),i=i.GetNext()},"retrieve-save-state":function(t,i){var s=null;(this.savable||i&&"boolean"==typeof this.owner.movable&&!this.owner.neverSave)&&(s=function(t,i){var s=e,n="",a=[],o={height:t.height||0,id:0,name:"",properties:a,rotation:t.rotation||0,type:t.type,visible:!0,width:t.width||0,x:t.x||0,y:t.y||0},h=!1;for(n in a.push({name:"z",type:"string",value:t.z%1e3}),t.shape&&t.saveShape?t.shape.points?(h=!0,o.polygon=t.shape.points):(a.push({name:"shape",type:"string",value:JSON.stringify(t.shape)}),"circle"===t.shape.type&&(o.ellipse=!0,o.width=2*t.shape.radius,o.height=2*t.shape.radius),o.x-=o.width/2,o.y-=o.height/2):(o.x-=o.width/2,o.y-=o.height/2),h||t.width||t.height||(o.point=!0),s)s.hasOwnProperty(n)&&r(s[n],a,t,n);return!i&&t.savable&&a.push({name:"savable",type:"string",value:"true"}),i&&t.movable&&a.push({name:"movable",type:"string",value:"false"}),o}(this.owner,i),t.push(s)),this.owner.snapShot=this.snapShot={rotation:this.owner.rotation,x:this.owner.x,y:this.owner.y}},"restore-save-state":function(){var t,e;this.snapShot?(t=this.owner,e=this.snapShot,t.x=e.x,t.y=e.y,t.rotation=e.rotation,t.body&&t.body.SetActive(!0)):this.savable&&this.owner.parent.removeEntity(this.owner)},"simulation-started":function(){var e=this.owner.body,i=null,s=this.sensors,r=0;if(!this.simulating&&e)for(this.simulating=!0,this.interactive&&this.activeType!==t&&e.SetType(this.activeType),this.allowSleep&&e.SetSleepingAllowed(!0),i=e.GetFixtureList();0!==n(i);)i.SetSensor(s[r]),r+=1,i=i.GetNext();this.owner.triggerEvent("prepare-for-simulation"),this.owner.triggerEvent("remove-dragging",!1,!0)},"simulation-stopped":function(){var e=this.owner.body,r=null,a=null;if(this.simulating&&e)for(this.simulating=!1,this.interactive&&this.activeType!==t&&e.SetType(t),this.allowSleep&&e.SetSleepingAllowed(!1),a=new i(0,0),e.SetAngularVelocity(0),e.SetLinearVelocity(a),this.owner.orientation=0,this.owner.matchBodyToEntity(),s(a),r=e.GetFixtureList();0!==n(r);)r.SetSensor(!0),r=r.GetNext();this.owner.triggerEvent("restore-dragging",!1,!0)}},methods:{destroy:function(){this.sensors.recycle(),this.sensors=null}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SoilLogic",properties:{},publicProperties:{},initialize:function(){},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SwitcherButtonLogic",properties:{name:"",skillGFX:!1},publicProperties:{},initialize:function(){},events:{clicked:function(){this.owner.parent.parent.layers[0].triggerEvent("switch",this.name)},adopted:function(){this.skillGFX||this.owner.triggerEvent("hide-sprite")},"show-switcher":function(t){this.skillGFX||t==this.name&&this.owner.triggerEvent("show-sprite")}},methods:{},publicMethods:{}})}(),function(){"use strict";var t,e,i=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?(?:(([^\/?]+)\.(\w+))|([^\/?]+))(?:\?((?:(?:[^&]*?[\/=])?(?:((?:(?:[^\/?&=]+)\.(\w+)))\S*?)|\S+))?)?$/,s=include("platypus.AABB"),n=include("platypus.Data"),r=include("platypus.Entity"),a=(t=function(t,e){return t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24)>>>0},e=function(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0},function(i,s){var n=4,r=[],a=atob(i.replace(/\\/g,""));if("zlib"===s)for(a=pako.inflate(a);n<=a.length;)r.push(e(a,n-4)),n+=4;else for(;n<=a.length;)r.push(t(a,n-4)),n+=4;return r}),o=function(t){var e=t.match(i);return e[5]||e[7]},h=function(t){for(var e=1;e<t;)e*=10;return e},l={x:1,y:1,id:-1},c=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},p=function(t,e,i){var s=0;if(t)if(Array.isArray(t)){for(s=t.length;s--;)if(t[s].name===e)return t[s].type=typeof i,void(t[s].value=i);t.push({name:e,type:typeof i,value:i})}else t[e]=i},d=function(t,e){var i,s,n,r,a=0,o=t.gid||-1,h={},c={gid:-1,transform:null,properties:h,type:""},p=null,d=null,g=0;for(-1!==o&&(c.transform=(n=!!(1073741824&(i=o)),r=!!(2147483648&i),(s=l).id=268435455&i,s.x=1,s.y=1,n&&(s.y=-1),r&&(s.x=-1),s),o=c.gid=l.id),a=0;a<e.length&&!(e[a].firstgid>o);a++)d=e[a];return d&&(g=o-d.firstgid,d.tileproperties&&d.tileproperties[g]&&(p=d.tileproperties[g]),d.tiles&&d.tiles[g]&&(c.type=d.tiles[g].type||"")),c.type=t.type||c.type,""===c.type&&(t.name?(c.type=t.name,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type using the "name" property has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):p&&(p.entity?(c.type=p.entity,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type using the "entity" property in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):p.type&&(c.type=p.type,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')))),c.type?(c.transform?(h.scaleX=c.transform.x,h.scaleY=c.transform.y):(h.scaleX=1,h.scaleY=1),u(p,c.properties),u(t.properties,c.properties),c):null},u=function(t,e){var i=0,s="";if(t&&e)if(Array.isArray(t))for(i=0;i<t.length;i++)p(e,t[i].name,g(t[i].value));else for(s in t)t.hasOwnProperty(s)&&p(e,s,g(t[s]));return e},g=function(t){var e=0;if("string"==typeof t){if(0===(e=parseFloat(t))||e)return e;if("true"===t)return!0;if("false"===t)return!1;if(t.length>1&&("{"===t[0]&&"}"===t[t.length-1]||"["===t[0]&&"]"===t[t.length-1]))try{return JSON.parse(t)}catch(t){}}return t},m=function(t,e){var i=0,s=0,a=Array.setUp(),o=null,h=Array.setUp(),l=null,p=null,u=null;if("string"==typeof t&&(t=platypus.game.settings.levels[t]),t)if(t.tilesets&&(t.tilesets=v(t.tilesets)),t.assets)h.union(t.assets);else if(t.layers){for(i=0;i<t.layers.length;i++)if("objectgroup"===t.layers[i].type)for(s=0;s<t.layers[i].objects.length;s++)(p=d(t.layers[i].objects[s],t.tilesets))&&(u=r.getAssetList(p),h.union(u),u.recycle());else"imagelayer"===t.layers[i].type?h.union([t.layers[i].image]):(p=c(t.layers[i].properties,"entity"))&&(l=n.setUp("type",p),o=r.getAssetList(l),h.union(o),o.recycle(),l.recycle());if(!e){for(i=0;i<t.tilesets.length;i++)a.push(t.tilesets[i].image);h.union(a),a.recycle()}t.assets=h.greenSlice()}return h},y={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]}},f=function(t){var e="",i=platypus.game.settings.levels[t.source.replace(".json","")];for(e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return delete t.source,t},v=function(t){var e=0;for(e=0;e<t.length;e++)t[e].source&&(t[e]=f(t[e]));return t};platypus.createComponentClass({id:"TiledLoader",properties:{offsetMap:!1,showCollisionTiles:!1,images:null,layerIncrement:1e3,separateTiles:!1,spriteSheet:null},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},initialize:function(){this.assetCache=platypus.game.app.assetManager.cache,this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(t,e){this.manuallyLoad||(e.count+=1,this.loadLevel({level:this.level||t.level,persistentData:t},e.release))},"load-level":function(t,e){this.loadLevel(t,e)}},methods:{createLayer:function(t,e,i,s,n,a,o,h,l,p){var d=null,g=null,m=e.width,f=e.height,v=e.tileheight||a,w=e.tilewidth||n,b=0,x=0,S=0,E=0,C=0,k=JSON.parse(JSON.stringify(platypus.game.settings.entities[t]||y[t])),A={},P=[],M=[],B=[],D={images:e.image?[e.image]:h,frames:M,animations:A},T=!1,I=null,L=null,X=0,z=0,R=0,U="",O=null,Y=function(t,e,i,s){var n=i.margin||0,r=i.spacing||0,a=i.tilewidth,o=i.tileheight,h=a/2,l=o/2,c=a+r,p=o+r,d=2*n-r,u=i.columns||i.imagewidth/c+d>>0,g=i.imageheight/p+d>>0,m=0,y=0;for(a*=s,o*=s,h*=s,l*=s,c*=s,p*=s,y=0;y<g;y++)for(m=0;m<u;m++)t.push([n+m*c,n+y*p,a,o,e,h,l])};if(this.decodeLayer(e),O=e.data,i+=e.offsetx||0,s+=e.offsety||0,k.properties=k.properties||{},e.properties){if((E=c(e.properties,"width"))&&(b=parseInt(E,10)),(S=c(e.properties,"height"))&&(x=parseInt(S,10)),b||x){for(b=b||m,x=x||f,O=[],z=0;z<b;z++)for(R=0;R<x;R++)O[z+R*b]=z<m&&R<f?e.data[z+R*m]:0;m=b,f=x}u(e.properties,k.properties)}if("collision-layer"===t)for(L=[],z=0;z<o.length;z++)if((I=o[z]).tileproperties)for(U in I.tileproperties)I.tileproperties.hasOwnProperty(U)&&I.tileproperties[U].jumpThrough&&L.push(I.firstgid+parseInt(U,10));if(k.properties.width=w*m*this.unitsPerPixel,k.properties.height=v*f*this.unitsPerPixel,k.properties.columns=m,k.properties.rows=f,k.properties.tileWidth=w*this.unitsPerPixel,k.properties.tileHeight=v*this.unitsPerPixel,k.properties.scaleX=this.imagesScale,k.properties.scaleY=this.imagesScale,k.properties.layerZ=this.layerZ,k.properties.left=k.properties.x||i,k.properties.top=k.properties.y||s,k.properties.z=k.properties.z||this.layerZ,o.length){for(z=0;z<o.length;z++)Y(M,z,o[z],this.unitsPerPixel/this.imagesScale);for(C=(d=o[o.length-1]).firstgid+d.tilecount,z=-1;z<C;z++)A["tile"+z]=z}for(z=0;z<m;z++)for(P[z]=[],B[z]=[],R=0;R<f;R++)X=+O[z+R*m]-1,B[z][R]="tile"+X,X+=1,L&&L.length&&L[0]===(268435455&X)&&(X|=268435456),P[z][R]=X;for(z=0;z<k.components.length;z++)"RenderTiles"===k.components[z].type&&(T=k.components[z]),"import"===k.components[z].spriteSheet?k.components[z].spriteSheet=D:k.components[z].spriteSheet&&("string"==typeof k.components[z].spriteSheet&&platypus.game.settings.spriteSheets[k.components[z].spriteSheet]&&(k.components[z].spriteSheet=platypus.game.settings.spriteSheets[k.components[z].spriteSheet]),k.components[z].spriteSheet.animations||(k.components[z].spriteSheet.animations=A)),"import"===k.components[z].collisionMap&&(k.components[z].collisionMap=P),"import"===k.components[z].imageMap&&(k.components[z].imageMap=B);return this.layerZ+=this.layerIncrement,"render-layer"===t&&!this.separateTiles&&l&&l.tileHeight===v&&l.tileWidth===w&&l.columns===m&&l.rows===f?(l.triggerEvent("add-tiles",T),this.updateLoadingProgress(p),l):(g={},"render-layer"===t&&this.spriteSheet&&("string"==typeof this.spriteSheet?g.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]:g.spriteSheet=this.spriteSheet,g.spriteSheet.animations||(g.spriteSheet.animations=A)),this.owner.addEntity(new r(k,{properties:g},this.updateLoadingProgress.bind(this,p),this.owner)))},convertImageLayer:function(t){var e,i=null,s=0,n="",r=t.properties||{},a=c(r,"repeat"),h=c(r,"repeat-x"),l=c(r,"repeat-y"),p={data:[],image:"",height:1,name:t.name,type:"tilelayer",width:1,tileheight:1,tilewidth:1,x:t.x,y:t.y,properties:r};for(a&&(p.width=+a,p.height=+a),h&&(p.width=+h),l&&(p.height=+l),e=p.width*p.height,s=0;s<e;s++)p.data.push(1);return(i=this.assetCache.read(t.name))?(p.image=t.name,p.tileheight=i.height,p.tilewidth=i.width):(n=o(t.image),(i=this.assetCache.read(n))?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+t.name+'", so using "'+t.image+'" instead.'),p.image=n,p.tileheight=i.height,p.tilewidth=i.width):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+t.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+t.name+'".'),p.image=t.image)),p.tileset={columns:1,image:p.image,imageheight:p.tileheight,imagewidth:p.tilewidth,margin:0,name:t.name,spacing:0,tilecount:1,tileheight:p.tileheight,tilewidth:p.tilewidth,type:"tileset"},p},loadLevel:function(t,e){var i,r,a,l,p,d,g=!0,m=null,y=0,f="",w=null,b=null,x=null,S=null,E=n.setUp("count",0,"progress",0,"total",0),C=0,k=0;if(i=(m="string"==typeof t.level?platypus.game.settings.levels[t.level]:t.level).layers,a=v(m.tilesets),l=m.tilewidth,p=m.tileheight,m.properties&&u(m.properties,this.owner),0===(w=this.images?this.images.greenSlice():Array.setUp()).length)for(y=0;y<a.length;y++)S=a[y],this.assetCache.read(S.name)?w.push(S.name):(f=o(S.image),this.assetCache.read(f)?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+S.name+'", so using "'+S.image+'" instead.'),w.push(f)):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+S.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+S.name+'".'),w.push(S.image)));for(d=m.width*l*this.unitsPerPixel,r=m.height*p*this.unitsPerPixel,this.offsetMap&&(C=h(d),k=h(r)),E.total=y=i.length;y--;)"objectgroup"===i[y].type?E.total+=i[y].objects.length:!g||"collision"!==i[y].name&&"collision-layer"!==c(i[y].properties,"entity")||(g=!1);for(this.finishedLoading=function(t,e,i,r,a,o,h,l){var c=n.setUp("level",null,"world",s.setUp(),"tile",s.setUp(),"camera",null);c.level=t,c.camera=this.followEntity,c.width=r,c.height=a,c.world.setBounds(e,i,e+r,i+a),c.tile.setBounds(0,0,o,h),this.owner.triggerEvent("world-loaded",c),c.world.recycle(),c.tile.recycle(),c.recycle(),this.owner.removeComponent(this),l&&l()}.bind(this,m,C,k,d,r,l,p,e),y=0;y<i.length;y++)switch((x=i[y]).type){case"imagelayer":b=this.convertImageLayer(x),b=this.createLayer("image-layer",b,C,k,b.tilewidth,b.tileheight,[b.tileset],w,b,E);break;case"objectgroup":this.setUpEntities(x,C,k,l,p,a,E),b=null,this.updateLoadingProgress(E);break;case"tilelayer":b=this.setupLayer(x,g,b,C,k,l,p,a,w,E);break;default:platypus.debug.warn('Component TiledLoader: Platypus does not support Tiled layers of type "'+x.type+'". This layer will not be loaded.'),this.updateLoadingProgress(E)}},setUpEntities:function(t,e,i,s,n,a,o){var h=0,l=0,p=0,u=0,g=0,m=0,y=0,f=null,v=0,w=null,b=null,x=null,S=c(t.properties,"entityPositionX")||this.entityPositionX,E=c(t.properties,"entityPositionY")||this.entityPositionY,C="",k=-1,A=1/0,P=-1/0,M=1/0,B=-1/0,D=null,T=null,I=null,L=0,X=0;for(e+=t.offsetx||0,i+=t.offsety||0,v=0;v<t.objects.length;v++)if(w=t.objects[v],D=d(w,a)){if(k=D.gid,C=D.type,x=(b=platypus.game.settings.entities[C])&&b.properties||null,T=D.properties,w.polygon||w.polyline){for(A=1/0,P=-1/0,M=1/0,B=-1/0,I=null,w.polygon?I=w.polygon:w.polyline&&(I=w.polyline),p=0;p<I.length;p++)I[p].x>P&&(P=I[p].x),I[p].x<A&&(A=I[p].x),I[p].y>B&&(B=I[p].y),I[p].y<M&&(M=I[p].y);if(T.width=P-A,T.height=B-M,T.x=w.x+A,T.y=w.y+M,h=0,l=0,T.width=T.width*this.unitsPerPixel,T.height=T.height*this.unitsPerPixel,T.x=T.x*this.unitsPerPixel+e,T.y=T.y*this.unitsPerPixel+i,w.polygon)for(T.shape={},T.shape.type="polygon",T.shape.points=[],u=0;u<I.length;u++)T.shape.points.push({x:(I[u].x-A)*this.unitsPerPixel+e,y:(I[u].y-M)*this.unitsPerPixel+i});else if(w.polyline)for(T.shape={},T.shape.type="polyline",T.shape.points=[],u=0;u<I.length;u++)T.shape.points.push({x:(I[u].x-A)*this.unitsPerPixel+e,y:(I[u].y-M)*this.unitsPerPixel+i})}else L=s*this.unitsPerPixel,X=n*this.unitsPerPixel,h=0,l=0,T.width=(w.width||0)*this.unitsPerPixel,T.height=(w.height||0)*this.unitsPerPixel,x&&("number"==typeof x.width&&(T.width=x.width,h=L),"number"==typeof x.height&&(T.height=x.height,l=X)),w.point||(T.width||(T.width=L),T.height||(T.height=X),h=h||T.width,l=l||T.height),T.x=w.x*this.unitsPerPixel,T.y=w.y*this.unitsPerPixel,w.rotation&&(g=(w.width||L)/2,m=(w.height||X)/2,y=w.rotation/180%2*Math.PI,f=platypus.Vector.setUp(g,-m).rotate(y),T.rotation=w.rotation,T.x=Math.round(1e3*(T.x+f.x-g))/1e3,T.y=Math.round(1e3*(T.y+f.y+m))/1e3,f.recycle()),"left"===S?T.regX=0:"center"===S?(T.regX=T.width/2,T.x+=h/2):"right"===S&&(T.regX=T.width,T.x+=h),T.x+=e,-1===k&&(T.y+=T.height),"bottom"===E?T.regY=T.height:"center"===E?(T.regY=T.height/2,T.y-=l/2):"top"===E&&(T.regY=0,T.y-=l),T.y+=i,w.ellipse?(T.shape={},T.shape.type="circle",T.shape.width=T.width*this.unitsPerPixel,T.shape.height=T.height*this.unitsPerPixel,T.shape.radius=(T.width+T.height)*this.unitsPerPixel/4):w.width&&w.height&&(T.shape={},T.shape.type="rectangle",T.shape.width=T.width*this.unitsPerPixel,T.shape.height=T.height*this.unitsPerPixel);x?(T.scaleX*=this.imagesScale*(x.scaleX||1),T.scaleY*=this.imagesScale*(x.scaleY||1)):(T.scaleX*=this.imagesScale,T.scaleY*=this.imagesScale),T.layerZ=this.layerZ,T.z?T.z+=this.layerZ:x&&"number"==typeof x.z?T.z=this.layerZ+x.z:T.z=this.layerZ,(w=this.owner.addEntity(new r(b,{properties:T},this.updateLoadingProgress.bind(this,o),this.owner)))&&(w.camera&&(this.followEntity={entity:w,mode:w.camera}),this.owner.triggerEvent("entity-created",w))}else this.updateLoadingProgress(o);this.layerZ+=this.layerIncrement},setupLayer:function(t,e,i,s,n,r,a,o,h,l){var p=!1,d=c(t.properties,"entity"),u=d||"render-layer",g=null,m=0;if(d||("collision"===t.name?u="collision-layer":"action"===t.name&&(u=e?"tile-layer":"render-layer")),"tile-layer"===u||this.showCollisionTiles&&platypus.game.settings.debug)return l.count+=1,this.createLayer("collision-layer",t,s,n,r,a,o,h,i,l),this.createLayer("render-layer",t,s,n,r,a,o,h,i,l);if("collision-layer"===u)return this.createLayer("collision-layer",t,s,n,r,a,o,h,i,l),null;if(g=platypus.game.settings.entities[u])for(m=g.components.length;m--;)if("RenderTiles"===g.components[m].type){p=!0;break}return p?this.createLayer(u,t,s,n,r,a,o,h,i,l):(this.createLayer(u,t,s,n,r,a,o,h,i,l),null)},updateLoadingProgress:function(t){t.count+=1,t.progress=t.count/t.total,this.owner.triggerEvent("level-loading-progress",t),t.count===t.total&&(t.recycle(),this.finishedLoading())},destroy:function(){}},publicMethods:{decodeLayer:function(t){return"base64"===t.encoding&&(t.data=a(t.data,t.compression),t.encoding="csv"),t}},getAssetList:function(t,e,i){var s=e||{},n=i||{},r=t.spriteSheet||s.spriteSheet||n.spriteSheet,a=t.images||s.images||n.images,o=m(t.level||s.level||n.level,r);return r&&("string"==typeof r?o.union(platypus.game.settings.spriteSheets[r].images):o.union(r.images)),a&&o.union(a),o},getLateAssetList:function(t,e,i,s){var n=e||{},r=i||{},a=t.spriteSheet||n.spriteSheet||r.spriteSheet;return s&&s.level?m(s.level,a):Array.setUp()}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"Timer",properties:{xo:0,yo:0,onComplete:null,length:0,manual:!1,subLength:0,subFunction:null},publicProperties:{},initialize:function(){this.bg=this.addElement("barBG",this.xo,this.yo,1,.01,.01,1),this.fg=this.addElement("barFG",this.xo+2,this.yo,2,1e-4,.5,.66),this.c=0,this.speed=.0055/this.length,this.subLength&&(this.c2=0,this.speed2=.0055/this.subLength),t.get(this.bg).to({scaleX:.5,scaleY:.5},250,createjs.Ease.sineOut)},events:{adopted:function(){},"handle-logic":function(){this.manual||(this.subLength&&(this.c2+=this.speed2,this.c2>1&&(this.c2=0,this.subFunction())),this.c+=this.speed,this.fg.scaleX+=(.5*this.c-this.fg.scaleX)/25,this.c>1&&(this.remove(),this.c=0))}},methods:{addElement:function(t,e,i,s,n,r,a){return this.owner.parent.addEntity({id:"timerElement",components:[{type:"RenderSprite",spriteSheet:"plantFeedback",animationMap:{default:t}}],properties:{x:this.owner.x+e,y:this.owner.y+i,z:this.owner.z+s,scaleX:n,scaleY:r,opacity:a}})}},publicMethods:{updateVal:function(t){this.fg&&(this.fg.scaleX+=(.5*t-this.fg.scaleX)/25)},updatePos:function(){this.fg&&(this.bg.x=this.owner.x+this.ox,this.bg.y=this.owner.y+this.oy,this.fg.x=this.owner.x+this.ox,this.fg.y=this.owner.y+this.oy)},remove:function(){this.fg.opacity=0,t.get(this.bg).to({scaleX:.01,scaleY:.01},250,createjs.Ease.sineOut).call(function(){this.owner&&!this.owner.destroyed&&this.remove2()}.bind(this))},remove2:function(){this.onComplete&&(this.onComplete(),this.bg.removeSelf(),this.fg.removeSelf(),this.bg=null,this.fg=null,this.owner.removeComponent(this),this.subFunction=null)}}})}(),function(){"use strict";platypus.createComponentClass({id:"TitleScaler",properties:{increment:1,auto:!1},initialize:function(){this.scaling=!1,this.srxi=0,this.sryi=0,this.marked=!1,this.sc=0,this.stars=[],this.auto&&(this.scaling=!0)},events:{"start-scaling":function(){this.scaling=!0,this.owner.triggerEvent("stop-audio")},"prepare-logic":function(){this.scaling&&(this.owner.scaleX*=this.increment,this.owner.scaleY*=this.increment,this.increment>1?(this.increment*=1.000001,(this.owner.y<0&&this.owner.x>0||this.marked)&&(this.marked=!0,this.srxi+=.001,this.sryi+=.0015,this.owner.x+=this.srxi,this.owner.y-=this.sryi)):this.increment*=.99999)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("PIXI.Container"),i=include("platypus.Data"),s=include("createjs.Ease"),n=include("platypus.Entity"),r=include("PIXI.Graphics"),a=include("createjs.Tween"),o=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null};platypus.createComponentClass({id:"ToolBoxHandler",properties:{toolBoxHeight:550,toolBoxTop:-300},publicProperties:{scrollable:!0},initialize:function(){this.mask=null,this.count=0,this.verticalSpacing=o(platypus.game.settings.entities["toolbox-item"].properties,"height"),this.upperLimit=this.toolBoxTop+this.verticalSpacing/2,this.lowerLimit=this.upperLimit,this.playerResources=Array.setUp(),this.scrollDistance=Math.max(Math.floor(this.toolBoxHeight/this.verticalSpacing)-1,1)*this.verticalSpacing,this.target={y:this.upperLimit},this.scrollTween=null,platypus.game.app.getResources=function(){return this.playerResources}.bind(this),platypus.game.app.isReallyReady=function(){for(var t=this.owner.getEntitiesByType("toolbox-item"),e=t.length;e--;)if(t[e].count&&!t[e].state.get("infinite"))return!1;return!0}.bind(this)},events:{"child-entity-added":function(t){"scroll-down"===t.type?(this.scrollDown=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop+this.toolBoxHeight):"scroll-up"===t.type&&(this.scrollUp=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop)},"process-level":function(t){for(var e="",s=t.level.properties,n="",r=i.setUp(),a=t.level.layers,h=a.length,l=0,c=null,p=null;h--;)if(p=a[h].objects)for(l=p.length;l--;)(c=p[l]).type&&"true"===o(c.properties,"savable")&&(r[c.type]=(r[c.type]||0)+1);if(Array.isArray(s))for(h=0;h<s.length;h++)"menu."===(n=s[h].name).substring(0,5)&&(e=n.substring(5),this.addMenuItem(e,s[h].value,r[e]));else for(n in s)s.hasOwnProperty(n)&&"menu."===n.substring(0,5)&&(e=n.substring(5),this.addMenuItem(e,s[n],r[e]));r.recycle(),this.toolbox.y=this.upperLimit,this.lowerLimit=Math.min(this.upperLimit,this.upperLimit-this.count*this.verticalSpacing+this.toolBoxHeight),this.upperLimit===this.lowerLimit?this.scrollable=!1:this.scrollDown.triggerEvent("show-sprite")},"render-world":function(i){var s=i.renderGroups,n=i.world,a=function(t,i,s){for(var n=i.length,r=null;n--;)if(i[n].name===t)return i[n];return(r=new e).name=t,i.push(r),s.addChild(r),r}("toolbox",s,n);a.z=1,this.toolbox=a,this.mask=function(t,e,i){var s=new r;return t.mask=s,s.isMask=!0,s.z=1,e.addChild(s),s.clear(),s.beginFill(0,1),s.r(i.left,i.top,i.width,i.height),s.endFill(),s}(a,n,t.setUp(0,this.toolBoxTop+this.toolBoxHeight/2,2e3,this.toolBoxHeight)),i.world.reorder=!0},"scroll-up":function(){var t=this.target.y+this.scrollDistance;this.swipe||(t>=this.upperLimit&&(t=this.upperLimit),this.scrollTween=a.get(this.target,{override:!0}).to({y:t},300,s.sineInOut))},"scroll-down":function(){var t=this.target.y-this.scrollDistance;this.swipe||(t<=this.lowerLimit&&(t=this.lowerLimit),this.scrollTween=a.get(this.target,{override:!0}).to({y:t},300,s.sineInOut))},swipe:function(t){this.swipe||(a.removeTweens(this.target),this.swipe=function(t,e,i){var s=e-t+i.y;s>=this.upperLimit?(s=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):s<=this.lowerLimit?(s=this.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=s,this.forceCameraUpdate()}.bind(this,t.y,this.toolbox.y)),this.swipe(t)},"end-swipe":function(t){this.swipe&&(this.swipe(t),this.swipe=null)},tick:function(){var t=this.target.y;this.toolbox.y!==t&&(this.swipe?this.target.y=this.toolbox.y:(t>=this.upperLimit?(t=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):t<=this.lowerLimit?(t=this.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=t,this.forceCameraUpdate()))}},methods:{addMenuItem:function(t,e,i){var s={},n={state:s};this.playerResources.push({name:t,count:e}),s[t]=!0,-1==+e?n.infinite=!0:(i&&(e-=i),n.count=e),n.y=this.count*this.verticalSpacing,n.spawns=t,this.lastEntityAdded=this.owner.addEntity({type:"toolbox-item",properties:n}),this.owner.triggerEvent("added-item-to-toolbox",t),this.count+=1},forceCameraUpdate:function(){this.lastEntityAdded&&this.owner.triggerEvent("child-entity-updated",this.lastEntityAdded)},destroy:function(){this.playerResources.recycle(),this.playerResources=null}},publicMethods:{getEntitiesAtPoint:function(e,i){for(var s=t.setUp(),n=Array.setUp(),r=this.owner.entities,a=null,o=r.length;o--;)a=r[o],s.setAll(a.x||0,a.y||0,a.width||0,a.height||0),s.containsPoint(e,i-this.toolbox.y)&&n.push(a);return s.recycle(),n}},getAssetList:function(){return n.getAssetList({type:"toolbox-item"})},getLateAssetList:function(t,e,i,s){var r=null,a=Array.setUp(),o=0,h=s&&s.level,l=null,c="";if("string"==typeof h&&(h=platypus.game.settings.levels[h]),l=h.properties)if(Array.isArray(l))for(o=0;o<l.length;o++)"menu."===(c=l[o].name).substring(0,5)&&(r=n.getAssetList({type:c.substring(5)}),a.union(r),r.recycle());else for(c in l)l.hasOwnProperty(c)&&"menu."===c.substring(0,5)&&(r=n.getAssetList({type:c.substring(5)}),a.union(r),r.recycle());return a}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"TrashRegion",initialize:function(){this.initialCamera=t.setUp(0,0,1600,1200)},properties:{panelOffset:300},publicProperties:{width:500},events:{"camera-update":function(t){var e=this.owner,i=Math.min(t.viewport.width/this.initialCamera.width,t.viewport.height/this.initialCamera.height);e.x=t.viewport.left+(this.width-this.panelOffset)*i-this.width/2,e.y=t.viewport.y}},methods:{destroy:function(){this.initialCamera.recycle(),this.initialCamera=null}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Tween"),i=["level-idle-3","level-idle-2","level-idle"],s=0,n=function(t){var e=createjs.Sound._getSrcById(t);return e&&e.src&&(e=createjs.Sound.activePlugin._audioSources[e.src])?1e3*(e.duration||0)>>0:0};platypus.createComponentClass({id:"TutorialSystem",properties:{},publicProperties:{},initialize:function(){this.everClosedRecipe=!1,this.recipeOpen=!0,this.camera=t.setUp(),this.countdown=15e3,this.simulationStarted=!1,this.setup=!1,this.skipGraceTime=200},events:{"camera-update":function(t){this.camera.set(t.viewport),this.setup||(this.setup=!0,this.beginTalking(e.get(this.owner)).call(this.owner.trigger,["announce-level"]))},"scene-live":function(t){this.levelId="string"==typeof t.level?t.level:function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null}(t.level.properties,"levelId")},"announce-level":function(){this.levelId&&this.owner.triggerEvent("announce-"+this.levelId)},"handle-logic":function(t){this.countdown>0&&(platypus.game.app.voPlayer.playing||this.recipeOpen?this.countdown=15e3:(this.countdown-=t.delta,this.countdown<=0&&(this.countdown=15e3,this.simulationStarted?this.owner.triggerEvent("level-idle-sim"):(this.owner.triggerEvent(i[s]),s=(s+1)%i.length))))},"closed-recipe":function(){this.everClosedRecipe||(this.everClosedRecipe=!0,this.owner.triggerEvent("begin-"+this.levelId+"-tutorial")),this.recipeOpen=!1},"opened-recipe":function(){this.recipeOpen=!0},"simulation-started":function(){this.countdown=75e3,this.simulationStarted=!0},"simulation-stopped":function(){this.countdown=15e3,this.simulationStarted=!1},"level-successful":function(){this.countdown=0},"did-something":function(){this.simulationStarted||(this.countdown=15e3)},"hint-it":function(){this.owner.parent.parent.triggerOnChildren("soft-hint")},"point-out-go-button":function(){this.addGoButton(e.get(this.owner))},"point-out-recipe":function(){var t=this.owner.trigger,i=e.get(this.owner).to({rotation:135,x:this.camera.left+300,y:0},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2e3).to({opacity:0},300);this.beginTalking(i).call(t,["hint-it"]).call(t,["hint-it"]).wait(5e3),this.addGoButton(i)},"point-out-recipe-only":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:135,x:this.camera.left+300,y:0},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"])},"point-out-help":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:135,x:this.camera.left+300,y:this.camera.bottom-190},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"])},"chopper-drag":function(){var t=this.owner.trigger,i=e.get(this.owner).to({rotation:-135,x:this.camera.left+300,y:this.camera.top+300},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({x:75,y:0,rotation:0},600).call(t,["hint-it"]).wait(1e3).to({opacity:0},300).call(t,["hide-sprite"]).wait(1500);this.addGoButton(i),i.to({x:0,y:100,rotation:90},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"])},"oven-drag":function(){var t=this.owner.trigger,i=e.get(this.owner).to({rotation:-135,x:this.camera.left+300,y:this.camera.top+300},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({x:50,y:-50,rotation:-225},600).call(t,["hint-it"]).wait(1e3).to({opacity:0},300).call(t,["hide-sprite"]);this.addGoButton(i)},"back-home":function(){this.goBackHome(e.get(this.owner))},chat:function(){this.beginTalking(e.get(this.owner))},quiet:function(){var t=this.owner.trigger;this.owner.triggerEvent("stop-active-timelines"),this.goBackHome(e.get(this.owner,{override:!0}).to({opacity:0},1).call(t,["hide-sprite"]))},"begin-action-vo-succeed":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,r="";if(this.time=Date.now(),this.duration=n(t),i)for(s=0;s<i.length;s++)r+=i[s].content+" ";e.analyticsEmitter.startCorrectFeedback(e.levelId||"","audio",this.duration,r,t)},"begin-action-vo-fail":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,r="";if(this.time=Date.now(),this.duration=n(t),i)for(s=0;s<i.length;s++)r+=i[s].content+" ";e.analyticsEmitter.startIncorrectFeedback(e.levelId||"","audio",this.duration,r,t)},"begin-instruction":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,r="";if(this.time=Date.now(),this.duration=n(t),i)for(s=0;s<i.length;s++)r+=i[s].content+" ";e.analyticsEmitter.startInstruction(e.levelId||"","audio",this.duration,r,t),e.googleAnalytics.event(e.name,"TutorialStart",t)},"end-action-vo-succeed":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="",r=Date.now()-this.time,a=r<this.duration-this.skipGraceTime;if(i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.endCorrectFeedback(e.analyticsEmitter._round||0,e.levelId||"","audio",r>>0,n,t,a)},"end-action-vo-fail":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="",r=Date.now()-this.time,a=r<this.duration-this.skipGraceTime;if(i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.endIncorrectFeedback(e.analyticsEmitter._round||0,e.levelId||"","audio",r>>0,n,t,a)},"end-instruction":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="",r=Date.now()-this.time,a=r<this.duration-this.skipGraceTime;if(i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.endInstruction(e.analyticsEmitter._round||0,e.levelId||"","audio",r>>0,n,t,a,e.getEnlearnData()),a?e.googleAnalytics.event(e.name,"TutorialSkip",t):e.googleAnalytics.event(e.name,"TutorialComplete",t)}},methods:{beginTalking:function(t){return t.to({x:this.camera.right-150,y:this.camera.top+150},600),t},goBackHome:function(t){var e=this.camera;return e.width/e.height<1.8?t.to({x:this.camera.right+150,y:this.camera.top+150},300):t.to({x:this.camera.right-150,y:this.camera.top+150},600),t},addGoButton:function(t){var e=this.owner.trigger;return t.to({rotation:45,x:this.camera.right-250,y:this.camera.bottom-250},600).call(e,["show-sprite"]).to({opacity:1},300).call(e,["pointy"]).wait(2e3).to({opacity:0},300).call(e,["hide-sprite"]),t}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"UnlockSequence",properties:{},publicProperties:{},initialize:function(){},events:{"complete-level":function(){this.owner.state.set("completing",!0)},"unlock-level":function(){this.owner.state.set("unlocking",!0)},"animation-ended":function(t){"completing"===t&&(this.owner.state.set("completing",!1),this.owner.state.set("complete",!0),this.owner.parent.triggerEvent("level-unlock-sequence")),"unlocking"===t&&(this.owner.state.set("unlocking",!1),this.owner.state.set("disabled",!1))}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.components.AudioVO"),e=include("platypus.components.RenderAnimation"),i=include("platypus.components.RenderSprite"),s=function(t,e){return" "===e?t+"default":t+e},n=function(t,e,i){this.owner.addComponent(new t(this.owner,e,i))},r=function(t,e,i,n){var r=0,a="",o={},h=0,l="",c="",p=t.voice,d=t.mouthCues;if("string"==typeof t)o.sound=t,o.events=Array.setUp();else if("string"==typeof t.sound)o.sound=t.sound,o.events=Array.setUp();else{for(a in t.sound)t.sound.hasOwnProperty(a)&&(o[a]=t.sound[a]);o.events?o.events=o.events.greenSlice():o.events=Array.setUp()}if(p||d||!platypus.game.app.config.mouthCues||(d=platypus.game.app.config.mouthCues[o.sound]),p)for(p+=" ",r=0;r<p.length;r++)(c=p[r])!==l&&(l=c,o.events.push({time:h,event:s(i,c)})),h+=n;else if(d)for(r=0;r<d.length;r++)c=d[r],o.events.push({time:1e3*c.start,event:s(i,c.value)}),h+=n;return o},a=function(t,e,i,s){var n=0,a=Array.setUp();if(e[" "]||(e[" "]=e.default),Array.isArray(t)){for(n=0;n<t.length;n++)"number"==typeof t[n]?a.push(t[n]):a.push(r(t[n],0,i,s));return a}return r(t,0,i,s)};platypus.createComponentClass({id:"VoiceOver",properties:{animationMap:{default:"default"},renderComponent:"",frameLength:100,messagePrefix:"",voiceOverMap:{}},initialize:function(r,o){var h="",l=Array.setUp(),c={audioMap:{},aliases:r.aliases},p={acceptInput:r.acceptInput,aliases:r.aliases,animation:r.animation,animationMap:{},eventBased:!0,flip:r.flip,hidden:r.hidden,interactive:r.interactive,mask:r.mask,mirror:r.mirror,offsetZ:r.offsetZ,regX:r.regX,regY:r.regY,restart:r.restart,rotate:r.rotate,scaleX:r.scaleX,scaleY:r.scaleY,spriteSheet:r.spriteSheet,stateBased:r.stateBased||!1};for(h in this.messagePrefix?this.message=this.messagePrefix+"-":this.message="",this.animationMap)this.animationMap.hasOwnProperty(h)&&(p.animationMap[s(this.message,h)]=this.animationMap[h]);for(h in p.animationMap.default=this.animationMap.default,this.renderComponent?l.push(n.bind(this,platypus.components[this.renderComponent],p)):l.push(n.bind(this,r.animation?e:i,p)),this.voiceOverMap)this.voiceOverMap.hasOwnProperty(h)&&(c.audioMap[h]=a(this.voiceOverMap[h],this.animationMap,this.message,this.frameLength));return l.push(n.bind(this,t,c)),platypus.Async.setUp(l,o),l.recycle(),!0},events:{load:function(){this.owner.removeComponent(this)}},getAssetList:function(t,e,i){var s=t.spriteSheet||e.spriteSheet||i&&i.spriteSheet;return"string"==typeof s?platypus.game.settings.spriteSheets[s].images.greenSlice():s?s.images.greenSlice():Array.setUp()}})}(),function(){"use strict";platypus.createComponentClass({id:"WaterLogic",properties:{},publicProperties:{},initialize:function(){},events:{"water-click":function(){this.owner.parent.triggerEvent("water-clicked")},"handle-logic":function(t){}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"WhatsBeingDragged",properties:{},publicProperties:{},initialize:function(){this.dragging=[]},events:{"dragging-a-piece":function(t){this.dragging.includes(t)||(this.dragging.push(t),1===this.dragging.length&&this.owner.triggerEvent("rl-dragging-taking-place"))},"finished-dragging-a-piece":function(t){var e;(e=this.dragging.indexOf(t))>=0&&(this.dragging.splice(e,1),0===this.dragging.length&&this.owner.triggerEvent("rl-no-dragging-taking-place"))}},methods:{},publicMethods:{isThisGroupMoving:function(t){var e=0;for(e=0;e<this.dragging.length;e++)if(this.dragging[e].groupId===t)return!0;return!1}}})}(),function(){"use strict";platypus.createComponentClass({id:"WorkSpace",initialize:function(){var t=this.owner;t.x=t.width/2,t.y=t.height/2},events:{pointerdown:function(t){this.lastLocationX=t.x,this.lastLocationY=t.y},pointerup:function(t){this.lastLocationX===t.x&&this.lastLocationY===t.y&&this.owner.triggerEvent("pointer-was-not-moved",t)}}})}(),function(){"use strict";platypus.createComponentClass({id:"ZoomBannerLogic",properties:{},publicProperties:{banner:null},initialize:function(){},events:{zoom:function(){this.owner.parent.triggerEvent("zoom-in",this.owner.banner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Vector");platypus.createComponentClass({id:"Zoomer",properties:{},publicProperties:{zooming:!1,zoomEnabled:!0,zoomPaused:!1},initialize:function(){var e=this.interaction=platypus.game.app.display.renderer.plugins.interaction;this.zoomLocks=0,this.zoomStep=1,this.camera=t.setUp(),this.pointers=Array.setUp(),this.mouseWorldOrigin=i.setUp(),this.continuing=function(t){var e=this.pointers;e.length>=1&&(this.repositionCamera(e[0],t.data.global),t.stopPropagation())}.bind(this),e.on("pointermove",this.continuing),this.ending=function(t){for(var e=null,i=this.pointers,s=i.length,n=t.data.identifier;s--;)if(i[s].identifier===n){i.greenSplice(s).recycle();break}1===i.length&&((e=i[0]).x=e.toX,e.y=e.toY,this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y)}.bind(this),e.on("pointerup",this.ending),e.on("pointerupoutside",this.ending),e.on("pointercancel",this.ending),this.zoomDimensionsCollected=!1,this.zoomDimensions={width:0,height:0,lastWidth:0},this.initialZoomDimensions={width:0,height:0}},events:{tick:function(){},"camera-update":function(t){this.camera.set(t.viewport),this.currentZoom=t.scaleX,this.zoomDimensionsCollected||(this.zoomDimensionsCollected=!0,this.zoomDimensions={width:t.viewport.width,height:t.viewport.height,lastWidth:t.viewport.width},this.initialZoomDimensions={width:t.viewport.width,height:t.viewport.height})},"workspace-pointerdown":function(t){this.zoomEnabled&&!this.zoomPaused&&this.start(t)},"pause-zooming":function(){this.zoomLocks+=1,this.zoomPaused=!0},"unpause-zooming":function(){this.zoomLocks-=1,this.zoomLocks<0&&(this.zoomLocks=0),this.zoomPaused=!!this.zoomLocks}},methods:{destroy:function(){var t=this.interaction;this.camera.recycle(),this.camera=null,this.mouseWorldOrigin.recycle(),this.mouseWorldOrigin=null,this.pointers.recycle(2),this.pointers=null,t.off("pointermove",this.continuing),t.off("pointerup",this.ending),t.off("pointerupoutside",this.ending),t.off("pointercancel",this.ending)},start:function(t){var i=this.camera,s=this.pointers;this.zooming=!0,this.owner.triggerEvent("stop-following-if-simulating"),s.push(e.setUp("toX",t.pixiEvent.data.global.x,"toY",t.pixiEvent.data.global.y,"x",t.pixiEvent.data.global.x,"y",t.pixiEvent.data.global.y,"identifier",t.pixiEvent.data.identifier)),1===s.length&&(this.mouseWorldOrigin.x=i.x,this.mouseWorldOrigin.y=i.y),t.pixiEvent.stopPropagation()},repositionCamera:function(t,e){var s=i.setUp(t.x-e.x,t.y-e.y),n=this.owner.windowToWorld(s,!1);n.x+=this.mouseWorldOrigin.x,n.y=this.camera.y,this.owner.triggerEvent("relocate",n),s.recycle(),n.recycle()}}})}();