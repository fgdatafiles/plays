!function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Point"),d=function(a){this.id=a,this.z=null,this.plx=1,this.pos=new c(0,0),this.origin=new c(0,0),this.offsety=0,this.setImage(a)},e=d.prototype;e.setImage=function(c){this.view=new b,this.b=new a(images[c]),this.view.addChild(this.b),this.width=this.b.image.width,this.height=this.b.image.height,this.origin.x=this.width/2,this.origin.y=this.height,this.b.x=-1*this.origin.x,this.b.y=-1*this.origin.y,this.radius=this.width>this.height?this.width/2:this.height/2,this.radius2=this.radius*this.radius,this.view.id=this.id,this.ypos=this.height+this.offsety,this.view.y=this.ypos},e.setoffsety=function(a){this.offsety=a,this.ypos=this.height+this.offsety,this.view.y=this.ypos},e.draw=function(){var a=new c((this.pos.x-this.cam.pos.x)*this.plx,this.height+(-1*this.cam.offset.y+this.height+this.pos.y-this.cam.pos.y)*this.plx);this.view.x=a.x},e.move=function(a){},e.appear=function(){this.view.visible=!0},e.setpos=function(a,b){this.pos.x=a,this.pos.y=b},e.setDistance=function(a){a===this.z||a>100||(this.z=a,this.view.stack=1e4*this.z+1e3,this.plx=(100-this.z)/99,this.updatez=!0)},e.setCamera=function(a){this.cam=a},namespace("lib").BGPanel=d}(),function(){var a=include("createjs.Point"),b=function(){this.mv=new a(0,0),this.v=new a(0,0),this.pos=new a(0,0),this.offset=new a(0,0),this.look=new a(0,0),this.setframe({w:100,h:100}),this.horizon=0},c=b.prototype;c.move=function(){this.pos.x+=this.mv.x,this.pos.y+=this.mv.y},c.setframe=function(a){this.frame={w:a.w,h:a.h},this.halfframe={w:this.frame.w/2,h:this.frame.h/2}},c.sethorizon=function(a){this.horizon=a},c.animate=function(){},c.setpos=function(a,b){this.pos.x=a+this.offset.x,this.pos.y=b+this.offset.y,this.look.x=a,this.look.y=b},c.shiftpos=function(a,b){this.pos.x=this.pos.x+a,this.pos.y=this.pos.y+b,this.look.x=this.pos.x-this.offset.x,this.look.y=this.pos.y-this.offset.y},c.follow=function(b){var c=new a((b.pos.x-this.look.x)/b.plx,(b.pos.y-this.look.y)/b.plx),d=new a(this.look.x,this.look.y);c.x>0&&c.x>this.halfframe.w?d.x=b.pos.x-this.halfframe.w:c.x<0&&c.x<-1*this.halfframe.w&&(d.x=b.pos.x+this.halfframe.w),c.y>0&&c.y>this.halfframe.h?d.y=b.pos.y-this.halfframe.h:c.y<0&&c.y<-1*this.halfframe.h&&(d.y=b.pos.y+this.halfframe.h),d.y>this.max?d.y=this.max:d.y<this.min&&(d.y=this.min),this.setpos(d.x,d.y)},namespace("lib").Camera=b}(),function(a){var b=include("createjs.Bitmap"),c=function(a,b){this.ss=b,this.species=a,this.setSpriteImage(this.ss._images[0]),this.animated=!1,this.animstate=0,this.animset=[],this.moving=!1,this.height=300,this.width=300,this.flipped=!1,this.useframe=null,this.initialize(),this.animsuffix="",this.animtype="",this.setRest()},d=c.prototype=new b;d.Parent_initialize=d.initialize,d.initialize=function(){this.Parent_initialize(this.imageOrUri),a.makeBasic(this)},d.setRest=function(){this.setFrameset("_rest")&&this.updateFrame()},d.setSuffix=function(a){a?this.animsuffix!=a&&(this.animsuffix=a,this.setFrameset(this.animtype)):""!==this.animsuffix&&(this.animsuffix="",this.setFrameset(this.animtype))},d.setSpriteImage=function(a){this.image!=a&&(this.imageOrUri=a,this.image=this.imageOrUri)},d.setFrameset=function(a,b){return this.animtype=a,a=this.animtype+this.animsuffix,this.ss.getAnimation(a)?(this.currentframeset=a,this.animset=this.ss.getAnimation(this.currentframeset).frames,this.currentframe=0,b&&(this.currentframe=parseInt(b*this.animset.length)),!0):!1},d.middley=function(){this.halfheight=this.height*-.5,this.y=this.halfheight-this.useframe.regY},d.bottomy=function(){this.halfheight=-1*this.height,this.y=this.halfheight-this.useframe.regY},d.updateFrame=function(){var a=this.useframe;this.useframe=this.ss.getFrame(this.animset[this.currentframe]),this.useframe||(this.useframe=this.ss.getFrame(0)),this.useframe!=a&&(this.setSpriteImage(this.useframe.image),this.sourceRect=this.useframe.rect,this.x=this.scaleX*(this.halfwidth-this.useframe.regX),this.y=this.halfheight-this.useframe.regY)},d.face=function(a){return a==this.flipped?!1:(a?(this.flipped=!0,this.scaleX=-1,this.x=this.negwidth+this.useframe.regX):(this.flipped=!1,this.scaleX=1,this.x=this.halfwidth+this.useframe.regX),!0)},namespace("plumlib").Critter=c}(plumlib=plumlib||{});var plumlib;plumlib.makeBasic=function(a){a.currentframe=0,a.setFramePoints=function(){};var b;a.setFrameset(a.species),a.setFrameset(a.species)?(b=a.ss.getFrame(a.animset[a.currentframe]),a.setSpriteImage(b.image)):(a.animated=!0,plumlib.makeAnimated(a),b=a.ss.getFrame(0)),a.sourceRect=b.rect,a.height=b.rect.height,a.width=b.rect.width,a.sourceRect=b.rect,a.halfwidth=a.width/-2,a.negwidth=-1*a.halfwidth,a.halfheight=-1*a.sourceRect.height,a.x=a.halfwidth-b.regX,a.y=a.halfheight-b.regY,a.useframe=b,a.updateFrame(),a.animstate=0},plumlib.makePlaceable=function(a){a.offsety=0,a.offsetx=0,a.xloc=0,a.yloc=0,a.zloc=0,a.species=null,a.stackdist=null,a.adist=0,a.stack=0},plumlib.makeAnimated=function(a){a.nextFrame=function(a){if(0!==this.animstate&&(a?this.currentframe=this.currentframe+a:this.currentframe++,this.currentframe>=this.animset.length)){if(3==this.animstate)return void(this.currentframe=0);var b;switch(this.animstate){case 1:this.ss.getAnimation("_takeOff")?(this.animstate=2,b="_takeOff"):(this.animstate=3,b="_loop"),this.moving=!0;break;case 2:this.animstate=3,b="_loop";break;case 4:this.animstate=5,b="_stop",this.moving=!1;break;case 5:return this.animstate=0,void this.currentframe--;case 6:return this.animstate=0,this.currentframe--,void(b="_loop")}return void this.setFrameset(b)}},a.takeoff=function(){this.animstate=1,this.setFrameset("_anticipation")},a.stop=function(){this.animstate=5,this.moving=!1,this.setFrameset("_stop")},a.loop=function(a){this.moving=!0,3!=this.animstate&&(this.animstate=3,a?this.setFrameset("_loop",a):this.setFrameset("_loop"))},a.playsection=function(a){this.animstate=5,this.setFrameset(a)},a.playspecial=function(){this.moving=!1,this.animstate=6,this.setFrameset("_special")},a.settle=function(){this.rest=10+90*Math.random(),this.moving=!1,this.ss.getAnimation("_land")?(this.animstate=4,this.setFrameset("_land")):(this.animstate=5,this.setFrameset("_stop"))}},function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.SpriteSheet"),d=include("createjs.Rectangle"),e=include("createjs.Shape"),f=include("createjs.Point"),g=include("plumlib.Critter"),h=33,i=function(a){this.mv=new f(0,0),this.vv=new f(0,0),this.vel=0,this.targetv=new f(0,0),this.iv=new f(0,0),this.av=new f(0,0),this.targetctr=new f(0,0),this.target=new d,this.pos=new f(0,0),this.vis=new f(0,0),this.lastpos=new f(0,0),this.origin=new f(0,0),this.mayfall=!1,this.z=null,this.fleeing=0,this.basedir={x:0,y:0},this.spotsleft=[],this.id=a,this.cancollide=!1,this.show=!0,this.faceleft=!0,this.accelrate=.5,this.tact=0,this.gr=1,this.plx=1,this.stack=0},j=i.prototype;j.addglow=function(b,c){this.bg=new a(images[b]),this.bg.scaleX=c.w/this.bg.image.width,this.bg.scaleY=c.h/this.bg.image.height,this.bg.x=c.x,this.bg.y=c.y,this.view.addChildAt(this.bg,0)},j.addbackground=function(b,c){this.bg=new a(images[b]),c?WGBH.Util.Position(this.bg,c):(this.bg.x=this.bg.image.width/-2,this.critter?this.bg.y=this.bg.image.height/-2-this.critter.height/2:this.bg.y=this.bg.image.height/-2),this.view.addChildAt(this.bg,0)},j.move=function(a){if(0!==this.mv.x||0!==this.mv.y){var b=a/h,c=0,d=this.mv.x*b,e=this.mv.y*b;this.wave&&(this.wavetime+=b,this.wavetime>this.wavechange&&(this.wavetime=0,this.wavepos=(this.wavepos+1)%this.wave.length,c=this.wave[this.wavepos],e+=c));var g=new f(this.pos.x+d,this.pos.y+e);this.rotate&&(this.view.rotation+=2*b),this.trypos(g.x,g.y)}},j.setImage=function(c){if(this.view=new b,this.b=new a(images[c]),this.view.addChild(this.b),this.width=this.b.image.width,this.height=this.b.image.height,this.origin.x=this.width/2,this.origin.y=this.height,this.b.x=-1*this.origin.x,this.b.y=-1*this.origin.y,this.radius=this.width>this.height?this.width/2:this.height/2,this.radius2=this.radius*this.radius,this.view.id=this.id,app.debug){var d=new a(images.dot);d.x=-2,d.y=-2,this.view.addChild(d)}},j.setOrigin=function(a,b){null!==a&&(this.origin.x=a),null!==b&&(this.origin.y=b),this.b&&(this.b.x=-1*this.origin.x,this.b.y=-1*this.origin.y)},j.setAsContainer=function(){this.view=new b},j.setSprite=function(d,e){if(this.view=new b,this.critter=new g(d,new c(e)),this.view.addChild(this.critter),this.width=this.critter.width,this.height=this.critter.height,this.radius=this.width>this.height?this.width/2:this.height/2,this.radius2=this.radius*this.radius,this.origin=new f(this.width/2,this.height/2),this.view.id=this.id,app.debug){var h=new a(images.dot);h.x=-2,h.y=-2,this.view.addChild(h)}},j.middley=function(a){a?this.critter?this.critter.middley():this.b.y=this.height/-2:this.critter?this.critter.bottomy():this.b.y=-1*this.height},j.loop=function(a){this.critter&&this.critter.loop(a)},j.setAnimation=function(a){this.critter&&this.critter.setSuffix(a)},j.setCamera=function(a){this.cam=a},j.setScale=function(a){this.view.scaleX=this.view.scaleY=a},j.updateHitarea=function(){this.critter?(this.critter.scaleX<0?this.hitspot.x=-1*this.hitspot.basex-this.hitspot.basew:this.hitspot.x=this.hitspot.basex,this.hitspot.width=this.hitspot.basew):(this.hitspot.x=this.hitspot.basex,this.hitspot.width=this.hitspot.basew),this.target.width=this.hitspot.width,this.target.height=this.hitspot.height,this.target.x=this.vis.x+this.hitspot.x,this.target.y=this.vis.y+this.hitspot.y},j.setHitarea=function(a){this.hitspot=new d(a.x,a.y,a.width,a.height),this.hitspot.basex=a.x,this.hitspot.basew=a.width,this.updateHitarea(),!this.showhit&&app.debug&&(this.showhit=new e,this.view.addChild(this.showhit)),this.fillHitarea("#000000",!0)},j.doSpecial=function(a){this.critter&&(this.mv.x=0,this.mv.y=0,this.critter.playspecial())},j.fillHitarea=function(a,b){this.showhit&&(this.showhit.graphics.clear(),b?(this.showhit.graphics.beginStroke(a),this.showhit.graphics.drawRect(this.hitspot.x,this.hitspot.y,this.hitspot.width,this.hitspot.height)):(this.showhit.graphics.beginFill(a),this.showhit.graphics.drawRect(this.hitspot.x,this.hitspot.y,this.hitspot.width,this.hitspot.height),this.showhit.graphics.endFill()))},j.setDistance=function(a){a===this.z||a>100||(this.z=a,this.view.stack=1e4*this.z+this.stack,this.plx=(100-this.z)/99,this.updatez=!0)},j.setStack=function(a){this.stack=a,this.view.stack=1e4*this.z+this.stack,this.updatez=!0},j.findDistance=function(a,b){if(b){var c=new f(this.gettargetctr().x-a.gettargetctr().x,this.gettargetctr().y-a.gettargetctr().y);return c}return new f(this.pos.x-a.pos.x,this.pos.y-a.pos.y)},j.stepframe=function(a){this.critter&&(this.critter.nextFrame(a),this.show&&this.critter.updateFrame())},j.faceright=function(a){if(this.faceleft==a&&(this.faceleft=!a,this.critter&&(this.critter.face(a),this.hitspot&&(this.updateHitarea(),this.showhit&&this.fillHitarea("#000000",!0),"enemy"==this.type)))){var b=this.pos.x-2*this.hitspot.x;this.trypos(b,this.pos.y)}},j.makecollidable=function(a){this.cancollide=!0,this.checkcollide=!0,a||(a=new d(this.width/-2,-1*this.height,this.width,this.height)),this.setHitarea(a)},j.appear=function(){this.show=!0,this.view.visible=!0,this.cancollide&&(this.checkcollide=!0)},j.disappear=function(a){a||(this.show=!1,this.view.visible=!1),this.checkcollide=!1,this.showhit&&this.fillHitarea("#000000",!0)},j.pushback=function(a){if(0!==a.x||0!==a.y){this.trypos(this.pos.x+a.x,this.pos.y+a.y);var b,c;a.x<0?(b=-1.1,this.mv.x=0):a.x>0?(b=1.1,this.mv.x=0):b=0,a.y<0?(c=-1.1,this.mv.y=0):a.y>0?(c=1.1,this.mv.y=0):c=0,a.y<0&&(this.airborne=!1)}},j.addVel=function(a,b){this.mv.add(a),b&&(b.x&&(a.x<0?this.mv.x=Math.max(this.mv.x,b.x):this.mv.x=Math.min(this.mv.x,b.x)),b.y&&(a.y<0?this.mv.y=Math.max(this.mv.y,b.y):this.mv.y=Math.min(this.mv.y,b.y))),this.checkFacing()},j.accelTo=function(a,b,c){if(a.x!=this.mv.x||a.y!=this.mv.y){var d=new f(a.x-this.mv.x,a.y-this.mv.y);b||(b=h),c||(c=this.accelrate);var e=c*b/h;d.lengthSq()>e*e?(d.truncate(e),this.addVel(d)):this.setVel(a.x,a.y)}},j.doForces=function(a){for(var b in a)this.doForce(a[b])},j.doForce=function(a,b,c){if(a){var d=new f(0,0),e=a;if(e.scale?("speed"==e.scale.x?d.x+=this.speed:d.x+=e.scale.x,"speed"==e.scale.y?d.y+=this.speed:d.y+=e.scale.y):c?(d.x=1,d.y=1):(d.x+=this.speed,d.y+=this.speed),"v"==e.type)this.setVel(e.x*d.x,e.y*d.y);else if("a"==e.type)this.accelTo(new f(e.x*d.x,e.y*d.y),b,e.acc);else if("f"==e.type){var g=e.x*d.x,h=e.y*d.y,i=null;e.lim&&(i=e.lim),this.addVel(new f(g,h),i)}}},j.setVel=function(a,b){this.mv.x=a,this.mv.y=b,this.vel=this.mv.lengthSq(),this.checkFacing()},j.getlastmove=function(){return new f(this.pos.x-this.lastpos.x,this.pos.y-this.lastpos.y)},j.checkFacing=function(){0!==this.mv.x&&this.faceright(this.mv.x>0),this.critter&&(this.mv.lengthSq()>0?(this.critter.moving||this.critter.loop(),this.facemv&&this.alignwith(this.mv)):this.critter.moving&&this.critter.stop())},j.facepoint=function(a){this.alignwith(new f(this.pos.x-a.x,this.pos.y-a.y))},j.alignwith=function(a){0!==a.x&&this.faceright(a.x>0),this.faceleft?this.view.rotation=180-180*WGBH.Util.GetAngle(a)/Math.PI:this.view.rotation=180*WGBH.Util.GetAngle(a)/Math.PI,this.bg&&(this.bg.rotation=360-this.view.rotation)},j.setreg=function(a,b){this.view.regX=a,this.view.regY=b,this.vis.x=this.pos.x-this.view.regX,this.vis.y=this.pos.y-this.view.regY},j.gotopoint=function(a){this.godirection(new f(a.x-this.pos.x,a.y-this.pos.y))},j.godirection=function(a){var b=a.clone();b.truncate(this.speed),this.setVel(b.x,b.y*this.vert)},j.draw=function(a){a&&this.stepframe();var b=this.plx,c=this.plx;if(this.fixedpos&&("undefined"!=typeof this.fixedpos.x&&(this.pos.x=this.cam.pos.x+this.fixedpos.x,b=1),"undefined"!=typeof this.fixedpos.y&&(this.pos.y=this.cam.pos.y+this.fixedpos.y,c=1)),this.show){var d=new f((this.pos.x-this.cam.pos.x)*b,this.cam.horizon+(this.pos.y-this.cam.pos.y)*c);this.view.x=d.x,this.view.y=d.y,this.view.visible=!0}},j.trypos=function(a,b){b<this.top?(b=this.top,this.setVel(this.mv.x,0)):b>this.bottom&&(b=this.bottom,this.freefall?this.setVel(0,0):this.setVel(this.mv.x,0),this.airborne=!1,this.mayfall=!1),this.setpos(parseInt(a),parseInt(b),!0)},j.setpos=function(a,b,c){c?(this.lastpos.x=this.pos.x,this.lastpos.y=this.pos.y):(this.lastpos.x=a,this.lastpos.y=b),this.pos.x=a,this.pos.y=b,this.vis.x=this.pos.x-this.view.regX,this.vis.y=this.pos.y-this.view.regY,this.hitspot&&(this.target.x=this.vis.x+this.hitspot.x,this.target.y=this.vis.y+this.hitspot.y),this.targetctr=null},j.getfreespot=function(){if(!this.spotsleft||this.spotsleft.length<1)return null;var a=parseInt(Math.random()*this.spotsleft.length),b=this.spotsleft[a];return this.spotsleft.splice(a,1),b},j.gettargetctr=function(){return this.targetctr?this.targetctr:(this.targetctr=new f,this.hitspot?(this.targetctr.x=this.target.x+this.target.width/2,this.targetctr.y=this.target.y+this.target.height/2):(this.targetctr.x=this.pos.x,this.targetctr.y=this.pos.y),this.targetctr)},j.rotateto=function(a){this.view.rotation=a},j.getrotation=function(){return this.view.rotation},j.act=function(){this.acting||(this.acting=!0,this.tact=0,this.startaction&&this.startaction())},j.endact=function(){this.acting=!1},namespace("lib").GamePiece=i}(),function(){var a=include("createjs.Point"),b=include("springroll.EventDispatcher"),c=function(){this.settings={},this.options={},this.arrays={},this.initfromconfig()},d=c.prototype;mixin(d,b),d.initfromconfig=function(){this.settings.game=app.config.game.clone(),this.settings.MOVEMENTS=app.config.preset.MOVEMENTS.clone(),this.settings.ACTIONS=app.config.preset.ACTIONS.clone(),this.settings.RANGES=app.config.preset.RANGES.clone(),this.settings.SCENES=app.config.preset.SCENES.clone(),this.settings.ITEMS=app.config.items.ITEMS.clone(),this.settings.BACKGROUNDS=app.config.items.BACKGROUNDS.clone(),this.settings.game.fullwidth=this.settings.game.GAMEPANELS*this.settings.game.FRAME.w,this.optionset=app.config.options;var a=this.optionset.player;this.optionset.preset;for(var b in a)op=a[b],"array"==op.type&&this.beginarray(op.id,op.param)},d.setpreset=function(a){var b=app.config.preset.PRESETS[a].clone();this.settings.presetid=a;var c=app.config.game.SPEEDFACTOR.max/2;this.settings.speedfactors={pred:c,collect:c,player:c},c=app.config.game.NUMBERFACTOR.max/2,this.settings.numberfactors={pred:c,collect:c},this.settings.goalfactors={time:app.config.game.TIMEFACTOR.max/2,collect:app.config.game.COLLECTFACTOR.max/2},this.settings.goal=b.goal.clone(),this.resetstatus(),this.settings.cam=b.cam,this.settings.title=b.title,this.settings.range=b.range,this.settings.start=b.start;var d=["pred","food","bar","safe","flock","scenery","backgrounds","foregrounds"];for(var e in d){var f=d[e];this.settings[f]=[],b[f]&&b[f].length>0&&(this.settings[f]=this.settings[f].concat(b[f]))}b.special?this.settings.special=b.special.clone():this.settings.special=null,this.setOption("scene",b.scene),this.setOption("animal",b.animal),this.setOption("speed",b.speed),this.setOption("movement",b.movement),this.setOption("action",b.action),this.setOption("pred",b.pred),this.setOption("food",b.food),this.setOption("bar",b.bar),this.setOption("flock",b.flock),this.setOption("safe",b.safe),this.setOption("scenery",b.scenery),this.updatefromoptions()},d.resetstatus=function(){this.settings.goalstatus={},this.settings.itemstatus={},this.settings.goal.time.on?(this.settings.goalstatus.time=!0,this.settings.goalstatus.collect=!1):(this.settings.goalstatus.time=!1,this.settings.goalstatus.collect=!0)},d.updatescene=function(){},d.getanimallist=function(){var a=[];for(var b in app.config.preset.PRESETS)a.push(b);return a},d.getanimalforpreset=function(a){return app.config.preset.PRESETS[a].animal},d.setmovement=function(b,c){if(!c){var d=this.getsettingsforitem(b.animal);c=d.movement}var e=this.settings.MOVEMENTS[c];b.basemv=new a(e.d.x*b.speed,e.d.y*b.speed),b.movetype=c,b.movement=e,b.baseforce=e.d,b.defaultforce=b.baseforce.clone(),b.vert=1==e.vert?1:0},d.gettopandbottomforid=function(a){var b,c=this.getsettingsforitem(a);return b=c.range?this.gettopandbottomforrange(c.range):this.gettopandbottomformovement(c.movement)},d.gettopandbottomforrange=function(a){return this.settings.RANGES[a]?{top:this.settings.game.ZONES[this.settings.RANGES[a][1]],bottom:this.settings.game.ZONES[this.settings.RANGES[a][0]]}:a.length>1?{top:a[0],bottom:a[1]}:void 0!==a.t&&void 0!==a.b?{top:a.t,bottom:a.b}:{top:this.settings.game.ZONES.top,bottom:this.settings.game.ZONES.bottom}},d.gettopandbottomformovement=function(a){var b=this.settings.MOVEMENTS[a];return this.gettopandbottomforrange(b.range)},d.getstartformovement=function(a){var b=this.settings.MOVEMENTS[a];return b.start?this.gettopandbottomforrange(b.start):this.gettopandbottomformovement(a)},d.getmovementforid=function(a){var b=this.getsettingsforitem(a),c=this.settings.MOVEMENTS[b.movement];return c},d.getsceneforid=function(a,b){var c=this.getsettingsforitem(a);return c.scene},d.setaction=function(a,b){if(!b){var c=this.getsettingsforitem(a.animal);b=c.action}var d=this.settings.ACTIONS[b];a.actionconfig=d,a.actiontype=b,d.c?(a.endt=d.c.t,a.actionforce=d.c.f):(a.endt=0,a.actionforce=null),d.s&&(a.initialforce=d.s.f),d.r&&(a.endforce=d.r.f)},d.updatefromoptions=function(){this.settings.player={},this.settings.player.animal=this.options.animal,this.settings.player.image=this.settings.ITEMS[this.settings.player.animal].image,this.settings.player.speed=this.options.speed,this.settings.player.range=this.options.range,this.settings.player.spritesheet=this.settings.ITEMS[this.settings.player.animal].spritesheet,this.settings.player.actiontype=this.options.action,this.settings.player.actiontext=this.settings.ACTIONS[this.options.action].n,this.settings.player.movementtype=this.options.movement,this.settings.pred=this.options.pred?this.options.pred.clone():null,this.settings.food=this.options.food?this.options.food.clone():null,this.settings.bar=this.options.bar?this.options.bar.clone():null,this.settings.flock=this.options.flock?this.options.flock.clone():null,this.settings.scenery=this.options.scenery?this.options.scenery.clone():null,this.settings.safe=this.options.safe?this.options.safe.clone():null,this.settings.scene=this.settings.SCENES[this.options.scene]},d.getpredatorlist=function(a){var b,c=[];for(var d in this.settings.pred)b=this.settings.pred[d].id,a&&this.settings.itemstatus[b]===!1||c.push(b);return c},d.getcollectionlist=function(a){var b,c=[];if(this.settings.flock[0])for(var d in this.settings.flock)b=this.settings.flock[d].id,a&&this.settings.itemstatus[b]===!1||c.push(b);else for(var e in this.settings.food)b=this.settings.food[e].id,a&&this.settings.itemstatus[b]===!1||c.push(b);return c},d.getgameitem=function(a){for(var b in this.settings.food)if(this.settings.food[b].id==a)return this.settings.food[b];for(var c in this.settings.flock)if(this.settings.flock[c].id==a)return this.settings.flock[c];for(var d in this.settings.pred)if(this.settings.pred[d].id==a)return this.settings.pred[d];return null},d.getimageforitem=function(a){var b=this.getsettingsforitem(a);return b.image},d.getimagelist=function(a,b){var c=[];b||(b=this.settings);for(var d in b[a]){var e=b[a][d].id,f=this.getsettingsforitem(e);if(c.push(f.image),f.placement)for(var g in f.placement.items){var h=f.placement.items[g];c.push(this.getimageforitem(h))}}return c},d.getmanifestforlevel=function(a,b){var c,d=app.config.preset.PRESETS[a].clone(),e=this.getgameitemsforscene(d.scene),f=this.getgameitemsforlevel(d),g=e.concat(f);return c="items"==b?this.getmanifestforidlist(f):"bgs"==b?this.getmanifestforidlist(e):this.getmanifestforidlist(g)},d.getmanifestforidlist=function(a){var b,c,d=[];for(var e in a){c=!1;for(b in app.config.assets.items)app.config.assets.items[b].id!=a[e]||(c=!0,d.push({id:a[e],src:app.config.assets.items[b].src}));for(b in app.config.assets.backgrounds)app.config.assets.backgrounds[b].id!=a[e]||(c=!0,d.push({id:a[e],src:app.config.assets.backgrounds[b].src}))}return d},d.getgameitemsforlevel=function(a){var b=[],c=this.getimagelist("pred");return b=b.concat(c),c=this.getimagelist("food"),b=b.concat(c),c=this.getimagelist("flock"),b=b.concat(c),c=this.getimagelist("bar"),b=b.concat(c),c=this.getimagelist("scenery"),b=b.concat(c),a.backgrounds&&(b=b.concat(this.getpanelitems(a.backgrounds))),a.foregrounds&&(b=b.concat(this.getpanelitems(a.foregrounds))),b.push(a.animal),b},d.getpanelitems=function(a){if(!a)return[];var b,c,d,e,f,g=[];for(b in a){f=a[b].items;for(c in f)if(e=f[c],e.filename)for(d=0;d<e.num;d++)g.push(e.filename+"_"+(parseInt(d)+1));else e.id&&g.push(e.id)}return g},d.getgameitemsforscene=function(a){var b=this.settings.SCENES[a],c=[];return c=c.concat(this.getpanelitems(b.backgrounds)),c=c.concat(this.getpanelitems(b.foregrounds)),c.push(b.sky.image),c},d.getallitems=function(){var a=[];for(var b in this.settings.ITEMS)a.push(b);return a},d.getframe=function(a){var b,c=this.getsettingsforitem(a);b=c.range?this.gettopandbottomforrange(c.range):this.getstartformovement(c.movement);var d=b.bottom-b.top,e={x:0,y:b.top,w:this.settings.game.fullwidth,h:d};return e},d.getbasespeed=function(a){var b=this.getsettingsforitem(a);return b.speed?b.speed:0},d.getbasevel=function(b){var c=this.getsettingsforitem(b);return c.speed?new a(-1*c.speed,0):new a(0,0)},d.getadjustednumber=function(a,b){var c=1+parseInt(a*this.settings.numberfactors[b]/app.config.game.NUMBERFACTOR.denom);return c},d.getadjustedspeed=function(a,b){var c=a*this.settings.speedfactors[b]/app.config.game.SPEEDFACTOR.denom;return 1>c&&(c=1),c},d.getadjustedtime=function(a,b){var c=b?b:this.settings.goalfactors.time,d=Math.max(1,parseInt(a*(c/app.config.game.TIMEFACTOR.denom)));return d},d.getadjustedgoal=function(a,b){var c=b?b:this.settings.goalfactors.collect,d=Math.max(1,parseInt(a*(c/app.config.game.COLLECTFACTOR.denom)));return d},d.getsettingsforitem=function(a){var b=this.settings.ITEMS[a];return b||(b=this.settings.BACKGROUNDS[a]),b},d.setoptionsFromData=function(a){},d.getoptions=function(){},d.getoption=function(a){};var e=6;d.setOption=function(a,b){if(!(0>e)){if(void 0===b||null===b){if(!this.arrays[a])return;b=[]}var c,d,f=a.split("_");c=d=this.options;for(var g=f.length-1,h=f[g],i="this.options",j=0;g>j;j++){var k=f[j];if(c=d[k],i+="."+k,!c){c=d;break}d=c}if(c[h]=b,"object"==typeof b){var l;if(void 0!==b.length){c[h]=[];for(l in b)this.addtoarray(a),e--,this.setOption(a+"_"+l,b[l])}else{c[h]={};for(l in b)e--,this.setOption(a+"_"+l,b[l])}}"preset"==a&&this.setpreset(b),e++}},d.getnameforitem=function(a){var b,c=this.getsettingsforitem(a);return b=c.name?c.name:c.image,b=WGBH.Util.TitleCase(b)},d.extrabottomforid=function(a){var b=this.getsettingsforitem(a);return b.flybottom?b.flybottom:0},d.extratopforid=function(a){var b=this.getsettingsforitem(a);return b.digtop?-1*b.digtop:0},d.beginarray=function(a,b){this.arrays[a]||(this.arrays[a]=b,this.options[a]||(this.options[a]=[]))},d.addtoarray=function(a){this.arrays[a]||this.beginarray(a,type);var b=this.optionset[this.arrays[a]],c=this.options[a].length;c||(c=0),this.options[a][c]={};var d;for(var e in b){var f=b[e];if(f){var g=f.def;if(!g)for(var h in this.settings[f.param]){if(g)break;("ITEMS"!=f.param||this.settings[f.param][h].scene==this.options.scene)&&(g=h,"id"==f.type&&(d=g))}f.lookup,this.options[a][c][f.id]=g}}this.updatefromoptions()},d.removefromarray=function(a,b){var c=this.options[a];c.length&&(c.splice(b,1),this.updatefromoptions())},namespace("lib").Options=c}(),function(){var a=include("createjs.Container"),b=include("createjs.Bitmap"),c=include("createjs.Sprite"),d=include("createjs.SpriteSheet"),e=include("createjs.Tween"),f=include("createjs.Ease"),g=function(){var e=app.config.plumpuppet;this.view=new a,this.lefteye=new c(new d(WGBH.Util.SpritesheetClone(app.config.spritesheets[e.LEFTEYE.spritesheet]))),this.lefteye.blinkframes=this.lefteye.spriteSheet.getAnimation(e.LEFTEYE.blink).frames,WGBH.Util.Position(this.lefteye,e.LEFTEYE.frame),this.righteye=new c(new d(WGBH.Util.SpritesheetClone(app.config.spritesheets[e.RIGHTEYE.spritesheet]))),this.righteye.blinkframes=this.lefteye.spriteSheet.getAnimation(e.RIGHTEYE.blink).frames,WGBH.Util.Position(this.righteye,e.RIGHTEYE.frame),this.righteye.gotoAndStop(this.righteye.blinkframes[0]),this.mouth=new c(new d(WGBH.Util.SpritesheetClone(app.config.spritesheets[e.MOUTH.spritesheet]))),WGBH.Util.Position(this.mouth,e.MOUTH.frame),this.topknot=new c(new d(WGBH.Util.SpritesheetClone(app.config.spritesheets[e.TOPKNOT.spritesheet])));var f=[];this.topknot.flipright=f.concat(this.topknot.spriteSheet.getAnimation(e.TOPKNOT.flip).frames),this.topknot.flipleft=f.concat(this.topknot.spriteSheet.getAnimation(e.TOPKNOT.flip).frames),this.topknot.flipleft.reverse(),WGBH.Util.Position(this.topknot,e.TOPKNOT.frame),this.body=new b(images[e.BODY.image]),this.leftarm=new c(new d(WGBH.Util.SpritesheetClone(app.config.spritesheets[e.LEFTARM.spritesheet]))),WGBH.Util.Position(this.leftarm,e.LEFTARM.frame),this.rightarm=new c(new d(WGBH.Util.SpritesheetClone(app.config.spritesheets[e.RIGHTARM.spritesheet]))),WGBH.Util.Position(this.rightarm,e.RIGHTARM.frame),this.rightarm.scaleX=-1,this.view.addChild(this.topknot),this.view.addChild(this.body),this.view.addChild(this.mouth),this.view.addChild(this.lefteye),this.view.addChild(this.righteye),this.view.addChild(this.leftarm),this.view.addChild(this.rightarm),this.nextblink=100,this.nextflip=60,this.movingparts=[]},h=g.prototype;h.goBlink=function(){var a=[];this.nextblink=100+parseInt(200*Math.random()),this.movingparts.push([this.righteye,a.concat(this.righteye.blinkframes)]),this.movingparts.push([this.lefteye,a.concat(this.lefteye.blinkframes)])},h.setMouth=function(a){this.mouth.gotoAndStop(a)},h.flipTopknot=function(){this.nextflip=100+parseInt(200*Math.random());var a=[];"right"==this.antennaside?(this.movingparts.push([this.topknot,a.concat(this.topknot.flipleft)]),this.antennaside="left"):(this.movingparts.push([this.topknot,a.concat(this.topknot.flipright)]),this.antennaside="right")},h.floataround=function(){this.centerspot={x:this.view.x,y:this.view.y},this.floatagain=!0,this.newspot()},h.newspot=function(){var a=this,b=12;if(this.floatagain){var c={x:this.centerspot.x+(b-Math.random()*b*2),y:this.centerspot.y+(2*b-Math.random()*b*4)};e.get(this.view).to({x:c.x,y:c.y},1500,f.cubicInOut).call(function(){a.newspot()})}},h.stopfloat=function(){e.removeAllTweens(),this.floatagain=!1},h.update=function(a){for(var b=this.movingparts.length-1,c=b;c>=0;c--){var d=this.movingparts[c][0],e=this.movingparts[c][1].shift();d.gotoAndStop(e),this.movingparts[c][1].length<1&&this.movingparts.splice(c,1)}this.nextblink--,this.nextblink<0&&this.goBlink(),this.nextflip--,this.nextflip<0&&this.flipTopknot()},namespace("lib").PlumPuppet=g}(),function(){var a=include("createjs.Container"),b=include("createjs.Bitmap"),c=include("createjs.Point"),d=function(){this.view=new a;var d=app.config.game.POINTBUBBLE,e=new b(images[d.image]);WGBH.Util.Frame(e,d.frame),e.x=d.frame.w*-.5,e.y=d.frame.h*-.5,this.view.id=this.id="pointbubble",this.mv=new c(d.mv.x,d.mv.y),this.view.addChild(e),this.pos=new c(0,0),this.lifetime=1e3*d.lifetime,this.disown=!1,this.mayfall=!1,this.collidable=!1,this.stack=0},e=d.prototype;e.getpoints=function(a,b){this.show(b)},e.setDistance=function(a){this.z=a,this.view.stack=1e4*this.z+this.stack,this.plx=(100-this.z)/99},e.setStack=function(a){this.stack=a,this.view.stack=1e4*this.z+this.stack},e.settext=function(a){this.points.text=a},e.show=function(a){this.view.visible=!0,this.pos.x=a.x,this.pos.y=a.y},e.setCamera=function(a){this.cam=a},e.move=function(){this.pos.y+=this.mv.y,this.pos.x+=this.mv.x},e.draw=function(a){this.view.x=this.pos.x-this.cam.pos.x,this.view.y=this.pos.y-this.cam.pos.y},e.setpos=function(a,b){this.pos.x=a,this.pos.y=b},e.setVel=function(a,b){this.mv.x=a,this.mv.y=b},namespace("plumlib").PointBubble=d}(),function(){var a=include("createjs.Container"),b=include("createjs.Shape"),c=include("createjs.Bitmap"),d=include("springroll.EventDispatcher"),e=function(d,e){this.stage=e,this.view=new a,this.bg=new b,this.config=app.config.ui.SLIDER,this.startSlide=this.startSlide.bind(this),this.endSlide=this.endSlide.bind(this),this.slid=this.slid.bind(this),this.thumb=new c(images.sliderbutton),this.width=this.config.width,this.thumb.w=this.thumb.image.width,this.thumb.hw=this.thumb.w/2,this.view.addChild(this.bg),this.showval=WGBH.Util.Text("0",this.config.showval.style),this.notches(2),this.value=0,this.ev={val:this.value,type:d,target:this},this.lowlabel=WGBH.Util.Text("low",this.config.label.style,{align:"right"}),this.lowlabel.x=-1*this.config.labelpadding,this.highlabel=WGBH.Util.Text("high",this.config.label.style),this.highlabel.x=this.width+this.config.labelpadding,this.view.addChild(this.lowlabel),this.view.addChild(this.highlabel),this.view.addChild(this.thumb),this.view.addChild(this.showval),app.config.choice.CHOICEPANEL.shownumbers?this.showval.visible=!0:this.showval.visible=!1,this.enable()},f=e.prototype;mixin(f,d),f.showvalue=function(a){a===!1?this.showval.visible=!1:(this.showval.visible=!0,this.view.y+=this.config.showval.offset)},f.setrange=function(a,b,c){this.min=a,this.max=b,this.span=b-a,this.step=c},f.setlabels=function(a,b){this.lowlabel.text=a,this.highlabel.text=b},f.notches=function(a){var b=this.config.line.h,c=this.config.notch.h,d=this.config.notch.w;this.bg.graphics.clear(),this.bg.graphics.beginFill("#BBBDBF");var e=this.thumb.w,f=e/2;this.bg.graphics.drawRect(0,-.5*b,this.width,b),this.bg.graphics.drawRect(0,-.5*c,d,c),this.bg.graphics.drawRect(this.width-d,-.5*c,d,c);if(a>2)for(var g=0;a>g;g++){var h=g*d;this.bg.graphics.drawRect(h,-.5*c,d,c)}this.bg.graphics.endFill(),this.thumb.regX=f,this.thumb.regY=f,this.showval.x=0,this.showval.y=this.config.showval.y;
},f.enable=function(){this.view.on("mousedown",this.startSlide)},f.disable=function(){this.view.off("mousedown",this.startSlide),this.stage.removeEventListener("pressmove",this.slid),this.stage.removeEventListener("pressup",this.endSlide)},f.startSlide=function(a){this.stage.removeEventListener("pressmove",this.slid),this.stage.removeEventListener("pressup",this.endSlide),this.stage.addEventListener("pressmove",this.slid),this.stage.addEventListener("pressup",this.endSlide)},f.slid=function(a){var b=this.view.globalToLocal(a.stageX,a.stageY);this.positionThumb(b)},f.positionThumb=function(a){a.x>this.width?this.thumb.x=this.width:a.x<0?this.thumb.x=0:this.thumb.x=a.x,this.showval.x=this.thumb.x;var b=this.thumb.x/this.width,c=b*this.span,d=parseInt(c/this.step);c=d*this.step,this.value=this.min+c,this.valuechange()},f.updatenode=function(){this.obj[this.node]=this.value},f.setshowval=function(a){this.showval.text=a},f.setobj=function(a,b){this.obj=a,this.node=b},f.endSlide=function(a){this.setValue(this.value),this.updatenode(),this.stage.removeEventListener("pressmove",this.slid),this.stage.removeEventListener("pressup",this.endSlide)},f.setValue=function(a){this.value=a;var b=(a-this.min)/(this.max-this.min);this.positionThumb({x:parseInt(b*this.width+1),y:0})},f.valuechange=function(){this.ev.val!=this.value&&(this.ev.val=this.value,this.showval.text=this.value,this.trigger("valuechange",this.ev))},f.getValue=function(){return this.value},namespace("lib").Slider=e}(),function(){var a=include("createjs.Container"),b=include("createjs.Shape"),c=include("createjs.Bitmap"),d=include("createjs.Rectangle"),e=include("createjs.SpriteSheet"),f=function(d){var e=app.config.ui.UIBUTTON;if(this.view=new a,this.color=d.color?d.color:e.color,this.bg=new b,this.view.addChild(this.bg),this.wpadding=e.padding.w,this.hpadding=e.padding.h,this.rnd=e.cornerradius,this.contentsize={w:0,h:0},this.justify=d.justify?d.justify:e.justify,d.text){var f=d.text.style?d.text.style:"button";this.text=WGBH.Util.Text(d.text.text,f,{align:"left"}),this.text.w=this.text.getMeasuredWidth(),this.text.h=this.text.getMeasuredHeight(),this.contentsize.h+=this.text.h,this.contentsize.w+=this.text.w,this.view.addChild(this.text)}if(d.icon){var g=app.config.ui.UIBUTTON.icons[d.icon.id];this.icon=new c(images[g.id]),this.text?("l"==d.icon.position?(this.icon.x=0,this.text.x+=g.frame.w+this.wpadding):this.icon.x=this.text.w+this.wpadding,this.contentsize.w+=g.frame.w+this.wpadding):(this.icon.x=g.frame.x,this.icon.y=g.frame.y,this.contentsize.w+=g.frame.w),this.icon.position=d.icon.position?d.icon.position:"center",this.icon.w=g.frame.w,this.icon.h=g.frame.h,this.contentsize.h=Math.max(g.frame.h,this.contentsize.h),this.view.addChild(this.icon)}"content"==d.scale?(this.width=this.contentsize.w+2*this.wpadding,this.height=this.contentsize.h+2*this.hpadding):(this.width=d.frame.w,this.height=d.frame.h),this.drawbg(this.width,this.height);var h=0;"right"==this.justify?h=this.width-this.contentsize.w:"left"==this.justify||(h=(this.width-this.contentsize.w)/2),this.text&&(this.text.x+=h,this.text.y=this.height/2),this.icon&&(this.icon.x+=h,this.icon.y=this.height/2-this.icon.h/2),this.view.x=d.frame.x,this.view.y=d.frame.y},g=f.prototype;g.drawbg=function(a,b){this.width=a,this.height=b,this.bg.graphics.clear(),this.bg.graphics.f("rgba(0,0,0,0.25)").drawRoundRect(0,5,this.width,this.height,this.rnd),this.bg.graphics.f(this.color).drawRoundRect(0,0,this.width,this.height,this.rnd)},g.settext=function(a){this.text.text=a},g.teardown=function(){this.removeAllChildren()};var h=function(b,d,e){d||(d="med"),this.size=d;var f=app.config.ui.PLINK[d];this.view=new a,b?(this.text=WGBH.Util.Text(b,f.title.style),this.text.x=f.title.frame.x,this.text.y=f.title.frame.y,e||(e=f.titleimage),this.b=new c(images[e]),this.view.addChild(this.b),this.view.addChild(this.text)):(e||(e=f.image),this.b=new c(images[e]),this.view.addChild(this.b)),this.plinkimage=e,this.view.x=f.frame.x,this.view.y=f.frame.y},i=h.prototype;i.settitle=function(a){this.text.text=a},i.setplinkimage=function(a){this.b&&this.view.removeChild(this.b),this.b=new c(images[a]),this.view.addChildAt(this.b,0),this.plinkimage=a},i.setplinksize=function(a){a||(a="med"),this.size=a;var b=app.config.ui.PLINK[a];this.text&&(this.view.removeChild(this.text),this.text=WGBH.Util.Text(this.text.text,b.title.style),this.text.x=b.title.frame.x,this.text.y=b.title.frame.y,this.view.addChild(this.text)),this.setplinkimage(b.titleimage)},i.red=function(){var a=app.config.ui.PLINK[this.size];this.setplinkimage(a.redtitle)},i.purple=function(){var a=app.config.ui.PLINK[this.size];this.setplinkimage(a.titleimage)};var j=function(b,c,d,e,f){this.view=new a,this.slices={},this.setimage(b,c,d,e,f)},k=j.prototype;k.setimage=function(a,b,e,f,g){this.leftsize=b,e?this.topsize=e:this.topsize=b,f?this.bottomsize=this.bottomedge:this.bottomsize=this.topsize,g?this.rightsize=g:this.rightsize=this.leftsize,this.view.removeAllChildren();var h=0,i=0;this.slices.tl=new c(a),this.cheight=a.height-(this.topsize+this.bottomsize),this.mwidth=a.width-(this.leftsize+this.rightsize);var j=a.width-this.rightsize,k=a.height-this.bottomsize;this.slices.tl.sourceRect=new d(i,h,this.leftsize,this.topsize),this.view.addChild(this.slices.tl),this.slices.tm=new c(a),this.slices.tm.sourceRect=new d(this.leftsize,h,this.mwidth,this.topsize),this.view.addChild(this.slices.tm),this.slices.tr=new c(a),this.slices.tr.sourceRect=new d(j,h,this.rightsize,this.topsize),this.view.addChild(this.slices.tr),this.slices.cl=new c(a),this.slices.cl.sourceRect=new d(i,this.topsize,this.leftsize,this.cheight),this.view.addChild(this.slices.cl),this.slices.cm=new c(a),this.slices.cm.sourceRect=new d(this.leftsize,this.topsize,this.mwidth,this.cheight),this.view.addChild(this.slices.cm),this.slices.cr=new c(a),this.slices.cr.sourceRect=new d(j,this.topsize,this.rightsize,this.cheight),this.view.addChild(this.slices.cr),this.slices.bl=new c(a),this.slices.bl.sourceRect=new d(i,k,this.leftsize,this.bottomsize),this.view.addChild(this.slices.bl),this.slices.bm=new c(a),this.slices.bm.sourceRect=new d(this.leftsize,k,this.mwidth,this.bottomsize),this.view.addChild(this.slices.bm),this.slices.br=new c(a),this.slices.br.sourceRect=new d(j,k,this.rightsize,this.bottomsize),this.view.addChild(this.slices.br)},k.setSize=function(a,b){var c=(b-(this.topsize+this.bottomsize))/this.cheight,d=(a-(this.leftsize+this.rightsize))/this.mwidth,e=b-this.bottomsize,f=a-this.rightsize;this.slices.tl.x=0,this.slices.tl.y=0,this.slices.tm.y=0,this.slices.tm.x=this.leftsize,this.slices.tm.scaleX=d,this.slices.tr.x=f,this.slices.tr.y=0,this.slices.cl.x=0,this.slices.cl.y=this.topsize,this.slices.cl.scaleY=c,this.slices.cm.scaleX=d,this.slices.cm.scaleY=c,this.slices.cm.x=this.leftsize,this.slices.cm.y=this.topsize,this.slices.cr.scaleY=c,this.slices.cr.x=f,this.slices.cr.y=this.topsize,this.slices.bl.x=0,this.slices.bl.y=e,this.slices.bm.y=e,this.slices.bm.x=this.leftsize,this.slices.bm.scaleX=d,this.slices.br.x=f,this.slices.br.y=e};var l=function(c){var d=app.config.ui.SCOREBOX;this.view=new a;var e=WGBH.Util.Text(d.label.text,d.label.style),f=e.getMeasuredHeight();e.x=d.margin,e.y=f/2+d.margin,this.minwidth=e.getMeasuredWidth()+2*d.margin,this.score=WGBH.Util.Text(c,d.score.style),this.score.x=d.margin;var g=this.score.getMeasuredHeight();this.score.y=e.y+g/2+d.margin,this.bg=new b,this.view.addChild(this.bg),this.h=g+2*d.margin+f,this.view.addChild(e),this.view.addChild(this.score),this.setscore(c)},m=l.prototype;m.setscore=function(a){var b=app.config.ui.SCOREBOX;this.score.text=a;var c=this.score.getMeasuredWidth()+2*b.margin;c=Math.max(c,this.minwidth),this.bg.graphics.clear(),this.bg.graphics.beginFill(b.bgcolor),this.bg.graphics.drawRect(0,0,c,this.h),this.bg.graphics.endFill()};var n=function(b,d){this.view=new a,this.onbutton=new c(images[d.button.imageon]),this.view.addChild(this.onbutton),this.offbutton=new c(images[d.button.imageoff]),this.view.addChild(this.offbutton),this.label=WGBH.Util.Text(b.label,d.text.style),this.label.x=d.button.frame.w+d.margin,this.label.y=d.button.frame.h/2,this.view.width=this.label.getMeasuredWidth()+d.button.frame.w+3*d.margin,this.view.addChild(this.label),this.view.val=b.val,this.view.control=this,this.setactive(!0)},o=n.prototype;o.setactive=function(a){this.active=a,this.active?(this.offbutton.visible=!1,this.onbutton.visible=!0):(this.offbutton.visible=!0,this.onbutton.visible=!1)},o.toggle=function(){this.setactive(!this.active)};var p=function(c){this.size={w:c.frame.w,h:c.frame.h},this.barcolor=c.barcolor,this.bgcolor=c.bgcolor;var d=new b;d.graphics.clear(),d.graphics.beginFill(this.bgcolor),d.graphics.drawRect(0,0,this.size.w,this.size.h),d.graphics.endFill(),this.view=new a,this.bar=new b,this.view.x=c.frame.x,this.view.y=c.frame.y,this.view.addChild(d),this.view.addChild(this.bar)},q=p.prototype;q.setval=function(a){var b=a*this.size.w;this.bar.graphics.clear(),this.bar.graphics.beginFill(this.barcolor),this.bar.graphics.drawRect(0,0,b,this.size.h),this.bar.graphics.endFill()};var r=function(d){var f=app.config.spritesheets[d.spritesheet];for(var g in f.images){var h=f.images[g];h.search(/.png/)>-1&&(f.images[g]=images[h.replace(".png","")])}this.spritesheet=new e(f),this.spritesource=images[d.spritesheet],this.size={w:d.frame.w,h:d.frame.h},this.barcolor=d.barcolor,this.bgcolor=d.bgcolor,this.barbg=new c(this.spritesource),this.barbg.ss=this.spritesheet,this.barbg.empty=function(){this.sourceRect=this.ss.getFrame(this.ss.getAnimation("_bar").frames[0]).rect},this.barbg.full=function(){this.sourceRect=this.ss.getFrame(this.ss.getAnimation("_barfull").frames[0]).rect},WGBH.Util.Position(this.barbg,d.barbg.frame),this.barbg.empty(),this.view=new a,this.bar=new b,this.view.x=d.frame.x,this.view.y=d.frame.y,this.view.addChild(this.barbg),this.view.addChild(this.bar),this.spinner=new c(this.spritesource),this.view.addChild(this.spinner),this.spinner.anim=this.spritesheet.getAnimation("_loop"),WGBH.Util.Position(this.spinner,d.spinner.frame),this.spinner.fr=this.spritesheet.getFrame(this.spinner.anim.frames[0]),this.spinner.sourceRect=this.spinner.fr.rect,this.text=WGBH.Util.Text(d.text.text,d.text.style),WGBH.Util.Position(this.text,d.text.frame),this.view.addChild(this.text)},s=r.prototype;s.update=function(){},s.activate=function(a){this.barbg.empty(),a===!1?(this.view.visible=!1,app.off("update",this.update),this.setval(0)):(this.view.visible=!0,app.on("update",this.update))},s.setval=function(a){var b=a*this.size.w;a>.99&&this.barbg.full(),this.bar.graphics.clear(),this.bar.graphics.beginFill(this.barcolor),this.bar.graphics.drawRect(0,0,b,this.size.h),this.bar.graphics.endFill()},namespace("lib").FrameImage=j,namespace("lib").UIButton=f,namespace("lib").Plink=h,namespace("lib").ScoreBox=l,namespace("lib").ToggleButton=n,namespace("lib").Thermometer=p,namespace("lib").Loading=r}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("lib.UIButton"),d=include("lib.Plink"),e=include("lib.GamePiece"),f=include("lib.Slider"),g=include("lib.FrameImage"),h=include("createjs.Container"),i=include("createjs.SpriteSheet"),j=include("lib.ToggleButton"),k=function(){a.call(this)},l=a.prototype,m=extend(k,a);m.setup=function(){this.debug={numbers:{},speeds:{}},this.dodebug=app.config.choice.CHOICEPANEL.shownumbers,this.bg=new b(images[app.config.ui.BG.id]),this.addChild(this.bg);var a=new c(app.config.choice.CHOICEPANEL.backbtn);this.back=a.view,this.back.visible=!1,this.nextbtn=new c(app.config.choice.CHOICEPANEL.nextbtn),this.next=this.nextbtn.view,this.next.visible=!1;var d=app.config.choice.CHOICEPANEL.homebtn;this.home=new b(images[d.image]),this.home.x=d.frame.x,this.home.y=d.frame.y,this.home.visible=!1;var e=WGBH.Util.SpritesheetClone(app.config.spritesheets.animalmenu);this.animalsheet=new i(e);var f=WGBH.Util.SpritesheetClone(app.config.spritesheets.bubblebg);this.bubblebgs=new i(f),this.addChild(this.home),this.addChild(this.next),this.addChild(this.back)},m.clear=function(a){this.removeAllChildren(),a||(this.addChild(this.bg),this.addChild(this.next),this.addChild(this.back),this.addChild(this.home)),this.debug={numbers:{},speeds:{}}},m.shownext=function(a){a===!1?this.next.visible=!1:(this.nextbtn.settext("Next"),this.next.visible=!0)},m.showback=function(a){a===!1?this.back.visible=!1:this.back.visible=!0},m.showplay=function(){this.nextbtn.settext("Play"),this.next.visible=!0},m.showhome=function(a){a===!1?this.home.visible=!1:this.home.visible=!0},m.uibutton=function(a){var b=new c(a);return b.view},m.uibutton2=function(a,b,d,e,f){var g=new c(a,d,e,null,null,f);return g.view.x=b.x,g.view.y=b.y,g.setsize(b.w,b.h),g.centertext(),g.view},m.plinkbackground=function(a){var b=new d(a);return b.view},m.plinkprojected=function(){var a=new b(images[app.config.ui.PLINK.projected.image]);return a},m.animalchoice=function(a,b,c,d){var e=new h,f=WGBH.Util.SpriteFromSheet(this.bubblebgs,c),g=WGBH.Util.SpriteFromSheet(this.animalsheet,a);e.addChild(f),e.addChild(g);var i=WGBH.Util.Text(d,app.config.choice.CHOICEPANEL.animallist.bubble.style,{align:"center"});return i.lineHeight=app.config.choice.CHOICEPANEL.animallist.bubble.lineheight,i.lineWidth=app.config.choice.CHOICEPANEL.animallist.bubble.linewidth,i.y=g.sourceRect.height,i.x=g.sourceRect.width/2,e.addChild(i),e},m.showsplash=function(a,b){this.hidesplash(),this.splash=new d(b,"splash","splash_"+a),this.addChild(this.splash.view)},m.hidesplash=function(){this.splash&&this.removeChild(this.splash.view)},m.itemchoice=function(a,b,c,d){var e=new h,f=app.config.choice.CHOICEPANEL.customize.itembutton;return e.button=WGBH.Util.SelectButton(f),e.button.selected=!0,e.button.type=a,b.margin||(b.margin=0),e.icon=this.animalicon(a,{x:b.w/2,y:b.h/2,w:b.w-2*b.margin,h:b.h-2*b.margin},c),e.name=WGBH.Util.Text(app.gameoptions.getnameforitem(a),f.text.style),e.name.x=e.icon.x,e.name.y=e.icon.y+b.h/2+f.text.frame.y,e.name.lineWidth=f.text.linewidth,e.addChild(e.name),e.button.icon=e.icon,e.icon.mouseEnabled=!1,e.addChild(e.button),e.addChild(e.icon),e.button.active=function(){this.isactive=!0,this.selected=!0,this.icon.alpha=1},e.button.inactive=function(){this.isactive=!1,this.selected=!1,this.icon.alpha=.5},e.button.toggle=function(){this.isactive?this.inactive():this.active()},e.button.isactive=!0,e.type=a,e.x=b.x,e.y=b.y,this.dodebug&&(this.debug.speeds[a]=WGBH.Util.Text("0",f.text.style),this.debug.speeds[a].x=b.w,e.addChild(this.debug.speeds[a]),this.debug.numbers[a]=WGBH.Util.Text("0",f.text.style),this.debug.numbers[a].y=b.h,e.addChild(this.debug.numbers[a])),e},m.playerdebug=function(a,b){this.debug.speeds.player=WGBH.Util.Text("0",app.config.choice.CHOICEPANEL.customize.itembutton.text.style),this.debug.speeds.player.x=b.x,this.debug.speeds.player.y=b.y,this.addChild(this.debug.speeds.player)},m.timedebug=function(a){this.debug.numbers.time=WGBH.Util.Text("0",app.config.choice.CHOICEPANEL.customize.itembutton.text.style),WGBH.Util.Position(this.debug.numbers.time,a),this.addChild(this.debug.numbers.time)},m.goaldebug=function(a){this.debug.numbers.goal=WGBH.Util.Text("0",app.config.choice.CHOICEPANEL.customize.itembutton.text.style),WGBH.Util.Position(this.debug.numbers.goal,a),this.addChild(this.debug.numbers.goal)},m.addimage=function(a){var c=new b(images[a.image]);return c.x=a.frame.x,c.y=a.frame.y,this.addChild(c),c},m.updatespeeds=function(a){if("player"==a)return e=app.gameoptions.settings.player.speed,f=app.gameoptions.getadjustedspeed(e,"player"),void(this.debug.speeds.player.text=f);var b="collect";"predator"==a&&(b="pred");for(var c in this.debug.speeds){var d=app.gameoptions.getgameitem(c),e=d.speed,f=0;e&&(f=app.gameoptions.getadjustedspeed(e,b)),this.debug.speeds[c].text=f}},m.updatenumbers=function(a){if("player"!=a){var b="collect";"predator"==a&&(b="pred");for(var c in this.debug.numbers){var d=app.gameoptions.getgameitem(c),e=d.num,f=app.gameoptions.getadjustednumber(e,b);this.debug.numbers[c].text=f}}},m.updatetime=function(){var a=app.gameoptions.settings.goal.time.limit;if(!a)return 0;var b=app.gameoptions.getadjustedtime(a);return this.dodebug&&(this.debug.numbers.time.text=b),b},m.updategoal=function(){var a=app.gameoptions.settings.goal.collect.num;if(!a)return 0;var b=app.gameoptions.getadjustedgoal(a);return this.dodebug&&(this.debug.numbers.goal.text=b),b},m.animalmover=function(a,b,c){var d=new e(a);return WGBH.Util.MakeIcon(d,c),WGBH.Util.ScaleToFit(d,b.w,b.h),d.view.x=b.x,d.view.y=b.y,d},m.animalicon=function(a,b,c){var d=new e(a);return WGBH.Util.MakeIcon(d,c),WGBH.Util.ScaleToFit(d,b.w,b.h),d.view.x=b.x,d.view.y=b.y,d.view},m.makeslider=function(a,b,c,d){var e=new f(d,app.display.stage);return e.setrange(1,10,1),e.setlabels(a,b),e.view.x=c.x,e.view.y=c.y,e},m.makebox=function(a,b){var c=new g(images["9slice"],3);return c.setSize(a.w,a.h),c.view.x=a.x,c.view.y=a.y,c.view},m.maketoggle=function(a,b,c){var d=new j(b,c);return d.view.x=a.x,d.view.y=a.y,d.view},m.teardown=function(){this.clear(!0),l.teardown.call(this)},namespace("WGBH").ChoicePanel=k}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Container"),c=include("createjs.Bitmap"),d=include("createjs.Shape"),e=include("createjs.Sprite"),f=include("createjs.SpriteSheet"),g=include("lib.Plink"),h=include("lib.UIButton"),i=include("lib.ScoreBox"),j=include("lib.Thermometer"),k=include("lib.GamePiece"),l=function(){a.call(this)},m=a.prototype,n=extend(l,a);n.setup=function(){var a=WGBH.Util.SpritesheetClone(app.config.spritesheets[app.config.game.GAMEICONS.spritesheet]);this.iconss=new f(a),this.clickcatch=new d,this.clickcatch.graphics.beginFill("#48AEEE"),this.clickcatch.graphics.drawRect(0,0,app.config.game.FRAME.w,app.config.game.FRAME.h),this.clickcatch.graphics.endFill(),this.addChild(this.clickcatch),this.world=new b,this.world.mouseEnabled=!1,this.addChild(this.world),this.worldobjects=[],this.world.visible=!1,this.world.layers=[],this.ui=new b;var e=new d;e.graphics.beginFill(app.config.game.UI.BAR.color),e.graphics.drawRect(-1,-1,app.config.game.UI.BAR.frame.w+2,app.config.game.UI.BAR.frame.h+1),e.graphics.endFill(),this.ui.addChild(e),this.addChild(this.ui),this.time=new WGBH.Util.Text,this.time.y=app.config.game.UI.TIME.frame.y,this.time.x=app.config.game.UI.TIME.frame.x,this.time.textAlign="right",this.time.color=app.config.game.UI.TIME.color,this.updatetime(0),this.ui.addChild(this.time),this.goalicon=new c,WGBH.Util.Position(this.goalicon,app.config.game.UI.TIME.icon.frame),this.ui.addChild(this.goalicon),this.thermometer=new j(app.config.game.UI.THERMOMETER),this.ui.addChild(this.thermometer.view),this.thermometer.setval(0),this.plink=new g(" "),this.plink.view.x=app.config.game.UI.PLINK.frame.x,this.plink.view.y=app.config.game.UI.PLINK.frame.y,this.plink.view.visible=!1,this.ui.addChild(this.plink.view),this.plinkcontent=new b,this.plinkcontent.visible=!1,this.ui.addChild(this.plinkcontent),this.gameover=new b,this.gameover.visible=!1,this.ui.addChild(this.gameover),this.pausebutton=new c(images[app.config.game.PAUSEBUTTON.image]),WGBH.Util.Position(this.pausebutton,app.config.game.PAUSEBUTTON.frame),this.ui.addChild(this.pausebutton),this.pausescreen=new b,bgshape=new d,bgshape.graphics.beginFill("#000000"),bgshape.graphics.drawRect(-1*app.config.game.PAUSESCREEN.frame.x,-1*app.config.game.PAUSESCREEN.frame.y+app.config.game.UI.BAR.frame.h,app.config.game.FRAME.w,app.config.game.FRAME.h),bgshape.graphics.endFill(),bgshape.alpha=.5,this.pausescreen.addChild(bgshape);var i=new c(images[app.config.game.PAUSESCREEN.plink.image]);WGBH.Util.Position(i,app.config.game.PAUSESCREEN.plink.frame),this.pausescreen.addChild(i),this.pausescreen.x=app.config.game.PAUSESCREEN.frame.x,this.pausescreen.y=app.config.game.PAUSESCREEN.frame.y;var k=new h(app.config.game.PAUSESCREEN.continuebtn);this["continue"]=k.view,this.pausescreen.addChild(this["continue"]);var l=new h(app.config.game.PAUSESCREEN.changebtn);this.change2=l.view,this.pausescreen.addChild(this.change2);var m=new h(app.config.game.PAUSESCREEN.exitbtn);this.exit2=m.view,this.pausescreen.addChild(this.exit2),this.ui.addChild(this.pausescreen),this.pausebutton.visible=!1,this.hidepause()},n.clearworld=function(){for(var a=this.world.numChildren,b=0;a>b;b++)this.world.removeChildAt(0);for(var c in this.world.layers){var d=this.world.layers[c];d.removeAllChildren()}this.world.layers=[],this.worldobjects=[],this.hideplinkscreen(),this.gameover.visible=!1},n.showworld=function(){this.world.visible=!0},n.addlayertoworld=function(a,c){if(this.world.layers[a])return this.world.layers[a];var d=new b;return d.stack=c?c:0,this.world.addChild(d),this.worldobjects.push(d),this.world.layers[a]=d,d},n.addtoworld=function(a,b){b?(this.world.layers[b]||this.addlayertoworld(b),this.world.layers[b].addChild(a)):(this.worldobjects.push(a),this.world.addChild(a))},n.removefromworld=function(a){var b=a.view;for(var c in this.world.layers){var d=this.world.layers[c];if(d.getChildIndex(b)>-1)return d.removeChild(b),!0}if(this.world.getChildIndex(b)>-1){this.world.removeChild(b);for(var e in this.worldobjects)if(this.worldobjects[e]==b){this.worldobjects.splice(e,1);break}}},n.showpausebutton=function(a){a===!1?this.pausebutton.visible=!1:this.pausebutton.visible=!0},n.updatescore=function(a){this.score.text="Score: "+a},n.showtimer=function(a){a===!1?this.time.visible=!1:this.time.visible=!0},n.setspeedround=function(a){this.ui.removeChild(this.goalicon),a?this.goalicon.image=images[app.config.game.UI.TIME.icon.time]:this.goalicon.image=images[app.config.game.UI.TIME.icon.collect],this.ui.addChild(this.goalicon)},n.updatetime=function(a,b){this.time.text=this.prettytime(a),this.thermometer&&this.thermometer.setval(a/b)},n.updatecollect=function(a,b){this.time.text=a+" of "+b,this.thermometer&&this.thermometer.setval(a/b)},n.pulltofront=function(a){this.world.removeChild(a),this.world.addChild(a)},n.restack=function(){this.world.removeAllChildren(),this.worldobjects.sort(function(a,b){return b.stack-a.stack});for(var a in this.worldobjects)this.world.addChild(this.worldobjects[a])},n.prettytime=function(a){var b=parseInt(a/60),c=a-60*b,d=b+":"+c.toPaddedString(2);return d},n.fiticon=function(a,b){WGBH.Util.ScaleToFit(a,b.w,b.h),a.view.x=b.x,a.view.y=b.y},n.showpause=function(){this.pausescreen.visible=!0},n.hidepause=function(){this.pausescreen.visible=!1},n.smallanimalicon=function(a,b){var c=new e(this.iconss);c.x=b.x,c.y=b.y;var d=this.iconss.getAnimation(a);if(!d&&(d=this.iconss.getAnimation("_blank"),!d))return c;var f=d.frames[0];return c.gotoAndStop(f),c},n.biganimalicon=function(a,b){var c=new k(a);return WGBH.Util.MakeIcon(c,app.gameoptions.settings),WGBH.Util.ScaleToFit(c,b.w,b.h),c.view.x=b.x,c.view.y=b.y,c.view.control=c,c.view},n.showplinkscreen=function(a,b){switch(this.plinkcontent.removeAllChildren(),a){case"avoid":this.showinstructions(a);break;case"collect":this.showinstructions(a);break;case"gamelost":this.gamelost();break;case"gamewon":this.gamewon()}this.plink.view.visible=!0,this.plinkcontent.visible=!0},n.hideplinkscreen=function(){this.plink.setplinksize("med"),this.plink.view.x=app.config.game.UI.PLINK.frame.x,this.plink.view.y=app.config.game.UI.PLINK.frame.y,this.plinkcontent.removeAllChildren(),this.plinkcontent.visible=!1,this.plink.view.visible=!1,this.timeout&&this.timeout.destroy()},n.showinstructions=function(a){this.plinkcontent.removeAllChildren();var b=app.gameoptions.settings,d=app.config.game.UI.PLINK.frame,e=app.config.game.INSTRUCTIONS[a],f=e.player.frame.clone();f.x+=d.x,f.y+=d.y;var g=this.biganimalicon(b.player.animal,f);g.scaleX*=-1,this.plinkcontent.addChild(g);var i;if("collect"==a){i=app.gameoptions.getcollectionlist(!0);var j="food";"flock"==app.gameoptions.settings.goal.collect.what?j="flock":"nest"==app.gameoptions.settings.goal.collect.what&&(j="nest"),this.plink.settitle(e.title[j]),this.plink.purple()}else this.plink.settitle(e.title),this.plink.purple(),i=app.gameoptions.getpredatorlist(!0),a="pred";var k,l=e.icons.frame.w/(i.length+1);for(var m in i){var n=new c(images[e.icons.circle.id]),o=(parseInt(m)+1)*l;k={x:o+d.x+e.icons.frame.x,y:e.icons.frame.y+d.y,w:e.icons.circle.frame.w,h:e.icons.circle.frame.h};var p=this.smallanimalicon(i[m],k);WGBH.Util.Position(n,k),this.plinkcontent.addChild(n),this.plinkcontent.addChild(p);var q=app.gameoptions.getgameitem(i[m]),r=q.num,s=(app.gameoptions.getadjustednumber(r,a),q.speed),t=0;s&&(t=app.gameoptions.getadjustedspeed(s,a))}var u=new c(images[e.arrow.id]);k={x:e.arrow.frame.x+d.x,y:e.arrow.frame.y+d.y},WGBH.Util.Position(u,k),this.plinkcontent.addChild(u);var v=new h(e.nextbtn);this.nextbutton=v.view,this.nextbutton.x+=d.x,this.nextbutton.y+=d.y,this.plinkcontent.addChild(this.nextbutton);var w=new c(images[e.icons.icon.id]);if(k={x:e.icons.icon.frame.x+d.x,y:e.icons.icon.frame.y+d.y},WGBH.Util.Position(w,k),this.plinkcontent.addChild(w),"collect"==a){var x=this;this.timeout=app.setTimeout(function(){x.switchcollect()},e.switchtime)}},n.switchcollect=function(){var a=app.config.game.UI.PLINK.frame,b="collect",d=app.gameoptions.settings.goaltarget;app.gameoptions.settings.speedround&&(b="time"),this.plinkcontent.removeChildAt(this.plinkcontent.numChildren-1);var e,f;"time"==b?(e=app.config.game.INSTRUCTIONS.collect.timegoal,f=this.prettytime(d)):(e=app.config.game.INSTRUCTIONS.collect.collectgoal,f=d);var g=new c(images[e.icon.image]);WGBH.Util.Position(g,e.icon.frame),g.x+=a.x,g.y+=a.y;var h=WGBH.Util.Text(f,e.text.style);WGBH.Util.Position(h,e.text.frame),h.x+=a.x,h.y+=a.y,this.plinkcontent.addChild(g),this.plinkcontent.addChild(h)},n.addpointer=function(a,d){this.arrow=new b;var e=new c(images.pointerarrow),f=new WGBH.Util.Text(d);f.x=90,f.y=40,this.arrow.addChild(f),this.arrow.addChild(e),this.arrow.x=a.x,this.arrow.y=a.y,this.ui.addChild(this.arrow)},n.hidepointer=function(){this.arrow&&(this.arrow.removeAllChildren(),this.ui.removeChild(this.arrow))},n.showjit=function(a){switch(this.plink.purple(),a){case 0:this.plink.settitle("Press space to begin");break;case 1:this.showmechanic();break;case 2:this.plink.settitle("Collect these!");break;case 3:this.plink.settitle("Avoid these!")}this.plink.view.visible=!0},n.hidejit=function(){this.hideplinkscreen(),this.hidepointer()},n.showmechanic=function(){var a=app.config.game.INSTRUCTIONS.mechanic,b=app.config.game.UI.PLINK.frame;this.plink.settitle(a.title),this.plinkcontent.removeAllChildren();var d=a[app.control],e=d.prompt+app.gameoptions.settings.player.actiontext,f=app.gameoptions.settings.player.actiontext.replace(/\s/g,"");if("keyboard"==app.control){var g=new c(images[d.icon.image]);WGBH.Util.Position(g,d.icon.frame),g.x+=b.x,g.y+=b.y,this.plinkcontent.addChild(g),app.playVO(d.vo[f])}else{var h=new c(images[d.icon.image]);WGBH.Util.Position(h,d.icon.frame),h.x+=b.x,h.y+=b.y,this.plinkcontent.addChild(h),app.playVO(d.vo[f])}var i=WGBH.Util.Text(e,a.text.style);WGBH.Util.Position(i,a.text.frame),i.x+=b.x,i.y+=b.y,this.plinkcontent.addChild(i);var j=this.biganimalicon(app.gameoptions.settings.player.animal,a.icon.frame);j.scaleX*=-1,this.plinkcontent.addChild(j),this.plinkcontent.visible=!0},n.clicknext=function(a){},n.showgameover=function(a,b,d,e,f){app.config.game.UI.PLINK.frame;this.gameover.removeAllChildren(),this.gameovericon=b,this.gameover.addChild(this.gameovericon.view);var g,j,k,l,m;if(d){this.gameover.x=app.config.game.GAMEOVER.win.frame.x,this.gameover.y=app.config.game.GAMEOVER.win.frame.y,j=app.config.game.GAMEOVER.win,g=j.icon,this.fiticon(this.gameovericon,g),WGBH.Util.Position(this.gameovericon,j.icon);var n="default";0===e?n="none":f&&(n="some"),this.plink.setplinksize("large"),this.plink.view.x=app.config.game.UI.BIGPLINK.frame.x,this.plink.view.y=app.config.game.UI.BIGPLINK.frame.y;var o=j.title[n];this.plink.settitle(o),this.plink.purple();var p=app.gameoptions.getcollectionlist(!0),q=j.icons.frame.w/(p.length+1);for(var r in p){var s=new c(images[j.icons.circle.id]),t=(parseInt(r)+1)*q,u={x:t+j.icons.frame.x,y:j.icons.frame.y,w:j.icons.circle.frame.w,h:j.icons.circle.frame.h},v=this.smallanimalicon(p[r],u);WGBH.Util.Position(s,u),this.gameover.addChild(s),this.gameover.addChild(v)}k=new h(j.replaybtn),this.replay=k.view,l=new h(j.changebtn),this.change=l.view,m=new h(j.exitbtn),this.exit=m.view,this.gameover.addChild(this.exit),this.gameover.addChild(this.replay),this.gameover.addChild(this.change);var w=new i(a);WGBH.Util.Position(w.view,j.scorebox.frame),this.gameover.addChild(w.view)}else{this.gameover.x=app.config.game.GAMEOVER.lose.frame.x,this.gameover.y=app.config.game.GAMEOVER.lose.frame.y,j=app.config.game.GAMEOVER.lose,g=j.icon,this.fiticon(this.gameovericon,g),WGBH.Util.Position(this.gameovericon,j.icon),this.plink.setplinksize("med"),this.plink.settitle(j.title),this.plink.red();var x=b.name;x.length>9&&(x+="\n"),k=new h(j.replaybtn),this.replay=k.view,l=new h(j.changebtn),this.change=l.view,m=new h(j.exitbtn),this.exit=m.view,this.gameover.addChild(this.exit),this.gameover.addChild(this.replay),this.gameover.addChild(this.change)}this.showplinkscreen(),this.gameover.visible=!0},n.showui=function(){this.ui.visible=!0},n.addtoui=function(a,b,c){b&&(a.x=b),c&&(a.y=c),this.ui.addChild(a)},n.hideui=function(){this.ui.visible=!1},n.clearui=function(){for(var a=this.ui.numChildren,b=0;a>b;b++)this.ui.removeChildAt(0);this.timeout&&this.timeout.destroy(),this.hideplinkscreen()},n.teardown=function(){this.clearworld(),this.clearui(),this.pausescreen.removeAllChildren(),m.teardown.call(this)},namespace("WGBH").GamePanel=l}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("springroll.easeljs.Button"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.background=new b(images.TitleBackground),this.addChildAt(this.background,0),this.playButton=new c(images.PlayButton),this.playButton.x=app.config.game.UI.PLAY.frame.x,this.playButton.y=app.config.game.UI.PLAY.frame.y,this.addChild(this.playButton)},f.teardown=function(){e.teardown.call(this),this.background=null,this.playButton=null},namespace("WGBH").TitlePanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("lib.UIButton"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){var a=new b(images[app.config.welcome.BACKGROUND.image]);this.addChild(a);var d=new c(app.config.welcome.SKIPBTN);this.skipintro=d.view,this.addChild(this.skipintro)},f.teardown=function(){e.teardown.call(this)},namespace("WGBH").WelcomePanel=d}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.ChoicePanel"),c=function(c){a.call(this,new b,c)},d=extend(c,a);d.enterDone=function(){this.chooseanimal=this.chooseanimal.bind(this),this.chooselevel=this.chooselevel.bind(this),this.clicknext=this.clicknext.bind(this),this.clickback=this.clickback.bind(this),this.clickhome=this.clickhome.bind(this),this.sliderchange=this.sliderchange.bind(this),this.toggleitem=this.toggleitem.bind(this),this.clickbackanimal=this.clickbackanimal.bind(this),this.clicknextanimal=this.clicknextanimal.bind(this),this.clickradio=this.clickradio.bind(this),this.animateitems=this.animateitems.bind(this),this.gameoptions=app.gameoptions,this.audiofiles=app.config.choice.VO,this.config=app.config.choice.CHOICEPANEL,this.dodebug=this.config.shownumbers,app.changecurrent?(this.showlevelsplash(),this.showlevel()):this.showanimals(),this.panel.home.addEventListener("click",this.clickhome),this.panel.back.addEventListener("click",this.clickback),this.panel.next.addEventListener("click",this.clicknext)},d.showanimals=function(){this.panel.shownext(!1),this.panel.showback(!1),this.panel.showhome(!1),this.rightarrow=this.panel.uibutton(this.config.animallist.nextbtn),this.leftarrow=this.panel.uibutton(this.config.animallist.prevbtn),this.showanimalpage(app.animalpage),
app.played.animalindex||(app.playVO(this.audiofiles.index),app.played.animalindex=!0)},d.showanimalpage=function(a){this.hideanimals();var b=WGBH.Util.Text(this.config.animallist.title,this.config.title.style);b.x=this.config.title.frame.x,b.y=this.config.title.frame.y,this.panel.addChild(b),this.panel.addChild(this.rightarrow),this.panel.addChild(this.leftarrow),app.animalpage=a;var c=8,d=0;this.rightarrow.off("click",this.rightarrow.listener),this.leftarrow.off("click",this.leftarrow.listener);var e=this.gameoptions.getanimallist(),f=this.config.animallist.bubble,g=this.config.animallist.frame.w,h=(this.config.animallist.frame.h,this.config.animallist.frame.y),i=this.config.animallist.frame.x,j=(a-1)*c,k=j+c;k>=e.length?(k=e.length,this.rightarrow.visible=!1):(this.rightarrow.visible=!0,this.rightarrow.listener=this.rightarrow.on("click",this.clicknextanimal)),this.buttonset=[],a>1?(this.leftarrow.visible=!0,this.leftarrow.listener=this.leftarrow.on("click",this.clickbackanimal)):this.leftarrow.visible=!1;for(var l=4,m=f.rh,n=g/(l-1),o=j;k>o;o++){col=d%l,row=parseInt(d/l);var p=e[o],q=this.gameoptions.getanimalforpreset(p),r=(this.gameoptions.getsettingsforitem(q),this.gameoptions.getnameforitem(q)),s=this.panel.animalchoice(q,f,this.gameoptions.getsceneforid(q),r);s.choice=p,s.addEventListener("click",this.chooseanimal),s.x=i+n*col,s.y=h+m*row,this.panel.addChild(s),d++,this.buttonset.push(s)}},d.clickbackanimal=function(){var a=app.animalpage-1;this.showanimalpage(a)},d.clicknextanimal=function(){var a=app.animalpage+1;this.showanimalpage(a)},d.chooseanimal=function(a){this.gamechoice=a.currentTarget.choice,app.history[this.gamechoice]={},app.currentgame=this.gamechoice,this.animalchoice=this.gameoptions.getanimalforpreset(this.gamechoice),this.gameoptions.setpreset(this.gamechoice);var b=this.gameoptions.getpredatorlist();!b||b.length<1?this.apex=!0:this.apex=null,this.hideanimals();var c=["title_"+this.gamechoice];this.repeat||(this.repeat=!0,c=c.concat(this.audiofiles.level)),app.playVO(c),this.preplevel()},d.hideanimals=function(){this.panel.clear();for(var a in this.buttonset)this.buttonset[a].off("click",this.buttonset[a].listener),this.buttonset[a]=null;this.rightarrow.off("click",this.rightarrow.listener),this.leftarrow.off("click",this.rightarrow.listener),this.panel.removeChild(this.rightarrow),this.panel.removeChild(this.leftarrow),this.buttonset=null},d.preplevel=function(){this.showlevelsplash();var a=this.gameoptions.getmanifestforlevel(this.gamechoice,"items"),b=this,c=this.showlevel;app.load(a,function(a){for(var d in a)images[d]||(images[d]=a[d]);c&&c.call(b)})},d.showlevelsplash=function(){this.panel.showback(!1),this.panel.showsplash(this.animalchoice,this.gameoptions.settings.title)},d.showlevel=function(){this.goback="main",this.panel.showhome(),this.buttonset=[];var a=this.panel.uibutton(this.config.levelchoice.easybtn);a.addEventListener("click",this.chooselevel),a.choice="easy",this.panel.addChild(a),this.buttonset.push(a);var b=this.panel.uibutton(this.config.levelchoice.hardbtn);b.addEventListener("click",this.chooselevel),b.choice="hard",this.panel.addChild(b),this.buttonset.push(b);var c=this.panel.uibutton(this.config.levelchoice.custombtn);c.addEventListener("click",this.chooselevel),c.choice="customize",this.panel.addChild(c),this.buttonset.push(c)},d.chooselevel=function(a){if(this.panel.showback(!1),this.hidelevel(),"customize"==a.currentTarget.choice)return void this.customize();var b=this.config.difficulty[a.currentTarget.choice];this.resetdefaults(),this.setfactor("speed","pred",b.pred.speed),this.setfactor("speed","collect",b.collect.speed),this.setfactor("speed","player",b.player.speed),this.setfactor("num","pred",b.pred.num),this.setfactor("num","collect",b.collect.num),this.setfactor("goal","time",b.goal.time),this.setfactor("goal","collect",b.goal.collect),this.gotogame()},d.setfactor=function(a,b,c){switch(a){case"num":this.gameoptions.settings.numberfactors[b]=c;break;case"speed":this.gameoptions.settings.speedfactors[b]=c;break;case"goal":this.gameoptions.settings.goalfactors[b]=c}},d.hidelevel=function(){this.panel.clear();for(var a in this.buttonset)this.buttonset[a].removeEventListener("click",this.chooselevel),this.buttonset[a]=null;this.buttonset=null},d.customize=function(){this.goback="level",this.panel.showback(),this.panel.showhome(),this.showcustom("collection")},d.showcustom=function(a){this.panel.showback(),this.panel.shownext(),this.panel.showhome(),this.clearcustom();var b=this.config.customize[a];this.goback=b.back,"predator"==this.goback&&this.apex&&(this.goback=this.config.customize.predator.back),this.gonext=b.next,"predator"==this.gonext&&this.apex&&(this.gonext=this.config.customize.predator.next);var c=this.panel.plinkprojected();c.x=this.config.customize.plink.frame.x,c.y=this.config.customize.plink.frame.y,this.panel.addChild(c);var d=WGBH.Util.Text(b.title,this.config.title.style);if(d.x=this.config.title.frame.x,d.y=this.config.title.frame.y,this.panel.addChild(d),b.icon){var e=this.panel.addimage(b.icon);e.x=d.x-d.getMeasuredWidth()/2-b.icon.frame.w-b.icon.margin}this.widgets=[];var f=this.panel.makebox(b.box);this.panel.addChild(f),this.itemlist=[];var g,h,i="player";this.items=[],this.whichpanel=a;var j=!1;switch(a){case"player":this.itemlist.push(this.gameoptions.settings.player.animal),this.itemcount=1,i="player",this.panel.showplay(),app.playVO(this.audiofiles.player);break;case"predator":this.itemlist=this.gameoptions.getpredatorlist(),i="pred",this.itemcount=this.gameoptions.settings.numberfactors[i],app.playVO(this.audiofiles.avoid);break;case"collection":this.itemlist=this.gameoptions.getcollectionlist(),i="collect";var k=[];app.history[this.gamechoice].gc||(k.push("context_"+this.gamechoice),app.history[this.gamechoice].gc=!0),this.itemlist.length>1?k=k.concat(this.audiofiles.collect):(k=k.concat(this.audiofiles.collect1),j=!0),app.playVO(k),this.itemcount=this.gameoptions.settings.numberfactors[i]}this.itemframes={};var l={x:this.config.customize.plink.frame.x+this.config.customize.plink.margin.l,y:this.config.customize.plink.frame.y+this.config.customize.plink.margin.t,h:this.config.customize.plink.frame.h-(this.config.customize.plink.margin.t+this.config.customize.plink.margin.b),w:this.config.customize.plink.frame.w-(this.config.customize.plink.margin.l+this.config.customize.plink.margin.r)},m=[],n=[],o=this.config.customize.player.herospot,p={x:o.x+l.x,y:o.y+l.y,w:o.w,h:o.h},q=100,r=60,s=parseInt(l.h/r),t=parseInt(l.w/q);s=6,t=5,r=parseInt(l.h/(1.12*s)),q=parseInt(l.w/(1.25*t));for(var u,v,w=0;s>w;w++){var x=0;w%2===0&&(x=q/2);for(var y=0;t>y;y++)w%2===0?y%2===0?(x+=q/2,v=w*r,u=y*q+x):(v=w*r-r/2,u=y*q+x):y%2===0?(x+=q/2,v=w*r,u=y*q+x):(v=w*r-r/2,u=y*q+x),2==y&&2==w||1==y&&2==w||2==y&&3==w?n.push({x:u+l.x,y:v+l.y,w:q,h:r}):m.push({x:u+l.x,y:v+l.y,w:q,h:r})}var z=0;for(var A in this.itemlist){var B=this.itemlist[A];if(this.itemframes[B]=[],this.itemframes[B][0]=n[A],"player"==this.whichpanel)z+=parseInt(this.gameoptions.settings.player.speed),this.itemframes[B][0]=p;else{var C=this.gameoptions.getgameitem(B),D=C.speed?C.speed:0;z+=parseInt(D)}for(var E=1;10>E;E++){var F=parseInt(Math.random()*m.length),G=m[F];m.splice(F,1),this.itemframes[B].push(G)}}var H,I=this.config.customize.panel.item.frame,J={x:I.x+b.box.x,y:I.y+b.box.y,w:I.w,h:I.h,margin:I.margin};"player"==this.whichpanel&&(H={x:I.x+b.box.x,y:I.y+b.box.y,w:I.w,h:I.h,margin:I.margin},this.dodebug&&this.panel.playerdebug(this.gameoptions.settings.player.animal,H));for(var K in b.panels){var L,M=this.config.customize.panel[b.panels[K].type],N=b.panels[K];if("speed"==b.panels[K].type){if(0===z)continue;L=this.gameoptions.settings.speedfactors}else"number"==b.panels[K].type?L=this.gameoptions.settings.numberfactors:"collect"==b.panels[K].type?(L=this.gameoptions.settings.goalfactors,i="collect"):"time"==b.panels[K].type&&(L=this.gameoptions.settings.goalfactors,i="time");N.title?title=N.title:title=M.title,j&&N.singletitle&&(title=N.singletitle);var O=WGBH.Util.Text(title,this.config.customize.paneltitle.style),P={x:b.box.x+b.box.w/2,y:N.frame.y+b.box.y};O.x=P.x,O.y=P.y;var Q=WGBH.Util.BoxText(O,this.config.customize.paneltitle.style);Q&&(Q.x=P.x,Q.y=P.y,this.panel.addChild(Q));var R;if(N.icon){var S=(N.icon.frame.w+N.icon.margin)/4;O.x=O.x+S,Q.x=Q.x+S,R=this.panel.addimage(N.icon),R.x=O.x-O.getMeasuredWidth()/2-4*S,R.y+=P.y}switch(this.panel.addChild(O),P.y=P.y+this.config.customize.paneltitle.h+this.config.customize.paneltitle.m,H={x:Q.x+O.getMeasuredWidth()/2,y:Q.y},M.type){case"slider":P.x=N.frame.x+b.box.x+this.config.customize.paneltitle.w,P.y+=this.config.customize.slider.y;var T=M.min,U=M.max,V=this.panel.makeslider(T,U,P,b.panels[K].type);this.panel.addChild(V.view),V.type=b.panels[K].type,V.off("valuechange",this.sliderchange),V.on("valuechange",this.sliderchange),this.widgets.push(V),V.setobj(L,i);var W=L[i];if(V.setValue(W),V.label=O,V.box=Q,V.icon=R,V.show=function(a){var b=!0;a===!1&&(b=!1),this.label.visible=b,this.box.visible=b,this.view.visible=b,this.icon.visible=b},"collect"==N.type){var X=app.gameoptions.settings.goal.collect.num,Y=this.gameoptions.getadjustedgoal(X,10);V.setlabels(this.gameoptions.getadjustedgoal(X,1),Y),V.showvalue()}else if("time"==N.type){var Z=app.gameoptions.settings.goal.time.limit;V.setlabels(WGBH.Util.PrettyTime(this.gameoptions.getadjustedtime(Z,1)),WGBH.Util.PrettyTime(this.gameoptions.getadjustedtime(Z,10))),V.showvalue()}break;case"buttons":var $=N.frame.w/(this.itemlist.length+1);h=0,P.x=b.box.x+N.frame.x;for(g in this.itemlist){h++;var _=h*$;J.x=P.x+_-J.w/2,J.y=P.y;var aa=this.panel.itemchoice(this.itemlist[g],J,this.gameoptions.settings);aa.button.off("click",aa.listener),aa.listener=aa.button.on("click",this.toggleitem),this.panel.addChild(aa),this.widgets.push(aa.button),this.gameoptions.settings.itemstatus[this.itemlist[g]]===!1&&aa.button.toggle()}break;case"togglebuttons":var ba=this.config.customize.togglebutton,ca={x:N.frame.x+b.box.x+M.frame.x,y:N.frame.y+b.box.y+M.frame.y+this.config.customize.togglebuttons.y,w:20,h:20};for(var da in this.config.customize.toggleoptions){var ea=this.panel.maketoggle(ca,this.config.customize.toggleoptions[da],ba);ea.tog=!0,this.panel.addChild(ea),this.widgets.push(ea),ea.off("click",this.clickradio),ea.on("click",this.clickradio),ca.x+=ea.width,this.gameoptions.settings.goalstatus[this.config.customize.toggleoptions[da].val]===!0?ea.control.setactive(!0):ea.control.setactive(!1)}}}this.updateitemcount(this.itemcount),"collection"==this.whichpanel?this.checkitems():"player"==this.whichpanel&&this.updategoal()},d.toggleitem=function(a){a.currentTarget.toggle(),this.setitem(a.currentTarget.type,a.currentTarget.isactive)},d.setitem=function(a,b){this.gameoptions.settings.itemstatus[a]=b,this.updateitemcount(this.itemcount),"collection"==this.whichpanel&&this.checkitems()},d.checkitems=function(){var a=0;for(var b in this.itemlist)this.gameoptions.settings.itemstatus[this.itemlist[b]]!==!1&&a++;1>a?this.panel.shownext(!1):this.panel.shownext(!0)},d.animateitems=function(a){if(this.tcheck+=a,this.tcheck>this.frameupdate){this.tcheck=0;for(var b in this.items)this.items[b].stepframe(this.speedframes)}},d.sliderchange=function(a){switch(a.target.updatenode(),a.type){case"number":this.updateitemcount(a.val);break;case"speed":this.updateanimspeed(a.val);break;case"time":var b=this.panel.updatetime();a.target.setshowval(WGBH.Util.PrettyTime(b));break;case"collect":var c=this.panel.updategoal();a.target.setshowval(c)}},d.updateitemcount=function(a){app.off("update",this.animateitems),this.tcheck=0,this.itemcount=a;var b,c,d,e;for(d in this.items)this.panel.removeChild(this.items[d].view);this.dodebug&&this.panel.updatenumbers(this.whichpanel),this.items=[];for(d in this.itemlist){var f=this.itemlist[d];if(this.gameoptions.settings.itemstatus[f]!==!1){for(var g=1;a>g;g++)b=this.itemframes[f][g],e=this.panel.animalmover(f,b,this.gameoptions.settings),this.panel.addChild(e.view),e.loop(Math.random()),this.items.push(e);if(c=this.itemframes[f][0],"player"==this.whichpanel){var h=f+"_large";this.gameoptions.getsettingsforitem(h)&&(f=h),e=this.panel.animalmover(f,c,this.gameoptions.settings),e.view.scaleX=e.view.scaleY=1,e.faceright(!0)}else e=this.panel.animalmover(f,c,this.gameoptions.settings);this.panel.addChild(e.view),e.loop(Math.random()),this.items.push(e)}}app.on("update",this.animateitems)},d.updateanimspeed=function(a){this.animspeed=a,this.dodebug&&this.panel.updatespeeds(this.whichpanel),this.fps=parseInt(40*this.animspeed/10),this.speedframes=1,this.frameupdate=30,a>5?this.speedframes=parseInt(a-5):5>a&&(this.frameupdate=25*(5-a))},d.resetdefaults=function(){this.gameoptions.resetstatus()},d.clickradio=function(a){var b=a.currentTarget;b.control.setactive(!0);for(var c in this.widgets)if(this.widgets[c].tog){var d=this.widgets[c];d!=b&&(d.control.setactive(!1),this.setgoaltype(d.val,!1))}this.setgoaltype(b.val),this.updategoal()},d.setgoaltype=function(a,b){b===!1?this.gameoptions.settings.goalstatus[a]=!1:this.gameoptions.settings.goalstatus[a]=!0},d.updategoal=function(){for(var a in this.widgets){var b=this.widgets[a];"time"==this.widgets[a].type?this.gameoptions.settings.goalstatus.time===!0?b.show():b.show(!1):"collect"==b.type&&(this.gameoptions.settings.goalstatus.collect===!0?b.show():b.show(!1))}},d.clearcustom=function(){},d.hidecurrent=function(){this.panel.clear();for(var a in this.buttonset)this.buttonset[a].removeEventListener("click",this.chooselevel),this.buttonset[a].removeEventListener("click",this.chooseanimal),this.buttonset[a]=null;for(var b in this.widgets)this.widgets[b].off("valuechange",this.sliderchange),this.widgets[b].off("click",this.widgets[b].listener);this.buttonset=null},d.gopanel=function(a){switch(app.stopVO(),this.panel.showback(!1),this.panel.shownext(!1),this.panel.showhome(!1),this.hidecurrent(),a){case"main":this.showanimals();break;case"level":this.showlevelsplash(),this.showlevel();break;case"player":this.showcustom("player");break;case"collection":this.showcustom("collection");break;case"predator":this.showcustom("predator");break;case"game":this.gotogame()}this.currentpanel=a},d.gotogame=function(){this.nextState()},d.clickback=function(a){this.gopanel(this.goback)},d.clickhome=function(a){this.gopanel("main")},d.clicknext=function(a){this.gopanel(this.gonext)},d.exit=function(){app.stopVO(),app.off("update",this.animateitems),this.hidecurrent(),this.panel.home.removeEventListener("click",this.clickhome),this.panel.back.removeEventListener("click",this.clickback),this.panel.next.removeEventListener("click",this.clicknext),this.panel.removeAllChildren(),this.rightarrow&&this.rightarrow.off("click",this.rightarrow.listener),this.leftarrow&&this.leftarrow.off("click",this.leftarrow.listener)},namespace("WGBH").ChoiceState=c}(),function(){var a,b,c,f,g,j,k,l,m,n,o=include("springroll.easeljs.BaseState"),p=include("createjs.Bitmap"),q=include("createjs.Point"),r=include("createjs.Rectangle"),s=include("WGBH.GamePanel"),t=include("lib.Camera"),u=include("plumlib.PointBubble"),v=include("lib.GamePiece"),w=include("lib.BGPanel"),x=function(a){o.call(this,new s,a)},y=extend(x,o),z=0,A=0,B=0,C=0;y.enterDone=function(){g=app.config.game,a=g.TIMELIMIT,j=g.TICKRATE,k=g.ANIMRATE,f={x:.001*g.GRAVITY.x,y:.001*g.GRAVITY.y},app.debug=1==g.SHOWRECTS,l=g.POINTBUBBLE.sfx,n=g.SFX.dig,m=g.SFX.bubble,this.params=document.getElementById("params"),this.update=this.update.bind(this),this.startover=this.startover.bind(this),this.activateenemies=this.activateenemies.bind(this),this.showcollection=this.showcollection.bind(this),this.showjit=this.showjit.bind(this),this.clicknext=this.clicknext.bind(this),this.tapped=this.tapped.bind(this),this.pause=this.pause.bind(this),this.unpause=this.unpause.bind(this),this.takeclicks=this.takeclicks.bind(this),this.clickexit=this.clickexit.bind(this),this.clickchange=this.clickchange.bind(this),b=!1,this.cam=new t,this.cam.setframe(g.CAMERA.frame),this.cam.sethorizon(g.CAMERA.horizon),this.options=app.gameoptions,this.loadgame(this.gameloaded);this.panel.pausebutton.off("mousedown",this.pause),this.panel.pausebutton.on("mousedown",this.pause)},y.loadgame=function(a){var b=this.options.getmanifestforlevel(this.options.settings.presetid,"bgs"),c=this;app.load(b,function(b){for(var d in b)images[d]||(images[d]=b[d]);a&&a.call(c)})},y.gameloaded=function(){this.setgame(),app.jitstate=0,this.showinstructions(1)},y.pause=function(a){this.gamerunning&&this.stop(),this.panel.showpause(),this.panel.showpausebutton(!1),this.panel["continue"].removeEventListener("click",this.unpause),this.panel["continue"].addEventListener("click",this.unpause),this.panel.change2.removeEventListener("click",this.clickchange),this.panel.change2.addEventListener("click",this.clickchange),this.panel.exit2.removeEventListener("click",this.clickexit),this.panel.exit2.addEventListener("click",this.clickexit)},y.unpause=function(a){this.panel.showpausebutton(),this.gamerunning&&this.resume(),this.panel.hidepause()},y.clickexit=function(a){this.mainmenu()},y.changeoptions=function(){this.exitgame(),app.changecurrent=!0,this.previousState()},y.mainmenu=function(){this.exitgame(),app.changecurrent=!1,this.previousState()},y.takeclicks=function(){app.keyboard.removeKeyDown("spacebar",this.tapped),app.keyboard.removeKeyUp("spacebar",this.released),app.keyboard.addKeyDown("spacebar",this.tapped),app.keyboard.addKeyUp("spacebar",this.released),this.panel.clickcatch.off("mousedown",this.mouseclick),this.panel.clickcatch.off("pressup",this.mouseup),this.mouseclick=this.panel.clickcatch.on("mousedown",this.tapped),this.mouseup=this.panel.clickcatch.on("pressup",this.released)},y.noclicks=function(){this.released(),app.keyboard.removeKeyDown("spacebar",this.tapped),app.keyboard.removeKeyUp("spacebar",this.released),this.panel.clickcatch.off("mousedown",this.mouseclick),this.panel.clickcatch.off("pressup",this.mouseup)},y.start=function(){z=0,A=0,B=0,C=0,app.playAmbient(this.options.settings.scene.ambient),app.off("update",this.update),app.on("update",this.update)},y.stop=function(){app.playAmbient(),app.off("update",this.update)},y.resume=function(){app.playAmbient(this.options.settings.scene.ambient),app.off("update",this.update),app.on("update",this.update)},y.cleargame=function(){this.player=null,this.panel.clearworld(),this.stop()},y.exitgame=function(){this.cleargame(),this.panel.hidepause(),this.panel.showpausebutton(!1)},y.startover=function(){this.cleargame(),this.panel.hidepause(),this.panel.showpausebutton(!1),this.setgame(),this.showinstructions(1)},y.showinstructions=function(a){switch(this.instructionset=a,this.panel.nextbutton&&this.panel.nextbutton.removeEventListener("click",this.clicknext),1==a&&this.dangers<1&&(this.instructionset=2),this.inintro=!0,this.instructionset){case 1:this.panel.showplinkscreen("avoid"),this.panel.nextbutton.removeEventListener("click",this.clicknext),this.panel.nextbutton.addEventListener("click",this.clicknext),app.playVO(app.config.game.INSTRUCTIONS.avoid.vo);break;case 2:this.panel.showplinkscreen("collect"),this.panel.nextbutton.removeEventListener("click",this.clicknext),this.panel.nextbutton.addEventListener("click",this.clicknext),this.goaltype="food","flock"==app.gameoptions.settings.goal.collect.what?this.goaltype="flock":"nest"==app.gameoptions.settings.goal.collect.what&&(this.goaltype="nest");var b=this.goaltype;this.speedround&&(b="time_"+b),app.playVO(app.config.game.INSTRUCTIONS.collect.vo[b]);break;case 3:this.panel.hideplinkscreen(),this.startgame(),this.inintro=!1,this.takeclicks(),this.nextjit()}},y.clicknext=function(a){this.showinstructions(this.instructionset+1)},y.hideinstructions=function(){this.inintro=!1,this.panel.hideplinkscreen()},y.showjit=function(){if(!(app.jitstate>3)){this.stop();var a=app.jitstate;this.noclicks();var b=this;switch(this.timing=app.setTimeout(b.takeclicks,300),a){case 1:this.injit=!0,this.panel.showjit(a),app.jitstate=3;break;case 2:this.injit=!0,this.panel.addpointer(new q(this.jititem.view.x,this.jititem.view.y),"Collect"),this.jititem=null;break;case 3:this.injit=!0,this.panel.addpointer(new q(this.jititem.view.x,this.jititem.view.y),"Beware"),this.jititem=null}}},y.nextjit=function(){this.panel.hidejit(),this.jititem=null,app.jitstate=Math.min(4,app.jitstate+1);var a=this;switch(this.injit=!1,app.jitstate){case 1:app.history[this.options.settings.presetid].m?app.jitstate=4:(this.timing=app.setTimeout(a.showjit,50),app.history[this.options.settings.presetid].m=!0);break;case 2:this.timing=app.setTimeout(a.showcollection,3e3);break;case 3:this.timing=app.setTimeout(a.activateenemies,4e3);break;case 4:this.timing=app.setTimeout(a.activateenemies,4e3)}},y.startgame=function(){app.startgame(),C=0,this.gamerunning=!0,this.hideinstructions(),this.start(),this.panel.showpausebutton()},y.goteaten=function(a){var b=new v(a);b.name=this.options.getnameforitem(a),WGBH.Util.MakeIcon(b,this.options.settings),this.gameover(!1,b)},y.gameover=function(a,b){if(this.stop(),this.panel.hidepause(),this.panel.showpausebutton(!1),this.gamerunning=!1,a){var c="default";0===this.collected?c="none":this.speedround&&(c="some"),this.panel.showgameover(this.score,b,!0,this.collected,this.speedround),app.playSFX(app.config.game.GAMEOVER.win.sfx),app.playVO(app.config.game.GAMEOVER.win.vo[this.goaltype][c]),app.scorepoints(this.score)}else this.panel.showgameover(this.score,b),app.playSFX(app.config.game.GAMEOVER.lose.sfx),app.playVO(app.config.game.GAMEOVER.lose.vo);this.panel.replay.removeEventListener("click",this.startover),this.panel.replay.addEventListener("click",this.startover),this.panel.change.removeEventListener("click",this.clickchange),this.panel.change.addEventListener("click",this.clickchange),this.panel.exit.removeEventListener("click",this.clickexit),this.panel.exit.addEventListener("click",this.clickexit)},y.gamewon=function(){var a=new v(this.player.animal);WGBH.Util.MakeIcon(a,this.options.settings),this.gameover(!0,a)},y.clickchange=function(a){this.changeoptions()},y.setgame=function(){this.score=0,this.items=[],this.flock=[],this.enemies=[],this.foods=[],this.barriers=[],this.scenery=[];var b,c,d,e,f;if(this.places={},this.collected=0,this.goal=this.options.settings.goal,this.enemyconf=g.ENEMY,this.preyconf={flee:g.PREY.flee,repel:g.PREY.repel,repelx:g.PREY.repelx,repely:g.PREY.repely},this.compare=g.FLOCK.clone(),this.compare.min2=this.compare.min*this.compare.min,this.compare.max2=this.compare.max*this.compare.max,this.player=new v("player"),this.player.setCamera(this.cam),this.options.settings.player.spritesheet){var h=WGBH.Util.SpritesheetClone(app.config.spritesheets[this.options.settings.player.spritesheet]);this.player.setSprite(this.options.settings.player.image,h)}else this.player.setImage(this.options.settings.player.image);this.player.setDistance(this.options.settings.game.ITEMDISTANCE),this.player.speed=this.options.getadjustedspeed(this.options.settings.player.speed,"player"),this.player.animal=this.options.settings.player.animal,this.options.setmovement(this.player,this.options.settings.player.movementtype);var i;i=this.options.settings.range?this.options.gettopandbottomforrange(this.options.settings.range):this.options.gettopandbottomforid(this.player.animal),this.player.top=i.top+this.options.extratopforid(this.player.animal),this.player.bottom=i.bottom+this.options.extrabottomforid(this.player.animal),this.options.setaction(this.player,this.options.settings.player.actiontype),this.cam.offset=new q(g.CAMERA.offset.x,g.CAMERA.offset.y),this.player.movement.cam&&(this.cam.offset=new q(this.player.movement.cam.x,this.player.movement.cam.y)),this.cam.min=this.options.settings.cam.min,this.cam.max=this.options.settings.cam.max,this.player.makecollidable(this.options.settings.ITEMS[this.player.animal].target);var j=this.randompointinframe(this.options.getframe(this.player.animal));this.options.settings.start&&(j={x:0,y:this.options.settings.start.y}),this.player.setStack(-10),this.player.pos=new q(0,j.y),this.cam.pos=new q(0,j.y),this.cam.follow(this.player),this.player.foodscores={},this.flock.push(this.player);this.sky=new p(images[this.options.settings.scene.sky.image]),this.sky.stack=1e7,this.panel.addtoworld(this.sky);var k=[];k=k.concat(this.options.settings.backgrounds),k=k.concat(this.options.settings.scene.backgrounds);for(var l in k){var m=k[l],n=m.dist;for(var o in m.items){var r=m.items[o];if("panel"!=r.type)for(d=this.options.getframe(r.id),e=0;e<r.num;e++)f=this.setgamepiece(r.id),f.type="bg",f.setDistance(n),f.setpos(f.pos.x/f.plx,f.pos.y/f.plx);else for(e=0;e<r.num;e++)f=r.filename?this.makepanel(r.filename,e):this.makepanel(r.id),f.setDistance(n),r.offsety&&f.setoffsety(r.offsety),f.panelwidth=r.num*this.options.settings.game.PANELWIDTH,f.setpos(e*this.options.settings.game.PANELWIDTH/f.plx,0),f.draw()}}for(b in this.options.settings.scenery)this.placeobjects(this.options.settings.scenery[b],"scenery");for(b in this.options.settings.food)c=this.options.settings.food[b],this.player.foodscores[c.id]=parseInt(c.points),this.placeobjects(c,"food");for(b in this.options.settings.bar)this.placeobjects(this.options.settings.bar[b],"bar");for(b in this.options.settings.safe)this.placeobjects(this.options.settings.safe[b],"safe");var s=0;for(b in this.options.settings.flock)s+=this.placeobjects(this.options.settings.flock[b],"flock");this.panel.addtoworld(this.player.view),this.dangers=0;for(b in this.options.settings.pred){var t=this.placeobjects(this.options.settings.pred[b],"enemy");this.dangers=this.dangers+t}this.setaction(this.player.movetype,this.player.actiontype);var u=[];u=u.concat(this.options.settings.foregrounds),u=u.concat(this.options.settings.scene.foregrounds);for(var w in u){var x,y,z=u[w],A=z.dist;for(var B in z.items){var C=z.items[B];if(x=null,y=null,C.pos&&(x=C.pos.x,y=C.pos.y),C.type&&"panel"==C.type)for(e=0;e<C.num;e++)f=C.filename?this.makepanel(C.filename,e):this.makepanel(C.id),f.setDistance(A),f.panelwidth=C.num*this.options.settings.game.PANELWIDTH,y?(y<f.top&&(f.top=y),y>f.bottom&&(f.bottom=y)):y=f.pos.y,f.setpos(e*this.options.settings.game.PANELWIDTH/f.plx,y),f.draw();else for(d=this.options.getframe(C.id),e=0;e<C.num;e++)f=this.setgamepiece(C.id),f.type="fg",y||x?(y?(y<f.top&&(f.top=y),y>f.bottom&&(f.bottom=y)):y=f.pos.y,x||(x=f.pos.x),f.setpos(x,y)):(f.bottom+=g.CAMERA.foreground.y,f.setpos(f.pos.x,f.bottom)),f.setDistance(A),f.draw()}}if(this.options.settings.goalstatus.time?(this.speedround=!0,a=this.options.getadjustedtime(this.goal.time.limit),this.panel.showtimer(),this.options.settings.speedround=!0,this.options.settings.goaltarget=a,this.panel.updatetime(0,a)):(this.collectiongoal=this.options.getadjustedgoal(this.goal.collect.num),this.panel.updatecollect(0,this.collectiongoal),this.speedround=!1,this.options.settings.speedround=!1,this.options.settings.goaltarget=this.collectiongoal,this.panel.showtimer(),this.panel.updatecollect(0,this.collectiongoal)),"flock"==this.goal.collect.what){var D=this.options.getsettingsforitem(this.player.animal);this.player.addglow("flockhalo",D.glow)}this.panel.setspeedround(this.speedround),this.player.faceright(!0),this.player.draw(!0),this.update(60),this.panel.showworld()},y.makepanel=function(a,b){var c=a;void 0!==b&&(c=a+"_"+(1+b));var d=new w(c);return d.type="bgpanel",d.fixedpos={y:1},this.additem(d),d},y.placeobjects=function(a,b,c){if(a.num<1)return 0;var f=0;if(this.options.settings.itemstatus[a.id]===!1)return 0;var g=this.options.getframe(a.id);void 0!==a.points&&(this.player.foodscores[a.id]=parseInt(a.points)),g.x+=100,g.w-=100;var h=a.speed;void 0===a.speed&&(h=this.options.getbasespeed(a.id));var j,k,l,m=Date.now(),n=a.num;"enemy"==b&&(n=this.options.getadjustednumber(n,"pred"),0!==h&&(h=this.options.getadjustedspeed(h,"pred"))),("food"==b||"flock"==b||"collect"==b)&&(n=this.options.getadjustednumber(n,"collect"),0!==h&&(h=this.options.getadjustedspeed(h,"collect")));var o=!1,p=!1;if(h){h*=.8+.4*Math.random(),j=new q(-1*h,0);var r=this.options.getmovementforid(a.id);r.npc&&(r.npc.d.wave&&(o=r.npc.d.wave),r.npc.d.rotate&&(p=!0))}else j=new q(0,0);var s=this.options.settings.ITEMS[a.id];if(s||(s=this.options.settings.BACKGROUNDS[a.id]),s){var t=this.gethostid(a.id);if(t)for(d=0;d<n;d++){e=this.hostgamepiece(a.id,t),e.type=b,a.type&&(e.subtype=a.type),"scenery"==b?(e.setStack(10),"perch"==e.subtype&&e.makecollidable(s.target)):e.makecollidable(s.target),e.speed=h,"flock"==e.type,"enemy"==e.type&&(e.chased=m);var u=this.options.gettopandbottomforrange("full");e.top=u.top,e.bottom=u.bottom,e.basedir=j.clone(),e.setVel(j.x,j.y),a.pos&&(k=a.pos.x?a.pos.x:e.pos.x,l=a.pos.y?a.pos.y:e.pos.y,l<e.top&&(e.top=l),l>e.bottom&&(e.bottom=l),e.setpos(k,l)),f++}else for(d=0;d<n;d++){if(e=this.setgamepiece(a.id,g,null,a.range),e.type=b,a.type&&(e.subtype=a.type),"scenery"==b?(e.setStack(10),"perch"==e.subtype&&e.makecollidable(s.target)):e.makecollidable(s.target),0===d&&(e.watchme=!0),e.speed=h,"flock"==e.type,"enemy"==e.type&&(e.chased=m,e.disappear()),"away"==this.player.actiontype&&0===e.speed&&e.setDistance(parseInt(30*Math.random())),e.setVel(j.x,j.y),p&&(e.rotate=!0,e.rotateto(360*Math.random()),e.middley(!0)),o){e.wave=[],e.wavetime=0,e.wavechange=1;var v=o.mag*h*e.height,w=parseInt(o.steps*v);e.wavepos=parseInt(Math.random()*w);var x=parseInt(v*Math.sin(2*Math.PI*(w-1)/w));for(i=0;i<w;i++){var y=parseInt(v*Math.sin(2*Math.PI*i/w));e.wave.push(x-y),x=y}}e.basedir=j.clone(),a.pos&&(k=a.pos.x?a.pos.x:e.pos.x,l=a.pos.y?a.pos.y:e.pos.y,l<e.top&&(e.top=l),l>e.bottom&&(e.bottom=l),e.bottom+=this.options.extrabottomforid(e.id),e.setpos(k,l)),"perch"==e.subtype&&0===d&&(this.findspotfor(e,this.player.pos.x),this.player.perch=e),f++}return f}},y.findspotfor=function(a,b){if(void 0===b&&a.pos.x&&(b=a.pos.x),!this.places[a.id]){for(var c=[],d=a.width,e=parseInt(this.options.settings.game.fullwidth/d),f=0;e>f;f++){var g=f*d;c.push(g)}this.places[a.id]=c}var h=this.places[a.id];if(!(h.length<0)){var i=0;if(void 0!==b){var j=1e6;for(var k in h){var l=h[k]-b;j>l*l&&(i=k,j=l*l)}}else i=parseInt(Math.random()*h.length);a.setpos(h[i],a.pos.y),this.places[a.id].splice(i,1)}},y.findspotfor_random=function(a){for(var b=!1,c=50,d=!1;!b;){c--,0>=c&&(b=!0),d=!1;for(var e in this.items)if(this.items[e].id==a.id){var f=this.overlap(a,this.items[e]);if(f){d=!0,a.setpos(a.pos.x+f.x,a.pos.y+f.y);break}}d||(b=!0)}},y.gethostid=function(a){var b=this.options.settings.ITEMS[a];if(b||(b=this.options.settings.BACKGROUNDS[a]),!b)return null;if(!b.placement||!b.placement.items)return null;var c=b.placement.items[parseInt(Math.random()*b.placement.items.length)];return c},y.setgamepiece=function(a,b,c,d){var e=new v(a),f=this.options.settings.ITEMS[a];if(f||(f=this.options.settings.BACKGROUNDS[a]),!f)return null;if(f.spritesheet){var g=WGBH.Util.SpritesheetClone(app.config.spritesheets[f.spritesheet]);e.setSprite(f.image,g),e.loop(Math.random())}else e.setImage(f.image);var h;h=d?this.options.gettopandbottomforrange(d):this.options.gettopandbottomforid(a),e.top=h.top,e.bottom=h.bottom,e.bottom+=this.options.extrabottomforid(e.id),c?e.setpos(c.x,c.y):(d&&(b={x:0,y:h.top,w:this.options.settings.game.fullwidth,h:h.top+h.bottom}),b||(b=this.options.getframe(a)),c=this.randompointinframe(b),e.setpos(c.x,c.y),this.findspotfor(e));var i=this.options.getmovementforid(a);e.vert=1==i.vert?1:0;var j=f.containing;return j&&(e.spotsleft=e.spotsleft.concat(j[parseInt(Math.random()*j.length)]),e.carrying=[]),e.setDistance(this.options.settings.game.ITEMDISTANCE),this.additem(e),e},y.findhost=function(a){for(var b in this.items)if(this.items[b].id==a&&this.items[b].spotsleft.length>0)return this.items[b];return null},y.hostgamepiece=function(a,b){h=this.findhost(b);var c;if(!h){h=this.setgamepiece(b),h.setStack(10);var d=this.options.getbasespeed(b);d*=.8+.4*Math.random();var e=this.options.getbasevel(b);h.setVel(e.x,e.y),
h.basedir=e.clone(),h.speed=d}var f=h.getfreespot();f?(c=this.setgamepiece(a,null,new q(f.x+h.pos.x,f.y+h.pos.y)),h.carrying.push(c),c.localpos=new q(f.x,f.y),f.r&&c.rotateto(f.r)):c=this.setgamepiece(a);var g=this.options.gettopandbottomforrange("full");return c.top=g.top,c.bottom=g.bottom,c.setDistance(h.z),c},y.additem=function(a,b){a.setCamera(this.cam),this.items.push(a),a.draw(),this.panel.addtoworld(a.view,b)},y.randompointinframe=function(a){var b={x:a.x+Math.random()*a.w,y:a.y+Math.random()*a.h};return b},y.setaction=function(a,c){var d=function(a){this.airborne||this.doForce(this.defaultforce,a)},e=this;switch(this.player.noaction=d,a){case"dig":this.player.noaction=d,this.player.facemv=!0,this.player.digger=!0,this.player.digoffset=this.options.extratopforid(this.player.animal),this.player.middley(!0),this.holelayer=this.panel.addlayertoworld("holelayer",500),this.dighole=new v("hole"),this.dighole.setImage("tunnel"),this.dighole.setDistance(0),this.dighole.setStack(2),this.dighole.lastsound=0,this.additem(this.dighole),this.player.setpos(this.player.pos.x,this.player.pos.y+this.player.digoffset),this.lasthole=new q(0,0),this.player.plaintarget=this.options.settings.ITEMS[this.player.animal].target,this.player.setHitarea(new r(this.player.plaintarget.x,this.player.plaintarget.y-this.player.digoffset,this.player.plaintarget.width,this.player.plaintarget.height));break;case"swim":this.player.swimmer=!0,this.player.nextbubble=90;break;case"hop":this.player.noaction=function(a){this.airborne||(this.doForce(this.defaultforce,a),this.airborne=!0,this.mayfall=!0)}}var f=function(a){this.tact+=a,this.tact>=this.endt,this.doForce(this.actionforce,a)},g=function(){this.doForce(this.initialforce)},h=function(){this.endforce&&this.doForce(this.endforce),this.endact()};switch(this.player.startaction=g,this.player.action=f,this.player.release=h,c){case"slidejump":this.player.release=function(){this.endforce&&this.doForce(this.endforce),this.airborne=!0,this.mayfall=!0,this.endact()},this.player.noaction=function(a){this.airborne||this.doForce(this.defaultforce,a)};break;case"jump":this.options.settings.special&&this.options.settings.special.jump&&(this.options.settings.special.jump.s&&(this.player.initialforce=this.options.settings.special.jump.s.f),this.options.settings.special.jump.c&&(this.player.actionforce=this.options.settings.special.jump.c.f)),this.player.startaction=function(){this.airborne=!0,this.mayfall=!0,this.unreleased=!0,this.doForce(this.initialforce,null,!0)},this.player.release=function(){this.unreleased=!1},this.player.action=function(a){return this.tact+=a,this.airborne?void(this.unreleased&&this.tact<this.endt&&this.doForce(this.actionforce,a,!0)):void this.endact()};break;case"flutter":this.player.startaction=function(){this.airborne=!0,this.mayfall=!0,this.unreleased=!0,this.setAnimation("_fly"),this.doForce(this.initialforce,null,!0)},this.player.release=function(){this.unreleased=!1},this.player.action=function(a){return this.tact+=a,this.airborne?void(this.unreleased&&this.tact<this.endt&&this.doForce(this.actionforce,a,!0)):(this.setAnimation(""),void this.endact())};break;case"slideglide":this.player.slowgr=this.options.settings.special.gr,this.player.glidebottom=this.options.settings.special.bottom,this.player.bottom+=100,this.player.perchtarget=this.options.settings.ITEMS[this.player.animal].perchtarget,this.player.plaintarget=this.options.settings.ITEMS[this.player.animal].target,this.player.perched=function(){this.stopx=null,this.setVel(0,0),this.safe=!0,this.airborne=!1,this.mayfall=!1,this.rotateto(270),this.setHitarea(this.perchtarget)},this.player.release=function(){this.airborne?this.gr=this.slowgr:(this.setAnimation(""),this.safe=!1,this.doForce(this.endforce),this.airborne=!0,this.mayfall=!0,this.facemv=!0,this.gr=1,this.setHitarea(this.plaintarget)),this.endact()},this.player.noaction=function(a){this.airborne?(this.mv.y>0&&(this.gr=this.slowgr),this.pos.y>=this.glidebottom&&(this.setpos(this.pos.x,this.glidebottom),this.setVel(this.mv.x,0))):(this.climbing=!1,this.doForce(this.defaultforce,a))},this.player.action=function(a){this.airborne?(this.gr=1,this.pos.y>=this.glidebottom&&(this.setpos(this.pos.x,this.glidebottom),this.setVel(this.mv.x,0))):this.doForce(this.actionforce,a)},this.player.startaction=function(){this.airborne?this.gr=1:this.setAnimation("_climb")},this.player.perched();break;case"glide":this.player.slowgr=this.options.settings.special.gr,this.player.glidebottom=this.options.settings.special.bottom,this.player.noaction=function(a){this.airborne?(this.mv.y>0&&(this.gr=this.slowgr),this.pos.y>=this.glidebottom&&this.setpos(this.pos.x,this.glidebottom)):this.doForce(this.defaultforce,a)},this.player.startaction=function(){this.airborne=!0,this.mayfall=!0,this.gr=1,this.doForce(this.initialforce)},this.player.action=function(a){return this.tact+=a,this.airborne?void(this.unreleased&&this.tact<this.endt&&this.doForce(this.actionforce,a,!0)):void this.endact()};break;case"none":this.player.action=function(a){},this.player.startaction=function(){};break;case"sineswoop":this.player.setreg(0,this.player.height*-.5),this.player.topy=this.options.settings.special.topy,this.player.bottomy=this.options.settings.special.bottomy,this.player.swoopdepth=this.options.settings.special.bottomy-this.options.settings.special.topy,this.player.loop(),this.player.startaction=function(){this.facemv=!0,this.didrelease=!1,this.beginpoint=new q(this.pos.x,this.pos.y),this.bottompoint=new q(this.pos.x+this.swoopwidth,this.bottomy),this.dxfactor=100*this.swoopdepth/this.endt},this.player.release=function(){this.didrelease=!0},this.player.action=function(a){if(this.tact+=a,this.tact>=this.endt&&this.pos.y<=this.topy)return this.pos.y=this.topy,void(this.didrelease?(this.doForce({x:this.defaultforce.x,y:this.defaultforce.y,type:"v"}),this.endact()):this.noaction());var b=this.tact/this.endt,c=Math.sin(b*Math.PI*2),d=this.speed+4*Math.sin(b*Math.PI),e={x:d,y:c*this.dxfactor,type:"v"};this.doForce(e,a,!0)};break;case"swoop":this.player.setreg(0,-1*this.player.height),this.player.topy=this.options.settings.special.topy,this.player.bottomy=this.options.settings.special.bottomy,this.player.swoopdepth=this.options.settings.special.bottomy-this.options.settings.special.topy,this.player.swoopwidth=50,this.player.noaction=function(a){this.doForce(this.defaultforce,a)},this.player.startaction=function(){this.facemv=!0,this.didrelease=!1,this.beginpoint=new q(this.pos.x,this.pos.y),this.bottompoint=new q(this.pos.x+this.swoopwidth,this.bottomy)},this.player.release=function(){this.didrelease=!0},this.player.action=function(a){if(this.tact+=a,this.tact>=this.endt)return void(this.didrelease?(this.doForce({x:this.defaultforce.x,y:this.defaultforce.y,type:"v"}),this.endact()):this.noaction());var b=this.tact/this.endt,c=b-.5;c*=20;var d=20*a/this.endt,e=-2*c*this.swoopdepth/100,f={x:d*this.speed,y:e*d,type:"v"};this.doForce(f,a,!0)};break;case"dive":this.player.release=function(){this.goingup&&this.endact(),this.didrelease=!0},this.player.topy=this.options.settings.special.topy,this.player.bottomy=this.options.settings.special.bottomy,this.player.trypos(this.player.pos.x,this.player.topy),this.player.upforce=this.player.actionforce.clone(),this.player.straightforce=this.player.upforce.clone(),this.player.upforce.y*=-1,this.player.straightforce.y*=0,this.player.noaction=function(a){!this.topy||this.pos.y<=this.topy?(this.doForce(this.straightforce,a),this.trypos(this.pos.x,this.topy)):this.doForce(this.upforce,a)},this.player.startaction=function(){this.facemv=!0,this.didrelease=!1,this.goingup=!1,this.doForce(this.initialforce)},this.player.action=function(a){return this.goingup?this.didrelease?void this.endact():this.pos.y>this.topy?void this.doForce(this.upforce,a):(this.doForce(this.straightforce,a),void this.trypos(this.pos.x,this.topy)):void(this.pos.y>=this.bottomy&&(this.goingup=!0,this.doForce(this.upforce,a)))};break;case"updown":this.player.topy=this.options.settings.special.topy,this.player.topy<this.player.top&&(this.player.top=this.player.topy),this.player.bottomy=this.options.settings.special.bottomy,this.player.bottomy>this.player.bottom&&(this.player.bottom=this.player.bottoy),this.player.drop=!0,this.player.trypos(this.player.pos.x,this.player.topy),this.player.startaction=function(){this.airborne=!0,this.mayfall=!1,this.unreleased=!0;var a;this.drop?(this.mayfall=!1,a={type:"v",x:this.initialforce.x,y:-1*this.initialforce.y},this.drop=!1):(this.doSpecial(),this.mayfall=!1,a={type:"v",x:this.initialforce.x,y:this.initialforce.y},this.drop=!0),this.doForce(a,null,!0)},this.player.release=function(){this.unreleased=!1},this.player.action=function(a){return this.tact+=a,this.drop&&this.pos.y<=this.topy?(this.airborne=!1,this.trypos(this.pos.x,this.topy)):!this.drop&&this.pos.y>=this.bottomy&&(this.airborne=!1,this.trypos(this.pos.x,this.bottomy)),this.airborne?void 0:(this.mayfall=!1,this.doForce({type:"v",x:this.defaultforce.x,y:0}),void this.endact())};break;case"hide":this.player.startaction=function(){this.hiding=!0,this.safe=!0,this.doForce(this.initialforce)},this.player.action=function(a){return this.tact+=a,this.tact>=this.endt?(this.hiding=!1,b||(this.safe=!1),void this.endact()):void this.doForce(this.actionforce,a)};break;case"drop":this.player.dropping=this.options.settings.special.drop,this.player.targets=this.options.settings.special.targets,this.missiles=[],this.player.dodrop=function(){e.adddropping(this.dropping,this.targets)},this.player.startaction=function(){this.dodrop(),this.doForce(this.initialforce)};break;case"defend":this.player.specialtarget=this.options.settings.ITEMS[this.player.animal].specialtarget,this.player.plaintarget=this.options.settings.ITEMS[this.player.animal].target,this.player.startaction=function(){this.defending=!0,this.safe=!0,this.doSpecial(),this.doForce(this.initialforce)},this.player.action=function(a){return this.tact+=a,this.tact>=this.endt?(this.defending=!1,void this.endact()):void this.doForce(this.actionforce,a)};break;case"attack":this.player.specialtarget=this.options.settings.ITEMS[this.player.animal].specialtarget,this.player.plaintarget=this.options.settings.ITEMS[this.player.animal].plaintarget,this.player.setHitarea(this.player.plaintarget),this.player.release=function(){this.attacking=!1,this.norelease=!1,this.specialtarget&&this.setHitarea(this.plaintarget),this.endact()},this.player.startaction=function(){return this.norelease?void this.endact():(this.attacking=!0,this.norelease=!0,this.doSpecial(),this.specialtarget&&this.setHitarea(this.specialtarget),void this.doForce(this.initialforce))},this.player.action=function(a){return this.tact+=a,this.tact>=this.endt?(this.attacking=!1,this.specialtarget&&this.setHitarea(this.plaintarget),void this.endact()):void this.doForce(this.actionforce,a)};break;case"gotopoint":this.player.startaction=function(){var a=new q(this.pos.x+100,this.pos.y-20),b=new q(a.x-this.pos.x,a.y-this.pos.y);b.truncate(this.speed);var c={a:{x:b.x,y:b.y}};this.doForce(c),this.noaction=function(a){this.doForce(c,a)}},this.player.noaction=function(a){},this.player.action=function(a){this.endact()};break;case"special":break;case"away":this.player.noaction=function(a){this.setDistance(Math.max(0,this.z-1)),this.doForce(this.actionforce,a)},this.player.action=function(a){return this.tact+=a,this.tact>=this.endt?void this.endact():(this.setDistance(Math.min(20,this.z+1)),void this.doForce(this.actionforce,a))};break;case"reverse":this.player.changeforce=this.player.defaultforce,this.player.impulse={type:"v",x:0,y:0},this.player.startaction=function(){if(this.changeforce.r){for(var a in this.changeforce.r)this.changeforce[this.changeforce.r[a]]*=-1;this.impulse.y=this.changeforce.y,this.impulse.x=this.changeforce.x}this.doForce(this.impulse)},this.player.action=function(a){return this.tact+=a,this.tact>=this.endt?void this.endact():void 0}}},y.updateflock=function(){var a,b,c,d,e,f,g,h,i;for(var j in this.flock)if(d=this.flock[j],d!=this.player){e=new q(0,0),i=new q(0,0),e.add(this.player.pos),h=new q(0,0),c=new q(d.mv.x,d.mv.y),b=1,ncount=0;for(var k in this.flock)if(a=this.flock[k],a!=d){b++,e.add(a.pos),f=new q(d.pos.x-a.pos.x,d.pos.y-a.pos.y);var l=f.lengthSq();if(l<this.compare.max2&&(h.add(a.mv),i.add(a.pos),ncount++,l<this.compare.min2)){f.normalize();var m=(this.compare.min2-l)/this.compare.min2;f.scaleBy(m),f.scaleBy(this.compare.localspread),c.add(f)}if(b>24)break}e.scaleBy(1/b),g=new q(e.x-d.pos.x,e.y-d.pos.y),g.scaleBy(this.compare.grouppos),c.add(g),ncount>0&&(h.scaleBy(1/ncount),h.scaleBy(this.compare.localvel),c.add(h),i.scaleBy(1/ncount),dlpos=new q(i.x-d.pos.x,i.y-d.pos.y),dlpos.scaleBy(this.compare.localpos),c.add(dlpos)),c.truncate(1.5*d.speed),d.setVel(c.x,c.y)}},y.removefromflock=function(a){for(var b in this.flock)if(this.flock[b]==a)return a.speed=a.preflockspeed,a.inflock=!1,this.flock.splice(b,1),a.setVel(a.basedir.x,a.basedir.y),this.collected=this.flock.length-1,void this.updatecollected()},y.addtoflock=function(a){a.disappear();for(var b in this.flock)if(this.flock[b]==a)return;var c=this.setgamepiece(a.id,null,{x:a.pos.x,y:a.pos.y});c.makecollidable(a.hitspot),c.checkcollide=!1,c.inflock=!0,a.preflockspeed=a.speed,c.speed=1.1*this.player.speed,this.flock.push(c),this.getpoints(c),this.collected=this.flock.length-1,this.updatecollected()},y.flockdistance=function(a,b){if(a==b)return new q(0,0);var c=new q(a.pos.x-b.pos.x,a.pos.y-b.pos.y),d=c.lengthSq();if(d<this.compare.min2){var e=new q(c.x,c.y);return e}if(d>this.compare.max2){var f=new q(-1*c.x,-1*c.y);return f}return new q(0,0)},y.repelenemy=function(a,b){if(a.chasing=!1,!b){var c=this.runaway(a,this.enemyconf.repel);c.truncate(1*a.speed),a.doForce({f:{x:c.x,y:c.y*a.vert}})}a.fleeing=this.enemyconf.flee+Math.random()*this.enemyconf.flee*2,a.chased=a.chased+this.enemyconf.time2},y.scatterprey=function(a){if(!(a.fleeing>0)){var b=this.runaway(a,this.preyconf.repel);b.truncate(.6*a.speed),a.doForce({type:"f",x:b.x,y:b.y*a.vert}),a.fleeing=this.preyconf.flee+Math.random()*this.preyconf.flee*2}},y.runaway=function(a,b){var c,d=a.findDistance(this.player);return d.x<0?(c=-1*b+-1*d.x,d.x=Math.min(c,0)):(c=b-d.x,d.x=Math.max(c,0)),d.y<=0?(c=-1*b+-1*d.y,d.y=Math.min(c,0)):(c=b-d.y,d.y=Math.max(c,0)),d},y.collidewithflockitem=function(a,b){if(this.collide(a,b)){if("food"!=b.type||a.safe||a.defending)if("enemy"!=b.type||b.ate){if("bar"==b.type)if(a==this.player&&a.airborne&&a.mv.y<0);else{var c=this.getoverlap(a.target,b.target);a.pushback(c)}else if("flock"==b.type&&a==this.player)this.addtoflock(b);else if("perch"==b.subtype&&b!=a.perch){var d=b.pos.x-this.player.pos.x;a==this.player&&a.airborne&&(a.perch=b,d>0?a.stopx=b.pos.x:(a.setpos(b.pos.x,a.pos.y),a.perched()))}}else a!=this.player?(this.removefromflock(a),b.ate=!0,a.disown=!0,this.repelenemy(b)):this.player.safe?this.player.defending&&this.repelenemy(b):this.goteaten(b.id);else"loc"==b.subtype?b.disappear(!0):b.disappear(),this.collected++,this.getpoints(b),this.updatecollected();this.checkgoal()}},y.collidewithmissile=function(a,b){if(!b.targeted)for(var c in a.targets)b.id==a.targets[c]&&(b.cancollide=!0,this.collide(a,b)&&(b.targeted=!0,this.getpoints(b)),b.cancollide=!1)},y.updatecollected=function(){this.speedround||this.panel.updatecollect(this.collected,this.collectiongoal)},y.checkgoal=function(){if(!this.speedround){if("flock"==this.goal.collect.what&&this.flock.length>this.collectiongoal)return this.collected=this.flock.length-1,void this.gamewon();if(this.collected>=this.collectiongoal)return void this.gamewon()}},y.ticktimer=function(){C++,this.speedround&&(this.panel.updatetime(C,a),C>=a&&this.gamewon())},y.showcollection=function(){"flock"==this.goal.collect.what?this.watchforitem("flock"):this.watchforitem("food")},y.activateenemies=function(){if(!(this.dangers<1)){var a=this.player.pos.x+app.config.game.FRAME.w;for(var b in this.items){var c=this.items[b];"enemy"==c.type&&c.pos.x>a&&(c.appear(),c.active=!0,c.chasetime=1*this.enemyconf.time,c.chasechecks=1*this.enemyconf.checks)}this.watchforitem("enemy")}},y.watchforitem=function(a){var b,c=1e8;this.jititem=null;for(var d in this.items){var e=this.items[d];if(e.type==a&&e.show){var f=e.pos.x-this.player.pos.x;f>0&&c>f&&(b=e,c=f)}}this.jititem=b},y.update=function(a){if(B+=a,A+=a,z+=a,!(j>=B)){var d=B%j;B=j;var e={x:f.x*B*this.player.gr,y:f.y*B*this.player.gr},g=!1;if(z>=k&&(z=0,g=!0),A>=1e3&&(A=0,this.ticktimer()),b?this.player.act():c&&(c=!1,this.player.release&&this.player.release()),this.player.acting?this.player.action&&this.player.action(B):(this.player.safe=!1,this.player.noaction&&this.player.noaction(B)),this.player.mayfall&&this.player.addVel(e),this.player.move(B),this.player.stopx&&this.player.pos.x>=this.player.stopx&&(this.player.setpos(this.player.stopx,this.player.pos.y),this.player.perched()),this.player.pos.x>this.options.settings.game.fullwidth){var h=this.options.settings.game.fullwidth;this.player.trypos(this.player.pos.x-h,this.player.pos.y),this.cam.shiftpos(-1*h,0);for(var i in this.items){var l=this.items[i];l.setpos(l.pos.x-h,l.pos.y)}}this.cam.follow(this.player),this.updateflock();var m,n=this.options.settings.game.FRAME.w,o=(this.options.settings.game.fullwidth-this.options.settings.game.FRAME.w,this.player.updatez);for(var p in this.items){if(m=this.items[p],m.destination&&m.gotopoint(m.destination),m.mayfall&&m.mv.add(e),"enemy"==m.type&&0!==m.speed&&m.active){var q,r=!1,s=!1;if(m.chasing?this.player.safe?r=!0:Date.now()-m.chased>m.chasetime&&(q=this.player.findDistance(m,!0),m.chasecount--,m.chasecount<=0?(r=!0,m.chasecount=m.chasechecks):q.x*q.x<this.enemyconf.hdist&&(s=!0)):this.player.safe||(q=this.player.findDistance(m,!0),q.x*q.x<this.enemyconf.hdist&&Date.now()-m.chased>m.chasetime&&(s=!0,m.chasecount=m.chasechecks)),r)m.chasing=!1,this.repelenemy(m,!0);else if(s)m.chasing=!0,m.chased=Date.now(),m.godirection(q),m.ate=!1;else if(!m.chasing){m.fleeing;m.fleeing--,m.fleeing<=0&&m.accelTo(m.basedir,a)}}if("food"==m.type&&0!==m.speed&&(m.fleeing>0?(m.fleeing--,m.fleeing<=0&&m.setVel(m.basedir.x,m.basedir.y)):m.accelTo(m.basedir,a),this.player.attacking&&this.scatterprey(m)),m.move(B),m.lifetime&&(m.lifetime-=B,m.lifetime<1&&(m.lifetime=null,m.disown=!0)),m.checkcollide){for(var t in this.flock)this.collidewithflockitem(this.flock[t],m);for(var u in this.missiles)this.collidewithmissile(this.missiles[u],m)}if("pointbubble"!=m.id&&(this.cam.pos.x-m.pos.x)*m.plx>=n&&(m.nowrap?m.disown=!0:("enemy"==m.type&&(m.ate=!1),0!==m.plx?"bgpanel"==m.type?m.setpos(m.pos.x+m.panelwidth/m.plx,m.pos.y):m.setpos(m.pos.x+this.options.settings.game.fullwidth/m.plx,m.pos.y):m.setpos(m.pos.x+this.options.settings.game.fullwidth,m.pos.y),m.appear())),m.carrying&&0!==m.vel)for(var v in m.carrying){var w=m.carrying[v];w.setpos(m.pos.x+w.localpos.x,m.pos.y+w.localpos.y)}if(m.disown){if(this.panel.removefromworld(m),this.items.splice(p,1),"flock"==m.type){var x=0;for(var y in this.flock)m==this.flock[y]&&(x=y);this.flock.splice(x,1)}if("missile"==m.type){var C=0;for(var D in this.missiles)m==this.missiles[D]&&(C=D);this.missiles.splice(C,1)}}else m.draw(g);m.updatez&&(o=!0,m.updatez=!1)}this.player.digger&&this.player.pos.y>this.player.top&&this.addhole(),this.player.swimmer&&(this.player.nextbubble--,this.player.nextbubble<=0&&(this.addbubble(),this.player.nextbubble=80*Math.random())),o&&(this.panel.restack(),this.player.updatez=!1),this.player.draw(g),this.jititem&&this.jititem.pos.x-this.player.pos.x<450&&this.jititem.pos.x-this.player.pos.x>0&&this.showjit(),B=d}},y.adddropping=function(a,b){var c=new v(a);c.setImage(a),c.setDistance(0),c.setpos(this.player.pos.x,this.player.pos.y),c.nowrap=!0,c.makecollidable(),c.type="missile",c.targets=b,this.missiles.push(c),c.bottom=app.config.game.ZONES.ground,c.pos.y<app.config.game.ZONES.ground&&(c.airborne=!0,c.mayfall=!0,c.freefall=!0,c.mv.x=this.player.mv.x),this.additem(c)},y.addhole=function(){var a=this.lasthole.x-this.player.pos.x,b=this.lasthole.y-this.player.pos.y,c=this.dighole.height/2,d=this.player.pos.y+c,e=this.player.pos.x,f=!1;if(this.player.pos.y<app.config.game.ZONES.ground+this.dighole.height){f=!0;var g=this.dighole.height-(d-app.config.game.ZONES.ground);this.dighole.b.sourceRect=new r(0,g,this.dighole.width,this.dighole.height-g),this.dighole.setpos(e,d+g)}else this.dighole.b.sourceRect=new r(0,0,this.dighole.width,this.dighole.height),this.dighole.setpos(e,d);this.dighole.draw();var h=a*a+b*b;if(h>200){this.dighole.lastsound--,(this.dighole.lastsound<0||h>1e3)&&(this.dighole.lastsound=5);var i=new v("hole");i.setImage("tunnel"),i.setDistance(0),i.setStack(5),i.nowrap=!0,i.b.sourceRect=this.dighole.b.sourceRect,this.lasthole.x=this.player.pos.x,this.lasthole.y=this.player.pos.y,i.setpos(this.dighole.pos.x,this.dighole.pos.y),i.updatez=!1,this.additem(i,"holelayer")}},y.addbubble=function(){var a=new v("airbubble");a.setImage("airbubble"),a.setDistance(0),a.nowrap=!0,a.lifetime=2e3*Math.random(),a.setScale(Math.random()+.15),a.setpos(this.player.pos.x,this.player.pos.y),a.updatez=!1,a.setVel(0,-5*Math.random()),this.additem(a)},y.getpoints=function(a){var b=this.player.foodscores[a.id],c=new u,d={x:a.pos.x,y:a.pos.y+a.cam.horizon};for(var e in this.items)if("pointbubble"==this.items[e].id){var f=new q(this.items[e].pos.x-d.x,this.items[e].pos.y-d.y);f.lengthSq()<1e3&&(d.x-=f.x,d.y-=f.y)}c.getpoints(b,d),c.setVel(c.mv.x*this.player.speed,c.mv.y),c.setDistance(-1),this.additem(c),this.score+=b,c.nowrap=!0,app.playSFX(l)},y.overlap=function(a,b){if(a==b)return null;var c=new q(a.pos.x-b.pos.x,a.pos.y-b.pos.y),d=(a.radius+b.radius)*(a.radius+b.radius),e=c.lengthSq();if(e>d)return null;var f=a.width/2+b.width/2;if(c.x*c.x>f*f)return null;var g=c.x-f;return g=c.x<=0?c.x+f:f-c.x,new q(g+1,0)},y.collide=function(a,b){if(a==b)return!1;if(!b.cancollide||!a.cancollide)return!1;if(a.z!=b.z)return!1;var c=new q(a.vis.x-b.vis.x,a.vis.y-b.vis.y);if(c.y>0&&2*a.height<c.y)return!1;if(c.y<=0&&-2*b.height>c.y)return!1;var d=a.width+b.width;return c.x*c.x>d*d?!1:this.collidetargets(a,b)},y.collidetargets=function(a,b){var c=a.target,d=b.target,e=WGBH.Util.RectOverlap(c,d);return e?(a.fillHitarea("#ff0000",!0),b.fillHitarea("#ff0000",!0),!0):(a.fillHitarea("#ffff00",!0),b.fillHitarea("#ffff00",!0),!1)},y.getoverlap=function(a,b){var c=b.x-a.width-a.x;c>0&&(c=0);var d=a.x-(b.x+b.width);d>0&&(d=0);var e=b.y-a.height-a.y;e>0&&(e=0);var f=a.y-(b.y+b.height);f>0&&(f=0);var g=c,h=e;return d>c&&(g=d),f>e&&(h=f),h>g?g=0:h=0,g==d&&(g*=-1),h==f&&(h*=-1),{x:g,y:h}},y.released=function(){b&&(c=!0),b=!1},y.tapped=function(a){return this.inintro?(b=!1,c=!1,this.nextjit(),void this.startgame()):this.injit?(this.nextjit(),void this.resume()):(b=!0,void(c=!1))},y.exitStart=function(){this.timing&&this.timing.destroy(),app.stopVO(),app.loading.setval(0),this.panel.clickcatch.off("mousedown",this.mouseclick),this.panel.clickcatch.off("pressup",this.mouseup),app.keyboard.removeKeyDown("spacebar",this.tapped),app.keyboard.removeKeyUp("spacebar",this.released),this.cleargame()},namespace("WGBH").GameState=x}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.TitlePanel"),c=function(c){a.call(this,new b,c),this.onPlay=this.onPlay.bind(this)},d=extend(c,a);d.enterDone=function(){this.panel.playButton.addEventListener("click",this.onPlay),this.panel.background.addEventListener("click",this.onPlay),this.panel.background.cursor="pointer"},d.onPlay=function(){this.nextState()},d.exit=function(){app.loading.setval(0),this.panel.background.cursor=null,this.panel.background.removeEventListener("click",this.onPlay),this.panel.playButton.removeEventListener("click",this.onPlay)},namespace("WGBH").TitleState=c}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.WelcomePanel"),c=include("lib.PlumPuppet"),d=function(c){a.call(this,new b,c),this.onPlay=this.onPlay.bind(this)},e=extend(d,a);e.enterDone=function(){this.update=this.update.bind(this),this.plumdone=this.plumdone.bind(this),this.plum=new c,WGBH.Util.Position(this.plum.view,app.config.welcome.PLUM.frame),this.panel.addChild(this.plum.view),this.panel.skipintro.addEventListener("click",this.onPlay),this.plum.floataround(),this.plumsays(app.config.welcome.VO.welcome,this.plumdone),this.plum.goBlink(),this.plum.flipTopknot(),this.t=0,this.fr=1e3/24,app.off("update",this.update),app.on("update",this.update)},e.plumsays=function(a,b){this.plum.talking=!0,app.playVO(a,b)},e.plumdone=function(){this.plum.talking=!1,this.nextState()},e.update=function(a){this.t+=a,this.t<this.fr||(this.t=0,this.plum.talking&&(mouthframe=parseInt(4*Math.random()),this.plum.setMouth(mouthframe),this.plum.setMouth(mouthframe)),this.plum.update(a))},e.onPlay=function(){this.nextState()},e.exitStart=function(){this.plum.stopfloat(),app.loading.setval(0)},e.exit=function(){app.off("update",this.update),this.panel.skipintro.removeEventListener("click",this.onPlay)},namespace("WGBH").WelcomeState=d}(),function(){var a=include("springroll.easeljs.Button"),b=include("springroll.easeljs.SoundButton"),c=include("createjs.Text"),d=include("createjs.Rectangle"),e=include("createjs.Point"),f=include("createjs.Shape"),g=include("createjs.Bitmap"),h={Frame:function(a,b,c){a.x=b.x,a.y=b.y;var d,e,f,g;if(b.srcsize)f=b.srcsize.w,g=b.srcsize.h;else{if(!a.image)return;f=a.image.width,g=a.image.height}d=b.w/f,e=b.h/g,c&&(e>=d?e=d:d=e,d>1&&(d=e=1),a.x=b.x+(b.w-f*d)/2,a.y=b.y+(b.h-g*e)/2),a.scaleX=d,a.scaleY=e},Position:function(a,b){a.x=b.x,a.y=b.y},ScaleToFit:function(a,b,c){var d=Math.min(1,b/a.width),e=Math.min(1,c/a.height);a.view.scaleX=Math.min(e,d),a.view.scaleY=a.view.scaleX},Mutate:function(a,b){a.rotation=b.r,a.scaleX=b.sx,a.scaleY=b.sy},TwoframeButton:function(c,e){var f={image:images[c.id],priority:["down","over","up"],up:{src:new d(0,0,c.frame.w,c.frame.h)},over:{src:new d(0,c.frame.h,c.frame.w,c.frame.h)},down:{src:new d(0,c.frame.h,c.frame.w,c.frame.h)}};return e?new b(f):new a(f)},SelectButton:function(c,e){var f={image:images[c.id],priority:["selected","down","over","up"],up:{src:new d(0,0,c.frame.w,c.frame.h)},over:{src:new d(0,c.frame.h,c.frame.w,c.frame.h)},down:{src:new d(0,2*c.frame.h,c.frame.w,c.frame.h)},selected:{src:new d(0,2*c.frame.h,c.frame.w,c.frame.h)}};return e?new b(f):new a(f)},SpritesheetClone:function(a){var b=[];for(var c in a.images)b[c]=images[a.images[c].replace(".png","")];var d={images:b,frames:a.frames,animations:a.animations};return d},PrettyTime:function(a){var b=parseInt(a/60),c=a-60*b,d=b+":"+c.toPaddedString(2);return d},TitleCase:function(a){return a=a.replace(/-\w/g,function(a){return a.toUpperCase()}),a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1)})},Text:function(a,b,d){var e=app.config.game.TEXTSTYLES["default"],f=e.color,g=e.align,h=e.size,i=e.face,j=e.weight;if(b&&app.config.game.TEXTSTYLES[b]){var k=app.config.game.TEXTSTYLES[b];"undefined"!=typeof k.color&&(f=k.color),k.align&&(g=k.align),k.size&&(h=k.size),k.face&&(i=k.face),k.weight&&(j=k.weight)}d&&("undefined"!=typeof d.color&&(f=d.color),d.align&&(g=d.align),d.size&&(h=d.size),d.face&&(i=d.face),d.weight&&(j=d.weight));var l=j+" "+h+" "+i,m=new c(a,l,f);return m.textBaseline="middle",m.textAlign=g,m},BoxText:function(a,b){e||(e=0);var c=app.config.game.TEXTSTYLES[b];if(!c)return null;if(!c.box)return null;var e=c.box.margin?c.box.margin:0,g=c.box.bg,h=new f,i=a.getBounds(),j=new d(i.x-e,i.y-e,i.width+2*e,i.height+2*e);return void 0!==g&&null!==g&&h.graphics.beginFill(g),h.graphics.drawRect(j.x,j.y,j.width,j.height),h.graphics.endFill(),h},RectOverlap:function(a,b){var c=new e(a.x-b.x,a.y-b.y);return c.y>=0&&b.height<=c.y?!1:c.y<0&&-1*a.height>=c.y?!1:c.x>=0&&b.width<=c.x?!1:c.x<0&&-1*a.width>=c.x?!1:!0},GetAngle:function(a){var b;return b=0===a.x?a.y>0?.5*Math.PI:1.5*Math.PI:a.x<0?Math.atan(a.y/a.x)+Math.PI:Math.atan(a.y/a.x),0>b&&(b+=2*Math.PI),b},DiffAngle:function(a,b){var c=Math.acos(a.dotProd(b)),d=new e(a.y,-1*a.x),f=new e(a.x,a.y);f.subtract(b),f.normalize();var g=f.dotProd(d)<0?-1:1;return c*g},PointInFrame:function(a,b){var c=b.x,d=b.x+b.w,e=b.y,f=b.y+b.h;return a.x>c&&a.x<d&&a.y>e&&a.y<f},MakeIcon:function(a,b){var c=b.ITEMS[a.id];if(c||(c=b.BACKGROUNDS[a.id]),c.spritesheet){var d=this.SpritesheetClone(app.config.spritesheets[c.spritesheet]);a.setSprite(c.image,d)}else a.setImage(c.image);a.middley(!0)},SpriteFromSheet:function(a,b,c){var d;if("number"==typeof b)d=a.getFrame(b);else{var e=a.getAnimation(b);if(!e)return null;d=a.getFrame(e.frames[0])}return c||(c=new g(d.image)),c.sourceRect=d.rect,c}};namespace("WGBH").Util=h}(),function(){var a=include("WGBH.TitleState"),b=include("WGBH.GameState"),c=include("WGBH.WelcomeState"),d=include("WGBH.ChoiceState"),e=include("lib.Options"),f=include("springroll.Application"),g=include("lib.Transition"),h=include("springroll.Sound"),i=include("springroll.easeljs.EaselJSDisplay"),j=include("lib.Loading"),k=function(a,b){window.images[b.id]=a},l=new f({fps:30,name:"PlumNSFGame",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",preload:[{id:"plum_loader_bg",src:"assets/images/plum_loader_bg.png",complete:k},{id:"plinkloader",src:"assets/images/ui/plinkloader.png",complete:k}],display:i,displayOptions:{clearView:!0}});l.on("init",function(){this.animator.captions.mute=!0,this.control="keyboard","ontouchstart"in document.documentElement&&(this.control="touch"),this.history={};var f=this.config.assets,i=(this.config.scaling,this.manifests,[]);i=i.concat(f.ui);var k=i.concat(f.welcome),m=i.concat(f.choice),n=i.concat(f.game);this.gameoptions=new e,this.animalpage=1,this.options.keepFocus=!1,this.states={title:new a({next:"welcome",preload:f.title,scaling:"panel"}),welcome:new c({next:"choice",preload:k,scaling:"panel"}),choice:new d({next:"game",preload:m,scaling:"panel"}),game:new b({next:"title",previous:"choice",preload:n,scaling:"panel"})},this.transition=new g,this.transition.framerate=15,this.loading=new j(l.config.ui.LOADING),this.transition.addChild(this.loading.view),this.states.title.on("progress",function(a){l.loading.setval(a)}),this.manager.on("onLoadingStart",function(){l.loading.activate()}),this.manager.on("onTransitionInDone",function(){l.loading.activate(!1)}),this.states.choice.on("progress",function(a){l.loading.setval(a)}),this.states.welcome.on("progress",function(a){l.loading.setval(a)}),this.states.game.on("progress",function(a){l.loading.setval(a)}),this.states.game.levelassets=null,this.states.game.on("loading",function(a){this.levelassets=l.gameoptions.getmanifestforlevel(l.gameoptions.settings.presetid,"bgs"),this.levelassets.forEach(function(b){a.push(b)})}),this.playVO=function(a,b){this.voPlayer.play(a,b)},this.voloc=function(){return 0===this.voPlayer.duration?0:this.voPlayer.currentPosition/this.voPlayer.currentDuration},this.voplaying=function(){return this.voPlayer.currentVO},this.stopVO=function(){this.voPlayer.stop()},this.played={},this.playSFX=function(a){h.instance.play(a)},this.playAmbient=function(a){this.ambient&&this.ambient.stop(),a&&(this.ambient=h.instance.play(a,{loop:-1}))},this.startgame=function(){"undefined"!=typeof embedded?embedded.startGame():this.container.send("startgame")},this.scorepoints=function(a){"undefined"!=typeof embedded?embedded.savePoints(a):this.container.send("scorepoints",a)},this.clickedplay=function(a){this.container.off("begin",this.clickedplay),this.states.title.onPlay()},this.clickedplay=this.clickedplay.bind(this),this.container.on("begin",this.clickedplay)}),window.app=l}();