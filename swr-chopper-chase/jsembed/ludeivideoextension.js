(function(){if(window.ext&&window.ext.LudeiExtensionVideo){if(document.createElement('video'))return;var ludeiExtensionVideo=window.ext.LudeiExtensionVideo;var Video={src:null,_src:null,style:{left:0,_left:0,top:0,_top:0,width:0,_width:0,height:0,_height:0,cssText:''},listeners:{},play:function(){ludeiExtensionVideo.makeCall('play');},addEventListener:function(eventType,callback){var listeners=this.listeners[eventType];if(!listeners){listeners=[];this.listeners[eventType]=listeners;}
if(listeners.indexOf(callback)<0){listeners.push(callback);}},removeEventListener:function(eventType,callback){var listeners=this.listeners[eventType];if(listeners){var i=listeners.indexOf(callback);if(i>=0){this.listeners[eventType]=listeners.splice(i,1);}}}};Video.__defineSetter__('src',function(src){console.log('location = '+location);if(src.toLowerCase().indexOf('http://')!==0&&src.toLowerCase().indexOf('file://')!==0){var prefix=''+location;var endOfPrefix=prefix.indexOf('?');prefix=prefix.substring(0,endOfPrefix<0?prefix.length:endOfPrefix);if(prefix.toLowerCase().indexOf('http://cocoonjslocalhost')===0){var storageTypeStrings=['TEMPORARY_STORAGE','INTERNAL_STORAGE','EXTERNAL_STORAGE','APP_STORAGE'];var path=null;for(var i=0;!path&&i<storageTypeStrings.length;i++){path=window.ext.IDTK_APP.makeCall('existsPath',src,storageTypeStrings[i]);}
if(path){src='file://'+path;}}else{if(prefix.toUpperCase().indexOf('HTML')===prefix.length-4){src=prefix.substring(0,prefix.lastIndexOf('/')+1)+src;}else{src=prefix+src;}}}
this._src=src;ludeiExtensionVideo.makeCall('load',src);});Video.__defineGetter__('src',function(){return this._src;});Video.style.__defineSetter__('left',function(left){this._left=left;ludeiExtensionVideo.makeCall('setRect',this._left/window.innerWidth,this._top/window.innerHeight,this._width/window.innerWidth,this._height/window.innerHeight);});Video.style.__defineGetter__('left',function(){return this._left;});Video.style.__defineSetter__('top',function(top){this._top=top;ludeiExtensionVideo.makeCall('setRect',this._left/window.innerWidth,this._top/window.innerHeight,this._width/window.innerWidth,this._height/window.innerHeight);});Video.style.__defineGetter__('top',function(){return this._top;});Video.style.__defineSetter__('width',function(width){this._width=width;ludeiExtensionVideo.makeCall('setRect',this._left/window.innerWidth,this._top/window.innerHeight,this._width/window.innerWidth,this._height/window.innerHeight);});Video.style.__defineGetter__('width',function(){return this._width;});Video.style.__defineSetter__('height',function(height){this._height=height;ludeiExtensionVideo.makeCall('setRect',this._left/window.innerWidth,this._top/window.innerHeight,this._width/window.innerWidth,this._height/window.innerHeight);});Video.style.__defineGetter__('height',function(){return this._height;});function callVideoListeners(eventType){var event={target:Video};var onEventType='on'+eventType;if(typeof(Video[onEventType])==='function'){Video[onEventType](event)}
var listeners=Video.listeners[eventType];if(listeners){for(var i=0;i<listeners.length;i++){listeners[i](event);}}}
ludeiExtensionVideo.addEventListener('ended',function(){callVideoListeners('ended',arguments);});ludeiExtensionVideo.addEventListener('error',function(){callVideoListeners('error',arguments);});ludeiExtensionVideo.addEventListener('canplaythrough',function(){callVideoListeners('canplaythrough',arguments);});ludeiExtensionVideo.oldCreateElement=ludeiExtensionVideo.oldCreateElement||document.createElement;document.createElement=function(type){var newElement=ludeiExtensionVideo.oldCreateElement.apply(this,Array.prototype.slice.call(arguments));if(!newElement&&type==='video'){newElement=Video;}
return newElement;};ludeiExtensionVideo.oldBodyAppendChild=ludeiExtensionVideo.oldBodyAppendChild||document.body.appendChild;document.body.appendChild=function(node){if(node===Video){ludeiExtensionVideo.makeCall('show');return node;}else{return ludeiExtensionVideo.oldBodyAppendChild.apply(this,Array.prototype.slice.call(arguments));}};ludeiExtensionVideo.oldBodyRemoveChild=ludeiExtensionVideo.oldBodyRemoveChild||document.body.removeChild;document.body.removeChild=function(node){if(node===Video){ludeiExtensionVideo.makeCall('stop');ludeiExtensionVideo.makeCall('hide');node.listeners={};return node;}else{return ludeiExtensionVideo.oldBodyRemoveChild.apply(this,Array.prototype.slice.call(arguments));}};}})();