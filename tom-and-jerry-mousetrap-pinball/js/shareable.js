var Shareable=function(){trace("Shareable()");var me=this;var canvas=document.body.appendChild(document.createElement("canvas"));canvas.className="canvas_shareable";canvas.width=1200;canvas.height=630;me.canvas=canvas;var stage=new createjs.Stage(canvas);stage.enableMouseOver(0);stage.tickChildren=false;stage.tickEnabled=false;stage.needUpdate=false;stage.snapToPixelsEnabled=true;stage.enableDOMEvents(false);var frame=stage.addChild(new lib.shareable_landscape);__utils.doText(frame.txt_title,oLANG.sharable_game_name,{verticalAlign:"top"});__utils.doText(frame.txt_header,oLANG.sharable_hdr,{verticalAlign:"top"});var temp_obj=JSON.parse(JSON.stringify(oLANG.sharable_score));temp_obj.value=__utils.doSubText(temp_obj.value,"~amt~",GAME.score);__utils.doText(frame.txt_score,temp_obj);stage.update();this.doDestroy=function(){stage=null;wrapper.removeChild(canvas);}
this.doSaveImage=function(which,callback){trace("doSaveImage()");var destination="user_files";var canvas_image;var shorten="no";canvas_image=canvas.toDataURL("image/jpeg");var file_path=location.href;file_path=file_path.substring(0,file_path.lastIndexOf("/")+1)+destination+"/";var vars=new FormData();vars.append("destination",destination);vars.append("name",__utils.guid()+".jpeg");vars.append("path",file_path);vars.append("shorten",shorten);vars.append("file",__utils.dataURItoBlob(canvas_image));var http=new XMLHttpRequest();http.open("POST","save_image.php",false);http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){trace(http);saved_file=http.responseText;callback(saved_file);}else{callback("failed");}}
http.send(vars);}
var social_popup;this.doShareImage=function(which,image_file){switch(which){case "twitter":var image_base_name=image_file.slice(0,-5);var site_path=base_url+"?i="+image_base_name;var share_url="https://twitter.com/intent/tweet?text="+oLANG.tweet_text.value+" &url="+encodeURI(site_path);social_popup=window.open(share_url,'twitter','width=640, height=800, scrollbars=yes','resizable');social_popup.focus();trace(share_url);break;case "facebook":var image_base_name=image_file.slice(0,-5);var site_path=base_url+"?i="+image_base_name;var share_url="https://www.facebook.com/sharer/sharer.php?u="+encodeURI(site_path);social_popup=window.open(share_url,'share','width=640, height=800, scrollbars=yes','resizable');social_popup.focus();trace(share_url);break;case "instagram":var canvas_image=canvas.toDataURL("image/jpeg");var image_blob=__utils.dataURItoBlob(canvas_image);if(platform.isIE&&doGetBrowser().version<=11){window.navigator.msSaveBlob(image_blob,oLANG.sharable_default_filename.value+".jpeg");}else{doClosePage();printable_popup=window.open("",oLANG.sharable_default_filename.value,"location=0,menubar=0,scrollbars=0,status=0,toolbar=0,resizable=1");printable_popup.document.write('<!DOCTYPE html><html><head><meta name="viewport" content="minimal-ui, user-scalable=yes, width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0" />');printable_popup.document.write('<link rel="stylesheet" type="text/css" href="css/fonts.css">');printable_popup.document.write('<link rel="stylesheet" type="text/css" href="css/popup_style.css">');printable_popup.document.write('</head><body>');printable_popup.document.write('<div id="download_inst" class="download_inst"></div>');printable_popup.document.write('<a id="download_helper" download="'+oLANG.sharable_default_filename.value+'.jpeg" href="'+window.URL.createObjectURL(image_blob)+'">');printable_popup.document.write('<img id="image" class="download_image" oncontextmenu="return false;" src="'+window.URL.createObjectURL(image_blob)+'"/>');printable_popup.document.write('</a>');printable_popup.document.write('<img id="button_close" class="close_button" src="media/images/close.png" onClick="javascript:opener.doClosePage();">');printable_popup.document.write('</body>');printable_popup.document.location="#";printable_popup.focus();var instr=printable_popup.document.getElementById("download_inst");if(platform.isMobile){__utils.doHTMLText(instr,oLANG.instagram_text_mobile);}else{__utils.doHTMLText(instr,oLANG.instagram_text_desktop);}}
break;case "download":var canvas_image=canvas.toDataURL("image/jpeg");var image_blob=__utils.dataURItoBlob(canvas_image);if(platform.isIE&&doGetBrowser().version<=11){window.navigator.msSaveBlob(image_blob,oLANG.sharable_default_filename.value+".jpeg");}else if(platform.isiOS){doClosePage();printable_popup=window.open("",oLANG.sharable_default_filename.value,"location=0,menubar=0,scrollbars=0,status=0,toolbar=0,resizable=1");printable_popup.document.write('<!DOCTYPE html><html><head><meta name="viewport" content="minimal-ui, user-scalable=yes, width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0" />');printable_popup.document.write('<link rel="stylesheet" type="text/css" href="css/fonts.css">');printable_popup.document.write('<link rel="stylesheet" type="text/css" href="css/popup_style.css">');printable_popup.document.write('</head><body>');printable_popup.document.write('<div id="download_inst" class="download_inst"></div>');printable_popup.document.write('<a id="download_helper" download="'+oLANG.sharable_default_filename.value+'.jpeg" href="'+window.URL.createObjectURL(image_blob)+'">');printable_popup.document.write('<img id="image" class="download_image" oncontextmenu="return false;" src="'+window.URL.createObjectURL(image_blob)+'"/>');printable_popup.document.write('</a>');printable_popup.document.write('<img id="button_close" class="close_button" src="media/images/close.png" onClick="javascript:opener.doClosePage();">');printable_popup.document.write('</body>');printable_popup.document.location="#";printable_popup.focus();var instr=printable_popup.document.getElementById("download_inst");__utils.doHTMLText(instr,oLANG.mobile_download_intructions);}else{var download_helper=wrapper.appendChild(document.createElement("a"));download_helper.id="download_helper";download_helper.download=oLANG.sharable_default_filename.value+".jpeg";download_helper.href=window.URL.createObjectURL(image_blob);download_helper.click();__utils.doDestroyElement("download_helper");}
break;}}}