/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Array.prototype.erase=function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};window.ig={game:null,debug:null,version:'1.23',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'js/lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class||ext===null){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);el[attr]=el['ms'+uc]=el['moz'+uc]=el['webkit'+uc]=el['o'+uc]=val;},getVendorAttribute:function(el,attr){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},getImagePixels:function(image,x,y,width,height){var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');ig.System.SCALE.CRISP(canvas,ctx);var ratio=ig.getVendorAttribute(ctx,'backingStorePixelRatio')||1;ig.normalizeVendorAttribute(ctx,'getImageDataHD');var realWidth=image.width/ratio,realHeight=image.height/ratio;canvas.width=Math.ceil(realWidth);canvas.height=Math.ceil(realHeight);ctx.drawImage(image,0,0,realWidth,realHeight);return(ratio===1)?ctx.getImageData(x,y,width,height):ctx.getImageDataHD(x,y,width,height);},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw("Unresolved (or circular?) dependencies. "+"Most likely there's a name/path mismatch for one of the listed modules "+"or a previous syntax error prevents a module from loading:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.kindle=/Silk/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||ig.ua.kindle||/mobile/i.test(navigator.userAgent);ig.ua.touchDevice=(('ontouchstart'in window)||(window.navigator.msMaxTouchPoints));},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};ig.normalizeVendorAttribute(window,'requestAnimationFrame');if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;var lastClassId=0;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;Class.classId=prototype.classId=++lastClassId;return Class;};if(window.ImpactMixin){ig.merge(ig,window.ImpactMixin);}})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.prefix+this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}
if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var origPixels=ig.getImagePixels(this.data,0,0,this.width,this.height);var widthScaled=this.width*scale;var heightScaled=this.height*scale;var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=(Math.floor(y/scale)*this.width+Math.floor(x/scale))*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,(Math.floor(tile*tileWidth)%this.width)*scale,(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]<128&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},soundObjects:[],volume:1,format:null,webAudioContext:null,savedVolume:1,savedMusicVolume:1,muted:false,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=false;return;}
var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(ig.Sound.iOSWebAudio){this.format={ext:'mp3.jsound',mime:'dataURI'};}
if(!this.format){ig.Sound.enabled=false;}},getAudioContext:function(){if(this.webAudioContext===null){window.AudioContext=window.AudioContext||window.webkitAudioContext;this.webAudioContext=new AudioContext();}
return this.webAudioContext;},load:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(ig.Sound.iOSWebAudio){if(this.clips[path]){return this.clips[path];}
var ctx=this.getAudioContext();var soundData={src:null,gainNode:null,data:"",loop:false,bufferData:null};var xmlhttp=new XMLHttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){soundData.data=JSON.parse(xmlhttp.responseText).data;var arrayBuff=Base64Binary.decodeArrayBuffer(soundData.data);ctx.decodeAudioData(arrayBuff,function(audioData){soundData.bufferData=audioData;});if(loadCallback){loadCallback(path,true);}}};xmlhttp.open("GET",realPath,true);xmlhttp.send();this.clips[path]=soundData;return soundData;}else{if(this.clips[path]){if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,false,ev);},false);}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;}},get:function(path){if(ig.Sound.iOSWebAudio){return this.clips[path];}
var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];},toggleMute:function(){this.muted=!this.muted;if(this.muted){this.savedVolume=this.volume;this.savedMusicVolume=ig.music._volume;this.setVolume(0);ig.music.setVolume(0);}else{this.setVolume(this.savedVolume);ig.music.setVolume(this.savedMusicVolume);}},setVolume:function(v){this.volume=v;for(var i=0;i<this.soundObjects.length;i++)
{var s=this.soundObjects[i];if(s.currentClip){if(s.currentClip.gainNode){s.currentClip.gainNode.gain.value=s.volume*this.volume;}else{s.currentClip.volume=s.volume*this.volume;}}}},stopAll:function(){for(var i=0;i<this.soundObjects.length;i++)
{var s=this.soundObjects[i];s.stop();}}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);if(ig.Sound.iOSWebAudio){track.loop=this._loop;}else{track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);}
this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!ig.Sound.enabled){return;}
if(!this.currentTrack){return;}
if(ig.Sound.iOSWebAudio){if(this.currentTrack.src){var a = 0;}}else{this.currentTrack.pause();if(!ig.ua.IE9){this.currentTrack.currentTime=0;}}},play:function(name){if(!ig.Sound.enabled){return;}
if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}else if(this.currentTrack.src&&this.currentTrack.src.playbackState==2){return;}}
else if(!this.currentTrack){return;}
if(ig.Sound.iOSWebAudio){var ctx=ig.soundManager.getAudioContext();var waObj=this.currentTrack;waObj.src=ctx.createBufferSource();waObj.gainNode=ctx.createGain?ctx.createGain():ctx.createGainNode();waObj.src.buffer=waObj.bufferData;waObj.src.loop=true;waObj.src.connect(waObj.gainNode);waObj.gainNode.connect(ctx.destination);}else{this.currentTrack.play();}},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){if(this.tracks[i].gainNode){this.tracks[i].gainNode.gain.value=this._volume;}else{this.tracks[i].volume=this._volume;}}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){if(!ig.ua.mobile||ig.Sound.iOSWebAudio){this.path=path;this.multiChannel=(multiChannel!==false);this.load();}},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled||(ig.ua.mobile&&!ig.Sound.iOSWebAudio)){return;}
if(ig.soundManager.soundObjects.indexOf(this)==-1)ig.soundManager.soundObjects.push(this);this.currentClip=ig.soundManager.get(this.path);if(ig.Sound.iOSWebAudio){var ctx=ig.soundManager.getAudioContext();var soundData=this.currentClip;soundData.src=ctx.createBufferSource();soundData.gainNode=ctx.createGain?ctx.createGain():ctx.createGainNode();soundData.gainNode.gain.value=ig.soundManager.volume*this.volume;soundData.src.buffer=soundData.bufferData;soundData.src.connect(soundData.gainNode);soundData.gainNode.connect(ctx.destination);}else{this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.currentTime=0;this.currentClip.play();}},stop:function(){if(this.currentClip){if(ig.Sound.iOSWebAudio){if(this.currentClip.src){var a = 0;}}else{this.currentClip.pause();this.currentClip.currentTime=0;}}}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=2;ig.Sound.iOSWebAudio=ig.ua.iOS&&('webkitAudioContext'in window||'AudioContext'in window);ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;if(this.scale!=1){ig.System.scaleMode=ig.System.SCALE.CRISP;}
ig.System.scaleMode(this.canvas,this.context);},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:null});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',false);canvas.style.imageRendering='-moz-crisp-edges';canvas.style.imageRendering='-o-crisp-edges';canvas.style.imageRendering='-webkit-optimize-contrast';canvas.style.imageRendering='crisp-edges';canvas.style.msInterpolationMode='nearest-neighbor';},SMOOTH:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',true);canvas.style.imageRendering='';canvas.style.msInterpolationMode='';}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,false);ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);if(ig.ua.touchDevice){ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('MSPointerDown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('MSPointerUp',this.keyup.bind(this),false);ig.system.canvas.addEventListener('MSPointerMove',this.mousemove.bind(this),false);ig.system.canvas.style.msTouchAction='none';}},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},initPage:function(){if(!this.isUsingPage){this.isUsingPage=true;window.addEventListener("pageshow",this.pageshow.bind(this),false);window.addEventListener("pagehide",this.pagehide.bind(this),false);}},pagehide:function(){ig.music.stop();},pageshow:function(){ig.music.play();},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var scale=ig.system.scale*(internalWidth/ig.system.realWidth);var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
var ev=event.touches?event.touches[0]:event;this.mouse.x=(ev.clientX-pos.left)/scale;this.mouse.y=(ev.clientY-pos.top)/scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchstart'||event.type=='mousedown'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
if(code>0)
{event.stopPropagation();event.preventDefault();}}},keyup:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);element.addEventListener('MSPointerDown',function(ev){that.touchStart(ev,action);},false);element.addEventListener('MSPointerUp',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return!!this.delayedKeyup[action];},clearPressed:function(){var action;for(action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;delete this.delayedKeyup[action];}
for(action in this.presses){delete this.presses[action];}},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/display/sprite.js
ig.baked=true;ig.module('display.sprite').defines(function(){"use strict";ig.Sprite=ig.Class.extend({igImage:null,sourceX:0,sourceY:0,width:0,height:0,init:function(igImage,sourceX,sourceY,width,height){this.igImage=igImage;this.sourceX=sourceX;this.sourceY=sourceY;this.width=width;this.height=height;},draw:function(dx,dy,context){if(!this.igImage.loaded){return;}
var ctx=typeof context==="undefined"?ig.system.context:context;ctx.drawImage(this.igImage.data,this.sourceX,this.sourceY,this.width,this.height,ig.system.getDrawPos(dx),ig.system.getDrawPos(dy),this.width,this.height);ig.Image.drawCount++;},drawSubPixel:function(dx,dy,context){if(!this.igImage.loaded){return;}
var ctx=typeof context==="undefined"?ig.system.context:context;ctx.drawImage(this.igImage.data,this.sourceX,this.sourceY,this.width,this.height,dx,dy,this.width,this.height);ig.Image.drawCount++;}});});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height){this.width=width;this.height=height;this.image=new ig.Image(path);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.loopCount=0;this.frame=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f-0.0001);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,simple:false,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=this.last.x=x;this.pos.y=this.last.y=y;ig.merge(this,settings);},reset:function(x,y,settings){var proto=this.constructor.prototype;this.pos.x=x;this.pos.y=y;this.last.x=x;this.last.y=y;this.vel.x=proto.vel.x;this.vel.y=proto.vel.y;this.accel.x=proto.accel.x;this.accel.y=proto.accel.y;this.health=proto.health;this._killed=proto._killed;this.standing=proto.standing;this.type=proto.type;this.checkAgainst=proto.checkAgainst;this.collides=proto.collides;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){if(this.simple===false){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;this.pos.x+=mx;this.pos.y+=my;}
if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){},erase:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;this.pxWidth=this.width*this.tilesize;this.pxHeight=this.height*this.tilesize;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,temp:{collision:{x:false,y:false,slope:false},pos:{x:0,y:0},tile:{x:0,y:0}},init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(totalWidth,totalHeight),this.chunkSize);var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;chunk.retinaResolutionEnabled=false;var chunkContext=chunk.getContext('2d');ig.System.scaleMode(chunk,chunkContext);var screenContext=ig.system.context;ig.system.context=chunkContext;for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=screenContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var w=this.width*this.tilesize*ig.system.scale;dx=(dx%w+w)%w;var h=this.height*this.tilesize*ig.system.scale;dy=(dy%h+h)%h;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX+=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY+=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=(tileY%this.height+this.height)%this.height;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=(tileX%this.width+this.width)%this.width;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){this.updateEntities();this.checkEntities();var n=this._deferredKill.length;for(var i=0;i<n;i++){this._deferredKill[i].erase();this.entities.erase(this._deferredKill[i]);}
this._deferredKill.length=0;if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}},updateEntities:function(){var n=this.entities.length;for(var i=0;i<n;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){if(this.clearColor){ig.system.clear(this.clearColor);}
this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var map=this.backgroundMaps[0];if(map){map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();},drawEntities:function(){var n=this.entities.length;for(var i=0;i<n;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};var n=this.entities.length;for(var e=0;e<n;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/impact/entity-pool.js
ig.baked=true;ig.module('impact.entity-pool').requires('impact.game').defines(function(){"use strict";ig.EntityPool={pools:{},mixin:{staticInstantiate:function(x,y,settings){return ig.EntityPool.getFromPool(this.classId,x,y,settings);},erase:function(){ig.EntityPool.putInPool(this);}},enableFor:function(Class){Class.inject(this.mixin);},getFromPool:function(classId,x,y,settings){var pool=this.pools[classId];if(!pool||!pool.length){return null;}
var instance=pool.pop();instance.reset(x,y,settings);return instance;},putInPool:function(instance){if(!this.pools[instance.classId]){this.pools[instance.classId]=[instance];}
else{this.pools[instance.classId].push(instance);}},drainPool:function(classId){delete this.pools[classId];},drainAllPools:function(){this.pools={};}};ig.Game.inject({loadLevel:function(data){ig.EntityPool.drainAllPools();this.parent(data);}});});

// lib/game/misc-entities.js
ig.baked=true;ig.module('game.misc-entities').requires('display.sprite','impact.entity-pool','impact.entity','impact.game').defines(function(){ig.PigmanBubble=ig.Entity.extend({size:{x:112,y:20},offset:{x:33,y:140},maxVel:{x:1000,y:1000},collides:ig.Entity.COLLIDES.ACTIVE,checkAgainst:ig.Entity.TYPE.B,sprite:null,pigBubble:true,inMud:false,angleToTarget:0,floatSpeed:0,targetMudSpot:null,init:function(x,y,settings){this.parent(x,y,settings);this.startPos={x:x,y:y};this.sprite=new ig.Sprite(ig.game.gameSpritesheet,0,0,176,174);ig.game.player.numPigInTow++;},update:function(){if(this.inMud!==true){this.inMud=ig.game.player.isInMud;this.collides=ig.Entity.COLLIDES.ACTIVE;}
if(this.inMud){if(this.targetMudSpot===null){this.targetMudSpot=ig.levelManager.mudSpots[ig.levelManager.numPigsSaved];ig.levelManager.numPigsSaved++;ig.game.player.numPigInTow--;this.collides=ig.Entity.COLLIDES.NEVER;}
this.angleToTarget=this.angleToMud();this.floatSpeed=220;}else{var distanceMultiplier=(this.distanceTo(ig.game.player)-100)/150;this.angleToTarget=this.angleTo(ig.game.player);this.floatSpeed=300*distanceMultiplier;}
this.vel.x=Math.cos(this.angleToTarget)*this.floatSpeed;this.vel.y=Math.sin(this.angleToTarget)*this.floatSpeed;this.parent();if(this.inMud===true&&this.distanceToSpot()<10){this.kill();ig.game.spawnEntity(ig.PigmanInMud,this.pos.x,this.pos.y);}},check:function(other){if(other.objectType==ig.OBJECT_TYPES.ENEMY){this.collides=ig.Entity.COLLIDES.PASSIVE;}},draw:function(){var dx=this.pos.x-this.offset.x-ig.game._rscreen.x;var dy=this.pos.y-this.offset.y-ig.game._rscreen.y;this.sprite.draw(dx,dy);},angleToMud:function(){return Math.atan2(this.targetMudSpot[1]-this.pos.y,this.targetMudSpot[0]-this.pos.x);},distanceToSpot:function(){var xd=this.pos.x-this.targetMudSpot[0];var yd=this.pos.y-this.targetMudSpot[1];return Math.sqrt(xd*xd+yd*yd);}});ig.PigmanInMud=ig.Entity.extend({size:{x:74,y:20},offset:{x:85,y:180},maxVel:{x:1000,y:1000},simple:true,timer:0,init:function(x,y,settings){this.parent(x,y,settings);this.animSheet=new ig.AnimationSheet("media/images/game/piginmud.png",223,247);this.addAnim('idle',1,[0]);this.addAnim('happystart',0.08,[1,2,3,4,5,6,7,8],true);this.addAnim('happyloop',0.08,[9,10,11,12,13,14]);ig.game.playSuccessSound();},update:function(){this.parent();if(this.currentAnim==this.anims["happyloop"]){return;}
if(this.currentAnim==this.anims["happystart"]&&this.currentAnim.loopCount>=1){this.currentAnim=this.anims["happyloop"].rewind();return;}
if(this.currentAnim==this.anims["idle"]&&this.timer>1.2){ig.SFX.mudbath.play();ig.levelManager.spawnHearts(this.pos.x+this.size.x/2,this.pos.y+this.size.y/2);this.currentAnim=this.anims["happystart"].rewind();ig.levelManager.completeTask(ig.TASK_TYPES.PIGMAN);}else{this.timer+=ig.system.tick;}}});ig.RockMama=ig.Entity.extend({size:{x:404,y:176},offset:{x:0,y:142},objectType:-1,isHappy:false,collides:ig.Entity.COLLIDES.FIXED,playerOffset:null,flipped:false,timer:0,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.ROCK_MAMA;this.animSheet=new ig.AnimationSheet("media/images/game/rock-mama.png",426,330);this.addAnim('idle',1,[0]);this.addAnim('happy',1,[1]);this.flipped=x>ig.levelManager.width/2;this.currentAnim.flip.x=this.flipped;this.playerOffset=this.flipped?{x:-56,y:145}:{x:550,y:145};this.playerOffset.x+=x;this.playerOffset.y+=y;},update:function(){this.parent();if(this.isHappy){if(this.timer>2){this.currentAnim=this.anims["idle"];this.currentAnim.flip.x=this.flipped;this.isHappy=false;this.timer=0;}else{this.timer+=ig.system.tick;}}},receiveBaby:function(){ig.SFX.rockBaby.play();this.isHappy=true;this.currentAnim=this.anims["happy"];this.currentAnim.flip.x=this.flipped;ig.levelManager.spawnHearts(ig.game.player.cp.x,ig.game.player.cp.y);}});ig.JellyfishPie=ig.Entity.extend({type:ig.Entity.TYPE.B,objectType:-1,size:{x:100,y:58},offset:{x:15,y:14},maxVel:{x:5000,y:5000},simple:true,sprite:null,life:10,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.PICKUP;this.sprite=new ig.Sprite(ig.game.gameSpritesheet,0,220,130,86);},draw:function(){var dx=this.pos.x-this.offset.x-ig.game._rscreen.x;var dy=this.pos.y-this.offset.y-ig.game._rscreen.y;this.sprite.draw(dx,dy);}});ig.EntityPool.enableFor(ig.JellyfishPie);ig.HeartPickup=ig.Entity.extend({objectType:-1,size:{x:40,y:40},maxVel:{x:1000,y:1000},lifeSeconds:5,sprite:null,scale:1,bottomY:0,direction:1,bounciness:0.4,minBounceVelocity:40,stopped:false,collected:false,highLevel:true,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.PICKUP;this.sprite=new ig.Sprite(ig.game.gameSpritesheet,177,136,48,44);this.reset(x,y,settings);},reset:function(x,y,settings){this.parent(x,y,settings);this.collected=false;this.stopped=false;this.highLevel=true;this.lifeSeconds=5;this.scale=Math.random()*0.5+0.5;this.direction=ig.HeartPickup.direction;ig.HeartPickup.direction*=-1;this.animate();},animate:function(){this.vel.x=(Math.random()*100+270)*this.direction;this.vel.y=Math.random()*-50-350;this.bottomY=this.pos.y+this.bottomY;this.stopped=false;},update:function(){if(this.stopped===true){var d=this.distanceTo(ig.game.player);if(d<20){this.collected=true;this.kill();ig.game.playPickupSound();ig.game.player.addHealth();}else if(d<200){var multi=(d-200)/200;var ang=this.angleTo(ig.game.player);this.vel.x=Math.cos(ang)*-200*multi;this.vel.y=Math.sin(ang)*-200*multi;}else{this.vel.x=0;this.vel.y=0;}
this.lifeSeconds-=1*ig.system.tick;if(this.lifeSeconds<1){this.scale=this.lifeSeconds/1*this.scale;}
if(this.lifeSeconds<=0){this.kill();}}else{this.vel.x-=300*ig.system.tick*this.direction;this.vel.y+=550*ig.system.tick;if(this.direction<0&&this.vel.x>0){this.vel.x=0;}else if(this.direction>0&&this.vel.x<0){this.vel.x=0;}
if(this.pos.y>this.bottomY&&this.vel.y>0){if(Math.abs(this.vel.y)>this.minBounceVelocity){this.highLevel=false;this.vel.y*=-this.bounciness;}else{this.pos.y=this.bottomY;this.vel.y=0;}}
this.stopped=this.vel.y===0&&this.vel.x===0;}
this.parent();},draw:function(){this.parent();var dx=this.pos.x-this.offset.x-ig.game._rscreen.x;var dy=this.pos.y-this.offset.y-ig.game._rscreen.y;if(dx>ig.system.width||dy>ig.system.height||dx+this.width<0||dy+this.height<0){return;}
ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(dx+24),ig.system.getDrawPos(dy+22));ig.system.context.scale(this.scale,this.scale);this.sprite.draw(-24,-22);ig.system.context.restore();}});ig.EntityPool.enableFor(ig.HeartPickup);ig.HeartPickup.direction=1;ig.StarPickup=ig.Entity.extend({objectType:-1,size:{x:48,y:48},sprite:null,collectedSprite:null,collected:false,yOffset:0,life:1,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.PICKUP;this.sprite=new ig.Sprite(ig.game.gameSpritesheet,177,87,48,48);if(ig.GameConfig.SCORE_PICKUP_USE_PLUS===true){this.collectedSprite=new ig.Sprite(ig.game.gameSpritesheet,0,175,139,44);}else{this.collectedSprite=new ig.Sprite(ig.game.gameSpritesheet,140,181,101,44);}
this.reset(x,y,settings);},reset:function(x,y,settings){this.parent(x,y,settings);this.collected=false;this.highLevel=false;this.yOffset=0;this.life=1;},update:function(){if(this.collected===true){if(this.yOffset<75){this.yOffset+=((75-this.yOffset)*0.9)*ig.system.tick*8;}
this.life-=ig.system.tick;if(this.life<0){this.kill();}
return;}
if(this.distanceTo(ig.game.player)<60){this.collected=true;this.highLevel=true;ig.levelManager.levelScore+=100;ig.game.playPickupSound();}},draw:function(){this.parent();var dx=this.pos.x-ig.game._rscreen.x;var dy=this.pos.y-ig.game._rscreen.y;if(dx>ig.system.width||dy>ig.system.height||dx+this.width<0||dy+this.height<0){return;}
if(this.collected){this.collectedSprite.draw(dx-45,dy-this.yOffset);}else{this.sprite.draw(dx,dy);}}});ig.EntityPool.enableFor(ig.HeartPickup);ig.FightGroup=ig.Entity.extend({size:{x:321,y:319},simple:true,init:function(x,y,settings){this.parent(x,y,settings);this.animSheet=new ig.AnimationSheet("media/images/game/tussle.png",321,319);this.addAnim('fighting',0.08,[0,1,2,3,4,5,6,7,8,]);this.currentAnim=this.anims["fighting"];},update:function(){this.parent();if(this.currentAnim.loopCount>=1){ig.game.endFight();this.kill();}}});});

// lib/managers/level.js
ig.baked=true;ig.module('managers.level').requires('game.misc-entities','impact.impact').defines(function(){"use strict";ig.LevelManager=ig.Class.extend({width:5000,height:2227,gameboardBackground:null,taskEntities:null,enemyEntities:null,terrainEntities:null,rockMama:null,closestTask:null,tasksCompleted:false,levelScore:0,levelData:null,_levelSessionData:null,patrolTaskIndex:0,pigmenZones:[{x:240,y:1976,w:650,h:100},{x:898,y:1750,w:140,h:286}],spawnZones:[{x:576,y:242,w:296,h:334},{x:1492,y:240,w:427,h:274},{x:2059,y:640,w:726,h:386},{x:3132,y:198,w:562,h:510},{x:4185,y:250,w:274,h:202},{x:608,y:634,w:587,h:266},{x:1375,y:618,w:419,h:410},{x:3864,y:618,w:419,h:658},{x:2927,y:1022,w:879,h:298},{x:147,y:1027,w:455,h:297},{x:839,y:1138,w:975,h:202},{x:2075,y:1118,w:607,h:214},{x:2684,y:1466,w:452,h:458},{x:1907,y:1527,w:628,h:289},{x:1347,y:1902,w:511,h:154},{x:2163,y:1914,w:411,h:90},{x:1127,y:1426,w:407,h:214}],rockMamaPositions:[{x:69,y:332},{x:4520,y:1142}],availableZones:null,mudOuterRect:{x:3531,y:1546,w:1402,h:550},mudPitPoly:[[3919,1556],[3606,1663],[3541,1753],[3671,1892],[4238,2072],[4589,2079],[4824,1995],[4932,1813],[4888,1684],[4696,1581],[4483,1573],[4238,1621],],mudSpots:[[4164,1828],[4004,1714],[3842,1810]],numPigsSaved:0,pieEntity:null,numSylvias:3,isEggLevel:false,init:function(){},createLevel:function(data){this.levelData=data;this.prepareLevelSessionData();this.numPigsSaved=0;this.numSylvias=3;this.levelScore=0;this.taskEntities=[];this.enemyEntities=[];this.terrainEntities=[];this.isEggLevel=false;this.refreshAvaiableZones();this.addGameboardTiles();this.addTerrainObjects();this.addTasks();this.addCharacters();this.addStars();this.tasksCompleted=false;},destroyLevel:function(){this.removeGameboardTiles();this.destroyEntities();this.terrainEntities=null;this.taskEntities=null;this.rockMama=null;this.enemyEntities=null;this.pieEntity=null;this.closestTask=null;this.levelData=null;this.taskEntities=null;this.enemyEntities=null;this.terrainEntities=null;this.isEggLevel=false;},getLevelCompletionPercent:function(){var numCompleted=0;var numTotal=0;var numTypes=this.levelData.tasks.length;for(var i=0;i<numTypes;i++){var taskObject=this._levelSessionData.tasks[this.levelData.tasks[i].type];numCompleted+=taskObject.completed;numTotal+=taskObject.total;}
return numCompleted/numTotal;},getLevelScore:function(){var timeScore=ig.game.levelTime*250;if(timeScore<0){timeScore=0;}
this.levelScore+=Math.floor(timeScore);return this.levelScore;},prepareLevelSessionData:function(){var session={};session.tasks={};session.taskTypes=[];var numTypes=this.levelData.tasks.length;for(var i=0;i<numTypes;i++){session.taskTypes.push(this.levelData.tasks[i].type);session.tasks[this.levelData.tasks[i].type]={completed:0,total:this.levelData.tasks[i].count};}
this._levelSessionData=session;},getSessionData:function(){return this._levelSessionData;},addGameboardTiles:function(){this.gameboardBackground=new ig.GameBoardBackground(1024,this.buildBlankData());this.gameboardBackground.loadTiles(ig.game.levelIndex+1);ig.game.backgroundMaps[0]=this.gameboardBackground;this.gameboardBackground.enabled=true;},removeGameboardTiles:function(){this.gameboardBackground.enabled=false;},addTerrainObjects:function(){this.terrainEntities.push(ig.game.spawnEntity(ig.Building,-12,1511));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlantRock,1122,1047));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlantRock,2715,87));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlantRock,3601,1965));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlant,-15,924));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlant,907,1434));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlant,1980,1982));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlant,2945,277));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlant,3408,1670));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallPlant,3911,538));this.terrainEntities.push(ig.game.spawnEntity(ig.LargePlant,1076,275));this.terrainEntities.push(ig.game.spawnEntity(ig.LargePlant,1660,1502));this.terrainEntities.push(ig.game.spawnEntity(ig.LargePlant,2933,967));this.terrainEntities.push(ig.game.spawnEntity(ig.LargePlant,4146,1527));this.terrainEntities.push(ig.game.spawnEntity(ig.LargeRocks,1089,2140));this.terrainEntities.push(ig.game.spawnEntity(ig.LargeRocks,1324,427));this.terrainEntities.push(ig.game.spawnEntity(ig.LargeRocks,2428,1439));this.terrainEntities.push(ig.game.spawnEntity(ig.LargeRocks,3638,922));this.terrainEntities.push(ig.game.spawnEntity(ig.YellowPipes,2835,405));this.terrainEntities.push(ig.game.spawnEntity(ig.YellowPipes,4396,946));this.terrainEntities.push(ig.game.spawnEntity(ig.YellowPipes,4701,2112));this.terrainEntities.push(ig.game.spawnEntity(ig.GreenPipes,745,1058));this.terrainEntities.push(ig.game.spawnEntity(ig.GreenPipes,1675,1837));this.terrainEntities.push(ig.game.spawnEntity(ig.GreenPipes,2016,162));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallBrownPlant,408,684));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallBrownPlant,1878,80));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallBrownPlant,1947,1042));this.terrainEntities.push(ig.game.spawnEntity(ig.SmallBrownPlant,4541,595));},addTasks:function(){var numTypes=this.levelData.tasks.length;for(var i=0;i<numTypes;i++){var numTaskPerType=this.levelData.tasks[i].count;var classType;switch(this.levelData.tasks[i].type){case ig.TASK_TYPES.FLOWER:classType=ig.FlowersTask;break;case ig.TASK_TYPES.BUNNY:classType=ig.BunnyTask;break;case ig.TASK_TYPES.PIGMAN:classType=ig.PigmanTask;break;case ig.TASK_TYPES.ROCK_BABY:classType=ig.RockBabyTask;if(this.rockMama===null){var mamaSpawn=this.rockMamaPositions.random();this.rockMama=ig.game.spawnEntity(ig.RockMama,mamaSpawn.x,mamaSpawn.y);}
break;default:continue;}
for(var j=0;j<numTaskPerType;j++){var spawnPoint;if(classType!=ig.PigmanTask||j>0){spawnPoint=this.getPointInUnusedZone();}else{spawnPoint=this.getPigmenSpawnPoint();}
this.taskEntities.push(ig.game.spawnEntity(classType,spawnPoint.x,spawnPoint.y));}}
this.isEggLevel=this.levelData.isEggLevel===true;},spawnHearts:function(x,y){ig.game.spawnEntity(ig.HeartPickup,x,y,{bottomY:-50});ig.game.spawnEntity(ig.HeartPickup,x,y,{bottomY:0});ig.game.spawnEntity(ig.HeartPickup,x,y,{bottomY:50});},addCharacters:function(){var numWatchdogs=this.levelData.watchdogs;this.patrolTaskIndex=Math.floor(this.taskEntities.length*Math.random());for(var i=0;i<numWatchdogs;i++){this.addWatchdogToBoard();}},addStars:function(){var numStars=15;for(var i=0;i<numStars;i++){var spawnPoint=this.spawnZones.random();ig.game.spawnEntity(ig.StarPickup,spawnPoint.x,spawnPoint.y);}},addWatchdogToBoard:function(){this.patrolTaskIndex++;if(this.patrolTaskIndex>=this.taskEntities.length){this.patrolTaskIndex=0;}
var task=this.taskEntities[this.patrolTaskIndex];var spawnX=task.pos.x+task.size.x/2;var spawnY=task.pos.y+task.size.y/2;var watchdog=ig.game.spawnEntity(ig.Watchdog,spawnX,spawnY);this.enemyEntities.push(watchdog);},addJellyfishPie:function(){var randomZone=this.spawnZones.random();this.pieEntity=ig.game.spawnEntity(ig.JellyfishPie,Math.round(randomZone.x+Math.random()*randomZone.w),Math.round(randomZone.y+Math.random()*randomZone.h));},findClosestTask:function(){this.closestTask=null;var d=99999;var n=this.taskEntities.length;for(var i=0;i<n;i++){if(this.taskEntities[i].isComplete===false&&ig.game.player.distanceTo(this.taskEntities[i])<d){d=ig.game.player.distanceTo(this.taskEntities[i]);this.closestTask=this.taskEntities[i];}}},destroyEntities:function(){for(var i=0;i<ig.game.entities.length;i++){ig.game.entities[i].kill();}
ig.game.update();},completeTask:function(taskType){this._levelSessionData.tasks[taskType].completed++;this.levelScore+=8000;ig.gameUI.bottombar.redraw();if(this.getLevelCompletionPercent()==1){this.tasksCompleted=true;}},getRandomTask:function(){return this.taskEntities.random();},getPigmenSpawnPoint:function(){var zone=this.pigmenZones.random();return{x:Math.round(zone.x+Math.random()*zone.w),y:Math.round(zone.y+Math.random()*zone.h)};},getPointInUnusedZone:function(){if(this.availableZones.length===0){this.refreshAvaiableZones();}
var zone=this.availableZones.splice(Math.floor(Math.random()*this.availableZones.length),1)[0];return{x:Math.round(zone.x+Math.random()*zone.w),y:Math.round(zone.y+Math.random()*zone.h)};},refreshAvaiableZones:function(){this.availableZones=this.spawnZones.slice(0);},isPointInMud:function(_x,_y){if(_x<this.mudOuterRect.x||_y<this.mudOuterRect.y||_x>this.mudOuterRect.x+this.mudOuterRect.w||_y>this.mudOuterRect.y+this.mudOuterRect.h){return false;}
var i,j,c=0;var poly=this.mudPitPoly;for(i=0,j=poly.length-1;i<poly.length;j=i++){if(((poly[i][1]>_y)!=(poly[j][1]>_y))&&(_x<(poly[j][0]-poly[i][0])*(_y-poly[i][1])/(poly[j][1]-poly[i][1])+poly[i][0])){c=!c;}}
return c;},buildBlankData:function(offset){var width=5;var height=3;var data=new Array(height);for(var y=0;y<height;y++){data[y]=new Array(width);for(var x=0;x<width;x++){data[y][x]=y*width+x;}}
return data;}});});

// lib/managers/userdata.js
ig.baked=true;ig.module('managers.userdata').requires('impact.impact').defines(function(){"use strict";ig.UserDataManager=ig.Class.extend({localStorageName:"woy_helpinhands",data:[],init:function(){if(Modernizr.localstorage===true&&typeof window.localStorage[this.localStorageName]!="undefined"){this.getExistingData();if(this.data.length!=ig.LevelData.length){this.createNewData();}}else{this.createNewData();}},createNewData:function(){var levelData=ig.LevelData;for(var i=0;i<levelData.length;i++){this.data[i]={unlocked:false,highscore:0};}
this.unlockNextLevel();this.storeData();},getExistingData:function(){if(Modernizr.localstorage===true){this.data=JSON.parse(window.localStorage[this.localStorageName]);}},storeData:function($scoresArray){if(Modernizr.localstorage===true){window.localStorage[this.localStorageName]=JSON.stringify(this.data);}},unlockNextLevel:function(){for(var i=0;i<this.data.length;i++){if(this.data[i].unlocked===false){this.data[i].unlocked=true;break;}}
this.storeData();},setLevelScore:function(levelIndex,score){if(this.data[levelIndex].highscore<score){this.data[levelIndex].highscore=score;}
this.storeData();},getLevelStatus:function(levelIndex){return this.data[levelIndex].unlocked?1:0;},getLastUnlockedLevel:function(){for(var i=0;i<this.data.length;i++){if(this.data[i].unlocked===false){return i-1;}}
return this.data.length-1;}});});

// lib/display/textbox.js
ig.baked=true;ig.module('display.textbox').requires('impact.impact').defines(function(){"use strict";ig.Textbox=ig.Class.extend({settings:{},pos:{x:0,y:0},numLines:0,lines:[],fontStyle:"12pt Arial",color:"#000000",align:"left",baseline:"alphabetic",fontSize:10,leading:"auto",shadowColor:"rgba(0,0,0,0.3)",shadowOffsetX:-2,shadowOffsetY:2,shadowBlur:0,init:function(stringObject,settings){ig.merge(this,settings);this.fontStyle=this.getStyleStr(stringObject);this.setString(stringObject.string);},setString:function(string){this.lines=string.split("\n");this.numLines=this.lines.length;if(this.leading=="auto"){this.leading=Math.round(this.fontSize*1.6);}},draw:function(x,y,context){var ctx=typeof context==="undefined"?ig.system.context:context;ctx.save();ctx.font=this.fontStyle;ctx.textAlign=this.align;ctx.fillStyle=this.color;ctx.textBaseline=this.baseline;if(this.shadowColor!==null){ctx.shadowColor=this.shadowColor;ctx.shadowOffsetX=this.shadowOffsetX;ctx.shadowOffsetY=this.shadowOffsetY;ctx.shadowBlur=this.shadowBlur;}
if(this.baseline=="middle"){y=y-((this.numLines-1)*this.fontSize)/2;}
for(var i=0;i<this.numLines;i++){ctx.fillText(this.lines[i],x,y+i*this.leading);}
ctx.restore();ig.Image.drawCount++;},replace:function(pattern,replace){for(var i=0;i<this.numLines;i++){this.lines[i]=this.lines[i].replace(pattern,replace);}},getStyleStr:function(stringObject,defaultStyle){var styleStr="";if(stringObject.bold!==undefined){styleStr+=stringObject.bold===true?"bold ":"";}else{styleStr+=ig.DEFAULT_FONTBOLD===true?"bold ":"";}
if(stringObject.size!==undefined){this.fontSize=stringObject.size;}
if(stringObject.leading!==undefined){this.leading=stringObject.leading;}
styleStr+=this.fontSize+"pt ";if(stringObject.font!==undefined){styleStr+=stringObject.font;}else{styleStr+=ig.DEFAULT_FONTFAMILY;}
return styleStr;}});});

// lib/display/displayobjects.js
ig.baked=true;ig.module('display.displayobjects').requires('display.sprite','display.textbox','impact.impact').defines(function(){"use strict";ig.DisplayObject=ig.Class.extend({pos:{x:0,y:0},size:{x:0,y:0},init:function(settings){ig.merge(this,settings);},update:function(){},draw:function(){},isMouseOver:function(){var mX=ig.input.mouse.x;var mY=ig.input.mouse.y;return(mX>=this.pos.x-this.size.x/2&&mX<=this.pos.x+this.size.x/2&&mY>=this.pos.y-this.size.y/2&&mY<=this.pos.y+this.size.y/2);},kill:function(){}});ig.LevelBubble=ig.DisplayObject.extend({levelIndex:-1,isLevelUnlocked:false,scale:1,levelBubble:null,dayTextbox:null,highscoreTextbox:null,highscoreLabelTextbox:null,stars:new ig.Image("media/images/screens/level-stars.png"),starLevel:0,tasks:[],numTaskTypes:0,isNewestLevel:false,bScale:1,over:false,xOffset:0,yOffset:0,xSpeed:1,ySpeed:6,yChange:0,canvasData:null,init:function(settings,levelIndex){this.parent(settings);this.levelIndex=levelIndex;this.scale=this.pos.s;this.isLevelUnlocked=ig.userDataManager.getLevelStatus(levelIndex)==1;this.dayTextbox=new ig.Textbox(ig.Strings.LEVEL_SELECT_DAY,{fontSize:36,color:"#FFFFFF",align:"center",baseline:"middle"});this.dayTextbox.replace("%n",levelIndex+1);if(this.isLevelUnlocked){this.levelBubble=new ig.Sprite(ig.game.screensSpritesheet,528,0,448,442);this.highscoreLabelTextbox=new ig.Textbox(ig.Strings.LEVEL_SELECT_HIGHSCORE_LABEL,{fontSize:26,align:"center",baseline:"middle"});this.highscoreTextbox=new ig.Textbox(ig.Strings.LEVEL_SELECT_HIGHSCORE,{fontSize:46,align:"center",baseline:"middle"});this.highscoreTextbox.replace("%n",ig.userDataManager.data[levelIndex].highscore);this.size.x=448;this.size.y=442;}else{this.levelBubble=new ig.Sprite(ig.game.screensSpritesheet,0,348,376,370);this.size.x=320;this.size.y=318;}
this.starLevel=Math.floor(ig.userDataManager.data[levelIndex].highscore/40000);if(this.starLevel>3){this.starLevel=3;}
this.yOffset=Math.random()*8-4;this.xSpeed*=Math.random()>0.5?1:-1;this.ySpeed*=Math.random()>0.5?1:-1;this.yChange=Math.random()*4+2;this.drawCanvasImageData();},update:function(){this.xOffset+=this.xSpeed*ig.system.tick;this.yOffset+=this.ySpeed*ig.system.tick;if(this.yOffset>4){this.ySpeed-=this.yChange*ig.system.tick;}else if(this.yOffset<-4){this.ySpeed+=this.yChange*ig.system.tick;}
if(this.xOffset>2){this.xSpeed-=2*ig.system.tick;}else if(this.xOffset<-2){this.xSpeed+=2*ig.system.tick;}
if(this.isLevelUnlocked===false){return;}
var mo=this.isMouseOver();if(mo&&this.over===false){this.over=true;ig.SFX.roll.play();TweenMax.to(this,0.2,{bScale:1.02,ease:"easeOutBack"});}else if(!mo&&this.over===true){this.over=false;TweenMax.to(this,0.2,{bScale:1,ease:"easeOutBack"});}},draw:function(){var data,dx,dy;var ctx=ig.system.context;ctx.save();ctx.translate(ig.game.cp.x+this.pos.x+this.xOffset,ig.game.cp.y+this.pos.y+this.yOffset);if(this.isLevelUnlocked){ctx.save();ctx.scale(this.bScale,this.bScale);dx=ig.system.getDrawPos(this.canvasData.width/-2);dy=ig.system.getDrawPos(this.canvasData.height/-2);ctx.drawImage(this.canvasData,dx,dy);ctx.restore();ig.Image.drawCount++;}else{if(this.scale!=1){ctx.scale(this.scale,this.scale);}
dx=ig.system.getDrawPos(this.canvasData.width/-2);dy=ig.system.getDrawPos(this.canvasData.height/-2);ctx.drawImage(this.canvasData,dx,dy);ig.Image.drawCount++;}
ctx.restore();},isMouseOver:function(){var mX=ig.input.mouse.x-ig.game.cp.x;var mY=ig.input.mouse.y-ig.game.cp.y;var xd=this.pos.x-mX;var yd=this.pos.y-mY;return Math.sqrt(xd*xd+yd*yd)<200*this.bScale;},drawCanvasImageData:function(){var w=this.levelBubble.width;var h=this.levelBubble.height;var canvas=ig.$new("canvas");canvas.width=w;canvas.height=h;var context=canvas.getContext('2d');context.clearRect(0,0,w,h);context.translate(w/2,h/2);if(this.isLevelUnlocked){this.levelBubble.draw(w/-2,h/-2,context);context.drawImage(this.stars.data,0,80*this.starLevel,164,80,-82,-144,164,80);this.dayTextbox.draw(0,-26,context);this.highscoreLabelTextbox.draw(0,26,context);this.highscoreTextbox.draw(0,80,context);}else{this.dayTextbox.draw(0,0,context);this.levelBubble.draw(w/-2,h/-2,context);}
this.canvasData=canvas;}});ig.LevelTaskBubble=ig.DisplayObject.extend({sprite:null,xOffset:0,yOffset:0,xSpeed:1,ySpeed:6,yChange:0,init:function(settings,taskType){this.parent(settings);var dx,dy;switch(taskType){case ig.TASK_TYPES.FLOWER:dx=0;dy=0;break;case ig.TASK_TYPES.BUNNY:dx=176;dy=0;break;case ig.TASK_TYPES.PIGMAN:dx=352;dy=0;break;case ig.TASK_TYPES.ROCK_BABY:dx=0;dy=174;break;case ig.TASK_TYPES.EGG:dx=176;dy=174;break;}
this.sprite=new ig.Sprite(ig.game.screensSpritesheet,dx,dy,176,174);this.yOffset=Math.random()*8-4;this.xSpeed*=Math.random()>0.5?1:-1;this.ySpeed*=Math.random()>0.5?1:-1;this.yChange=Math.random()*4+2;},update:function(){this.xOffset+=this.xSpeed*ig.system.tick;this.yOffset+=this.ySpeed*ig.system.tick;if(this.yOffset>4){this.ySpeed-=this.yChange*ig.system.tick;}else if(this.yOffset<-4){this.ySpeed+=this.yChange*ig.system.tick;}
if(this.xOffset>2){this.xSpeed-=2*ig.system.tick;}else if(this.xOffset<-2){this.xSpeed+=2*ig.system.tick;}
if(this.isLevelUnlocked===false){return;}},draw:function(){var ctx=ig.system.context;ctx.save();ctx.translate(ig.game.cp.x+this.pos.x+this.xOffset,ig.game.cp.y+this.pos.y+this.yOffset);this.sprite.draw(-88,-87);ctx.restore();},});ig.LevelTaskCount=ig.DisplayObject.extend({sprite:null,numbers:new ig.Image("media/images/gameui/numbers.png"),offset:{x:0,y:0},count:0,init:function(task,count){this.parent(this.settings);this.count=count;switch(task){case ig.TASK_TYPES.BUNNY:this.pos.x=-226;this.pos.y=22;this.sprite=new ig.Sprite(ig.game.screensSpritesheet,376,348,137,109);break;case ig.TASK_TYPES.FLOWER:this.pos.x=-18;this.pos.y=22;this.sprite=new ig.Sprite(ig.game.screensSpritesheet,376,626,160,90);this.offset.x=32;this.offset.y=32;break;case ig.TASK_TYPES.PIGMAN:this.pos.x=-405;this.pos.y=-165;this.sprite=new ig.Sprite(ig.game.screensSpritesheet,530,871,110,113);this.offset.x=50;break;case ig.TASK_TYPES.ROCK_BABY:this.pos.x=116;this.pos.y=-154;this.sprite=new ig.Sprite(ig.game.screensSpritesheet,976,0,40,56);this.offset.x=98;this.offset.y=16;break;case ig.TASK_TYPES.EGG:this.pos.x=68;this.pos.y=192;this.sprite=new ig.Sprite(ig.game.screensSpritesheet,425,878,105,136);this.offset.x=52;this.offset.y=13;break;}},draw:function(){this.sprite.draw(ig.game.cp.x+this.pos.x+this.offset.x,ig.game.cp.y+this.pos.y+this.offset.y);this.numbers.drawTile(ig.game.cp.x+this.pos.x+144,ig.game.cp.y+this.pos.y-6,21,30,43);this.numbers.drawTile(ig.game.cp.x+this.pos.x+174,ig.game.cp.y+this.pos.y-6,this.count*2+1,30,43);}});});

// lib/display/buttons.js
ig.baked=true;ig.module('display.buttons').requires('impact.impact').defines(function(){"use strict";ig.Button=ig.Class.extend({size:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},active:true,allowDraw:true,isFocused:false,isPressing:false,onTouchStartBinded:null,init:function(x,y,settings){ig.merge(this,settings);this.pos.x=x;this.pos.y=y;},update:function(){if(ig.game.isClickBlockActive===true){this.isFocused=false;this.isPressing=false;return;}
if(this.active){var f=this.isMouseOver();if(!ig.ua.touchDevice){if(f&&!this.isFocused){this.onMouseOver();}
if(!f&&this.isFocused){this.onMouseOut();}}
this.isFocused=f;if(this.isFocused&&ig.input.pressed("left_mouse")){this.onPress();}else if(this.isFocused&&ig.input.released("left_mouse")){this.onRelease();}
this.isPressing=ig.input.state("left_mouse")&&this.isFocused;}else{this.isFocused=false;this.isPressing=false;}},draw:function(){},isMouseOver:function(){var mX=ig.input.mouse.x-this.offset.x;var mY=ig.input.mouse.y-this.offset.y;var hSizeX=this.size.x/2;var hSizeY=this.size.y/2;return(mX>=this.pos.x-hSizeX&&mX<=this.pos.x+hSizeX&&mY>=this.pos.y-hSizeY&&mY<=this.pos.y+hSizeY);},onTouchStart:function(event){if(this.active&&this.isMouseOver()){this.onPress();}},onPress:function(){},onRelease:function(){},onMouseOver:function(){},onMouseOut:function(){},kill:function(){}});ig.UIButton=ig.Button.extend({size:{x:110,y:108},type:"",typePos:null,alpha:1,scale:1,stateScale:1,flipped:false,image:new ig.Image("media/images/gameui/ui-buttons.png"),clickHandler:null,init:function(x,y,settings){this.parent(x,y,settings);switch(this.type){case"play":this.typePos={x:0,y:0};break;case"arrow":this.typePos={x:0,y:1};break;case"close":this.typePos={x:0,y:2};break;case"mute":this.typePos={x:0,y:3};break;case"home":this.typePos={x:0,y:5};break;case"restart":this.typePos={x:0,y:6};break;case"help":this.typePos={x:0,y:7};break;case"skip":this.typePos={x:0,y:8};break;case"pause":this.typePos={x:1,y:0};break;case"sylvia":this.typePos={x:1,y:1};break;case"check":this.typePos={x:1,y:2};break;}},update:function(){this.parent();if(this.type=="mute"){this.typePos.y=ig.soundManager.muted?4:3;}},draw:function(){if(this.allowDraw){var imgData=this.image.data;var _w=this.size.x*this.scale*this.stateScale;var _h=this.size.y*this.scale*this.stateScale;var _x=this.pos.x-_w/2;var _y=this.pos.y-_h/2;var _cx=this.size.x*this.typePos.x;var _cy=this.size.y*this.typePos.y;ig.system.context.globalAlpha=this.alpha;if(this.flipped){ig.system.context.save();ig.system.context.scale(-1,1);_x=_x*-1-_w;}
ig.system.context.drawImage(imgData,_cx,_cy,this.size.x,this.size.y,_x,_y,_w,_h);if(this.flipped){ig.system.context.restore();}
ig.system.context.globalAlpha=1;ig.Image.drawCount++;}},onPress:function(){this.parent();ig.SFX.click.play();TweenMax.to(this,0.2,{stateScale:0.9,ease:"easeOutBack"});if(this.clickHandler!==null){this.clickHandler();}},onRelease:function(){TweenMax.to(this,0.2,{stateScale:1,ease:"easeOutBack"});},onMouseOver:function(){ig.SFX.roll.play();TweenMax.to(this,0.2,{stateScale:1.08,ease:"easeOutBack"});},onMouseOut:function(){TweenMax.to(this,0.2,{stateScale:1,ease:"easeOutBack"});},});ig.SylviaButton=ig.UIButton.extend({used:false,update:function(){if(this.used===false){this.parent();}},draw:function(){this.alpha=this.used===true?0.5:1;this.parent();},onPress:function(){if(this.used===false&&ig.game.sylvia===null){this.parent();this.onRelease();}}});});

// lib/display/overlays.js
ig.baked=true;ig.module('display.overlays').requires('display.displayobjects','display.buttons','impact.impact').defines(function(){"use strict";ig.Overlay=ig.Class.extend({children:[],name:"",_killed:false,init:function(settings){ig.merge(this,settings);},animateIn:function(){},animateOut:function(){},update:function(){var nChildren=this.children.length;for(var i=0;i<nChildren;i++){if(this._killed){return;}
if(this.children[i]){this.children[i].update();}}},draw:function(){ig.system.context.fillStyle="#000000";ig.system.context.globalAlpha=0.8;ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);ig.system.context.globalAlpha=1;var nChildren=this.children.length;for(var i=0;i<nChildren;i++){if(this.children[i]){this.children[i].draw();}}},isMouseOverEntity:function(ent){var mX=ig.input.mouse.x;var mY=ig.input.mouse.y;return(mX>=ent.pos.x&&mX<=ent.pos.x+ent.size.x&&mY>=ent.pos.y&&mY<=ent.pos.y+ent.size.y);},kill:function(){this._killed=true;var nChildren=this.children.length;for(var i=0;i<nChildren;i++){if(this.children[i]&&this.children[i].kill){this.children[i].kill();}}
this.children=null;}});ig.PauseOverlay=ig.Overlay.extend({playButton:null,helpButton:null,restartButton:null,homeButton:null,muteButton:null,textbox:null,init:function(settings){this.parent(settings);this.name="pauseOverlay";this.playButton=new ig.UIButton(ig.game.cp.x-250,ig.game.cp.y,{type:"play",clickHandler:ig.game.resumeLevel.bind(ig.game)});this.helpButton=new ig.UIButton(ig.game.cp.x-125,ig.game.cp.y,{type:"help",clickHandler:ig.game.showHelp.bind(ig.game)});this.restartButton=new ig.UIButton(ig.game.cp.x,ig.game.cp.y,{type:"restart",clickHandler:this.callRestart.bind(this)});this.homeButton=new ig.UIButton(ig.game.cp.x+125,ig.game.cp.y,{type:"home",clickHandler:this.callLevelSelect.bind(this)});this.muteButton=new ig.UIButton(ig.game.cp.x+250,ig.game.cp.y,{type:"mute",clickHandler:ig.soundManager.toggleMute.bind(ig.soundManager)});this.children.push(this.helpButton);this.children.push(this.restartButton);this.children.push(this.homeButton);this.children.push(this.muteButton);this.children.push(this.playButton);this.textbox=new ig.Textbox(ig.Strings.PAUSE,{fontSize:60,color:"#FFFFFF",align:"center"});},callRestart:function(){ig.game.restartLevel(true);},callLevelSelect:function(){ig.game.gotoLevelSelect(true);},update:function(){this.playButton.pos.x=ig.game.cp.x-250;this.helpButton.pos.x=ig.game.cp.x-125;this.restartButton.pos.x=ig.game.cp.x;this.homeButton.pos.x=ig.game.cp.x+125;this.muteButton.pos.x=ig.game.cp.x+250;this.parent();},draw:function(){this.parent();this.textbox.draw(ig.game.cp.x,ig.game.cp.y-106);}});ig.AreYouSureOverlay=ig.Overlay.extend({yesButton:null,noButton:null,textbox:null,yesHandler:null,noHandle:null,init:function(settings){this.parent(settings);this.name="areyousureOverlay";this.yesButton=new ig.UIButton(ig.game.cp.x-62,ig.game.cp.y,{type:"check",clickHandler:this.handleYes.bind(this)});this.noButton=new ig.UIButton(ig.game.cp.x+62,ig.game.cp.y,{type:"close",clickHandler:this.handleNo.bind(this)});this.children.push(this.yesButton);this.children.push(this.noButton);this.textbox=new ig.Textbox(ig.Strings.ARE_YOU_SURE,{fontSize:58,color:"#FFFFFF",align:"center"});},handleYes:function(){this.yesHandler();},handleNo:function(){this.noHandler();},update:function(){this.yesButton.pos.x=ig.game.cp.x-62;this.noButton.pos.x=ig.game.cp.x+62;this.parent();},draw:function(){this.parent();this.textbox.draw(ig.game.cp.x,ig.game.cp.y-106);}});ig.HelpOverlay=ig.Overlay.extend({closeButton:null,nextButton:null,backButton:null,instructions:new ig.Image("media/images/screens/instructions.png"),title:null,textbox:null,spaceKeyTextbox:null,_instructionsIndex:0,pages:[{img:[654,217,670,189,28,0],text:ig.Strings.INSTRUCTIONS_A},{img:[0,275,644,225,15,0],text:ig.Strings.INSTRUCTIONS_H},{img:[644,406,492,101,97,49],text:ig.Strings.INSTRUCTIONS_B},{img:[1136,406,188,101,240,70],text:ig.Strings.INSTRUCTIONS_G}],init:function(settings){this.parent(settings);this.name="helpOverlay";this.closeButton=new ig.UIButton(ig.system.width-80,80,{type:"close",clickHandler:ig.game.pauseLevel.bind(ig.game)});this.nextButton=new ig.UIButton(ig.system.width-80,ig.game.cp.y,{type:"arrow",clickHandler:this.next.bind(this)});this.backButton=new ig.UIButton(80,ig.game.cp.y,{type:"arrow",clickHandler:this.previous.bind(this)});this.backButton.flipped=true;this.children.push(this.closeButton);this.children.push(this.nextButton);this.children.push(this.backButton);this.title=new ig.Textbox(ig.Strings.INSTRUCTIONS_HOW_TO,{fontSize:38,align:"center",baseline:"middle",color:"#FFFFFF"});this.spaceKeyTextbox=new ig.Textbox(ig.Strings.INSTRUCTIONS_SPACE_KEY,{fontSize:22,color:"#FFFFFF",baseline:"middle",align:"center"});this.changeHelp();},next:function(){this._instructionsIndex++;this.changeHelp();},previous:function(){this._instructionsIndex--;this.changeHelp();},changeHelp:function(){var stringData=this.pages[this._instructionsIndex].text;this.textbox=new ig.Textbox(stringData,{fontSize:28,align:"center",baseline:"middle",color:"#FFFFFF"});this.instructionsImageData=this.pages[this._instructionsIndex].img;this.backButton.active=this._instructionsIndex>0;this.backButton.alpha=this.backButton.active?1:0.5;this.nextButton.active=this._instructionsIndex<this.pages.length-1;this.nextButton.alpha=this.nextButton.active?1:0.5;},update:function(){this.closeButton.pos.x=ig.system.width-80;this.nextButton.pos.x=ig.system.width-80;this.parent();},draw:function(){this.parent();this.title.draw(ig.game.cp.x,ig.game.cp.y-215);if(this.instructionsImageData!==false){var data=this.instructionsImageData;ig.system.context.drawImage(this.instructions.data,data[0],data[1],data[2],data[3],ig.game.cp.x-334+data[4],ig.game.cp.y-180+data[5],data[2],data[3]);}
if(this._instructionsIndex==2){this.spaceKeyTextbox.draw(ig.game.cp.x-90,ig.game.cp.y-82);}
this.textbox.draw(ig.game.cp.x,ig.game.cp.y+106);}});});

// lib/display/preloaders.js
ig.baked=true;ig.module('display.preloaders').requires('impact.game').defines(function(){ig.Preloader=ig.Loader.extend({blackAlpha:1,logoY:1000,barY:1000,loadCount:0,load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
this.logoY=ig.system.realHeight;this.barY=ig.system.realHeight+100;ig.tabletOrientationImage=new Image();ig.tabletOrientationImage.src=ig.prefix+"media/images/orientation_tablet.png";ig.mobileOrientationImage=new Image();ig.mobileOrientationImage.src=ig.prefix+"media/images/orientation_mobile.png";var self=this;ig.loadImage=new Image();ig.loadImage.src=ig.prefix+"media/images/backgrounds/loader-background.jpg";ig.loadImage.onload=function(){self.startLoadHandler();};ig.logo=new Image();ig.logo.src=ig.prefix+"media/images/localized/logo.png";ig.logo.onload=function(){self.startLoadHandler();};this._intervalId=setInterval(this.draw.bind(this),16);},startLoadHandler:function(){this.loadCount++;if(this.loadCount>=2){TweenMax.to(this,0.75,{blackAlpha:0,ease:"easeOutQuad"});TweenMax.to(this,0.7,{delay:0.2,logoY:ig.system.realHeight/2-302,ease:"easeOutBack",onComplete:this.loadAll,onCompleteScope:this});TweenMax.to(this,0.4,{delay:0.6,barY:ig.system.realHeight/2+165,ease:"easeOutBack"});}},loadAll:function(){for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}},draw:function(){var RW=ig.system.realWidth;var RH=ig.system.realHeight;var ctx=ig.system.context;ctx.fillStyle='#000000';ctx.fillRect(0,0,RW,RH);if(window.innerHeight>window.innerWidth&&(GameStartup.ua.tablet||GameStartup.ua.mobile)){var oImage;if(GameStartup.ua.mobile){oImage=ig.mobileOrientationImage;}else{oImage=ig.tabletOrientationImage;}
var oWidth=window.innerWidth<oImage.width?window.innerWidth:oImage.width;var oHeight=oImage.height*(oWidth/oImage.width);ctx.drawImage(oImage,ig.system.realWidth/2-oWidth/2,ig.system.realHeight/2-oHeight/2,oWidth,oHeight);return;}
ctx.drawImage(ig.loadImage,(RW*0.5)-(ig.loadImage.width*0.5),(RH*0.5)-(ig.loadImage.height*0.5));ctx.drawImage(ig.logo,(RW*0.5)-(ig.logo.width*0.5),this.logoY);var w=930;var h=74;var x=(RW*0.5)-w/2;var y=this.barY-h/2;var r=h/2;ctx.save();ctx.fillStyle="#f58234";ctx.strokeStyle="#000000";ctx.lineWidth=8;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.arc(x+w-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.stroke();ctx.fill();ctx.restore();w-=18;h-=18;x=(RW*0.5)-w/2;y=this.barY-h/2;r=h/2;this._drawStatus+=(this.status-this._drawStatus)/5;var pw=w*this._drawStatus;if(pw<r*2){pw=r*2;}
ctx.save();ctx.fillStyle="#FFFFFF";ctx.lineWidth=8;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+pw-r,y);ctx.arc(x+pw-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.fill();ctx.restore();if(this.blackAlpha>0){ctx.globalAlpha=this.blackAlpha;ctx.fillStyle='#000000';ctx.fillRect(0,0,RW,RH);ctx.globalAlpha=1;}},end:function(){TweenMax.delayedCall(0.8,this.parent,null,this);TweenMax.to(this,1,{delay:0.1,logoY:ig.system.realHeight+200,ease:"easeInOutBack"});TweenMax.to(this,1,{barY:ig.system.realHeight+300,ease:"easeInOutBack"});}});ig.Miniloader=ig.Loader.extend({draw:function(dx,dy){var ctx=ig.system.context;var w=250;var h=20;var x=dx-w/2;var y=dy-h/2;var r=h/2;ctx.save();ctx.fillStyle="#f58234";ctx.strokeStyle="#000000";ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.arc(x+w-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.stroke();ctx.fill();ctx.restore();w-=6;h-=6;x=dx-w/2;y=dy-h/2;r=h/2;this._drawStatus+=(this.status-this._drawStatus)/5;var pw=w*this._drawStatus;if(pw<r*2){pw=r*2;}
ctx.save();ctx.fillStyle="#FFFFFF";ctx.lineWidth=8;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+pw-r,y);ctx.arc(x+pw-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.fill();ctx.restore();},end:function(){this.parent();this.callback();},callback:function(){}});});

// lib/display/screens.js
ig.baked=true;ig.module('display.screens').requires('display.preloaders','display.displayobjects','display.buttons','impact.impact').defines(function(){"use strict";ig.Screen=ig.Class.extend({children:[],name:"",rw:0,rh:0,bgImage:null,init:function(settings){ig.merge(this,settings);this.rw=ig.system.realWidth;this.rh=ig.system.realHeight;},animateIn:function(){},update:function(){this.rw=ig.system.realWidth;this.rh=ig.system.realHeight;if(this.children){var nChildren=this.children.length;for(var i=0;i<nChildren;i++){if(this.children[i]){this.children[i].update();}}}},draw:function(){this.drawBackground();this.drawChildren();},drawBackground:function(){if(this.bgImage!==null){this.bgImage.draw(ig.game.cp.x-(this.bgImage.width*0.5),ig.game.cp.y-(this.bgImage.height*0.5));}},drawChildren:function(){var nChildren=this.children.length;for(var i=0;i<nChildren;i++){if(this.children[i]){this.children[i].draw();}}},isMouseOverEntity:function(ent){var mX=ig.input.mouse.x;var mY=ig.input.mouse.y;return(mX>=ent.pos.x&&mX<=ent.pos.x+ent.size.x&&mY>=ent.pos.y&&mY<=ent.pos.y+ent.size.y);},kill:function(){var nChildren=this.children.length;for(var i=0;i<nChildren;i++){if(this.children[i]&&this.children[i].kill){this.children[i].kill();}}
this.children=null;}});ig.StartScreen=ig.Screen.extend({playButton:null,muteButton:null,bgImage:new ig.Image("media/images/backgrounds/title-background.jpg"),loaderBg:new ig.Image("media/images/backgrounds/loader-background.jpg"),title:new ig.Image("media/images/localized/game-title.png"),characters:new ig.Image("media/images/screens/start-characters.png"),logo:new ig.Image("media/images/localized/logo.png"),bgAlpha:1,init:function(settings){this.parent(settings);this.name="start";this.playButton=new ig.UIButton(this.rw-80,this.rh+200,{type:"play",clickHandler:this.startButtonClickHandler.bind(this)});this.muteButton=new ig.UIButton(this.rw-80,-200,{type:"mute",scale:0.87,clickHandler:ig.soundManager.toggleMute.bind(ig.soundManager)});this.children.push(this.muteButton);this.children.push(this.playButton);this.title.x=-this.title.width/2+4;this.title.y=this.rh/2;this.characters.x=-320;this.characters.y=this.rh/2;this.logo.x=36;this.logo.y=this.rh/-2-170;},animateIn:function(withBGFade){var d=withBGFade===true?0.5:0;TweenMax.to(this.title,0.75,{delay:d,y:-50,ease:"easeOutBack"});TweenMax.to(this.characters,0.75,{delay:d,y:-368,ease:"easeOutBack"});TweenMax.to(this.logo,0.75,{delay:d,y:23,ease:"easeOutCubic"});TweenMax.to(this.playButton.pos,0.75,{delay:d,y:this.rh-80,ease:"easeOutCubic"});TweenMax.to(this.muteButton.pos,0.75,{delay:d,y:80,ease:"easeOutCubic"});if(withBGFade===true){this.bgAlpha=0;TweenMax.to(this,0.5,{delay:d,bgAlpha:1,ease:"easeInOutQuad"});}},update:function(){this.parent();this.playButton.pos.x=this.rw-80;this.muteButton.pos.x=this.rw-80;},draw:function(){this.drawBackground();this.characters.draw(ig.game.cp.x+this.characters.x,ig.game.cp.y+this.characters.y);this.title.draw(ig.game.cp.x+this.title.x,ig.game.cp.y+this.title.y);ig.system.context.drawImage(this.logo.data,this.logo.x,this.logo.y,247,169);ig.Image.drawCount++;this.drawChildren();},drawBackground:function(){if(this.bgAlpha!=1){this.loaderBg.draw(ig.game.cp.x-(this.loaderBg.width*0.5),ig.game.cp.y-(this.loaderBg.height*0.5));ig.system.context.globalAlpha=this.bgAlpha;this.parent();ig.system.context.globalAlpha=1;}else{this.parent();}},startButtonClickHandler:function(){ig.game.requestNewScreen(ig.SCREENS.INTRO);}});ig.IntroScreen=ig.Screen.extend({skipButton:null,nextButton:null,backButton:null,bgImage:new ig.Image("media/images/intro/intro_bg.jpg"),mrPeepers:{x:0,y:354,sprite:null,allowDraw:false},wander:{x:2000,y:218,img:new ig.Image("media/images/intro/wandersylvia.png")},textbox1:{x:40,y:22,textbox:null},textbox2:{x:1600,y:22,textbox:null},introPageIndex:0,animating:false,bgXPos:0,screenOffset:0,init:function(settings){this.parent(settings);this.name="intro";this.skipButton=new ig.UIButton(this.rw-80,80,{type:"close",scale:0.87,clickHandler:this.skipButtonClickHandler.bind(this)});this.nextButton=new ig.UIButton(this.rw-80,this.rh-80,{type:"arrow",clickHandler:this.handleNextButton.bind(this)});this.backButton=new ig.UIButton(80,this.rh-80,{type:"arrow",clickHandler:this.handleBackButton.bind(this),flipped:true});this.children.push(this.skipButton);this.children.push(this.nextButton);this.children.push(this.backButton);this.mrPeepers.sprite=new ig.Sprite(ig.game.screensSpritesheet,425,716,83,162);this.textbox1.textbox=new ig.Textbox(ig.Strings.INTRO_TEXT_1,{fontSize:40,color:"#FFFFFF",baseline:"top"});this.textbox2.textbox=new ig.Textbox(ig.Strings.INTRO_TEXT_2,{fontSize:40,color:"#FFFFFF",baseline:"top"});},update:function(){this.backButton.active=this.introPageIndex>0;this.backButton.allowDraw=this.backButton.active;this.parent();this.skipButton.pos.x=this.rw-80;this.nextButton.pos.x=this.rw-80;},draw:function(){this.screenOffset=(1364-ig.system.realWidth)/-2;this.drawBackground();if(this.mrPeepers.allowDraw){this.mrPeepers.sprite.draw(this.mrPeepers.x+this.screenOffset,this.mrPeepers.y);}
this.wander.img.draw(this.wander.x+this.screenOffset,this.wander.y);this.textbox1.textbox.draw(this.textbox1.x,this.textbox1.y);this.textbox2.textbox.draw(this.textbox2.x,this.textbox2.y);this.drawChildren();},drawBackground:function(){this.bgImage.draw(this.bgXPos+this.screenOffset,0);},skipButtonClickHandler:function(){ig.game.requestNewScreen(ig.SCREENS.LEVEL_SELECT);},handleNextButton:function(){if(this.animating===true){return;}
if(this.introPageIndex<1){this.introPageIndex++;this.switchPages();}else{ig.game.requestNewScreen(ig.SCREENS.LEVEL_SELECT);}},handleBackButton:function(){if(this.animating===true){return;}
this.introPageIndex--;this.switchPages();},switchPages:function(){this.animating=true;switch(this.introPageIndex){case 1:TweenMax.to(this,2,{bgXPos:-788,ease:"easeInOutCubic"});TweenMax.to(this.textbox1,2,{x:-1364,ease:"easeInOutCubic"});TweenMax.to(this.textbox2,2,{x:40,ease:"easeInOutCubic"});TweenMax.to(this.wander,2,{delay:1,x:607,ease:"easeInOutCubic",onComplete:function(){this.animating=false;},onCompleteScope:this});TweenMax.delayedCall(1.5,this.slidePeepersIn,null,this);break;case 0:TweenMax.to(this,2,{bgXPos:0,ease:"easeInOutCubic",onComplete:function(){this.animating=false;},onCompleteScope:this});TweenMax.to(this.textbox1,2,{x:40,ease:"easeInOutCubic"});TweenMax.to(this.textbox2,2,{x:1600,ease:"easeInOutCubic"});TweenMax.to(this.wander,2,{x:2000,ease:"easeInOutCubic"});TweenMax.to(this.mrPeepers,0.25,{x:-100,ease:"easeInCubic"});break;}},slidePeepersIn:function(){this.mrPeepers.allowDraw=true;this.mrPeepers.x=-100;TweenMax.to(this.mrPeepers,1,{x:156,ease:"easeInOutCubic"});}});ig.LevelSelectScreen=ig.Screen.extend({backButton:null,headline:null,bgImage:new ig.Image("media/images/backgrounds/level-select-background.jpg"),bubbles:[],bubblePlacements:[[{x:-164,y:-20},{x:-320,y:-115},{x:-344,y:-154},{x:-344,y:-154}],[{x:238,y:-72,s:1},{x:202,y:-60},{x:285,y:-90},{x:368,y:-170}],[{x:120,y:212,s:0.85},{x:-168,y:230,s:0.85},{x:-120,y:174},{x:-248,y:160}],[{x:386,y:185,s:0.62},{x:182,y:244,s:0.62},{x:350,y:168,s:0.62},{x:200,y:184}]],taskBubblePlacements:[[{x:-174,y:-160},{x:-212,y:185}],[{x:-214,y:-95},{x:-240,y:150},{x:236,y:-52}],[{x:-266,y:-80},{x:-180,y:126},{x:85,y:-278},{x:238,y:-4}],[{x:-232,y:-85},{x:-184,y:112},{x:-118,y:-220},{x:215,y:-124},{x:228,y:82}]],init:function(settings){this.parent(settings);this.name="levelSelect";this.backButton=new ig.UIButton(80,this.rh-80,{type:"arrow",clickHandler:this.handleBackButton.bind(this)});this.backButton.flipped=true;this.children.push(this.backButton);this.headline=new ig.Textbox(ig.Strings.LEVEL_SELECT_TITLE,{fontSize:36,align:"center"});this.addLevelBubbles();},addLevelBubbles:function(){var lastLevel=ig.userDataManager.getLastUnlockedLevel();var i,pos;for(i=0;i<ig.LevelData.length;i++){pos=this.bubblePlacements[i][lastLevel];this.bubbles[i]=new ig.LevelBubble({pos:pos},i);this.children.push(this.bubbles[i]);}
var lastLevelPos=this.bubblePlacements[lastLevel][lastLevel];var placements=this.taskBubblePlacements[lastLevel];for(i=0;i<ig.LevelData[lastLevel].tasks.length;i++){pos={x:lastLevelPos.x+placements[i].x,y:lastLevelPos.y+placements[i].y};this.children.push(new ig.LevelTaskBubble({pos:pos},ig.LevelData[lastLevel].tasks[i].type));}
if(ig.LevelData[lastLevel].isEggLevel===true){pos={x:lastLevelPos.y+placements[4].x,y:lastLevelPos.y+placements[4].y};this.children.push(new ig.LevelTaskBubble({pos:pos},"egg"));}},handleBackButton:function(){ig.game.requestNewScreen(ig.SCREENS.START);},update:function(){this.parent();if(ig.input.pressed("left_mouse")){for(var i=0;i<this.bubbles.length;i++){if(this.bubbles[i].isLevelUnlocked&&this.bubbles[i].isMouseOver()){ig.SFX.click.play();ig.game.gotoLevel(this.bubbles[i].levelIndex);break;}}}},draw:function(){this.parent();this.headline.draw(ig.game.cp.x,ig.game.cp.y-276);}});ig.LevelStartScreen=ig.Screen.extend({dayText:null,goalText:null,playButton:null,bgImage:new ig.Image("media/images/backgrounds/level-start-background.jpg"),wander:new ig.Image("media/images/screens/level-wander.png"),sylvia:new ig.Image("media/images/screens/level-sylvia.png"),taskObjects:[],numTaskObjects:0,numTaskForLevel:0,loader:null,init:function(settings){this.parent(settings);this.name="levelstart";this.wander.x=ig.system.width/-2-508;this.sylvia.x=ig.system.width/2;this.playButton=new ig.UIButton(ig.game.cp.x,595,{type:"play",clickHandler:ig.game.fadeToLevel.bind(ig.game)});this.dayText=new ig.Textbox(ig.Strings.LEVEL_START_DAY,{fontSize:60,align:"center"});this.dayText.replace("%n",ig.game.levelIndex+1);this.goalText=new ig.Textbox(ig.Strings.LEVEL_START_GOAL,{fontSize:36,align:"center",color:"#FFFFFF"});this.getTaskObjects();ig.resources=[];ig.ready=false;ig.game.buildLevel();ig.ready=true;this.loader=new ig.Miniloader(null,ig.resources);this.loader.callback=this.levelReady.bind(this);this.loader.load();},levelReady:function(){this.loader=null;this.children.push(this.playButton);},animateIn:function(){TweenMax.to(this.wander,0.5,{x:-704,ease:"easeOutCubic"});TweenMax.to(this.sylvia,0.5,{x:278,ease:"easeOutCubic"});},getTaskObjects:function(){this.numTaskForLevel=ig.LevelData[ig.game.levelIndex].tasks.length;for(var i=0;i<this.numTaskForLevel;i++){var task=ig.LevelData[ig.game.levelIndex].tasks[i];this.taskObjects.push(new ig.LevelTaskCount(task.type,task.count));}
if(ig.LevelData[ig.game.levelIndex].isEggLevel===true){this.taskObjects.push(new ig.LevelTaskCount(ig.TASK_TYPES.EGG,1));}
this.numTaskObjects=this.taskObjects.length;},update:function(){this.playButton.pos.x=ig.game.cp.x;this.parent();},draw:function(){this.parent();this.dayText.draw(ig.game.cp.x,ig.game.cp.y-106);this.goalText.draw(ig.game.cp.x,ig.game.cp.y-44);for(var i=0;i<this.numTaskObjects;i++){this.taskObjects[i].draw();}
this.wander.draw(ig.game.cp.x+this.wander.x,ig.system.height-this.wander.height);this.sylvia.draw(ig.game.cp.x+this.sylvia.x,ig.system.height-this.sylvia.height);if(this.loader){this.loader.draw(ig.game.cp.x,595);}}});ig.LevelEndScreen=ig.Screen.extend({nextButton:null,scoreText:null,highscoreLabel:null,highscoreText:null,bgImage:new ig.Image("media/images/backgrounds/level-end-background.jpg"),wanderSylviaSprite:null,newHighscoreTextbox:null,newHighscoreImage:new ig.Image("media/images/screens/level-end-highscore.png"),stars:new ig.Image("media/images/screens/end-level-stars.png"),drawHighScoreAlert:false,hsScale:0,starLevel:0,numTaskForLevel:0,taskSprites:{},taskPositions:{flowers:[-57,139],bunnies:[-302,62],pigmen:[-468,-122],egg:[252,-174],rockbabies:[190,75]},init:function(settings){this.parent(settings);this.name="levelend";this.wanderSylviaSprite=new ig.Sprite(ig.game.screensSpritesheet,738,442,222,415);this.nextButton=new ig.UIButton(this.rw-80,this.rh-80,{type:"arrow",clickHandler:this.handleNextButton.bind(this)});this.children.push(this.nextButton);this.scoreText=new ig.Textbox(ig.Strings.LEVEL_END_SCORE,{fontSize:75,align:"center"});this.scoreText.replace("%n",ig.levelManager.levelScore);this.starLevel=Math.floor(ig.levelManager.levelScore/40000);if(this.starLevel>3){this.starLevel=3;}
this.highscoreLabel=new ig.Textbox(ig.Strings.LEVEL_END_HIGHSCORE_LABEL,{fontSize:22,align:"center",color:"#FFFFFF"});this.highscoreText=new ig.Textbox(ig.Strings.LEVEL_END_HIGHSCORE,{fontSize:45,align:"center",color:"#FFFFFF"});this.highscoreText.replace("%n",ig.userDataManager.data[ig.game.levelIndex].highscore);this.newHighscoreTextbox=new ig.Textbox(ig.Strings.LEVEL_END_NEWHIGHSCORE,{fontSize:22,align:"center",baseline:"middle",leading:24,color:"#FFFFFF"});this.newHighscoreTextbox.shadowColor=null;this.numTaskForLevel=ig.LevelData[ig.game.levelIndex].tasks.length;this.taskSprites.flowers=new ig.Sprite(ig.game.screensSpritesheet,508,716,230,155);this.taskSprites.bunnies=new ig.Sprite(ig.game.screensSpritesheet,0,718,179,235);this.taskSprites.pigmen=new ig.Sprite(ig.game.screensSpritesheet,376,457,214,169);this.taskSprites.rockbabies=new ig.Sprite(ig.game.screensSpritesheet,536,626,125,89);this.taskSprites.egg=new ig.Sprite(ig.game.screensSpritesheet,179,718,246,222);if(ig.levelManager.levelScore==ig.userDataManager.data[ig.game.levelIndex].highscore){this.drawHighScoreAlert=true;TweenMax.to(this,1,{delay:0.5,hsScale:1,ease:"easeOutElastic"});}},handleNextButton:function(){ig.game.requestNewScreen(ig.SCREENS.LEVEL_SELECT);},update:function(){this.nextButton.pos.x=ig.system.width-80;this.parent();},draw:function(){this.parent();this.scoreText.draw(ig.game.cp.x,ig.game.cp.y-22);this.highscoreLabel.draw(ig.game.cp.x,ig.game.cp.y+36);this.highscoreText.draw(ig.game.cp.x,ig.game.cp.y+94);var position;for(var i=0;i<this.numTaskForLevel;i++){var taskType=ig.LevelData[ig.game.levelIndex].tasks[i].type;position=this.taskPositions[taskType];this.taskSprites[taskType].draw(ig.game.cp.x+position[0],ig.game.cp.y+position[1]);}
if(ig.LevelData[ig.game.levelIndex].isEggLevel===true){position=this.taskPositions[ig.TASK_TYPES.EGG];this.taskSprites[ig.TASK_TYPES.EGG].draw(ig.game.cp.x+position[0],ig.game.cp.y+position[1]);}
this.stars.drawTile(ig.game.cp.x-this.stars.width/2,ig.game.cp.y-355,this.starLevel,415,225);this.wanderSylviaSprite.draw(ig.game.cp.x-582,ig.game.cp.y-50);if(this.drawHighScoreAlert===true&&this.hsScale>0){ig.system.context.save();ig.system.context.translate(ig.game.cp.x-330,ig.game.cp.y-214);ig.system.context.scale(this.hsScale,this.hsScale);this.newHighscoreImage.draw(this.newHighscoreImage.width/-2,this.newHighscoreImage.height/-2);this.newHighscoreTextbox.draw(0,0);ig.system.context.restore();}}});ig.TryAgainScreen=ig.Screen.extend({restartButton:null,homeButton:null,tryAgainText:null,bgImage:new ig.Image("media/images/backgrounds/level-end-background.jpg"),init:function(settings){this.parent(settings);this.name="tryagain";this.restartButton=new ig.UIButton(ig.game.cp.x-68,ig.game.cp.y+72,{type:"restart",clickHandler:ig.game.restartLevel.bind(ig.game)});this.homeButton=new ig.UIButton(ig.game.cp.x+68,ig.game.cp.y+72,{type:"home",clickHandler:this.handleButton.bind(this)});this.children.push(this.restartButton);this.children.push(this.homeButton);this.tryAgainText=new ig.Textbox(ig.Strings.TRY_AGAIN,{fontSize:76,align:"center"});},handleButton:function(){ig.game.requestNewScreen(ig.SCREENS.LEVEL_SELECT);},update:function(){this.restartButton.pos.x=ig.game.cp.x-68;this.homeButton.pos.x=ig.game.cp.x+68;this.parent();},draw:function(){this.parent();this.tryAgainText.draw(ig.game.cp.x,ig.game.cp.y-43);}});ig.WinScreen=ig.Screen.extend({homeButton:null,title:null,copy:null,scoreLabel:null,score:null,bgImage:new ig.Image("media/images/backgrounds/level-end-background.jpg"),wanderSylvia:new ig.Image("media/images/screens/win-wandersylvia.png"),hater:new ig.Image("media/images/screens/win-hater.png"),init:function(settings){this.parent(settings);this.name="win";this.homeButton=new ig.UIButton(ig.game.cp.x,ig.game.cp.y+195,{type:"home",clickHandler:this.handleButton.bind(this)});this.children.push(this.homeButton);this.title=new ig.Textbox(ig.Strings.WIN_TITLE,{fontSize:50,align:"center"});this.copy=new ig.Textbox(ig.Strings.WIN_COPY,{fontSize:30,align:"center",baseline:"top"});this.title.shadowColor=this.copy.shadowColor=null;this.scoreLabel=new ig.Textbox(ig.Strings.WIN_SCORE_LABEL,{fontSize:22,align:"center",color:"#FFFFFF"});var finalScore=0;for(var i=0;i<ig.userDataManager.data.length;i++){finalScore+=ig.userDataManager.data[i].highscore;}
this.score=new ig.Textbox(ig.Strings.WIN_SCORE,{fontSize:46,align:"center",color:"#FFFFFF"});this.score.replace("%n",finalScore);},handleButton:function(){ig.game.requestNewScreen(ig.SCREENS.LEVEL_SELECT);},update:function(){this.homeButton.pos.x=ig.game.cp.x;this.parent();},draw:function(){this.parent();this.wanderSylvia.draw(ig.game.cp.x-535,ig.system.realHeight-this.wanderSylvia.height);this.hater.draw(ig.game.cp.x+152,218);this.title.draw(ig.game.cp.x,ig.game.cp.y-102);this.copy.draw(ig.game.cp.x,ig.game.cp.y-83);this.scoreLabel.draw(ig.game.cp.x,ig.game.cp.y+54);this.score.draw(ig.game.cp.x,ig.game.cp.y+110);}});});

// lib/display/game-ui.js
ig.baked=true;ig.module('display.game-ui').requires('display.sprite','display.buttons','impact.animation','impact.impact').defines(function(){ig.GameUI=ig.Class.extend({muteButton:null,pauseButton:null,nextButton:null,sylviaPowerups:[],bottombar:null,scorebar:null,sylviaAnimation:null,sylviaEggSheet:new ig.AnimationSheet("media/images/gameui/sylvia-egg.png",158,260),eggAlertTimer:0,eggAlertScale:0,eggAlertActive:false,eggAlertTextbox:null,eggAlert:new ig.Image("media/images/gameui/egg-alert.png"),arrowSprite:null,arrowTargetX:-1,arrowTargetY:-1,egg:new ig.Image("media/images/gameui/egg.png"),dayCompleteTextbox:null,dayCompleteTextboxProps:{scale:0,y:0,alpha:0},_instructionsIndex:0,_isOnInstructions:false,spaceKeyTextbox:null,instructions:new ig.Image("media/images/screens/instructions.png"),instructionsTextBox:null,instructionsImageData:false,instructionsData:[[{img:[654,217,670,189,28,0],text:ig.Strings.INSTRUCTIONS_A},{img:[644,406,492,101,97,49],text:ig.Strings.INSTRUCTIONS_B},{img:[654,0,648,217,23,0],text:ig.Strings.INSTRUCTIONS_C}],[{img:[1302,0,460,147,127,64],text:ig.Strings.INSTRUCTIONS_D},],[{img:[0,0,654,275,0,10],text:ig.Strings.INSTRUCTIONS_E},],[{img:[1324,147,186,265,240,9],text:ig.Strings.INSTRUCTIONS_F},]],clickHappenedThisUpdate:false,buttonChecks:[],init:function(settings){ig.merge(this,settings);var rw=ig.system.realWidth;this.bottomBarWidth=rw;this.pauseButton=new ig.UIButton(rw-80,80,{type:"pause",clickHandler:ig.game.pauseLevel.bind(ig.game)});this.muteButton=new ig.UIButton(rw-80,184,{type:"mute",scale:0.87,clickHandler:ig.soundManager.toggleMute.bind(ig.soundManager)});this.nextButton=new ig.UIButton(ig.game.cp.x,ig.game.cp.y+164,{type:"play",clickHandler:this.advanceHelp.bind(this)});this.buttonChecks.push(this.pauseButton);this.buttonChecks.push(this.muteButton);this.buttonChecks.push(this.nextButton);this.addSylviaButtons();this.arrowSprite=new ig.Sprite(ig.game.gameSpritesheet,177,0,64,86);this.sylviaIdleAnimation=new ig.Animation(this.sylviaEggSheet,1,[0]);this.sylviaOffAnimation=new ig.Animation(this.sylviaEggSheet,0.08,[0,2,3,5]);this.bottombar=new ig.GameUIBottomBar();this.scorebar=new ig.GameUIScore();this.spaceKeyTextbox=new ig.Textbox(ig.Strings.INSTRUCTIONS_SPACE_KEY,{fontSize:22,color:"#FFFFFF",baseline:"middle",align:"center"});this.eggAlertTextbox=new ig.Textbox(ig.Strings.EGG_ALERT,{fontSize:34,align:"center",baseline:"middle",color:"#FFFFFF"});this.eggAlertTextbox.shadowColor=null;ig.gameUI=this;},reset:function(){for(var i=0;i<this.sylviaPowerups.length;i++){this.sylviaPowerups[i].used=false;}
this.dayCompleteTextbox=null;this.bottombar.reset();this.scorebar.reset();},addSylviaButtons:function(){for(var i=0;i<3;i++){this.sylviaPowerups[i]=new ig.SylviaButton(80,ig.game.cp.y-106+102*i,{type:"sylvia",clickHandler:ig.game.activateSylvia.bind(ig.game)});this.buttonChecks.push(this.sylviaPowerups[i]);}},addSylvia:function(){for(var i=this.sylviaPowerups.length-1;i>=0;i--){if(this.sylviaPowerups[i].used===true){this.sylviaPowerups[i].used=false;return;}}},removeSylvia:function(){if(this.eggAlertActive){this.skrinkEggAlert();}
for(var i=0;i<this.sylviaPowerups.length;i++){if(this.sylviaPowerups[i].used===false){this.sylviaPowerups[i].used=true;return;}}},showDayComplete:function(){this.dayCompleteTextbox=new ig.Textbox(ig.Strings.DAY_COMPLETE,{fontSize:58,align:"center",baseline:"middle"});this.dayCompleteTextbox.replace("%n",ig.game.levelIndex+1);this.dayCompleteTextboxProps.scale=0;this.dayCompleteTextboxProps.y=ig.game.cp.y;this.dayCompleteTextboxProps.alpha=0;TweenMax.to(this.dayCompleteTextboxProps,0.5,{scale:1,y:116,alpha:1,ease:"easeOutBounce"});},update:function(){if(ig.game.levelExists===false||ig.game.currentOverlay!==null){return;}
this.pauseButton.pos.x=ig.system.realWidth-80;this.muteButton.pos.x=ig.system.realWidth-80;this.nextButton.pos.x=ig.game.cp.x;this.bottombar.update();if(ig.game.levelPaused===true){if(this._isOnInstructions===true){this.pauseButton.update();this.muteButton.update();this.nextButton.update();}
return;}
this.clickHappenedThisUpdate=false;this.scorebar.update();this.sylviaOffAnimation.update();this.pauseButton.update();this.muteButton.update();for(var i=0;i<3;i++){this.sylviaPowerups[i].update();}
if(ig.input.pressed("left_mouse")){var n=this.buttonChecks.length;for(var j=0;j<n;j++){if(this.buttonChecks[j].active===true&&this.buttonChecks[j].isMouseOver()){this.clickHappenedThisUpdate=true;break;}}}},draw:function(){if(ig.game.levelExists===false||ig.game.currentOverlay!==null){return;}
if(ig.levelManager.closestTask===null&&ig.levelManager.isEggLevel){this.drawEggArrow();}else{this.drawArrow();}
if(this._isOnInstructions===true){this.drawStartInstructions();}
this.pauseButton.draw();this.muteButton.draw();this.nextButton.draw();for(var i=0;i<3;i++){this.sylviaPowerups[i].draw();}
this.scorebar.draw();this.bottombar.draw();if(ig.levelManager.isEggLevel){this.drawEggMeter();}
if(this.dayCompleteTextbox!==null){ig.system.context.save();ig.system.context.globalAlpha=this.dayCompleteTextboxProps.alpha;ig.system.context.translate(ig.game.cp.x,this.dayCompleteTextboxProps.y);ig.system.context.scale(this.dayCompleteTextboxProps.scale,this.dayCompleteTextboxProps.scale);this.dayCompleteTextbox.draw(0,0);ig.system.context.restore();}},popEggAlert:function(){this.eggAlertTimer=2.5;this.eggAlertActive=true;TweenMax.to(this,0.5,{eggAlertScale:1,ease:"easeOutBack"});},skrinkEggAlert:function(){this.eggAlertActive=false;TweenMax.to(this,0.25,{eggAlertScale:0,ease:"easeInBack"});},drawEggMeter:function(){if(this.eggAlertScale>0){ig.system.context.save();ig.system.context.translate(ig.system.width-142,525);ig.system.context.scale(this.eggAlertScale,this.eggAlertScale);this.eggAlert.draw(-this.eggAlert.width,this.eggAlert.height/-2);this.eggAlertTextbox.draw(-346,-8);ig.system.context.restore();if(this.eggAlertActive===true){this.eggAlertTimer-=ig.system.tick;if(this.eggAlertTimer<=0){this.skrinkEggAlert();}}}
var tile=Math.floor(ig.game.eggWarmth*9);this.egg.drawTile(ig.system.width-150,ig.system.height-260,tile,164,196);if(ig.game.sylvia===null){this.sylviaIdleAnimation.draw(ig.system.width-155,ig.system.height-420);}else{if(this.sylviaOffAnimation.loopCount<1){this.sylviaOffAnimation.draw(ig.system.width-155,ig.system.height-420);}}},drawArrow:function(){if(ig.game.player===null){return;}
var x=-1,y=-1;if(ig.game.player.isCarryingRock){var mama=ig.levelManager.rockMama;if(!ig.game.isEntityOnScreen(mama)){x=mama.pos.x+mama.size.x/2;y=mama.pos.y+mama.size.y/2;}else{return;}}else if(ig.game.player.numPigInTow>0){if(ig.game.screen.x>2372&&ig.game.screen.y>928){return;}else{x=4150;y=1714;}}else if(ig.levelManager.closestTask!==null){if(!ig.game.isEntityOnScreen(ig.levelManager.closestTask)){x=ig.levelManager.closestTask.pos.x+ig.levelManager.closestTask.size.x/2;y=ig.levelManager.closestTask.pos.y+ig.levelManager.closestTask.size.y/2;}else{return;}}else{return;}
var tX=x-ig.game.screen.x;var tY=y-ig.game.screen.y;var paddingW=130;var paddingH=80;if(tX<paddingW){tX=paddingW;}else if(tX>ig.system.width-paddingW){tX=ig.system.width-paddingW;}
if(tY<paddingH){tY=paddingH;}else if(tY>ig.system.height-paddingH-this.bottombar.height){tY=ig.system.height-paddingH-this.bottombar.height;}
var rad=ig.game.player.angleToPoint({x:x,y:y})+Math.PI/-2;var ctx=ig.system.context;ctx.save();ctx.translate(Math.round(tX),Math.round(tY));ctx.rotate(rad);this.arrowSprite.draw(-32,-86);ctx.restore();},drawEggArrow:function(){var ctx=ig.system.context;ctx.save();ctx.translate(Math.round(ig.system.width-174),590);ctx.rotate(Math.PI/-2);this.arrowSprite.draw(-32,-86);ctx.restore();},endLevelInstructions:function(){this._isOnInstructions=false;this.nextButton.active=false;this.nextButton.allowDraw=false;ig.game.startLevel();},advanceHelp:function(){this._instructionsIndex++;if(this.instructionsData[ig.game.levelIndex][this._instructionsIndex]){this.changeInstructions();}else{this.endLevelInstructions();}},showLevelInstructions:function(){this._instructionsIndex=0;this.nextButton.allowDraw=true;this.nextButton.active=true;this._isOnInstructions=true;this.changeInstructions();},changeInstructions:function(){var stringData=this.instructionsData[ig.game.levelIndex][this._instructionsIndex].text;this.instructionsTextBox=new ig.Textbox(stringData,{fontSize:28,align:"center",baseline:"middle",color:"#FFFFFF"});this.instructionsImageData=this.instructionsData[ig.game.levelIndex][this._instructionsIndex].img;},drawStartInstructions:function(){var ctx=ig.system.context;ctx.globalAlpha=0.5;ctx.fillStyle="#000000";ctx.fillRect(0,0,ig.system.width,ig.system.height);ctx.globalAlpha=1;var offset=240;if(this.instructionsImageData!==false){var data=this.instructionsImageData;ctx.drawImage(this.instructions.data,data[0],data[1],data[2],data[3],ig.game.cp.x-334+data[4],ig.game.cp.y-324+data[5],data[2],data[3]);offset=data[5]+data[3]+20;if(offset<240){offset=240;}
if(this._instructionsIndex==1){this.spaceKeyTextbox.draw(ig.game.cp.x-106,ig.game.cp.y-228);}}
this.instructionsTextBox.draw(ig.game.cp.x,ig.game.cp.y-280+offset);}});ig.GameUIBottomBar=ig.Class.extend({width:0,height:118,drawCanvas:null,drawContext:null,drawY:0,timerText:null,timerTextShadow:null,taskImages:new ig.Image("media/images/gameui/bottom-bar-tasks.png"),numbers:new ig.Image("media/images/gameui/numbers.png"),_flagRedraw:false,init:function(){this.timerText=new ig.Textbox({string:"0:00"},{fontSize:62,align:"center",color:"#FFFFFF"});this.timerTextShadow=new ig.Textbox({string:"0:00"},{fontSize:62,align:"center",color:"#000000"});this.timerTextShadow.shadowColor=this.timerText.shadowColor=null;this.width=ig.system.width;this.drawCanvas=ig.$new("canvas");this.drawCanvas.width=this.width;this.drawCanvas.height=this.height;this.drawContext=this.drawCanvas.getContext('2d');},reset:function(){this.redraw();},update:function(){if(this.width!=ig.system.realWidth){this._flagRedraw=true;this.width=ig.system.realWidth;this.drawCanvas.width=this.width;this.drawCanvas.height=this.height;}
this.width=ig.system.realWidth;this.drawY=ig.system.height-this.height;},draw:function(){if(this._flagRedraw===true){this.redraw();}
ig.system.context.drawImage(this.drawCanvas,Math.round(ig.system.width/2-this.width/2),ig.system.height-this.height);this.drawTimer();},drawTimer:function(){var time=ig.game.levelTime;var s=Math.floor(time)%60;var m=Math.floor((time%3600)/60);s=s.toString();if(s.length<2)s="0"+s;var timeString=m+":"+s;var yPos=ig.system.height-30;this.timerTextShadow.setString(timeString);this.timerText.setString(timeString);ig.system.context.globalAlpha=0.3;this.timerTextShadow.draw(ig.game.cp.x-2,yPos+3);ig.system.context.globalAlpha=1;this.timerText.draw(ig.game.cp.x,yPos);},redraw:function(){this.width=ig.system.realWidth;var ctx=this.drawContext;ctx.clearRect(0,0,this.width,this.height);ctx.globalAlpha=0.5;ctx.fillStyle="#1e110f";ctx.fillRect(0,0,this.width,this.height);ctx.globalAlpha=1;var sessionData=ig.levelManager.getSessionData();var numTasks=sessionData.taskTypes.length;if(numTasks>4){numTasks=4;}
var startX=ig.game.cp.x-546;var maxWidth=178;for(var i=0;i<numTasks;i++){var type=sessionData.taskTypes[i];var tile=0;var iX=0;var nX=0;switch(type){case ig.TASK_TYPES.BUNNY:nX=80;break;case ig.TASK_TYPES.FLOWER:iX=202;tile=1;nX=46;break;case ig.TASK_TYPES.PIGMAN:iX=740;tile=2;nX=94;break;case ig.TASK_TYPES.ROCK_BABY:iX=966;tile=3;nX=45;break;}
ctx.drawImage(this.taskImages.data,tile*100,0,100,92,startX+iX,12,100,92);var n=sessionData.tasks[type].completed;ctx.drawImage(this.numbers.data,0,43*n,30,43,startX+iX+nX,46,30,43);ctx.drawImage(this.numbers.data,0,43*10,30,43,startX+iX+nX+30,46,30,43);n=sessionData.tasks[type].total;ctx.drawImage(this.numbers.data,0,43*n,30,43,startX+iX+nX+60,46,30,43);}
this._flagRedraw=false;},});ig.GameUIScore=ig.Class.extend({width:220,height:100,drawCanvas:null,drawContext:null,visual:0,scoreCanvas:null,_flagRedraw:false,textbox:null,init:function(settings){ig.merge(this,settings);this.drawCanvas=ig.$new("canvas");this.drawCanvas.width=this.width;this.drawCanvas.height=this.height;this.drawContext=this.drawCanvas.getContext('2d');this.drawContext.lineWidth=8;this.drawContext.fillStyle="#FFFFFF";this.drawContext.strokeStyle='#000000';this.drawContext.textBaseline="middle";this.textbox=new ig.Textbox(ig.Strings.GAME_UI_SCORE,{fontSize:38});this.drawContext.font=this.textbox.fontStyle;},reset:function(){this.visual=0;this.textbox.setString(ig.Strings.GAME_UI_SCORE.string);this.textbox.replace("%n",this.visual);this.redraw();},update:function(){if(this.visual!=ig.levelManager.levelScore){this._flagRedraw=true;this.visual=ig.levelManager.levelScore;this.textbox.setString(ig.Strings.GAME_UI_SCORE.string);this.textbox.replace("%n",this.visual);}},draw:function(){if(this._flagRedraw){this.redraw();}
ig.system.context.drawImage(this.drawCanvas,0,0);},redraw:function(){var ctx=this.drawContext;ctx.clearRect(0,0,this.width,this.height);ctx.strokeText(this.visual,26,50);ctx.fillText(this.visual,26,50);this._flagRedraw=false;}});});

// lib/game/gameboard-background.js
ig.baked=true;ig.module('game.gameboard-background').requires('impact.background-map','impact.image').defines(function(){ig.GameBoardBackground=ig.BackgroundMap.extend({tiles:null,enabled:true,distance:1,once:false,init:function(tilesize,data){this.parent(tilesize,data);},loadTiles:function(dayNum){var path="media/images/gb_tiles/day"+dayNum+"/";this.tiles=new Array(this.height);for(var y=0;y<this.height;y++){this.tiles[y]=new Array(this.width);for(var x=0;x<this.width;x++){var count=y*this.width+(x+1);if(count<10){count="0"+count;}
this.tiles[y][x]=new ig.Image(path+"tile_"+count+".jpg");}}},setTileset:function(tileset){},draw:function(){if(!this.enabled){return;}
this.drawTiles();},drawTiles:function(){var tile=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=0&&tileX<this.width&&tileY>=0&&tileY<this.height){if(pxX+this.tilesize>0&&pxX<ig.system.width&&pxY+this.tilesize>0&&pxY<ig.system.height){this.tiles[tileY][tileX].draw(pxX,pxY);}}}}}});});

// lib/game/figures/sylvia.js
ig.baked=true;ig.module('game.figures.sylvia').requires('impact.entity-pool','impact.entity','impact.game').defines(function(){ig.Sylvia=ig.Entity.extend({size:{x:224,y:98},offset:{x:156,y:18},maxVel:{x:5000,y:5000},_sweepIndex:0,init:function(x,y,settings){this.parent(x,y,settings);this.animSheet=new ig.AnimationSheet("media/images/game/sylvia.png",464,114);this.addAnim('run',0.08,[0,1,2]);this.doSweep();},reset:function(x,y,settings){this.parent(x,y,settings);this._sweepIndex=0;this.doSweep();},doSweep:function(){switch(this._sweepIndex){case 0:this.pos.x=ig.game.screen.x-700;break;case 2:this.pos.x=ig.game.screen.x-300;break;case 1:this.pos.x=ig.game.screen.x+ig.system.width+300;break;case 3:ig.game.sylvia=null;this.kill();break;}
this.pos.y=ig.game.screen.y+ig.system.height*(this._sweepIndex+1)/5;this.vel.x=this.pos.x<ig.game.screen.x?1500:-1500;this._sweepIndex++;},update:function(){this.parent();if(this.vel.x>0&&this.pos.x>ig.game.screen.x+ig.system.width+300){this.doSweep();}else if(this.vel.x<0&&this.pos.x<ig.game.screen.x-300){this.doSweep();}
this.currentAnim.flip.x=this.vel.x<0;}});ig.EntityPool.enableFor(ig.Sylvia);});

// lib/game/figures/player.js
ig.baked=true;ig.module('game.figures.player').requires('impact.entity','impact.game').defines(function(){ig.PLAYER_STATUS={NORMAL:0,FIGHTING:1,STUNNED:2,GIVING_ROCK:3,DEAD:4};ig.Player=ig.Entity.extend({type:ig.Entity.TYPE.A,checkAgainst:ig.Entity.TYPE.B,collides:ig.Entity.COLLIDES.ACTIVE,size:{x:56,y:20},maxVel:{x:300,y:300},cp:{x:0,y:0},healthObj:{actual:100,visual:100,max:100},speed:300,baseSpeed:300,targetLoc:{x:-1,y:-1},targetTask:null,_taskInProgress:false,_taskCompleted:false,_distanceToLoc:0,status:0,isInMud:false,isCarryingRock:false,isSecure:false,numPigInTow:0,mudSplatter:null,mudSoundTime:0,stunnedTime:0,_currentAnimation:null,_currentAnimationFlipped:false,_mouseDown:false,animations:{IDLE:{name:"idle",offset:{x:60,y:135}},SIDEWALK:{name:"sidewalk",offset:{x:60,y:135}},DOWNWALK:{name:"downwalk",offset:{x:60,y:135}},UPWALK:{name:"upwalk",offset:{x:60,y:135}},ROCK_IDLE:{name:"rockidle",offset:{x:60,y:140}},ROCK_SIDEWALK:{name:"rocksidewalk",offset:{x:60,y:140}},ROCK_DOWNWALK:{name:"rockdownwalk",offset:{x:60,y:140}},ROCK_UPWALK:{name:"rockupwalk",offset:{x:60,y:140}},BUBBLE:{name:"bubble",offset:{x:46,y:119}},CARROT:{name:"carrot",offset:{x:43,y:108}},STUNNED:{name:"stunned",offset:{x:28,y:128}},STARTPOUR:{name:"startpour",offset:{x:46,y:113}},CONTPOUR:{name:"continuepour",offset:{x:46,y:113}},ENDPOUR:{name:"endpour",offset:{x:46,y:113}},ROCKBABY_START:{name:"startpickuprock",offset:{x:53,y:116}},ROCKBABY_PICKUP:{name:"pickuprock",offset:{x:53,y:116}},ROCKBABY_GIVE:{name:"giverock",offset:{x:53,y:116}}},init:function(x,y,settings){this.parent(x,y,settings);this.setupAnimations();},setupAnimations:function(){var basicAnimations=new ig.AnimationSheet("media/images/game/wander-basic.png",141,170);var rockCarryAnimations=new ig.AnimationSheet("media/images/game/wander-rockcarry.png",144,170);var bubbleAnimations=new ig.AnimationSheet("media/images/game/wander-bubble.png",307,176);var carrotAnimations=new ig.AnimationSheet("media/images/game/wander-carrot.png",135,129);var stunnedAnimations=new ig.AnimationSheet("media/images/game/wander-stunned.png",98,149);var wateringAnimations=new ig.AnimationSheet("media/images/game/wander-watering.png",171,135);var rockBabyAnimations=new ig.AnimationSheet("media/images/game/wander-rockbaby.png",175,140);var mudSplatter=new ig.AnimationSheet("media/images/game/mudsplatter.png",146,88);var rate=0.08;this.animSheet=basicAnimations;this.addAnim('idle',rate,[0,1,2,3,4,5,6,7,8,9]);this.addAnim('sidewalk',rate,[10,11,12,13,14,15,16,17,18]);this.addAnim('downwalk',rate,[19,20,21,22,23,24,25,26,27]);this.addAnim('upwalk',rate,[28,29,30,31,32,33,34,35,36]);this.animSheet=rockCarryAnimations;this.addAnim('rockidle',rate,[0,1,2,3,4,5,6,7,8,9]);this.addAnim('rocksidewalk',rate,[10,11,12,13,14,15,16,17,18]);this.addAnim('rockdownwalk',rate,[19,20,21,22,23,24,25,26,27]);this.addAnim('rockupwalk',rate,[28,29,30,31,32,33,34,35,36]);this.animSheet=bubbleAnimations;this.addAnim('bubble',rate,[0,1,2,3,4,5,6,7,8]);this.animSheet=carrotAnimations;this.addAnim('carrot',rate,[0,1,2,3,4,5],true);this.animSheet=stunnedAnimations;this.addAnim('stunned',rate,[0,1,2,3,4,5,6,7,8,9]);this.animSheet=wateringAnimations;this.addAnim('startpour',rate,[0,1,2,3,4,5,6,7],true);this.addAnim('continuepour',rate,[8,9]);this.addAnim('endpour',rate,[10,11,12,13,14,15],true);this.animSheet=rockBabyAnimations;this.addAnim('startpickuprock',rate,[0,1,2],true);this.addAnim('pickuprock',rate,[3,4,5,6,7],true);this.addAnim('giverock',rate,[8,9,10,11,12,13,14,15,16,17,18,18,18,18,18,18],true);this.mudSplatter=new ig.Animation(mudSplatter,0.08,[0,1,2,3,4,5,6,7,8],false);},update:function(){if(this.status==ig.PLAYER_STATUS.FIGHTING){this.vel.x=0;this.vel.y=0;return;}
if(ig.game.levelEnded===true){this.vel.x=0;this.vel.y=0;this.isSecure=true;this.parent();this.updateAnimation();return;}
if(this.status==ig.PLAYER_STATUS.NORMAL){this.isInMud=ig.levelManager.isPointInMud(this.cp.x,this.cp.y);this.updateMudSplatter();this.speed=this.isInMud===true||this.isCarryingRock===true?this.baseSpeed*0.6:this.baseSpeed;if(ig.gameUI.clickHappenedThisUpdate===false){if(ig.input.pressed("left_mouse")){this._mouseDown=true;this.cancelTask();this.checkForTaskClick();if(!this.hasTask()){ig.game.spawnEntity(ig.TargetMarker,ig.input.mouse.x+ig.game.screen.x-20,ig.input.mouse.y+ig.game.screen.y-8);}}
if(this._mouseDown&&ig.input.state("left_mouse")){var d=this.distanceToPoint({x:ig.input.mouse.x+ig.game.screen.x,y:ig.input.mouse.y+ig.game.screen.y});if(!this.hasTask()&&d>40){this.targetLoc.x=ig.input.mouse.x+ig.game.screen.x;this.targetLoc.y=ig.input.mouse.y+ig.game.screen.y;}}else{if(ig.input.state('up')){this.vel.y=-this.speed;}else if(ig.input.state('down')){this.vel.y=this.speed;}else if(!this.hasTargetLoc()&&!this.hasTask()){this.vel.y=0;}
if(ig.input.state('right')){this.vel.x=this.speed;}else if(ig.input.state('left')){this.vel.x=-this.speed;}else if(!this.hasTargetLoc()&&!this.hasTask()){this.vel.x=0;}
if(ig.input.pressed("up")||ig.input.pressed("down")||ig.input.pressed("left")||ig.input.pressed("right")){this.cancelTask();}
this._mouseDown=false;}
if(this.hasTargetLoc()){this.updateToTargetLoc();}}}else if(this.status==ig.PLAYER_STATUS.STUNNED){this.vel.x=0;this.vel.y=0;this.stunnedTime-=1*ig.system.tick;if(this.stunnedTime<=0){this.endStun();}}
if(this.vel.x<1&&this.vel.x>-1){this.vel.x=0;}
if(this.vel.y<1&&this.vel.y>-1){this.vel.y=0;}
this.parent();this.updateAnimation();this.cp.x=this.pos.x+this.size.x/2;this.cp.y=this.pos.y+this.size.y/2;if(this._taskInProgress){if(!this.hasTask()){this._taskInProgress=false;return;}
this.targetTask.addProgress();if(this.targetTask.isComplete){this.completeTask();}}
if(this.isCarryingRock===true){this.checkMama();}
this.isSecure=this.status>=ig.PLAYER_STATUS.STUNNED||ig.game.sylvia!==null;var diff=this.healthObj.actual-this.healthObj.visual;if(diff!==0){this.updateHealth(diff);}},updateToTargetLoc:function(){this._distanceToLoc=this.distanceToPoint(this.targetLoc);if(this._distanceToLoc>5){var angleToMarker=this.angleToPoint(this.targetLoc);this.vel.x=Math.cos(angleToMarker)*this.speed*1.25;this.vel.y=Math.sin(angleToMarker)*this.speed*1.25;}else{this.vel.x=this.vel.y=0;this.pos.x=this.targetLoc.x-this.size.x/2;this.pos.y=this.targetLoc.y-this.size.y/2;if(this.targetTask){this.beginTask();}else if(this.isCarryingRock&&ig.levelManager.rockMama.playerOffset.x==this.targetLoc.x&&ig.levelManager.rockMama.playerOffset.y==this.targetLoc.y){this.giveRockToMama();}
this.cancelTargetLoc();}},updateMudSplatter:function(){if(this.isInMud&&this.vel.x!==0&&this.vel.y!==0){if(this.mudSoundTime===0){ig.SFX.mudwalk.play();}
if(this.mudSoundTime<1.6){this.mudSoundTime+=ig.system.tick;}else{this.mudSoundTime=0;}}else if(this.mudSoundTime!==0){ig.SFX.mudwalk.stop();this.mudSoundTime=0;}},updateAnimation:function(){var newAnimation=this._currentAnimation;if(this.status==ig.PLAYER_STATUS.STUNNED||this.status==ig.PLAYER_STATUS.DEAD){newAnimation=this.animations.STUNNED;}else if(this.status==ig.PLAYER_STATUS.GIVING_ROCK&&!this.hasTargetLoc()){newAnimation=this.animations.ROCKBABY_GIVE;if(this._currentAnimation==this.animations.ROCKBABY_GIVE&&this.currentAnim.loopCount>=1){this.status=ig.PLAYER_STATUS.NORMAL;}}else if(this._taskInProgress){switch(this.targetTask.taskType){case ig.TASK_TYPES.FLOWER:if(this._currentAnimation==this.animations.STARTPOUR&&this.currentAnim.loopCount>=1){newAnimation=this.animations.CONTPOUR;}else if(this._currentAnimation!=this.animations.CONTPOUR&&this._currentAnimation!=this.animations.ENDPOUR){newAnimation=this.animations.STARTPOUR;}
break;case ig.TASK_TYPES.BUNNY:newAnimation=this.animations.CARROT;break;case ig.TASK_TYPES.PIGMAN:newAnimation=this.animations.BUBBLE;if(this._currentAnimation==this.animations.BUBBLE){this.currentAnim.gotoFrame(8*this.targetTask.progress);}
break;case ig.TASK_TYPES.ROCK_BABY:newAnimation=this.animations.ROCKBABY_START;break;}
this._currentAnimationFlipped=this.cp.x>this.targetTask.pos.x+this.targetTask.size.x/2;}else if(this._taskCompleted){switch(this._currentAnimation){case this.animations.CONTPOUR:case this.animations.STARTPOUR:case this.animations.ENDPOUR:newAnimation=this.animations.ENDPOUR;if(this._currentAnimation==this.animations.ENDPOUR&&this.currentAnim.loopCount>=1){this._taskCompleted=false;}
break;case this.animations.ROCKBABY_START:case this.animations.ROCKBABY_PICKUP:newAnimation=this.animations.ROCKBABY_PICKUP;if(this._currentAnimation==this.animations.ROCKBABY_PICKUP&&this.currentAnim.loopCount>=1){this._taskCompleted=false;}
break;default:this._taskCompleted=false;break;}}else{if(this.vel.x!==0||this.vel.y!==0){this._currentAnimationFlipped=false;if(Math.abs(this.vel.x)>Math.abs(this.vel.y)){newAnimation=this.isCarryingRock?this.animations.ROCK_SIDEWALK:this.animations.SIDEWALK;this._currentAnimationFlipped=this.vel.x<0;}else if(this.vel.y>0){newAnimation=this.isCarryingRock?this.animations.ROCK_DOWNWALK:this.animations.DOWNWALK;}else if(this.vel.y<0){newAnimation=this.isCarryingRock?this.animations.ROCK_UPWALK:this.animations.UPWALK;}}else{newAnimation=this.isCarryingRock?this.animations.ROCK_IDLE:this.animations.IDLE;}}
if(this._currentAnimation===null&&newAnimation===null){return;}
if(this._currentAnimation!=newAnimation){this._currentAnimation=newAnimation;this.currentAnim=this.anims[this._currentAnimation.name].rewind();}
this.offset.x=this._currentAnimation.offset.x;this.offset.y=this._currentAnimation.offset.y;this.currentAnim.flip.x=this._currentAnimationFlipped;if(this.currentAnim.flip.x===true){this.offset.x=this.currentAnim.sheet.width-this.size.x-this.offset.x;}
if(this.isInMud){this.mudSplatter.update();}},assignTask:function(task){this.targetTask=task;var isOnLeft=(this.cp.x<this.targetTask.pos.x+this.targetTask.size.x/2);var pos=isOnLeft?this.targetTask.playerOffsetLeft:this.targetTask.playerOffsetRight;this.targetLoc.x=this.targetTask.pos.x+pos.x;this.targetLoc.y=this.targetTask.pos.y+pos.y;},beginTask:function(){this._taskInProgress=true;this._taskCompleted=false;this.targetTask.start();switch(this.targetTask.taskType){case ig.TASK_TYPES.FLOWER:ig.SFX.pour.play();break;case ig.TASK_TYPES.PIGMAN:ig.SFX.bubble.play();break;}},completeTask:function(){this._taskCompleted=true;this.targetTask=null;this._taskInProgress=false;},cancelTask:function(){if(this.targetTask!==null){switch(this.targetTask.taskType){case ig.TASK_TYPES.FLOWER:ig.SFX.pour.stop();break;case ig.TASK_TYPES.PIGMAN:ig.SFX.bubble.stop();break;}}
this._taskInProgress=false;this._taskCompleted=false;this.targetTask=null;this.cancelTargetLoc();},hasTask:function(){return this.targetTask!==null;},hasTargetLoc:function(){return this.targetLoc.x>-1&&this.targetLoc.y>-1;},cancelTargetLoc:function(){this.targetLoc.x=-1;this.targetLoc.y=-1;},cancelTargets:function(){this.cancelTargetLoc();this.cancelTask();},handleFightEnd:function(){this.cancelTargets();this.status=ig.PLAYER_STATUS.STUNNED;this.stunnedTime=2;this.addDamage();},endStun:function(){this.status=ig.PLAYER_STATUS.NORMAL;if(this.healthObj.actual<=0){ig.SFX.death.play();TweenMax.delayedCall(3,ig.game.endLevel,[true],ig.game);}else{this.cancelTargets();ig.game.resumeEnemies();}},checkMama:function(){if(this.distanceToPoint(ig.levelManager.rockMama.playerOffset)<100){this.targetLoc.x=ig.levelManager.rockMama.playerOffset.x;this.targetLoc.y=ig.levelManager.rockMama.playerOffset.y;}},giveRockToMama:function(){this.vel.x=0;this.vel.y=0;this.isCarryingRock=false;this.status=ig.PLAYER_STATUS.GIVING_ROCK;ig.levelManager.completeTask(ig.TASK_TYPES.ROCK_BABY);TweenMax.delayedCall(0.6,ig.levelManager.rockMama.receiveBaby,null,ig.levelManager.rockMama);},updateHealth:function(diff){var change=14*ig.system.tick;if(change<Math.abs(diff)){this.healthObj.visual+=diff>0?change:-change;}else{this.healthObj.visual=this.healthObj.actual;}},draw:function(){if(this.status==ig.PLAYER_STATUS.FIGHTING||ig.game.paused===true){return;}else if(this.healthObj.actual!=this.healthObj.visual){this.drawHealthBar();}
this.parent();if(this.isInMud&&(this.vel.x!==0||this.vel.y!==0)){var yOffset=Math.abs(this.vel.x)<Math.abs(this.vel.y)?32:40;this.mudSplatter.draw(this.pos.x-ig.game._rscreen.x-52,this.pos.y-ig.game._rscreen.y-yOffset);}},drawHealthBar:function(){var cx=this.pos.x-20-ig.game.screen.x;var cy=this.pos.y-130-ig.game.screen.y;var ctx=ig.system.context;var w=144;var h=24;var x=w/-2;var y=h/-2;var r=h/2;ctx.save();ctx.translate(cx,cy);ctx.rotate((-45).toRad());ctx.save();ctx.fillStyle="rgba(46, 76, 0, 0.4)";ctx.strokeStyle="#000000";ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.arc(x+w-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.stroke();ctx.fill();ctx.restore();w-=8;h-=8;x=w/-2;y=h/-2;r=h/2;var pw=w*(this.healthObj.visual/this.healthObj.max);if(pw<r*2){ctx.restore();return;}
ctx.save();ctx.fillStyle="#ff00b3";ctx.lineWidth=8;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+pw-r,y);ctx.arc(x+pw-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.fill();ctx.restore();ctx.restore();},checkForTaskClick:function(){if(this.isCarryingRock===true){return;}
var n=ig.levelManager.taskEntities.length;for(var i=0;i<n;i++){if(ig.levelManager.taskEntities[i].isComplete===false&&ig.levelManager.taskEntities[i].isMouseOver()===true){this.assignTask(ig.levelManager.taskEntities[i]);return;}}},nearTask:function(task){if(this.status>ig.PLAYER_STATUS.NORMAL){return;}
if(!task.isComplete&&this.vel.x===0&&this.vel.y===0&&!this.hasTask()&&!this.hasTargetLoc()&&this.isCarryingRock===false){this.assignTask(task);}},addHealth:function(){this.healthObj.actual+=10;if(this.healthObj.actual>this.healthObj.max){this.healthObj.actual=this.healthObj.max;}},addDamage:function(){this.healthObj.actual-=25;if(this.healthObj.actual<0){this.healthObj.actual=0;}},distanceToPoint:function(point){var xd=this.cp.x-point.x;var yd=this.cp.y-point.y;return Math.sqrt(xd*xd+yd*yd);},angleToPoint:function(point){return Math.atan2(point.y-this.cp.y,point.x-this.cp.x);},check:function(other){if(this.status>ig.PLAYER_STATUS.NORMAL){return;}
switch(other.objectType){case ig.OBJECT_TYPES.ENEMY:this.status=ig.PLAYER_STATUS.FIGHTING;other.status=ig.ENEMY_STATUS.FIGHTING;ig.game.createFight();break;case ig.OBJECT_TYPES.PICKUP:ig.levelManager.numSylvias++;ig.gameUI.addSylvia();ig.levelManager.pieEntity=null;other.kill();ig.game.playPickupSound();break;}}});});

// lib/game/figures/enemies.js
ig.baked=true;ig.module('game.figures.enemies').requires('impact.entity','impact.game').defines(function(){ig.ENEMY_PATROL_PATTERNS=[[[-1,0],[1,0]],[[-1,-1],[-1,1],[1,1],[1,-1]],[[-1,0],[1,0],[0,1],[0,-1]],[[-1,0],[0,1.5],[0.5,-1.5],[1.5,0],[-0.5,-0.5],[0.5,1]]];ig.ENEMY_STATUS={NORMAL:0,AGRO:1,RETREAT:2,FIGHTING:3,RESTING:4,DIVING:5};ig.Watchdog=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.PASSIVE,objectType:-1,size:{x:50,y:20},offset:{x:5,y:90},maxVel:{x:2000,y:2000},isOnScreen:false,walkSpeed:100,chaseSpeed:200,retreatSpeed:250,currentSpeed:0,LoS:330,diveRadius:130,energy:100,energyDrain:30,energyGain:35,patrolPattern:null,patrolNextPoint:{x:0,y:0},patrolCenter:{x:0,y:0},patrolPause:1.5,patrolDirection:1,patrolRange:200,_patrolIndex:0,status:ig.ENEMY_STATUS.NORMAL,_cPause:0,_distanceToPlayer:0,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.ENEMY;this.animSheet=new ig.AnimationSheet("media/images/game/watchdog.png",136,124);this.addAnim('idle',1,[1]);this.addAnim('walk',0.1,[0,1,2,3,4,5,6,7,8]);this.addAnim('run',0.08,[0,1,2,3,4,5,6,7,8]);this.addAnim('flee',0.06,[0,1,2,3,4,5,6,7,8]);this.addAnim('pant',0.08,[9,10,11,12,13]);this.addAnim('dive',0.08,[14,15,16,17,18,19,20,21,22],true);this.setPatrol({x:x,y:y});},update:function(){this._distanceToPlayer=this.distanceTo(ig.game.player);if(this.status<ig.ENEMY_STATUS.RETREAT){if(this._distanceToPlayer>850||ig.game.player.inMud){this.status=ig.ENEMY_STATUS.NORMAL;}else{if(ig.game.player.isSecure){this.status=ig.ENEMY_STATUS.RETREAT;}else{if(this._distanceToPlayer<this.LoS){if(this.status==ig.ENEMY_STATUS.NORMAL){ig.SFX.watchdog.play();}
this.status=ig.ENEMY_STATUS.AGRO;}else{this.status=ig.ENEMY_STATUS.NORMAL;}}}}else if(this.status==ig.ENEMY_STATUS.RETREAT&&ig.game.player.isSecure===false){this.status=ig.ENEMY_STATUS.NORMAL;}
if(this.status!==ig.ENEMY_STATUS.DIVING){this.size.x=50;}
if(ig.game.levelEnded===true||ig.game.player.status==ig.PLAYER_STATUS.STUNNED){this.doRetreatBehaviour();}else{switch(this.status){case ig.ENEMY_STATUS.NORMAL:this.doNormalBehaviour();break;case ig.ENEMY_STATUS.AGRO:this.doAgroBehaviour();break;case ig.ENEMY_STATUS.RETREAT:this.doRetreatBehaviour();break;case ig.ENEMY_STATUS.DIVING:this.updateDive();break;case ig.ENEMY_STATUS.RESTING:this.doRestingBehaviour();break;case ig.ENEMY_STATUS.FIGHTING:return;}}
this.parent();this.isOnScreen=this.pos.x+this.size.x-ig.game.screen.x>0&&this.pos.y+this.size.y-ig.game.screen.y>0&&this.pos.x-ig.game.screen.x<ig.system.width&&this.pos.y-ig.game.screen.y<ig.system.height;if(this.isOnScreen){this.checkAnimation();}},checkAnimation:function(){if(ig.game.levelEnded===true){this.currentAnim=this.anims["flee"];}else{switch(this.status){case ig.ENEMY_STATUS.RESTING:var f=this.currentAnim.flip.x;this.currentAnim=this.anims["pant"];this.currentAnim.flip.x=f;break;case ig.ENEMY_STATUS.DIVING:this.currentAnim=this.anims["dive"];break;default:switch(this.currentSpeed){case this.walkSpeed:this.currentAnim=this.anims["walk"];break;case this.chaseSpeed:this.currentAnim=this.anims["run"];break;case this.retreatSpeed:this.currentAnim=this.anims["flee"];break;}
break;}}
if(this.vel.x!==0){this.currentAnim.flip.x=this.vel.x<0;}
this.offset.x=5;if(this.currentAnim.flip.x===true){this.offset.x=this.currentAnim.sheet.width-this.size.x-this.offset.x;}},doNormalBehaviour:function(){this.currentSpeed=this.walkSpeed;if(this.energy<100){this.energy+=this.energyGain*ig.system.tick/2;}
var d=this.distanceToPoint(this.patrolNextPoint);if(d>5){var a=this.angleToPoint(this.patrolNextPoint);this.vel.x=Math.cos(a)*this.currentSpeed;this.vel.y=Math.sin(a)*this.currentSpeed;}else{this.setNextPatrolPoint();}},doRestingBehaviour:function(){this.vel.x=0;this.vel.y=0;this.energy+=this.energyGain*ig.system.tick;if(this.energy>=100){this.energy=100;this.status=ig.ENEMY_STATUS.NORMAL;}},doAgroBehaviour:function(){this.currentSpeed=this.chaseSpeed;var radToPlayer=this.angleTo(ig.game.player);this.vel.x=Math.cos(radToPlayer)*this.currentSpeed;this.vel.y=Math.sin(radToPlayer)*this.currentSpeed;this.energy-=this.energyDrain*ig.system.tick;if(this.energy<=0){this.status=ig.ENEMY_STATUS.RESTING;return;}
if(this._distanceToPlayer<this.diveRadius){ig.SFX.diveSound.play();this.currentAnim=this.anims["dive"].rewind();this.size.x=90;this.status=ig.ENEMY_STATUS.DIVING;this.vel.x*=2;this.vel.y*=2;this.energy=0;}},doRetreatBehaviour:function(){this.currentSpeed=this.retreatSpeed;var radToPlayer=this.angleTo(ig.game.player);this.vel.x=Math.cos(radToPlayer)*-this.currentSpeed;this.vel.y=Math.sin(radToPlayer)*-this.currentSpeed;if(ig.game.sylvia!==null&&this.distanceTo(ig.game.sylvia)<100){ig.SFX.diveSound.play();this.currentAnim=this.anims["dive"].rewind();this.status=ig.ENEMY_STATUS.DIVING;}},updateDive:function(){this.friction.x=500;this.friction.y=500;if(this.vel.x===0&&this.vel.y===0&&ig.game.sylvia===null){this.status=ig.ENEMY_STATUS.RESTING;}},retreat:function(){this.status=ig.ENEMY_STATUS.RETREAT;},resume:function(){this.status=ig.ENEMY_STATUS.NORMAL;},setPatrol:function(patrolPoint){this.patrolCenter=patrolPoint;this.getNewPatrolPattern();},getNewPatrolPattern:function(){this.patrolPattern=ig.ENEMY_PATROL_PATTERNS.random();this._patrolIndex=0;this.patrolDirection=Math.random()>0.5?1:-1;this.setNextPatrolPoint();},setNextPatrolPoint:function(){this._patrolIndex+=this.patrolDirection;if(this._patrolIndex<0){this._patrolIndex=this.patrolPattern.length-1;}else if(this._patrolIndex>=this.patrolPattern.length){this._patrolIndex=0;}
this.patrolNextPoint.x=this.patrolCenter.x+this.patrolPattern[this._patrolIndex][0]*this.patrolRange;this.patrolNextPoint.y=this.patrolCenter.y+this.patrolPattern[this._patrolIndex][1]*this.patrolRange;},draw:function(){if(this.status==ig.ENEMY_STATUS.FIGHTING||ig.game.paused===true){return;}
this.parent();},collideWith:function(other,axis){if(other.objectType===ig.OBJECT_TYPES.TERRAIN&&this.status!==ig.ENEMY_STATUS.AGRO){this.vel.x=this.vel.y=0;this.patrolNextPoint.x=this.pos.x+this.size.x/2>other.pos.x+other.size.x/2?this.pos.x+other.size.x*2:this.pos.x-other.size.x*2;this.patrolNextPoint.y=this.pos.y;}},distanceToPoint:function(point){var xd=this.pos.x-point.x;var yd=this.pos.y-point.y;return Math.sqrt(xd*xd+yd*yd);},angleToPoint:function(point){return Math.atan2(point.y-this.pos.y,point.x-this.pos.x);}});});

// lib/game/ui-entities.js
ig.baked=true;ig.module('game.ui-entities').requires('impact.entity-pool','impact.entity','impact.game').defines(function(){ig.TargetMarker=ig.Entity.extend({size:{x:40,y:16},animSheet:new ig.AnimationSheet("media/images/gameui/click-marker.png",40,16),lowLevel:true,simple:true,init:function(x,y,settings){this.parent(x,y,settings);this.reset();},reset:function(x,y,settings){this.parent(x,y,settings);this.addAnim('play',0.05,[0,1,2,3,4,5]);this.currentAnim=this.anims["play"];},update:function(){this.parent();if(this.currentAnim.loopCount>=1){this.kill();}}});ig.EntityPool.enableFor(ig.TargetMarker);ig.TaskArrow=ig.Entity.extend({simple:true,highLevel:true,drawYOffset:0,task:null,draw:function(){if(ig.game.levelPaused===true||(ig.game.player._taskInProgress===true&&ig.game.player.targetTask===this.task)){return;}
var x=this.pos.x-this.offset.x-ig.game._rscreen.x;var y=this.pos.y-this.offset.y-ig.game._rscreen.y;ig.game.arrowSprite.draw(x-32,y-86+ig.game.arrowYPos+this.drawYOffset);},kill:function(){this.parent();this.task=null;}});ig.EntityPool.enableFor(ig.TaskArrow);});

// lib/game/task-entities.js
ig.baked=true;ig.module('game.task-entities').requires('impact.entity-pool','game.ui-entities','game.misc-entities','impact.entity','impact.game').defines(function(){ig.TaskEntity=ig.Entity.extend({clickPadding:{x:0,y:0},clickSize:{x:0,y:0},playerOffsetLeft:{x:0,y:0},playerOffsetRight:{x:0,y:0},objectType:-1,taskType:"",isComplete:false,progressRate:0.01,progress:0,taskArrow:null,isOnScreen:false,inProgress:false,alertYOffset:-50,playerDistance:9999,taskTriggerRadius:250,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.TASK;},start:function(){},finish:function(){this.type=ig.Entity.TYPE.NONE;this.isComplete=true;},addProgress:function(){this.progress+=this.progressRate;if(this.progress>1){this.progress=1;this.isComplete=true;this.finish();}
this.inProgress=true;},isMouseOver:function(){var mX=ig.input.mouse.x+ig.game.screen.x;var mY=ig.input.mouse.y+ig.game.screen.y;return(mX>this.pos.x-this.offset.x-this.clickPadding.x&&mX<this.pos.x-this.offset.x+this.clickSize.x+this.clickPadding.x*2&&mY>this.pos.y-this.offset.y-this.clickPadding.y&&mY<this.pos.y-this.offset.y+this.clickSize.y+this.clickPadding.y*2);},update:function(){this.parent();this.isOnScreen=this.pos.x+this.size.x-ig.game.screen.x>0&&this.pos.y+this.size.y-ig.game.screen.y>0&&this.pos.x-ig.game.screen.x<ig.system.width&&this.pos.y-ig.game.screen.y<ig.system.height;if(this.isComplete){if(this.taskArrow!==null){this.taskArrow.kill();this.taskArrow=null;}
return;}
if(this.isOnScreen){this.playerDistance=this.distanceTo(ig.game.player);if(this.playerDistance<this.taskTriggerRadius){ig.game.player.nearTask(this);}
if(this.taskArrow===null){this.taskArrow=ig.game.spawnEntity(ig.TaskArrow,this.pos.x+this.size.x/2,this.pos.y+this.size.y/2,{task:this,drawYOffset:this.alertYOffset});}else{this.taskArrow.pos.x=this.pos.x+this.size.x/2;this.taskArrow.pos.y=this.pos.y+this.size.y/2;}}else if(this.taskArrow!==null){this.taskArrow.kill();this.taskArrow=null;}},draw:function(){this.parent();if(this.isComplete===false){if(this.inProgress){this.drawProgressBars(this.pos.x+this.size.x/2-ig.game._rscreen.x,this.pos.y+this.size.y-ig.game._rscreen.y+24);}
this.inProgress=false;}},drawProgressBars:function(cx,cy){var ctx=ig.system.context;var w=146;var h=24;var x=cx-w/2;var y=cy-h/2;var r=h/2;ctx.save();ctx.fillStyle="rgba(101, 0, 43, 0.4)";ctx.strokeStyle="#000000";ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.arc(x+w-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.stroke();ctx.fill();ctx.restore();w-=8;h-=8;x=cx-w/2;y=cy-h/2;r=h/2;var pw=w*this.progress;if(pw<r*2){pw=r*2;}
ctx.save();ctx.fillStyle="#a6e741";ctx.lineWidth=8;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+pw-r,y);ctx.arc(x+pw-r,y+h/2,r,Math.PI*1.5,Math.PI*0.5,false);ctx.lineTo(x+r,y+h);ctx.arc(x+r,y+h/2,r,Math.PI*0.5,Math.PI*1.5,false);ctx.closePath();ctx.fill();ctx.restore();},kill:function(){this.parent();if(this.taskArrow!==null){this.taskArrow.kill();this.taskArrow=null;}}});ig.FlowersTask=ig.TaskEntity.extend({playerOffsetLeft:{x:-20,y:70},playerOffsetRight:{x:170,y:70},clickSize:{x:157,y:106},size:{x:157,y:106},lowLevel:true,simple:true,taskType:"flowers",init:function(x,y,settings){this.parent(x,y,settings);this.animSheet=new ig.AnimationSheet("media/images/game/flowers.png",157,106);this.addAnim('idle',0.08,[0,1,2,3,4,5,6,8,9],true);},update:function(){this.parent();if(!this.isComplete){this.currentAnim.gotoFrame(Math.floor(6*this.progress));}},finish:function(){this.parent();ig.levelManager.completeTask(this.taskType);ig.game.playSuccessSound();ig.levelManager.spawnHearts(this.pos.x+this.size.x/2,this.pos.y+this.size.y/2);}});ig.BunnyTask=ig.TaskEntity.extend({playerOffsetLeft:{x:11,y:37},playerOffsetRight:{x:100,y:37},size:{x:122,y:88},clickSize:{x:122,y:148},offset:{x:0,y:60},simple:true,taskType:"bunnies",flipped:false,end:false,alertYOffset:-20,init:function(x,y,settings){this.parent(x,y,settings);this.animSheet=new ig.AnimationSheet("media/images/game/bunnytask.png",122,148);this.addAnim('idle',1,[0]);this.addAnim('succeed',0.08,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],true);this.flipped=Math.random()>0.5;if(this.flipped){this.playerOffsetLeft={x:20,y:37};this.playerOffsetRight={x:110,y:37};}
this.currentAnim.flip.x=this.flipped;},update:function(){this.parent();if(this.end===false){if(this.currentAnim==this.anims["succeed"]&&this.currentAnim.loopCount>=1){ig.game.playSuccessSound();this.end=true;}}},finish:function(){this.parent();this.currentAnim=this.anims["succeed"].rewind();this.currentAnim.flip.x=this.flipped;ig.levelManager.completeTask(this.taskType);TweenMax.delayedCall(0.3,ig.SFX.bunnyWake.play,null,ig.SFX.bunnyWake);TweenMax.delayedCall(0.8,ig.levelManager.spawnHearts,[this.pos.x+this.size.x/2,this.pos.y+this.size.y/2],ig.levelManager);}});ig.RockBabyTask=ig.TaskEntity.extend({alertYOffset:-40,clickSize:{x:40,y:40},clickPadding:{x:20,y:20},playerOffsetLeft:{x:-31,y:7},playerOffsetRight:{x:56,y:7},size:{x:28,y:20},simple:true,lowLevel:true,taskType:"rockbabies",sprite:null,init:function(x,y,settings){this.parent(x,y,settings);this.sprite=new ig.Sprite(ig.game.gameSpritesheet,226,87,28,20);},update:function(){this.parent();if(this.inHand){this.pos.x=ig.game.player.pos.x;this.pos.y=ig.game.player.pos.y;}},draw:function(){this.parent();var dx=this.pos.x-this.offset.x-ig.game._rscreen.x;var dy=this.pos.y-this.offset.y-ig.game._rscreen.y;this.sprite.draw(dx,dy);},finish:function(){this.parent();this.kill();ig.game.player.isCarryingRock=true;}});ig.PigmanTask=ig.TaskEntity.extend({alertYOffset:-90,clickSize:{x:104,y:108},playerOffsetLeft:{x:-115,y:14},playerOffsetRight:{x:190,y:14},size:{x:74,y:20},offset:{x:0,y:88},startPos:null,walkCount:1,walkSpeed:100,pauseCount:0,taskType:"pigmen",init:function(x,y,settings){this.parent(x,y,settings);this.startPos={x:x,y:y};this.animSheet=new ig.AnimationSheet("media/images/game/pigman.png",108,107);this.addAnim('walk',0.08,[0,1,2,3,4,5,6,7,8,9],true);this.vel.x=this.walkSpeed;},update:function(){if(ig.game.player.targetTask===this){return;}
if(this.currentAnim.frame>2&&this.currentAnim.frame<9){if(this.currentAnim.frame==8){this.vel.x=this.walkSpeed/2;}else{this.vel.x=this.walkSpeed;}}else{if(this.walkCount>2){this.walkCount=0;this.walkSpeed*=-1;this.currentAnim.flip.x=!this.currentAnim.flip.x;this.offset.x=this.currentAnim.flip.x===true?30:0;}
this.vel.x=0;}
if(this.vel.x===0){this.pauseCount+=ig.system.tick;}
if(this.pauseCount>1){this.walkCount++;this.pauseCount=0;this.currentAnim.rewind();}
if(this.vel.x!==0){this.currentAnim.flip.x=this.vel.x<0;this.offset.x=this.currentAnim.flip.x===true?30:0;}
this.parent();},start:function(){this.vel.x=0;},finish:function(){this.parent();this.kill();ig.game.spawnEntity(ig.PigmanBubble,this.pos.x,this.pos.y+20);}});});

// lib/game/terrain-entities.js
ig.baked=true;ig.module('game.terrain-entities').requires('impact.entity','impact.game').defines(function(){ig.TerrainObject=ig.Entity.extend({objectType:-1,simple:true,image:null,collides:ig.Entity.COLLIDES.FIXED,rect:null,imageWidth:10,imageHeight:10,isBuilding:false,init:function(x,y,settings){this.parent(x,y,settings);this.objectType=ig.OBJECT_TYPES.TERRAIN;if(this.isBuilding){this.image=new ig.Image("media/images/game/building.png");this.imageWidth=776;this.imageHeight=565;}else{this.image=new ig.Image("media/images/game/terrain.png");this.imageWidth=this.rect[2];this.imageHeight=this.rect[3];}},draw:function(){if(this.image!==null){var dx=this.pos.x-this.offset.x-ig.game._rscreen.x;var dy=this.pos.y-this.offset.y-ig.game._rscreen.y;if(dx>ig.system.width||dy>ig.system.height||dx+this.imageWidth<0||dy+this.imageHeight<0){this.collides=ig.Entity.COLLIDES.NEVER;return;}
this.collides=ig.Entity.COLLIDES.FIXED;if(this.isBuilding===false){ig.system.context.drawImage(this.image.data,this.rect[0],this.rect[1],this.imageWidth,this.imageHeight,dx,dy,this.imageWidth,this.imageHeight);ig.Image.drawCount++;}else{this.image.draw(dx,dy);}}
this.parent();}});ig.Building=ig.TerrainObject.extend({size:{x:776,y:400},offset:{x:0,y:159},isBuilding:true});ig.SmallPlantRock=ig.TerrainObject.extend({size:{x:180,y:18},offset:{x:10,y:46},rect:[0,0,194,68]});ig.SmallPlant=ig.TerrainObject.extend({size:{x:100,y:18},offset:{x:10,y:46},rect:[120,188,118,70]});ig.LargePlant=ig.TerrainObject.extend({size:{x:144,y:18},offset:{x:20,y:102},rect:[0,68,174,120]});ig.LargeRocks=ig.TerrainObject.extend({size:{x:120,y:18},offset:{x:0,y:58},rect:[0,188,120,76]});ig.YellowPipes=ig.TerrainObject.extend({size:{x:90,y:18},offset:{x:0,y:130},rect:[0,264,96,152]});ig.GreenPipes=ig.TerrainObject.extend({size:{x:95,y:18},offset:{x:16,y:115},rect:[120,258,114,136]});ig.SmallBrownPlant=ig.TerrainObject.extend({size:{x:68,y:10},offset:{x:12,y:55},rect:[174,68,80,65]});});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('managers.level','managers.userdata','display.overlays','display.screens','display.game-ui','display.preloaders','game.gameboard-background','game.figures.sylvia','game.figures.player','game.figures.enemies','game.misc-entities','game.task-entities','game.terrain-entities','game.ui-entities','impact.game','impact.font').defines(function(){ig.SCREENS={START:0,INTRO:1,LEVEL_SELECT:2,LEVEL_START:3,LEVEL_END:4,TRY_AGAIN:5,WIN:6};ig.TASK_TYPES={FLOWER:"flowers",BUNNY:"bunnies",PIGMAN:"pigmen",ROCK_BABY:"rockbabies",EGG:"egg"};ig.OBJECT_TYPES={TERRAIN:0,ENEMY:1,TASK:2,PICKUP:3,ROCK_MAMA:4};ig.SFX={};ig.DEFAULT_FONTBOLD=true;ig.DEFAULT_FONTFAMILY="MatterhornSerif, Arial, sans-serif";ig.HelpingHands=ig.Game.extend({screensSpritesheet:new ig.Image("media/images/screens/screen-images.png"),gameSpritesheet:new ig.Image("media/images/game/gamesprites.png"),preloadMusic:new ig.Sound('media/audio/title-music.mp3'),c:new ig.Sound('media/audio/roll.mp3'),currentScreen:null,currentOverlay:null,blackScreenAlpha:0,isClickBlockActive:false,levelExists:false,levelPaused:false,levelEnded:false,levelTime:0,levelScore:0,player:null,sylvia:null,eggWarmth:0,arrowSprite:null,arrowYVel:400,arrowYPos:0,fightEntity:null,levelIndex:-1,cp:{x:0,y:0},autoSort:true,firstTouchEventHandler:null,successSoundIndex:0,pickupSoundIndex:0,init:function(){ig.input.initMouse();ig.input.bind(ig.KEY.MOUSE1,"left_mouse");var i=0;for(i=0;i<ig.GameConfig.LEFT_KEYS.length;i++){ig.input.bind(ig.GameConfig.LEFT_KEYS[i],'left');}
for(i=0;i<ig.GameConfig.UP_KEYS.length;i++){ig.input.bind(ig.GameConfig.UP_KEYS[i],'up');}
for(i=0;i<ig.GameConfig.RIGHT_KEYS.length;i++){ig.input.bind(ig.GameConfig.RIGHT_KEYS[i],'right');}
for(i=0;i<ig.GameConfig.DOWN_KEYS.length;i++){ig.input.bind(ig.GameConfig.DOWN_KEYS[i],'down');}
ig.input.bind(ig.GameConfig.ACTION_KEY,'space');if(ig.GameConfig.DEBUG_MODE===true){ig.input.bind(ig.KEY._1,'test1');ig.input.bind(ig.KEY._2,'test2');ig.input.bind(ig.KEY._3,'test3');ig.input.bind(ig.KEY._4,'test4');ig.input.bind(ig.KEY._0,'testEndLevel');}
this.cp.x=ig.system.realWidth/2;this.cp.y=ig.system.realHeight/2;ig.levelManager=new ig.LevelManager();ig.userDataManager=new ig.UserDataManager();ig.gameUI=new ig.GameUI();this.arrowSprite=new ig.Sprite(this.gameSpritesheet,177,0,64,86);if(ig.ua.mobile){ig.input.initPage();this.firstTouchEventHandler=this.firstTouchEvent.bind(this);ig.system.canvas.addEventListener('touchstart',this.firstTouchEventHandler);if(ig.Sound.iOSWebAudio){this.initMusic();}}else{this.initMusic();}
this.initSoundEffects();this.forceFontUpdate();this.gotoStartScreen();},forceFontUpdate:function(){var textbox=new ig.Textbox(ig.Strings.PAUSE);textbox.draw(-100,-100);},firstTouchEvent:function(event){ig.system.canvas.removeEventListener('touchstart',this.onTouchStartBinded);if(ig.Sound.iOSWebAudio){this.c.play();this.c.stop();}else if(ig.ua.android){this.initAndroidMusic();}},initMusic:function(){ig.music.add(this.preloadMusic,"titleMusic");ig.music.add("media/audio/menu-music.mp3","menuMusic");ig.music.add("media/audio/game-music.mp3","gameMusic");ig.music.setVolume(0.5);ig.music.setLooping(true);},initAndroidMusic:function(){ig.music.add("media/audio/game-music.mp3","gameMusic");ig.music.setVolume(0.5);ig.music.setLooping(true);ig.music.play();},initSoundEffects:function(){ig.SFX.watchdog=new ig.Sound('media/audio/watchdogchase.mp3',false);ig.SFX.tossle=new ig.Sound('media/audio/tossle.mp3',false);ig.SFX.death=new ig.Sound('media/audio/banjo2.mp3',false);ig.SFX.success1=new ig.Sound('media/audio/banjo1.mp3',false);ig.SFX.success2=new ig.Sound('media/audio/banjo3.mp3',false);ig.SFX.success3=new ig.Sound('media/audio/banjo4.mp3',false);ig.SFX.success4=new ig.Sound('media/audio/banjo5.mp3',false);ig.SFX.pour=new ig.Sound('media/audio/pour.mp3',false);ig.SFX.bunnyWake=new ig.Sound('media/audio/bunnywake.mp3',false);ig.SFX.bubble=new ig.Sound('media/audio/bubbleblow.mp3',false);ig.SFX.mudbath=new ig.Sound('media/audio/mudbath.mp3',false);ig.SFX.rockBaby=new ig.Sound('media/audio/rocktada.mp3',false);ig.SFX.mudwalk=new ig.Sound('media/audio/mudwalk.mp3',true);ig.SFX.pickup1=new ig.Sound('media/audio/score1.mp3',false);ig.SFX.pickup2=new ig.Sound('media/audio/score2.mp3',false);ig.SFX.pickup3=new ig.Sound('media/audio/score3.mp3',false);ig.SFX.pickup4=new ig.Sound('media/audio/score4.mp3',false);ig.SFX.sylvia=new ig.Sound('media/audio/sylvia.mp3',false);ig.SFX.diveSound=new ig.Sound('media/audio/skid.mp3',false);ig.SFX.roll=new ig.Sound('media/audio/roll.mp3',false);ig.SFX.click=new ig.Sound('media/audio/click.mp3',false);},gotoStartScreen:function(){this.currentScreen=new ig.StartScreen();this.currentScreen.animateIn(true);ig.music.play("titleMusic");},requestNewScreen:function(id){TweenMax.to(this,0.25,{blackScreenAlpha:1,ease:Quad.easeInOut,onComplete:this.showRequestedScreen,onCompleteScope:this,onCompleteParams:[id]});},showRequestedScreen:function(id){this.removeOverlay();this.removeScreen();if(this.levelExists){this.destroyLevel();}
switch(id){case ig.SCREENS.START:ig.music.play("titleMusic");this.currentScreen=new ig.StartScreen();this.currentScreen.animateIn();break;case ig.SCREENS.INTRO:ig.music.play("titleMusic");this.currentScreen=new ig.IntroScreen();break;case ig.SCREENS.LEVEL_SELECT:ig.music.play("menuMusic");this.currentScreen=new ig.LevelSelectScreen();break;case ig.SCREENS.LEVEL_START:ig.music.play("menuMusic");this.currentScreen=new ig.LevelStartScreen();this.currentScreen.animateIn();break;case ig.SCREENS.LEVEL_END:ig.music.play("menuMusic");this.currentScreen=new ig.LevelEndScreen();break;case ig.SCREENS.TRY_AGAIN:ig.music.play("menuMusic");this.currentScreen=new ig.TryAgainScreen();break;case ig.SCREENS.WIN:ig.music.play("menuMusic");this.currentScreen=new ig.WinScreen();break;}
TweenMax.to(this,0.25,{delay:0.1,blackScreenAlpha:0,ease:Quad.easeInOut});},removeOverlay:function(){if(this.currentOverlay!==null){this.currentOverlay.kill();}
this.currentOverlay=null;},removeScreen:function(){if(this.currentScreen!==null){this.currentScreen.kill();}
this.currentScreen=null;},gotoLevel:function(levelIndex){this.levelIndex=levelIndex;this.requestNewScreen(ig.SCREENS.LEVEL_START);},fadeToLevel:function(){TweenMax.to(this,0.25,{blackScreenAlpha:1,ease:Quad.easeInOut,onComplete:this.showLevel,onCompleteScope:this});},showLevel:function(){ig.music.play("gameMusic");this.removeScreen();this.removeOverlay();ig.gameUI.showLevelInstructions();TweenMax.to(this,0.25,{delay:0.1,blackScreenAlpha:0,ease:Quad.easeInOut});},buildLevel:function(){ig.levelManager.createLevel(ig.LevelData[this.levelIndex]);this.levelExists=true;this.levelPaused=true;this.levelEnded=false;this.levelTime=ig.LevelData[this.levelIndex].timelimit;this.levelScore=0;this.screen.x=ig.levelManager.width/2-ig.system.width/2;this.screen.y=0;ig.gameUI.reset();this.player=ig.game.spawnEntity(ig.Player,this.screen.x+ig.system.realWidth/2-28,-200);this.loadGameAssets();},destroyLevel:function(){ig.levelManager.destroyLevel();this.player=null;this.sylvia=null;this.fightEntity=null;this.levelPaused=false;this.levelExists=false;},startLevel:function(){this.levelPaused=false;this.player.targetLoc.x=this.screen.x+ig.system.realWidth/2-28;this.player.targetLoc.y=300;},pauseLevel:function(){this.levelPaused=true;this.removeOverlay();this.currentOverlay=new ig.PauseOverlay();},endLevel:function(byPlayerDeath,timeEnded){this.levelEnded=true;if(byPlayerDeath){this.requestNewScreen(ig.SCREENS.TRY_AGAIN);}else{var levelScore=ig.levelManager.getLevelScore();ig.userDataManager.setLevelScore(this.levelIndex,levelScore);if(timeEnded!==true){ig.gameUI.showDayComplete();if(ig.userDataManager.data.length-1==this.levelIndex){TweenMax.delayedCall(2,this.requestNewScreen,[ig.SCREENS.WIN],this);}else{if(this.levelIndex==ig.userDataManager.getLastUnlockedLevel()){ig.userDataManager.unlockNextLevel();}
TweenMax.delayedCall(2,this.requestNewScreen,[ig.SCREENS.LEVEL_END],this);}}else{this.requestNewScreen(ig.SCREENS.LEVEL_END);}}},resumeLevel:function(){if(ig.gameUI._isOnInstructions!==true){this.levelPaused=false;}
this.removeOverlay();},restartLevel:function(showConfirmScreen){if(showConfirmScreen===true){this.showConfirmationOverlay(this.restartLevel.bind(this));return;}
this.levelPaused=false;this.gotoLevel(this.levelIndex);},showConfirmationOverlay:function(yesHandler){var lastOverlayName=this.currentOverlay.name;this.removeOverlay();this.currentOverlay=new ig.AreYouSureOverlay();this.currentOverlay.yesHandler=yesHandler;var self=this;this.currentOverlay.noHandler=function(){switch(lastOverlayName){case"pauseOverlay":self.pauseLevel();break;}};},gotoLevelSelect:function(showConfirmScreen){if(showConfirmScreen===true){this.showConfirmationOverlay(this.gotoLevelSelect.bind(this));return;}
this.requestNewScreen(ig.SCREENS.LEVEL_SELECT);},showHelp:function(){this.levelPaused=true;this.removeOverlay();this.currentOverlay=new ig.HelpOverlay();},followPlayer:function(){var targetX=this.player.pos.x+28-ig.system.width/2+this.player.vel.x*0.25;var targetY=this.player.pos.y-ig.system.height/2+this.player.vel.y*0.25;if(targetX<0){targetX=0;}else if(targetX>ig.levelManager.width-ig.system.realWidth){targetX=ig.levelManager.width-ig.system.realWidth;}
if(targetY<0){targetY=0;}else if(targetY>ig.levelManager.height-ig.system.realHeight){targetY=ig.levelManager.height-ig.system.realHeight;}
this.screen.x+=(targetX-this.screen.x)*0.06;this.screen.y+=(targetY-this.screen.y)*0.06;},activateSylvia:function(fromSpaceBar){if(this.sylvia===null&&ig.levelManager.numSylvias>0){if(ig.levelManager.isEggLevel===false||this.eggWarmth>0.6){ig.levelManager.numSylvias--;ig.gameUI.sylviaOffAnimation.rewind();this.sylvia=ig.game.spawnEntity(ig.Sylvia);ig.SFX.sylvia.play();ig.gameUI.removeSylvia();}else{ig.gameUI.popEggAlert();}}},update:function(){if(window.innerHeight>window.innerWidth&&ig.ua.touchDevice){return;}
this.cp.x=ig.system.realWidth/2;this.cp.y=ig.system.realHeight/2;if(ig.input.pressed("test1")){this.gotoLevel(0);}else if(ig.input.pressed("test2")){this.gotoLevel(1);}else if(ig.input.pressed("test3")){this.gotoLevel(2);}else if(ig.input.pressed("test4")){this.gotoLevel(3);}
this.arrowYVel+=800*ig.system.tick;this.arrowYPos+=this.arrowYVel*ig.system.tick;if(this.arrowYPos>0&&this.arrowYVel>0){this.arrowYVel=-400;}
if(this.levelExists===true){if(this.currentOverlay===null){ig.gameUI.update();}
if(this.levelPaused===false){this.parent();if(ig.input.pressed("testEndLevel")){ig.levelManager.tasksCompleted=true;}
if(ig.levelManager.tasksCompleted===true&&this.levelEnded===false&&(ig.levelManager.isEggLevel===false||this.eggWarmth>=1)){this.endLevel();return;}
ig.levelManager.findClosestTask();this.followPlayer();if(ig.levelManager.numSylvias<2&&ig.levelManager.pieEntity===null){ig.levelManager.addJellyfishPie();}
if(ig.input.pressed("space")){this.activateSylvia(true);}
if(ig.levelManager.isEggLevel){if(this.sylvia===null){if(this.eggWarmth<0.2){this.eggWarmth=0.2;}
this.eggWarmth+=0.05*ig.system.tick;}else{this.eggWarmth-=0.2*ig.system.tick;}
if(this.eggWarmth>1){this.eggWarmth=1;}
if(this.eggWarmth<0){this.eggWarmth=0;}}
if(this.levelEnded!==true){this.levelTime-=ig.system.tick;if(this.levelTime<=0){this.endLevel(false,true);}}}}
if(this.currentScreen!==null){this.currentScreen.update();}
if(this.currentOverlay!==null){this.currentOverlay.update();}},draw:function(){var ctx=ig.system.context;if(window.innerHeight>window.innerWidth&&ig.ua.touchDevice){ig.system.clear(this.clearColor);var oImage;if(GameStartup.ua.mobile){oImage=ig.mobileOrientationImage;}else{oImage=ig.tabletOrientationImage;}
var oWidth=window.innerWidth<oImage.width?window.innerWidth:oImage.width;var oHeight=oImage.height*(oWidth/oImage.width);ctx.drawImage(oImage,ig.system.realWidth/2-oWidth/2,ig.system.realHeight/2-oHeight/2,oWidth,oHeight);return;}
this.parent();if(this.levelExists===true&&this.currentOverlay===null&&this.currentScreen===null){ig.gameUI.draw();}
if(this.levelExists===false||this.levelPaused===true){if(this.currentScreen!==null){this.currentScreen.draw();}
if(this.currentOverlay!==null){this.currentOverlay.draw();}}
this.isClickBlockActive=this.blackScreenAlpha>0;if(this.blackScreenAlpha>0){ctx.globalAlpha=this.blackScreenAlpha;ctx.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);ctx.globalAlpha=1;}},createFight:function(){if(this.fightEntity===null){ig.SFX.tossle.play();this.fightEntity=ig.game.spawnEntity(ig.FightGroup,this.player.cp.x-160,this.player.cp.y-159);}},endFight:function(){this.fightEntity=null;this.retreatEnemies();this.player.handleFightEnd();},retreatEnemies:function(){var enemies=this.getEntitiesByType(ig.Watchdog);for(var i=0;i<enemies.length;i++){if(enemies[i].status==ig.ENEMY_STATUS.FIGHTING){enemies[i].retreat();}}},resumeEnemies:function(){var enemies=this.getEntitiesByType(ig.Watchdog);for(var i=0;i<enemies.length;i++){enemies[i].resume();}},playSuccessSound:function(){this.successSoundIndex++;if(this.successSoundIndex>4){this.successSoundIndex=1;}
ig.SFX["success"+this.successSoundIndex].play();},playPickupSound:function(){this.pickupSoundIndex++;if(this.pickupSoundIndex>4){this.pickupSoundIndex=1;}
ig.SFX["pickup"+this.pickupSoundIndex].play();},isEntityOnScreen:function(ent){return(ent.pos.x+ent.size.x/2-this.screen.x>0&&ent.pos.x+ent.size.x/2-this.screen.x<ig.system.width&&ent.pos.y+ent.size.y/2-this.screen.y>0&&ent.pos.y+ent.size.y/2-this.screen.y<ig.system.height);},loadGameAssets:function(){new ig.Image("media/images/game/tussle.png");new ig.Image("media/images/game/sylvia.png");if(this.levelIndex<1){return;}
new ig.Image("media/images/game/piginmud.png");if(this.levelIndex<2){return;}
new ig.Image("media/images/game/rock-mama.png");},sortBy:function(a,b){if(a.lowLevel!=b.lowLevel){if(a.lowLevel===true){return-1;}else if(b.lowLevel===true){return 1;}}
if(a.highLevel!=b.highLevel){if(a.highLevel===true){return 1;}else if(b.highLevel===true){return-1;}}
return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}});ig.deploy=function(){if(typeof ig.Strings!=="undefinied"){ig.DEFAULT_FONTBOLD=ig.GameConfig.DEFAULT_BOLD||true;ig.DEFAULT_FONTFAMILY=ig.GameConfig.DEFAULT_FONTFAMILY||"MatterhornSerif, Arial, sans-serif";}
ig.main("#canvas",ig.HelpingHands,30,GameStartup.targetWidth,GameStartup.targetHeight,1,ig.Preloader);};});