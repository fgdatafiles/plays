window.Box2D=window.Box2D(),function(){"use strict";var t=include("Box2D.b2Color"),e=include("Box2D.b2Transform"),i=include("Box2D.b2Vec2"),n=include("Box2D.JSDraw"),s=include("Box2D.destroy"),r=include("Box2D.wrapPointer"),o={},a=1,h=[],l=function(e,i){var n=r(i,t),s=(255*n.get_r()|0)+","+(255*n.get_g()|0)+","+(255*n.get_b()|0);e.fillStyle="rgba("+s+",0.25)",e.strokeStyle="rgb("+s+")",e.lineWidth=.04},c=function(t,e,n,s){var o=0,a=null;for(t.beginPath(),o=0;o<n;o++)a=r(e+8*o,i),0===o?t.moveTo(a.get_x(),a.get_y()):t.lineTo(a.get_x(),a.get_y());t.closePath(),s&&t.fill(),t.stroke()},p=function(t,e,n,o,a){var h=r(e,i),l=r(o,i),c=null,p=null;t.beginPath(),t.arc(h.get_x(),h.get_y(),n,0,2*Math.PI,!1),a&&t.fill(),t.stroke(),a&&(p=new i(h.get_x(),h.get_y()),c=new i(n*l.get_x(),n*l.get_y()),p.op_add(c),t.beginPath(),t.moveTo(h.get_x(),h.get_y()),t.lineTo(p.get_x(),p.get_y()),t.stroke(),s(p),s(c))};o[0]=null,window.Box2D.helpers={getCanvasDebugDraw:function(t){var o=new n;return o.DrawSegment=function(e,n,s){l(t,s),function(t,e,n){var s=r(e,i),o=r(n,i);t.beginPath(),t.moveTo(s.get_x(),s.get_y()),t.lineTo(o.get_x(),o.get_y()),t.stroke()}(t,e,n)},o.DrawPolygon=function(e,i,n){l(t,n),c(t,e,i,!1)},o.DrawSolidPolygon=function(e,i,n){l(t,n),c(t,e,i,!0)},o.DrawCircle=function(e,n,r){var o=new i(0,0);l(t,r),p(t,e,n,o,!1),s(o)},o.DrawSolidCircle=function(e,i,n,s){l(t,s),p(t,e,i,n,!0)},o.DrawTransform=function(i){!function(t,i){var n,s=r(i,e),o=s.get_p(),a=s.get_q();t.save(),t.translate(o.get_x(),o.get_y()),t.scale(.5,.5),t.rotate(a.GetAngle()),t.lineWidth*=2,(n=t).strokeStyle="rgb(192,0,0)",n.beginPath(),n.moveTo(0,0),n.lineTo(1,0),n.stroke(),n.strokeStyle="rgb(0,192,0)",n.beginPath(),n.moveTo(0,0),n.lineTo(0,1),n.stroke(),t.restore()}(t,i)},o},getUserData:function(t){return o[t.GetUserData()]},setUserData:function(t,e){var i=t.GetUserData();i||(h.length?i=h.pop():(i=a,a+=1),t.SetUserData(i)),o[i]=e},clearUserData:function(t){var e=t.GetUserData();e&&(o.hasOwnProperty(e)&&h.indexOf(e)<0?(h.push(e),o[e]=null):platypus.debug.warn("Box2D `userData` Helper: Tried to clear userData with an invalid ID."))}}}(),platypus.Badger=function(){"use strict";var t=[],e=function(e,i,n,s){var r=null,o=0,a="",h=0,l="",c={},p=null,u={},d=null;for(a in this.badgesAwarded=[],this.keys=c,this.userData=n,this.badges=u,this.loading=!0,this.gameId=i,e)if(e.hasOwnProperty(a))for(r=e[a].badges,u[a]=[],h=r.length;h--;){for(l in d=r[h],u[a][d.id]=p={},d)d.hasOwnProperty(l)&&(p[l]=d[l]);if(p.subgoals)for(o=p.subgoals.length;o--;)c[p.subgoals[o].key]||(c[p.subgoals[o].key]=[]),c[p.subgoals[o].key].push(p)}n.readGameData("SpaceScouts","BadgeProgress",function(e){var i="",n=e||{},r=t.length;for(i in this.progress=n,n.badges||(n.badges={}),n)n.hasOwnProperty(i)&&"badges"!==i&&this.setProgress(i,n[i]);for(this.loading=!1;r--;)t[r]();t=null,s&&s(this.badges,this.getBadgeStatusForLAP())}.bind(this))},i=e.prototype;return i.increment=function(e){this.loading?t.push(this.increment.bind(this,e)):this.setProgress(e,(this.progress[e]||0)+1)},i.setProgress=function(t,e){var i=this.keys[t],n=!1,s=0,r=0,o=!this.loading,a=0,h=this.progress,l=null;if(i){for(s=i.length,o&&platypus.debug.orange&&platypus.debug.orange('Badger: "'+t+'" badge subgoal incremented for '+s+" badge"+(s>1?"s":"")+".");s--;){for(r=(l=i[s].subgoals).length,n=!0;r--;)l[r].key===t&&(a=l[r].progress||0,l[r].progress=Math.min(e,+l[r].count),l[r].progress===+l[r].count&&(l[r].completed=!0),o&&a!==l[r].progress&&(platypus.game.currentScene?platypus.game.currentScene.triggerOnChildren("badge-incremented",{badge:i[s],subgoal:t,originalProgress:a,progress:l[r].progress,count:+l[r].count}):platypus.debug.warn("Badger: just tried to show a badge notification, but there is no current scene."))),l[r].completed||(n=!1);!n||i[s].completed||this.gameId&&this.gameId!==i[s]["game-id"]||(i[s].completed=!0,h.badges[i[s].name]||this.badgesAwarded.push(i[s]))}this.loading||(h[t]=e,this.userData.writeGameData("SpaceScouts","BadgeProgress",h))}else platypus.debug.warn('Badger: There are no badges that have a "'+t+'" subgoal. Progress for this key will not be saved.')},i.award=function(){var t=this.badgesAwarded,e=t.length,i=this.progress,n=null;if(e){for(n=t.greenSlice(),t.length=0;e--;)this.increment("earned-badge"),i.badges[n[e].name]=!0;return this.userData.writeGameData("SpaceScouts","BadgeProgress",i),n}return null},i.getBadges=function(t){return t?this.badges[t]:this.badges},i.getBadgeStatusForLAP=function(t){var e=[],i=this.badges,n=null,s=null,r="",o=0,a=null,h=null,l=0,c=0,p=0;for(r in i)if(i.hasOwnProperty(r))for(c=(n=i[r]).length;c--;)if(p=(h=(s=n[c]).subgoals).length,l=0,o=0,a={},t){if(t===s.name){for(;p--;)a[h[p].key]=h[p].completed||!1;return{name:s.name,unlocked:s.completed||!1,steps:a}}}else{for(;p--;)a[h[p].key]=h[p].completed||!1,l+=+h[p].count,o+=h[p].progress||0;e.push({name:s.name,unlocked:s.completed||!1,progress:o/l,steps:a})}return e},e}(),platypus.DragGroup=function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Vector"),i=function(t,e){return t*t+e*e},n=function(t,e){for(var i=e.length,n=0,s=0,r=t.getPinnedEntities(),o=null;i--;)for(o=e[i].getPinnedEntities(),n=r.length;n--;)for(s=o.length;s--;)if(r[n]===o[s])return!1;return!0},s=function(t,e){return t.distance-e.distance},r=function(e){this.effected=Array.setUp(),this.immobile=!1,this.valid=!1,this.lastValidPosition=null,this.validSnaps=Array.setUp(),this.entities=Array.setUp(),this.offsets=Array.setUp(),this.saOrigin=t.setUp("x",e.x,"y",e.y),this.lastPosition=null,this.state=0,this.snap=null,this.snappingEnabled=!1,this.readyToEnd=null,this.collisionComplete=!1,this.originalEntityCount=0},o=r.prototype;return o.addEntity=function(t){t.inDragGroup&&t.inDragGroup!==this&&platypus.debug.warn("Attempting to add an entity to a new drag group that is already in a drag group."),this.entities.indexOf(t)<0&&(this.entities.push(t),this.offsets.push(e.setUp(t.x-this.saOrigin.x,t.y-this.saOrigin.y)),t.inDragGroup=this)},o.checkValidity=function(){var t,e,i=this.entities,n=null,s=this.effected,r=i.length,o=0;for(i[0].parent.world.Step(0,1,1);r--;){if(!(n=i[r]).inBuildingArea||n.overlaps&&!this.lastValidPosition||n.inTrash&&(t=n.inTrash,e=n.body.GetPosition(),t[0].TestPoint(e))){o=2;break}n.overlaps&&(o=1)}if(0===o&&s.length>i.length)for(r=s.length;r--;)if(s[r].overlaps){o=1;break}this.state=o,this.lastPosition&&(0===o?this.lastValidPosition=this.lastPosition:this.lastPosition.recycle(),this.lastPosition=null)},o.startMovement=function(t){var i=this.entities,n=null,s=i.length;for(this.originalEntityCount=s;s--;)(n=i[s]).startMovement(n);this.state=0,this.immobile=!1,this.snappingEnabled=!0,this.lastPosition=e.setUp(t.x,t.y)},o.selectAll=function(){var t=this.entities,e=null,i=t.length,n=this.originalEntityCount;if(i!==n)for(this.snappingEnabled=!1,n=this.originalEntityCount;n<i;n++)(e=t[n]).startMovement(e)},o.validateMotion=function(s,r){for(var o,a=this.entities,h=a.length,l=3+h,c=null,p=this.offsets,u=null,d=t.setUp("adjusted",null,"valid",!0,"movable",!0,"entity",null,"position",e.setUp(),"forSnap",!!s.pinTo),g=null,y=d.position;l--;){for(h=a.length;h--;){if(c=p[h],y.x=s.x+c.x,y.y=s.y+c.y,d.entity=a[h],d.valid=!0,d.adjusted=null,a[h].validateMotion(d,3),!d.valid){d.movable||(this.immobile=!0);break}if(d.adjusted){if(s.pinTo){d.valid=!1;break}s.x=d.adjusted.x-c.x,s.y=d.adjusted.y-c.y;break}}if(!d.valid||!d.adjusted)break}if(o=d.valid&&!d.adjusted,d.recycle(),o&&s.pinTo){for((g=Array.setUp()).push(s.pinTo),h=0;h<r.length;h++)if((u=r[h]).pinFrom&&u!==s&&.9>i(s.x-u.x,s.y-u.y)){if(!n(u.pinTo,g))return g.recycle(),!1;g.push(u.pinTo)}return g.recycle(),!0}return o},o.continueMovement=function(t,i){for(var n=this.entities,s=n.length,r=null,o=this.offsets,a=e.setUp();s--;)r=o[s],a.x=t.x+r.x,a.y=t.y+r.y,n[s].continueMovement(a);for(s=n.length;s--;)n[s].triggerEvent("resolve-bodies");for(s=n.length;s--;)n[s].triggerEvent("resolve-joints");if(i&&i.length)for(s=n.length;s--;)n[s].triggerEvent("resolve-snaps",i);this.lastPosition=e.setUp(t.x,t.y),a.recycle()},o.endMovement=function(t){for(var i=this.entities,n=i.length,s=null,r=this.offsets,o=e.setUp(),a=this.validSnaps,h=a.length;n--;)i[n].destroyed||(s=r[n],o.x=t.x+s.x,o.y=t.y+s.y,i[n].endMovement(o,this.state,this.immobile)),i[n].inDragGroup=null;if(0===this.state){for(;h--;)a[h].panel?(a[h].pinFrom.state.set("panelled",!0),a[h].pinFrom.panelled=a[h].pinTo,a[h].pinFrom.tint=null):a[h].pinFrom.triggerEvent("snap-to-pin",a[h].pinTo),a[h].recycle();a.length=0}else{for(;h--;)a[h].pinFrom.destroyed||(a[h].pinFrom.tint=null),a[h].recycle();a.length=0}o.recycle()},o.getSnap=function(e,n,s){var r=platypus.game.app.config.pins.snapDistance,o=r*r,a=0,h=null,l=null,c=null,p=s.length;if(e.destroyed)return null;for(;p--;)e!==(c=s[p])&&(a=i(c.x-n.x,c.y-n.y))<o&&(l=t.setUp("pinFrom",e,"pinTo",c,"snappable",!0),e.canSnapTo(l,0)&&(o=a,h=c),l.recycle());return h?t.setUp("distance",o,"pinTo",h,"pinFrom",e):null},o.getSnaps=function(t,n,r,o){var a=null,h=this.entities,l=h.length,c=null,p=this.offsets,u=this.saOrigin,d=null,g=null;if(this.snappingEnabled){for(g=e.setUp();l--;)"pin"===(a=h[l]).type&&(c=p[l],g.x=n.x+c.x,g.y=n.y+c.y,(d=this.getSnap(a,g,r))&&(d.x=d.pinTo.x-c.x,d.y=d.pinTo.y-c.y,t.push(d)));t.length>1&&t.sort(s),g.recycle()}return o&&i(n.x-u.x,n.y-u.y)<25?t.push(e.setUp(u.x,u.y)):t.push(e.setUp(n.x,n.y)),t},o.getPanelSnaps=function(e,i){for(var n=null,s=this.entities,r=s.length,o=null,a=this.offsets,h=t.setUp("x",0,"y",0,"panelled",null);r--;)"pin"===(n=s[r]).type&&(o=a[r],h.x=i.x+o.x,h.y=i.y+o.y,n.panelled=!1,n.state.set("panelled",!1),n.parent.triggerEventOnChildren("pin-on-panel",h),h.panelled&&(e.push(t.setUp("pinTo",h.panelled,"pinFrom",n,"panel",!0)),h.panelled=!1));return h.recycle(),e},recycle.add(r,!!springroll.Debug,"DragGroup",function(){this.lastValidPosition&&this.lastValidPosition.recycle(),this.readyToEnd&&this.readyToEnd.recycle(),this.effected.recycle(),this.validSnaps.recycle(),this.entities.recycle(),this.offsets.recycle(),this.saOrigin.recycle(),r.recycle(this)}),r}(),platypus.LabRetriever=function(){"use strict";var t=[],e=function(e,i){this.labItemsUnlocked=[],this.userData=e,this.loading=!0,this.onLoaded=!1,e.readGameData("space-scouts-lab","LabUnlocks",function(e){var n=e||{},s=t.length;for(this.progress=n,this.loading=!1;s--;)t[s]();t=null,i&&i(this),this.onLoaded&&this.onLoaded()}.bind(this))},i=e.prototype;return i.has=function(t){return!!this.progress[t]},i.isNew=function(t){return!(this.progress[t]&&this.progress[t].used)},i.unlock=function(e){this.loading?t.push(this.unlock.bind(this,e)):this.progress[e]||(this.labItemsUnlocked.push(e),this.progress[e]={},this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress))},i.use=function(t){"space-scouts-lab"===platypus.game.app.name?this.loading||!this.progress[t]||this.progress[t].used||(this.progress[t].used=!0,this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress)):platypus.debug.warn('LabRetriever: Only the Lab is allowed to mark "'+t+'" as a used item.')},i.award=function(){var t=this.labItemsUnlocked;return t.length?t:null},e}(),function(){"use strict";var t,e,i,n,s,r,o,a,h=window.navigator.userAgent.toLowerCase(),l=include("platypus.Data"),c=[["os 9_","","ios935"],["os 10_","","ios935"],["kfgiwi","","small"],["kfdowi","","small"],["os 11_","","small"],["iphone","dpi2","small"],["iphone","dpi3","small"],["ipad; cpu os 12_","scr4:3","small"],["ipad; cpu os 13_","scr4:3","small"],["android 4.","","small"],["android 5.","","small"],["android 6.","","small"]],p=0,u=null,d="",g=platypus.PIXIAnimation.formatSpriteSheet.bind(platypus.PIXIAnimation);for(p=0;p<c.length;p++)if(u=c[p],h.indexOf(u[0])>=0&&(!u[1]||"scr4:3"===u[1]&&window.screen.height/window.screen.width==1024/768||"dpi2"===u[1]&&2===window.devicePixelRatio||"dpi3"===u[1]&&3===window.devicePixelRatio)){d=u[2];break}d?(platypus.modifyAllAssets={ios935:4,small:2}[d],springroll.Task.prototype.filter=(a="/"+d+"/",function(t){var e=t.lastIndexOf("/"),i=t.substring(t.lastIndexOf(".")+1),n=t.substring(e+1);return"png"===i||"jpg"===i?t.substring(0,e)+a+n:t}),platypus.PIXIAnimation.formatSpriteSheet=(t=/([\w-]+)\.(\w+)$/,e=function(t,e,i){var n=platypus.modifyAllAssets,s=null,r=0;for(r=0;r<t.length;r++)s=t[r],e.push(Array.setUp(s[0]/n>>0,s[1]/n>>0,s[2]/n>>0,s[3]/n>>0,s[4]+i,s[5]/n>>0,s[6]/n>>0))},i=function(t){for(var e=t.length,i="",n="";e--;)i+=n+(t[e].src||t[e]).substring(0,128),n=",";return i},n=function(t,n){var o=n.animations,a=n.images,h=n.framerate||60,l=n.frames,c=0,p=Array.setUp(),u=a.length,d=l.length,y=t.animations,m=t.images,v=t.framerate||60,f=t.frames,w=null;for(n.id?n.id+=";"+(t.id||i(t.images)):n.id=t.id||i(t.images),c=0;c<m.length;c++)p.push(r(m[c])),a.push(p[c]);return Array.isArray(f)?e(f,l,u):(w=g(t),e(w.frames,l,u),w.recycleSpriteSheet()),function(t,e,i,n,r){var o="";for(o in t)t.hasOwnProperty(o)&&(e[o]&&(e[o].frames.recycle(),e[o].recycle(),platypus.debug.olive('PIXIAnimation "'+r+'": Overwriting duplicate animation for "'+o+'".')),e[o]=s(o,t[o],i,n))}(y,o,v/h,d,n.id),p.recycle(),n},s=function(t,e,i,n){var s=0,r=0,o=Array.setUp(),a=0;if("number"==typeof e)return o.push(e+n),l.setUp("frames",o,"next",t,"speed",i);if(Array.isArray(e)){for(r=e[0]||0,a=(e[1]||r)+1+n,s=r+=n;s<a;s++)o.push(s);return l.setUp("frames",o,"next",e[2]||t,"speed",(e[3]||1)*i)}for(s=0;s<e.frames.length;s++)o.push(e.frames[s]+n);return l.setUp("frames",o,"next",e.next||t,"speed",(e.speed||1)*i)},r=function(e){var i=!1;return"string"==typeof e&&(i=e.match(t))?i[1]:e},o=function(){var t=this.animations,e="";for(e in t)t.hasOwnProperty(e)&&t[e].frames.recycle(),t[e].recycle();this.frames.recycle(2),this.images.recycle(),this.recycle()},function(t){var e=platypus.PIXIAnimation.EmptySpriteSheet,i=t;if("string"==typeof i&&(i=platypus.game.settings.spriteSheets[t]),i){if(e=l.setUp("animations",l.setUp(),"framerate",60,"frames",Array.setUp(),"id","","images",Array.setUp(),"recycleSpriteSheet",o),Array.isArray(i))return function(t,e){for(var i=t.length,s=null;i--;)"string"==typeof(s=t[i])&&(s=platypus.game.settings.spriteSheets[s]),s&&n(s,e);return e}(i,e);if(i)return n(i,e)}return e})):platypus.modifyAllAssets=1}(),function(){"use strict";var t=include("springroll.SavedData"),e=include("springroll.UserData").prototype;e.readGameData=function(e,i,n){this.container.supported?this.container.fetch("userDataRead",function(t){n(t.data)},e+i,!0):n(t.read(e+i))},e.writeGameData=function(e,i,n,s){if(!this.container.supported)return t.write(e+i,n),void(s&&s());this.container.fetch("userDataWrite",function(){s&&s()},{name:e+i,value:n},!0)},e.removeGameData=function(e,i,n){if(!this.container.supported)return t.remove(e+i),void(n&&n());this.container.fetch("userDataRemove",function(){n&&n()},e+i,!0)},e.fixFetch=function(){var t,e,i,n=this.container;n.___fetch||(n.___fetch=n.fetch,n.fetch=(t=!1,e=function(n,s){var r=null;n(s),i.length?(r=i.shift(),this.___fetch(r.event,e.bind(this,r.callback),r.options,r.once)):t=!1},i=[],function(n,s,r,o){t?i.push({event:n,callback:s,options:r,once:o}):(t=!0,this.___fetch(n,e.bind(this,s),r,o))}))}}(),function(){"use strict";var t,e="file:"===window.location.protocol||"ionic:"===window.location.protocol||"localhost:8080"===window.location.host,i=window.navigator.userAgent.toLowerCase(),n=i.indexOf("os 9_")>=0||i.indexOf("os 10_")>=0,s=include("springroll.Application"),r=include("platypus.Badger"),o=include("springroll.pixi.PixiDisplay"),a=include("springroll.Debug",!1),h=include("platypus.LabRetriever"),l=document.getElementById("interaction"),c=function(){l.style.display="none",p=!1,u.paused=!1;try{document.body.removeChild(l)}catch(t){}},p=!e||i.indexOf("os 9_")>=0,u=new s({name:"mission-control",canvasId:"stage",captions:"captions",configPath:"assets/config/config.json",display:o,displayOptions:{clearView:!0,preserveDrawingBuffer:!0},enableHiDPI:!0,brainpoints:{callback:function(t){u.trigger("brainpoint",t)},apiOverride:"https://proxy.services.pbskids.org/enlearn",appData:{releaseBuild:!a}},preload:(t=[],n||t.push({id:"ScreenBadge_Standard",src:"assets/images/ScreenBadge_Standard.png"}),t),resizeElement:"content",responsive:!0,uniformResize:!1,state:"menu",version:"1.0.4"}),d=function(){var t=document.getElementById("frame"),e=window.innerHeight,i=window.innerWidth,n=.75*i>>0,s=2*e>>0;e>n?(t.style.height=n+"px",t.style.top=((e-n)/2>>0)+"px",t.style.width="",t.style.left=""):i>s?(t.style.width=s+"px",t.style.left=((i-s)/2>>0)+"px",t.style.height="",t.style.top=""):(t.style.height="",t.style.top="",t.style.width="",t.style.left="")};if(u.userData.fixFetch(),u.on("init",function(){var t=new r(u.config["badge-list"],"space-scouts-home-base"!==u.name?u.name:"",u.userData,function(t,e){a&&u.analyticsEmitter.enableLogging(),u.userData.read("Completed-Levels",function(t){platypus.completedLevels=t||[],u.analyticsEmitter.startGame(u.options.version,t||[],e)}),u.googleAnalytics.event(u.name,"StartGame")});u.container.on("download-complete",function(){u.sound.play("download-complete")}),u.paused=p,platypus.labRetriever=new h(u.userData),platypus.badger=t,t.increment("tried-"+u.name),platypus.game.app.userData.remove("storyVO"),platypus.game.app.userData.remove("last-level-played"),u.captions.data=u.config.captions,platypus.game.settings.entities["action-layer"].maxStepsPerTick=60/platypus.modifyAllAssets}),u.once("endGame",function(t){u.analyticsEmitter.endGame(t,platypus.completedLevels,platypus.badger.getBadgeStatusForLAP()),u.googleAnalytics.event(u.name,"EndGame")}),u.on("resize",function(t,e){u.transition?(u.transition.x=t/2,u.transition.y=e/2,u.transition.scale.x=u.transition.scale.y=e/880):(platypus.savedWidth=t,platypus.savedHeight=e)}),platypus.savedGame=sessionStorage.getItem("load-saved-game")||null,platypus.savedGame){sessionStorage.removeItem("load-saved-game");try{platypus.savedGame=JSON.parse(platypus.savedGame)}catch(t){platypus.savedGame=null}}u.on("brainpoint",function(t){platypus.debug.log('Brain Point "'+t.type+'" received! '+t.message,t),u.analyticsEmitter.receivedBrainPoint(u.levelBot||"",u.levelNumber||0,t),u.googleAnalytics.event(u.name,"ReceivedBrainPoint"),platypus.badger&&u.config.brainPoints[t.type]&&(platypus.badger.increment(u.config.brainPoints[t.type]),u.voPlayer.playing||u.voPlayer.play("brain-point-"+t.type))}),window.app=u,window.addEventListener("resize",d,!1),window.addEventListener("orientationchange",d,!1),window.addEventListener("focus",d,!1),window.addEventListener("load",d,!1);try{!p||window.AudioContext&&"running"!==(new window.AudioContext).state||window.webkitAudioContext&&"running"!==(new window.webkitAudioContext).state||(p=!1)}catch(t){platypus.debug.warn("Unlocking audio error: "+t.message)}p&&(l.addEventListener("pointerdown",c),l.addEventListener("mousedown",c),l.addEventListener("touchstart",c),l.style.display="block")}(),function(){"use strict";platypus.createComponentClass({id:"ActionButton",properties:{},publicProperties:{},initialize:function(){this.c=0,this.c2=0},events:{"scene-loaded":function(t){"string"==typeof t.level?this.currentLevel=t.level:this.currentLevel=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null}(t.level.properties,"levelId"),"level-1"==this.currentLevel&&(this.owner.triggerEvent("disable"),this.owner.opacity=.33,this.c=5500)},"handle-logic":function(){this.c&&(this.c--,0===this.c&&(this.owner.triggerEvent("enable"),this.owner.opacity=1))},pressed:function(){platypus.dragging||this.owner.triggerEvent("pressed2")},"control-panel-width-set":function(t){this.owner.x=t/2+100}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Asteroid",properties:{star:!1},publicProperties:{attack:!1},initialize:function(){this.worldBounds=null,this.remove=!1,this.makeStar=!1,this.vortex=null,this.scaleSpeed=.001},events:{adopted:function(){var e=new t(this.randRange(-1,1),this.randRange(-1,1));if(this.owner.body.SetLinearVelocity(e),this.owner.body.SetTransform(this.owner.body.GetWorldCenter(),this.randRange(0,6)),this.owner.body.ApplyTorque(this.randRange(-250,250)),this.attack){var i=Math.atan2(1800-this.owner.y,1384-this.owner.x)*this.randRange(.9,1.1),n=this.randRange(1.75,2.25),s=new t(Math.cos(i)*n,Math.sin(i)*n);this.owner.body.SetLinearVelocity(s)}},"camera-loaded":function(t){this.worldBounds=t.world},"collide-with-satellite":function(){this.remove=!0},"collide-with-hand":function(){this.star&&(this.makeStar=!0)},"collide-with-vortex":function(t){this.vortex=t.entity},"handle-logic":function(){var t=this.owner.body.GetLinearVelocity();t.get_x()>10&&(t.set_x(10),this.owner.body.SetLinearVelocity(t)),t.get_x()<-10&&(t.set_x(-10),this.owner.body.SetLinearVelocity(t)),t.get_y()>10&&(t.set_y(10),this.owner.body.SetLinearVelocity(t)),t.get_y()<-10&&(t.set_y(-10),this.owner.body.SetLinearVelocity(t)),this.owner.x>this.worldBounds.right+50&&(this.owner.x=0),this.owner.x<-50&&(this.owner.x=this.worldBounds.right),this.owner.y>this.worldBounds.bottom+50&&(this.owner.y=0),this.owner.y<-50&&(this.owner.y=this.worldBounds.bottom),this.vortex&&(this.scaleSpeed*=1.05,this.owner.scaleX-=this.scaleSpeed,this.owner.scaleY-=this.scaleSpeed,this.owner.x+=(this.vortex.x-this.owner.x)/10,this.owner.y+=(this.vortex.y-this.owner.y)/10,this.owner.scaleX<.01&&(this.vortex=null,this.remove=!0))},"prepare-logic":function(){this.remove&&(this.owner.parent.removeEntity(this.owner),this.remove=!1),this.makeStar&&(this.owner.parent.addEntity({type:"star",properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+1}}),this.remove=!0,this.makeStar=!1)}},methods:{destroy:function(){this.worldBounds=null,this.vortex=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.StateMap"),i={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:!1,paused:!1,playthrough:!1},n=function(e){var n="",s=null;return"string"==typeof e?(n=e,s={}):(n=e.sound,s={interrupt:e.interrupt,delay:e.delay,offset:e.offset,loop:e.loop,volume:e.volume,pan:e.pan,startTime:e.startTime,duration:e.duration,mute:e.mute,paused:e.paused,playthrough:e.playthrough}),function(e){var r=null;e=e||s,(r=t.setUp("interrupt",e.interrupt||s.interrupt||i.interrupt,"delay",e.delay||s.delay||i.delay,"loop",e.loop||s.loop||i.loop,"offset",e.offset||s.offset||i.offset,"volume",void 0!==e.volume?e.volume:void 0!==s.volume?s.volume:i.volume,"pan",e.pan||s.pan||i.pan,"mute",e.mute||s.mute||i.mute,"paused",e.paused||s.paused||i.paused,"playthrough",e.playthrough||s.playthrough||i.playthrough)).complete=function(t){t.audio&&!this.owner.destroyed&&(this.removeClip(t.audio),this.owner.triggerEvent("clip-complete")),t.recycle()}.bind(this,r),r.audio=this.player.play(n,r),r.audio&&(r.audio.soundId=n,r.audio.playthrough=r.playthrough,this.activeAudioClips.push(r.audio))}};platypus.createComponentClass({id:"AudioSFX",properties:{audioMap:null,forcePlayThrough:!0,eventBased:!0,stateBased:!1},initialize:function(t){var e="",i=null,s=null;if(this.activeAudioClips=Array.setUp(),this.state=this.owner.state,this.stateChange=!1,this.player=platypus.game.app.sound,t.audioMap)for(e in this.stateBased&&(this.checkStates=Array.setUp()),t.audioMap)t.audioMap.hasOwnProperty(e)&&(s=t.audioMap[e],i=n(s),s.sound&&(s=s.sound),this.eventBased&&this.addEventListener(e,i),this.stateBased&&this.addStateCheck(e,s,i));this.paused=!1},events:{"handle-render":function(){var t=0,e=null,i=this.state;if(!this.paused&&this.stateBased&&this.stateChange){for(t=(e=this.checkStates).length;t--;)e[t].check(i);this.stateChange=!1}},"state-changed":function(){this.stateChange=!0},"toggle-mute":function(t){this.handleClip(t,function(t){t&&(t.unmuted?(t.volume=t.unmuted,delete t.unmuted):(t.unmuted=t.volume,t.volume=0))})},"stop-audio":function(t){t?"string"==typeof t?this.stopAudio(t):this.stopAudio(t.audioId||!1,t.playthrough||!1):this.stopAudio()},"mute-audio":function(t){this.handleClip(t,function(t){t&&(t.unmuted=t.volume,t.volume=0)})},"unmute-audio":function(t){this.handleClip(t,function(t){t&&(t.volume=t.unmuted,delete t.unmuted)})},"pause-audio":function(t){this.handleClip(t,function(t){t&&t.pause()})},"unpause-audio":function(t){this.handleClip(t,function(t){t&&t.unpause()})},"set-pan":function(t,e){var i=e||"",n=function(t,e){e&&(e.pan=t)};e?this.handleClip(i,n.bind(null,t)):this.getAllClips(n.bind(null,t))},"set-volume":function(t,e){var i=e||"",n=function(t,e){e&&(e.volume=t)};e?this.handleClip(i,n.bind(null,t)):this.getAllClips(n.bind(null,t))}},methods:{handleClip:function(t,e){"string"==typeof t?this.getClipById(t,e):this.getAllClips(e)},getClipById:function(t,e){var i=0,n=this.activeAudioClips;for(i=0;i<n.length;i++)if(n[i].soundId===t)return e&&e(n[i]),n[i];return e&&e(null),null},getAllClips:function(t){var e=0,i=this.activeAudioClips;if(t)for(e=0;e<i.length;e++)t(i[e]);return i},stopAudio:function(t,e){var i=this.activeAudioClips,n=(function(t){this.stopAudioInstance(t.currentTarget)}.bind(this),i.length);if(t)for(;n--;)i[n].soundId===t&&(i[n].playthrough||e||(i[n].stop(),i.greenSplice(n)));else{for(;n--;)e||i[n].playthrough||i[n].stop();i.length=0}},stopAudioInstance:function(t){var e=this.activeAudioClips,i=e?e.indexOf(t):-1;i>=0&&e.greenSplice(i),t.stop()},removeClip:function(t){var e=this.activeAudioClips.indexOf(t);e>=0&&this.activeAudioClips.greenSplice(e)},addStateCheck:function(i,n,s){var r=e.setUp(i),o=t.setUp("states",r,"playing",!1);o.check=function(t,e,i,n){var s=n.includes(t.states);s!==t.playing&&(s?i():this.stopAudio(e,this.forcePlaythrough),t.playing=s)}.bind(this,o,n,s.bind(this)),this.checkStates.push(o)},destroy:function(){var t=this.checkStates,e=null,i=0;if(this.stopAudio(),this.activeAudioClips.recycle(),this.activeAudioClips=null,this.state=null,t){for(i=t.length;i--;)(e=t[i]).states.recycle(),e.recycle();t.recycle(),this.checkStates=null}}}})}(),function(){"use strict";var t=include("platypus.Data"),e=function(t,e){return t.time-e.time},i=function(i,n){var s=0;for(s=0;s<i.length;s++)n.push(t.setUp("event",i[s].event,"time",i[s].time||0,"message",i[s].message));return s&&n.sort(e),n},n=function(i,n,s){var r=0,o=s.getElapsed();for(r=0;r<i.length;r++)n.push(t.setUp("event",i[r].event,"time",(i[r].time||0)+o,"message",i[r].message||null));r&&n.sort(e)},s=function(t,e,i){var s=0,r=Array.setUp();for(s=0;s<t.length;s++)t[s].sound?(t[s].events&&r.push(n.bind(this,t[s].events,e,i)),r.push(t[s].sound)):r.push(t[s]);return r},r=function(t,e){this.playingAudio=!1,this.player.unloadSound(),this.owner.destroyed||(this.checkTimeEvents(!0),this.owner.triggerEvent("sequence-complete")),e.recycle()},o=function(t,e){var n=null,o=Array.setUp(),a=this.player;"string"==typeof t?n=Array.setUp(t):Array.isArray(t)?n=s(t,o,a):(t.events&&i(t.events,o),n=Array.isArray(t.sound)?s(t.sound,o,a):Array.setUp(t.sound)),e&&e.events&&i(e.events,o),a.play(n,r.bind(this,!0,n),r.bind(this,!1,n)),this.eventList.recycle(),this.eventList=o,this.playingAudio=!0};platypus.createComponentClass({id:"AudioVO",properties:{audioMap:null},initialize:function(){var t="";if(this.eventList=Array.setUp(),this.playingAudio=!1,this.player=platypus.game.app.voPlayer,this.player.trackSound=platypus.supports.iOS,this.audioMap)for(t in this.audioMap)this.audioMap.hasOwnProperty(t)&&this.addEventListener(t,o.bind(this,this.audioMap[t]));this.paused=!1},events:{"handle-render":function(){this.paused||this.checkTimeEvents(!1)},"stop-audio":function(){this.player.stop(),this.player.voList=[]}},methods:{checkTimeEvents:function(t){var e=null,i=this.eventList,n=0,s=this.owner;if(i&&i.length)for(n=this.player.getElapsed();i.length&&(t||i[0].time<=n);)e=i.greenSplice(0),s.trigger(e.event,e.message),e.recycle()},destroy:function(){this.playingAudio&&(this.player.stop(),this.player.voList=[]),this.eventList.recycle()}}})}(),function(){"use strict";var t=include("platypus.Entity");platypus.createComponentClass({id:"BackgroundLoader",events:{adopted:function(){this.owner.parent.parent.layers[0].addEntity({type:"mars_bg_stationary"})}},getAssetList:function(){return t.getAssetList({type:"mars_bg_stationary"})}})}(),function(){"use strict";var t=include("platypus.Entity");platypus.createComponentClass({id:"BackgroundLoaderSpace",events:{adopted:function(){this.owner.parent.parent.layers[0].addEntity({type:"space_bg_stationary"})}},getAssetList:function(){return t.getAssetList({type:"space_bg_stationary"})}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeAward",properties:{},publicProperties:{},initialize:function(){this.badgeList=null,this.lastState="",this.hiding=!0},events:{"earned-badge":function(t){this.badgeList=t},"show-next-badge":function(){var t=platypus.game.app,e=null,i=this.owner.state;this.hiding?(this.owner.triggerEvent("show-earned-badge-dialog"),this.hiding=!1,e=this.badgeList.greenSplice(0),this.badgeList.length||this.owner.triggerEvent("last-badge-showing"),t.analyticsEmitter.unlockedBadge(t.levelBot||"",t.levelNumber||0,e.name),t.googleAnalytics.event(t.name,"BadgeUnlocked",e.name,1),this.lastState&&i.set(this.lastState,!1),this.lastState=e["game-id"]+"-"+e.id,i.set(this.lastState,!0),this.owner.triggerEvent("set-text",e.name),this.owner.triggerEvent(this.lastState)):(this.badgeList.length?this.owner.triggerEvent("hide-earned-badge-dialog-and-next"):this.owner.triggerEvent("hide-earned-badge-dialog"),this.hiding=!0)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeBannerBuilder",properties:{bannerPositions:null,toBuild:"all",zoomOutWidth:1816,zoomOutHeight:1360,zoomInWidth:908,zoomInHeight:680},publicProperties:{},initialize:function(){var t=platypus.game.app,e=t.name,i=platypus.badger.getBadges(),n=0,s=null;if(this.showEverything="space-scouts-home-base"===e,this.zoomBanners=[],this.banners=[],this.badges={},this.badgeHighlight=null,this.collectedBadges=0,this.zooming=!1,this.cameraX=0,this.cameraY=0,this.tweenWidth=1816,this.tweenHeight=1360,this.targetBanner=null,this.zoomed="out",this.showEverything)for(s in i)i.hasOwnProperty(s)&&(this.buildBanner(s,i[s],n),n++);else this.buildBanner(e,i[e],n);this.badgeHighlight=this.owner.addEntity({type:"badge-highlight",properties:{x:0,y:0,z:100.5,opacity:.001}}),t.music="jam",t.musicInstance.volume=.5,this.badgeTime=Date.now(),t.googleAnalytics.event(t.name,"EnterBadgeScreen","BadgesCollected",this.collectedBadges)},events:{"scene-live":function(t){var e=0;if(this.showEverything){if(t&&t.banner)for(e=this.banners.length;e--;)if(this.banners[e].game===t.banner){this.owner.triggerEvent("zoom-in",this.banners[e]);break}}else this.owner.triggerEvent("zoom-in",this.banners[0])},tick:function(){this.zooming&&this.resizeCamera()},"camera-update":function(t){this.tweenWidth=t.viewport.width,this.tweenHeight=t.viewport.height,this.cameraX=t.viewport.x,this.cameraY=t.viewport.y},"zoom-out":function(){this.zooming||("out"!==this.zoomed&&this.showEverything?(this.zooming=!0,this.owner.triggerEvent("rl-hide-info-panel"),this.targetBanner.zoomBanner.triggerEvent("show-sprite"),this.targetBanner=null,this.badgeHighlight.opacity=.001,t.get(this).to({cameraX:0,cameraY:0,tweenWidth:this.zoomOutWidth,tweenHeight:this.zoomOutHeight},1e3,e.sineInOut).call(function(){this.zoomed="out",this.zooming=!1,this.resizeCamera()}.bind(this))):this.owner.triggerEvent("new-scene"))},"zoom-in":function(i){this.zooming||"out"!==this.zoomed||(this.zooming=!0,this.targetBanner=i,this.showEverything?i.state.get("app")?t.get(this).to({cameraX:this.targetBanner.x+225,cameraY:this.targetBanner.y,tweenWidth:this.zoomInWidth,tweenHeight:this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):t.get(this).to({cameraX:this.targetBanner.x+180,cameraY:this.targetBanner.y,tweenWidth:.8*this.zoomInWidth,tweenHeight:.8*this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):(this.cameraX=this.targetBanner.x+225,this.cameraY=this.targetBanner.y,this.tweenWidth=this.zoomInWidth,this.tweenHeight=this.zoomInHeight,this.zoomInComplete(i,!0)))}},methods:{zoomInComplete:function(t,e){this.zoomed="in",this.zooming=!1,this.resizeCamera(),this.targetBanner.zoomBanner.triggerEvent("hide-sprite"),this.badges[t.game][0].triggerEvent("send-highlight-info"),this.owner.triggerEvent("rl-show-info-panel",e)},resizeCamera:function(){this.owner.triggerEvent("resize-camera",{width:this.tweenWidth,height:this.tweenHeight}),this.owner.triggerEvent("relocate",{x:this.cameraX,y:this.cameraY})},buildBanner:function(t,e,i){var n=null,s=this.bannerPositions&&this.bannerPositions[t],r=null,o=450*(i%3),a=650*Math.floor(i/3);this.showEverything?s?(o=s.x,a=s.y):(o+=-450,a+=-325):o-=225,(n=this.owner.addEntity({type:"badge-banner",properties:{x:o,y:a,z:100,game:t}})).state.set(t,!0),r=this.owner.addEntity({type:"zoom-banner",properties:{x:o,y:a,z:102}}),n.zoomBanner=r,r.banner=n,this.banners.push(n),this.zoomBanners.push(r),this.buildBadges(t,e,o,a,s)},buildBadges:function(t,e,i,n,s){var r=0,o=0,a=null,h=null,l=0,c=0,p=0,u="",d="",g=s&&s.badgeOffsetX?s.badgeOffsetX:-91,y=s&&s.badgeOffsetY?s.badgeOffsetY:-70;for(r=0;r<e.length;r++)h=e[r],s.specials&&s.specials[r]?(o-=1,c=i+s.specials[r].x,p=n+s.specials[r].y):(l=Math.floor((r+o)/3),c=i+g+91*((r+o)%3),p=n+y+91*l),u=h.name,d=h.description,a=this.owner.addEntity({type:"badge",properties:{x:c,y:p,z:101,animation:t+"-"+h.id,highlight:h.highlight||"circle",name:u||t+"-"+h.id,description:d||"Undescribed",level:h.level,collected:h.completed,game:t,directive:h.directive,progress:this.getProgress(h)}}),this.addGroupInfo(h,a,"group1"),this.addGroupInfo(h,a,"group2"),this.addGroupInfo(h,a,"group3"),this.addGroupInfo(h,a,"group4"),a.collected?(a.state.set(a.animation,!0),this.collectedBadges+=1):a.opacity=.2,h.highlight?(a.state.set(h.highlight,!0),a.collected?a.scaleX=a.scaleY=.203452:a.scaleX=a.scaleY=.203452/.6):a.scaleX=a.scaleY=.6344*.38,this.badges[t]||(this.badges[t]=[]),this.badges[t].push(a)},addGroupInfo:function(t,e,i){var n=0,s=0,r=null,o=0,a=0;if(t[i]){if(e[i]=t[i],e[i+"-directive"]=t[i+"-directive"],!t.subgoals)return e[i+"-complete"]=!1,void(e[i+"-progress"]=0);for(n=(r=t[i+"-subgoals"].split(",")).length;n--;)for(s=t.subgoals.length;s--;)if(t.subgoals[s].key===r[n]){a+=Math.min(t.subgoals[s].progress||0,+(t.subgoals[s].count||0)),o+=+(t.subgoals[s].count||0);break}a!==o?(e[i+"-complete"]=!1,e[i+"-progress"]=a/o):e[i+"-complete"]=!0}},getProgress:function(t){var e=0,i=0,n=0;if(!t.subgoals)return 0;for(e=t.subgoals.length;e--;)n+=Math.min(t.subgoals[e].progress||0,+(t.subgoals[e].count||0)),i+=+(t.subgoals[e].count||0);return n/i},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitBadgeScreen","BadgeScreenTime",Date.now()-this.badgeTime>>0)}},publicMethods:{},getAssetList:function(){for(var t=null,e=["badge-banner","badge","badge-highlight","zoom-banner"],n=e.length,s=Array.setUp();n--;)t=i.getAssetList({type:e[n]}),s.union(t),t.recycle();return s}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeHighlightLogic",properties:{},publicProperties:{},initialize:function(){this.prevAnimation=null},events:{"highlight-badge":function(t){this.owner.opacity=1,this.owner.x=t.x,this.owner.y=t.y,this.owner.triggerEvent("set-animation",t.highlight)},"set-animation":function(t){""!==this.prevAnimation&&this.owner.state.set(this.prevAnimation,!1),this.owner.state.set(t,!0),this.prevAnimation=t}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("platypus.Data"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeInfoPanelLogic",properties:{},publicProperties:{},initialize:function(){this.highlightedBadge=null,this.prevAnimation="",this.badgeInfo=null,this.rows=Array.setUp()},events:{"scene-loaded":function(){var t=platypus.game.app,e=t.name,i=null,n=t.config["badge-list"],s=null,r=null;if(this.highlightedBadge=this.owner.parent.addEntity({type:"highlighted-badge",properties:{x:this.owner.x,y:this.owner.y+-270,z:101}}),this.rows.push(this.createGoRow(0),this.createGoRow(1),this.createGoRow(2),this.createGoRow(3)),"space-scouts-home-base"===e){for(i in n)if(n.hasOwnProperty(i)){r={name:(s=n[i].badges[0]).name,description:s.description,level:s.level,animation:i+"-"+s.id,game:i};break}}else r={name:(s=n[e].badges[0]).name,description:s.description,level:s.level,animation:e+"-"+s.id,game:e};this.owner.triggerEvent("highlight-badge",r,!0),this.owner.triggerEvent("hide-sprite"),this.highlightedBadge.triggerEvent("hide-sprite"),this.rows[0].checkmark.triggerEvent("hide-sprite"),this.rows[1].checkmark.triggerEvent("hide-sprite"),this.rows[2].checkmark.triggerEvent("hide-sprite"),this.rows[3].checkmark.triggerEvent("hide-sprite")},"highlight-badge":function(t,e){var i=this.highlightedBadge;this.badgeInfo=t,i.scaleX=i.scaleY=1,t.collected?(this.owner.triggerEvent("set-badge-animation",t.animation),"circle"!==t.highlight&&(i.scaleX=i.scaleY=2/3),this.owner.state.set("earned",!0),e||(this.owner.triggerEvent(t.animation+"-earned"),platypus.game.app.voPlayer.play(t.animation))):(this.owner.triggerEvent("set-badge-animation",t.highlight||"empty"),this.owner.state.set("earned",!1),e||(this.owner.triggerEvent(t.animation),platypus.game.app.voPlayer.play([t.animation,t.game+"-to-earn-badge",t.animation+"-requirements"]))),this.owner.triggerEvent("set-title-text",t.name),this.loadRows(t)},"set-badge-animation":function(t){""!==this.prevAnimation&&this.highlightedBadge.state.set(this.prevAnimation,!1),this.highlightedBadge.state.set(t,!0),this.prevAnimation=t},"hide-info-panel":function(){this.tweenHide(this.owner),this.tweenHide(this.highlightedBadge),this.tweenHide(this.rows[0].checkmark),this.tweenHide(this.rows[1].checkmark),this.tweenHide(this.rows[2].checkmark),this.tweenHide(this.rows[3].checkmark)},"show-info-panel":function(e){var i=e?0:300;this.owner.triggerEvent("show-sprite"),this.highlightedBadge.triggerEvent("show-sprite"),this.rows[0].checkmark.triggerEvent("show-sprite"),this.rows[1].checkmark.triggerEvent("show-sprite"),this.rows[2].checkmark.triggerEvent("show-sprite"),this.rows[3].checkmark.triggerEvent("show-sprite"),this.owner.opacity=.001,this.highlightedBadge.opacity=.001,this.rows[0].checkmark.opacity=.001,this.rows[1].checkmark.opacity=.001,this.rows[2].checkmark.opacity=.001,this.rows[3].checkmark.opacity=.001,t.get(this.owner).to({opacity:1},i),t.get(this.highlightedBadge).to({opacity:1},i),t.get(this.rows[0].checkmark).to({opacity:1},i),t.get(this.rows[1].checkmark).to({opacity:1},i),t.get(this.rows[2].checkmark).to({opacity:1},i),t.get(this.rows[3].checkmark).to({opacity:1},i)},"get-badge":function(t){var e=null,i=this.badgeInfo.game,n=platypus.game.app.config.games;t.directive?(i=(e=t.directive.split(":"))&&e[0]||this.badgeInfo.game,platypus.debug.olive("This one has a directive! "+t.directive)):platypus.debug.olive("Wants to achieve badge. Opening Level Select for all cases at this point."),"space-scouts-home-base"===platypus.game.app.name?"app"===i?this.owner.triggerEvent("look-at-all-badges"):"true"===sessionStorage.getItem("space-scouts-home-base-loaded-by-app")?platypus.game.app.container.send("load-game",{game:i,getBadge:e}):n[i]?(this.loadSavedGame&&sessionStorage.setItem("get-badge",JSON.stringify(e)),window.top.location=n[i]):platypus.debug.warn('"'+i+'" does not seem to be a valid game id.'):platypus.game.loadScene("level-select")}},methods:{createGoRow:function(t){var i=this.owner,n=e.setUp("checkmark",i.parent.addEntity({type:"go-to-badge-button",properties:{x:i.x+-300,y:i.y+100+100*t,z:101}}),"directive","","visible",!1);return n.checkmark.on("released",i.triggerEvent.bind(i,"get-badge",n)),n},loadRows:function(t){for(var e=["group1","group2","group3","group4"],i=e.length,n=0,s=null,r=null,o=null;i--;){for(o=(r=(s=this.rows[i]).checkmark).state,n=1;n<=16;n++)o.set("filled-"+n,!1);t[e[i]]?(r.x=this.owner.x+-300,r.triggerEvent("set-text",t[e[i]]),s.visible=!0,s.directive=t[e[i]+"-directive"],t[e[i]+"-complete"]?r.triggerEvent("disable"):(o.set("filled-"+(Math.ceil(16*t[e[i]+"-progress"])||1),!0),r.triggerEvent("enable"))):(r.x=-6e3,s.visible=!1)}t.group1?(r.components[3].sprite.y=0,r.components[3].sprite.anchor.y=.5):((r=(s=this.rows[0]).checkmark).x=this.owner.x+-300,r.triggerEvent("set-text",t.description),s.visible=!0,s.directive=t.directive,t.collected?r.triggerEvent("disable"):(o.set("filled-"+(Math.ceil(16*t.progress)||1),!0),r.triggerEvent("enable")),r.components[3].sprite.y=-24,r.components[3].sprite.anchor.y=0)},tweenHide:function(e){t.get(e).to({opacity:0},300).call(function(){e.triggerEvent("hide-sprite")})}},publicMethods:{},getAssetList:function(){for(var t=null,e=["highlighted-badge","go-to-badge-button"],n=e.length,s=Array.setUp();n--;)t=i.getAssetList({type:e[n]}),s.union(t),t.recycle();return s}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeLogic",properties:{},publicProperties:{animation:"",highlight:"circle",name:"default name",description:"default description",level:"",collected:!1,game:""},initialize:function(){},events:{"send-highlight-info":function(){this.owner.triggerEvent("rl-highlight-badge",this.owner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Ease"),i=include("PIXI.Graphics"),n=include("createjs.Tween"),s=function(t,e,n){var s=new i;return t.mask=s,s.isMask=!0,s.z=1,e.addChild(s),s.clear(),s.beginFill(0,1),s.r(n.left,n.top,n.width,n.height),s.endFill(),s};platypus.createComponentClass({id:"BadgeNotifier",properties:{},publicProperties:{showLength:5e3},initialize:function(){this.hideSoon=0,this.hiding=!0,this.lastState=null,this.list=Array.setUp()},events:{load:function(){this.progressMask=s(this.owner.components[3].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.activeMask=s(this.owner.components[5].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.progressMask.y=170,this.activeMask.y=170},adopted:function(){this.handler=function(t){for(var e=this.list,i=e.length;i--;)if(t.badge===e[i].badge)return;e.push(t)}.bind(this),this.owner.parent.on("badge-incremented",this.handler)},"handle-logic":function(t){var e=null,i=null,n=0,s=this.owner.state;if(this.hiding){if(this.list.length){if(i=(e=this.list.pop()).badge,this.lastState&&s.set(this.lastState,!1),this.lastState=i["game-id"]+"-"+i.id,s.set(this.lastState,!0),n="app-1"===this.lastState||"app-2"===this.lastState||"app-3"===this.lastState||"app-4"===this.lastState,this.createProgress(i,e,!n),n)return;this.owner.triggerEvent("show-progress"),this.owner.triggerEvent("set-text",i.name),this.hiding=!1,this.hideSoon=this.showLength}}else this.hideSoon>0&&(this.hideSoon-=t.delta,this.hideSoon<=0&&this.owner.triggerEvent("hide-progress"))},hiding:function(){this.hiding=!0}},methods:{createProgress:function(t,i,s){for(var r=platypus.game.app,o=t.subgoals,a=o.length,h=0,l=0,c=0;a--;)h+=+o[a].count,l+=o[a].progress||0;r.analyticsEmitter.progressBadge(r.levelBot||"",r.levelNumber||0,t.name,l/h),r.googleAnalytics.event(r.name,"BadgeProgress",t.name,l-i.originalProgress),s&&(c=(l-i.progress+i.originalProgress)/h*400,this.activeMask.x=c,this.progressMask.x=c,n.get(this.activeMask).wait(500).to({x:l/h*400},1200,e.sineInOut))},destroy:function(){this.owner.parent.off("badge-incremented",this.handler),this.list.recycle(),this.list=null}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"Beamable",properties:{},publicProperties:{},initialize:function(){this.connectedTo=null,this.beamJoint=null,this.createBeamJoint=null,this.bc=-1,this.beamFX=[],this.needDisconnect=!1,this.beaming=!1},events:{"handle-logic":function(){},"beam-on":function(t){this.owner.y-t.y<700&&Math.abs(this.owner.x-t.x)<200&&t.beamConnect(this)===this&&(this.beaming=!0,this.connectedTo=t,this.createBeamJoint=t)},"beam-off":function(t){this.connectedTo&&(this.needDisconnect=!0,this.beaming=!1)},"collide-with-goal":function(){this.remove=!0},"prepare-logic":function(){if(this.remove?(this.connectedTo&&(this.disconnect(),this.beaming=!1,this.owner.parent.triggerEvent("stop-audio","beamLoop"),this.owner.parent.parent.layers[2].triggerEvent("kill-beam",!0)),this.owner.parent&&(this.owner.parent.removeEntity(this.owner),this.remove=!1)):this.connectedTo&&this.needDisconnect&&(this.disconnect(),this.needDisconnect=!1),this.createBeamJoint&&(this.beamJoint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:(this.owner.y-this.createBeamJoint.y)/30},length:10,collideConnected:!0,dampingRatio:.1,frequencyHz:10},this.createBeamJoint,1),this.createBeamJoint=null),this.connectedTo){if(this.bc++,this.bc%50==0&&this.beamFX.length<5){var t=this.owner.parent.addEntity({id:"beamFX",components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"beam"}}],properties:{x:this.owner.x,y:this.owner.y-50,z:this.owner.z-1,scaleX:.66,scaleY:.66,opacity:.5}});this.beamFX.push(t)}for(var e in this.beamFX){var i=this.beamFX[e];i.opacity-=.0025,i.x=this.owner.x,i.y=this.owner.y-50-500*(.5-i.opacity),i.opacity<.005&&(i.opacity=.5,i.y=this.owner.y-50)}}}},methods:{destroy:function(){this.connectedTo=null,this.beamJoint=null,this.createBeamJoint=null,this.beamFX=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{disconnect:function(){var t=platypus.game.app;for(var e in this.owner.removeJoint(this.beamJoint),this.beamJoint=null,this.connectedTo.beamConnect(null),this.connectedTo=null,this.bc=-1,this.beamFX){var i=this.beamFX[e];this.owner.parent.removeEntity(i)}this.beamFX=[],t.analyticsEmitter.droppedItem(t.levelBot||"",t.levelNumber||0,t.getRobotLocationForLAP(),this.owner.type)}},getAssetList:function(){return Array.setUp("assets/images/fx.png")}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Bird",properties:{carrying:null,ship:!1,dir:1},publicProperties:{},initialize:function(){this.joint=null,this.flyForce=new t(0,0),this.originX=0,this.originY=0,this.hoverC=0,this.carryingObj=null,this.free=!1,this.shakeC=0,this.shakeX=0,this.shakeY=0},events:{whistle:function(t){var e,i,n=platypus.game.app;(e=this.owner.x-t.x,i=this.owner.y-t.y,e*e+i*i)<5e5&&!this.free&&(this.owner.removeJoint(this.joint),this.free=!0,this.carryingObj.released(),n.analyticsEmitter.birdDropsItem(n.levelBot||"",n.levelNumber||0,{x:this.carryingObj.x>>0,y:this.carryingObj.y>>0},this.carryingObj.type))},"handle-logic":function(){this.hoverC+=this.randRange(.1,.5);var t=Math.sin(this.hoverC),e=this.originY-this.owner.y;e<0&&(t=Math.abs(t)*e),this.flyForce.set_y(t),this.flyForce.set_x(this.randRange(7,13)*this.dir),this.owner.body.ApplyForce(this.flyForce,this.owner.body.GetWorldCenter());var i=!1;this.free||this.ship||Math.abs(this.owner.x-this.originX)>300&(this.originX-this.owner.x)*this.dir<0&&(i=!0);if((Math.random()<.001||i)&&!this.ship&&(this.dir*=-1),this.owner.scaleX=.75*this.dir,this.shakeC)return this.owner.x=this.shakeX+this.randRange(-1,1)*(this.shakeC/10),this.owner.y=this.shakeY+this.randRange(-1,1)*(this.shakeC/10),this.shakeC--,void(0===this.shakeC&&(this.owner.x=this.shakeX,this.owner.y=this.shakeY))},adopted:function(){this.originX=this.owner.x,this.originY=this.owner.y,null!==this.carrying&&(this.carryingObj=this.owner.parent.addEntity({type:this.carrying,properties:{x:this.owner.x,y:this.owner.y+100,z:this.owner.z+1,carried:!0}}),this.joint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:0},length:50,dampingRatio:1,frequencyHz:5},this.carryingObj,1))}},methods:{destroy:function(){this.flyForce=null,this.carryingObj=null,this.joint=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"BoopArm",properties:{main:null},initialize:function(){},events:{adopted:function(){this.owner.state.set("arm",!0),this.owner.body.SetGravityScale(0),this.main.connectArm(this.owner)},"handle-logic":function(){}},methods:{destroy:function(){this.main=null}}})}(),function(){"use strict";platypus.createComponentClass({id:"BoopHand",properties:{main:null},publicProperties:{magnet:!0,facing:"X"},initialize:function(){this.state="claw",this.connectedTrash=[],this.suckFX=[],this.suckC=-1,this.mag=!1},events:{adopted:function(){this.owner.state.set("claw",!0),this.owner.body.SetGravityScale(0),this.main.connectHand(this.owner)},"get-soil":function(){this.owner.parent.parent.layers[2].triggerEvent("kill-magnet"),this.owner.state.set("magnet",!1),this.owner.state.set("claw",!0),this.owner.state.set("camera",!1)},camera:function(){this.owner.parent.parent.layers[2].triggerEvent("kill-magnet"),this.owner.state.get("camera")?(this.takePicture(),this.owner.parent.triggerEvent("camClick"),this.owner.parent.parent.layers[3].triggerEvent("take-pic")):(this.owner.state.set("magnet",!1),this.owner.state.set("claw",!1),this.owner.state.set("camera",!0),this.owner.parent.triggerEvent("click"))},"magnet-toggle":function(){this.owner.state.set("magnet",!0),this.owner.state.set("claw",!1),this.owner.state.set("camera",!1),this.owner.parent.triggerEvent("click")},"magnet-on":function(t){this.mag||this.owner.parent.triggerEvent("magnet"),this.mag=!0},"magnet-off":function(){var t=platypus.game.app,e=this.connectedTrash,i=e.length,n=0;for(n=0;n<i;n++)e[n].disconnect(!0),t.analyticsEmitter.droppedItem(t.levelBot||"",t.levelNumber||0,t.getRobotLocationForLAP(),e[n].owner.type);for(var s in e.length=0,this.mag=!1,this.suckFX){var r=this.suckFX[s];this.owner.parent.removeEntity(r)}this.suckFX=[],this.owner.parent.triggerEvent("stop-audio","magnet")},"handle-logic":function(){if(this.mag){var t,e,i,n;if(this.suckC++,this.suckC%5==0&&this.suckFX.length<18){e=(t=20*this.suckFX.length)+180,i=t*(Math.PI/180),n=e*(Math.PI/180);var s=this.owner.parent.addEntity({id:"suckFX",components:[{type:"RenderSprite",spriteSheet:"fx",rotate:!0,animationMap:{default:"suck"}}],properties:{x:this.owner.x+150*Math.cos(i),y:this.owner.y+150*Math.sin(i),z:this.owner.z-1,scaleX:this.randRange(.5,.75),scaleY:.66,opacity:.15,speedX:Math.cos(n),speedY:Math.sin(n),rotation:t,ang:t}});this.suckFX.push(s)}for(var r in this.suckFX){var o=this.suckFX[r];o.x+=o.speedX,o.y+=o.speedY,o.speedX*=1.02,o.speedY*=1.02,o.scaleX-=.01,o.opacity+=.01,o.opacity>.6&&(e=(t=o.ang)+180,i=t*(Math.PI/180),n=e*(Math.PI/180),o.x=this.owner.x+100*Math.cos(i),o.y=this.owner.y+100*Math.sin(i),o.scaleX=this.randRange(.5,.75),o.opacity=.15,o.speedX=Math.cos(n),o.speedY=Math.sin(n),o.rotation=t)}}}},methods:{destroy:function(){this.main=null,this.connectedTrash=null}},publicMethods:{takePicture:function(){var t=this.owner.orientation,e=10*Math.cos(t),i=10*Math.sin(t);this.owner.parent.addEntity({type:"camPath",properties:{x:this.owner.x+e,y:this.owner.y+i,vx:100*e,vy:100*i}})},addTrash:function(t){this.connectedTrash.push(t)},removeTrash:function(t){var e=this.connectedTrash.indexOf(t);e>-1&&this.connectedTrash.splice(e,1)},randRange:function(t,e){return Math.random()*(e-t)+t}},getAssetList:function(){return Array.setUp("assets/images/fx.png")}})}(),function(){"use strict";platypus.createComponentClass({id:"BoopHead",properties:{main:null},initialize:function(){},events:{adopted:function(){this.owner.state.set("head",!0),this.owner.body.SetGravityScale(0),this.main.connectHead(this.owner)},"handle-logic":function(){this.owner.orientation>0&&this.owner.body.ApplyTorque(-50),this.owner.orientation<-1&&this.owner.body.ApplyTorque(50)}},methods:{destroy:function(){this.main=null}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("platypus.AABB"),i={};platypus.createComponentClass({id:"BoopMain",properties:{npc:!1},publicProperties:{grounded:!1},initialize:function(){this.originX=0,this.originY=0,this.groundContacts=0,this.soilContacts=0,this.activateJump=new t(0,-50),this.leftWheel=null,this.centerWheel=null,this.rightWheel=null,this.middleWheel=null,this.arm=null,this.head=null,this.magnet=null,this.canCollectSoil=!1,this.camera=e.setUp(),this.psc=0,this.psp=0,this.partsHitGround=0,this.canyoned=!1,this.playerReady=!1,this.npc||(platypus.game.app.getRobotLocationForLAP=function(){return{x:this.owner.x>>0,y:this.owner.y>>0}}.bind(this))},events:{adopted:function(){this.npc||(this.camLock=this.owner.parent.addEntity({type:"camLock",properties:{target:this.owner,x:this.owner.x,y:this.owner.y,levelId:this.owner.parent.levelId}})),this.owner.state.set("body",!0),this.originX=this.owner.x,this.originY=this.owner.y,this.buildBoop("level-13"==this.owner.parent.levelId||"level-14"==this.owner.parent.levelId)},"collide-with-hole":function(){this.canyoned||(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","canyon"),this.canyoned=!0)},"camera-update":function(t){this.camera.set(t.viewport)},"activate-controls":function(){this.owner.body.ApplyLinearImpulse(this.activateJump,this.owner.body.GetWorldCenter())},"collide-with-ground":function(){var t="boopWrong";this.groundContacts++,this.grounded=this.groundContacts>0,this.grounded&&this.owner.body.SetAngularDamping(0),"level-17"==this.owner.parent.levelId&&Math.abs(this.owner.orientation)>2.2&&(i[t]||(this.owner.parent.triggerEvent("show-mindy-panel",t),i[t]=!0))},"end-collide-with-ground":function(){this.groundContacts--,this.grounded=this.groundContacts>0,this.grounded||this.owner.body.SetAngularDamping(25)},"collide-with-soil":function(t){this.soilContacts++;var e=t.entity;this.canCollectSoil=!e.collected},"end-collide-with-soil":function(){this.soilContacts--,this.canCollectSoil=this.soilContacts>0},"get-soil":function(){this.canCollectSoil&&(this.canCollectSoil=!1)},"part-hit-ground":function(){"level-12"==this.owner.parent.levelId&&(this.partsHitGround++,7==this.partsHitGround&&this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","level12NoBadge"))},"level-12-end":function(){this.partsHitGround<7&&platypus.badger.increment("part-protector")},"player-ready":function(){this.psc=1900,this.playerReady=!0},"prepare-logic":function(){if("level-12"==this.owner.parent.levelId&&this.playerReady){if(this.psc++,6==this.psp&&1e3==this.psc&&this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","level12More"),this.psp>6&&4e3==this.psc){var t=this.owner.container.parent.transform.worldTransform;this.owner.parent.addEntity({type:"star",properties:{x:1400,y:this.camera.top/t.d-200,z:this.owner.z-1,falling:!0}})}if(this.psc>2e3&&this.psc%450==0&&this.psp<12){var e=this.owner.container.parent.transform.worldTransform;this.owner.parent.addEntity({type:"satPart"+Math.round(this.randRange(1,8)),properties:{x:this.randRange(600,1900),y:this.camera.top/e.d-200,z:this.owner.z-1,slow:!0}}),this.psp++,6==this.psp&&(this.psc=-2e3,this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","level12Break"))}}if(Math.abs(this.owner.orientation)>2){var n="boopFlip";i[n]&&(this.owner.parent.triggerEvent("show-mindy-panel",n),this.owner.parent.triggerEvent("boopFlipFX"),i[n]=!0)}},rescue:function(){this.owner.y=this.owner.y-50,this.owner.orientation=0,this.owner.parent.triggerEvent("rescueFX")},"handle-logic":function(){null!==this.magnet&&(this.magnet.orientation=this.arm.orientation)},"boop-cw":function(){this.owner.body.ApplyTorque(-15)},"boop-ccw":function(){this.owner.body.ApplyTorque(15)}},methods:{randRange:function(t,e){return Math.random()*(e-t)+t},destroy:function(){this.activateJump=null,this.leftWheel=null,this.centerWheel=null,this.rightWheel=null,this.middleWheel=null,this.arm=null,this.head=null,this.magnet=null,this.camera.recycle()},buildBoop:function(t){this.leftWheel=this.owner.parent.addEntity({type:t?"boopSuperWheel":"boopWheel",properties:{main:this.owner,name:"left",z:this.owner.z+1,npc:this.npc}}),this.centerWheel=this.owner.parent.addEntity({type:t?"boopSuperWheelMiddle":"boopWheelMiddle",properties:{main:this.owner,name:"center",z:this.owner.z+1,npc:this.npc}}),this.rightWheel=this.owner.parent.addEntity({type:t?"boopSuperWheel":"boopWheel",properties:{main:this.owner,name:"right",z:this.owner.z+1,npc:this.npc}}),this.leftWheel.x=this.owner.x-60,this.leftWheel.y=this.owner.y,this.centerWheel.x=this.owner.x-20,this.centerWheel.y=this.owner.y,this.rightWheel.x=this.owner.x+50,this.rightWheel.y=this.owner.y,this.arm=this.owner.parent.addEntity({type:"boopArm",properties:{main:this.owner,z:this.owner.z+1}}),this.arm.x=this.owner.x-125,this.arm.y=this.owner.y-100,this.magnet=this.owner.parent.addEntity({type:"boopHand",properties:{main:this.owner,z:this.owner.z+2}}),this.magnet.x=this.owner.x+40,this.magnet.y=this.owner.y-100,this.head=this.owner.parent.addEntity({type:"boopHead",properties:{main:this.owner,z:this.owner.z+1}}),this.head.x=this.owner.x+90,this.head.y=this.owner.y-90}},publicMethods:{connectWheel:function(t,e){var i=0;switch(e){case"left":i=-3.2;break;case"center":i=-.6;break;case"right":i=3}this.owner.createJoint("revolute",{localAnchorA:{x:i,y:1.5},localAnchorB:{x:0,y:0}},t,1)},connectArm:function(t){this.owner.createJoint("revolute",{localAnchorA:{x:-1.6,y:-4},localAnchorB:{x:-1.5,y:0}},t,1)},connectHead:function(t){this.owner.createJoint("revolute",{localAnchorA:{x:2.5,y:-3.45},localAnchorB:{x:-1.5,y:0}},t,1)},connectHand:function(t){this.arm.createJoint("revolute",{localAnchorA:{x:2,y:0},localAnchorB:{x:0,y:0}},t,1)}},getAssetList:function(){return Array.setUp("assets/images/fx.png")}})}(),function(){"use strict";platypus.createComponentClass({id:"BoopWheel",properties:{main:null,name:"",npc:!1,super:!1},publicProperties:{grounded:!1},initialize:function(){this.groundContacts=0,this.wheelTouch=0},events:{adopted:function(){this.owner.state.set(this.super?"superWheel":"wheel",!0),this.main.connectWheel(this.owner,this.name)},"collide-with-ground":function(){this.groundContacts++,this.grounded=this.groundContacts>0,this.npc&&this.owner.x>3500&&this.owner.x<5950&&(this.wheelTouch++,1==this.wheelTouch&&(this.owner.triggerEvent("boop-touch-other-side"),this.owner.parent.parent.layers[2].triggerEvent("kill-beam")))},"end-collide-with-ground":function(){this.groundContacts--,this.grounded=this.groundContacts>0},"handle-logic":function(){"left"==this.name&&this.owner.parent.triggerEvent("angle-update",this.owner.orientation)},"angle-update":function(t){"center"==this.name&&(this.owner.orientation=t)}},methods:{destroy:function(){this.main=null}},publicMethods:{}})}(),function(){"use strict";var t={static:0,kinematic:1,dynamic:2},e=include("Box2D.b2Vec2"),i=include("Box2D.b2BodyDef"),n=include("Box2D.b2Filter"),s=include("Box2D.b2FixtureDef"),r=include("Box2D.b2PolygonShape"),o=include("Box2D.b2CircleShape"),a=include("platypus.Data"),h=include("platypus.Async"),l=include("Box2D.helpers.clearUserData"),c=include("Box2D.destroy"),p=include("Box2D.getPointer"),u=include("Box2D.helpers.setUserData"),d=include("decomp.quickDecomp"),g=new s,y={distance:Box2D.b2DistanceJoint,revolute:Box2D.b2RevoluteJoint,prismatic:Box2D.b2PrismaticJoint,pulley:Box2D.b2PulleyJoint,gear:Box2D.b2GearJoint,mouse:Box2D.b2MouseJoint,wheel:Box2D.b2WheelJoint,weld:Box2D.b2WeldJoint,rope:Box2D.b2RopeJoint,friction:Box2D.b2FrictionJoint,motor:Box2D.b2MotorJoint},m={distance:new Box2D.b2DistanceJointDef,revolute:new Box2D.b2RevoluteJointDef,prismatic:new Box2D.b2PrismaticJointDef,pulley:new Box2D.b2PulleyJointDef,gear:new Box2D.b2GearJointDef,mouse:new Box2D.b2MouseJointDef,wheel:new Box2D.b2WheelJointDef,weld:new Box2D.b2WeldJointDef,rope:new Box2D.b2RopeJointDef,friction:new Box2D.b2FrictionJointDef,motor:new Box2D.b2MotorJointDef},v=function(t){return Math.round(16384*t)/16384},f=function(t){for(var i=Array.setUp(),n=t.length,s=null;n--;)(s=new e).Set(t[n][0],t[n][1]),i[n]=s;return i},w=function(t,e,i,n,s){for(var r=function(t,e){for(var i=Array.setUp(),n=t.length;n--;)i[n]=Array.setUp(t[n].x/e,t[n].y/e);return i}(e,n),o=null,a=r.length<=4?[r]:d(r),h=null,l=null,p=a.length,g=0;p--;){if(a[p].length>8){for(o=[],g=a[p].length-6;g<a[p].length;g++)o.push(a[p][g]);a[p].length-=5,a[p].push(o[5]),p+=1,a.splice(p,0,o)}for(l=f(a[p]),t.set_shape(x(l)),h=i.CreateFixture(t),u(h,s),g=l.length;g--;)c(l[g]);l.recycle()}r.recycle(2)},b=function(t){return"string"==typeof t?function(e){this.owner.triggerEvent(t,e)}:t.length?function(e){this.owner.trigger(t,e)}:null},x=function(t){var e,i=new r,n=Box2D._malloc(8*t.length),s=0,o=0;for(o=0;o<t.length;o++)Box2D.HEAPF32[n+s>>2]=t[o].get_x(),Box2D.HEAPF32[n+(s+4)>>2]=t[o].get_y(),s+=8;return e=Box2D.wrapPointer(n,Box2D.b2Vec2),i.Set(e,t.length),i},E=function(t,e){var i=this.owner.parent.addEntity(t,e);this.connectedEntities.push(i)};platypus.createComponentClass({id:"BoxCollision",properties:{bodyDefinition:null,connectingEntities:null,joints:null,resolution:null},publicProperties:{shape:null},initialize:function(e,n){var s=null,r=null,o=this.resolution,a="",l="",c="",p=new i,d=this.bodyDefinition,g=null,y=d.fixtureDefinitions,m=0,v=null,f=null,w=null,x=0,A=[];if(this.owner.body=null,this.world=this.owner.parent.world,this.drawScale=this.owner.parent.drawScale,this.owner.orientation=this.owner.orientation||0,this.connectedEntities=[],o)for(a in o)if(o.hasOwnProperty(a))for(l in"default"===(r=a)&&(r=this.owner.type),o[a])if(o[a].hasOwnProperty(l))if("beginContact"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("begin-contact-"+r+"-and-"+c,b(s[c]));else if("endContact"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("end-contact-"+r+"-and-"+c,b(s[c]));else if("preSolve"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("pre-solve-"+r+"-and-"+c,b(s[c]));else if("postSolve"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("post-solve-"+r+"-and-"+c,b(s[c]));if(d){if(void 0!==d.type&&p.set_type(t[d.type]),void 0!==d.active&&p.set_active(d.active),void 0!==d.allowSleep&&p.set_allowSleep(d.allowSleep),void 0!==d.angle?p.set_angle(d.angle):this.owner.orientation&&p.set_angle(this.owner.orientation),void 0!==d.angularDamping&&p.set_angularDamping(d.angularDamping),void 0!==d.angularVelocity&&p.set_angularVelocity(d.angularVelocity),void 0!==d.awake&&p.set_awake(d.awake),void 0!==d.bullet&&p.set_bullet(d.bullet),void 0!==d.fixedRotation&&p.set_fixedRotation(d.fixedRotation),void 0!==d.inertiaScale&&p.set_inertiaScale(d.inertiaScale),void 0!==d.linearDamping&&p.set_linearDamping(d.linearDamping),void 0!==d.gravityScale&&p.set_gravityScale(d.gravityScale),g=p.get_position(),d.position?(g.set_x((this.owner.x||d.position.x||0)/this.drawScale),g.set_y((this.owner.y||d.position.y||0)/this.drawScale)):(g.set_x((this.owner.x||0)/this.drawScale),g.set_y((this.owner.y||0)/this.drawScale)),this.owner.body=this.world.CreateBody(p),this.matchEntityToBody(),u(this.owner.body,{entity:this.owner}),!this.owner.body)return platypus.debug.warn('Unable to create Box2D Body for "'+this.owner.type+'".'),!1;for(m=0;m<y.length;m++)this.createFixture(y[m],d.defaultFixtureData||{})}else platypus.debug.warn(this.owner.type+": This entity has no defined body.");if(this.connectingEntities)for(x=0;x<this.connectingEntities.length;x++){for(w in f={},(v=this.connectingEntities[x]).properties)v.properties.hasOwnProperty(w)&&(f[w]=v.properties[w]);f.x=this.owner.x,f.y=this.owner.y,f.z=this.owner.z,v.offset&&(f.x+=v.offset.x||0,f.y+=v.offset.y||0,f.z+=v.offset.z||0),f.joinId=v.joinId||"entity-"+x,A.push(E.bind(this,{type:v.type,properties:f}))}return h.setUp(A,function(t){var e=null,i=null;if(this.joints)for(i=0;i<this.joints.length;i++)e=this.joints[i],this.createJoint(e.type,e);this.owner.triggerEvent("box2d-body-initialized",this.owner.body),t()}.bind(this,n)),!0},events:{"before-box2d-update":function(){this.matchBodyToEntity()},"after-box2d-update":function(){this.matchEntityToBody()},"add-collision-listener":function(t){var e=t,i=e.thisType||this.owner.type;"beginContact"===e.when&&this.addEventListener("begin-contact-"+i+"-and-"+e.otherType,b(e.message)),"endContact"===e.when&&this.addEventListener("end-contact-"+i+"-and-"+e.otherType,b(e.message)),"preSolve"===e.when&&this.addEventListener("pre-solve-"+i+"-and-"+e.otherType,b(e.message)),"postSolve"===e.when&&this.addEventListener("post-solve-"+i+"-and-"+e.otherType,b(e.message))}},methods:{destroy:function(){var t=0,e=this.owner,i=this.owner.body,n=i.GetFixtureList();for(this.owner.destroyThePins&&this.owner.destroyThePins(),e.parent.triggerEvent("body-removed",i),l(i);0!==p(n);)l(n),n=n.GetNext();for(e.body=null,this.world=null,t=0;t<this.connectedEntities.length;t++)this.owner.parent.removeEntity(this.connectedEntities[t]);this.connectedEntities.length=0}},publicMethods:{createFixture:function(t,i){var s=g,h=null,l="",c=this.owner,p=null,d=null,y=new n,m=t.shape||this.shape||c;if(m=a.setUp("radius",m.radius,"points",m.points,"halfHeight",m.halfHeight||(m.height||0)/2,"halfWidth",m.halfWidth||(m.width||0)/2,"x",(m===c?0:m.x)||0,"y",(m===c?0:m.y)||0),void 0!==t.density?s.set_density(t.density):void 0!==i.density?s.set_density(i.density):s.set_density(1),void 0!==t.friction?s.set_friction(t.friction):void 0!==i.friction?s.set_friction(i.friction):s.set_friction(.5),void 0!==t.restitution?s.set_restitution(t.restitution):void 0!==i.restitution?s.set_restitution(i.restitution):s.set_restitution(.2),t.filter&&void 0!==t.filter.categoryBits?y.set_categoryBits(t.filter.categoryBits):i.filter&&void 0!==i.filter.categoryBits?y.set_categoryBits(i.filter.categoryBits):y.set_categoryBits(1),t.filter&&void 0!==t.filter.groupIndex?y.set_groupIndex(t.filter.groupIndex):i.filter&&void 0!==i.filter.groupIndex?y.set_groupIndex(i.filter.groupIndex):y.set_groupIndex(0),t.filter&&void 0!==t.filter.maskBits?y.set_maskBits(t.filter.maskBits):i.filter&&void 0!==i.filter.maskBits?y.set_maskBits(i.filter.maskBits):y.set_maskBits(65535),s.set_filter(y),void 0!==t.isSensor?s.set_isSensor(t.isSensor):void 0!==i.isSensor?s.set_isSensor(i.isSensor):s.set_isSensor(!1),d={collisionType:this.owner.type},void 0!==t.userData)for(l in t.userData)t.userData.hasOwnProperty(l)&&(d[l]=t.userData[l]);else if(void 0!==i.userData)for(l in i.userData)i.userData.hasOwnProperty(l)&&(d[l]=i.userData[l]);m.radius?((p=new o).set_m_radius(m.radius/this.drawScale),(m.x||m.y)&&p.get_m_p().Set((m.x||0)/this.drawScale,(m.y||0)/this.drawScale),s.set_shape(p),h=c.body.CreateFixture(s),u(h,d)):m.points?w(s,m.points,c.body,this.drawScale,d):m.halfWidth&&m.halfHeight?((p=new r).SetAsBox(m.halfWidth/this.drawScale,m.halfHeight/this.drawScale,new e((m.x||0)/this.drawScale,(m.y||0)/this.drawScale),0),s.set_shape(p),h=c.body.CreateFixture(s),u(h,d)):platypus.debug.warn(c.type+": Unhandled shape definition.",m),m.recycle()},findConnectedByJoinId:function(t){var e=null,i=0;for(i=0;i<this.connectedEntities.length;i++)if(this.connectedEntities[i].joinId===t){e=this.connectedEntities[i];break}return e},createJoint:function(t,i,n,s){var r=m[t],o=new e(0,0),a=new e(0,0),h=null,l=null,c=null,p="",d=null,g=null;switch(void 0===s&&(s=this.drawScale),n?(h=this.owner,l=n):"string"==typeof i.join?(h=this.owner,l=this.findConnectedByJoinId(i.join)):i.join?(h=i.join.A?this.findConnectedByJoinId(i.join.A):this.owner,l=i.join.B?this.findConnectedByJoinId(i.join.B):this.owner):(h=this.owner,l=this.findConnectedByJoinId("entity-0")),i.anchor?(o.set_x(i.anchor.x),o.set_y(i.anchor.y),r.Initialize(h.body,l.body,o)):(r.set_bodyA(h.body),r.set_bodyB(l.body),i.localAnchorA&&o.Set(i.localAnchorA.x/s,i.localAnchorA.y/s),r.set_localAnchorA(o),i.localAnchorB&&a.Set(i.localAnchorB.x/s,i.localAnchorB.y/s),r.set_localAnchorB(a)),r.set_collideConnected(!!i.collideConnected),t){case"distance":r.set_length(i.length/this.drawScale||1),r.set_dampingRatio(i.dampingRatio||0),r.set_frequencyHz(i.frequencyHz||0);break;case"revolute":r.set_referenceAngle(i.referenceAngle||0),r.set_enableLimit(!!i.enableLimit),r.set_lowerAngle(i.lowerAngle||0),r.set_upperAngle(i.upperAngle||0),r.set_enableMotor(!!i.enableMotor),r.set_maxMotorTorque(i.maxMotorTorque||0),r.set_motorSpeed(i.motorSpeed||0);break;case"prismatic":g=new e(1,0),i.localAxisA&&g.Set(i.localAxisA.x,i.localAxisA.y),r.set_localAxisA(g),r.set_referenceAngle(i.referenceAngle||0),r.set_enableLimit(!!i.enableLimit),r.set_lowerTranslation(i.lowerTranslation/this.drawScale||0),r.set_upperTranslation(i.upperTranslation/this.drawScale||0),r.set_enableMotor(!!i.enableMotor),r.set_maxMotorForce(i.maxMotorForce||0),r.set_motorSpeed(i.motorSpeed||0);break;case"weld":r.set_referenceAngle(i.referenceAngle||0);break;case"pulley":case"gear":case"mouse":case"wheel":case"rope":case"friction":case"motor":default:platypus.debug.warn(t+" joints are not implemented at this point")}if(d={},i.userData)for(p in i.userData)i.userData.hasOwnProperty(p)&&(d[p]=i.userData[p]);return c=this.world.CreateJoint(r),c=Box2D.castObject(c,y[t]),u(c,d),h.triggerEvent("joint-attached",c),l.triggerEvent("joint-attached",c),c},removeJoint:function(t){l(t),this.world.DestroyJoint(t)},matchEntityToBody:function(t,e){var i=this.owner.body,n=t||i.GetPosition(),s=e||i.GetAngle(),r=n.get_x(),o=n.get_y();r===this.lastBodyX&&o===this.lastBodyY&&s===this.lastBodyAngle||(this.lastBodyX=r,this.lastBodyY=o,this.lastBodyAngle=s,this.lastX=this.owner.x=v(r*this.drawScale),this.lastY=this.owner.y=v(o*this.drawScale),this.lastOrientation=this.owner.orientation=v(s),this.owner.rotation=180*s/Math.PI)},matchBodyToEntity:function(){var t=this.owner,i=null,n=0,s=0;return(t.x!==this.lastX||t.y!==this.lastY||t.orientation!==this.lastOrientation)&&(this.lastX=t.x,this.lastY=t.y,this.lastOrientation=t.orientation,this.lastBodyX=n=v(t.x/this.drawScale),this.lastBodyY=s=v(t.y/this.drawScale),this.lastBodyAngle=v(t.orientation),i=new e(n,s),t.body.SetAwake(!0),t.body.SetTransform(i,this.lastBodyAngle),c(i),!0)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.DragGroup"),n=include("platypus.Vector"),s=function(t){var e=null,i=this.camera,n=this.owner.container.parent.transform.worldTransform;i.empty||(this.tempEvents.length||this.increaseTempEvents(),(e=this.tempEvents.pop()).x=t.data.global.x/n.a+i.left,e.y=t.data.global.y/n.d+i.top,e.event=t.data.originalEvent,e.pixiEvent=t,e.entity=this.owner,this.mouseArray.push(function(t){var e=platypus.game.app;1!==this.dragTypeResolved&&(2===this.dragTypeResolved&&(this.dragTypeResolved=1),this.groupMovement&&this.continueInputMovement(t),this.triggeredLAPStartDragStall||0===t.event.movementX&&0===t.event.movementY?this.triggeredLAPStartDragStall&&!this.triggeredLAPStartDrag&&(this.triggeredLAPStartDrag=!0,e.analyticsEmitter.startDrag(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"click-n-stick",this.owner.type,this.neverMovedPreviously?"toolbox":"kitchen")):this.triggeredLAPStartDragStall=!0,this.recycleTempEvent(t))}.bind(this,e)))},r=function(t){var e=null;this.owner.parent.zooming?this.ignoreInput=!0:(this.dragged=!1,this.dragTypeResolved=2,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick&&this.stickyClick(t,this)?(this.ignoreInput=!0,this.stickyClick=null):(e=s.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",e),this.stickyClick=function(t,e,i){return this.owner.container.removeListener("pointermove",t),e&&!this.owner.destroyed?this.endInputMovement(e,!0):this.owner.destroyed&&platypus.debug.warn("BoxDragger: Somehow a sticky-click stayed stuck on a destroyed entity."),i===this}.bind(this,e))):this.startInputMovement(t),this.recycleTempEvent(t))};platypus.createComponentClass({id:"BoxDragger",properties:{useNodes:!1,untrashable:!1},publicProperties:{dragging:!1,movable:!0,inTrash:null,inBuildingArea:!1,neverMovedPreviously:null,overlaps:0,z:0},initialize:function(){Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.firstRun=!0,this.sensorState=!1,this.groupMovement=null,this.locked=!0,this.ignoreInput=!1,this.mouseArray=[],this.tempEvents=[],this.increaseTempEvents(),this.wentOutsideTheScreen=!1,this.time=0,this.triggeredLAPStartDrag=!1,this.triggeredLAPStartDragStall=!1,this.dragTypeResolved=0},events:{adopted:function(){this.owner.state.get("block")&&(this.untrashable=!0),this.untrashable&&(this.inBuildingArea=!0)},"camera-update":function(t){this.camera.set(t.viewport)},"handle-logic":function(){},"handle-render":function(t){var i=this.groupMovement,n=this.owner.parent,s=null;i&&(i.readyToEnd?i.collisionComplete&&(i.endMovement(i.readyToEnd),i.recycle(),this.groupMovement=null):(n.triggerEvent("hover-state",i.state),this.countDown&&(this.countDown-=t.delta,this.countDown<=0&&(s=e.setUp("criteria",this.owner.groupId,"group",i,"invalid",!1),n.triggerEventOnChildren("validate-select-all",s),s.invalid?this.countDown=1/0:(n.triggerEventOnChildren("select-all",i,this.owner.groupId),i.selectAll(),this.countDown=0),s.recycle()))))},"handle-ai":function(){var t=0;for(t=0;t<this.mouseArray.length&&!this.willSoonBeDestroyed;t++)this.mouseArray[t]();1===this.dragTypeResolved&&(this.dragTypeResolved=0),this.mouseArray.length=0},pointerdown:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(r.bind(this,e))},pointermove:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){var e=platypus.game.app;this.ignoreInput||0===t.event.movementX&&0===t.event.movementY||(t.event?(this.dragged=!0,1!==this.dragTypeResolved&&(2===this.dragTypeResolved&&(this.dragTypeResolved=1),this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.groupMovement?this.continueInputMovement(t):platypus.debug.warn('BoxDragger: Received "pointermove" event, but have no group to move. This is bizarre.'),this.triggeredLAPStartDrag||(this.triggeredLAPStartDrag=!0,e.analyticsEmitter.startDrag(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"press-n-drag",this.owner.type,this.neverMovedPreviously?"toolbox":"kitchen")),this.recycleTempEvent(t))):platypus.debug.warn("Mouse event received before entity was created."))}.bind(this,e))},pointerup:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created.")}.bind(this,e))},pointerupoutside:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created.")}.bind(this,e))},pointercancel:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.groupMovement&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created."))}.bind(this,e))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off"),i.removeComponent(this),e?i.addComponent(new platypus.components.BoxDraggerFrozen(this.owner,{})):i.addComponent(new platypus.components.FindMovables(this.owner,{})),t||i.parent.triggerEvent("child-entity-updated",i)},"before-box2d-update":function(){},"collide-with-building-region":function(){this.untrashable||(this.inBuildingArea=!0)},"collided-with-building-region":function(){this.untrashable||(this.inBuildingArea=!1)},"collide-with-trash":function(t){this.untrashable?this.owner.triggerEvent("begin-drag-overlap"):(this.inTrash||(this.inTrash=Array.setUp()),this.inTrash.push(t.otherFixture))},"collided-with-trash":function(t){var e;this.untrashable?this.owner.triggerEvent("end-drag-overlap"):(e=this.inTrash.indexOf(t.otherFixture))>=0?(this.inTrash.greenSplice(e),0===this.inTrash.length&&(this.inTrash.recycle(),this.inTrash=null)):platypus.debug.warn("Trying to remove a fixture that is not in trash.")},"begin-drag-overlap":function(){this.owner.state.get("block")||(this.overlaps+=1)},"end-drag-overlap":function(){this.owner.state.get("block")||(this.overlaps-=1)},"box2d-step-complete":function(){var t=this.groupMovement;this.vector&&t&&(t.readyToEnd&&(t.collisionComplete=!0),t.checkValidity())},"include-in-group":function(t){t.addEntity(this.owner)},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&this.groupMovement&&t.group!==this.groupMovement&&(t.invalid=!0)},"select-all":function(t,e){this.owner.groupId&&this.owner.groupId===e&&this.owner.triggerEvent("include-in-group",t)},"select-effected":function(t,e){this.owner.groupId&&this.owner.groupId===e&&t.push(this.owner)}},methods:{recycleTempEvent:function(t){t.x=0,t.y=0,t.event=null,t.pixiEvent=null,t.entity=null,this.tempEvents.push(t)},copyMouseEvent:function(t){var e=null;return this.tempEvents.length||this.increaseTempEvents(),(e=this.tempEvents.pop()).x=t.x,e.y=t.y,e.event=t.event,e.pixiEvent=t.pixiEvent,e.entity=t.entity,e},increaseTempEvents:function(){for(var t=5;t;)--t,this.tempEvents.push({x:0,y:0,event:null,pixiEvent:null,entity:null})},startInputMovement:function(t){var n,s=null,r=this.owner,o=e.setUp("invalid",!1);this.time=Date.now(),r.triggerEvent("validate-begin-group-movement",o),n=this.owner.parent.isThisGroupMoving(this.owner.groupId),o.invalid||n?this.ignoreInput=!0:(this.owner.parent.triggerEvent("dragging-a-piece",this.owner),this.groupMovement=s=i.setUp(t),s.addEntity(r),r.triggerEvent("begin-group-movement",s),s.startMovement(t),this.countDown=1250,r.parent.triggerEventOnChildren("select-effected",s.effected,r.groupId),r.parent.triggerEvent("pause-zooming")),o.recycle()},continueInputMovement:function(t){var i,s,r=this.groupMovement,o=null,a=null,h=0,l=null,c=null,p=null,u=0,d=!1;if(r){if(this.owner.destroyed)return platypus.debug.warn("BoxDragger: Cannot move a destroyed entity. Bailing!"),r.endMovement(t),r.recycle(),void(this.groupMovement=null);for(i=n.setUp(t.x,t.y),s=r.saOrigin,c=Array.setUp(),u=(p=r.validSnaps).length,void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),r.getSnaps(c,i,this.owner.parent.pins,this.countDown),h=0;h<c.length;h++)if(l=c[h],r.validateMotion(l,c)){if(this.countDown){if(l.x===s.x&&l.y===s.y)break;this.countDown=0,this.owner.triggerEvent("break-away")}if(!p.length&&l.pinTo&&this.owner.triggerEvent("connect"),u){for(d=!0;u--;)p[u].pinFrom.state.set("almost-pinned",!1),p[u].recycle();p.length=0}for(l.pinTo?(l.pinFrom.state.set("almost-pinned",!0),p.push(e.setUp("pinTo",l.pinTo,"pinFrom",l.pinFrom))):d&&(d=!1,r.justUnsnapped=!0),u=h+1;u<c.length;u++)(a=c[u]).pinFrom&&.9>(g=l.x-a.x,y=l.y-a.y,g*g+y*y)&&(a.pinFrom.state.set("almost-pinned",!0),p.push(e.setUp("pinTo",a.pinTo,"pinFrom",a.pinFrom)));for(o=Array.setUp(),r.getPanelSnaps(o,l),h=o.length,r.justUnsnapped&&h&&(r.justUnsnapped=!1);h--;)o[h].pinFrom.state.set("almost-pinned",!0),p.push(o[h]);o.recycle(),r.continueMovement(l,p);break}var g,y;c.recycle(2)}else platypus.debug.warn("BoxDragger: No group movement for this input. Bailing!")},endInputMovement:function(t,e){var i=platypus.game.app,s=this.groupMovement,r=s.lastValidPosition||t;this.owner.parent.triggerEvent("finished-dragging-a-piece",this.owner),2===s.state?(s.endMovement(r),this.groupMovement.recycle(),this.groupMovement=null):(s.state&&i.analyticsEmitter.endDragOutside(i.levelBot||"",i.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0,this.owner.type,{kitchen_w:this.camera.width>>0,kitchen_h:this.camera.height>>0,x:this.owner.x-this.camera.left>>0,y:this.owner.y-this.camera.top>>0}),this.continueInputMovement(r),r=s.lastValidPosition||t,s.readyToEnd=n.setUp(r.x,r.y),this.neverMovedPreviously&&(this.neverMovedPreviously=null)),this.owner.destroyed||(this.owner.parent.triggerEvent("unpause-zooming"),this.owner.parent.triggerEvent("moved-item"),this.triggeredLAPStartDrag=!1,this.triggeredLAPStartDragStall=!1)},destroy:function(){this.camera.recycle()}},publicMethods:{startMovement:function(t){this.vector?this.vector.recycle():this.owner.renderGroup="hover",this.vector=n.setUp(t.x,t.y),this.locked=!1,this.owner.triggerEvent("starting-drag")},continueMovement:function(t){var e=this.owner;this.vector.x=t.x,this.vector.y=t.y,e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endMovement:function(t,e,i){this.vector&&(i||this.continueMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,this.owner.renderGroup="blueprint",this.owner.triggerEvent("motion-ended"),2!==e||i||this.owner.destroyed||(this.willSoonBeDestroyed=!0,this.stickyClick&&this.stickyClick(),this.addEventListener("prepare-logic",function(){this.owner.triggerEvent("throw-away"),this.owner.destroyed||this.owner.parent.removeEntity(this.owner)})))},validateMotion:function(t,e){if(!this.movable)return t.valid=!1,void(t.movable=!1);this.owner.triggerEvent("validate-motion",t),t.valid||e&&t.adjusted&&(t.position=t.adjusted,t.adjusted=null,t.valid=!0,this.validateMotion(t,e-1))}}})}(),function(){"use strict";var t=include("Box2D.b2AABB"),e=include("Box2D.b2Contact"),i=include("Box2D.b2Fixture"),n=include("Box2D.b2Vec2"),s=include("Box2D.b2World"),r=include("Box2D.JSContactListener"),o=include("Box2D.JSQueryCallback"),a=include("Box2D.helpers.getUserData"),h=include("Box2D.destroy"),l={collisionType:"none",entity:null},c=include("Box2D.wrapPointer"),p={entity:null,contact:null,thisFixture:null,otherFixture:null,oldManifold:null,impulse:null},u=function(t){var i=c(t,e),n=i.GetFixtureA(),s=i.GetFixtureB(),r=a(n).collisionType,o=a(s).collisionType,h=a(n.GetBody()).entity,l=a(s.GetBody()).entity;p.contact=i,p.oldManifold=null,p.impulse=null,p.thisFixture=n,p.otherFixture=s,p.entity=l,h.triggerEvent("begin-contact-"+r+"-and-"+o,p),p.thisFixture=s,p.otherFixture=n,p.entity=h,l.triggerEvent("begin-contact-"+o+"-and-"+r,p)},d=function(t){var i=c(t,e),n=i.GetFixtureA(),s=i.GetFixtureB(),r=(a(n)||l).collisionType,o=(a(s)||l).collisionType,h=(a(n.GetBody())||l).entity,u=(a(s.GetBody())||l).entity;p.contact=i,p.oldManifold=null,p.impulse=null,h&&(p.thisFixture=n,p.otherFixture=s,p.entity=u,h.triggerEvent("end-contact-"+r+"-and-"+o,p)),u&&(p.thisFixture=s,p.otherFixture=n,p.entity=h,u.triggerEvent("end-contact-"+o+"-and-"+r,p))},g=function(t,i){var n=c(t,e),s=n.GetFixtureA(),r=n.GetFixtureB(),o=a(s).collisionType,h=a(r).collisionType,l=a(s.GetBody()).entity,u=a(r.GetBody()).entity;p.contact=n,p.oldManifold=i,p.impulse=null,p.thisFixture=s,p.otherFixture=r,p.entity=u,l.triggerEvent("pre-solve-"+o+"-and-"+h,p),p.thisFixture=r,p.otherFixture=s,p.entity=l,u.triggerEvent("pre-solve-"+h+"-and-"+o,p)},y=function(t,i){var n=c(t,e),s=n.GetFixtureA(),r=n.GetFixtureB(),o=a(s).collisionType,h=a(r).collisionType,l=a(s.GetBody()).entity,u=a(r.GetBody()).entity;p.contact=n,p.oldManifold=null,p.impulse=i,p.thisFixture=s,p.otherFixture=r,p.entity=u,l.triggerEvent("post-solve-"+o+"-and-"+h,p),p.thisFixture=r,p.otherFixture=s,p.entity=l,u.triggerEvent("post-solve-"+h+"-and-"+o,p)};platypus.createComponentClass({id:"BoxHandler",properties:{gravity:null,simulationFrequency:1/60,velocityIterations:10,positionIterations:10,debugFlags:null},publicProperties:{world:null,drawScale:30,logicStepsPerBox2DStep:1},initialize:function(t){var e=this.gravity||{x:0,y:0},i=new r,o=void 0===t.allowSleep||t.allowSleep;this.destroyBodies=[],this.inCollisionLoop=!1,this.paused=!1,this.totalTime=0,this.world=new s(new n(e.x,e.y),o),i.BeginContact=u,i.EndContact=d,i.PreSolve=g,i.PostSolve=y,this.world.SetContactListener(i)},events:{"body-removed":function(t){this.inCollisionLoop?this.destroyBodies.push(t):this.world.DestroyBody(t)},"check-collision-group":function(t){var e=this.debugCanvas,i=this.destroyBodies,n=0,s=this.owner,r=this.simulationFrequency,o=this.world;if(i.length){for(n=0;n<i.length;n++)o.DestroyBody(i[n]);i.length=0}if(!this.paused)for(this.totalTime+=t.delta/(1e3*r);this.totalTime>0;)this.totalTime-=this.logicStepsPerBox2DStep,s.triggerEvent("before-box2d-update",t,r),s.triggerEventOnChildren("before-box2d-update",t,r),this.inCollisionLoop=!0,o.Step(r,this.velocityIterations,this.positionIterations),this.inCollisionLoop=!1,e&&(this.ctx.clearRect(0,0,e.width,e.height),o.DrawDebugData()),o.ClearForces(),s.triggerEventOnChildren("after-box2d-update",t,r),s.triggerEvent("after-box2d-update",t,r),s.triggerEventOnChildren("box2d-step-complete")},"camera-update":function(t){var e=window.devicePixelRatio||1,i=t.scaleY*this.drawScale/e,n=t.scaleX*this.drawScale/e;this.debugCanvas&&(this.debugCanvas.width===this.debugCanvas.offsetWidth&&this.debugCanvas.height===this.debugCanvas.offsetHeight||(this.debugCanvas.width=this.debugCanvas.offsetWidth,this.debugCanvas.height=this.debugCanvas.offsetHeight),this.ctx.restore(),this.ctx.save(),this.ctx.translate(-t.viewport.left*t.scaleX/e,-t.viewport.top*t.scaleY/e),this.ctx.scale(i,n))},"pause-collision":function(){this.paused=!0},"unpause-collision":function(){this.paused=!1}},methods:{destroy:function(){h(this.world),this.world=null,this.debugCanvas&&this.debugCanvas.parentNode&&this.debugCanvas.parentNode.removeChild(this.debugCanvas),this.debugCanvas=null,this.debugDraw=null,this.ctx=null}},publicMethods:{getEntitiesAtPoint:function(e,s){var r=new t,l=Array.setUp(),p=e/this.drawScale,u=s/this.drawScale,d=new n(p-.01,u-.01),g=new n(p+.01,u+.01),y=new o,m=null;return r.set_lowerBound(d),r.set_upperBound(g),y.ReportFixture=function(t){var e=c(t,i);return e.TestPoint(this.m_point)&&(m=a(e.GetBody()))&&m.entity&&l.push(m.entity),!0},y.m_point=new n(p,u),this.world.QueryAABB(y,r),h(d),h(g),h(r),l}}})}(),function(){"use strict";var t,e=include("platypus.AABB"),i=include("Box2D.b2Vec2"),n=include("PIXI.Graphics"),s=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},r=include("Box2D.destroy");platypus.createComponentClass({id:"BoxStateSaver",properties:{renderDebug:!1,useStressSignals:!0},publicProperties:{buildingArea:null,engine:null,world:null,gravityMultiplier:1},initialize:function(){this.busySaving=!1,this.simulationStarted=!1,this.initialCamera=e.setUp(0,0,800,600),this.mask=null,this.level=null,this.stage=null,this.gravityStrength=50,this.gravity=new i(0,this.gravityStrength),this.noGravity=new i(0,0),this.currentLevel="",this.currentMatrix=[],springroll.Debug&&(window.makeEverythingMovable=this.makeEverythingMovable.bind(this),window.exportLevel=this.exportLevel.bind(this)),this.owner.stickyClick=null},events:{"set-gravity":function(t){this.gravityMultiplier=t},"hover-state":function(t){if(this.stage!==t)switch(this.stage=t,t){case 2:this.updateFilter(1,0,0);break;case 1:this.updateFilter(1,.6,.6);break;default:this.updateFilter(1,1,.4)}},"render-world":function(t){var e=t.renderGroups,i=t.world;e[0].z=0,this.mask=function(t,e){var i=new n;return t.mask=i,i.isMask=!0,i.z=1,e.addChild(i),i}(e[0],i),t.world.reorder=!0},"world-loaded":function(t){var e=0,i=null,n=platypus.labRetriever,s=this.owner.labUnlocks;if(this.level=t.level,s)for(e=(s=s.split(",")).length;e--;)i=s[e],n.has(i)||platypus.labRetriever.unlock(i);this.startSimulation()},"scene-loaded":function(t){switch("string"==typeof t.level?this.currentLevel=t.level:this.currentLevel=s(t.level.properties,"levelId"),this.currentLevel){case"level-8":case"level-9":case"level-10":case"level-11":case"level-12":case"level-13":case"level-14":this.gravity=new i(0,32);break;case"level-18":case"level-19":case"level-20":this.gravity=new i(0,0)}},"start-simulation":function(){this.simulationStarted?platypus.debug.warn("Simulation asked to start, but it is already started."):this.startSimulation()},"stop-simulation":function(){this.simulationStarted?platypus.game.loadScene("scene-level",{level:this.level}):platypus.debug.warn("Simulation asked to stop, but it is not started.")},"camera-update":function(t){var i=e.setUp(t.viewport);!function(t,e){e.clear(),e.beginFill(0,1),e.r(t.left-1,t.top-1,t.width+2,t.height+2),e.endFill()}(i,this.mask),i.recycle()},"building-area-ready":function(t){this.buildingArea=t},"stop-following-if-simulating":function(){this.followingItem&&(this.followingItem=!1,this.owner.triggerEvent("follow",{mode:"static"}))},"child-entity-removed":function(t){this.simulationStarted||this.owner.triggerEvent("entity-discarded",t.type)},"recycle-everything":function(){platypus.game.loadScene("scene-level",{level:this.level})},"controls-updated":function(t){this.currentControls=t},"photo-ready":(t=function(t,e,i){var n=0,s=platypus.game.app.config.journal,r={thumbnail:function(t,e,i){var n=0,s=0,r=t.width,o=t.height,a=document.createElement("canvas"),h=a.getContext("2d");a.width=e,a.height=i,r/o>e/i?(n=i*(r/o),s=i):r/o<e/i?(n=e,s=e*(o/r)):(n=e,s=i);try{return h.drawImage(t,0,0,r,o,(e-n)/2,(i-s)/2,n,s),a.toDataURL()}catch(t){return null}}(platypus.game.app.display.renderer.extract.canvas(this.owner.worldContainer.parent),s.thumbnail.width/2,s.thumbnail.height/2),level:this.currentLevel,controls:this.currentControls};for(Array.isArray(i)||(i=[]),n=0;n<i.length&&i[n];n++);if(n>=s.maxSavesPerGame)platypus.debug.olive("Will need to remove a picture to make room!"),platypus.game.loadScene("journal-menu",{insertSave:r});else{i[n]=r;try{t.write(s.storageKey,i,e)}catch(n){r.thumbnail=null,t.write(s.storageKey,i,e)}}},function(){var e=this.owner.parent.app.userData,i=platypus.game.app.config.journal;this.busySaving||(this.busySaving=!0,e.read(i.storageKey,t.bind(this,e,function(){this.busySaving=!1}.bind(this))))}),tick:function(){this.owner.triggerEventOnChildren("handle-cam-lock")}},methods:{getSaveState:function(){var t,e=this.owner,i=Array.setUp();return e.triggerEventOnChildren("retrieve-save-state",i,this.editingLevel),t=function(t,e,i){var n=JSON.parse(JSON.stringify(e)),r=null,o=null,a=n.layers,h=a.length,l=0,c=null;for(delete n.assets;h--;)if(a[h].objects){o=a[h].objects;break}for(h=o.length;h--;)r=o[h],s(r.properties,"savable")||i&&s(r.properties,"movable")?o.splice(h,1):l=Math.max(l,r.id+1);for(h=n.tilesets.length;h--;)c=n.tilesets[h],n.tilesets[h]={firstgid:c.firstgid,source:c.source||c.name+".json"};return t.forEach(function(t){t.id=l++,o.push(t)}),n}(i,this.level,this.editingLevel),i.recycle(),t},startSimulation:function(){var t=this.owner,e=0,i=null,n=this.useStressSignals;for(this.simulationStarted=!0,this.gravity.set_y(this.gravityStrength*this.gravityMultiplier),this.world.SetGravity(this.gravity),this.level=this.getSaveState(),this.owner.triggerEvent("pre-simulation-started"),e=t.pins&&t.pins.length;e--;)t.pins[e].getConstraints().length>0&&(i={},t.pins[e].panelled?(i.distance=.45,n=!1):t.pins[e].handshake?(i.distance=.35,n=!1):(i.angle="default",i.reaction="default",i.distance="default",n=this.useStressSignals),this.owner.triggerEvent("add-joint-cluster",t.pins[e].getConstraints(),i,n));this.owner.triggerEvent("simulation-started")},updateFilter:function(t,e,i){var n=this.hover.filters[0].matrix;n[0]=t,n[6]=e,n[12]=i},destroy:function(){r(this.gravity),r(this.noGravity),this.initialCamera.recycle(),this.initialCamera=null}},publicMethods:{makeEverythingMovable:function(){for(var t=this.owner.entities,e=t.length,i=null;e--;)!(i=t[e]).hasOwnProperty("movable")||i.neverSave||i.movable||(i.movable=!0)},exportLevel:function(){return this.simulationStarted?"Restart simulation before attempting to export.":(this.editingLevel=!0,JSON.stringify(this.getSaveState()))},getSavedLevel:function(){return this.level}}})}(),function(){"use strict";platypus.createComponentClass({id:"CamFader",properties:{},publicProperties:{},initialize:function(){},events:{"activate-controls":function(){this.owner.opacity=.25,this.owner.triggerEvent("disable")},"deactivate-controls":function(){this.owner.opacity=1,this.owner.triggerEvent("enable")}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.AABB");platypus.createComponentClass({id:"CamLock",properties:{target:null,levelId:0},publicProperties:{},initialize:function(){this.tx=0,this.ty=0,this.offsetX=0,this.offsetY=0,this.tweening=!0,this.camera=i.setUp(),this.zoom=2,this.yo=0},events:{adopted:function(){this.owner.parent.triggerEvent("follow",{mode:"locked",entity:this.owner});var i=1.33,n=1500;switch(this.levelId){case"level-1":this.yo=0,this.offsetX=3e3-this.owner.x,this.offsetY=1e3-this.owner.y;break;case"level-2":this.yo=0,this.offsetX=3e3-this.owner.x,this.offsetY=415-this.owner.y;break;case"level-3":this.yo=0,i=1.5,this.offsetX=4200-this.owner.x,this.offsetY=526-this.owner.y;break;case"level-4":this.yo=0,this.offsetX=1656-this.owner.x,this.offsetY=700-this.owner.y;break;case"level-5":this.yo=0,this.offsetX=808-this.owner.x,this.offsetY=408-this.owner.y;break;case"level-6":this.yo=0,this.offsetX=1918-this.owner.x,this.offsetY=200-this.owner.y;break;case"level-7":this.yo=0,this.offsetX=3300-this.owner.x,this.offsetY=852-this.owner.y;break;case"level-8":this.yo=0,this.offsetX=4e3-this.owner.x,this.offsetY=480-this.owner.y;break;case"level-9":this.yo=50,this.offsetX=4900-this.owner.x,this.offsetY=300-this.owner.y;break;case"level-10":this.yo=175,i=2,this.offsetX=1200-this.owner.x,this.offsetY=350-this.owner.y,n=5e3;break;case"level-11":this.yo=25,this.offsetX=2e3-this.owner.x,this.offsetY=300-this.owner.y;break;case"level-12":this.yo=150,i=1.8,this.offsetX=1600-this.owner.x,this.offsetY=700-this.owner.y;break;case"level-13":this.yo=50,this.offsetX=3800-this.owner.x,this.offsetY=1300-this.owner.y;break;case"level-14":this.yo=100,this.offsetX=1500-this.owner.x,this.offsetY=1552-this.owner.y;break;case"level-15":this.yo=-350,i=1.75,this.offsetX=1700-this.owner.x,this.offsetY=1400-this.owner.y;break;case"level-16":this.yo=0,i=1.75,this.offsetX=6e3-this.owner.x,this.offsetY=830-this.owner.y;break;case"level-17":this.yo=-400,i=1.85,this.offsetX=1156-this.owner.x,this.offsetY=1507-this.owner.y;break;case"level-18":this.yo=0,i=1.75,this.offsetX=1240-this.owner.x,this.offsetY=672-this.owner.y;break;case"level-19":this.yo=0,i=1.75,this.offsetX=3046-this.owner.x,this.offsetY=1245-this.owner.y;break;case"level-20":this.yo=0,i=2,this.offsetX=1384-this.owner.x,this.offsetY=1800-this.owner.y}this.yo-=50,i+=.1,t.get(this).wait(n).to({zoom:i,x:this.origX,y:this.origY},6e3,e.sineInOut).call(function(){this.tweening=!1}.bind(this)),t.get(this).wait(n).to({offsetX:0,offsetY:0},6e3,e.sineInOut)},"handle-cam-lock":function(){this.target.body.GetLinearVelocity();this.tx=this.target.x+this.offsetX,this.ty=this.target.y-this.yo+this.offsetY,this.owner.x+=(this.tx-this.owner.x)/1,this.owner.y+=(this.ty-this.owner.y)/1,this.tweening&&this.owner.parent.triggerEvent("resize-camera",{width:960*this.zoom,height:720*this.zoom})}},methods:{destroy:function(){this.target=null,this.camera.recycle()}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"CamPath",properties:{vx:0,vy:0},publicProperties:{},initialize:function(){this.remove=!1},events:{adopted:function(){var e=new t(10*this.vx,10*this.vy);this.owner.body.ApplyLinearImpulse(e,this.owner.body.GetWorldCenter())},"prepare-logic":function(){this.owner.y<200&&(this.remove=!0,this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","camera-capture-sky")),this.remove&&(this.owner.parent.removeEntity(this.owner),this.remove=!1)},"collide-with-target":function(t){var e=t.entity,i=Math.atan2(e.y-this.owner.y,e.x-this.owner.x),n=Math.atan2(this.vy,this.vx),s=Math.abs(Math.abs(i)-Math.abs(n))<.85;i>0&&n<0&&(s=!1),s?(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","camera-capture-target-good"),e.removeThis(),this.owner.parent.triggerEvent("goodPhotoFX")):this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","camera-capture-target-bad"),this.remove=!0},"collide-with-star":function(){this.remove=!0,this.owner.parent.triggerEvent("camera-capture-star")},"collide-with-ground":function(){this.remove=!0,this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","camera-capture-ground")}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Cloud",properties:{speedX:1},publicProperties:{},initialize:function(){this.camera=t.setUp()},events:{"handle-logic":function(t){this.owner.x+=this.speedX,this.owner.x>this.camera.right+150&&(this.owner.x=this.camera.left-150)},"camera-update":function(t){this.camera.set(t.viewport)}},methods:{destroy:function(){this.camera.recycle()}},publicMethods:{}})}(),function(){"use strict";var t,e=include("PIXI.Container"),i=include("PIXI.Graphics"),n=include("platypus.AABB");platypus.createComponentClass({id:"CommandList",properties:{width:0,height:0},publicProperties:{},initialize:function(){this.mask=null,this.commands=Array.setUp(),this.yMax=-235,this.yMin=0,this.currentY=this.yMax,this.aabb=n.setUp(0,0,this.width,this.height),this.list=null,platypus.game.app.getPlayerResources=function(){for(var t=[],e=this.commands,i=e.length;i--;)t.push({name:e[i].type,position:{x:e[i].x>>0,y:e[i].y>>0},shape:e[i].shape});return t}.bind(this)},events:{"scene-loaded":function(t){var e="",i=0,n=platypus.labRetriever;switch(e="string"==typeof t.level?t.level:function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null}(t.level.properties,"levelId")){case"level-1":this.list=["control-left","control-right"];break;case"level-2":this.list=["control-left","control-right","control-jump"];break;case"level-3":this.list=["control-left","control-right","control-jump","control-horn"];break;case"level-4":case"level-5":this.list=["control-left","control-right","control-vacuum","control-eject","control-jump","control-horn"];break;case"level-6":this.list=["control-left","control-right","control-vacuum","control-eject","control-jump","control-horn","control-whistle"];break;case"level-7":this.list=["control-left","control-right","control-vacuum","control-eject","control-jump","control-whistle","control-super-jump"];break;case"level-8":this.list=["control-rotate-ccw","control-rotate-cw","control-rotate-arm-cw","control-rotate-arm-ccw"];break;case"level-9":this.list=["control-rotate-ccw","control-rotate-cw","control-rotate-arm-cw","control-rotate-arm-ccw","control-get-soil","control-rescue"];break;case"level-10":this.list=["control-rotate-ccw","control-rotate-cw","control-rotate-arm-cw","control-rotate-arm-ccw","control-get-soil","control-camera","control-rescue"];break;case"level-11":case"level-12":case"level-13":case"level-14":this.list=["control-rotate-ccw","control-rotate-cw","control-rotate-arm-cw","control-rotate-arm-ccw","control-get-soil","control-magnet","control-camera","control-rescue"];break;case"level-15":this.list=["control-fly-left","control-fly-right","control-fly-up","control-fly-down","control-beam"];break;case"level-16":this.list=["control-fly-left","control-fly-right","control-fly-up","control-fly-down","control-throttle"];break;case"level-17":this.list=["control-fly-left","control-fly-right","control-fly-up","control-fly-down","control-beam"];break;case"level-18":case"level-19":this.list=["control-fly-left","control-fly-right","control-fly-up","control-fly-down","control-throttle","control-hand"];break;case"level-20":this.list=["control-fly-left","control-fly-right","control-fly-up","control-fly-down","control-throttle","control-hand","control-vortex"]}for("level-1"!==e?this.populateList(e,t.controls):this.unveilControls=this.populateList.bind(this,e,t.controls),i=this.list.length;i--;)n.unlock(this.list[i]);platypus.game.app.getResources=function(){for(var t=[],e=this.list,i=e.length;i--;)t.push({name:e[i],shape:platypus.game.settings.entities[e[i]].properties.shape});return t}.bind(this),platypus.game.app.isReallyReady=function(){return!0}.bind(this)},"render-world":function(t){for(var n=t.renderGroups,s=n.length,r=null,o=new i;s--;)if("commandList"===n[s].name){r=n[s];break}r||((r=new e).name="commandList",n.push(r),t.world.addChild(r)),r.z=100,this.mask=r.mask=o,o.isMask=!0,o.z=100,t.world.addChild(this.mask)},"camera-update":function(t){var e=this.mask;e.clear(),e.beginFill(0,1),e.r(this.owner.x,this.owner.y-this.height/2+50,this.width+100,this.height-100),e.endFill(),this.aabb.move(this.owner.x,this.owner.y)},"command-scroll-up":function(){if(!(this.currentY+50>this.yMax)){for(var t=0;t<this.commands.length;t++){this.commands[t].scroll(50)}this.currentY+=50}},"command-scroll-down":function(){if(!(this.currentY-50<this.yMin)){for(var t=0;t<this.commands.length;t++){this.commands[t].scroll(-50)}this.currentY-=50}},"begin-level-1":function(){this.owner.triggerEvent("hide-sprite")},"begin-tutorial":function(){this.owner.triggerEvent("show-sprite"),this.unveilControls&&(this.unveilControls(),this.unveilControls=null)},"activate-controls":function(){this.owner.triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("computerON")},"deactivate-controls":function(){this.owner.triggerEvent("show-sprite"),this.owner.parent.triggerEvent("computerOFF")}},methods:{destroy:function(){this.mask=null,this.commands.recycle(),this.aabb.recycle(),this.list=null},populateList:(t=function(t){this.total-=1,0===this.total&&this.owner.parent.getEntitiesByType("control-panel")[0].triggerEvent("buttons-are-ready",t)},function(e,i){var n=75,s=this.yMax,r=0,o=0,a=0,h=1,l=null,c=null,p="";for(this.total=0,a=0;a<this.list.length;a++)p=this.list[a],c=platypus.game.settings.entities[p],h="control-throttle"===p?.575:.75,this.total+=1,((l=this.owner.parent.addEntity({type:this.list[a],properties:{originX:n,originY:s+c.properties.height/2*h,levelId:e,scaleX:h,scaleY:h,commandList:this.owner}},t.bind(this,i))).height+25)*h>o&&(o=(l.height+25)*h),75!==n&&(s+=o,r+=o,o=0),this.commands.push(l),n=75===n?200:75;this.yMin=this.yMax-r+(this.height-100),this.yMin>=-235&&this.owner.parent.triggerEvent("scroller-not-required")}),removeList:function(){for(var t=["control-left"],e=0;e<this.commands.length;e++){var i=this.commands[e];"control-left"==i.type&&this.owner.parent.removeEntity(i)}for(e=0;e<t.length;e++){var n=t[e];this.commands.splice(this.commands.indexOf(n),1)}},updateCommandList:function(){for(var t=0;t<this.commands.length;t++){this.commands[t].updateVisible(this.aabb)}}},publicMethods:{collidesWith:function(t){return this.aabb.collides(t)}},getAssetList:function(){return Array.setUp("assets/images/controls.png","assets/images/control-panel-cell.png","assets/images/control-panel-border.png")}})}(),function(){"use strict";platypus.createComponentClass({id:"CommandScroller",properties:{dir:""},publicProperties:{},initialize:function(){this.c=0,this.neverShow=!1},events:{adopted:function(){this.owner.state.set(this.dir,!0)},pointerdown:function(){this.owner.parent.triggerEvent("command-scroll-"+this.dir),this.owner.state.set(this.dir,!1),this.owner.state.set(this.dir+"-pressed",!0),this.c=1},pointerup:function(){this.owner.state.set(this.dir+"-pressed",!1),this.owner.state.set(this.dir,!0),this.c=0},"handle-logic":function(){this.c>0&&(this.c++,this.c%20==0&&this.owner.parent.triggerEvent("command-scroll-"+this.dir))},"activate-controls":function(){this.owner.triggerEvent("hide-sprite")},"deactivate-controls":function(){this.neverShow||this.owner.triggerEvent("show-sprite")},"begin-level-1":function(){this.owner.triggerEvent("hide-sprite")},"begin-tutorial":function(){this.neverShow||this.owner.triggerEvent("show-sprite")},"scroller-not-required":function(){this.neverShow=!0,this.owner.triggerEvent("hide-sprite")}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",properties:{propertyName1:"property-value"},publicProperties:{propertyName2:"property-value"},initialize:function(){},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Control",properties:{name:"",continuous:!1,bookEnds:!1,paired:""},initialize:function(){this.camera=t.setUp(),this.pressed=!1,this.continuous&&this.addEventListener("handle-logic",function(){this.pressed&&this.owner.parent.parent.layers[1].triggerEvent(this.name)}),this.paired&&(this.bookEnds=!0,this.addEventListener(this.paired+"-start",function(){this.owner.state.set(this.name+"-active",!0),this.owner.state.set(this.name+"-pressed",!1)}),this.addEventListener("deactivate-controls",function(){this.owner.state.set(this.name+"-inactive",!0),this.owner.state.set(this.name+"-pressed",!1),this.owner.state.set(this.name+"-active",!1)}))},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-down":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.owner.x,n=t&&"number"==typeof t.y?t.y:this.owner.y;e.analyticsEmitter.controlButtonEngaged(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},this.name,e.getRobotLocationForLAP()),this.bookEnds?this.owner.parent.parent.layers[1].triggerEvent(this.name+"-start"):this.owner.parent.parent.layers[1].triggerEvent(this.name),this.owner.state.set(this.name+"-active",!1),this.owner.state.set(this.name+"-pressed",!0),this.pressed=!0,this.paired&&this.owner.parent.triggerEvent(this.name+"-start")},"pointer-up":function(){this.bookEnds&&this.owner.parent.parent.layers[1].triggerEvent(this.name+"-end"),this.owner.state.set(this.name+"-active",!0),this.owner.state.set(this.name+"-pressed",!1),this.pressed=!1}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e="";platypus.createComponentClass({id:"Controllable",properties:{rotateCW:0,rotateCCW:0,moveRight:0,moveLeft:0,moveUp:0,moveDown:0,jump:0,superJump:0,stop:0,open:0,close:0,magnet:0,light:0,horn:0,rotateArmCW:0,rotateArmCCW:0,flyRight:0,flyLeft:0,flyDown:0,flyUp:0,throttle:0,beam:0,eject:0},publicProperties:{},initialize:function(){this.zeroVec2=new t(0,0),0!==this.moveRight&&(this.rightVec2=new t(this.moveRight,0)),this.rightVec2Air=new t(this.moveRight/3,0),0!==this.moveLeft&&(this.leftVec2=new t(-this.moveLeft,0)),this.leftVec2Air=new t(-this.moveLeft/3,0),0!==this.flyUp&&(this.flyVec2=new t(0,0)),0!==this.jump&&(this.jumpVec2=new t(0,-this.jump)),0!==this.superJump&&(this.superJumpVec2=new t(0,-this.superJump)),this.magnetOn=!1,this.beamOn=!1,this.lightOn=!1,this.facingVal=1},events:{adopted:function(){e=""},"deactivate-controls":function(){e=""},"right-start":function(){0!==this.moveRight&&(e="move-right",this.facingVal=1)},"right-end":function(){0!==this.moveRight&&(e="")},"left-start":function(){0!==this.moveLeft&&(e="move-left",this.facingVal=-1)},"left-end":function(){0!==this.moveLeft&&(e="")},"move-down-start":function(){0!==this.moveDown&&this.owner.body.SetLinearVelocity(this.downVec2)},"move-down-end":function(){this.moveDown},"move-up-start":function(){0!==this.moveUp&&this.owner.body.SetLinearVelocity(this.upVec2)},"move-up-end":function(){this.moveUp},"fly-right":function(){0!==this.flyRight&&(this.owner.colliding||(this.flyVec2.set_x(this.throttle),this.flyVec2.set_y(0),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-left":function(){0!==this.flyLeft&&(this.owner.colliding||(this.flyVec2.set_x(-this.throttle),this.flyVec2.set_y(0),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-up":function(){0!==this.flyUp&&(this.owner.colliding||(this.flyVec2.set_x(0),this.flyVec2.set_y(-this.throttle),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-down":function(){0!==this.flyDown&&(this.owner.colliding||(this.flyVec2.set_x(0),this.flyVec2.set_y(this.throttle),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"rotate-cw-start":function(){0!==this.rotateCW&&(""===e&&this.owner.parent.triggerEvent("boopMove"),e="rotate-cw")},"rotate-cw-end":function(){0!==this.rotateCW&&(this.owner.parent.triggerEvent("stop-audio","boopMove"),e="")},"rotate-ccw-start":function(){0!==this.rotateCCW&&(""===e&&this.owner.parent.triggerEvent("boopMove"),e="rotate-ccw")},"rotate-ccw-end":function(){0!==this.rotateCCW&&(this.owner.parent.triggerEvent("stop-audio","boopMove"),e="")},"rotate-arm-cw-start":function(){0!==this.rotateArmCW&&(""===e&&this.owner.parent.triggerEvent("armMove"),e="rotate-arm-cw")},"rotate-arm-cw-end":function(){0!==this.rotateArmCW&&(this.owner.parent.triggerEvent("stop-audio","armMove"),e="")},"rotate-arm-ccw-start":function(){0!==this.rotateArmCCW&&(""===e&&this.owner.parent.triggerEvent("armMove"),e="rotate-arm-ccw")},"rotate-arm-ccw-end":function(){0!==this.rotateArmCCW&&(this.owner.parent.triggerEvent("stop-audio","armMove"),e="")},"jump-start":function(){0!==this.jump&&this.owner.grounded&&(e="",this.jumpVec2.set_y(.85*-this.jump),this.jumpVec2.set_x(66*this.facingVal),this.owner.body.ApplyLinearImpulse(this.jumpVec2,this.owner.body.GetWorldCenter()),this.owner.jumping=!0,this.owner.parent.triggerEvent("jump"))},"super-jump-start":function(){0!==this.superJump&&this.owner.grounded&&(e="",this.superJumpVec2.set_y(.85*-this.superJump),this.superJumpVec2.set_x(400*this.facingVal),this.owner.body.ApplyLinearImpulse(this.superJumpVec2,this.owner.body.GetWorldCenter()),this.owner.jumping=!0,this.owner.parent.triggerEvent("superJump"))},"magnet-toggle":function(){0!==this.magnet&&(this.magnetOn=!this.magnetOn,this.magnetOn?this.owner.parent.triggerEvent("magnet-on",this.owner):this.owner.parent.triggerEvent("magnet-off",this.owner))},"beam-toggle":function(t){0!==this.beam&&(this.beamOn=!this.beamOn,t||(this.beamOn?this.owner.parent.triggerEvent("beam-on",this.owner):this.owner.parent.triggerEvent("beam-off",this.owner)))},"light-toggle":function(){this.lightOn=!this.lightOn,this.lightOn?this.owner.parent.triggerEvent("light-on"):this.owner.parent.triggerEvent("light-off")},"throttle-none":function(){0!==this.throttle&&(this.throttle=1e-7)},"throttle-low":function(){0!==this.throttle&&(this.throttle=8)},"throttle-med":function(){0!==this.throttle&&(this.throttle=13)},"throttle-high":function(){0!==this.throttle&&(this.throttle=18)},eject:function(){0!==this.eject&&this.owner.triggerEvent("eject-item",this.eject)},"handle-logic":function(){switch(this.magnetOn&&this.owner.parent.triggerEvent("magnet-on",this.owner),e){case"rotate-cw":this.owner.body.ApplyTorque(this.rotateCW),this.owner.grounded||this.owner.parent.triggerEvent("boop-cw");break;case"rotate-ccw":this.owner.body.ApplyTorque(-this.rotateCCW),this.owner.grounded||this.owner.parent.triggerEvent("boop-ccw");break;case"rotate-arm-cw":this.owner.body.ApplyTorque(this.rotateArmCW);break;case"rotate-arm-ccw":this.owner.body.ApplyTorque(-this.rotateArmCCW);break;case"move-right":this.owner.grounded?this.owner.body.ApplyForce(this.rightVec2,this.owner.body.GetWorldCenter()):this.owner.body.ApplyForce(this.rightVec2Air,this.owner.body.GetWorldCenter());break;case"move-left":this.owner.grounded?this.owner.body.ApplyForce(this.leftVec2,this.owner.body.GetWorldCenter()):this.owner.body.ApplyForce(this.leftVec2Air,this.owner.body.GetWorldCenter());break;case"fly-left":this.owner.body.ApplyForce(this.leftVec2,this.owner.body.GetWorldCenter())}}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ControlPanel",properties:{height:0,width:0,x:0,y:-1e3,div:50},publicProperties:{},initialize:function(){this.planTimeStart=Date.now(),this.runTimeStart=0,this.controlsActive=!1,this.aabb=t.setUp(),this.controls=Array.setUp(),this.matrix=Array.setUp(),this.c=1,this.cells=[],this.borderElements=[],this.oldX=0,this.oldY=0,this.colsNum=0,this.rowsNum=0,this.currentLevel="",this.currentSubGoal=null,this.sfxc=100,this.playerReady=!1,this.buttonsReady=null,this.cameraReady=!1,this.logicRan=!1,platypus.game.app.getHint=function(){return this.currentSubGoal?"hint-level17"+this.currentSubGoal:"hint-"+this.currentLevel}.bind(this)},events:{"buttons-are-ready":function(t){this.cameraReady?this.handleControlPlacement(t):this.buttonsReady=t||!0},"requesting-help":function(){var t="hint-"+this.currentLevel;this.currentSubGoal&&(t="hint-level17"+this.currentSubGoal),this.owner.parent.triggerEvent("show-mindy-panel",t)},"level-17-sub-goal":function(t){this.currentSubGoal=t},"scene-loaded":function(t){var e=this.owner.z;switch("string"==typeof t.level?this.currentLevel=t.level:this.currentLevel=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null}(t.level.properties,"levelId"),this.currentLevel){case"level-1":this.width=300,this.height=150,this.owner.bottom=100;break;case"level-2":this.width=350,this.height=150,this.owner.bottom=100;break;case"level-3":this.width=400,this.height=150,this.owner.bottom=100;break;case"level-4":case"level-5":case"level-6":case"level-7":this.width=500,this.height=150,this.owner.bottom=100;break;case"level-8":this.width=200,this.height=150,this.owner.bottom=100;break;case"level-9":case"level-10":this.width=200,this.height=200,this.owner.bottom=125;break;case"level-11":case"level-12":this.width=300,this.height=150,this.owner.bottom=100;break;case"level-13":this.width=200,this.height=150,this.owner.bottom=100;break;case"level-14":this.width=350,this.height=200,this.owner.bottom=125;break;case"level-15":this.width=400,this.height=150,this.owner.bottom=100;break;case"level-16":this.width=550,this.height=150,this.owner.bottom=100;break;case"level-17":this.width=500,this.height=150,this.owner.bottom=100;break;case"level-18":case"level-19":case"level-20":this.width=550,this.height=150,this.owner.bottom=100}this.owner.parent.triggerEvent("control-panel-width-set",this.width),this.colsNum=Math.round(this.width/this.div),this.rowsNum=Math.round(this.height/this.div);for(var i=0;i<this.colsNum;i++){for(var n=Array.setUp(),s=0;s<this.rowsNum;s++){n.push(0);var r=this.owner.parent.addEntity({id:"cell"+i+"_"+s,components:[{type:"RenderSprite",spriteSheet:"control-panel-cell",animationMap:{default:"default",active:"active"}}],properties:{x:this.owner.x+i*this.div-this.width/2+this.div/2,y:this.owner.y+s*this.div-this.height/2+this.div/2,z:e,scaleX:.5,scaleY:.5}});this.cells.push(r),r.opacity=.75}this.matrix.push(n)}this.oldX=this.owner.x,this.oldY=this.owner.y;var o=this.owner.parent.addEntity({id:"topLeft",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"topLeft"}}],properties:{x:this.owner.x-this.width/2-25,y:this.owner.y-this.height/2-25,z:e--,scaleX:.5,scaleY:.5}}),a=this.owner.parent.addEntity({id:"topRight",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"topRight"}}],properties:{x:this.owner.x+this.width/2,y:this.owner.y-this.height/2-25,z:e--,scaleX:.5,scaleY:.5}}),h=this.owner.parent.addEntity({id:"top",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"top"}}],properties:{x:this.owner.x-this.width/2,y:this.owner.y-this.height/2-25,z:e--,scaleX:this.width/50,scaleY:.5}}),l=this.owner.parent.addEntity({id:"leftBottom",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"leftBottom"}}],properties:{x:this.owner.x-this.width/2-25,y:this.owner.y+this.height/2,z:e--,scaleY:.5,scaleX:.5}}),c=this.owner.parent.addEntity({id:"rightBottom",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"rightBottom"}}],properties:{x:this.owner.x+this.width/2,y:this.owner.y+this.height/2,z:e--,scaleY:.5,scaleX:.5}}),p=this.owner.parent.addEntity({id:"left",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"left"}}],properties:{x:this.owner.x-this.width/2-25,y:this.owner.y-this.height/2,z:e--,scaleY:this.height/50,scaleX:.5}}),u=this.owner.parent.addEntity({id:"right",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"right"}}],properties:{x:this.owner.x+this.width/2,y:this.owner.y-this.height/2,z:e--,scaleY:this.height/50,scaleX:.5}}),d=this.owner.parent.addEntity({id:"bottom",components:[{type:"RenderSprite",spriteSheet:"control-panel-border",animationMap:{default:"bottom"}}],properties:{x:this.owner.x-this.width/2-10,y:this.owner.y+this.height/2,z:e--,scaleX:this.width/95,scaleY:.5}});this.borderElements.push(o),this.borderElements.push(a),this.borderElements.push(h),this.borderElements.push(p),this.borderElements.push(u),this.borderElements.push(l),this.borderElements.push(c),this.borderElements.push(d)},"position-updated":function(){for(var t=this.owner,e=this.owner.x-this.oldX,i=this.owner.y-this.oldY,n=0;n<this.cells.length;n++){var s=this.cells[n];s.x+=e,s.y+=i}for(n=0;n<this.borderElements.length;n++){var r=this.borderElements[n];r.x+=e,r.y+=i}this.oldX=this.owner.x,this.oldY=this.owner.y,this.aabb.setAll(t.x,t.y,this.width,this.height),this.cameraReady=!0,this.buttonsReady&&(this.handleControlPlacement(!0!==this.buttonsReady&&this.buttonsReady),this.buttonsReady=null)},"handle-logic":function(){this.sfxc>0&&this.sfxc--},"activate-controls":function(){for(var t=platypus.game.app,e=0;e<this.controls.length;e++){this.controls[e].activate()}for(e=0;e<this.cells.length;e++){var i=this.cells[e];i.opacity=1,i.state.set("active",!0)}this.playerReady||(this.playerReady=!0,this.owner.parent.parent.layers[1].triggerEvent("player-ready"));this.controlsActive||(this.controlsActive=!0,this.runTimeStart=Date.now(),t.googleAnalytics.event(t.name,"PlanTimeFinish-"+this.currentLevel,"PlanTime",this.runTimeStart-this.planTimeStart>>0))},"deactivate-controls":function(){for(var t=0;t<this.controls.length;t++){this.controls[t].deactivate()}for(t=0;t<this.cells.length;t++){var e=this.cells[t];e.opacity=.75,e.state.set("active",!1)}this.controlsActive&&(this.controlsActive=!1,this.owner.triggerEvent("run-time-ended"))},"run-time-ended":function(){var t=platypus.game.app;this.planTimeStart=Date.now(),t.googleAnalytics.event(t.name,"RunTimeFinish-"+this.currentLevel,"RunTime",this.planTimeStart-this.runTimeStart>>0)}},methods:{destroy:function(){this.aabb.recycle(),this.aabb=null,this.controls.recycle(),this.controls=null,this.matrix.recycle(),this.martix=null,this.cells=null,this.borderElements=null}},publicMethods:{collidesWith:function(t){return this.aabb.collides(t)},handleControlPlacement:function(t){this.owner.parent.triggerEvent("panel-exists",this.owner,t)},snapToGrid:function(t,e){var i=t.left,n=t.top,s=this.div,r=this.aabb.left%s,o=this.aabb.top%s;if(i=Math.round((i-r)/s)*s+t.width/2+r,n=Math.round((n-o)/s)*s+t.height/2+o,t.move(i,n),!this.aabb.contains(t))return[0,0];for(var a,h,l,c=Math.round((t.left-this.aabb.left)/s),p=Math.round((t.top-this.aabb.top)/s),u=!1,d=0;d<e.length;d++)h=c+(a=e[d])[0],l=p+a[1],1==this.matrix[h][l]&&(u=!0);return u?(platypus.game.app.userData.read("played-VO",function(t){null===t&&(t=[]);var e="doesntFit";-1==t.indexOf(e)&&(this.owner.parent.triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this)),[0,0]):(this.adjustMatrix(t,e,1),[i,n])},adjustMatrix:function(t,e,i){for(var n=Math.round((t.left-this.aabb.left)/this.div),s=Math.round((t.top-this.aabb.top)/this.div),r=0;r<e.length;r++){var o=e[r],a=n+o[0],h=s+o[1];this.matrix[a][h]=i}},addControl:function(t){this.controls.push(t);for(var e=!1,i=0;i<this.colsNum;i++)for(var n=0;n<this.rowsNum;n++)if(0===this.matrix[i][n]){e=!0;break}e||platypus.badger.increment("fill-control-panel")},removeControl:function(t){var e=this.controls.indexOf(t);e>-1&&this.controls.splice(e,1),0===this.sfxc&&this.owner.parent.triggerEvent("removeControl")}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ControlThrottle",properties:{name:""},initialize:function(){this.camera=t.setUp(),this.modes=["low","med","high"],this.mode="inactive",this.lastmode=""},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-down":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.owner.x,n=t&&"number"==typeof t.y?t.y:this.owner.y;e.analyticsEmitter.controlButtonEngaged(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},this.name,e.getRobotLocationForLAP()),this.switchMode(null)},"activate-controls":function(){""===this.lastmode?this.switchMode("low"):this.switchMode(this.lastmode)},"deactivate-controls":function(){this.lastmode=this.mode,this.switchMode("inactive")}},methods:{switchMode:function(t){var e=this.owner.parent.parent.layers[1];if(this.owner.state.set("throttle-"+this.mode,!1),null!==t){if(this.mode=t,"inactive"==t)return void this.owner.state.set("throttle-"+this.mode,!0)}else{var i=this.modes.indexOf(this.mode);++i==this.modes.length&&(i=0),this.mode=this.modes[i]}e.triggerEvent("throttle-"+this.mode),this.owner.state.set("throttle-"+this.mode,!0),this.owner.parent.triggerEvent("throttle")},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ControlToggle",properties:{name:"",toggleOnUp:!1},initialize:function(){this.camera=t.setUp(),this.on=!1,this.addEventListener("kill-"+this.name,function(t){this.on&&this.owner.parent.parent.layers[1].triggerEvent(this.name+"-toggle",t),this.toggle(!0)}),this.toggleOnUp&&this.addEventListener("pointer-up",function(){this.owner.parent.parent.layers[1].triggerEvent(this.name+"-toggle"),this.toggle()})},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-down":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.owner.x,n=t&&"number"==typeof t.y?t.y:this.owner.y;e.analyticsEmitter.controlButtonEngaged(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},this.name,e.getRobotLocationForLAP()),this.owner.parent.parent.layers[1].triggerEvent(this.name+"-toggle"),this.toggle()},"deactivate-controls":function(){this.on&&(this.owner.parent.parent.layers[1].triggerEvent(this.name+"-toggle"),this.on=!1,this.owner.state.set(this.name+"-inactive",!0),this.owner.state.set(this.name+"-pressed",!1))}},methods:{toggle:function(t){this.on=!this.on,t&&(this.on=!1),this.on?(this.owner.state.set(this.name+"-active",!1),this.owner.state.set(this.name+"-pressed",!0)):(this.owner.state.set(this.name+"-active",!0),this.owner.state.set(this.name+"-pressed",!1))},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"Conveyor",properties:{},publicProperties:{speed:-5},initialize:function(){var t=this.owner.state,e=t.get("reversed");this.simulationStarted=!1,"boolean"!=typeof e?t.set("reversed",!1):e&&(this.speed=-this.speed)},events:{"handle-logic":function(){var t=this.owner,e=!1,i=t.state;!this.simulationStarted&&t.pointA&&t.pointB&&(e=t.pointB.x-t.pointA.x<0)!==i.get("reversed")&&(i.set("reversed",e),this.speed=-this.speed)},"prepare-for-simulation":function(){this.simulationStarted=!0},"convey-on-collision":function(t){this.simulationStarted&&t.contact.SetTangentSpeed(this.speed)}}})}(),function(){"use strict";platypus.createComponentClass({id:"EndLevelSprite",events:{"end-level-id":function(t){var e="LS_Jet2",i=-175;switch(t){case"level-8":case"level-9":case"level-10":case"level-11":case"level-12":case"level-13":case"level-14":e="LS_Boop",i=-150;break;case"level-15":case"level-16":case"level-17":case"level-18":case"level-19":case"level-20":e="LS_Spaceship",i=-150}this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:e,offsetY:i,offsetZ:1.5}))}},getAssetList:function(){return Array.setUp("assets/images/LS_Jet2.png","assets/images/LS_Spaceship.png","assets/images/LS_Boop.png")}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"FindMovables",properties:{useNodes:!1},initialize:function(){this.activeEntities=null},events:{"handle-logic":function(t){this.activeEntities=t.entities},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&(t.invalid=!0)},pointerdown:function(){for(var e=this.activeEntities,i=e.length,n=null;i--;)(n=e[i]).movable&&("number"!=typeof n.opacity&&(n.opacity=1),t.get(n).to({opacity:.01},250).to({opacity:1},250).to({opacity:.01},250).to({opacity:1},250).to({opacity:.01},250).to({opacity:1},250))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off")},"restore-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-on")}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Goal",properties:{name:""},publicProperties:{},initialize:function(){this.goalManager=null,this.makeStar=!1,this.starMade=!1,this.applesToBadge=3,this.total=this.hits=3,this.shakeC=0,this.shakeX=0,this.shakeY=0,this.hitCoolDown=0,this.lvl20Win=!1,this.suckForce=new t(0,0),this.spawnApple=!1},events:{adopted:function(){this.shakeX=this.owner.x,this.shakeY=this.owner.y},"prepare-logic":function(){this.spawnApple&&(this.spawnApple=!1,this.owner.parent.addEntity({type:"apple",properties:{x:1340,y:976,z:this.owner.z+1}})),this.makeStar&&(this.owner.parent.addEntity({type:"star",properties:{x:this.owner.x,y:this.owner.y-250,z:this.owner.z-1,eject:!0}}),this.makeStar=!1,this.owner.parent.triggerEvent("appleMakeStar")),this.shakeC&&(this.owner.x=this.shakeX+this.randRange(-1,1)*(this.shakeC/5),this.owner.y=this.shakeY+this.randRange(-1,1)*(this.shakeC/5),this.shakeC--,0===this.shakeC&&(this.owner.x=this.shakeX,this.owner.y=this.shakeY))},"handle-logic":function(e){if("satPart"==this.name)for(var i=0;i<e.entities.length;i++){var n=e.entities[i];if(n.type.indexOf("satPart")>-1){if(null===n.body)continue;if((l=n.x-this.owner.x,c=n.y-this.owner.y,l*l+c*c)<15e4){n.disconnected||n.disconnect();var s=this.owner.body.GetWorldCenter(),r=n.body.GetWorldCenter(),o=new t(s.get_x()-r.get_x(),s.get_y()-r.get_y()),a=o.Length(),h=3/(a*a);this.suckForce.set_x(o.get_x()*h),this.suckForce.set_y(o.get_y()*h*2),n.body.ApplyForce(this.suckForce,n.body.GetWorldCenter(),!0)}}}var l,c},"collide-with-trash":function(){this.goalManager.reportGoal("trash")&&this.owner.state.set(this.name+"Highlight",!0)},"collide-with-apple":function(){this.goalManager.reportGoal("apple");"level-5"==this.owner.parent.levelId&&(this.starMade||(this.makeStar=!0),this.starMade=!0,this.applesToBadge--,0===this.applesToBadge?(this.spawnApple=!0,platypus.badger.increment("all-apples-in-compost")):this.applesToBadge<0&&(this.spawnApple=!0))},"collide-with-satPart":function(){this.goalManager.reportGoal("satPart")&&this.owner.state.set(this.name+"Highlight",!0),this.owner.parent.triggerEvent("partToSat")},"boop-touch-other-side":function(){this.goalManager.reportGoal("boopNearSoil")},level20Win:function(){this.lvl20Win=!0},"collide-with-asteroidAttack":function(){var t=platypus.game.app;0!==this.shakeC||this.lvl20Win||(this.hits--,this.hits>0?this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",this.hits+"hit"):0===this.hits&&this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","break"),this.hits>=0&&(this.owner.parent.triggerEvent("satelliteHit"),this.shakeC=150,t.analyticsEmitter.hitByAsteroid(t.levelBot||"",t.levelNumber||0,this.total-this.hits)))},"collide-with-jet2":function(){this.goalManager.reportGoal("jet2")&&this.owner.state.set(this.name+"Highlight",!0)},"collide-with-boop":function(){this.goalManager.reportGoal("boop")&&this.owner.state.set(this.name+"Highlight",!0)},"collide-with-ship":function(){this.goalManager.reportGoal("ship")},"collide-with-ship-mars":function(){this.goalManager.reportGoal("shipMars")},"collide-with-bin":function(){this.goalManager.reportGoal("bin")},"collect-soil":function(){this.goalManager.reportGoal("soil")},"good-photo":function(){this.goalManager.reportGoal("photo")},"goal-manager-exists":function(t){this.goalManager=t}},methods:{destroy:function(){this.goalManager=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"GoalCounter",properties:{},publicProperties:{},initialize:function(){this.nums=[]},events:{"init-goal-counter":function(t){for(var e=0;e<t.length;e++){var i=t[e];switch(e){case 0:case 2:case 4:var n="";switch(i){case"soil":n="goal-soil";break;case"trash":n="goal-trash";break;case"satPart":n="goal-sat";break;case"boopNearSoil":n="boop";break;case"photo":n="goal-photo";break;case"trap":n="trap"}this.owner.parent.addEntity({id:"goal-item",components:[{type:"RenderSprite",spriteSheet:"inventoryItems",animationMap:{default:n}},{type:"ResizeSnapper",bottom:50+42*e,right:66}],properties:{scaleX:.66,scaleY:.66,z:this.owner.z}});break;case 1:case 3:case 5:var s=this.owner.parent.addEntity({id:"num"+e,components:[{type:"RenderSprite",spriteSheet:"levelNums",stateBased:!1,eventBased:!0},{type:"ResizeSnapper",bottom:66+42*(e-1),right:35}],properties:{z:this.owner.z+1,scaleX:.66,scaleY:.66}});s.triggerEvent("num-"+i),this.nums.push(s)}}},"update-goal-counter":function(i){var n=this.nums[i[0]],s=i[1];n.triggerEvent("num-"+s),t.get(n).to({scaleX:1.33,scaleY:1.33},150,e.sineOut).call(function(){t.get(n).to({scaleX:.66,scaleY:.66},150,e.sineIn).call(function(){}.bind(this))}.bind(this))}},methods:{destroy:function(){this.nums=null}},getAssetList:function(){return Array.setUp("assets/images/inventoryItems.png","assets/images/levelNums.png")}})}(),function(){"use strict";var t={"level-1":[{name:"jet2",count:1}],"level-2":[{name:"jet2",count:1}],"level-3":[{name:"jet2",count:1}],"level-4":[{name:"trash",count:5}],"level-5":[{name:"trash",count:2}],"level-6":[{name:"satPart",count:1}],"level-7":[{name:"satPart",count:2},{name:"trash",count:2}],"level-8":[{name:"boop",count:1}],"level-9":[{name:"soil",count:3}],"level-10":[{name:"photo",count:4}],"level-11":[{name:"satPart",count:9}],"level-12":[{name:"satPart",count:12}],"level-13":[{name:"boop",count:1}],"level-14":[{name:"satPart",count:6},{name:"soil",count:2},{name:"photo",count:2}],"level-15":[{name:"bin",count:1}],"level-16":[{name:"shipMars",count:1}],"level-17":[{name:"satPart",count:2},{name:"boopNearSoil",count:1},{name:"bin",count:1}],"level-18":[{name:"ship",count:1}],"level-19":[{name:"satPart",count:5}],"level-20":[{name:"trap",count:12}]};platypus.getObjectives=function(e){return t[e]},platypus.createComponentClass({id:"GoalManager",properties:{},publicProperties:{inventory:[],levelProgress:0},initialize:function(){this.goalA="",this.goalANum=0,this.goalB="",this.goalBNum=0,this.goalC="",this.goalCNum=0,this.complete=!1,this.hintC=0,this.hint="",this.inventoryReq="",this.c=10,this.instr=null,this.wheels=0,this.voc=0,this.supressHint=!1,this.firstTrash=!0,this.distanceGoal=0,platypus.game.app.getGoalProgress=function(){for(var e=["goalANum","goalBNum","goalCNum"],i="",n=t[this.owner.levelId],s="",r=n.length,o=[];r--;)i=e[r],s=n[r],o.push({name:s.name,current_count:s.count-this[i],total_count:s.count});return o}.bind(this)},events:{"scene-live":function(){var t="",e=.5,i=0;switch(this.owner.levelId){case"level-1":case"level-2":case"level-3":this.goalA="jet2",this.goalANum=1,t="background-earth",e=.5,i=this.owner.getEntitiesByType("rightArrow")[0].x;break;case"level-4":this.goalA="trash",this.goalANum=5,t="background-earth",e=.5;break;case"level-5":this.goalA="trash",this.goalANum=2,this.hint="hint-1",this.hintC=5400,t="background-earth",e=.5;break;case"level-6":this.goalA="satPart",this.goalANum=1,t="background-earth",e=.5;break;case"level-7":this.goalA="satPart",this.goalANum=2,this.goalB="trash",this.goalBNum=2,t="background-earth",e=.5;break;case"level-8":this.goalA="boop",this.goalANum=1,t="background-mars",e=.75,i=this.owner.getEntitiesByType("rightArrow")[0].x;break;case"level-9":this.goalA="soil",this.goalANum=3,t="background-mars",e=.75;break;case"level-10":this.goalA="photo",this.goalANum=4,t="background-mars",e=.75;break;case"level-11":this.goalA="satPart",this.goalANum=9,t="background-mars",e=.75;break;case"level-12":this.goalA="satPart",this.goalANum=12,t="background-mars",e=.75;break;case"level-13":this.goalA="boop",this.goalANum=1,t="background-mars-2",e=.66,i=this.owner.getEntitiesByType("rightArrow")[0].x;break;case"level-14":this.goalA="satPart",this.goalANum=6,this.goalB="soil",this.goalBNum=2,this.goalC="photo",this.goalCNum=2,t="background-mars-2",e=.66;break;case"level-15":this.goalA="bin",this.goalANum=1,t="background-space",e=1;break;case"level-16":this.goalA="shipMars",this.goalANum=1,t="background-space",e=1,i=this.owner.getEntitiesByType("mars")[0].x;break;case"level-17":this.goalA="satPart",this.goalANum=2,this.goalB="boopNearSoil",this.goalBNum=1,this.goalC="bin",this.goalCNum=1,t="background-space",e=1;break;case"level-18":this.goalA="ship",this.goalANum=1,t="background-space-2",i=this.owner.getEntitiesByType("ship")[0].y;break;case"level-19":this.goalA="satPart",this.goalANum=5,t="background-space-2";break;case"level-20":this.goalA="trap",t="background-space-2",this.goalANum=12}this.distanceGoal=i,platypus.game.app.music=t,platypus.game.app.musicInstance.volume=e,this.inventory=[];var n=this.owner.levelId.split("-")[1];platypus.game.app.userData.write("last-level-played",n);var s=[],r=["trash","soil","photo","satPart","trap","boopNearSoil"];r.indexOf(this.goalA)>-1&&(s.push(this.goalA),s.push(this.goalANum)),r.indexOf(this.goalB)>-1&&(s.push(this.goalB),s.push(this.goalBNum)),r.indexOf(this.goalC)>-1&&(s.push(this.goalC),s.push(this.goalCNum)),this.owner.parent.layers[2].triggerEvent("init-goal-counter",s)},"supress-hint":function(){this.supressHint=!0},"trash-trapped":function(){this.reportGoal("trap")&&this.owner.triggerEvent("level20Win")},"next-level":function(){"level-8"==this.owner.next?platypus.game.loadScene("menu"):platypus.game.loadScene("scene-level",{level:this.owner.next})},tick:function(){this.supressHint||this.hintC>0&&(this.hintC--,0===this.hintC&&this.owner.parent.layers[2].triggerEvent("show-mindy-panel",this.hint)),this.c>0&&(this.c--,0===this.c&&this.owner.triggerEvent("goal-manager-exists",this.owner)),this.voc>0&&this.voc--,this.distanceGoal&&(this.levelProgress=this.getDistanceProgress())}},methods:{getLevelProgress:function(){for(var e=["goalANum","goalBNum","goalCNum"],i=t[this.owner.levelId],n=i.length,s=0,r=0;n--;)s+=this[e[n]],r+=i[n].count;return(r-s)/r},getDistanceProgress:function(){var t=0,e=this.distanceGoal,i=platypus.game.app.getRobotLocationForLAP();return t="level-18"===this.owner.levelId?e-i.y:i.x,Math.max(0,Math.min(.95,t/e))}},publicMethods:{reportGoal:function(e){var i=platypus.game.app,n=t[this.owner.levelId];if("boopNearSoil"==e&&(this.wheels++,2!=this.wheels))return!1;if(!0===this.complete)return!0;var s=e==this.goalA||e==this.goalB||e==this.goalC;if(""!==this.inventoryReq&&(s=this.inventory.indexOf(this.inventoryReq)>-1),s){var r=0,o=(this.owner.parent.layers[3],!1),a=0;e===this.goalA?(this.goalANum--,r=this.goalANum,"level-17"===this.owner.levelId&&0===r&&(this.owner.parent.layers[2].triggerEvent("level-17-sub-goal","C"),this.owner.parent.layers[2].triggerEvent("show-mindy-panel","level17C"),o=!0)):e===this.goalB?(a=1,this.goalBNum--,r=this.goalBNum,"level-17"===this.owner.levelId&&0===r&&(this.owner.parent.layers[2].triggerEvent("level-17-sub-goal","B"),this.owner.parent.layers[2].triggerEvent("show-mindy-panel","level17B"),o=!0)):(a=2,this.goalCNum--,r=this.goalCNum),this.levelProgress=this.getLevelProgress(),this.goalANum<=0&&this.goalBNum<=0&&this.goalCNum<=0&&(this.complete=!0);["trash","soil","photo","satPart","trap","boopNearSoil"].indexOf(e)>-1&&this.owner.parent.layers[2].triggerEvent("update-goal-counter",[a,r]),i.analyticsEmitter.objectiveComplete(i.levelBot||"",i.levelNumber||0,{name:e,current_count:n[a].count-r,total_count:n[a].count},i.getEnlearnStopData((n[a].count-r)/n[a].count)),this.complete?("level-12"==this.owner.levelId&&this.owner.triggerEvent("level-12-end"),"level-16"==this.owner.levelId&&this.owner.triggerEvent("level-16-end"),this.owner.triggerEvent("begin-level-success-sequence"),this.owner.triggerEvent("rl-run-time-ended"),this.owner.parent.layers[2].triggerEvent("show-mindy-panel","levelEnd")):0===this.voc&&(r>0?("trash"==e&&(this.firstTrash?(this.firstTrash=!1,this.owner.parent.layers[2].triggerEvent("show-mindy-panel","pointOutProgress")):this.owner.parent.layers[2].triggerEvent("show-mindy-panel","moreTrash")),"satPart"==e&&("level-19"==this.owner.levelId?this.owner.parent.layers[2].triggerEvent("show-mindy-panel","moreSatPart2"):this.owner.parent.layers[2].triggerEvent("show-mindy-panel","moreSatPart")),"soil"==e&&this.owner.parent.layers[2].triggerEvent("show-mindy-panel","moreSoil")):o||this.owner.parent.layers[2].triggerEvent("show-mindy-panel","stillMore"),this.voc=500)}return this.complete}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e={};platypus.createComponentClass({id:"Hand",properties:{ship:null},publicProperties:{},initialize:function(){this.remove=!1,this.grabbing=!1,this.suckForce=new t(0,0),this.segments=[],this.joints=[],this.grabJoint=null,this.toGrab=null,this.thingThatsGrabbed=null,this.retracting=!1,this.releaseGrabbed=!1,this.shown=!1,this.removeJoint=!1},events:{adopted:function(){var e=new t(.2*(this.owner.x-this.ship.x),.2*(this.owner.y-this.ship.y));this.owner.body.ApplyLinearImpulse(e,this.owner.body.GetWorldCenter()),this.createSegments(),this.owner.state.set("open",!0),this.owner.parent.triggerEvent("boing")},"handle-logic":function(){if(!this.grabbing){var e=this.owner.body.GetWorldCenter(),i=this.ship.body.GetWorldCenter(),n=new t(i.get_x()-e.get_x(),i.get_y()-e.get_y()),s=n.Length(),r=5*this.owner.body.GetMass()*7/(s*s);this.suckForce.set_x(n.get_x()*r),this.suckForce.set_y(n.get_y()*r),this.owner.body.ApplyForce(this.suckForce,this.owner.body.GetWorldCenter(),!0)}this.owner.orientation=Math.atan2(this.owner.y-this.ship.y,this.owner.x-this.ship.x),this.shown||(this.shown=!0,this.owner.opacity=1);for(var o=0;o<this.segments.length;o++){var a,h,l=this.segments[o];o==this.segments.length-1?(a=this.segments[o-1],h=this.ship):0===o?(a=this.owner,h=this.segments[o+1]):(a=this.segments[o-1],h=this.segments[o+1]),l.orientation=Math.atan2(a.y-h.y,a.x-h.x),l.scaleX=(c=a.x-h.x,p=a.y-h.y,Math.sqrt(c*c+p*p)/150)}var c,p},"collide-with-asteroid":function(){this.owner.parent.triggerEvent("handHitAsteroid")},"prepare-logic":function(){if(null!==this.toGrab&&(this.grabJoint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:0},length:10},this.toGrab,1),this.thingThatsGrabbed=this.toGrab,this.toGrab=null,this.grabbing=!0,this.owner.state.set("open",!1),this.owner.state.set("close",!0),this.owner.parent.triggerEvent("handGrab")),this.remove){for(var t=0;t<this.segments.length;t++)this.owner.parent.removeEntity(this.segments[t]);return this.owner.parent.removeEntity(this.owner),void(this.remove=!1)}this.releaseGrabbed&&(this.removeJoint&&this.owner.removeJoint(this.grabJoint),this.grabbing=!1,this.retracting=!0,this.releaseGrabbed=!1,this.owner.state.set("open",!0),this.owner.state.set("close",!1))},"collide-with-trash":function(t){this.grabbing||this.retracting||this.remove||(this.toGrab=t.entity)},"collide-with-ship":function(t){this.grabbing||(this.remove=!0,this.retracting=!1,this.ship.handReturn())},"ship-hit-asteroid":function(){var t=platypus.game.app,i="lostPart";this.grabbing?(this.releaseGrabbed=!0,this.removeJoint=!0,this.owner.parent.triggerEvent("losePart"),e[i]||(this.owner.parent.triggerEvent("show-mindy-panel",i),e[i]=!0),t.analyticsEmitter.droppedItem(t.levelBot||"",t.levelNumber||0,t.getRobotLocationForLAP(),this.thingThatsGrabbed.type)):(this.remove=!0,this.retracting=!1,this.ship.handReturn())},hand:function(){this.grabbing&&(this.releaseGrabbed=!0,this.removeJoint=!1)}},methods:{destroy:function(){this.ship=null,this.suckForce=null,this.segments=null,this.joints=null},createSegments:function(){for(var t=(this.owner.x-this.ship.x)/10,e=(this.owner.y-this.ship.y)/10,i=1;i<=10;i++){var n=this.owner.parent.addEntity({type:"armSegment",properties:{x:this.owner.x-t*i,y:this.owner.y-e*i,z:this.owner.z-1}}),s=null,r=null,o=0,a=0,h=20,l=!1;1==i?(s=this.owner,r=n,o=-1,a=0,h=10):(s=n,r=this.segments[this.segments.length-1],10==i&&(l=!0));var c=s.createJoint("distance",{localAnchorA:{x:0+o,y:0+a},localAnchorB:{x:0,y:0},length:h,dampingRatio:.1,frequencyHz:4},r,1);this.joints.push(c),l&&(s=n,r=this.ship,c=s.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:0},length:30,dampingRatio:.7,frequencyHz:10},r,1),this.joints.push(c)),this.segments.push(n)}}},publicMethods:{scaleX:.66,scaleY:.66}})}(),function(){"use strict";var t={};platypus.createComponentClass({id:"HintSensor",properties:{hintID:0},initialize:function(){},events:{activate:function(){var e="hint-"+this.hintID;t[e]||(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),t[e]=!0)}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"Instructions",properties:{customText:null},initialize:function(){this.c=1e3,this.tweening=!1,this.originY=-360,this.originYwithCC=-345,this.destroyed=!1},events:{"scene-live":function(){var t=this.owner.parent.parent.layers[1].levelId,e="";switch(t){case"level-1":e="Level 1: On The Move";break;case"level-2":e="Level 2: Jump it!";break;case"level-3":e="Level 3: Construction Crossing";break;case"level-4":e="Level 4: Park Patrol";break;case"level-5":e="Level 5: Tree Trash";break;case"level-6":e="Level 6: A Mysterious Object";break;case"level-7":e="Level 7: Jet2's Big Job";break;case"level-8":e="Level 8: Boop's Journey";break;case"level-9":e="Level 9: Soil Sampler";break;case"level-10":e="Level 10: Picture Perfect";break;case"level-11":e="Level 11: Satellite Blues";break;case"level-12":e="Level 12: Raining Parts!";break;case"level-13":e="Level 13: Boop-Olympics!";break;case"level-14":e="Level 14: Boop's Final Mission";break;case"level-15":e="Level 15: Back To Earth";break;case"level-16":e="Level 16: Bound For Mars";break;case"level-17":e="Level 17: Mars Missions";break;case"level-18":e="Level 18: To The Satellite!";break;case"level-19":e="Level 19: Helping Hands";break;case"level-20":e="Level 20: The Protector"}this.owner.triggerEvent("set-text",e),this.owner.parent.triggerEvent("show-mindy-panel","begin-"+t),this.show()},adopted:function(){null!==this.customText&&this.owner.triggerEvent("set-text",this.customText)}},methods:{destroy:function(){this.destroyed=!0},show:function(){var i=platypus.game.app.voPlayer.captions.mute?this.originY:this.originYwithCC;this.tweening=!0,this.owner.y=this.originY-120,t.get(this.owner).wait(500).to({y:i},500,e.sineOut).call(function(){this.tweening=!1,this.owner.top=0}.bind(this)).wait(3e3).to({y:this.originY-120},500,e.sineOut).call(function(){this.tweening=!1,this.owner.top=-120,this.destroyed||this.owner.parent.removeEntity(this.owner)}.bind(this))}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"Inventory",properties:{},publicProperties:{},initialize:function(){this.inventory=[],this.inventoryEnts=[]},events:{"scene-live":function(){},"add-to-inventory":function(i){var n=platypus.game.app,s=i.type,r=300+50*this.inventory.length,o=this.owner.parent.addEntity({id:"inventory-item",components:[{type:"RenderSprite",spriteSheet:"inventoryItems",animationMap:{default:s}},{type:"ResizeSnapper",top:40,left:350+55*this.inventory.length}],properties:{scaleX:.5,scaleY:.5,x:r,y:70,z:this.owner.z+this.inventory.length+1}});this.inventory.push(s),this.inventoryEnts.push(o),n.analyticsEmitter.inventoryAdded(n.levelBot||"",n.levelNumber||0,s,{x:i.x>>0,y:i.y>>0},this.inventory),t.get(o).to({scaleX:1,scaleY:1},150,e.sineOut).to({scaleX:.5,scaleY:.5},150,e.sineIn)},"remove-from-inventory":function(i){if(-1!=this.inventory.indexOf(i)){this.inventory.pop();var n=this.inventoryEnts.pop();t.get(n).to({scaleX:0,scaleY:0},250,e.sineOut).call(function(){this.owner.parent.removeEntity(n)}.bind(this))}}},methods:{destroy:function(){this.inventory=[],this.inventoryEnts=[]}},publicMethods:{}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),n=e?[]:[{type:"camera-flash"},{type:"magnifying-glass"},{type:"magnification-dialog"},{type:"magnification-dialog-blind"},{type:"badge-notifier"}];platypus.createComponentClass({id:"IOS935",events:{load:function(){for(var t=n.length,e=this.owner;t--;)e.addEntity(n[t])}},getAssetList:function(){for(var t=Array.setUp(),e=null,s=n.length;s--;)e=i.getAssetList(n[s]),t.union(e),e.recycle();return t}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase().indexOf("os 9_3_5")>=0,e=include("platypus.Entity"),i=t?[{type:"mindy-no-head"},{type:"right-no-panel"}]:[{type:"mindy-head"},{type:"right-panel"}];platypus.createComponentClass({id:"IOS935Alt",events:{load:function(){for(var t=i.length,e=this.owner;t--;)e.addEntity(i[t])}},getAssetList:function(){for(var t=Array.setUp(),n=null,s=i.length;s--;)n=e.getAssetList(i[s]),t.union(n),n.recycle();return t}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Jet2",properties:{npc:!1},publicProperties:{grounded:!1,facing:"R"},initialize:function(){this.originX=0,this.originY=0,this.groundContacts=0,this.groundContactsArray=[],this.activateJump=new t(0,-50),this.camLock=null,this.owner.normal=0,this.owner.walled=!1,this.body=null,this.head=null,this.arm1=null,this.arm2=null,this.arm1A=45,this.arm2A=45,this.arm1AC=0,this.arm2AC=0,this.suckFX=[],this.suckC=-1,this.facingVal=1,this.mag=!1,this.ejectFX=[],this.ejectC=0,this.noteFX=[],this.noteC=0,this.cornerLand=!1,this.npc||(platypus.game.app.getRobotLocationForLAP=function(){return{x:this.owner.x>>0,y:this.owner.y>>0}}.bind(this))},events:{adopted:function(){this.npc||(this.camLock=this.owner.parent.addEntity({type:"camLock",properties:{target:this.owner,x:this.owner.x,y:this.owner.y,levelId:this.owner.parent.levelId}}),this.originX=this.owner.x,this.originY=this.owner.y),this.owner.state.set("idle",!0),this.body=this.owner.parent.addEntity({id:"jetBody",components:[{type:"RenderSprite",spriteSheet:"jet2",animationMap:{default:"body"}}],properties:{x:this.owner.x,y:this.owner.y-55,z:this.owner.z+1,scaleX:.35,scaleY:.35}}),this.head=this.owner.parent.addEntity({id:"jetHead",components:[{type:"RenderSprite",spriteSheet:"jet2",animationMap:{default:"head",light:"headLight"}}],properties:{x:this.owner.x,y:this.owner.y-140,z:this.owner.z+2,scaleX:.35,scaleY:.35}}),this.arm1=this.owner.parent.addEntity({id:"jetHead",components:[{type:"RenderSprite",spriteSheet:"jet2",rotate:!0,animationMap:{default:"arm1"}}],properties:{x:this.owner.x,y:this.owner.y-100,z:this.owner.z+2,scaleX:.35,scaleY:.35}}),this.arm2=this.owner.parent.addEntity({id:"jetHead",components:[{type:"RenderSprite",spriteSheet:"jet2",rotate:!0,animationMap:{default:"arm2"}}],properties:{x:this.owner.x,y:this.owner.y-100,z:this.owner.z-2,scaleX:.35,scaleY:.35}})},"magnet-on":function(t){this.mag||this.owner.parent.triggerEvent("vacuumLoop"),this.mag=!0},"magnet-off":function(t){for(var e in this.mag=!1,this.suckFX){var i=this.suckFX[e];this.owner.parent.removeEntity(i)}this.suckFX=[],this.owner.parent.triggerEvent("stop-audio","vacuumLoop")},"activate-controls":function(){this.owner.body.ApplyLinearImpulse(this.activateJump,this.owner.body.GetWorldCenter()),platypus.game.app.userData.read("played-VO",function(t){null===t&&(t=[]);var e="tutorial-3";-1==t.indexOf(e)&&(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this))},"collide-with-apple":function(e){"level-7"==this.owner.parent.levelId&&Math.abs(e.contact.GetManifold().get_localNormal().get_x())<1&&this.owner.jumping&&(this.owner.body.ApplyLinearImpulse(new t(0,-400)),this.owner.parent.triggerEvent("boing"))},"collide-with-ground":function(t){var e=t.contact.GetManifold().get_localNormal().get_x(),i=platypus.game.app,n=Math.abs(e)>=.75;t.contact.walled=n,n||(this.groundContactsArray.push(t.contact),this.grounded=this.groundContactsArray.length>0,this.grounded&&(this.owner.jumping&&(this.owner.parent.triggerEvent("thud"),i.analyticsEmitter.jumpIt(i.levelBot||"",i.levelNumber||0,{x:this.owner.x>>0,y:this.owner.y>>0})),this.owner.body.SetLinearDamping(5),this.owner.jumping=!1))},"end-collide-with-ground":function(t){var e=this.groundContactsArray.indexOf(t.contact);t.contact.walled||(e>-1&&this.groundContactsArray.splice(e,1),this.grounded=this.groundContactsArray.length>0,this.grounded||this.owner.body.SetLinearDamping(0))},"light-on":function(){this.head.state.set("light",!0),this.head.state.set("default",!1),this.owner.parent.triggerEvent("click")},"light-off":function(){this.head.state.set("light",!1),this.head.state.set("default",!0),this.owner.parent.triggerEvent("click")},"horn-start":function(){this.owner.parent.triggerEvent("horn",this.owner),this.owner.parent.triggerEvent("honkFX")},"whistle-start":function(){this.owner.parent.triggerEvent("whistle",this.owner),this.noteC=1,this.owner.parent.triggerEvent("whistleFX")},"jump-start":function(){this.owner.body.SetLinearDamping(0)},"eject-item":function(t){var e=platypus.game.app,i=this.owner.parent.inventory;if(this.owner.parent.parent.layers[2].triggerEvent("kill-magnet"),0!==i.length){var n=i.pop();this.owner.parent.addEntity({type:n,properties:{ejectSpeed:t*this.owner.scaleX*2,x:this.owner.x+150*this.owner.scaleX,y:this.owner.y-100,z:this.owner.z+1,reportEjectionCollision:!0}}),this.owner.parent.parent.layers[3].triggerEvent("remove-from-inventory",n),e.analyticsEmitter.chestLaunch(e.levelBot||"",e.levelNumber||0,{x:this.owner.x>>0,y:this.owner.y>>0});for(var s=0;s<10;s++){var r="R"==this.facing?35-12*s:125+12*s,o=this.randRange(.5,.1),a=this.owner.parent.addEntity({id:"suckFX",components:[{type:"RenderSprite",spriteSheet:"fx",rotate:!0,animationMap:{default:"suck"}}],properties:{x:this.owner.x+35*this.facingVal,y:this.owner.y-(40+2*s),z:this.owner.z,scaleX:.5,rotation:r,opacity:.5,speedX:3*Math.cos(r*(Math.PI/180))*o,speedY:3*Math.sin(r*(Math.PI/180))*o}});this.ejectFX.push(a)}}},"suckable-touch-jet2":function(t){var e=platypus.game.app,i=this.owner.parent.parent.layers[3];this.owner.parent.inventory.push(t.type),i.triggerEvent("add-to-inventory",t),e.analyticsEmitter.chestVacuum(e.levelBot||"",e.levelNumber||0,{x:this.owner.x>>0,y:this.owner.y>>0}),platypus.game.app.userData.read("played-VO",function(t){null===t&&(t=[]);var e="trash-collect";-1==t.indexOf(e)&&(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this)),"satPartTree"==t.type&&(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel","story-1"),this.owner.parent.triggerEvent("scanner"))},"right-end":function(){this.owner.state.set("move",!1),this.owner.state.set("idle",!0),this.owner.parent.triggerEvent("stop-audio","jetMove")},"left-end":function(){this.owner.state.set("move",!1),this.owner.state.set("idle",!0),this.owner.parent.triggerEvent("stop-audio","jetMove")},"right-start":function(){this.owner.scaleX=.4,this.head.scaleX=.35,this.body.scaleX=.35,this.arm1.scaleX=.35,this.arm2.scaleX=.35,this.facing="R",this.facingVal=1,this.owner.state.set("move",!0),this.owner.state.set("idle",!1),this.arm1.rotation="R"==this.facing?this.arm1A:360-this.arm1A,this.arm2.rotation="R"==this.facing?this.arm2A:360-this.arm2A,this.owner.parent.triggerEvent("jetMove")},"left-start":function(){this.owner.scaleX=-.4,this.head.scaleX=-.35,this.body.scaleX=-.35,this.arm1.scaleX=-.35,this.arm2.scaleX=-.35,this.facing="L",this.facingVal=-1,this.owner.state.set("move",!0),this.owner.state.set("idle",!1),this.arm1.rotation="R"==this.facing?this.arm1A:360-this.arm1A,this.arm2.rotation="R"==this.facing?this.arm2A:360-this.arm2A,this.owner.parent.triggerEvent("jetMove")},"after-box2d-update":function(){this.body.x=this.owner.x,this.body.y+=.5*(this.owner.y-55-this.body.y),this.head.x=this.owner.x,this.head.y+=.5*(this.body.y-85-this.head.y),this.arm1.x=this.owner.x,this.arm1.y=this.body.y-15,this.arm2.x=this.owner.x,this.arm2.y=this.body.y-15,this.arm1A+=(this.owner.y-55-this.body.y+80-this.arm1A)/10,this.arm2A+=(this.owner.y-55-this.body.y+65-this.arm2A)/15,this.arm1.rotation="R"==this.facing?this.arm1A:360-this.arm1A,this.arm2.rotation="R"==this.facing?this.arm2A:360-this.arm2A},"handle-logic":function(){var e,i=this.owner.body.GetLinearVelocity();if(this.grounded&&(i.get_x()>15&&(i.set_x(15),this.owner.body.SetLinearVelocity(i)),i.get_x()<-15&&(i.set_x(-15),this.owner.body.SetLinearVelocity(i))),i.get_y()<-40&&(i.set_y(-40),this.owner.body.SetLinearVelocity(i)),this.owner.jumping&&Math.abs(this.owner.body.GetLinearVelocity().get_x())<10&&this.owner.body.ApplyForce(new t(50*this.owner.scaleX,0),this.owner.body.GetWorldCenter()),this.owner.state.get("move")?(this.arm1AC+=.0066,this.arm1A+=.5*Math.cos(this.arm1AC),this.arm2AC+=.0033,this.arm2A+=.4*Math.cos(this.arm2AC)):(this.arm1AC+=.0033,this.arm1A+=.15*Math.cos(this.arm1AC),this.arm2AC+=.0015,this.arm2A+=.1*Math.cos(this.arm2AC)),this.mag){if(this.suckC++,this.suckC%5==0&&this.suckFX.length<10){var n=this.owner.y-this.randRange(0,80),s=this.owner.parent.addEntity({id:"suckFX",components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"suck"}}],properties:{x:this.owner.x+this.randRange(75,150)*this.facingVal,y:n,z:this.owner.z,scaleX:this.randRange(.3,.6),scaleY:.66,opacity:.15,speedX:0,speedY:.01*(this.owner.y-40-n)}});this.suckFX.push(s)}for(e in this.suckFX){var r=this.suckFX[e];r.x-=r.speedX,r.y+=r.speedY,r.speedX+=.05*this.facingVal,r.scaleX-=.001,r.opacity+=.01;("R"==this.facing?r.x<this.owner.x+25:r.x>this.owner.x-25)&&(r.x=this.owner.x+this.randRange(75,150)*this.facingVal,r.scaleX=this.randRange(.3,.6),r.opacity=.1,r.speedX=0,r.y=this.owner.y-this.randRange(0,80),r.speedY=.01*(this.owner.y-40-r.y))}}if(this.noteC>0){if(this.noteC++,this.noteC%12==0&&this.noteC<40){var o=this.owner.parent.addEntity({id:"noteFX",components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"note"+Math.round(this.randRange(1,3))}}],properties:{x:this.owner.x+50*this.facingVal,y:this.owner.y-120,z:this.owner.z,scaleX:.75,scaleY:.75,opacity:1,speedY:this.randRange(-.25,-.5),speedX:this.randRange(0,.04)*this.facingVal,oscC:0,oscCI:this.randRange(-.01,.01)}});this.noteFX.push(o)}for(e in this.noteFX){var a=this.noteFX[e];a.oscC+=a.oscCI,a.x+=a.speedX+.5*("L"==this.facing?Math.sin(a.oscC):Math.cos(a.oscC)),a.y+=a.speedY,a.opacity-=.002,a.opacity<=0&&this.owner.parent.removeEntity(a)}}var h=!1;if(this.ejectFX.length>0)for(var l in this.ejectC++,h=this.ejectC>200,this.ejectFX){var c=this.ejectFX[l];c.x+=c.speedX,c.y+=c.speedY,c.opacity-=.0015,c.scaleX-=.0012,c.speedX*=.995,c.speedY*=.995}if(h){for(var p in this.ejectFX){var u=this.ejectFX[p];this.owner.parent.removeEntity(u)}this.ejectFX=[],this.ejectC=0}}},methods:{destroy:function(){this.activateJump=null,this.camLock=null,this.arm1=null,this.arm2=null,this.body=null,this.head=null,this.suckFX=null},randRange:function(t,e){return Math.random()*(e-t)+t}},getAssetList:function(){return Array.setUp("assets/images/fx.png")}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.helpers.getUserData"),i=Math.PI/4;platypus.createComponentClass({id:"JointWatcher",properties:{enactStress:!0,stressModifiers:null},publicProperties:{},initialize:function(){this.watchJoints=!1,this.jointClusters=Array.setUp(),this.stressSignals=Array.setUp(),this.stressSignalsToRemove=Array.setUp(),this.firstBreak=!0,this.firstPass=!0,this.usesAnchors=!1,this.stressModifiers?this.modify=this.modifiedStress.bind(this,this.stressModifiers):this.modify=this.unmodifiedStress.bind(this)},events:{"logic-tick":function(){var t=0,e=0;if(this.stressSignalsToRemove.length){for(t=this.stressSignalsToRemove.length-1;t>=0;t--)for(e=this.stressSignals.length-1;e>=0;e--)if(this.stressSignalsToRemove[t]===this.stressSignals[e]){this.owner.removeEntity(this.stressSignals.splice(e,1)[0]);break}this.stressSignalsToRemove.length=0}},"after-box2d-update":function(i,n){var s=0,r=0,o=0,a=null,h=null,l=null,c=null,p=null,u=null,d=[],g=null,y=null,m=null,v=0,f=1,w=0,b=0,x=0,E=null,A=null,C=0,S=0,k=null,B=null;if(this.enactStress&&this.watchJoints){for(s=this.jointClusters.length-1;s>=0;s--){for(a=this.jointClusters[s],h=t.setUp(),r=0;r<a.length;r++)c=(p=a[r]).joint,0===r&&(C=30*(c.GetAnchorA().get_x()+c.GetAnchorB().get_x())/2,S=30*(c.GetAnchorA().get_y()+c.GetAnchorB().get_y())/2,this.stressSignals.length&&(this.stressSignals[s].x=C,this.stressSignals[s].y=S)),h[p.entityA.id]||(h[p.entityA.id]=Array.setUp(0,0,0)),h[p.entityB.id]||(h[p.entityB.id]=Array.setUp(0,0,0)),"number"==typeof p.stressValues.angle&&(A=e(c),!this.firstPass||"piston-beam"!==p.entityA.type&&"piston-beam"!==p.entityB.type||(A.oAngle=c.GetJointAngle()),f=(v=c.GetJointAngle()-A.oAngle)>0?1:-1,"piston-beam"===p.entityA.type||"piston-beam"===p.entityB.type?c.SetMotorSpeed(Math.max(-.25,-10*Math.pow(v,2))*f):c.SetMotorSpeed(-20*f*Math.pow(v,2)),w=Math.min(Math.abs(v)/p.stressValues.angle,1),h[p.entityA.id][2]=Math.max(w,h[p.entityA.id][2]),h[p.entityB.id][2]=Math.max(w,h[p.entityB.id][2])),"number"==typeof p.stressValues.reaction&&(b=p.joint.GetReactionForce(1/n).Length(),b=Math.min(this.modify(b,p.entityA.jointType,p.stressValues.reaction),this.modify(b,p.entityB.jointType,p.stressValues.reaction),1),h[p.entityA.id][0]=Math.max(b,h[p.entityA.id][0]),h[p.entityB.id][0]=Math.max(b,h[p.entityB.id][0])),"number"==typeof p.stressValues.distance&&(x=Math.pow(c.GetAnchorA().get_x()-c.GetAnchorB().get_x(),2)+Math.pow(c.GetAnchorA().get_y()-c.GetAnchorB().get_y(),2),x/=p.stressValues.distance,x=Math.min(1,x),h[p.entityA.id][1]=Math.max(x,h[p.entityA.id][1]),h[p.entityB.id][1]=Math.max(x,h[p.entityB.id][1]));for(u in h)1!==h[u][0]&&1!==h[u][1]&&1!==h[u][2]||(d.push(u),this.firstBreak&&(this.firstBreak=!1,this.owner.triggerEvent("slo-mo"))),this.stressSignals.length&&this.stressSignals[s].triggerEvent("stress",Math.max(Math.max(h[u][2],h[u][0]),h[u][1]));for(l in h)h[l].recycle();for(h.recycle(),r=0;r<d.length;r++)for(g=d[r],o=a.length-1;o>=0;o--)y=a[o].entityA.id,m=a[o].entityB.id,y!==g&&m!==g||(k=a[o].entityA.type,B=a[o].entityB.type,"wheel"!==k&&"wheel-powered"!==k&&"wheel-small"!==k&&"rocket"!==k||a[o].entityA.state.set("axeled",!1),"wheel"!==B&&"wheel-powered"!==B&&"wheel-small"!==B&&"rocket"!==B||a[o].entityB.state.set("axeled",!1),this.owner.world.DestroyJoint(a[o].joint),a[o].entityA=null,a[o].entityB=null,a[o].joint=null,a.splice(o,1));d.length&&(this.owner.triggerEvent("play-break"),E={type:"explosion",properties:{x:C,y:S,z:3110}},this.owner.addEntity(E)),d=[],0===a.length&&(this.jointClusters.splice(s,1),this.stressSignals.length&&this.stressSignalsToRemove.push(this.stressSignals[s]))}this.firstPass=!1}},"simulation-started":function(){this.watchJoints=!0,this.usesAnchors&&this.owner.triggerEvent("uses-anchors")},"simulation-stopped":function(){var t=null,e=this.jointClusters,i=e.length,n=0,s=this.owner,r=this.stressSignals,o=this.stressSignalsToRemove,a=s.world;for(this.usesAnchors=!1;i--;)for(n=(t=e[i]).length;n--;)a.DestroyJoint(t[n].joint);for(i=r.length;i--;)o.push(r[i]);this.owner.triggerEvent("watched-joints-removed"),e.length=0,this.owner.triggerEvent("normal-mo"),this.watchJoints=!1,this.firstBreak=!0,this.firstPass=!0},"add-joint-cluster":function(t,n,s){var r=0,o=[],a=null,h=null,l=null,c=null;for("default"===n.angle&&(n.angle=i),"default"===n.reaction&&(n.reaction=60),"default"===n.distance&&(n.distance=.8),r=0;r<t.length;r++)o[r]={},o[r].stressValues=n,o[r].joint=t[r],o[r].entityA=e(t[r].GetBodyA()).entity,o[r].entityB=e(t[r].GetBodyB()).entity,l=o[r].entityA.type,c=o[r].entityB.type,"anchor"!==l&&"anchor"!==c||(this.usesAnchors=!0),"wheel"!==l&&"wheel-powered"!==l&&"wheel-small"!==l&&"rocket"!==l||o[r].entityA.state.set("axeled",!0),"wheel"!==c&&"wheel-powered"!==c&&"wheel-small"!==c&&"rocket"!==c||o[r].entityB.state.set("axeled",!0);o.length&&(this.jointClusters.push(o),s&&(a={type:"stress-signal",properties:{x:0,y:0,z:3020}},h=this.owner.addEntity(a),this.stressSignals.push(h)))}},methods:{destroy:function(){this.jointClusters.recycle(),this.jointClusters=null,this.stressSignals.recycle(),this.stressSignals=null,this.stressSignalsToRemove.recycle(),this.stressSignalsToRemove=null},modifiedStress:function(t,e,i,n){return e/(n*(t[i]||1))},unmodifiedStress:function(t,e,i){return t/i}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPActionButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},pressed:function(t){this.toggle(t,!0)},released:function(t){this.toggle(t,!1)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{toggle:function(t,e){var i=platypus.game.app,n=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;i.analyticsEmitter.togglePowerButton(i.levelBot||"",i.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0},i.getRobotLocationForLAP(),platypus.getButtonLayout(),e)},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPBadgeButton",properties:{lapEvent:""},publicProperties:{name:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y,s=platypus.badger.getBadgeStatusForLAP(this.name);e.analyticsEmitter[this.lapEvent](e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},s)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPDwellTimer",publicProperties:{hover:!0},initialize:function(){this.camera=t.setUp(),this.time=-1,this.x=0,this.y=0,this.xs=0,this.ys=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(t){var e=t.delta;this.time>=0&&(this.time+=e,this.xs+=this.x*e,this.ys+=this.y*e)},pointerover:function(t){this.time=0,this.x=t.x,this.y=t.y,this.ys=0,this.xs=0},pointermove:function(t){this.x=t.x,this.y=t.y},pointerout:function(t){var e=platypus.game.app;t&&t.event&&"mouse"===t.event.pointerType&&this.time>=1e3&&e.analyticsEmitter.dwellTime(e.levelBot||"",e.levelNumber||0,this.time>>0,this.owner.type,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.xs/this.time-this.camera.left>>0,y:this.ys/this.time-this.camera.top>>0}),this.time=-1}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPHelpButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},e.getGoalProgress(),e.getHint(),e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPJournalButton",initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=platypus.game.app.config.journal,n=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,r={stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0};e.userData.read(i.storageKey,function(t,n){var s=0,r=i.maxSavesPerGame,o=0;for(s=0;s<r;s++)n&&n[s]&&(o+=1);e.analyticsEmitter.viewSavedGames(e.levelBot||"",e.levelNumber||0,t,o)}.bind(this,r))},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPPointerEvent",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPRecycleButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.startTime=Date.now()},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app;e.analyticsEmitter[this.lapEvent](e.levelBot||"",e.levelNumber||0,Date.now()-this.startTime,platypus.getButtonLayout(),{unlocked_levels:[],badges_earned:[]},e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSavedGame",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},+this.owner.persistentData.level.split("-")[1],this.owner.totalSaves)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPScrollButton",initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.coords=null},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=t&&"number"==typeof t.x?t.x:this.x,i=t&&"number"==typeof t.y?t.y:this.y;this.coords={stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:e-this.camera.left>>0,y:i-this.camera.top>>0}},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y},"new-scroll-position":function(t){var e=platypus.game.app;this.coords&&(e.analyticsEmitter.scrollin(e.levelBot||"",e.levelNumber||0,this.coords,["Earth","Mars","Space"][t]),this.coords=null)}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=["","jet-2","jet-2","jet-2","jet-2","jet-2","jet-2","jet-2","boop","boop","boop","boop","boop","boop","boop","spaceship","spaceship","spaceship","spaceship","spaceship","spaceship"],e=include("platypus.AABB");platypus.createComponentClass({id:"LAPSelectLevel",properties:{lapEvent:"",lapLevel:""},initialize:function(){this.camera=e.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(e){var i=platypus.game.app,n=e&&"number"==typeof e.x?e.x:this.x,s=e&&"number"==typeof e.y?e.y:this.y,r=+this.lapLevel.substring(this.lapLevel.lastIndexOf("-")+1)||0;i.analyticsEmitter[this.lapEvent](t[r]||"",r||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=["","jet-2","jet-2","jet-2","jet-2","jet-2","jet-2","jet-2","boop","boop","boop","boop","boop","boop","boop","spaceship","spaceship","spaceship","spaceship","spaceship","spaceship"],e=include("platypus.AABB"),i=Date.now().toString(16);platypus.createComponentClass({id:"LevelCompleter",properties:{},publicProperties:{levelId:"",levelProgress:0,next:""},initialize:function(){var t=platypus.game.app;this.alreadyAttempted=!1,this.camera=e.setUp(),this.completedLevels=platypus.completedLevels,t.getLayout=function(){return function(t,e){for(var i=null,n=null,s=t.length,r=[],o=[],a=[],h={fixed_objects:r,movable_objects:o,player_placed_objects:a};s--;)(i=t[s]).destroyed||(n={name:i.type,position:{x:i.x-e.left>>0,y:i.y-e.top>>0,kitchen_w:e.width>>0,kitchen_h:e.height>>0}},i.savable?a.push(n):i.movable?o.push(n):r.push(n));return h}(this.owner.entities,this.camera)}.bind(this),t.getEnlearnStopData=function(t){return function(t,e,i){for(var n=null,s=e.length,r=[],o=[];s--;)(n=e[s]).inPanel&&o.push({part_type:n.type,mini_game:n.miniGame||t.name,location:"number"==typeof n.x&&"number"==typeof n.y?{x:n.x,y:n.y}:null});return 0===r.length&&r.push(t.levelId+"-obstacle"),t.getEnlearnData({obstacle_types:r,parts:o,score:i})}(platypus.game.app,this.owner.parent.layers[2].entities.greenSlice(),t)}.bind(this),this.roundTime=Date.now(),this.testTime=0,this.buildTime=0,this.failedAttempts=0,this.badgesEarned=[],this.savedGame=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"scene-loaded":function(t){var e=t.level;this.savedGame="string"!=typeof e},"world-loaded":function(){var e=platypus.game.app;e.levelId=this.levelId||"unspecified",e.levelInstanceId=(this.levelId||"unspecified")+"-"+Date.now().toString(16),e.levelNumber=+this.levelId.substring(this.levelId.lastIndexOf("-")+1)||0,e.levelBot=t[e.levelNumber],e.getEnlearnData=function(t){var n="",s={mini_game_instance_id:i,level_id:e.levelId,level_instance_id:e.levelInstanceId};if(t)for(n in t)t.hasOwnProperty(n)&&(s[n]=t[n]);return s},e.analyticsEmitter.startRound(e.levelBot||"",e.levelNumber||0,platypus.getButtonLayout(),e.getResources(),platypus.getObjectives(e.levelId),this.savedGame,e.getEnlearnData()),e.googleAnalytics.event(e.name,"Enter-"+e.levelId),this.buildTime=Date.now()},"begin-level-success-sequence":function(){var t,e=platypus.badger,i=this.levelId,n=this.owner,s=n.parent.app,r=s.userData,o=this.lastSuccess,a=0;if(e.increment("completed-"+s.name+"-"+i),this.alreadySecondSuccessed||e.badges.app[7].completed||(this.lastSuccess=JSON.stringify(this.owner.getSavedLevel()),o&&this.lastSuccess!==o&&(e.increment("second-success"),this.alreadySecondSuccessed=!0)),"level-15"!==i&&"level-16"!==i&&"level-17"!==i&&"level-18"!==i&&"level-19"!==i&&"level-20"!==i||e.increment("completed-mission-control-spaceship-level"),(t=e.award())&&t.length){for(a=t.length;a--;)this.badgesEarned.push(t[a].name);this.owner.triggerEvent("rl-earned-badge",t)}n.triggerEvent("rl-show-level-complete-dialog"),n.parent.layers[3].triggerEvent("end-level-id",i),this.completedLevels.includes(i)||(this.completedLevels.push(i),this.unlockedALevel=!0,r.write("Completed-Levels",this.completedLevels)),r.write("Recently-Completed-Level",i),"menu"===this.next?(n.triggerEvent("rl-set-next-scene","menu"),n.triggerEvent("rl-set-next-scene-data",{winGame:!0})):"level-select"===this.next?(n.triggerEvent("rl-set-next-scene","level-select"),n.triggerEvent("rl-set-next-scene-data",{winSection:"level-7"===i?1:2})):(n.triggerEvent("rl-set-next-scene","scene-level"),n.triggerEvent("rl-set-next-scene-data",{level:this.next})),this.owner.triggerEvent("winLevel")},"round-ended":function(){this.roundEnded(!0)},"round-ended-home":function(){this.roundEnded(!1)}},methods:{roundEnded:function(t){var e=platypus.game.app,i=Date.now()-this.roundTime>>0,n=+this.levelId.split("-")[1],s=[];this.unlockedALevel&&n<20&&s.push("level-"+(n+1)),e.analyticsEmitter[t?"endRound":"endRoundHome"](e.levelBot||"",e.levelNumber||0,Date.now()-this.roundTime>>0,platypus.getButtonLayout(),{unlocked_levels:s,badges_earned:this.badgesEarned}),e.googleAnalytics.event(e.name,(t?"Complete-":"Abandon-")+e.levelId,"LevelTime",i)},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.Entity");platypus.createComponentClass({id:"LevelSelectManager",properties:{levelButtonData:[]},publicProperties:{},initialize:function(t,e){var i=2;return this.recentlyCompleted="",this.newUnlocks=[],this.progress=null,this.stars=null,this.recentlyCompletedLevel=null,this.progress=platypus.completedLevels,this.owner.parent.app.userData.read("Recently-Completed-Level",function(t){this.recentlyCompletedLevel=t,0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Stars",function(t){null===t&&(t=[]),this.stars=t,0===--i&&e()}.bind(this)),!0},events:{"ls-scroll-right":function(){},"populate-level-buttons":function(t){var e=platypus.game.app,i=0,n=0,s=null,r=null,o=0,a=!0,h=!1,l=!1;for(i=0;i<this.levelButtonData.length;i++)if(s=this.owner.addEntity({type:this.levelButtonData[i].buttonType||"level-button",properties:{lapLevel:this.levelButtonData[i].level,x:this.levelButtonData[i].x,y:this.levelButtonData[i].y}}),r=this.owner.addEntity({id:"levelNum"+i,components:[{type:"RenderSprite",spriteSheet:"levelNums",animationMap:{default:"num-"+(i+1)}},{type:"LevelSelectScrollable"}],properties:{x:this.levelButtonData[i].x-50,y:this.levelButtonData[i].y-50,z:100,scaleX:1.25,scaleY:1.25}}),s.triggerEvent("ls-jump2",t),s.triggerEvent("set-persistent-scene-data",{level:this.levelButtonData[i].level}),r.triggerEvent("ls-jump2",t),a=!0,h=!1,this.progress&&(l=this.progress.indexOf(this.levelButtonData[i].level)>-1),l)o+=1,s.triggerEvent("enable"),s.triggerEvent("complete-level",this.stars.indexOf(this.levelButtonData[i].level)>-1);else{if(this.levelButtonData[i].toUnlock)for(n=0;n<this.levelButtonData[i].toUnlock.length;n++)this.progress&&-1!==this.progress.indexOf(this.levelButtonData[i].toUnlock[n])?this.levelButtonData[i].toUnlock[n]===this.recentlyCompletedLevel&&(h=!0):a=!1;a&&(h?(this.newUnlocks.push(s),s.triggerEvent("enable"),s.triggerEvent("unlock-level")):this.levelButtonData[i].level===this.recentlyCompletedLevel?(this.recentlyCompleted=s,s.triggerEvent("enable"),s.triggerEvent("unlock-level")):(s.triggerEvent("enable"),s.triggerEvent("unlock-level"))),this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale}e.googleAnalytics.event(e.name,"EnterLevelSelect","CompletedLevels",o),this.lsTime=Date.now()},"scene-loaded":function(t){platypus.game.app.music="background-levelSelect",platypus.game.app.musicInstance.volume=1;var e=0;if(platypus.game.app.userData.read("last-level-played",function(t){null===t&&(t=1),t>7&&(e=1),t>14&&(e=2),this.owner.triggerEvent("ls-jump",e),this.owner.triggerEvent("new-scroll-position",e),this.owner.triggerEvent("populate-level-buttons",e)}.bind(this)),this.owner.parent.app.userData.write("Recently-Completed-Level",""),void 0!==t&&t.winSection)switch(this.owner.triggerEvent("endSection"+t.winSection),t.winSection){case 1:this.owner.triggerEvent("jet2-jump");break;case 2:this.owner.triggerEvent("boop-jump")}},"scene-live":function(){this.recentlyCompleted},"show-completed-level":function(){this.recentlyCompleted.triggerEvent("complete-level",!1),this.recentlyCompleted=null},"show-unlocked-levels":function(){var t=0;for(t=0;t<this.newUnlocks.length;t++)this.newUnlocks[t].triggerEvent("unlock-level"),this.newUnlocks[t].triggerEvent("enable");this.newUnlocks=[]}},methods:{destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitLevelSelect","LevelSelectTime",Date.now()-this.lsTime>>0)}},getAssetList:function(){var e=t.getAssetList({type:"level-button"}),i=Array.setUp("assets/images/levelNums.png");return e.union(i),i.recycle(),e}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"LevelSelectScrollable",properties:{scrollScale:1,name:""},publicProperties:{},initialize:function(t,e){this.originX=0,this.scrolledX=0,this.scrolledPos=0,this.scrolling=!1,this.ignoreAdopt=!1,this.fx=[],this.fxc=0,this.hoverC=0},events:{"ls-scroll-right":function(){2==this.scrolledPos||this.scrolling||(this.scrolling=!0,this.scrolledPos++,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,t.get(this.owner).to({x:this.scrolledX},1e3,e.sineInOut).call(function(){this.scrolling=!1,this.owner.parent.triggerEvent("new-scroll-position",this.scrolledPos)}.bind(this)))},"jet2-jump":function(){if("Jet2"==this.name){t.get(this.owner).to({y:this.owner.y-100,scaleX:.75,scaleY:.75},300,e.sineOut).call(function(){t.get(this.owner).to({y:this.owner.y+100,scaleX:.6,scaleY:.6},300,e.sineIn).call(function(){}.bind(this))}.bind(this));for(var i=0;i<8;i++){var n=45*i,s=this.owner.parent.addEntity({id:"starFX",components:[{type:"RenderSprite",spriteSheet:"star",rotate:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z-1,scaleX:.75,scaleY:.75,opacity:.5,speedX:2*Math.cos(n*(Math.PI/180)),speedY:2*Math.sin(n*(Math.PI/180))}});this.fx.push(s)}this.owner.parent.triggerEvent("star")}},"boop-jump":function(){if("Boop"==this.name){t.get(this.owner).to({y:this.owner.y-100,scaleX:.9,scaleY:.9},300,e.sineOut).call(function(){t.get(this.owner).to({y:this.owner.y+100,scaleX:.6,scaleY:.6},300,e.sineIn).call(function(){}.bind(this))}.bind(this));for(var i=0;i<8;i++){var n=45*i,s=this.owner.parent.addEntity({id:"starFX",components:[{type:"RenderSprite",spriteSheet:"star",rotate:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z-1,scaleX:.75,scaleY:.75,opacity:.5,speedX:3.5*Math.cos(n*(Math.PI/180)),speedY:3.5*Math.sin(n*(Math.PI/180))}});this.fx.push(s)}this.owner.parent.triggerEvent("star")}},"ls-scroll-left":function(){0===this.scrolledPos||this.scrolling||(this.scrolling=!0,this.scrolledPos--,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,t.get(this.owner).to({x:this.scrolledX},1e3,e.sineInOut).call(function(){this.scrolling=!1,this.owner.parent.triggerEvent("new-scroll-position",this.scrolledPos)}.bind(this)))},"ls-jump":function(t){this.scrolledPos=t,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,this.owner.x=this.scrolledX},"ls-jump2":function(t){this.originX=this.owner.x,this.scrolledPos=t,this.scrolledX=this.originX-1200*this.scrolledPos*this.scrollScale,this.owner.x=this.scrolledX,this.ignoreAdopt=!0},adopted:function(){this.ignoreAdopt||(this.originX=this.owner.x)},"handle-logic":function(){"ship"==this.name&&(this.hoverC+=.01,this.owner.y+=.1*Math.sin(this.hoverC));var t=!1;if(this.fx.length>0)for(var e in this.fxc++,t=this.fxc>400,this.fx){var i=this.fx[e];i.x+=i.speedX,i.y+=i.speedY,i.opacity-=.00125,i.speedX*=.99,i.speedY*=.99,i.rotation+=1}if(t){for(var n in this.fx){var s=this.fx[n];this.owner.parent.removeEntity(s)}this.fx=[],this.fxc=0}}},getAssetList:function(){return Array.setUp("assets/images/star.png")}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Entity");platypus.createComponentClass({id:"ListItem",properties:{infinite:!1,opacity:1},publicProperties:{count:1,z:0,spawns:""},initialize:function(e){this.item=this.owner.item||e.item,this.generatedItem=!1,this.dragging=!1,this.readyToDrag=null,this.pointerIsDown=!1,this.show=this.owner.left,this.hide=-this.owner.left,this.motion=t.setUp("x",0,"y",0),this.owner.state.set("infinite",this.infinite),this.updateCount(this.count)},events:{"increase-count":function(){this.updateCount(this.count+1)},"decrease-count":function(){this.updateCount(this.count-1)},"item-returned":function(t){t===this.spawns&&this.updateCount(this.count+1)},pointerdown:function(t){this.readyToDrag=!0,this.motion.x=t.x,this.motion.y=t.y,this.pointerIsDown=!0},pointermove:function(t){var e=0,i=0;this.pointerIsDown&&!this.generatedItem&&(this.readyToDrag?(e=Math.abs(this.motion.x-t.x),i=Math.abs(this.motion.y-t.y),this.owner.parent.scrollable?2*e>i&&e>7?this.createEntity(t)||(this.readyToDrag=!1,this.scroll(t)):i>2*e&&i>7&&(this.readyToDrag=!1,this.scroll(t)):this.createEntity(t)):this.scroll(t))},pointerup:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointerupoutside:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointercancel:function(t){this.scrolling&&(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{createEntity:function(t){return!!this.count&&(this.generatedItem=!0,this.owner.triggerEvent("generate-item",t),this.owner.triggerEvent("decrease-count"),this.dragging=!0,!0)},scroll:function(t){this.owner.parent.triggerEvent("swipe",t),this.scrolling=!0},updateCount:function(t){var e="";this.infinite||(t>0?(e+=t,this.owner.opacity=1):0===t&&(e="0",this.owner.opacity=.2),this.count=t,this.owner.triggerEvent("set-text",e))}},getAssetList:function(t,i,n){var s=t.spawns||i.spawns||n&&n.spawns;return s?e.getAssetList({type:s}):Array.setUp()}})}(),function(){"use strict";var t={};platypus.createComponentClass({id:"LSScroller",properties:{hideAtPos:0},events:{adopted:function(){0===this.hideAtPos&&this.owner.triggerEvent("hide-sprite")},pointerover:function(){this.owner.state.set("hover",!0)},pointerout:function(){this.owner.state.set("hover",!1)},"new-scroll-position":function(e){var i=["lsEarth","lsMars","lsSpace"][e];this.hideAtPos==e?this.owner.triggerEvent("hide-sprite"):this.owner.triggerEvent("show-sprite"),t[i]||(this.owner.triggerEvent(i),t[i]=!0)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Vector");platypus.createComponentClass({id:"Magnifier",properties:{offsetX:56,offsetY:-61},publicProperties:{dragging:!1},initialize:function(){this.details=platypus.game.app.config["magnify-list"],Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.sensorState=!1,this.groupMovement=null,this.locked=!1,this.ignoreInput=!1,this.top=this.owner.top,this.left=this.owner.left,this.detail=null,this.detailEntity=null,this.wentOutsideTheScreen=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(){var t=null,e=this.camera,n=null,s=null,r=this.owner,o=r.parent,a=null,h=r.parent.parent.layers,l=r.state,c=this.vector,p=null,u=null,d=null,g=h.length,y=0,m=0;if(l.get("focus")&&l.set("focus",!1),c&&l.get("dragging")){for(this.detail=null,c=i.setUp(c.x+this.offsetX,c.y+this.offsetY),y=0;y<g;y++)if((a=h[y])!==o&&(p=a.windowToWorld(o.worldToWindow(c)),m=(t=a.getEntitiesAtPoint?a.getEntitiesAtPoint(p.x,p.y):this.getEntitiesAtPoint(a,p.x,p.y)).length)){for(;m--;)s=t[m],(n=this.details[s.spawns||s.type])&&(l.set("focus",!0),this.detail=n,u=a.windowToWorld(o.worldToWindow(i.setUp(e.left,e.top))),d=a.windowToWorld(o.worldToWindow(i.setUp(e.width,e.height))),this.detailEntity={x:s.x>>0,y:s.y>>0},this.time=Date.now(),u.recycle(),d.recycle());if(n)break}c.recycle()}},pointerdown:function(t){var i=null;this.owner.parent.zooming||this.locked?this.ignoreInput=!0:(this.dragged=!1,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick?(this.ignoreInput=!0,this.stickyClick(t),this.stickyClick=null):(i=function(t){var i=this.camera,n=this.owner.container.parent.transform.worldTransform,s=e.setUp("event",t.data.originalEvent,"pixiEvent",t,"x",t.data.global.x/n.a+i.left,"y",t.data.global.y/n.d+i.top,"entity",this.owner);this.continueInputMovement(s),s.recycle()}.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",i),this.stickyClick=function(t,e){this.owner.container.removeListener("pointermove",t),e&&this.endInputMovement(e)}.bind(this,i))):this.startInputMovement(t))},pointermove:function(t){this.ignoreInput||this.vector.x===t.x&&this.vector.y===t.y||(this.dragged=!0,this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.continueInputMovement(t))},pointerup:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointerupoutside:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointercancel:function(t){this.vector&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t))},"unlock-magnifying-glass":function(){var t=this.owner;t.top=this.top,t.left=this.left,this.locked=!1,t.state.set("dragging",!1),this.dragging=!1},hide:function(){var t=platypus.game.app;this.detail&&(t.analyticsEmitter.closeMagnificationDialog(t.levelBot||"",t.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,!t.voPlayer.playing,Date.now()-this.time>>0,t.getEnlearnData()),this.detail=null,this.detailEntity=null),this.time=0}},methods:{getEntitiesAtPoint:function(e,i,n){for(var s=t.setUp(),r=Array.setUp(),o=e.entities,a=null,h=o.length,l=0;h--;)if((a=o[h]).shape){var c=a.width/-2+a.x+25,p=a.height/-2+a.y+25;for(l=a.shape.length;l--;)s.setAll(c+(50*a.shape[l][0]||0),p+(50*a.shape[l][1]||0),50,50),s.containsPoint(i,n)&&r.push(a)}else s.setAll(a.x||0,a.y||0,a.width||0,a.height||0),s.containsPoint(i,n)&&r.push(a);return s.recycle(),r},startInputMovement:function(t){var e=this.owner;this.vector&&this.vector.recycle(),this.vector=i.setUp(t.x,t.y),e.parent.triggerEvent("pause-zooming"),this.dragging=!0},continueInputMovement:function(t){var e=this.owner,i=e.state;this.dragging&&!i.get("dragging")&&(i.set("dragging",!0),e.triggerEvent("magnifying"),this.owner.top=null,this.owner.left=null),void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.detail=null,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),this.vector&&(this.vector.x=t.x,this.vector.y=t.y),e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endInputMovement:function(t){var e=platypus.game.app,i=this.owner,n=this.detail,s="";this.continueInputMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,i.parent.triggerEvent("unpause-zooming"),n?(e.analyticsEmitter.magnifyAnEntity(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,this.detailEntity),i.triggerEvent("send-title",n.title),i.triggerEvent("set-photo",n.id),i.triggerEvent("show-magnification"),platypus.game.app.voPlayer.play(n["vo-id"]||"mag-"+n.id),"cracker-a"!==(s=n.id)&&"cracker-b"!==s&&"cracker-c"!==s&&"cracker-d"!==s||(s="cracker"),platypus.badger.increment("inspected-"+s),this.time=Date.now()):i.triggerEvent("early-reset-magnification")},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"MagnifierPhotoSetter",initialize:function(){this.photos=platypus.game.app.config["magnify-list"]},events:{"set-photo-id":function(t){var e=this.photos[t],i=platypus.modifyAllAssets;this.scale||(this.scale=function(t){for(var e=t.length;e--;)if(1===t[e].offsetZ)return t[e].sprite.scale}(this.owner.components)),e&&(this.owner.triggerEvent(e.image),e.credit&&(this.scale.x=i,this.scale.y=i,e["image-title"]?"*"+e["image-title"]+"* by ":"This photo is by ",e.credit+" at "+e.link),e.scale?(this.scale.x=+e.scale*i,this.scale.y=+e.scale*i):(this.scale.x=i,this.scale.y=i))}}})}(),function(){"use strict";var t=function(t){var e=createjs.Sound._getSrcById(t),i=e.src,n=null,s=null,r=null,o=null;if(!e||!e.src)return 0;if(r=(e=createjs.Sound.activePlugin._audioSources[e.src]).duration,!0===e)n=(s=(n=i.split(".")[0]).split("/"))[s.length-1],r=app.config.captions[n]&&app.config.captions[n].lines?(o=app.config.captions[n].lines)[o.length-1].end/1e3:0;else if(!e)return 0;return 1e3*(r||0)>>0};platypus.createComponentClass({id:"MindyHead",properties:{},publicProperties:{},initialize:function(){this.vo=null,this.scc=0,this.triggered=[],this.silenced=!1,this.skipGraceTime=200},events:{adopted:function(){this.owner.triggerEvent("hide-sprite")},"show-mindy":function(t){this.silenced||(this.vo=t,this.scc=30,this.owner.triggerEvent("show-sprite"),this.owner.triggerEvent("mindy-"+this.vo),-1===this.triggered.indexOf(t)&&this.owner.parent.triggerEvent(this.vo),this.triggered.push(t))},"silence-mindy":function(){this.silenced=!0,this.owner.triggerEvent("stop-audio")},"sequence-complete":function(){if(!(this.scc>0)){this.scc=30;var t=null;switch(this.vo){case"begin-level-1":t="begin-tutorial";break;case"begin-tutorial":t="tutorial-2";break;case"tutorial-2":this.owner.parent.triggerEvent("end-tutorial");break;case"begin-level-2":t="tutorial-4";break;case"tutorial-4":t="tutorial-4B";break;case"begin-level-3":t="tutorial-5";break;case"begin-level-7":t="tutorial-6"}t?(this.vo=t,this.owner.triggerEvent("mindy-"+this.vo),this.owner.parent.triggerEvent(this.vo)):(this.owner.triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("hide-mindy-panel"))}},"handle-logic":function(){this.scc>0&&this.scc--},"lev-succ-a":function(e){var i=platypus.game.app,n=i.config.captions[e]&&i.config.captions[e].lines,s=0,r="";if(this.time=Date.now(),this.duration=t(e),n)for(s=0;s<n.length;s++)r+=n[s].content+" ";try{i.analyticsEmitter.startCorrectFeedback(i.levelBot||"",i.levelNumber||0,"audio",this.duration,r,e)}catch(t){platypus.debug.warn("Analytics Emitter Error",t)}},"lev-fail-a":function(e){var i=platypus.game.app,n=i.config.captions[e]&&i.config.captions[e].lines,s=0,r="";if(this.time=Date.now(),this.duration=t(e),n)for(s=0;s<n.length;s++)r+=n[s].content+" ";try{i.analyticsEmitter.startIncorrectFeedback(i.levelBot||"",i.levelNumber||0,"audio",this.duration,r,e)}catch(t){platypus.debug.warn("Analytics Emitter Error",t)}},"instruct-a":function(e){var i=platypus.game.app,n=i.config.captions[e]&&i.config.captions[e].lines,s=0,r="";if(this.time=Date.now(),this.duration=t(e),n)for(s=0;s<n.length;s++)r+=n[s].content+" ";try{i.analyticsEmitter.startInstruction(i.levelBot||"",i.levelNumber||0,"audio",this.duration,r,e),i.googleAnalytics.event(i.name,"TutorialStart",e)}catch(t){platypus.debug.warn("Analytics Emitter Error",t)}},"lev-succ-b":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,n=0,s="",r=Date.now()-this.time,o=r<this.duration-this.skipGraceTime;if(i)for(n=0;n<i.length;n++)s+=i[n].content+" ";try{e.analyticsEmitter.endCorrectFeedback(e.analyticsEmitter._round||0,e.levelBot||"",e.levelNumber||0,"audio",r>>0,s,t,o)}catch(t){platypus.debug.warn("Analytics Emitter Error",t)}},"lev-fail-b":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,n=0,s="",r=Date.now()-this.time,o=r<this.duration-this.skipGraceTime;if(i)for(n=0;n<i.length;n++)s+=i[n].content+" ";try{e.analyticsEmitter.endIncorrectFeedback(e.analyticsEmitter._round||0,e.levelBot||"",e.levelNumber||0,"audio",r>>0,s,t,o)}catch(t){platypus.debug.warn("Analytics Emitter Error",t)}},"instruct-b":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,n=0,s="",r=Date.now()-this.time,o=r<this.duration-this.skipGraceTime;if(i)for(n=0;n<i.length;n++)s+=i[n].content+" ";try{e.analyticsEmitter.endInstruction(e.analyticsEmitter._round||0,e.levelBot||"",e.levelNumber||0,"audio",r>>0,s,t,o,e.getEnlearnData()),o?e.googleAnalytics.event(e.name,"TutorialSkip",t):e.googleAnalytics.event(e.name,"TutorialComplete",t)}catch(t){platypus.debug.warn("Analytics Emitter Error",t)}}}})}(),function(){"use strict";platypus.createComponentClass({id:"MindyMenu",properties:{},publicProperties:{},initialize:function(){},events:{"scene-live":function(t){void 0!==t&&t.winGame?this.owner.triggerEvent("win"):this.owner.triggerEvent("main")},"handle-logic":function(){}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"Motor",properties:{accel:40,damping:.8},publicProperties:{},initialize:function(){this.simulationStarted=!1,this.torque=0,this.direction=0,this.batteryDrain=.0013,this.owner.state.set("powered",!1)},events:{load:function(){this.torque=this.owner.body.GetMass()*this.accel*(this.owner.radius/30)},"simulation-started":function(){this.simulationStarted=!0},"simulation-stopped":function(){this.simulationStarted=!1},"motor-cw-start":function(){this.owner.state.get("connected-to-battery")&&(this.direction=1,this.owner.body.SetAngularDamping(this.damping))},"motor-cw-stop":function(){this.owner.state.get("connected-to-battery")&&1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"motor-ccw-start":function(){this.owner.state.get("connected-to-battery")&&(this.direction=-1,this.owner.body.SetAngularDamping(this.damping))},"motor-ccw-stop":function(){this.owner.state.get("connected-to-battery")&&-1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"before-box2d-update":function(){this.simulationStarted&&this.direction&&this.owner.state.get("connected-to-battery")&&this.owner.drainBattery(this.batteryDrain)&&(this.owner.body.SetAwake(!0),this.owner.body.ApplyTorque(this.direction*this.torque))}},methods:{},publicMethods:{}})}(),function(){"use strict";var t;platypus.createComponentClass({id:"Mouth",properties:{animationMap:null},initialize:(t=function(t){this.spine&&this.spine.skeleton.setAttachment("Mouths",t)},function(){var e="",i=this.animationMap;for(e in this.spine=null,i)i.hasOwnProperty(e)&&this.addEventListener(e,t.bind(this,i[e]))}),events:{load:function(){for(var t=this.owner.components,e=t.length;e--;)if(t[e].spine){this.spine=t[e].spine;break}}}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),n=new(include("Box2D.b2Vec2"))(0,0),s=-6e3;platypus.createComponentClass({id:"Pin",properties:{},publicProperties:{handshake:0,vertical:!1,weld:!1},initialize:function(){this.constraints=Array.setUp(),this.temporaryConstraints=Array.setUp(),this.entities=Array.setUp(),this.defaultZ=this.handshake?3015:this.owner.z,this.pinnedZ=this.defaultZ-.1,this.owner.parent.addPin(this.owner),this.hiding=!1,this.handshake&&this.owner.state.set("block",!0),this.vertical&&this.owner.state.set("vertical",!0),this.weld&&(this.owner.scaleX=.5,this.owner.scaleY=.5)},events:{adopted:function(){this.owner.parent.triggerEvent("pin-on-panel",this.owner)},"snap-to-pin":function(t){for(var e=this.entities,i=e.length,n=null;i--;)n=e[i],this.detach(n),t.attach(n,!1,!0);this.owner.parent.removeEntity(this.owner)},"validate-motion":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("validate-constraint",t)},dragged:function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("pin-moved",t);this.destroyTemporaryJoints()},"resolve-bodies":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-bodies")},"resolve-joints":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-joints")},"resolve-snaps":function(e){for(var i=this.entities,n=null,s=null,r=this.temporaryConstraints,o=e.length,a=0,h=0;o--;)if((n=e[o]).pinFrom===this.owner&&!n.panel)for(a=(s=n.pinTo.getPinnedEntities()).length;a--;)for(h=i.length;h--;)r.push(t.setUp("pinned",s[a],"entity",i[h]))},"motion-ended":function(){var t=this.entities,e=t.length;for(this.destroyTemporaryJoints();e--;)t[e].triggerEvent("pin-motion-ended",this.owner)},"update-group-id":function(t){var e=this.entities,i=e.length;if(!t||t!==this.owner.groupId){for(t?this.owner.groupId=t:(this.owner.groupId=--s,t=this.owner.groupId);i--;)e[i].groupId!==t&&e[i].triggerEvent("update-group-id",t);this.owner.panelled&&this.owner.panelled.triggerEvent("update-group-id",t)}},"pre-simulation-started":function(){this.owner.panelled&&this.attach(this.owner.panelled)},"prepare-for-simulation":function(){var t=0,e=null;for(t=0;t<this.constraints.length;t++)e=this.constraints[t],this.owner.handshake||this.owner.panelled||(e.EnableMotor(!0),e.SetMaxMotorTorque(15),i(e).oAngle=e.GetJointAngle());this.owner.parent.removeEntity(this.owner)},"throw-away":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("lost-pin",this.owner)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("begin-pin-group-movement",t)},"before-box2d-update":function(){for(var t=null,e=this.temporaryConstraints,i=e.length;i--;)(t=e[i]).joint=this.createJoint(t.pinned,t.entity)},"after-box2d-update":function(){for(var t=this.owner,e=null,i=this.temporaryConstraints,n=i.length;n--;)e=i[n],t.removeJoint(e.joint),e.joint=null},"handle-render":function(){!this.hiding&&this.owner.immobile?(this.owner.triggerEvent("hide-sprite"),this.hiding=!0):this.hiding&&!this.owner.immobile&&(this.owner.triggerEvent("show-sprite"),this.hiding=!1)},"can-you-pin-to-this-panel":function(t){var i=null,s=[0,-2,2],r=0;if(!this.owner.handshake&&-1===this.owner.getPinnedEntities().indexOf(t.panel))for(i=t.panel.body.GetFixtureList();0!==e(i);){for(r=0;r<s.length;r++)if(n.Set((this.owner.x+s[r])/30,(this.owner.y+s[r])/30),i.TestPoint(n))return t.pin=this.owner,this.owner.panelled=t.panel,this.owner.state&&this.owner.state.set("panelled",!0),void t.panel.velcroed.push(this.owner);i=i.GetNext()}}},methods:{createJoint:function(t,e){var i=this.owner,n=i.x/30,s=i.y/30;return this.handshake||this.weld?t.createJoint("weld",{anchor:{x:n,y:s}},e,1):t.createJoint("revolute",{anchor:{x:n,y:s}},e,1)},destroyTemporaryJoints:function(){for(var t=this.temporaryConstraints,e=t.length;e--;)t[e].recycle();t.length=0},updateRendering:function(){var t=this.entities.length>1;this.owner.state.set("pinned",t),this.owner.z=t?this.pinnedZ:this.defaultZ},destroy:function(){var t=this.owner.parent;t.removePin&&t.removePin(this.owner),this.constraints.recycle(),this.constraints=null,this.entities.recycle(),this.entities=null},detachPinAndJoint:function(t){var e=t.body,i=this.owner,n=this.constraints,s=null,r=this.entities,o=r.indexOf(t),a=0;if(o>=0){for(a=n.length;a--;)if(e===(s=n[a]).GetBodyA()||e===s.GetBodyB()){n.greenSplice(a);try{i.removeJoint(s)}catch(t){platypus.debug.warn("Joint removal caused an error.",t)}}if(r.greenSplice(o),this.owner.immobile&&!t.movable)for(o=r.length,this.owner.immobile=!1;o--;)if(!r[o].movable){this.owner.immobile=!0;break}t.triggerEvent("pin-removed",i)}else platypus.debug.warn("Attempting to detach an unattached entity. This is incorrect; please fix.")}},publicMethods:{getConstraints:function(){return this.constraints},attach:function(t,e,i){var n=this.constraints,s=this.entities,r=s.length;for(i&&this.handshake&&(this.handshake+=1e3);r--;)n.push(this.createJoint(t,s[r]));s.push(t),t.movable||(this.owner.immobile=!0),e||t.triggerEvent("pin-added",this.owner),this.owner.loadingComponents?t.groupId&&!this.owner.groupId&&(this.owner.groupId=t.groupId):this.owner.groupId?t.triggerEvent("update-group-id",this.owner.groupId):this.owner.triggerEvent("update-group-id"),this.updateRendering()},canSnapTo:function(t,e){var i=this.entities,n=i.length,s=!0,r=t.pinTo.getPinnedEntities(),o=r.length;if(t.pinFrom.handshake+t.pinTo.handshake!==0)return!1;if(t.pinFrom.inDragGroup&&t.pinTo.inDragGroup)return!1;for(;n--;)for(o=r.length;o--;)if(i[n]===r[o])return!1;for(n=i.length;n--;)if(i[n].triggerEvent("valid-snap",t,e),!t.snappable){s=!1;break}return s},isConstrained:function(){return!!this.entities.length},hasJoint:function(t){for(var i=this.constraints,n=i.length;n--;)if(e(i[n])===e(t))return!0;return!1},detach:function(t){this.detachPinAndJoint(t)&&(this.owner.triggerEvent("update-group-id"),this.updateRendering())},getPinnedEntities:function(){return this.entities},resetJoints:function(){for(var t=this.owner,e=this.constraints,i=e.length,n=this.entities,s=0;i--;)t.removeJoint(e[i]);for(e.length=0,i=n.length;i--;)for(s=i;s--;)e.push(this.createJoint(n[i],n[s]))},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake?9999999:0,vertical:t.vertical||!1,weld:t.weld||!1}})},split:function(t){var e=this.owner.parent,i=this.entities,n=i.length,s=null,r=null;if(1===n)return null;for(this.owner.immobile&&t.movable&&(this.owner.immobile=!1),r=this.createPin(this.owner,e);n--;)i[n]!==t&&(s=i[n],this.detachPinAndJoint(s),r.attach(s,!1),this.handshake&&(this.handshake-=1e3,0===n?(this.handshake*=-1,r.handshake=-this.handshake):r.handshake=-this.handshake,r.state.set("block",!0)));return this.owner.triggerEvent("update-group-id"),this.updateRendering(),r},detachPermanently:function(t){this.detach(t),this.entities.length?this.updateRendering():this.owner.parent.removeEntity(this.owner)}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",initialize:function(){this.pins=this.owner.pins=Array.setUp()},events:{},methods:{destroy:function(){this.pins.recycle(),this.pins=this.owner.pins=null}},publicMethods:{addPin:function(t){this.pins.push(t),this.owner.pinsImmovable&&(t.triggerEvent("input-off"),t.interactive=!1)},removePin:function(t){var e=this.pins,i=e.indexOf(t);i>=0&&e.greenSplice(i)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.getPointer"),i=new t(0,0),n=function(t){var n=t.pin||t,s=this.owner.velcroed.indexOf(n),r=null,o=[0,-2,2],a=0;if(-1===n.getPinnedEntities().indexOf(this.owner)){for(r=this.owner.body.GetFixtureList();0!==e(r);){for(a=0;a<o.length;a++)if(i.Set((t.x+o[a])/30,(t.y+o[a])/30),r.TestPoint(i))return t.panelled=this.owner,t.state&&t.state.set("panelled",!0),void(-1===s&&this.owner.velcroed.push(n));r=r.GetNext()}-1!==s&&this.owner.velcroed.splice(s,1)}};platypus.createComponentClass({id:"Pinnable",properties:{pinLocations:null,validate:!0},publicProperties:{z:0,velcro:!1,velcroed:null},initialize:function(){this.owner.parent.pins;var t=this.pinLocations,e=0,i=t&&t.length||0;for(this.onlyRemovingComponentSoDontDropThePins=!1,this.pins=Array.setUp(),e=0;e<i;e++)this.addPin(t[e]);this.velcroed=[],this.velcro&&this.addEventListener("pin-on-panel",n)},events:{"peer-entity-added":function(t){"pin"!==t.type||t.handshake||this.owner.triggerEvent("pin-on-panel",t)},"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.PinnableFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.validate&&t.valid&&this.tryAdjustment(t.entity,t)},"update-group-id":function(t){var e=this.pins,i=e.length,n=this.velcroed.length;for(this.owner.groupId=t;i--;)t!==e[i].groupId&&e[i].triggerEvent("update-group-id",t);for(;n--;)t!==this.velcroed[n].groupId&&this.velcroed[n].triggerEvent("update-group-id",t)},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){this.pins.push(t)},"resolve-bodies":function(){var t=this.owner;t.body&&t.matchBodyToEntity()},"pin-removed":function(t){for(var e=this.pins,i=e.length;i--;)if(t===e[i])return void e.greenSplice(i)},"begin-pin-group-movement":function(t){var e=this.pins,i=e.length;for(this.owner.triggerEvent("include-in-group",t);i--;)e[i].triggerEvent("include-in-group",t)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.pins,i=e.length,n=!1;i--;)e[i].triggerEvent("include-in-group",t),e[i].immobile&&(n=!0);if(this.owner.movable&&n)for(i=e.length;i--;)e[i].split(this.owner);else this.prepareForBreakage=!0},"break-away":function(){var t=this.pins,e=t.length;if(this.prepareForBreakage)for(this.prepareForBreakage=!1;e--;)t[e].split(this.owner)},"include-in-group":function(){this.prepareForBreakage=!1},"remove-pinnable-component":function(){this.owner.removeComponent(this),this.owner.parent.triggerEvent("child-entity-updated",this.owner)}},methods:{addPin:function(t){var e=this.owner,i=this.createOrFindPin({x:e.x+t.x,y:e.y+t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1},e.parent);return this.pins.push(i),i.getPinnedEntities().length?i.attach(e,!0,!0):i.attach(e,!0),i},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins),n=this.pins.indexOf(i);return i&&n<0?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1}})},findPin:function(t,e){var i,n,s=platypus.game.app.config.pins.mergeDistance,r=0,o=null,a=e&&e.length,h=s*s,l=null;if(a)for(;a--;)o=e[a],i=o.x-t.x,n=o.y-t.y,(r=i*i+n*n)<h&&o.handshake+t.handshake===0&&(h=r,l=o);return l},tryAdjustment:function(t,e){var i=this.pins,n=i.length;if(!this.alreadyTryingAdjustment){for(this.alreadyTryingAdjustment=!0;n--;)t!==i[n]&&i[n].triggerEvent("validate-constraint",e);this.alreadyTryingAdjustment=!1}}},publicMethods:{destroyThePins:function(){var t=this.pins,e=t.length;if(!this.onlyRemovingComponentSoDontDropThePins)try{for(;e--;)t[e].detachPermanently(this.owner)}catch(t){}t.recycle()}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.AABB");platypus.createComponentClass({id:"PointerBehaviors",properties:{bounceDistance:30,scaleBy:1.25},publicProperties:{},initialize:function(){this.degToRad=Math.PI/180,this.originalX=this.owner.x,this.originalY=this.owner.y,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY,this.camera=i.setUp()},events:{"handle-logic":function(t){},"end-tutorial":function(){this.owner.parent.triggerEvent("finish-tutorial")},move:function(t){this.owner.x=t.x,this.owner.y=t.y,t.left&&(this.owner.x=this.camera.left+t.left),t.right&&(this.owner.x=this.camera.right-t.right),t.top&&(this.owner.y=this.camera.top+t.top),this.owner.rotation=t.rotation||this.owner.rotation,this.originalX=this.owner.x,this.originalY=this.owner.y},"smooth-move":function(i){this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner).to({x:i.x,y:i.y,rotation:i.rotation||this.owner.rotation},i.time||250,e.sineInOut).call(function(){this.originalX=this.owner.x,this.originalY=this.owner.y}.bind(this))},show:function(){t.get(this.owner).to({opacity:1},100)},hide:function(){t.get(this.owner).to({opacity:0},100)},"start-pulse":function(i){i=i||-1,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY,t.get(this.owner,{loop:i}).to({scaleX:this.originalScaleX*this.scaleBy,scaleY:this.originalScaleY*this.scaleBy},250,e.sineInOut).to({scaleX:this.originalScaleX,scaleY:this.originalScaleY},250,e.sineInOut)},"start-bounce":function(i){i=i||-1,this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner,{loop:i}).to({x:this.originalX+Math.cos(this.owner.rotation*this.degToRad)*this.bounceDistance,y:this.originalY+Math.sin(this.owner.rotation*this.degToRad)*this.bounceDistance},250,e.sineInOut).to({x:this.originalX,y:this.originalY},250,e.sineInOut)},stop:function(){t.removeTweens(this.owner),this.owner.x=this.originalX,this.owner.y=this.originalY,this.owner.scaleX=this.originalScaleX,this.owner.scaleY=this.originalScaleY},"set-state":function(t){this.owner.state.set(t.state,t.value)},"camera-update":function(t){this.camera.set(t.viewport)}},methods:{destroy:function(){this.camera.recycle()}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=0,i=function(t,e,i){t.worldToWindow(i,!0,i),e.windowToWorld(i,!0,i),i.pixiEvent.stopPropagation()},n=function(t){t.pixiEvent.stopPropagation()},s=function(i){this.owner.parent.zooming||this.newEntity||(this.convert(i),this.newEntityReady=!1,this.storedInputs.length=0,this.newEntity=this.targetLayer.addEntity({type:this.spawns,properties:{savable:!0,movable:!0,neverMovedPreviously:this.owner,x:i.x,y:i.y}},function(t,i){var n=!1,s=this.storedInputs,r=0;for(i.relayPointer?(this.newEntity=i.relayPointer,i.relayPointer=null):this.newEntity=i,this.newEntityReady=!0,this.newEntity.triggerEvent("pointerdown",t),r=0;r<s.length;r++)this.newEntity.triggerEvent(s[r].event.type,s[r]),n=n||s[r].done,s[r].recycle();s.length=0,"pointerup"!==t.event.type&&"touchend"!==t.event.type||(this.newEntity.triggerEvent("pointerup",t),this.newEntity=null),"pointerupoutside"===t.event.type&&(this.newEntity.triggerEvent("pointerupoutside",t),this.newEntity=null),"pointercancel"===t.event.type&&(this.newEntity.triggerEvent("pointercancel",t),this.newEntity=null),n&&(this.newEntity=null),t.recycle(),e+=1e-6,i.z+=e}.bind(this,t.setUp("entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y))))};platypus.createComponentClass({id:"PointerPassalong",properties:{spawnEvent:"pointerdown",targetLayerType:"action-layer"},publicProperties:{spawns:""},initialize:function(){this.newEntity=null,this.targetLayer=null,this.convert=n,this.storedInputs=Array.setUp(),this.addEventListener(this.spawnEvent,s.bind(this))},events:{adopted:function(){var t=this.owner.parent.parent.layers,e=t.length,n=this.targetLayerType;if(n){for(;e--;)if(n===t[e].type){this.targetLayer=t[e],this.convert=i.bind(null,this.owner.parent,this.targetLayer);break}this.targetLayer||platypus.debug.warn('PointerPassalong: "'+n+'" is not an available layer in this scene. Entity will be spawned on the same layer.')}},pointermove:function(t){this.passEvent("pointermove",t)},pointerup:function(t){this.passEvent("pointerup",t,!0)},pointerupoutside:function(t){this.passEvent("pointerupoutside",t,!0)},pointercancel:function(t){this.passEvent("pointercancel",t,!0)}},methods:{passEvent:function(e,i,n){this.newEntity&&(this.convert(i),this.newEntityReady?(this.newEntity.triggerEvent(e,i),n&&(this.newEntity=null)):this.storedInputs.push(t.setUp("done",n,"entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y)))},destroy:function(){this.storedInputs.recycle(),this.storedInputs=null}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Region",properties:{},publicProperties:{height:0,width:0,x:0,y:0},initialize:function(){this.aabb=t.setUp(this.x,this.y,this.width,this.height),this.entities=Array.setUp()},events:{adopted:function(){var t=this.owner,e=t.parent;this.addBorderingRegions(),e.triggerEvent("building-area-ready",t),e.triggerEvent("relocate",t)},"prepare-for-simulation":function(){for(var t=this.entities,e=t.length;e--;)this.owner.parent.removeEntity(t[e]);t.length=0,this.owner.body.SetActive(!1)},"simulation-stopped":function(){this.addBorderingRegions(),this.owner.body.SetActive(!0)},"handle-logic":function(){this.x===this.aabb.x&&this.y===this.aabb.y||this.aabb.move(this.x,this.y)}},methods:{addBorderingRegions:function(){var t=this.aabb,e=this.entities,i=this.owner.parent;e.push(i.addEntity({type:"trash",properties:{width:500,height:2e3,x:-500,y:0}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.left-250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.top-250}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.right+250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.bottom+250}}))},destroy:function(){this.aabb.recycle(),this.aabb=null,this.entities.recycle(),this.entities=null}},publicMethods:{inBounds:function(t,e){return this.aabb.containsPoint(t,e)}}})}(),function(){"use strict";var t,e=include("PIXI.Graphics"),i=include("platypus.components.RenderContainer"),n=(t=function(t,e){var i=0,n=e.indexOf("("),s=e.substring(0,n),r=e.substring(n+1,e.indexOf(")"));if(r.length){for(i=(r=r.greenSplit(",")).length;i--;)r[i]=+r[i];t[s].apply(t,r),r.recycle()}else t[s]()},function(e,i){var n=0,s=i.greenSplit(".");for(n=0;n<s.length;n++)t(e,s[n]);s.recycle()});platypus.createComponentClass({id:"RenderGraphics",properties:{offsetX:0,offsetY:0,offsetZ:0,shape:""},publicProperties:{color:16776960,width:100,height:100},initialize:function(t){var e,s,r,o,a;"string"==typeof this.color&&(this.color=parseInt(this.color.replace("#","0x"),16)),e=this,s=this.shape,r=this.color,o=this.width,a=this.height,e.beginFill(r,1),s&&"string"==typeof s?n(e,s):s&&s.radius?e.dc(s.x||0,s.y||0,s.radius):s&&s.width&&s.height?e.r(s.x||0,s.y||0,s.width,s.height):e.r(-o/2,-a/2,o,a),e.endFill(),this.x=this.offsetX,this.y=this.offsetY,this.z=this.offsetZ,this.owner.container?this.addToContainer():this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this)))},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this),t.reorder=!0},destroy:function(){this.owner.container.removeChild(this)}}},e)}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.components.RenderContainer"),i=include("PIXI.Graphics"),n=include("platypus.Vector");platypus.createComponentClass({id:"RenderShape",properties:{mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,rotate:!1,mirror:!1,flip:!1,visible:!0,cache:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0,shape:null},initialize:function(){var s=null,r=this.owner,o=r.shape,a=o&&o.points||null,h=this.gfx=new i,l=o&&o.translation?n.setUp(o.translation.x,o.translation.y):n.setUp(0,0);h.beginFill(16777215,1),a?h.drawPolygon(function(t,e){var i=Array.setUp(),n=0;for(n=0;n<t.length;n++)i.push(t[n].x+e.x,t[n].y+e.y);return i}(a,{x:l.x,y:l.y})):o&&"circle"===o.type?h.drawCircle(this.offsetX,this.offsetY,o.radius||r.radius||r.width/2):h.drawRect(this.offsetX-r.width/2,this.offsetY-r.height/2,r.width,r.height),h.endFill(),l.recycle(),this.owner.container?this.addToContainer():(s=t.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new e(this.owner,s,this.addToContainer.bind(this))),s.recycle())},events:{},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.gfx),t.reorder=!0}}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.RenderContainer"),n=include("platypus.PIXIAnimation");platypus.createComponentClass({id:"RenderSpan",properties:{spriteSheet:null,offsetX:0,offsetY:0,offsetZ:0,endA:"end-a",endAReversed:"",endALength:40,endB:"end-b",endBReversed:"",endBLength:40,middle:"middle",middleReversed:"",middleLength:120,scaleLength:!1},publicProperties:{scaleX:1,stretchLength:0},initialize:function(){var t=null,s=n.formatSpriteSheet(this.spriteSheet),r=this.reversed=this.owner.state.get("reversed");s===n.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),this.endAReversed||(this.endAReversed=this.endA),this.middleReversed||(this.middleReversed=this.middle),this.endBReversed||(this.endBReversed=this.endB),this.sprite=new n(s,r?this.middleReversed:this.middle),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=platypus.modifyAllAssets,this.sprite.scale.y=platypus.modifyAllAssets,this.spriteEndA=new n(s,r?this.endAReversed:this.endA),this.spriteEndA.y=this.offsetY,this.spriteEndA.z=this.offsetZ+.01,this.spriteEndA.scale.x=platypus.modifyAllAssets,this.spriteEndA.scale.y=platypus.modifyAllAssets,this.spriteEndB=new n(s,r?this.endBReversed:this.endB),this.spriteEndB.y=this.offsetY,this.spriteEndB.z=this.offsetZ+.02,this.spriteEndB.scale.x=platypus.modifyAllAssets,this.spriteEndB.scale.y=platypus.modifyAllAssets,this.currentStretchLength=0,this.stretch(this.stretchLength),this.owner.container?this.addToContainer():(t=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this))),t.recycle()),s.recycleSpriteSheet()},events:{"handle-render":function(){this.sprite&&this.stretchLength!==this.currentStretchLength&&this.stretch(this.stretchLength)},"state-changed":function(){var t=this.owner.state.get("reversed");this.reversed!==t&&(this.reversed=t,t?(this.spriteEndA.gotoAndPlay(this.endAReversed),this.sprite.gotoAndPlay(this.middleReversed),this.spriteEndB.gotoAndPlay(this.endBReversed)):(this.spriteEndA.gotoAndPlay(this.endA),this.sprite.gotoAndPlay(this.middle),this.spriteEndB.gotoAndPlay(this.endB)))}},methods:{stretch:function(t){var e=this.scaleLength?1:1/this.scaleX,i=(t||this.middleLength+(this.endALength+this.endBLength)/2)*e,n=this.sprite,s=this.spriteEndA,r=this.spriteEndB,o=i/2-1;s.x=-o+this.offsetX,r.x=o+this.offsetX,n.scale.x=platypus.modifyAllAssets*(i-this.endALength/2-this.endBLength/2)/this.middleLength},addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.addChild(this.spriteEndA),t.addChild(this.spriteEndB),t.reorder=!0},destroy:function(){var t=this.owner.container;t.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null,t.removeChild(this.spriteEndA),this.spriteEndA.destroy(),this.spriteEndA=null,t.removeChild(this.spriteEndB),this.spriteEndB.destroy(),this.spriteEndB=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||n.spriteSheet;if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}return t(h,a)})})}(),function(){"use strict";var t,e,i=include("PIXI.spine.core.TextureAtlas",!1),n=include("PIXI.spine.core.AtlasAttachmentLoader",!1),s=include("PIXI.BaseTexture"),r=include("platypus.Data"),o=include("platypus.components.EventRender"),a=include("platypus.components.RenderContainer"),h=include("PIXI.spine.core.SkeletonJson",!1),l=include("PIXI.spine.Spine",!1),c=include("platypus.components.StateRender");l&&platypus.createComponentClass({id:"RenderSpine",properties:{animationMap:null,mask:null,interactive:!1,mixTimes:0,offsetX:0,offsetY:0,offsetZ:0,atlas:"",skeleton:null,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0},publicProperties:{dragMode:!1,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,x:0,y:0,z:0},initialize:(e=function(t,e,i){var n,r,o=(n=e,(r=platypus.game.app.assetManager.cache.read(n.substring(n.lastIndexOf("/")+1,n.lastIndexOf("."))))||platypus.debug.warn('RenderSpine: "'+n+'" is not a loaded asset.'),new s(r));i(o),o.isLoading?o.on("loaded",t):t()},function(t,s){var p,u="",d=null,g=platypus.game.settings,y=g.atlases[this.atlas+"-"+platypus.modifyAllAssets],m=g.skeletons[this.skeleton],v=new i(y,e.bind(null,s)),f=new h(new n(v)).readSkeletonData(m),w=this.spine=new l(f);return w.state.addListener({event:function(t,e){var i=e.data.name;this.playAnimation(i)&&this.spine.update(1e-6),this.owner.trigger(i,e.data)}.bind(this),complete:function(){this.owner.triggerEvent("animation-ended",this.currentAnimation)}.bind(this)}),w.autoUpdate=!1,p=function(t,e){var i=null,n="";if(t)return t;for(n in i={},e)e.hasOwnProperty(n)&&(i[n]=n);return i}(this.animationMap,m.animations),this.stateBased=p&&this.stateBased,this.eventBased=p&&this.eventBased,p&&(u=p.default||"",this.eventBased&&(d=r.setUp("animationMap",p,"component",this),this.owner.addComponent(new o(this.owner,d)),d.recycle()),this.stateBased&&(d=r.setUp("animationMap",p,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new c(this.owner,d)),d.recycle())),this.mixTimes&&this.setMixTimes(this.mixTimes),u&&(this.currentAnimation=u,w.state.setAnimation(0,u,!0)),w.x=this.offsetX,w.y=this.offsetY,w.z=this.offsetZ,this.owner.container?this.addToContainer():(d=r.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new a(this.owner,d,this.addToContainer.bind(this))),d.recycle()),!0}),events:{"handle-render":function(t){this.spine&&(this.owner.triggerEvent("update-animation",!0),this.spine.update(t.delta/1e3))},"set-mix-times":function(t){this.setMixTimes(t)},hide:function(){this.visible=!1},show:function(){this.visible=!0},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t){this.playAnimation(t)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.spine),t.reorder=!0},playAnimation:function(t){var e=this.spine;return!(!t||!e.state.hasAnimation(t))&&(this.currentAnimation=t,e.state.setAnimation(0,t,!0),this.paused=!1,!0)},stopAnimation:function(t){var e=this.spine;t&&e.state.hasAnimation(t)&&(this.currentAnimation=t,e.state.setAnimation(0,t,!1)),this.paused=!0},setMixTimes:function(t){var e=this.spine,i=e.spineData.animations,n=0,s=0,r=0,o="",a=e.stateData;if("number"==typeof t)for(s=i.length;s--;)for(r=i.length;r--;)s!==r&&a.setMix(i[s].name,i[r].name,t);else for(o in t)t.hasOwnProperty(o)&&(n=o.indexOf(":"))>=0&&a.setMix(o.substring(0,n),o.substring(n+1),t[o]);this.mixTimes=a.animationToMixTime},destroy:function(){this.owner.container.removeChild(this.spine),this.spine.destroy(),this.spine=null,this.mixTimes=null}},getAssetList:(t=function(t,e){var i=Array.setUp(),n=null,s=0;if(t){if(1===(n=t.split("\n")).length){if(!(t=e[t+"-"+platypus.modifyAllAssets]))return i;n=t.split("\n")}for(s=n.length;s--;)".png"===n[s].substr(n[s].length-4)&&i.push(n[s])}return i},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.atlases,h=e.atlas||i.atlas||n.atlas;if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}return t(h,a)})})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.EventRender"),n=include("platypus.components.RenderContainer"),s=include("platypus.PIXIAnimation"),r=include("platypus.components.StateRender");platypus.createComponentClass({id:"RenderSprite",properties:{localScaleX:1,localScaleY:1,spriteSheet:null,animationMap:null,mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,restart:!0,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0,cache:!1,forcePlayThrough:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0},initialize:function(){var t,o="",a=null,h=s.formatSpriteSheet(this.spriteSheet);h===s.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),t=function(t,e){var i=null,n="",s=null,r=0;if(t)return t;if(Array.isArray(e.frames)&&1===e.frames.length)return null;for(n in i={},s=Array.setUp(),e.animations)e.animations.hasOwnProperty(n)&&(s.push(n),i[n]=n);if("default"===s[0])for(r=s.length,i={};r--;)i[s[r]]=s[r];return s.recycle(),i}(this.animationMap,h),this.stateBased=t&&this.stateBased,this.eventBased=t&&this.eventBased,t&&(o=t.default||"",this.eventBased&&(a=e.setUp("animationMap",t,"restart",this.restart,"component",this),this.owner.addComponent(new i(this.owner,a)),a.recycle()),this.stateBased&&(a=e.setUp("animationMap",t,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new r(this.owner,a)),a.recycle())),this.sprite=new s(h,o),this.sprite.on("complete",function(t){this.owner.triggerEvent("animation-ended",t)}.bind(this)),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=this.localScaleX*platypus.modifyAllAssets,this.sprite.scale.y=this.localScaleY*platypus.modifyAllAssets,this.owner.container?this.addToContainer():(a=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new n(this.owner,a,this.addToContainer.bind(this))),a.recycle()),h.recycleSpriteSheet()},events:{"handle-render":function(t){this.sprite&&(this.owner.triggerEvent("update-animation",!0),this.sprite.update(t.delta))},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t,e){this.playAnimation(t,e)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.reorder=!0},playAnimation:function(t,e){var i=this.sprite;t&&i.has(t)?i.gotoAndPlay(t,e):i.play()},stopAnimation:function(t){var e=this.sprite;t&&e.has(t)?e.gotoAndStop(t):e.stop()},destroy:function(){this.owner.container.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||n.spriteSheet;if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}return t(h,a)})})}(),function(){"use strict";var t,e=include("platypus.AABB"),i=include("platypus.PIXIAnimation"),n=include("springroll.Application"),s=include("PIXI.CanvasRenderer"),r=include("PIXI.Container"),o=include("PIXI.Graphics"),a=r,h=include("PIXI.Rectangle"),l=include("platypus.components.RenderContainer"),c=include("PIXI.RenderTexture"),p=include("PIXI.Sprite"),u=function(t,e,i){var n=e.baseTexture._glRenderTargets[t.CONTEXT_UID];n&&n.clear(i)},d=function(){return null},g=e.setUp(),y=function(t,e){return t.z-e.z},m=function(t){for(var e=1;e<t;)e*=2;return e},v=function(t,e){this.id=e,this.instances=Array.setUp(t),this.index=0,t.template=this},f={getNext:d,destroy:d},w=v.prototype;w.getNext=function(){var t=this.instances[this.index],e=null;return t||(e=this.instances[0],(t=this.instances[this.index]=new p(e.texture)).scale=e.scale,t.rotation=e.rotation,t.anchor=e.anchor),this.index+=1,t},w.clear=function(){this.index=0},w.destroy=function(){var t=0;for(t=0;t<this.instances.length;t++)this.instances[t].destroy();this.instances.recycle(),this.recycle()},recycle.add(v,!!springroll.Debug,"Template"),platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10,top:0,left:0},initialize:function(t){var o=platypus.modifyAllAssets,h=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=n.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=e.setUp(),this.tileWidth/=o,this.tileHeight/=o,this.scaleX*=o,this.scaleY*=o,this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=e.setUp(),this.cachePixels=e.setUp(),this.spriteSheet=i.formatSpriteSheet(this.spriteSheet),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof s?new r:new a(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new r,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=Array.setUp(this.createMap(h)),this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(m(this.layerWidth+2),this.maximumBuffer),this.cacheHeight=Math.min(m(this.layerHeight+2),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1),this.ready=!1,this.owner.container?this.addToContainer():this.owner.addComponent(new l(this.owner,t,this.addToContainer.bind(this)))},events:{"cache-sprite":function(t){this.cacheSprite(t)},"peer-entity-added":function(t){this.cacheSprite(t)},"add-tiles":function(t){var e=t.imageMap;e&&(this.imageMap.push(this.createMap(e)),this.updateCache=!0)},"change-tile":function(t,e,i,n){var s=this.imageMap;s&&(this.updateTile(t,s[n||0],e,i),this.updateCache=!0)},"camera-loaded":function(t){this.worldWidth=t.world.width,this.worldHeight=t.world.height,this.buffer&&!this.cacheAll&&this.updateBufferRegion(t.viewport)},"camera-update":function(t){this.ready&&this.updateCamera(t)},"handle-render":function(){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{addToContainer:function(){var t=this.container=this.owner.container,e=this.mapContainer,i=null,n=this.owner.z;t.reorder=!0,this.ready=!0,this.updateRegion(0),this.tileCache?(this.mapContainerWrapper=new r,this.mapContainerWrapper.addChild(e),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.render=this.renderCache,this.cacheTexture=c.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=i=new p(this.cacheTexture),i.scale.x=this.scaleX,i.scale.y=this.scaleY,i.z=n,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),t.addChild(i)):(this.render=this.renderCache,this.cacheAll=!1,this.cacheTexture=c.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=new p(this.cacheTexture),this.tilesSprite.scale.x=this.scaleX,this.tilesSprite.scale.y=this.scaleY,this.tilesSprite.z=n,this.cacheTexture.alternate=c.create(this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new p(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,t.addChild(this.tilesSprite))):(this.render=d,e.scale.x=this.scaleX,e.scale.y=this.scaleY,e.x=this.left,e.y=this.top,e.z=n,t.addChild(e))},cacheSprite:function(t){var e=0,i=0,n=t.cacheRender,s=null,r=0,o=0,a=0,h=0;if(this.entityCache&&n){for(this.doMap||(this.doMap=Array.setUp(),this.cachedDisplayObjects=Array.setUp(),this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(n),(s=n.getBounds(n.transformMatrix)).x-=this.left,s.y-=this.top,r=Math.max(0,Math.floor(s.y/this.tileHeight)),o=Math.min(this.tilesHeight,Math.ceil((s.y+s.height)/this.tileHeight)),h=Math.max(0,Math.floor(s.x/this.tileWidth)),a=Math.min(this.tilesWidth,Math.ceil((s.x+s.width)/this.tileWidth)),e=h;e<a;e++)for(this.doMap[e]||(this.doMap[e]=Array.setUp()),i=r;i<o;i++)this.doMap[e][i]||(this.doMap[e][i]=Array.setUp()),this.doMap[e][i].push(n);t.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(t){var e=this.layerWidth*this.scaleX,i=this.layerHeight*this.scaleY,n=this.worldWidth,s=n-t.width,r=this.worldHeight,o=r-t.height,a=this.laxCam;return n!==e&&s?a.moveX((t.left-this.left)*(e-t.width)/s+t.halfWidth+this.left):a.moveX(t.x),r!==i&&o?a.moveY((t.top-this.top)*(i-t.height)/o+t.halfHeight+this.top):a.moveY(t.y),t.width===a.width&&t.height===a.height||a.resize(t.width,t.height),a},createTile:function(t){var e,n=null;return"tile-1"===t?f:(e="tile"+function(t,e){var i=+t.substring(4),n=0;return 2147483648&i&&(e.scale.x=-1),1073741824&i&&(e.scale.y=-1),536870912&i&&(n=e.scale.x,e.scale.x=e.scale.y,e.scale.y=-n,e.rotation=Math.PI/2),268435455&i}(t,n=new i(this.spriteSheet)),n.gotoAndStop(e),v.setUp(n,t))},createMap:function(t){var e=0,i=0,n="",s=null;if("string"!=typeof t[0][0])return t;for(s=Array.setUp(),e=0;e<t.length;e++)for(s[e]=Array.setUp(),i=0;i<t[e].length;i++)n=t[e][i],this.updateTile(n,s,e,i);return s},updateCamera:function(t){var e=0,i=0,n=!1,s=null,r=0,o=0,a=0,h=0,l=this.cache,c=this.cachePixels,p=t.viewport,u=this.buffer&&(p.width!==this.laxCam.width||p.height!==this.laxCam.height),d=g,y=this.convertCamera(p);if(!this.cacheAll&&(c.empty||!c.contains(y))&&this.imageMap.length>0&&(u&&this.updateBufferRegion(y),a=(r=this.cacheTilesWidth-1)/2,h=(o=this.cacheTilesHeight-1)/2,d.setAll(Math.round((y.x-this.left)/(this.tileWidth*this.scaleX)-a)+a,Math.round((y.y-this.top)/(this.tileHeight*this.scaleY)-h)+h,r,o),d.left<0?d.moveX(d.halfWidth):d.right>this.tilesWidth-1&&d.moveX(this.tilesWidth-1-d.halfWidth),d.top<0?d.moveY(d.halfHeight):d.bottom>this.tilesHeight-1&&d.moveY(this.tilesHeight-1-d.halfHeight),this.tileCache?!l.empty&&d.contains(l)||(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,d,this.tilesSpriteCache,l)):this.update(null,d),c.setAll((l.x+.5)*this.tileWidth+this.left,(l.y+.5)*this.tileHeight+this.top,(l.width+1)*this.tileWidth,(l.height+1)*this.tileHeight)),this.cacheGrid)for(e=0;e<this.cacheGrid.length;e++)for(i=0;i<this.cacheGrid[e].length;i++)s=this.cacheGrid[e][i],c.setAll((e+.5)*this.cacheClipWidth+this.left,(i+.5)*this.cacheClipHeight+this.top,this.cacheClipWidth,this.cacheClipHeight),n=c.intersects(y),s.visible&&!n?s.visible=!1:!s.visible&&n&&(s.visible=!0),s.visible&&n&&(s.x=p.left-y.left+e*this.cacheClipWidth+this.left,s.y=p.top-y.top+i*this.cacheClipHeight+this.top);else this.tileCache&&(this.tilesSprite.x=p.left-y.left+l.left*this.tileWidth*this.scaleX+this.left,this.tilesSprite.y=p.top-y.top+l.top*this.tileHeight*this.scaleY+this.top)},updateTile:function(t,e,i,n){var s=null,r=this.tiles;t.id&&(t=t.id),(s=r[t])||null===s||(s=r[t]=this.createTile(t)),e[i][n]=s},createGrid:function(t){var e=this.cacheHeight,i=this.cacheWidth,n=this.cacheTilesHeight,s=this.cacheTilesWidth,r=0,o=0,a=null,l=this.scaleX,u=this.scaleY,d=this.tileHeight,g=this.tileWidth,y=this.tilesHeight,v=this.tilesWidth,f=0,w=0,b=this.owner.z,x=null,E=null,A=Array.setUp();for(f=0;f<v;f+=s)for(x=Array.setUp(),A.push(x),w=0;w<y;w+=n)o=Math.min(m((v-f)*g+2),i),r=Math.min(m((y-w)*d+2),e),(a=c.create(o,r)).frame=new h(1,1,((o-2)/g>>0)*g+1,((r-2)/d>>0)*d+1),(E=new p(a)).z=b,E.scale.x=l,E.scale.y=u,x.push(E),t.addChild(E),b-=1e-6;return A},updateRegion:function(t){var e=this.tileWidth,i=this.tileHeight,n=Math.min(this.tilesWidth,(this.cacheWidth-2)/e>>0),s=Math.min(this.tilesHeight,(this.cacheHeight-2)/i>>0);n||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+e+"px wide which is larger than "+(this.cacheWidth-2)+"px (maximum cache size of "+this.cacheWidth+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),s||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+i+"px high which is larger than "+(this.cacheHeight-2)+"px (maximum cache size of "+this.cacheHeight+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),this.cacheTilesWidth=n,this.cacheTilesHeight=s,this.cacheClipWidth=n*e,this.cacheClipHeight=s*i,this.tileCache&&(this.mapContainer.mask=(new o).beginFill(0).drawRect(0,0,this.cacheClipWidth+t,this.cacheClipHeight+t).endFill())},updateBufferRegion:function(t){var e=this.tileWidth,i=this.tileHeight;this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((t.width+2*this.buffer)/e),this.cacheWidth/e>>0),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((t.height+2*this.buffer)/i),this.cacheHeight/i>>0),this.cacheClipWidth=this.cacheTilesWidth*e,this.cacheClipHeight=this.cacheTilesHeight*i,this.mapContainer.mask=(new o).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(t,e,i,n){this.populate(e,n),this.render(e,t,this.mapContainer,this.mapContainerWrapper,i,n),n&&n.set(e)},populateTiles:function(t,e){var i=0,n=0,s=0,r=0,o=null,a=Array.setUp();for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(n=t.top;n<=t.bottom;n++)if(!e||e.empty||n>e.bottom||n<e.top||i>e.right||i<e.left)for(r=0;r<this.imageMap.length;r++)(o=this.imageMap[r][i][n].getNext())&&(o.template&&a.push(o.template),o.x=(i+.5)*this.tileWidth,o.y=(n+.5)*this.tileHeight,this.tileContainer.addChild(o));for(s=0;s<a.length;s++)a[s].clear();a.recycle()},populateTilesAndEntities:function(t,e){var i=0,n=0,s=0,r=0,o=null,a=null,h=Array.setUp(),l=Array.setUp(),c=null;for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(n=t.top;n<=t.bottom;n++)if(!e||e.empty||n>e.bottom||n<e.top||i>e.right||i<e.left){for(r=0;r<this.imageMap.length;r++)(o=this.imageMap[r][i][n].getNext())&&(o.template&&l.push(o.template),o.x=(i+.5)*this.tileWidth,o.y=(n+.5)*this.tileHeight,this.tileContainer.addChild(o));if(this.doMap[i]&&this.doMap[i][n])for(c=this.doMap[i][n],s=0;s<c.length;s++)c[s].drawn||(c[s].drawn=!0,h.push(c[s]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),h.length)for(h.sort(y),s=0;s<h.length;s++)delete(a=h[s]).drawn,this.mapContainer.addChild(a),a.mask&&this.mapContainer.addChild(a.mask);for(s=0;s<l.length;s++)l[s].clear();l.recycle(),h.recycle()},renderCache:function(t,e,i,n,s,r){var o=this.renderer;s&&!r.empty&&(s.x=r.left*this.tileWidth,s.y=r.top*this.tileHeight,i.addChild(s)),u(o,e),i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight,o.render(n,e),e.requiresUpdate=!0},renderCacheWithExtrusion:function(t,e,i,n){var s=new o,r=this.renderer;s.lineStyle(1,0),s.drawRect(.5,.5,this.cacheClipWidth+1,this.cacheClipHeight+1),u(r,e),n.mask=s,i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight+1,r.render(n,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight,r.render(n,e),i.x=-t.left*this.tileWidth+2,i.y=-t.top*this.tileHeight+1,r.render(n,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+2,r.render(n,e),n.mask=null,i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+1,r.render(n,e),e.requiresUpdate=!0},updateGrid:function(){var t=this.cache,e=this.cacheTilesHeight,i=this.cacheTilesWidth,n=this.tilesHeight-1,s=this.tilesWidth-1,r=0,o=0,a=this.cacheGrid;for(r=0;r<a.length;r++)for(o=0;o<a[r].length;o++)t.setBounds(r*i,o*e,Math.min((r+1)*i,s),Math.min((o+1)*e,n)),this.update(a[r][o].texture,t)},toJSON:function(){for(var t=this.imageMap[0],e=[],i=t.length,n=0;i--;)for(n=t[i].length,e[i]=[];n--;)e[i][n]=t[i][n].id;return{type:"RenderTiles",buffer:this.buffer,cacheAll:this.cacheAll,entityCache:this.entityCache,imageMap:e,maximumBuffer:this.maximumBuffer,scaleX:this.scaleX,scaleY:this.scaleY,spriteSheet:this.spriteSheet,tileCache:this.tileCache,tileHeight:this.tileHeight,tileWidth:this.tileWidth,top:this.top,left:this.left}},destroy:function(){var t=0,e=0,i="",n=this.cacheGrid,s=this.doMap,r=this.imageMap;if(n){for(t=0;t<n.length;t++)for(e=0;e<n[t].length;e++)n[t][e].texture.destroy(!0),this.container.removeChild(n[t][e]);n.recycle(2),delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.container.removeChild(this.tilesSprite)):this.container.removeChild(this.mapContainer);for(i in r.recycle(2),this.tiles)this.tiles.hasOwnProperty(i)&&this.tiles[i].destroy();if(this.tiles=null,this.container=null,this.tilesSprite=null,this.spriteSheet.recycleSpriteSheet(),s){for(t=0;t<this.cachedDisplayObjects.length;t++)this.cachedDisplayObjects[t].destroy();for(this.cachedDisplayObjects.recycle(),t=0;t<s.length;t++)if(s[t]){for(e=0;e<s.length;e++)s[t][e]&&s[t][e].recycle();s[t].recycle()}s.recycle()}this.laxCam.recycle(),this.cache.recycle(),this.cachePixels.recycle()}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||n.spriteSheet;if(h){if("string"==typeof h&&"import"!==h)return t(h,a);if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}if(h.images)return h.images.greenSlice()}return Array.setUp()})})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ResizeSnapper",properties:{cameraSizes:null},publicProperties:{bottom:null,left:null,right:null,top:null,x:0,y:0},initialize:function(){this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.cameraSizesIndex=-1,this.cameraUpdated=!1},events:{"handle-logic":function(){if(!1!==this.owner.shouldSnap){var t=this.bottom,e=this.left,i=this.right,n=this.top;(this.lastBottom!==t||this.lastLeft!==e||this.lastRight!==i||this.lastTop!==n||this.cameraUpdated)&&(this.updatePosition(this.aabb),this.lastBottom=t,this.lastLeft=e,this.lastRight=i,this.lastTop=n,this.cameraUpdated=!1)}},"camera-update":function(t){this.aabb.set(t.viewport),this.cameraSizes&&this.checkCamera(this.aabb),this.cameraUpdated=!0},"force-update":function(){this.cameraUpdated=!0}},methods:{checkCamera:function(t){var e=this.cameraSizes,i=0,n=t.width/t.height;for(i=0;i<e.length;i++)if(n>e[i].minRatio){i!==this.cameraSizesIndex&&(this.updateProperties(e[i]),this.cameraSizesIndex=i);break}},updateProperties:function(t){this.right="number"==typeof t.right?t.right:null,this.left="number"==typeof t.left?t.left:null,this.top="number"==typeof t.top?t.top:null,this.bottom="number"==typeof t.bottom?t.bottom:null,"number"==typeof t.x&&(this.x=t.x),"number"==typeof t.y&&(this.y=t.y)},updatePosition:function(t){var e=this.bottom,i=this.left,n=this.owner,s=this.right,r=this.top;"number"==typeof i?n.x=t.left+i:"number"==typeof s&&(n.x=t.right-s),"number"==typeof r?n.y=t.top+r:"number"==typeof e&&(n.y=t.bottom-e),this.owner.triggerEvent("position-updated")},destroy:function(){this.aabb.recycle(),this.aabb=null}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"RightPanel",properties:{},publicProperties:{},initialize:function(){this.tweening=!1,this.vo="",this.showing=!1,this.c=0,this.hideTop=-250,this.showTop=0},events:{adopted:function(){this.tweening=!1,this.owner.top=this.hideTop},"camera-update":function(){},"activate-controls":function(){},"deactivate-controls":function(){},"show-mindy-panel":function(t){this.c=200,this.vo=t,this.show()},"hide-mindy-panel":function(){this.c>0||this.hide()},"handle-logic":function(){this.c>0&&this.c--}},methods:{hide:function(){this.tweening=!0,t.get(this.owner).to({top:this.hideTop},500,e.sineOut).call(function(){this.tweening=!1,this.showing=!1}.bind(this))},show:function(){this.tweening=!0,t.get(this.owner).to({top:this.showTop},500,e.sineOut).call(function(){this.tweening=!1,this.showing=!0,this.owner.parent.triggerEvent("show-mindy",this.vo)}.bind(this))}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Vector"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),n=function(t,e){return t*t+e*e},s={x:0,y:0},r={points:[s,s,s,s,s,s,s,s]},o=1+Math.SQRT2;platypus.createComponentClass({id:"Rod",properties:{faceUpward:!1,maximum:500,minimum:50,width:100,height:40,unpinnable:!1},publicProperties:{z:0,pointA:null,pointB:null,shape:null,trussLength:0,rotation:0,stretchLength:0,movable:!0},initialize:function(){var t,e=this.shape||r,i=this.owner.parent,n=e.points,s=n.length;for(this.shape={points:[]};s--;)this.shape.points.unshift({x:n[s].x,y:n[s].y});this.unpinnable&&this.movable&&(this.unpinnable=!1),this.onlyRemovingComponentSoDontDropThePins=!1,this.trussLength=this.trussLength||this.owner.width||this.minimum,t=this.trussLength/2,this.pointA=this.pointA||{x:this.owner.x-t,y:this.owner.y},this.unpinnable||(this.pinA=this.createOrFindPin(this.pointA,i)),this.pointB?this.unpinnable||(this.pinB=this.createOrFindPin(this.pointB,i)):(this.pointB={x:this.owner.x+t,y:this.owner.y},this.unpinnable||(this.pinB=this.createPin(this.pointB,i))),this.graceMargin=platypus.game.app.config.pins.snapGraceMargin,this.originalMax=this.maximum,this.originalMin=this.minimum,this.graceMax=2*this.maximum,this.graceMin=this.minimum/2,this.enactAdjustment(),this.owner.matchBodyToEntity(),this.unpinnable||(this.pinA.attach(this.owner,!0,!1),this.pinB.attach(this.owner,!0,!1)),this.inMotion=!1},events:{"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.RodFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.unpinnable||(t.entity===this.pinA?this.tryAdjustment(this.pinA,this.pinB,t):t.entity===this.pinB?this.tryAdjustment(this.pinB,this.pinA,t):platypus.debug.warn("Something odd occurred: notified about an unattached constraint movement."))},"pin-moved":function(){var t=this.pinA,e=this.pinB,i=this.pointA,n=this.pointB;t.x===i.x&&t.y===i.y&&e.x===n.x&&e.y===n.y||this.enactAdjustment()},"resolve-bodies":function(){this.owner.matchBodyToEntity()},"resolve-joints":function(){this.unpinnable||(this.pinA.resetJoints(),this.pinB.resetJoints())},"update-group-id":function(t){this.owner.groupId=t,this.unpinnable||(t!==this.pinA.groupId&&this.pinA.triggerEvent("update-group-id",t),t!==this.pinB.groupId&&this.pinB.triggerEvent("update-group-id",t))},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){var e=this.closestPin(t);this.unpinnable||(e===this.pointA?this.pinA=t:e===this.pointB?this.pinB=t:platypus.debug.warn("Rod: uh, this is odd."))},"pin-removed":function(t){t===this.pinA?this.pinA=null:t===this.pinB?this.pinB=null:platypus.debug.warn("Rod: A pin was removed that cannot be removed so it was not removed.")},"validate-begin-group-movement":function(t){this.unpinnable||t.invalid||!this.pinA.inDragGroup&&!this.pinB.inDragGroup||(t.invalid=!0)},"begin-group-movement":function(t){this.unpinnable||(this.pinA.triggerEvent("include-in-group",t),this.pinB.triggerEvent("include-in-group",t),this.inMotion=!0,this.owner.movable&&(this.pinA.immobile||this.pinB.immobile)?(this.pinA.split(this.owner),this.pinB.split(this.owner)):this.prepareForBreakage=!0)},"break-away":function(){this.prepareForBreakage&&(this.prepareForBreakage=!1,this.pinA.split(this.owner),this.pinB.split(this.owner))},"include-in-group":function(){this.prepareForBreakage=!1,this.inMotion=!0},"motion-ended":function(){this.inMotion=!1},"pin-motion-ended":function(){this.minimum=Math.min(this.trussLength,this.originalMin),this.maximum=Math.max(this.trussLength,this.originalMax)},"valid-snap":function(t,e){var i=t.pinFrom,n=t.pinTo;0===e?i===this.pinA?t.snappable=this.pinB.canSnapTo(t,e+1):i===this.pinB&&(t.snappable=this.pinA.canSnapTo(t,e+1)):1===e&&(this.pinA!==n&&this.pinB!==n||(t.snappable=!1))}},methods:{closestPin:function(t){var e=this.pointA,i=this.pointB;return n(e.x-t.x,e.y-t.y)>n(i.x-t.x,i.y-t.y)?i:e},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins);return i&&i!==this.pinA&&i!==this.pinB?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y}})},findPin:function(t,e){var i=platypus.game.app.config.pins.mergeDistance,s=0,r=null,o=e&&e.length,a=i*i,h=null;if(o)for(;o--;)r=e[o],(s=n(r.x-t.x,r.y-t.y))<a&&(a=s,h=r);return h},stretch:function(t,n){var s=this.owner,r=s.body,a=null,h=null,l=null,c=this.shape.points,p=this.pointA,u=this.pointB;if(4===c.length)!function(t,e,i){var n=t[0],s=t[1],r=t[2],o=t[3];n.x=-e,n.y=-i,s.x=e,s.y=-i,r.x=e,r.y=i,o.x=-e,o.y=i}(c,t/2,n/2);else if(6===c.length)!function(t,e,i){var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],h=t[5];n.x=-e,n.y=-i,s.x=e,s.y=-i,r.x=e+i,r.y=0,o.x=e,o.y=i,a.x=-e,a.y=i,h.x=-e-i,h.y=0}(c,t/2,n/2);else{if(8!==c.length)return void platypus.debug.warn(this.owner.type+": This entity is not using a rectangle for stretching.");!function(t,e,i){var n=i/o,s=t[0],r=t[1],a=t[2],h=t[3],l=t[4],c=t[5],p=t[6],u=t[7];s.x=-e-n,s.y=-i,r.x=e+n,r.y=-i,a.x=e+i,a.y=-n,h.x=e+i,h.y=n,l.x=e+n,l.y=i,c.x=-e-n,c.y=i,p.x=-e-i,p.y=n,u.x=-e-i,u.y=-n}(c,t/2,n/2)}s.x=(p.x+u.x)/2,s.y=(p.y+u.y)/2,r&&(l={},h=r.GetFixtureList(),0!==e(h)&&(a=h.GetFilterData(),l.filter={categoryBits:a.get_categoryBits(),groupIndex:a.get_groupIndex(),maskBits:a.get_maskBits()},l.density=h.GetDensity(),l.friction=h.GetFriction(),l.restitution=h.GetRestitution(),l.isSensor=h.IsSensor(),l.userData=i(h),r.DestroyFixture(h)),this.owner.createFixture(l,{}))},tryAdjustment:function(e,i,s){var r,o=null,a=s.position,h=a.x,l=a.y,c=null,p=this.minimum,u=this.maximum;this.inMotion||(this.owner.movable?(s.forSnap&&((p-=this.graceMargin)<this.graceMin&&(p=this.graceMin),(u+=this.graceMargin)>this.graceMax&&(u=this.graceMax)),(r=Math.sqrt(n(h-i.x,l-i.y)))<p?(c=t.setUp(i.x,i.y),s.adjusted=o=t.setUp(h,l),o.subtractVector(c).normalize(),0!==o.magnitude()?o.multiply(p).addVector(c):(o.x=p,o.addVector(c))):r>u&&(c=t.setUp(i.x,i.y),s.adjusted=o=t.setUp(h,l),o.subtractVector(c).normalize(),o.multiply(u).addVector(c))):s.adjusted=t.setUp(e.x,e.y))},enactAdjustment:function(){var t=this.owner,e=this.pinA,i=this.pinB,s=this.pointA,r=this.pointB,o=e?s.x=e.x:s.x,a=e?s.y=e.y:s.y,h=(i?r.x=i.x:r.x)-o,l=(i?r.y=i.y:r.y)-a,c=Math.sqrt(n(h,l)),p=Math.atan(l/h);!this.faceUpward&&h<0&&(p+=Math.PI),this.stretch(c,this.height),t.orientation=p,this.trussLength=c,this.stretchLength=c,this.rotation=180*p/Math.PI},destroy:function(){var t=this.pinA,e=this.pinB;this.onlyRemovingComponentSoDontDropThePins||(t&&!t.destroyed&&t.detachPermanently(this.owner),e&&!e.destroyed&&e.detachPermanently(this.owner))}},publicMethods:{}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),n=include("PIXI.spine.core.TextureAtlas",!1),s=include("PIXI.spine.core.AtlasAttachmentLoader",!1),r=include("PIXI.BaseTexture"),o=include("PIXI.spine.core.SkeletonJson",!1),a=include("PIXI.spine.Spine",!1),h=function(){var t=platypus.game.app,e=t.config.platypus;t.transition=new a(new o(new s(new n(e.atlases["ScreenBadge_Standard-"+platypus.modifyAllAssets],function(t,e){var i,n;e((i=t,(n=platypus.game.app.assetManager.cache.read(i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."))))||platypus.debug.warn('SavedGameChecker: "'+i+'" is not a loaded asset.'),new r(n)))}))).readSkeletonData(e.skeletons.ScreenBadge_Standard)),t.transition.children[0].mask=t.transition.children[2].children[0],platypus.savedWidth&&platypus.savedHeight&&(t.transition.x=platypus.savedWidth/2,t.transition.y=platypus.savedHeight/2,t.transition.scale.x=t.transition.scale.y=platypus.savedHeight/880),t.transition.visible=!1};platypus.createComponentClass({id:"SavedGameChecker",events:{"scene-live":function(){var t=platypus.game.app,i=platypus.savedGame;t.transition||e||setTimeout(h,100),i?platypus.game.loadScene("scene-level",{level:i.level}):this.owner.triggerEvent("relocate",{x:0,y:0}),springroll.Debug&&(this.owner.addEntity("debug-reset"),this.owner.addEntity("debug-unlock"))},"unlock-levels":function(){var t=platypus.game.app,e=t.userData;platypus.completedLevels=["level-1","level-2","level-3","level-4","level-5","level-6","level-7","level-8","level-9","level-10","level-11","level-12","level-13","level-14","level-15","level-16","level-17","level-18","level-19","level-20"],e.write("Completed-Levels",platypus.completedLevels),t.sound.play("badge-tada")},"reset-game":function(){var t=platypus.game.app,e=t.userData;platypus.completedLevels=[],e.remove("Completed-Levels"),e.remove("Recently-Completed-Level"),e.remove("LevelSaves"),e.remove("played-VO"),e.remove("last-level-played"),e.remove("Stars"),t.sound.play("reset"),t.sound.play("snap-photo")}},getAssetList:function(){return springroll.Debug?i.getAssetList({type:"debug-reset"}):Array.setUp()}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=0;platypus.createComponentClass({id:"SavedGameLister",properties:{},publicProperties:{},initialize:function(t,e){var i=platypus.game.app,n=platypus.game.app.config.journal;return this.saves=null,this.savesTotal=0,this.saveTime=Date.now(),this.buttons=[],this.owner.parent.app.userData.read(n.storageKey,function(t){var i=platypus.game.app,s=0,r=this.buttons,o=n.maxSavesPerGame;for(this.saves=t,s=0;s<o;s++)t&&t[s]?r.push(this.addSave(t[s],0,0,s)):r.push(this.addEmpty(0,0));this.tableColumns=this.tableColumns||3,this.updateLocations(),i.googleAnalytics.event(i.name,"EnterSaveMenu","NumberOfSaves",this.savesTotal),e()}.bind(this)),i.music="jam",i.musicInstance.volume=.5,platypus.badger.increment("tried-journal"),!0},events:{"camera-update":function(t){var e=t.viewport,i=e.width/e.height>1.766?3:2;this.tableColumns!==i&&(this.tableColumns=i,this.updateLocations())},"scene-loaded":function(t){var e=t.insertSave,i=null,n=this.owner.getEntitiesByType("journal-insert")[0];e?(this.insertSave=e,this.savedEntry=this.addSave(e,0,n.y,-1,function(){this.triggerEvent("insert-incoming")}.bind(this.owner),n.cameraSizes),(i=this.savedEntry.deletes).scaleX=.5,i.scaleY=.5,i.z=20,i.on("handle-render",function(t){t.x=this.x+135}.bind(i,this.savedEntry)),this.savedEntry.y=-550,this.savedEntry.z=30):this.saves&&this.saves.length?this.owner.triggerEvent("journal-some"):this.owner.triggerEvent("journal-none")},"return-to-game":function(){this.returnToGame&&this.returnToGame.deletes.triggerEvent("new-scene")},"delete-me":(t=function(t){this.removeEntity(t.deletes),this.removeEntity(t)},function(e){var i=platypus.game.app,n=i.userData,s=e.entity,r=this.savedEntry,o=i.config.journal;if(r){if(-1===s.deletes.saveIndex)return void s.deletes.triggerEvent("new-scene");this.saves[s.deletes.saveIndex]=this.insertSave,this.buttons[s.deletes.saveIndex]=this.returnToGame=this.addSave(this.insertSave,s.deletes.x,s.deletes.y,s.deletes.saveIndex),r.on("prepare-logic",t.bind(this.owner,r)),this.insertSave=null,this.savedEntry=null,this.owner.triggerEvent("inserted-save")}else this.saves[s.deletes.saveIndex]=null,this.buttons[s.deletes.saveIndex]=this.addEmpty(s.deletes.x,s.deletes.y);try{n.write(o.storageKey,this.saves)}catch(t){this.saves[s.deletes.saveIndex]&&(this.saves[s.deletes.saveIndex].thumbnail=null,n.write(o.storageKey,this.saves))}s.on("prepare-logic",t.bind(this.owner,s))})},methods:{addEmpty:function(t,e){var i=platypus.game.app.config.journal.thumbnail;return this.owner.addEntity({type:"saved-game-empty",properties:{width:i.width,height:i.height,x:t,y:e,z:8}})},addSave:function(t,n,s,r,o,a){var h=null,l=null,c=new Image,p=platypus.game.app.config.journal,u=platypus.modifyAllAssets,d=p.thumbnail.width/2,g=p.thumbnail.height/2,y=d/2,m=g/2;return this.savesTotal+=1,o&&(h=function(t,e){t.count-=1,t.count||(t.recycle(),e())}.bind(null,e.setUp("count",2),o)),t.thumbnail?c.src=t.thumbnail:c="thumbnail-backup",l=this.owner.addEntity({type:"saved-game-button",properties:{x:n,y:s,z:15,cameraSizes:a,spriteSheet:{id:"saved-ss-"+i,images:[c],frames:[[0,0,d*u,g*u,0,y*u,m*u]]},persistentData:{level:t.level,controls:t.controls},events:null,saveIndex:r}},h),i+=1,l.components[l.components.length-3].sprite.scale.x=2,l.components[l.components.length-3].sprite.scale.y=2,this.owner.addEntity({type:"delete-saved-game-button",properties:{deletes:l,x:n+y,y:s-m,z:16}},h)},updateLocations:function(){for(var t=this.buttons,e=null,i=t.length,n=platypus.game.app.config.journal,s=n.thumbnail.width,r=s/2,o=n.thumbnail.height,a=o/2,h=n.maxSavesPerGame,l=this.tableColumns,c=(h/l-1)/2,p=0,u=0,d=n.spacing+s,g=n.spacing+o;i--;)p=(i%l-(l-1)/2)*d,u=((i/l>>0)-c)*g,(e=t[i]).deletes&&(e.x=p+r,e.y=u-a,e=e.deletes),e.x=p,e.y=u,e.totalSaves=this.savesTotal},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitSaveMenu","SaveMenuTime",Date.now()-this.saveTime>>0)}},getAssetList:function(){return Array.setUp("assets/images/delete-button.png","assets/images/journal-frame.png","assets/images/thumbnail-backup.png")}})}(),function(){"use strict";var t=include("platypus.Data");platypus.createComponentClass({id:"SceneChanger",properties:{scene:"",persistentData:null},initialize:function(){this.persistentData=t.setUp(this.persistentData),this.loadingScene=!1},events:{"new-scene":function(t){var e=t||this,i=e.scene||this.scene,n=e.persistentData||this.persistentData;this.loadingScene||(this.loadingScene=!0,platypus.game.loadScene(i,n))},"set-scene":function(t){this.scene=t},"set-persistent-scene-data":function(t){var e=this.persistentData,i="";for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}},methods:{destroy:function(){}}})}(),function(){"use strict";platypus.createComponentClass({id:"Scroller",properties:{direction:""},publicProperties:{},initialize:function(){this.show=this.owner.left,this.hide=-this.owner.left},events:{adopted:function(){this.owner.state.set(this.direction,!0)},pointerdown:function(){this.owner.parent.triggerEvent("scroll-"+this.direction),this.owner.state.set(this.direction,!1),this.owner.state.set(this.direction+"-pressed",!0)},pointerup:function(){this.release()},pointerupoutside:function(){this.release()},pointercancel:function(){this.release()},"hide-sprite":function(){this.release()},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{release:function(){this.owner.state.set(this.direction+"-pressed",!1),this.owner.state.set(this.direction,!0)}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SetBGMusic",properties:{music:"",volume:1},publicProperties:{},initialize:function(){platypus.game.app.music=this.music,platypus.game.app.musicInstance.volume=this.volume},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("platypus.AABB"),i=include("platypus.Entity"),n={},s=function(t,e){return t*t+e*e};platypus.createComponentClass({id:"Ship",properties:{},publicProperties:{colliding:0},initialize:function(){this.camLock=null,this.handOut=!1,this.camera=e.setUp(),this.worldBounds=null,this.lvl="",this.vortexNum=0,this.attackerCount=0,this.ac=0,this.beaming=null,this.level16Badge=!1,this.flying=!1,this.beamFX=[],this.bc=0,this.playerReady=!1,this.npc||(platypus.game.app.getRobotLocationForLAP=function(){return{x:this.owner.x>>0,y:this.owner.y>>0}}.bind(this))},events:{adopted:function(){this.camLock=this.owner.parent.addEntity({type:"camLock",properties:{target:this.owner,x:this.owner.x,y:this.owner.y,levelId:this.owner.parent.levelId}}),"level-16"==this.owner.parent.levelId&&(this.level16Badge=!0)},"camera-loaded":function(t){if(this.worldBounds=t.world,this.lvl=this.owner.parent.levelId,"level-16"==this.lvl||"level-18"==this.lvl||"level-19"==this.lvl){var e=0,i=0;switch(this.lvl){case"level-16":22,e=2e3,i=0;break;case"level-18":200,e=0,i=2e3;break;case"level-19":50,e=0,i=0}for(var n=0;n<("level-16"==this.lvl?30:50);n++){var s=0,r=0,o=!1;do{s=this.randRange(this.worldBounds.left+e,this.worldBounds.right-e),r=this.randRange(this.worldBounds.top+i,this.worldBounds.bottom-i),o=Math.abs(s-this.owner.x)<500&&Math.abs(r-this.owner.y)<400}while(o);this.owner.parent.addEntity({type:"asteroid"+Math.round(this.randRange(1,9)),properties:{x:s,y:r,z:this.owner.z+1}})}}},"collide-with-asteroid":function(e){this.owner.parent.triggerEvent("ship-hit-asteroid"),"level-16"===this.owner.parent.levelId&&(this.level16Badge=!1),this.owner.parent.triggerEvent("asteroidHit");var i=Math.atan2(this.owner.y-e.entity.y,this.owner.x-e.entity.x);this.colliding=1,this.owner.body.SetLinearDamping(4),this.owner.body.SetAngularDamping(0),this.owner.body.ApplyLinearImpulse(new t(1e3*Math.cos(i),1e3*Math.sin(i)),this.owner.body.GetWorldCenter()),this.owner.body.ApplyTorque(this.randRange(25e3,1e5)*(Math.random()<.5?-1:1))},"collide-with-spaceJunk":function(e){"level-16"==this.owner.parent.levelId&&(this.level16Badge=!1),this.owner.parent.triggerEvent("clank");var i=Math.atan2(this.owner.y-e.entity.y,this.owner.x-e.entity.x);this.colliding=1,this.owner.body.SetLinearDamping(4),this.owner.body.SetAngularDamping(0),this.owner.body.ApplyLinearImpulse(new t(500*Math.cos(i),500*Math.sin(i)),this.owner.body.GetWorldCenter()),this.owner.body.ApplyTorque(this.randRange(1e4,5e4)*(Math.random()<.5?-1:1))},"level-16-end":function(){this.level16Badge&&platypus.badger.increment("license-to-drive")},"camera-update":function(t){this.camera.set(t.viewport)},"collide-with-wallGoal":function(){var e="";this.beaming&&"partBinBeamable"===this.beaming.owner.type||(this.owner.body.ApplyLinearImpulse(new t(0,500),this.owner.body.GetWorldCenter()),"level-17"==this.owner.parent.levelId?n[e="cantLeave"]||(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),n[e]=!0):n[e="dontLeave"]||(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),n[e]=!0))},vortex:function(){if(!(this.vortexNum>5)){this.owner.parent.addEntity({type:"vortex",properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+1,ship:this.owner}});this.vortexNum++,this.owner.parent.triggerEvent("spawnVortex")}},hand:function(){this.handOut||"level-17"===this.owner.parent.levelId||(this.needHandOut=!0)},"player-ready":function(){this.playerReady=!0,this.ac=2100},"handle-logic":function(t){if(this.colliding>0&&(this.colliding++,this.colliding>100&&(this.colliding=0,this.owner.body.SetLinearDamping(8),this.owner.body.SetAngularDamping(50))),this.needHandOut){this.needHandOut=!1,this.handOut=!0;for(var e=null,i=1e10,n=!1,r=0;r<t.entities.length;r++){var o=t.entities[r],a=o.type,h=0;"space-junk"==a||"star"==a||a.indexOf("satPart")>-1?(n=!0,(h=s(this.owner.x-o.x,this.owner.y-o.y))<i&&(e=o,i=h)):a.indexOf("asteroid")>-1&&(h=s(this.owner.x-o.x,this.owner.y-o.y))<i&&!n&&(e=o,i=h)}var l=this.randRange(0,6.3);null!==e&&(l=Math.atan2(e.y-this.owner.y,e.x-this.owner.x));var c=200*Math.cos(l),p=200*Math.sin(l);this.owner.parent.addEntity({type:"hand",properties:{x:this.owner.x+c,y:this.owner.y+p,z:this.owner.z-1,ship:this.owner}})}var u=this.owner.body.GetLinearVelocity(),d=this.owner.throttle;if("level-17"==this.lvl&&(d=15),u.get_x()>d&&(u.set_x(d),this.owner.body.SetLinearVelocity(u)),u.get_x()<-d&&(u.set_x(-d),this.owner.body.SetLinearVelocity(u)),u.get_y()>d&&(u.set_y(d),this.owner.body.SetLinearVelocity(u)),u.get_y()<-d&&(u.set_y(-d),this.owner.body.SetLinearVelocity(u)),Math.abs(u.get_x())>.5||Math.abs(u.get_y())>.5?(this.flying||this.owner.parent.triggerEvent("shipFly"),this.flying=!0):(this.flying&&this.owner.parent.triggerEvent("stop-audio","shipFly"),this.flying=!1),"level-20"==this.lvl&&this.playerReady&&(this.ac++,this.ac>2199&&this.ac%1100==0)){var g=this.randRange(-2,.5),y=1384+1500*Math.cos(g),m=1800+1500*Math.sin(g);this.owner.parent.addEntity({type:"asteroid-attack"+Math.round(this.randRange(1,6)),properties:{x:y,y:m,z:this.owner.z+1}}),this.attackerCount++}this.colliding||(this.owner.orientation>.025&&this.owner.body.ApplyTorque(-2500),this.owner.orientation<-.025&&this.owner.body.ApplyTorque(2500))}},methods:{destroy:function(){this.camLock=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{handReturn:function(){this.handOut=!1},vortexRemoved:function(){this.vortexNum--},beamConnect:function(t){return t?this.beaming||("partBinBeamable"===t.owner.type&&platypus.game.app.userData.read("played-VO",function(t){var e="binBeam";null===t&&(t=[]),-1===t.indexOf(e)&&(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this)),this.beaming=t,this.owner.parent.triggerEvent("beamLoop")):(this.beaming=t,this.owner.parent.triggerEvent("stop-audio","beamLoop")),this.beaming}},getAssetList:function(){for(var t=null,e=["camLock","asteroid1","vortex","hand"],n=e.length,s=Array.setUp();n--;)t=i.getAssetList({type:e[n]}),s.union(t),t.recycle();return s}})}(),function(){"use strict";var t=2,e={pointA:"json",pointB:"json",radius:"string",renderGroup:"string",stretchLength:"string",trussLength:"string"},i=include("Box2D.b2Vec2"),n=include("Box2D.destroy"),s=include("Box2D.getPointer"),r=function(t,e,i,n){switch(t){case"json":o(e,i,n);break;default:a(e,i,n)}},o=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:JSON.stringify(e[i])})},a=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:e[i]+""})};platypus.createComponentClass({id:"Sim",properties:{},publicProperties:{movable:!0,savable:!1,inBuildingArea:!1,interactive:!1,simulating:!1},initialize:function(){this.allowSleep=!1,this.sensors=Array.setUp(),this.activeType=0,this.snapShot=null},events:{load:function(){!this.simulating&&this.movable||this.owner.triggerEvent("remove-dragging",!0,this.simulating)},"box2d-body-initialized":function(){var e=this.owner.body,i=e.GetFixtureList(),n=this.sensors;if(!this.simulating)for(e.IsSleepingAllowed()&&(this.allowSleep=!0,e.SetSleepingAllowed(!1)),this.activeType=e.GetType(),this.interactive&&this.activeType!==t&&(e.SetType(t),this.owner.parent.buildingArea&&(this.inBuildingArea=this.owner.parent.buildingArea.body.GetFixtureList().TestPoint(e.GetPosition())));0!==s(i);)n.push(i.IsSensor()),i.SetSensor(!0),i=i.GetNext()},"retrieve-save-state":function(t,i){var n=null;(this.savable||i&&"boolean"==typeof this.owner.movable&&!this.owner.neverSave)&&(n=function(t,i){var n=e,s="",o=[],a={height:t.height||0,id:0,name:"",properties:o,rotation:t.rotation||0,type:t.type,visible:!0,width:t.width||0,x:t.x||0,y:t.y||0},h=!1;for(s in o.push({name:"z",type:"string",value:t.z%1e3}),t.shape&&t.saveShape?t.shape.points?(h=!0,a.polygon=t.shape.points):(o.push({name:"shape",type:"string",value:JSON.stringify(t.shape)}),"circle"===t.shape.type&&(a.ellipse=!0,a.width=2*t.shape.radius,a.height=2*t.shape.radius),a.x-=a.width/2,a.y-=a.height/2):(a.x-=a.width/2,a.y-=a.height/2),h||t.width||t.height||(a.point=!0),n)n.hasOwnProperty(s)&&r(n[s],o,t,s);return!i&&t.savable&&o.push({name:"savable",type:"string",value:"true"}),i&&t.movable&&o.push({name:"movable",type:"string",value:"false"}),a}(this.owner,i),t.push(n)),this.owner.snapShot=this.snapShot={rotation:this.owner.rotation,x:this.owner.x,y:this.owner.y}},"restore-save-state":function(){var t,e;this.snapShot?(t=this.owner,e=this.snapShot,t.x=e.x,t.y=e.y,t.rotation=e.rotation,t.body&&t.body.SetActive(!0)):this.savable&&this.owner.parent.removeEntity(this.owner)},"simulation-started":function(){var e=this.owner.body,i=null,n=this.sensors,r=0;if(!this.simulating&&e)for(this.simulating=!0,this.interactive&&this.activeType!==t&&e.SetType(this.activeType),this.allowSleep&&e.SetSleepingAllowed(!0),i=e.GetFixtureList();0!==s(i);)i.SetSensor(n[r]),r+=1,i=i.GetNext();this.owner.triggerEvent("prepare-for-simulation"),this.owner.triggerEvent("remove-dragging",!1,!0)},"simulation-stopped":function(){var e=this.owner.body,r=null,o=null;if(this.simulating&&e)for(this.simulating=!1,this.interactive&&this.activeType!==t&&e.SetType(t),this.allowSleep&&e.SetSleepingAllowed(!1),o=new i(0,0),e.SetAngularVelocity(0),e.SetLinearVelocity(o),this.owner.orientation=0,this.owner.matchBodyToEntity(),n(o),r=e.GetFixtureList();0!==s(r);)r.SetSensor(!0),r=r.GetNext();this.owner.triggerEvent("restore-dragging",!1,!0)}},methods:{destroy:function(){this.sensors.recycle(),this.sensors=null}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"Soil",properties:{},publicProperties:{collected:!1},initialize:function(){this.boopContacts=0,this.dirtFX=[]},events:{"get-soil":function(){if(this.boopContacts>0&&!this.collected){this.owner.state.set("collected",!0),this.collected=!0,this.owner.parent.inventory.push("soil"),this.owner.parent.parent.layers[3].triggerEvent("add-to-inventory",this.owner),this.owner.triggerEvent("collect-soil"),this.owner.parent.triggerEvent("dig");for(var t=0;t<30;t++){var e=this.randRange(.33,1.25),i=this.owner.parent.addEntity({id:"dirtFX"+t,components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"dirt"}}],properties:{x:this.owner.x+this.randRange(-50,50),y:this.owner.y,z:this.owner.z+1,opacity:.5,scaleX:e,scaleY:e,speedX:this.randRange(-.5,.5),speedY:this.randRange(-.66,-.1)}});this.dirtFX.push(i)}}},"handle-logic":function(){var t=!1;if(this.dirtFX.length>0)for(var e in this.dirtFX){var i=this.dirtFX[e];i.x+=i.speedX,i.y+=i.speedY,i.opacity-=.001,i.speedX*=.995,i.speedY*=.995,i.opacity<0&&(t=!0)}if(t){for(var n in this.dirtFX){var s=this.dirtFX[n];this.owner.parent.removeEntity(s)}this.dirtFX=[]}},"collide-with-boop":function(){this.boopContacts++},"end-collide-with-boop":function(){this.boopContacts--}},methods:{destroy:function(){},randRange:function(t,e){return Math.random()*(e-t)+t}},getAssetList:function(){return Array.setUp("assets/images/fx.png")}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"SpaceJunk",properties:{},publicProperties:{attack:!1},initialize:function(){this.remove=!1},events:{adopted:function(){if("level-16"==this.owner.parent.levelId){var e=new t(this.randRange(-1,1),this.randRange(-1,1));this.owner.body.SetLinearVelocity(e),this.owner.body.SetTransform(this.owner.body.GetWorldCenter(),this.randRange(0,6)),this.owner.body.ApplyTorque(this.randRange(-250,250))}if(this.attack){var i=Math.atan2(1800-this.owner.y,1384-this.owner.x)*this.randRange(.8,1.2),n=new t(Math.cos(i)*this.randRange(1,1.5),Math.sin(i)*this.randRange(1,1.5));this.owner.body.SetLinearVelocity(n)}},"handle-logic":function(){},"collide-with-goal":function(){this.remove=!0,this.owner.parent.triggerEvent("hand")},"collide-with-vortex":function(){this.remove=!0},"collide-with-satellite":function(){this.remove=!0},"prepare-logic":function(){this.remove&&(this.owner.parent.removeEntity(this.owner),this.remove=!1)}},methods:{destroy:function(){},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Star",properties:{eject:!1,falling:!1,alt:!1},publicProperties:{},initialize:function(){this.originX=0,this.originY=0,this.hoverC=1,this.hoverForce=new t(0,0),this.remove=!1,this.removing=!1,this.fx=[],this.fxc=0,this.fade=1},events:{"handle-logic":function(){this.removing&&this.owner.scaleX>0&&(this.owner.scaleX-=.02,this.owner.scaleY-=.02,this.owner.rotation+=5);var t=!1;if(this.fx.length>0)for(var e in this.fxc++,t=this.fxc>400,this.fx){var i=this.fx[e];i.x+=i.speedX,i.y+=i.speedY,i.opacity-=.0025,i.speedX*=.99,i.speedY*=.99}if(t){for(var n in this.fx){var s=this.fx[n];this.owner.parent.removeEntity(s)}return this.fx=[],this.fxc=0,void(this.remove=!0)}1!=this.owner.body.GetGravityScale()&&(this.hoverC+=.02,this.owner.x+=.05*Math.cos(.3*this.hoverC),this.owner.y+=.2*Math.sin(1.1*this.hoverC),this.owner.rotation+=.025*Math.sin(this.hoverC),this.falling&this.fade<1&&(this.fade-=.005,this.owner.opacity=this.fade,this.owner.opacity<.01&&(this.remove=!0)))},adopted:function(){this.originX=this.owner.x,this.originY=this.owner.y,platypus.game.app.userData.read("Stars",function(t){if(null!==t){var e=this.owner.parent.levelId;t.indexOf(e)>-1&&(this.owner.opacity=.5)}}.bind(this)),this.eject&&(this.owner.body.SetGravityScale(1),this.owner.body.ApplyForce(new t(-1e3,-2e3),this.owner.body.GetWorldCenter())),this.falling&&this.owner.body.SetGravityScale(.1)},"collide-with-ground":function(){this.falling&&(this.fade=.99)},collected:function(){var t=platypus.game.app;if(!this.removing){this.removing=!0,this.falling=!1,this.fade=1,this.alt||this.owner.body.SetGravityScale(1),platypus.game.app.userData.read("played-VO",function(t){null===t&&(t=[]);var e="star";-1==t.indexOf(e)&&(this.owner.parent.parent.layers[2].triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this)),platypus.game.app.userData.read("Stars",function(t){null===t&&(t=[]);var e=this.owner.parent.levelId;-1==t.indexOf(e)&&(t.push(e),platypus.game.app.userData.write("Stars",t))}.bind(this)),platypus.badger.increment("star-"+this.owner.parent.levelId),this.owner.parent.parent.layers[2].triggerEvent("star-ui-show");for(var e=0;e<18;e++){var i=20*e,n=this.owner.parent.addEntity({id:"starFX",components:[{type:"RenderSprite",spriteSheet:"star",rotate:!0}],properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+1,scaleX:.2,scaleY:.2,opacity:.75,speedX:5*Math.cos(i*(Math.PI/180)),speedY:5*Math.sin(i*(Math.PI/180))}});this.fx.push(n)}this.owner.parent.triggerEvent("star"),t.analyticsEmitter.collectedStar(t.levelBot||"",t.levelNumber||0,{x:this.owner.x>>0,y:this.owner.y>>0})}},"prepare-logic":function(){this.remove&&(this.owner.parent.removeEntity(this.owner),this.remove=!1)},"hit-trash":function(){this.owner.body.SetGravityScale(1)}},methods:{destroy:function(){this.hoverForce=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"StarUI",properties:{},publicProperties:{},initialize:function(){},events:{adopted:function(){this.owner.triggerEvent("hide-sprite")},"star-ui-show":function(i){this.owner.triggerEvent("show-sprite"),t.get(this.owner).to({scaleX:.75,scaleY:.75},150,e.sineOut).call(function(){t.get(this.owner).to({scaleX:.4,scaleY:.4},150,e.sineIn).call(function(){}.bind(this))}.bind(this))}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Suckable",properties:{ejectSpeed:0,carried:!1,slow:!1},publicProperties:{disconnected:!1},initialize:function(){this.attractedTo=null,this.suckForce=new t(0,0),this.originX=0,this.originY=0,this.remove=!1,this.magJoint=null,this.createMagJoint=null,this.canEnterJet2=0,this.connectedTo=null,this.lvl12Damaged=!1},events:{adopted:function(){if(this.originX=this.owner.x,this.originY=this.owner.y,0!==this.ejectSpeed){this.owner.body.GetFixtureList().GetDensity()<.002&&(this.owner.body.GetFixtureList().SetDensity(.1),this.owner.body.ResetMassData());var e=new t(.2*this.ejectSpeed,-1*Math.abs(.8*this.ejectSpeed));this.owner.body.ApplyLinearImpulse(e,this.owner.body.GetWorldCenter()),this.owner.body.SetGravityScale(1),this.owner.body.ApplyTorque(this.randRange(-10,10)),this.owner.parent.triggerEvent("ejectFX")}this.slow&&this.owner.body.SetGravityScale(.075)},"handle-logic":function(){if(this.attractedTo&&!this.magJoint){if((this.owner.x<this.attractedTo.x?"L":"R")!=this.attractedTo.facing&&!this.attractedTo.magnet)return;if((a=this.attractedTo.x-this.owner.x,h=this.attractedTo.y-this.owner.y,a*a+h*h)>15e4)return;this.slow&&this.owner.body.SetGravityScale(1);var e=this.owner.body.GetWorldCenter(),i=this.attractedTo.body.GetWorldCenter(),n=0;"X"!=this.attractedTo.facing&&(n=-1);var s=new t(i.get_x()-e.get_x(),i.get_y()+n-e.get_y()),r=s.Length(),o=("X"==this.attractedTo.facing?30:40)*this.owner.body.GetMass()*7/(r*r);this.suckForce.set_x(s.get_x()*o),this.suckForce.set_y(s.get_y()*o*3),this.owner.body.ApplyForce(this.suckForce,this.owner.body.GetWorldCenter(),!0),this.canEnterJet2=200}var a,h;this.canEnterJet2>0&&this.canEnterJet2--},"magnet-on":function(t){0===this.owner.body.GetGravityScale()||this.carried||this.attractedTo||(this.attractedTo=t)},"magnet-off":function(t){0===this.owner.body.GetGravityScale()||this.carried||(this.attractedTo=null)},"collide-with-magnet":function(t){!this.magJoint&&this.attractedTo&&(this.createMagJoint=t.entity,this.collided(t))},"collide-with-goal":function(t){var e=platypus.game.app;"level-17"!=this.owner.parent.levelId&&(this.remove||(this.remove=!0,this.owner.parent.triggerEvent("hand"),this.owner.parent.triggerEvent("enterBin"),this.owner.parent.triggerEvent("good"),e.analyticsEmitter.inTheBin(e.levelBot||"",e.levelNumber||0,this.owner.type,{x:this.owner.x>>0,y:this.owner.y>>0})),this.collided(t))},"prepare-logic":function(){this.remove&&(this.magJoint&&this.disconnect(),this.owner.parent.removeEntity(this.owner),this.remove=!1),this.createMagJoint&&(this.magJoint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:0},length:55,collideConnected:!0},this.createMagJoint,1),this.createMagJoint.addTrash(this),this.owner.body.SetGravityScale(0),this.connectedTo=this.createMagJoint,this.createMagJoint=null)},"collide-with-jet2":function(t){(null!==this.attractedTo||this.canEnterJet2>0)&&(this.remove=!0,this.owner.parent.triggerEvent("suckable-touch-jet2",this.owner),this.owner.parent.triggerEvent("enterJet"))},"collide-with-ground":function(t){this.owner.body.SetAngularDamping(5),this.slow&&(this.owner.body.SetGravityScale(1),this.lvl12Damaged||this.owner.parent.triggerEvent("part-hit-ground"),this.lvl12Damaged=!0),this.owner.body.GetLinearVelocity()>1&&this.owner.parent.triggerEvent("thud"),this.collided(t)},"collide-with-trash":function(t){this.owner.body.SetGravityScale(1),this.collided(t)},"collide-with-apple":function(t){this.owner.body.SetGravityScale(1),this.collided(t)},"collide-with-apple-in-tree":function(t){this.owner.body.SetGravityScale(1),this.owner.parent.triggerEvent("supress-hint"),this.collided(t)}},methods:{destroy:function(){this.attractedTo=null,this.suckForce=null,this.magJoint=null,this.createMagJoint=null,this.connectedTo=null},randRange:function(t,e){return Math.random()*(e-t)+t},collided:function(t){var e=platypus.game.app;this.owner.reportEjectionCollision&&(this.owner.reportEjectionCollision=!1,e.analyticsEmitter.collisionReport(e.levelBot||"",e.levelNumber||0,{x:this.owner.x>>0,y:this.owner.y>>0},this.owner.type,t.entity?t.entity.type:"ground"))}},publicMethods:{released:function(){this.carried=!1},disconnect:function(t){this.disconnected=!0,null!==this.connectedTo&&(this.owner.body.SetGravityScale(1),this.owner.removeJoint(this.magJoint),this.magJoint=null,this.attractedTo=null,t||this.connectedTo.removeTrash(this),this.connectedTo=null)}}})}(),function(){"use strict";platypus.createComponentClass({id:"Target",properties:{},publicProperties:{},initialize:function(){this.remove=!1,this.scaleC=0},events:{"prepare-logic":function(){this.remove&&(this.owner.parent.removeEntity(this.owner),this.remove=!1),this.owner.rotation+=.33,this.scaleC+=.01,this.owner.scaleX=1+.1*Math.cos(this.scaleC),this.owner.scaleY=this.owner.scaleX}},methods:{},publicMethods:{removeThis:function(){this.owner.triggerEvent("good-photo"),this.remove=!0}}})}(),function(){"use strict";var t,e,i=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?(?:(([^\/?]+)\.(\w+))|([^\/?]+))(?:\?((?:(?:[^&]*?[\/=])?(?:((?:(?:[^\/?&=]+)\.(\w+)))\S*?)|\S+))?)?$/,n=include("platypus.AABB"),s=include("platypus.Data"),r=include("platypus.Entity"),o=(t=function(t,e){return t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24)>>>0},e=function(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0},function(i,n){var s=4,r=[],o=atob(i.replace(/\\/g,""));if("zlib"===n)for(o=pako.inflate(o);s<=o.length;)r.push(e(o,s-4)),s+=4;else for(;s<=o.length;)r.push(t(o,s-4)),s+=4;return r}),a=function(t){var e=t.match(i);return e[5]||e[7]},h=function(t){for(var e=1;e<t;)e*=10;return e},l={x:1,y:1,id:-1},c=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},p=function(t,e,i){var n=0;if(t)if(Array.isArray(t)){for(n=t.length;n--;)if(t[n].name===e)return t[n].type=typeof i,void(t[n].value=i);t.push({name:e,type:typeof i,value:i})}else t[e]=i},u=function(t,e){var i,n,s,r,o=0,a=t.gid||-1,h={},c={gid:-1,transform:null,properties:h,type:""},p=null,u=null,g=0;for(-1!==a&&(c.transform=(s=!!(1073741824&(i=a)),r=!!(2147483648&i),(n=l).id=268435455&i,n.x=1,n.y=1,s&&(n.y=-1),r&&(n.x=-1),n),a=c.gid=l.id),o=0;o<e.length&&!(e[o].firstgid>a);o++)u=e[o];return u&&(g=a-u.firstgid,u.tileproperties&&u.tileproperties[g]&&(p=u.tileproperties[g]),u.tiles&&u.tiles[g]&&(c.type=u.tiles[g].type||"")),c.type=t.type||c.type,""===c.type&&(t.name?(c.type=t.name,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type using the "name" property has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):p&&(p.entity?(c.type=p.entity,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type using the "entity" property in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):p.type&&(c.type=p.type,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')))),c.type?(c.transform?(h.scaleX=c.transform.x,h.scaleY=c.transform.y):(h.scaleX=1,h.scaleY=1),d(p,c.properties),d(t.properties,c.properties),c):null},d=function(t,e){var i=0,n="";if(t&&e)if(Array.isArray(t))for(i=0;i<t.length;i++)p(e,t[i].name,g(t[i].value));else for(n in t)t.hasOwnProperty(n)&&p(e,n,g(t[n]));return e},g=function(t){var e=0;if("string"==typeof t){if(0===(e=parseFloat(t))||e)return e;if("true"===t)return!0;if("false"===t)return!1;if(t.length>1&&("{"===t[0]&&"}"===t[t.length-1]||"["===t[0]&&"]"===t[t.length-1]))try{return JSON.parse(t)}catch(t){}}return t},y=function(t,e){var i=0,n=0,o=Array.setUp(),a=null,h=Array.setUp(),l=null,p=null,d=null;if("string"==typeof t&&(t=platypus.game.settings.levels[t]),t)if(t.tilesets&&(t.tilesets=f(t.tilesets)),t.assets)h.union(t.assets);else if(t.layers){for(i=0;i<t.layers.length;i++)if("objectgroup"===t.layers[i].type)for(n=0;n<t.layers[i].objects.length;n++)(p=u(t.layers[i].objects[n],t.tilesets))&&(d=r.getAssetList(p),h.union(d),d.recycle());else"imagelayer"===t.layers[i].type?h.union([t.layers[i].image]):(p=c(t.layers[i].properties,"entity"))&&(l=s.setUp("type",p),a=r.getAssetList(l),h.union(a),a.recycle(),l.recycle());if(!e){for(i=0;i<t.tilesets.length;i++)o.push(t.tilesets[i].image);h.union(o),o.recycle()}t.assets=h.greenSlice()}return h},m={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]}},v=function(t){var e="",i=platypus.game.settings.levels[t.source.replace(".json","")];for(e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return delete t.source,t},f=function(t){var e=0;for(e=0;e<t.length;e++)t[e].source&&(t[e]=v(t[e]));return t};platypus.createComponentClass({id:"TiledLoader",properties:{offsetMap:!1,showCollisionTiles:!1,images:null,layerIncrement:1e3,separateTiles:!1,spriteSheet:null},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},initialize:function(){this.assetCache=platypus.game.app.assetManager.cache,this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(t,e){this.manuallyLoad||(e.count+=1,this.loadLevel({level:this.level||t.level,persistentData:t},e.release))},"load-level":function(t,e){this.loadLevel(t,e)}},methods:{createLayer:function(t,e,i,n,s,o,a,h,l,p){var u=null,g=null,y=e.width,v=e.height,f=e.tileheight||o,w=e.tilewidth||s,b=0,x=0,E=0,A=0,C=0,S=JSON.parse(JSON.stringify(platypus.game.settings.entities[t]||m[t])),k={},B=[],P=[],M=[],T={images:e.image?[e.image]:h,frames:P,animations:k},L=!1,D=null,I=null,X=0,z=0,R=0,_="",U=null,O=function(t,e,i,n){var s=i.margin||0,r=i.spacing||0,o=i.tilewidth,a=i.tileheight,h=o/2,l=a/2,c=o+r,p=a+r,u=2*s-r,d=i.columns||i.imagewidth/c+u>>0,g=i.imageheight/p+u>>0,y=0,m=0;for(o*=n,a*=n,h*=n,l*=n,c*=n,p*=n,m=0;m<g;m++)for(y=0;y<d;y++)t.push([s+y*c,s+m*p,o,a,e,h,l])};if(this.decodeLayer(e),U=e.data,i+=e.offsetx||0,n+=e.offsety||0,S.properties=S.properties||{},e.properties){if((A=c(e.properties,"width"))&&(b=parseInt(A,10)),(E=c(e.properties,"height"))&&(x=parseInt(E,10)),b||x){for(b=b||y,x=x||v,U=[],z=0;z<b;z++)for(R=0;R<x;R++)U[z+R*b]=z<y&&R<v?e.data[z+R*y]:0;y=b,v=x}d(e.properties,S.properties)}if("collision-layer"===t)for(I=[],z=0;z<a.length;z++)if((D=a[z]).tileproperties)for(_ in D.tileproperties)D.tileproperties.hasOwnProperty(_)&&D.tileproperties[_].jumpThrough&&I.push(D.firstgid+parseInt(_,10));if(S.properties.width=w*y*this.unitsPerPixel,S.properties.height=f*v*this.unitsPerPixel,S.properties.columns=y,S.properties.rows=v,S.properties.tileWidth=w*this.unitsPerPixel,S.properties.tileHeight=f*this.unitsPerPixel,S.properties.scaleX=this.imagesScale,S.properties.scaleY=this.imagesScale,S.properties.layerZ=this.layerZ,S.properties.left=S.properties.x||i,S.properties.top=S.properties.y||n,S.properties.z=S.properties.z||this.layerZ,a.length){for(z=0;z<a.length;z++)O(P,z,a[z],this.unitsPerPixel/this.imagesScale);for(C=(u=a[a.length-1]).firstgid+u.tilecount,z=-1;z<C;z++)k["tile"+z]=z}for(z=0;z<y;z++)for(B[z]=[],M[z]=[],R=0;R<v;R++)X=+U[z+R*y]-1,M[z][R]="tile"+X,X+=1,I&&I.length&&I[0]===(268435455&X)&&(X|=268435456),B[z][R]=X;for(z=0;z<S.components.length;z++)"RenderTiles"===S.components[z].type&&(L=S.components[z]),"import"===S.components[z].spriteSheet?S.components[z].spriteSheet=T:S.components[z].spriteSheet&&("string"==typeof S.components[z].spriteSheet&&platypus.game.settings.spriteSheets[S.components[z].spriteSheet]&&(S.components[z].spriteSheet=platypus.game.settings.spriteSheets[S.components[z].spriteSheet]),S.components[z].spriteSheet.animations||(S.components[z].spriteSheet.animations=k)),"import"===S.components[z].collisionMap&&(S.components[z].collisionMap=B),"import"===S.components[z].imageMap&&(S.components[z].imageMap=M);return this.layerZ+=this.layerIncrement,"render-layer"===t&&!this.separateTiles&&l&&l.tileHeight===f&&l.tileWidth===w&&l.columns===y&&l.rows===v?(l.triggerEvent("add-tiles",L),this.updateLoadingProgress(p),l):(g={},"render-layer"===t&&this.spriteSheet&&("string"==typeof this.spriteSheet?g.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]:g.spriteSheet=this.spriteSheet,g.spriteSheet.animations||(g.spriteSheet.animations=k)),this.owner.addEntity(new r(S,{properties:g},this.updateLoadingProgress.bind(this,p),this.owner)))},convertImageLayer:function(t){var e,i=null,n=0,s="",r=t.properties||{},o=c(r,"repeat"),h=c(r,"repeat-x"),l=c(r,"repeat-y"),p={data:[],image:"",height:1,name:t.name,type:"tilelayer",width:1,tileheight:1,tilewidth:1,x:t.x,y:t.y,properties:r};for(o&&(p.width=+o,p.height=+o),h&&(p.width=+h),l&&(p.height=+l),e=p.width*p.height,n=0;n<e;n++)p.data.push(1);return(i=this.assetCache.read(t.name))?(p.image=t.name,p.tileheight=i.height,p.tilewidth=i.width):(s=a(t.image),(i=this.assetCache.read(s))?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+t.name+'", so using "'+t.image+'" instead.'),p.image=s,p.tileheight=i.height,p.tilewidth=i.width):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+t.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+t.name+'".'),p.image=t.image)),p.tileset={columns:1,image:p.image,imageheight:p.tileheight,imagewidth:p.tilewidth,margin:0,name:t.name,spacing:0,tilecount:1,tileheight:p.tileheight,tilewidth:p.tilewidth,type:"tileset"},p},loadLevel:function(t,e){var i,r,o,l,p,u,g=!0,y=null,m=0,v="",w=null,b=null,x=null,E=null,A=s.setUp("count",0,"progress",0,"total",0),C=0,S=0;if(i=(y="string"==typeof t.level?platypus.game.settings.levels[t.level]:t.level).layers,o=f(y.tilesets),l=y.tilewidth,p=y.tileheight,y.properties&&d(y.properties,this.owner),0===(w=this.images?this.images.greenSlice():Array.setUp()).length)for(m=0;m<o.length;m++)E=o[m],this.assetCache.read(E.name)?w.push(E.name):(v=a(E.image),this.assetCache.read(v)?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+E.name+'", so using "'+E.image+'" instead.'),w.push(v)):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+E.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+E.name+'".'),w.push(E.image)));for(u=y.width*l*this.unitsPerPixel,r=y.height*p*this.unitsPerPixel,this.offsetMap&&(C=h(u),S=h(r)),A.total=m=i.length;m--;)"objectgroup"===i[m].type?A.total+=i[m].objects.length:!g||"collision"!==i[m].name&&"collision-layer"!==c(i[m].properties,"entity")||(g=!1);for(this.finishedLoading=function(t,e,i,r,o,a,h,l){var c=s.setUp("level",null,"world",n.setUp(),"tile",n.setUp(),"camera",null);c.level=t,c.camera=this.followEntity,c.width=r,c.height=o,c.world.setBounds(e,i,e+r,i+o),c.tile.setBounds(0,0,a,h),this.owner.triggerEvent("world-loaded",c),c.world.recycle(),c.tile.recycle(),c.recycle(),this.owner.removeComponent(this),l&&l()}.bind(this,y,C,S,u,r,l,p,e),m=0;m<i.length;m++)switch((x=i[m]).type){case"imagelayer":b=this.convertImageLayer(x),b=this.createLayer("image-layer",b,C,S,b.tilewidth,b.tileheight,[b.tileset],w,b,A);break;case"objectgroup":this.setUpEntities(x,C,S,l,p,o,A),b=null,this.updateLoadingProgress(A);break;case"tilelayer":b=this.setupLayer(x,g,b,C,S,l,p,o,w,A);break;default:platypus.debug.warn('Component TiledLoader: Platypus does not support Tiled layers of type "'+x.type+'". This layer will not be loaded.'),this.updateLoadingProgress(A)}},setUpEntities:function(t,e,i,n,s,o,a){var h=0,l=0,p=0,d=0,g=0,y=0,m=0,v=null,f=0,w=null,b=null,x=null,E=c(t.properties,"entityPositionX")||this.entityPositionX,A=c(t.properties,"entityPositionY")||this.entityPositionY,C="",S=-1,k=1/0,B=-1/0,P=1/0,M=-1/0,T=null,L=null,D=null,I=0,X=0;for(e+=t.offsetx||0,i+=t.offsety||0,f=0;f<t.objects.length;f++)if(w=t.objects[f],T=u(w,o)){if(S=T.gid,C=T.type,x=(b=platypus.game.settings.entities[C])&&b.properties||null,L=T.properties,w.polygon||w.polyline){for(k=1/0,B=-1/0,P=1/0,M=-1/0,D=null,w.polygon?D=w.polygon:w.polyline&&(D=w.polyline),p=0;p<D.length;p++)D[p].x>B&&(B=D[p].x),D[p].x<k&&(k=D[p].x),D[p].y>M&&(M=D[p].y),D[p].y<P&&(P=D[p].y);if(L.width=B-k,L.height=M-P,L.x=w.x+k,L.y=w.y+P,h=0,l=0,L.width=L.width*this.unitsPerPixel,L.height=L.height*this.unitsPerPixel,L.x=L.x*this.unitsPerPixel+e,L.y=L.y*this.unitsPerPixel+i,w.polygon)for(L.shape={},L.shape.type="polygon",L.shape.points=[],d=0;d<D.length;d++)L.shape.points.push({x:(D[d].x-k)*this.unitsPerPixel+e,y:(D[d].y-P)*this.unitsPerPixel+i});else if(w.polyline)for(L.shape={},L.shape.type="polyline",L.shape.points=[],d=0;d<D.length;d++)L.shape.points.push({x:(D[d].x-k)*this.unitsPerPixel+e,y:(D[d].y-P)*this.unitsPerPixel+i})}else I=n*this.unitsPerPixel,X=s*this.unitsPerPixel,h=0,l=0,L.width=(w.width||0)*this.unitsPerPixel,L.height=(w.height||0)*this.unitsPerPixel,x&&("number"==typeof x.width&&(L.width=x.width,h=I),"number"==typeof x.height&&(L.height=x.height,l=X)),w.point||(L.width||(L.width=I),L.height||(L.height=X),h=h||L.width,l=l||L.height),L.x=w.x*this.unitsPerPixel,L.y=w.y*this.unitsPerPixel,w.rotation&&(g=(w.width||I)/2,y=(w.height||X)/2,m=w.rotation/180%2*Math.PI,v=platypus.Vector.setUp(g,-y).rotate(m),L.rotation=w.rotation,L.x=Math.round(1e3*(L.x+v.x-g))/1e3,L.y=Math.round(1e3*(L.y+v.y+y))/1e3,v.recycle()),"left"===E?L.regX=0:"center"===E?(L.regX=L.width/2,L.x+=h/2):"right"===E&&(L.regX=L.width,L.x+=h),L.x+=e,-1===S&&(L.y+=L.height),"bottom"===A?L.regY=L.height:"center"===A?(L.regY=L.height/2,L.y-=l/2):"top"===A&&(L.regY=0,L.y-=l),L.y+=i,w.ellipse?(L.shape={},L.shape.type="circle",L.shape.width=L.width*this.unitsPerPixel,L.shape.height=L.height*this.unitsPerPixel,L.shape.radius=(L.width+L.height)*this.unitsPerPixel/4):w.width&&w.height&&(L.shape={},L.shape.type="rectangle",L.shape.width=L.width*this.unitsPerPixel,L.shape.height=L.height*this.unitsPerPixel);x?(L.scaleX*=this.imagesScale*(x.scaleX||1),L.scaleY*=this.imagesScale*(x.scaleY||1)):(L.scaleX*=this.imagesScale,L.scaleY*=this.imagesScale),L.layerZ=this.layerZ,L.z?L.z+=this.layerZ:x&&"number"==typeof x.z?L.z=this.layerZ+x.z:L.z=this.layerZ,(w=this.owner.addEntity(new r(b,{properties:L},this.updateLoadingProgress.bind(this,a),this.owner)))&&(w.camera&&(this.followEntity={entity:w,mode:w.camera}),this.owner.triggerEvent("entity-created",w))}else this.updateLoadingProgress(a);this.layerZ+=this.layerIncrement},setupLayer:function(t,e,i,n,s,r,o,a,h,l){var p=!1,u=c(t.properties,"entity"),d=u||"render-layer",g=null,y=0;if(u||("collision"===t.name?d="collision-layer":"action"===t.name&&(d=e?"tile-layer":"render-layer")),"tile-layer"===d||this.showCollisionTiles&&platypus.game.settings.debug)return l.count+=1,this.createLayer("collision-layer",t,n,s,r,o,a,h,i,l),this.createLayer("render-layer",t,n,s,r,o,a,h,i,l);if("collision-layer"===d)return this.createLayer("collision-layer",t,n,s,r,o,a,h,i,l),null;if(g=platypus.game.settings.entities[d])for(y=g.components.length;y--;)if("RenderTiles"===g.components[y].type){p=!0;break}return p?this.createLayer(d,t,n,s,r,o,a,h,i,l):(this.createLayer(d,t,n,s,r,o,a,h,i,l),null)},updateLoadingProgress:function(t){t.count+=1,t.progress=t.count/t.total,this.owner.triggerEvent("level-loading-progress",t),t.count===t.total&&(t.recycle(),this.finishedLoading())},destroy:function(){}},publicMethods:{decodeLayer:function(t){return"base64"===t.encoding&&(t.data=o(t.data,t.compression),t.encoding="csv"),t}},getAssetList:function(t,e,i){var n=e||{},s=i||{},r=t.spriteSheet||n.spriteSheet||s.spriteSheet,o=t.images||n.images||s.images,a=y(t.level||n.level||s.level,r);return r&&("string"==typeof r?a.union(platypus.game.settings.spriteSheets[r].images):a.union(r.images)),o&&a.union(o),a},getLateAssetList:function(t,e,i,n){var s=e||{},r=i||{},o=t.spriteSheet||s.spriteSheet||r.spriteSheet;return n&&n.level?y(n.level,o):Array.setUp()}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("PIXI.Container"),i=include("platypus.Data"),n=include("createjs.Ease"),s=include("platypus.Entity"),r=include("PIXI.Graphics"),o=include("createjs.Tween"),a=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null};platypus.createComponentClass({id:"ToolBoxHandler",properties:{toolBoxHeight:550,toolBoxTop:-300},publicProperties:{scrollable:!0},initialize:function(){this.mask=null,this.count=0,this.verticalSpacing=a(platypus.game.settings.entities["toolbox-item"].properties,"height"),this.upperLimit=this.toolBoxTop+this.verticalSpacing/2,this.lowerLimit=this.upperLimit,this.playerResources=Array.setUp(),this.scrollDistance=Math.max(Math.floor(this.toolBoxHeight/this.verticalSpacing)-1,1)*this.verticalSpacing,this.target={y:this.upperLimit},this.scrollTween=null,platypus.game.app.getResources=function(){return this.playerResources}.bind(this),platypus.game.app.isReallyReady=function(){for(var t=this.owner.getEntitiesByType("toolbox-item"),e=t.length;e--;)if(t[e].count&&!t[e].state.get("infinite"))return!1;return!0}.bind(this)},events:{"child-entity-added":function(t){"scroll-down"===t.type?(this.scrollDown=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop+this.toolBoxHeight):"scroll-up"===t.type&&(this.scrollUp=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop)},"process-level":function(t){for(var e="",n=t.level.properties,s="",r=i.setUp(),o=t.level.layers,h=o.length,l=0,c=null,p=null;h--;)if(p=o[h].objects)for(l=p.length;l--;)(c=p[l]).type&&"true"===a(c.properties,"savable")&&(r[c.type]=(r[c.type]||0)+1);if(Array.isArray(n))for(h=0;h<n.length;h++)"menu."===(s=n[h].name).substring(0,5)&&(e=s.substring(5),this.addMenuItem(e,n[h].value,r[e]));else for(s in n)n.hasOwnProperty(s)&&"menu."===s.substring(0,5)&&(e=s.substring(5),this.addMenuItem(e,n[s],r[e]));r.recycle(),this.toolbox.y=this.upperLimit,this.lowerLimit=Math.min(this.upperLimit,this.upperLimit-this.count*this.verticalSpacing+this.toolBoxHeight),this.upperLimit===this.lowerLimit?this.scrollable=!1:this.scrollDown.triggerEvent("show-sprite")},"render-world":function(i){var n=i.renderGroups,s=i.world,o=function(t,i,n){for(var s=i.length,r=null;s--;)if(i[s].name===t)return i[s];return(r=new e).name=t,i.push(r),n.addChild(r),r}("toolbox",n,s);o.z=1,this.toolbox=o,this.mask=function(t,e,i){var n=new r;return t.mask=n,n.isMask=!0,n.z=1,e.addChild(n),n.clear(),n.beginFill(0,1),n.r(i.left,i.top,i.width,i.height),n.endFill(),n}(o,s,t.setUp(0,this.toolBoxTop+this.toolBoxHeight/2,2e3,this.toolBoxHeight)),i.world.reorder=!0},"scroll-up":function(){var t=this.target.y+this.scrollDistance;this.swipe||(t>=this.upperLimit&&(t=this.upperLimit),this.scrollTween=o.get(this.target,{override:!0}).to({y:t},300,n.sineInOut))},"scroll-down":function(){var t=this.target.y-this.scrollDistance;this.swipe||(t<=this.lowerLimit&&(t=this.lowerLimit),this.scrollTween=o.get(this.target,{override:!0}).to({y:t},300,n.sineInOut))},swipe:function(t){this.swipe||(o.removeTweens(this.target),this.swipe=function(t,e,i){var n=e-t+i.y;n>=this.upperLimit?(n=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):n<=this.lowerLimit?(n=this.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=n,this.forceCameraUpdate()}.bind(this,t.y,this.toolbox.y)),this.swipe(t)},"end-swipe":function(t){this.swipe&&(this.swipe(t),this.swipe=null)},tick:function(){var t=this.target.y;this.toolbox.y!==t&&(this.swipe?this.target.y=this.toolbox.y:(t>=this.upperLimit?(t=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):t<=this.lowerLimit?(t=this.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=t,this.forceCameraUpdate()))}},methods:{addMenuItem:function(t,e,i){var n={},s={state:n};this.playerResources.push({name:t,count:e}),n[t]=!0,-1==+e?s.infinite=!0:(i&&(e-=i),s.count=e),s.y=this.count*this.verticalSpacing,s.spawns=t,this.lastEntityAdded=this.owner.addEntity({type:"toolbox-item",properties:s}),this.owner.triggerEvent("added-item-to-toolbox",t),this.count+=1},forceCameraUpdate:function(){this.lastEntityAdded&&this.owner.triggerEvent("child-entity-updated",this.lastEntityAdded)},destroy:function(){this.playerResources.recycle(),this.playerResources=null}},publicMethods:{getEntitiesAtPoint:function(e,i){for(var n=t.setUp(),s=Array.setUp(),r=this.owner.entities,o=null,a=r.length;a--;)o=r[a],n.setAll(o.x||0,o.y||0,o.width||0,o.height||0),n.containsPoint(e,i-this.toolbox.y)&&s.push(o);return n.recycle(),s}},getAssetList:function(){return s.getAssetList({type:"toolbox-item"})},getLateAssetList:function(t,e,i,n){var r=null,o=Array.setUp(),a=0,h=n&&n.level,l=null,c="";if("string"==typeof h&&(h=platypus.game.settings.levels[h]),l=h.properties)if(Array.isArray(l))for(a=0;a<l.length;a++)"menu."===(c=l[a].name).substring(0,5)&&(r=s.getAssetList({type:c.substring(5)}),o.union(r),r.recycle());else for(c in l)l.hasOwnProperty(c)&&"menu."===c.substring(0,5)&&(r=s.getAssetList({type:c.substring(5)}),o.union(r),r.recycle());return o}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"TrashRegion",initialize:function(){this.initialCamera=t.setUp(0,0,960,720)},properties:{panelOffset:300},publicProperties:{width:500},events:{"camera-update":function(t){var e=this.owner,i=Math.min(t.viewport.width/this.initialCamera.width,t.viewport.height/this.initialCamera.height);e.x=t.viewport.left+(this.width-this.panelOffset)*i-this.width/2,e.y=t.viewport.y}},methods:{destroy:function(){this.initialCamera.recycle(),this.initialCamera=null}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=[],i=function(t){var e=platypus.game.app,i=this.stuck;if(this.activated)this.owner.triggerEvent("pointer-up");else if(this.controlsActive||this.ignoreInput)this.ignoreInput=!1;else{if(null===this.handlerInstance&&(this.handlerInstance=function(t){var e=this.owner.container.parent.transform.worldTransform;this.updateAABB(t.data.global.x/e.a+this.camera.left,t.data.global.y/e.d+this.camera.top),this.moveThis(),this.dragging=!0,platypus.dragging=!0}.bind(this)),this.stuck)this.stuck=!1,this.owner.container.removeListener("pointermove",this.handlerInstance);else{if("mouse"===t.pixiEvent.data.pointerType&&this.pointerDownC>0)return this.pointerDownC=0,e.analyticsEmitter.startDrag(e.levelBot||"",e.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"stick-n-click",this.owner.type,this.inPanel?"control-panel":"toolbox",{x:this.owner.x>>0,y:this.owner.y>>0}),this.stuck=!0,void this.owner.container.addListener("pointermove",this.handlerInstance);this.stuck=!1}this.updateAABB(t.x,t.y),this.moveThis(),this.placeThis(t,i),this.dragging=!1,platypus.dragging=!1}};platypus.getButtonLayout=function(){var t=[],i=0;for(i=0;i<e.length;i+=3)t.push({name:"control-"+e[i],position:{x:e[i+1]>>0,y:e[i+2]>>0},shape:platypus.game.settings.entities["control-"+e[i]].properties.shape});return t},platypus.createComponentClass({id:"UIControl",properties:{originX:0,originY:0,height:0,width:0,x:0,y:0,shape:[],name:"",levelId:"",commandList:null},publicProperties:{renderGroup:"commandList",inPanel:!1},initialize:function(){this.aabb=t.setUp(0,0,this.width,this.height),this.controlPanel=null,this.dragging=!1,this.activated=!1,this.ignoreInput=!1,this.controlsActive=!1,this.shakeC=0,this.shakeX=0,this.shakeY=0,this.camera=t.setUp(),this.origScale=0,this.pointerDownC=0,this.stuck=!1,this.handlerInstance=null,this.sfxc=100,this.ox=0,this.oy=0},events:{adopted:function(){this.owner.state.set(this.name+"-inactive",!0)},"begin-level-1":function(){this.owner.triggerEvent("hide-sprite")},"begin-tutorial":function(){this.owner.triggerEvent("show-sprite")},"activate-controls":function(){this.controlsActive=!0,this.activated||this.owner.triggerEvent("hide-sprite")},"deactivate-controls":function(){this.controlsActive=!1,this.activated||this.owner.triggerEvent("show-sprite")},pointerdown:function(t){if(this.activated)return this.ignoreInput=!0,void this.owner.triggerEvent("pointer-down",t);this.controlsActive||this.stuck||(this.inPanel&&!this.stuck&&this.controlPanel.adjustMatrix(this.aabb,this.shape,0),this.owner.renderGroup="",this.ox=this.owner.x-t.x,this.oy=this.owner.y-t.y,this.updateAABB(t.x,t.y),this.moveThis(),this.dragging=!0,platypus.dragging=!0,0===this.sfxc&&this.owner.parent.triggerEvent("removeControl"),0===this.origScale&&(this.origScale=this.owner.scaleX),this.owner.scaleX=1,this.owner.scaleY=1,this.pointerDownC=30,this.dragTime=Date.now(),platypus.game.app.voPlayer.playing||platypus.game.app.userData.read("played-VO",function(t){var e="vo-control-"+this.name;null===t&&(t=[]),-1===t.indexOf(e)&&(this.owner.parent.triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this)))},pointermove:function(t){this.activated?this.owner.triggerEvent("pointer-move"):this.controlsActive||this.ignoreInput||(this.updateAABB(t.x,t.y),this.moveThis(),this.dragging=!0,platypus.dragging=!0)},pointerup:i,pointerupoutside:i,pointercancel:i,"panel-exists":function(t,i){this.putOnPanel=function(t,i){var n;this.controlPanel=t,-1!==(n=(e=i||e).indexOf(this.name))&&(0===this.origScale&&(this.origScale=this.owner.scaleX),this.owner.scaleX=1,this.owner.scaleY=1,this.owner.renderGroup="",this.owner.x=e[n+1],this.owner.y=e[n+2],this.placeThis())}.bind(this,t,i)},"camera-update":function(t){this.updateShouldSnap(),this.camera.set(t.viewport),this.inPanel||(this.owner.x=this.originX+this.camera.left,this.owner.y=this.originY)},"handle-logic":function(){var t=platypus.game.app;if(this.putOnPanel&&this.putOnPanel(),this.sfxc>0&&this.sfxc--,this.pointerDownC>0&&(this.pointerDownC--,this.pointerDownC||this.stuck||t.analyticsEmitter.startDrag(t.levelBot||"",t.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.aabb.x-this.camera.left>>0,y:this.aabb.y-this.camera.top>>0},"press-n-drag",this.owner.type,this.inPanel?"control-panel":"toolbox",{x:this.owner.x>>0,y:this.owner.y>>0})),this.shakeC)return this.owner.x=this.shakeX+this.randRange(-1,1)*(this.shakeC/10),this.owner.y=this.shakeY+this.randRange(-1,1)*(this.shakeC/10),this.shakeC--,void(0===this.shakeC&&(this.owner.x=this.shakeX,this.owner.y=this.shakeY));this.updateShouldSnap(),this.putOnPanel&&(this.putOnPanel=null,this.owner.triggerEvent("force-update"))},"pointer-down":function(){this.botLocation=platypus.game.app.getRobotLocationForLAP(),this.botTime=Date.now()},"pointer-up":function(){var t=platypus.game.app;t.analyticsEmitter.selectAnswer(t.levelBot||"",t.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x-this.camera.left>>0,y:this.owner.y-this.camera.top>>0},this.owner.type,this.botLocation,t.getRobotLocationForLAP(),Date.now()-this.botTime)}},methods:{destroy:function(){this.aabb.recycle(),this.controlPanel=null},randRange:function(t,e){return Math.random()*(e-t)+t},updateShouldSnap:function(){this.dragging||this.inPanel?this.owner.shouldSnap=!1:this.owner.shouldSnap=!0},updateAABB:function(t,e,i){i?this.aabb.move(t,e):this.aabb.move(t+this.ox,e+this.oy)},moveThis:function(){this.owner.z=1e3,this.aabb.right>this.camera.right?this.aabb.x=this.camera.right-this.aabb.width/2:this.aabb.left<this.camera.left&&(this.aabb.x=this.camera.left+this.aabb.width/2),this.aabb.bottom>this.camera.bottom?this.aabb.y=this.camera.bottom-this.aabb.height/2:this.aabb.top<this.camera.top&&(this.aabb.y=this.camera.top+this.aabb.height/2),this.owner.x=this.aabb.x,this.owner.y=this.aabb.y},placeThis:function(i,n){var s,r,o,a=platypus.game.app;if(this.updateAABB(this.owner.x,this.owner.y,!0),this.owner.z=10,s=this.controlPanel.snapToGrid(this.aabb,this.shape),r=t.setUp(s[0],s[1],this.aabb.width,this.aabb.height),this.controlPanel.collidesWith(r)?0===this.sfxc&&this.owner.parent.triggerEvent("placeControl"):(this.commandList.collidesWith(this.aabb)?0===this.sfxc&&this.owner.parent.triggerEvent("placeControl"):(0===this.sfxc&&this.owner.parent.triggerEvent("error"),i&&a.analyticsEmitter.endDragOutside(a.levelBot||"",a.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i.x-this.camera.left>>0,y:i.y-this.camera.top>>0},n?"click-n-stick":"press-n-drag",Date.now()-this.dragTime>>0,this.owner.type,{x:this.owner.x>>0,y:this.owner.y>>0},this.inPanel?"control-panel":"toolbox")),this.resetToOrigin()),0===s[0]&&0===s[1])return this.shakeX=this.owner.x,this.shakeY=this.owner.y,this.shakeC=60,this.inPanel&&this.controlPanel.removeControl(this.owner),void(this.inPanel=!1);this.owner.x=s[0],this.owner.y=s[1],this.inPanel?this.controlPanel.adjustMatrix(this.aabb,this.shape,1):this.controlPanel.addControl(this.owner,this.aabb),this.inPanel=!0,-1===(o=e.indexOf(this.name))?(e.push(this.name),e.push(this.owner.x),e.push(this.owner.y),a.analyticsEmitter.addControlToControlPanel(a.levelBot||"",a.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x-this.camera.left>>0,y:this.owner.y-this.camera.top>>0},platypus.getButtonLayout(),a.getPlayerResources(),a.getEnlearnData())):(e[o+1]=this.owner.x,e[o+2]=this.owner.y),this.owner.parent.parent.layers[1].triggerEvent("controls-updated",e)},resetToOrigin:function(){var t=platypus.game.app,i=e.indexOf(this.name);this.inPanel&&(this.controlPanel.removeControl(this.owner),t.analyticsEmitter.removeControlFromControlPanel(t.levelBot||"",t.levelNumber||0,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x-this.camera.left>>0,y:this.owner.y-this.camera.top>>0},this.owner.type)),this.owner.x=this.originX+this.camera.left,this.owner.y=this.originY,this.inPanel=!1,this.renderGroup="commandList",this.owner.scaleX=this.origScale,this.owner.scaleY=this.origScale,-1!==i&&e.splice(i,3)}},publicMethods:{activate:function(){this.activated=!0,this.owner.state.set(this.name+"-inactive",!1),this.owner.state.set(this.name+"-active",!0)},deactivate:function(){this.activated=!1,this.owner.state.set(this.name+"-inactive",!0),this.owner.state.set(this.name+"-active",!1)},scroll:function(t){this.dragging||this.inPanel||(this.owner.y+=t),this.updateAABB(this.owner.x,this.owner.y)},updateVisible:function(t){t.collides(this.aabb)?this.owner.triggerEvent("show-sprite"):this.owner.triggerEvent("hide-sprite")}}})}(),function(){"use strict";platypus.createComponentClass({id:"UnlockSequence",properties:{},publicProperties:{},initialize:function(){},events:{"complete-level":function(t){this.owner.state.set(t?"complete-star":"complete-no-star",!0),this.owner.state.set("unlocked",!1),this.owner.state.set("disabled",!1)},"unlock-level":function(){this.owner.state.set("unlocked",!0),this.owner.state.set("disabled",!1)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.components.AudioVO"),e=include("platypus.components.RenderAnimation"),i=include("platypus.components.RenderSprite"),n=function(t,e){return" "===e?t+"default":t+e},s=function(t,e,i){this.owner.addComponent(new t(this.owner,e,i))},r=function(t,e,i,s){var r=0,o="",a={},h=0,l="",c="",p=t.voice,u=t.mouthCues;if("string"==typeof t)a.sound=t,a.events=Array.setUp();else if("string"==typeof t.sound)a.sound=t.sound,a.events=Array.setUp();else{for(o in t.sound)t.sound.hasOwnProperty(o)&&(a[o]=t.sound[o]);a.events?a.events=a.events.greenSlice():a.events=Array.setUp()}if(p||u||!platypus.game.app.config.mouthCues||(u=platypus.game.app.config.mouthCues[a.sound]),p)for(p+=" ",r=0;r<p.length;r++)(c=p[r])!==l&&(l=c,a.events.push({time:h,event:n(i,c)})),h+=s;else if(u)for(r=0;r<u.length;r++)c=u[r],a.events.push({time:1e3*c.start,event:n(i,c.value)}),h+=s;return a},o=function(t,e,i,n){var s=0,o=Array.setUp();if(e[" "]||(e[" "]=e.default),Array.isArray(t)){for(s=0;s<t.length;s++)"number"==typeof t[s]?o.push(t[s]):o.push(r(t[s],0,i,n));return o}return r(t,0,i,n)};platypus.createComponentClass({id:"VoiceOver",properties:{animationMap:{default:"default"},renderComponent:"",frameLength:100,messagePrefix:"",voiceOverMap:{}},initialize:function(r,a){var h="",l=Array.setUp(),c={audioMap:{},aliases:r.aliases},p={acceptInput:r.acceptInput,aliases:r.aliases,animation:r.animation,animationMap:{},eventBased:!0,flip:r.flip,hidden:r.hidden,interactive:r.interactive,mask:r.mask,mirror:r.mirror,offsetZ:r.offsetZ,regX:r.regX,regY:r.regY,restart:r.restart,rotate:r.rotate,scaleX:r.scaleX,scaleY:r.scaleY,spriteSheet:r.spriteSheet,stateBased:r.stateBased||!1};for(h in this.messagePrefix?this.message=this.messagePrefix+"-":this.message="",this.animationMap)this.animationMap.hasOwnProperty(h)&&(p.animationMap[n(this.message,h)]=this.animationMap[h]);for(h in p.animationMap.default=this.animationMap.default,this.renderComponent?l.push(s.bind(this,platypus.components[this.renderComponent],p)):l.push(s.bind(this,r.animation?e:i,p)),this.voiceOverMap)this.voiceOverMap.hasOwnProperty(h)&&(c.audioMap[h]=o(this.voiceOverMap[h],this.animationMap,this.message,this.frameLength));return l.push(s.bind(this,t,c)),platypus.Async.setUp(l,a),l.recycle(),!0},events:{load:function(){this.owner.removeComponent(this)}},getAssetList:function(t,e,i){var n=t.spriteSheet||e.spriteSheet||i&&i.spriteSheet;return"string"==typeof n?platypus.game.settings.spriteSheets[n].images.greenSlice():n?n.images.greenSlice():Array.setUp()}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Vortex",properties:{ship:null},publicProperties:{},initialize:function(){this.remove=!1,this.c=0,this.removing=!1,this.spawning=!1,this.angSpeed=100,this.suckForce=new t(0,0)},events:{adopted:function(){this.spawning=!0,this.angSpeed=100,this.owner.opacity=0,this.owner.scaleX=1.85,this.owner.scaleY=1.85,this.trapping=!1},"prepare-logic":function(){this.c++,this.c>1500&&(this.removing||this.owner.parent.triggerEvent("vortexFade"),this.removing=!0,this.owner.opacity=1-.0025*(this.c-1500),this.angSpeed++,this.owner.scaleX-=1e-4,this.owner.scaleY-=1e-4,this.owner.opacity<.001&&(this.remove=!0)),this.remove&&(this.ship.vortexRemoved(),this.owner.parent.removeEntity(this.owner),this.remove=!1),this.spawning&&(this.angSpeed--,this.owner.opacity+=.01,this.owner.scaleX-=.01,this.owner.scaleY-=.01,this.angSpeed<1&&(this.angSpeed=.25,this.spawning=!1)),this.trapping&&(this.angSpeed*=1.1,this.owner.scaleX-=.005*this.angSpeed,this.owner.scaleY-=.005*this.angSpeed,this.owner.scaleX<.01&&(this.trapping=!1,this.remove=!0)),this.owner.rotation+=this.angSpeed},"collide-with-trash":function(t){var e=platypus.game.app;this.trapping||(this.trapping=!0,this.owner.parent.parent.layers[1].triggerEvent("trash-trapped"),this.owner.parent.triggerEvent("vortexAst"),e.analyticsEmitter.vortexedAsteroid(e.levelBot||"",e.levelNumber||0,{x:t.entity.x>>0,y:t.entity.y>>0}))},"handle-logic":function(e){for(var i=0;i<e.entities.length;i++){var n=e.entities[i];if(n.type.indexOf("asteroid")>-1){if(null===n.body)continue;if((l=n.x-this.owner.x,c=n.y-this.owner.y,l*l+c*c)<1e5){var s=this.owner.body.GetWorldCenter(),r=n.body.GetWorldCenter(),o=new t(s.get_x()-r.get_x(),s.get_y()-r.get_y()),a=o.Length(),h=50/(a*a);this.suckForce.set_x(o.get_x()*h),this.suckForce.set_y(o.get_y()*h*2),n.body.ApplyForce(this.suckForce,n.body.GetWorldCenter(),!0)}}}var l,c}},methods:{destroy:function(){this.ship=null}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"WhatsBeingDragged",properties:{},publicProperties:{},initialize:function(){this.dragging=[]},events:{"dragging-a-piece":function(t){this.dragging.includes(t)||(this.dragging.push(t),1===this.dragging.length&&this.owner.triggerEvent("rl-dragging-taking-place"))},"finished-dragging-a-piece":function(t){var e;(e=this.dragging.indexOf(t))>=0&&(this.dragging.splice(e,1),0===this.dragging.length&&this.owner.triggerEvent("rl-no-dragging-taking-place"))}},methods:{},publicMethods:{isThisGroupMoving:function(t){var e=0;for(e=0;e<this.dragging.length;e++)if(this.dragging[e].groupId===t)return!0;return!1}}})}(),function(){"use strict";platypus.createComponentClass({id:"WorkSpace",initialize:function(){var t=this.owner;t.x=t.width/2,t.y=t.height/2}})}(),function(){"use strict";platypus.createComponentClass({id:"ZoomBannerLogic",properties:{},publicProperties:{banner:null},initialize:function(){},events:{zoom:function(){this.owner.parent.triggerEvent("zoom-in",this.owner.banner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Entity"),n=include("platypus.Vector"),s=include("createjs.Tween");platypus.createComponentClass({id:"Zoomer",properties:{maxZoom:2048,minZoom:240},publicProperties:{zooming:!1,zoomEnabled:!0,zoomPaused:!1},initialize:function(){var e=this.interaction=platypus.game.app.display.renderer.plugins.interaction;this.zoomLocks=0,this.zoomButton=null,this.zoomStep=1,this.camera=t.setUp(),this.pointers=Array.setUp(),this.mouseWorldOrigin=n.setUp(),this.pinchCam=null,this.wheelie=function(t){var e=5e-4*t.deltaY,i=window.devicePixelRatio||1,s=1+e/this.currentZoom,r=this.owner,o=n.setUp(t.clientX*i,t.clientY*i),a=r.windowToWorld(o,!0);this.zoomEnabled&&!this.zoomPaused&&this.zoom(a,s,this.camera),o.recycle(),a.recycle(),t.preventDefault()}.bind(this),this.continuing=function(e){var i=null,n=this.pointers,s=n.length,r=e.data.identifier,o=!1;if(this.pinchCam||1!==s){if(2===s){if(!this.pinchCam){for(this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y;s--;)(i=n[s]).x=i.toX,i.y=i.toY;s=n.length,this.pinchCam=t.setUp(this.camera)}for(;s--;)if((i=n[s]).identifier===r){i.toX=e.data.global.x,i.toY=e.data.global.y,o=!0;break}o?this.pinchZoom():platypus.debug.warn("Well, that was odd. Unregistered input pointer!")}}else this.repositionCamera(n[0],e.data.global),e.stopPropagation();this.pinchCam&&e.stopPropagation()}.bind(this),e.on("pointermove",this.continuing),this.ending=function(t){for(var e=null,i=this.pointers,n=i.length,s=t.data.identifier;n--;)if(i[n].identifier===s){i.greenSplice(n).recycle();break}this.pinchCam&&(this.pinchCam.recycle(),this.pinchCam=null),1===i.length&&((e=i[0]).x=e.toX,e.y=e.toY,this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y),this.zooming&&t.stopPropagation(),i.length||(this.zooming=!1)}.bind(this),e.on("pointerup",this.ending),e.on("pointerupoutside",this.ending),e.on("pointercancel",this.ending),this.needToAddZoomButton=!1,this.enabledZoomButton=!1,this.zoomDimensionsCollected=!1,this.zoomDimensions={width:0,height:0,lastWidth:0},this.initialZoomDimensions={width:0,height:0}},events:{"step-zoom":function(){var t=(this.maxZoom-this.minZoom)/3;this.zoomStep=(this.zoomStep+1)%3,this.zoom(this.camera,(this.minZoom+t*(2-this.zoomStep))/this.camera.height,this.camera)},tick:function(){this.zoomEnabled&&this.needToAddZoomButton&&(this.zoomButton=platypus.game.currentScene.layers[platypus.game.currentScene.layers.length-1].addEntity({type:"button-zoom"}),this.needToAddZoomButton=!1,this.enabledZoomButton=!0),this.zoomButton&&(!this.enabledZoomButton||this.zoomEnabled&&!this.zoomPaused?this.enabledZoomButton||!this.zoomEnabled||this.zoomPaused||(this.zoomButton.triggerEvent("enable"),this.enabledZoomButton=!0):(this.zoomButton.triggerEvent("disable"),this.enabledZoomButton=!1)),this.zoomDimensions.width!==this.zoomDimensions.lastWidth&&(this.zoomDimensions.lastWidth=this.zoomDimensions.width,this.owner.triggerEvent("resize-camera",this.zoomDimensions))},"camera-update":function(t){this.camera.set(t.viewport),this.currentZoom=t.scaleX,this.zoomDimensionsCollected||(this.zoomDimensionsCollected=!0,this.zoomDimensions={width:t.viewport.width,height:t.viewport.height,lastWidth:t.viewport.width},this.initialZoomDimensions={width:t.viewport.width,height:t.viewport.height})},"tween-zoom-out":function(){var t=Math.min(1.4*this.initialZoomDimensions.height,this.maxZoom);this.zoomDimensions.changing=!0,s.get(this.zoomDimensions,{override:!0}).to({height:t,width:4*t/3},600,createjs.Ease.sineInOut)},"tween-zoom-in":function(){this.zoomDimensions.changing=!0,s.get(this.zoomDimensions,{override:!0}).to({height:this.initialZoomDimensions.height,width:this.initialZoomDimensions.width},600,createjs.Ease.sineInOut)},"workspace-pointerdown":function(t){this.zoomEnabled&&!this.zoomPaused&&this.start(t)},"pause-zooming":function(){this.zoomLocks+=1,this.zoomPaused=!0},"unpause-zooming":function(){this.zoomLocks-=1,this.zoomLocks<0&&(this.zoomLocks=0),this.zoomPaused=!!this.zoomLocks}},methods:{destroy:function(){var t=this.interaction;this.camera.recycle(),this.camera=null,this.mouseWorldOrigin.recycle(),this.mouseWorldOrigin=null,this.pointers.recycle(2),this.pointers=null,window.removeEventListener("wheel",this.wheelie),t.off("pointermove",this.continuing),t.off("pointerup",this.ending),t.off("pointerupoutside",this.ending),t.off("pointercancel",this.ending)},start:function(t){var i=this.camera,n=this.pointers;this.zooming=!0,this.owner.triggerEvent("stop-following-if-simulating"),n.push(e.setUp("toX",t.pixiEvent.data.global.x,"toY",t.pixiEvent.data.global.y,"x",t.pixiEvent.data.global.x,"y",t.pixiEvent.data.global.y,"identifier",t.pixiEvent.data.identifier)),1===n.length&&(this.mouseWorldOrigin.x=i.x,this.mouseWorldOrigin.y=i.y),t.pixiEvent.stopPropagation()},pinchZoom:function(){var t=this.pointers,e=t[0],i=t[1],s=Math.hypot(e.x-i.x,e.y-i.y),r=Math.hypot(e.toX-i.toX,e.toY-i.toY),o=n.setUp((e.toX+i.toX)/2,(e.toY+i.toY)/2),a=this.owner.windowToWorld(o);this.zoom(a,s/r,this.pinchCam),a.recycle(),o.recycle()},zoom:function(e,i,n){var s=Math.min(this.maxZoom,Math.max(this.minZoom,n.height*i)),r=this.owner,o=4*s/3,a=1-s/n.height,h=t.setUp(n.x+(e.x-n.x)*a,n.y+(e.y-n.y)*a,o,s);r.triggerEvent("resize-camera",h),r.triggerEvent("relocate",h),h.recycle()},repositionCamera:function(t,e){var i=n.setUp(t.x-e.x,t.y-e.y),s=this.owner.windowToWorld(i,!1);s.x+=this.mouseWorldOrigin.x,s.y+=this.mouseWorldOrigin.y,this.owner.triggerEvent("relocate",s),i.recycle(),s.recycle()}},getAssetList:function(){return platypus.supports.desktop?i.getAssetList({type:"button-zoom"}):Array.setUp()}})}();