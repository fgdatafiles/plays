!function(){var t=include("springroll.Enum"),e=new t("SHORE","WATERUNIT","CHARACTERUNIT","POWERUP");namespace("nature.data").CollisionType=e;var i=new t("COLLIDES","ONEHITLEFT","EARNSBOOST","SLOWEDBYWIND","BOATBREAKS","TRYAGAIN","WINRACE","CELEBRATELOOP","SCORE");namespace("nature.data").Trigger=i}(),function(){var t=function(){this.numPlayers=1,this.playerNames=[null,null],this.playerParts=[null,null],this.stageName="stream",this.unlocks=[],this.unlockedParts={},this.allParts=null,this.unlockedStages=[],this.justUnlockedPart=null,this.customSegmentIdxes=[],this.winningCharacter=null,this.worlds=null,this.cameras=null,this.units=null,this.aboveUnits=null,this.characters=null,this.allUnits=null,this.hearts=null,this.energyMeters=null,this.playerCharacterUnits=null,this.segmentStarts=null,this.currentSegmentIdxes=null,this.stageConfig=null};t.CHARACTER_NAMES=["NatureCat","Squeaks","Daisy","Hal"],t.BOAT_PART_TYPES=["sail","base","accessory"],t.STAT_NAMES=["speed","defense"],t.STAGE_NAMES=["stream","river","ocean","gp"];var e=t.prototype;Object.defineProperty(e,"waterType",{get:function(){if(["stream","river","ocean"].indexOf(this.stageName)>-1)return this.stageName;if("2p"===this.stageName)return"stream";this.stageConfig.backgrounds[this.currentSegmentIdxes[0]];return"stream"}}),e.initGameplayData=function(){this.worlds=[],this.cameras=[],this.units=[[],[]],this.aboveUnits=[[],[]],this.characters=[[],[]],this.allUnits=[[],[]],this.hearts=[[],[]],this.energyMeters=[[],[]],this.playerCharacterUnits=[],this.segmentStarts=[[],[]],this.currentSegmentIdxes=[-1,-1]},e.buildPlayerParts=function(e){for(var i={},n=0;n<t.BOAT_PART_TYPES.length;n++){var s=t.BOAT_PART_TYPES[n];i[s]=this.unlockedParts[s][0]}this.playerParts[e]=i},e.playerCharacterChosen=function(t,e){this.playerNames[t]=e,this.buildPlayerParts(t)},e.stageChosen=function(t){this.stageName=t},e.buildUnlockedParts=function(){for(var e={},i=this.unlocks.slice(),n=0;n<t.BOAT_PART_TYPES.length;n++){for(var s=t.BOAT_PART_TYPES[n],a=[],r=this.allParts[s],o=0;o<r.parts.length;o++)for(var l=r.parts[o].name,h=i.length-1;h>=0;h--)i[h][0]===s&&i[h][1]===l&&(a.push(o),i.splice(h,1));e[s]=a}this.unlockedParts=e},e.getRandomBoat=function(){for(var e={},i=0;i<t.BOAT_PART_TYPES.length;i++){var n=t.BOAT_PART_TYPES[i],s=this.unlockedParts[n],a=Math.randomInt(s.length-1);e[n]=a}return e},e.getUnlockedIndexFromName=function(t,e){for(var i=this.unlockedParts[t],n=0;n<i.length;n++){var s=i[n];if(this.allParts[t].parts[s].name===e)return s}return-1},e.getPartDataByType=function(t,e){return this.allParts[t].parts[e[t]]};var i=null;t.init=function(){return i||(i=new t)._initialize(),i},Object.defineProperty(t,"instance",{get:function(){return i}}),e._initialize=function(){},namespace("nature.data").GameData=t}(),function(){var t=include("PIXI.Container"),e=include("springroll.Application"),i=include("PIXI.Sprite"),n=include("PIXI.Texture"),s=include("PIXI.Point"),a=include("createjs.Tween"),r=include("nature.data.GameData"),o=function(){this.character=null,t.call(this),this.partClips=[]},l=["accessory","base","sail"],h=extend(o,t),c=t.prototype;h.display=function(t,a,o,h){this.clear();for(var c,u,d=PIXI.Texture.fromImage,p=[],g=[],y=r.instance.getPartDataByType("base",t),f=new s(.75,.75),m=0;m<l.length;m++){var v=l[m],w=r.instance.getPartDataByType(v,t);if(w){if(h){var C=w.stats;for(var b in h){var P=C[b]||0;h[b]+=P}}for(var S=0;S<w.images.length;S++){var B=w.images[S],x=new i(d(B.image));if(x.scale=f,this.partClips.push(x),x.anchor=new s(0,0),x._partType=v,B.positionBase){var k=y.anchors[B.positionBase];x.x=k.x,x.y=k.y}B.position&&(x.x+=B.position.x||0,x.y+=B.position.y||0),B.flipX&&(x.scale=new s(-f.x,f.y)),!0===B.aboveBase?g.push(x):!0===B.above&&p.push(x),this.addChild(x)}}}if(a)if(this.character)this.addChild(this.character);else{var T;if(o.boatAnimation){var _=new pixiflash_lib[o.boatAnimation];_.framerate=30,T=this.character=this.addChild(_),e.instance.animator.play(_,"idle"),this.mc=_}else{var I="CharactersSitting"+a;T=this.character=this.addChild(new i(n.fromImage(I)))}T.scale=new s(o.boatScale.x,o.boatScale.y),T.x=y.anchors.character.x+o.boatPosition.x,T.y=y.anchors.character.y+o.boatPosition.y}for(c=0;c<p.length;c++)u=p[c],this.setChildIndex(u,this.children.length-1);for(c=0;c<g.length;c++)u=g[c],this.setChildIndex(u,this.children.length-1)},h.hideChildByType=function(t){for(var e=0;e<this.partClips.length;e++)this.partClips[e]._partType===t&&(this.partClips[e].visible=!1)},h.adjustY=function(){for(var t={},e=0;e<this.children.length;e++)t[this.children[e]._partType]||(t[this.children[e]._partType]=this.children[e].y),t[this.children[e]._partType]=Math.min(t[this.children[e]._partType],this.children[e].y);for(e=0;e<this.children.length;e++)this.children[e].y-=t[this.children[e]._partType]},h.sink=function(){for(var t=0;t<this.partClips.length;t++)this.partClips[t].visible=!1},h.unSink=function(){for(var t=0;t<this.partClips.length;t++)this.partClips[t].visible=!0;e.instance.animator.play(this.mc,"idle")},h.startBlink=function(){for(var t=0;t<this.partClips.length;t++)a.get(this.partClips[t],{loop:!0}).to({alpha:.5},125).to({alpha:1},125)},h.stopBlink=function(){for(var t=0;t<this.partClips.length;t++)a.get(this.partClips[t],{override:!0}).to({alpha:1})},h.startRocking=function(){for(var t=[{tween:{x:0,y:0,rotation:-1},duration:100},{tween:{x:0,y:-10,rotation:-.5},duration:100},{tween:{x:-3,y:-7,rotation:0},duration:266},{tween:{x:-14,y:8,rotation:1},duration:133},{tween:{x:-6,y:20,rotation:.5},duration:100},{tween:{x:0,y:13,rotation:0},duration:166},{tween:{x:0,y:0,rotation:0},duration:0}],e=a.get(this),i=a.get(this.character),n=this.x,s=this.y,r=this.character.x,o=this.character.y,l=0;l<t.length;l++){var h=t[l];h.tween?(e.to({x:n+h.tween.x*this.scale.x,y:s+h.tween.y*this.scale.x,rotation:.25*h.tween.rotation},h.duration),i.to({x:r-h.tween.x*this.scale.x,y:o-h.tween.y*this.scale.x},h.duration)):h.wait&&(e.wait(h.wait),i.wait(h.wait))}},h.clear=function(){this.partClips=[],this.removeChildren()},h.destroy=function(){for(var t=this.partClips.length-1;t>=0;--t)a.removeTweens(this.partClips[t]),this.partClips[t].destroy();c.destroy.call(this),this.character&&(e.instance.stop(this.character),this.character.destroy()),this.partClips=this.character=null},namespace("nature").BoatContainer=o}(),function(){var t=include("PIXI.Container"),e=include("springroll.EventDispatcher"),i=function(i,n){t.call(this),mixin(this,e),this.panel=i,this.config=n,this.worldIdx=0};extend(i,t).start=function(){0},namespace("nature").UnitContainer=i}(),function(){var t=include("PIXI.Container"),e=include("springroll.Application"),i=include("springroll.EventDispatcher"),n=function(){t.call(this),mixin(this,i);var n=e.instance,s=this.blocker=new PIXI.Graphics;s.beginFill(0,.5),s.lineStyle(0,0,0),s.drawRect((n.config.scalingSize.width-n.config.scalingSize.maxWidth)/2,0,n.config.scalingSize.maxWidth,n.config.scalingSize.height),s.endFill(),this.addChild(s)},s=extend(n,t),a=t.prototype;s.show=function(t){this.visible=!0},s.hide=function(t){this.visible=!1},s.destroy=function(){a.destroy.call(this),this.blocker.destroy(),this.blocker=null},namespace("nature").Menu=n}(),function(){var t=include("PIXI.Container"),e=include("springroll.Application"),i=include("PIXI.Sprite"),n=include("PIXI.Texture"),a=include("createjs.Tween"),r=include("createjs.Ease"),o=include("nature.Menu"),l=include("springroll.ButtonSounds"),h=include("springroll.pixi.Button"),c=function(){o.call(this);e.instance;var s=this.animContainer=this.addChild(new t),a=PIXI.Texture.fromImage,r=this.bg=s.addChild(new i(n.fromImage("PauseScreenBG")));r.x=177,r.y=47;var c={up:a("pauseQuitButton_up"),over:a("pauseQuitButton_over"),down:a("pauseQuitButton_down")},u=this.quitButton=s.addChild(new h(c));u.on("buttonPress",function(){this.trigger("pauseQuitClicked")}.bind(this)),u.x=166,u.y=257;var d={up:a("pausePlayButton_up"),over:a("pausePlayButton_over"),down:a("pausePlayButton_down")},p=this.playButton=s.addChild(new h(d));p.on("buttonPress",function(){this.trigger("pausePlayClicked")}.bind(this)),p.x=354,p.y=371;var g={up:a("pauseReplayButton_up"),over:a("pauseReplayButton_over"),down:a("pauseReplayButton_down")},y=this.restartButton=s.addChild(new h(g));y.on("buttonPress",function(){this.trigger("pauseRestartClicked")}.bind(this)),y.x=507,y.y=230,this.buttonSounds=new l("ButtonClick","ButtonRollover",[u,p,y])},u=extend(c,t);u.show=function(t){this.visible=!0,t&&a.get(this.animContainer).to({y:-600}).to({y:0},2e3,r.elasticOut)},u.hide=function(t){t?a.get(this.animContainer).to({y:-600},500,r.sineIn).call((function(){this.visible=!1}),null,this):this.visible=!1},u.destroy=function(){s.destroy.call(this),this.buttonSounds.destroy(),a.removeTweens(this.animContainer),this.animContainer.destroy(),this.bg.destroy(),this.quitButton.destroy(),this.playButton.destroy(),this.restartButton.destroy(),this.buttonSounds=this.animContainer=this.bg=this.quitButton=this.playButton=this.restartButton=null},namespace("nature").PauseMenu=c}(),function(){var t=include("springroll.Application"),e=include("springroll.EventDispatcher"),i=include("nature.Menu"),n=include("springroll.ButtonSounds"),s=include("springroll.pixi.Button"),a=function(){i.call(this),mixin(this,e);t.instance;var a=this.tryTxt=this.addChild(new pixiflash_lib.TryAgainAni);a.framerate=30,a.visible=!1,a.stop(),a.x=450,a.y=300;PIXI.Texture.fromImage;this.quitButton=new s({up:"pauseQuitButton_up",over:"pauseQuitButton_over",down:"pauseQuitButton_down"}),this.addChild(this.quitButton),this.quitButton.on("buttonPress",function(){this.trigger("tryagainQuitClicked")}.bind(this)),this.quitButton.x=217,this.quitButton.y=400;this.restartButton=new s({up:"pauseReplayButton_up",over:"pauseReplayButton_over",down:"pauseReplayButton_down"}),this.addChild(this.restartButton),this.restartButton.on("buttonPress",function(){this.trigger("tryagainRestartClicked")}.bind(this)),this.restartButton.x=464,this.restartButton.y=400,this.buttonSounds=new n("ButtonClick","ButtonRollover",[this.quitButton,this.restartButton])},r=i.prototype,o=extend(a,i);o.show=function(){r.show.call(this),this.tryTxt.visible=!0,t.instance.animator.play(this.tryTxt,"default")},o.destroy=function(){r.destroy.call(this),t.instance.animator.stop(this.tryTxt),this.buttonSounds.destroy(),this.restartButton.destroy(),this.quitButton.destroy(),this.tryTxt.destroy(),this.ButtonSounds=this.restartButton=this.quitButton=this.tryTxt=null,e.prototype.destroy.call(this)},namespace("nature").TryagainMenu=a}(),function(){var t=include("springroll.Application"),e=include("PIXI.Sprite"),i=include("PIXI.Texture"),n=include("nature.Menu"),s=include("nature.data.GameData"),a=include("springroll.pixi.Button"),r=include("springroll.ButtonSounds"),o=include("createjs.Tween"),l=include("springroll.Positioner"),h=function(){n.call(this);t.instance;var o=PIXI.Texture.fromImage;this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this);var h=this.bg=this.addChild(new e(i.fromImage("TutorialBG")));h.x=150,h.y=100;var c={up:o("okButton_up"),over:o("okButton_over"),down:o("okButton_down")},u=this.okButton=this.addChild(new a(c));if(u.on("buttonPress",function(){this.trigger("tutorialComplete")}.bind(this)),u.x=400,u.y=450,this.buttonSounds=new r("ButtonClick","ButtonRollover",[u]),1===s.instance.numPlayers)this.addChild(u);else if(this.completeKeys=[],this.keyButtons=[],t.instance.hasTouch)this.addChild(u);else{for(var d=this.config=t.instance.config.dialogs.tutorial,p=["left1","right1","up1","down1","left2","right2","up2","down2"],g=t.instance.keyboard,y=0;y<p.length;y++){var f=d[p[y]];if(f){var m=new e(i.fromImage(f.tex.none));this.addChild(m),l.init(m,f),f.key&&(m.name=f.key,g.addKeyDown(f.key,this.onKeyDown),g.addKeyUp(f.key,this.onKeyUp)),this.keyButtons.push(m)}}this.addChild(u)}},c=n.prototype,u=extend(h,n);u.show=function(){var n;c.show.call(this),1===s.instance.numPlayers?(voAlias="NC_Game_HowToPlay",n=t.instance.hasTouch?"Tutorial_1p_touch":"Tutorial_1p_desktop"):t.instance.hasTouch?(voAlias="NC_Game_HowToPlay",n="Tutorial_2p_touch"):(voAlias=["NC_Game_PlayerOneControls","NC_Game_PlayerTwoControls"],n="Tutorial_2p_desktop",this.updateHighlight(!0,0),o.get(this).wait(2e3).call((function(){this.updateHighlight(!1,0),this.updateHighlight(!0,1)})).wait(2e3).call((function(){this.updateHighlight(!1,1)}))),voAlias&&t.instance.voPlayer.play(voAlias);var a=this.addChild(new e(i.fromImage(n)));a.x=150,a.y=100},u.updateHighlight=function(t,e){var n,s,a,r,o=[["left1","right1","up1","down1"],["left2","right2","up2","down2"]][e];for(n=0;n<o.length;n++){a=o[n];var l=this.config[a];r=l.key,s=this.getChildByName(r),t?s.texture=i.fromImage(l.tex.hi):s._selected||(s.texture=i.fromImage(l.tex.none))}},u.onKeyDown=function(t){var e=this.getConfigByKeyName(t),n=this.getChildByName(t);n.texture=i.fromImage(e.tex.sel),n._selected=!0,-1===this.completeKeys.indexOf(t)&&this.completeKeys.push(t)},u.onKeyUp=function(t){8===this.completeKeys.length&&this.trigger("tutorialComplete")},u.getConfigByKeyName=function(t){for(var e in this.config)if(this.config[e].key===t)return this.config[e];return null},u.destroy=function(){c.destroy.call(this),o.removeTweens(this),this.buttonSounds.destroy(),this.bg.destroy(),this.okButton.destroy();for(var e=t.instance.keyboard,i=0;i<this.keyButtons.length;++i)e.removeKeyDown(this.keyButtons[i].name,this.onKeyDown),e.removeKeyUp(this.keyButtons[i].name,this.onKeyUp),this.keyButtons[i].destroy();this.bg=this.okButton=this.keyButtons=this.completeKeys=this.buttonSounds=null},namespace("nature").TutorialMenu=h}(),function(){var t=include("PIXI.Container"),e=include("springroll.Application"),i=include("PIXI.Sprite"),n=include("PIXI.Texture"),s=include("createjs.Tween"),a=include("springroll.pixi.PercentTexture"),r=function(){t.call(this);var s=e.instance.config.statMeter;this.background=new i(n.fromImage(s.background)),this.addChild(this.background),this.fillTex=new a(n.fromImage(s.fill),!1,0,void 0,!1),this.fill=new i(this.fillTex),this.addChild(this.fill),this.pivot.x=s.pivotX,this._percent=0},o=extend(r,t),l=t.prototype;Object.defineProperty(o,"percent",{get:function(){return this._percent},set:function(t){this._percent=t,this.fill.texture.setPercent(t)}}),o.setPercent=function(t,e){t!==this.percent&&(!0===e&&(e=1e3),isNaN(e)&&(e=0),s.get(this).to({percent:this._percent}).to({percent:t},e))},o.destroy=function(){l.destroy.call(this),this.background.destroy(),this.fillTex.destroy(),this.fill.destroy(),this.background=this.fillTex=this.fill=null},namespace("nature").StatMeter=r}(),function(){var t=include("PIXI.Container"),e=include("PIXI.Sprite"),i=include("PIXI.Texture"),n=include("createjs.Tween"),s=include("springroll.pixi.PercentTexture"),a=function(n){t.call(this),this.back=this.addChild(new e(i.fromImage(n.background)));var a=new s(i.fromImage(n.fill),!0,0,void 0,!0);if(this.fill=new e(a),this.addChild(this.fill),n.overlay){var r=this.overlay=this.addChild(new e(i.fromImage(n.overlay)));r.x=n.overlayPosition[0],r.y=n.overlayPosition[1]}this.pivot.x=n.pivotX,this._maxValue=0},r=extend(a,t),o=t.prototype;Object.defineProperty(r,"percent",{get:function(){return _percent},set:function(t){_percent=t,this.fill.texture.setPercent(t)}}),r.setPercent=function(t,e){!0===e&&(e=1e3),isNaN(e)&&(e=0),n.get(this).to({percent:t},e)},r.destroy=function(){o.destroy.call(this),n.removeTweens(this),this.fill.destroy(),this.back.destroy(),this.overlay&&this.overlay.destroy(),this.fill=this.back=this.overlay=null},namespace("nature").EnergyMeter=a}(),function(){var t=include("nature.UnitContainer"),e=include("springroll.Application"),i=include("PIXI.Sprite"),n=include("PIXI.Texture"),s=include("createjs.Tween"),a=include("createjs.Ease"),r=include("nature.data.GameData"),o=include("collision.Polygon"),l=function(s,a){t.call(this,null,s);var r,l=s.art;l&&(pixiflash_lib[l]?((r=new pixiflash_lib[l]).framerate=30,e.instance.animator.hasAnimation(r,"idle")&&e.instance.animator.play(r,{anim:"idle"})):r=new i(n.fromImage(l)),r.anchor&&(r.anchor.x=.5,r.anchor.y=.5),this.addChild(r),this.art=r);this.powerupType=s.powerupType,this.collision=new o(s.collision),this.waitForCollision=!1,this.windActive=!1,s.sfx&&"WindWarning"==s.sfx.start&&(this.waitForCollision=!0),this.additionalSpeed=null,a&&a.additionalSpeed?this.additionalSpeed=a.additionalSpeed:s.additionalSpeed&&(this.additionalSpeed=s.additionalSpeed),this.above=!1,this.segmentIdx=-1,this.move=this.move,this.start=this.start,this.collide=this.collide},h=t.prototype,c=extend(l,t);c.start=function(){if(this.startPosition=this.position.clone(),this.collision.updateOrigin(this.x,this.y),this.enabled=!0,this.additionalSpeed&&"tween"===this.additionalSpeed.algo){var t=this.additionalSpeed.time,i=a[this.additionalSpeed.ease],n=this.startPosition.clone();n.x+=this.additionalSpeed.min.x||0,n.y+=this.additionalSpeed.min.y||0;var r=this.startPosition.clone();r.x+=this.additionalSpeed.max.x||0,r.y+=this.additionalSpeed.max.y||0,this._tween=s.get(this,{loop:!0}).to(r,t,i).to(n,t,i),this._tween.addEventListener("change",function(){this.collision.updateOrigin(this.x,this.y)}.bind(this))}this.config.sfx&&this.config.sfx.start&&e.instance.sound.play(this.config.sfx.start),h.start.call(this),this.waitForCollision&&s.get(this).wait(1500).call(function(){this.waitForCollision=!1,this.collide(null,null,!0),this.windActive=!0}.bind(this))},Object.defineProperty(c,"paused",{set:function(t){this._tween&&this._tween.setPaused(t)}}),c.enterSegment=function(t){var e=t===this.segmentIdx;return this.visible=e,e?(this.start(),this):null},c.move=function(t,e){if(this.additionalSpeed){e||(e=this.y);var i=0,n=0;this.additionalSpeed.hasOwnProperty("x")&&(i=this.additionalSpeed.x*t),this.additionalSpeed.hasOwnProperty("y")&&(n=this.additionalSpeed.y*t),this.x+=i,this.y+=n,this.collision.updateOrigin(this.collision.origin.x+i,this.collision.origin.y+n)}},c.collide=function(t,i,n){var s=this.art;if(!this.windActive&&e.instance.animator.hasAnimation(s,"hit")){var a=[{anim:"hit"}];i&&a.push({anim:"idle"}),e.instance.animator.play(s,a,function(){n&&this.destroyMe()}.bind(this))}if(!this.windActive){var r="ShipHitsObject";this.config.sfx&&this.config.sfx.collision&&(r=this.config.sfx.collision),e.instance.sound.play(r)}},c.destroyMe=function(){this.visible=!1,this.enabled=!1;var t=r.instance.aboveUnits[this.worldIdx].indexOf(this);r.instance.aboveUnits[this.worldIdx].splice(t,1),this.destroy()},Object.defineProperty(c,"tint",{set:function(t){this.children.forEach((function(e){e.tint=t}))}}),c.destroy=function(){h.destroy.call(this),s.removeTweens(this),this.art&&(e.instance.animator.stop(this.art),this.art.destroy()),this.collision.destroy(),this.art=this.collision=null},namespace("nature").WaterUnit=l}(),function(){var t=include("nature.WaterUnit"),e=include("nature.BoatContainer"),i=include("PIXI.Container"),n=include("springroll.Application"),s=include("PIXI.Sprite"),a=include("PIXI.Point"),r=include("PIXI.Rectangle"),o=include("PIXI.Texture"),l=include("createjs.Tween"),h=include("collision.CollisionUtils"),c=include("collision.Polygon"),u=include("springroll.RandomList"),d=include("nature.data.CollisionType"),p=include("nature.data.Trigger"),g=include("nature.data.GameData"),y=function(r,l,h,u,d){this.stageConfig=h,t.call(this,r,l),this.isNPC=!1,this.waypoints=[],this.boatSpeed=0,this.movementYScale=1,this.speedMultiplier=1,this.heartsPerHit=1,this.movementVector=new a,this.movementDistance=0,this.collisionVector=new a,this.collisionDistance=0,this.isInvulnerable=!1,this.worldIdx=null,this.isRacing=!1,this.characterName=u,this.emitter=null,this.energyBoost=1,this.npcBoost=0,this.health=0,this.energy=0,this.triggers=this.initTriggers(r.triggers);var p=this.art=new e;this.stats={};for(var y=0;y<g.STAT_NAMES.length;y++){var f=g.STAT_NAMES[y];this.stats[f]=0}p.display(d,u,n.instance.config.units.characters[u],this.stats),this.waterSpeed=0,this.windSpeed=0;this.speedMultiplier=1+1*this.stats.speed,this.heartsPerHit=Math.roundDecimal(-5*this.stats.defense/2+3,.5),this.addChild(p);p.getBounds();for(p.scale=new a(.5,.5),p.pivot=new a(150,150),p.x=25,p.y=-15,this.translatedCollision=new c(r.collision),this.collectDigits=[],y=0;y<3;y++){var m=y+1,v=new s(o.fromFrame("Collect"+m));v.y=-135,this.collectDigits.push(v)}this.heartIcon=new s(o.fromFrame("CollectHeart")),this.energyIcon=new s(o.fromFrame("CollectEnergy")),this.heartIcon.y=-135,this.heartIcon.x=-30,this.energyIcon.y=-135,this.energyIcon.x=-30,this.collectIcons=[this.heartIcon,this.energyIcon],this.iconContainer=new i},f=t.prototype,m=extend(y,t);m.start=function(){f.start.call(this),this.isRacing=!0,this.isNPC&&this.randomNPCBoost()},m.randomNPCBoost=function(){this.npcBoost=1+this.stats.speed,l.get(this).wait(Math.randomInt(1e3,3e3)).call(function(){this.npcBoost=0}.bind(this)).wait(Math.randomInt(3e3,5e3)).call(this.randomNPCBoost.bind(this))},m.pickNextWaypoint=function(){this.collision.updateOrigin(this.x,this.y),this.collision.calcAABB();for(var t,e=this.collision.aabb,i=new r(e.x,e.y,e.width,1e3),n=c.fromRect(i),s=null,o=0;o<g.instance.units[this.worldIdx].length;o++){var l=g.instance.units[this.worldIdx][o];if(void 0===l.powerupType&&h.checkPolygonCollision(n,l.collision)){s=l;var u=Math.randomInt(1);(t=l.position.clone()).y-=1+l.height/2+this.height/2;var d=l.width/2+this.width/2+Math.randomInt(10,30);1===u&&t.x+d>this.stageConfig.shorelineRight&&(u=0),0===u&&t.x-d<this.stageConfig.shorelineLeft&&(u=1),1===u?t.x+=d:t.x-=d,this.waypoints.push({pt:t,type:"top",unit:l}),this.waypoints.push({pt:new a(t.x,t.y+l.height+this.height+Math.randomInt(10,20)),type:"side",unit:l});break}}s||this.waypoints.push({pt:new a(this.x,this.y+1e3),type:"blank"})},m.moveTowardWaypoint=function(t){this.movementVector=this.waypoints[0].pt.clone(),this.movementVector.subtract(this.position),this.movementDistance=this.movementVector.length(),this.movementVector.normalize(),this.y>this.waypoints[0].pt.y&&(this.waypoints.shift(),0===this.waypoints.length&&this.pickNextWaypoint())},m.update=function(t){var e=g.instance;if(this.enabled){var i,n,s,r,o;if(this.movementDistance>0){var l=t*this.speedMultiplier*this.boatSpeed;l>this.movementDistance&&(l=this.movementDistance),this.movementDistance-=l;var c=this.movementVector.x,u=this.movementVector.y;c*=l,u*=l*this.movementYScale,this.x+=c,this.y+=u,this.isNPC&&(this.y+=this.npcBoost)}if(this.energyBoost>1&&(this.y+=t*this.movementYScale*this.speedMultiplier*this.boatSpeed*(this.energyBoost-1)),this.y+=t*this.waterSpeed,this.y+=t*this.windSpeed,0!==this.collisionDistance){var p=new a(this.collisionVector.x,this.collisionVector.y);p.scaleBy(this.collisionDistance),this.x+=p.x,this.y+=p.y}for(this.collision.updateOrigin(this.x,this.y),s=this.leftShorelinePoints[0],i=1;i<this.leftShorelinePoints.length;i++){if(n=this.leftShorelinePoints[i],s.y<this.y&&n.y>this.y){var y;h.getLinePolygonCollision(s.x,s.y,n.x,n.y,this.collision)&&this.startCollision(d.SHORE,null,{distance:-10,x:-1,y:0,time:250}),s.x===n.x?y=n.x+this.width/2:(r=(this.y-s.y)/(n.y-s.y),o=n.x-s.x,y=this.width/2+s.x+o*r),this.x<y&&(this.x=y+1);break}s=n}for(s=this.rightShorelinePoints[0],i=1;i<this.rightShorelinePoints.length;i++){if(n=this.rightShorelinePoints[i],s.y<this.y&&n.y>this.y){var f;h.getLinePolygonCollision(s.x,s.y,n.x,n.y,this.collision)&&this.startCollision(d.SHORE,null,{distance:-10,x:1,y:0,time:250}),s.x===n.x?f=n.x-this.width/2:(r=(this.y-s.y)/(n.y-s.y),o=n.x-s.x,f=-this.width/2+s.x+o*r),this.x>f&&(this.x=f-1);break}s=n}for(i=0;i<e.units[this.worldIdx].length;i++){var m=e.units[this.worldIdx][i];h.checkPolygonCollision(this.collision,m.collision)&&(void 0===m.powerupType?this.startCollision(d.WATERUNIT,m):this.startPowerup(m))}for(this.translatedCollision.updateOrigin(this.x,0),i=0;i<e.aboveUnits[this.worldIdx].length;i++){var v=e.aboveUnits[this.worldIdx][i];v.visible&&v.enabled&&(h.checkPolygonCollision(this.translatedCollision,v.collision)&&!1===v.waitForCollision&&this.startAbovePowerup(v))}this.isNPC&&(0===this.waypoints.length&&this.pickNextWaypoint(),this.moveTowardWaypoint(t))}},m.startPowerup=function(t){this.trigger("powerup",this,t)},m.startAbovePowerup=function(t){this.trigger("abovePowerup",this,t)},m.showCollect=function(t,e){this.hideCollect(),t=this.collectDigits[t-1],icon=this.collectIcons[e],this.iconContainer.addChild(t),this.iconContainer.addChild(icon),this.addChild(this.iconContainer),l.get(this.iconContainer).wait(500).to({alpha:0},500).call(this.hideCollect.bind(this))},m.hideCollect=function(){this.iconContainer.removeChildren(),this.removeChild(this.iconContainer),this.iconContainer.alpha=1},m.startCollision=function(t,e,i,s){this.isInvulnerable&&!s||!this.isNPC&&n.instance.options.invulnerable||(this.meter.showCollision(),this.isInvulnerable=!0,this.art.startBlink(),this.health>=0&&this.art.startRocking(),e&&e.collisionDetails&&(i=e.collisionDetails),i||(i={distance:-10,x:0,y:1,time:250}),this.collisionDistance=i.distance,this.collisionVector=new a(i.x,i.y),l.get(this).to({collisionDistance:0},i.time),t!=d.SHORE&&(this.health-=this.heartsPerHit),this.trigger("collided",{unit:this,type:t,details:e}),this.health>=0?new springroll.DelayedCall(function(){this.isInvulnerable=!1,this.art.stopBlink()}.bind(this),2e3):this.isNPC&&this.sink())},m.sink=function(t){this.emitter&&(this.emitter.emit=!1,this.emitter.parent.visible=!1),this.playTrigger(p.BOATBREAKS,t),this.isNPC||n.instance.sound.play("BoatBreaking",{complete:function(){n.instance.sound.play("CharacterFallInWater")}.bind(this)}),this.enabled=!1,this.meter.sink(),this.art.sink()},m.resurrect=function(){this.health=n.instance.config.params.maxHealth,this.art.unSink(),this.art.startBlink(),this.meter.unSink(),this.isInvulnerable=!0,this.enabled=!0,new springroll.DelayedCall(function(){this.isInvulnerable=!1,this.art.stopBlink()}.bind(this),2e3)},m.celebrate=function(){this.celebrated=!1;this.playTrigger(p.WINRACE);new springroll.DelayedCall(function(){this.celebrated=!0}.bind(this),2e3)},m.initTriggers=function(t){var e={};if(!t)return e;for(var i in t){var n=t[i];"object"==typeof n&&(n=new u(n)),e[i]=n}return e},m.getTrigger=function(t){var e=t.toString(),i=this.triggers[e];return i instanceof u&&(i=i.random()),i},m.playTrigger=function(t,e){var i=this.getTrigger(t);if(i)if("string"==typeof i)this.isNPC||n.instance.sound.play(i);else{var s=i.clone();s.anim&&s.anim.indexOf("%WATER%")>-1&&(s.anim=s.anim.replace("%WATER%",g.instance.waterType)),s.anim&&s.anim.indexOf("%NPC%")>-1&&(s.anim=s.anim.replace("%NPC%",this.isNPC?"_npc":"")),e||s.next&&(e=function(){this.playTrigger(s.next)}.bind(this)),this.isNPC&&delete s.audio,n.instance.animator.play(this.art.character,s,e)}return i},m.destroy=function(){f.destroy.call(this),l.removeTweens(this),this.meter&&(this.meter.destroy(),this.meter=null),this.emitter&&this.emitter.destroy(),this.art.destroy(),this.iconContainer.destroy(),this.heartIcon.destroy(),this.energyIcon.destroy(),this.translatedCollision.destroy();for(var t=this.collectDigits.length-1;t>=0;--t)this.collectDigits[t].destroy();this.energyDrainCall&&(this.energyDrainCall.destroy(),this.energyDrainCall=null),this.emitter=this.art=this.waypoints=this.triggers=this.meter=this.iconContainer=this.collectIcons=this.translatedCollision=this.collectDigits=null},namespace("nature").CharacterUnit=y}(),function(){var t=include("PIXI.Container"),e=include("PIXI.Sprite"),i=function(){t.call(this);var i=PIXI.Texture.fromImage;this.bg=this.addChild(new e(i("PlayerNumberBG")));var n=this.addChild(new e(i("PlayerNumber1"))),s=this.addChild(new e(i("PlayerNumber2")));s.visible=!1,this.playerButtons=[n,s]},n=extend(i,t),s=t.prototype;Object.defineProperty(n,"playerNumber",{set:function(t){this.playerButtons[0].visible=0===t,this.playerButtons[1].visible=!this.playerButtons[0].visible}}),n.destroy=function(){s.destroy.call(this);for(var t=0;t<this.playerButtons.length;++t)this.playerButtons[t].destroy();this.bg.destroy(),this.bg=this.playerButtons=null},namespace("nature").PlayerNumberContainer=i}(),function(){var t=include("springroll.Application"),e=function(){this.world=null,this.size={},this.center=0,this.worldTopEdge=0,this.worldBottomEdge=0},i=e.prototype={};i.update=function(e){this.world.y=this.size.y/2-e,this.center=e;var i=t.instance;this.worldTopEdge=-this.world.y,this.worldBottomEdge=this.worldTopEdge+i.display.height/i.scaling.scale},i.updateBy=function(t){this.update(this.center+t)},namespace("nature").Camera=e}(),function(){var t=include("createjs.Tween"),e=function(t){this.range=t,this.minY=t[0],this.deltaY=t[1]-t[0]},i=e.prototype;i.setPercent=function(t){t=Math.clamp(t,0,1),this.y=this.minY+this.deltaY*t},i.showCollision=function(){t.get(this).to({rotation:4*Math.PI},1500).to({rotation:0})},i.sink=function(){this.showCollision(),t.get(this).to({alpha:0},1500)},i.unSink=function(){this.showCollision(),t.get(this).to({alpha:1},1500)},namespace("nature").CharacterMeter=e}(),function(){var t=function(){};t.prototype.sortChildren=function(){this.children.sort((function(t,e){if(t._alwaysUnder)return-1;if(e._alwaysUnder)return 1;var i=t.y,n=e.y;return i<n?-1:i>n?1:0}))},namespace("nature").RaceMeter=t}(),function(){var t=include("PIXI.Container"),e=include("PIXI.Point"),i=include("PIXI.Sprite"),n=include("springroll.Application"),s=include("PIXI.extras.MovieClip"),a=include("springroll.pixi.Button"),r=include("nature.EnergyMeter"),o=include("springroll.ButtonSounds"),l=include("nature.data.GameData"),h=function(){t.call(this)},c=function(t,e){var i;if(Math.isNumeric(t))i=t;else{var n=t;switch(n[0]){case"RANDOM":i=Math.randomInt(n[1],n[2]);break;case"LEFT":i=e[0].x+n[1];break;case"CENTERX":i=(e[0].x+e[1].x)/2+n[1];break;case"RIGHT":i=e[1].x+n[1]}}return i},u=extend(h,t);u.setup=function(){var h=n.instance;this.worldScaler=new t,this.addChild(this.worldScaler);var u=PIXI.Texture.fromImage,d=l.instance;d.initGameplayData();var p={up:u("pauseButton_up"),over:u("pauseButton_over"),down:u("pauseButton_down")};this.pauseButton=new a(p),this.addChild(this.pauseButton),this.buttonSounds=new o("ButtonClick","ButtonRollover",[this.pauseButton]),this.raceMeter=new t,mixin(this.raceMeter,nature.RaceMeter);var g="RaceMeterBG";2===d.numPlayers&&(this.raceMeter2p=this.raceMeter,g="RaceMeter2pBG"),this.addChild(this.raceMeter);var y=new i(u(g));y._alwaysUnder=!0,this.raceMeter.addChild(y),this.pauseMenu=new nature.PauseMenu,this.addChild(this.pauseMenu),this.pauseMenu.hide(!1),this.tryagainMenu=new nature.TryagainMenu,this.addChild(this.tryagainMenu),this.tryagainMenu.hide(!1),this.tutorialMenu=new nature.TutorialMenu,this.addChild(this.tutorialMenu),this.tutorialMenu.hide(!1);var f=h.config,m=d.stageConfig=f.stages[d.stageName];this.backgroundSpritesLength=[],this.leftShorelinePoints=null,this.rightShorelinePoints=null;for(var v=[],w=0;w<d.numPlayers;w++){var C=1===w,b=0;C&&(b=m.flipDelta);var P=new t;d.worlds.push(P),P.x=600*w;var S=new nature.Camera;S.world=P,S.size=new e(f.scalingSize.maxWidth,f.scalingSize.height),d.cameras.push(S),this.worldScaler.addChild(P),S.update(S.size.y/2+m.cameraCenterOffset);var B,x=0,k=0,T=0;C&&(T=1);for(var _=m.backgroundTileWidth,I=f.scalingSize.height,A=[],N=[];x<=m.length+1e3;){var M=T%m.backgrounds.length,R=m.backgrounds[M],E=f.segments.shoreline[R];B=new i(u(R)),E.tileSize?(B.width=E.tileSize[0],B.height=E.tileSize[1]):(B.width=_,B.height=I),P.addChild(B),B.x=m.backgroundX,B.y=x,B.alpha=.999999,C&&(B.x+=_,B.scale.x*=-1),B._waterType=d.stageName,m.waterTypes&&(B._waterType=m.waterTypes[M]),k=x,x+=I;var O=E.left;O.constructor===Array?(A.push(new e(O[0],k)),A.push(new e(O[1],x))):(0!==A.length&&A.last().x==O||A.push(new e(O,k)),A.push(new e(O,x)));var D=E.right;D.constructor===Array?(N.push(new e(D[0],k)),N.push(new e(D[1],x))):(0!==N.length&&N.last().x==D||N.push(new e(D,k)),N.push(new e(D,x))),T++}var U,L,G,H,X=A.length-1;for(U=1;U<X;U++)L=A[U-1],G=A[U],H=A[U+1],L.x===G.x&&H.x===G.x&&(A.splice(U,1),X--,U--);for(X=N.length-1,U=1;U<X;U++)L=N[U-1],G=N[U],H=N[U+1],L.x===G.x&&H.x===G.x&&(N.splice(U,1),X--,U--);var K=[A[0].clone(),N[0].clone()];if(C){for(U=0;U<A.length;U++)A[U].x-=b;for(U=0;U<N.length;U++)N[U].x-=b}this.backgroundSpritesLength[w]=T;var Y=new t;P.addChild(Y);var W=f.segments[d.stageName].slice(),V=null;if(m.waterTypes&&(V=m.waterTypes[0],W=f.segments[V].slice()),d.customSegmentIdxes.length>0){for(var j=[],z=0;z<d.customSegmentIdxes.length;z++){var F=d.customSegmentIdxes[z];j.push(W[F])}W=j,m.useCommon=!1}m.useCommon&&(W=W.concat(f.segments.common));var Q=new springroll.RandomList(W),q=f.units;x=m.startLineZone;for(var Z,J,$,tt=m.length-m.endLineZone;x<tt;){var et,it=tt-x;0===w?(et=Q.random(),v.push(et)):et=v.shift();var nt=et.length;if(nt>=it)break;if(d.segmentStarts[w].push(x),et.units)for(var st=0;st<et.units.length;st++){var at=et.units[st],rt=new nature.WaterUnit(q[at.type],at);if(rt.worldIdx=w,rt.x=c(at.x,K)-b,rt.segmentIdx=d.segmentStarts[w].length-1,at.scale&&(rt.scale=new e(at.scale.x||1,at.scale.y||1)),at.above){if(x===m.startLineZone)continue;rt.y=c(at.y,K),rt.above=!0,rt.visible=!1,this.worldScaler.addChild(rt),d.aboveUnits[w].push(rt)}else rt.y=x+c(at.y,K),P.addChild(rt),d.units[w].push(rt)}if(x+=nt,null!==V){var ot=this.getWaterTypeByY(x);ot!=V&&(V=ot,W=f.segments[V].slice(),m.useCommon&&(W=W.concat(f.segments.common)),Q=new springroll.RandomList(W))}}var lt,ht=d.playerNames[w];for(1===d.numPlayers?(($=l.CHARACTER_NAMES.slice()).shuffle(),$.splice($.indexOf(ht),1),$.unshift(ht)):$=[ht],Z=0;Z<$.length;Z++){var ct,ut=$[Z],dt=m.characterStarts[Z],pt=Object.merge({type:ut},dt),gt=ut!=ht;ct=gt?d.getRandomBoat():d.playerParts[w];var yt=new nature.CharacterUnit(q.characters[pt.type],pt,m,ut,ct);yt.x=pt.x-b,yt.y=pt.y,yt.scale=new e(m.boatScale,m.boatScale),yt.collision.scale=m.boatScale,yt.isNPC=gt,yt.health=f.params.maxHealth,yt.energy=0,yt.worldIdx=w,yt.waterSpeed=m.waterSpeed,yt.leftShorelinePoints=A,yt.rightShorelinePoints=N,yt.boatSpeed=m.unitBaseSpeed,yt.movementYScale=m.movementYScale||1,yt.isNPC||(d.playerCharacterUnits[w]=yt);var ft=new t;Y.addChild(ft);var mt=[u("ring")],vt=yt.emitter=new cloudkid.Emitter(ft,mt,f.emitter);h.display.isWebGL||(vt.frequency*=2,vt.maxParticles/=2),vt.emit=!0,P.addChild(yt),d.characters[w].push(yt);var wt=yt.meter=new i(u("Meter"+ut));mixin(wt,nature.CharacterMeter,f.params.raceMeterMinMax),this.raceMeter.addChild(wt),wt.anchor=new e(.5,.5),wt.x=f.params.raceMeterX,wt.setPercent(yt.y/m.length)}2===d.numPlayers?(lt=new nature.WaterUnit(q.FinishLine2P,null),0===w?(lt.scale.x=-1.03,lt.x=115):(lt.scale.x=1,lt.x=175)):lt=new nature.WaterUnit(q.FinishLine,null),lt.y=m.length,P.addChild(lt),lt._alwaysOver=!0,d.units[w].push(lt),d.allUnits[w]=d.allUnits[w].concat(d.characters[w],d.units[w]);var Ct=0;2===d.numPlayers&&(Ct=w+1);var bt=this["healthMeter"+Ct]=new t;this.addChild(bt);var Pt=40*f.params.maxHealth;for(Z=0;Z<f.params.maxHealth;Z++)J=new s([u("HeartEmpty"),u("HeartFull"),u("HeartHalf")]),bt.addChild(J),J.x=0,J.y=Pt-40*Z,J.gotoAndStop(1),d.hearts[w].push(J);var St,Bt=this["energyMeter"+Ct]=new r(f.energyMeter);if(Bt._maxValue=f.params.maxEnergy,Bt.percent=0,d.energyMeters[w]=Bt,this.addChild(Bt),h.display.isWebGL){var xt=new PIXI.Graphics;for(xt.beginFill(16711680,1),xt.lineStyle(10,16711680,.5),xt.moveTo(A[0].x,A[0].y),St=1;St<A.length;St++)xt.lineTo(A[St].x,A[St].y);for(St=N.length-1;St>=0;St--)xt.lineTo(N[St].x,N[St].y);xt.lineTo(A[0].x,A[0].y),xt.endFill(),Y.addChild(xt),Y.mask=xt}}this.countdown=new pixiflash_lib.Countdown,this.countdown.framerate=30,this.countdown.x=-150,this.addChild(this.countdown),this.countdown.visible=!1,this.countdown.stop()},u.getWaterTypeByY=function(t){var e=n.instance.config.scalingSize.height,i=l.instance.stageConfig,s=Math.floor(t/e);return i.waterTypes[s]},u.updateHealthDisplay=function(t,e){for(var i=Math.floor(e),n=e%1!=0,s=0;s<l.instance.hearts[t].length;s++){var a=l.instance.hearts[t][s];a.gotoAndStop(s<i?1:0),n&&s===i&&a.gotoAndStop(2)}},u.updateEnergyDisplay=function(t,e,i){var n=l.instance.energyMeters[t];n.setPercent(e/n._maxValue,i)},u.showPauseMenu=function(t){return this.pauseMenu.show(t),this.pauseMenu},u.hidePauseMenu=function(t){return this.pauseMenu.hide(t),this.pauseMenu},u.showTryagainMenu=function(t){return this.tryagainMenu.show(t),this.tryagainMenu},u.hideTryagainMenu=function(t){return this.tryagainMenu.hide(t),this.tryagainMenu},u.teardown=function(){this.removeChildren(),this.buttonSounds.destroy(),n.instance.animator.stop(this.countdown);for(var t=l.instance,e=0;e<l.instance.numPlayers;e++){var i,s;for(t.worlds[e].destroy(),t.worlds[e]=null,t.cameras[e]=null,i=0,s=t.allUnits[e].length;i<s;i++)t.allUnits[e][i].destroy(),t.allUnits[e][i]=null;for(t.allUnits[e]=null,i=0,s=t.aboveUnits[e].length;i<s;i++)t.aboveUnits[e][i].destroy(),t.aboveUnits[e][i]=null;for(var a=0;a<t.characters[e].length;a++)t.characters[e][a].destroy(),t.characters[e][a]=null;t.aboveUnits[e]=null,t.units[e]=null}this.pauseButton.destroy(),this.raceMeter.destroy(),this.pauseMenu.destroy(),this.tryagainMenu.destroy(),this.tutorialMenu&&this.tutorialMenu.destroy(),this.countdown.destroy(),this.worldScaler.destroy(),this.buttonSounds=this.pauseButton=this.raceMeter=this.tryagainMenu=this.pauseMenu=this.countdown=t.worlds=t.cameras=this.raceMeter2p=t.allUnits=this.tutorialMenu=this.worldScaler=this.backgroundSpritesLength=null},namespace("nature").GamePanel=h}(),function(){var t=include("PIXI.Container"),e=include("PIXI.Sprite"),i=include("springroll.Application"),n=include("PIXI.Texture"),s=include("springroll.pixi.Button"),a=include("springroll.ButtonSounds"),r=include("nature.data.GameData"),o=function(){t.call(this)},l=extend(o,t);l.setup=function(){var t,o,l=i.instance,h=n.fromImage;this.background=new e(h("scoreBG")),this.addChild(this.background),r.instance.winningCharacter&&(t=r.instance.winningCharacter.characterName);for(var c=0;c<r.CHARACTER_NAMES.length;c++){var u=r.CHARACTER_NAMES[c];u!==t&&((o=this["character"+u]=new pixiflash_lib["Setup"+u])._characterName=u,o.framerate=30,o.interactive=!1,o.buttonMode=!1,this.addChild(o),l.animator.play(o,"idle"))}if(this.partUnlock=new pixiflash_lib.partUnlock,this.partUnlock.framerate=30,this.addChild(this.partUnlock),this.partUnlock.visible=!1,this.partUnlock.stop(),t){var d=t+"Win";(o=this[d]=new pixiflash_lib[d]).framerate=30;l.animator.play(o,l.config.units.characters[t].triggers.SCORE[0]);this.addChild(o)}var p={up:h("replayButton_up"),over:h("replayButton_over"),down:h("replayButton_down")};this.replayButton=new s(p),this.replayButton2=new s(p),p={up:h("newraceButton_up"),over:h("newraceButton_over"),down:h("newraceButton_down")},this.newRaceButton=new s(p),this.newRaceButton2=new s(p),this.buttonSounds=new a("ButtonClick","ButtonRollover",[this.replayButton,this.newRaceButton,this.replayButton2,this.newRaceButton2])},l.addUnlockSprite=function(t){this.addChild(this.replayButton),this.addChild(this.newRaceButton),this.unlockedPartID=t[0]+"_"+t[1],this.partUnlock.boatPart.autoReset=!1,this.partUnlock.boatPart.gotoAndStop(this.unlockedPartID),this.partUnlock.visible=!0,i.instance.animator.play(this.partUnlock,"unlock"),i.instance.sound.play("SignPopUp",{complete:function(){i.instance.sound.play("NewBoatPart")}})},l.addAltButtons=function(){this.addChild(this.replayButton2),this.addChild(this.newRaceButton2)},l.teardown=function(){this.removeChildren(),this.buttonSounds.destroy(),this.background.destroy(),this.replayButton.destroy(),this.newRaceButton.destroy(),this.replayButton2.destroy(),this.newRaceButton2.destroy(),this.partUnlock.destroy();var t=i.instance.animator;if(t.stop(this.partUnlock),r.instance.winningCharacter){var e=r.instance.winningCharacter.characterName+"Win";t.stop(this[e]),this[e].destroy(),this[e]=null}for(var n=0;n<r.CHARACTER_NAMES.length;n++){var s=r.CHARACTER_NAMES[n];this["character"+s]&&(t.stop(this["character"+s]),this["character"+s].destroy(),this["character"+s]=null)}this.background=this.buttonSounds=this.replayButton=this.newRaceButton=this.replayButton2=this.newRaceButton2=this.partUnlock=null},namespace("nature").ScorePanel=o}(),function(){var t=include("PIXI.Container"),e=include("springroll.Application"),i=include("PIXI.Sprite"),n=include("nature.data.GameData"),s=include("PIXI.Point"),a=include("nature.BoatContainer"),r=include("createjs.Tween"),o=include("createjs.Ease"),l=include("springroll.pixi.Button"),h=include("springroll.ButtonSounds"),c=include("nature.PlayerNumberContainer"),u=function(){t.call(this)},d=extend(u,t);d.setup=function(){var u=PIXI.Texture.fromImage,d=this.worldContainer=new t;this.addChild(d);var p=this.uiContainer=new t;this.markerContainer=new t,this.addChild(p),this.uiContainer.addChild(this.markerContainer),this.setupScreen1BG=d.addChild(new i(u("SetupBG_01"))),this.setupScreen2BG=d.addChild(new i(u("SetupBG_02"))),this.setupScreen3BG=d.addChild(new i(u("SetupBG_03")));for(var g,y=[],f=0;f<n.CHARACTER_NAMES.length;f++){var m=n.CHARACTER_NAMES[f],v=this["character"+m]=new pixiflash_lib["Setup"+m],w=this["container"+m]=new t;v._characterName=m,v.framerate=30,v.interactive=!0,v.buttonMode=!0,d.addChild(v),d.addChild(w),e.instance.animator.play(v,"idle")}g={priority:["highlighted","down","over","up"],up:"boatarrow_up",over:"boatarrow_over",down:"boatarrow_down",highlighted:"boatarrow_highlight"};for(var C=["Left","Right"],b=0;b<n.BOAT_PART_TYPES.length;b++)for(var P=n.BOAT_PART_TYPES[b],S=0;S<C.length;S++){var B=C[S],x=this[P+B+"Button"]=d.addChild(new l(g));x._boatPart=P,x._increment="Left"===B?-1:1,y.push(x)}this.boat=d.addChild(new a);this.boat.y=40,r.get(this.boat,{loop:!0}).to({y:50},2e3,o.sineInOut).to({y:40},2e3,o.sineInOut),this.setupStatsBG=d.addChild(new i(u("SetupStatsBG")));for(var k=0;k<n.STAGE_NAMES.length;k++){var T=n.STAGE_NAMES[k];g={priority:["disabled","pseudoDisabled","down","over","up"],pseudoDisabled:"stage_"+T+"Button_disabled",disabled:"stage_"+T+"Button_disabled",up:"stage_"+T+"Button_up",over:"stage_"+T+"Button_over",down:"stage_"+T+"Button_down"};var _=this["stage"+k+"Button"]=new l(g);d.addChild(_),_._stageIdx=k,_._stageName=T,_.visible=!0,_.enabled=!0,_.pseudoDisabled=n.instance.unlockedStages.indexOf(k)<=-1,0===k&&(_.pseudoDisabled=!1),_.pseudoDisabled||y.push(_)}if(this.seagull=new pixiflash_lib.SetupSeagull,this.seagull.framerate=30,this.seagull.interactive=!0,this.seagull.buttonMode=!0,d.addChild(this.seagull),e.instance.animator.play(this.seagull,"idle"),g={up:"backButton_up",over:"backButton_over",down:"backButton_down"},this.backButton=new l(g),y.push(this.backButton),p.addChild(this.backButton),g={priority:["highlighted","down","over","up"],up:"okButton_up",over:"okButton_over",down:"okButton_down",highlighted:"okButton_highlight"},this.okButton=new l(g),y.push(this.okButton),p.addChild(this.okButton),this.okButton.visible=!1,this.playerNumberContainer=p.addChild(new c),this.playerNumberContainer.visible=2==n.instance.numPlayers,2===n.instance.numPlayers)for(var I=1;I<=2;I++){var A=new i(u("PlayerMarker"+I));A.anchor=new s(.5,.5),A.visible=!1,this["marker"+I]=A}this.buttonSounds=new h("ButtonClick","ButtonRollover",y)},d.teardown=function(){this.removeChildren(),this.worldContainer.destroy(),this.uiContainer.destroy(),this.playerNumberContainer.destroy(),this.markerContainer.destroy(),this.buttonSounds.destroy(),this.setupScreen1BG.destroy(),this.setupScreen2BG.destroy(),this.setupScreen3BG.destroy();for(var t=0;t<n.CHARACTER_NAMES.length;t++){var i=n.CHARACTER_NAMES[t],s=this["character"+i];e.instance.animator.stop(s),s.destroy(),this["character"+i]=null}this.backButton.destroy(),this.okButton.destroy();for(var a=[0,1,2,3],o=0;o<a.length;o++){var l=a[o];this["stage"+l+"Button"].destroy(),this["stage"+l+"Button"]=null}e.instance.animator.stop(this.seagull),this.seagull.destroy();for(var h=["Left","Right"],c=0;c<n.BOAT_PART_TYPES.length;c++)for(var u=n.BOAT_PART_TYPES[c],d=0;d<h.length;d++){var p=u+h[d]+"Button";this[p].destroy(),this[p]=null}2===n.instance.numPlayers&&(this.marker1.destroy(),this.marker2.destroy()),r.removeTweens(this.boat),this.boat.destroy(),this.setupStatsBG.destroy(),this.setupScreen1BG=this.setupScreen2BG=this.setupScreen3BG=this.marker1=this.marker2=this.seagull=this.backButton=this.okButton=this.buttonSounds=this.worldContainer=this.uiContainer=this.boat=this.setupStatsBG=this.playerNumberContainer=this.markerContainer=null},namespace("nature").SetupPanel=u}(),function(){var t=include("PIXI.Container"),e=include("PIXI.Sprite"),i=include("PIXI.Texture"),n=include("springroll.ButtonSounds"),s=include("springroll.pixi.Button"),a=function(){t.call(this)},r=extend(a,t);r.setup=function(){this.background=new e(i.fromImage("titleBG")),this.addChild(this.background);var t={priority:["highlighted","down","over","up"],up:"player1_up",over:"player1_over",down:"player1_down",highlighted:"player1_highlight"};this.playButton=new s(t),this.addChild(this.playButton),t={priority:["highlighted","down","over","up"],up:"player2_up",over:"player2_over",down:"player2_down",highlighted:"player2_highlight"},this.play2Button=new s(t),this.addChild(this.play2Button),this.buttonSounds=new n("ButtonClick","ButtonRollover",[this.playButton,this.play2Button])},r.teardown=function(){this.removeChildren(),this.buttonSounds.destroy(),this.background.destroy(),this.playButton.destroy(),this.play2Button.destroy(),this.background=this.playButton=this.play2Button=this.buttonSounds=null},namespace("nature").TitlePanel=a}(),function(){var t=include("springroll.Application"),e=include("createjs.Tween"),i=include("springroll.DelayedCall"),n=include("springroll.State"),s=include("nature.data.CollisionType"),a=include("nature.data.Trigger"),r=include("nature.data.GameData"),o=include("springroll.SavedData"),l=function(t){n.call(this,new nature.GamePanel,t),this.paused=!1,this.handlePause=this.handlePause.bind(this),this.handleQuit=this.handleQuit.bind(this),this.handleMenuRestart=this.handleMenuRestart.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onCharacterCollision=this.onCharacterCollision.bind(this),this.onPowerupTouched=this.onPowerupTouched.bind(this),this.onAbovePowerupTouched=this.onAbovePowerupTouched.bind(this),this.update=this.update.bind(this),this.on("loading",this.handleLoading.bind(this)),this.on("loaded",this._assetsLoaded.bind(this))},h=extend(l,n),c=n.prototype;h.handleLoading=function(t){for(var e=this.config.stages[r.instance.stageName].assets,i=0;i<e.length;i++)t.push(e[i])},h._assetsLoaded=function(){this.touchData=[null,null],this.panel.setup(),this.halfHeight=this.app.config.scalingSize.height/2,this.app.music="River_GameLoop"},h.enterDone=function(){var e=t.instance.config.params.userDataKeys["tutorial"+(1===r.instance.numPlayers?"1p":"2p")];o.read(e)?this.playStartupSequence():(this.panel.pauseButton.enabled=!1,this.panel.tutorialMenu.show(!1),this.panel.tutorialMenu.once("tutorialComplete",function(){this.panel.pauseButton.enabled=!0,o.write(e,!0,!0),this.panel.tutorialMenu.hide(),this.app.voPlayer.play("NC_Game_OkayRace",this.playStartupSequence.bind(this))}.bind(this)))},h.exit=function(){for(var t=[],e=this.config.stages[r.instance.stageName].assets,i=0;i<e.length;i++)t.push(e[i]);this.app.unload(t),this.stopMouseListening(),this.panel.teardown(),c.exit.call(this)},h.playStartupSequence=function(){this.app.voPlayer.play("NC_Game_Ready",function(){this.panel.countdown.visible=!0,this.app.animator.play(this.panel.countdown,{anim:"countdown",audio:"NC_Game_Countdown"},this.startGameplay.bind(this))}.bind(this))},h.startGameplay=function(){this.panel.pauseButton.on("buttonPress",this.handlePause),this.panel.countdown.visible=!1;var t=r.instance;this.app.sound.play("StartWhistle"),this.paused=!1,this.checkKeys=[],this.checkKeys.push({left:"arrow_left",right:"arrow_right",up:"arrow_up",down:"arrow_down"}),2===t.numPlayers&&this.checkKeys.unshift({up:"w",left:"a",down:"s",right:"d"}),this.app.on("update",this.update);for(var e=0;e<t.numPlayers;e++){for(var i=0;i<t.units[e].length;i++)t.units[e][i].start();for(var n=0;n<t.characters[e].length;n++){var s=t.characters[e][n];s.start(),s.on("collided",this.onCharacterCollision),s.on("powerup",this.onPowerupTouched),s.on("abovePowerup",this.onAbovePowerupTouched)}}this.startMouseListening()},h.startMouseListening=function(){var t=this.app.display.renderer.plugins.interaction;t.on("stagedown",this.onMouseDown),t.on("stagemove",this.onMouseMove),t.on("stageup",this.onMouseUp)},h.stopMouseListening=function(){var t=this.app.display.renderer.plugins.interaction;t.off("stagedown",this.onMouseDown),t.off("stagemove",this.onMouseMove),t.off("stageup",this.onMouseUp)},h.onMouseDown=function(t){var e;e=1==r.instance.numPlayers||t.data.global.x<this.app.display.width/2?0:1;var i=this.touchData[e];i?(i.id=t.data.identifier,t.data.getLocalPosition(this.panel.worldScaler,i.pt)):this.touchData[e]={pt:t.data.getLocalPosition(this.panel.worldScaler),id:t.data.identifier}},h.onMouseMove=function(t){for(var e=0;e<this.touchData.length;++e){var i=this.touchData[e];i&&i.id==t.data.identifier&&t.data.getLocalPosition(this.panel.worldScaler,i.pt)}},h.onMouseUp=function(t){for(var e=0;e<this.touchData.length;++e){var i=this.touchData[e];i&&i.id==t.data.identifier&&(this.touchData[e]=null)}},h.onCharacterCollision=function(t){var e=t.unit;switch(t.type){case s.WATERUNIT:case s.CHARACTERUNIT:t.details.collide(e,!0)}if(!e.isNPC){var i=e.worldIdx;if(e.characterName===r.instance.playerCharacterUnits[i].characterName){var n=e.health;this.panel.updateHealthDisplay(i,n),this.app.sound.play("HeartDepleted"),n<=0?this.startGameOver(e,!1):n<=e.heartsPerHit?e.playTrigger(a.ONEHITLEFT):e.playTrigger(a.COLLIDES)}}},h.onPowerupTouched=function(t,e){var n,s=r.instance;switch(s.units[t.worldIdx].splice(s.units[t.worldIdx].indexOf(e),1),s.allUnits[t.worldIdx].splice(s.allUnits[t.worldIdx].indexOf(e),1),e.collide(t),e.parent.removeChild(e),e.powerupType){case"health":n=Math.randomInt(1,3),t.health=Math.min(this.config.params.maxHealth,t.health+n),t.showCollect(n,0),t.characterName===s.playerCharacterUnits[t.worldIdx].characterName&&this.panel.updateHealthDisplay(t.worldIdx,t.health);break;case"energy":if(n=Math.randomInt(1,3),t.energy>=this.config.params.maxEnergy)break;t.energy=Math.min(this.config.params.maxEnergy,t.energy+n),t.showCollect(n,1),t.energy===this.config.params.maxEnergy&&(t.characterName===s.playerCharacterUnits[t.worldIdx].characterName&&t.playTrigger(a.EARNSBOOST),t.energyBoost=6,t.energyDrainCall=new i(function(){t.energy=0,t.energyDrainCall=null,t.characterName===s.playerCharacterUnits[t.worldIdx].characterName&&this.panel.updateEnergyDisplay(t.worldIdx,t.energy,!1),t.energyBoost=1}.bind(this),4e3)),t.characterName===s.playerCharacterUnits[t.worldIdx].characterName&&this.panel.updateEnergyDisplay(t.worldIdx,t.energy,!0)}},h.onAbovePowerupTouched=function(t,i){switch(i.enabled=!1,this.app.sound.play("GustofWind"),i.powerupType){case"fast":t.isInvulnerable=!0,e.get(t).to({windSpeed:2*t.boatSpeed},1e3).wait(2e3).to({windSpeed:0},500).call(function(){t.isInvulnerable=!1}.bind(this)),t.playTrigger(a.EARNSBOOST);break;case"slow":e.get(t).to({windSpeed:-t.boatSpeed},500).wait(2e3).to({windSpeed:0},500),t.playTrigger(a.SLOWEDBYWIND)}},h.startGameOver=function(e){var i=null;1===r.instance.numPlayers?(this.panel.pauseButton.enabled=!1,t.instance.off("update",this.update),i=function(){e.playTrigger("TRYAGAIN",this.showTryagainMenu.bind(this))}.bind(this)):i=function(){e.resurrect()}.bind(this),e.sink(i)},h.update=function(t){for(var e=t/1e3,i=r.instance,n=!1,s=!1,a=0;a<i.numPlayers;a++){for(var o=0;o<i.units[a].length;o++)i.units[a][o].move(t);for(var l=i.playerCharacterUnits[a],h=0;h<i.characters[a].length;h++){var c=i.characters[a][h];if(!this.paused){var u=e*c.speedMultiplier*c.boatSpeed;if(c===l&&c.isRacing){var d=1*u;isNaN(c.movementVector.x)&&(c.movementVector.x=0),isNaN(c.movementVector.y)&&(c.movementVector.y=0);var p=this.checkKeys[a];if(this.app.keyboard.isDown(p.left)?(c.movementVector.x=-d,this.touchData[0]=null):this.app.keyboard.isDown(p.right)&&(c.movementVector.x=d,this.touchData[0]=null),this.app.keyboard.isDown(p.up)?(c.movementVector.y=-d,this.touchData[0]=null):this.app.keyboard.isDown(p.down)&&(c.movementVector.y=d,this.touchData[0]=null),this.touchData[a]){var g=this.touchData[a].pt.x;1==a&&(g-=600);var y=this.touchData[a].pt.y+i.cameras[a].worldTopEdge;c.movementVector.x=g-c.x,c.movementVector.y=y-c.y}}c.movementDistance=c.movementVector.length(),c.movementVector.normalize(),c.update(e),c.meter.setPercent(c.y/i.stageConfig.length),this.panel.raceMeter.sortChildren(),c.emitter&&(c.emitter.updateOwnerPos(c.x,c.y),c.emitter.update(e));var f=!1;c.y>=i.stageConfig.length&&c.isRacing&&(c.isRacing=!1,c.isInvulnerable=!0,this.winningCharacter||(f=!0,this.winningCharacter={characterName:c.characterName,isNPC:c.isNPC},c.celebrate()),c.isNPC||!c.isNPC&&!f?c._endY=i.stageConfig.length+120:c._endY=i.stageConfig.length+this.halfHeight+90),c.y>=c._endY&&!c.isRacing&&c.enabled&&(c.enabled=!1,this.checkForGameplayEnd(c))}}var m=Math.clamp(l.y+i.stageConfig.cameraCenterOffset-100,i.stageConfig.length);i.cameras[a].update(m),i.allUnits[a].sort(this.unitSort);for(var v=this.panel.backgroundSpritesLength[a],w=i.cameras[a].worldTopEdge,C=i.cameras[a].worldBottomEdge,b=i.worlds[a].children.length-1,P=0;P<i.allUnits[a].length;P++){var S=i.allUnits[a][P];i.worlds[a].setChildIndex(S,Math.min(b,P+v+1));var B=S.height/2,x=S.y-B,k=S.y+B>w&&x<C;k&&(n=!0),S.visible=k}for(var T=-1,_=0;_<i.segmentStarts[a].length;_++)if(w<i.segmentStarts[a][_]){T=_;break}if(T!=i.currentSegmentIdxes[a]){i.currentSegmentIdxes[a]=T;for(var I=0;I<i.aboveUnits[a].length;I++){var A=i.aboveUnits[a][I].enterSegment(T);A&&"fast"===A.powerupType&&(s=!0)}}}n&&!1===this.playedObstacleAudio?(this.playedObstacleAudio=!0,this.app.voPlayer.play("NC_Game_Obstacles")):s&&!1===this.playedTailwindsAudio&&(this.playedTailwindsAudio=!0,this.app.voPlayer.play("NC_Game_IntoTailWinds"))},h.unitSort=function(t,e){if(t._alwaysOver)return 1;if(e._alwaysOver)return-1;var i=t.y+t.height/2,n=e.y+e.height/2;return i<n?-1:i>n?1:0},h.checkForGameplayEnd=function(t){var e=r.instance,i=!0;if(t.isNPC||this.winningCharacter.characterName!==t.characterName)for(var n=0;n<e.numPlayers;n++)for(var s=0;s<e.characters[n].length;s++){if(e.characters[n][s].enabled){i=!1;break}}else;i&&(this.endGameplay(),this.paused=!0)},h.endGameplay=function(){t.instance.off("update",this.update),r.instance.winningCharacter=this.winningCharacter,this.nextState(),this.winningCharacter=null},h.handlePause=function(){this.panel.pauseButton.enabled=this.paused,this.paused=!this.paused;for(var e=0;e<r.instance.numPlayers;e++)for(var i=0;i<r.instance.aboveUnits[e].length;i++)r.instance.aboveUnits[e][i].paused=this.paused;var n;this.paused?(t.instance.off("update",this.update),(n=this.panel.showPauseMenu(!0)).on("pausePlayClicked",this.handlePause),n.on("pauseRestartClicked",this.handleMenuRestart),n.on("pauseQuitClicked",this.handleQuit)):(t.instance.on("update",this.update),(n=this.panel.hidePauseMenu(!0)).off("pausePlayClicked",this.handlePause),n.off("pauseRestartClicked",this.handleMenuRestart),n.off("pauseQuitClicked",this.handleQuit))},h.showTryagainMenu=function(){this.panel.pauseButton.enabled=!1;var t=this.panel.showTryagainMenu();t.on("tryagainQuitClicked",this.handleQuit),t.on("tryagainRestartClicked",this.handleMenuRestart)},h.handleQuit=function(){t.instance.off("update",this.update);var e=this.panel.hideTryagainMenu();e.off("tryagainQuitClicked",this.handleQuit),e.off("tryagainRestartClicked",this.handleMenuRestart),pauseMenuInstance=this.panel.hidePauseMenu(),pauseMenuInstance.off("pauseQuitClicked",this.handleQuit),pauseMenuInstance.off("pausePlayClicked",this.handlePause),pauseMenuInstance.off("pauseRestartClicked",this.handleMenuRestart),t.instance.manager.state="title"},h.handleMenuRestart=function(){t.instance.off("update",this.update),this.restart()},h.restart=function(){t.instance.manager.refresh()},Object.defineProperty(h,"playedObstacleAudio",{get:function(){if(void 0===this._playedObstacleAudio){var e=t.instance.config.params.userDataKeys.obstacles,i=o.read(e);this._playedObstacleAudio=!!i}return this._playedObstacleAudio},set:function(e){this._playedObstacleAudio=e;var i=t.instance.config.params.userDataKeys.obstacles;o.write(i,e,!0)}}),Object.defineProperty(h,"playedTailwindsAudio",{get:function(){if(void 0===this._playedTailwindsAudio){var e=t.instance.config.params.userDataKeys.tailwinds,i=o.read(e);this._playedTailwindsAudio=!!i}return this._playedTailwindsAudio},set:function(e){this._playedTailwindsAudio=e;var i=t.instance.config.params.userDataKeys.tailwinds;o.write(i,e,!0)}}),namespace("nature").GameState=l}(),function(){var t=include("springroll.Application"),e=include("springroll.State"),i=include("nature.data.GameData"),n=function(t){e.call(this,new nature.ScorePanel,t),this.previousState=this.previousState.bind(this),this.nextState=this.nextState.bind(this),this.on("loaded",this._assetsLoaded.bind(this))},s=extend(n,e),a=e.prototype;s._assetsLoaded=function(){this.panel.setup(),this.panel.replayButton.on("buttonPress",this.previousState),this.panel.newRaceButton.on("buttonPress",this.nextState),this.panel.replayButton2.on("buttonPress",this.previousState),this.panel.newRaceButton2.on("buttonPress",this.nextState),this.app.music="River_MenuLoop"},s.enterDone=function(){var t=i.instance;if(t.winningCharacter&&(t.winningCharacter.isNPC||1!==t.numPlayers||this.doUnlocking(),1===t.numPlayers)){var e=this.app.config.params.stageUnlocks[t.stageName];null!==e&&-1===t.unlockedStages.indexOf(e)&&(t.unlockedStages.push(e),this.app.userData.write(this.app.config.params.userDataKeys.stages,t.unlockedStages))}1===t.numPlayers&&t.winningCharacter.characterName===t.playerCharacterUnits[0].characterName||this.panel.addAltButtons()},s.doUnlocking=function(){var e=i.instance;"gp"==e.stageName&&this.panel.addAltButtons();var n=null,s=t.instance.config.stages[e.stageName].unlocks;if(s){for(var a=0;a<s.length;a++){for(var r=s[a],o=!1,l=0;l<e.unlocks.length;l++){var h=e.unlocks[l];r[0]===h[0]&&r[1]===h[1]&&(o=!0)}if(!o){n=r;break}}null!==n?(e.justUnlockedPart=n,e.unlocks.push(n),e.buildUnlockedParts(),this.app.userData.write(t.instance.config.params.userDataKeys.unlocks,e.unlocks),this.panel.addUnlockSprite(n)):this.panel.addAltButtons()}},s.exit=function(){a.exit.call(this),this.panel.teardown()},namespace("nature").ScoreState=n}(),function(){var t=include("springroll.Application"),e=include("createjs.Tween"),i=include("springroll.State"),n=include("springroll.RandomList"),s=include("nature.StatMeter"),a=include("nature.data.GameData"),r=function(e){i.call(this,new nature.SetupPanel,e),this.characterClicked=this.characterClicked.bind(this),this.screen2ArrowClicked=this.screen2ArrowClicked.bind(this),this.screen1OKClicked=this.screen1OKClicked.bind(this),this.screen2OKClicked=this.screen2OKClicked.bind(this),this.screen3StageClicked=this.screen3StageClicked.bind(this),this.screen3StageLocked=this.screen3StageLocked.bind(this),this.screen1BackClicked=this.screen1BackClicked.bind(this),this.screen2BackClicked=this.screen2BackClicked.bind(this),this.screen3BackClicked=this.screen3BackClicked.bind(this),this.seagullClicked=this.seagullClicked.bind(this),this.handleResize=this.handleResize.bind(this),this.on("loaded",this._assetsLoaded.bind(this)),this.currentPlayerIdx=0,this.screensX=[0,-1300,-2600],this.currentScreenIdx=0,this.choiceVOCountdown=Math.randomInt(4,6),t.instance.on("resize",this.resizeToken.bind(this),-1),this.playTokenExists=!1,this.otherMarker=null,this.tokenBounds=null},o=extend(r,i),l=i.prototype;o._assetsLoaded=function(){this.panel.setup(),this.screensSeen=[!1,!1,!1],a.instance.playerNames=[null,null],a.instance.playerParts=[null,null],this.currentPlayerIdx=0,this.showScreen1(!1),this.choicePraise=new n(["NC_Build_Amazing","NC_Build_LooksWinner","NC_Build_Ooo"]),t.instance.on("resize",this.handleResize),t.instance.music="River_MenuLoop",this.app.hints.enabled=!1},o.handleResize=function(e,i){this.panel.worldContainer.x=this.screensX[this.currentScreenIdx]*t.instance.scaling.scale},o.showScreen1=function(i){this.currentScreenIdx=0,e.get(this.panel.worldContainer).to({x:this.screensX[this.currentScreenIdx]*t.instance.scaling.scale},500).call((function(){this.panel.okButton.on("buttonPress",this.screen1OKClicked),this.panel.backButton.on("buttonPress",this.screen1BackClicked),this.panel.okButton.visible=!0,null===a.instance.playerNames[this.currentPlayerIdx]?(this.panel.okButton.enabled=!1,this.panel.okButton.visible=!1):(this.panel.okButton.enabled=!0,this.panel.okButton.visible=!0);for(var t=0;t<a.CHARACTER_NAMES.length;t++){var e=a.CHARACTER_NAMES[t],i=this.panel["character"+e],n=!0;if(2===a.instance.numPlayers){var s=0===this.currentPlayerIdx?1:0;if(e===a.instance.playerNames[s]){n=!1;var r=this.panel["marker"+(s+1)];r.visible=!0,this.panel["container"+e].addChild(r);i.getBounds();r.x=0,r.y=0,this.setButtonSelected(i,!0)}}n&&(i.on("mouseup",this.characterClicked),i.on("touchend",this.characterClicked))}if(this.screensSeen[0]){var o=this.app.hasTouch?"NC_Char_Tap":"NC_Char_Click";this.app.hints.vo(o),this.app.hints.startTimer(8e3),this.app.hints.enabled=!0}else{var l;1===a.instance.numPlayers?(l="NC_Char_ChooseCharacter",this.screensSeen[0]=!0):(l=0===this.currentPlayerIdx?"NC_Char_PlayerOne":"NC_Char_PlayerTwo",this.screensSeen[0]=1===this.currentPlayerIdx),this.app.hints.enabled=!1,this.app.hints.stopTimer(),this.app.voPlayer.play(l,function(){var t=this.app.hasTouch?"NC_Char_Tap":"NC_Char_Click";this.app.hints.vo(t),this.app.hints.startTimer(8e3)}.bind(this))}}),null,this)},o.resizeToken=function(){if(this.tokenBounds){var t=this.tokenButton.getBounds();this.otherMarker.x=t.x+t.width/2,this.otherMarker.y=t.y+t.height}},o.screen1BackClicked=function(){if(this.hideScreen1(),1===a.instance.numPlayers||0===this.currentPlayerIdx)this.previousState();else{for(var t=a.instance.playerNames[1],e=0;e<a.CHARACTER_NAMES.length;e++){var i=a.CHARACTER_NAMES[e];if(i===t){var n=this.panel["character"+i];this.setButtonSelected(n,!1)}}a.instance.playerNames[1]=null,this.setCurrentPlayerIdx(0),this.showScreen2()}},o.screen1OKClicked=function(){this.app.hints.enabled=!1,this.app.hints.stopTimer(),this.app.sound.play("MenuScreenPan"),this.hideScreen1(),this.showScreen2()},o.characterClicked=function(t){this.app.hints.stopTimer(),this.app.hints.func(this.screen1OKHint.bind(this)),this.app.hints.startTimer(8e3);var e=t.target,i=e._characterName;this.app.voPlayer.play(this.app.config.params.characterVOLookup[i]);for(var n=0;n<a.CHARACTER_NAMES.length;n++){var s=a.CHARACTER_NAMES[n],r=this.panel["character"+s];if(this.setButtonSelected(r,!1),2===a.instance.numPlayers){var o=0===this.currentPlayerIdx?1:0;s===a.instance.playerNames[o]&&this.setButtonSelected(r,!0)}}this.setButtonSelected(e,!0),this.panel.okButton.enabled=!0,this.panel.okButton.visible=!0,a.instance.playerCharacterChosen(this.currentPlayerIdx,i)},o.screen1OKHint=function(){this.app.hints.stopTimer();var t=this.app.hasTouch?"NC_Char_ReadyTap":"NC_Char_ReadyClick";e.get(this).wait(700).call(function(){this.panel.okButton.highlighted=!0}.bind(this)),this.app.voPlayer.play(t,function(){this.app.hints.startTimer(8e3),this.panel.okButton.highlighted=!1}.bind(this))},o.setButtonSelected=function(t,e){e?(this.app.animator.stop(t),t.gotoAndStop("selected")):t._selected&&this.app.animator.play(t,"idle"),t._selected=e},o.hideScreen1=function(){this.panel.okButton.off("buttonPress",this.screen1OKClicked),this.panel.backButton.off("buttonPress",this.screen1BackClicked),2===a.instance.numPlayers&&(this.panel.marker1.visible=this.panel.marker2.visible=!1);for(var t=0;t<a.CHARACTER_NAMES.length;t++){var e=a.CHARACTER_NAMES[t],i=this.panel["character"+e];i.off("mouseup",this.characterClicked),i.off("touchend",this.characterClicked)}},o.showScreen2=function(){this.app.hints.enabled=!1,this.app.hints.stopTimer(),this.currentScreenIdx=1,e.get(this.panel.worldContainer).to({x:this.screensX[this.currentScreenIdx]*t.instance.scaling.scale},500).call((function(){var t;if(this.panel.okButton.visible=!0,this.panel.backButton.on("buttonPress",this.screen2BackClicked),this.panel.okButton.on("buttonPress",this.screen2OKClicked),this.screensSeen[1]){if(null!==a.instance.justUnlockedPart){var e={base:"NC_Build_NewBase",accessory:"NC_Build_NewAccessory",sail:"NC_Build_NewSail"}[a.instance.justUnlockedPart[0]];a.instance.justUnlockedPart=null,this.app.voPlayer.play(e,this.app.enableHints)}}else 1===a.instance.numPlayers?t="NC_Build_Build":(t=0===this.currentPlayerIdx?"NC_Build_PlayerOne":"NC_Build_PlayerTwo",this.screensSeen[1]=1===this.currentPlayerIdx),t=[t,"NC_Build_Options"],this.app.voPlayer.play(t,this.app.enableHints)}),null,this);for(var i=["Left","Right"],n=0;n<a.BOAT_PART_TYPES.length;n++)for(var r=a.BOAT_PART_TYPES[n],o=a.instance.unlockedParts[r].length>1,l=0;l<i.length;l++){var h=r+i[l]+"Button";o?this.panel[h].on("buttonPress",this.screen2ArrowClicked):this.panel[h].visible=!1}e.get(this).wait(2300).call(function(){for(var t=a.BOAT_PART_TYPES[0],e=0;e<i.length;e++){var n=t+i[e]+"Button";this.panel[n].highlighted=!0}}.bind(this)).wait(1500).call(function(){for(var t=0;t<i.length;t++){var e=a.BOAT_PART_TYPES[0],n=e+i[t]+"Button";this.panel[n].highlighted=!1,n=(e=a.BOAT_PART_TYPES[1])+i[t]+"Button",this.panel[n].highlighted=!0}}.bind(this)).wait(1500).call(function(){for(var t=0;t<i.length;t++){var e=a.BOAT_PART_TYPES[1],n=e+i[t]+"Button";this.panel[n].highlighted=!1,n=(e=a.BOAT_PART_TYPES[2])+i[t]+"Button",this.panel[n].highlighted=!0}}.bind(this)).wait(1500).call(function(){for(var t=0;t<i.length;t++)r=a.BOAT_PART_TYPES[2],h=r+i[t]+"Button",this.panel[h].highlighted=!1;this.app.hints.func(this.screen2ArrowHint.bind(this)),this.app.hints.startTimer(8e3),this.app.hints.enabled=!0,this.hintCycle=0}.bind(this));for(var c=0;c<a.STAT_NAMES.length;c++){var u=a.STAT_NAMES[c],d=this.panel[u+"Meter"]=new s;this.panel.worldContainer.addChild(d),d._name=u,d.percent=0,t.instance.scaling.addItem(d,this.config.scaling.setup[u+"Meter"])}this.updateBoat()},o.enableHints=function(){this.app.hints.enabled=!0},o.screen2ArrowHint=function(){this.app.hints.enabled=!1,this.app.hints.stopTimer();var t=["Left","Right"],e=function(e,i){for(var n=0;n<t.length;n++){var s=void 0!==i?i:this.hintCycle-1,r=a.BOAT_PART_TYPES[s]+t[n]+"Button";this.panel[r].highlighted=e}}.bind(this),i=function(t){for(var i=0;i<3;i++)e(t,i)}.bind(this);0===this.hintCycle?i(!0):e(!0);var n=["NC_Build_Arrows","NC_Build_FirstSail","NC_Build_Base","NC_Build_Accessory"][this.hintCycle];this.app.voPlayer.play(n,function(){i(!1),this.app.hints.startTimer(8e3)}.bind(this),!0),this.hintCycle++,this.hintCycle>3&&(this.hintCycle=0)},o.unHighlightAll=function(){for(var t=["Left","Right"],e=0;e<3;e++)for(var i=0;i<t.length;i++){var n=a.BOAT_PART_TYPES[e]+t[i]+"Button";this.panel[n].highlighted=!1}},o.screen2ArrowClicked=function(t){this.app.hints.stopTimer();var e=t._boatPart,i=a.instance.playerParts[this.currentPlayerIdx],n=a.instance.unlockedParts[e],s=n.indexOf(i[e]),r=n[Math.mod(s+t._increment,n.length)];if(i[t._boatPart]=r,this.updateBoat(),this.partVOPlayed||(this.partVOPlayed={}),!this.partVOPlayed[e]){var o={sail:"NC_Build_SailFact",base:"NC_Build_BaseFact",accessory:null}[e];o&&this.app.voPlayer.play(o),this.partVOPlayed[e]=!0}this.choiceVOCountdown--,0===this.choiceVOCountdown&&(this.choiceVOCountdown=Math.randomInt(4,6),this.app.voPlayer.play(this.choicePraise.random()))},o.updateBoat=function(){var e=this.panel.boat,i=a.instance.playerNames[this.currentPlayerIdx],n={speed:0,defense:0};e.display(a.instance.playerParts[this.currentPlayerIdx],i,t.instance.config.units.characters[i],n);for(var s=0;s<a.STAT_NAMES.length;s++){var r=a.STAT_NAMES[s],o=this.panel[r+"Meter"];o._name=r,o.setPercent(n[r],250)}},o.screen2BackClicked=function(){this.unHighlightAll(),this.app.sound.play("MenuScreenPan"),this.app.voPlayer.stop(),this.panel.okButton.off("buttonPress",this.screen2OKClicked),this.panel.backButton.off("buttonPress",this.screen2BackClicked),this.hideScreen2(),this.showScreen1(),this.app.hints.stopTimer(),this.app.hints.enabled=!1},o.screen2OKClicked=function(){this.app.hints.stopTimer(),this.app.hints.enabled=!1,this.panel.okButton.off("buttonPress",this.screen2OKClicked),this.panel.backButton.off("buttonPress",this.screen2BackClicked);for(var t=null,e=0;e<a.STAT_NAMES.length;e++){var i=a.STAT_NAMES[e];if(this.panel[i+"Meter"].percent>=1){t=i;break}}if(t){this.app.voPlayer.play({speed:"NC_Build_Speedy",defense:"NC_Build_Strong"}[t],this.leaveScreen2.bind(this))}else this.leaveScreen2()},o.leaveScreen2=function(){this.app.sound.play("MenuScreenPan"),this.hideScreen2(),this.app.voPlayer.stop(),1===a.instance.numPlayers?this.showScreen3():0===this.currentPlayerIdx?(this.setCurrentPlayerIdx(1),this.showScreen1()):(a.instance.stageChosen("2p"),this.nextState())},o.hideScreen2=function(){for(var t=0;t<a.STAT_NAMES.length;t++){var e=a.STAT_NAMES[t];this.panel.removeChild(this.panel[e+"Meter"])}for(var i=["Left","Right"],n=0;n<a.BOAT_PART_TYPES.length;n++)for(var s=a.BOAT_PART_TYPES[n],r=0;r<i.length;r++){var o=s+i[r]+"Button";this.panel[o].off("buttonPress",this.screen2ArrowClicked)}this.panel.boat.character=null},o.showScreen3=function(i){this.app.hints.vo("NC_Level_Choose"),this.app.hints.enabled=!1,this.currentScreenIdx=2,e.get(this.panel.worldContainer).to({x:this.screensX[this.currentScreenIdx]*t.instance.scaling.scale},500).call((function(){this.panel.backButton.on("buttonPress",this.screen3BackClicked);this.screensSeen[this.currentScreenIdx]=!0,this.app.voPlayer.play("NC_Level_Choose",function(){this.app.hints.enabled=!0}.bind(this))}),null,this);for(var n=[0,1,2,3],s=0;s<n.length;s++){var a=n[s];this.panel["stage"+a+"Button"].pseudoDisabled?this.panel["stage"+a+"Button"].on("buttonPress",this.screen3StageLocked):this.panel["stage"+a+"Button"].on("buttonPress",this.screen3StageClicked)}this.panel.okButton.visible=!1,this.panel.seagull.on("mouseup",this.seagullClicked),this.panel.seagull.on("touchend",this.seagullClicked)},o.screen3BackClicked=function(){this.app.hints.stopTimer(),this.app.hints.enabled=!1,this.app.sound.play("MenuScreenPan"),this.hideScreen3(),this.showScreen2()},o.screen3StageClicked=function(t){this.app.hints.stopTimer(),this.app.hints.enabled=!1;for(var e=[0,1,2,3],i=0;i<e.length;i++){var n=e[i];this.panel["stage"+n+"Button"].pseudoDisabled?this.panel["stage"+n+"Button"].off("buttonPress",this.screen3StageLocked):this.panel["stage"+n+"Button"].off("buttonPress",this.screen3StageClicked)}this.hideScreen3();var s={stream:"NC_Level_BreezyStream",river:"NC_Level_RapidRiver",ocean:"NC_Level_ShipwreckSea",gp:"NC_Level_GrandPrix"}[t._stageName];this.app.voPlayer.play(s,function(){a.instance.stageChosen(t._stageName),this.nextState()}.bind(this))},o.screen3StageLocked=function(t){this.app.voPlayer.play("NC_Level_Locked")},o.seagullClicked=function(){t.instance.animator.play(this.panel.seagull,[{anim:"reaction",audio:"Seagull"},{anim:"idle"}])},o.hideScreen3=function(){this.panel.backButton.off("buttonPress",this.screen3BackClicked);for(var t=[0,1,2,3],e=0;e<t.length;e++){var i=t[e];this.panel["stage"+i+"Button"].off("buttonPress",this.screen3StageClicked)}this.panel.seagull.off("mouseup",this.seagullClicked),this.panel.seagull.off("touchend",this.seagullClicked)},o.setCurrentPlayerIdx=function(t){this.currentPlayerIdx=t,this.panel.playerNumberContainer.playerNumber=t},o.exit=function(){t.instance.off("resize",this.handleResize),e.removeTweens(this),this.app.hints.enabled=!1,this.app.hints.stopTimer(),l.exit.call(this),this.panel.teardown()},namespace("nature").SetupState=r}(),function(){var t=include("springroll.State"),e=include("createjs.Tween"),i=include("nature.data.GameData"),n=function(e){t.call(this,new nature.TitlePanel,e),this.btnClicked=this.btnClicked.bind(this),this.on("loaded",this._assetsLoaded.bind(this))},s=extend(n,t),a=t.prototype;s._assetsLoaded=function(){this.panel.setup(),this.panel.playButton.on("buttonPress",this.btnClicked),this.panel.play2Button.on("buttonPress",this.btnClicked),this.app.music="River_MenuLoop",this.app.hints.enabled=!1},s.btnClicked=function(t){e.removeTweens(this),this.panel.playButton.off("buttonPress",this.btnClicked),this.panel.play2Button.off("buttonPress",this.btnClicked),i.instance.numPlayers=t===this.panel.playButton?1:2;var n=t===this.panel.playButton?"NC_Title_OnePlayer":"NC_Title_TwoPlayer";this.app.voPlayer.play(n,this.nextState.bind(this),!0)},s.enterDone=function(){this.app.voPlayer.play(this.app.cleanVO("NC_OneOrTwo%TOUCH%"),function(){this.playButton.highlighted=!1,this.play2Button.highlighted=!1}.bind(this.panel),!0),e.get(this).wait(100).call((function(){this.playButton.highlighted=!0}),null,this.panel).wait(1700).call((function(){this.playButton.highlighted=!1,this.play2Button.highlighted=!0}),null,this.panel)},s.exit=function(){e.removeTweens(this),a.exit.call(this),this.panel.teardown()},namespace("nature").TitleState=n}(),function(){var t=include("springroll.Application"),e=include("springroll.pixi.PixiDisplay"),i=include("nature.data.GameData"),n=include("nature.TitleState"),s=include("nature.SetupState"),a=include("nature.GameState"),r=include("nature.ScoreState"),o=include("springroll.UserData"),l=include("PIXI.utils");l.useFilenamesForTextures=!0;var h=new t({name:"river-rapids",useQueryString:!1,canvasId:"stage",configPath:"assets/config/config.json",display:e,displayOptions:{clearView:!0,antiAlias:!0},enableHiDPI:!0,transitionSounds:{out:"TransitionBeginning",loop:"TransitionMiddle",in:"TransitionEnding"},preventScrollingKeys:!0});h.once("configLoaded",(function(t,e){t.assets.init&&t.assets.init.forEach((function(t){e.push(t)}))})),h.on("init",function(){this.display.autoPreventDefault=this.hasTouch,this.transition=new pixiflash_lib.Transition,this.transition.framerate=30;var t=i.init();t.allParts=this.config.parts,this.userData=new o(this.container),this.userData.read(this.config.params.userDataKeys.unlocks,function(e){e||(e=this.config.startUnlocks.slice()),t.unlocks=e,t.buildUnlockedParts()}.bind(this)),this.userData.read(this.config.params.userDataKeys.stages,function(e){e||(e=this.config.params.startStageUnlocks.slice()),t.unlockedStages=e}.bind(this)),this.states={title:new n({next:"setup",preload:this.config.assets.title,scaling:this.config.scaling.title}),setup:new s({previous:"title",next:"game",preload:this.config.assets.setup,scaling:this.config.scaling.setup}),game:new a({next:"score",previous:"title",preload:this.config.assets.game,scaling:this.config.scaling.game}),score:new r({next:"setup",previous:"game",preload:this.config.assets.score,scaling:this.config.scaling.score})},this.options.state||(this.manager.state="title")}.bind(h)),window.app=h,h.cleanVO=function(t){var e="Click";return this.hasTouch&&(e="Tap"),t.replace("%TOUCH%",e)}}(),Math.mod=function(t,e){return(t%e+e)%e},Math.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)};