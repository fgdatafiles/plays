window.Box2D=window.Box2D(),function(){"use strict";var t=include("Box2D.b2Color"),e=include("Box2D.b2Transform"),i=include("Box2D.b2Vec2"),s=include("Box2D.JSDraw"),n=include("Box2D.destroy"),o=include("Box2D.wrapPointer"),r={},a=1,h=[],l=function(e,i){var s=o(i,t),n=(255*s.get_r()|0)+","+(255*s.get_g()|0)+","+(255*s.get_b()|0);e.fillStyle="rgba("+n+",0.25)",e.strokeStyle="rgb("+n+")",e.lineWidth=.04},p=function(t,e,s,n){var r=0,a=null;for(t.beginPath(),r=0;r<s;r++)a=o(e+8*r,i),0===r?t.moveTo(a.get_x(),a.get_y()):t.lineTo(a.get_x(),a.get_y());t.closePath(),n&&t.fill(),t.stroke()},c=function(t,e,s,r,a){var h=o(e,i),l=o(r,i),p=null,c=null;t.beginPath(),t.arc(h.get_x(),h.get_y(),s,0,2*Math.PI,!1),a&&t.fill(),t.stroke(),a&&(c=new i(h.get_x(),h.get_y()),p=new i(s*l.get_x(),s*l.get_y()),c.op_add(p),t.beginPath(),t.moveTo(h.get_x(),h.get_y()),t.lineTo(c.get_x(),c.get_y()),t.stroke(),n(c),n(p))};r[0]=null,window.Box2D.helpers={getCanvasDebugDraw:function(t){var r=new s;return r.DrawSegment=function(e,s,n){l(t,n),function(t,e,s){var n=o(e,i),r=o(s,i);t.beginPath(),t.moveTo(n.get_x(),n.get_y()),t.lineTo(r.get_x(),r.get_y()),t.stroke()}(t,e,s)},r.DrawPolygon=function(e,i,s){l(t,s),p(t,e,i,!1)},r.DrawSolidPolygon=function(e,i,s){l(t,s),p(t,e,i,!0)},r.DrawCircle=function(e,s,o){var r=new i(0,0);l(t,o),c(t,e,s,r,!1),n(r)},r.DrawSolidCircle=function(e,i,s,n){l(t,n),c(t,e,i,s,!0)},r.DrawTransform=function(i){!function(t,i){var s,n=o(i,e),r=n.get_p(),a=n.get_q();t.save(),t.translate(r.get_x(),r.get_y()),t.scale(.5,.5),t.rotate(a.GetAngle()),t.lineWidth*=2,(s=t).strokeStyle="rgb(192,0,0)",s.beginPath(),s.moveTo(0,0),s.lineTo(1,0),s.stroke(),s.strokeStyle="rgb(0,192,0)",s.beginPath(),s.moveTo(0,0),s.lineTo(0,1),s.stroke(),t.restore()}(t,i)},r},getUserData:function(t){return r[t.GetUserData()]},setUserData:function(t,e){var i=t.GetUserData();i||(h.length?i=h.pop():(i=a,a+=1),t.SetUserData(i)),r[i]=e},clearUserData:function(t){var e=t.GetUserData();e&&(r.hasOwnProperty(e)&&h.indexOf(e)<0?(h.push(e),r[e]=null):platypus.debug.warn("Box2D `userData` Helper: Tried to clear userData with an invalid ID."))}}}(),platypus.Badger=function(){"use strict";var t=[],e=function(e,i,s,n){var o=null,r=0,a="",h=0,l="",p={},c=null,u={},d=null;for(a in this.badgesAwarded=[],this.keys=p,this.userData=s,this.badges=u,this.loading=!0,this.gameId=i,e)if(e.hasOwnProperty(a))for(o=e[a].badges,u[a]=[],h=o.length;h--;){for(l in d=o[h],u[a][d.id]=c={},d)d.hasOwnProperty(l)&&(c[l]=d[l]);if(c.subgoals)for(r=c.subgoals.length;r--;)p[c.subgoals[r].key]||(p[c.subgoals[r].key]=[]),p[c.subgoals[r].key].push(c)}s.readGameData("SpaceScouts","BadgeProgress",function(e){var i="",s=e||{},o=t.length;for(i in this.progress=s,s.badges||(s.badges={}),s)s.hasOwnProperty(i)&&"badges"!==i&&this.setProgress(i,s[i]);for(this.loading=!1;o--;)t[o]();t=null,n&&n(this.badges,this.getBadgeStatusForLAP())}.bind(this))},i=e.prototype;return i.increment=function(e){this.loading?t.push(this.increment.bind(this,e)):this.setProgress(e,(this.progress[e]||0)+1)},i.setProgress=function(t,e){var i=this.keys[t],s=!1,n=0,o=0,r=!this.loading,a=0,h=this.progress,l=null;if(i){for(n=i.length,r&&platypus.debug.orange&&platypus.debug.orange('Badger: "'+t+'" badge subgoal incremented for '+n+" badge"+(n>1?"s":"")+".");n--;){for(o=(l=i[n].subgoals).length,s=!0;o--;)l[o].key===t&&(a=l[o].progress||0,l[o].progress=Math.min(e,+l[o].count),l[o].progress===+l[o].count&&(l[o].completed=!0),r&&a!==l[o].progress&&(platypus.game.currentScene?platypus.game.currentScene.triggerOnChildren("badge-incremented",{badge:i[n],subgoal:t,originalProgress:a,progress:l[o].progress,count:+l[o].count}):platypus.debug.warn("Badger: just tried to show a badge notification, but there is no current scene."))),l[o].completed||(s=!1);!s||i[n].completed||this.gameId&&this.gameId!==i[n]["game-id"]||(i[n].completed=!0,h.badges[i[n].name]||this.badgesAwarded.push(i[n]))}this.loading||(h[t]=e,this.userData.writeGameData("SpaceScouts","BadgeProgress",h))}else platypus.debug.warn('Badger: There are no badges that have a "'+t+'" subgoal. Progress for this key will not be saved.')},i.award=function(){var t=this.badgesAwarded,e=t.length,i=this.progress,s=null;if(e){for(s=t.greenSlice(),t.length=0;e--;)this.increment("earned-badge"),i.badges[s[e].name]=!0;return this.userData.writeGameData("SpaceScouts","BadgeProgress",i),s}return null},i.getBadges=function(t){return t?this.badges[t]:this.badges},i.getBadgeStatusForLAP=function(t){var e=[],i=this.badges,s=null,n=null,o="",r=0,a=null,h=null,l=0,p=0,c=0;for(o in i)if(i.hasOwnProperty(o))for(p=(s=i[o]).length;p--;)if(c=(h=(n=s[p]).subgoals).length,l=0,r=0,a={},t){if(t===n.name){for(;c--;)a[h[c].key]=h[c].completed||!1;return{name:n.name,unlocked:n.completed||!1,steps:a}}}else{for(;c--;)a[h[c].key]=h[c].completed||!1,l+=+h[c].count,r+=h[c].progress||0;e.push({name:n.name,unlocked:n.completed||!1,progress:r/l,steps:a})}return e},e}(),platypus.DragGroup=function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Vector"),i=function(t,e){return t*t+e*e},s=function(t,e){for(var i=e.length,s=0,n=0,o=t.getPinnedEntities(),r=null;i--;)for(r=e[i].getPinnedEntities(),s=o.length;s--;)for(n=r.length;n--;)if(o[s]===r[n]&&!o[s].multiSnap)return!1;return!0},n=function(t,e){return t.distance-e.distance},o=function(e){this.trashable=!0,this.effected=Array.setUp(),this.immobile=!1,this.valid=!1,this.lastValidPosition=null,this.justUnsnapped=!1,this.validSnaps=Array.setUp(),this.entities=Array.setUp(),this.offsets=Array.setUp(),this.saOrigin=t.setUp("x",e.x,"y",e.y),this.lastPosition=null,this.state=0,this.snap=null,this.snappingEnabled=!1,this.readyToEnd=null,this.collisionComplete=!1,this.originalEntityCount=0,this.allowPops=!0},r=o.prototype;return r.addEntity=function(t){t.inDragGroup&&t.inDragGroup!==this&&platypus.debug.warn("Attempting to add an entity to a new drag group that is already in a drag group."),this.entities.indexOf(t)<0&&(this.entities.push(t),"cockpit"===t.type&&(this.trashable=!1),this.offsets.push(e.setUp(t.x-this.saOrigin.x,t.y-this.saOrigin.y)),t.inDragGroup=this)},r.checkValidity=function(){var t,e,i=this.entities,s=null,n=this.effected,o=i.length,r=0;for(i[0].parent.world.Step(0,1,1);o--;){if((!(s=i[o]).inBuildingArea||s.overlaps&&!this.lastValidPosition||s.inTrash&&(t=s.inTrash,e=s.body.GetPosition(),t[0].TestPoint(e)))&&this.trashable){r=2;break}s.overlaps&&(r=1)}if(0===r&&n.length>i.length)for(o=n.length;o--;)if(n[o].overlaps){r=1;break}this.state=r,this.lastPosition&&(0!==r||this.justUnsnapped?this.lastPosition.recycle():this.lastValidPosition=this.lastPosition,this.lastPosition=null),this.justUnsnapped=!1},r.startMovement=function(t){var i=this.entities,s=null,n=i.length;for(this.originalEntityCount=n;n--;)(s=i[n]).startMovement(s);this.state=0,this.immobile=!1,this.snappingEnabled=!0,this.lastPosition=e.setUp(t.x,t.y),this.trashable||(this.lastValidPosition=e.setUp(t.x,t.y))},r.selectAll=function(){var t=this.entities,i=null,s=t.length,n=this.originalEntityCount,o=0;if(s!==n){for(n=this.originalEntityCount;n<s;n++)(i=t[n]).startMovement(i),"pin"!==i.type&&o++;o>1&&(this.allowPops=!1),this.trashable||this.lastValidPosition||(this.lastValidPosition=e.setUp(this.lastPosition.x,this.lastPosition.y))}},r.validateMotion=function(n,o){for(var r,a=this.entities,h=a.length,l=3+h,p=null,c=this.offsets,u=null,d=t.setUp("adjusted",null,"valid",!0,"movable",!0,"entity",null,"position",e.setUp(),"forSnap",!!n.pinTo),g=null,m=d.position;l--;){for(h=a.length;h--;){if(p=c[h],m.x=n.x+p.x,m.y=n.y+p.y,d.entity=a[h],d.valid=!0,d.adjusted=null,a[h].validateMotion(d,3),!d.valid){d.movable||(this.immobile=!0);break}if(d.adjusted){if(n.pinTo){d.valid=!1;break}n.x=d.adjusted.x-p.x,n.y=d.adjusted.y-p.y;break}}if(!d.valid||!d.adjusted)break}if(r=d.valid&&!d.adjusted,d.recycle(),r&&n.pinTo){for((g=Array.setUp()).push(n.pinTo),h=0;h<o.length;h++)if((u=o[h]).pinFrom&&u!==n&&.9>i(n.x-u.x,n.y-u.y)){if(!s(u.pinTo,g))return g.recycle(),!1;g.push(u.pinTo)}return g.recycle(),!0}return r},r.continueMovement=function(t,i){for(var s=this.entities,n=s.length,o=null,r=this.offsets,a=e.setUp();n--;)o=r[n],a.x=t.x+o.x,a.y=t.y+o.y,s[n].continueMovement(a);for(n=s.length;n--;)s[n].triggerEvent("resolve-bodies");for(n=s.length;n--;)s[n].triggerEvent("resolve-joints");if(i&&i.length)for(n=s.length;n--;)s[n].triggerEvent("resolve-snaps",i);this.lastPosition=e.setUp(t.x,t.y),a.recycle()},r.endMovement=function(t){for(var i=this.entities,s=i.length,n=null,o=this.offsets,r=e.setUp(),a=this.validSnaps,h=a.length;s--;)i[s].destroyed||(n=o[s],r.x=t.x+n.x,r.y=t.y+n.y,i[s].endMovement(r,this.state,this.immobile)),i[s].inDragGroup=null;if(0===this.state){for(;h--;)a[h].panel?(a[h].pinFrom.state.set("panelled",!0),a[h].pinFrom.state.set("almost-pinned",!1),a[h].pinFrom.panelled=a[h].pinTo,a[h].pinFrom.tint=null):a[h].pinFrom.triggerEvent("snap-to-pin",a[h].pinTo),a[h].recycle();for(s=i.length;s--;)if("pin"===i[s].type){i[s].triggerEvent("update-group-id");break}a.length=0}else{for(;h--;)a[h].pinFrom.destroyed||(a[h].pinFrom.tint=null),a[h].recycle();a.length=0}r.recycle()},r.getSnap=function(e,s,n){var o=platypus.game.app.config.pins.snapDistance,r=o*o,a=0,h=null,l=null,p=null,c=n.length;if(e.destroyed)return null;for(;c--;)e!==(p=n[c])&&(a=i(p.x-s.x,p.y-s.y))<r&&(l=t.setUp("pinFrom",e,"pinTo",p,"snappable",!0),e.canSnapTo(l,0)&&(r=a,h=p),l.recycle());return h?t.setUp("distance",r,"pinTo",h,"pinFrom",e):null},r.getSnaps=function(t,s,o,r){var a=null,h=this.entities,l=h.length,p=null,c=this.offsets,u=this.saOrigin,d=null,g=null;if(this.snappingEnabled){for(g=e.setUp();l--;)"pin"===(a=h[l]).type&&(p=c[l],g.x=s.x+p.x,g.y=s.y+p.y,(d=this.getSnap(a,g,o))&&(d.x=d.pinTo.x-p.x,d.y=d.pinTo.y-p.y,t.push(d)));t.length>1&&t.sort(n),g.recycle()}return r&&i(s.x-u.x,s.y-u.y)<25?t.push(e.setUp(u.x,u.y)):t.push(e.setUp(s.x,s.y)),t},r.getPanelSnaps=function(e,i){for(var s=null,n=this.entities,o=n.length,r=0,a=null,h=this.offsets,l=t.setUp("x",0,"y",0,"panelled",null,"pin",null),p=t.setUp("panel",null,"pin",null),c=null;o--;)if("pin"!==(s=n[o]).type||s.handshake){if(s.velcro)for(p.panel=s,s.velcroed.length=0,c=s.parent.pins,r=0;r<c.length;r++)c[r].panelled===s&&(c[r].panelled=!1,c[r].state.set("was-panelled",c[r].state.get("panelled")),c[r].state.set("panelled",!1)),c[r].panelled||(p.pin=null,c[r].triggerEvent("can-you-pin-to-this-panel",p),p.pin?e.push(t.setUp("pinTo",s,"pinFrom",p.pin,"panel",!0)):c[r].state.set("was-panelled",!1))}else a=h[o],l.x=i.x+a.x,l.y=i.y+a.y,l.pin=s,s.panelled=!1,s.state.set("was-panelled",s.state.get("panelled")),s.state.set("panelled",!1),s.parent.triggerEventOnChildren("pin-on-panel",l),l.panelled&&(e.push(t.setUp("pinTo",l.panelled,"pinFrom",s,"panel",!0)),l.panelled=!1);return l.recycle(),e},recycle.add(o,!!springroll.Debug,"DragGroup",function(){this.lastValidPosition&&this.lastValidPosition.recycle(),this.readyToEnd&&this.readyToEnd.recycle(),this.effected.recycle(),this.validSnaps.recycle(),this.entities.recycle(),this.offsets.recycle(),this.saOrigin.recycle(),o.recycle(this)}),o}(),platypus.LabRetriever=function(){"use strict";var t=[],e=function(e,i){this.labItemsUnlocked=[],this.userData=e,this.loading=!0,this.onLoaded=!1,e.readGameData("space-scouts-lab","LabUnlocks",function(e){var s=e||{},n=t.length;for(this.progress=s,this.loading=!1;n--;)t[n]();t=null,i&&i(this),this.onLoaded&&this.onLoaded()}.bind(this))},i=e.prototype;return i.has=function(t){return!!this.progress[t]},i.isNew=function(t){return!(this.progress[t]&&this.progress[t].used)},i.unlock=function(e){this.loading?t.push(this.unlock.bind(this,e)):this.progress[e]||(this.labItemsUnlocked.push(e),this.progress[e]={},this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress))},i.use=function(t){"space-scouts-lab"===platypus.game.app.name?this.loading||!this.progress[t]||this.progress[t].used||(this.progress[t].used=!0,this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress)):platypus.debug.warn('LabRetriever: Only the Lab is allowed to mark "'+t+'" as a used item.')},i.award=function(){var t=this.labItemsUnlocked;return t.length?t:null},e}(),function(){"use strict";var t,e,i,s,n,o,r,a,h=window.navigator.userAgent.toLowerCase(),l=include("platypus.Data"),p=[["os 9_","","ios935"],["os 10_","","ios935"],["kfgiwi","","small"],["kfdowi","","small"],["os 11_","","small"],["iphone","dpi2","small"],["iphone","dpi3","small"],["ipad; cpu os 12_","scr4:3","small"],["ipad; cpu os 13_","scr4:3","small"],["android 4.","","small"],["android 5.","","small"],["android 6.","","small"]],c=0,u=null,d="",g=platypus.PIXIAnimation.formatSpriteSheet.bind(platypus.PIXIAnimation);for(c=0;c<p.length;c++)if(u=p[c],h.indexOf(u[0])>=0&&(!u[1]||"scr4:3"===u[1]&&window.screen.height/window.screen.width==1024/768||"dpi2"===u[1]&&2===window.devicePixelRatio||"dpi3"===u[1]&&3===window.devicePixelRatio)){d=u[2];break}d?(platypus.modifyAllAssets={ios935:4,small:2}[d],springroll.Task.prototype.filter=(a="/"+d+"/",function(t){var e=t.lastIndexOf("/"),i=t.substring(t.lastIndexOf(".")+1),s=t.substring(e+1);return"png"===i||"jpg"===i?t.substring(0,e)+a+s:t}),platypus.PIXIAnimation.formatSpriteSheet=(t=/([\w-]+)\.(\w+)$/,e=function(t,e,i){var s=platypus.modifyAllAssets,n=null,o=0;for(o=0;o<t.length;o++)n=t[o],e.push(Array.setUp(n[0]/s>>0,n[1]/s>>0,n[2]/s>>0,n[3]/s>>0,n[4]+i,n[5]/s>>0,n[6]/s>>0))},i=function(t){for(var e=t.length,i="",s="";e--;)i+=s+(t[e].src||t[e]).substring(0,128),s=",";return i},s=function(t,s){var r=s.animations,a=s.images,h=s.framerate||60,l=s.frames,p=0,c=Array.setUp(),u=a.length,d=l.length,m=t.animations,y=t.images,f=t.framerate||60,w=t.frames,v=null;for(s.id?s.id+=";"+(t.id||i(t.images)):s.id=t.id||i(t.images),p=0;p<y.length;p++)c.push(o(y[p])),a.push(c[p]);return Array.isArray(w)?e(w,l,u):(v=g(t),e(v.frames,l,u),v.recycleSpriteSheet()),function(t,e,i,s,o){var r="";for(r in t)t.hasOwnProperty(r)&&(e[r]&&(e[r].frames.recycle(),e[r].recycle(),platypus.debug.olive('PIXIAnimation "'+o+'": Overwriting duplicate animation for "'+r+'".')),e[r]=n(r,t[r],i,s))}(m,r,f/h,d,s.id),c.recycle(),s},n=function(t,e,i,s){var n=0,o=0,r=Array.setUp(),a=0;if("number"==typeof e)return r.push(e+s),l.setUp("frames",r,"next",t,"speed",i);if(Array.isArray(e)){for(o=e[0]||0,a=(e[1]||o)+1+s,n=o+=s;n<a;n++)r.push(n);return l.setUp("frames",r,"next",e[2]||t,"speed",(e[3]||1)*i)}for(n=0;n<e.frames.length;n++)r.push(e.frames[n]+s);return l.setUp("frames",r,"next",e.next||t,"speed",(e.speed||1)*i)},o=function(e){var i=!1;return"string"==typeof e&&(i=e.match(t))?i[1]:e},r=function(){var t=this.animations,e="";for(e in t)t.hasOwnProperty(e)&&t[e].frames.recycle(),t[e].recycle();this.frames.recycle(2),this.images.recycle(),this.recycle()},function(t){var e=platypus.PIXIAnimation.EmptySpriteSheet,i=t;if("string"==typeof i&&(i=platypus.game.settings.spriteSheets[t]),i){if(e=l.setUp("animations",l.setUp(),"framerate",60,"frames",Array.setUp(),"id","","images",Array.setUp(),"recycleSpriteSheet",r),Array.isArray(i))return function(t,e){for(var i=t.length,n=null;i--;)"string"==typeof(n=t[i])&&(n=platypus.game.settings.spriteSheets[n]),n&&s(n,e);return e}(i,e);if(i)return s(i,e)}return e})):platypus.modifyAllAssets=1}(),function(){"use strict";Math.sign||(Math.sign=function(t){return(t>0)-(t<0)||+t})}(),function(){"use strict";var t=include("springroll.SavedData"),e=include("springroll.UserData").prototype;e.readGameData=function(e,i,s){this.container.supported?this.container.fetch("userDataRead",function(t){s(t.data)},e+i,!0):s(t.read(e+i))},e.writeGameData=function(e,i,s,n){if(!this.container.supported)return t.write(e+i,s),void(n&&n());this.container.fetch("userDataWrite",function(){n&&n()},{name:e+i,value:s},!0)},e.removeGameData=function(e,i,s){if(!this.container.supported)return t.remove(e+i),void(s&&s());this.container.fetch("userDataRemove",function(){s&&s()},e+i,!0)},e.fixFetch=function(){var t,e,i,s=this.container;s.___fetch||(s.___fetch=s.fetch,s.fetch=(t=!1,e=function(s,n){var o=null;s(n),i.length?(o=i.shift(),this.___fetch(o.event,e.bind(this,o.callback),o.options,o.once)):t=!1},i=[],function(s,n,o,r){t?i.push({event:s,callback:n,options:o,once:r}):(t=!0,this.___fetch(s,e.bind(this,n),o,r))}))}}(),function(){"use strict";var t,e="file:"===window.location.protocol||"ionic:"===window.location.protocol||"localhost:8080"===window.location.host,i=window.navigator.userAgent.toLowerCase(),s=i.indexOf("os 9_")>=0||i.indexOf("os 10_")>=0,n=include("springroll.Application"),o=include("platypus.Badger"),r=include("springroll.pixi.PixiDisplay"),a=include("springroll.Debug",!1),h=include("platypus.LabRetriever"),l=document.getElementById("interaction"),p=function(){l.style.display="none",c=!1,u.paused=!1;try{document.body.removeChild(l)}catch(t){}},c=!e||i.indexOf("os 9_")>=0,u=new n({name:"rover-maker",canvasId:"stage",captions:"captions",configPath:"assets/config/config.json",display:r,displayOptions:{clearView:!0,preserveDrawingBuffer:!0},enableHiDPI:!0,brainpoints:{callback:function(t){u.trigger("brainpoint",t)},apiOverride:"https://proxy.services.pbskids.org/enlearn",appData:{releaseBuild:!a}},preload:(t=[{id:"buttons",src:"assets/images/buttons.png"},{id:"pin",src:"assets/images/pin.png"},{id:"edge-pins",src:"assets/images/edge-pins.png"},{id:"explosion",src:"assets/images/explosion.png"},{id:"smoke-particle",src:"assets/images/smoke-particle.png"},{id:"not-velcroed",src:"assets/images/not-velcroed.png"}],s||t.push({id:"ScreenBadge_Standard",src:"assets/images/ScreenBadge_Standard.png"}),t),resizeElement:"content",responsive:!0,uniformResize:!1,state:"menu",version:"1.0.0"}),d=function(){var t=document.getElementById("frame"),e=window.innerHeight,i=window.innerWidth,s=.75*i>>0,n=2*e>>0;e>s?(t.style.height=s+"px",t.style.top=((e-s)/2>>0)+"px",t.style.width="",t.style.left=""):i>n?(t.style.width=n+"px",t.style.left=((i-n)/2>>0)+"px",t.style.height="",t.style.top=""):(t.style.height="",t.style.top="",t.style.width="",t.style.left="")};if(u.userData.fixFetch(),u.on("init",function(){var t=new o(u.config["badge-list"],"space-scouts-home-base"!==u.name?u.name:"",u.userData,function(t,e){a&&u.analyticsEmitter.enableLogging(),u.completedLevelCount=0,u.levelOrder=["e-sunspot-snap-tutorial","e-wheel-snap-tutorial","e-block-snap-tutorial","e-bumpy-hill","e-jump","e-pot-holes","e-hill-climb","e-climb-and-coast","l-plinko","l-hill-climb-pit-stop","l-solar-two","l-first-rocket","l-horizontal-rockets","l-rocket-steps","m-wind-storm","m-wind-storm-2","m-ceiling-rockets","m-back-and-forth","eur-ice-pond","eur-tread-two","eur-ice-and-rockets","eur-slip-and-slide"],u.getLevelProgress=function(){var t={},e=0;for(e=0;e<u.levelOrder.length&&e<=u.completedLevelCount;e++)t[u.levelOrder[e]]=!0;return t},u.userData.read("Completed-Levels",function(t){u.completedLevelCount=t?t.length:0,u.analyticsEmitter.startGame(u.options.version,u.getLevelProgress(),e)}),u.googleAnalytics.event(u.name,"StartGame")});u.container.on("download-complete",function(){u.sound.play("download-complete")}),u.paused=c,platypus.labRetriever=new h(u.userData),platypus.badger=t,t.increment("tried-"+u.name),u.captions.data=u.config.captions,platypus.game.settings.entities["action-layer"].maxStepsPerTick=60/platypus.modifyAllAssets}),u.once("endGame",function(t){u.analyticsEmitter.endGame(t,u.getLevelProgress(),platypus.badger.getBadgeStatusForLAP()),u.googleAnalytics.event(u.name,"EndGame")}),u.on("resize",function(t,e){u.transition?(u.transition.x=t/2,u.transition.y=e/2,u.transition.scale.x=u.transition.scale.y=e/880):(platypus.savedWidth=t,platypus.savedHeight=e)}),platypus.savedGame=sessionStorage.getItem("load-saved-game")||null,platypus.savedGame){sessionStorage.removeItem("load-saved-game");try{platypus.savedGame=JSON.parse(platypus.savedGame)}catch(t){platypus.savedGame=null}}u.on("brainpoint",function(t){platypus.debug.log('Brain Point "'+t.type+'" received! '+t.message,t),u.analyticsEmitter.receivedBrainPoint(u.levelId||"",t),u.googleAnalytics.event(u.name,"ReceivedBrainPoint"),platypus.badger&&u.config.brainPoints[t.type]&&(platypus.badger.increment(u.config.brainPoints[t.type]),platypus.badgeVOCollection?platypus.badgeVOCollection.push("brain-point-"+t.type):u.voPlayer.playing||u.voPlayer.play("brain-point-"+t.type))}),window.app=u,window.addEventListener("resize",d,!1),window.addEventListener("orientationchange",d,!1),window.addEventListener("focus",d,!1),window.addEventListener("load",d,!1);try{!c||window.AudioContext&&"running"!==(new window.AudioContext).state||window.webkitAudioContext&&"running"!==(new window.webkitAudioContext).state||(c=!1)}catch(t){platypus.debug.warn("Unlocking audio error: "+t.message)}c&&(l.addEventListener("pointerdown",p),l.addEventListener("mousedown",p),l.addEventListener("touchstart",p),l.style.display="block")}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data");platypus.createComponentClass({id:"ActionButton",properties:{onPress:"",onRelease:"",onCancel:"",onHover:"",useOnce:!1,disabled:!1,toggle:!1,pressed:!1},publicProperties:{bottom:null,left:null,right:null,top:null},initialize:function(){var e=this.owner.state;this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.state=e,e.set("disabled",this.disabled),e.set("released",!this.pressed),e.set("pressed",this.pressed),e.set("highlighted",!1),this.owner.buttonMode=!this.disabled,this.cancelled=!1,this.readyToToggle=!1,this.coolDown=0,this.dragging=[]},events:{"handle-logic":function(t){var e=this.bottom,i=this.left,s=this.right,n=this.top;this.lastBottom===e&&this.lastLeft===i&&this.lastRight===s&&this.lastTop===n||(this.updatePosition(this.aabb),this.lastBottom=e,this.lastLeft=i,this.lastRight=s,this.lastTop=n),this.coolDown>0&&(this.coolDown-=t.delta,this.coolDown<0&&(this.coolDown=0))},"camera-update":function(t){this.aabb.set(t.viewport),this.updatePosition(this.aabb)},pointerdown:function(t){this.state.get("disabled")||(this.toggle?this.coolDown||(this.readyToToggle=!0):(this.onPress&&this.owner.trigger(this.onPress),this.updateStateAndTrigger("pressed"),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&this.removeEventListener("pointerdown")))},pressup:function(t){var e=this.state;e.get("disabled")||(this.cancelled?(this.onCancel&&this.owner.trigger(this.onCancel),this.updateStateAndTrigger("cancelled")):this.toggle?this.readyToToggle&&(this.coolDown=500,e.get("pressed")?this.updateStateAndTrigger("released"):this.updateStateAndTrigger("pressed")):(this.onRelease&&this.owner.trigger(this.onRelease),this.updateStateAndTrigger("released")),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&(this.removeEventListener("pressup"),this.state.set("disabled",!0),this.owner.buttonMode=!1)),this.cancelled=!1,this.readyToToggle=!1},disable:function(){this.state.set("disabled",!0),this.owner.buttonMode=!1},enable:function(){this.state.set("disabled",!1),this.owner.buttonMode=!0},"toggle-disabled":function(){var t=this.state.get("disabled");this.owner.buttonMode=t,this.state.set("disabled",!t)},highlight:function(){this.state.set("highlighted",!0)},unhighlight:function(){this.state.set("highlighted",!1)},"toggle-highlight":function(){var t=this.state;t.set("highlighted",!t.get("highlighted"))},"dragging-taking-place":function(){this.owner.triggerEvent("disable")},"no-dragging-taking-place":function(){this.owner.triggerEvent("enable")}},methods:{updatePosition:function(t){var e=this.bottom,i=this.left,s=this.owner,n=this.right,o=this.top;"number"==typeof i?s.x=t.left+i:"number"==typeof n&&(s.x=t.right-n),"number"==typeof o?s.y=t.top+o:"number"==typeof e&&(s.y=t.bottom-e)},updateStateAndTrigger:function(t){var i=null,s=this.owner,n=this.state,o=n.get("pressed"),r=n.get("released"),a=!1;r&&"pressed"===t?(n.set("pressed",!0),n.set("released",!1),a=!0):!o||"released"!==t&&"cancelled"!==t||(n.set("pressed",!1),n.set("released",!0),a=!0),a&&(i=e.setUp("released",o,"pressed",r,"triggered",r,"entity",s),s.triggerEvent(t,i),i.recycle())},destroy:function(){this.aabb.recycle(),this.aabb=null,this.owner.buttonMode=!1,this.state=null}}})}(),function(){"use strict";var t=include("platypus.Data"),e=function(t,e){return t.time-e.time},i=function(i,s){var n=0;for(n=0;n<i.length;n++)s.push(t.setUp("event",i[n].event,"time",i[n].time||0,"message",i[n].message));return n&&s.sort(e),s},s=function(i,s,n){var o=0,r=n.getElapsed();for(o=0;o<i.length;o++)s.push(t.setUp("event",i[o].event,"time",(i[o].time||0)+r,"message",i[o].message||null));o&&s.sort(e)},n=function(t,e,i){var n=0,o=Array.setUp();for(n=0;n<t.length;n++)t[n].sound?(t[n].events&&o.push(s.bind(this,t[n].events,e,i)),o.push(t[n].sound)):o.push(t[n]);return o},o=function(t,e){this.playingAudio=!1,this.player.unloadSound(),this.owner.destroyed||(this.checkTimeEvents(!0),this.owner.triggerEvent("sequence-complete")),e.recycle()},r=function(t,e){var s=null,r=Array.setUp(),a=this.player;"string"==typeof t?s=Array.setUp(t):Array.isArray(t)?s=n(t,r,a):(t.events&&i(t.events,r),s=Array.isArray(t.sound)?n(t.sound,r,a):Array.setUp(t.sound)),e&&e.events&&i(e.events,r),a.play(s,o.bind(this,!0,s),o.bind(this,!1,s)),this.eventList.recycle(),this.eventList=r,this.playingAudio=!0};platypus.createComponentClass({id:"AudioVO",properties:{audioMap:null},initialize:function(){var t="";if(this.eventList=Array.setUp(),this.playingAudio=!1,this.player=platypus.game.app.voPlayer,this.player.trackSound=platypus.supports.iOS,this.audioMap)for(t in this.audioMap)this.audioMap.hasOwnProperty(t)&&this.addEventListener(t,r.bind(this,this.audioMap[t]));this.paused=!1},events:{"handle-render":function(){this.paused||this.checkTimeEvents(!1)},"stop-audio":function(){this.player.stop(),this.player.voList=[]}},methods:{checkTimeEvents:function(t){var e=null,i=this.eventList,s=0,n=this.owner;if(i&&i.length)for(s=this.player.getElapsed();i.length&&(t||i[0].time<=s);)e=i.greenSplice(0),n.trigger(e.event,e.message),e.recycle()},destroy:function(){this.playingAudio&&(this.player.stop(),this.player.voList=[]),this.eventList.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeAward",properties:{},publicProperties:{},initialize:function(){this.badgeList=null,this.lastState="",this.hiding=!0},events:{"earned-badge":function(t){this.badgeList=t},"show-next-badge":function(){var t=platypus.game.app,e=null,i=this.owner.state;this.hiding?(this.owner.triggerEvent("show-earned-badge-dialog"),this.hiding=!1,e=this.badgeList.greenSplice(0),this.badgeList.length||this.owner.triggerEvent("last-badge-showing"),t.analyticsEmitter.unlockedBadge(t.levelId||"",e.name),t.googleAnalytics.event(t.name,"BadgeUnlocked",e.name,1),this.lastState&&i.set(this.lastState,!1),this.lastState=e["game-id"]+"-"+e.id,i.set(this.lastState,!0),this.owner.triggerEvent("set-text",e.name),this.owner.triggerEvent(this.lastState)):(this.badgeList.length?this.owner.triggerEvent("hide-earned-badge-dialog-and-next"):this.owner.triggerEvent("hide-earned-badge-dialog"),this.hiding=!0)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeBannerBuilder",properties:{bannerPositions:null,toBuild:"all",zoomOutWidth:1816,zoomOutHeight:1360,zoomInWidth:908,zoomInHeight:680},publicProperties:{},initialize:function(){var t=platypus.game.app,e=t.name,i=platypus.badger.getBadges(),s=0,n=null;if(this.showEverything="space-scouts-home-base"===e,this.zoomBanners=[],this.banners=[],this.badges={},this.badgeHighlight=null,this.collectedBadges=0,this.zooming=!1,this.cameraX=0,this.cameraY=0,this.tweenWidth=1816,this.tweenHeight=1360,this.targetBanner=null,this.zoomed="out",this.showEverything)for(n in i)i.hasOwnProperty(n)&&(this.buildBanner(n,i[n],s),s++);else this.buildBanner(e,i[e],s);this.badgeHighlight=this.owner.addEntity({type:"badge-highlight",properties:{x:0,y:0,z:100.5,opacity:.001}}),t.music="jam",t.musicInstance.volume=.5,this.badgeTime=Date.now(),t.googleAnalytics.event(t.name,"EnterBadgeScreen","BadgesCollected",this.collectedBadges)},events:{"scene-live":function(t){var e=0;if(this.showEverything){if(t&&t.banner)for(e=this.banners.length;e--;)if(this.banners[e].game===t.banner){this.owner.triggerEvent("zoom-in",this.banners[e]);break}}else this.owner.triggerEvent("zoom-in",this.banners[0])},tick:function(){this.zooming&&this.resizeCamera()},"camera-update":function(t){this.tweenWidth=t.viewport.width,this.tweenHeight=t.viewport.height,this.cameraX=t.viewport.x,this.cameraY=t.viewport.y},"zoom-out":function(){this.zooming||("out"!==this.zoomed&&this.showEverything?(this.zooming=!0,this.owner.triggerEvent("rl-hide-info-panel"),this.targetBanner.zoomBanner.triggerEvent("show-sprite"),this.targetBanner=null,this.badgeHighlight.opacity=.001,t.get(this).to({cameraX:0,cameraY:0,tweenWidth:this.zoomOutWidth,tweenHeight:this.zoomOutHeight},1e3,e.sineInOut).call(function(){this.zoomed="out",this.zooming=!1,this.resizeCamera()}.bind(this))):this.owner.triggerEvent("new-scene"))},"zoom-in":function(i){this.zooming||"out"!==this.zoomed||(this.zooming=!0,this.targetBanner=i,this.showEverything?i.state.get("app")?t.get(this).to({cameraX:this.targetBanner.x+225,cameraY:this.targetBanner.y,tweenWidth:this.zoomInWidth,tweenHeight:this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):t.get(this).to({cameraX:this.targetBanner.x+180,cameraY:this.targetBanner.y,tweenWidth:.8*this.zoomInWidth,tweenHeight:.8*this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):(this.cameraX=this.targetBanner.x+225,this.cameraY=this.targetBanner.y,this.tweenWidth=this.zoomInWidth,this.tweenHeight=this.zoomInHeight,this.zoomInComplete(i,!0)))}},methods:{zoomInComplete:function(t,e){this.zoomed="in",this.zooming=!1,this.resizeCamera(),this.targetBanner.zoomBanner.triggerEvent("hide-sprite"),this.badges[t.game][0].triggerEvent("send-highlight-info"),this.owner.triggerEvent("rl-show-info-panel",e)},resizeCamera:function(){this.owner.triggerEvent("resize-camera",{width:this.tweenWidth,height:this.tweenHeight}),this.owner.triggerEvent("relocate",{x:this.cameraX,y:this.cameraY})},buildBanner:function(t,e,i){var s=null,n=this.bannerPositions&&this.bannerPositions[t],o=null,r=450*(i%3),a=650*Math.floor(i/3);this.showEverything?n?(r=n.x,a=n.y):(r+=-450,a+=-325):r-=225,(s=this.owner.addEntity({type:"badge-banner",properties:{x:r,y:a,z:100,game:t}})).state.set(t,!0),o=this.owner.addEntity({type:"zoom-banner",properties:{x:r,y:a,z:102}}),s.zoomBanner=o,o.banner=s,this.banners.push(s),this.zoomBanners.push(o),this.buildBadges(t,e,r,a,n)},buildBadges:function(t,e,i,s,n){var o=0,r=0,a=null,h=null,l=0,p=0,c=0,u="",d="",g=n&&n.badgeOffsetX?n.badgeOffsetX:-91,m=n&&n.badgeOffsetY?n.badgeOffsetY:-70;for(o=0;o<e.length;o++)h=e[o],n.specials&&n.specials[o]?(r-=1,p=i+n.specials[o].x,c=s+n.specials[o].y):(l=Math.floor((o+r)/3),p=i+g+91*((o+r)%3),c=s+m+91*l),u=h.name,d=h.description,a=this.owner.addEntity({type:"badge",properties:{x:p,y:c,z:101,animation:t+"-"+h.id,highlight:h.highlight||"circle",name:u||t+"-"+h.id,description:d||"Undescribed",level:h.level,collected:h.completed,game:t,directive:h.directive,progress:this.getProgress(h)}}),this.addGroupInfo(h,a,"group1"),this.addGroupInfo(h,a,"group2"),this.addGroupInfo(h,a,"group3"),this.addGroupInfo(h,a,"group4"),a.collected?(a.state.set(a.animation,!0),this.collectedBadges+=1):a.opacity=.2,h.highlight?(a.state.set(h.highlight,!0),a.collected?a.scaleX=a.scaleY=.203452:a.scaleX=a.scaleY=.203452/.6):a.scaleX=a.scaleY=.6344*.38,this.badges[t]||(this.badges[t]=[]),this.badges[t].push(a)},addGroupInfo:function(t,e,i){var s=0,n=0,o=null,r=0,a=0;if(t[i]){if(e[i]=t[i],e[i+"-directive"]=t[i+"-directive"],!t.subgoals)return e[i+"-complete"]=!1,void(e[i+"-progress"]=0);for(s=(o=t[i+"-subgoals"].split(",")).length;s--;)for(n=t.subgoals.length;n--;)if(t.subgoals[n].key===o[s]){a+=Math.min(t.subgoals[n].progress||0,+(t.subgoals[n].count||0)),r+=+(t.subgoals[n].count||0);break}a!==r?(e[i+"-complete"]=!1,e[i+"-progress"]=a/r):e[i+"-complete"]=!0}},getProgress:function(t){var e=0,i=0,s=0;if(!t.subgoals)return 0;for(e=t.subgoals.length;e--;)s+=Math.min(t.subgoals[e].progress||0,+(t.subgoals[e].count||0)),i+=+(t.subgoals[e].count||0);return s/i},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitBadgeScreen","BadgeScreenTime",Date.now()-this.badgeTime>>0)}},publicMethods:{},getAssetList:function(){for(var t=null,e=["badge-banner","badge","badge-highlight","zoom-banner"],s=e.length,n=Array.setUp();s--;)t=i.getAssetList({type:e[s]}),n.union(t),t.recycle();return n}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeHighlightLogic",properties:{},publicProperties:{},initialize:function(){this.prevAnimation=null},events:{"highlight-badge":function(t){this.owner.opacity=1,this.owner.x=t.x,this.owner.y=t.y,this.owner.triggerEvent("set-animation",t.highlight)},"set-animation":function(t){""!==this.prevAnimation&&this.owner.state.set(this.prevAnimation,!1),this.owner.state.set(t,!0),this.prevAnimation=t}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("platypus.Data"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeInfoPanelLogic",properties:{},publicProperties:{},initialize:function(){this.highlightedBadge=null,this.prevAnimation="",this.badgeInfo=null,this.rows=Array.setUp()},events:{"scene-loaded":function(){var t=platypus.game.app,e=t.name,i=null,s=t.config["badge-list"],n=null,o=null;if(this.highlightedBadge=this.owner.parent.addEntity({type:"highlighted-badge",properties:{x:this.owner.x,y:this.owner.y+-270,z:101}}),this.rows.push(this.createGoRow(0),this.createGoRow(1),this.createGoRow(2),this.createGoRow(3)),"space-scouts-home-base"===e){for(i in s)if(s.hasOwnProperty(i)){o={name:(n=s[i].badges[0]).name,description:n.description,level:n.level,animation:i+"-"+n.id,game:i};break}}else o={name:(n=s[e].badges[0]).name,description:n.description,level:n.level,animation:e+"-"+n.id,game:e};this.owner.triggerEvent("highlight-badge",o,!0),this.owner.triggerEvent("hide-sprite"),this.highlightedBadge.triggerEvent("hide-sprite"),this.rows[0].checkmark.triggerEvent("hide-sprite"),this.rows[1].checkmark.triggerEvent("hide-sprite"),this.rows[2].checkmark.triggerEvent("hide-sprite"),this.rows[3].checkmark.triggerEvent("hide-sprite")},"highlight-badge":function(t,e){var i=this.highlightedBadge;this.badgeInfo=t,i.scaleX=i.scaleY=1,t.collected?(this.owner.triggerEvent("set-badge-animation",t.animation),"circle"!==t.highlight&&(i.scaleX=i.scaleY=2/3),this.owner.state.set("earned",!0),e||(this.owner.triggerEvent(t.animation+"-earned"),platypus.game.app.voPlayer.play(t.animation))):(this.owner.triggerEvent("set-badge-animation",t.highlight||"empty"),this.owner.state.set("earned",!1),e||(this.owner.triggerEvent(t.animation),platypus.game.app.voPlayer.play([t.animation,t.game+"-to-earn-badge",t.animation+"-requirements"]))),this.owner.triggerEvent("set-title-text",t.name),this.loadRows(t)},"set-badge-animation":function(t){""!==this.prevAnimation&&this.highlightedBadge.state.set(this.prevAnimation,!1),this.highlightedBadge.state.set(t,!0),this.prevAnimation=t},"hide-info-panel":function(){this.tweenHide(this.owner),this.tweenHide(this.highlightedBadge),this.tweenHide(this.rows[0].checkmark),this.tweenHide(this.rows[1].checkmark),this.tweenHide(this.rows[2].checkmark),this.tweenHide(this.rows[3].checkmark)},"show-info-panel":function(e){var i=e?0:300;this.owner.triggerEvent("show-sprite"),this.highlightedBadge.triggerEvent("show-sprite"),this.rows[0].checkmark.triggerEvent("show-sprite"),this.rows[1].checkmark.triggerEvent("show-sprite"),this.rows[2].checkmark.triggerEvent("show-sprite"),this.rows[3].checkmark.triggerEvent("show-sprite"),this.owner.opacity=.001,this.highlightedBadge.opacity=.001,this.rows[0].checkmark.opacity=.001,this.rows[1].checkmark.opacity=.001,this.rows[2].checkmark.opacity=.001,this.rows[3].checkmark.opacity=.001,t.get(this.owner).to({opacity:1},i),t.get(this.highlightedBadge).to({opacity:1},i),t.get(this.rows[0].checkmark).to({opacity:1},i),t.get(this.rows[1].checkmark).to({opacity:1},i),t.get(this.rows[2].checkmark).to({opacity:1},i),t.get(this.rows[3].checkmark).to({opacity:1},i)},"get-badge":function(t){var e=null,i=this.badgeInfo.game,s=platypus.game.app.config.games;t.directive?(i=(e=t.directive.split(":"))&&e[0]||this.badgeInfo.game,platypus.debug.olive("This one has a directive! "+t.directive)):platypus.debug.olive("Wants to achieve badge. Opening Level Select for all cases at this point."),"space-scouts-home-base"===platypus.game.app.name?"app"===i?this.owner.triggerEvent("look-at-all-badges"):"true"===sessionStorage.getItem("space-scouts-home-base-loaded-by-app")?platypus.game.app.container.send("load-game",{game:i,getBadge:e}):s[i]?(this.loadSavedGame&&sessionStorage.setItem("get-badge",JSON.stringify(e)),window.top.location=s[i]):platypus.debug.warn('"'+i+'" does not seem to be a valid game id.'):platypus.game.loadScene("level-select")}},methods:{createGoRow:function(t){var i=this.owner,s=e.setUp("checkmark",i.parent.addEntity({type:"go-to-badge-button",properties:{x:i.x+-300,y:i.y+100+100*t,z:101}}),"directive","","visible",!1);return s.checkmark.on("released",i.triggerEvent.bind(i,"get-badge",s)),s},loadRows:function(t){for(var e=["group1","group2","group3","group4"],i=e.length,s=0,n=null,o=null,r=null;i--;){for(r=(o=(n=this.rows[i]).checkmark).state,s=1;s<=16;s++)r.set("filled-"+s,!1);t[e[i]]?(o.x=this.owner.x+-300,o.triggerEvent("set-text",t[e[i]]),n.visible=!0,n.directive=t[e[i]+"-directive"],t[e[i]+"-complete"]?o.triggerEvent("disable"):(r.set("filled-"+(Math.ceil(16*t[e[i]+"-progress"])||1),!0),o.triggerEvent("enable"))):(o.x=-6e3,n.visible=!1)}t.group1?(o.components[3].sprite.y=0,o.components[3].sprite.anchor.y=.5):((o=(n=this.rows[0]).checkmark).x=this.owner.x+-300,o.triggerEvent("set-text",t.description),n.visible=!0,n.directive=t.directive,t.collected?o.triggerEvent("disable"):(r.set("filled-"+(Math.ceil(16*t.progress)||1),!0),o.triggerEvent("enable")),o.components[3].sprite.y=-24,o.components[3].sprite.anchor.y=0)},tweenHide:function(e){t.get(e).to({opacity:0},300).call(function(){e.triggerEvent("hide-sprite")})}},publicMethods:{},getAssetList:function(){for(var t=null,e=["highlighted-badge","go-to-badge-button"],s=e.length,n=Array.setUp();s--;)t=i.getAssetList({type:e[s]}),n.union(t),t.recycle();return n}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeLogic",properties:{},publicProperties:{animation:"",highlight:"circle",name:"default name",description:"default description",level:"",collected:!1,game:""},initialize:function(){},events:{"send-highlight-info":function(){this.owner.triggerEvent("rl-highlight-badge",this.owner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Ease"),i=include("PIXI.Graphics"),s=include("createjs.Tween"),n=function(t,e,s){var n=new i;return t.mask=n,n.isMask=!0,n.z=1,e.addChild(n),n.clear(),n.beginFill(0,1),n.r(s.left,s.top,s.width,s.height),n.endFill(),n};platypus.createComponentClass({id:"BadgeNotifier",properties:{},publicProperties:{showLength:5e3},initialize:function(){this.hideSoon=0,this.hiding=!0,this.lastState=null,this.list=Array.setUp()},events:{load:function(){this.progressMask=n(this.owner.components[3].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.activeMask=n(this.owner.components[5].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.progressMask.y=170,this.activeMask.y=170},adopted:function(){this.handler=function(t){for(var e=this.list,i=e.length;i--;)if(t.badge===e[i].badge)return;e.push(t)}.bind(this),this.owner.parent.on("badge-incremented",this.handler)},"handle-logic":function(t){var e=null,i=null,s=0,n=this.owner.state;if(this.hiding){if(this.list.length){if(i=(e=this.list.pop()).badge,this.lastState&&n.set(this.lastState,!1),this.lastState=i["game-id"]+"-"+i.id,n.set(this.lastState,!0),s="app-1"===this.lastState||"app-2"===this.lastState||"app-3"===this.lastState||"app-4"===this.lastState,this.createProgress(i,e,!s),s)return;this.owner.triggerEvent("show-progress"),this.owner.triggerEvent("set-text",i.name),this.hiding=!1,this.hideSoon=this.showLength}}else this.hideSoon>0&&(this.hideSoon-=t.delta,this.hideSoon<=0&&this.owner.triggerEvent("hide-progress"))},hiding:function(){this.hiding=!0}},methods:{createProgress:function(t,i,n){for(var o=platypus.game.app,r=t.subgoals,a=r.length,h=0,l=0,p=0;a--;)h+=+r[a].count,l+=r[a].progress||0;o.analyticsEmitter.progressBadge(o.levelId||"",t.name,l/h),o.googleAnalytics.event(o.name,"BadgeProgress",t.name,l-i.originalProgress),n&&(p=(l-i.progress+i.originalProgress)/h*400,this.activeMask.x=p,this.progressMask.x=p,s.get(this.activeMask).wait(500).to({x:l/h*400},1200,e.sineInOut))},destroy:function(){this.owner.parent.off("badge-incremented",this.handler),this.list.recycle(),this.list=null}},publicMethods:{}})}(),function(){"use strict";var t=[];platypus.createComponentClass({id:"BatteryLogic",properties:{},publicProperties:{power:1,order:0},initialize:function(){var e=0,i=!1;for(this.simulating=!1,this.prevPower=0,this.power=1,this.owner.state.set("power-8",!0),this.owner.state.set("power-7",!1),this.owner.state.set("power-6",!1),this.owner.state.set("power-5",!1),this.owner.state.set("power-4",!1),this.owner.state.set("power-3",!1),this.owner.state.set("power-2",!1),this.owner.state.set("power-1",!1),this.owner.state.set("power-0",!1),this.owner.state.set("dead",!1),e=0;e<t.length;e++)if(e<t[e]){this.order=e,t.splice(e,0,e),i=!0;break}i||(this.order=t.length,t.push(this.order))},events:{"update-group-id":function(){this.owner.triggerEvent("rl-battery-moved",this.owner)},"handle-ai":function(){this.simulating&&(0!==this.prevPower&&this.power<=0?(this.owner.state.set("dead",!0),platypus.game.app.analyticsEmitter.batteryDrained(platypus.game.app.levelId||"",platypus.game.app.getRoverLocation())):this.prevPower<=0&&this.power>0&&this.owner.state.set("dead",!1),this.prevPower=this.power,this.owner.state.set("power-8",!1),this.owner.state.set("power-7",!1),this.owner.state.set("power-6",!1),this.owner.state.set("power-5",!1),this.owner.state.set("power-4",!1),this.owner.state.set("power-3",!1),this.owner.state.set("power-2",!1),this.owner.state.set("power-1",!1),this.owner.state.set("power-0",!1),this.power<=0?this.owner.state.set("power-0",!0):this.power<=.125?this.owner.state.set("power-1",!0):this.power<=.25?this.owner.state.set("power-2",!0):this.power<=.375?this.owner.state.set("power-3",!0):this.power<=.5?this.owner.state.set("power-4",!0):this.power<=.625?this.owner.state.set("power-5",!0):this.power<=.75?this.owner.state.set("power-6",!0):this.power<=.875?this.owner.state.set("power-7",!0):this.power<=1&&this.owner.state.set("power-8",!0))},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.owner.state.set("power-8",!0),this.owner.state.set("power-7",!1),this.owner.state.set("power-6",!1),this.owner.state.set("power-5",!1),this.owner.state.set("power-4",!1),this.owner.state.set("power-3",!1),this.owner.state.set("power-2",!1),this.owner.state.set("power-1",!1),this.owner.state.set("power-0",!1),this.simulating=!1,this.power=1,this.prevPower=0}},methods:{destroy:function(){var e=0;for(e=0;e<t.length;e++)this.order===t[e]&&t.splice(e,1)}},publicMethods:{drain:function(t){return!this.owner.state.get("dead")&&(this.power-=t,this.power=Math.max(0,this.power),!0)},charge:function(t){return this.power<1&&(this.power+=t,this.power=Math.min(1,this.power),!0)}}})}(),function(){"use strict";platypus.createComponentClass({id:"BGMusic",properties:{music:"",volume:1,planets:!1},publicProperties:{},initialize:function(){this.planets||(platypus.game.app.music=this.music,platypus.game.app.musicInstance.volume=this.volume)},events:{"world-loaded":function(){var t=null;this.planets&&(t=this.planets[this.owner.planet||"earth"],platypus.game.app.music=t.music,platypus.game.app.musicInstance.volume=t.volume)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t={static:0,kinematic:1,dynamic:2},e=include("Box2D.b2Vec2"),i=include("Box2D.b2BodyDef"),s=include("Box2D.b2Filter"),n=include("Box2D.b2FixtureDef"),o=include("Box2D.b2PolygonShape"),r=include("Box2D.b2CircleShape"),a=include("platypus.Data"),h=include("platypus.Async"),l=include("Box2D.helpers.clearUserData"),p=include("Box2D.destroy"),c=include("Box2D.getPointer"),u=include("Box2D.helpers.setUserData"),d=include("decomp.quickDecomp"),g=new n,m={distance:Box2D.b2DistanceJoint,revolute:Box2D.b2RevoluteJoint,prismatic:Box2D.b2PrismaticJoint,pulley:Box2D.b2PulleyJoint,gear:Box2D.b2GearJoint,mouse:Box2D.b2MouseJoint,wheel:Box2D.b2WheelJoint,weld:Box2D.b2WeldJoint,rope:Box2D.b2RopeJoint,friction:Box2D.b2FrictionJoint,motor:Box2D.b2MotorJoint},y={distance:new Box2D.b2DistanceJointDef,revolute:new Box2D.b2RevoluteJointDef,prismatic:new Box2D.b2PrismaticJointDef,pulley:new Box2D.b2PulleyJointDef,gear:new Box2D.b2GearJointDef,mouse:new Box2D.b2MouseJointDef,wheel:new Box2D.b2WheelJointDef,weld:new Box2D.b2WeldJointDef,rope:new Box2D.b2RopeJointDef,friction:new Box2D.b2FrictionJointDef,motor:new Box2D.b2MotorJointDef},f=function(t){return Math.round(16384*t)/16384},w=function(t){for(var i=Array.setUp(),s=t.length,n=null;s--;)(n=new e).Set(t[s][0],t[s][1]),i[s]=n;return i},v=function(t,e,i,s,n){for(var o=function(t,e){for(var i=Array.setUp(),s=t.length;s--;)i[s]=Array.setUp(t[s].x/e,t[s].y/e);return i}(e,s),r=null,a=o.length<=4?[o]:d(o),h=null,l=null,c=a.length,g=0;c--;){if(a[c].length>8){for(r=[],g=a[c].length-6;g<a[c].length;g++)r.push(a[c][g]);a[c].length-=5,a[c].push(r[5]),c+=1,a.splice(c,0,r)}for(l=w(a[c]),t.set_shape(x(l)),h=i.CreateFixture(t),u(h,n),g=l.length;g--;)p(l[g]);l.recycle()}o.recycle(2)},b=function(t){return"string"==typeof t?function(e){this.owner.triggerEvent(t,e)}:t.length?function(e){this.owner.trigger(t,e)}:null},x=function(t){var e,i=new o,s=Box2D._malloc(8*t.length),n=0,r=0;for(r=0;r<t.length;r++)Box2D.HEAPF32[s+n>>2]=t[r].get_x(),Box2D.HEAPF32[s+(n+4)>>2]=t[r].get_y(),n+=8;return e=Box2D.wrapPointer(s,Box2D.b2Vec2),i.Set(e,t.length),i},E=function(t,e){var i=this.owner.parent.addEntity(t,e);this.connectedEntities.push(i)};platypus.createComponentClass({id:"BoxCollision",properties:{bodyDefinition:null,connectingEntities:null,joints:null,resolution:null},publicProperties:{shape:null},initialize:function(e,s){var n=null,o=null,r=this.resolution,a="",l="",p="",c=new i,d=this.bodyDefinition,g=null,m=d.fixtureDefinitions,y=0,f=null,w=null,v=null,x=0,C=[];if(this.owner.body=null,this.world=this.owner.parent.world,this.drawScale=this.owner.parent.drawScale,this.owner.orientation=this.owner.orientation||0,this.connectedEntities=[],r)for(a in r)if(r.hasOwnProperty(a))for(l in"default"===(o=a)&&(o=this.owner.type),r[a])if(r[a].hasOwnProperty(l))if("beginContact"===l)for(p in n=r[a][l])n.hasOwnProperty(p)&&this.addEventListener("begin-contact-"+o+"-and-"+p,b(n[p]));else if("endContact"===l)for(p in n=r[a][l])n.hasOwnProperty(p)&&this.addEventListener("end-contact-"+o+"-and-"+p,b(n[p]));else if("preSolve"===l)for(p in n=r[a][l])n.hasOwnProperty(p)&&this.addEventListener("pre-solve-"+o+"-and-"+p,b(n[p]));else if("postSolve"===l)for(p in n=r[a][l])n.hasOwnProperty(p)&&this.addEventListener("post-solve-"+o+"-and-"+p,b(n[p]));if(d){if(void 0!==d.type&&c.set_type(t[d.type]),void 0!==d.active&&c.set_active(d.active),void 0!==d.allowSleep&&c.set_allowSleep(d.allowSleep),void 0!==d.angle?c.set_angle(d.angle):this.owner.orientation&&c.set_angle(this.owner.orientation),void 0!==d.angularDamping&&c.set_angularDamping(d.angularDamping),void 0!==d.angularVelocity&&c.set_angularVelocity(d.angularVelocity),void 0!==d.awake&&c.set_awake(d.awake),void 0!==d.bullet&&c.set_bullet(d.bullet),void 0!==d.fixedRotation&&c.set_fixedRotation(d.fixedRotation),void 0!==d.inertiaScale&&c.set_inertiaScale(d.inertiaScale),void 0!==d.linearDamping&&c.set_linearDamping(d.linearDamping),void 0!==d.gravityScale&&c.set_gravityScale(d.gravityScale),g=c.get_position(),d.position?(g.set_x((this.owner.x||d.position.x||0)/this.drawScale),g.set_y((this.owner.y||d.position.y||0)/this.drawScale)):(g.set_x((this.owner.x||0)/this.drawScale),g.set_y((this.owner.y||0)/this.drawScale)),this.owner.body=this.world.CreateBody(c),this.matchEntityToBody(),u(this.owner.body,{entity:this.owner}),!this.owner.body)return platypus.debug.warn('Unable to create Box2D Body for "'+this.owner.type+'".'),!1;for(y=0;y<m.length;y++)this.createFixture(m[y],d.defaultFixtureData||{})}else platypus.debug.warn(this.owner.type+": This entity has no defined body.");if(this.connectingEntities)for(x=0;x<this.connectingEntities.length;x++){for(v in w={},(f=this.connectingEntities[x]).properties)f.properties.hasOwnProperty(v)&&(w[v]=f.properties[v]);w.x=this.owner.x,w.y=this.owner.y,w.z=this.owner.z,f.offset&&(w.x+=f.offset.x||0,w.y+=f.offset.y||0,w.z+=f.offset.z||0),w.joinId=f.joinId||"entity-"+x,C.push(E.bind(this,{type:f.type,properties:w}))}return h.setUp(C,function(t){var e=null,i=null;if(this.joints)for(i=0;i<this.joints.length;i++)e=this.joints[i],this.createJoint(e.type,e);this.owner.triggerEvent("box2d-body-initialized",this.owner.body),t()}.bind(this,s)),!0},events:{"before-box2d-update":function(){this.matchBodyToEntity()},"after-box2d-update":function(){this.matchEntityToBody()},"add-collision-listener":function(t){var e=t,i=e.thisType||this.owner.type;"beginContact"===e.when&&this.addEventListener("begin-contact-"+i+"-and-"+e.otherType,b(e.message)),"endContact"===e.when&&this.addEventListener("end-contact-"+i+"-and-"+e.otherType,b(e.message)),"preSolve"===e.when&&this.addEventListener("pre-solve-"+i+"-and-"+e.otherType,b(e.message)),"postSolve"===e.when&&this.addEventListener("post-solve-"+i+"-and-"+e.otherType,b(e.message))}},methods:{destroy:function(){var t=0,e=this.owner,i=this.owner.body,s=i.GetFixtureList();for(this.owner.destroyThePins&&this.owner.destroyThePins(),e.parent.triggerEvent("body-removed",i),l(i);0!==c(s);)l(s),s=s.GetNext();for(e.body=null,this.world=null,t=0;t<this.connectedEntities.length;t++)this.owner.parent.removeEntity(this.connectedEntities[t]);this.connectedEntities.length=0}},publicMethods:{createFixture:function(t,i){var n=g,h=null,l="",p=this.owner,c=null,d=null,m=new s,y=t.shape||this.shape||p;if(y=a.setUp("radius",y.radius,"points",y.points,"halfHeight",y.halfHeight||(y.height||0)/2,"halfWidth",y.halfWidth||(y.width||0)/2,"x",(y===p?0:y.x)||0,"y",(y===p?0:y.y)||0),void 0!==t.density?n.set_density(t.density):void 0!==i.density?n.set_density(i.density):n.set_density(1),void 0!==t.friction?n.set_friction(t.friction):void 0!==i.friction?n.set_friction(i.friction):n.set_friction(.5),void 0!==t.restitution?n.set_restitution(t.restitution):void 0!==i.restitution?n.set_restitution(i.restitution):n.set_restitution(.2),t.filter&&void 0!==t.filter.categoryBits?m.set_categoryBits(t.filter.categoryBits):i.filter&&void 0!==i.filter.categoryBits?m.set_categoryBits(i.filter.categoryBits):m.set_categoryBits(1),t.filter&&void 0!==t.filter.groupIndex?m.set_groupIndex(t.filter.groupIndex):i.filter&&void 0!==i.filter.groupIndex?m.set_groupIndex(i.filter.groupIndex):m.set_groupIndex(0),t.filter&&void 0!==t.filter.maskBits?m.set_maskBits(t.filter.maskBits):i.filter&&void 0!==i.filter.maskBits?m.set_maskBits(i.filter.maskBits):m.set_maskBits(65535),n.set_filter(m),void 0!==t.isSensor?n.set_isSensor(t.isSensor):void 0!==i.isSensor?n.set_isSensor(i.isSensor):n.set_isSensor(!1),d={collisionType:this.owner.type},void 0!==t.userData)for(l in t.userData)t.userData.hasOwnProperty(l)&&(d[l]=t.userData[l]);else if(void 0!==i.userData)for(l in i.userData)i.userData.hasOwnProperty(l)&&(d[l]=i.userData[l]);y.radius?((c=new r).set_m_radius(y.radius/this.drawScale),(y.x||y.y)&&c.get_m_p().Set((y.x||0)/this.drawScale,(y.y||0)/this.drawScale),n.set_shape(c),h=p.body.CreateFixture(n),u(h,d)):y.points?v(n,y.points,p.body,this.drawScale,d):y.halfWidth&&y.halfHeight?((c=new o).SetAsBox(y.halfWidth/this.drawScale,y.halfHeight/this.drawScale,new e((y.x||0)/this.drawScale,(y.y||0)/this.drawScale),0),n.set_shape(c),h=p.body.CreateFixture(n),u(h,d)):platypus.debug.warn(p.type+": Unhandled shape definition.",y),y.recycle()},findConnectedByJoinId:function(t){var e=null,i=0;for(i=0;i<this.connectedEntities.length;i++)if(this.connectedEntities[i].joinId===t){e=this.connectedEntities[i];break}return e},createJoint:function(t,i,s,n){var o=y[t],r=new e(0,0),a=new e(0,0),h=null,l=null,p=null,c="",d=null,g=null;switch(void 0===n&&(n=this.drawScale),s?(h=this.owner,l=s):"string"==typeof i.join?(h=this.owner,l=this.findConnectedByJoinId(i.join)):i.join?(h=i.join.A?this.findConnectedByJoinId(i.join.A):this.owner,l=i.join.B?this.findConnectedByJoinId(i.join.B):this.owner):(h=this.owner,l=this.findConnectedByJoinId("entity-0")),i.anchor?(r.set_x(i.anchor.x),r.set_y(i.anchor.y),o.Initialize(h.body,l.body,r)):(o.set_bodyA(h.body),o.set_bodyB(l.body),i.localAnchorA&&r.Set(i.localAnchorA.x/n,i.localAnchorA.y/n),o.set_localAnchorA(r),i.localAnchorB&&a.Set(i.localAnchorB.x/n,i.localAnchorB.y/n),o.set_localAnchorB(a)),o.set_collideConnected(!!i.collideConnected),t){case"distance":o.set_length(i.length/this.drawScale||1),o.set_dampingRatio(i.dampingRatio||0),o.set_frequencyHz(i.frequencyHz||0);break;case"revolute":o.set_referenceAngle(i.referenceAngle||0),o.set_enableLimit(!!i.enableLimit),o.set_lowerAngle(i.lowerAngle||0),o.set_upperAngle(i.upperAngle||0),o.set_enableMotor(!!i.enableMotor),o.set_maxMotorTorque(i.maxMotorTorque||0),o.set_motorSpeed(i.motorSpeed||0);break;case"prismatic":g=new e(1,0),i.localAxisA&&g.Set(i.localAxisA.x,i.localAxisA.y),o.set_localAxisA(g),o.set_referenceAngle(i.referenceAngle||0),o.set_enableLimit(!!i.enableLimit),o.set_lowerTranslation(i.lowerTranslation/this.drawScale||0),o.set_upperTranslation(i.upperTranslation/this.drawScale||0),o.set_enableMotor(!!i.enableMotor),o.set_maxMotorForce(i.maxMotorForce||0),o.set_motorSpeed(i.motorSpeed||0);break;case"weld":o.set_referenceAngle(i.referenceAngle||0);break;case"pulley":case"gear":case"mouse":case"wheel":case"rope":case"friction":case"motor":default:platypus.debug.warn(t+" joints are not implemented at this point")}if(d={},i.userData)for(c in i.userData)i.userData.hasOwnProperty(c)&&(d[c]=i.userData[c]);return p=this.world.CreateJoint(o),p=Box2D.castObject(p,m[t]),u(p,d),h.triggerEvent("joint-attached",p),l.triggerEvent("joint-attached",p),p},removeJoint:function(t){l(t),this.world.DestroyJoint(t)},matchEntityToBody:function(t,e){var i=this.owner.body,s=t||i.GetPosition(),n=e||i.GetAngle(),o=s.get_x(),r=s.get_y();o===this.lastBodyX&&r===this.lastBodyY&&n===this.lastBodyAngle||(this.lastBodyX=o,this.lastBodyY=r,this.lastBodyAngle=n,this.lastX=this.owner.x=f(o*this.drawScale),this.lastY=this.owner.y=f(r*this.drawScale),this.lastOrientation=this.owner.orientation=f(n),this.owner.rotation=180*n/Math.PI)},matchBodyToEntity:function(){var t=this.owner,i=null,s=0,n=0;return(t.x!==this.lastX||t.y!==this.lastY||t.orientation!==this.lastOrientation)&&(this.lastX=t.x,this.lastY=t.y,this.lastOrientation=t.orientation,this.lastBodyX=s=f(t.x/this.drawScale),this.lastBodyY=n=f(t.y/this.drawScale),this.lastBodyAngle=f(t.orientation),i=new e(s,n),t.body.SetAwake(!0),t.body.SetTransform(i,this.lastBodyAngle),p(i),!0)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.DragGroup"),s=include("platypus.Vector"),n=function(t,e){return t*t+e*e},o=function(t){var e=null,i=this.camera,s=this.owner.container.parent.transform.worldTransform;i.empty||(this.tempEvents.length||this.increaseTempEvents(),(e=this.tempEvents.pop()).x=t.data.global.x/s.a+i.left,e.y=t.data.global.y/s.d+i.top,e.event=t.data.originalEvent,e.pixiEvent=t,e.entity=this.owner,this.mouseArray.push(function(t){var e=platypus.game.app;1!==this.dragTypeResolved&&(2===this.dragTypeResolved&&(this.dragTypeResolved=1),this.groupMovement&&this.continueInputMovement(t),this.triggeredLAPStartDragStall||0===t.event.movementX&&0===t.event.movementY?this.triggeredLAPStartDragStall&&!this.triggeredLAPStartDrag&&(this.triggeredLAPStartDrag=!0,e.analyticsEmitter.startDrag(e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"click-n-stick",this.owner.type,this.neverMovedPreviously?"resources":"build area")):this.triggeredLAPStartDragStall=!0,this.recycleTempEvent(t))}.bind(this,e)))},r=function(t){var e=null;this.owner.parent.zooming?this.ignoreInput=!0:(this.dragged=!1,this.dragTypeResolved=2,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick&&this.stickyClick(t,this)?(this.ignoreInput=!0,this.stickyClick=null):(e=o.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",e),this.stickyClick=function(t,e,i){return this.owner.container.removeListener("pointermove",t),e&&!this.owner.destroyed?this.endInputMovement(e,!0):this.owner.destroyed&&platypus.debug.warn("BoxDragger: Somehow a sticky-click stayed stuck on a destroyed entity."),i===this}.bind(this,e))):this.startInputMovement(t),this.recycleTempEvent(t))};platypus.createComponentClass({id:"BoxDragger",properties:{useNodes:!1},publicProperties:{untrashable:!1,dragging:!1,movable:!0,inTrash:null,inBuildingArea:!1,neverMovedPreviously:null,overlaps:0,z:0},initialize:function(){Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.firstRun=!0,this.sensorState=!1,this.groupMovement=null,this.locked=!0,this.ignoreInput=!1,this.mouseArray=[],this.tempEvents=[],this.increaseTempEvents(),this.wentOutsideTheScreen=!1,this.time=0,this.triggeredLAPStartDrag=!1,this.triggeredLAPStartDragStall=!1,this.dragTypeResolved=0},events:{adopted:function(){this.owner.state.get("block")&&(this.untrashable=!0),this.untrashable&&(this.inBuildingArea=!0)},"camera-update":function(t){this.camera.set(t.viewport)},"handle-logic":function(){},"handle-render":function(t){var i=this.groupMovement,s=this.owner.parent,n=null;i&&(i.readyToEnd?i.collisionComplete&&(i.endMovement(i.readyToEnd),i.recycle(),this.groupMovement=null):(s.triggerEvent("hover-state",i.state),this.countDown&&(this.countDown-=t.delta,this.countDown<=0&&(n=e.setUp("criteria",this.owner.groupId,"group",i,"invalid",!1),s.triggerEventOnChildren("validate-select-all",n),n.invalid?this.countDown=1/0:(s.triggerEventOnChildren("select-all",i,this.owner.groupId),i.selectAll(),this.countDown=0),n.recycle()))))},"handle-ai":function(){var t=0;for(t=0;t<this.mouseArray.length&&!this.willSoonBeDestroyed;t++)this.mouseArray[t]();1===this.dragTypeResolved&&(this.dragTypeResolved=0),this.mouseArray.length=0},pointerdown:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(r.bind(this,e))},pointermove:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){var e=platypus.game.app;this.ignoreInput||0===t.event.movementX&&0===t.event.movementY||(t.event?(this.dragged=!0,1!==this.dragTypeResolved&&(2===this.dragTypeResolved&&(this.dragTypeResolved=1),this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.groupMovement?this.continueInputMovement(t):platypus.debug.warn('BoxDragger: Received "pointermove" event, but have no group to move. This is bizarre.'),this.triggeredLAPStartDrag||(this.triggeredLAPStartDrag=!0,this.camera.empty&&this.camera.set(this.owner.parent.getCameraDimensions()),e.analyticsEmitter.startDrag(e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"press-n-drag",this.owner.type,this.neverMovedPreviously?"resources":"build area")),this.recycleTempEvent(t))):platypus.debug.warn("Mouse event received before entity was created."))}.bind(this,e))},pointerup:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created.")}.bind(this,e))},pointerupoutside:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created.")}.bind(this,e))},pointercancel:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.groupMovement&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created."))}.bind(this,e))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off"),i.removeComponent(this),e?i.addComponent(new platypus.components.BoxDraggerFrozen(this.owner,{})):i.addComponent(new platypus.components.FindMovables(this.owner,{})),t||i.parent.triggerEvent("child-entity-updated",i)},"before-box2d-update":function(){},"collide-with-building-region":function(){this.untrashable||(this.inBuildingArea=!0)},"collided-with-building-region":function(){this.untrashable||(this.inBuildingArea=!1)},"collide-with-trash":function(t){this.untrashable?this.owner.triggerEvent("begin-drag-overlap"):(this.inTrash||(this.inTrash=Array.setUp()),this.inTrash.push(t.otherFixture))},"collided-with-trash":function(t){var e;this.untrashable?this.owner.triggerEvent("end-drag-overlap"):(e=this.inTrash.indexOf(t.otherFixture))>=0?(this.inTrash.greenSplice(e),0===this.inTrash.length&&(this.inTrash.recycle(),this.inTrash=null)):platypus.debug.warn("Trying to remove a fixture that is not in trash.")},"begin-drag-overlap":function(){this.owner.state.get("block")||(this.overlaps+=1)},"end-drag-overlap":function(){this.owner.state.get("block")||(this.overlaps-=1)},"box2d-step-complete":function(){var t=this.groupMovement;this.vector&&t&&(t.readyToEnd&&(t.collisionComplete=!0),t.checkValidity())},"include-in-group":function(t){t.addEntity(this.owner)},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&this.groupMovement&&t.group!==this.groupMovement&&(t.invalid=!0)},"select-all":function(t,e){this.owner.groupId&&this.owner.groupId===e&&this.owner.triggerEvent("include-in-group",t)},"select-effected":function(t,e){this.owner.groupId&&this.owner.groupId===e&&t.push(this.owner)}},methods:{recycleTempEvent:function(t){t.x=0,t.y=0,t.event=null,t.pixiEvent=null,t.entity=null,this.tempEvents.push(t)},copyMouseEvent:function(t){var e=null;return this.tempEvents.length||this.increaseTempEvents(),(e=this.tempEvents.pop()).x=t.x,e.y=t.y,e.event=t.event,e.pixiEvent=t.pixiEvent,e.entity=t.entity,e},increaseTempEvents:function(){for(var t=5;t;)--t,this.tempEvents.push({x:0,y:0,event:null,pixiEvent:null,entity:null})},startInputMovement:function(t){var s,n=null,o=this.owner,r=e.setUp("invalid",!1);this.time=Date.now(),o.triggerEvent("validate-begin-group-movement",r),s=this.owner.parent.isThisGroupMoving(this.owner.groupId),r.invalid||s?this.ignoreInput=!0:(this.owner.parent.triggerEvent("dragging-a-piece",this.owner),this.groupMovement=n=i.setUp(t),n.addEntity(o),o.triggerEvent("begin-group-movement",n),n.startMovement(t),this.countDown=1250,o.parent.triggerEventOnChildren("select-effected",n.effected,o.groupId),o.parent.triggerEvent("pause-zooming")),r.recycle()},continueInputMovement:function(t){var i,o,r=this.groupMovement,a=null,h=null,l=0,p=null,c=null,u=null,d=Array.setUp(),g=0,m=!1,y=0,f=0,w=!0;if(r){if(this.owner.destroyed)return platypus.debug.warn("BoxDragger: Cannot move a destroyed entity. Bailing!"),r.endMovement(t),r.recycle(),void(this.groupMovement=null);for(i=s.setUp(t.x,t.y),o=r.saOrigin,c=Array.setUp(),g=(u=r.validSnaps).length,void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),r.getSnaps(c,i,this.owner.parent.pins,this.countDown),l=0;l<c.length;l++)if(p=c[l],r.validateMotion(p,c)){if(this.countDown){if(p.x===o.x&&p.y===o.y)break;this.countDown=0,this.owner.triggerEvent("break-away")}for(f=0;f<u.length;f++)if(u[f].pinFrom.handshake){w=!1;break}if((!u.length||w)&&p.pinTo)for(this.owner.triggerEvent("connect"),y=0;y<c.length-1;y++)c[y].pinFrom.handshake&&(c[y].pinFrom.vertical?c[y].pinFrom.triggerEvent("pop-v"):c[y].pinFrom.triggerEvent("pop-h"));if(g){for(m=!0;g--;)d.push(u[g].pinFrom),u[g].pinFrom.state.set("almost-pinned",!1),u[g].recycle();u.length=0}for(p.pinTo?(p.pinFrom.state.set("almost-pinned",!0),u.push(e.setUp("pinTo",p.pinTo,"pinFrom",p.pinFrom))):m&&(m=!1,r.justUnsnapped=!0),g=l+1;g<c.length;g++)(h=c[g]).pinFrom&&.9>n(p.x-h.x,p.y-h.y)&&(h.pinFrom.state.set("almost-pinned",!0),u.push(e.setUp("pinTo",h.pinTo,"pinFrom",h.pinFrom)));for(a=Array.setUp(),r.getPanelSnaps(a,p),l=a.length,r.justUnsnapped&&l&&(r.justUnsnapped=!1);l--;)!r.allowPops||a[l].pinFrom.state.get("was-panelled")||a[l].pinFrom.state.get("almost-pinned")||-1!==d.indexOf(a[l].pinFrom)||a[l].pinFrom.triggerEvent("pop"),a[l].pinFrom.state.set("was-panelled",!1),a[l].pinFrom.state.set("almost-pinned",!0),u.push(a[l]);a.recycle(),d.recycle(),r.continueMovement(p,u);break}c.recycle(2)}else platypus.debug.warn("BoxDragger: No group movement for this input. Bailing!")},endInputMovement:function(t,e){var i=platypus.game.app,n=this.groupMovement,o=n.lastValidPosition||t;this.owner.parent.triggerEvent("finished-dragging-a-piece",this.owner),2===n.state?(i.analyticsEmitter.removeAnswer(i.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:o.x-this.camera.left>>0,y:o.y-this.camera.top>>0},this.owner.type,{build_w:i.buildingRegion.width>>0,build_h:i.buildingRegion.height>>0,x:n.saOrigin.x+n.offsets[0].x-i.buildingRegion.x>>0,y:n.saOrigin.y+n.offsets[0].y-i.buildingRegion.y>>0},i.getLayout(),i.getResources(),e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0),n.endMovement(o),this.groupMovement.recycle(),this.groupMovement=null):(1===n.state&&(this.owner.parent.triggerEvent("rl-play-cannot-place",n),i.analyticsEmitter.endDragOutside(i.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0,this.owner.type,{build_w:i.buildingRegion.width>>0,build_h:i.buildingRegion.height>>0,x:this.owner.x-i.buildingRegion.x>>0,y:this.owner.y-i.buildingRegion.y>>0})),this.continueInputMovement(o),o=n.lastValidPosition||t,n.readyToEnd=s.setUp(o.x,o.y),this.neverMovedPreviously&&(i.analyticsEmitter.selectAnswer(i.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:o.x-this.camera.left>>0,y:o.y-this.camera.top>>0},this.owner.type,{build_w:i.buildingRegion.width>>0,build_h:i.buildingRegion.height>>0,x:this.owner.x-i.buildingRegion.x>>0,y:this.owner.y-i.buildingRegion.y>>0},i.getLayout(),i.getResources(),e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0),this.neverMovedPreviously=null)),this.owner.destroyed||(this.owner.parent.triggerEvent("unpause-zooming"),this.owner.parent.triggerEvent("moved-item"),this.triggeredLAPStartDrag=!1,this.triggeredLAPStartDragStall=!1)},destroy:function(){this.camera.recycle()}},publicMethods:{startMovement:function(t){this.vector?this.vector.recycle():this.owner.renderGroup="hover",this.vector=s.setUp(t.x,t.y),this.locked=!1,this.owner.triggerEvent("starting-drag")},continueMovement:function(t){var e=this.owner;this.vector.x=t.x,this.vector.y=t.y,e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endMovement:function(t,e,i){this.vector&&(i||this.continueMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,this.owner.renderGroup="blueprint",this.owner.triggerEvent("motion-ended"),2!==e||i||this.owner.destroyed||(this.willSoonBeDestroyed=!0,this.stickyClick&&this.stickyClick(),this.addEventListener("prepare-logic",function(){this.owner.triggerEvent("throw-away"),this.owner.destroyed||this.owner.parent.removeEntity(this.owner)})))},validateMotion:function(t,e){if(!this.movable)return t.valid=!1,void(t.movable=!1);this.owner.triggerEvent("validate-motion",t),t.valid||e&&t.adjusted&&(t.position=t.adjusted,t.adjusted=null,t.valid=!0,this.validateMotion(t,e-1))}}})}(),function(){"use strict";platypus.createComponentClass({id:"BoxDraggerFrozen",publicProperties:{overlaps:0},initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.triggerEvent("input-on"),t.removeComponent(this),t.addComponent(new platypus.components.BoxDragger(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"begin-drag-overlap":function(){this.overlaps+=1},"end-drag-overlap":function(){this.overlaps-=1}}})}(),function(){"use strict";var t=include("Box2D.b2AABB"),e=include("Box2D.b2Contact"),i=include("Box2D.b2Fixture"),s=include("Box2D.b2Vec2"),n=include("Box2D.b2World"),o=include("Box2D.JSContactListener"),r=include("Box2D.JSQueryCallback"),a=include("springroll.Debug",!1),h=include("Box2D.helpers.getCanvasDebugDraw"),l=include("Box2D.helpers.getUserData"),p=include("Box2D.destroy"),c={collisionType:"none",entity:null},u=include("Box2D.wrapPointer"),d={entity:null,contact:null,thisFixture:null,otherFixture:null,oldManifold:null,impulse:null},g=function(t){var i=u(t,e),s=i.GetFixtureA(),n=i.GetFixtureB(),o=l(s).collisionType,r=l(n).collisionType,a=l(s.GetBody()).entity,h=l(n.GetBody()).entity;d.contact=i,d.oldManifold=null,d.impulse=null,d.thisFixture=s,d.otherFixture=n,d.entity=h,a.triggerEvent("begin-contact-"+o+"-and-"+r,d),d.thisFixture=n,d.otherFixture=s,d.entity=a,h.triggerEvent("begin-contact-"+r+"-and-"+o,d)},m=function(t){var i=u(t,e),s=i.GetFixtureA(),n=i.GetFixtureB(),o=(l(s)||c).collisionType,r=(l(n)||c).collisionType,a=(l(s.GetBody())||c).entity,h=(l(n.GetBody())||c).entity;d.contact=i,d.oldManifold=null,d.impulse=null,a&&(d.thisFixture=s,d.otherFixture=n,d.entity=h,a.triggerEvent("end-contact-"+o+"-and-"+r,d)),h&&(d.thisFixture=n,d.otherFixture=s,d.entity=a,h.triggerEvent("end-contact-"+r+"-and-"+o,d))},y=function(t,i){var s=u(t,e),n=s.GetFixtureA(),o=s.GetFixtureB(),r=l(n).collisionType,a=l(o).collisionType,h=l(n.GetBody()).entity,p=l(o.GetBody()).entity;d.contact=s,d.oldManifold=i,d.impulse=null,d.thisFixture=n,d.otherFixture=o,d.entity=p,h.triggerEvent("pre-solve-"+r+"-and-"+a,d),d.thisFixture=o,d.otherFixture=n,d.entity=h,p.triggerEvent("pre-solve-"+a+"-and-"+r,d)},f=function(t,i){var s=u(t,e),n=s.GetFixtureA(),o=s.GetFixtureB(),r=l(n).collisionType,a=l(o).collisionType,h=l(n.GetBody()).entity,p=l(o.GetBody()).entity;d.contact=s,d.oldManifold=null,d.impulse=i,d.thisFixture=n,d.otherFixture=o,d.entity=p,h.triggerEvent("post-solve-"+r+"-and-"+a,d),d.thisFixture=o,d.otherFixture=n,d.entity=h,p.triggerEvent("post-solve-"+a+"-and-"+r,d)};platypus.createComponentClass({id:"BoxHandler",properties:{gravity:null,simulationFrequency:1/60,velocityIterations:10,positionIterations:10,debugFlags:null},publicProperties:{world:null,drawScale:30,logicStepsPerBox2DStep:1},initialize:function(t){var e=this.gravity||{x:0,y:0},i=new o,r=void 0===t.allowSleep||t.allowSleep;this.destroyBodies=[],this.inCollisionLoop=!1,this.paused=!1,this.totalTime=0,this.world=new n(new s(e.x,e.y),r),i.BeginContact=g,i.EndContact=m,i.PreSolve=y,i.PostSolve=f,this.world.SetContactListener(i),(t.debug||!1!==t.debug&&(this.owner.debug||a))&&(this.debugCanvas=document.createElement("canvas"),this.debugCanvas.style.pointerEvents="none",this.debugCanvas.id="box2D-debug-canvas",this.ctx=this.debugCanvas.getContext("2d"),document.body.appendChild(this.debugCanvas),this.debugDraw=h(this.ctx),this.debugDraw.SetFlags(this.debugFlags?this.debugFlags:3),this.world.SetDebugDraw(this.debugDraw))},events:{"body-removed":function(t){this.inCollisionLoop?this.destroyBodies.push(t):this.world.DestroyBody(t)},"check-collision-group":function(t){var e=this.debugCanvas,i=this.destroyBodies,s=0,n=this.owner,o=this.simulationFrequency,r=this.world;if(i.length){for(s=0;s<i.length;s++)r.DestroyBody(i[s]);i.length=0}if(!this.paused)for(this.totalTime+=t.delta/(1e3*o);this.totalTime>0;)this.totalTime-=this.logicStepsPerBox2DStep,n.triggerEvent("before-box2d-update",t,o),n.triggerEventOnChildren("before-box2d-update",t,o),this.inCollisionLoop=!0,r.Step(o,this.velocityIterations,this.positionIterations),this.inCollisionLoop=!1,e&&(this.ctx.clearRect(0,0,e.width,e.height),r.DrawDebugData()),r.ClearForces(),n.triggerEventOnChildren("after-box2d-update",t,o),n.triggerEvent("after-box2d-update",t,o),n.triggerEventOnChildren("box2d-step-complete")},"camera-update":function(t){var e=window.devicePixelRatio||1,i=t.scaleY*this.drawScale/e,s=t.scaleX*this.drawScale/e;this.debugCanvas&&(this.debugCanvas.width===this.debugCanvas.offsetWidth&&this.debugCanvas.height===this.debugCanvas.offsetHeight||(this.debugCanvas.width=this.debugCanvas.offsetWidth,this.debugCanvas.height=this.debugCanvas.offsetHeight),this.ctx.restore(),this.ctx.save(),this.ctx.translate(-t.viewport.left*t.scaleX/e,-t.viewport.top*t.scaleY/e),this.ctx.scale(i,s))},"pause-collision":function(){this.paused=!0},"unpause-collision":function(){this.paused=!1}},methods:{destroy:function(){p(this.world),this.world=null,this.debugCanvas&&this.debugCanvas.parentNode&&this.debugCanvas.parentNode.removeChild(this.debugCanvas),this.debugCanvas=null,this.debugDraw=null,this.ctx=null}},publicMethods:{getEntitiesAtPoint:function(e,n){var o=new t,a=Array.setUp(),h=e/this.drawScale,c=n/this.drawScale,d=new s(h-.01,c-.01),g=new s(h+.01,c+.01),m=new r,y=null;return o.set_lowerBound(d),o.set_upperBound(g),m.ReportFixture=function(t){var e=u(t,i);return e.TestPoint(this.m_point)&&(y=l(e.GetBody()))&&y.entity&&a.push(y.entity),!0},m.m_point=new s(h,c),this.world.QueryAABB(m,o),p(d),p(g),p(o),a}}})}(),function(){"use strict";var t,e,i=include("platypus.AABB"),s=include("Box2D.b2Vec2"),n=include("PIXI.filters.ColorMatrixFilter"),o=include("PIXI.Container"),r=include("PIXI.Graphics"),a=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},h=include("Box2D.destroy");platypus.createComponentClass({id:"BoxStateSaver",properties:{renderDebug:!1,useStressSignals:!0},publicProperties:{buildingArea:null,engine:null,world:null,gravityMultiplier:1},initialize:function(){this.busySaving=!1,this.simulationStarted=!1,this.initialCamera=i.setUp(0,0,960,720),this.camera=i.setUp(),this.mask=null,this.level=null,this.stage=null,this.gravityStrength=50,this.gravity=new s(0,this.gravityStrength),this.noGravity=new s(0,0),springroll.Debug&&(window.makeEverythingMovable=this.makeEverythingMovable.bind(this),window.exportLevel=this.exportLevel.bind(this)),this.owner.stickyClick=null},events:{"set-gravity":function(t){this.gravityMultiplier=t},"hover-state":function(t){if(this.stage!==t)switch(this.stage=t,t){case 2:this.updateFilter(1,0,0);break;case 1:this.updateFilter(1,.6,.6);break;default:this.updateFilter(1,1,.4)}},"render-world":(e=function(t,e,i){for(var s=e.length,n=null;s--;)if(e[s].name===t)return e[s];return(n=new o).name=t,e.push(n),i.addChild(n),n},function(t){var i=t.renderGroups,s=t.world,o=e("blueprint",i,s),a=e("hover",i,s);o.z=0,this.mask=function(t,e){var i=new r;return t.mask=i,i.isMask=!0,i.z=1,e.addChild(i),i}(o,s),this.hover=a,a.filters=Array.setUp(new n),this.updateFilter(1,1,.6),a.z=2e3,t.world.reorder=!0}),"world-loaded":function(t){var e=0,i=null,s=platypus.labRetriever,n=this.owner.labUnlocks;if(this.level=t.level,n)for(e=(n=n.split(",")).length;e--;)i=n[e],s.has(i)||platypus.labRetriever.unlock(i)},"start-simulation":function(){this.simulationStarted?platypus.debug.warn("Simulation asked to start, but it is already started."):this.startSimulation()},"stop-simulation":function(){this.simulationStarted?this.stopSimulation():platypus.debug.warn("Simulation asked to stop, but it is not started.")},"camera-update":function(t){this.camera.set(t.viewport),this.updateMask()},"building-area-ready":function(t){this.buildingArea=t},"stop-following-if-simulating":function(){this.followingItem&&(this.followingItem=!1,this.owner.triggerEvent("follow",{mode:"static"}))},"child-entity-removed":function(t){this.simulationStarted||this.owner.triggerEvent("entity-discarded",t.type)},"recycle-everything":function(){for(var t=this.owner,e=(t.parent.app,t.entities.greenSlice()),i=null,s=e.length;s--;)!(i=e[s]).destroyed&&i.savable&&"cockpit"!==i.type&&(t.removeEntity(i),1);e.recycle()},"tour-started":function(){this.onTour=!0,this.updateMask()},"tour-stopped":function(){this.onTour=!1,this.updateMask()},"photo-ready":(t=function(t,e,i){var s=0,n=platypus.game.app.config.journal,o={thumbnail:function(t,e,i){var s=0,n=0,o=t.width,r=t.height,a=document.createElement("canvas"),h=a.getContext("2d");a.width=e,a.height=i,o/r>e/i?(s=i*(o/r),n=i):o/r<e/i?(s=e,n=e*(r/o)):(s=e,n=i);try{return h.drawImage(t,0,0,o,r,(e-s)/2,(i-n)/2,s,n),a.toDataURL()}catch(t){return null}}(platypus.game.app.display.renderer.extract.canvas(this.owner.worldContainer),n.thumbnail.width/2,n.thumbnail.height/2),level:this.getSaveState()};for(Array.isArray(i)||(i=[]),s=0;s<i.length&&i[s];s++);if(s>=n.maxSavesPerGame)platypus.debug.olive("Will need to remove a picture to make room!"),platypus.game.loadScene("journal-menu",{insertSave:o});else{i[s]=o;try{t.write(n.storageKey,i,e)}catch(s){o.thumbnail=null,t.write(n.storageKey,i,e)}}},function(){var e=this.owner.parent.app.userData,i=platypus.game.app.config.journal;this.busySaving||(this.busySaving=!0,e.read(i.storageKey,t.bind(this,e,function(){this.busySaving=!1}.bind(this))))})},methods:{getSaveState:function(){var t,e=this.owner,i=Array.setUp();return e.triggerEventOnChildren("retrieve-save-state",i,this.editingLevel),t=function(t,e,i){var s=JSON.parse(JSON.stringify(e)),n=null,o=null,r=s.layers,h=r.length,l=0,p=null;for(delete s.assets;h--;)if(r[h].objects){o=r[h].objects;break}for(h=o.length;h--;)n=o[h],a(n.properties,"savable")||i&&a(n.properties,"movable")?o.splice(h,1):l=Math.max(l,n.id+1);for(h=s.tilesets.length;h--;)p=s.tilesets[h],s.tilesets[h]={firstgid:p.firstgid,source:p.source||p.name+".json"};return t.forEach(function(t){t.id=l++,o.push(t)}),s}(i,this.level,this.editingLevel),i.recycle(),t},startSimulation:function(){var t=this.owner,e=0,i=null,s=this.useStressSignals;for(this.simulationStarted=!0,this.updateMask(),this.gravity.set_y(this.gravityStrength*this.gravityMultiplier),this.world.SetGravity(this.gravity),this.level=this.getSaveState(),this.owner.triggerEvent("pre-simulation-started"),e=t.pins&&t.pins.length;e--;)t.pins[e].getConstraints().length>0&&(i={},t.pins[e].panelled?(i.distance=.9,s=!1):t.pins[e].handshake?(i.distance=.35,s=!1):(i.angle="default",i.reaction="default",i.distance="default",s=this.useStressSignals),this.owner.triggerEvent("add-joint-cluster",t.pins[e].getConstraints(),i,s));this.owner.triggerEvent("simulation-started")},stopSimulation:function(){this.owner.triggerEvent("pre-simulation-stopped"),this.simulationStarted=!1,this.updateMask(),this.world.SetGravity(this.noGravity),this.owner.triggerEventOnChildren("restore-save-state"),this.owner.triggerEvent("simulation-stopped")},updateFilter:function(t,e,i){var s=this.hover.filters[0].matrix;s[0]=t,s[6]=e,s[12]=i},updateMask:function(){var t=i.setUp(this.camera),e=Math.min(t.width/this.initialCamera.width,t.height/this.initialCamera.height);this.simulationStarted||this.onTour||t.setAll(t.x+100*e,t.y,t.width-200*e,t.height),function(t,e){e.clear(),e.beginFill(0,1),e.r(t.left-1,t.top-1,t.width+2,t.height+2),e.endFill()}(t,this.mask),t.recycle()},destroy:function(){h(this.gravity),h(this.noGravity),this.camera.recycle(),this.camera=null,this.initialCamera.recycle(),this.initialCamera=null}},publicMethods:{makeEverythingMovable:function(){for(var t=this.owner.entities,e=t.length,i=null;e--;)!(i=t[e]).hasOwnProperty("movable")||i.neverSave||i.movable||(i.movable=!0)},exportLevel:function(){return this.simulationStarted?"Restart simulation before attempting to export.":(this.editingLevel=!0,JSON.stringify(this.getSaveState()))},getSavedLevel:function(){return this.level}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"ButtonHideShow",properties:{showHides:null},publicProperties:{activeLeft:0,inactiveLeft:0},initialize:function(){this.tweenTime=500},events:{"show-0":function(){this.activeLeft&&(this.showHides[0].show.left=this.activeLeft),this.show(this.showHides[0].show)},"hide-0":function(){this.activeLeft&&(this.showHides[0].hide.left=this.inactiveLeft),this.hide(this.showHides[0].hide)},"show-1":function(){this.show(this.showHides[1].show)},"hide-1":function(){this.hide(this.showHides[1].hide)},reveal:function(){this.owner.opacity=1}},methods:{show:function(i){var s=null,n={},o=this.owner.trigger,r=null;for(s in i)"disable"===s?!0:n[s]=i[s];t.removeTweens(this.owner),this.owner.opacity=1,(r=t.get(this.owner).call(o,["enable"])).to(n,this.tweenTime,e.sineOut),r.call(o,["button-shown"])},hide:function(i){var s=null,n={},o=!1;for(s in i)"disable"===s?o=!0:n[s]=i[s];t.removeTweens(this.owner),o&&(this.owner.triggerEvent("disable"),this.owner.triggerEvent("button-hiding")),t.get(this.owner).to(n,this.tweenTime,e.sineOut)}},publicMethods:{}})}(),function(){"use strict";var t,e,i,s,n,o,r,a,h,l,p=window.devicePixelRatio||1,c=include("platypus.AABB"),u=include("platypus.Data"),d=include("platypus.Vector"),g=function(){return!1},m=function(t){return t.clientX?t.clientX:t.touches&&t.touches[0]&&t.touches[0].clientX?t.touches[0].clientX:0},y=function(t){return t.clientY?t.clientY:t.touches&&t.touches[0]&&t.touches[0].clientY?t.touches[0].clientY:0};platypus.createComponentClass({id:"Camera",properties:{width:0,height:0,mode:"static",overflow:!1,stretch:!1,threshold:1,rotate:!1,x:0,y:0},publicProperties:{canvas:null,transitionX:400,transitionY:600,transitionAngle:600},initialize:function(t){var e=c.setUp(this.x,this.y,this.width,this.height),i=u.setUp("viewport",e,"orientation",t.orientation||0);this.viewport=c.setUp(0,0,0,0),this.worldCamera=i,this.worldDimensions=c.setUp(),this.message=u.setUp("viewport",c.setUp(),"scaleX",0,"scaleY",0,"orientation",0,"stationary",!1,"world",this.worldDimensions),this.cameraLoadedMessage=u.setUp("viewport",this.message.viewport,"world",this.worldDimensions),this.worldIsLoaded=!1,this.following=null,this.state="static","pan"===this.mode&&(this.state="mouse-pan"),this.boundingBox=c.setUp(e.x,e.y,e.width/2,e.height/2),this.lastX=e.x,this.lastY=e.y,this.lastOrientation=i.orientation,this.forwardX=0,this.forwardY=0,this.forwardAngle=0,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=0,this.offsetY=0,this.offsetAngle=0,this.forwardFollower=u.setUp("x",this.lastX,"y",this.lastY,"orientation",this.lastOrientation),this.lastFollow=u.setUp("entity",null,"mode",null,"offsetX",0,"offsetY",0,"begin",0),this.xMagnitude=0,this.yMagnitude=0,this.xWaveLength=0,this.yWaveLength=0,this.xShakeTime=0,this.yShakeTime=0,this.shakeTime=0,this.shakeIncrementor=0,this.direction=!0,this.stationary=!1,this.viewportUpdate=!1,this.owner.container?this.parentContainer=this.owner.container:this.owner.stage?(this.canvas=this.canvas||platypus.game.app.display.canvas,this.parentContainer=this.owner.stage,this.owner.width=this.canvas.width,this.owner.height=this.canvas.height):platypus.debug.warn("Camera: There appears to be no Container on this entity for the camera to display."),this.container=new PIXI.Container,this.container.visible=!1,this.parentContainer.addChild(this.container),this.movedCamera=!1},events:{load:function(){this.resize()},"render-world":function(t){this.world=t.world,this.container.addChild(this.world)},"child-entity-added":function(t){this.viewportUpdate=!0,this.worldIsLoaded&&t.triggerEvent("camera-loaded",this.cameraLoadedMessage)},"child-entity-updated":function(t){this.viewportUpdate=!0,this.worldIsLoaded&&t.triggerEvent("camera-update",this.message)},"world-loaded":function(t){this.message.viewport.set(this.worldCamera.viewport),this.worldDimensions.set(t.world),this.worldIsLoaded=!0,t.camera&&this.follow(t.camera),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-loaded",this.cameraLoadedMessage),this.updateMovementMethods()},pointerdown:function(t){var e=this.worldCamera.viewport;"mouse-pan"===this.state&&(this.mouseVector||(this.mouseVector=d.setUp(),this.mouseWorldOrigin=d.setUp()),this.mouse=this.mouseVector,this.mouse.x=m(t.event),this.mouse.y=y(t.event),this.mouseWorldOrigin.x=e.x,this.mouseWorldOrigin.y=e.y,t.pixiEvent.stopPropagation())},pressmove:function(t){this.mouse&&this.move(this.mouseWorldOrigin.x+(this.mouse.x-m(t.event))*p/this.world.transform.worldTransform.a,this.mouseWorldOrigin.y+(this.mouse.y-y(t.event))*p/this.world.transform.worldTransform.d)&&(this.viewportUpdate=!0,this.movedCamera=!0,t.pixiEvent.stopPropagation())},pressup:function(t){this.mouse&&(this.mouse=null,this.movedCamera&&(this.movedCamera=!1,t.pixiEvent.stopPropagation()))},tick:function(t){var e=this.message,i=e.viewport,s=this.worldCamera;"following"===this.state&&this.followingFunction(this.following,t.delta)&&(this.viewportUpdate=!0),this.canvas&&(this.owner.width=this.canvas.width,this.owner.height=this.canvas.height),this.owner.width===this.lastWidth&&this.owner.height===this.lastHeight||(this.resize(),this.lastWidth=this.owner.width,this.lastHeight=this.owner.height),this.viewportUpdate?(this.viewportUpdate=!1,this.stationary=!1,e.stationary=!1,i.set(s.viewport),this.shakeIncrementor<this.shakeTime&&(this.viewportUpdate=!0,this.shakeIncrementor+=t.delta,this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime),this.shakeIncrementor<this.xShakeTime&&i.moveX(i.x+Math.sin(this.shakeIncrementor/this.xWaveLength*(2*Math.PI))*this.xMagnitude),this.shakeIncrementor<this.yShakeTime&&i.moveY(i.y+Math.sin(this.shakeIncrementor/this.yWaveLength*(2*Math.PI))*this.yMagnitude)),e.scaleX=this.windowPerWorldUnitWidth,e.scaleY=this.windowPerWorldUnitHeight,e.orientation=s.orientation,this.world.setTransform(-i.x,-i.y,1,1,0),this.container.setTransform(i.halfWidth*e.scaleX,i.halfHeight*e.scaleY,e.scaleX,e.scaleY,e.orientation),this.container.visible=!0,this.owner.triggerEvent("camera-update",e),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",e)):this.stationary||(this.stationary=!0,e.stationary=!0,this.owner.triggerEvent("camera-update",e),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",e)),this.lastFollow.begin&&this.lastFollow.begin<Date.now()&&this.follow(this.lastFollow)},"resize-camera":function(t){this.width=t.width,this.height=t.height,this.resize()},relocate:function(t){var e=null,i=this.worldCamera.viewport;t.time&&window.createjs&&createjs.Tween?(e=d.setUp(i.x,i.y),createjs.Tween.get(e).to({x:t.x,y:t.y},t.time,t.ease).on("change",function(t){this.move(t.x,t.y)&&(this.viewportUpdate=!0)}.bind(this,e)).call(function(){this.recycle()}.bind(e))):this.move(t.x,t.y)&&(this.viewportUpdate=!0)},follow:function(t){this.follow(t)},shake:function(t){var e=t||{},i=e.xMagnitude||0,s=e.yMagnitude||0,n=e.xFrequency||0,o=e.yFrequency||0,r=e.time||0;this.viewportUpdate=!0,this.shakeIncrementor=0,this.xMagnitude=i,this.yMagnitude=s,0===n?(this.xWaveLength=1,this.xShakeTime=0):(this.xWaveLength=1e3/n,this.xShakeTime=Math.ceil(r/this.xWaveLength)*this.xWaveLength),0===o?(this.yWaveLength=1,this.yShakeTime=0):(this.yWaveLength=1e3/o,this.yShakeTime=Math.ceil(r/this.yWaveLength)*this.yWaveLength),this.shakeTime=Math.max(this.xShakeTime,this.yShakeTime)}},methods:{follow:function(t){switch(t.time?(this.lastFollow.begin||(this.lastFollow.entity=this.following,this.lastFollow.mode=this.mode,this.lastFollow.offsetX=this.offsetX,this.lastFollow.offsetY=this.offsetY),this.lastFollow.begin=Date.now()+t.time):this.lastFollow.begin&&(this.lastFollow.begin=0),this.mode=t.mode,t.mode){case"locked":this.state="following",this.following=t.entity,this.followingFunction=this.lockedFollow,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetAngle=t.offsetAngle||0;break;case"forward":this.state="following",this.followFocused=!1,this.following=t.entity,this.lastX=t.entity.x-t.offsetX||0,this.lastY=t.entity.y-t.offsetY||0,this.lastOrientation=t.entity.orientation||0,this.forwardX=t.movementX||.1*this.transitionX,this.forwardY=t.movementY||.1*this.transitionY,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetAngle=t.offsetAngle||0,this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following",this.following=t.entity,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetAngle=t.offsetAngle||0,this.boundingBox.setAll(t.x,t.y,t.width,t.height),this.followingFunction=this.boundingFollow;break;case"anchor-bound":this.state="following",this.following=t.entity,this.followingFunction=function(t,e,i,s){var n=c.setUp(s.x+e,s.y+i,s.width,s.height),o=t.x,r=t.y;return n.top<t.top?r-=t.top-n.top:n.bottom>t.bottom&&(r+=t.bottom-n.bottom),n.left<t.left?o-=t.left-n.left:n.right>t.right&&(o+=t.right-n.right),n.recycle(),this.move(o,r,0)}.bind(this,t.anchorAABB,t.offsetX||0,t.offsetY||0);break;case"pan":this.state="mouse-pan",this.following=null,this.followingFunction=null,t&&"number"==typeof t.x&&"number"==typeof t.y&&(this.move(t.x,t.y,t.orientation||0),this.viewportUpdate=!0);break;default:this.state="static",this.following=null,this.followingFunction=null,t&&"number"==typeof t.x&&"number"==typeof t.y&&(this.move(t.x,t.y,t.orientation||0),this.viewportUpdate=!0)}t.begin&&(t.begin=0)},move:function(t,e,i){var s=this.moveX(t);return s=this.moveY(e)||s,this.rotate&&(s=this.reorient(i||0)||s),s},moveX:g,moveY:g,reorient:function(t){var e=this.worldCamera;return Math.abs(e.orientation-t)>1e-4&&(e.orientation=t,!0)},lockedFollow:(a=Math.min,h=function(t,e,i){return i*e+(1-i)*t},l=function(t,e){return t?a(e/t,1):1},function(t,e){var i=this.worldCamera,s=i.viewport,n=h(s.x,t.x+this.offsetX,l(this.transitionX,e)),o=h(s.y,t.y+this.offsetY,l(this.transitionY,e));return this.rotate?this.move(n,o,h(i.orientation,-(t.orientation||0),l(this.transitionAngle,e))):this.move(n,o,0)}),forwardFollow:function(t,e){var i=this.forwardFollower,s=!1,n=15/e,o=this.worldCamera,r=o.viewport,a=t.x+this.offsetX,h=t.y+this.offsetY,l=(t.orientation||0)+this.offsetAngle;return this.followFocused&&this.lastX===a&&this.lastY===h?this.lockedFollow(i,e):(this.averageOffsetX*=.9,this.averageOffsetY*=.9,this.averageOffsetX+=(1-.9)*(a-this.lastX)*n,this.averageOffsetY+=(1-.9)*(h-this.lastY)*n,Math.abs(this.averageOffsetX)>r.width/(2*this.forwardX)&&(this.averageOffsetX=0),Math.abs(this.averageOffsetY)>r.height/(2*this.forwardY)&&(this.averageOffsetY=0),this.rotate&&(this.averageOffsetAngle*=.9,this.averageOffsetAngle+=(1-.9)*(l-this.lastOrientation)*n,Math.abs(this.averageOffsetAngle)>o.orientation/(2*this.forwardAngle)&&(this.averageOffsetAngle=0)),i.x=this.averageOffsetX*this.forwardX+a,i.y=this.averageOffsetY*this.forwardY+h,i.orientation=this.averageOffsetAngle*this.forwardAngle+l,this.lastX=a,this.lastY=h,this.lastOrientation=l,s=this.lockedFollow(i,e),this.followFocused||s||(this.followFocused=!0),s)},boundingFollow:function(t,e){var i=0,s=0,n=this.transitionX?Math.min(e/this.transitionX,1):1,o=1-n,r=this.transitionY?Math.min(e/this.transitionY,1):1,a=1-r,h=this.worldCamera.viewport;return this.boundingBox.move(h.x,h.y),t.x>this.boundingBox.right?i=t.x-this.boundingBox.halfWidth:t.x<this.boundingBox.left&&(i=t.x+this.boundingBox.halfWidth),t.y>this.boundingBox.bottom?s=t.y-this.boundingBox.halfHeight:t.y<this.boundingBox.top&&(s=t.y+this.boundingBox.halfHeight),0!==i&&(i=this.moveX(n*i+o*h.x)),0!==s&&(s=this.moveY(r*s+a*h.y)),i||s},resize:function(){var t=this.width/this.height,e=this.owner.width/this.owner.height,i=this.worldCamera.viewport;this.viewport.setAll(this.owner.width/2,this.owner.height/2,this.owner.width,this.owner.height),this.stretch||(e>t?this.overflow?i.resize(this.height*e,this.height):this.viewport.resize(this.viewport.height*t,this.viewport.height):this.overflow?i.resize(this.width,this.width/e):this.viewport.resize(this.viewport.width,this.viewport.width/t)),this.worldPerWindowUnitWidth=i.width/this.viewport.width,this.worldPerWindowUnitHeight=i.height/this.viewport.height,this.windowPerWorldUnitWidth=this.viewport.width/i.width,this.windowPerWorldUnitHeight=this.viewport.height/i.height,this.container.setTransform(this.viewport.x-this.viewport.halfWidth,this.viewport.y-this.viewport.halfHeight),this.viewportUpdate=!0,this.updateMovementMethods()},updateMovementMethods:(t=g,e=function(){var e=this.worldDimensions;return this.worldCamera.viewport.moveX(e.width/2+e.left),this.moveX=t,!0},i=function(){var e=this.worldDimensions;return this.worldCamera.viewport.moveY(e.height/2+e.top),this.moveY=t,!0},s=function(t){var e=this.worldCamera.viewport,i=this.worldDimensions,s=i.width,n=i.left;return Math.abs(e.x-t)>this.threshold&&(t+e.halfWidth>s+n?e.moveX(s-e.halfWidth+n):t<e.halfWidth+n?e.moveX(e.halfWidth+n):e.moveX(t),!0)},n=function(t){var e=this.worldCamera.viewport,i=this.worldDimensions,s=i.height,n=i.top;return Math.abs(e.y-t)>this.threshold&&(t+e.halfHeight>s+n?e.moveY(s-e.halfHeight+n):t<e.halfHeight+n?e.moveY(e.halfHeight+n):e.moveY(t),!0)},o=function(t){var e=this.worldCamera.viewport;return Math.abs(e.x-t)>this.threshold&&(e.moveX(t),!0)},r=function(t){var e=this.worldCamera.viewport;return Math.abs(e.y-t)>this.threshold&&(e.moveY(t),!0)},function(){var t=this.threshold,a=this.worldCamera.viewport,h=this.worldDimensions,l=h.width,p=h.height;l?l<a.width?this.moveX=e:this.moveX=s:this.moveX=o,p?p<a.height?this.moveY=i:this.moveY=n:this.moveY=r,this.threshold=-1,this.moveX(a.x),this.moveY(a.y),this.threshold=t}),destroy:function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.mouseVector&&(this.mouseVector.recycle(),this.mouseWorldOrigin.recycle()),this.boundingBox.recycle(),this.viewport.recycle(),this.worldCamera.viewport.recycle(),this.worldCamera.recycle(),this.message.viewport.recycle(),this.message.recycle(),this.cameraLoadedMessage.recycle(),this.worldDimensions.recycle(),this.forwardFollower.recycle(),this.lastFollow.recycle()}},publicMethods:{getCameraDimensions:function(){return this.message.viewport},isOnCanvas:function(t){var e=this.canvas;return!t||!(t.x+t.width<0||t.x>e.width||t.y+t.height<0||t.y>e.height)},windowToWorld:function(t,e,i){var s=i||d.setUp();return s.x=t.x*this.worldPerWindowUnitWidth,s.y=t.y*this.worldPerWindowUnitHeight,!1!==e&&(s.x+=this.worldCamera.viewport.left,s.y+=this.worldCamera.viewport.top),s},worldToWindow:function(t,e,i){var s=i||d.setUp();return s.x=t.x*this.windowPerWorldUnitWidth,s.y=t.y*this.windowPerWorldUnitHeight,!1!==e&&(s.x+=this.viewport.x,s.y+=this.viewport.y),s}}})}(),function(){"use strict";platypus.createComponentClass({id:"CockpitLogic",properties:{},publicProperties:{},initialize:function(){this.timer=2e3,this.busy=!1,this.busyTimer=2500,this.simming=!1,this.forwardProgress=0,this.finished=!1,this.extraSunspot=!1,this.doOnce=!1},events:{adopted:function(){platypus.game.app.getRoverLocation=function(){return this&&this.owner?{x:this.owner.x>>0,y:this.owner.y>>0,stage_w:this.owner.parent.lapLevelWidth,stage_h:this.owner.parent.lapLevelHeight}:{x:0,y:0,stage_w:0,stage_h:0}}.bind(this)},"peer-entity-added":function(t){"cockpit"===t.type&&t.savable&&(this.owner.opacity=0,this.extraSunspot=!0)},"prepare-logic":function(){this.doOnce||(this.doOnce=!0,this.extraSunspot?this.owner.parent.removeEntity(this.owner):this.owner.savable=!0)},"handle-logic":function(t){var e=t.delta;this.simming?this.owner.x>this.forwardProgress&&(this.forwardProgress=this.owner.x,this.owner.triggerEvent("rl-forward-progress-report",this.forwardProgress)):this.busy||(this.timer-=e,this.timer<=0&&(this.timer=15e3,this.owner.triggerEvent("stop-audio"),this.owner.triggerEvent("play-sunspot-wave"),this.owner.triggerEvent("wave"),this.busy=!0)),this.busy&&(this.busyTimer-=e,this.busyTimer<=0&&(this.busyTimer=2500,this.busy=!1))},"simulation-started":function(){this.busy||(this.owner.triggerEvent("thumbs-up"),this.busy=!0),this.simming=!0},"simulation-stopped":function(){this.owner.triggerEvent("idle"),this.busy=!1,this.busyTimer=2500,this.timer=15e3,this.simming=!1,this.finished=!1,this.forwardProgress=0},"rl-crossed-finish-line":function(){var t=Math.floor(2*Math.random());this.finished||(this.finished=!0,this.owner.triggerEvent("stop-audio"),this.owner.triggerEvent("play-sunspot-win-"+t),this.owner.triggerEvent("cheer"),this.busy=!0)},"something-broke":function(){var t=Math.floor(2*Math.random());this.busy||this.finished||(this.owner.triggerEvent("stop-audio"),this.owner.triggerEvent("play-sunspot-broke-"+t),this.owner.triggerEvent("danger"),this.busy=!0)},"in-the-sun":function(){this.owner.parent.triggerEvent("rl-play-found-sunny-spot")}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",properties:{propertyName1:"property-value"},publicProperties:{propertyName2:"property-value"},initialize:function(){},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=!1;platypus.createComponentClass({id:"ControllablePiece",properties:{},publicProperties:{},initialize:function(){this.allBatteries=[],this.myBatteries=[],this.checkIfConnected=!0,this.owner.state.set("connected-to-battery",!1),this.beingDragged=!1,this.playedMessage=!1},events:{"scene-live":function(){this.owner.triggerEvent("piece-added",this.owner.type)},adopted:function(){this.owner.triggerEvent("piece-added",this.owner.type)},"peer-entity-added":function(t){"battery"===t.type&&this.allBatteries.push(t)},"peer-entity-removed":function(t){var e=0;if("battery"===t.type){for(e=0;e<this.allBatteries;e++)if(this.allBatteries[e]===t){this.allBatteries.splice(e,1);break}for(e=0;e<this.myBatteries;e++)if(this.myBatteries[e]===t){this.myBatteries.splice(e,1);break}}},"update-group-id":function(){this.checkIfConnected=!0},"battery-moved":function(){this.checkIfConnected=!0},"starting-drag":function(){this.beingDragged=!0,this.owner.state.set("connected-to-battery",!1)},"motion-ended":function(){this.beingDragged=!1},"handle-logic":function(){var t=0,e=0,i=!1;if(!this.beingDragged&&this.checkIfConnected){for(this.myBatteries.length=0,t=0;t<this.allBatteries.length;t++)if(this.allBatteries[t].groupId===this.owner.groupId){for(e=0;e<this.myBatteries.length;e++)if(this.allBatteries[t].order<this.myBatteries[e].order){this.myBatteries.splice(e,0,this.allBatteries[t]),i=!0;break}i||this.myBatteries.push(this.allBatteries[t]),i=!1}this.myBatteries.length?this.owner.state.set("connected-to-battery",!0):this.owner.state.set("connected-to-battery",!1)}this.checkIfConnected=!1},"simulation-stopped":function(){this.playedMessage=!1,t=!1}},methods:{destroy:function(){this.owner.triggerEvent("piece-removed",this.owner.type),this.allBatteries=null,this.myBatteries=null}},publicMethods:{drainBattery:function(e){var i=0;for(i=0;i<this.myBatteries.length;i++)if(this.myBatteries[i].drain(e))return!0;return this.myBatteries.length>0&&(this.playedMessage||(this.owner.parent.triggerEvent("rl-play-battery-is-dead"),this.playedMessage=!0),t||(t=!0,this.owner.triggerEvent("battery-dead-sfx"))),!1},chargeBattery:function(e){var i=0;for(i=this.myBatteries.length-1;i>=0;i--)if(this.myBatteries[i].charge(e))return t=!1,!0;return!1}}})}(),function(){"use strict";var t=include("PIXI.filters.ColorMatrixFilter");platypus.createComponentClass({id:"Desaturator",publicProperties:{disabled:!1},initialize:function(){var e=null,i=this.owner.container;this.colorMatrix=e=new t,i.filters=[e],e.blackAndWhite(),e.enabled=!1,this.wasDisabled=!0,this.checkDisabled()},events:{"handle-logic":function(){this.checkDisabled()},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1}},methods:{checkDisabled:function(){this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.colorMatrix.enabled=!this.disabled)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.destroy");platypus.createComponentClass({id:"DustParticleLogic",properties:{lifetime:700,direction:-1},publicProperties:{maxOpacity:1},initialize:function(){this.owner.opacity=this.owner.opacity||0,this.oX=0,this.fadeIn=!1,this.fadeOut=!1,this.fadeSpeed=250,this.inStorm=!0,this.force=new t(.2*this.direction,0),this.maxVelocity=55*this.direction,this.bouncesLeft=10},events:{"handle-logic":function(t){var e=t.delta,i=0;this.inStorm||(this.direction>0?this.owner.body.GetLinearVelocity().get_x()<this.maxVelocity&&this.owner.body.ApplyForce(this.force,this.owner.body.GetWorldCenter()):this.owner.body.GetLinearVelocity().get_x()>this.maxVelocity&&this.owner.body.ApplyForce(this.force,this.owner.body.GetWorldCenter()),this.fadeIn?(this.owner.opacity+=e/this.fadeSpeed,this.owner.opacity>=this.maxOpacity&&(this.owner.opacity=this.maxOpacity,this.fadeIn=!1)):this.fadeOut?(this.owner.opacity-=e/this.fadeSpeed,this.owner.opacity<=0&&(this.owner.opacity=0,this.fade=!1,this.owner.triggerEvent("reset"))):(i=Math.abs(this.owner.x-this.oX),this.lifetime<=i&&(this.fadeOut=!0)))},blow:function(i){var s=new t(i*this.direction,0);this.owner.body.SetLinearVelocity(s),e(s),this.inStorm=!1,this.owner.body.SetActive(!0),this.owner.body.SetAwake(!0),this.fadeIn=!0,this.maxVelocity=i*this.direction,this.oX=this.owner.x},reset:function(){this.fadeOut=!1,this.inStorm=!0,this.owner.x=0,this.owner.y=-1e3,this.owner.opacity=0,this.owner.orientation=0,this.owner.body.SetActive(!1),this.owner.body.SetAwake(!1),this.bouncesLeft=10,this.owner.storm.triggerEvent("return-to-storm",this.owner)},"hit-something":function(){this.bouncesLeft--,this.bouncesLeft<=0&&(this.fadeOut=!0)},"simulation-stopped":function(){this.inStorm||this.owner.triggerEvent("reset")}},methods:{destroy:function(){e(this.force)}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Entity"),e=Math.floor(15);platypus.createComponentClass({id:"DustStormLogic",properties:{direction:1,offsetUnit:-2,stormLength:7e3,introOutroLength:3e3,interval:50,velocity:55},publicProperties:{startOn:!1},initialize:function(){this.stormState="off",this.simulating=!1,this.availableParticles=[],this.availableClouds=[],this.cloudInterval=0,this.thingsToHit=Array.setUp(this.owner,this.owner,this.owner,this.owner,this.owner),this.hitDex=0,this.introOutroTime=0,this.stormTime=0,this.timer=0,this.yOffsets=[.1,-1.4,2.8,-1.5,1,-2.1,2,-1.6,2.6,-.3,1.4,-1.8,.4,-1.3,3,-2.3,.6,-2.2,1.6,-.9,1.9,-2,2.4,-1.8,.5,-.7,1.1,-1.7,1.2,-2.5,2.9,-1.3,1.7,-.8,2.7],this.offsetIndex=0,this.velocityOffsets=[1.1,.6,1,.5,1.2,1.5,.8,1.1,.9,1.3,1,.9,.8,1.2,1,.7,1.4,.8,1.2,1.1,1],this.inFront=!1,this.specialCloudCount=0,this.specialCloudEvery=8,this.specialCloudIndex=0,this.startTime=0},events:{"peer-entity-added":function(t){t.movable&&this.thingsToHit.push(t)},"peer-entity-removed":function(t){var e=0;t.movable&&(e=this.thingsToHit.indexOf(t))>=0&&this.thingsToHit.greenSplice(e)},"camera-update":function(t){this.owner.x=t.viewport.x,this.owner.y=t.viewport.y,this.owner.height=t.viewport.height},"handle-logic":function(t){var e=null,i=null,s=.5,n=null,o=0,r=0,a=0,h=t.delta,l=!1;"off"!==this.stormState&&("starting"===this.stormState?(this.introOutroTime=Math.min(this.introOutroLength,this.introOutroTime+h),this.introOutroTime===this.introOutroLength&&(this.stormState="on",this.stormTime=0,this.owner.triggerEvent("set-volume",1,"dust-storm")),r=this.introOutroTime/this.introOutroLength,this.owner.triggerEvent("set-volume",Math.min(2*r,1),"dust-storm")):"ending"===this.stormState?(this.introOutroTime=Math.max(.001,this.introOutroTime-h),.001===this.introOutroTime&&(this.stormState="off",l=!0),r=this.introOutroTime/this.introOutroLength,this.owner.triggerEvent("set-volume",Math.min(2*r,1),"dust-storm")):"on"===this.stormState&&(r=1,-1!==this.stormLength&&(this.stormTime=Math.min(this.stormLength,this.stormTime+h),this.stormTime===this.stormLength&&(this.stormState="ending",this.stormTime=0))),this.availableParticles.length>0&&(this.timer+=t.delta,this.timer>=this.interval/r&&(this.timer=0,a=this.velocity*this.velocityOffsets[this.offsetIndex%this.velocityOffsets.length],this.hitDex+=499,o=(n=this.thingsToHit[this.hitDex%this.thingsToHit.length]).y+this.yOffsets[this.offsetIndex]*this.offsetUnit*(n.height||64)/4,this.cloudInterval+=.75,this.cloudInterval>=1&&this.availableClouds.length>0&&(this.cloudInterval=0,(i=this.availableClouds.pop()).x=n.x+1e3*-this.direction,i.y=o,this.inFront=!this.inFront,s+=1.2*(this.yOffsets.length-this.yOffsets[this.offsetIndex])/this.yOffsets.length,i.scaleX=s,i.scaleY=s,i.maxOpacity=.5+.5*Math.random(),i.triggerEvent("blow",a),i.state.set("cloud-0",!1),i.state.set("cloud-1",!1),i.state.set("cloud-2",!1),i.state.set("cloud-3",!1),i.state.set("cloud-4",!1),i.state.set("cloud-5",!1),this.specialCloudCount++,this.specialCloudCount===this.specialCloudEvery?(this.specialCloudCount=0,i.state.set("cloud-"+this.specialCloudIndex,!0),this.specialCloudIndex++,this.specialCloudIndex>2&&(this.specialCloudIndex=0)):i.state.set("cloud-"+(Math.floor(3*Math.random())+3),!0)),(e=this.availableParticles.pop()).x=n.x+500*-this.direction,e.y=o,e.maxOpacity=.9,e.triggerEvent("mote-"+this.offsetIndex%4),e.triggerEvent("blow",a),this.offsetIndex++,this.offsetIndex>=this.yOffsets.length&&(this.offsetIndex=0))),l&&this.stopStorm())},"return-to-storm":function(t){this.simulating?"dust-particle"===t.type?this.availableParticles.push(t):this.availableClouds.push(t):this.owner.parent.removeEntity(t)},"start-the-wind":function(){var t=platypus.game.app;this.simulating&&("off"!==this.stormState&&"ending"!==this.stormState||("off"===this.stormState&&this.owner.triggerEvent("play-dust-storm"),this.stormState="starting",this.startTime=Date.now(),t.analyticsEmitter.windStarted(t.levelId||"",t.getRoverLocation())))},"end-the-wind":function(){this.simulating&&-1===this.stormLength&&(this.stormState="ending")},"simulation-started":function(){var t=0,i=null,s=null,n=null;for(this.simulating=!0,this.startOn&&this.owner.triggerEvent("start-the-wind"),t=0;t<20;t++)i={type:"dust-particle",properties:{direction:this.direction,x:0,y:-1e3,z:this.owner.z+.01*t,storm:this.owner}},s=this.owner.parent.addEntity(i),this.availableParticles.push(s);for(t=0;t<e;t++)i={type:"dust-cloud",properties:{direction:this.direction,x:0,y:-1e3,z:this.owner.z+1110+.01*t,storm:this.owner}},n=this.owner.parent.addEntity(i),this.availableClouds.push(n)},"simulation-stopped":function(){var t=0;for(this.simulating=!1,"off"!==this.stormState&&this.stopStorm(),t=0;t<this.availableClouds.length;t++)this.owner.parent.removeEntity(this.availableClouds[t]);for(this.availableClouds=[],t=0;t<this.availableParticles.length;t++)this.owner.parent.removeEntity(this.availableParticles[t]);this.availableParticles=[]},"chose-earth":function(){this.assignCloudsToPlanet("on-earth")},"chose-mars":function(){this.assignCloudsToPlanet("on-mars")}},methods:{assignCloudsToPlanet:function(t){for(var e=this.availableClouds,i=e.length;i--;)e[i].triggerEvent(t)},stopStorm:function(){var t=platypus.game.app,e=Date.now()-this.startTime;t.analyticsEmitter.windStopped(t.levelId||"",t.getRoverLocation(),e),this.started=!1,this.owner.triggerEvent("stop-audio","dust-storm"),this.cloudInterval=0,this.stormState="off",this.stormTime=0,this.introOutroTime=0,this.timer=0,this.offsetIndex=0,this.hitDex=0,this.owner.triggerEvent("wind-has-stopped")}},getAssetList:function(){for(var e=null,i=["dust-cloud","dust-particle"],s=i.length,n=Array.setUp();s--;)e=t.getAssetList({type:i[s]}),n.union(e),e.recycle();return n}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"FindMovables",properties:{useNodes:!1},initialize:function(){this.activeEntities=null},events:{"handle-logic":function(t){this.activeEntities=t.entities},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&(t.invalid=!0)},pointerdown:function(){var e=this.activeEntities,i=e.length,s=null;for(this.owner.parent.triggerEvent("rl-play-cannot-drag");i--;)(s=e[i]).movable&&("number"!=typeof s.opacity&&(s.opacity=1),t.get(s).to({opacity:.01},350).to({opacity:1},350).to({opacity:.01},350).to({opacity:1},350).to({opacity:.01},350).to({opacity:1},350))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off")},"restore-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-on")}}})}(),function(){"use strict";platypus.createComponentClass({id:"FinishLineSydney",properties:{},publicProperties:{},initialize:function(){this.lakitu=null,this.simulating=!1,this.haveWaved=!1,this.haveFlagged=!1},events:{"peer-entity-added":function(t){"lakitu"===t.type&&(this.lakitu=t)},"scene-live":function(){"earth"===this.owner.parent.planet||void 0===this.owner.parent.planet?this.owner.triggerEvent("change-skin","space scouts"):this.owner.triggerEvent("change-skin","space suits")},"handle-logic":function(){this.simulating||!this.haveWaved&&this.lakitu.x>this.owner.x-256&&this.lakitu.x<this.owner.x+256&&(this.haveWaved=!0,this.owner.triggerEvent("hello"))},finished:function(t){var e=Math.floor(4*Math.random());"cockpit"===t.entity.type&&this.simulating&&(this.haveFlagged||(this.owner.triggerEvent("play-celebrate-"+e),this.haveFlagged=!0,this.owner.triggerEvent("wave-flag")))},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.simulating=!1,this.haveWaved=!1,this.haveFlagged=!1,this.owner.triggerEvent("idle")}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"GameMaster",properties:{},publicProperties:{lapLevelWidth:0,lapLevelHeight:0},initialize:function(){this.cockpit=null,this.finishedRace=!1,this.starCollected=!1,this.touring=!1,this.cameraHasUpdated=!1,this.simming=!1,this.forwardProgress=0,this.stalledTimer=1e4,this.helpLevel=-1,this.maxHelpLevel=-1,this.finishLine=null,platypus.game.app.getHint=function(){var t=this.helpLevel<=this.maxHelpLevel?this.helpLevel:-2;return-2===t?"play-help-max":"play-help-"+(t+1)}.bind(this)},events:{"world-loaded":function(t){this.lapLevelWidth=t.width,this.lapLevelHeight=t.height},"child-entity-added":function(t){"cockpit"===t.type?this.cockpit=t:"finish-line"===t.type&&(this.finishLine=t)},"camera-update":function(){this.cameraHasUpdated||(this.cameraHasUpdated=!0,this.owner.triggerEvent("show-me-the-level"))},tick:function(t){var e=t.delta;this.simming&&!this.finishedRace&&(this.stalledTimer-=e,this.stalledTimer<=0&&(this.stalledTimer=2e4,this.owner.triggerEvent("rl-play-reset-hint")))},"simulation-started":function(){this.simming=!0,this.cockpit&&this.owner.triggerEvent("rl-focus-on",this.cockpit)},"simulation-stopped":function(){this.simming=!1,this.finishedRace=!1,this.owner.triggerEvent("rl-focus-on","start"),this.stalledTimer=1e4},"crossed-finish-line":function(){this.finishedRace||(this.finishedRace=!0,this.owner.triggerEvent("level-complete"))},"see-course-tour":function(t){"boolean"!=typeof t&&(t=!1),this.owner.triggerEvent("rl-start-course-tour",t)},"skip-course-tour":function(){this.owner.triggerEvent("rl-stop-course-tour")},"tour-started":function(){this.touring=!0,this.owner.triggerEvent("drop-dragged")},"tour-stopped":function(){this.touring=!1},"star-collected":function(){this.starCollected=!0},"forward-progress-report":function(t){this.owner.levelProgress=Math.min(t/this.finishLine.x,1),this.forwardProgress=t,this.stalledTimer=1e4},"report-help-level":function(t){t>=this.maxHelpLevel&&(this.maxHelpLevel=t)},"request-help":function(){this.helpLevel<=this.maxHelpLevel?(this.owner.triggerEvent("rl-reveal-help",this.helpLevel),this.helpLevel++):this.owner.triggerEvent("rl-reveal-help",-2)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=3009,e=3011;platypus.createComponentClass({id:"HelpPiece",properties:{help:0,forTutorial:!1,revealed:!1},publicProperties:{},initialize:function(){this.forTutorial?(this.owner.z=e,e+=1e-4):(this.owner.z=t,t+=1e-4),this.revealed&&(this.owner.opacity=1),this.owner.z+=4e3},events:{adopted:function(){this.owner.parent.triggerEvent("report-help-level",this.help)},"reveal-help":function(t){t===this.help||-2===t&&!this.forTutorial?this.owner.triggerEvent("reveal"):t>this.help&&(this.owner.opacity=.4)},"simulation-started":function(){this.owner.triggerEvent("hide")}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"HintSheetLogic",properties:{hint:"hint-0"},publicProperties:{},initialize:function(){this.owner.state.set(this.hint,!0)},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ImpactAudio",properties:{variations:0,minAudibleSpeed:15,maxAudibleSpeed:50,maxVolume:1},publicProperties:{},initialize:function(){this.soundSpecs={volume:1,pan:0},this.simulating=!1,this.cameraPosition=t.setUp(),this.soundInterval=0,this.interval=85,this.panRange=0},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.25*this.cameraPosition.width,2)},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.simulating=!1},"handle-logic":function(t){var e=t.delta;this.soundInterval>0&&(this.soundInterval=Math.max(0,this.soundInterval-e))},"hit-something":function(t){var e=0,i=Math.floor(Math.random()*this.variations),s=0,n=null,o=null,r=this.cameraPosition,a=0,h=0,l=0;this.simulating&&0===this.soundInterval&&(n=t.contact.GetManifold().get_localNormal(),o=this.owner.body.GetLinearVelocity(),a=Math.pow(this.owner.x-r.x,2)+Math.pow(this.owner.y-r.y,2),h=Math.max(1-a/this.panRange,0),0===n.get_x()&&0===n.get_y()&&(n.set_x(this.owner.x-t.entity.x),n.set_y(this.owner.y-t.entity.y),n.Normalize()),s=(e=Math.abs(n.get_x()*o.get_x()+n.get_y()*o.get_y()))<this.minAudibleSpeed?0:Math.min(e/this.maxAudibleSpeed,1)*this.maxVolume*h,l=this.owner.x>r.right?1:this.owner.x<r.left?-1:(this.owner.x-r.left)/r.width*2-1,this.soundSpecs.volume=s,this.soundSpecs.pan=l,this.owner.triggerEvent("impact-"+i,this.soundSpecs),this.soundInterval=this.interval)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),s=e?[{type:"level-complete-dialog-without-sunspot"},{type:"tutorial-entity-without-sidney"}]:[{type:"level-complete-dialog"},{type:"camera-flash"},{type:"magnifying-glass"},{type:"magnification-dialog"},{type:"magnification-dialog-blind"},{type:"badge-notifier"},{type:"tutorial-entity"}];platypus.createComponentClass({id:"IOS935",events:{load:function(){for(var t=s.length,e=this.owner;t--;)e.addEntity(s[t])}},getAssetList:function(){for(var t=Array.setUp(),e=null,n=s.length;n--;)e=i.getAssetList(s[n]),t.union(e),e.recycle();return t}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.helpers.getUserData"),i=Math.PI/4;platypus.createComponentClass({id:"JointWatcher",properties:{enactStress:!0,stressModifiers:null},publicProperties:{},initialize:function(){this.watchJoints=!1,this.jointClusters=Array.setUp(),this.stressSignals=Array.setUp(),this.stressSignalsToRemove=Array.setUp(),this.firstBreak=!0,this.ignoreBreaks=!1,this.breakCounter=0,this.firstPass=!0,this.usesAnchors=!1,this.stageWidth=0,this.stageHeight=0,this.stressModifiers?this.modify=this.modifiedStress.bind(this,this.stressModifiers):this.modify=this.unmodifiedStress.bind(this)},events:{"world-loaded":function(t){this.stageWidth=t.width,this.stageHeight=t.height},"logic-tick":function(){var t=0,e=0;if(this.stressSignalsToRemove.length){for(t=this.stressSignalsToRemove.length-1;t>=0;t--)for(e=this.stressSignals.length-1;e>=0;e--)if(this.stressSignalsToRemove[t]===this.stressSignals[e]){this.owner.removeEntity(this.stressSignals.splice(e,1)[0]);break}this.stressSignalsToRemove.length=0}},"after-box2d-update":function(i,s){var n=0,o=0,r=0,a=null,h=null,l=null,p=null,c=null,u=null,d=[],g=null,m=null,y=null,f=0,w=1,v=0,b=0,x=0,E=null,C=null,S=0,A=0,k=null,P=null;if(this.enactStress&&this.watchJoints){for(n=this.jointClusters.length-1;n>=0;n--){for(a=this.jointClusters[n],h=t.setUp(),o=0;o<a.length;o++)p=(c=a[o]).joint,0===o&&(S=30*(p.GetAnchorA().get_x()+p.GetAnchorB().get_x())/2,A=30*(p.GetAnchorA().get_y()+p.GetAnchorB().get_y())/2,this.stressSignals.length&&(this.stressSignals[n].x=S,this.stressSignals[n].y=A)),h[c.entityA.id]||(h[c.entityA.id]=Array.setUp(0,0,0)),h[c.entityB.id]||(h[c.entityB.id]=Array.setUp(0,0,0)),"number"==typeof c.stressValues.angle&&(C=e(p),!this.firstPass||"piston-beam"!==c.entityA.type&&"piston-beam"!==c.entityB.type||(C.oAngle=p.GetJointAngle()),w=(f=p.GetJointAngle()-C.oAngle)>0?1:-1,"piston-beam"===c.entityA.type||"piston-beam"===c.entityB.type?p.SetMotorSpeed(Math.max(-.25,-10*Math.pow(f,2))*w):p.SetMotorSpeed(-20*w*Math.pow(f,2)),v=Math.min(Math.abs(f)/c.stressValues.angle,1),h[c.entityA.id][2]=Math.max(v,h[c.entityA.id][2]),h[c.entityB.id][2]=Math.max(v,h[c.entityB.id][2])),"number"==typeof c.stressValues.reaction&&(b=c.joint.GetReactionForce(1/s).Length(),b=Math.min(this.modify(b,c.entityA.jointType,c.stressValues.reaction),this.modify(b,c.entityB.jointType,c.stressValues.reaction),1),h[c.entityA.id][0]=Math.max(b,h[c.entityA.id][0]),h[c.entityB.id][0]=Math.max(b,h[c.entityB.id][0])),"number"==typeof c.stressValues.distance&&(x=Math.pow(p.GetAnchorA().get_x()-p.GetAnchorB().get_x(),2)+Math.pow(p.GetAnchorA().get_y()-p.GetAnchorB().get_y(),2),x/=c.stressValues.distance,x=Math.min(1,x),h[c.entityA.id][1]=Math.max(x,h[c.entityA.id][1]),h[c.entityB.id][1]=Math.max(x,h[c.entityB.id][1]));for(u in h)1!==h[u][0]&&1!==h[u][1]&&1!==h[u][2]||(d.push(u),this.firstBreak&&!this.ignoreBreaks&&(this.owner.triggerEvent("rover-broke"),this.firstBreak=!1,this.breakCounter-=1,this.breakCounter<=0&&(this.breakCounter=6,"wheel"===c.entityA.type||"wheel-small"===c.entityA.type||"wheel-powered"===c.entityA.type||"wheel"===c.entityB.type||"wheel-small"===c.entityB.type||"wheel-powered"===c.entityB.type?this.owner.triggerEvent("rl-play-broke-wheel"):this.owner.triggerEvent("rl-play-broke-rover")))),this.stressSignals.length&&this.stressSignals[n].triggerEvent("stress",Math.max(Math.max(h[u][2],h[u][0]),h[u][1]));for(l in h)h[l].recycle();for(h.recycle(),o=0;o<d.length;o++)for(g=d[o],r=a.length-1;r>=0;r--)m=a[r].entityA.id,y=a[r].entityB.id,m!==g&&y!==g||(k=a[r].entityA.type,P=a[r].entityB.type,platypus.game.app.analyticsEmitter.roverBroke(platypus.game.app.levelId||"",platypus.game.app.getRoverLocation(),k),"wheel"!==k&&"wheel-powered"!==k&&"wheel-small"!==k&&"rocket"!==k&&"h-rocket"!==k&&"tread"!==k||a[r].entityA.state.set("axeled",!1),"wheel"!==P&&"wheel-powered"!==P&&"wheel-small"!==P&&"rocket"!==P&&"h-rocket"!==P&&"tread"!==P||a[r].entityB.state.set("axeled",!1),this.owner.world.DestroyJoint(a[r].joint),a[r].entityA=null,a[r].entityB=null,a[r].joint=null,a.splice(r,1));d.length&&(this.owner.triggerEvent("joint-broke"),this.owner.triggerEvent("play-break"),E={type:"explosion",properties:{x:S,y:A,z:3110}},this.owner.addEntity(E)),d=[],0===a.length&&(this.jointClusters.splice(n,1),this.stressSignals.length&&this.stressSignalsToRemove.push(this.stressSignals[n]))}this.firstPass=!1}},"simulation-started":function(){this.watchJoints=!0,this.usesAnchors&&this.owner.triggerEvent("uses-anchors")},"simulation-stopped":function(){var t=null,e=this.jointClusters,i=e.length,s=0,n=this.owner,o=this.stressSignals,r=this.stressSignalsToRemove,a=n.world;for(this.usesAnchors=!1;i--;)for(s=(t=e[i]).length;s--;)a.DestroyJoint(t[s].joint);for(i=o.length;i--;)r.push(o[i]);this.owner.triggerEvent("watched-joints-removed"),e.length=0,this.owner.triggerEvent("normal-mo"),this.watchJoints=!1,this.firstBreak=!0,this.firstPass=!0,this.ignoreBreaks=!1},"level-complete":function(){this.ignoreBreaks=!0},"add-joint-cluster":function(t,s,n){var o=0,r=[],a=null,h=null,l=null,p=null;for("default"===s.angle&&(s.angle=i),"default"===s.reaction&&(s.reaction=60),"default"===s.distance&&(s.distance=.8),o=0;o<t.length;o++)r[o]={},r[o].stressValues=s,r[o].joint=t[o],r[o].entityA=e(t[o].GetBodyA()).entity,r[o].entityB=e(t[o].GetBodyB()).entity,l=r[o].entityA.type,p=r[o].entityB.type,"anchor"!==l&&"anchor"!==p||(this.usesAnchors=!0),"wheel"!==l&&"wheel-powered"!==l&&"wheel-small"!==l&&"rocket"!==l&&"h-rocket"!==l&&"tread"!==l||r[o].entityA.state.set("axeled",!0),"wheel"!==p&&"wheel-powered"!==p&&"wheel-small"!==p&&"rocket"!==p&&"h-rocket"!==p&&"tread"!==p||r[o].entityB.state.set("axeled",!0);r.length&&(this.jointClusters.push(r),n&&(a={type:"stress-signal",properties:{x:0,y:0,z:3020}},h=this.owner.addEntity(a),this.stressSignals.push(h)))}},methods:{destroy:function(){this.jointClusters.recycle(),this.jointClusters=null,this.stressSignals.recycle(),this.stressSignals=null,this.stressSignalsToRemove.recycle(),this.stressSignalsToRemove=null},modifiedStress:function(t,e,i,s){return e/(s*(t[i]||1))},unmodifiedStress:function(t,e,i){return t/i}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"LakituLogic",properties:{onPath:!0,startingTarget:""},publicProperties:{},initialize:function(){this.targets=[],this.path=[],this.following=null,this.transitionX=0,this.transitionY=0,this.owner.parent.triggerEvent("follow",{entity:this.owner,mode:"locked"})},events:{"scene-live":function(){0===this.targets.length&&this.owner.triggerEvent("quit-following")},"peer-entity-added":function(t){var e=0,i=!1;if("camera-target"===t.type)this.targets.push(t),t.name===this.startingTarget&&this.owner.triggerEvent("focus-on",t,!0);else if("camera-path-node"===t.type){for(e=0;e<this.path.length;e++)if(t.x<this.path[e].x){i=!0,this.path.splice(e,0,t);break}i||this.path.push(t)}},"handle-post-collision-logic":function(t){var e=this.owner.x,i=this.owner.y,s=null;this.following&&(e=this.following.x+this.transitionX,i=this.following.y+this.transitionY),this.onPath&&(e=(s=this.findPositionOnPath({x:e,y:i})).x,i=s.y),this.owner.x=e,this.owner.y=i},"focus-on":function(t,e){var i=0,s=null;if("string"==typeof t){for(i=0;i<this.targets.length;i++)if(this.targets[i].name===t){s=this.targets[i];break}}else s=t;s?(this.following=s,e?this.jumpTo(s):this.smoothTo(s)):(this.following=null,this.transitionX=0,this.transitionY=0)},"quit-following":function(){this.owner.parent.triggerEvent("follow",{mode:"static"})},"set-starting-target":function(t){this.startingTarget=t}},methods:{jumpTo:function(t){createjs.Tween.removeTweens(this.owner),this.transitionX=0,this.transitionY=0,this.owner.x=t.x,this.owner.y=t.y},smoothTo:function(t){createjs.Tween.removeTweens(this.owner),this.transitionX=this.owner.x-t.x,this.transitionY=this.owner.y-t.y,createjs.Tween.get(this).to({transitionX:0,transitionY:0},1e3,createjs.Ease.quadInOut)},findPositionOnPath:function(t){var e={x:t.x-192,y:t.y},i={x:t.x+192,y:t.y},s={x:0,y:0};return e=this.findPositionBetweenNodes(e),i=this.findPositionBetweenNodes(i),s.x=(e.x+i.x)/2,s.y=(e.y+i.y)/2,s},findPositionBetweenNodes:function(t){var e=0,i=null,s=null,n=null,o=0,r=0,a=0;for(e=0;e<this.path.length;e++)if(n=this.path[e],t.x>=n.x)i=n;else if(t.x<=n.x){s=n;break}return i&&s?(o=t.x-i.x,{x:(r=s.x-i.x)*(a=o/r)+i.x,y:(s.y-i.y)*a+i.y}):i?{x:i.x,y:i.y}:s?{x:s.x,y:s.y}:{x:0,y:0}}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPActionButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},e.getLayout())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPBadgeButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=platypus.badger.getBadgeStatusForLAP();e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},n)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPDwellTimer",publicProperties:{hover:!0},initialize:function(){this.camera=t.setUp(),this.time=-1,this.x=0,this.y=0,this.xs=0,this.ys=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(t){var e=t.delta;this.time>=0&&(this.time+=e,this.xs+=this.x*e,this.ys+=this.y*e)},pointerover:function(t){this.time=0,this.x=t.x,this.y=t.y,this.ys=0,this.xs=0},pointermove:function(t){this.x=t.x,this.y=t.y},pointerout:function(t){var e=platypus.game.app;t&&t.event&&"mouse"===t.event.pointerType&&this.time>=1e3&&e.analyticsEmitter.dwellTime(e.levelId||"",this.time>>0,this.owner.type,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.xs/this.time-this.camera.left>>0,y:this.ys/this.time-this.camera.top>>0}),this.time=-1}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPHelpButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=e.getLayout();e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},n,e.getHint(),e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPMotorActivate",properties:{activateEvent:"",deactivateEvent:"",direction:"right"},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.startTime=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},activate:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.activateEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.direction,window.getEntitiesByType("wheel-powered").length,t.entity?"click":"keyboard",e.getRoverLocation()),this.startTime=Date.now()},deactivate:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=Date.now()-this.startTime;e.analyticsEmitter[this.deactivateEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.direction,window.getEntitiesByType("wheel-powered").length,t.entity?"click":"keyboard",n,e.getRoverLocation())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPPlanetButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.owner.getNextPlanet())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPPointerEvent",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPRecycleButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=e.getLayout();e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},n,e.getResources(),e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPRocketActivate",properties:{activateEvent:"",deactivateEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.startTime=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},activate:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=window.getEntitiesByType("rocket"),o=window.getEntitiesByType("h-rocket"),r=n[0]||o[0];e.analyticsEmitter[this.activateEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},{up:n.length,forward:o.length},e.getRoverLocation(),r?r.getFuel():0),this.startTime=Date.now()},deactivate:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=Date.now()-this.startTime,o=window.getEntitiesByType("rocket"),r=window.getEntitiesByType("h-rocket"),a=o[0]||r[0];e.analyticsEmitter[this.deactivateEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},a?a.getFuel():0,{up:o.length,forward:r.length},t.entity?"click":"keyboard",n,e.getRoverLocation())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSail",properties:{activateEvent:"",deactivateEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.startTime=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},activate:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;window.getEntitiesByType("rocket");e.analyticsEmitter[this.activateEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},!0,window.getEntitiesByType("sail").length,t.entity?"click":"keyboard",-1,e.getRoverLocation()),this.startTime=Date.now()},deactivate:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,n=Date.now()-this.startTime;e.analyticsEmitter[this.deactivateEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},!1,window.getEntitiesByType("sail").length,t.entity?"click":"keyboard",n,e.getRoverLocation())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSavedGame",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](e.levelId||"",{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0},this.owner.totalSaves)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSelectLevel",properties:{lapEvent:""},publicProperties:{level:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent](this.level,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:s-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=Date.now().toString(16),i=function(t,e,i,s,n,o){for(var r=null,a=e.length,h=[],l=[];a--;)(r=e[a]).destroyed||(r.savable?l.push({part_type:r.type,mini_game:r.miniGame||t.name,location:"number"==typeof r.x&&"number"==typeof r.y?{x:r.x,y:r.y}:null}):r.isObstacle&&h.push(r.type));0===h.length&&h.push(t.levelId+"-obstacle"),t.analyticsEmitter.simulationStop(t.levelId||"",n,s||1===i,o,!s&&1!==i,t.getRoverLocation(),i,t.getEnlearnData({obstacle_types:h,parts:l}))};platypus.createComponentClass({id:"LevelCompleter",properties:{},publicProperties:{levelId:"",levelProgress:0,next:""},initialize:function(e,i){var s=platypus.game.app,n=4;this.alreadyAttempted=!1,this.camera=t.setUp(),this.completedLevels=null,this.newlyCompleted=null,this.unbrokenLevels=[],this.smallCarLevels=[],this.noWheelsLevels=[],this.simming=!1,this.owner.parent.app.userData.read("Completed-Levels",function(t){this.completedLevels=t||[],0===--n&&i()}.bind(this)),s.getLayout=function(){return function(t,e){for(var i=platypus.game.app,s=null,n=null,o=t.length,r=[],a=["block-1x1","block-1x2","block-2x1","block-2x2","block-3x1","cockpit","nose-cone","tail-fin","battery","solar-panel","h-rocket","rocket","sail","tread","wheel-powered","wheel-small-axeled","wheel-small","wheel"];o--;)(s=t[o]).destroyed||-1===a.indexOf(s.type)||s.savable&&!e&&!s.inBuildingArea||(n={name:s.type,position:{x:s.x-i.buildingRegion.x>>0,y:s.y-i.buildingRegion.y>>0,build_w:i.buildingRegion.width>>0,build_h:i.buildingRegion.height>>0}},r.push(n));return r}(this.owner.entities,this.simming)}.bind(this),this.roundTime=Date.now(),this.testTime=0,this.buildTime=0,this.failedAttempts=0,this.badgesEarned=[],this.savedGame=!1,platypus.game.app.userData.read("Unbroken-Levels",function(t){t?this.unbrokenLevels=t:platypus.game.app.userData.write("Unbroken-Levels",this.unbrokenLevels),0===--n&&i()}.bind(this)),platypus.game.app.userData.read("Small-Car-Levels",function(t){t?this.smallCarLevels=t:platypus.game.app.userData.write("Small-Car-Levels",this.smallCarLevels),0===--n&&i()}.bind(this)),platypus.game.app.userData.read("No-Wheels-Levels",function(t){t?this.noWheelsLevels=t:platypus.game.app.userData.write("No-Wheels-Levels",this.noWheelsLevels),0===--n&&i()}.bind(this)),this.collectedStar=!1,this.roverBroke=!1,this.beatTheLevel=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"scene-loaded":function(t){var e=t.level;this.savedGame="string"!=typeof e},"world-loaded":function(){var t=platypus.game.app;t.levelId=this.levelId||"unspecified",t.levelInstanceId=(this.levelId||"unspecified")+"-"+Date.now().toString(16),t.getEnlearnData=function(i){var s="",n={mini_game_instance_id:e,level_id:t.levelId,level_instance_id:t.levelInstanceId};if(i)for(s in i)i.hasOwnProperty(s)&&(n[s]=i[s]);return n},t.analyticsEmitter.startRound(t.levelId||"",t.getResources(),this.savedGame,t.getEnlearnData()),t.googleAnalytics.event(t.name,"Enter-"+t.levelId),this.buildTime=Date.now()},"pre-simulation-stopped":function(){this.savedLayoutForLAP=platypus.game.app.getLayout(),this.simming=!1},"simulation-stopped":function(){var t=platypus.game.app,e=this.levelProgress||0;1!==e&&(this.failedAttempts+=1),platypus.badgeVOCollection=null,this.alreadyAttempted||i(t,this.owner.entities.greenSlice(),e,this.alreadyAttempted,this.savedLayoutForLAP,this.LAPFarthestLocation),this.savedLayoutForLAP=null,this.alreadyAttempted=!1,this.starCollected=!1,this.roverBroke=!1,this.buildTime=Date.now(),this.beatTheLevel||t.googleAnalytics.event(t.name,"TestFinish-"+t.levelId,"TestTime",this.buildTime-this.testTime>>0),this.beatTheLevel=!1},"simulation-started":function(){var t=platypus.game.app;this.simming=!0,this.LAPFL=0,this.LAPFarthestLocation=platypus.game.app.getRoverLocation(),this.testTime=Date.now(),t.googleAnalytics.event(t.name,"BuildFinish-"+t.levelId,"BuildTime",this.testTime-this.buildTime>>0)},"begin-level-success-sequence":function(){var t,e=platypus.badger,s=this.levelId,n=this.owner,o=n.parent.app,r=o.userData,a=this.lastSuccess,h=0;if(platypus.badgeVOCollection=[],this.buildTime=Date.now(),o.googleAnalytics.event(o.name,"TestFinish-"+o.levelId,"TestTime",this.buildTime-this.testTime>>0),this.beatTheLevel=!0,e.increment("completed-"+s),this.alreadySecondSuccessed||e.badges.app[7].completed||(this.lastSuccess=JSON.stringify(this.owner.getSavedLevel()),a&&this.lastSuccess!==a&&(e.increment("second-success"),this.alreadySecondSuccessed=!0)),this.collectedStar&&e.increment("star-"+s),this.roverBroke||-1!==this.unbrokenLevels.indexOf(this.levelId)||(e.increment("no-breaks"),this.unbrokenLevels.push(this.levelId),platypus.game.app.userData.write("Unbroken-Levels",this.unbrokenLevels)),window.getEntitiesByType("block-1x1").length+window.getEntitiesByType("block-1x2").length+window.getEntitiesByType("block-2x1").length+window.getEntitiesByType("block-2x2").length+window.getEntitiesByType("block-3x1").length<=3&&-1===this.smallCarLevels.indexOf(this.levelId)&&(e.increment("small-car"),this.smallCarLevels.push(this.levelId),platypus.game.app.userData.write("Small-Car-Levels",this.smallCarLevels)),0===window.getEntitiesByType("wheel").length+window.getEntitiesByType("wheel-small").length+window.getEntitiesByType("wheel-powered").length+window.getEntitiesByType("wheel-small-axeled").length&&-1===this.noWheelsLevels.indexOf(this.levelId)&&(e.increment("no-wheels"),this.noWheelsLevels.push(this.levelId),platypus.game.app.userData.write("No-Wheels-Levels",this.noWheelsLevels)),(t=e.award())&&t.length){for(h=t.length;h--;)this.badgesEarned.push(t[h].name);this.owner.triggerEvent("rl-earned-badge",t)}i(o,n.entities.greenSlice(),1,this.alreadyAttempted,o.getLayout(),this.LAPFarthestLocation),this.alreadyAttempted=!0,n.triggerEvent("rl-show-level-complete-dialog"),-1===this.completedLevels.indexOf(s)&&(o.completedLevelCount+=1,this.completedLevels.push(s),this.newlyCompleted=s),r.write("Completed-Levels",this.completedLevels),r.write("Recently-Completed-Level",s),"level-select"===this.next?n.triggerEvent("rl-set-next-scene","level-select"):(n.triggerEvent("rl-set-next-scene","scene-level"),n.triggerEvent("rl-set-next-scene-data",{level:this.next}))},"play-badge-vo":function(){var t=platypus.game.app,e=0;!t.voPlayer.playing&&platypus.badgeVOCollection.length&&(e=Math.floor(Math.random()*platypus.badgeVOCollection.length),t.voPlayer.play(platypus.badgeVOCollection[e]),platypus.badgeVOCollection=null)},"star-collected":function(){this.collectedStar=!0},"rover-broke":function(){this.roverBroke=!0},"round-ended":function(){this.roundEnded(!0)},"round-ended-home":function(){this.roundEnded(!1)},tick:function(){var t=platypus.game.app,e=null,i=0,s=this.LAPFarthestLocation;this.simming&&(e=t.getRoverLocation(),(i=Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))>this.LAPFL&&(this.LAPFL=i,this.LAPFarthestLocation=e))}},methods:{roundEnded:function(t){var e=platypus.game.app,i=Date.now()-this.roundTime>>0,s=["e-sunspot-snap-tutorial","e-wheel-snap-tutorial","e-block-snap-tutorial","e-bumpy-hill","e-jump","e-pot-holes","e-hill-climb","e-climb-and-coast","l-plinko","l-hill-climb-pit-stop","l-solar-two","l-first-rocket","l-horizontal-rockets","l-rocket-steps","m-wind-storm","m-wind-storm-2","m-ceiling-rockets","m-back-and-forth","eur-ice-pond","eur-tread-two","eur-ice-and-rockets","eur-slip-and-slide"],n=[],o=0;t&&this.newlyCompleted&&(o=s.indexOf(this.newlyCompleted),s.length>o+1&&n.push(s[o+1])),e.analyticsEmitter[t?"endRound":"endRoundHome"](e.levelId||"",Date.now()-this.roundTime>>0,e.getLayout(),{unlocked_levels:n,badges_earned:this.badgesEarned},this.failedAttempts),e.googleAnalytics.event(e.name,(t?"Complete-":"Abandon-")+e.levelId,"LevelTime",i)},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"LevelSelectLakituLogic",properties:{startingTarget:"start"},publicProperties:{},initialize:function(){this.targets=[],this.zoom=1,this.owner.parent.triggerEvent("follow",{entity:this.owner,mode:"locked"})},events:{"scene-live":function(){0===this.targets.length&&this.owner.triggerEvent("quit-following")},"peer-entity-added":function(t){"camera-target"===t.type&&(this.targets.push(t),t.name===this.startingTarget&&this.jumpTo(t.x,t.y))},"focus-on":function(t,e){var i=0,s=null;if("string"==typeof t){for(i=0;i<this.targets.length;i++)if(this.targets[i].name===t){s=this.targets[i];break}}else s=t;s&&(e?this.jumpTo(s.x,s.y):this.smoothTo(s.x,s.y))},"quit-following":function(){this.owner.parent.triggerEvent("follow",{mode:"static"})},"set-starting-target":function(t){this.startingTarget=t}},methods:{jumpTo:function(t,e,i){i=i||this.zoom,createjs.Tween.removeTweens(this.owner),this.owner.x=t,this.owner.y=e,this.zoom=i},smoothTo:function(t,e,i){i=i||this.zoom,createjs.Tween.removeTweens(this.owner),createjs.Tween.get(this.owner).to({x:t,y:e,zoom:i},1e3,createjs.Ease.quadInOut)}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"LevelSelectManager",properties:{unlockMoon:"",unlockMars:"",unlockEuropa:"",unlockAll:""},publicProperties:{},initialize:function(t,e){var i=8;return this.progress=null,this.starProgress=null,this.introducedEarth=!1,this.completedEarth=!1,this.completedMoon=!1,this.completedMars=!1,this.completedAll=!1,this.lastPage=null,this.owner.parent.app.userData.read("Completed-Levels",function(t){this.progress=t,this.progress||(this.progress=[],this.owner.parent.app.userData.write("Completed-Levels",this.progress)),app.googleAnalytics.event(app.name,"EnterLevelSelect","CompletedLevels",this.progress.length),this.lsTime=Date.now(),0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Stars-Collected",function(t){this.starProgress=t,this.starProgress||(this.starProgress=[],this.owner.parent.app.userData.write("Stars-Collected",this.starProgress)),0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Introduced-Earth",function(t){this.introducedEarth=t,0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Completed-Earth",function(t){this.completedEarth=t,0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Completed-Moon",function(t){this.completedMoon=t,0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Completed-Mars",function(t){this.completedMars=t,0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Completed-All",function(t){this.completedAll=t,0===--i&&e()}.bind(this)),this.owner.parent.app.userData.read("Last-Page",function(t){t?this.lastPage=t:(this.lastPage="earth",this.owner.parent.app.userData.write("Last-Page",this.lastPage)),0===--i&&e()}.bind(this)),!0},events:{"child-entity-added":function(t){"earth-button"!==t.type&&"moon-button"!==t.type&&"mars-button"!==t.type&&"europa-button"!==t.type||(t.triggerEvent("set-persistent-scene-data",{level:t.level}),t.lapLevel=t.level,t.toUnlock&&-1===this.progress.indexOf(t.toUnlock)?(t.state.set("locked",!0),springroll.Debug||t.triggerEvent("disable")):-1!==this.progress.indexOf(t.level)?(t.state.set("complete",!0),-1!==this.starProgress.indexOf(t.level)&&t.state.set("starred",!0)):t.triggerEvent("pulse"))},"scene-loaded":function(t){this.introducedEarth?this.completedEarth||-1===this.progress.indexOf(this.unlockMoon)?this.completedMoon||-1===this.progress.indexOf(this.unlockMars)?this.completedMars||-1===this.progress.indexOf(this.unlockEuropa)?this.completedAll||-1===this.progress.indexOf(this.unlockAll)?(this.owner.triggerEvent("rl-play-level-prompt"),this.owner.triggerEvent("rl-set-starting-target",this.lastPage)):(this.owner.parent.app.userData.write("Completed-All",!0),this.owner.triggerEvent("rl-game-over-sequence"),this.owner.triggerEvent("rl-set-starting-target","europa")):(this.owner.parent.app.userData.write("Completed-Mars",!0),this.owner.triggerEvent("rl-unlock-europa-sequence"),this.owner.triggerEvent("rl-set-starting-target","mars")):(this.owner.parent.app.userData.write("Completed-Moon",!0),this.owner.triggerEvent("rl-unlock-mars-sequence"),this.owner.triggerEvent("rl-set-starting-target","moon")):(this.owner.parent.app.userData.write("Completed-Earth",!0),this.owner.triggerEvent("rl-unlock-moon-sequence")):(this.owner.parent.app.userData.write("Introduced-Earth",!0),this.owner.triggerEvent("rl-introduce-earth-sequence"))},"focus-on":function(t){this.lastPage=t,this.owner.parent.app.userData.write("Last-Page",this.lastPage)}},methods:{destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitLevelSelect","LevelSelectTime",Date.now()-this.lsTime>>0)}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Entity");platypus.createComponentClass({id:"ListItem",properties:{infinite:!1,opacity:1},publicProperties:{count:1,z:0,spawns:""},initialize:function(e){this.item=this.owner.item||e.item,this.generatedItem=!1,this.dragging=!1,this.readyToDrag=null,this.pointerIsDown=!1,this.show=this.owner.left,this.hide=-this.owner.left,this.motion=t.setUp("x",0,"y",0),this.owner.state.set("infinite",this.infinite),this.updateCount(this.count)},events:{"increase-count":function(){this.updateCount(this.count+1)},"decrease-count":function(){this.updateCount(this.count-1)},"item-returned":function(t){t===this.spawns&&this.updateCount(this.count+1)},pointerdown:function(t){this.readyToDrag=!0,this.motion.x=t.x,this.motion.y=t.y,this.pointerIsDown=!0},pointermove:function(t){var e=0,i=0;this.pointerIsDown&&!this.generatedItem&&(this.readyToDrag?(e=Math.abs(this.motion.x-t.x),i=Math.abs(this.motion.y-t.y),this.owner.parent.scrollable?2*e>i&&e>7?this.createEntity(t)||(this.readyToDrag=!1,this.scroll(t)):i>2*e&&i>7&&(this.readyToDrag=!1,this.scroll(t)):this.createEntity(t)):this.scroll(t))},pointerup:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointerupoutside:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointercancel:function(t){this.scrolling&&(this.owner.parent.triggerEvent("end-swipe",t),this.scrolling=!1),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{createEntity:function(t){return!!this.count&&(this.generatedItem=!0,this.owner.triggerEvent("generate-item",t),this.owner.triggerEvent("decrease-count"),this.dragging=!0,!0)},scroll:function(t){this.owner.parent.triggerEvent("swipe",t),this.scrolling=!0},updateCount:function(t){var e="";this.infinite||(t>0?(e+=t,this.owner.opacity=1):0===t&&(e="0",this.owner.opacity=.2),this.count=t,this.owner.triggerEvent("set-text",e))}},getAssetList:function(t,i,s){var n=t.spawns||i.spawns||s&&s.spawns;return n?e.getAssetList({type:n}):Array.setUp()}})}(),function(){"use strict";platypus.createComponentClass({id:"LogicSeeCourseButton",properties:{},publicProperties:{},initialize:function(){this.owner.state.set("touring",!0)},events:{"tour-started":function(){this.owner.state.set("touring",!0)},"tour-stopped":function(){this.owner.state.set("touring",!1)},pressed:function(){this.owner.state.get("touring")?this.owner.triggerEvent("rl-skip-course-tour"):this.owner.triggerEvent("rl-see-course-tour")}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Vector");platypus.createComponentClass({id:"Magnifier",properties:{offsetX:56,offsetY:-61},publicProperties:{dragging:!1},initialize:function(){this.details=platypus.game.app.config["magnify-list"],Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.sensorState=!1,this.groupMovement=null,this.locked=!1,this.ignoreInput=!1,this.top=this.owner.top,this.left=this.owner.left,this.detail=null,this.detailEntity=null,this.wentOutsideTheScreen=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(){var t=null,e=this.camera,s=null,n=null,o=this.owner,r=o.parent,a=null,h=o.parent.parent.layers,l=o.state,p=this.vector,c=null,u=null,d=null,g=h.length,m=0,y=0;if(l.get("focus")&&l.set("focus",!1),p&&l.get("dragging")){for(this.detail=null,p=i.setUp(p.x+this.offsetX,p.y+this.offsetY),m=0;m<g;m++)if((a=h[m])!==r&&(c=a.windowToWorld(r.worldToWindow(p)),y=(t=a.getEntitiesAtPoint?a.getEntitiesAtPoint(c.x,c.y):this.getEntitiesAtPoint(a,c.x,c.y)).length)){for(;y--;)n=t[y],(s=this.details[n.spawns||n.type])&&(l.set("focus",!0),this.detail=s,u=a.windowToWorld(r.worldToWindow(i.setUp(e.left,e.top))),d=a.windowToWorld(r.worldToWindow(i.setUp(e.width,e.height))),this.detailEntity={stage_w:d.x>>0,stage_h:d.y>>0,x:n.x-u.x>>0,y:n.y-u.y>>0},this.time=Date.now(),u.recycle(),d.recycle());if(s)break}p.recycle()}},pointerdown:function(t){var i=null;this.owner.parent.zooming||this.locked?this.ignoreInput=!0:(this.dragged=!1,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick?(this.ignoreInput=!0,this.stickyClick(t),this.stickyClick=null):(i=function(t){var i=this.camera,s=this.owner.container.parent.transform.worldTransform,n=e.setUp("event",t.data.originalEvent,"pixiEvent",t,"x",t.data.global.x/s.a+i.left,"y",t.data.global.y/s.d+i.top,"entity",this.owner);this.continueInputMovement(n),n.recycle()}.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",i),this.stickyClick=function(t,e){this.owner.container.removeListener("pointermove",t),e&&this.endInputMovement(e)}.bind(this,i))):this.startInputMovement(t))},pointermove:function(t){this.ignoreInput||this.vector.x===t.x&&this.vector.y===t.y||(this.dragged=!0,this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.continueInputMovement(t))},pointerup:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointerupoutside:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointercancel:function(t){this.vector&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t))},"unlock-magnifying-glass":function(){var t=this.owner;t.top=this.top,t.left=this.left,this.locked=!1,t.state.set("dragging",!1),this.dragging=!1},hide:function(){var t=platypus.game.app;this.detail&&(t.analyticsEmitter.closeMagnificationDialog(t.levelId,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,!t.voPlayer.playing,Date.now()-this.time>>0,t.getEnlearnData()),this.detail=null,this.detailEntity=null),this.time=0},"ui-simulation-started":function(){this.owner.left=this.left=20},"ui-simulation-stopped":function(){this.owner.left=this.left=220},"tour-started":function(){this.owner.left=this.left=20},"tour-stopped":function(){this.owner.left=this.left=220}},methods:{getEntitiesAtPoint:function(e,i,s){for(var n=t.setUp(),o=Array.setUp(),r=e.entities,a=null,h=r.length;h--;)a=r[h],n.setAll(a.x||0,a.y||0,a.width||0,a.height||0),n.containsPoint(i,s)&&o.push(a);return n.recycle(),o},startInputMovement:function(t){var e=this.owner;this.vector&&this.vector.recycle(),this.vector=i.setUp(t.x,t.y),e.parent.triggerEvent("pause-zooming"),this.dragging=!0},continueInputMovement:function(t){var e=this.owner,i=e.state;this.dragging&&!i.get("dragging")&&(i.set("dragging",!0),e.triggerEvent("magnifying"),this.owner.top=null,this.owner.left=null),void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.detail=null,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),this.vector&&(this.vector.x=t.x,this.vector.y=t.y),e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endInputMovement:function(t){var e=platypus.game.app,i=this.owner,s=this.detail,n="";this.continueInputMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,i.parent.triggerEvent("unpause-zooming"),s?(e.analyticsEmitter.magnifyAnEntity(e.levelId,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,this.detailEntity),i.triggerEvent("send-title",s.title),i.triggerEvent("set-photo",s.id),i.triggerEvent("show-magnification"),platypus.game.app.voPlayer.play(s["vo-id"]||"mag-"+s.id),"cracker-a"!==(n=s.id)&&"cracker-b"!==n&&"cracker-c"!==n&&"cracker-d"!==n||(n="cracker"),platypus.badger.increment("inspected-"+n),this.time=Date.now()):i.triggerEvent("early-reset-magnification")},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"MagnifierPhotoSetter",initialize:function(){this.photos=platypus.game.app.config["magnify-list"]},events:{"set-photo-id":function(t){var e=this.photos[t],i=platypus.modifyAllAssets;this.scale||(this.scale=function(t){for(var e=t.length;e--;)if(1===t[e].offsetZ)return t[e].sprite.scale}(this.owner.components)),e&&(this.owner.triggerEvent(e.image),e.credit&&(this.scale.x=i,this.scale.y=i,e["image-title"]?"*"+e["image-title"]+"* by ":"This photo is by ",e.credit+" at "+e.link),e.scale?(this.scale.x=+e.scale*i,this.scale.y=+e.scale*i):(this.scale.x=i,this.scale.y=i))}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Motor",properties:{accel:40,damping:.8,isTread:!1,batteryDrain:.0013},publicProperties:{},initialize:function(){this.simulationStarted=this.isTread||!1,this.torque=0,this.direction=0,this.wheelSounding=!1,this.wheelAudioLevel=0,this.owner.state.set("powered",!1),"moon"===this.owner.parent.planet?this.accel=62:"mars"===this.owner.parent.planet||"europa"===this.owner.parent.planet&&(this.accel=40),this.isTread?this.connector=this.owner.tread:this.connector=this.owner,this.cameraPosition=t.setUp(),this.panRange=0},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.15*this.cameraPosition.width,2)},load:function(){this.torque=this.owner.body.GetMass()*this.accel*(this.owner.radius/30)},"simulation-started":function(){this.simulationStarted=!0},"simulation-stopped":function(){this.simulationStarted=!1},"motor-cw-start":function(){this.connector.state.get("connected-to-battery")&&(this.direction=1,this.owner.body.SetAngularDamping(this.damping))},"motor-cw-stop":function(){this.connector.state.get("connected-to-battery")&&1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"motor-ccw-start":function(){this.connector.state.get("connected-to-battery")&&(this.direction=-1,this.owner.body.SetAngularDamping(this.damping))},"motor-ccw-stop":function(){this.connector.state.get("connected-to-battery")&&-1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"handle-logic":function(t){var e=0;this.isTread||(this.wheelSounding&&this.wheelAudioLevel<=1?(e=this.figureOutPan(),0===this.wheelAudioLevel&&this.owner.triggerEvent("wheel-running"),this.wheelAudioLevel=Math.min(1,this.wheelAudioLevel+t.delta/500),this.owner.triggerEvent("set-volume",.25*this.wheelAudioLevel*e,"motor-running")):!this.wheelSounding&&this.wheelAudioLevel>0&&(e=this.figureOutPan(),this.wheelAudioLevel=Math.max(0,this.wheelAudioLevel-t.delta/200),this.owner.triggerEvent("set-volume",.25*this.wheelAudioLevel*e,"motor-running"),0===this.wheelAudioLevel&&this.owner.triggerEvent("stop-audio","motor-running")))},"before-box2d-update":function(){this.isTread||this.owner.triggerEvent("move-wheels")},"move-wheels":function(){this.simulationStarted?this.direction&&this.connector.state.get("connected-to-battery")?this.isTread?(this.owner.myJoint.EnableLimit(!1),this.owner.body.SetAwake(!0),this.owner.body.ApplyTorque(this.direction*this.torque)):this.connector.drainBattery(this.batteryDrain)?(this.owner.body.SetAwake(!0),this.owner.body.ApplyTorque(this.direction*this.torque),this.wheelSounding||(this.wheelSounding=!0)):this.wheelSounding&&(this.wheelSounding=!1):this.wheelSounding&&(this.wheelSounding=!1):this.wheelSounding=!1},"stop-wheels":function(){var t=0;this.isTread&&(this.owner.body.SetAngularVelocity(0),t=this.owner.myJoint.GetJointAngle(),this.owner.myJoint.SetLimits(t,t),this.owner.myJoint.EnableLimit(!0))},"apply-special-friction":function(t){this.simulationStarted&&"ice"===t.entity.type&&t.contact.SetFriction(.8)}},methods:{figureOutPan:function(){var t,e,i=this.cameraPosition,s=0;return t=Math.pow(this.owner.x-i.x,2)+Math.pow(this.owner.y-i.y,2),e=Math.max(1-t/this.panRange,0),s=this.owner.x>i.right?1:this.owner.x<i.left?-1:(this.owner.x-i.left)/i.width*2-1,this.owner.triggerEvent("set-pan",s,"motor-running"),e}},publicMethods:{}})}(),function(){"use strict";var t;platypus.createComponentClass({id:"Mouth",properties:{animationMap:null,slotName:"Mouth"},initialize:(t=function(t){this.spine&&this.spine.skeleton.setAttachment(this.slotName,t)},function(){var e="",i=this.animationMap;for(e in this.spine=null,i)i.hasOwnProperty(e)&&this.addEventListener(e,t.bind(this,i[e]))}),events:{load:function(){for(var t=this.owner.components,e=t.length;e--;)if(t[e].spine){this.spine=t[e].spine;break}}}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),s=new(include("Box2D.b2Vec2"))(0,0),n=-6e3;platypus.createComponentClass({id:"Pin",properties:{},publicProperties:{handshake:0,vertical:!1,weld:!1,tread:!1},initialize:function(){this.constraints=Array.setUp(),this.temporaryConstraints=Array.setUp(),this.entities=Array.setUp(),this.defaultZ=this.handshake?3015:this.owner.z,this.pinnedZ=this.defaultZ-.1,this.owner.parent.addPin(this.owner),this.hiding=!1,this.handshake&&this.owner.state.set("block",!0),this.vertical&&this.owner.state.set("vertical",!0),this.weld||this.tread?(this.owner.state.set("small-pin",!0),this.owner.scaleX=.6,this.owner.scaleY=.6):this.owner.state.set("small-pin",!1)},events:{adopted:function(){this.owner.parent.triggerEvent("pin-on-panel",this.owner)},"snap-to-pin":function(t){for(var e=this.entities,i=e.length,s=null;i--;)s=e[i],this.detach(s),t.attach(s,!1,!0);this.owner.parent.removeEntity(this.owner)},"validate-motion":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("validate-constraint",t)},dragged:function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("pin-moved",t);this.destroyTemporaryJoints()},"resolve-bodies":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-bodies")},"resolve-joints":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-joints")},"resolve-snaps":function(e){for(var i=this.entities,s=null,n=null,o=this.temporaryConstraints,r=e.length,a=0,h=0;r--;)if((s=e[r]).pinFrom===this.owner&&!s.panel)for(a=(n=s.pinTo.getPinnedEntities()).length;a--;)for(h=i.length;h--;)o.push(t.setUp("pinned",n[a],"entity",i[h]))},"motion-ended":function(){var t=this.entities,e=t.length;for(this.destroyTemporaryJoints();e--;)t[e].triggerEvent("pin-motion-ended",this.owner)},"update-group-id":function(t){var e=this.entities,i=e.length;if(!t||t!==this.owner.groupId){for(t?this.owner.groupId=t:(this.owner.groupId=--n,t=this.owner.groupId);i--;)e[i].groupId!==t&&e[i].triggerEvent("update-group-id",t);this.owner.panelled&&this.owner.panelled.triggerEvent("update-group-id",t)}},"pre-simulation-started":function(){this.owner.panelled&&this.attach(this.owner.panelled)},"prepare-for-simulation":function(){var t=0,e=null;for(t=0;t<this.constraints.length;t++)e=this.constraints[t],this.owner.handshake||this.owner.panelled||(e.EnableMotor(!0),e.SetMaxMotorTorque(15),i(e).oAngle=e.GetJointAngle());this.owner.parent.removeEntity(this.owner)},"throw-away":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("lost-pin",this.owner)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("begin-pin-group-movement",t)},"before-box2d-update":function(){for(var t=null,e=this.temporaryConstraints,i=e.length;i--;)(t=e[i]).joint=this.createJoint(t.pinned,t.entity,!0)},"after-box2d-update":function(){for(var t=this.owner,e=null,i=this.temporaryConstraints,s=i.length;s--;)e=i[s],t.removeJoint(e.joint),e.joint=null},"can-you-pin-to-this-panel":function(t){var i=null,n=[0,-2,2],o=0;if(!this.owner.handshake&&-1===this.owner.getPinnedEntities().indexOf(t.panel))for(i=t.panel.body.GetFixtureList();0!==e(i);){for(o=0;o<n.length;o++)if(s.Set((this.owner.x+n[o])/30,(this.owner.y+n[o])/30),i.TestPoint(s))return t.pin=this.owner,this.owner.panelled=t.panel,this.owner.state&&(this.owner.state.get("panelled")||this.owner.state.set("panelled",!0)),void t.panel.velcroed.push(this.owner);i=i.GetNext()}}},methods:{createJoint:function(t,e,i){var s=this.owner,n=s.x/30,o=s.y/30;return this.handshake||this.weld?t.createJoint("weld",{anchor:{x:n,y:o},collideConnected:i||!1},e,1):this.tread?t.createJoint("revolute",{anchor:{x:n,y:o},lowerAngle:-Math.PI/6,upperAngle:Math.PI/6,enableLimit:!0},e,1):t.createJoint("revolute",{anchor:{x:n,y:o}},e,1)},destroyTemporaryJoints:function(){for(var t=this.temporaryConstraints,e=t.length;e--;)t[e].recycle();t.length=0},updateRendering:function(){var t=this.entities.length>1;this.owner.state.set("pinned",t),this.owner.z=t?this.pinnedZ:this.defaultZ},destroy:function(){var t=this.owner.parent;t.removePin&&t.removePin(this.owner),this.constraints.recycle(),this.constraints=null,this.entities.recycle(),this.entities=null},detachPinAndJoint:function(t){var e=t.body,i=this.owner,s=this.constraints,n=null,o=this.entities,r=o.indexOf(t),a=0;if(r>=0){for(a=s.length;a--;)if(e===(n=s[a]).GetBodyA()||e===n.GetBodyB()){s.greenSplice(a);try{i.removeJoint(n)}catch(t){platypus.debug.warn("Joint removal caused an error.",t)}}if(this.handshake&&(this.handshake-=1e3,0===r&&(this.handshake*=-1)),o.greenSplice(r),this.owner.immobile&&!t.movable)for(r=o.length,this.owner.immobile=!1;r--;)if(!o[r].movable){this.owner.immobile=!0;break}t.triggerEvent("pin-removed",i)}else platypus.debug.warn("Attempting to detach an unattached entity. This is incorrect; please fix.")}},publicMethods:{getConstraints:function(){return this.constraints},attach:function(t,e,i){var s=this.constraints,n=this.entities,o=n.length;for(i&&this.handshake&&(this.handshake+=1e3);o--;)s.push(this.createJoint(t,n[o]));n.push(t),t.movable||(this.owner.immobile=!0),e||t.triggerEvent("pin-added",this.owner),this.owner.loadingComponents?t.groupId&&!this.owner.groupId&&(this.owner.groupId=t.groupId):this.owner.groupId?t.triggerEvent("update-group-id",this.owner.groupId):this.owner.triggerEvent("update-group-id"),this.updateRendering()},canSnapTo:function(t,e){var i=this.entities,s=i.length,n=!0,o=t.pinTo.getPinnedEntities(),r=o.length;if(t.pinFrom.handshake+t.pinTo.handshake!==0||0===t.pinFrom.handshake||0===t.pinTo.handshake)return!1;if(t.pinFrom.inDragGroup&&t.pinTo.inDragGroup)return!1;for(;s--;)for(r=o.length;r--;)if(i[s]===o[r])return!1;for(s=i.length;s--;)if(i[s].triggerEvent("valid-snap",t,e),!t.snappable){n=!1;break}return n},isConstrained:function(){return!!this.entities.length},hasJoint:function(t){for(var i=this.constraints,s=i.length;s--;)if(e(i[s])===e(t))return!0;return!1},detach:function(t){this.detachPinAndJoint(t)&&(this.owner.triggerEvent("update-group-id"),this.updateRendering())},getPinnedEntities:function(){return this.entities},resetJoints:function(){for(var t=this.owner,e=this.constraints,i=e.length,s=this.entities,n=0;i--;)t.removeJoint(e[i]);for(e.length=0,i=s.length;i--;)for(n=i;n--;)e.push(this.createJoint(s[i],s[n]))},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake?9999999:0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1}})},split:function(t){var e=this.owner.parent,i=this.entities,s=i.length,n=null,o=null;if(1===s)return null;for(this.owner.immobile&&t.movable&&(this.owner.immobile=!1),o=this.createPin(this.owner,e);s--;)i[s]!==t&&(n=i[s],this.detachPinAndJoint(n),o.attach(n,!1),this.handshake&&(o.handshake=-this.handshake,o.state.set("block",!0)));return this.owner.triggerEvent("update-group-id"),this.updateRendering(),o},detachPermanently:function(t){this.detach(t),this.entities.length?this.updateRendering():this.owner.parent.removeEntity(this.owner)}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",initialize:function(){this.pins=this.owner.pins=Array.setUp()},events:{},methods:{destroy:function(){this.pins.recycle(),this.pins=this.owner.pins=null}},publicMethods:{addPin:function(t){this.pins.push(t),this.owner.pinsImmovable&&(t.triggerEvent("input-off"),t.interactive=!1)},removePin:function(t){var e=this.pins,i=e.indexOf(t);i>=0&&e.greenSplice(i)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.getPointer"),i=new t(0,0),s=function(t){var s=t.pin||t,n=this.owner.velcroed.indexOf(s),o=null,r=[0,-2,2],a=0;if(-1===s.getPinnedEntities().indexOf(this.owner)){for(o=this.owner.body.GetFixtureList();0!==e(o);){for(a=0;a<r.length;a++)if(i.Set((t.x+r[a])/30,(t.y+r[a])/30),o.TestPoint(i))return t.panelled=this.owner,t.state&&t.state.set("panelled",!0),void(-1===n&&this.owner.velcroed.push(s));o=o.GetNext()}-1!==n&&this.owner.velcroed.splice(n,1)}};platypus.createComponentClass({id:"Pinnable",properties:{pinLocations:null,validate:!0},publicProperties:{z:0,velcro:!1,velcroed:null},initialize:function(){this.owner.parent.pins;var t=this.pinLocations,e=0,i=t&&t.length||0;for(this.onlyRemovingComponentSoDontDropThePins=!1,this.pins=Array.setUp(),e=0;e<i;e++)this.addPin(t[e]);this.velcroed=[],this.velcro&&this.addEventListener("pin-on-panel",s)},events:{"peer-entity-added":function(t){"pin"!==t.type||t.handshake||this.owner.triggerEvent("pin-on-panel",t)},"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.PinnableFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.validate&&t.valid&&this.tryAdjustment(t.entity,t)},"update-group-id":function(t){var e=this.pins,i=e.length,s=this.velcroed.length;for(this.owner.groupId=t;i--;)t!==e[i].groupId&&e[i].triggerEvent("update-group-id",t);for(;s--;)t!==this.velcroed[s].groupId&&this.velcroed[s].triggerEvent("update-group-id",t)},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){this.pins.push(t)},"resolve-bodies":function(){var t=this.owner;t.body&&t.matchBodyToEntity()},"pin-removed":function(t){for(var e=this.pins,i=e.length;i--;)if(t===e[i])return void e.greenSplice(i)},"begin-pin-group-movement":function(t){var e=this.pins,i=e.length;for(this.owner.triggerEvent("include-in-group",t);i--;)e[i].triggerEvent("include-in-group",t)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.pins,i=e.length,s=!1;i--;)e[i].triggerEvent("include-in-group",t),e[i].immobile&&(s=!0);if(this.owner.movable&&s)for(i=e.length;i--;)e[i].split(this.owner);else this.prepareForBreakage=!0},"break-away":function(){var t=this.pins,e=t.length;if(this.prepareForBreakage)for(this.prepareForBreakage=!1;e--;)t[e].split(this.owner)},"include-in-group":function(){this.prepareForBreakage=!1},"remove-pinnable-component":function(){this.owner.removeComponent(this),this.owner.parent.triggerEvent("child-entity-updated",this.owner)}},methods:{addPin:function(t){var e=this.owner,i=this.createOrFindPin({x:e.x+t.x,y:e.y+t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1},e.parent);return this.pins.push(i),i.getPinnedEntities().length?i.attach(e,!0,!0):i.attach(e,!0),i},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins),s=this.pins.indexOf(i);return i&&s<0?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1}})},findPin:function(t,e){var i,s,n=platypus.game.app.config.pins.mergeDistance,o=0,r=null,a=e&&e.length,h=n*n,l=null;if(a)for(;a--;)r=e[a],i=r.x-t.x,s=r.y-t.y,(o=i*i+s*s)<h&&r.handshake+t.handshake===0&&(h=o,l=r);return l},tryAdjustment:function(t,e){var i=this.pins,s=i.length;if(!this.alreadyTryingAdjustment){for(this.alreadyTryingAdjustment=!0;s--;)t!==i[s]&&i[s].triggerEvent("validate-constraint",e);this.alreadyTryingAdjustment=!1}}},publicMethods:{destroyThePins:function(){var t=this.pins,e=t.length;if(!this.onlyRemovingComponentSoDontDropThePins)try{for(;e--;)t[e].detachPermanently(this.owner)}catch(t){}t.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinnableFrozen",initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.removeComponent(this),t.addComponent(new platypus.components.Pinnable(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)}}})}(),function(){"use strict";platypus.createComponentClass({id:"PlanetButtonLogic",properties:{leftArrow:!1},publicProperties:{},initialize:function(t,e){var i=3;return this.sequence=["earth"],this.completedEarth=!1,this.completedMoon=!1,this.completedMars=!1,this.index=0,this.leftArrow&&this.owner.triggerEvent("disable"),this.owner.parent.parent.app.userData.read("Completed-Earth",function(t){this.completedEarth=t,this.completedEarth&&!this.completedMoon&&(this.sequence=["earth","moon"]),0===--i&&e()}.bind(this)),this.owner.parent.parent.app.userData.read("Completed-Moon",function(t){this.completedMoon=t,this.completedMoon&&(this.sequence=["earth","moon","mars"]),0===--i&&e()}.bind(this)),this.owner.parent.parent.app.userData.read("Completed-Mars",function(t){this.completedMoon=t,this.completedMoon&&(this.sequence=["earth","moon","mars","europa"]),0===--i&&e()}.bind(this)),!0},events:{load:function(){1===this.sequence.length&&this.owner.triggerEvent("disable")},"add-planet":function(t){this.sequence.push(t)},"focus-on":function(t){var e=this.sequence.indexOf(t);-1!==e&&(this.index=e,this.leftArrow?0===e||1===this.sequence.length?this.owner.triggerEvent("disable"):this.owner.triggerEvent("enable"):e===this.sequence.length-1||1===this.sequence.length?this.owner.triggerEvent("disable"):this.owner.triggerEvent("enable"))},disable:function(){1===this.sequence.length?this.owner.opacity=0:this.owner.opacity=.25},enable:function(){this.owner.opacity=1},released:function(){var t=this.index;this.leftArrow?t--:t++,this.owner.triggerEvent("focus-on",this.sequence[t]),this.owner.triggerEvent("rl-focus-on",this.sequence[t])}},methods:{},publicMethods:{getNextPlanet:function(){var t=0;return t=this.leftArrow?this.index-1:this.index+1,this.sequence[t]}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"PointerBehaviors",properties:{bounceDistance:30,scaleBy:1.25},publicProperties:{},initialize:function(){this.degToRad=Math.PI/180,this.originalX=this.owner.x,this.originalY=this.owner.y,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY},events:{"handle-logic":function(t){},move:function(t){this.owner.x=t.x,this.owner.y=t.y,this.owner.rotation=t.rotation||this.owner.rotation,this.originalX=this.owner.x,this.originalY=this.owner.y},"smooth-move":function(i){this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner).to({x:i.x,y:i.y,rotation:i.rotation||this.owner.rotation},i.time||250,e.sineInOut).call(function(){this.originalX=this.owner.x,this.originalY=this.owner.y}.bind(this))},show:function(){t.get(this.owner).to({opacity:1},100)},hide:function(){t.get(this.owner).to({opacity:0},100)},"start-pulse":function(i){i=i||-1,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY,t.get(this.owner,{loop:i}).to({scaleX:this.originalScaleX*this.scaleBy,scaleY:this.originalScaleY*this.scaleBy},250,e.sineInOut).to({scaleX:this.originalScaleX,scaleY:this.originalScaleY},250,e.sineInOut)},"start-bounce":function(i){i=i||-1,this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner,{loop:i}).to({x:this.originalX+Math.cos(this.owner.rotation*this.degToRad)*this.bounceDistance,y:this.originalY+Math.sin(this.owner.rotation*this.degToRad)*this.bounceDistance},250,e.sineInOut).to({x:this.originalX,y:this.originalY},250,e.sineInOut)},stop:function(){t.removeTweens(this.owner),this.owner.x=this.originalX,this.owner.y=this.originalY,this.owner.scaleX=this.originalScaleX,this.owner.scaleY=this.originalScaleY},"set-state":function(t){this.owner.state.set(t.state,t.value)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=3e3,i=function(t,e,i){t.worldToWindow(i,!0,i),e.windowToWorld(i,!0,i),i.pixiEvent.stopPropagation()},s=function(t){t.pixiEvent.stopPropagation()},n=function(i){this.owner.parent.zooming||this.newEntity||(this.convert(i),this.newEntityReady=!1,this.storedInputs.length=0,this.newEntity=this.targetLayer.addEntity({type:this.spawns,properties:{savable:!0,movable:!0,neverMovedPreviously:this.owner,x:i.x,y:i.y}},function(t,i){var s=!1,n=this.storedInputs,o=0;for(i.relayPointer?(this.newEntity=i.relayPointer,i.relayPointer=null):this.newEntity=i,this.newEntityReady=!0,this.newEntity.triggerEvent("pointerdown",t),o=0;o<n.length;o++)this.newEntity.triggerEvent(n[o].event.type,n[o]),s=s||n[o].done,n[o].recycle();n.length=0,"pointerup"!==t.event.type&&"touchend"!==t.event.type||(this.newEntity.triggerEvent("pointerup",t),this.newEntity=null),"pointerupoutside"===t.event.type&&(this.newEntity.triggerEvent("pointerupoutside",t),this.newEntity=null),"pointercancel"===t.event.type&&(this.newEntity.triggerEvent("pointercancel",t),this.newEntity=null),s&&(this.newEntity=null),t.recycle(),e+=1e-6,i.z+=e}.bind(this,t.setUp("entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y))))};platypus.createComponentClass({id:"PointerPassalong",properties:{spawnEvent:"pointerdown",targetLayerType:"action-layer"},publicProperties:{spawns:""},initialize:function(){this.newEntity=null,this.targetLayer=null,this.convert=s,this.storedInputs=Array.setUp(),this.addEventListener(this.spawnEvent,n.bind(this))},events:{"building-region-z-is":function(t){e=t},adopted:function(){var t=this.owner.parent.parent.layers,e=t.length,s=this.targetLayerType;if(s){for(;e--;)if(s===t[e].type){this.targetLayer=t[e],this.convert=i.bind(null,this.owner.parent,this.targetLayer);break}this.targetLayer||platypus.debug.warn('PointerPassalong: "'+s+'" is not an available layer in this scene. Entity will be spawned on the same layer.')}this.owner.triggerEvent("rl-get-z")},pointermove:function(t){this.passEvent("pointermove",t)},pointerup:function(t){this.passEvent("pointerup",t,!0)},pointerupoutside:function(t){this.passEvent("pointerupoutside",t,!0)},pointercancel:function(t){this.passEvent("pointercancel",t,!0)}},methods:{passEvent:function(e,i,s){this.newEntity&&(this.convert(i),this.newEntityReady?(this.newEntity.triggerEvent(e,i),s&&(this.newEntity=null)):this.storedInputs.push(t.setUp("done",s,"entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y)))},destroy:function(){this.storedInputs.recycle(),this.storedInputs=null}}})}(),function(){"use strict";var t={};platypus.createComponentClass({id:"RandomizeVariant",properties:{numVariants:3},publicProperties:{},initialize:function(){this.alphabet="abcdefghij",this.variant="",void 0===t[this.owner.type]&&(t[this.owner.type]=Math.floor(Math.random()*this.numVariants)),this.owner.state.set("variant-"+this.alphabet[t[this.owner.type]],!0),t[this.owner.type]++,t[this.owner.type]>=this.numVariants&&(t[this.owner.type]=0)},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Region",properties:{},publicProperties:{height:0,width:0,x:0,y:0},initialize:function(){this.aabb=t.setUp(this.x,this.y,this.width,this.height),this.entities=Array.setUp(),this.answeredZ=!1,platypus.game.app.buildingRegion={x:this.owner.x,y:this.owner.y,width:this.owner.width,height:this.owner.height}},events:{adopted:function(){var t=this.owner,e=t.parent;this.addBorderingRegions(),e.triggerEvent("building-area-ready",t),e.triggerEvent("relocate",t)},"prepare-for-simulation":function(){for(var t=this.entities,e=t.length;e--;)this.owner.parent.removeEntity(t[e]);t.length=0,this.owner.body.SetActive(!1)},"simulation-stopped":function(){this.addBorderingRegions(),this.owner.body.SetActive(!0)},"handle-logic":function(){this.x===this.aabb.x&&this.y===this.aabb.y||this.aabb.move(this.x,this.y)},"what-is-building-region-z":function(){this.answeredZ||(this.answeredZ=!0,this.owner.triggerEvent("rl-tell-z",this.owner.z))}},methods:{addBorderingRegions:function(){var t=this.aabb,e=this.entities,i=this.owner.parent;e.push(i.addEntity({type:"trash",properties:{width:500,height:2e3,x:-500,y:0}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.left-250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.top-250}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.right+250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.bottom+250}}))},destroy:function(){this.aabb.recycle(),this.aabb=null,this.entities.recycle(),this.entities=null}},publicMethods:{inBounds:function(t,e){return this.aabb.containsPoint(t,e)}}})}(),function(){"use strict";var t,e=include("PIXI.Graphics"),i=include("platypus.components.RenderContainer"),s=(t=function(t,e){var i=0,s=e.indexOf("("),n=e.substring(0,s),o=e.substring(s+1,e.indexOf(")"));if(o.length){for(i=(o=o.greenSplit(",")).length;i--;)o[i]=+o[i];t[n].apply(t,o),o.recycle()}else t[n]()},function(e,i){var s=0,n=i.greenSplit(".");for(s=0;s<n.length;s++)t(e,n[s]);n.recycle()});platypus.createComponentClass({id:"RenderGraphics",properties:{offsetX:0,offsetY:0,offsetZ:0,shape:""},publicProperties:{color:16776960,width:100,height:100},initialize:function(t){var e,n,o,r,a;"string"==typeof this.color&&(this.color=parseInt(this.color.replace("#","0x"),16)),e=this,n=this.shape,o=this.color,r=this.width,a=this.height,e.beginFill(o,1),n&&"string"==typeof n?s(e,n):n&&n.radius?e.dc(n.x||0,n.y||0,n.radius):n&&n.width&&n.height?e.r(n.x||0,n.y||0,n.width,n.height):e.r(-r/2,-a/2,r,a),e.endFill(),this.x=this.offsetX,this.y=this.offsetY,this.z=this.offsetZ,this.owner.container?this.addToContainer():this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this)))},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this),t.reorder=!0},destroy:function(){this.owner.container.removeChild(this)}}},e)}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.components.RenderContainer"),i=include("PIXI.Graphics"),s=include("platypus.Vector");platypus.createComponentClass({id:"RenderShape",properties:{mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,rotate:!1,mirror:!1,flip:!1,visible:!0,cache:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0,shape:null},initialize:function(){var n=null,o=this.owner,r=o.shape,a=r&&r.points||null,h=this.gfx=new i,l=r&&r.translation?s.setUp(r.translation.x,r.translation.y):s.setUp(0,0);h.beginFill(16777215,1),a?h.drawPolygon(function(t,e){var i=Array.setUp(),s=0;for(s=0;s<t.length;s++)i.push(t[s].x+e.x,t[s].y+e.y);return i}(a,{x:l.x,y:l.y})):r&&"circle"===r.type?h.drawCircle(this.offsetX,this.offsetY,r.radius||o.radius||o.width/2):h.drawRect(this.offsetX-o.width/2,this.offsetY-o.height/2,o.width,o.height),h.endFill(),l.recycle(),this.owner.container?this.addToContainer():(n=t.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new e(this.owner,n,this.addToContainer.bind(this))),n.recycle())},events:{},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.gfx),t.reorder=!0}}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.RenderContainer"),s=include("platypus.PIXIAnimation");platypus.createComponentClass({id:"RenderSpan",properties:{spriteSheet:null,offsetX:0,offsetY:0,offsetZ:0,endA:"end-a",endAReversed:"",endALength:40,endB:"end-b",endBReversed:"",endBLength:40,middle:"middle",middleReversed:"",middleLength:120,scaleLength:!1},publicProperties:{scaleX:1,stretchLength:0},initialize:function(){var t=null,n=s.formatSpriteSheet(this.spriteSheet),o=this.reversed=this.owner.state.get("reversed");n===s.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),this.endAReversed||(this.endAReversed=this.endA),this.middleReversed||(this.middleReversed=this.middle),this.endBReversed||(this.endBReversed=this.endB),this.sprite=new s(n,o?this.middleReversed:this.middle),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=platypus.modifyAllAssets,this.sprite.scale.y=platypus.modifyAllAssets,this.spriteEndA=new s(n,o?this.endAReversed:this.endA),this.spriteEndA.y=this.offsetY,this.spriteEndA.z=this.offsetZ+.01,this.spriteEndA.scale.x=platypus.modifyAllAssets,this.spriteEndA.scale.y=platypus.modifyAllAssets,this.spriteEndB=new s(n,o?this.endBReversed:this.endB),this.spriteEndB.y=this.offsetY,this.spriteEndB.z=this.offsetZ+.02,this.spriteEndB.scale.x=platypus.modifyAllAssets,this.spriteEndB.scale.y=platypus.modifyAllAssets,this.currentStretchLength=0,this.stretch(this.stretchLength),this.owner.container?this.addToContainer():(t=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this))),t.recycle()),n.recycleSpriteSheet()},events:{"handle-render":function(){this.sprite&&this.stretchLength!==this.currentStretchLength&&this.stretch(this.stretchLength)},"state-changed":function(){var t=this.owner.state.get("reversed");this.reversed!==t&&(this.reversed=t,t?(this.spriteEndA.gotoAndPlay(this.endAReversed),this.sprite.gotoAndPlay(this.middleReversed),this.spriteEndB.gotoAndPlay(this.endBReversed)):(this.spriteEndA.gotoAndPlay(this.endA),this.sprite.gotoAndPlay(this.middle),this.spriteEndB.gotoAndPlay(this.endB)))}},methods:{stretch:function(t){var e=this.scaleLength?1:1/this.scaleX,i=(t||this.middleLength+(this.endALength+this.endBLength)/2)*e,s=this.sprite,n=this.spriteEndA,o=this.spriteEndB,r=i/2-1;n.x=-r+this.offsetX,o.x=r+this.offsetX,s.scale.x=platypus.modifyAllAssets*(i-this.endALength/2-this.endBLength/2)/this.middleLength},addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.addChild(this.spriteEndA),t.addChild(this.spriteEndB),t.reorder=!0},destroy:function(){var t=this.owner.container;t.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null,t.removeChild(this.spriteEndA),this.spriteEndA.destroy(),this.spriteEndA=null,t.removeChild(this.spriteEndB),this.spriteEndB.destroy(),this.spriteEndB=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,s){var n=null,o=0,r=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||s.spriteSheet;if(Array.isArray(h)){for(o=h.length,r=Array.setUp();o--;)n=t(h[o],a),r.union(n),n.recycle();return r}return t(h,a)})})}(),function(){"use strict";var t,e,i=include("PIXI.spine.core.TextureAtlas",!1),s=include("PIXI.spine.core.AtlasAttachmentLoader",!1),n=include("PIXI.BaseTexture"),o=include("platypus.Data"),r=include("platypus.components.EventRender"),a=include("platypus.components.RenderContainer"),h=include("PIXI.spine.core.SkeletonJson",!1),l=include("PIXI.spine.Spine",!1),p=include("platypus.components.StateRender");l&&platypus.createComponentClass({id:"RenderSpine",properties:{localScaleX:1,localScaleY:1,animationMap:null,mask:null,interactive:!1,mixTimes:0,offsetX:0,offsetY:0,offsetZ:0,atlas:"",skeleton:null,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0},publicProperties:{dragMode:!1,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,x:0,y:0,z:0},initialize:(e=function(t,e,i){var s,o,r=(s=e,(o=platypus.game.app.assetManager.cache.read(s.substring(s.lastIndexOf("/")+1,s.lastIndexOf("."))))||platypus.debug.warn('RenderSpine: "'+s+'" is not a loaded asset.'),new n(o));i(r),r.isLoading?r.on("loaded",t):t()},function(t,n){var c,u="",d=null,g=platypus.game.settings,m=g.atlases[this.atlas+"-"+platypus.modifyAllAssets],y=g.skeletons[this.skeleton],f=new i(m,e.bind(null,n)),w=new h(new s(f)).readSkeletonData(y),v=this.spine=new l(w);return v.state.addListener({event:function(t,e){var i=e.data.name;this.playAnimation(i)&&this.spine.update(1e-6),this.owner.trigger(i,e.data)}.bind(this),complete:function(){this.owner.triggerEvent("animation-ended",this.currentAnimation)}.bind(this)}),v.autoUpdate=!1,c=function(t,e){var i=null,s="";if(t)return t;for(s in i={},e)e.hasOwnProperty(s)&&(i[s]=s);return i}(this.animationMap,y.animations),this.stateBased=c&&this.stateBased,this.eventBased=c&&this.eventBased,c&&(u=c.default||"",this.eventBased&&(d=o.setUp("animationMap",c,"component",this),this.owner.addComponent(new r(this.owner,d)),d.recycle()),this.stateBased&&(d=o.setUp("animationMap",c,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new p(this.owner,d)),d.recycle())),this.mixTimes&&this.setMixTimes(this.mixTimes),u&&(this.currentAnimation=u,v.state.setAnimation(0,u,!0)),v.x=this.offsetX,v.y=this.offsetY,v.z=this.offsetZ,v.scale.x=this.localScaleX,v.scale.y=this.localScaleY,this.owner.container?this.addToContainer():(d=o.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new a(this.owner,d,this.addToContainer.bind(this))),d.recycle()),!0}),events:{"handle-render":function(t){this.spine&&(this.owner.triggerEvent("update-animation",!0),this.spine.update(t.delta/1e3))},"set-mix-times":function(t){this.setMixTimes(t)},hide:function(){this.visible=!1},show:function(){this.visible=!0},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t){this.playAnimation(t)},"change-skin":function(t){var e=0,i=this.spine.spineData.skins,s=null;for(e=0;e<i.length;e++)if(i[e].name===t){s=i[e];break}this.spine.skeleton.setSkin(s),this.spine.skeleton.setSlotsToSetupPose(),this.spine.state.apply(this.spine.skeleton)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.spine),t.reorder=!0},playAnimation:function(t){var e=this.spine;return!(!t||!e.state.hasAnimation(t))&&(this.currentAnimation=t,e.state.setAnimation(0,t,!0),this.paused=!1,!0)},stopAnimation:function(t){var e=this.spine;t&&e.state.hasAnimation(t)&&(this.currentAnimation=t,e.state.setAnimation(0,t,!1)),this.paused=!0},setMixTimes:function(t){var e=this.spine,i=e.spineData.animations,s=0,n=0,o=0,r="",a=e.stateData;if("number"==typeof t)for(n=i.length;n--;)for(o=i.length;o--;)n!==o&&a.setMix(i[n].name,i[o].name,t);else for(r in t)t.hasOwnProperty(r)&&(s=r.indexOf(":"))>=0&&a.setMix(r.substring(0,s),r.substring(s+1),t[r]);this.mixTimes=a.animationToMixTime},destroy:function(){this.owner.container.removeChild(this.spine),this.spine.destroy(),this.spine=null,this.mixTimes=null}},getAssetList:(t=function(t,e){var i=Array.setUp(),s=null,n=0;if(t){if(1===(s=t.split("\n")).length){if(!(t=e[t+"-"+platypus.modifyAllAssets]))return i;s=t.split("\n")}for(n=s.length;n--;)".png"===s[n].substr(s[n].length-4)&&i.push(s[n])}return i},function(e,i,s){var n=null,o=0,r=null,a=platypus.game.settings.atlases,h=e.atlas||i.atlas||s.atlas;if(Array.isArray(h)){for(o=h.length,r=Array.setUp();o--;)n=t(h[o],a),r.union(n),n.recycle();return r}return t(h,a)})})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.EventRender"),s=include("platypus.components.RenderContainer"),n=include("platypus.PIXIAnimation"),o=include("platypus.components.StateRender");platypus.createComponentClass({id:"RenderSprite",properties:{localScaleX:1,localScaleY:1,spriteSheet:null,animationMap:null,mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,restart:!0,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0,cache:!1,forcePlayThrough:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0},initialize:function(){var t,r="",a=null,h=n.formatSpriteSheet(this.spriteSheet);h===n.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),t=function(t,e){var i=null,s="",n=null,o=0;if(t)return t;if(Array.isArray(e.frames)&&1===e.frames.length)return null;for(s in i={},n=Array.setUp(),e.animations)e.animations.hasOwnProperty(s)&&(n.push(s),i[s]=s);if("default"===n[0])for(o=n.length,i={};o--;)i[n[o]]=n[o];return n.recycle(),i}(this.animationMap,h),this.stateBased=t&&this.stateBased,this.eventBased=t&&this.eventBased,t&&(r=t.default||"",this.eventBased&&(a=e.setUp("animationMap",t,"restart",this.restart,"component",this),this.owner.addComponent(new i(this.owner,a)),a.recycle()),this.stateBased&&(a=e.setUp("animationMap",t,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new o(this.owner,a)),a.recycle())),this.sprite=new n(h,r),this.sprite.on("complete",function(t){this.owner.triggerEvent("animation-ended",t)}.bind(this)),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=this.localScaleX*platypus.modifyAllAssets,this.sprite.scale.y=this.localScaleY*platypus.modifyAllAssets,this.owner.container?this.addToContainer():(a=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new s(this.owner,a,this.addToContainer.bind(this))),a.recycle()),h.recycleSpriteSheet()},events:{"handle-render":function(t){this.sprite&&(this.owner.triggerEvent("update-animation",!0),this.sprite.update(t.delta))},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t,e){this.playAnimation(t,e)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.reorder=!0},playAnimation:function(t,e){var i=this.sprite;t&&i.has(t)?i.gotoAndPlay(t,e):i.play()},stopAnimation:function(t){var e=this.sprite;t&&e.has(t)?e.gotoAndStop(t):e.stop()},destroy:function(){this.owner.container.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,s){var n=null,o=0,r=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||s.spriteSheet;if(Array.isArray(h)){for(o=h.length,r=Array.setUp();o--;)n=t(h[o],a),r.union(n),n.recycle();return r}return t(h,a)})})}(),function(){"use strict";var t,e=include("platypus.AABB"),i=include("platypus.PIXIAnimation"),s=include("springroll.Application"),n=include("PIXI.CanvasRenderer"),o=include("PIXI.Container"),r=include("PIXI.Graphics"),a=o,h=include("PIXI.Rectangle"),l=include("platypus.components.RenderContainer"),p=include("PIXI.RenderTexture"),c=include("PIXI.Sprite"),u=function(t,e,i){var s=e.baseTexture._glRenderTargets[t.CONTEXT_UID];s&&s.clear(i)},d=function(){return null},g=e.setUp(),m=function(t,e){return t.z-e.z},y=function(t){for(var e=1;e<t;)e*=2;return e},f=function(t,e){this.id=e,this.instances=Array.setUp(t),this.index=0,t.template=this},w={getNext:d,destroy:d},v=f.prototype;v.getNext=function(){var t=this.instances[this.index],e=null;return t||(e=this.instances[0],(t=this.instances[this.index]=new c(e.texture)).scale=e.scale,t.rotation=e.rotation,t.anchor=e.anchor),this.index+=1,t},v.clear=function(){this.index=0},v.destroy=function(){var t=0;for(t=0;t<this.instances.length;t++)this.instances[t].destroy();this.instances.recycle(),this.recycle()},recycle.add(f,!!springroll.Debug,"Template"),platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10,top:0,left:0},initialize:function(t){var r=platypus.modifyAllAssets,h=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=s.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=e.setUp(),this.tileWidth/=r,this.tileHeight/=r,this.scaleX*=r,this.scaleY*=r,this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=e.setUp(),this.cachePixels=e.setUp(),this.spriteSheet=i.formatSpriteSheet(this.spriteSheet),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof n?new o:new a(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new o,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=Array.setUp(this.createMap(h)),this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(y(this.layerWidth+2),this.maximumBuffer),this.cacheHeight=Math.min(y(this.layerHeight+2),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1),this.ready=!1,this.owner.container?this.addToContainer():this.owner.addComponent(new l(this.owner,t,this.addToContainer.bind(this)))},events:{"cache-sprite":function(t){this.cacheSprite(t)},"peer-entity-added":function(t){this.cacheSprite(t)},"add-tiles":function(t){var e=t.imageMap;e&&(this.imageMap.push(this.createMap(e)),this.updateCache=!0)},"change-tile":function(t,e,i,s){var n=this.imageMap;n&&(this.updateTile(t,n[s||0],e,i),this.updateCache=!0)},"camera-loaded":function(t){this.worldWidth=t.world.width,this.worldHeight=t.world.height,this.buffer&&!this.cacheAll&&this.updateBufferRegion(t.viewport)},"camera-update":function(t){this.ready&&this.updateCamera(t)},"handle-render":function(){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{addToContainer:function(){var t=this.container=this.owner.container,e=this.mapContainer,i=null,s=this.owner.z;t.reorder=!0,this.ready=!0,this.updateRegion(0),this.tileCache?(this.mapContainerWrapper=new o,this.mapContainerWrapper.addChild(e),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.render=this.renderCache,this.cacheTexture=p.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=i=new c(this.cacheTexture),i.scale.x=this.scaleX,i.scale.y=this.scaleY,i.z=s,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),t.addChild(i)):(this.render=this.renderCache,this.cacheAll=!1,this.cacheTexture=p.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=new c(this.cacheTexture),this.tilesSprite.scale.x=this.scaleX,this.tilesSprite.scale.y=this.scaleY,this.tilesSprite.z=s,this.cacheTexture.alternate=p.create(this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new c(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,t.addChild(this.tilesSprite))):(this.render=d,e.scale.x=this.scaleX,e.scale.y=this.scaleY,e.x=this.left,e.y=this.top,e.z=s,t.addChild(e))},cacheSprite:function(t){var e=0,i=0,s=t.cacheRender,n=null,o=0,r=0,a=0,h=0;if(this.entityCache&&s){for(this.doMap||(this.doMap=Array.setUp(),this.cachedDisplayObjects=Array.setUp(),this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(s),(n=s.getBounds(s.transformMatrix)).x-=this.left,n.y-=this.top,o=Math.max(0,Math.floor(n.y/this.tileHeight)),r=Math.min(this.tilesHeight,Math.ceil((n.y+n.height)/this.tileHeight)),h=Math.max(0,Math.floor(n.x/this.tileWidth)),a=Math.min(this.tilesWidth,Math.ceil((n.x+n.width)/this.tileWidth)),e=h;e<a;e++)for(this.doMap[e]||(this.doMap[e]=Array.setUp()),i=o;i<r;i++)this.doMap[e][i]||(this.doMap[e][i]=Array.setUp()),this.doMap[e][i].push(s);t.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(t){var e=this.layerWidth*this.scaleX,i=this.layerHeight*this.scaleY,s=this.worldWidth,n=s-t.width,o=this.worldHeight,r=o-t.height,a=this.laxCam;return s!==e&&n?a.moveX((t.left-this.left)*(e-t.width)/n+t.halfWidth+this.left):a.moveX(t.x),o!==i&&r?a.moveY((t.top-this.top)*(i-t.height)/r+t.halfHeight+this.top):a.moveY(t.y),t.width===a.width&&t.height===a.height||a.resize(t.width,t.height),a},createTile:function(t){var e,s=null;return"tile-1"===t?w:(e="tile"+function(t,e){var i=+t.substring(4),s=0;return 2147483648&i&&(e.scale.x=-1),1073741824&i&&(e.scale.y=-1),536870912&i&&(s=e.scale.x,e.scale.x=e.scale.y,e.scale.y=-s,e.rotation=Math.PI/2),268435455&i}(t,s=new i(this.spriteSheet)),s.gotoAndStop(e),f.setUp(s,t))},createMap:function(t){var e=0,i=0,s="",n=null;if("string"!=typeof t[0][0])return t;for(n=Array.setUp(),e=0;e<t.length;e++)for(n[e]=Array.setUp(),i=0;i<t[e].length;i++)s=t[e][i],this.updateTile(s,n,e,i);return n},updateCamera:function(t){var e=0,i=0,s=!1,n=null,o=0,r=0,a=0,h=0,l=this.cache,p=this.cachePixels,c=t.viewport,u=this.buffer&&(c.width!==this.laxCam.width||c.height!==this.laxCam.height),d=g,m=this.convertCamera(c);if(!this.cacheAll&&(p.empty||!p.contains(m))&&this.imageMap.length>0&&(u&&this.updateBufferRegion(m),a=(o=this.cacheTilesWidth-1)/2,h=(r=this.cacheTilesHeight-1)/2,d.setAll(Math.round((m.x-this.left)/(this.tileWidth*this.scaleX)-a)+a,Math.round((m.y-this.top)/(this.tileHeight*this.scaleY)-h)+h,o,r),d.left<0?d.moveX(d.halfWidth):d.right>this.tilesWidth-1&&d.moveX(this.tilesWidth-1-d.halfWidth),d.top<0?d.moveY(d.halfHeight):d.bottom>this.tilesHeight-1&&d.moveY(this.tilesHeight-1-d.halfHeight),this.tileCache?!l.empty&&d.contains(l)||(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,d,this.tilesSpriteCache,l)):this.update(null,d),p.setAll((l.x+.5)*this.tileWidth+this.left,(l.y+.5)*this.tileHeight+this.top,(l.width+1)*this.tileWidth,(l.height+1)*this.tileHeight)),this.cacheGrid)for(e=0;e<this.cacheGrid.length;e++)for(i=0;i<this.cacheGrid[e].length;i++)n=this.cacheGrid[e][i],p.setAll((e+.5)*this.cacheClipWidth+this.left,(i+.5)*this.cacheClipHeight+this.top,this.cacheClipWidth,this.cacheClipHeight),s=p.intersects(m),n.visible&&!s?n.visible=!1:!n.visible&&s&&(n.visible=!0),n.visible&&s&&(n.x=c.left-m.left+e*this.cacheClipWidth+this.left,n.y=c.top-m.top+i*this.cacheClipHeight+this.top);else this.tileCache&&(this.tilesSprite.x=c.left-m.left+l.left*this.tileWidth*this.scaleX+this.left,this.tilesSprite.y=c.top-m.top+l.top*this.tileHeight*this.scaleY+this.top)},updateTile:function(t,e,i,s){var n=null,o=this.tiles;t.id&&(t=t.id),(n=o[t])||null===n||(n=o[t]=this.createTile(t)),e[i][s]=n},createGrid:function(t){var e=this.cacheHeight,i=this.cacheWidth,s=this.cacheTilesHeight,n=this.cacheTilesWidth,o=0,r=0,a=null,l=this.scaleX,u=this.scaleY,d=this.tileHeight,g=this.tileWidth,m=this.tilesHeight,f=this.tilesWidth,w=0,v=0,b=this.owner.z,x=null,E=null,C=Array.setUp();for(w=0;w<f;w+=n)for(x=Array.setUp(),C.push(x),v=0;v<m;v+=s)r=Math.min(y((f-w)*g+2),i),o=Math.min(y((m-v)*d+2),e),(a=p.create(r,o)).frame=new h(1,1,((r-2)/g>>0)*g+1,((o-2)/d>>0)*d+1),(E=new c(a)).z=b,E.scale.x=l,E.scale.y=u,x.push(E),t.addChild(E),b-=1e-6;return C},updateRegion:function(t){var e=this.tileWidth,i=this.tileHeight,s=Math.min(this.tilesWidth,(this.cacheWidth-2)/e>>0),n=Math.min(this.tilesHeight,(this.cacheHeight-2)/i>>0);s||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+e+"px wide which is larger than "+(this.cacheWidth-2)+"px (maximum cache size of "+this.cacheWidth+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),n||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+i+"px high which is larger than "+(this.cacheHeight-2)+"px (maximum cache size of "+this.cacheHeight+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),this.cacheTilesWidth=s,this.cacheTilesHeight=n,this.cacheClipWidth=s*e,this.cacheClipHeight=n*i,this.tileCache&&(this.mapContainer.mask=(new r).beginFill(0).drawRect(0,0,this.cacheClipWidth+t,this.cacheClipHeight+t).endFill())},updateBufferRegion:function(t){var e=this.tileWidth,i=this.tileHeight;this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((t.width+2*this.buffer)/e),this.cacheWidth/e>>0),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((t.height+2*this.buffer)/i),this.cacheHeight/i>>0),this.cacheClipWidth=this.cacheTilesWidth*e,this.cacheClipHeight=this.cacheTilesHeight*i,this.mapContainer.mask=(new r).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(t,e,i,s){this.populate(e,s),this.render(e,t,this.mapContainer,this.mapContainerWrapper,i,s),s&&s.set(e)},populateTiles:function(t,e){var i=0,s=0,n=0,o=0,r=null,a=Array.setUp();for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(s=t.top;s<=t.bottom;s++)if(!e||e.empty||s>e.bottom||s<e.top||i>e.right||i<e.left)for(o=0;o<this.imageMap.length;o++)(r=this.imageMap[o][i][s].getNext())&&(r.template&&a.push(r.template),r.x=(i+.5)*this.tileWidth,r.y=(s+.5)*this.tileHeight,this.tileContainer.addChild(r));for(n=0;n<a.length;n++)a[n].clear();a.recycle()},populateTilesAndEntities:function(t,e){var i=0,s=0,n=0,o=0,r=null,a=null,h=Array.setUp(),l=Array.setUp(),p=null;for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(s=t.top;s<=t.bottom;s++)if(!e||e.empty||s>e.bottom||s<e.top||i>e.right||i<e.left){for(o=0;o<this.imageMap.length;o++)(r=this.imageMap[o][i][s].getNext())&&(r.template&&l.push(r.template),r.x=(i+.5)*this.tileWidth,r.y=(s+.5)*this.tileHeight,this.tileContainer.addChild(r));if(this.doMap[i]&&this.doMap[i][s])for(p=this.doMap[i][s],n=0;n<p.length;n++)p[n].drawn||(p[n].drawn=!0,h.push(p[n]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),h.length)for(h.sort(m),n=0;n<h.length;n++)delete(a=h[n]).drawn,this.mapContainer.addChild(a),a.mask&&this.mapContainer.addChild(a.mask);for(n=0;n<l.length;n++)l[n].clear();l.recycle(),h.recycle()},renderCache:function(t,e,i,s,n,o){var r=this.renderer;n&&!o.empty&&(n.x=o.left*this.tileWidth,n.y=o.top*this.tileHeight,i.addChild(n)),u(r,e),i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight,r.render(s,e),e.requiresUpdate=!0},renderCacheWithExtrusion:function(t,e,i,s){var n=new r,o=this.renderer;n.lineStyle(1,0),n.drawRect(.5,.5,this.cacheClipWidth+1,this.cacheClipHeight+1),u(o,e),s.mask=n,i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight+1,o.render(s,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight,o.render(s,e),i.x=-t.left*this.tileWidth+2,i.y=-t.top*this.tileHeight+1,o.render(s,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+2,o.render(s,e),s.mask=null,i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+1,o.render(s,e),e.requiresUpdate=!0},updateGrid:function(){var t=this.cache,e=this.cacheTilesHeight,i=this.cacheTilesWidth,s=this.tilesHeight-1,n=this.tilesWidth-1,o=0,r=0,a=this.cacheGrid;for(o=0;o<a.length;o++)for(r=0;r<a[o].length;r++)t.setBounds(o*i,r*e,Math.min((o+1)*i,n),Math.min((r+1)*e,s)),this.update(a[o][r].texture,t)},toJSON:function(){for(var t=this.imageMap[0],e=[],i=t.length,s=0;i--;)for(s=t[i].length,e[i]=[];s--;)e[i][s]=t[i][s].id;return{type:"RenderTiles",buffer:this.buffer,cacheAll:this.cacheAll,entityCache:this.entityCache,imageMap:e,maximumBuffer:this.maximumBuffer,scaleX:this.scaleX,scaleY:this.scaleY,spriteSheet:this.spriteSheet,tileCache:this.tileCache,tileHeight:this.tileHeight,tileWidth:this.tileWidth,top:this.top,left:this.left}},destroy:function(){var t=0,e=0,i="",s=this.cacheGrid,n=this.doMap,o=this.imageMap;if(s){for(t=0;t<s.length;t++)for(e=0;e<s[t].length;e++)s[t][e].texture.destroy(!0),this.container.removeChild(s[t][e]);s.recycle(2),delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.container.removeChild(this.tilesSprite)):this.container.removeChild(this.mapContainer);for(i in o.recycle(2),this.tiles)this.tiles.hasOwnProperty(i)&&this.tiles[i].destroy();if(this.tiles=null,this.container=null,this.tilesSprite=null,this.spriteSheet.recycleSpriteSheet(),n){for(t=0;t<this.cachedDisplayObjects.length;t++)this.cachedDisplayObjects[t].destroy();for(this.cachedDisplayObjects.recycle(),t=0;t<n.length;t++)if(n[t]){for(e=0;e<n.length;e++)n[t][e]&&n[t][e].recycle();n[t].recycle()}n.recycle()}this.laxCam.recycle(),this.cache.recycle(),this.cachePixels.recycle()}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,s){var n=null,o=0,r=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||s.spriteSheet;if(h){if("string"==typeof h&&"import"!==h)return t(h,a);if(Array.isArray(h)){for(o=h.length,r=Array.setUp();o--;)n=t(h[o],a),r.union(n),n.recycle();return r}if(h.images)return h.images.greenSlice()}return Array.setUp()})})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ResizeSnapper",properties:{cameraSizes:null},publicProperties:{bottom:null,left:null,right:null,top:null,x:0,y:0},initialize:function(){this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.cameraSizesIndex=-1},events:{"handle-logic":function(){var t=this.bottom,e=this.left,i=this.right,s=this.top;this.lastBottom===t&&this.lastLeft===e&&this.lastRight===i&&this.lastTop===s||(this.updatePosition(this.aabb),this.lastBottom=t,this.lastLeft=e,this.lastRight=i,this.lastTop=s)},"camera-update":function(t){this.aabb.set(t.viewport),this.cameraSizes&&this.checkCamera(this.aabb),this.updatePosition(this.aabb)}},methods:{checkCamera:function(t){var e=this.cameraSizes,i=0,s=t.width/t.height;for(i=0;i<e.length;i++)if(s>e[i].minRatio){i!==this.cameraSizesIndex&&(this.updateProperties(e[i]),this.cameraSizesIndex=i);break}},updateProperties:function(t){this.right="number"==typeof t.right?t.right:null,this.left="number"==typeof t.left?t.left:null,this.top="number"==typeof t.top?t.top:null,this.bottom="number"==typeof t.bottom?t.bottom:null,"number"==typeof t.x&&(this.x=t.x),"number"==typeof t.y&&(this.y=t.y)},updatePosition:function(t){var e=this.bottom,i=this.left,s=this.owner,n=this.right,o=this.top;"number"==typeof i?s.x=t.left+i:"number"==typeof n&&(s.x=t.right-n),"number"==typeof o?s.y=t.top+o:"number"==typeof e&&(s.y=t.bottom-e)},destroy:function(){this.aabb.recycle(),this.aabb=null}}})}(),function(){"use strict";var t={age:1,orientation:0,velocity:null},e=include("platypus.AABB"),i=include("Box2D.b2Vec2"),s=include("Box2D.b2Fixture"),n=include("Box2D.helpers.getUserData"),o=Math.PI/2,r=new i(0,0),a=new i(0,0),h=new Box2D.JSRayCastCallback;h.ReportFixture=function(t,e,o,r){var a=Box2D.wrapPointer(t,s),h=Box2D.wrapPointer(e,i),l=Box2D.wrapPointer(o,i),p=n(a.GetBody()).entity.type;return"wall"===p||"wall-storm"===p||"ice"===p?(this.m_fixture=a,this.m_point=h,this.m_normal=l,this.m_fraction=r,r):-1},platypus.createComponentClass({id:"Rocket",properties:{horizontal:!1,defaultVolume:1},publicProperties:{},initialize:function(){this.owner.parent.smokeParticles||(this.owner.parent.smokeParticles=[]),this.smokeParticles=this.owner.parent.smokeParticles,this.maxForce=.14,this.minForce=.07,"moon"===this.owner.parent.planet?(this.maxForce=.14,this.minForce=.07):"mars"===this.owner.parent.planet?(this.maxForce=.14*1.5,this.minForce=.07*1.5):"europa"===this.owner.parent.planet&&(this.maxForce=.14,this.minForce=.07),this.fuel=1e4,this.firing=!1,this.firingTime=0,this.accelTime=200,this.forceVector=new i(0,0),this.boostDistance=512/30,this.sinceLastParticle=0,this.owner.state.set("used",!1),this.ifHorizontal=0,this.horizontal&&(this.ifHorizontal=Math.PI/2),this.cameraPosition=e.setUp(),this.panRange=0,this.simulating=!1},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.15*this.cameraPosition.width,2)},"handle-logic":function(t){var e=t.delta,i=0,s=0,n=0,a=null;this.simulating&&this.firing&&(this.fuel?(this.figureOutPan(),this.fuel=Math.max(this.fuel-e,0),this.firingTime+=e,n=this.owner.orientation-o+this.ifHorizontal,a=this.owner.body.GetWorldCenter(),r.Set(a.get_x()+Math.cos(n)*this.boostDistance,a.get_y()+Math.sin(-n)*this.boostDistance),this.owner.parent.world.RayCast(h,a,r),s=h.m_fraction<1?Math.pow(.25,2*h.m_fraction)*this.maxForce:0,this.firingTime<=this.accelTime&&(i=this.firingTime/this.accelTime,s*=Math.sin(i*Math.PI-o)/2+.5),s+=this.minForce,this.emitParticles(e,this.fuel/1e4,1),this.forceVector.Set(Math.cos(n)*s,Math.sin(n)*s),this.owner.body.ApplyForce(this.forceVector,this.owner.body.GetWorldCenter(),!0)):(this.owner.triggerEvent("stop-audio"),this.firing=!1,this.owner.state.set("used",!0),this.owner.parent.triggerEvent("rl-play-rocket-is-dead"),platypus.game.app.analyticsEmitter.rocketEmpty(platypus.game.app.levelId||"",platypus.game.app.getRoverLocation())))},"rocket-start":function(){this.simulating&&this.fuel&&!this.firing&&(this.firing=!0,this.owner.triggerEvent("burn-"+Math.floor(5*Math.random())))},"rocket-stop":function(){this.owner.triggerEvent("stop-audio"),this.firing=!1,this.firingTime=0},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.simulating=!1,this.firing=!1,this.owner.state.set("used",!1),this.fuel=1e4,this.owner.triggerEvent("stop-audio"),this.owner.body.SetLinearVelocity(a),this.owner.body.SetAngularVelocity(0),this.owner.body.SetAwake(!1)},"recycle-particle":function(t){this.smokeParticles.push(t)}},methods:{figureOutPan:function(){var t,e,i=this.cameraPosition,s=0;t=Math.pow(this.owner.x-i.x,2)+Math.pow(this.owner.y-i.y,2),e=Math.max(1-t/this.panRange,0),s=this.owner.x>i.right?1:this.owner.x<i.left?-1:(this.owner.x-i.left)/i.width*2-1,this.owner.triggerEvent("set-pan",s,"rocket-engine"),this.owner.triggerEvent("set-volume",e*this.defaultVolume,"rocket-engine")},emitParticles:function(t,e,i){var s=750*(1-i<.1?.1:1-i);this.sinceLastParticle+=t,this.sinceLastParticle>=s&&(this.sinceLastParticle-=s,this.launchParticle(e))},launchParticle:function(e){var i=null,s=0,n=null,r=this.owner.orientation-o+this.ifHorizontal;if(this.smokeParticles.length>0)(i=this.smokeParticles.pop()).x=this.owner.x-32*Math.cos(r),i.y=this.owner.y+32*Math.sin(-r),i.z=this.owner.z-.01;else{for(s=0;s<10;s++)n={type:"smoke-particle",properties:{x:this.owner.x-32*Math.cos(r),y:this.owner.y+32*Math.sin(-r),z:this.owner.z-.01,rocket:this.owner}},i=this.owner.parent.addEntity(n),this.smokeParticles.push(i);i=this.smokeParticles.pop()}t.fuel=e,t.orientation=this.owner.orientation+o+this.ifHorizontal,t.velocity=this.owner.body.GetLinearVelocity(),i.triggerEvent("launch",t)}},publicMethods:{getFuel:function(){return this.fuel}}})}(),function(){"use strict";var t=include("platypus.Vector"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),s=function(t,e){return t*t+e*e},n={x:0,y:0},o={points:[n,n,n,n,n,n,n,n]},r=1+Math.SQRT2;platypus.createComponentClass({id:"Rod",properties:{faceUpward:!1,maximum:500,minimum:50,width:100,height:40,unpinnable:!1},publicProperties:{z:0,pointA:null,pointB:null,shape:null,trussLength:0,rotation:0,stretchLength:0,movable:!0},initialize:function(){var t,e=this.shape||o,i=this.owner.parent,s=e.points,n=s.length;for(this.shape={points:[]};n--;)this.shape.points.unshift({x:s[n].x,y:s[n].y});this.unpinnable&&this.movable&&(this.unpinnable=!1),this.onlyRemovingComponentSoDontDropThePins=!1,this.trussLength=this.trussLength||this.owner.width||this.minimum,t=this.trussLength/2,this.pointA=this.pointA||{x:this.owner.x-t,y:this.owner.y},this.unpinnable||(this.pinA=this.createOrFindPin(this.pointA,i)),this.pointB?this.unpinnable||(this.pinB=this.createOrFindPin(this.pointB,i)):(this.pointB={x:this.owner.x+t,y:this.owner.y},this.unpinnable||(this.pinB=this.createPin(this.pointB,i))),this.graceMargin=platypus.game.app.config.pins.snapGraceMargin,this.originalMax=this.maximum,this.originalMin=this.minimum,this.graceMax=2*this.maximum,this.graceMin=this.minimum/2,this.enactAdjustment(),this.owner.matchBodyToEntity(),this.unpinnable||(this.pinA.attach(this.owner,!0,!1),this.pinB.attach(this.owner,!0,!1)),this.inMotion=!1},events:{"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.RodFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.unpinnable||(t.entity===this.pinA?this.tryAdjustment(this.pinA,this.pinB,t):t.entity===this.pinB?this.tryAdjustment(this.pinB,this.pinA,t):platypus.debug.warn("Something odd occurred: notified about an unattached constraint movement."))},"pin-moved":function(){var t=this.pinA,e=this.pinB,i=this.pointA,s=this.pointB;t.x===i.x&&t.y===i.y&&e.x===s.x&&e.y===s.y||this.enactAdjustment()},"resolve-bodies":function(){this.owner.matchBodyToEntity()},"resolve-joints":function(){this.unpinnable||(this.pinA.resetJoints(),this.pinB.resetJoints())},"update-group-id":function(t){this.owner.groupId=t,this.unpinnable||(t!==this.pinA.groupId&&this.pinA.triggerEvent("update-group-id",t),t!==this.pinB.groupId&&this.pinB.triggerEvent("update-group-id",t))},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){var e=this.closestPin(t);this.unpinnable||(e===this.pointA?this.pinA=t:e===this.pointB?this.pinB=t:platypus.debug.warn("Rod: uh, this is odd."))},"pin-removed":function(t){t===this.pinA?this.pinA=null:t===this.pinB?this.pinB=null:platypus.debug.warn("Rod: A pin was removed that cannot be removed so it was not removed.")},"validate-begin-group-movement":function(t){this.unpinnable||t.invalid||!this.pinA.inDragGroup&&!this.pinB.inDragGroup||(t.invalid=!0)},"begin-group-movement":function(t){this.unpinnable||(this.pinA.triggerEvent("include-in-group",t),this.pinB.triggerEvent("include-in-group",t),this.inMotion=!0,this.owner.movable&&(this.pinA.immobile||this.pinB.immobile)?(this.pinA.split(this.owner),this.pinB.split(this.owner)):this.prepareForBreakage=!0)},"break-away":function(){this.prepareForBreakage&&(this.prepareForBreakage=!1,this.pinA.split(this.owner),this.pinB.split(this.owner))},"include-in-group":function(){this.prepareForBreakage=!1,this.inMotion=!0},"motion-ended":function(){this.inMotion=!1},"pin-motion-ended":function(){this.minimum=Math.min(this.trussLength,this.originalMin),this.maximum=Math.max(this.trussLength,this.originalMax)},"valid-snap":function(t,e){var i=t.pinFrom,s=t.pinTo;0===e?i===this.pinA?t.snappable=this.pinB.canSnapTo(t,e+1):i===this.pinB&&(t.snappable=this.pinA.canSnapTo(t,e+1)):1===e&&(this.pinA!==s&&this.pinB!==s||(t.snappable=!1))}},methods:{closestPin:function(t){var e=this.pointA,i=this.pointB;return s(e.x-t.x,e.y-t.y)>s(i.x-t.x,i.y-t.y)?i:e},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins);return i&&i!==this.pinA&&i!==this.pinB?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y}})},findPin:function(t,e){var i=platypus.game.app.config.pins.mergeDistance,n=0,o=null,r=e&&e.length,a=i*i,h=null;if(r)for(;r--;)o=e[r],(n=s(o.x-t.x,o.y-t.y))<a&&(a=n,h=o);return h},stretch:function(t,s){var n=this.owner,o=n.body,a=null,h=null,l=null,p=this.shape.points,c=this.pointA,u=this.pointB;if(4===p.length)!function(t,e,i){var s=t[0],n=t[1],o=t[2],r=t[3];s.x=-e,s.y=-i,n.x=e,n.y=-i,o.x=e,o.y=i,r.x=-e,r.y=i}(p,t/2,s/2);else if(6===p.length)!function(t,e,i){var s=t[0],n=t[1],o=t[2],r=t[3],a=t[4],h=t[5];s.x=-e,s.y=-i,n.x=e,n.y=-i,o.x=e+i,o.y=0,r.x=e,r.y=i,a.x=-e,a.y=i,h.x=-e-i,h.y=0}(p,t/2,s/2);else{if(8!==p.length)return void platypus.debug.warn(this.owner.type+": This entity is not using a rectangle for stretching.");!function(t,e,i){var s=i/r,n=t[0],o=t[1],a=t[2],h=t[3],l=t[4],p=t[5],c=t[6],u=t[7];n.x=-e-s,n.y=-i,o.x=e+s,o.y=-i,a.x=e+i,a.y=-s,h.x=e+i,h.y=s,l.x=e+s,l.y=i,p.x=-e-s,p.y=i,c.x=-e-i,c.y=s,u.x=-e-i,u.y=-s}(p,t/2,s/2)}n.x=(c.x+u.x)/2,n.y=(c.y+u.y)/2,o&&(l={},h=o.GetFixtureList(),0!==e(h)&&(a=h.GetFilterData(),l.filter={categoryBits:a.get_categoryBits(),groupIndex:a.get_groupIndex(),maskBits:a.get_maskBits()},l.density=h.GetDensity(),l.friction=h.GetFriction(),l.restitution=h.GetRestitution(),l.isSensor=h.IsSensor(),l.userData=i(h),o.DestroyFixture(h)),this.owner.createFixture(l,{}))},tryAdjustment:function(e,i,n){var o,r=null,a=n.position,h=a.x,l=a.y,p=null,c=this.minimum,u=this.maximum;this.inMotion||(this.owner.movable?(n.forSnap&&((c-=this.graceMargin)<this.graceMin&&(c=this.graceMin),(u+=this.graceMargin)>this.graceMax&&(u=this.graceMax)),(o=Math.sqrt(s(h-i.x,l-i.y)))<c?(p=t.setUp(i.x,i.y),n.adjusted=r=t.setUp(h,l),r.subtractVector(p).normalize(),0!==r.magnitude()?r.multiply(c).addVector(p):(r.x=c,r.addVector(p))):o>u&&(p=t.setUp(i.x,i.y),n.adjusted=r=t.setUp(h,l),r.subtractVector(p).normalize(),r.multiply(u).addVector(p))):n.adjusted=t.setUp(e.x,e.y))},enactAdjustment:function(){var t=this.owner,e=this.pinA,i=this.pinB,n=this.pointA,o=this.pointB,r=e?n.x=e.x:n.x,a=e?n.y=e.y:n.y,h=(i?o.x=i.x:o.x)-r,l=(i?o.y=i.y:o.y)-a,p=Math.sqrt(s(h,l)),c=Math.atan(l/h);!this.faceUpward&&h<0&&(c+=Math.PI),this.stretch(p,this.height),t.orientation=c,this.trussLength=p,this.stretchLength=p,this.rotation=180*c/Math.PI},destroy:function(){var t=this.pinA,e=this.pinB;this.onlyRemovingComponentSoDontDropThePins||(t&&!t.destroyed&&t.detachPermanently(this.owner),e&&!e.destroyed&&e.detachPermanently(this.owner))}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"RodFrozen",initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.pinA=null,t.pinB=null,t.removeComponent(this),t.addComponent(new platypus.components.Rod(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=new t(0,0);platypus.createComponentClass({id:"SailLogic",properties:{},publicProperties:{},initialize:function(){this.owner.state.set("high",!1),this.owner.state.set("full",!1),this.owner.state.set("is-raised",!1),this.owner.state.set("was-high",!1),this.fullTimer=0,this.forceVector=null},events:{"handle-logic":function(t){var e=t.delta;this.simulating&&this.fullTimer&&(this.fullTimer-=e,this.fullTimer<=0?(this.fullTimer=0,this.owner.state.set("full",!1)):this.owner.body.ApplyForce(this.forceVector,this.owner.body.GetWorldCenter(),!0))},"simulation-started":function(){var e=this.owner.parent.getEntitiesByType("sail").length;this.forceVector=new t(.16/(e+1),0),this.simulating=!0},"simulation-stopped":function(){this.fullTimer=0,this.owner.state.set("full",!1),this.owner.state.set("high",!1),this.owner.state.set("is-raised",!1),this.owner.state.set("was-high",!1),this.simulating=!1,this.owner.body.SetLinearVelocity(e),this.owner.body.SetAngularVelocity(0),this.owner.body.SetAwake(!1)},"sail-up":function(){this.simulating&&(this.owner.state.set("high",!0),this.owner.state.set("was-high",!1))},"sail-down":function(){this.simulating&&(this.fullTimer=0,this.owner.state.get("high")&&this.owner.state.set("was-high",!0),this.owner.state.set("full",!1),this.owner.state.set("high",!1),this.owner.state.set("is-raised",!1))},"caught-wind":function(){this.simulating&&this.owner.state.get("high")&&(this.owner.state.set("full",!0),this.owner.state.set("is-raised",!0),this.fullTimer=2500)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),s=include("PIXI.spine.core.TextureAtlas",!1),n=include("PIXI.spine.core.AtlasAttachmentLoader",!1),o=include("PIXI.BaseTexture"),r=include("PIXI.spine.core.SkeletonJson",!1),a=include("PIXI.spine.Spine",!1),h=function(){var t=platypus.game.app,e=t.config.platypus;t.transition=new a(new r(new n(new s(e.atlases["ScreenBadge_Standard-"+platypus.modifyAllAssets],function(t,e){var i,s;e((i=t,(s=platypus.game.app.assetManager.cache.read(i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."))))||platypus.debug.warn('SavedGameChecker: "'+i+'" is not a loaded asset.'),new o(s)))}))).readSkeletonData(e.skeletons.ScreenBadge_Standard)),t.transition.children[0].mask=t.transition.children[2].children[0],platypus.savedWidth&&platypus.savedHeight&&(t.transition.x=platypus.savedWidth/2,t.transition.y=platypus.savedHeight/2,t.transition.scale.x=t.transition.scale.y=platypus.savedHeight/880),t.transition.visible=!1};platypus.createComponentClass({id:"SavedGameChecker",events:{"scene-live":function(){var t=platypus.game.app,i=platypus.savedGame;t.transition||e||setTimeout(h,100),i?platypus.game.loadScene("scene-level",{level:i.level}):this.owner.triggerEvent("relocate",{x:0,y:0}),springroll.Debug&&(this.owner.addEntity("debug-reset"),this.owner.addEntity("debug-unlock"))},"unlock-levels":function(){var t=platypus.game.app,e=t.userData;e.write("Completed-Levels",["e-sunspot-snap-tutorial","e-wheel-snap-tutorial","e-block-snap-tutorial","e-bumpy-hill","e-jump","e-pot-holes","e-hill-climb","e-climb-and-coast","l-plinko","l-hill-climb-pit-stop","l-solar-two","l-first-rocket","l-horizontal-rockets","l-rocket-steps","m-wind-storm","m-wind-storm-2","m-ceiling-rockets","m-back-and-forth","eur-ice-pond","eur-tread-two","eur-ice-and-rockets","eur-slip-and-slide"]),e.write("Completed-Earth",!0),e.write("Completed-Moon",!0),e.write("Completed-Mars",!0),e.write("Completed-All",!0),t.sound.play("badge-tada")},"reset-game":function(){var t=platypus.game.app,e=t.userData;e.remove("Completed-Levels"),e.remove("Recently-Completed-Level"),e.remove("LevelSaves"),e.remove("Unbroken-Levels"),e.remove("Small-Car-Levels"),e.remove("No-Wheels-Levels"),e.remove("Stars-Collected"),e.remove("Last-Page"),e.remove("Introduced-Earth"),e.remove("Completed-Earth"),e.remove("Completed-Moon"),e.remove("Completed-Mars"),e.remove("Completed-All"),t.sound.play("reset"),t.sound.play("snap-photo")}},getAssetList:function(){return springroll.Debug?i.getAssetList({type:"debug-reset"}):Array.setUp()}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=0;platypus.createComponentClass({id:"SavedGameLister",properties:{},publicProperties:{},initialize:function(t,e){var i=platypus.game.app,s=platypus.game.app.config.journal;return this.saves=null,this.savesTotal=0,this.saveTime=Date.now(),this.buttons=[],this.owner.parent.app.userData.read(s.storageKey,function(t){var i=platypus.game.app,n=0,o=this.buttons,r=s.maxSavesPerGame;for(this.saves=t,n=0;n<r;n++)t&&t[n]?o.push(this.addSave(t[n],0,0,n)):o.push(this.addEmpty(0,0));this.tableColumns=this.tableColumns||3,this.updateLocations(),i.googleAnalytics.event(i.name,"EnterSaveMenu","NumberOfSaves",this.savesTotal),e()}.bind(this)),i.music="jam",i.musicInstance.volume=.5,platypus.badger.increment("tried-journal"),!0},events:{"camera-update":function(t){var e=t.viewport,i=e.width/e.height>1.766?3:2;this.tableColumns!==i&&(this.tableColumns=i,this.updateLocations())},"scene-loaded":function(t){var e=t.insertSave,i=null,s=this.owner.getEntitiesByType("journal-insert")[0];e?(this.insertSave=e,this.savedEntry=this.addSave(e,0,s.y,-1,function(){this.triggerEvent("insert-incoming")}.bind(this.owner),s.cameraSizes),(i=this.savedEntry.deletes).scaleX=.5,i.scaleY=.5,i.z=20,i.on("handle-render",function(t){t.x=this.x+135}.bind(i,this.savedEntry)),this.savedEntry.y=-550,this.savedEntry.z=30):this.saves&&this.saves.length?this.owner.triggerEvent("journal-some"):this.owner.triggerEvent("journal-none")},"return-to-game":function(){this.returnToGame&&this.returnToGame.deletes.triggerEvent("new-scene")},"delete-me":(t=function(t){this.removeEntity(t.deletes),this.removeEntity(t)},function(e){var i=platypus.game.app,s=i.userData,n=e.entity,o=this.savedEntry,r=i.config.journal;if(o){if(-1===n.deletes.saveIndex)return void n.deletes.triggerEvent("new-scene");this.saves[n.deletes.saveIndex]=this.insertSave,this.buttons[n.deletes.saveIndex]=this.returnToGame=this.addSave(this.insertSave,n.deletes.x,n.deletes.y,n.deletes.saveIndex),o.on("prepare-logic",t.bind(this.owner,o)),this.insertSave=null,this.savedEntry=null,this.owner.triggerEvent("inserted-save")}else this.saves[n.deletes.saveIndex]=null,this.buttons[n.deletes.saveIndex]=this.addEmpty(n.deletes.x,n.deletes.y);try{s.write(r.storageKey,this.saves)}catch(t){this.saves[n.deletes.saveIndex]&&(this.saves[n.deletes.saveIndex].thumbnail=null,s.write(r.storageKey,this.saves))}n.on("prepare-logic",t.bind(this.owner,n))})},methods:{addEmpty:function(t,e){var i=platypus.game.app.config.journal.thumbnail;return this.owner.addEntity({type:"saved-game-empty",properties:{width:i.width,height:i.height,x:t,y:e,z:8}})},addSave:function(t,s,n,o,r,a){var h=null,l=null,p=new Image,c=platypus.game.app.config.journal,u=platypus.modifyAllAssets,d=c.thumbnail.width/2,g=c.thumbnail.height/2,m=d/2,y=g/2;return this.savesTotal+=1,r&&(h=function(t,e){t.count-=1,t.count||(t.recycle(),e())}.bind(null,e.setUp("count",2),r)),t.thumbnail?p.src=t.thumbnail:p="thumbnail-backup",l=this.owner.addEntity({type:"saved-game-button",properties:{x:s,y:n,z:15,cameraSizes:a,spriteSheet:{id:"saved-ss-"+i,images:[p],frames:[[0,0,d*u,g*u,0,m*u,y*u]]},persistentData:{level:t.level},events:null,saveIndex:o}},h),i+=1,l.components[l.components.length-3].sprite.scale.x=2,l.components[l.components.length-3].sprite.scale.y=2,this.owner.addEntity({type:"delete-saved-game-button",properties:{deletes:l,x:s+m,y:n-y,z:16}},h)},updateLocations:function(){for(var t=this.buttons,e=null,i=t.length,s=platypus.game.app.config.journal,n=s.thumbnail.width,o=n/2,r=s.thumbnail.height,a=r/2,h=s.maxSavesPerGame,l=this.tableColumns,p=(h/l-1)/2,c=0,u=0,d=s.spacing+n,g=s.spacing+r;i--;)c=(i%l-(l-1)/2)*d,u=((i/l>>0)-p)*g,(e=t[i]).deletes&&(e.x=c+o,e.y=u-a,e=e.deletes),e.x=c,e.y=u,e.totalSaves=this.savesTotal},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitSaveMenu","SaveMenuTime",Date.now()-this.saveTime>>0)}},getAssetList:function(){return Array.setUp("assets/images/delete-button.png","assets/images/journal-frame.png","assets/images/thumbnail-backup.png")}})}(),function(){"use strict";var t=include("platypus.Data");platypus.createComponentClass({id:"SceneChanger",properties:{scene:"",persistentData:null},initialize:function(){this.persistentData=t.setUp(this.persistentData),this.loadingScene=!1},events:{"new-scene":function(t){var e=t||this,i=e.scene||this.scene,s=e.persistentData||this.persistentData;this.loadingScene||(this.loadingScene=!0,platypus.game.loadScene(i,s))},"set-scene":function(t){this.scene=t},"set-persistent-scene-data":function(t){var e=this.persistentData,i="";for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}},methods:{destroy:function(){}}})}(),function(){"use strict";platypus.createComponentClass({id:"Scroller",properties:{direction:""},publicProperties:{},initialize:function(){this.show=this.owner.left,this.hide=-this.owner.left},events:{adopted:function(){this.owner.state.set(this.direction,!0)},pointerdown:function(){this.owner.parent.triggerEvent("scroll-"+this.direction),this.owner.state.set(this.direction,!1),this.owner.state.set(this.direction+"-pressed",!0)},pointerup:function(){this.release()},pointerupoutside:function(){this.release()},pointercancel:function(){this.release()},pointerover:function(){this.owner.state.set("hover",!0)},pointerout:function(){this.owner.state.set("hover",!1)},"hide-sprite":function(){this.release()},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{release:function(){this.owner.state.set(this.direction+"-pressed",!1),this.owner.state.set(this.direction,!0)}},publicMethods:{}})}(),function(){"use strict";var t=2,e={pointA:"json",pointB:"json",radius:"string",renderGroup:"string",stretchLength:"string",trussLength:"string"},i=include("Box2D.b2Vec2"),s=include("Box2D.destroy"),n=include("Box2D.getPointer"),o=function(t,e,i,s){switch(t){case"json":r(e,i,s);break;default:a(e,i,s)}},r=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:JSON.stringify(e[i])})},a=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:e[i]+""})};platypus.createComponentClass({id:"Sim",properties:{},publicProperties:{movable:!0,savable:!1,inBuildingArea:!1,interactive:!1,simulating:!1},initialize:function(){this.allowSleep=!1,this.sensors=Array.setUp(),this.activeType=0,this.snapShot=null},events:{load:function(){!this.simulating&&this.movable||this.owner.triggerEvent("remove-dragging",!0,this.simulating)},"box2d-body-initialized":function(){var e=this.owner.body,i=e.GetFixtureList(),s=this.sensors;if(!this.simulating)for(e.IsSleepingAllowed()&&(this.allowSleep=!0,e.SetSleepingAllowed(!1)),this.activeType=e.GetType(),this.interactive&&this.activeType!==t&&(e.SetType(t),this.owner.parent.buildingArea&&(this.inBuildingArea=this.owner.parent.buildingArea.body.GetFixtureList().TestPoint(e.GetPosition())));0!==n(i);)s.push(i.IsSensor()),i.SetSensor(!0),i=i.GetNext()},"retrieve-save-state":function(t,i){var s=null;(this.savable||i&&"boolean"==typeof this.owner.movable&&!this.owner.neverSave)&&(s=function(t,i){var s=e,n="",r=[],a={height:t.height||0,id:0,name:"",properties:r,rotation:t.rotation||0,type:t.type,visible:!0,width:t.width||0,x:t.x||0,y:t.y||0},h=!1;for(n in r.push({name:"z",type:"string",value:t.z%1e3}),t.shape&&t.saveShape?t.shape.points?(h=!0,a.polygon=t.shape.points):(r.push({name:"shape",type:"string",value:JSON.stringify(t.shape)}),"circle"===t.shape.type&&(a.ellipse=!0,a.width=2*t.shape.radius,a.height=2*t.shape.radius),a.x-=a.width/2,a.y-=a.height/2):(a.x-=a.width/2,a.y-=a.height/2),h||t.width||t.height||(a.point=!0),s)s.hasOwnProperty(n)&&o(s[n],r,t,n);return!i&&t.savable&&r.push({name:"savable",type:"string",value:"true"}),i&&t.movable&&r.push({name:"movable",type:"string",value:"false"}),a}(this.owner,i),t.push(s)),this.owner.snapShot=this.snapShot={rotation:this.owner.rotation,x:this.owner.x,y:this.owner.y}},"restore-save-state":function(){var t,e;this.snapShot?(t=this.owner,e=this.snapShot,t.x=e.x,t.y=e.y,t.rotation=e.rotation,t.body&&t.body.SetActive(!0)):this.savable&&this.owner.parent.removeEntity(this.owner)},"simulation-started":function(){var e=this.owner.body,i=null,s=this.sensors,o=0;if(!this.simulating&&e)for(this.simulating=!0,this.interactive&&this.activeType!==t&&e.SetType(this.activeType),this.allowSleep&&e.SetSleepingAllowed(!0),i=e.GetFixtureList();0!==n(i);)i.SetSensor(s[o]),o+=1,i=i.GetNext();this.owner.triggerEvent("prepare-for-simulation"),this.owner.triggerEvent("remove-dragging",!1,!0)},"simulation-stopped":function(){var e=this.owner.body,o=null,r=null;if(this.simulating&&e)for(this.simulating=!1,this.interactive&&this.activeType!==t&&e.SetType(t),this.allowSleep&&e.SetSleepingAllowed(!1),r=new i(0,0),e.SetAngularVelocity(0),e.SetLinearVelocity(r),this.owner.orientation=0,this.owner.matchBodyToEntity(),s(r),o=e.GetFixtureList();0!==n(o);)o.SetSensor(!0),o=o.GetNext();this.owner.triggerEvent("restore-dragging",!1,!0)}},methods:{destroy:function(){this.sensors.recycle(),this.sensors=null}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"SmokeParticleLogic",properties:{rocket:null},publicProperties:{},initialize:function(){this.lifetime=1e3,this.active=!1,this.linearVelocity=new t(0,0),this.angularVelocity=0,this.owner.state.set("particle-0",!1),this.owner.state.set("particle-1",!1),this.owner.state.set("particle-2",!1),this.owner.scaleX=.6,this.owner.scaleY=.6,this.owner.tint="#ffffff"},events:{"handle-logic":function(t){var e=0,i=t.delta;this.active&&(this.lifetime-=t.delta,e=this.lifetime/1e3,this.lifetime<=0?this.recycleMe():(this.owner.opacity=e,this.owner.scaleX=.6+1.25*(1-e),this.owner.scaleY=.6+1.25*(1-e),this.owner.x+=this.linearVelocity.get_x()*i,this.owner.y+=this.linearVelocity.get_y()*i,this.linearVelocity.op_mul(.97),this.owner.rotation+=this.angularVelocity*i))},launch:function(t){var e=t.fuel,i=Math.random()+Math.random()-1,s=t.orientation+i*Math.PI/4,n=.3*(1-Math.abs(i))+.04,o=Math.floor(3*Math.random());this.active||(this.active=!0,this.owner.opacity=1,this.owner.state.set("particle-"+o,!0),this.owner.z+=.005*i,e<.1?this.owner.tint="#444444":e<.2?this.owner.tint="#777777":e<.3?this.owner.tint="#999999":e<.4?this.owner.tint="#aaaaaa":e<.5&&(this.owner.tint="#dddddd"),this.linearVelocity.Set(Math.cos(s)*n,Math.sin(s)*n),this.angularVelocity=i)},"simulation-stopped":function(){this.recycleMe()}},methods:{recycleMe:function(){this.lifetime=1e3,this.owner.x=-1e3,this.owner.y=-1e3,this.owner.scaleX=.6,this.owner.scaleY=.6,this.owner.tint="#ffffff",this.active=!1,this.opacity=0,this.owner.state.set("particle-0",!1),this.owner.state.set("particle-1",!1),this.owner.state.set("particle-2",!1),this.linearVelocity.Set(0,0),this.angularVelocity=0,this.rocket.triggerEvent("recycle-particle",this.owner)}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SolarPanelLogic",properties:{},publicProperties:{},initialize:function(){this.sunCount=0,this.chargeAmount=.0015,this.owner.state.set("charging",!1)},events:{"handle-logic":function(){this.sunCount&&this.owner.chargeBattery(this.chargeAmount)},"in-the-sun":function(){this.sunCount+=1,this.sunCount>0&&(this.owner.state.set("charging",!0),this.owner.triggerEvent("charge-sfx"))},"out-of-the-sun":function(){this.sunCount-=1,this.sunCount<=0&&(this.owner.state.set("charging",!1),this.owner.triggerEvent("stop-audio"))}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Entity");platypus.createComponentClass({id:"SparkleArea",properties:{spawn:null,spawnCount:10,interval:1e3},initialize:function(){this.readyToUse=Array.setUp(),this.inUse=Array.setUp(),this.time=0,this.spawnCount=platypus.supports.mobile?4:this.spawnCount},events:{adopted:function(){var t=0,e=null;for(t=0;t<this.spawnCount;t++)e=this.owner.parent.addEntity({type:this.spawn,properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z+1e-4*t}}),this.readyToUse.push(e)},"handle-logic":function(t){var e=t.delta,i=null;this.time+=e,this.time>this.interval&&(this.readyToUse.length>0?(this.time-=this.interval,(i=this.readyToUse.pop()).x=this.owner.x-(this.owner.regX||0)+Math.random()*this.owner.width,i.y=this.owner.y-(this.owner.regY||0)+Math.random()*this.owner.height,i.triggerEvent("start"),this.inUse.push(i)):this.time=this.interval)},finished:function(t){var e=0,i=null;for(e=0;e<this.inUse.length;e++)if(this.inUse[e]===t){i=this.inUse.splice(e,1)[0];break}i&&this.readyToUse.push(i)}},methods:{destroy:function(){this.readyToUse.recycle(),this.inUse.recycle()}},getAssetList:function(e,i,s){var n=e.spawn||i.spawn||s.spawn;return n?t.getAssetList({type:n}):Array.setUp()}})}(),function(){"use strict";platypus.createComponentClass({id:"SparkleLogic",properties:{},publicProperties:{},initialize:function(){},events:{done:function(){this.owner.triggerEvent("rl-finished",this.owner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"StarLogic",properties:{},publicProperties:{},initialize:function(t,e){var i=0,s=null;for(this.previouslyCollected=!1,this.canCollect=!1,this.collected=!1,this.owner.opacity=0,this.startingScale=this.owner.scaleX,this.collectedOpacity=.4,this.particles=[],i=0;i<12;i++)s={type:"star-particle",properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z-.01}},this.particles.push(this.owner.parent.addEntity(s));return this.levelId=null,this.starsCollected=[],platypus.game.app.userData.read("Stars-Collected",function(t){t?this.starsCollected=t:platypus.game.app.userData.write("Stars-Collected",this.starsCollected),e()}.bind(this)),!0},events:{"scene-live":function(t){this.levelId="string"==typeof t.level?t.level:t.level.properties.levelId,-1!==this.starsCollected.indexOf(this.levelId)?(this.previouslyCollected=!0,this.owner.opacity=this.collectedOpacity):this.owner.opacity=1},adopted:function(){this.owner.triggerEvent("dance")},collected:function(){var i=0,s=0,n=2*Math.PI/this.particles.length;if(this.canCollect){for(this.canCollect=!1,this.owner.triggerEvent("play-star"),this.owner.triggerEvent("collect-animation"),this.owner.parent.triggerEvent("star-collected"),i=0;i<this.particles.length;i++)this.particles[i].opacity=.5,t.get(this.particles[i]).to({x:this.owner.x+300*Math.cos(s),y:this.owner.y+300*Math.sin(s),opacity:0},900,e.circOut),s+=n;this.collected=!0}},"simulation-started":function(){this.canCollect=!0},"simulation-stopped":function(){var e=0;for(this.canCollect=!1,t.removeTweens(this.owner),this.owner.rotation=0,this.owner.scaleX=this.startingScale,this.owner.scaleY=this.startingScale,this.previouslyCollected?this.owner.opacity=this.collectedOpacity:this.owner.opacity=1,this.owner.triggerEvent("dance"),e=0;e<this.particles.length;e++)t.removeTweens(this.particles[e]),this.particles[e].x=this.owner.x,this.particles[e].y=this.owner.y,this.particles[e].opacity=0},"level-is-complete":function(){this.collected&&!this.previouslyCollected&&(this.starsCollected.push(this.levelId),platypus.game.app.userData.write("Stars-Collected",this.starsCollected),this.previouslyCollected=!0)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t,e,i=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?(?:(([^\/?]+)\.(\w+))|([^\/?]+))(?:\?((?:(?:[^&]*?[\/=])?(?:((?:(?:[^\/?&=]+)\.(\w+)))\S*?)|\S+))?)?$/,s=include("platypus.AABB"),n=include("platypus.Data"),o=include("platypus.Entity"),r=(t=function(t,e){return t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24)>>>0},e=function(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0},function(i,s){var n=4,o=[],r=atob(i.replace(/\\/g,""));if("zlib"===s)for(r=pako.inflate(r);n<=r.length;)o.push(e(r,n-4)),n+=4;else for(;n<=r.length;)o.push(t(r,n-4)),n+=4;return o}),a=function(t){var e=t.match(i);return e[5]||e[7]},h=function(t){for(var e=1;e<t;)e*=10;return e},l={x:1,y:1,id:-1},p=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},c=function(t,e,i){var s=0;if(t)if(Array.isArray(t)){for(s=t.length;s--;)if(t[s].name===e)return t[s].type=typeof i,void(t[s].value=i);t.push({name:e,type:typeof i,value:i})}else t[e]=i},u=function(t,e){var i,s,n,o,r=0,a=t.gid||-1,h={},p={gid:-1,transform:null,properties:h,type:""},c=null,u=null,g=0;for(-1!==a&&(p.transform=(n=!!(1073741824&(i=a)),o=!!(2147483648&i),(s=l).id=268435455&i,s.x=1,s.y=1,n&&(s.y=-1),o&&(s.x=-1),s),a=p.gid=l.id),r=0;r<e.length&&!(e[r].firstgid>a);r++)u=e[r];if(u&&(g=a-u.firstgid,u.tileproperties&&u.tileproperties[g]&&(c=u.tileproperties[g]),u.tiles))for(p.type="",r=0;r<u.tiles.length;r++)if(u.tiles[r].id===g){p.type=u.tiles[r].type;break}return p.type=t.type||p.type,""===p.type&&(t.name?(p.type=t.name,platypus.debug.warn('Component TiledLoader (loading "'+p.type+'"): Defining the entity type using the "name" property has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):c&&(c.entity?(p.type=c.entity,platypus.debug.warn('Component TiledLoader (loading "'+p.type+'"): Defining the entity type using the "entity" property in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):c.type&&(p.type=c.type,platypus.debug.warn('Component TiledLoader (loading "'+p.type+'"): Defining the entity type in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')))),p.type?(p.transform?(h.scaleX=p.transform.x,h.scaleY=p.transform.y):(h.scaleX=1,h.scaleY=1),d(c,p.properties),d(t.properties,p.properties),p):null},d=function(t,e){var i=0,s="";if(t&&e)if(Array.isArray(t))for(i=0;i<t.length;i++)c(e,t[i].name,g(t[i].value));else for(s in t)t.hasOwnProperty(s)&&c(e,s,g(t[s]));return e},g=function(t){var e=0;if("string"==typeof t){if(0===(e=parseFloat(t))||e)return e;if("true"===t)return!0;if("false"===t)return!1;if(t.length>1&&("{"===t[0]&&"}"===t[t.length-1]||"["===t[0]&&"]"===t[t.length-1]))try{return JSON.parse(t)}catch(t){}}return t},m=function(t,e){var i=0,s=0,r=Array.setUp(),a=null,h=Array.setUp(),l=null,c=null,d=null;if("string"==typeof t&&(t=platypus.game.settings.levels[t]),t)if(t.tilesets&&(t.tilesets=w(t.tilesets)),t.assets)h.union(t.assets);else if(t.layers){for(i=0;i<t.layers.length;i++)if("objectgroup"===t.layers[i].type)for(s=0;s<t.layers[i].objects.length;s++)(c=u(t.layers[i].objects[s],t.tilesets))&&(d=o.getAssetList(c),h.union(d),d.recycle());else"imagelayer"===t.layers[i].type?h.union([t.layers[i].image]):(c=p(t.layers[i].properties,"entity"))&&(l=n.setUp("type",c),a=o.getAssetList(l),h.union(a),a.recycle(),l.recycle());if(!e){for(i=0;i<t.tilesets.length;i++)r.push(t.tilesets[i].image);h.union(r),r.recycle()}t.assets=h.greenSlice()}return h},y={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]}},f=function(t){var e="",i=platypus.game.settings.levels[t.source.replace(".json","")];for(e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return delete t.source,t},w=function(t){var e=0;for(e=0;e<t.length;e++)t[e].source&&(t[e]=f(t[e]));return t};platypus.createComponentClass({id:"TiledLoader",properties:{offsetMap:!1,showCollisionTiles:!1,images:null,layerIncrement:1e3,separateTiles:!1,spriteSheet:null},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},initialize:function(){this.assetCache=platypus.game.app.assetManager.cache,this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(t,e){this.manuallyLoad||(e.count+=1,this.loadLevel({level:this.level||t.level,persistentData:t},e.release))},"load-level":function(t,e){this.loadLevel(t,e)}},methods:{createLayer:function(t,e,i,s,n,r,a,h,l,c){var u=null,g=null,m=e.width,f=e.height,w=e.tileheight||r,v=e.tilewidth||n,b=0,x=0,E=0,C=0,S=0,A=JSON.parse(JSON.stringify(platypus.game.settings.entities[t]||y[t])),k={},P=[],T=[],B=[],M={images:e.image?[e.image]:h,frames:T,animations:k},L=!1,D=null,I=null,z=0,U=0,O=0,_="",X=null,F=function(t,e,i,s){var n=i.margin||0,o=i.spacing||0,r=i.tilewidth,a=i.tileheight,h=r/2,l=a/2,p=r+o,c=a+o,u=2*n-o,d=i.columns||i.imagewidth/p+u>>0,g=i.imageheight/c+u>>0,m=0,y=0;for(r*=s,a*=s,h*=s,l*=s,p*=s,c*=s,y=0;y<g;y++)for(m=0;m<d;m++)t.push([n+m*p,n+y*c,r,a,e,h,l])};if(this.decodeLayer(e),X=e.data,i+=e.offsetx||0,s+=e.offsety||0,A.properties=A.properties||{},e.properties){if((C=p(e.properties,"width"))&&(b=parseInt(C,10)),(E=p(e.properties,"height"))&&(x=parseInt(E,10)),b||x){for(b=b||m,x=x||f,X=[],U=0;U<b;U++)for(O=0;O<x;O++)X[U+O*b]=U<m&&O<f?e.data[U+O*m]:0;m=b,f=x}d(e.properties,A.properties)}if("collision-layer"===t)for(I=[],U=0;U<a.length;U++)if((D=a[U]).tileproperties)for(_ in D.tileproperties)D.tileproperties.hasOwnProperty(_)&&D.tileproperties[_].jumpThrough&&I.push(D.firstgid+parseInt(_,10));if(A.properties.width=v*m*this.unitsPerPixel,A.properties.height=w*f*this.unitsPerPixel,A.properties.columns=m,A.properties.rows=f,A.properties.tileWidth=v*this.unitsPerPixel,A.properties.tileHeight=w*this.unitsPerPixel,A.properties.scaleX=this.imagesScale,A.properties.scaleY=this.imagesScale,A.properties.layerZ=this.layerZ,A.properties.left=A.properties.x||i,A.properties.top=A.properties.y||s,A.properties.z=A.properties.z||this.layerZ,a.length){for(U=0;U<a.length;U++)F(T,U,a[U],this.unitsPerPixel/this.imagesScale);for(S=(u=a[a.length-1]).firstgid+u.tilecount,U=-1;U<S;U++)k["tile"+U]=U}for(U=0;U<m;U++)for(P[U]=[],B[U]=[],O=0;O<f;O++)z=+X[U+O*m]-1,B[U][O]="tile"+z,z+=1,I&&I.length&&I[0]===(268435455&z)&&(z|=268435456),P[U][O]=z;for(U=0;U<A.components.length;U++)"RenderTiles"===A.components[U].type&&(L=A.components[U]),"import"===A.components[U].spriteSheet?A.components[U].spriteSheet=M:A.components[U].spriteSheet&&("string"==typeof A.components[U].spriteSheet&&platypus.game.settings.spriteSheets[A.components[U].spriteSheet]&&(A.components[U].spriteSheet=platypus.game.settings.spriteSheets[A.components[U].spriteSheet]),A.components[U].spriteSheet.animations||(A.components[U].spriteSheet.animations=k)),"import"===A.components[U].collisionMap&&(A.components[U].collisionMap=P),"import"===A.components[U].imageMap&&(A.components[U].imageMap=B);return this.layerZ+=this.layerIncrement,"render-layer"===t&&!this.separateTiles&&l&&l.tileHeight===w&&l.tileWidth===v&&l.columns===m&&l.rows===f?(l.triggerEvent("add-tiles",L),this.updateLoadingProgress(c),l):(g={},"render-layer"===t&&this.spriteSheet&&("string"==typeof this.spriteSheet?g.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]:g.spriteSheet=this.spriteSheet,g.spriteSheet.animations||(g.spriteSheet.animations=k)),this.owner.addEntity(new o(A,{properties:g},this.updateLoadingProgress.bind(this,c),this.owner)))},convertImageLayer:function(t){var e,i=null,s=0,n="",o=t.properties||{},r=p(o,"repeat"),h=p(o,"repeat-x"),l=p(o,"repeat-y"),c={data:[],image:"",height:1,name:t.name,type:"tilelayer",width:1,tileheight:1,tilewidth:1,x:t.x,y:t.y,properties:o};for(r&&(c.width=+r,c.height=+r),h&&(c.width=+h),l&&(c.height=+l),e=c.width*c.height,s=0;s<e;s++)c.data.push(1);return(i=this.assetCache.read(t.name))?(c.image=t.name,c.tileheight=i.height,c.tilewidth=i.width):(n=a(t.image),(i=this.assetCache.read(n))?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+t.name+'", so using "'+t.image+'" instead.'),c.image=n,c.tileheight=i.height,c.tilewidth=i.width):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+t.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+t.name+'".'),c.image=t.image)),c.tileset={columns:1,image:c.image,imageheight:c.tileheight,imagewidth:c.tilewidth,margin:0,name:t.name,spacing:0,tilecount:1,tileheight:c.tileheight,tilewidth:c.tilewidth,type:"tileset"},c},loadLevel:function(t,e){var i,o,r,l,c,u,g=!0,m=null,y=0,f="",v=null,b=null,x=null,E=null,C=n.setUp("count",0,"progress",0,"total",0),S=0,A=0;if(i=(m="string"==typeof t.level?platypus.game.settings.levels[t.level]:t.level).layers,r=w(m.tilesets),l=m.tilewidth,c=m.tileheight,m.properties&&d(m.properties,this.owner),0===(v=this.images?this.images.greenSlice():Array.setUp()).length)for(y=0;y<r.length;y++)E=r[y],this.assetCache.read(E.name)?v.push(E.name):(f=a(E.image),this.assetCache.read(f)?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+E.name+'", so using "'+E.image+'" instead.'),v.push(f)):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+E.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+E.name+'".'),v.push(E.image)));for(u=m.width*l*this.unitsPerPixel,o=m.height*c*this.unitsPerPixel,this.offsetMap&&(S=h(u),A=h(o)),C.total=y=i.length;y--;)"objectgroup"===i[y].type?C.total+=i[y].objects.length:!g||"collision"!==i[y].name&&"collision-layer"!==p(i[y].properties,"entity")||(g=!1);for(this.finishedLoading=function(t,e,i,o,r,a,h,l){var p=n.setUp("level",null,"world",s.setUp(),"tile",s.setUp(),"camera",null);p.level=t,p.camera=this.followEntity,p.width=o,p.height=r,p.world.setBounds(e,i,e+o,i+r),p.tile.setBounds(0,0,a,h),this.owner.triggerEvent("world-loaded",p),p.world.recycle(),p.tile.recycle(),p.recycle(),this.owner.removeComponent(this),l&&l()}.bind(this,m,S,A,u,o,l,c,e),y=0;y<i.length;y++)switch((x=i[y]).type){case"imagelayer":b=this.convertImageLayer(x),b=this.createLayer("image-layer",b,S,A,b.tilewidth,b.tileheight,[b.tileset],v,b,C);break;case"objectgroup":this.setUpEntities(x,S,A,l,c,r,C),b=null,this.updateLoadingProgress(C);break;case"tilelayer":b=this.setupLayer(x,g,b,S,A,l,c,r,v,C);break;default:platypus.debug.warn('Component TiledLoader: Platypus does not support Tiled layers of type "'+x.type+'". This layer will not be loaded.'),this.updateLoadingProgress(C)}},setUpEntities:function(t,e,i,s,n,r,a){var h=0,l=0,c=0,d=0,g=0,m=0,y=0,f=null,w=0,v=null,b=null,x=null,E=p(t.properties,"entityPositionX")||this.entityPositionX,C=p(t.properties,"entityPositionY")||this.entityPositionY,S="",A=-1,k=1/0,P=-1/0,T=1/0,B=-1/0,M=null,L=null,D=null,I=0,z=0;for(e+=t.offsetx||0,i+=t.offsety||0,w=0;w<t.objects.length;w++)if(v=t.objects[w],M=u(v,r)){if(A=M.gid,S=M.type,x=(b=platypus.game.settings.entities[S])&&b.properties||null,L=M.properties,v.polygon||v.polyline){for(k=1/0,P=-1/0,T=1/0,B=-1/0,D=null,v.polygon?D=v.polygon:v.polyline&&(D=v.polyline),c=0;c<D.length;c++)D[c].x>P&&(P=D[c].x),D[c].x<k&&(k=D[c].x),D[c].y>B&&(B=D[c].y),D[c].y<T&&(T=D[c].y);if(L.width=P-k,L.height=B-T,L.x=v.x+k,L.y=v.y+T,h=0,l=0,L.width=L.width*this.unitsPerPixel,L.height=L.height*this.unitsPerPixel,L.x=L.x*this.unitsPerPixel+e,L.y=L.y*this.unitsPerPixel+i,v.polygon)for(L.shape={},L.shape.type="polygon",L.shape.points=[],d=0;d<D.length;d++)L.shape.points.push({x:(D[d].x-k)*this.unitsPerPixel+e,y:(D[d].y-T)*this.unitsPerPixel+i});else if(v.polyline)for(L.shape={},L.shape.type="polyline",L.shape.points=[],d=0;d<D.length;d++)L.shape.points.push({x:(D[d].x-k)*this.unitsPerPixel+e,y:(D[d].y-T)*this.unitsPerPixel+i})}else I=s*this.unitsPerPixel,z=n*this.unitsPerPixel,h=0,l=0,L.width=(v.width||0)*this.unitsPerPixel,L.height=(v.height||0)*this.unitsPerPixel,x&&("number"==typeof x.width&&(L.width=x.width,h=I),"number"==typeof x.height&&(L.height=x.height,l=z)),v.point||(L.width||(L.width=I),L.height||(L.height=z),h=h||L.width,l=l||L.height),L.x=v.x*this.unitsPerPixel,L.y=v.y*this.unitsPerPixel,v.rotation&&(g=(v.width||I)/2,m=(v.height||z)/2,y=v.rotation/180%2*Math.PI,f=platypus.Vector.setUp(g,-m).rotate(y),L.rotation=v.rotation,L.x=Math.round(1e3*(L.x+f.x-g))/1e3,L.y=Math.round(1e3*(L.y+f.y+m))/1e3,f.recycle()),"left"===E?L.regX=0:"center"===E?(L.regX=L.width/2,L.x+=h/2):"right"===E&&(L.regX=L.width,L.x+=h),L.x+=e,-1===A&&(L.y+=L.height),"bottom"===C?L.regY=L.height:"center"===C?(L.regY=L.height/2,L.y-=l/2):"top"===C&&(L.regY=0,L.y-=l),L.y+=i,v.ellipse?(L.shape={},L.shape.type="circle",L.shape.width=L.width*this.unitsPerPixel,L.shape.height=L.height*this.unitsPerPixel,L.shape.radius=(L.width+L.height)*this.unitsPerPixel/4):v.width&&v.height&&(L.shape={},L.shape.type="rectangle",L.shape.width=L.width*this.unitsPerPixel,L.shape.height=L.height*this.unitsPerPixel);x?(L.scaleX*=this.imagesScale*(x.scaleX||1),L.scaleY*=this.imagesScale*(x.scaleY||1)):(L.scaleX*=this.imagesScale,L.scaleY*=this.imagesScale),L.layerZ=this.layerZ,L.z?L.z+=this.layerZ:x&&"number"==typeof x.z?L.z=this.layerZ+x.z:L.z=this.layerZ,(v=this.owner.addEntity(new o(b,{properties:L},this.updateLoadingProgress.bind(this,a),this.owner)))&&(v.camera&&(this.followEntity={entity:v,mode:v.camera}),this.owner.triggerEvent("entity-created",v))}else this.updateLoadingProgress(a);this.layerZ+=this.layerIncrement},setupLayer:function(t,e,i,s,n,o,r,a,h,l){var c=!1,u=p(t.properties,"entity"),d=u||"render-layer",g=null,m=0;if(u||("collision"===t.name?d="collision-layer":"action"===t.name&&(d=e?"tile-layer":"render-layer")),"tile-layer"===d||this.showCollisionTiles&&platypus.game.settings.debug)return l.count+=1,this.createLayer("collision-layer",t,s,n,o,r,a,h,i,l),this.createLayer("render-layer",t,s,n,o,r,a,h,i,l);if("collision-layer"===d)return this.createLayer("collision-layer",t,s,n,o,r,a,h,i,l),null;if(g=platypus.game.settings.entities[d])for(m=g.components.length;m--;)if("RenderTiles"===g.components[m].type){c=!0;break}return c?this.createLayer(d,t,s,n,o,r,a,h,i,l):(this.createLayer(d,t,s,n,o,r,a,h,i,l),null)},updateLoadingProgress:function(t){t.count+=1,t.progress=t.count/t.total,this.owner.triggerEvent("level-loading-progress",t),t.count===t.total&&(t.recycle(),this.finishedLoading())},destroy:function(){}},publicMethods:{decodeLayer:function(t){return"base64"===t.encoding&&(t.data=r(t.data,t.compression),t.encoding="csv"),t}},getAssetList:function(t,e,i){var s=e||{},n=i||{},o=t.spriteSheet||s.spriteSheet||n.spriteSheet,r=t.images||s.images||n.images,a=m(t.level||s.level||n.level,o);return o&&("string"==typeof o?a.union(platypus.game.settings.spriteSheets[o].images):a.union(o.images)),r&&a.union(r),a},getLateAssetList:function(t,e,i,s){var n=e||{},o=i||{},r=t.spriteSheet||n.spriteSheet||o.spriteSheet;return s&&s.level?m(s.level,r):Array.setUp()}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("PIXI.Container"),i=include("platypus.Data"),s=include("createjs.Ease"),n=include("platypus.Entity"),o=include("PIXI.Graphics"),r=include("createjs.Tween"),a=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null};platypus.createComponentClass({id:"ToolBoxHandler",properties:{toolBoxHeight:574,toolBoxTop:-287,order:[]},publicProperties:{scrollable:!0},initialize:function(){this.mask=null,this.count=0,this.verticalSpacing=a(platypus.game.settings.entities["toolbox-item"].properties,"height"),this.upperLimit=this.toolBoxTop+this.verticalSpacing/2,this.lowerLimit=this.upperLimit,this.playerResources=Array.setUp(),this.scrollDistance=Math.max(Math.floor(this.toolBoxHeight/this.verticalSpacing)-1,1)*this.verticalSpacing,this.target={y:this.upperLimit},this.scrollTween=null,this.menuItems=[],this.moveToTop=null,platypus.game.app.getResources=function(){return this.playerResources}.bind(this),platypus.game.app.isReallyReady=function(){for(var t=this.owner.getEntitiesByType("toolbox-item"),e=t.length;e--;)if(t[e].count&&!t[e].state.get("infinite"))return!1;return!0}.bind(this)},events:{"child-entity-added":function(t){"scroll-down"===t.type?(this.scrollDown=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop+this.toolBoxHeight):"scroll-up"===t.type&&(this.scrollUp=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop)},"process-level":function(t){for(var e="",s=t.level.properties,n="",o=i.setUp(),r=t.level.layers,h=r.length,l=0,p=null,c=null;h--;)if(c=r[h].objects)for(l=c.length;l--;)(p=c[l]).type&&"true"===a(p.properties,"savable")&&(o[p.type]=(o[p.type]||0)+1);if(Array.isArray(s))for(h=0;h<s.length;h++)"menu."===(n=s[h].name).substring(0,5)?(e=n.substring(5),this.menuItems.push({item:e,count:Number(s[h].value),used:o[e]})):"moveToTop"===n&&(this.moveToTop=s[h].value);else for(n in s)s.hasOwnProperty(n)&&"menu."===n.substring(0,5)&&(e=n.substring(5),this.menuItems.push({item:e,count:Number(s[n]),used:o[e]}));this.composeMenu(),o.recycle(),this.toolbox.y=this.upperLimit,this.lowerLimit=Math.min(this.upperLimit,this.upperLimit-this.count*this.verticalSpacing+this.toolBoxHeight),this.upperLimit===this.lowerLimit?this.scrollable=!1:this.scrollDown.triggerEvent("show-sprite")},"render-world":function(i){var s=i.renderGroups,n=i.world,r=function(t,i,s){for(var n=i.length,o=null;n--;)if(i[n].name===t)return i[n];return(o=new e).name=t,i.push(o),s.addChild(o),o}("toolbox",s,n);r.z=1,this.toolbox=r,this.mask=function(t,e,i){var s=new o;return t.mask=s,s.isMask=!0,s.z=1,e.addChild(s),s.clear(),s.beginFill(0,1),s.r(i.left,i.top,i.width,i.height),s.endFill(),s}(r,n,t.setUp(0,this.toolBoxTop+this.toolBoxHeight/2,2e3,this.toolBoxHeight)),i.world.reorder=!0},"scroll-up":function(){var t=this.target.y+this.scrollDistance;this.swipe||(t>=this.upperLimit&&(t=this.upperLimit),this.scrollTween=r.get(this.target,{override:!0}).to({y:t},300,s.sineInOut))},"scroll-down":function(){var t=this.target.y-this.scrollDistance;this.swipe||(t<=this.lowerLimit&&(t=this.lowerLimit),this.scrollTween=r.get(this.target,{override:!0}).to({y:t},300,s.sineInOut))},swipe:function(t){this.swipe||(r.removeTweens(this.target),this.swipe=function(t,e,i){var s=e-t+i.y;s>=this.upperLimit?(s=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):s<=this.lowerLimit?(s=this.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=s,this.forceCameraUpdate()}.bind(this,t.y,this.toolbox.y)),this.swipe(t)},"end-swipe":function(t){this.swipe&&(this.swipe(t),this.swipe=null)},tick:function(){var t=this.target.y;this.toolbox.y!==t&&(this.swipe?this.target.y=this.toolbox.y:(t>=this.upperLimit?(t=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):t<=this.lowerLimit?(t=this.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=t,this.forceCameraUpdate()))}},methods:{composeMenu:function(){var t=0,e=0,i=null,s=null,n=null,o=this.order.slice();if(this.moveToTop&&o.length){for(n=this.moveToTop.split(","),t=0;t<n.length;t++)for(e=0;e<o.length;e++)if(o[e]===n[t]){o.splice(e,1);break}o=n.concat(o)}for(t=0;t<o.length;t++)for(i=o[t],e=0;e<this.menuItems.length;e++)if(i===(s=this.menuItems[e]).item){this.addMenuItem(s),this.menuItems.splice(e,1);break}for(e=0;e<this.menuItems.length;e++)this.addMenuItem(this.menuItems[e]);this.menuItems=null},addMenuItem:function(t){var e=null,i=null;i={state:e={}},e[t.item]=!0,this.playerResources.push({name:t.item,count:t.count}),-1===t.count?i.infinite=!0:(t.used&&(t.count-=t.used),i.count=t.count),i.y=this.count*this.verticalSpacing,i.spawns=t.item,this.lastEntityAdded=this.owner.addEntity({type:"toolbox-item",properties:i}),this.count+=1},forceCameraUpdate:function(){this.lastEntityAdded&&this.owner.triggerEvent("child-entity-updated",this.lastEntityAdded)},destroy:function(){this.playerResources.recycle(),this.playerResources=null}},publicMethods:{getEntitiesAtPoint:function(e,i){for(var s=t.setUp(),n=Array.setUp(),o=this.owner.entities,r=null,a=o.length;a--;)r=o[a],s.setAll(r.x||0,r.y||0,r.width||0,r.height||0),s.containsPoint(e,i-this.toolbox.y)&&n.push(r);return s.recycle(),n}},getAssetList:function(){return n.getAssetList({type:"toolbox-item"})},getLateAssetList:function(t,e,i,s){var o=null,r=Array.setUp(),a=0,h=s&&s.level,l=null,p="";if("string"==typeof h&&(h=platypus.game.settings.levels[h]),l=h.properties)if(Array.isArray(l))for(a=0;a<l.length;a++)"menu."===(p=l[a].name).substring(0,5)&&(o=n.getAssetList({type:p.substring(5)}),r.union(o),o.recycle());else for(p in l)l.hasOwnProperty(p)&&"menu."===p.substring(0,5)&&(o=n.getAssetList({type:p.substring(5)}),r.union(o),o.recycle());return r}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"TourGuideLogic",properties:{},publicProperties:{},initialize:function(){this.path=[],this.start=null,this.lakitu=null,this.touring=!1,this.initialTourVO=null,this.postTourVO=null,this.initialTourWait=0,this.tourTween=null,this.waitingForVO=!1},events:{"peer-entity-added":function(t){var e=0,i=!1;if("camera-path-node"===t.type){for(e=0;e<this.path.length;e++)if(t.x<this.path[e].x){i=!0,this.path.splice(e,0,t);break}i||this.path.push(t)}else"lakitu"===t.type?(this.lakitu=t,this.lakitu.triggerEvent("focus-on",this.owner,!0)):"camera-target"===t.type&&"start"===t.name&&(this.start=t,this.owner.x=this.start.x,this.owner.y=this.start.y,this.initialTourVO=this.start.vo||null,this.postTourVO=this.start.postVO||null,this.initialTourWait=this.start.wait||0)},"start-course-tour":function(t){this.touring||(this.touring=!0,this.owner.triggerEvent("rl-tour-started"),this.owner.triggerEvent("start-tutorial-tour"))},"stop-course-tour":function(){this.touring&&(t.removeTweens(this.owner),this.owner.triggerEvent("tour-complete"))},"start-tutorial-tour":function(){var i=0,s=null,n=null,o=this.owner.trigger,r=0;for(this.tourTween=t.get(this.owner),this.owner.x=this.start.x,this.owner.y=this.start.y,this.lakitu.triggerEvent("focus-on",this.owner,!0),this.tourTween.wait(500),this.initialTourVO&&this.tourTween.call(o,["tour-vo",this.initialTourVO]).pause(),this.initialTourWait&&this.tourTween.wait(this.initialTourWait),n=this.start,i=1;i<this.path.length;i++)(s=this.path[i]).vo||s.wait?(r=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2))/100*250,this.tourTween.to({x:s.x,y:s.y},r,e.sineInOut),s.vo&&this.tourTween.call(o,["tour-vo",s.vo]).pause(),this.tourTween.wait(s.wait||500),n=s):i===this.path.length-1&&(r=Math.sqrt(Math.pow(this.path[i].x-n.x,2)+Math.pow(this.path[i].y-n.y,2))/100*250,this.tourTween.to({x:this.path[i].x,y:this.path[i].y},r,e.sineInOut).call(o,["tour-complete"]))},"tour-complete":function(){this.lakitu.triggerEvent("focus-on",this.start),this.touring=!1,this.owner.triggerEvent("rl-tour-stopped"),this.owner.triggerEvent("rl-post-tour-tutorial",this.postTourVO)},"tour-vo":function(t){this.waitingForVO=!0,this.owner.triggerEvent("rl-tour-tutorial",t)},"tour-vo-ready":function(){this.waitingForVO&&(this.waitingForVO=!1,this.tourTween.paused=!1)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"TrashRegion",initialize:function(){this.initialCamera=t.setUp(0,0,960,720)},properties:{panelOffset:300},publicProperties:{width:500},events:{"camera-update":function(t){var e=this.owner,i=Math.min(t.viewport.width/this.initialCamera.width,t.viewport.height/this.initialCamera.height);e.x=t.viewport.left+(this.width-this.panelOffset)*i-this.width/2,e.y=t.viewport.y}},methods:{destroy:function(){this.initialCamera.recycle(),this.initialCamera=null}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("platypus.AABB"),i=new t(0,0);platypus.createComponentClass({id:"TreadLogic",properties:{},publicProperties:{speed:0},initialize:function(){var t=this.owner.state,i=t.get("reversed");this.owner.state.set("simming",!1),this.simulationStarted=!1,this.moving=0,this.batteryDrain=4e-4,this.owner.state.set("moving",!1),"boolean"!=typeof i&&t.set("reversed",!1),this.wheels=[],this.treadSounding=!1,this.treadAudioLevel=0,this.cameraPosition=e.setUp(),this.panRange=0},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.15*this.cameraPosition.width,2)},"handle-logic":function(t){var e=0;this.simulationStarted&&(this.treadSounding&&this.treadAudioLevel<=1?(e=this.figureOutPan(),0===this.treadAudioLevel&&this.owner.triggerEvent("tread-running"),this.treadAudioLevel=Math.min(1,this.treadAudioLevel+t.delta/500),this.owner.triggerEvent("set-volume",.25*this.treadAudioLevel*e,"motor-running")):!this.treadSounding&&this.treadAudioLevel>0&&(e=this.figureOutPan(),this.treadAudioLevel=Math.max(0,this.treadAudioLevel-t.delta/200),this.owner.triggerEvent("set-volume",.25*this.treadAudioLevel*e,"motor-running"),0===this.treadAudioLevel&&this.owner.triggerEvent("stop-audio","motor-running")))},"before-box2d-update":function(t){var e=0;if(this.simulationStarted)if(this.moving&&this.owner.drainBattery(this.batteryDrain)){for(this.owner.state.set("moving",!0),e=0;e<this.wheels.length;e++)this.wheels[e].triggerEvent("move-wheels");this.treadSounding||(this.treadSounding=!0)}else{for(this.owner.state.set("moving",!1),e=0;e<this.wheels.length;e++)this.wheels[e].triggerEvent("stop-wheels");this.treadSounding&&(this.treadSounding=!1)}},"simulation-started":function(){this.simulationStarted=!0,this.owner.state.set("simming",!0)},"simulation-stopped":function(){this.simulationStarted=!1,this.owner.state.set("simming",!1),this.moving=0,this.speed=0,this.owner.state.set("reversed",!1),this.wheels=[],this.owner.triggerEvent("stop-audio","motor-running"),this.owner.state.set("moving",!1),this.owner.body.SetLinearVelocity(i),this.owner.body.SetAngularVelocity(0),this.owner.body.SetAwake(!1)},"tread-cw-start":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-cw-start");this.owner.state.set("reversed",!1),this.moving++}},"tread-cw-stop":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-cw-stop");this.moving>0&&this.moving--}},"tread-ccw-start":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-ccw-start");this.owner.state.set("reversed",!0),this.moving++}},"tread-ccw-stop":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-ccw-stop");this.moving>0&&this.moving--}},"pre-simulation-started":function(){var t=null,e=null,i=null,s=null,n=null;t={type:"tread-wheel",properties:{tread:this.owner,x:this.owner.x,y:this.owner.y,z:this.owner.z+.01,orientation:0}},e=this.owner.parent.addEntity(t),this.wheels.push(e),t={type:"tread-wheel",properties:{tread:this.owner,x:this.owner.x-32,y:this.owner.y,z:this.owner.z+.01,orientation:0}},i=this.owner.parent.addEntity(t),this.wheels.push(i),t={type:"tread-wheel",properties:{tread:this.owner,x:this.owner.x+32,y:this.owner.y,z:this.owner.z+.01,orientation:0}},s=this.owner.parent.addEntity(t),this.wheels.push(s),n=e.createJoint("revolute",{anchor:{x:e.x/30,y:e.y/30}},this.owner,1),e.myJoint=n,n=i.createJoint("revolute",{anchor:{x:i.x/30,y:i.y/30}},this.owner,1),i.myJoint=n,n=s.createJoint("revolute",{anchor:{x:s.x/30,y:s.y/30}},this.owner,1),s.myJoint=n}},methods:{figureOutPan:function(){var t,e,i=this.cameraPosition,s=0;return t=Math.pow(this.owner.x-i.x,2)+Math.pow(this.owner.y-i.y,2),e=Math.max(1-t/this.panRange,0),s=this.owner.x>i.right?1:this.owner.x<i.left?-1:(this.owner.x-i.left)/i.width*2-1,this.owner.triggerEvent("set-pan",s,"motor-running"),e}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Tween"),i=["idle-hint-play"],s=["idle-hint-play","idle-hint-toolbox","idle-hint-course","idle-hint-remove"],n=["idle-hint-button","idle-hint-course","idle-hint-save","idle-hint-group-move","clear-all-1"],o=["reset-hint-redo-0","reset-hint-redo-1","reset-hint-redo-2","reset-hint-redo-3"],r=["hint-breaking-0","hint-breaking-1","lost-pieces-ok-0","hint-breaking-2","hint-breaking-3","lost-pieces-ok-1","hint-breaking-4"],a=["hint-broke-wheel-0","hint-broke-wheel-1","hint-broke-wheel-2"],h=["hint-battery-dead-0","","","","","hint-battery-dead-1","","","","","hint-battery-dead-2","","","",""],l=["hint-rocket-dead-0","","","","","hint-rocket-dead-1","","","","","hint-rocket-dead-2","","","",""],p=["hint-sunny-spot-0","","","","","hint-sunny-spot-1","","","","","hint-sunny-spot-2","","","",""],c=["hint-cannot-place-0","hint-cannot-place-1"],u=["level-win-1","level-win-2","level-win-3","level-win-4","level-win-5"],d=0,g=0,m=Math.floor(Math.random()*r.length),y=Math.floor(Math.random()*a.length),f=Math.floor(3*Math.random())*h.length/3,w=Math.floor(3*Math.random())*l.length/3,v=Math.floor(3*Math.random())*p.length/3,b=Math.floor(Math.random()*c.length),x=Math.floor(Math.random()*u.length),E=function(t){var e=createjs.Sound._getSrcById(t);return e&&e.src&&(e=createjs.Sound.activePlugin._audioSources[e.src])?1e3*(e.duration||0)>>0:0};platypus.createComponentClass({id:"TutorialSystem",properties:{},publicProperties:{},initialize:function(){this.everClosedRecipe=!1,this.recipeOpen=!0,this.camera=t.setUp(),this.countdown=2e4,this.simulationStarted=!1,this.idlingPrompts=n,this.showing=!1,this.cannotPlaceCount=10,this.controlsTutorial=null,this.playedGeneric=!1,this.chatSpot={x:180,y:180},this.skipGraceTime=200},events:{"camera-update":function(t){this.camera.set(t.viewport)},"scene-live":function(t){this.levelId="string"==typeof t.level?t.level:t.level.properties.levelId,"e-sunspot-snap-tutorial"===this.levelId?this.idlingPrompts=i:"e-wheel-snap-tutorial"!==this.levelId&&"e-block-snap-tutorial"!==this.levelId&&"e-bumpy-hill"!==this.levelId||(this.idlingPrompts=s),d=Math.floor(Math.random()*this.idlingPrompts.length),g=Math.floor(Math.random()*o.length)},"announce-level":function(){this.levelId&&this.owner.triggerEvent("announce-"+this.levelId)},"tour-started":function(){this.owner.triggerEvent("quiet"),this.touring=!0,this.owner.triggerEvent("rl-disable-help-button")},"tour-tutorial":function(t){t&&this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["tour-"+t])},"post-tour-tutorial":function(t){var i=0;this.touring=!1,e.removeTweens(this.owner),this.owner.triggerEvent("stop-active-timelines"),t?this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["tour-"+t]):this.playedGeneric?this.showing&&this.goBackHome():(this.playedGeneric=!0,i=Math.floor(5*Math.random()),this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["tour-tutorial-generic-"+i])),this.owner.triggerEvent("rl-enable-help-button")},"passed-finish":function(){this.owner.triggerEvent("quiet")},"handle-logic":function(t){this.countdown>0&&(platypus.game.app.voPlayer.playing||this.touring?this.countdown=2e4:(this.countdown-=t.delta,this.countdown<=0&&(this.countdown=2e4,this.simulationStarted||(this.owner.triggerEvent(this.idlingPrompts[d]),d=(d+1)%this.idlingPrompts.length))))},"play-reset-hint":function(){platypus.game.app.voPlayer.playing||(this.owner.triggerEvent(o[g]),g=(g+1)%o.length)},"play-broke-rover":function(){platypus.game.app.voPlayer.playing||(this.owner.triggerEvent(r[m]),m=(m+1)%r.length)},"play-broke-wheel":function(){platypus.game.app.voPlayer.playing||(this.owner.triggerEvent(a[y]),y=(y+1)%a.length)},"play-battery-is-dead":function(){platypus.game.app.voPlayer.playing||(""!==h[f]&&this.owner.triggerEvent(h[f]),f=(f+1)%h.length)},"play-rocket-is-dead":function(){platypus.game.app.voPlayer.playing||(""!==l[w]&&this.owner.triggerEvent(l[w]),w=(w+1)%l.length)},"play-found-sunny-spot":function(){platypus.game.app.voPlayer.playing||(""!==p[v]&&this.owner.triggerEvent(p[v]),v=(v+1)%p.length)},"play-cannot-drag":function(){platypus.game.app.voPlayer.playing||this.owner.triggerEvent("hint-cannot-drag")},"play-cannot-place":function(){this.owner.triggerEvent("play-bonk"),this.cannotPlaceCount-=1,platypus.game.app.voPlayer.playing||this.cannotPlaceCount<=0&&(this.cannotPlaceCount=15,this.owner.triggerEvent(c[b]),b=(b+1)%c.length)},"play-win-speech":function(){this.owner.triggerEvent(u[x]),x=(x+1)%u.length},"reveal-help":function(t){var i=0,s=Math.round(Math.random())?"-alt":"";this.owner.triggerEvent("stop-active-timelines"),this.owner.triggerEvent("rl-stop-audio"),this.owner.opacity=0,e.removeTweens(this.owner),-2===t?this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["play-help-max"+s]):(i=t+1,this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["play-help-"+i+s]))},"set-controls-tutorial":function(t){this.controlsTutorial=t},"ui-simulation-started":function(){this.simulationStarted=!0,this.controlsTutorial?(this.owner.triggerEvent("stop-active-timelines"),this.owner.triggerEvent("rl-stop-audio"),e.removeTweens(this.owner),this.owner.opacity=0,platypus.supports.mobile?this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["controls-"+this.controlsTutorial]):this.beginTalking(e.get(this.owner)).wait(150).call(this.owner.trigger,["controls-"+this.controlsTutorial+"-keyboard"])):this.owner.triggerEvent("quiet")},"ui-simulation-stopped":function(){this.countdown=2e4,this.simulationStarted=!1,this.owner.triggerEvent("quiet"),this.controlsTutorial=null},"did-something":function(){this.simulationStarted||(this.countdown=2e4)},"hint-it":function(){this.owner.parent.parent.triggerOnChildren("soft-hint")},"point-out-go-button":function(){this.addGoButton(e.get(this.owner))},"drag-sunspot":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:145,x:100,y:-250},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({rotation:90,x:230,y:-250},600).wait(1e3).to({opacity:0},300).wait(1e3).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600).wait(7500).to({rotation:45,x:this.camera.right-250,y:this.camera.bottom-250},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-wheels":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:180,x:this.camera.left+380,y:this.camera.top+180},600).call(t,["show-sprite"]).to({opacity:1},300).wait(2500).to({rotation:270,x:75,y:200},600).wait(3e3).to({opacity:0},300).wait(1e3).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600).wait(3700).to({rotation:45,x:this.camera.right-250,y:this.camera.bottom-250},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(1e3).to({opacity:0},300).call(t,["hide-sprite"])},"point-out-blocks":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:180,x:this.camera.left+380,y:this.camera.top+318},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({x:this.camera.left+380,y:this.camera.top+116},600).wait(2500).to({rotation:90,x:51,y:-240},600).wait(1e3).to({opacity:0},300).wait(500).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600).wait(1500).to({rotation:45,x:this.camera.right-250,y:this.camera.bottom-250},600).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"])},"point-out-all-tools":function(){var t=this.owner.trigger;e.get(this.owner).wait(3500).to({rotation:180,x:this.camera.left+380,y:this.camera.top+116},1e3).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({x:this.camera.left+380,y:this.camera.bottom-116},1e3).wait(1500).to({rotation:45,x:this.camera.right-370,y:this.camera.bottom-230},1e3).call(t,["pointy"]).wait(1e3).to({opacity:0},300).call(t,["hide-sprite"])},"point-out-battery-and-motor":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:90,x:-40,y:-160},600).call(t,["show-sprite"]).to({opacity:1},300).wait(900).to({x:90,y:-200},600).wait(2e3).to({opacity:0},300).wait(500).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-motor-controls":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:90,x:this.camera.left+340,y:this.camera.bottom-315},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({opacity:0},300).wait(500).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-tread-controls":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:90,x:this.camera.left+340,y:this.camera.bottom-315},600).call(t,["show-sprite"]).to({opacity:1},300).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"])},"point-out-sunny-spot":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:90,x:5,y:-125},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({opacity:0},300).wait(500).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-battery-and-solar":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:180,x:275,y:12},600).call(t,["show-sprite"]).to({opacity:1},300).wait(300).to({x:275,y:-120},600).wait(1500).to({opacity:0},300).wait(500).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-rockets":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:180,x:this.camera.left+380,y:this.camera.top+116},600).call(t,["show-sprite"]).to({opacity:1},300).wait(750).to({x:this.camera.left+380,y:this.camera.top+221},600).wait(750).to({rotation:90,x:95,y:-200},600).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"]).wait(500).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-rocket-controls":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:90,x:this.camera.left+292,y:this.camera.bottom-315},600).call(t,["show-sprite"]).to({opacity:1},300).wait(1e3).to({opacity:0},300).wait(500).call(t,["hide-sprite"]).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-sail":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:180,x:this.camera.left+380,y:this.camera.top+116},600).call(t,["show-sprite"]).to({opacity:1},300).wait(3e3).to({rotation:0,x:-250,y:-200},600).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"]).wait(500).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"point-out-treads":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:90,x:49,y:-215},600).call(t,["show-sprite"]).to({opacity:1},300).wait(2e3).to({opacity:0},300).call(t,["hide-sprite"]).wait(500).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600)},"back-home":function(){this.goBackHome(e.get(this.owner))},chat:function(){this.beginTalking(e.get(this.owner))},quiet:function(){var t=this.owner.trigger;this.owner.triggerEvent("stop-active-timelines"),this.owner.triggerEvent("rl-stop-audio"),e.removeTweens(this.owner),this.goBackHomeQuick(e.get(this.owner,{override:!0}).to({opacity:0},1).call(t,["hide-sprite"]))},"character-showing":function(){this.showing=!0},"character-hiding":function(){this.showing=!1},"begin-action-vo-succeed":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="";if(this.time=Date.now(),this.duration=E(t),i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.startCorrectFeedback(e.levelId||"","audio",this.duration,n,t)},"begin-action-vo-fail":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="";if(this.time=Date.now(),this.duration=E(t),i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.startIncorrectFeedback(e.levelId||"","audio",this.duration,n,t)},"begin-instruction":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="";if(this.time=Date.now(),this.duration=E(t),i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.startInstruction(e.levelId||"","audio",this.duration,n,t),e.googleAnalytics.event(e.name,"TutorialStart",t)},"end-action-vo-succeed":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="",o=Date.now()-this.time,r=o<this.duration-this.skipGraceTime;if(i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.endCorrectFeedback(e.levelId||"","audio",o>>0,n,t,r)},"end-action-vo-fail":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="",o=Date.now()-this.time,r=o<this.duration-this.skipGraceTime;if(i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.endIncorrectFeedback(e.levelId||"","audio",o>>0,n,t,r)},"end-instruction":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,s=0,n="",o=Date.now()-this.time,r=o<this.duration-this.skipGraceTime;if(i)for(s=0;s<i.length;s++)n+=i[s].content+" ";e.analyticsEmitter.endInstruction(e.levelId||"","audio",o>>0,n,t,r,e.getEnlearnData()),r?e.googleAnalytics.event(e.name,"TutorialSkip",t):e.googleAnalytics.event(e.name,"TutorialComplete",t)}},methods:{beginTalking:function(t){var e=this.owner.trigger;return this.showing?t.to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600).call(e,["character-showing"]):t.to({x:this.camera.right-this.chatSpot.x,y:this.camera.top-500},0).to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600).call(e,["character-showing"]),t},goBackHome:function(t){var i=this.owner.trigger;return t||(t=e.get(this.owner)),this.owner.x===this.camera.right-this.chatSpot.x&&this.owner.y===this.camera.top+this.chatSpot.y?t.to({y:this.camera.top-500},600).call(i,["character-hiding"]):t.to({x:this.camera.right-this.chatSpot.x,y:this.camera.top+this.chatSpot.y},600).wait(200).to({y:this.camera.top-500},600).call(i,["character-hiding"]),t},goBackHomeQuick:function(t){var i=this.owner.trigger;return t||(t=e.get(this.owner)),t.to({y:this.camera.top-500},600).to({x:this.camera.right-this.chatSpot.x},0).call(i,["character-hiding"]),t},addGoButton:function(t){var e=this.owner.trigger;return t.to({rotation:45,x:this.camera.right-250,y:this.camera.bottom-250},600).call(e,["show-sprite"]).to({opacity:1},300).call(e,["pointy"]).wait(2e3).to({opacity:0},300).call(e,["hide-sprite"]),t}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"UnlockSequence",properties:{},publicProperties:{},initialize:function(){},events:{"complete-level":function(){this.owner.state.set("completing",!0)},"unlock-level":function(){this.owner.state.set("unlocking",!0)},"animation-ended":function(t){"completing"===t&&(this.owner.state.set("completing",!1),this.owner.state.set("complete",!0),this.owner.parent.triggerEvent("level-unlock-sequence")),"unlocking"===t&&(this.owner.state.set("unlocking",!1),this.owner.state.set("disabled",!1))}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"UsingPC",properties:{},publicProperties:{},initialize:function(){},events:{adopted:function(){platypus.supports.mobile||this.owner.state.set("using-pc",!0)},"used-key":function(){this.owner.state.get("simulating")&&this.owner.state.set("used-keyboard",!0)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.Entity"),s={"e-hill-climb":["wheel-control-tray"],"e-climb-and-coast":["wheel-control-tray"],"l-hill-climb-pit-stop":["wheel-control-tray"],"l-solar-two":["wheel-control-tray"],"l-first-rocket":["rocket-control-tray"],"l-horizontal-rockets":["rocket-control-tray"],"l-rocket-steps":["wheel-control-tray","rocket-control-tray"],"m-wind-storm":["sail-control-tray"],"m-wind-storm-2":["sail-control-tray"],"m-ceiling-rockets":["rocket-control-tray"],"m-back-and-forth":["sail-control-tray"],"eur-ice-pond":["tread-control-tray"],"eur-tread-two":["wheel-control-tray","tread-control-tray"],"eur-ice-and-rockets":["rocket-control-tray","tread-control-tray"],"eur-slip-and-slide":["wheel-control-tray"]};platypus.createComponentClass({id:"VehicleControlsManager",properties:{},publicProperties:{},initialize:function(){this.controls={},this.showingControls=[],this.controlDependentsCount={"wheel-control-tray":0,"rocket-control-tray":0,"sail-control-tray":0,"tread-control-tray":0},this.leftBuffer=210,this.betweenBuffer=10},events:{"add-piece-control":function(t){var e=this.lookUpController(t);e&&!this.controls[e]&&this.addControl(e)},"controllable-piece-added":function(t){var e=this.lookUpController(t);e&&(this.owner.triggerEvent("add-piece-control",t),this.controlDependentsCount[e]||this.showControl(e),this.controlDependentsCount[e]++)},"controllable-piece-removed":function(t){var e=this.lookUpController(t);e&&(this.controlDependentsCount[e]--,this.controlDependentsCount[e]||this.hideControl(e))}},methods:{lookUpController:function(t){switch(t){case"wheel-powered":return"wheel-control-tray";case"rocket":case"h-rocket":return"rocket-control-tray";case"sail":return"sail-control-tray";case"tread":return"tread-control-tray"}return null},addControl:function(t){var e,i={type:t,properties:{bottom:-300}};e=this.owner.addEntity(i),this.controls[t]=e},showControl:function(t){var e=null,i=0,s=null;e=this.controls[t],i=this.showingControls.length>0?(s=this.showingControls[this.showingControls.length-1]).left+s.width/2+this.betweenBuffer+e.width/2:this.leftBuffer+e.width/2,e.left=i,e.bottom=-300,this.showingControls.push(e),e.triggerEvent("pop-up")},hideControl:function(i){var s=0,n=-1,o=null,r=0;for(s=0;s<this.showingControls.length;s++)o=this.showingControls[s],-1!==n?(t.get(o).wait(300).to({left:r+o.width/2},750,e.quadInOut),r+=o.width+this.betweenBuffer):o.type===i&&(n=s,o.triggerEvent("pop-down"),r=s>0?this.showingControls[s-1].left+this.showingControls[s-1].width/2+this.betweenBuffer:this.leftBuffer);this.showingControls.splice(n,1)}},getLateAssetList:function(t,e,n,o){var r=null,a=null,h=null,l=0,p=Array.setUp();if(o&&o.level&&("string"!=typeof(r=o.level)&&(r=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null}(o.level.properties,"levelId")),h=s[r]))for(l=h.length;l--;)a=i.getAssetList({type:h[l]}),p.union(a),a.recycle();return p}})}(),function(){"use strict";var t=include("platypus.components.AudioVO"),e=include("platypus.components.RenderAnimation"),i=include("platypus.components.RenderSprite"),s=function(t,e){return" "===e?t+"default":t+e},n=function(t,e,i){this.owner.addComponent(new t(this.owner,e,i))},o=function(t,e,i,n){var o=0,r="",a={},h=0,l="",p="",c=t.voice,u=t.mouthCues;if("string"==typeof t)a.sound=t,a.events=Array.setUp();else if("string"==typeof t.sound)a.sound=t.sound,a.events=Array.setUp();else{for(r in t.sound)t.sound.hasOwnProperty(r)&&(a[r]=t.sound[r]);a.events?a.events=a.events.greenSlice():a.events=Array.setUp()}if(c||u||!platypus.game.app.config.mouthCues||(u=platypus.game.app.config.mouthCues[a.sound]),c)for(c+=" ",o=0;o<c.length;o++)(p=c[o])!==l&&(l=p,a.events.push({time:h,event:s(i,p)})),h+=n;else if(u)for(o=0;o<u.length;o++)p=u[o],a.events.push({time:1e3*p.start,event:s(i,p.value)}),h+=n;return a},r=function(t,e,i,s){var n=0,r=Array.setUp();if(e[" "]||(e[" "]=e.default),Array.isArray(t)){for(n=0;n<t.length;n++)"number"==typeof t[n]?r.push(t[n]):r.push(o(t[n],0,i,s));return r}return o(t,0,i,s)};platypus.createComponentClass({id:"VoiceOver",properties:{animationMap:{default:"default"},renderComponent:"",frameLength:100,messagePrefix:"",voiceOverMap:{}},initialize:function(o,a){var h="",l=Array.setUp(),p={audioMap:{},aliases:o.aliases},c={acceptInput:o.acceptInput,aliases:o.aliases,animation:o.animation,animationMap:{},eventBased:!0,flip:o.flip,hidden:o.hidden,interactive:o.interactive,mask:o.mask,mirror:o.mirror,offsetZ:o.offsetZ,regX:o.regX,regY:o.regY,restart:o.restart,rotate:o.rotate,scaleX:o.scaleX,scaleY:o.scaleY,spriteSheet:o.spriteSheet,stateBased:o.stateBased||!1};for(h in this.messagePrefix?this.message=this.messagePrefix+"-":this.message="",this.animationMap)this.animationMap.hasOwnProperty(h)&&(c.animationMap[s(this.message,h)]=this.animationMap[h]);for(h in c.animationMap.default=this.animationMap.default,this.renderComponent?l.push(n.bind(this,platypus.components[this.renderComponent],c)):l.push(n.bind(this,o.animation?e:i,c)),this.voiceOverMap)this.voiceOverMap.hasOwnProperty(h)&&(p.audioMap[h]=r(this.voiceOverMap[h],this.animationMap,this.message,this.frameLength));return l.push(n.bind(this,t,p)),platypus.Async.setUp(l,a),l.recycle(),!0},events:{load:function(){this.owner.removeComponent(this)}},getAssetList:function(t,e,i){var s=t.spriteSheet||e.spriteSheet||i&&i.spriteSheet;return"string"==typeof s?platypus.game.settings.spriteSheets[s].images.greenSlice():s?s.images.greenSlice():Array.setUp()}})}(),function(){"use strict";platypus.createComponentClass({id:"WhatsBeingDragged",properties:{},publicProperties:{},initialize:function(){this.dragging=[]},events:{"dragging-a-piece":function(t){this.dragging.includes(t)||(this.dragging.push(t),1===this.dragging.length&&this.owner.triggerEvent("rl-dragging-taking-place"))},"finished-dragging-a-piece":function(t){var e;(e=this.dragging.indexOf(t))>=0&&(this.dragging.splice(e,1),0===this.dragging.length&&this.owner.triggerEvent("rl-no-dragging-taking-place"))}},methods:{},publicMethods:{isThisGroupMoving:function(t){var e=0;for(e=0;e<this.dragging.length;e++)if(this.dragging[e].groupId===t)return!0;return!1}}})}(),function(){"use strict";platypus.createComponentClass({id:"WorkSpace",initialize:function(){var t=this.owner;t.x=t.width/2,t.y=t.height/2}})}(),function(){"use strict";platypus.createComponentClass({id:"ZoomBannerLogic",properties:{},publicProperties:{banner:null},initialize:function(){},events:{zoom:function(){this.owner.parent.triggerEvent("zoom-in",this.owner.banner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Entity"),s=include("platypus.Vector"),n=include("createjs.Tween");platypus.createComponentClass({id:"Zoomer",properties:{maxZoom:2048,minZoom:240},publicProperties:{zooming:!1,zoomEnabled:!0,zoomPaused:!1},initialize:function(){var e=this.interaction=platypus.game.app.display.renderer.plugins.interaction;this.zoomLocks=0,this.zoomButton=null,this.zoomStep=1,this.camera=t.setUp(),this.pointers=Array.setUp(),this.mouseWorldOrigin=s.setUp(),this.pinchCam=null,this.wheelie=function(t){var e=5e-4*t.deltaY,i=window.devicePixelRatio||1,n=1+e/this.currentZoom,o=this.owner,r=s.setUp(t.clientX*i,t.clientY*i),a=o.windowToWorld(r,!0);this.zoomEnabled&&!this.zoomPaused&&this.zoom(a,n,this.camera),r.recycle(),a.recycle(),t.preventDefault()}.bind(this),window.addEventListener("wheel",this.wheelie),this.continuing=function(e){var i=null,s=this.pointers,n=s.length,o=e.data.identifier,r=!1;if(this.pinchCam||1!==n){if(2===n){if(!this.pinchCam){for(this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y;n--;)(i=s[n]).x=i.toX,i.y=i.toY;n=s.length,this.pinchCam=t.setUp(this.camera)}for(;n--;)if((i=s[n]).identifier===o){i.toX=e.data.global.x,i.toY=e.data.global.y,r=!0;break}r?this.pinchZoom():platypus.debug.warn("Well, that was odd. Unregistered input pointer!")}}else this.repositionCamera(s[0],e.data.global),e.stopPropagation();this.pinchCam&&e.stopPropagation()}.bind(this),e.on("pointermove",this.continuing),this.ending=function(t){for(var e=null,i=this.pointers,s=i.length,n=t.data.identifier;s--;)if(i[s].identifier===n){i.greenSplice(s).recycle();break}this.pinchCam&&(this.pinchCam.recycle(),this.pinchCam=null),1===i.length&&((e=i[0]).x=e.toX,e.y=e.toY,this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y),this.zooming&&t.stopPropagation(),i.length||(this.zooming=!1)}.bind(this),e.on("pointerup",this.ending),e.on("pointerupoutside",this.ending),e.on("pointercancel",this.ending),this.needToAddZoomButton=platypus.supports.desktop,this.enabledZoomButton=!1,this.zoomDimensionsCollected=!1,this.zoomDimensions={width:0,height:0,lastWidth:0},this.initialZoomDimensions={width:0,height:0}},events:{"step-zoom":function(){var t=(this.maxZoom-this.minZoom)/2;this.zoomStep=(this.zoomStep+1)%3,this.zoom(this.camera,(this.minZoom+t*(2-this.zoomStep))/this.camera.height,this.camera)},tick:function(){this.zoomEnabled&&this.needToAddZoomButton&&(this.zoomButton=platypus.game.currentScene.layers[platypus.game.currentScene.layers.length-1].addEntity({type:"button-zoom"}),this.needToAddZoomButton=!1,this.enabledZoomButton=!0),this.zoomButton&&(!this.enabledZoomButton||this.zoomEnabled&&!this.zoomPaused?this.enabledZoomButton||!this.zoomEnabled||this.zoomPaused||(this.zoomButton.triggerEvent("enable"),this.enabledZoomButton=!0):(this.zoomButton.triggerEvent("disable"),this.enabledZoomButton=!1)),this.zoomDimensions.width!==this.zoomDimensions.lastWidth&&(this.zoomDimensions.lastWidth=this.zoomDimensions.width,this.owner.triggerEvent("resize-camera",this.zoomDimensions))},"camera-update":function(t){this.camera.set(t.viewport),this.currentZoom=t.scaleX,this.zoomDimensionsCollected||(this.zoomDimensionsCollected=!0,this.zoomDimensions={width:t.viewport.width,height:t.viewport.height,lastWidth:t.viewport.width},this.initialZoomDimensions={width:t.viewport.width,height:t.viewport.height})},"tween-zoom-out":function(){var t=Math.min(1.355*this.initialZoomDimensions.height,this.maxZoom);this.zoomDimensions.changing=!0,n.get(this.zoomDimensions,{override:!0}).to({height:t,width:4*t/3},600,createjs.Ease.sineInOut)},"tween-zoom-in":function(){this.zoomDimensions.changing=!0,n.get(this.zoomDimensions,{override:!0}).to({height:this.initialZoomDimensions.height,width:this.initialZoomDimensions.width},600,createjs.Ease.sineInOut)},"workspace-pointerdown":function(t){this.zoomEnabled&&!this.zoomPaused&&this.start(t)},"pause-zooming":function(){this.zoomLocks+=1,this.zoomPaused=!0},"unpause-zooming":function(){this.zoomLocks-=1,this.zoomLocks<0&&(this.zoomLocks=0),this.zoomPaused=!!this.zoomLocks}},methods:{destroy:function(){var t=this.interaction;this.camera.recycle(),this.camera=null,this.mouseWorldOrigin.recycle(),this.mouseWorldOrigin=null,this.pointers.recycle(2),this.pointers=null,window.removeEventListener("wheel",this.wheelie),t.off("pointermove",this.continuing),t.off("pointerup",this.ending),t.off("pointerupoutside",this.ending),t.off("pointercancel",this.ending)},start:function(t){var i=this.camera,s=this.pointers;this.zooming=!0,this.owner.triggerEvent("stop-following-if-simulating"),s.push(e.setUp("toX",t.pixiEvent.data.global.x,"toY",t.pixiEvent.data.global.y,"x",t.pixiEvent.data.global.x,"y",t.pixiEvent.data.global.y,"identifier",t.pixiEvent.data.identifier)),1===s.length&&(this.mouseWorldOrigin.x=i.x,this.mouseWorldOrigin.y=i.y),t.pixiEvent.stopPropagation()},pinchZoom:function(){var t=this.pointers,e=t[0],i=t[1],n=Math.hypot(e.x-i.x,e.y-i.y),o=Math.hypot(e.toX-i.toX,e.toY-i.toY),r=s.setUp((e.toX+i.toX)/2,(e.toY+i.toY)/2),a=this.owner.windowToWorld(r);this.zoom(a,n/o,this.pinchCam),a.recycle(),r.recycle()},zoom:function(e,i,s){var n=Math.min(this.maxZoom,Math.max(this.minZoom,s.height*i)),o=this.owner,r=4*n/3,a=1-n/s.height,h=t.setUp(s.x+(e.x-s.x)*a,s.y+(e.y-s.y)*a,r,n);o.triggerEvent("resize-camera",h),o.triggerEvent("relocate",h),h.recycle()},repositionCamera:function(t,e){var i=s.setUp(t.x-e.x,t.y-e.y),n=this.owner.windowToWorld(i,!1);n.x+=this.mouseWorldOrigin.x,n.y+=this.mouseWorldOrigin.y,this.owner.triggerEvent("relocate",n),i.recycle(),n.recycle()}},getAssetList:function(){return platypus.supports.desktop?i.getAssetList({type:"button-zoom"}):Array.setUp()}})}();