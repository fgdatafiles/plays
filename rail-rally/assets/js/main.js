!function(){"use strict";var a=new platypus.Vector(0,0,0),b=new platypus.Vector(1,0,0);return platypus.createComponentClass({id:"AIPilot",properties:{errorRatio:1},publicProperties:{standingDistance:0},constructor:function(a){this.winds=[],this.on=!1,this.wind=null,this.go=!1},events:{"new-wind":function(a){this.winds.push(a)},"start-race":function(){this.winds.sort(function(a,b){return a.x-b.x}),this.go=!0},"handle-ai":function(){var c=a;this.go&&(this.winds[0]&&(c.set(this.winds[0].position).subtractVector(this.owner.position).normalize(),b.dot(c)<.85&&(this.winds.splice(0,1),this.wind=this.winds[0])),this.wind&&this.wind.y<this.owner.y?!this.on&&Math.random()<this.errorRatio&&(this.on=!0,this.owner.triggerEvent("use-power",{pressed:!0})):this.on&&Math.random()<this.errorRatio&&this.standingDistance<0&&(this.on=!1,this.owner.triggerEvent("use-power",{pressed:!1})))}},methods:{},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"BroadcastMe",properties:{broadcast:"me"},publicProperties:{},constructor:function(a){},events:{"scene-loaded":function(){this.owner.triggerEvent(this.broadcast,this.owner)},"handle-logic":function(){}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=2100;return platypus.createComponentClass({id:"IntroBrain",properties:{},publicProperties:{},constructor:function(a){var b=null,c=null,d=null,e="",f="";this.hasPracticed={},this.awards={};try{b=JSON.parse(window.localStorage.getItem("dt-rail-rally"))}catch(g){}if(b||(b={}),b.ghosts){c=b.ghosts;for(e in c)c.hasOwnProperty(e)&&(this.hasPracticed[e]=!0)}if(b.awards){d=b.awards;for(e in d)if(d.hasOwnProperty(e))switch(f=e.replace("train-",""),d[e]){case 0:this.awards[f]="gold";break;case 1:this.awards[f]="silver";break;case 2:this.awards[f]="bronze";break;default:this.awards[f]="none"}}this.trainOrder=["dino","rocket","solar","zeppelin"],this.trainIndex=0,this.transitioning=0,this.leftButton=null,this.rightButton=null},events:{"the-left-button":function(a){this.leftButton=a},"the-right-button":function(a){this.rightButton=a},tick:function(a){var b=a.delta;this.transitioning>0&&(this.transitioning-=b,this.transitioning=Math.max(this.transitioning,0))},"scene-loaded":function(){var a=this.owner;this.hasPracticed[this.trainOrder[this.trainIndex]]?(a.triggerEvent("rl-enable-race"),a.triggerEvent("intro-race")):(a.triggerEvent("rl-disable-race"),a.triggerEvent("intro")),a.triggerEvent("rl-change-award",this.awards[this.trainOrder[this.trainIndex]]),this.updateArrows()},"next-right":function(){this.transitioning||(this.trainIndex++,this.transitioning=a,this.trainIndex>=this.trainOrder.length&&(this.trainIndex=0),this.updateArrows(),this.owner.triggerEvent("rl-change-train",this.trainOrder[this.trainIndex]),this.hasPracticed[this.trainOrder[this.trainIndex]]?(this.owner.triggerEvent("rl-enable-race"),this.owner.triggerEvent("play-"+this.trainOrder[this.trainIndex]+"-race")):(this.owner.triggerEvent("rl-disable-race"),this.owner.triggerEvent("play-"+this.trainOrder[this.trainIndex])),this.owner.triggerEvent("rl-show-award",this.awards[this.trainOrder[this.trainIndex]]))},"next-left":function(){this.transitioning||(this.trainIndex--,this.transitioning=a,this.trainIndex<0&&(this.trainIndex=this.trainOrder.length-1),this.updateArrows(),this.owner.triggerEvent("rl-change-train",this.trainOrder[this.trainIndex]),this.hasPracticed[this.trainOrder[this.trainIndex]]?(this.owner.triggerEvent("rl-enable-race"),this.owner.triggerEvent("play-"+this.trainOrder[this.trainIndex]+"-race")):(this.owner.triggerEvent("rl-disable-race"),this.owner.triggerEvent("play-"+this.trainOrder[this.trainIndex])),this.owner.triggerEvent("rl-show-award",this.awards[this.trainOrder[this.trainIndex]]))},"start-race":function(){this.owner.triggerEvent("new-scene",{scene:"race",persistentData:{practice:!1,train:this.trainOrder[this.trainIndex]},transition:"fade-to-black"})},"start-practice":function(){this.owner.triggerEvent("new-scene",{scene:"practice",persistentData:{practice:!0,train:this.trainOrder[this.trainIndex]},transition:"fade-to-black"})},mousedown:function(a){this.lastX=a.x},pressmove:function(a){var b=a.x-this.lastX;b>90?(this.owner.triggerEvent("next-right"),this.lastX=a.x):-90>b&&(this.owner.triggerEvent("next-left"),this.lastX=a.x)},pressup:function(a){this.lastX=a.x}},methods:{updateArrows:function(){var a=0,b=0,c=0;for(a=this.trainIndex-1,b=this.trainIndex+1,0>a&&(a=this.trainOrder.length-1),b>=this.trainOrder.length&&(b=0),c=0;c<this.trainOrder.length;c++)this.leftButton.state[this.trainOrder[c]]=!1,this.rightButton.state[this.trainOrder[c]]=!1;this.leftButton.state[this.trainOrder[a]]=!0,this.rightButton.state[this.trainOrder[b]]=!0},destroy:function(){this.leftButton=null,this.rightButton=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicCanvasRadioButton",properties:{onPress:null,groupUp:"rl-radio-group-up",disabled:!1,selected:!1},publicProperties:{},constructor:function(a){this.owner.state.disabled=this.disabled,this.owner.state.down=this.selected,this.owner.buttonMode=!this.disabled,this.last=null},events:{"handle-logic":function(a){this.last!==(this.disabled===this.owner.state.disabled)&&(this.last=this.disabled===this.owner.state.disabled)},mousedown:function(a){this.owner.triggerEvent("down")},disable:function(){this.owner.state.disabled=!0,this.owner.buttonMode=!1},enable:function(){this.owner.state.disabled=!1,this.owner.buttonMode=!0},"toggle-disabled":function(){this.owner.buttonMode=this.owner.state.disabled,this.owner.state.disabled=!this.owner.state.disabled},down:function(){this.owner.state.down||this.owner.state.disabled||(this.owner.state.down=!0,this.onPress&&this.owner.triggerEvent(this.onPress),this.owner.triggerEvent(this.groupUp,this.owner))},up:function(){this.owner.state.down=!1},"radio-group-up":function(a){a!==this.owner&&this.owner.triggerEvent("up")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicIntroAward",properties:{},publicProperties:{},constructor:function(a){this.owner.opacity=0,this.owner.scaleX=.7,this.owner.scaleY=.7,this.lastAward="none"},events:{"handle-logic":function(a){},"show-award":function(a){var b=this.owner;createjs.Tween.get(this.owner).to({scaleX:0,scaleY:0},200).call(function(){b.triggerEvent("change-award",a)}).to({scaleX:.7,scaleY:.7},800,createjs.Ease.elasticOut)},"change-award":function(a){a||(a="none"),this.owner.state[this.lastAward]=!1,this.owner.state[a]=!0,this.lastAward=a,"none"===a?this.owner.opacity=0:this.owner.opacity=1}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicIntroInfoPanel",properties:{},publicProperties:{},constructor:function(a){this.lastTrain="steam",this.nextTrain="",this.owner.scaleX=1,this.owner.scaleY=1},events:{"handle-logic":function(a){},"change-train":function(a){var b=this.owner;this.nextTrain=a,createjs.Tween.get(this.owner).to({scaleX:0,scaleY:0},200).call(function(){b.triggerEvent("next-train")}).to({scaleX:1,scaleY:1},800,createjs.Ease.elasticOut)},"next-train":function(){this.owner.state[this.lastTrain]=!1,this.owner.state[this.nextTrain]=!0,this.lastTrain=this.nextTrain}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicIntroTrains",properties:{},publicProperties:{},constructor:function(a){this.lastTrain="steam",this.nextTrain="",this.centerX=550,this.centerY=295,this.shiftX=1200,this.shiftY=250},events:{"handle-logic":function(a){},"change-train":function(a){var b=this.owner,c=150;this.nextTrain=a,this.owner.state.zeppelin&&(c=-500),createjs.Tween.get(this.owner).to({x:this.centerX+this.shiftX,y:this.centerY+c,scaleX:1.75,scaleY:1.75},1e3,createjs.Ease.quadIn).call(function(){b.triggerEvent("next-train")})},"next-train":function(){var a=0;this.owner.state[this.lastTrain]=!1,this.owner.state[this.nextTrain]=!0,this.lastTrain=this.nextTrain,this.owner.x=this.centerX-this.shiftX,this.owner.scaleX=.5,this.owner.scaleY=.5,this.owner.state.zeppelin?(this.owner.y=this.centerY-500,a=200):this.owner.y=this.centerY-150,createjs.Tween.get(this.owner).to({x:this.centerX,y:this.centerY-a,scaleX:1,scaleY:1},1e3,createjs.Ease.quadOut)}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPopup",constructor:function(a){this.popped=!1,this.growFrom=a.scale||this.owner.scale||this.owner.scaleX||this.owner.scaleY||1,this.growBy=a.growth||this.owner.growth||1.5,this.opacitySwitch=a.fadeThreshold||.1,this.deathTimerStart=this.deathTimer=a.time||1200},events:{"handle-logic":function(a){var b=a.delta,c=0;this.popped&&(this.deathTimer-=b,this.deathTimer<=0?this.owner.parent.removeEntity(this.owner):(c=this.deathTimer/this.deathTimerStart,this.owner.scaleX=this.growFrom+(1-c)*this.growBy,this.owner.scaleY=this.growFrom+(1-c)*this.growBy,c<=this.opacitySwitch&&(this.owner.opacity=c/this.opacitySwitch)))},pop:function(a){this.popped||(this.popped=!0,this.owner.triggerEvent("popped"))}}})}(),function(){"use strict";var a=platypus.supports.mobile,b="spacebar";return a&&(b="screen"),platypus.createComponentClass({id:"LogicRaceMaster",properties:{},publicProperties:{},constructor:function(a){this.trains=[],this.finalStandings=[],this.done=!1,this.data=null,this.startTicker=8e3,this.cheer=0,this.cheerTime=5e3,this.tutorialPanel=3,this.tutorial=null,this.resultsInfo={practice:!1,standings:[],fastFinish:!1,playerTrain:"dino-train"},this.tuts=null,this.trafficLights=null,this.places=null,this.powerButton=null,this.topTrackButton=null,this.bottomTrackButton=null},events:{"the-traffic-lights":function(a){this.trafficLights=a},"the-places":function(a){this.places=a},"the-power-button":function(a){this.powerButton=a},"the-top-track-button":function(a){this.topTrackButton=a},"the-bottom-track-button":function(a){this.bottomTrackButton=a},"scene-live":function(b){var c=this,d=c.owner,e=d.state,f=platypus.game.currentScene.layers[0],g=0,h=null;if(e["driving-"+b.train]=!0,e.practice=b.practice||!1,this.train=b.train,this.powerButton.state[this.train]=!0,this.practice=b.practice||!1,this.data=b,"dino"!==this.train)for(h=f.getEntitiesByType("bonus-dino-sign"),g=0;g<h.length;g++)f.removeEntity(h[g]);if("rocket"!==this.train)for(h=f.getEntitiesByType("bonus-rocket-sign"),g=0;g<h.length;g++)f.removeEntity(h[g]);if("solar"!==this.train)for(h=f.getEntitiesByType("bonus-solar-sign"),g=0;g<h.length;g++)f.removeEntity(h[g]);a&&(this.owner.parent.triggerEvent("resize-camera",{width:1100,height:550}),this.owner.parent.triggerEvent("relocate",{x:550,y:392})),"zeppelin"===this.train&&(this.topTrackButton.state.visible=!1,this.bottomTrackButton.state.visible=!1),e.practice&&"zeppelin"!==this.train&&this.startTutorial()},"train-added":function(a){this.trains.push(a),a.ghost||a.type!=="train-"+this.train?a.ghost||a.triggerEvent("CHEAT!"):(this.train=a,this.train.bonusSound=!0,this.train.triggerEvent("follow-me"),this.practice&&(this.tutorial=this.train.tutorial.slice()))},"train-finished":function(a){var b=0,c=0,d=[];if(a===this.train&&(this.done=!0,this.powerButton.state.visible=!1,this.topTrackButton.state.visible=!1,this.bottomTrackButton.state.visible=!1),this.finalStandings.push(a),this.finalStandings.length===this.trains.length){for(this.resultsInfo.practice=this.practice,this.resultsInfo.playerTrain=this.train.type,b=0;b<this.finalStandings.length;b++)d[b]=this.finalStandings[b].type;for(this.resultsInfo.standings=d,b=0;b<this.finalStandings.length;b++)this.finalStandings[b]===this.train&&(c=b);this.practice||(this.owner.triggerEvent("play-"+this.train.type+"-"+c),this.awardMedal(c,this.train.type),this.owner.triggerEvent("rl-show-results",this.resultsInfo))}},"fast-finish":function(a){this.owner.state["fast-finish"]=a,a?(this.resultsInfo.fastFinish=!0,this.owner.triggerEvent("play-best-run-"+this.train.type)):this.owner.triggerEvent("play-finish-"+this.train.type),this.owner.triggerEvent("rl-show-results",this.resultsInfo)},"go-up":function(){this.train&&this.train.triggerEvent&&this.train.triggerEvent("go-up")},"go-down":function(){this.train&&this.train.triggerEvent&&this.train.triggerEvent("go-down")},"play-zeppelin-up":function(){this.owner.triggerEvent("play-zeppelin-up-"+b)},"play-zeppelin-down":function(){this.owner.triggerEvent("play-zeppelin-down-"+b)},"play-branch":function(){this.owner.triggerEvent("play-branch-"+b)},"play-power":function(){var a="train";"train-zeppelin"===this.train.type&&(a="zeppelin"),this.owner.triggerEvent("play-"+b+"-"+a)},"play-yay":function(){var a=0;return function(){this.owner.triggerEvent("play-awesome-"+a),a=(a+1)%3}}(),"show-spacebar":function(){this.tuts.length&&(this.tuts[1].triggerEvent("show-spacebar"),this.tuts[2].triggerEvent("show-arrows"),this.tuts[1].triggerEvent("show-sprite"),this.tuts[2].triggerEvent("show-sprite"))},"point-out-power-button":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].x=this.powerButton.x,this.tuts[3].y=this.powerButton.y-75)},"press-spacebar":function(){this.tuts.length&&this.tuts[1].triggerEvent("press-spacebar")},"show-dino-powered":function(){this.tuts.length&&(this.tuts[4].triggerEvent("show-sprite"),this.tuts[4].y=19)},"show-rocket-powered":function(){this.tuts.length&&(this.tuts[4].triggerEvent("show-sprite"),this.tuts[4].y=79)},"show-solar-powered":function(){this.tuts.length&&(this.tuts[4].triggerEvent("show-sprite"),this.tuts[4].y=-41)},"show-dino-powered-zoomed":function(){this.tuts.length&&(this.tuts[4].triggerEvent("show-sprite"),this.tuts[4].x=-350,this.tuts[4].y=20,this.tuts[3].triggerEvent("hide-sprite"))},"show-rocket-powered-zoomed":function(){this.tuts.length&&(this.tuts[4].triggerEvent("show-sprite"),this.tuts[4].x=-350,this.tuts[4].y=120,this.tuts[3].triggerEvent("hide-sprite"))},"show-solar-powered-zoomed":function(){this.tuts.length&&(this.tuts[4].triggerEvent("show-sprite"),this.tuts[4].x=-350,this.tuts[4].y=-80,this.tuts[3].triggerEvent("hide-sprite"))},"pan-to-sign":function(){this.tuts.length&&(a||this.tuts[1].triggerEvent("show-spacebar"),this.tuts[3].triggerEvent("hide-sprite"),this.tuts[4].triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("relocate",{x:8508,y:443,time:1500,ease:createjs.Ease.sineOut}))},"press-down-arrow":function(){this.tuts.length&&(this.tuts[1].triggerEvent("show-spacebar"),this.tuts[2].triggerEvent("show-down-arrow"),this.tuts[3].triggerEvent("sign-go-down"),this.topTrackButton.state.down=!1,this.bottomTrackButton.state.down=!0)},"point-out-down-arrow":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].x=this.bottomTrackButton.x,this.tuts[3].y=this.bottomTrackButton.y-75,this.tuts[3].triggerEvent("sign-go-down"),this.topTrackButton.state.down=!1,this.bottomTrackButton.state.down=!0)},"press-up-arrow":function(){this.tuts.length&&(this.tuts[1].triggerEvent("show-spacebar"),this.tuts[2].triggerEvent("show-up-arrow"),this.tuts[3].triggerEvent("sign-go-up"),this.topTrackButton.state.down=!0,this.bottomTrackButton.state.down=!1)},"point-out-up-arrow":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].x=this.topTrackButton.x,this.tuts[3].y=this.topTrackButton.y-75,this.tuts[3].triggerEvent("sign-go-up"),this.topTrackButton.state.down=!0,this.bottomTrackButton.state.down=!1)},"pan-to-bonus-dino":function(){this.tuts.length&&(this.tuts[1].triggerEvent("hide-spacebar"),this.tuts[2].triggerEvent("hide-arrows"),this.tuts[3].triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("relocate",{x:17958,y:443,time:500,ease:createjs.Ease.sineOut}))},"point-out-bonus-dino":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].x=0,this.tuts[3].y=-150)},"pan-to-bonus-rocket":function(){this.tuts.length&&(this.tuts[1].triggerEvent("hide-spacebar"),this.tuts[2].triggerEvent("hide-arrows"),this.tuts[3].triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("relocate",{x:18508,y:500,time:500,ease:createjs.Ease.sineOut}))},"point-out-bonus-rocket":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].x=0,this.tuts[3].y=140)},"pan-to-bonus-solar":function(){this.tuts.length&&(this.tuts[1].triggerEvent("hide-spacebar"),this.tuts[2].triggerEvent("hide-arrows"),this.tuts[3].triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("relocate",{x:18308,y:450,time:500,ease:createjs.Ease.sineOut}))},"point-out-bonus-solar":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].x=0,this.tuts[3].y=100,this.tuts[3].rotation=180)},"pan-to-bonus-sign":function(){this.tuts.length&&(this.tuts[3].triggerEvent("hide-sprite"),this.owner.parent.triggerEvent("relocate",{x:15258,y:500,time:500,ease:createjs.Ease.sineOut}))},"point-out-bonus-sign":function(){this.tuts.length&&(this.tuts[3].triggerEvent("show-sprite"),this.tuts[3].rotation=0,this.tuts[3].x=0,this.tuts[3].y=0)},"swipe-up":function(){this.owner.state["steam-meter"]=!1,this.owner.state["float-down"]=!1,this.owner.state["touch-up"]=!0},"key-up":function(){this.owner.state["float-down"]=!0},"steam-meter":function(){this.owner.state["steam-meter"]=!0,this.owner.state["show-spacebar"]=!1,this.owner.state["float-down"]=!0,this.owner.state["float-up"]=!1,this.owner.state["touch-release"]=!1},"stop-tutorial":function(){var a=0,b=platypus.game.currentScene.layers[1],c=this.tuts;for(c[3].triggerEvent("sign-go-up"),this.topTrackButton.state.down=!0,this.bottomTrackButton.state.down=!1,a=0;a<c.length;a++)b.removeEntity(c[a]);c.length=0,this.owner.parent.triggerEvent("relocate",{x:550,y:392,time:1500,ease:createjs.Ease.sineOut}),this.owner.state.tutorialling=!1,this.owner.triggerEvent("stop-audio")},"handle-logic":function(){var a=function(a,b){return b.x-a.x};return function(b){var c=0,d=this.startTicker-b.delta,e=this.tutorial;if(e&&e[0]&&e[0].x<this.train.x&&this.owner.triggerEvent(e.splice(0,1)[0].event),this.cheer&&(this.cheer=Math.max(this.cheer-b.delta,0)),!this.owner.state.tutorialling&&this.startTicker)0>=d?(d=0,createjs.Tween.get(this.trafficLights).to({y:this.trafficLights.y-251},500,createjs.Ease.quadIn)):1500>=d?this.startTicker>1500&&(this.trafficLights.state.go=!0,this.owner.triggerEvent("go-"+this.data.train,!0),this.practice?this.owner.triggerEvent("play-power"):this.owner.triggerEvent("play-go")):3e3>=d?this.startTicker>3e3&&(this.trafficLights.state.set=!0,this.owner.triggerEvent("play-set")):4500>=d?this.startTicker>4500&&(this.trafficLights.state.ready=!0,this.owner.triggerEvent("play-ready")):this.trafficLights.state.used||(this.trafficLights.state.used=!0,createjs.Tween.get(this.trafficLights).to({y:this.trafficLights.y+251},500,createjs.Ease.quadOut)),this.trafficLights.triggerEvent("logical-state"),this.startTicker=d;else if(!this.done){for(this.trains.sort(a),c=0;c<this.trains.length;c++)this.trains[c].standing=c+1,this.trains[c].standingDistance=this.trains[c].x-this.train.x,this.trains[c].x===this.trains[0].x&&(this.trains[c].standing=1);this.standing!==this.train.standing&&(this.updateState(this.standing,this.train.standing),this.standing=this.train.standing)}this.train.state&&this.choosingUp!==this.train.state.choosingUp&&(this.choosingUp=this.train.state.choosingUp,this.owner.state["choosing-up"]=this.choosingUp,this.owner.state["choosing-down"]=!this.choosingUp)}}(),race:function(){this.data.practice=!1,this.owner.triggerEvent("stop-audio"),platypus.game.loadScene("race","fade-to-black",this.data)},practice:function(){this.data.practice=!0,this.owner.triggerEvent("stop-audio"),platypus.game.loadScene("practice","fade-to-black",this.data)},menu:function(){this.owner.triggerEvent("stop-audio"),platypus.game.loadScene("menu","fade-to-black",this.data)}},methods:{startTutorial:function(){var a=platypus.game.currentScene.layers[1];this.tuts=[a.addEntity("tut-skip"),a.addEntity("tut-spacebar"),a.addEntity("tut-arrows"),a.addEntity("tut-pointer"),a.addEntity("tut-going")],this.owner.state.tutorialling=!0,setTimeout(function(){this.owner.triggerEvent("play-"+this.train+"-"+b+"-tutorial")}.bind(this),2e3)},updateState:function(){var a=0,b=0,c={"train-dino":["play-lead","play-lead-dino"],"train-rocket":["play-lead","play-lead-rocket"],"train-solar":["play-lead","play-lead-solar"],"train-zeppelin":["play-lead","play-lead-zeppelin"]},d=["play-way-to-go","play-yeah","play-awesome"];return function(e,f){var g=0;if(this.places){for(this.places.state.visible=!0,g=1;4>=g;g++)this.places.state["place-"+g]=!1;this.places.state["place-"+f]=!0,this.places.triggerEvent("logical-state")}this.practice||this.cheer||(1===e?(this.cheer=this.cheerTime,this.owner.triggerEvent("play-uh-oh")):1===f?(this.cheer=this.cheerTime,a=1-a,this.owner.triggerEvent(c[this.train.type][a])):e>f&&(this.cheer=this.cheerTime,b=(b+1)%3,this.owner.triggerEvent(d[b])))}}(),awardMedal:function(a,b){var c=null,d=null;try{c=JSON.parse(window.localStorage.getItem("dt-rail-rally"))}catch(e){}c||(c={}),c.awards?d=c.awards:c.awards=d={},3>a&&(isNaN(d[b])||a<d[b])&&(d[b]=a,window.localStorage.setItem("dt-rail-rally",JSON.stringify(c)))},destroy:function(){this.tuts=null,this.trafficLights=null,this.places=null,this.powerButton=null,this.topTrackButton=null,this.bottomTrackButton=null}},publicMethods:{}})}(),function(){"use strict";var a=210,b=150,c=66,d=20,e=0,f=60;return platypus.createComponentClass({id:"LogicResultsScreen",properties:{},publicProperties:{},constructor:function(a){this.owner.state.practice=!1},events:{"handle-logic":function(a){},"show-results":function(g){var h=0,i=null,j={},k=null,l=0,m=0,n=0;if(this.owner.opacity=1,g.practice)this.owner.state.practice=!0,j[g.playerTrain]=!0,h="train-zeppelin"===g.playerTrain?-45:0,i={x:this.owner.x,y:this.owner.y+h,z:this.owner.z+1,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-big-train"],{properties:i})),i={x:this.owner.x-250,y:this.owner.y+230,z:this.owner.z+2,state:{}},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-station-button"],{properties:i})),i={x:this.owner.x,y:this.owner.y+230,z:this.owner.z+2,state:{}},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-practice-button"],{properties:i})),i={x:this.owner.x+250,y:this.owner.y+230,z:this.owner.z+2,state:{}},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-race-button"],{properties:i})),g.fastFinish&&(h="train-zeppelin"===g.playerTrain?115:-140,i={x:this.owner.x+220,y:this.owner.y+h,z:this.owner.z+2,state:{}},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-best-run"],{properties:i})));else{for(k=g.standings,h=0;h<k.length;h++)k[h]===g.playerTrain&&(l=h);2>=l&&(j[["gold","silver","bronze"][l]]=!0,i={x:this.owner.x-150,y:this.owner.y+20,z:this.owner.z+1,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-medal"],{properties:i}))),3===l?(m=e,n=f):(m=b,n=a),j={first:!0},0===l&&(j.highlight=!0),i={x:this.owner.x+m,y:this.owner.y+d-1.5*c,z:this.owner.z+1,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-place-slot"],{properties:i})),j={second:!0},1===l&&(j.highlight=!0),i={x:this.owner.x+m,y:this.owner.y+d-c/2,z:this.owner.z+1,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-place-slot"],{properties:i})),j={third:!0},2===l&&(j.highlight=!0),i={x:this.owner.x+m,y:this.owner.y+d+c/2,z:this.owner.z+1,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-place-slot"],{properties:i})),j={fourth:!0},3===l&&(j.highlight=!0),i={x:this.owner.x+m,y:this.owner.y+d+1.5*c,z:this.owner.z+1,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-place-slot"],{properties:i})),j={},j[k[0]]=!0,i={x:this.owner.x+n,y:this.owner.y+d-1.5*c,z:this.owner.z+2,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-slot-train"],{properties:i})),j={},j[k[1]]=!0,i={x:this.owner.x+n,y:this.owner.y+d-c/2,z:this.owner.z+2,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-slot-train"],{properties:i})),j={},j[k[2]]=!0,i={x:this.owner.x+n,y:this.owner.y+d+c/2,z:this.owner.z+2,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-slot-train"],{properties:i})),j={},j[k[3]]=!0,i={x:this.owner.x+n,y:this.owner.y+d+1.5*c,z:this.owner.z+2,state:j},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-slot-train"],{properties:i})),i={x:this.owner.x-150,y:this.owner.y+230,z:this.owner.z+3,state:{}},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-station-button"],{properties:i})),i={x:this.owner.x+150,y:this.owner.y+230,z:this.owner.z+3,state:{}},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-race-button"],{properties:i}))}}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=0,b=new platypus.Vector(0,0);return platypus.createComponentClass({id:"NodePath",properties:{nodeEntity:null,color:"accent",shade:null},publicProperties:{startingLine:!1,endingLine:!1},constructor:function(a){this.entityClass=platypus.game.settings.entities[a.nodeEntity],this.pointerClass=platypus.game.settings.entities.pointer,this.points=null,this.owner.shape&&this.owner.shape.points&&(this.points=this.owner.shape.points)},events:{adopted:function(){var c=0,d=0,e=0,f=this.points,g=0,h=null,i=null,j="",k="",l=null,m=null;for(c=0;c<f.length;c++){if(i=null,g=0!==c&&c!==f.length-1?b.set(f[c+1].x-f[c-1].x,f[c+1].y-f[c-1].y).getAngle():0,d=f[c].x+this.owner.x,e=f[c].y+this.owner.y,k="tie:"+String(d)+","+String(e),j?(h=this.owner.parent.getNode(j),i={back:h},this.endingLine||c!==f.length-1||(k=this.owner.parent.getClosestNode([d,e]).id),h.neighbors.ahead?(h.triggerEvent("add-neighbors",{above:k}),this.owner.parent.addEntity(new platypus.Entity(this.pointerClass,{properties:{x:h.x,y:h.y-112,z:h.z-1e-7}}))):h.triggerEvent("add-neighbors",{ahead:k})):this.owner.startingLine||(k=this.owner.parent.getClosestNode([d,e]).id),l=this.owner.parent.getNode(k)){if(j)break}else m={},this.color&&(m[this.color]=!0),this.shade&&this.shade[c]&&" "!==this.shade[c]&&(m.shade=!0,m[this.shade[c]]=!0),l=this.owner.parent.addEntity(new platypus.Entity(this.entityClass,{properties:{id:k,rotation:180*g/Math.PI,x:f[c].x+this.owner.x,y:f[c].y+this.owner.y,z:this.owner.z-a,neighbors:i,state:m}})),a+=1e-7,this.owner.triggerEvent("entity-created",l);j=k}}},methods:{},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"RacerHook",constructor:function(){this.done=!1},events:{"scene-loaded":function(a){var b=null,c=null,d=null;if(a.practice&&!this.owner.ghost)if(this.owner.type!=="train-"+a.train)this.owner.parent.removeEntity(this.owner);else{try{b=JSON.parse(window.localStorage.getItem("dt-rail-rally"))}catch(e){}b||(b={}),b.ghosts&&b.ghosts[a.train]&&(d=b.ghosts[a.train],c=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities[this.owner.type],{properties:{x:this.owner.x,y:this.owner.y,z:this.owner.z,regX:this.owner.regX,regY:this.owner.regY,ghost:!0,opacity:.3,componentMap:{"start-race":{remove:"AIPilot",add:{type:"TapeDeck",playback:d,autoPlay:!0}},ghostify:{remove:["RelayLinker","CameraFollowMe"],add:{type:"RelayLinker"}}}}})),c.triggerEvent("ghostify")),this.owner.triggerEvent("add-recorder"),this.addEventListener("finished-recording",function(b){var c=null,e=0,f=null,g=null,h=null;if(!d||!d.time||d.time>b.time){try{c=JSON.parse(window.localStorage.getItem("dt-rail-rally"))}catch(i){}for(c||(c={}),c.ghosts||(c.ghosts={}),g=b.events,h=b.events=[],e=0;e<g.length;e++)g[e].message.pressed!==f&&(f=g[e].message.pressed,delete g[e].message.released,delete g[e].message.triggered,h.push(g[e]));c.ghosts[a.train]=b,window.localStorage.setItem("dt-rail-rally",JSON.stringify(c)),this.owner.triggerEvent("finished-fast",!!d)}else this.owner.triggerEvent("finished-fast",!1)})}},"start-race":function(){this.owner.triggerEvent("add-me",this.owner)},"with-finish-line":function(){this.done||(this.done=!0,this.owner.triggerEvent("im-done",this.owner))}}})}(),function(){"use strict";var a=30;return platypus.createComponentClass({id:"RailFixer",properties:{},publicProperties:{},constructor:function(a){this.yMin=-(1/0),this.yMax=1/0,this.yLast=0},events:{"world-loaded":function(){this.addMasks(this.owner.map)},mousedown:function(b){this.yMin=b.y-a,this.yMax=b.y+a,this.yLast=b.y},mousemove:function(b){b.y<this.yLast?(this.yMax=b.y+a,b.y<this.yMin&&(this.yMin=b.y-a)):b.y>this.yLast&&(this.yMin=b.y-a,b.y>this.yMax&&(this.yMax=b.y+a)),this.yLast=b.y},mouseup:function(a){}},methods:{addMasks:function(){var a=platypus.Vector,b=(new a,new a,function(b,c,d,e){var f=b.x-c.x,g=d.x-e.x,h=b.y-c.y,i=d.y-e.y,j=b.x*c.y-b.y*c.x,k=d.x*e.y-d.y*e.x,l=f*i-h*g;return Math.abs(l)<4096?null:new a((g*j-f*k)/l,(i*j-h*k)/l)}),c=function(a,b,c,d){var e=new PIXI.Graphics;Math.round;return e.beginFill(0,1),d?e.drawPolygon([a.x,a.y,b.x,b.y,c.x,c.y,d.x,d.y]):e.drawPolygon([a.x,a.y,b.x,b.y,c.x,c.y]),e.endFill(),e},d=function(d,e,f){var g=d.position,h=d.cacheRender,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=Math.PI,r=q/2,s=100,t=null,u=null;e?i=e.position:(i=new a(g),i.x-=s),f?j=f.position:(j=new a(g),j.x+=s),k=new a(j).subtractVector(g).multiply(.5),l=new a(i).subtractVector(g).multiply(.5),u=new a(k).add(l).multiply(.5).add(g),k.multiply(1.04),l.multiply(1.04),m=new a(k).rotate(r).normalize().multiply(s),n=new a(m).rotate(q),o=new a(l).rotate(r).normalize().multiply(s),p=new a(o).rotate(q),m.add(k),n.add(k),o.add(l),p.add(l),t=b(m,n,o,p),t&&t.magnitude()<1.1*s?k.set(m).subtractVector(t).magnitude()>l.set(n).subtractVector(t).magnitude()?h?(h.mask=c(m.add(g),p.add(g),t.add(g)),h.x=u.x,h.y=u.y):d.triggerEvent("set-mask",c(m.add(g),p.add(g),t.add(g))):h?(h.mask=c(n.add(g),o.add(g),t.add(g)),h.x=u.x,h.y=u.y):d.triggerEvent("set-mask",c(n.add(g),o.add(g),t.add(g))):h?(h.mask=c(m.add(g),n.add(g),o.add(g),p.add(g)),h.x=u.x,h.y=u.y):d.triggerEvent("set-mask",c(m.add(g),n.add(g),o.add(g),p.add(g)))};return function(a){var b=0;for(b=0;b<a.length;b++)d(a[b],a[b].getNode("back"),a[b].getNode("ahead"))}}()},publicMethods:{}})}(),function(){"use strict";var a=0,b=75,c=2.5;return platypus.createComponentClass({id:"SignPointer",properties:{updateMessage:!1},publicProperties:{rotation:0},constructor:function(){this.direction=-c,this.destination=a},events:{"going-down":function(){this.direction=c,this.destination=b},"going-up":function(){this.direction=-c,this.destination=a},"handle-logic":function(){this.rotation!==this.destination&&(this.rotation+=this.direction,this.rotation<a?this.rotation=a:this.rotation>b&&(this.rotation=b),this.updateMessage&&this.owner.triggerEvent("update-sign",{webkitTransform:"rotate("+this.owner.rotation+"deg)",mozTransform:"rotate("+this.owner.rotation+"deg)",msTransform:"rotate("+this.owner.rotation+"deg)",transform:"rotate("+this.owner.rotation+"deg)"}))}}})}(),function(){"use strict";return platypus.createComponentClass({id:"StateProperty",properties:{properties:[]},constructor:function(a){var b=0,c=this.owner.state,d=this.properties,e=null;for(b=0;b<d.length;b++)e=this.owner[d[b]],e&&(e===!0?c[d[b]]=!0:"string"==typeof e&&(c[d[b]+"-"+e]=!0))}})}(),function(){"use strict";var a=function(b){var c=0,d="",e=null;if(null===b||"object"!=typeof b)return b;if(b instanceof Array){for(e=[],c=0;c<b.length;c++)e[c]=a(b[c]);return e}if(b instanceof Object){e={};for(d in b)b.hasOwnProperty(d)&&(e[d]=a(b[d]));return e}throw new Error("Unable to copy obj! Its type isn't supported.");
},b=function(b){return function(c,d){this.recording&&this.stepEvents.push({event:b,message:a(c),debug:d})}},c=[];return window.printTest=function(a,b){var d=0,e=!1,f=!1,g=!1,h=!1;for(d=0;d<c[b].length&&(c[b][d].x!==c[a][d].x&&(e=!0),c[b][d].v!==c[a][d].v&&(f=!0),c[b][d].p!==c[a][d].p&&(g=!0),c[b][d].f!==c[a][d].f&&(h=!0),!f);d++);},platypus.createComponentClass({id:"TapeDeck",properties:{autoPlay:!1,autoRecord:!1,record:[],playback:{events:[],time:0}},publicProperties:{},constructor:function(a){var c=0;if(this.playing=!1,this.recording=!1,this.time=0,this.index=0,this.playback.events||(this.playback.events=[]),this.events=this.playback.events,this.stepEvents=[],this.record)for(c=0;c<this.record.length;c++)this.addEventListener(this.record[c],b(this.record[c]));this.autoRecord&&this.startRecording(),this.autoPlay&&this.startPlayback(),this.steps=0,this.lteps=0},events:{"handle-ai":function(a){var b=0,d=null,e=a.delta;if(this.playing){for(this.steps+=1,this.time+=e,b=this.index;b<this.events.length&&this.events[b].time<=this.time;b++)this.owner.trigger(this.events[b]),this.index+=1,c[c.length-1].push({x:this.owner.x,v:this.owner.speed,p:this.owner.components[2].powered,f:this.owner.components[2].fuel});this.time>=this.playback.time&&(this.playing=!1,c.length>1&&window.printTest(c.length-2,c.length-1),this.index=0,this.owner.triggerEvent("finished-playback"))}else if(this.recording){for(this.time+=e,b=0;b<this.stepEvents.length;b++)d=this.stepEvents[b],d.time=this.time,this.events.push(d);this.stepEvents.length=0}},"handle-logic":function(){this.playing&&(this.lteps+=1)},play:function(){this.startPlayback()},record:function(){this.startRecording()},"stop-record":function(){this.stopRecording()}},methods:{startPlayback:function(){c.push([]),this.playing=!0,this.time=0},startRecording:function(){this.recording=!0,this.events.length=0,this.time=0},stopRecording:function(){this.recording=!1,this.playback.time=this.time,this.owner.triggerEvent("finished-recording",this.playback)}},publicMethods:{}})}(),function(){"use strict";var a=new platypus.Vector(0,0,0),b={"train-dino":new platypus.Vector(10,-64,10),"train-rocket":new platypus.Vector(-32,-24,-10),"train-solar":new platypus.Vector(40,-24,-10)},c={"train-dino":[.5,3],"train-rocket":[1.6,.5],"train-solar":[1.6,.5]};return platypus.createComponentClass({id:"TrainEngine",properties:{acceleration:5e-4,bonusMultiplier:1.4,bonusTime:1e3},publicProperties:{},constructor:function(a){this.owner.speed=0,this.minSpeed=.2,this.carsInTow=!1,this.passedTies=0,this.state=this.owner.state,this.movedLastTurn=!1,this.hillAcceleration=this.acceleration/2,this.camFade=500,this.camOut=750,this.camCenter=0,this.chug=0,this.choosingUp=!0},events:{"use-power":function(a){this.powered=a.pressed!==!1},"camera-update":function(a){this.camCenter=a.viewport.x},"CHEAT! no more":function(){this.acceleration*=.8,this.hillAcceleration*=.8},"handle-logic":function(a){var b=a.delta,c=.99,d=this.owner;this.onFire?(d.speed+=this.acceleration*this.bonusMultiplier*b,this.onFire-=b,this.onFire<=0&&(this.onFire=0)):this.owner.rotation>=180?(c=.9992+8e-4*(360-d.rotation)/360,this.powered?d.speed+=this.hillAcceleration*b:c=(c+1)/2,d.speed*=Math.pow(c,b)):this.powered&&(d.speed+=this.acceleration*b),this.movedLastTurn=this.state.moving,!this.state.moving&&d.speed&&(this.twoPaths&&this.choosingUp?d.triggerEvent("above"):d.triggerEvent("ahead")),d.state.choosingUp=this.choosingUp,this.state.fast=d.speed>.06||this.powered,this.state.slow=d.speed>.004&&!this.state.fast},"go-up":function(){this.choosingUp=!0},"go-down":function(){this.choosingUp=!1},"with-bonus-rocket":function(){"train-rocket"===this.owner.type&&(this.onFire=this.bonusTime,this.acceleration*=1.04,this.playBoost("rocket-boost","rocket-bonus"))},"with-bonus-solar":function(){"train-solar"===this.owner.type&&(this.onFire=this.bonusTime,this.acceleration*=1.05,this.playBoost("solar-boost","solar-bonus"))},"with-bonus-dino":function(a){"train-dino"===this.owner.type&&(this.onFire=this.bonusTime,this.acceleration*=1.045,this.playBoost("dino-boost","dino-bonus"))},"passing-tie":function(){return function(a){var b=.1,c=0,d=0;this.passedTies+=1,a.neighbors.above?this.twoPaths=!0:this.twoPaths=!1,platypus.supports.mobile||this.owner.ghost||!this.onFire&&!this.powered||this.puff(a),"train-solar"===this.owner.type&&(a.state.shade?(this.owner.speed*=.995,this.shaded||(this.shaded=!0,this.playBoost("solar-slow"))):this.shaded&&(this.shaded=!1)),!this.owner.ghost&&this.owner.x>this.camCenter-this.camOut&&this.owner.x<this.camCenter+this.camOut&&(this.chug=(this.chug+.25)%4,(this.powered||this.onFire)&&(b+=.2),d=this.owner.x-this.camCenter,c=d/this.camOut,d=Math.abs(d)-this.camFade,d>0&&(b*=1-d/(this.camOut-this.camFade)),this.chug===Math.floor(this.chug)&&this.owner.triggerEvent("chug"+String(this.chug),{volume:b,pan:c,debug:!1}))}}()},methods:{puff:function(){var d=platypus.Entity,e=null,f={state:null,x:0,y:0,z:0,scaleX:.1,scaleY:.1,growth:0,rotation:0},g={properties:f};return function(h){var i=a.set(b[this.owner.type]).rotate(h.rotation/180*Math.PI).add(this.owner.x,this.owner.y,this.owner.z),j=c[this.owner.type];f.state={},f.x=i.x,f.y=i.y,f.z=i.z,this.onFire?(f.scaleX=j[0],f.scaleY=j[0],f.growth=j[1]-j[0]):h.rotation<180?(f.scaleX=j[0]/2,f.scaleY=j[0]/2,f.growth=(j[1]-j[0])/2):(f.scaleX=j[0]/3,f.scaleY=j[0]/3,f.growth=(j[1]-j[0])/3),f.rotation=360*Math.random(),f.state[this.owner.type]=!0,e||(e=platypus.game.settings.entities.popup),this.owner.parent.addEntity(new d(e,g))}}(),playBoost:function(a,b){var c=0,d=0,e=1;this.owner.bonusSound&&this.owner.x>this.camCenter-this.camOut&&this.owner.x<this.camCenter+this.camOut&&(c=this.owner.x-this.camCenter,d=c/this.camOut,c=Math.abs(c)-this.camFade,c>0&&(e*=1-c/(this.camOut-this.camFade)),this.owner.triggerEvent(a,{volume:e,pan:d}),b&&this.owner.triggerEvent("attach"))}}})}(),function(){"use strict";var a=new platypus.Vector(0,0,0);return platypus.createComponentClass({id:"ZeppelinEngine",properties:{refuelRate:.2,defuelRate:.2},constructor:function(a){this.camFade=500,this.camOut=750,this.camCenter=0,this.active=!1,this.wind=.005,this.owner.state.choosingUp=!1},events:{"use-power":function(a){this.powered=this.owner.state.choosingUp=a.pressed!==!1},"camera-update":function(a){this.camCenter=a.viewport.x},"CHEAT! no more":function(){this.wind*=.8},"handle-logic":function(a){var b=.2,c=0,d=0;this.owner.y<this.owner.height?(this.owner.y=this.owner.height,this.owner.dy=0):this.owner.y>450&&(this.owner.y=450,this.owner.dy=0),!this.owner.ghost&&this.camCenter&&this.owner.x>this.camCenter-this.camOut&&this.owner.x<this.camCenter+this.camOut?(this.powered&&(b+=.1),c=this.owner.x-this.camCenter,d=c/this.camOut,c=Math.abs(c)-this.camFade,c>0&&(b*=1-c/(this.camOut-this.camFade)),this.active?(this.owner.triggerEvent("set-volume",b),this.owner.triggerEvent("set-pan",d)):(this.active=!0,this.owner.triggerEvent("play-prop",{volume:b,pan:d,loop:-1}))):this.active&&(this.active=!1,this.owner.triggerEvent("stop-audio"))},"in-wind":function(b){var c=a.set(this.wind,0,0);this.owner.velocity.add(c)}},methods:{},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"AIConductor",properties:{errorRatio:.01,errorWindow:2e3,adaptableAI:!0,powerOnly:!1},publicProperties:{standingDistance:0},constructor:function(a){var b=(this.errorRatio-1)*this.errorWindow;this.on=!1,this.powerOnly&&(this.adaptableAI=!1,this.errorRatio=1),this.adaptableAI?this.getErrorRatio=function(){return 1-Math.min(Math.max(0,this.standingDistance-b),this.errorWindow)/this.errorWindow}:this.getErrorRatio=function(){return this.errorRatio},this.powerButtonPressed=!1},events:{"handle-ai":function(){!this.powerButtonPressed&&this.powerOnly?this.on&&(this.on=!1,this.owner.triggerEvent("use-power",{pressed:!1})):!this.on&&this.owner.speed<1?(this.on=!0,this.owner.triggerEvent("use-power",{pressed:!0}),this.powerOnly||this.owner.triggerEvent("go-down")):this.owner.rotation<180?!this.on&&Math.random()<this.getErrorRatio()&&(this.on=!0,this.owner.triggerEvent("use-power",{pressed:!0}),this.powerOnly||this.owner.triggerEvent("go-down")):this.on&&Math.random()<this.getErrorRatio()&&(this.on=!1,this.owner.triggerEvent("use-power",{pressed:!1}),this.powerOnly||this.owner.triggerEvent("go-up"))},"use-power-keyboard":function(a){a.pressed===!0?this.powerButtonPressed=!0:this.powerButtonPressed=!1},"use-power-down":function(){this.powerOnly&&(this.powerButtonPressed=!0)},"use-power-up":function(){this.powerOnly&&(this.powerButtonPressed=!1)}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("springroll.pixi.PixiDisplay"),c=new a({name:"rail-rally",canvasId:"stage",cacheBust:!0,configPath:"assets/config/config.json",display:b,displayOptions:{clearView:!0,transparent:!0,forceContext:platypus.supports.iOS||platypus.supports.silk?"canvas2d":null},keepFocus:!0,preload:[{id:"packed",src:"assets/images/packed.png"},{id:"game-ui",src:"assets/images/game-ui.png"},{id:"intro",src:"assets/images/intro.png"},{id:"bg00",src:"assets/images/bg00.jpg"}]});c.on("init",function(){var a=function(){var a=document.getElementById("stage");c.container.send("resizegame",{width:a.offsetWidth,height:a.offsetHeight})};c.on("resize",a),a()}),window.app=c,document.domain.indexOf("pbskids.org")>=0&&(document.domain="pbskids.org")}();