"use strict";!function(){var e,t=window,i=document,a=i.body,n=Boolean("ontouchstart"in window||navigator.maxTouchPoints),r=navigator?navigator.userAgent:t.navigator.userAgent,o={is_opera:-1!==r.toLowerCase().indexOf("op"),is_chrome:-1!==r.indexOf("Chrome"),is_explorer:-1!==r.indexOf("MSIE")||-1!==r.indexOf("Trident/"),is_firefox:-1!==r.indexOf("Firefox"),is_safari:-1!==r.indexOf("Safari"),is_edge:-1!==r.indexOf("Edge"),is_ipad:-1!==r.indexOf("iPad"),is_ios:!!navigator.platform&&/iPad|iPhone|iPod/i.test(navigator.platform),is_android:/android/i.test(r),is_windows_phone:/Windows Phone/i.test(r),is_mobile:/mobile/i.test(r)},s=function(){var e,t=document.createElement("whatever"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};if(o.is_explorer||o.is_edge||o.is_ipad)return 0;for(e in i)if(void 0!==t.style[e])return i[e]}();function l(e,t){return"string"==typeof e&&e.trim().match(/<(\w+)(.*?)\/?>/)?function(e,t){var a,n=1;for(e.match(/^<(tbody|thead|tfoot|caption|colgroup)[\s|>].*/)?a=l("<table>"):e.match(/^<tr[\s|>].*/)?(a=l("<table><tbody>"),n=2):e.match(/^<col[\s|>].*/)?(a=l("<table><colgroup>"),n=2):e.match(/^<td[\s|>].*/)?(a=l("<table><tbody><tr>"),n=3):e.match(/^<th[\s|>].*/)?(a=l("<table><thead><tr>"),n=3):a=e.match(/^<option[\s|>].*/)?i.createElement("select"):i.createElement("div"),a.innerHTML=e;n--;)a=a.firstChild;return"object"==typeof t&&Object.keys(t).forEach(function(e){a.setAttribute(e,t[e])}),a}(e,t):function(e,t){var a=[].slice;return void 0===t&&(t=e,e=i),/^#[\w-]+$/.test(t)?i.getElementById(t.substr(1)):function(e){return[].concat.apply([],e)}(t.split(",").map(function(t){if(!/^([#|.]?[\w-]+)$/.test(t))return a.call(e.querySelectorAll(t));switch(t.charAt(0)){case"#":return i.getElementById(t.substr(1));case".":return a.call(e.getElementsByClassName(t.substr(1)));default:return a.call(e.getElementsByTagName(t))}}))}(e,t)}function d(e){return"string"==typeof e?e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"):e}function c(e,i,a){var n,r,o,l,d=0,c=function(e){(++d>=r||!e.propertyName)&&(this.removeEventListener(s,c),i(e))};s?(l=new Event(s),n=t.getComputedStyle(e,null)["transition-property"]||"",r=n.split(",").length,a&&(o=(t.getComputedStyle(e,null)["transition-duration"]||"").split(",").reduce(function(e,t){return-1!==t.indexOf("ms")?Math.max(e,parseFloat(t.replace("ms",""))):-1!==t.indexOf("s")?Math.max(e,1e3*parseFloat(t.replace("s",""))):e},0),setTimeout(function(){return e?e.dispatchEvent(l):0},1.5*o)),e.on(s,c)):setTimeout(function(){i({target:e})})}o.is_chrome=o.is_chrome&&!o.is_opera,o.is_safari=o.is_safari&&!o.is_chrome,o.is_mobile=o.is_mobile||o.is_ipad||o.is_ios||o.is_android||o.is_windows_phone,console.log("%c Modern English ðŸŒ³ ","color: white; background: #AFC731; padding: 2px;"),Window.prototype.on=Element.prototype.on=document.on=function(e,t){var a=this;return e.replace(/(\s)/g,"").split(",").map(function(e){return function(e,t,a){return e===i&&"load"===t&&(t="DOMContentLoaded"),e.addEventListener(t,a),e}(a,e,t)}),this},Array.prototype.on=function(e,t){return this.map(function(i){return i.on(e,t)})},Element.prototype.removeClass=function(e){return this.className=this.className.replace(new RegExp("(^| )"+d(e)+"( |$)","ig"),"$2").trim(),this},Array.prototype.removeClass=function(e){return this.map(function(t){return t.removeClass(e)})},Element.prototype.addClass=function(e){return this.hasClass(e)||(this.className+=(this.className?" ":"")+e),this},Array.prototype.addClass=function(e){return this.map(function(t){return t.addClass(e)})},Element.prototype.hasClass=function(e){return new RegExp("(^| )"+d(e)+"( |$)","ig").test(this.className)},document.remove||(Element.prototype.remove=function(){this&&this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.remove=function(e){void 0!==this[e]&&this.splice(e,1)},Array.prototype.shuffle=function(){for(var e,t,i=this.length;i>0;)t=Math.random()*i--|0,e=this[i],this[i]=this[t],this[t]=e},Array.prototype.clone=function(){return this.map(function(e){return Object.assign({},e)})},Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,i,a,n,r,o,s,l=1;if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(t=Object(e);l<arguments.length;l++)if(void 0!==(i=arguments[l])&&null!==i)for(i=Object(i),a=0,o=(r=Object.keys(i)).length;a<o;a++)n=r[a],void 0!==(s=Object.getOwnPropertyDescriptor(i,n))&&s.enumerable&&(t[n]=i[n]);return t}}),function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var a=(new Date).getTime(),n=Math.max(0,16-(a-e)),r=window.setTimeout(function(){t(a+n)},n);return e=a+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),o.is_explorer||o.is_edge?(a.addClass("is-ms"),o.is_explorer&&a.addClass("is-ie")):o.is_mobile&&a.addClass("is-not-desktop"),o.is_ios||o.is_ipad?(e="is-ios"+(o.is_ipad?" is-ipad":""),a.addClass(e),l("html").addClass(e)):o.is_android&&(a.addClass("android"),l("html").addClass("android")),navigator.platform.match(/mac/i)||n||a.addClass("sb");var u={success:["daisy_brilliant","daisy_fantastic","daisy_hooray","daisy_well_done","daisy_well_done_2","ollie_brilliant","ollie_fantastic","ollie_hooray","ollie_well_done","ollie_well_done_2"],finished:["daisy_you_are_the_winner","ollie_you_are_the_winner"],start:["daisy_can_you_spot","ollie_can_you_spot"]},m={},h=[],f={bench:{scene:"Bench",img_left:"left.png",img_right:"right.png",marker:[[10.67,21.58,23.31,25.28],[41.53,22.04,51.4,18.82],[45.01,12.76,86.8,10.39],[8.82,12.76,60.96,11.8],[79.35,15.55,70.79,10.39],[21.81,9.28,80.06,11.24],[47.56,9.28,8.71,11.24],[56.61,10.44,71.35,11.24]]},garden:{scene:"Garden",img_left:"left.png",img_right:"right.png",marker:[[18.56,14.15,29.49,12.08],[40.14,10.9,17.13,30.62],[83.99,13.69,55.06,11.52],[53.36,16.94,70.22,9.27],[65.43,16.47,58.43,9.55],[72.85,9.28,17.98,11.24],[9.98,9.05,64.04,13.48],[4.18,13.46,76.12,18.82]]},nursery:{scene:"Nursery",img_left:"left.png",img_right:"right.png",marker:[[2.47,14.64,27.36,20.69],[34.22,10.84,29.89,17.24],[48.86,11.79,41.38,12.18],[35.36,21.86,82.3,17.47],[81.94,16.92,83.91,15.4],[68.06,19.2,43.68,20.69],[28.9,12.93,62.3,13.33],[5.13,19.58,58.16,19.31]]},shop:{scene:"Shop",img_left:"left.png",img_right:"right.png",marker:[[38.21,24.52,12.18,24.6],[83.84,16.16,34.94,49.66],[61.22,9.7,66.21,12.18],[54.18,11.41,86.67,10.57],[40.87,10.27,61.38,10.34],[33.08,11.22,46.9,14.02],[13.88,13.69,81.38,13.79]]},park:{scene:"Park",img_left:"left.png",img_right:"right.png",marker:[[14.26,15.21,34.94,16.32],[35.36,11.41,22.3,14.71],[15.59,14.83,62.76,18.62],[30.8,20.91,65.29,17.24],[48.29,13.88,78.85,20.92],[71.29,21.67,75.86,18.39],[68.82,11.41,56.09,10.34],[49.62,14.45,42.76,14.71],[66.73,30.8,37.47,18.16]]},garage:{scene:"Garage",img_left:"left.png",img_right:"right.png",marker:[[27.38,13.88,.46,13.1],[25.86,13.31,18.85,10.34],[75.86,8.37,16.55,10.8],[79.47,19.96,35.4,13.56],[71.67,14.64,63.45,15.17],[11.98,28.71,34.25,19.08],[11.6,19.2,53.79,37.93]]},hairdressers:{scene:"Hairdressers",img_left:"left.png",img_right:"right.png",marker:[[25.48,15.97,60.46,19.08],[38.97,11.41,79.08,13.33],[86.31,9.13,73.33,17.24],[84.22,14.26,47.82,10.8],[73,14.83,5.52,24.14],[9.7,25.86,11.26,43.68],[38.59,24.52,17.47,29.43]]},pirates:{scene:"Pirates",img_left:"left.png",img_right:"right.png",marker:[[.96,32.01,7.32,35.84],[67.99,14.33,8.09,15.8],[85.03,11.46,58,10.79],[75.48,9.39,84.2,10.02],[45.22,26.27,72.45,9.83],[42.2,16.4,85.93,12.72],[21.66,18.47,50.1,25.05],[19.9,18.79,75.53,21.19],[2.55,15.45,86.9,12.72]]}};function p(e){var t,i,a,n;if(u[e]){for((t=u[e].slice(0)).shuffle(),i=t.length;i--;){for(a=m[e].length,n=0;a--;)t[i]===m[e][a]&&(n=1,a=0);if(!n)return m[e].push(t[i]),void $("voice/"+t[i]+".mp3")}m[e]=[m[e][0]],$("voice/"+m[e][0]+".mp3")}}function g(){for(var e,t,i=function(){var e,t=[];for(e in f)t.push(e);for(e in t.length===h.length&&(h=[]),t.shuffle(),t)if(!~h.indexOf(t[e]))return h.push(t[e]),t[e]}(),a=f[i],n=l("#game-spot-the-difference-container");n.firstElementChild;)n.firstElementChild.remove();e=l("<div>",{class:"game-difference"}),t=l("<div>",{class:"game-difference"}),e.appendChild(l("<img>",{alt:"",src:"./uploads/game/spot-difference/"+i+"/"+a.img_left})),t.appendChild(l("<img>",{alt:"",src:"./uploads/game/spot-difference/"+i+"/"+a.img_right}));for(var r=a.marker.length;r--;){var o={class:"marker","data-marker":r,style:"left: "+a.marker[r][0]+"%; width: "+a.marker[r][1]+"%; top: "+a.marker[r][2]+"%; height: "+a.marker[r][3]+"%;"};e.appendChild(l("<button>",o)),t.appendChild(l("<button>",o))}n.appendChild(e),n.appendChild(t),p("start"),window.innerWidth<window.innerHeight&&l("html")[0].hasClass("is_mobile")&&($mobile_msg=document.createElement("div"),$mobile_msg.innerHTML="Play in landscape for a better gaming experience.",$mobile_msg.setAttribute("id","portrait-msg"),l("body")[0].insertBefore($mobile_msg,l("#main")[0]),$mobile_msg.addClass("show"),setTimeout(function(){$mobile_msg.removeClass("show")},9e3)),v()}function _(e){if(!e.hasClass("marker-found")){l('[data-marker="'+e.getAttribute("data-marker")+'"]').forEach(function(e){e.addClass("marker-found").addClass("show-tick")});var t=function(e){for(var t=O.length;t--;)if(O[t].name===e)return O[t];return 0}("starburst");if(e.id="marker-"+e.dataset.marker,t.parent="#"+e.id,I(t),v(),w()===b()){var i=l("#game-spot-the-difference-container");p("success"),setTimeout(function(){for(;i.firstElementChild;)i.firstElementChild.remove();y()},1500)}else p("success")}}function v(){l("#spot-the-difference-counter").textContent=b()+"/"+w()}function w(){return l(".marker").length/2}function b(){return l(".marker-found").length/2}function y(){p("finished"),q("modal-game-over")}i.on("click",function(e){var t=e.target;t.hasAttribute("data-marker")?_(t):t.hasAttribute("data-replay-spot-the-difference")?(l(".modal").forEach(H),g()):t.hasAttribute("data-end-game")&&(y(),t.hasAttribute("data-href")&&""!=t.hasAttribute("data-href")&&window.open(t.getAttribute("data-href"),"_blank"))}),function(){var e;for(e in u)m[e]=[]}(),g();var C,k,A=[],E=[],x=l("#main"),T=new function(e,t){var i,a=1e3/e,n=null,r=-1,o=this;function s(e){var o;null===n&&(n=e),(o=Math.floor((e-n)/a))>r&&t({time:e,frame:r=o}),i=requestAnimationFrame(s)}o.is_playing=0,o.start=function(){o.is_playing||(o.is_playing=!0,i=requestAnimationFrame(s))},o.pause=function(){o.is_playing&&(cancelAnimationFrame(i),o.is_playing=!1,n=null,r=-1)}}(30,function(){for(var e=A.length;e--;)A[e].update(),A[e].render();for(e=E.length;e--;)E[e].update(),E[e].render()}),O=[{name:"starburst",image_src:"/img/sprite/starburst.png",frame_count:6,width:238,height:190,is_reserved:!0,no_repeat:!0,callback:z,className:"starburst"}],M=window.innerWidth,F=window.innerHeight;function N(){M=t.innerWidth,F=t.innerHeight}function $(e,i){var n=e.replace(/[.\/-]/g,"_"),r=l("#"+n),s={id:n,preload:"auto",src:"./audio/"+e},d=i||{};t.is_muted&&o.is_ios||d.play_one_instance&&r||(d.loop&&(s.loop="loop"),r=l("<audio>",s),t.is_muted&&!t.can_autoplay_audio?r.volume=0:d.volume&&(r.volume=d.volume),r.on("ended",function(){this.remove()}),a.appendChild(r),r.play())}function P(e){e.muted=!0}function j(e){e.muted=!1}function L(){l("audio").forEach(function(e){e.pause(),e.remove()})}function q(e,i){var n,r=l("<div>",{class:"modal was-created "+e}),o=l("<div>",{class:"modal-container"}),s=l("#"+e);s&&(o.innerHTML=s.innerHTML),r.appendChild(o),a.appendChild(r),a.offsetWidth,r.addClass("showing"),T.pause(),i&&-1!==i.indexOf("(")&&-1!==i.indexOf(")")&&(n=i.substring(i.indexOf("(")+1,i.indexOf(")")),i=i.substring(0,i.indexOf("("))),i&&t[i]&&t[i].call&&c(r,function(){t[i](n)})}function H(e){var t;e&&e instanceof HTMLElement&&(t=function(e,t){if(!e.hasClass(t))for(;(e=e.parentElement)&&!e.hasClass(t););return e}(e,"modal"))&&(t.removeClass("showing"),t.hasClass("was-created")&&c(t,function(){t.remove()})),T.start()}function I(e){var i,a=new Image,n=l("<canvas>",{class:"canvas"}),r=l(x,".sprite-container")[0];e&&(e.parent?(i=l(e.parent)).length&&(i=i[0]):i=r,i.appendChild(n),n.width=M,n.height=F,a.src=SITE_URL+e.image_src,a.onload=T.start,e.image=a,e.canvas=n,A.push(function(e){var t,i,a,n={},r=0,o=e.frame_count||1,s=0,l=0;return n.name=e.name,n.canvas=e.canvas,n.context=n.canvas.getContext("2d"),n.width=e.width,n.height=e.height,n.image=e.image,n.is_paused=0,n.scale=e.scale?e.scale:1,n.canvas.addClass(n.name+" sprite"),e.className&&n.canvas.addClass(e.className),e.fullsize?n.canvas.addClass("full-size"):(n.canvas.width=n.width*n.scale,n.canvas.height=n.height*n.scale),n.resize_handler=function(){e.fullsize?(F>M?(i=Math.max(F,1080),t=i/9*16):(t=Math.max(M,1920),i=t/16*9),s=Math.round((M-t)/2),l=Math.round((F-i)/2),t=Math.round(t),i=Math.round(i),n.canvas.width=M,n.canvas.height=F+(Boolean("ontouchstart"in window||navigator.maxTouchPoints)?120:0)):(t=Math.round(n.width*n.scale),i=Math.round(n.height*n.scale))},n.resize_handler(),n.update=function(){n.is_paused||(r<o-1?r+=1:(e.callback&&e.callback.call&&e.callback(n),e.no_repeat?(n.is_paused=1,e.delay&&setTimeout(function(){n.is_paused=0,r=0},e.delay)):r=0))},n.render=function(){n.context.clearRect(s,l,t,i),n.context.drawImage(n.image,r*n.width,0,n.width,n.height,s,l,t,i)},n.delete=function(){n.context.clearRect(s,l,t,i),n.canvas.remove()},a=new Image,e.first_frame_src&&(a.src=SITE_URL+e.first_frame_src,a.onload=function(){n.context.drawImage(a,0,0,n.width,n.height,s,l,t,i)}),n}(e)),e.name&&(t.used_sprites[e.name]=e.contains?e.contains:[]))}function z(e){e.delete()}t.used_sprites=[],t.on("resize",function(){clearTimeout(C),C=setTimeout(N,100)}),i.on("click",function(e){var i=e.target;i.hasAttribute("data-scene-open")&&!i.hasAttribute("disabled")?(L(),go_to_scene(i.getAttribute("data-scene-open"),"wipe"),menu_hide()):i.hasAttribute("data-play-video")?(L(),video_player_click(i)):i.hasAttribute("data-menu-toggle")?menu_toggle():i.hasAttribute("data-mute-toggle")?(t.is_muted=!t.is_muted,t.is_muted?(o.is_ios?l("audio, video").forEach(function(e){e.pause(),e.loop||e.remove()}):l("audio, video").forEach(P),a.addClass("is-muted")):(o.is_ios?l("audio, video").forEach(function(e){e.loop&&e.play()}):l("audio, video").forEach(j),a.removeClass("is-muted"))):i.hasClass("menu-page")?menu_scroll(i):i.hasAttribute("data-facey-trigger")&&video_player_click(i)}).on("scroll",function(){clearTimeout(k),k=setTimeout(function(){a.scrollTop?a.addClass("has-scrolled"):a.removeClass("has-scrolled")},100)}),t.is_muted=!1,i.on("click",function(e){var t=e.target;t.hasAttribute("data-modal-create")?q(t.getAttribute("data-modal-create"),t.hasAttribute("data-modal-callback")?t.getAttribute("data-modal-callback"):0):t.hasAttribute("data-modal-close")&&H(t)})}();