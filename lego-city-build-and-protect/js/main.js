!function(h){function webpackJsonpCallback(t){for(var e,i,n=t[0],r=t[1],a=t[2],s=0,o=[];s<n.length;s++)i=n[s],Object.prototype.hasOwnProperty.call(l,i)&&l[i]&&o.push(l[i][0]),l[i]=0;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(h[e]=r[e]);for(c&&c(t);o.length;)o.shift()();return d.push.apply(d,a||[]),checkDeferredModules()}function checkDeferredModules(){for(var t,e=0;e<d.length;e++){for(var i=d[e],n=!0,r=1;r<i.length;r++){var a=i[r];0!==l[a]&&(n=!1)}n&&(d.splice(e--,1),t=__webpack_require__(__webpack_require__.s=i[0]))}return t}var i={},l={1:0},d=[];function __webpack_require__(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return h[t].call(e.exports,e,e.exports,__webpack_require__),e.l=!0,e.exports}__webpack_require__.m=h,__webpack_require__.c=i,__webpack_require__.d=function(t,e,i){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(i,n,function(t){return e[t]}.bind(null,n));return i},__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="";var t=this.webpackJsonp=this.webpackJsonp||[],e=t.push.bind(t);t.push=webpackJsonpCallback,t=t.slice();for(var n=0;n<t.length;n++)webpackJsonpCallback(t[n]);var c=e;d.push([284,2]),checkDeferredModules()}({10:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=(n=i(73))&&n.__esModule?n:{default:n};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(n){function Label(t){var e;void 0===t&&(t={}),e=n.call(this)||this;var i=Object.assign({text:"",align:"center",fill:16777215,fontSize:32,fontFamily:r.default.getMainStyle().fontFamily,lineJoin:"round",dropShadow:!1,dropShadowDistance:3,anchor:.5,anchorX:null,anchorY:null,x:null,y:null,wordWrap:!1,wordWrapWidth:1e3,extraContainer:null},t);return e._text=new a.Text(i.text,i),e._text.anchor.set(i.anchor),e.addChild(e._text),null!==i.anchorX&&(e._text.anchor.x=i.anchorX),null!==i.anchorY&&(e._text.anchor.y=i.anchorY),i.x&&(e.x=i.x),i.y&&(e.y=i.y),e.originalX=e.x,e.originalY=e.y,e.updateText(i.text),t.extraContainer&&(e.extraContainer=t.extraContainer,e.addChild(t.extraContainer)),t.icon&&(e.icon=a.Sprite.from(t.icon),e.icon.anchor.set(.5),e.addChild(e.icon),e.icon.x=0,e.update()),e._text.scale.set(1.1),e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Label,n);var t=Label.prototype;return t.updateText=function(t){for(var e=t.split(";"),i=new a.Point,n=1,r=e.length-1;0<=r;r--)0===e[r].indexOf("offsetX")?(i.x=parseInt(e[r].substr(8)),e.splice(r,1)):0===e[r].indexOf("offsetY")?(i.y=parseInt(e[r].substr(8)),e.splice(r,1)):0===e[r].indexOf("fontScale")&&(n=parseFloat(e[r].substr(10)),e.splice(r,1));this.x=this.originalX+i.x,this.y=this.originalY+i.y,this._text.scale.set(n),this._text.text=e.join(" ")},t.update=function(){if(this.icon){this._text.x=0,this.icon.x=this._text.x-.5*this._text.width-.5*this.icon.width-5;var t=.5*(this.width-this._text.width);this.icon.x+=t,this._text.x+=t}},t.prompt=function(){if(!this._prompting){this._prompting=!0;var t=window.prompt(this.description,this.text);t&&(this.text=t),this._prompting=!1,this.emit("change",this.text)}},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(Label,[{key:"tint",get:function(){return this._text.style.fill},set:function(t){this._text.style.fill=t}},{key:"text",get:function(){return this._text.text},set:function(t){this._text.text!==t&&(this.updateText(t),this.update())}},{key:"editable",get:function(){return!!this._editable},set:function(t){this._editable=t,this.interactive=t,this.buttonMode=t,void 0===this.description&&(this.description="Set text"),this[this._editable?"on":"off"]("pointertap",this.prompt,this)}},{key:"color",set:function(t){this._text.style.fill=t},get:function(){return this._text.style.fill}}]),Label}(a.Container);e.default=s},117:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var n=function(n){function Blocker(t,e){var i;return void 0===t&&(t=102),void 0===e&&(e=.65),(i=n.call(this)||this).bg=new r.Graphics,i.bg.beginFill(t,e),i.bg.drawRect(-8,-8,16,16),i.addChild(i.bg),i.bg.interactive=!0,i}return function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Blocker,n),Blocker.prototype.resize=function(t,e){this.bg.width=t,this.bg.height=e},Blocker}(r.Container);e.default=n},118:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=new(function(){function TimeManager(){this.date=new Date}return TimeManager.prototype.fancyTimeFormat=function(t){var e=~~(t/3600),i=~~(t%3600/60),n=~~t%60,r="";return 0<e&&(r+=String(e)+":"+(i<10?"0":"")),r+=String(i)+":"+(n<10?"0":""),r+=String(n)},TimeManager}());e.default=n},119:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(266)),s=_interopRequireDefault(i(43)),r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),o=_interopRequireDefault(i(272));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(a){function Entity(t){var e;return(e=a.call(this)||this).view=t||new r.Container,e.x=0,e.y=0,e.sx=1,e.sy=1,e._comps={},e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Entity,a);var t=Entity.prototype;return t.add=function(t,e,i){for(var n in a.prototype.add.call(this,t,e,i),this){var r=this[n];r instanceof s.default&&(this._comps[n]=r)}return this},t.message=function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var r in this[t]&&this[t].apply(this,i),this._comps){var a=this._comps[r];a[t]&&a[t].apply(a,i)}},t.moveTo=function(t){void 0===t&&(t={}),void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y)},t.distance=function(t){return o.default.distance(this.x,this.y,t.x,t.y)},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(Entity,[{key:"x",get:function(){return this.view.position.x},set:function(t){this.view.position.x=t}},{key:"y",get:function(){return this.view.position.y},set:function(t){this.view.position.y=t}},{key:"sx",get:function(){return this.view.scale.x},set:function(t){this.view.scale.x=t}},{key:"sy",get:function(){return this.view.scale.y},set:function(t){this.view.scale.y=t}}]),Entity}(n.default);e.default=a},13:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=new(function(){function Strings(){}var t=Strings.prototype;return t.setup=function(t){this.app=t,this.lang="en",this.data=null,this.app.resources.onLoadComplete.add(this.onLoadComplete,this)},t.onLoadComplete=function(t){"title"===t&&this.load(this.app.config.lang)},t.get=function(t,e){void 0===e&&(e="fontScale");var i=this.data[t];return i?i.text+";offsetX="+i.offsetX+";offsetY="+i.offsetY+";fontScale="+i[e]+";":""},t.upper=function(t){return this.get(t).toUpperCase()},t.load=function(t){t&&(this.lang=t),this.data=this.loadStrings(this.lang)},t.loadStrings=function(t){var e=this.app.resourceManager.resources,i={},n=e["data/loc_"+this.app.config.lang];n=n||((n=e["data/loc_"+this.app.config.lang.split("-")[0]])||e["data/loc_en"]);for(var r=n.data.getElementsByTagName("string"),a=0;a<r.length;a++){var s=r[a];i[s.getAttribute("id")]={fontName:s.getAttribute("fontName"),offsetX:s.getAttribute("offsetX"),offsetY:s.getAttribute("offsetY"),text:s.childNodes[0].nodeValue},s.getAttribute("fontScale")&&(i[s.getAttribute("id")].fontScale=s.getAttribute("fontScale")),s.getAttribute("fontScaleInventory")&&(i[s.getAttribute("id")].fontScaleInventory=s.getAttribute("fontScaleInventory")),s.getAttribute("fontScaleMiniGame")&&(i[s.getAttribute("id")].fontScaleMiniGame=s.getAttribute("fontScaleMiniGame")),s.getAttribute("fontScaleDropdown")&&(i[s.getAttribute("id")].fontScaleDropdown=s.getAttribute("fontScaleDropdown")),s.getAttribute("fontScaleDigSites")&&(i[s.getAttribute("id")].fontScaleDigSites=s.getAttribute("fontScaleDigSites")),s.getAttribute("fontScaleBlueprints")&&(i[s.getAttribute("id")].fontScaleBlueprints=s.getAttribute("fontScaleBlueprints")),s.getAttribute("fontScaleRibbonCutting")&&(i[s.getAttribute("id")].fontScaleRibbonCutting=s.getAttribute("fontScaleRibbonCutting"))}return i},Strings}());e.default=n},168:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(17)),d=_interopRequireDefault(i(41)),c=_interopRequireDefault(i(61)),u=_interopRequireDefault(i(13)),r=_interopRequireDefault(i(270)),a=_interopRequireDefault(i(77)),s=_interopRequireDefault(i(713)),p=_interopRequireDefault(i(44));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var f=-1,g=0,m=1,v=2,b=3,y=4,w=5,_=6,C=7,x=8,k=9,S=10,P=11,D=12,T=13,o=0,h=function(n){function OnboardSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.app=t.game.app,i.onboardingData=d.default.getCookie("onboarding"),i.onboardingData||(i.onboardingData={step:-1,collectAll:!1,backup:-1},d.default.createCookie("onboarding",i.onboardingData)),i.sin=0,i.onboardingData.collectCoin||i.game.grid.onCoinPopped.addOnce(function(t){i.onboardCollectCoin(t)}),i.skipFrame=0,i.welcomePanel=new r.default,i.welcomePanel.closeWelcome.add(function(){i.game.state.setState("onboarding"),i.next()}),i.maxStep=13,i.handy=new s.default(i.game),i.tryAgainTimer=i.defaultTryAgainTimer=.5,i.tryAgain=!1,i.tryAgainFunction=null,i.tryAgainParameters=null,i.isOnboarding=!1,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(OnboardSystem,n);var t=OnboardSystem.prototype;return t.build=function(){var t=this;this.built||(this.built=!0,this.handy.build(),this.handy.hide(),this.game.view.notification.addChild(this.handy),this.onboardingData.step<this.maxStep&&(this.onboardingData.step=this.onboardingData.backup,this.handy.show(),this.game.drag.lock(),d.default.storeObject("onboarding",this.onboardingData)),this.updateStep(),a.default.signals.show.add(function(){a.default.signals.end.once(function(){t.game.dig.inTutorial&&(t.next(),a.default.btnClose.visible=!0,a.default.signals.end.detachAll(),a.default.signals.show.detachAll())})}))},t.onboardCollectCoin=function(t){if(!this.onboardingData.collectCoin){if("GAME"!==this.game.state.currentState.toUpperCase()||this.game.drag.hasDragged)return this.tryAgain=!0,this.tryAgainFunction=this.onboardCollectCoin,void(this.tryAgainParameters=t);this.tryAgain=!1,this.game.grid.centerCameraByBuilding(t),this.game.camera.zoomIn(),this.game.hud.hide(),this.game.drag.lock(),this.game.grid.lockAllTiles(0),this.game.camera.lock(),this.handy.moveToPosition(30,-75,"right"),this.handy.show(),t.unlock(),c.default.show(u.default.get("character_mayor"),u.default.get("onboard_collect_coin"),null,!0),this.game.state.setState("onboarding")}},t.completeCollectCoin=function(){c.default.quickHide(),c.default.show(u.default.get("character_mayor"),u.default.get("onboard_finish_coin")),this.handy.hide(),this.game.hud.show(),this.game.grid.unlockAllTiles(0),this.game.camera.unlock(),this.game.drag.unlock(),this.onboardingData.collectCoin=!0,d.default.storeObject("onboarding",this.onboardingData),this.game.state.setState("game")},t.onboardCollectAll=function(){var t=this,e=this.game.hud.highlightCollect();!this.onboardingData.collectAll&&e&&(this.handy.moveToEntity(e,"right",{x:.5*e.width,y:0}),this.handy.show(),c.default.show(u.default.get("character_mayor"),[u.default.get("onboard_collect_all")]),setTimeout(function(){t.handy.hide()},6e3),this.onboardingData.collectAll=!0,d.default.storeObject("onboarding",this.onboardingData))},t.updateStep=function(){var n=this;if(this.isOnboarding=!0,this.onboardingData.step==f&&(this.game.hud.hide(),this.game.view.notification.addChild(this.welcomePanel),this.game.state.setState("menu"),this.game.camera.lock(),this.game.drag.lock()),this.onboardingData.step==g){this.game.hud.hide();var t=this.game.grid.highlightOnboarding();this.handy.moveToEntity(t.view,"right"),c.default.show(u.default.get("character_police_segeant"),u.default.get("onboard_place_police"),"policeSegeant",!0),this.handy.show(),this.updateBackup(g)}else if(this.onboardingData.step==m){this.game.hud.hide();var e=this.game.buildings.highlightFirst(0,function(){n.handy.moveToEntity(e,"right",{x:e.width,y:.5*e.height}),e.interactive=!0,setTimeout(function(){e.pointertap=function(){e.pointertap=null,c.default.quickHide(),n.next()}},400)});c.default.updateMessage(u.default.get("character_police_segeant"),u.default.get("onboard_select_police"))}else if(this.onboardingData.step==v||this.onboardingData.step==w||this.onboardingData.step==D){this.game.hud.hide();var i=this.game.buildings.highlightCard(function(){n.handy.moveToEntity(i,"right",{x:.5*i.width,y:-8}),i.interactive=!0,setTimeout(function(){i.pointertap=function(){i.pointertap=null,n.next()}},400)})}else if(this.onboardingData.step==b){this.updateBackup(b),this.game.hud.hide();var r=this.game.grid.highlightOnboarding(!1);this.game.grid.centerCameraByBuilding(r),this.handy.moveToPosition(0,0,"right"),this.game.camera.lock(),this.game.drag.lock(),c.default.show(u.default.get("character_fire_chief"),u.default.get("onboard_place_fire"),"fireChief",!0),this.handy.show()}else if(this.onboardingData.step==y){this.game.hud.hide();var a=this.game.buildings.highlightFirst(1,function(){n.handy.moveToEntity(a,"right",{x:a.width,y:.5*a.height}),a.interactive=!0,setTimeout(function(){a.pointertap=function(){a.pointertap=null,c.default.quickHide(),n.next()}},400)});c.default.updateMessage(u.default.get("character_fire_chief"),u.default.get("onboard_select_fire"))}else if(this.onboardingData.step==_){this.updateBackup(_),this.game.hud.hide(),this.game.grid.lockAllTiles(0),this.game.inventory.inventory.forceCoins(p.default.get("initialRevenue"));var s=this.game.hud.highlightDig();this.handy.moveToEntity(s,"left",{x:-.5*s.width,y:0}),s.pointertap=function(){s.pointertap=null,n.next()},c.default.show(u.default.get("character_mayor"),u.default.get("onboard_select_dig"),null,!0)}else if(this.onboardingData.step==C)var o=this.game.dig.digSitePanel.tutorialStart(function(){c.default.updateMessage(u.default.get("character_mayor"),u.default.get("onboard_select_dig_district")),n.handy.moveToEntity(o,"right",{x:.5*o.width,y:-6}),o.onTap=function(){n.next(),n.game.dig.digSitePanel.tutorialEnd(o)}});else if(this.onboardingData.step==x)this.game.dig.startTutorial(),this.digPieceIndex=0,c.default.updateMessage(u.default.get("character_mayor"),u.default.get("onboard_select_bricks")),this.game.dig.signals.tutortialReady.add(function(e){e=n.sortArray(e),n.digPieceIndexMax=e.length;var t=e[n.digPieceIndex].view;n.handy.moveToEntity(t,"right"),t.interactive=!0,t.buttonMode=!0;for(var i=0;i<e.length;i++){e[i].onPieceSelected.once(function(){if(0===n.digPieceIndex&&c.default.quickHide(),n.digPieceIndex++,n.digPieceIndex>=n.digPieceIndexMax)n.handy.hide(),n.game.dig.onEndMinigame(),n.next(),n.updateBackup(S);else{var t=e[n.digPieceIndex].view;t.interactive=!0,t.buttonMode=!0,n.handy.moveToEntity(t,"right",{x:.25*t.width,y:0})}})}});else if(this.onboardingData.step==k);else if(this.onboardingData.step==S){this.game.hud.hide();var h=this.game.grid.highlightOnboarding(!1,-1);this.game.grid.centerCameraByBuilding(h),this.handy.moveToPosition(0,0,"right"),c.default.show(u.default.get("character_mayor"),u.default.get("onboard_lets_build"),"mayor"),setTimeout(function(){n.handy.show()},800)}else if(this.onboardingData.step==P){this.game.hud.hide();var l=this.game.buildings.highlightFirst(2,function(){n.handy.moveToEntity(l,"right",{x:.7*l.width,y:.35*l.height}),l.interactive=!0,setTimeout(function(){l.pointertap=function(){c.default.quickHide(),n.next(),setTimeout(function(){c.default.show(u.default.get("character_mayor"),[u.default.get("onboard_free_build"),u.default.get("onboard_save")])},300)}},400)})}this.onboardingData.step==T&&(this.updateBackup(T),this.handy.hide(),this.game.hud.removeHightlightDig(),this.game.hud.show(),this.game.grid.unlockAllTiles(0),this.game.buildings.removeHightlight(),this.game.camera.unlock(),this.game.drag.unlock(),this.game.buildings.removeCardHighlight(),this.game.state.setState("game"),this.isOnboarding=!1),d.default.storeObject("onboarding",this.onboardingData)},t.updateBackup=function(t){o=t,this.onboardingData.backup=o,d.default.getCookie("onboarding",this.onboardingData),this.game.state.setState("onboarding")},t.sortArray=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push([n,n.piece.uid])}e.sort(function(t,e){return t[1]-e[1]});for(var r=[],a=0;a<e.length;a++){var s=e[a];r.push(s[0])}return r},t.update=function(){this.handy.update(),this.tryAgain&&(0<this.tryAgainTimer?this.tryAgainTimer-=1/60:(this.tryAgainTimer=this.defaultTryAgainTimer,this.tryAgainFunction(this.tryAgainParameters)))},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.next=function(){this.onboardingData.step++,this.updateStep()},OnboardSystem}(n.default);e.default=h},169:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(10)),a=(_interopRequireDefault(i(13)),_interopRequireDefault(i(44)));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(e){function MenuTopPanel(){var t;return(t=e.call(this)||this).container=new n.Container,t.addChild(t.container),t.titleContainer=new n.Container,t.container.addChild(t.titleContainer),t.title=new r.default({fill:16777215,padding:10,fontSize:25}),t.titleContainer.addChild(t.title),t.coinsContainer=new n.Container,t.container.addChild(t.coinsContainer),t.coins=new r.default({text:"1000",fill:16777215,fontSize:25,anchorX:1}),t.coins.y=t.coins.originalY=.5*t.coins.height,t.coins.visible=!1,t.coinsContainer.addChild(t.coins),t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(MenuTopPanel,e);var t=MenuTopPanel.prototype;return t.updateCoins=function(t){this.coins.text=a.default.numberWithCommas(t.toString()),this.coins.scale.set(1),85<this.coins.width&&(this.coins.width=85,this.coins.scale.y=this.coins.scale.x)},t.hideCoins=function(){this.coins.visible=!1},t.showCoins=function(){this.coins.visible=!0},t.resize=function(t,e,i){void 0===i&&(i=!1);var n=4;i&&(n=-8),this.titleContainer.x=t/2+n,this.titleContainer.y=42,this.coinsContainer.x=145,this.coinsContainer.y=28},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(MenuTopPanel,[{key:"text",set:function(t){this.title.text=t}}]),MenuTopPanel}(n.Container);e.default=s},268:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;function Sd(){this.startX=0,this.startY=0,this.gravity=-.5,this.endX=600,this.endY=20,this.lockedStart=!0,this.lockedEnd=!1;var o=45,h=[],l=[],d=[],c=[];this.links=[],this.build=function(t){.1;var e,i=-(o=t/20);for(e=0;e<=20;e++)h[e]=this.startX+0*e+e,l[e]=this.startY+i*e,d[e]=this.startX+0*e,c[e]=this.startY+i*e,this.links[e]=new n.Point(20*e,20*e)},this.update=function(t){this.lockedStart&&(h[0]=this.startX,l[0]=this.startY),this.lockedEnd&&(h[20]=this.endX,l[20]=this.endY),this.verlet(),this.satisfyConstraints(),this.satisfyJoints()},this.forceToPoint=function(t,e){for(var i=0;i<h.length;i++)h[i]=t;for(var n=0;n<l.length;n++)l[n]=e},this.satisfyJoints=function(){for(var t=0;t<=20;t++)this.links[t].x=h[t],this.links[t].y=l[t]},this.setEndPoint=function(t,e){return{x:this.endX=t,y:this.endY=e}},this.setStartPoint=function(t,e){return{x:this.startX=t,y:this.startY=e}},this.detect=function(t){for(var e=2;e<19;e++){this.links[e];var i=t.x-h[e],n=t.y-l[e],r=Math.sqrt(i*i+n*n);if(r<50){var a=-i/r,s=-n/r;h[e]=d[e]=t.x+50*a,l[e]=c[e]=t.y+50*s}}},this.getAngle=function(t,e,i,n){var r=t-i,a=e-n;return Math.atan2(a,r)},this.verlet=function(){for(var t=0;t<=20;t++){var e=h[t],i=l[t];h[t]+=1*(.96*h[t]-.96*d[t]),l[t]+=1*(.96*l[t]-.96*c[t])+this.gravity,d[t]=e,c[t]=i}},this.satisfyConstraints=function(){for(var t=1;t<=20;t++){var e=h[t]-h[t-1],i=l[t]-l[t-1],n=Math.sqrt(e*e+i*i),r=n-o,a=r*e/n/2,s=r*i/n/2;h[t]-=a,l[t]-=s,h[t-1]+=a,l[t-1]+=s}},this.lockEndPoint=function(){this.lockedEnd=!0},this.unlockEndPoint=function(){this.lockedEnd=!1},this.lockStartPoint=function(){this.lockedStart=!0},this.unlockStartPoint=function(){this.lockedStart=!1},this.reset=function(t){.1;var e,i=t?20:-20,n=-(o=12.5);for(e=0;e<=20;e++)h[e]=this.startX+i*e+e,l[e]=this.startY+n*e,d[e]=this.startX+i*e,c[e]=this.startY+n*e},this.destroy=function(){links=c=d=l=h=null},this.getAllLinkPositions=function(){return this.links},this.setLength=function(t,e){t*=.8;var i=this.endX-this.startX,n=this.endY-this.startY;if(i/=20,n/=20,o=t/20,e)for(var r=0;r<20;r++)h[r]=d[r]=this.startX+i*r,l[r]=c[r]=this.startY+n*r}}var n=i(1);e.default=Sd},269:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n;(function(t){{if(t&&t.__esModule)return;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}e.default=t}})(i(1)),(n=i(43))&&n.__esModule;e.default=function(){this.image,this.id,this.name,this.cost,this.requirementPieces=[],this.requirementBuildings=[],this.group,this.level,this.timeToBuild,this.revenue,this.timeToRevenue,this.enabled,this.crimeRisk=0,this.fireRisk=0}},270:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(8)),a=_interopRequireDefault(i(13)),s=_interopRequireDefault(i(10)),o=_interopRequireDefault(i(29));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(i){function WelcomePanel(t){var e;return(e=i.call(this)||this).container=new n.Container,e.addChild(e.container),e.blackShape=(new n.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),e.container.addChild(e.blackShape),e.blackShape.alpha=.25,e.backPanel=n.Sprite.from("welcome_panel.png"),e.backPanel.anchor.set(.5),e.container.addChild(e.backPanel),e.welcome=new s.default({fontSize:48,x:65,y:-e.backPanel.height/2+57}),e.welcome.text=a.default.get("welcome"),e.backPanel.addChild(e.welcome),e.interactive=!0,e.btnLetsGo=new o.default({base:"button_welcome.png"}),e.btnLetsGo.setLabel({y:-2,fontSize:45}),e.btnLetsGo.label.text=a.default.get("welcome_button"),e.backPanel.addChild(e.btnLetsGo),e.btnLetsGo.onTap=function(){e.visible=!1,e.closeWelcome.dispatch()},e.btnLetsGo.preventHide=!0,e.btnLetsGo.x=195,e.btnLetsGo.y=250,e.description=new s.default({fontSize:40,x:e.btnLetsGo.x,y:-20,wordWrap:!0,wordWrapWidth:.55*e.backPanel.width}),e.description.text=a.default.get("welcome_description"),e.backPanel.addChild(e.description),e.backPanel.scale.set(.65),e.backPanel.originScale={x:e.backPanel.scale.x,y:e.backPanel.scale.y},e.closeWelcome=new r.default,e}return function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(WelcomePanel,i),function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(WelcomePanel,[{key:"buttonLabel",set:function(t){this.btnLetsGo.label.text=t.toString()}},{key:"message",set:function(t){this.description.text=t}},{key:"title",set:function(t){this.welcome.text=t}}]),WelcomePanel}(n.Container);e.default=h},271:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var c=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=(_interopRequireDefault(i(43)),_interopRequireDefault(i(4)),i(7),_interopRequireDefault(i(8))),r=_interopRequireDefault(i(119)),a=_interopRequireDefault(i(73));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(i){function BuildingCard(t){var e;return(e=i.call(this)||this).game=t,e.background=(new c.Graphics).beginFill(16737637).drawRect(0,0,280,120),e.view.addChild(e.background),e.view.interactive=!0,e.view.buttonMode=!0,e.view.mouseover=function(){},e.view.mouseout=function(){},e.view.pointerup=function(){e.locked||e.onCardSelected.dispatch(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e))},e.onCardSelected=new n.default,e.text=new c.Text,e.text.style=a.default.getMainStyle(),e.text.anchor.x=1,e.view.addChild(e.text),e.text.text="Requirements:\nSOMETHING",e.text.x=e.background.width-10,e.text.y=10,e.locked=!1,e.buildingLock=!0,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BuildingCard,i);var t=BuildingCard.prototype;return t.update=function(){this.view.alpha=1,this.locked=!1;for(var t=0;t<this.buildingData.requirementPieces.length;t++){var e=this.buildingData.requirementPieces[t];this.game.inventory.inventory.getPieceById(e.id).value<e.value&&(this.view.alpha=.5,this.locked=!0)}if(this.buildingLock){for(var i=!1,n=0;n<this.buildingData.requirementBuildings.length;n++){var r=this.buildingData.requirementBuildings[n];this.game.inventory.inventory.isPlaced(r.id)||(this.view.alpha=.5,i=!0)}this.buildingLock=i,this.buildingLock&&(this.locked=!0)}},t.build=function(t){this.buildingData=t,this.sprite=c.Sprite.from(this.buildingData.image),this.sprite.scale.set((this.background.height-20)/this.sprite.height);for(var e=this.game.inventory.inventory,i=(this.game.buildings.buildingList,0);i<this.buildingData.requirementPieces.length;i++){var n=this.buildingData.requirementPieces[i],r=e.getPieceById(n.id),a=new c.Sprite.from(r.image),s=new c.Text("X "+n.value);s.style.fill=16777215,s.style.fontSize=12,this.view.addChild(s),s.anchor.set(.5),a.anchor.set(.5),a.scale.set(30/a.height),a.x=this.background.width-90-.5*a.width,a.y=40*i+20+.5*a.height,s.x=a.x+a.width/2+20,s.y=a.y,this.view.addChild(a)}for(var o=0;o<this.buildingData.requirementBuildings.length;o++){var h=this.buildingData.requirementBuildings[o],l=e.getBuildingById(h.id),d=new c.Sprite.from(l.image);d.anchor.set(.5),d.scale.set(30/d.height),d.x=this.background.width-10-.5*d.width,d.y=40*o+20+.5*d.height,this.view.addChild(d)}this.sprite.anchor.y=.5,this.sprite.x=10,this.sprite.y=this.background.height/2,this.view.addChild(this.sprite)},BuildingCard}(r.default);e.default=s},272:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function Math2(){}return Math2.lerp=function(t,e,i,n,r){return void 0===n&&(n=0),void 0===r&&(r=0),n&&e-n<=t&&t<=e+n?e:t*(1-i)+e*i},Math2.clamp=function(t,e,i){return t<e?e:i<t?i:t},Math2.sign=function(t,e){return void 0===e&&(e=!1),e?t<0?-1:0<t?1:0:t<0?-1:1},Math2.ease=function(t,e,i,n){var r=-(t-e)*i;return n?this.clamp(r,-n,n):r},Math2.distance=function(t,e,i,n){var r=i-t,a=n-e;return Math.sqrt(r*r+a*a)},Math2}();(e.default=n).PI_HALF=.5*Math.PI,n.PI_QUARTER=.25*Math.PI,n.PI_DOUBLE=2*Math.PI},273:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var o=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),h=(_interopRequireDefault(i(8)),_interopRequireDefault(i(23))),l=_interopRequireDefault(i(18));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var n=function(s){function Scroller(t,e,i,n){var r;void 0===t&&(t={w:500,h:500}),void 0===e&&(e=1),void 0===i&&(i=!0),void 0===n&&(n=10),(r=s.call(this)||this).containerBackground=(new o.Graphics).beginFill(16711680).drawRect(0,0,t.w,t.h),r.containerBackground.alpha=0,r.marginTop=0,r.space=n,r.itens=[],r.itensPool=[],r.container=new o.Container,r.listContainer=new o.Container,r.rect=t,r.itemsPerPage=e,r.itemHeight=r.rect.h/r.itemsPerPage,r.snap=!0,r.cap=!1,r.ease=Back.easeOut,r.container.addChild(r.containerBackground),r.container.addChild(r.listContainer),r.addChild(r.container),i&&(r.maskGraphic=(new o.Graphics).beginFill(0).drawRect(0,0,t.w,t.h),r.addChild(r.maskGraphic),r.container.mask=r.maskGraphic),r.container.interactive=!0,r.updateCallback=new l.default,r.percent=0,h.default.instance.desktop?(r.container.on("mousemove",r.moveDrag.bind(_assertThisInitialized(r))),r.container.on("mouseout",r.moveOut.bind(_assertThisInitialized(r))),r.container.on("mousedown",r.startDrag.bind(_assertThisInitialized(r))),r.container.on("mouseup",r.endDrag.bind(_assertThisInitialized(r))).on("mouseupoutside",r.endDrag.bind(_assertThisInitialized(r))),r.container.on("mouseover",r.moveOver.bind(_assertThisInitialized(r))),r.isDesktop=!0):(r.container.on("touchmove",r.moveDrag.bind(_assertThisInitialized(r))),r.container.on("touchstart",r.startDrag.bind(_assertThisInitialized(r))),r.container.on("touchend",r.endDrag.bind(_assertThisInitialized(r))).on("touchendoutside",r.endDrag.bind(_assertThisInitialized(r))),r.isDesktop=!1),r.wheelDirection=-1;var a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";return document.attachEvent?document.attachEvent("on"+a,r.onWheelManager.bind(_assertThisInitialized(r))):document.addEventListener&&document.addEventListener(a,r.onWheelManager.bind(_assertThisInitialized(r)),!1),r}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Scroller,s);var t=Scroller.prototype;return t.disableDrag=function(){this.isDraggable=!1},t.disable=function(){this.container.interactive=!1},t.enable=function(){this.container.interactive=!0},t.moveOver=function(t){this.mouseOver=!0},t.moveOut=function(t){this.mouseOver=!1},t.onWheelManager=function(t){if(this.mouseOver){var e=window.event||t,i=-(e.detail?e.detail:e.wheelDelta)/40/8*this.wheelDirection;0<i?(this.containerBackground.interactive=!0,this.sideMoving=-1):i<0&&(this.containerBackground.interactive=!0,this.sideMoving=1),this.ableToMove()&&(TweenLite.killTweensOf(this.listContainer),this.listContainer.y+=50*i),this.hideUnseen(),this.testBounds();var n=(this.itemHeight+this.space)*this.itens.length;this.percent=this.listContainer.y/(this.containerBackground.height-n),this.updateCallback.dispatch()}},t.resetPosition=function(){this.listContainer.y=0,this.enableDrag=!1,this.hideUnseen()},t.updatePosition=function(t){var e,i=this.itemHeight+this.space,n=i*this.itens.length;e=0<t&&t<this.itens.length-1?-t*i+this.itemHeight/2-25:0===t?0:this.containerBackground.height-n,this.listContainer.y=e,this.percent=this.listContainer.y/(this.containerBackground.height-n),this.updateCallback.dispatch(),this.enableDrag=!1,this.hideUnseen()},t.addItem=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),this.listContainer.addChild(t),t.y=(this.itemHeight+this.space)*this.itens.length-1+this.marginTop,e&&t.scale.set(this.itemHeight/t.height*e),i&&(t.x=this.rect.w/2-t.width/2,t.y+=t.height/2),this.itens.push(t)},t.addItens=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1);for(var n=0;n<t.length;n++){var r=t[n];this.addItem(r,0,i)}this.lastItemClicked=this.itens[0]},t.endDrag=function(t){void 0===t&&(t=!1),(this.enableDrag||t)&&(this.dragging=!1,this.containerBackground.interactive=!1,this.testBounds())},t.ableToMove=function(){var t=(this.itemHeight+this.space)*this.itens.length,e=this.sideMoving<0&&0<=this.listContainer.y,i=0<this.sideMoving&&t+this.listContainer.y<this.containerBackground.height;return!e&&!i},t.testBounds=function(){var t=this,e=this.listContainer.y,i=this.listContainer.y,n=this.itemHeight+this.space,r=n*this.itens.length;this.snap&&(1==this.sideMoving?(i-=n/2,e=Math.floor(i/n)*n):-1==this.sideMoving&&(i+=n/2,e=Math.ceil(i/n)*n)),0<=e?(this.detectOnScreenObjects(0),TweenLite.killTweensOf(this.listContainer),TweenLite.to(this.listContainer,.75,{y:0,ease:this.ease,onComplete:function(){t.detectOnScreenObjects()}})):e+r<this.containerBackground.height?(this.detectOnScreenObjects(this.containerBackground.height-r),TweenLite.killTweensOf(this.listContainer),TweenLite.to(this.listContainer,.75,{y:this.containerBackground.height-r,ease:this.ease,onComplete:function(){t.detectOnScreenObjects()}})):0!=e&&(this.detectOnScreenObjects(e),TweenLite.killTweensOf(this.listContainer),TweenLite.to(this.listContainer,.75,{y:e,ease:this.ease,onComplete:function(){t.detectOnScreenObjects()}}))},t.moveDrag=function(t){if(this.enableDrag){if(this.dragging){this.container.alpha=1,this.dragVelocity={x:t.data.global.x-this.currentMousePos.x,y:this.currentMousePos.y-t.data.global.y},this.currentMousePos={x:t.data.global.x,y:t.data.global.y},this.currentLocalMousePos.x>.93*this.rect.w&&(this.isDesktop?(this.dragVelocity.y*=-1.85,this.listContainer.y-=this.dragVelocity.y):this.dragVelocity.y*=-2.2),this.isDesktop||(this.listContainer.y-=this.dragVelocity.y);var e=(this.itemHeight+this.space)*this.itens.length;this.cap&&(0<this.listContainer.y?this.listContainer.y=0:this.listContainer.y<this.containerBackground.height-e&&(this.listContainer.y=this.containerBackground.height-e)),this.percent=this.listContainer.y/(this.containerBackground.height-e),this.updateCallback.dispatch(),0<this.dragVelocity.y?(this.containerBackground.interactive=!0,this.sideMoving=1):this.dragVelocity.y<0&&(this.containerBackground.interactive=!0,this.sideMoving=-1),this.detectOnScreenObjects(),this.hideUnseen()}}else this.sideMoving=0},t.hideUnseen=function(){if(this.maskGraphic)for(var t=0;t<this.listContainer.children.length;t++){var e=this.listContainer.children[t],i=e.y+e.height+e.parent.y<this.maskGraphic.y,n=e.y+e.parent.y>this.maskGraphic.y+this.maskGraphic.height;e.visible=!i&&!n}},t.getDist=function(){return this.startPoint&&this.currentMousePos?this.distance(this.startPoint.x,this.startPoint.y,this.currentMousePos.x,this.currentMousePos.y):0},t.distance=function(t,e,i,n){var r=t-i,a=e-n;return Math.sqrt(r*r+a*a)},t.detectOnScreenObjects=function(t){void 0===t&&(t=this.listContainer.y);var e=this.itemHeight+this.space,i=Math.abs(Math.ceil(t/e));this.rect.h},t.startDrag=function(t){if(!(this.listContainer.height<this.containerBackground.height)){this.enableDrag=!0,this.sideMoving=0,TweenLite.killTweensOf(this.listContainer),this.dragging=!0,this.startPoint={x:t.data.global.x,y:t.data.global.y},this.currentMousePos={x:t.data.global.x,y:t.data.global.y};var e=this.listContainer.toLocal(t.data.global);this.currentLocalMousePos={x:e.x,y:e.y}}},Scroller}(o.Container);e.default=n},274:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),s=_interopRequireDefault(i(275)),o=_interopRequireDefault(i(4));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var n=function(r){function People(t){var e;e=r.call(this)||this;var i,n=["boy1","boys2","cop","fireman","woman"];return t?(i="fireman"===t?n[3]:n[2],e.isEventPeople=!0,e.speed=25):(i=n[Math.floor(Math.random()*n.length)],e.speed=20+5*Math.random()),e.sprite=new a.Sprite.from(i+"/"+i+"-1_00003.png"),e.sprite.anchor.set(.5,1),e.animationManager=new s.default,e.animationManager.addAnimation("down",i+"/"+i+"-1_000",15,.1,{loop:!0}),e.animationManager.addAnimation("up",i+"/"+i+"-2_000",15,.1,{loop:!0}),e.animationManager.addAnimation("stopdown",[i+"/"+i+"-2_00003.png"],0,.1),e.animationManager.addAnimation("stopup",[i+"/"+i+"-2_00003.png"],0,.1),e.animationManager.play("down"),e.animationManager.updateAnimation(.1),e.addChild(e.sprite),e.prevWaypointID=0,e.currentWaypointID=0,e.waypoints=[],e.velocity={x:0,y:0},e.targetPosition={x:0,y:0},e.scl=1,e.waitingTime=0,e.currentAnimation="",e.waypointSide=1,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(People,r);var t=People.prototype;return t.setWaypoints=function(t){this.waypoints=t,this.currentWaypointID=Math.floor(Math.random()*this.waypoints.length),this.currentWaypointID=Math.max(this.currentWaypointID,1);var e=this.waypoints[this.currentWaypointID];this.targetPosition.x=e.x,this.targetPosition.y=e.y,this.x=this.targetPosition.x,this.y=this.targetPosition.y},t.setAnimationPoints=function(t){this.waypoints=t,this.currentWaypointID=1;var e=this.waypoints[0],i=this.waypoints[0];this.x=e.x,this.y=e.y,this.targetPosition.x=i.x,this.targetPosition.y=i.y},t.update=function(t){if(this.animationManager.updateAnimation(t),0<this.waitingTime)return this.animationManager.play("stop"+this.currentAnimation),this.waitingTime-=t,void(this.sprite.texture=this.animationManager.currentTexture);this.angleDir=Math.atan2(this.targetPosition.y-this.y,this.targetPosition.x-this.x);var e=Math.floor(180*this.angleDir/Math.PI);this.dist(e,0,90,0)<80?(this.direction=1,this.scl=1):this.dist(e,0,0,0)<80?(this.direction=1,this.scl=-1):Math.abs(this.dist(e,0,180,0))<80?(this.direction=-1,this.scl=1):this.dist(e,0,-90,0)<80&&(this.direction=-1,this.scl=-1),this.sprite.scale.x=this.scl,this.direction<0?this.currentAnimation="up":this.currentAnimation="down",this.animationManager.play(this.currentAnimation,4),this.sprite.texture=this.animationManager.currentTexture;var i=this.waypoints[this.currentWaypointID];this.targetPosition.x=i.x,this.targetPosition.y=i.y;var n=this.speed*t;this.velocity.x=this.lerp(Math.cos(this.angleDir)*n,this.velocity.x,.99),this.velocity.y=this.lerp(Math.sin(this.angleDir)*n,this.velocity.y,.99),this.x+=this.velocity.x,this.y+=this.velocity.y,this.dist(this.x,this.y,this.targetPosition.x,this.targetPosition.y)<5&&(this.velocity.x=0,this.velocity.y=0,o.default.to(this,.5,{x:this.targetPosition.x,y:this.targetPosition.y}),.5<Math.random()?this.toPrevWaypoint():this.toNextWaypoint(),this.waitingTime=3+2*Math.random())},t.toNextWaypoint=function(){this.waypointSide=-1,this.prevWaypointID=this.currentWaypointID+0,this.currentWaypointID++,this.currentWaypointID%=this.waypoints.length},t.toPrevWaypoint=function(){this.waypointSide=1,this.prevWaypointID=this.currentWaypointID+0,this.currentWaypointID--,this.currentWaypointID<0&&(this.currentWaypointID=this.waypoints.length-1)},t.dist=function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},t.lerp=function(t,e,i){return t*(1-i)+e*i},People}(a.Container);e.default=n},275:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=(n=i(8))&&n.__esModule?n:{default:n};var s=function(){function AnimationManager(){this.onStart=new a.default,this.onFinish=new a.default,this.currentTexture=null,this.currentAnimation=null,this.animationData={}}var t=AnimationManager.prototype;return t.nameHelper=function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=".png");for(var r=[],a=i;a<=e;a++){var s="0";s=a<10?"0"+a:a,r.push(t+s+n)}return r},t.addAnimation=function(t,e,i,n,r,a){void 0===i&&(i=1),void 0===n&&(n=.1),void 0===r&&(r={}),void 0===a&&(a=!1),r.start||(r.start=1),null==r.loop&&(r.loop=!0);var s=[];if(0==i)s=e;else if(s=this.nameHelper(e,i,r.start),r.inverse&&s.reverse(),r.boomerang){var o=this.nameHelper(e,i,r.start).reverse();s=s.concat(o)}this.animationData[t]={textures:s,animationSpeed:n,currentFrame:0,currentTime:0,loop:r.loop,hasCallback:a}},t.destroy=function(){this.currentTexture=null,this.currentAnimation=null,this.animationData={}},t.reset=function(){this.currentTexture=null,this.currentAnimation=null,this.animationData={}},t.playOnCurrentFrame=function(t,e){void 0===e&&(e=!1),this.play(t,this.animationData[this.currentAnimation].currentFrame,e)},t.play=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=!1),t!==this.currentAnimation||i){this.currentAnimation=t;var n=this.animationData[this.currentAnimation];n.currentFrame=e,this.currentTexture=r.Texture.from(n.textures[n.currentFrame])}},t.forceFrame=function(t,e){var i=this.animationData[t||this.currentAnimation];i.currentFrame=e,this.currentTexture=r.Texture.from(i.textures[i.currentFrame])},t.getNormalizedFrame=function(){return this.animationData[this.currentAnimation].currentFrame/this.animationData[this.currentAnimation].textures.length},t.forceStop=function(){this.currentAnimation=null},t.getCurrentFrame=function(){return this.animationData[this.currentAnimation].currentFrame},t.updateAnimation=function(t){if(this.currentAnimation&&this.animationData){var e=this.animationData[this.currentAnimation],i=e.currentTime+t;if(i>=e.animationSpeed){var n=Math.ceil((i-e.currentTime)/e.animationSpeed)+1;e.currentFrame+=n,!e.loop&&e.currentFrame>=e.textures.length-1?(e.currentFrame=e.textures.length-1,e.hasCallback&&this.onFinish.dispatch(e.currentFrame)):e.currentFrame%=e.textures.length,e.currentTime=0,this.currentTexture=r.Texture.from(e.textures[e.currentFrame])}else e.currentTime=i}},AnimationManager}();e.default=s},276:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var h=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),o=_interopRequireDefault(i(8)),l=_interopRequireDefault(i(10)),d=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var n=function(s){function BuildingThumbCard(t,e,i,n){var r;(r=s.call(this)||this).game=t,r.container=new h.Container,r.addChild(r.container),r.cardBackPanel=h.Sprite.from(i||"blueprint_panel_tintable.png"),e&&(r.cardBackPanel.tint=d.default.getColorByDistrict(e)),n&&(r.cardBackPanel.tint=n),r.cardBackPanelHighlight=h.Sprite.from("blueprint_panel_outline.png"),r.cardBackPanel.addChild(r.cardBackPanelHighlight),r.container.addChild(r.cardBackPanel),r.building=h.Sprite.from(h.Texture.WHITE);var a=.05*r.cardBackPanel.width;return r.building.scale.set(Math.min(a/r.building.height*r.building.scale.x,a/r.building.width*r.building.scale.x)),r.container.addChild(r.building),r.building.anchor.set(.5),r.building.x=r.cardBackPanel.width/2,r.building.y=.4*r.cardBackPanel.height,r.container.interactive=!0,r.container.buttonMode=!0,r.isDown=!1,r.locked=!1,r.container.pointerdown=function(){r.isDown=!0},r.container.pointerup=function(){r.locked||r.isDown&&(r.isDown=!1,r.onBuildingSelect.dispatch(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r)))},r.onBuildingSelect=new o.default,r.pieces=[],r.canBuildTextures={can:h.Texture.from("panel_tick_icon.png"),cannot:h.Texture.from("panel_cross_icon.png")},r.canBuildIcon=h.Sprite.from("panel_tick_icon.png"),r.addChild(r.canBuildIcon),r.lockSprite=h.Sprite.from("lock_icon.png"),r.lockSprite.anchor.set(.5),r.lockSprite.scale.set(.75),r.lockSprite.position.set(r.building.x,r.building.y),r.lockSprite.visible=!1,r.addChild(r.lockSprite),r}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BuildingThumbCard,s);var t=BuildingThumbCard.prototype;return t.lock=function(){this.locked=!0,this.container.alpha=.5,this.building.tint=4210752,this.pieceContainer.visible=!1,this.lockSprite.visible=!0,this.canBuildIcon.visible=!1},t.unlock=function(){this.locked=!1,this.container.alpha=1,this.building.tint=16777215,this.pieceContainer.visible=!0,this.lockSprite.visible=!1,this.canBuildIcon.visible=!0,this.buyState()},t.buyState=function(){this.canBuy?this.canBuildIcon.texture=this.canBuildTextures.can:this.canBuildIcon.texture=this.canBuildTextures.cannot},t.setData=function(t){this.buildingData=t,this.addPieces(),this.building.texture=h.Texture.from(t.image);var e=.8*this.cardBackPanel.width;this.building.scale.set(Math.min(e/this.building.height*this.building.scale.x,e/this.building.width*this.building.scale.x)),this.updatePieces()},t.addPieces=function(){this.pieceContainer=new h.Container,this.container.addChild(this.pieceContainer);for(var t=this.cardBackPanel.width/this.buildingData.requirementPieces.length,e=0,i=0,n=0;n<this.buildingData.requirementPieces.length;n++){var r=this.buildingData.requirementPieces[n],a=this.game.inventory.inventory.getPieceById(r.id),s=h.Sprite.from(a.image);s.anchor.set(.5),s.scale.set(.25),s.x=t*n,this.pieceContainer.addChild(s);var o=new l.default({text:"1/3",fill:16777215,fontSize:28,x:s.x,y:.7*s.height});this.pieceContainer.addChild(o),o.scale.set(.5),0===e&&0===i&&(e=.5*s.width,i=.5*s.height),this.pieces.push(o)}this.pieceContainer.scale.set(.85),this.pieceContainer.y=this.cardBackPanel.height-this.pieceContainer.height+i-7.5,this.pieceContainer.x=.5*this.cardBackPanel.width-.5*this.pieceContainer.width+e},t.updatePieces=function(){this.canBuy=!0;for(var t=0;t<this.buildingData.requirementPieces.length;t++){var e=this.buildingData.requirementPieces[t],i=this.game.inventory.inventory.getPieceById(e.id);i.value<e.value?(this.canBuy=!1,this.pieces[t].tint=0):this.pieces[t].tint=16777215,this.pieces[t].text=i.value+"/"+e.value}this.buyState()},BuildingThumbCard}(h.Container);e.default=n},277:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(10)),a=_interopRequireDefault(i(741)),s=_interopRequireDefault(i(4)),o=i(7),h=_interopRequireDefault(i(18));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l={width:0,height:0},d=function(e){function EventIndicator(){var t;return(t=e.call(this)||this).eventIcons={fire:n.Texture.from("badge_fire.png"),crime:n.Texture.from("badge_police.png")},t.sin=0,t.isShown=!0,t.signals={success:new h.default,failure:new h.default,tapped:new h.default},t.pause=!0,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(EventIndicator,e);var t=EventIndicator.prototype;return t.build=function(t){var e=this;this.container=new n.Container,this.addChild(this.container),this.interactive=!0,this.buttonMode=!0,this.type=t,this.isDown=!1,this.on("pointerdown",function(){e.isDown=!0}),this.on("pointerup",function(){e.isDown&&e.signals.tapped.dispatch()}),this.buildInnerRing(),this.buildOuterRing(),this.buildIndicator(),this.centerIcon=new n.Sprite.from(this.eventIcons[t]),this.container.addChild(this.centerIcon),this.centerIcon.anchor.set(.5),this.targetRatioInner=1,this.targetRatioOuter=1,this.hide(),l.width=this.container.width,l.height=this.container.height},t.update=function(){if(!this.pause){if(this.isShown){this.sin+=1/60;var t=(this.sin-.6)/.4,e=.1*Math.sin(t)+.8;this.centerIcon.scale.set(e)}0<this.innerRatio&&(this.innerRatio-=1/60*.1)}},t.setIcon=function(t){this.eventIcons[t]&&(this.centerIcon.texture=this.eventIcons[t])},t.buildOuterRing=function(){this.outerRingContainer=new n.Container,this.container.addChild(this.outerRingContainer);var t=new n.Sprite.from("fire_outerring_empty.png");t.anchor.set(.5),this.outerRingContainer.addChild(t);var e=new n.Sprite.from("fire_outerring_full.png");e.anchor.set(.5),this.outerMask=new a.default,this.outerMask.radius=t.width/2,this.outerMask.segments=15,this.outerMask.ratio=1,this.innerRingContainer.addChild(this.outerMask),e.mask=this.outerMask,this.outerRingContainer.addChild(e)},t.buildInnerRing=function(){this.innerRingContainer=new n.Container,this.container.addChild(this.innerRingContainer);var t=new n.Sprite.from("fire_innerring_empty.png");t.anchor.set(.5),this.innerRingContainer.addChild(t);var e=new n.Sprite.from("fire_innerring_full.png");e.anchor.set(.5),this.innerMask=new a.default,this.innerMask.radius=t.width/2,this.innerMask.segments=15,this.innerMask.ratio=1,this.innerRingContainer.addChild(this.innerMask),e.mask=this.innerMask,this.innerRingContainer.addChild(e)},t.buildIndicator=function(){this.pointer=new n.Sprite.from("fire_incident_pointer.png"),this.pointer.anchor.set(.5),this.container.addChild(this.pointer);var t=new r.default({text:"100m",fill:16777215,padding:10,fontSize:24,y:.5*-this.pointer.height+10});this.distanceText=t},t.drop=function(){var t=this.container.y+90;s.default.to(this.container,.5,{y:t,ease:o.Back.easeOut}),s.default.to(this.pointer,.5,{alpha:0,ease:o.Back.easeOut})},t.transformIndicator=function(t,e){var i=.5*(t.x+e.x),n=.5*(t.y+e.y);this.x=i,this.y=n,this.rotateTowardsTarget(t,e);var r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));this.distanceText.text=Math.floor(r.toString())+"m"},t.rotateTowardsTarget=function(t,e){var i=Math.atan2(t.y-e.y,t.x-e.x);this.pointer.rotation=i-.5*Math.PI},t.animateOut=function(t){var e=this;void 0===t&&(t=.25),this.container.scale.set(1.5),s.default.to(this.container.scale,t,{x:0,y:0,onComplete:function(){e.isShown=!1,e.hide(),e.reset()},ease:o.Back.easeOut})},t.animateIn=function(){var t=this;this.show(),this.container.scale.set(.5),s.default.to(this.container.scale,.25,{x:1.5,y:1.5,ease:o.Back.easeOut,onComplete:function(){t.isShown=!0}})},t.hide=function(){this.pause=!0,this.visible=!1,this.isShown=!1},t.show=function(){this.visible=!0,this.isShown=!0,this.reset()},t.reset=function(){this.innerRatio=0,this.outerRatio=1,this.pause=!1,s.default.killTweensOf(this.container),s.default.killTweensOf(this.pointer),this.container.y=0,this.pointer.alpha=1},t.boundaryCollision=function(t,e){this.x<-.5*t+.5*l.width?this.x=-.5*t+.5*l.width:this.x>.5*t-.5*l.width&&(this.x=.5*t-.5*l.width),this.y<-.5*e+.5*l.height?this.y=-.5*e+.5*l.height:this.y>.5*e-.5*l.height&&(this.y=.5*e-.5*l.height)},t.lerp=function(t,e,i){return(1-i)*t+i*e},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(EventIndicator,[{key:"innerRatio",get:function(){return this.innerMask.ratio},set:function(t){1<=t&&(this.pause=!0,this.signals.success.dispatch()),this.innerMask.ratio=t}},{key:"outerRatio",get:function(){return this.outerMask.ratio},set:function(t){t<=0&&(this.pause=!0,this.signals.failure.dispatch()),this.outerMask.ratio=t}}]),EventIndicator}(n.Container);e.default=d},278:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=i(1),s=(_interopRequireDefault(i(748)),_interopRequireDefault(i(749))),o=i(752);!function(t){{if(t&&t.__esModule)return;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}e.default=t}}(i(757));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h=o.mat4.create(),l=o.mat4.create();o.mat4.translate(l,l,[0,0,-100]),o.mat4.rotateX(l,l,-.635),o.mat4.rotateY(l,l,.771);o.mat4.identity(l),o.mat4.translate(l,l,[0,0,-100]),o.mat4.rotateX(l,l,-.771),o.mat4.rotateY(l,l,-2.337),o.mat4.rotateZ(l,l,0);var d=new a.UniformGroup({projectionView:o.mat4.create(),translationMatrix:o.mat3.create(),normalMatrix:o.mat3.create(),aspectRatio:1});var n=function(r){function Little3d(t,e){var i;if(i=r.call(this)||this,!t)throw new Error("please provide a new model id");if(!e)throw new Error("please provide a new texture id");i.geometry=new a.Geometry.from(t),i.shader=new s.default(a.Texture.from(e));var n=new a.State;return n.depthTest=!0,n.culling=!1,n.blend=!0,n.clockwiseFrontFace=!0,i.rotation3d={x:0,y:0,z:0},i.rotation3dCache={x:0,y:0,z:0},i.state=n,i.shader.uniforms.little3dUniforms=d,i.cachedTransform=o.mat4.create(),i.cachedNormal=o.mat3.create(),i}return function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Little3d,r),Little3d.prototype.render=function(t){t.batch.flush();var e=d.uniforms;e.aspectRatio=t.width/t.height;var i=e.projectionView;if(this.rotation3dCache.x!==this.rotation3d.x||this.rotation3dCache.y!==this.rotation3d.y||this.rotation3dCache.z!==this.rotation3d.z){this.rotation3dCache.x=this.rotation3d.x,this.rotation3dCache.y=this.rotation3d.y,this.rotation3dCache.z=this.rotation3d.z;var n=o.mat4.identity(this.cachedTransform);o.mat4.rotateX(n,n,-this.rotation3d.x),o.mat4.rotateY(n,n,-this.rotation3d.y),o.mat4.rotateZ(n,n,this.rotation3d.z),function(t,e){var i=e[0],n=e[1],r=e[2],a=e[4],s=e[5],o=e[6],h=e[8],l=e[9],d=e[10],c=i*s-n*a,u=i*o-r*a,p=n*o-r*s,f=c*d-u*l+p*h;f=1/f,t[0]=(s*d-o*l)*f,t[1]=(o*h-a*d)*f,t[2]=(a*l-s*h)*f,t[3]=(r*l-n*d)*f,t[4]=(i*d-r*h)*f,t[5]=(n*h-i*l)*f,t[6]=p*f,t[7]=-u*f,t[8]=c*f}(this.cachedNormal,this.cachedTransform)}o.mat4.multiply(i,h,l),o.mat4.multiply(i,i,this.cachedTransform),e.normalMatrix=this.cachedNormal,e.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(this.shader),t.state.set(this.state),t.geometry.bind(this.geometry),t.geometry.draw(a.DRAW_MODES.TRIANGLES)},Little3d.updateProjection=function(t,e){var i=e/t;o.mat4.ortho(h,-10,10,-10*i,10*i,.1,2e3)},Little3d}(a.Container);e.default=n},284:function(t,e,i){i(285),t.exports=i(487)},29:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=_interopRequireDefault(i(10)),s=i(7),o=_interopRequireDefault(i(25));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var n=function(n){function Button(t){var e;void 0===t&&(t={}),e=n.call(this)||this;var i=Object.assign({name:"",x:null,y:null,icon:null,base:null,label:null,noScale:!1,downDepth:10,downScale:new r.Point(1,1),overScale:new r.Point(1,1),normalScale:new r.Point(1,1),noOver:!1,noDown:!1,tint:16777215,tintAlt:5592405},t);return e.opts=i,e.name=i.name,null!==i.x&&(e.x=i.x),null!==i.y&&(e.y=i.y),e.buttonContainer=new r.Container,e.addChild(e.buttonContainer),e.on("pointertap",e.onPointerTap.bind(_assertThisInitialized(e)),_assertThisInitialized(e)),e.on("pointerover",e.onPointerOver.bind(_assertThisInitialized(e)),_assertThisInitialized(e)),e.on("pointerout",e.onPointerOut.bind(_assertThisInitialized(e)),_assertThisInitialized(e)),e.on("pointerup",e.onPointerUp.bind(_assertThisInitialized(e)),_assertThisInitialized(e)),e.on("pointerupoutside",e.onPointerUp.bind(_assertThisInitialized(e)),_assertThisInitialized(e)),e.on("pointerdown",e.onPointerDown.bind(_assertThisInitialized(e)),_assertThisInitialized(e)),null!==i.base&&e.setBase(i.base),null!==i.icon&&e.setIcon(i.icon),null!==i.label&&e.setLabel(i.label),e.isPressed=!1,e.noDown=i.noDown,e.downDepth=i.downDepth,e._update(),e._enabled=!0,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Button,n);var t=Button.prototype;return t.setBase=function(t){if("string"==typeof t){this.base||(this.base=new r.Sprite),this.base.texture=r.Texture.from(t),this.base.textureNormal=this.base.texture;var e=r.Texture.from(t);this.opts.noOver||(e=t.includes("up.png")?r.Texture.from(t.replace("up.png","")+"over.png"):r.Texture.from(t.replace(".png","")+"-over.png")),this.base.textureOver=e||this.base.textureNormal;var i=r.Texture.from(t);this.opts.noDown||(i=t.includes("up.png")?r.Texture.from(t.replace("up.png","")+"down.png"):r.Texture.from(t.replace(".png","")+"-down.png")),this.base.textureDown=i||this.base.textureNormal,this.base.anchor.set(.5)}else{var n=Object.assign({color:16763904,alpha:1,w:200,h:100},t);this.base||(this.base=new r.Graphics),this.base.clear(),this.base.beginFill(n.color,n.alpha),this.base.drawRect(-8,-8,16,16),this.base.width=n.w,this.base.height=n.h}this.addChildAt(this.base,0),this.backupInteraction=(new r.Graphics).beginFill(0).drawRect(0,0,this.base.width,this.base.height),this.backupInteraction.x=.5*-this.backupInteraction.width,this.backupInteraction.y=.5*-this.backupInteraction.height,this.backupInteraction.alpha=0,this.addChildAt(this.backupInteraction,0)},t.setIcon=function(t){t="string"==typeof t?{texture:t}:t;var e=Object.assign({texture:"",anchor:.5},t||{});this.icon||(this.icon=new r.Sprite),this.icon.texture=r.Texture.from(e.texture),this.icon.anchor.set(e.anchor),this.buttonContainer.addChild(this.icon),this.icon.position.y-=3.5},t.setLabel=function(t){t="string"==typeof t?{text:t}:t,this.label||(this.label=new a.default(t)),this.buttonContainer.addChild(this.label)},t.addChildAtContainer=function(t,e,i){void 0===i&&(i=this.buttonContainer);var n="last"===e?i.children.length-1:e;i.addChildAt(t,n)},t.add=function(t){this.buttonContainer.addChild(t)},t.addAtIndex=function(t,e){void 0===e&&(e="last");var i="last"===e?this.buttonContainer.children.length-1:e;this.buttonContainer.addChildAt(t,i)},t.onPointerTap=function(){this._onTap&&this._onTap(this)},t.onPointerOver=function(){this.stopAnimations(),this.enabled&&this._animateOver(),this.enabled&&this.base.textureOver&&(this.base.texture=this.base.textureOver),this._onOver&&this._onOver(this),o.default.playSfx("button-over")},t.onPointerOut=function(){this.stopAnimations(),this.enabled&&this._animateOut(),this.base.texture=this.base.textureNormal,this._onOut&&this._onOut(this),o.default.playSfx("button-off"),this.isPressed=!1},t.onPointerUp=function(){this.stopAnimations(),this.enabled&&this._animateClick(),this.base.texture=this.base.textureNormal,this._onUp&&this._onUp(this),this.isPressed=!1},t.onPointerDown=function(){this.isPressed=!0,this.stopAnimations(),this.enabled&&this._animateDown(),this.enabled&&this.base.textureDown&&(this.base.texture=this.base.textureDown),this._onDown&&this._onDown(this),o.default.playSfx("button-press")},t.onKeyDown=function(t){this.interactive&&this.visible&&this._key&&!t.repeat&&this._onTap&&t[this._keyField]===this._key&&this.onPointerTap()},t.stopAnimations=function(){s.TweenLite.killTweensOf(this.buttonContainer.scale)},t._animateOver=function(){this.opts.noScale||s.TweenLite.to(this.buttonContainer.scale,.6,{x:this.opts.overScale.x,y:this.opts.overScale.y,ease:s.Elastic.easeOut})},t._animateOut=function(){this.isPressed&&!this.noDown&&(this.buttonContainer.position.y-=this.downDepth),this.opts.noScale||s.TweenLite.to(this.buttonContainer.scale,.6,{x:this.opts.normalScale.x,y:this.opts.normalScale.y,ease:s.Elastic.easeOut})},t._animateDown=function(){this.noDown||(this.buttonContainer.position.y+=this.downDepth),this.opts.noScale||s.TweenLite.to(this.buttonContainer.scale,.6,{x:this.opts.downScale.x,y:this.opts.downScale.y,ease:s.Elastic.easeOut})},t._animateClick=function(){this.isPressed&&!this.noDown&&(this.buttonContainer.position.y-=this.downDepth),this.opts.noScale||s.TweenLite.to(this.buttonContainer.scale,.6,{x:1,y:1,ease:s.Elastic.easeOut})},t._update=function(){var t=this.interactive?this.opts.tint:this.opts.tintAlt;this.base&&(this.base.tint=t),this.icon&&(this.icon.tint=t),this.label&&(this.label._text.tint=t)},t.animateIn=function(t,e){var i=this;s.TweenLite.killTweensOf(this),s.TweenLite.killTweensOf(this.scale),this.visible=!1,this.scale.set(.5),e=e||1,s.TweenLite.to(this.scale,.3,{delay:t,ease:s.Back.easeOut.config(3),x:e,y:e,onStart:function(){i.visible=!0}})},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(Button,[{key:"key",get:function(){return this._key},set:function(t){this._key=t,this._keyField="string"==typeof t?"code":"which",this._onKeyDownBind||(this._onKeyDownBind=this.onKeyDown.bind(this)),document.removeEventListener("keyup",this._onKeyDownBind),this._key&&document.addEventListener("keyup",this._onKeyDownBind)}},{key:"onTap",set:function(t){this._onTap=t,this.enabled=!!t,this._update()},get:function(){return this._onTap}},{key:"onOver",get:function(){return this._onOver},set:function(t){this._onOver=t}},{key:"onOut",get:function(){return this._onOut},set:function(t){this._onOut=t}},{key:"onUp",get:function(){return this._onUp},set:function(t){this._onUp=t}},{key:"onDown",get:function(){return this._onDown},set:function(t){this._onDown=t}},{key:"enabled",set:function(t){this.interactive=t;var e=(this.buttonMode=t)?1:.5;this.buttonContainer.alpha=e,this.buttonContainer.interactiveChildren=!1,this._update()},get:function(){return this.interactive}}]),Button}(r.Container);e.default=n},41:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=new(function(){function SaveSystem(){}var t=SaveSystem.prototype;return t.createCookie=function(t,e){var i=JSON.stringify(e);try{window.localStorage.setItem(t,i)}catch(t){}},t.getCookie=function(t){return JSON.parse(window.localStorage.getItem(t))},t.storeObject=function(t,e){window.localStorage.setItem(t,JSON.stringify(e))},t.resetCookie=function(){for(var t in window.localStorage)window.localStorage.removeItem(t)},SaveSystem}());e.default=n},44:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=new(function(){function GameData(){}var t=GameData.prototype;return t.init=function(t){this.resources=t.resourceManager,this.data=this.resources.getJson("data/game").data,this.debugData={debugMode:!1,logEventTime:!1}},t.setDebug=function(t,e){this.debugData[t]=e},t.getDebug=function(t){return this.debugData[t]},t.get=function(t){return this.data[t]},t.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},GameData}());e.default=n},487:function(t,e,i){"use strict";var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(525)),a=_interopRequireDefault(i(767));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function urlBase(){return"object"==typeof window.jsembed?jsembed.baseUrl():""}n.settings.RENDER_OPTIONS.legacy=!1;var s={gid:"hstreet",gameDir:urlBase(),gameContainerId:"og-game-holder",isFullScreen:window.self===window.top,exitGameUrl:"https://www.goodboydigital.com/",environment:"test",embedVars:{statsCounterName:"testCounterName",statsAppName:"TestAppName"}};!function(){if((new a.default).supported){window.og||(window.og=s),window.ASSET_URL||(window.ASSET_URL=urlBase()+"assets/"),window.DEVICE_SCALE||(window.DEVICE_SCALE=window.devicePixelRatio||1),window.console||(window.console={}),window.console.log||(window.console.log=function(t){return t});var t=document.getElementById(s.gameContainerId);"object"==typeof window.jsembed&&(t=jsembed.embedDiv()),new r.default(window.sharedAppData).init(t)}}()},525:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var l=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),d=_interopRequireDefault(i(526)),c=_interopRequireDefault(i(541)),u=_interopRequireDefault(i(542)),p=_interopRequireDefault(i(23)),n=_interopRequireDefault(i(543)),r=_interopRequireDefault(i(683)),f=_interopRequireDefault(i(684)),g=_interopRequireDefault(i(685)),a=_interopRequireDefault(i(686)),s=_interopRequireDefault(i(687)),o=_interopRequireDefault(i(688)),m=_interopRequireDefault(i(13)),v=_interopRequireDefault(i(690)),b=_interopRequireDefault(i(691)),y=_interopRequireDefault(i(693)),w=_interopRequireDefault(i(29)),_=_interopRequireDefault(i(694)),C=_interopRequireDefault(i(761)),x=_interopRequireDefault(i(763)),k=_interopRequireDefault(i(765)),S=_interopRequireDefault(i(25)),P=_interopRequireDefault(i(44)),h=_interopRequireDefault(i(766)),D=_interopRequireDefault(i(278));_interopRequireDefault(i(41));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function asyncGeneratorStep(t,e,i,n,r,a,s){try{var o=t[a](s),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(n,r)}i(211).default=h.default;var T=function(h){function Application(t){var e,i=new l.Container,n={manifest:function(t){return t}(u.default),orientationMode:d.default.orientationModes.LANDSCAPE,screenManagerOptions:{container:i,defaultTransition:new c.default},middlewares:[x.default],antialias:!1,version:t.config.debug,fps:t.config.debug,upload:!1,loadingScreenClass:f.default,rotationImage:"device/rotate_device_01.png",verison:!0};if((e=h.call(this,n)||this).orientationManager.rotateScreen.style.backgroundSize="100%",window.OPT=!p.default.instance.desktop||p.default.instance.ie||0<e.optimisationLevel||p.default.instance.iPad,p.default.instance.iOS&&window.scrollTo(0,1),e.resourceManager.middlewaresPre=[g.default],e.manifest=n.manifest,e.config=Object.assign({},t.config),e.color=0,e.screens=i,e.stage.addChild(e.screens),e.overlay=new l.Container,e.stage.addChild(e.overlay),e.showNoGoZone=!1,e.showNoGoZone){var r=Math.floor(16777215*Math.random()),a=(new l.Graphics).beginFill(r).drawRect(0,0,140,140);e.overlay.addChild(a);var s=(new l.Graphics).beginFill(r).drawRect(-1e3,0,1e4,40);e.overlay.addChild(s)}document.addEventListener("touchmove",function(t){1!==t.scale&&t.preventDefault()},!1);var o=0;return document.addEventListener("touchend",function(t){var e=(new Date).getTime();e-o<=300&&t.preventDefault(),o=e},!1),e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Application,h);var t=Application.prototype;return t.init=function(){var e=function(a){return function(){var t=this,r=arguments;return new Promise(function(e,i){var n=a.apply(t,r);function _next(t){asyncGeneratorStep(n,e,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(n,e,i,_next,_throw,"throw",t)}_next(void 0)})}}(regeneratorRuntime.mark(function _callee(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.container=e,this.settings=new b.default("settings",{sound:!0},!0),this.addSystem("resources",new s.default(this)),this.addSystem("size",new a.default(this)),this.addSystem("events",new o.default(this)),this.addSystem("loading",new C.default(this)),this.addScreen("loading",new f.default(this)),this.addScreen("title",new n.default(this)),this.addScreen("game",new r.default(this)),m.default.setup(this),this.settings.onChange.add(this.onSettingsChange,this),this.onSettingsChange(),t.next=14,this.resources.load("preload");case 14:return t.next=16,this.resources.load("title");case 16:P.default.init(this),this.screenManager.registerTransition(new k.default,"title","all"),this.screenManager.registerTransition(new k.default,"game","title"),this.loadAudio(),this.btnSound=new w.default,this.game=new _.default(this),this.onSettingsChange(),this.onResize(),this.sdk=new y.default(this),"8000"===location.port&&(window._app=this,window._game=this.game),v.default.getUrlParam("newgame")&&this.game.state.clean(),v.default.getUrlParam("fastplay",!1)?this.goToGame():this.screenManager.gotoScreenByID("title"),P.default.setDebug("debugMode",v.default.getUrlParam("debug",!1)),P.default.setDebug("logEventTime",v.default.getUrlParam("eventTime",!1)),this.config.autoload&&this.resources.load("game");case 31:case"end":return t.stop()}},_callee,this)}));return function(t){return e.apply(this,arguments)}}(),t.loadAudio=function(){var t=["dig-loop","music_loop_01","lego-theme-music"];for(var e in this.manifest.audio.audio){var i=this.manifest.audio.audio[e],n=""+(window.ASSET_URL+i.mp3),r=t.includes(i.shortcut);S.default.registerSound({id:i.shortcut,src:n,preload:!0,loop:r}),S.default.getChannelById("sfx").volume=.5}},t.onSettingsChange=function(){this.settings.get("sound");this.btnSound},t.addScreen=function(t,e){this[t+"Screen"]=e,"loading"===t?this.screenManager.loadingScreen=e:this.screenManager.addScreen(e,t)},t.addSystem=function(t,e){this.systems||(this.systems={}),this[t]=e,this.systems[t]=e},t.suspend=function(){this.suspended||(this.suspended=!0,this.blocker||(this.blocker=new l.Graphics,this.blocker.beginFill(this.color,.5),this.blocker.drawRect(0,0,16,16),this.blocker.endFill()),this.blocker.visible=!0,this.stage.addChild(this.blocker),this.blocker.width=this.size.sw,this.blocker.height=this.size.sh)},t.resume=function(){this.suspended&&(this.suspended=!1,this.blocker&&(this.blocker.visible=!1),this.blocker&&this.blocker.parent&&this.stage.addChild(this.blocker))},t.goToGame=function(){this.screenManager.gotoScreenByID("game")},t.onLoadStart=function(t){},t.onLoadComplete=function(t){"preload"===t&&this.container.appendChild(this.view),"game"===t&&this.shouldOpenGame&&this.goToGame(),this.size.update(),this.overlay&&this.stage.addChild(this.overlay)},t.onFocus=function(){this.suspended||(S.default.system.paused=!1)},t.onBlur=function(){this.suspended||(S.default.system.paused=!0,this.game&&this.game.blur())},t.onResize=function(){this.view.style.position="absolute",this.view.style.width=this.size.w+"px",this.view.style.height=this.size.h+"px",this.view.style.left="0px",this.view.style.top="0px",this.renderer.resize(this.size.sw,this.size.sh),this.screenManager.resize(this.size.w,this.size.h),this.screenManager.container.scale.x=this.size.scale,this.screenManager.container.scale.y=this.size.scale,this.overlay.scale.x=this.size.scale,this.overlay.scale.y=this.size.scale,this.blocker&&this.blocker.visible&&(this.blocker.width=this.size.sw,this.blocker.height=this.size.sh),D.default.updateProjection(this.size.sw,this.size.sh)},t.timeout=function(e){return new Promise(function(t){return setTimeout(t,e)})},Application}(d.default);e.default=T},542:function(t){t.exports=JSON.parse('{"default":{"image":{},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"app":{"image":{"app/splash":{"shortcut":"splash","default":"app/splash.png","low":"app/splash_mip.png"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"audio":{"image":{},"fonts":{},"audio":{"audio/music/dig-loop":{"shortcut":"dig-loop","mp3":"audio/music/dig-loop.mp3","ogg":"audio/music/dig-loop.ogg"},"audio/music/lego-theme-music":{"shortcut":"lego-theme-music","mp3":"audio/music/lego-theme-music.mp3","ogg":"audio/music/lego-theme-music.ogg"},"audio/music/music_loop_01":{"shortcut":"music_loop_01","mp3":"audio/music/music_loop_01.mp3","ogg":"audio/music/music_loop_01.ogg"},"audio/sfx/alarm-crime":{"shortcut":"alarm-crime","mp3":"audio/sfx/alarm-crime.mp3","ogg":"audio/sfx/alarm-crime.ogg"},"audio/sfx/alarm-fire":{"shortcut":"alarm-fire","mp3":"audio/sfx/alarm-fire.mp3","ogg":"audio/sfx/alarm-fire.ogg"},"audio/sfx/button-off":{"shortcut":"button-off","mp3":"audio/sfx/button-off.mp3","ogg":"audio/sfx/button-off.ogg"},"audio/sfx/button-over":{"shortcut":"button-over","mp3":"audio/sfx/button-over.mp3","ogg":"audio/sfx/button-over.ogg"},"audio/sfx/button-press":{"shortcut":"button-press","mp3":"audio/sfx/button-press.mp3","ogg":"audio/sfx/button-press.ogg"},"audio/sfx/button-zoom-in":{"shortcut":"button-zoom-in","mp3":"audio/sfx/button-zoom-in.mp3","ogg":"audio/sfx/button-zoom-in.ogg"},"audio/sfx/button-zoom-na":{"shortcut":"button-zoom-na","mp3":"audio/sfx/button-zoom-na.mp3","ogg":"audio/sfx/button-zoom-na.ogg"},"audio/sfx/button-zoom-out":{"shortcut":"button-zoom-out","mp3":"audio/sfx/button-zoom-out.mp3","ogg":"audio/sfx/button-zoom-out.ogg"},"audio/sfx/coin_ready":{"shortcut":"coin_ready","mp3":"audio/sfx/coin_ready.mp3","ogg":"audio/sfx/coin_ready.ogg"},"audio/sfx/collect-money":{"shortcut":"collect-money","mp3":"audio/sfx/collect-money.mp3","ogg":"audio/sfx/collect-money.ogg"},"audio/sfx/comms-panel-congratulations":{"shortcut":"comms-panel-congratulations","mp3":"audio/sfx/comms-panel-congratulations.mp3","ogg":"audio/sfx/comms-panel-congratulations.ogg"},"audio/sfx/comms-panel-in":{"shortcut":"comms-panel-in","mp3":"audio/sfx/comms-panel-in.mp3","ogg":"audio/sfx/comms-panel-in.ogg"},"audio/sfx/comms-panel-out":{"shortcut":"comms-panel-out","mp3":"audio/sfx/comms-panel-out.mp3","ogg":"audio/sfx/comms-panel-out.ogg"},"audio/sfx/comms-panel-sad":{"shortcut":"comms-panel-sad","mp3":"audio/sfx/comms-panel-sad.mp3","ogg":"audio/sfx/comms-panel-sad.ogg"},"audio/sfx/comms-panel-text":{"shortcut":"comms-panel-text","mp3":"audio/sfx/comms-panel-text.mp3","ogg":"audio/sfx/comms-panel-text.ogg"},"audio/sfx/construction-end":{"shortcut":"construction-end","mp3":"audio/sfx/construction-end.mp3","ogg":"audio/sfx/construction-end.ogg"},"audio/sfx/construction-start":{"shortcut":"construction-start","mp3":"audio/sfx/construction-start.mp3","ogg":"audio/sfx/construction-start.ogg"},"audio/sfx/crowd_cheering":{"shortcut":"crowd_cheering","mp3":"audio/sfx/crowd_cheering.mp3","ogg":"audio/sfx/crowd_cheering.ogg"},"audio/sfx/destroy-building":{"shortcut":"destroy-building","mp3":"audio/sfx/destroy-building.mp3","ogg":"audio/sfx/destroy-building.ogg"},"audio/sfx/dig-find-brick":{"shortcut":"dig-find-brick","mp3":"audio/sfx/dig-find-brick.mp3","ogg":"audio/sfx/dig-find-brick.ogg"},"audio/sfx/dig-find-coins":{"shortcut":"dig-find-coins","mp3":"audio/sfx/dig-find-coins.mp3","ogg":"audio/sfx/dig-find-coins.ogg"},"audio/sfx/dig-find-piece":{"shortcut":"dig-find-piece","mp3":"audio/sfx/dig-find-piece.mp3","ogg":"audio/sfx/dig-find-piece.ogg"},"audio/sfx/dig-results-lose":{"shortcut":"dig-results-lose","mp3":"audio/sfx/dig-results-lose.mp3","ogg":"audio/sfx/dig-results-lose.ogg"},"audio/sfx/dig-results-win":{"shortcut":"dig-results-win","mp3":"audio/sfx/dig-results-win.mp3","ogg":"audio/sfx/dig-results-win.ogg"},"audio/sfx/dig":{"shortcut":"dig","mp3":"audio/sfx/dig.mp3","ogg":"audio/sfx/dig.ogg"},"audio/sfx/emergency-button-deflate":{"shortcut":"emergency-button-deflate","mp3":"audio/sfx/emergency-button-deflate.mp3","ogg":"audio/sfx/emergency-button-deflate.ogg"},"audio/sfx/emergency-button-press":{"shortcut":"emergency-button-press","mp3":"audio/sfx/emergency-button-press.mp3","ogg":"audio/sfx/emergency-button-press.ogg"},"audio/sfx/fire-extinguish":{"shortcut":"fire-extinguish","mp3":"audio/sfx/fire-extinguish.mp3","ogg":"audio/sfx/fire-extinguish.ogg"},"audio/sfx/money-riser":{"shortcut":"money-riser","mp3":"audio/sfx/money-riser.mp3","ogg":"audio/sfx/money-riser.ogg"},"audio/sfx/new-district-open":{"shortcut":"new-district-open","mp3":"audio/sfx/new-district-open.mp3","ogg":"audio/sfx/new-district-open.ogg"},"audio/sfx/pop":{"shortcut":"pop","mp3":"audio/sfx/pop.mp3","ogg":"audio/sfx/pop.ogg"}},"model":{},"json":{},"animate":{},"misc":{}},"backgrounds":{"image":{"backgrounds/background_tile":{"shortcut":"background_tile","default":"backgrounds/background_tile.jpg","low":"backgrounds/background_tile_mip.jpg"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"blueprints":{"image":{"blueprints/blueprints":{"tags":{"tps":true,"manifest":true},"default":"blueprints/blueprints.json","low":"blueprints/blueprints_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"bricks":{"image":{"bricks/bricks":{"tags":{"manifest":true,"tps":true},"default":"bricks/bricks.json","low":"bricks/bricks_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"buildings":{"image":{"buildings/buildings-8":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-8.json","low":"buildings/buildings-8_mip.json"},"buildings/buildings-7":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-7.json","low":"buildings/buildings-7_mip.json"},"buildings/buildings-5":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-5.json","low":"buildings/buildings-5_mip.json"},"buildings/buildings-4":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-4.json","low":"buildings/buildings-4_mip.json"},"buildings/buildings-6":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-6.json","low":"buildings/buildings-6_mip.json"},"buildings/buildings-2":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-2.json","low":"buildings/buildings-2_mip.json"},"buildings/buildings-3":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-3.json","low":"buildings/buildings-3_mip.json"},"buildings/buildings-1":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-1.json","low":"buildings/buildings-1_mip.json"},"buildings/buildings-0":{"tags":{"tps":true,"manifest":true},"default":"buildings/buildings-0.json","low":"buildings/buildings-0_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"building_motion":{"image":{"building_motion/building_motion-5":{"tags":{"tps":true,"manifest":true},"default":"building_motion/building_motion-5.json","low":"building_motion/building_motion-5_mip.json"},"building_motion/building_motion-0":{"tags":{"tps":true,"manifest":true},"default":"building_motion/building_motion-0.json","low":"building_motion/building_motion-0_mip.json"},"building_motion/building_motion-4":{"tags":{"tps":true,"manifest":true},"default":"building_motion/building_motion-4.json","low":"building_motion/building_motion-4_mip.json"},"building_motion/building_motion-2":{"tags":{"tps":true,"manifest":true},"default":"building_motion/building_motion-2.json","low":"building_motion/building_motion-2_mip.json"},"building_motion/building_motion-1":{"tags":{"tps":true,"manifest":true},"default":"building_motion/building_motion-1.json","low":"building_motion/building_motion-1_mip.json"},"building_motion/building_motion-3":{"tags":{"tps":true,"manifest":true},"default":"building_motion/building_motion-3.json","low":"building_motion/building_motion-3_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"buttons":{"image":{"buttons/buttons":{"tags":{"tps":true,"manifest":true},"default":"buttons/buttons.json","low":"buttons/buttons_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"character_panel":{"image":{"character_panel/character_panel":{"tags":{"tps":true,"manifest":true},"default":"character_panel/character_panel.json","low":"character_panel/character_panel_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"chars":{"image":{"chars/chars":{"tags":{"tps":true,"manifest":true},"default":"chars/chars.json","low":"chars/chars_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"data":{"image":{},"fonts":{"data/config":{"shortcut":"config","default":"data/config.xml"},"data/loc_en":{"shortcut":"loc_en","default":"data/loc_en.xml"}},"audio":{},"model":{},"json":{"data/buildings":{"shortcut":"buildings","default":"data/buildings.json"},"data/game":{"shortcut":"game","default":"data/game.json"},"data/pieces":{"shortcut":"pieces","default":"data/pieces.json"}},"animate":{},"misc":{}},"device":{"image":{"device/rotate_device_01":{"shortcut":"rotate_device_01","default":"device/rotate_device_01.png","low":"device/rotate_device_01_mip.png"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"dig_minigame":{"image":{"dig_minigame/dig_minigame":{"tags":{"manifest":true,"tps":true},"default":"dig_minigame/dig_minigame.json","low":"dig_minigame/dig_minigame_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"dig_site":{"image":{"dig_site/dig_site":{"tags":{"manifest":true,"tps":true},"default":"dig_site/dig_site.json","low":"dig_site/dig_site_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"event":{"image":{"event/ui/ui":{"tags":{"tps":true},"default":"event/ui/ui.json","low":"event/ui/ui_mip.json"},"event/water/water_stream_01":{"shortcut":"water_stream_01","default":"event/water/water_stream_01.png","low":"event/water/water_stream_01_mip.png"},"event/water/water_stream_02":{"shortcut":"water_stream_02","default":"event/water/water_stream_02.png","low":"event/water/water_stream_02_mip.png"},"event/water/water_stream_03":{"shortcut":"water_stream_03","default":"event/water/water_stream_03.png","low":"event/water/water_stream_03_mip.png"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"font":{"image":{},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"inventory_overlay":{"image":{"inventory_overlay/inventory_overlay":{"tags":{"tps":true,"manifest":true},"default":"inventory_overlay/inventory_overlay.json","low":"inventory_overlay/inventory_overlay_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"minigame":{"image":{"minigame/minigame":{"tags":{"manifest":true,"tps":true},"default":"minigame/minigame.json","low":"minigame/minigame_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"models":{"image":{"models/vehicles/textures/textures":{"tags":{"tps":true},"default":"models/vehicles/textures/textures.json","low":"models/vehicles/textures/textures_mip.json"}},"fonts":{},"audio":{},"model":{"models/vehicles/fireman-car":{"shortcut":"fireman-car","default":"models/vehicles/fireman-car.gbo"},"models/vehicles/ice-cream-van":{"shortcut":"ice-cream-van","default":"models/vehicles/ice-cream-van.gbo"},"models/vehicles/normal-car":{"shortcut":"normal-car","default":"models/vehicles/normal-car.gbo"},"models/vehicles/police-car":{"shortcut":"police-car","default":"models/vehicles/police-car.gbo"},"models/vehicles/van-truck":{"shortcut":"van-truck","default":"models/vehicles/van-truck.gbo"}},"json":{},"animate":{},"misc":{}},"particles":{"image":{"particles/particles":{"tags":{"tps":true,"manifest":true},"default":"particles/particles.json","low":"particles/particles_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"preload":{"image":{"preload/preload":{"tags":{"manifest":true,"tps":true},"default":"preload/preload.json","low":"preload/preload_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"reward_overlay":{"image":{"reward_overlay/reward_overlay":{"tags":{"tps":true,"manifest":true},"default":"reward_overlay/reward_overlay.json","low":"reward_overlay/reward_overlay_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"ribbon":{"image":{"ribbon/ribbon":{"tags":{"manifest":true,"tps":true},"default":"ribbon/ribbon.json","low":"ribbon/ribbon_mip.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}},"ui":{"image":{"ui/ui-1":{"tags":{"crush":true,"fix":true,"tps":true,"manifest":true},"default":"ui/ui-1.json"},"ui/ui-0":{"tags":{"crush":true,"fix":true,"tps":true,"manifest":true},"default":"ui/ui-0.json"}},"fonts":{},"audio":{},"model":{},"json":{},"animate":{},"misc":{}}}')},543:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(29)),a=_interopRequireDefault(i(10)),s=_interopRequireDefault(i(23)),o=_interopRequireDefault(i(41)),h=_interopRequireDefault(i(13)),l=_interopRequireDefault(i(25)),d=_interopRequireDefault(i(60)),c=_interopRequireDefault(i(549)),u=_interopRequireDefault(i(4));i(550);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var p=0,f=function(i){function TitleScreen(t){var e;return(e=i.call(this)||this).app=t,e.w=512,e.h=512,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(TitleScreen,i);var t=TitleScreen.prototype;return t.build=function(){var t=this;if(!this.bg){this.bg=new n.Sprite.from("background-title.jpg"),this.bg.anchor.set(.5),this.addChild(this.bg),this.defaultBgSize={width:this.bg.width,height:this.bg.height},this.collectiveContainer=new n.Container,this.addChild(this.collectiveContainer),this.titleLogoContainer=new n.Container,this.titleLogoContainer.scale.set(1.2),this.collectiveContainer.addChild(this.titleLogoContainer),this.corpContainer=new n.Container,this.collectiveContainer.addChild(this.corpContainer),this.corpContainer.pivot.set(.5,0),this.legoLogo=new n.Sprite.from("logo_lego.png"),this.legoLogo.anchor.set(.5,0),this.legoLogo.scale.set(.75),this.corpContainer.addChild(this.legoLogo),this.nickLogo=new n.Sprite.from("logo_nickelodeon.png"),this.nickLogo.anchor.set(.5,0),this.corpContainer.addChild(this.nickLogo),p=this.corpContainer.height,this.characters=new n.Sprite.from("characters.png"),this.characters.anchor.set(.5,1),this.collectiveContainer.addChild(this.characters),this.btnSettings=new r.default({base:"button_information.png"}),this.btnSettings.scale.set(.5),this.btnSettings.onTap=this.onBtnPlayTap.bind(this),this.bg.on("pointertap",function(){return t.btnSettings.onPointerTap()});var e=s.default.instance.isMobile?h.default.get("click_mobile"):h.default.get("click_desktop");this.btnClear=new r.default({base:"button_information.png"}),this.app.config.resetCookies&&this.addChild(this.btnClear),this.btnClear.scale.set(.5),this.btnClear.onTap=function(){o.default.resetCookie()},this.btnClear.x=50,this.btnClear.y=50,e+=" "+h.default.get("to_play"),this.startText=new a.default({text:e,fill:16699720,dropShadow:!0,dropShadowDistance:5,dropShadowBlur:5,dropShadowAngle:.7*Math.PI,padding:10}),this.characters.addChild(this.startText),this.startText.y-=.25*this.characters.height,this.defaultContainerSize={width:this.collectiveContainer.width,height:this.collectiveContainer.height},this.defaultCharacterSize={width:this.characters.width,height:this.characters.height},this.animation=new c.default,this.animation.build(),this.titleLogoContainer.addChild(this.animation),this.legoLogo.x=.5*this.titleLogoContainer.width-1.5*this.legoLogo.width,this.nickLogo.x=-.5*this.titleLogoContainer.width+this.nickLogo.width,this.corpContainer.y=-.5*this.titleLogoContainer.height-p,this.resize()}},t.onShow=function(){var t=this;this.build(),this.resize(),this._animateIn(),this.bg.interactive=!0,this.btnSettings.visible=!0,l.default.playMusic("lego-theme-music"),d.default.instance.add(this.update,this),this.legoLogo.alpha=0,this.nickLogo.alpha=0,setTimeout(function(){t.animation.animateIn(function(){u.default.to(t.legoLogo,.25,{alpha:1}),u.default.to(t.nickLogo,.25,{alpha:1})})},500)},t.update=function(){this.animation.update()},t.onHide=function(){this.bg.interactive=!1,d.default.instance.remove(this.update,this)},t.resize=function(t,e){if(t=this.w=t||this.w,e=this.h=e||this.h,this.bg){var i=e/20;this.corpContainer.x=.5*t,this.corpContainer.y=i,this.corpContainer.scale.set(1);var n=e/10/this.corpContainer.height;this.corpContainer.scale.set(n),this.titleLogoContainer.x=.5*t,this.titleLogoContainer.y=i+.34*e,this.titleLogoContainer.scale.set(1);var r=e/3/this.titleLogoContainer.height;this.titleLogoContainer.scale.set(r),this.characters.y=e,this.characters.x=.5*t,this.characters.scale.set(1);var a=e/2/this.characters.height;this.characters.scale.set(a),this.btnSettings.x=t-this.btnSettings.width,this.btnSettings.y=50+.5*this.btnSettings.height,this.bg.x=.5*t,this.bg.y=.5*e;var s=Math.max(this.h/this.defaultBgSize.height,this.w/this.defaultBgSize.width);this.bg.scale.set(s)}},t.onBtnPlayTap=function(){this.bg.interactive=!1,this.btnSettings.visible=!1,this.app.goToGame(),s.default.instance.android&&(document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen())},t._animateIn=function(){},TitleScreen}(n.Container);e.default=f},549:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),s=(n=i(4))&&n.__esModule?n:{default:n},o=i(7);var r=function(e){function TitleAnimation(){var t;return(t=e.call(this)||this).container=new a.Container,t.addChild(t.container),t.startShake=!1,t.shakeIntensity=5,t.shakeTimer=2.25,t.scale.set(.6),t.pieces=[],t.originHeight=0,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(TitleAnimation,e);var t=TitleAnimation.prototype;return t.build=function(){this.container.addChild(this.createSprite("title_build.png","buildSprite",{x:1,y:-1},{x:.5,y:1})),this.container.addChild(this.createSprite("title_protect.png","protectSprite",{x:1,y:1},{x:.5,y:0})),this.andSprite=a.Sprite.from("title_and.png"),this.container.addChild(this.andSprite),this.andSprite.anchor.set(.5,.9),this.leftBadge=a.Sprite.from("title_fire.png"),this.container.addChildAt(this.leftBadge,0),this.leftBadge.x=-.5*this.container.width+.2*this.leftBadge.width,this.leftBadge.y=.5*this.leftBadge.height,this.leftBadge.anchor.set(1,.5),this.rightBadge=a.Sprite.from("title_police.png"),this.container.addChildAt(this.rightBadge,0),this.rightBadge.x=.5*this.container.width-.81*this.leftBadge.width,this.rightBadge.y=this.leftBadge.y,this.rightBadge.anchor.set(0,.5),this.originHeight=this.height,this.andSprite.alpha=0,this.leftBadge.alpha=0,this.rightBadge.alpha=0},t.createSprite=function(t,e,i,n){var r=a.Sprite.from(t);return r.anchor.set(n.x,n.y),r.startY=r.height*i.y,r.alpha=0,this[e]=r,this.pieces.push(r),r},t.animateIn=function(i){for(var n=this,r=function(){s.default.to(n.andSprite,.5,{alpha:1,ease:o.Back.easeIn,onComplete:function(){!function(){var t=s.default.from(n.rightBadge,.5,{x:n.rightBadge.x+200,onUpdate:function(){n.rightBadge.alpha=t.progress()}}),e=s.default.from(n.leftBadge,.5,{x:n.leftBadge.x-200,onUpdate:function(){n.leftBadge.alpha=e.progress()},onComplete:function(){i instanceof Function&&i()}})}()}})},t=function(t){var e=n.pieces[t],i=s.default.from(e,.5,{y:e.startY,delay:.5*t,ease:o.Back.easeIn,onComplete:function(){n.shake(),t===n.pieces.length-1&&r()},onUpdate:function(){e.alpha=i.progress()}})},e=0;e<this.pieces.length;e++)t(e)},t.shake=function(){this.startShake=!0,this.shakeTimer=.25},t.update=function(){this.startShake&&(this.container.x=Math.random()*this.shakeIntensity,this.container.y=Math.random()*this.shakeIntensity,0<this.shakeTimer?this.shakeTimer-=1/60:this.startShake=!1)},t.show=function(t){},t.hide=function(t){},TitleAnimation}(a.Container);e.default=r},55:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=new(function(){function Colours(){this.colourList=[{name:"RED",color:15340630,district:1},{name:"ORANGE",color:16752910,district:2},{name:"YELLOW",color:16766748,district:3},{name:"GREEN",color:8249362,district:4},{name:"BLUE",color:2328567,district:5},{name:"PURPLE",color:12262099,district:6}]}var t=Colours.prototype;return t.getColorByDistrict=function(t){for(var e=0;e<this.colourList.length;e++){var i=this.colourList[e];if(i.district===t)return i.color}return 16777215},t.getColorByName=function(t){for(var e=0;e<this.colourList.length;e++){var i=this.colourList[e];if(i.name===t.toUpperCase())return i.color}return 16777215},Colours}());e.default=n},61:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var d=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(10)),r=i(7),a=_interopRequireDefault(i(25));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=new(function(){function CharacterPanel(){this.visibleTimer=this.defaultVisibleTimer=.1,this.flickerIndex=0,this.maxFlickerIndex=1,this.flicker=!1,this.isShown=!1,this.shownTimer=this.defaultShownTimer=3,this.ignoreMessageTimer=this.defaultIgnoreMessageTimer=60,this.countDown=!1,this.messageList=[],this.ignoreMessage=[],this.characterTextures={mayor:"mayor.png",fireChief:"fire_chief_freya_mccloud.png",fireFighter:"fire_fighter_clemmons.png",policeLieutenant:"lieutenant_duke_detain.png",policeRookie:"rooky_partnur.png",policeSegeant:"sergeant_sam_grizzled.png",shirley:"shirley_keeper.png"}}var t=CharacterPanel.prototype;return t.build=function(){this.backupData={character:d.Texture.from(this.characterTextures.mayor),name:"Default Man",dialogue:"Default Man is saying a lot of things right now"},this.container=new d.Container,this.container.visible=!1,this.background=new d.Sprite.from("character_text_box.png"),this.background.anchor.set(0,.5),this.background.x-=.5*this.background.width,this.container.addChild(this.background),this.characterBack=new d.Sprite.from("character_square.png"),this.characterBack.anchor.set(.5),this.characterBack.x-=.5*this.background.width-.5*this.characterBack.width,this.container.addChild(this.characterBack),this.characterImage=new d.Sprite.from(d.Texture.WHITE),this.characterImage.anchor.set(.5),this.characterImage.scale.set(.5),this.characterBack.addChild(this.characterImage),this.dataContainer=new d.Container,this.background.addChild(this.dataContainer),this.midZoneWidth=this.background.width-this.characterBack.width,this.boxCenter=this.characterBack.x+.5*this.characterBack.width+.5*this.midZoneWidth;this.corners=new d.Sprite.from("corners.png"),this.corners.anchor.set(.5),this.corners.scale.set((this.corners.width-80)/this.corners.width),this.corners.y=3,this.dataContainer.addChild(this.corners),this.dataContainer.x=this.boxCenter+.5*this.background.width-2,this.dataContainer.y=this.background.y+.25*this.dataContainer.height+2,this.nameText=new n.default({text:"Bill Williams IV",fill:16777215,padding:10,fontSize:21,anchorX:0,anchorY:.5,x:this.corners.x-.5*this.corners.width,y:this.corners.y-.5*this.corners.height-28}),this.dataContainer.addChild(this.nameText),this.dialogueText=new n.default({text:"Default",fill:16777215,padding:10,fontSize:20,align:"center",wordWrap:!0,wordWrapWidth:1.1*this.corners.width}),this.corners.addChild(this.dialogueText),this.waitForAction=!1},t.animateIn=function(t,e){var i=this;this.isShown=!0,r.TweenLite.killTweensOf(this.background),r.TweenLite.killTweensOf(this.characterBack),this.container.visible=!0,this.dataContainer.visible=!1,this.characterBack.rotation=0;this.container.y=0,this.container.y=.5*this.h+this.container.height,this.background.scale.x=0,r.TweenLite.killTweensOf(this.characterBack),r.TweenLite.to(this.container,.75,{delay:t,y:.5*this.h-.75*this.container.height,ease:r.Back.easeOut,onComplete:function(){r.TweenLite.killTweensOf(i.background),r.TweenLite.to(i.background.scale,.3,{x:1,onComplete:function(){i.flicker=!0,i.dataContainer.visible=!0,i.countDown=!0,a.default.playSfx("comms-panel-text")}}),a.default.playSfx(e)}})},t.update=function(){if(this.flicker&&(0<this.visibleTimer?this.visibleTimer-=1/60:(this.visibleTimer=this.defaultVisibleTimer,this.dataContainer.visible=!this.dataContainer.visible,this.flickerIndex++,this.flickerIndex===this.maxFlickerIndex&&(this.flickerIndex=0,this.flicker=!1,this.dataContainer.visible=!0))),this.countDown&&!this.waitForAction&&(0<this.shownTimer?this.shownTimer-=1/60:(this.shownTimer=this.defaultShownTimer,this.laterMessages&&0<this.laterMessages.length?(this.updateMessage(this.nameText.text,this.laterMessages[0]),this.laterMessages.shift()):this.hide())),0<this.messageList.length&&!this.isShown){var t=this.messageList[0];this.show(t.name,t.dialogue,t.characterTex,t.waitForAction,t.delay),this.messageList.splice(0,1),this.shownTimer=this.defaultShownTimer}0<this.ignoreMessage.length&&(0<this.ignoreMessageTimer?this.ignoreMessageTimer-=1/60:(this.ignoreMessageTimer=this.defaultIgnoreMessageTimer,this.removeIgnoreMessage(this.ignoreMessage[0])))},t.hide=function(){var t=this;this.dataContainer.visible=!this.dataContainer.visible,this.countDown=!1,this.laterMessages=[],r.TweenLite.killTweensOf(this.background.scale);r.TweenLite.to(this.background.scale,.5,{x:0,ease:r.Back.easeIn}),r.TweenLite.killTweensOf(this.characterBack);var e=[{x:-5,y:this.container.y-20},{x:-10,y:this.container.y-40},{x:-40,y:this.container.y+150}];r.TweenMax.to(this.container,.5,{ease:r.Linear.easeNone,bezier:{values:e},delay:.5,onStart:function(){a.default.playSfx("comms-panel-out")},onComplete:function(){t.container.y=.5*t.h+t.container.height,t.container.x=0,t.isShown=!1}}),r.TweenLite.to(this.container,.4,{x:-150,ease:r.Power2.easeOut,delay:.5}),r.TweenLite.killTweensOf(this.characterBack),r.TweenLite.to(this.characterBack,1,{rotation:2*-Math.PI,ease:r.Back.easeOut,delay:.5})},t.resetPanel=function(t){void 0===t&&(t=!1),t&&(r.TweenLite.killTweensOf(this.background),r.TweenLite.killTweensOf(this.characterBack),r.TweenLite.killTweensOf(this.background.scale),r.TweenLite.killTweensOf(this.container)),this.characterBack.rotation=0,this.container.x=0,this.container.y=.5*this.h+this.container.height,this.background.scale.x=0,a.default.playSfx("comms-panel-out")},t.quickHide=function(){var t=this;this.countDown=!1,this.dataContainer.visible=!this.dataContainer.visible,this.laterMessages=[],r.TweenLite.to(this.container,.1,{y:.5*this.h+this.container.height,ease:r.Power0.easeOut,delay:.5,onComplete:function(){t.resetPanel(!0),t.isShown=!1}})},t.show=function(t,e,i,n,r,a,s){if(void 0===n&&(n=!1),void 0===r&&(r="nuetral"),void 0===a&&(a=0),void 0===s&&(s=!1),!this.ignoreMessage.includes(e)){if(this.isShown&&!n)return this.messageList.push({name:t,dialogue:e,characterTex:i,waitForAction:n,delay:a}),void(s&&(this.quickHide(),this.laterMessages=[]));if(this.isShown&&(n||s)&&(this.messageList.unshift({name:t,dialogue:e,characterTex:i,waitForAction:n,delay:a}),this.quickHide()),this.waitForAction=n,this.nameText.text=t||this.backupData.name,e instanceof Array){var o=e;this.dialogueText.text=o[0]||this.backupData.dialogue,o.shift(),this.laterMessages=o}else this.dialogueText.text=e||this.backupData.dialogue;var h;h=i?this.characterTextures[i]?d.Texture.from(this.characterTextures[i]):i instanceof d.Texture?i:d.Texture.from(i):this.backupData.character,this.characterImage.texture=h;var l=null;switch(r){case"happy":l="comms-panel-congratulations";break;case"sad":l="comms-panel-sad";break;case"nuetral":default:l="comms-panel-in"}this.animateIn(a,l)}},t.updateMessage=function(t,e){this.isShown&&(this.shownTimer=this.defaultShownTimer),this.countDown=!0,this.nameText.text=t||this.backupData.name,this.dialogueText.text=e||this.backupData.dialogue,this.nameText.alpha=0,this.dialogueText.alpha=0,r.TweenLite.to(this.nameText,.5,{alpha:1}),r.TweenLite.to(this.dialogueText,.5,{alpha:1}),this.flicker=!0,this.dataContainer.visible=!0,this.isShown=!0,a.default.playSfx("comms-panel-text")},t.addIgnoreMessage=function(t){this.ignoreMessage.includes(t)||this.ignoreMessage.push(t)},t.removeIgnoreMessage=function(t){this.ignoreMessage.splice(this.ignoreMessage.indexOf(t),1)},t.resize=function(t,e){this.w=t,this.h=e},CharacterPanel}());e.default=s},683:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var r=function(i){function GameScreen(t){var e;return(e=i.call(this)||this).app=t,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(GameScreen,i);var t=GameScreen.prototype;return t.build=function(){this.bg||(this.bg=new n.Graphics,this.bg.beginFill(51,1),this.bg.drawRect(0,0,16,16),this.bg.endFill(),this.addChild(this.bg))},t.onShow=function(){this.build(),this.app.game.init(),this.resize(),this.addChild(this.app.game.stage),this.app.game.beginSession(),this.app.btnSound.visible=!1},t.onHide=function(){},t.resize=function(t,e){t=this.w=t||this.w,e=this.h=e||this.h,this.bg&&(this.bg.width=t,this.bg.height=e,this.app.game.resize())},GameScreen}(n.Container);e.default=r},684:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=(n=i(117))&&n.__esModule?n:{default:n};var s=function(i){function LoadingScreen(t){var e;return(e=i.call(this)||this).app=t,e.w=512,e.h=512,e.color=e.app.color,e.view=new r.Container,e.addChild(e.view),e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(LoadingScreen,i);var t=LoadingScreen.prototype;return t.build=function(){this.bg||(this.bg=new a.default(this.color,1),this.addChildAt(this.bg,0),this.splash=r.Sprite.from(window.ASSET_URL+"app/splash.png?v=wtj5a4k3sr9wh5"),this.splash.anchor.set(.5),this.view.addChild(this.splash),this.buildBar(),this.resize())},t.buildBar=function(){if(!this.bar){this.bar=new r.Container,this.view.addChild(this.bar),this.bar.y=160;var t=300,e=30,i=new r.Graphics;i.beginFill(3355443,.75),i.drawRect(0,0,t,e),i.position.set(-t/2,-e/2),this.bar.addChild(i),this.bar.bg=i,t-=8,e-=8;var n=new r.Graphics;n.beginFill(15181588),n.drawRect(0,0,t,e),n.position.set(-t/2,-e/2),n.scale.x=.01,this.bar.addChild(n),this.bar.fill=n}},t.updateProgress=function(t){this.bar&&(this.bar.fill.scale.x=t/100)},t.resize=function(t,e){this.w=t||this.w,this.h=e||this.h,this.view.position.x=this.w/2,this.view.position.y=this.h/2,this.bg&&this.bg.resize(this.w,this.h)},t.onShow=function(){this.reset(),this._opened=!0},t.onHidden=function(){this.reset(),this._opened=!1},t.reset=function(){this.updateProgress(0)},t.showAsFullScreen=function(){this.splash&&(this.view.visible=!0,this.splash.visible=!0,this.bg.alpha=1,this.app.overlay.addChild(this))},t.showAsOverlay=function(){this.splash&&(this.view.visible=!0,this.splash.visible=!1,this.bg.alpha=.5,this.app.overlay.addChild(this))},t.hide=function(){this.view.visible=!1},LoadingScreen}(r.Container);e.default=s},686:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(23)),r=_interopRequireDefault(i(8));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var a=function(){function Size(t){var e=this;this.app=t,this.w=950,this.h=560,this.sw=950,this.sh=560,this.scale=1,this.onResize=new r.default,window.addEventListener("resize",function(){return e.update()}),window.addEventListener("orientationchange",function(){return e.update()}),this.update(),this.onResize.add(this.app.onResize,this.app)}var t=Size.prototype;return t.update=function(){window.scrollTo(0,0),this.w=window.innerWidth,this.h=window.innerHeight,90===Math.abs(window.orientation)&&n.default.instance.iPhone&&n.default.instance.safari&&(232===this.h&&(this.h=320),this.h++),this.scale=window.devicePixelRatio||1,n.default.instance.isMobile&&!window.devicePixelRatio&&(this.scale=window.screen.deviceXDPI/window.screen.logicalXDPI),2<this.scale&&(this.scale=2),this.sw=this.w*this.scale,this.sh=this.h*this.scale,this.onResize.dispatch(this)},t.requestFullScreen=function(){n.default.instance.android&&(document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen(),this.update())},t.add=function(t){if(!t.onResize)throw Error("Object does not have onResize function");this.onResize.add(t.onResize,t),t.onResize()},t.remove=function(t){this.onResize.remove(t.onResize,t)},Size}();e.default=a},687:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(8)),s=_interopRequireDefault(i(148));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function asyncGeneratorStep(t,e,i,n,r,a,s){try{var o=t[a](s),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(n,r)}var a=[{name:"preload",assets:["app","preload","device"]},{name:"title",assets:["blueprints","bricks","buildings","buttons","character_panel","data","dig_minigame","chars","dig_site","building_motion","event","font","inventory_overlay","reward_overlay","ribbon","particles","ui","models"]},{name:"game",assets:[]}],o=function(){function Resources(t,e){var i=this;this.app=t,this.config=e||a,this.level=-1,this.levelLoading=-1,this.app.resourceManager.getLoader=function(){var e=new n.Loader;return this.middlewaresPre.forEach(function(t){return e.pre(t())}),this.middlewares.forEach(function(t){return e.use(t())}),e},this.onLoadStart=new r.default,this.onLoadProgress=new r.default,this.onLoadComplete=new r.default,this.app.onLoadStart&&this.onLoadStart.add(this.app.onLoadStart,this.app),this.app.onLoadComplete&&this.onLoadComplete.add(this.app.onLoadComplete,this.app),this.app.onLoadProgress&&this.onLoadProgress.add(this.app.onLoadProgress,this.app),s.default.onProgress.add(function(t){return i.onLoadProgress.dispatch(t/100)},this)}var t=Resources.prototype;return t.load=function(){var e=function(a){return function(){var t=this,r=arguments;return new Promise(function(e,i){var n=a.apply(t,r);function _next(t){asyncGeneratorStep(n,e,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(n,e,i,_next,_throw,"throw",t)}_next(void 0)})}}(regeneratorRuntime.mark(function _callee(e){var i,n,r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((i=this.getLevel(e))<=this.levelLoading)return t.abrupt("return");t.next=3;break;case 3:if(-1==i)throw new Error("Invalid level ref: "+e);t.next=5;break;case 5:for(this.levelLoading=i,this.onLoadStart.dispatch(this.config[i].name,i),n=[],r=0;r<=i;r++)a=this.config[r],n=n.concat(a.assets);return t.next=11,s.default.load(n);case 11:return t.next=13,this.timeout(50);case 13:this.level=i,this.levelLoading=-1,this.onLoadComplete.dispatch(this.config[i].name,i);case 16:case"end":return t.stop()}},_callee,this)}));return function(t){return e.apply(this,arguments)}}(),t.getLevel=function(t){switch(typeof t){case"number":return t;case"string":return this.levelByName(t);default:return this.config.indexOf(t)}},t.levelByName=function(t){return this.config.map(function(t){return t.name}).indexOf(t)},t.groupByName=function(t){var e=this.levelByName(t);return this.config[e]},t.isLoaded=function(t){return this.getLevel(t)<=this.level},t.isLoading=function(t){var e=this.getLevel(t);return this.levelLoading===e},t.timeout=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.find=function(t){var e=this.app.resourceManager.resources;for(var i in e)if(i.match(t))return e[i];return null},Resources}();e.default=o},688:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(689)),r=_interopRequireDefault(i(8));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var a=function(){function Events(t){var e=this;this.app=t,this.onBlur=new r.default,this.onFocus=new r.default,this.app.onBlur&&this.onBlur.add(this.app.onBlur,this.app),this.app.onFocus&&this.onFocus.add(this.app.onFocus,this.app),n.default.onShow.add(function(){return e.onFocus.dispatch()}),n.default.onHide.add(function(){return e.onBlur.dispatch()}),window.addEventListener("blur",function(){return e.onBlur.dispatch()}),window.addEventListener("focus",function(){return e.onFocus.dispatch()}),window.addEventListener("pagehide",function(){return e.onBlur.dispatch()}),window.addEventListener("pageshow",function(){return e.onFocus.dispatch()}),window.addEventListener("gesturestart",this._onEventPreventDefault.bind(this)),window.addEventListener("gesturechange",this._onEventPreventDefault.bind(this)),window.addEventListener("gestureend",this._onEventPreventDefault.bind(this)),window.addEventListener("touchmove",this._onEventPreventDefault.bind(this))}return Events.prototype._onEventPreventDefault=function(t){t.preventDefault()},Events}();e.default=a},690:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function Browser(){}return Browser.getUrlParams=function(){var t=location.search,e={},i=t.slice(t.indexOf("?")+1).split("&"),n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var a;if(n){if(r>=i.length)break;a=i[r++]}else{if((r=i.next()).done)break;a=r.value}var s=a.split("="),o=s[0],h=s[1];void 0!==h&&("true"!==h&&"false"!==h||(h="true"===h),e[o]="string"==typeof h&&h.match(/^[-.0-9]+$/)?parseFloat(h):h)}return e},Browser.getUrlParam=function(t,e){var i=this.getUrlParams();return void 0!==i[t]?i[t]:e},Browser}();e.default=n},691:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(262)),r=_interopRequireDefault(i(8)),a=_interopRequireDefault(i(692));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(){function Store(t,e,i){void 0===i&&(i=!1),this.id=t,this.autosave=i,this.original=e,this.cache=a.default.flat(e),this.data=a.default.flat(e),this.storage=new n.default(t),this.onChange=new r.default,this._changes={},this.load()}var t=Store.prototype;return t.get=function(t){return this.data[t]},t.set=function(t,e){"object"==typeof e?Object.assign(this.data,a.default.flat(e)):this.data[t]=e;var i=this.update();this.autosave&&i&&this.save()},t.toggle=function(t){this.set(t,!this.data[t])},t.update=function(){var t=!1;for(var e in this.data)if(this.cache[e]!==this.data[e]){var i=this.cache[e],n=this.data[e];this._lastChange={field:e,from:i,to:n},this._changes[e]={from:i,to:n},this.onChange.dispatch(e,n,i),this.cache[e]=this.data[e],t=!0}return t},t.keys=function(){return Object.keys(this.data)},t.load=function(){var t=this.storage.getObject(this.id);t&&(Object.assign(this.data,t),this.update())},t.save=function(){this.storage.storeObject(this.id,this.data)},t.lastChange=function(t){return this._changes[t]||null},t.reset=function(){this.cache=a.default.flat(this.original),this.data=a.default.flat(this.original)},Store}();e.default=s},692:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function Obj(){}return Obj.diff=function(t,e){var i={},n={};for(var r in t)n[r]=1;for(var a in e)n[a]=1;for(var s in n){var o=t[s],h=e[s];if(o!==h){var l=typeof o,d=typeof h;i[s]="object"==l&&"object"==d?this.diff(o,h):{a:o,b:h}}}return i},Obj.flat=function(t,e,i){for(var n in void 0===e&&(e=""),void 0===i&&(i={}),t){var r=t[n],a=e?e+"."+n:n;"object"==typeof r?this.flat(r,a,i):i[a]=t[n]}return i},Obj.unflat=function(t){var e={};for(var i in t)for(var n=i.split("."),r=e,a=0;a<n.length;a++){var s=a===n.length-1;r[n[a]]=s?t[i]:r[n[a]]||{},r=r[n[a]]}return e},Obj.flatDiff=function(t,e){var i=this.flat(t),n=this.flat(e);return this.diff(i,n)},Obj.isEmpty=function(t){for(var e in t)return!1;return!0},Obj}();e.default=n},693:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function SDK(t){this.app=t,nick_sdk_client.SDK.initialize()}var t=SDK.prototype;return t.sendGameEvent=function(t,e){nick_sdk_client.GameEventEmitter.sendGameEvent(nick_sdk_client.GameEventEmitter[t],e)},t.sendCustomEvent=function(t,e){nick_sdk_client.GameEventEmitter.sendGameEvent(nick_sdk_client.GameEventEmitter.ON_LEVEL_COMPLETE,e)},SDK}();e.default=n},694:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(60)),r=_interopRequireDefault(i(695)),a=_interopRequireDefault(i(696)),s=_interopRequireDefault(i(697)),o=_interopRequireDefault(i(698)),h=_interopRequireDefault(i(699)),l=_interopRequireDefault(i(700)),d=_interopRequireDefault(i(707)),c=_interopRequireDefault(i(708)),u=_interopRequireDefault(i(717)),p=_interopRequireDefault(i(726)),f=_interopRequireDefault(i(733)),g=_interopRequireDefault(i(740)),m=_interopRequireDefault(i(744)),v=_interopRequireDefault(i(41)),b=_interopRequireDefault(i(168)),y=_interopRequireDefault(i(61)),w=_interopRequireDefault(i(77)),_=_interopRequireDefault(i(745)),C=_interopRequireDefault(i(746)),x=_interopRequireDefault(i(25)),k=_interopRequireDefault(i(758)),S=_interopRequireDefault(i(759)),P=_interopRequireDefault(i(760));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var D=function(i){function Game(t){var e;return(e=i.call(this)||this).app=t,e.currentDistrict=1,e.w=1e3,e.h=640,e.running=!1,e.debug=e.app.config.debug,e.noHowTo=!1,window.addEventListener("error",function(t){return e.crash(t.error.message)}),e.addSystem(d.default,{}),e.register("onDig"),e.signals.onDig.add(e.onDig,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)),e.digCost=500,e.possibleEvents=["fire","crime"],e.nextEvent=e.randomEvent(),v.default.getCookie("events")||(e.events={fire:!1,crime:!1},v.default.createCookie("events",e.events)),e.currentEvent={type:"none",sound:null,backup:null},e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Game,i);var t=Game.prototype;return t.setNextEvent=function(t){this.nextEvent=t&&this.possibleEvents.includes(t)?t:this.randomEvent();for(var e=0;e<this.possibleEvents.length;e++){this[this.possibleEvents[e]].isNextEvent=!1}this[this.nextEvent].isNextEvent=!0},t.randomEvent=function(){return this.possibleEvents[Math.floor(Math.random()*this.possibleEvents.length)]},t.onDig=function(t){var e=t&&t.buildingData?t.buildingData.districtIndex:null,i=t&&t.buildingData?t.buildingData.requirementPieces:[];this.dig.show({district:e,requirementPieces:i})},t.pauseEvent=function(){this.fire.isPause=!0,this.crime.isPause=!0},t.resumeEvent=function(){this.fire.isPause=!1,this.crime.isPause=!1},t.init=function(){this.view||(this.addSystem(h.default,{}),this.addSystem(a.default,{}),this.addSystem(s.default,{}),this.addSystem(u.default,{}),this.addSystem(o.default,{}),this.addSystem(p.default,{}),this.addSystem(f.default,{}),this.addSystem(g.default,{}),this.addSystem(_.default,{}),this.addSystem(c.default,{}),this.addSystem(l.default,{}),this.addSystem(m.default,{}),this.addSystem(b.default,{}),this.addSystem(C.default,{}),this.addSystem(k.default,{}),this.addSystem(S.default,{}),this.addSystem(P.default,{}),this.resize(),this.state.signals.onStateChange.add(this.onStateChange,this),this.fire.signals.start.add(this.onEventStart,this),this.fire.signals.end.add(this.onEventEnd,this),this.fire.signals.failedStart.add(this.onEventFailed,this),this.crime.signals.start.add(this.onEventStart,this),this.crime.signals.end.add(this.onEventEnd,this),this.crime.signals.failedStart.add(this.onEventFailed,this))},t.onSpend=function(t){w.default.showUserCoins(t),this.hud.updateCoins(this.inventory.inventory.userCoins)},t.onEarn=function(t,e){void 0===e&&(e=!1),w.default.showUserCoins(t),this.hud.updateCoins(this.inventory.inventory.userCoins),e||x.default.playSfx("money-riser",{volume:.2})},t.spawn=function(t,e){void 0===e&&(e={});var i=this.pool.get(t,e);return this.addToGame(i),i},t.vanish=function(t){this.removeFromGame(t),this.pool.return(t)},t.crash=function(){this.running=!1,n.default.instance.stop();for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];throw new Error("CRASH! "+e.join(" "))},t.update=function(t){this.running&&(i.prototype.update.call(this,t),this.app.btnSound.visible=!1,y.default.update(),this.hud.update(),this.grid&&(this.camera.isMoving()||this.drag.isMoving)&&this.culling.checkCulling(this.camera.isMoving()||!this.changingDistrict||this.drag.isMoving))},t.resize=function(){var t=this.app.size,e=t.h/(640*t.scale);t.w,t.s,t.h,t.s;this.view.stage.x=t.w/2,this.view.stage.y=t.h/2,this.view.stage.scale.set(e*t.scale),this.w=t.w/(t.h/640),this.h=640,i.prototype.resize.call(this,this.w,this.h),y.default.resize(this.w,this.h)},t.beginSession=function(){this.run()},t.run=function(){var e=this;this.running||(this.grid.build(),this.inventory.build(),this.inventory.inventory.signals.coinsEarned.add(this.onEarn,this),this.inventory.inventory.signals.coinsSpent.add(this.onSpend,this),this.buildings.build(),this.hud.open(),this.hud.updateCoins(this.inventory.inventory.userCoins),this.dig.build(),this.fire.build(),this.crime.build(),this.drag.build(),this.traffic.build(),this.endGame.build(),this.drag.signals.dragStart.add(this.onDragStart,this),this.drag.signals.dragEnd.add(this.onDragEnd,this),this.grid.updateLockedZones(),w.default.build(),this.view.notification.addChild(w.default.container),y.default.build(),this.view.notification.addChild(y.default.container),this.app.btnSound.visible=!1,this.resize(),n.default.instance.add(this.update,this,1),this.running=!0,this.setNextEvent(),this.checkClosestDistrict(),this.culling.setup({zones:this.grid.allZones,cars:this.traffic.allCars,dressing:this.grid.gridDressing.dressingList}),this.culling.checkCulling(!0,30,!0),this.onboard.build(),w.default.signals.show.add(function(){w.default.showUserCoins(e.inventory.inventory.userCoins),e.state.setState("menu"),w.default.signals.end.add(function(){e.state.setState("game")})}),w.default.signals.reward.add(function(t){e.inventory.inventory.earnCoins(t)}),x.default.playMusic("music_loop_01"),5<this.grid.checkBuildingAmount()&&this.onboard.onboardCollectAll())},t.pause=function(){this.running=!1,this.pauseEvent(),this.state.setState("menu")},t.resume=function(){this.running=!0,this.resumeEvent(),this.state.setState("game")},t.blur=function(){this.drag&&this.drag.resetTouchId()},t.muteToggle=function(t){x.default.systemMute(t)},t.quit=function(){this.idle(),this.room.close(),this.house.close(),this.hud.close(),this.app.screenManager.gotoScreenByID("title"),this.app.overlay.visible=!0},t.onStateChange=function(t,e){},t.onEventStart=function(t){for(var e=this.grid.allTiles,i=0;i<e.length;i++){var n=e[i];n.hadCoin=n.coinSprite.visible,n.coinSprite.visible=!1,n.eventBystander=!0,n.buildingTimer&&n.buildingTimer.visible&&n.buildingTimer.temporaryHide(),n.revenueTimer&&n.revenueTimer.visible&&n.revenueTimer.temporaryHide()}this.currentEvent.type=t,this.currentEvent.sound&&(this.currentEvent.backup=x.default.playSfx("alarm-"+t,{loops:10})),this.currentEvent.sound=x.default.playSfx("alarm-"+t,{loops:10}),this.culling.eventState(!0)},t.onEventEnd=function(t){this.camera.forceZoom(10);for(var e=this.grid.allTiles,i=0;i<e.length;i++){var n=e[i];n.eventBystander=!1,n.coinSprite.visible=n.hadCoin,delete n.hadCoin,n.buildingTimer&&n.buildingTimer.tempHide&&n.buildingTimer.show(),n.revenueTimer&&n.revenueTimer.tempHide&&n.revenueTimer.show()}var r=this.currentEvent.backup?this.currentEvent.backup:this.currentEvent.sound;this.dealWithSound(r),this.currentEvent.type="none",this.culling.eventState(!1),this.setNextEvent()},t.dealWithSound=function(t,e){var i=t;this.currentEvent[e?"backup":"sound"]=null,i.looped.connect(function(){i&&(i.stop(),i.looped.disconnect())})},t.onEventFailed=function(t){this.setNextEvent()},t.unlockNextDistrict=function(){var t=this;this.inventory.inventory.availableZones>=this.grid.orderEnabled.length||(this.inventory.inventory.availableZones++,this.grid.centerCameraByZoneID(this.grid.orderEnabled[this.inventory.inventory.availableZones-1]),this.hud.hide(),this.inventory.inventory.saveAvailableZones(),this.hud.ribbon.show(this.inventory.inventory.availableZones,function(){t.grid.updateLockedZones(),t.inventory.inventory.unlockNextDistrict(),t.checkClosestDistrict(),t.hud.show(),t.traffic.addTrafficOnZone(t.inventory.inventory.availableZones),t.culling.addCars(t.traffic.allCars)}))},t.triggerEndGame=function(){this.endGame.endGameReached()},t.onDragStart=function(){},t.onDragEnd=function(){this.checkClosestDistrict(),this.culling.checkCulling()},t.checkClosestDistrict=function(){var t=this.grid.getClosestDistrict();this.currentDistrict=t.index,this.hud.updateCurrentDistrict(this.grid.getZoneOrder(this.currentDistrict)),this.checkDistrictSupport()},t.checkDistrictSupport=function(t,e){var i=this.grid.getClosestDistrict(),n=null;t||(n=e||this.grid.districtHasBuilding(i.index,"Police Station",!0));var r=null;e||(r=t||this.grid.districtHasBuilding(i.index,"Fire Station",!0)),this.hud.supportIndicator.hasSupport(r,n,i.district.locked)},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(Game,[{key:"stage",get:function(){return this.view.stage}}]),Game}(r.default);(e.default=D).IDLE=0,D.RUNNING=1,D.PAUSED=2,D.GAMEOVER=3,D.CRASHED=4},698:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),s=_interopRequireDefault(i(25)),o=_interopRequireDefault(i(18));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var r=function(r){function CameraSystem(t,e){var i;void 0===e&&(e={}),(i=r.call(this,t,e)||this).camera={x:0,y:0},i.currentZoom=1,i.graphics=new a.Graphics;var n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";return document.attachEvent?document.attachEvent("on"+n,i.onWheelManager.bind(_assertThisInitialized(i))):document.addEventListener&&document.addEventListener(n,i.onWheelManager.bind(_assertThisInitialized(i)),!1),i.locked=!1,i.scrollWheelByStep=!0,i.disableWheel=!0,i.maxZoom=1.6,i.minZoom=.75,i.steps=[i.minZoom,1,i.maxZoom],i.currentRoomStep=1,i.targetZoom=i.steps[1],i.signals={zoomIn:new o.default,zoomOut:new o.default},i.startCheck=!1,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(CameraSystem,r);var t=CameraSystem.prototype;return t.onWheelManager=function(t){if(!this.locked&&!this.disableWheel&&"GAME"===this.game.state.currentState.toUpperCase()){var e=window.event||t,i=(e.detail?e.detail:e.wheelDelta)/120/8;this.scrollWheelByStep?0<i?this.zoomIn():this.zoomOut():(this.targetZoom+=Math.min(i,.1),this.targetZoom=Math.min(this.targetZoom,this.maxZoom),this.targetZoom=Math.max(this.targetZoom,this.minZoom))}},t.zoomOut=function(){this.currentRoomStep--,this.signals.zoomOut.dispatch(this.currentRoomStep<0);var t=this.currentRoomStep<0?"button-zoom-na":"button-zoom-out";this.currentRoomStep=Math.max(this.currentRoomStep,0),this.targetZoom=this.steps[this.currentRoomStep],this.targetZoom=Math.min(this.targetZoom,this.maxZoom),this.targetZoom=Math.max(this.targetZoom,this.minZoom),s.default.playSfx(t)},t.isMax=function(){return 0===this.currentRoomStep},t.inMin=function(){return this.currentRoomStep===this.steps.length-1},t.dist=function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},t.zoomIn=function(){this.currentRoomStep++;var t=this.currentRoomStep>this.steps.length-1?"button-zoom-na":"button-zoom-in";this.currentRoomStep=Math.min(this.currentRoomStep,this.steps.length-1),this.targetZoom=this.steps[this.currentRoomStep],this.targetZoom=Math.min(this.targetZoom,this.maxZoom),this.targetZoom=Math.max(this.targetZoom,this.minZoom),s.default.playSfx(t),this.signals.zoomIn.dispatch(this.currentRoomStep>this.steps.length-1)},t.isMoving=function(){var t=5<this.dist(this.camera.x,this.camera.y,this.game.view.container.pivot.x,this.game.view.container.pivot.y),e=.01<this.dist(this.targetZoom,0,this.currentZoom,0);return t||e},t.forceZoom=function(t){this.currentRoomStep=t,this.currentRoomStep=Math.min(this.currentRoomStep,this.steps.length-1),this.targetZoom=this.steps[this.currentRoomStep],this.targetZoom=Math.min(this.targetZoom,this.maxZoom),this.targetZoom=Math.max(this.targetZoom,this.minZoom)},t.lock=function(){this.locked=!0},t.unlock=function(){this.locked=!1},t.postupdate=function(){var t=this.game.view.container;this.game.drag.isMoving||this.game.drag.isMouseDown?(t.pivot.x=this.camera.x,t.pivot.y=this.camera.y):(t.pivot.x=this.lerp(this.camera.x,t.pivot.x,.9),t.pivot.y=this.lerp(this.camera.y,t.pivot.y,.9)),this.currentZoom=this.lerp(this.targetZoom,this.currentZoom,.9),t.scale.set(this.currentZoom),this.game.grid.updateUIZoom(this.currentZoom)},t.checkNearPosition=function(t){if(void 0===t&&(t=1),!this.startCheck)return!1;var e=this.game.view.container.pivot.x,i=this.game.view.container.pivot.y,n=this.camera.x,r=this.camera.y;return Math.sqrt(Math.pow(e-n,2)+Math.pow(i-r,2))<t&&(this.startCheck=!1,this.game.checkClosestDistrict(),!0)},t.setPosition=function(t,e){this.camera.x=t,this.camera.y=e,this.game.drag.reset(),this.startCheck=!0},t.forcePosition=function(t,e){this.camera.x=t,this.camera.y=e,this.game.view.container.pivot.x=t,this.game.view.container.pivot.y=e,this.game.drag.reset(),this.startCheck=!1},t.lerp=function(t,e,i){return t*(1-i)+e*i},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(CameraSystem,[{key:"x",get:function(){return this.camera.x},set:function(t){this.camera.x=t}},{key:"y",get:function(){return this.camera.y},set:function(t){this.camera.y=t}}]),CameraSystem}(n.default);e.default=r},699:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var a=function(n){function ViewSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).removeDuringEvent=[],i.stage=new r.Container,i.background=new r.Container,i.stage.addChild(i.background),i.removeDuringEvent.push(i.background),i.container=new r.Container,i.stage.addChild(i.container),i.removeDuringEvent.push(i.container),i.dragContainer=new r.Container,i.stage.addChild(i.dragContainer),i.removeDuringEvent.push(i.dragContainer),i.ui=new r.Container,i.stage.addChild(i.ui),i.removeDuringEvent.push(i.ui),i.digContainer=new r.Container,i.stage.addChild(i.digContainer),i.overlay=new r.Container,i.stage.addChild(i.overlay),i.removeDuringEvent.push(i.overlay),i.transition=new r.Container,i.stage.addChild(i.transition),i.removeDuringEvent.push(i.transition),i.notification=new r.Container,i.stage.addChild(i.notification),i.topMenu=new r.Container,i.stage.addChild(i.topMenu),i.removeDuringEvent.push(i.topMenu),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(ViewSystem,n);var t=ViewSystem.prototype;return t.onDigStart=function(){for(var t=0;t<this.removeDuringEvent.length;t++){var e=this.removeDuringEvent[t];e.previousVisibleState=e.visible,e.visible=!1}},t.onDigEnd=function(){for(var t=0;t<this.removeDuringEvent.length;t++){var e=this.removeDuringEvent[t];e.visible=e.previousVisibleState}},ViewSystem}(((n=i(17))&&n.__esModule?n:{default:n}).default);e.default=a},700:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var l=_interopRequireWildcard(i(1)),n=_interopRequireDefault(i(17)),r=_interopRequireDefault(i(29)),a=_interopRequireDefault(i(701)),d=_interopRequireWildcard(i(4)),c=i(7),s=_interopRequireDefault(i(73)),o=_interopRequireDefault(i(10)),h=_interopRequireDefault(i(702)),u=_interopRequireDefault(i(703)),p=_interopRequireDefault(i(44)),f=_interopRequireDefault(i(704)),g=_interopRequireDefault(i(706));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}var m=85,v=function(n){function HudSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.view=new l.Container,i.inEvent=!1,i.eventReturnExceptions=[],i.labelPool=[],i.canCollectAll=!1,i.coinsToCollect=0,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(HudSystem,n);var t=HudSystem.prototype;return t.build=function(){var i=this;if(!this.built){this.built=!0,this.blocker=(new l.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),this.view.addChild(this.blocker),this.blocker.alpha=.5,this.blocker.visible=!1,this.eventReturnExceptions.push(this.blocker),this.buttonsSize=65,this.btnZoomIn=new r.default({base:"button_district_up.png",icon:"zoom_in.png"}),this.view.addChild(this.btnZoomIn),this.btnZoomIn.onTap=this.onZoomIn.bind(this),this.btnZoomIn.scale.set(this.buttonsSize/this.btnZoomIn.height),this.btnZoomIn.icon.scale.set(.4),this.btnZoomOut=new r.default({base:"button_district_up.png",icon:"zoom_out.png"}),this.view.addChild(this.btnZoomOut),this.btnZoomOut.onTap=this.onZoomOut.bind(this),this.btnZoomOut.scale.set(this.buttonsSize/this.btnZoomOut.height),this.btnZoomOut.icon.scale.set(.4),this.btnInventory=new r.default({base:"button_district_up.png",icon:"icon_inventory.png"}),this.view.addChild(this.btnInventory),this.btnInventory.scale.set(this.buttonsSize/this.btnInventory.height),this.btnInventory.onTap=this.onInventory.bind(this),this.coinCountSprite=new l.Sprite.from("bar_money.png"),this.coinCountSprite.anchor.set(.5),this.coinCountSprite.scale.set(1.2),this.coinCountSprite.interactive=!0,this.view.addChild(this.coinCountSprite),this.coinCountSprite.buttonMode=!0,this.coinCountSprite.pointertap=function(){i.collectAll(),i.collectAllIndicator.sin=0,(p.default.getDebug("debugMode")||i.game.app.config.freeBricksOnCollectAll)&&i.game.inventory.inventory.addPiecesCheat()},m=1.25*this.coinCountSprite.width,this.collectAllIndicator=new l.Sprite.from("bar_money_collect_all.png"),this.collectAllIndicator.anchor.set(.5),this.collectAllIndicator.scale.set(.5),this.collectAllIndicator.x=-.5*this.coinCountSprite.width+2.1*this.collectAllIndicator.width,this.collectAllIndicator.y=-.5*this.collectAllIndicator.width,this.collectAllIndicator.visible=!1,this.coinCountSprite.addChild(this.collectAllIndicator),this.btnPause=new r.default({base:"button_district_up.png",icon:"icon_pause_down.png"}),this.view.addChild(this.btnPause),this.btnPause.scale.set(this.buttonsSize/this.btnPause.height);var t=this.createCoinCountLabel("btnInventory","x 05000",null,2*this.coinCountSprite.width-50);t.scale.set(.42),t.x=-t.width/2-2,t.y=-t.height/2-2,this.coinCountSprite.addChild(t),this.btnDig=new r.default({base:"button_dig.png",downDepth:5}),this.view.addChild(this.btnDig),this.btnDig.scale.set(this.buttonsSize/this.btnDig.height*2),this.btnDig.onTap=this.onDig.bind(this);var e=this.createCoinCountLabel("btnDig","500","icon_dig.png",2*this.btnDig.base.width-50);e.scale.set(.5),e.x=-e.width/2-3,e.y=-e.height/2+25,this.btnDig.buttonContainer.addChild(e),this.btnDig.text.text="65",this.decisionPrompt=new a.default(this.game),this.eventReturnExceptions.push(this.decisionPrompt),this.view.addChild(this.decisionPrompt),this.decisionPrompt.hide(!0),this.decisionPrompt.onCancel.add(function(t){i.closePrompt()}),this.decisionPrompt.onDestroy.add(function(t){i.closePrompt(),i.game.buildings.destroyCurrentBuilding(),t.hide()}),this.decisionPrompt.onFastBuilding.add(function(t){i.closePrompt(),i.game.inventory.inventory.userCoins-=t.currentTile.placedBuildingData.getFastbuildPrice(),i.game.inventory.inventory.saveCoins(),i.updateCoins(i.game.inventory.inventory.userCoins),t.currentTile.dofastBuilding(),i.game.inventory.inventory.saveFastBuilding(t.currentTile),t.hide()}),this.supportIndicator=new h.default,this.supportIndicator.build(),this.view.addChild(this.supportIndicator),this.districtDropDown=new u.default,this.view.addChild(this.districtDropDown),this.districtDropDown.buttonTapped.add(function(){i.updateDropdown()}),this.districtDropDown.onChangeDistrict.add(function(t){var e=i.game.grid.orderEnabled[t];i.game.grid.centerCameraByZoneID(e,!1,function(){i.game.checkClosestDistrict()}),i.updateCurrentDistrict(i.game.grid.getZoneOrder(e))}),this.updateDropdown(),this.ribbon=new f.default,this.game.view.overlay.addChild(this.ribbon),this.ribbon.build(),this.pauseMenu=new g.default,this.pauseMenu.build(),this.btnPause.onTap=this.onBtnPauseTap.bind(this),this.pauseMenu.signals.paused.add(function(){i.game.grid.hideAllIcons(!0),i.game.pause(),i.hide()}),this.pauseMenu.signals.resumed.add(function(){i.game.grid.showAllIcons(!0),i.game.resume(),i.show()}),this.pauseMenu.signals.muteToggle.add(function(t){i.game.muteToggle(t)}),this.game.view.topMenu.addChild(this.pauseMenu)}},t.animateCollectAll=function(){var e=this;this.collectAllIndicator.scale.set(.5);var i=0,n=!1;!function beat(){var t=n?1.5:0;d.default.to(e.collectAllIndicator.scale,.2,{x:.65,y:.65,ease:d.Power1.easeOut,delay:t,onComplete:function(){d.default.to(e.collectAllIndicator.scale,.2,{x:.5,y:.5,ease:d.Power1.easeOut,onComplete:function(){0<i?(n=!0,i=0):(n=!1,i++),e.canCollectAll&&beat()}})}})}()},t.updateCurrentDistrict=function(t){this.districtDropDown.updateCurrentDistrict(t);var e=this.game.inventory.inventory.digStep[t];e=Math.min(p.default.get("digPrices")[t].length-1,e),this.btnDig.text.text=p.default.numberWithCommas(p.default.get("digPrices")[t][e].toString()),this.btnDig.text.scale.set(1),this.btnDig.text.width>1.3*this.btnDig.width&&(this.btnDig.text.width=this.btnDig.width,this.btnDig.text.scale.y=this.btnDig.text.scale.x)},t.highlightCollect=function(){return this.coinCountSprite?(this.coinCountSprite.visible=!0,this.coinCountSprite):null},t.updateDropdown=function(){if(this.districtDropDown&&this.districtDropDown.districtButtons){for(var t=[],e=0;e<this.districtDropDown.districtButtons.length;e++)t.push(this.game.grid.buildingCountByDistrict(e,!0));this.districtDropDown.updateInformation(t)}},t.closePrompt=function(){this.game.grid.unlockScreen()},t.showFastBuilding=function(t){this.decisionPrompt.showFastBuilding(t)},t.showDestroyBuilding=function(t){this.decisionPrompt.showDestroy(t)},t.hideHint=function(){},t.update=function(){this.supportIndicator.update(),this.ribbon.update()},t.createCoinCountLabel=function(t,e,i,n){void 0===e&&(e=""),void 0===n&&(n=0);var r=new l.Container,a=new l.Sprite.from(i||"coin.png");r.addChild(a),a.alpha=0,this[t].icon=a;var s=new o.default({text:e,fontSize:50,anchorX:1,x:n,y:a.y+.75*a.height});return this[t].text=s,r.addChild(s),this[t].coinsContainer=r,t&&(this[t].text=s,this[t].icon=a),r},t.getLabel=function(){var t=null;return this.labelPool.length&&(t=this.labelPool[0],this.labelPool.splice(0,1)),t||(t=new l.Text("",s.default.getStyle("countdown"))).anchor.set(.5),t},t.collectAll=function(){this.canCollectAll&&(this.game.grid.collectAll(),this.canCollectAll=!1,this.collectAllIndicator.visible=!1,this.coinsToCollect=0)},t.revenueReady=function(){this.coinsToCollect++,this.canCollectAll||(this.collectAllIndicator.visible=!0,this.canCollectAll=!0,this.animateCollectAll())},t.animateCoins=function(t,e){var i=this;if(this.collectAllIndicator){var n=l.Sprite.from("coin.png");this.coinsToCollect--,this.coinsToCollect<=0&&(this.coinsToCollect=0,this.collectAllIndicator.visible=!1,this.canCollectAll=!1),this.view.addChild(n);var r=t.coinSprite.getGlobalPosition(),a=this.view.toLocal(r),s=this.getLabel();s.text=t.currentBuilding?t.currentBuilding.revenue:"",s.text=e||"",s.x=a.x,s.y=a.y-30,s.alpha=1,this.view.addChild(s),s.scale.set(0),d.default.to(s,.75,{y:a.y-80}),d.default.to(s,.75,{delay:.35,alpha:0,onCompleteParams:[s],onComplete:function(t){t.parent.removeChild(t),i.labelPool.push(t)}}),d.default.to(s.scale,.65,{x:1,y:1,ease:c.Elastic.easeOut}),n.anchor.set(.5);var o=.8*this.game.camera.targetZoom;n.x=a.x,n.y=a.y-.5*t.coinSprite.height;var h=.25*Math.random();n.scale.set(0),d.default.to(n.scale,.5,{delay:h,x:o,y:o,ease:c.Elastic.easeOut}),d.default.to(n,.5,{delay:.25+h,x:this.coinCountSprite.x-.25*this.coinCountSprite.width-20,y:this.coinCountSprite.y}),d.default.to(n.scale,.5,{delay:.25+h,x:.02,y:.02,ease:Back.easeIn}),d.default.to(n,.1,{delay:.85+h,alpha:0,onCompleteParams:[n],onComplete:function(t){t.parent&&t.parent.removeChild(t)}})}},t.highlightDig=function(){return this.blocker.visible=!0,this.blocker.interactive=!0,this.view.visible=!0,this.districtDropDown.visible=!1,this.coinCountSprite.visible=!0,this.btnInventory.visible=!1,this.btnPause.visible=!1,this.btnZoomIn.visible=!1,this.btnZoomOut.visible=!1,this.btnDig.visible=!0,this.btnDig},t.removeHightlightDig=function(){this.districtDropDown.visible=!0,this.btnInventory.visible=!0,this.btnZoomIn.visible=!0,this.btnZoomOut.visible=!0,this.btnPause.visible=!0,this.coinCountSprite.visible=!0,this.btnDig.visible=!0,this.blocker.visible=!1,this.blocker.interactive=!1},t.updateCoins=function(t){this.game.buildings.blueprintsPanel.updateCoins(t),this.btnInventory.text.text=p.default.numberWithCommas(t.toString()),this.btnInventory.text.scale.set(1),this.btnInventory.text.width>m&&(this.btnInventory.text.width=m,this.btnInventory.text.scale.y=this.btnInventory.text.scale.x)},t.onZoomIn=function(){this.inEvent?this.game.camera.forceZoom(1):this.game.camera.zoomIn()},t.onZoomOut=function(){this.inEvent?this.game.camera.forceZoom(10):this.game.camera.zoomOut()},t.itemDragged=function(t){this.game.room.itemDragged(t)},t.eventShow=function(){for(var t=0;t<this.view.children.length;t++){var e=this.view.children[t];e.preventHide||(e.visible=!1)}this.inEvent=!0},t.eventHide=function(){for(var t=0;t<this.view.children.length;t++){var e=this.view.children[t];this.eventReturnExceptions.includes(e)||(e.visible=!0)}this.inEvent=!1},t.hide=function(){this.view.visible=!1},t.show=function(){this.view.visible=!0},t.open=function(t){void 0===t&&(t={}),this.opened||(t.room&&(this.room=t.room),this.opened=!0,this.build(),this.game.view.ui.addChild(this.view),this.resize(),this.game.state.signals.onStateChange.add(this.onStateChange,this))},t.hideInventory=function(){this.btnInventory.visible=!1},t.onInventory=function(){this.game.inventory.show(),this.hide()},t.onDig=function(){this.game.signals.onDig.dispatch()},t.close=function(){this.opened&&(this.opened=!1,this.game.view.ui.removeChild(this.view),this.game.state.signals.onStateChange.remove(this.onStateChange,this))},t.resize=function(){if(this.built){this.coinCountSprite.x=-this.game.w/2+50+95,this.coinCountSprite.y=this.game.h/2-50-25,this.btnPause.x=this.game.w/2-50-.5*this.btnPause.width,this.btnPause.y=-this.game.h/2+50+.5*this.btnPause.height,this.btnInventory.x=this.game.w/2-50-.5*this.btnInventory.width,this.btnInventory.y=this.btnPause.y+80,this.btnDig.x=this.game.w/2-50-.5*this.btnDig.width,this.btnDig.y=this.game.h/2-50-.5*this.btnDig.height,this.btnZoomOut.x=this.game.w/2-50-.5*this.btnZoomIn.width,this.btnZoomOut.y=this.btnDig.y-1.5*this.btnZoomOut.height-20,this.btnZoomIn.x=this.btnZoomOut.x,this.btnZoomIn.y=this.btnZoomOut.y-80,this.decisionPrompt.resize(this.game.w,this.game.h),this.districtDropDown.y=-this.game.h/2+50,this.supportIndicator.x=-.5*this.game.w+140+.5*this.supportIndicator.width,this.supportIndicator.y=-.5*this.game.h+50+.25*this.supportIndicator.height,this.pauseMenu.resize(this.game.w,this.game.h),this.ribbon.resize(this.game.w,this.game.h)}},t.onBtnPauseTap=function(){this.pauseMenu.onPause()},t.onBtnNoteTap=function(){this.game.notes.open()},t.onBtnMapTap=function(){this.game.goToHouse()},t.onStateChange=function(t,e){"event"===t&&"game"===e?this.eventShow():"event"===e&&this.eventHide()},HudSystem}(n.default);e.default=v},701:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(8)),a=_interopRequireDefault(i(4)),s=_interopRequireDefault(i(29)),o=_interopRequireDefault(i(10)),h=i(7),l=(_interopRequireDefault(i(61)),_interopRequireDefault(i(13)));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var d=function(i){function DecisionPrompt(t){var e;return(e=i.call(this)||this).game=t,e.hudContainer=new n.Container,e.addChild(e.hudContainer),e.blockScreen=(new n.Graphics).beginFill(0).drawRect(-2500,-2500,5e3,5e3),e.hudContainer.addChild(e.blockScreen),e.blockScreen.alpha=.2,e.blockScreen.buttonMode=!0,e.blockScreen.interactive=!0,e.blockScreen.pointerdown=function(){e.cancel()},e.fastbuildingPanel=n.Sprite.from("small_panel.png"),e.fastbuildingPanel.anchor.set(.5),e.fastbuildingPanel.scale.set(.5),e.hudContainer.addChild(e.fastbuildingPanel),e.panelContainer=n.Sprite.from("back_panel_small.png"),e.hudContainer.addChild(e.panelContainer),e.panelContainer.anchor.set(.5),e.panelContainer.y=150,e.cancelButtonFast=new s.default({base:"button_no.png"}),e.fastbuildingPanel.addChild(e.cancelButtonFast),e.cancelButtonFast.x=100,e.cancelButtonFast.y=80,e.cancelButtonFast.scale.set(2),e.cancelButtonFast.onTap=function(){e.cancel()},e.buttonFastBuilding=new s.default({base:"button_yes.png"}),e.fastbuildingPanel.addChild(e.buttonFastBuilding),e.buttonFastBuilding.x=-100,e.buttonFastBuilding.y=80,e.buttonFastBuilding.scale.set(2),e.buttonFastBuilding.onTap=function(){e.onFastBuilding.dispatch(_assertThisInitialized(e))},e.char=new n.Sprite.from("mayor.png"),e.char.anchor.y=.5,e.char.scale.set(.5),e.char.x=-e.panelContainer.width/2+30,e.panelContainer.addChild(e.char),e.onFastBuilding=new r.default,e.onDestroy=new r.default,e.onCancel=new r.default,e.costContainer=new n.Container,e.backgroundCoins=new n.Sprite.from("fastbuild_coin_back.png"),e.costContainer.addChild(e.backgroundCoins),e.coinIcon=new n.Sprite.from("coin.png"),e.costContainer.addChild(e.coinIcon),e.coinIcon.anchor.set(.5),e.coinIcon.scale.set(.5),e.coinIcon.x=40,e.coinIcon.y=e.backgroundCoins.height/2,e.labelCost=new o.default({text:"1000"}),e.costContainer.addChild(e.labelCost),e.labelCost.x=e.coinIcon.width+15,e.labelCost.y=2,e.costContainer.scale.set(1.25),e.costContainer.x=-e.costContainer.width/2,e.costContainer.y=-70,e.fastbuildingPanel.addChild(e.costContainer),e.fastBuildTitle=new o.default,e.fastBuildTitle.text=l.default.get("quick_build"),e.fastbuildingPanel.addChild(e.fastBuildTitle),e.fastBuildTitle.scale.set(1.5),e.fastBuildTitle.x=0,e.fastBuildTitle.y=-120,e.title=new o.default({text:"TITLE"}),e.panelContainer.addChild(e.title),e.title.x=52,e.title.y=-30,e.buttonDestroy=new s.default({base:"button_yes.png"}),e.panelContainer.addChild(e.buttonDestroy),e.buttonDestroy.x=120,e.buttonDestroy.y=30,e.buttonDestroy.onTap=function(){e.onDestroy.dispatch(_assertThisInitialized(e))},e.cancelButton=new s.default({base:"button_no.png"}),e.panelContainer.addChild(e.cancelButton),e.cancelButton.x=0,e.cancelButton.y=30,e.cancelButton.onTap=function(){e.cancel()},e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DecisionPrompt,i);var t=DecisionPrompt.prototype;return t.showFastBuilding=function(t){this.game.inventory.inventory.userCoins>=t.placedBuildingData.getFastbuildPrice()?(this.buttonFastBuilding.interactive=!0,this.buttonFastBuilding.alpha=1):(this.buttonFastBuilding.interactive=!1,this.buttonFastBuilding.alpha=.5),this.labelCost.text=t.placedBuildingData.getFastbuildPrice().toString(),this.labelCost.x=this.backgroundCoins.width-this.labelCost.width,this.labelCost.y=this.backgroundCoins.height/2-2,this.title.text=l.default.get("decision_fast_build"),220<this.title.width*this.title.scale.x&&this.title.scale.set(220/this.title.width*this.title.scale.x),this.title.x=60,this.title.y=-32,this.currentTile=t,this.show(),this.buttonDestroy.visible=!1,this.buttonFastBuilding.visible=!this.buttonDestroy.visible,this.costContainer.visible=!this.buttonDestroy.visible,this.panelContainer.visible=!1,this.fastbuildingPanel.visible=!this.panelContainer.visible},t.showDestroy=function(t){this.currentTile=t,this.show(),this.title.text=l.default.get("decision_destroy"),this.title.x=60,this.title.y=-32,this.title.scale.set(220/this.title.width*this.title.scale.x),this.buttonDestroy.visible=!0,this.buttonFastBuilding.visible=!this.buttonDestroy.visible,this.costContainer.visible=!this.buttonDestroy.visible,this.panelContainer.visible=!0,this.fastbuildingPanel.visible=!this.panelContainer.visible},t.show=function(){this.alpha=1,this.visible=!0,this.blockScreen.alpha=0,a.default.to(this.blockScreen,.5,{alpha:.25}),this.panelContainer.y=0,this.fastbuildingPanel.y=0,this.fastbuildingPanel.alpha=0,a.default.to(this.fastbuildingPanel,.35,{alpha:1}),this.panelContainer.alpha=0,a.default.from(this.panelContainer,.65,{y:this.panelContainer.y+30,ease:h.Back.easeOut}),a.default.to(this.panelContainer,.35,{alpha:1}),this.game.state.setState("menu")},t.cancel=function(){this.hide(),this.currentTile&&this.currentTile.cancelPrompt(),this.onCancel.dispatch()},t.hide=function(t){var e=this;a.default.to(this,t?0:.25,{alpha:0,onComplete:function(){e.visible=!1}}),this.game.state.setState("game")},t.update=function(){},t.resize=function(t,e){},DecisionPrompt}(n.Container);e.default=d},702:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=(n=i(4))&&n.__esModule?n:{default:n},s=i(7);var o=function(e){function SupportIndicator(){var t;return(t=e.call(this)||this).hidden=!1,t.sin=0,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(SupportIndicator,e);var t=SupportIndicator.prototype;return t.build=function(){this.container=new r.Container,this.addChild(this.container),this.container.scale.set(.75),this.crimeContainer=new r.Container,this.container.addChild(this.crimeContainer),this.crimeSprite=r.Sprite.from("police_badge_large.png"),this.crimeSprite.anchor.set(.5),this.crimeSprite.warnShown=!0;var t=this.createWarning();this.crimeContainer.addChild(t),this.crimeContainer.addChild(this.crimeSprite),t.x=.5*this.crimeSprite.width+.5*t.width,t.originPos={x:t.x,y:t.y},this.crimeSprite.warning=t,this.fireContainer=new r.Container,this.container.addChild(this.fireContainer),this.fireSprite=r.Sprite.from("fire_badge_large.png"),this.fireSprite.anchor.set(.5),this.fireSprite.warnShown=!0;var e=this.createWarning();this.fireContainer.addChild(e),this.fireContainer.addChild(this.fireSprite),e.x=.5*this.fireSprite.width+.5*e.width,e.originPos={x:e.x,y:e.y},this.fireSprite.warning=e,this.fireContainer.y=this.crimeContainer.y+this.crimeContainer.height,this.fireSprite.scale.set(.8),this.crimeSprite.scale.set(.8),this.bottomSupport=this.crimeContainer.y+this.crimeContainer.height},t.createWarning=function(){var t=r.Sprite.from("warning.png");return t.anchor.set(.5),t},t.hasSupport=function(t,e,i){i?this.hidden||this.hide():(null!==t&&(t&&this.fireSprite.warnShown?this.hideWarning(this.fireSprite):t||this.fireSprite.warnShown||this.showWarning(this.fireSprite)),null!==e&&(e&&this.crimeSprite.warnShown?this.hideWarning(this.crimeSprite):e||this.crimeSprite.warnShown||this.showWarning(this.crimeSprite)),this.hidden&&this.show())},t.hide=function(){a.default.killTweensOf(this.container.scale),this.hidden=!0,a.default.to(this.container.scale,.25,{x:0,y:0,ease:s.Back.easeIn})},t.show=function(){a.default.killTweensOf(this.container.scale),this.hidden=!1,a.default.to(this.container.scale,.25,{x:.75,y:.75,ease:s.Back.easeOut})},t.hideWarning=function(t){var e=t.warning;a.default.killTweensOf(e.scale),a.default.killTweensOf(e),a.default.killTweensOf(t.scale),t.warnShown=!1,a.default.to(e.scale,.5,{x:.5,y:.5,ease:s.Back.easeIn}),a.default.to(e,.5,{x:0,rotation:0,ease:s.Back.easeIn,onComplete:function(){e.visible=!1,a.default.to(t.scale,.5,{x:0,y:0,ease:s.Back.easeIn})}})},t.showWarning=function(t){var e=t.warning;a.default.killTweensOf(e.scale),a.default.killTweensOf(e),t.warnShown=!0,a.default.to(t.scale,.5,{x:.8,y:.8,ease:s.Back.easeOut,onComplete:function(){e.visible=!0,a.default.to(e.scale,.25,{x:1,y:1,ease:s.Back.easeOut}),a.default.to(e,.5,{x:e.originPos.x,ease:s.Back.easeOut})}})},t.update=function(){this.sin+=1/60;var t=(this.sin-.6)/.4,e=.1*Math.sin(t)+.8;this.fireSprite.warning.scale.set(e),this.crimeSprite.warning.scale.set(e)},SupportIndicator}(r.Container);e.default=o},703:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var l=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),d=_interopRequireDefault(i(29)),n=_interopRequireDefault(i(8)),r=_interopRequireDefault(i(4)),a=i(7),c=_interopRequireDefault(i(10)),u=_interopRequireDefault(i(13)),p=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(i){function DistrictDropDown(){var o;(o=i.call(this)||this).back=(new l.Graphics).beginFill(16711680).drawRect(-120,0,240,275),o.addChild(o.back),o.back.alpha=0,o.back.interactive=!0,o.districtButtons=[],o.size=65;for(var h=[l.Texture.from("button_district_tintable_outline_down.png"),l.Texture.from("button_district_tintable_outline_up.png")],t=function(t){var e=p.default.getColorByDistrict(t+1),i=new d.default({base:"button_district_tintable_fill_up.png",tint:e,tintAlt:e});i.preventHide=!0,i.enabled=!0,o.addChildAt(i,1),i.index=t;var n=new c.default;n.updateText(u.default.get("district_name_"+(t+1),"fontScaleDropdown")),i.buttonContainer.addChild(n),n.x=n.originalX=n._text.width/2-196,n.y=n.originalY=-4,n.scale.set(.8),i.labelName=n;var r=new c.default;r.updateText("0/0"),i.buttonContainer.addChild(r),r.x=r.originalX=130,r.y=r.originalY=-4,(i.labelInfo=r).scale.set(.8),i.onTap=function(t){o.buttonTap(t.index)},i.onDown=function(t){i.children[0].texture=h[0]},i.onUp=i.onOut=function(t){i.children[0].texture=h[1]},i.y=o.size*t+o.size/2,i.scale.set(o.size/i.height),o.districtButtons.push(i);var a=l.Sprite.from("button_district_tintable_house.png");a.anchor.set(.5),i.add(a);var s=l.Sprite.from(h[1]);s.anchor.set(.5),i.addChildAtContainer(s,0,i)},e=0;e<6;e++)t(e);return o.colapseButton=new d.default({base:"button_district_up.png",icon:"chevron_down.png"}),o.addChild(o.colapseButton),o.colapseButton.scale.set(o.districtButtons[0].height/o.colapseButton.height),o.colapseButton.x=o.districtButtons[0].width/2+o.colapseButton.width/2+5,o.colapseButton.y=o.districtButtons[0].height/2,o.colapseButton.onTap=function(t){o.toggleExpand()},o.onChangeDistrict=new n.default,o.buttonTapped=new n.default,o.selectedId=-1,o.expanded=!1,o.selectedId=0,o.contract(),o.disabled=!1,o}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DistrictDropDown,i);var t=DistrictDropDown.prototype;return t.toggleExpand=function(){this.disabled||(this.expanded?(this.contract(this.selectedId),this.enableAll()):(this.expand(),this.disableAll()))},t.disableAll=function(){this.disabled=!0;for(var t=0;t<this.districtButtons.length;t++){this.districtButtons[t].interactive=!1}},t.enableAll=function(){this.disabled=!1;for(var t=0;t<this.districtButtons.length;t++){this.districtButtons[t].interactive=!0}},t.buttonTap=function(t){this.onChangeDistrict.dispatch(t),this.selectedId=t,this.contract()},t.updateCurrentDistrict=function(t){if(this.selectedId!=t){for(var e=0;e<this.districtButtons.length;e++)this.districtButtons[e].visible=!1;this.selectedId=t,this.districtButtons[t].alpha=1,this.districtButtons[t].visible=!0,this.districtButtons[t].y=this.size/2,this.expanded=!1,this.back.visible=!1,r.default.to(this.colapseButton.icon,.5,{rotation:0,ease:a.Back.easeOut})}},t.expand=function(){var e=this;this.buttonTapped.dispatch(),this.expanded=!0,this.back.visible=!0;for(var t=function(t){e.districtButtons[t].y=e.size*t+e.size/2,e.districtButtons[t].visible=!0;0<t&&(e.districtButtons[t].alpha=1,r.default.from(e.districtButtons[t],.2,{alpha:0,y:e.size*t-e.size,delay:.1*t,ease:a.Back.easeOut,onComplete:function(){t===e.districtButtons.length-1&&e.enableAll()}}))},i=0;i<this.districtButtons.length;i++)t(i);r.default.to(this.colapseButton.icon,.5,{rotation:Math.PI,ease:a.Back.easeOut})},t.contract=function(){this.expanded=!1,this.back.visible=!1;for(var t=0;t<this.districtButtons.length;t++)this.districtButtons[t].visible=!1;this.districtButtons[this.selectedId].alpha=1,this.districtButtons[this.selectedId].visible=!0,this.districtButtons[this.selectedId].y=this.size/2,this.selectedId=this.selectedId,r.default.to(this.colapseButton.icon,.5,{rotation:0,ease:a.Back.easeOut})},t.updateInformation=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.districtButtons[e].labelInfo.updateText(i.current+"/"+i.max)}},DistrictDropDown}(l.Container);e.default=s},704:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=i(7),r=_interopRequireDefault(i(705)),s=_interopRequireDefault(i(10)),o=_interopRequireDefault(i(13)),h=_interopRequireDefault(i(18)),l=_interopRequireDefault(i(61)),d=_interopRequireDefault(i(23)),c=_interopRequireDefault(i(25));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var u=0,p=function(e){function DistrictRibbon(){var t;return(t=e.call(this)||this).container=new n.Container,t.addChild(t.container),t.signals={onFinished:new h.default},t.ropesBuilt=!1,t.moveRopes=!1,t.shown=!1,t.snipping=!1,t.shimmerDelay=t.defaultShimmerDelay=3,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DistrictRibbon,e);var t=DistrictRibbon.prototype;return t.build=function(t){var e=this;this.blocker=(new n.Graphics).beginFill(0).drawRect(-1e3,-1e3,1e4,1e4),this.blocker.alpha=0,this.container.addChild(this.blocker),this.blocker.interactive=!0,this.blocker.buttonMode=!0,this.blocker.on("pointerup",function(){e.snip()},this),this.scissorBottom=n.Sprite.from("scissor_bottom.png"),this.scissorBottom.anchor.set(.5,.6),this.scissorTop=n.Sprite.from("scissor_top.png"),this.scissorTop.anchor.set(.5,.6),this.fullRibbon=n.Sprite.from("ribbon_full.png"),this.fullRibbon.anchor.set(.5),this.districtText=new s.default({text:o.default.get("district_name_1","fontScaleRibbonCutting"),fill:16777215,fontSize:60}),this.fullRibbon.addChild(this.districtText),this.shimmer=n.Sprite.from("ribbon_highlight.png"),this.shimmer.anchor.set(.5),this.shimmer.height=this.fullRibbon.height,this.shimmer.scale.x=this.shimmer.scale.y},t.buildRope=function(){this.ropesBuilt||(this.ropesBuilt=!0,this.rightRope=new r.default(.5*this.w,n.Texture.from("ribbon_left.png")),this.leftRope=new r.default(.5*this.w,n.Texture.from("ribbon_right.png")),this.hide(),this.addChildrenInOrder())},t.show=function(t,e){var i=this,n=o.default.get("district_name_"+t,"fontScaleRibbonCutting");this.shown=!0,this.setName(n),this.reset(),this.container.visible=!0,this.container.alpha=0,a.TweenLite.to(this.container,.25,{alpha:1,onStart:function(){i.scissorTop.alpha=0,i.scissorBottom.alpha=0},onComplete:function(){var t=a.TweenLite.from(i.scissorTop,.5,{y:i.scissorTop.y+100,onUpdate:function(){i.scissorTop.alpha=t.progress()}});a.TweenLite.from(i.scissorBottom,.5,{y:i.scissorBottom.y+100,onUpdate:function(){i.scissorBottom.alpha=t.progress()}})}}),e&&(this.callback=e);var r=(d.default.instance.isMobile?o.default.get("click_mobile"):o.default.get("click_desktop"))+o.default.get("district_unlock_interact");l.default.show(o.default.get("character_mayor"),r)},t.hide=function(){this.container.visible=!1,this.reset(),this.shown=!1},t.setName=function(t){this.districtText.text=t},t.addChildrenInOrder=function(){this.container.addChild(this.scissorBottom),this.container.addChild(this.leftRope),this.container.addChild(this.rightRope),this.container.addChild(this.fullRibbon),this.container.addChild(this.scissorTop),this.fullRibbon.addChild(this.shimmer),this.scissorBottom.y=.3*this.scissorBottom.height,this.scissorTop.y=this.scissorBottom.y,this.hide()},t.moveShimmer=function(){this.shimmer.x=.5*-this.fullRibbon.width,this.shimmer.alpha=1,this.snipping||a.TweenLite.to(this.shimmer,.75,{x:.5*this.fullRibbon.width})},t.reset=function(){a.TweenLite.killTweensOf(this.scissorBottom),a.TweenLite.killTweensOf(this.scissorTop),a.TweenLite.killTweensOf(this.rightRope.verlet),a.TweenLite.killTweensOf(this.leftRope.verlet),this.scissorTop.rotation=0,this.scissorBottom.rotation=0,this.scissorTop.alpha=1,this.scissorBottom.alpha=1,this.fullRibbon.visible=!0,this.shimmer.x=.5*-this.fullRibbon.width,this.rightRope.lockEndPoint(),this.rightRope.gravity=0,this.leftRope.lockStartPoint(),this.leftRope.gravity=0,this.rightRope.setStartPoint(u+75,0),this.rightRope.setEndPoint(0,0),this.rightRope.setLength(u+75),this.leftRope.setStartPoint(0,0),this.leftRope.setEndPoint(-u-75,0),this.leftRope.setLength(u+75),this.leftRope.startForceUpdate(),this.rightRope.startForceUpdate(),this.moveRopes=!1},t.snip=function(){var t=this;if(!this.snipping){this.snipping=!0;a.TweenLite.to(this.scissorTop,.5,{rotation:.3,ease:a.Back.easeIn}),a.TweenLite.to(this.scissorBottom,.5,{rotation:-.3,ease:a.Back.easeIn,onComplete:function(){t.fullRibbon.visible=!1,t.rightRope.unlockEndPoint(),t.rightRope.gravity=.1,t.leftRope.unlockStartPoint(),t.leftRope.gravity=.1,t.moveRopes=!0,l.default.show(o.default.get("character_mayor"),o.default.get("district_unlock_pre")+name+o.default.get("district_unlock_post")),c.default.playSfx("new-district-open"),a.TweenLite.to(t.scissorTop,.5,{alpha:0}),a.TweenLite.to(t.scissorBottom,.5,{alpha:0}),a.TweenLite.to(t.leftRope.verlet,2,{endX:t.leftRope.moveToX,ease:a.Back.easeOut,delay:.45}),a.TweenLite.to(t.rightRope.verlet,2,{startX:t.rightRope.moveToX,ease:a.Back.easeOut,delay:.45,onComplete:function(){t.onFinish(),t.snipping=!1}})}})}},t.onFinish=function(){this.signals.onFinished.dispatch(),this.hide(),this.callback&&(this.callback(),delete this.callback)},t.update=function(){this.ropesBuilt&&(this.rightRope.update(),this.leftRope.update(),this.shown&&(0<this.shimmerDelay?this.shimmerDelay-=1/60:(this.shimmerDelay=this.defaultShimmerDelay,this.moveShimmer()),this.snipping&&0<this.shimmer.alpha&&(this.shimmer.alpha-=1/60)))},t.lerp=function(t,e,i){return(1-i)*t+i*e},t.resize=function(t,e){this.w=t,this.h=e,this.buildRope(),u=.5*t,this.rightRope.setStartPoint(u+75,0),this.rightRope.setLength(u+75),this.rightRope.moveToX=2.25*u+75,this.leftRope.setEndPoint(-u-75,0),this.leftRope.setLength(u+75),this.leftRope.moveToX=-2.25*u-75},DistrictRibbon}(n.Container);e.default=p},705:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=i(1),a=(n=i(268))&&n.__esModule?n:{default:n};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(r){function RibbonRope(t,e){var i,n=new a.default;return n.gravity=0,n.build(t),(i=r.call(this,e,n.links)||this).verlet=n,i.lockEndPoint(),i.sin=0,i.forceUpdate=!1,i.forceUpdateTimer=i.defaultUpdateTimer=5,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(RibbonRope,r);var t=RibbonRope.prototype;return t.show=function(){},t.setEndPoint=function(t,e){this.endPointOrigin=this.verlet.setEndPoint(t,e)},t.setStartPoint=function(t,e){this.startPointOrigin=this.verlet.setStartPoint(t,e)},t.setLength=function(t,e){this.verlet.setLength(t,e)},t.lockEndPoint=function(){this.verlet.lockEndPoint()},t.unlockEndPoint=function(){this.verlet.unlockEndPoint()},t.lockStartPoint=function(){this.verlet.lockStartPoint()},t.unlockStartPoint=function(){this.verlet.unlockStartPoint()},t.update=function(){this.forceUpdate&&(this.updateTransform(),this.forceUpdateTimer-=1/60,this.forceUpdateTimer<0&&(this.forceUpdateTimer=this.defaultUpdateTimer,this.forceUpdate=!1))},t.startForceUpdate=function(t){this.forceUpdate=!0,this.forceUpdateTimer=t||this.defaultUpdateTimer},t.hide=function(){},t.updateTransform=function(){r.prototype.updateTransform.call(this),this.verlet.update()},t.lerp=function(t,e,i){return(1-i)*t+i*e},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(RibbonRope,[{key:"gravity",set:function(t){this.verlet.gravity=t},get:function(){return this.verlet.gravity}}]),RibbonRope}(r.SimpleRope);e.default=s},706:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(18)),a=_interopRequireDefault(i(10)),s=_interopRequireDefault(i(29)),o=_interopRequireDefault(i(13));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h=function(e){function _default(){var t;return(t=e.call(this)||this).signals={paused:new r.default,resumed:new r.default,muteToggle:new r.default},t.mutted=!1,t.muteToggleTextures=[n.Texture.from("icon_sound_on.png"),n.Texture.from("icon_sound_off.png")],t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(_default,e);var t=_default.prototype;return t.build=function(){var t=this;this.pauseContainer=new n.Container,this.addChild(this.pauseContainer),this.blocker=(new n.Graphics).beginFill(0).drawRect(0,0,1e4,1e4),this.blocker.interactive=!0,this.blocker.buttonMode=!0,this.pauseContainer.addChild(this.blocker),this.blocker.alpha=.5,this.blocker.pointerdown=function(){t.onResume()},this.buttonContainer=new n.Container,this.pauseContainer.addChild(this.buttonContainer),this.text=new a.default({text:o.default.get("misc_paused"),fill:16777215,padding:10,fontSize:80}),this.pauseContainer.visible=!1,this.pauseContainer.addChild(this.text),this.btnPause=new s.default({base:"button_district_up.png",icon:"icon_play.png"}),this.buttonContainer.addChild(this.btnPause),this.btnPause.scale.set(.75),this.btnPause.onTap=this.onResume.bind(this),this.btnMute=new s.default({base:"button_district_up.png",icon:"icon_sound_on.png"}),this.buttonContainer.addChild(this.btnMute),this.btnMute.scale.set(.75),this.btnMute.onTap=this.onToggleMute.bind(this),this.btnMute.x=1.5*-this.btnMute.width},t.onPause=function(){this.signals.paused.dispatch(),this.pauseContainer.visible=!0},t.onResume=function(){this.signals.resumed.dispatch(),this.pauseContainer.visible=!1},t.onToggleMute=function(){this.mutted=!this.mutted,this.btnMute.icon.texture=this.mutted?this.muteToggleTextures[1]:this.muteToggleTextures[0],this.signals.muteToggle.dispatch(this.mutted)},t.resize=function(t,e){this.blocker.width=t,this.blocker.height=e,this.blocker.x=.5*-t,this.blocker.y=.5*-e;this.buttonContainer.x=t/2-50-.5*this.btnPause.width,this.buttonContainer.y=-e/2+50+.5*this.btnPause.height},_default}(n.Container);e.default=h},707:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;_interopRequireDefault(i(262));var n=_interopRequireDefault(i(17)),r=_interopRequireDefault(i(18));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(n){function StateSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).states=["game","menu","event","minigame","onboarding"],i.currentState="game",i.signals={onStateChange:new r.default},i}return function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(StateSystem,n),StateSystem.prototype.setState=function(t){this.states.includes(t)&&(this.previousState=this.currentState,this.currentState=t,this.signals.onStateChange.dispatch(this.currentState,this.previousState))},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(StateSystem,[{key:"state",get:function(){return this.currentState}}]),StateSystem}(n.default);e.default=a},708:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),a=(_interopRequireDefault(i(10)),_interopRequireDefault(i(709)),_interopRequireDefault(i(710))),s=(_interopRequireDefault(i(269)),_interopRequireDefault(i(271)),_interopRequireDefault(i(714)));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var o=function(n){function InventorySystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.app=t.game.app,i.view=new r.Container,i.inventoryPanel=new s.default(i.game),i.view.addChild(i.inventoryPanel),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(InventorySystem,n);var t=InventorySystem.prototype;return t.build=function(){this.built||(this.built=!0,this.inventory=new a.default(this.app,this.game.grid),this.inventory.loadBuildings(),this.inventory.loadPieces(),this.game.view.ui.addChild(this.view),this.inventoryPanel.build())},t.postupdate=function(){this.inventory.updateBuildings()},t.show=function(){this.inventoryPanel.show()},t.resize=function(t,e){this.inventoryPanel.resize(t,e)},InventorySystem}(n.default);e.default=o},709:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function Time(){}return Time.timeout=function(e){return new Promise(function(t){return setTimeout(t,e)})},Time}();e.default=n},710:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var y=_interopRequireDefault(i(711)),w=_interopRequireDefault(i(269)),r=_interopRequireDefault(i(712)),_=_interopRequireDefault(i(41)),a=_interopRequireDefault(i(77)),C=_interopRequireDefault(i(18)),s=_interopRequireDefault(i(13)),x=(_interopRequireDefault(i(168)),_interopRequireDefault(i(44)));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var n=function(){function Inventory(t,e){this.resources=t.resourceManager,this.grid=e;var i=this.resources.getJson("data/pieces").data,n=this.resources.getJson("data/buildings").data;this.pieces=[],this.allPieces=[],this.signals={coinsSpent:new C.default,coinsEarned:new C.default},this.audioCoinPopLimit=5;for(var r=this.currentAudioPopCount=0;r<i.length;r++){for(var a=[],s=0;s<i[r].length;s++){var o=i[r][s],h=new y.default;for(var l in o)o.hasOwnProperty(l)&&(h[l]=o[l]);h._customTiles=o.customTiles,h._structure=o.structure,a.push(h),0==r&&s<2&&(h.value=1),this.allPieces.push(h)}this.pieces.push(a)}this.buildings=[];for(var d=0;d<n.length;d++){for(var c=[],u=0;u<n[d].length;u++){var p=n[d][u],f=new w.default;for(var g in f.districtIndex=d,p)p.hasOwnProperty(g)&&(f[g]=p[g]);c.push(f)}this.buildings.push(c)}if(this.placedBuildings=[],this.UID=_.default.getCookie("UID"),this.UID||(this.UID=1,_.default.createCookie("UID",this.UID)),this.toSaveBuildings=_.default.getCookie("buildings"),this.toSaveBuildings||(_.default.createCookie("buildings",this.toSaveBuildings),this.toSaveBuildings=[]),this.toSavePieces=_.default.getCookie("pieces"),!this.toSavePieces){this.toSavePieces=[];for(var m=0;m<this.allPieces.length;m++){var v=this.allPieces[m];this.toSavePieces.push({id:v.id,value:v.value,found:!1})}_.default.createCookie("pieces",this.toSavePieces)}if(this.userCoins=_.default.getCookie("userCoins"),this.userCoins||0===this.userCoins||(this.userCoins=x.default.get("initialRevenue"),_.default.createCookie("userCoins",this.userCoins)),this.availableZones=_.default.getCookie("availableZones"),this.availableZones||(this.availableZones=1,_.default.createCookie("availableZones",this.availableZones)),t.config.overrideDistricts&&(this.availableZones=parseInt(t.config.overrideDistrictsCount,10)),this.digStep=_.default.getCookie("digSteps"),!this.digStep){this.digStep=[];for(var b=0;b<6;b++)this.digStep.push(0);_.default.createCookie("digSteps",this.digStep)}this.availableCoinsToCollect=0}var t=Inventory.prototype;return t.addPiecesCheat=function(){for(var t=0;t<this.pieces.length;t++)for(var e=0;e<this.pieces[t].length;e++){this.pieces[t][e].value+=5}this.savePieces()},t.collectRevenue=function(t,e){this.earnCoins(t.revenue,e)},t.loadBuildings=function(){if(this.toSaveBuildings)for(var t=0;t<this.toSaveBuildings.length;t++){var e=this.toSaveBuildings[t],i=this.grid.getZone(e.zone).getTile(e.i,e.j),n=this.getBuildingById(e.id);i.ignoreSound=this.currentAudioPopCount>this.audioCoinPopLimit,this.currentAudioPopCount++,i.isBurnt=e.isBurnt,this.placeBuilding(i,n,e.placedTime),i.setTimers(e.lastRevenueTime,e.placedTime),i.addBuilding(n,!0)}},t.loadPieces=function(){if(this.toSavePieces)for(var t=0;t<this.toSavePieces.length;t++){var e=this.toSavePieces[t];this.getPieceById(e.id).value=e.value}},t.getPieceById=function(t){for(var e=0;e<this.pieces.length;e++)for(var i=0;i<this.pieces[e].length;i++){var n=this.pieces[e][i];if(n.id==t)return n}return{}},t.addPieces=function(t,e){var i=this.getPieceById(t);i.value+=e;for(var n=0;n<this.toSavePieces.length;n++){var r=this.toSavePieces[n];r.id==t&&(r.value=i.value)}this.savePieces(t)},t.unlockNextDistrict=function(){var t=[],e=this.availableZones-1;if(this.buildings[e]){for(var i=0;i<this.buildings[e].length;i++){var n=this.buildings[e][i];t.push({texture:n.image})}a.default.showUserCoins(this.userCoins),a.default.showObjectReward(t,1+e,{title:s.default.get("rewards_title_districts"),subtitle:s.default.get("rewards_subtitle_districts")})}},t.getBuildingById=function(t){for(var e=0;e<this.buildings.length;e++)for(var i=0;i<this.buildings[e].length;i++){var n=this.buildings[e][i];if(n.id==t)return n}return{}},t.getRandomPlaced=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=[];if(t||e)for(var n=0;n<this.placedBuildings.length;n++){var r=this.placedBuildings[n],a=!!t&&"essential"!==r.buildingData.group;e!==(!!e&&r.isBuilt)||t!==a||r.tile.isBurnt||i.push(r)}else i=this.placedBuildings;return i[Math.floor(Math.random()*i.length)]},t.isPlaced=function(t){for(var e=0;e<this.placedBuildings.length;e++){var i=this.placedBuildings[e];if(i.buildingData.id==t)return i}return!1},t.placeBuilding=function(t,e,i){var n=new r.default;return n.tile=t,n.buildingData=e,n.uid=this.UID,n.placedTime=i||Date.now(),_.default.storeObject("UID",this.UID),n.build(),t.addPlacedBuilding(n),this.placedBuildings.push(n),3<this.placedBuildings.length&&this.grid.game.onboard.onboardCollectAll(),n},t.saveFastBuilding=function(t){for(var e=0;e<this.toSaveBuildings.length;e++){var i=this.toSaveBuildings[e];i.i==t.i&&i.j==t.j&&i.zone==t.zone.id&&(i.placedTime=Date.now()-9e7,i.lastRevenueTime=Date.now())}_.default.storeObject("buildings",this.toSaveBuildings)},t.saveBuildings=function(t,e,i){for(var n={id:e.id,i:t.i,j:t.j,zone:t.zone.id,lastRevenue:0,placedTime:i.placedTime,lastRevenueTime:i.lastRevenueTimer,uid:i.uid,isBurnt:!!t.isBurnt},r=0;r<this.toSaveBuildings.length;r++){var a=this.toSaveBuildings[r];if(a.i==t.i&&a.j==t.j&&a.zone==t.zone.id){this.toSaveBuildings.splice(r,1);break}}this.toSaveBuildings.push(n),_.default.storeObject("buildings",this.toSaveBuildings)},t.saveAvailableZones=function(){_.default.storeObject("availableZones",this.availableZones)},t.saveRevenue=function(t,e){for(var i=0;i<this.toSaveBuildings.length;i++){var n=this.toSaveBuildings[i];n.i==t.i&&n.j==t.j&&n.zone==t.zone.id&&(n.lastRevenueTime=e.lastRevenueTimer)}_.default.storeObject("buildings",this.toSaveBuildings)},t.forceCoins=function(t){var e=this.userCoins>t;this.userCoins=t,e?this.signals.coinsSpent.dispatch(this.userCoins):this.signals.coinsEarned.dispatch(this.userCoins),this.saveCoins()},t.spendCoins=function(t){this.userCoins-=t,this.userCoins=Math.min(x.default.get("coinCap"),Math.max(0,this.userCoins)),this.saveCoins(),this.signals.coinsSpent.dispatch(this.userCoins)},t.earnCoins=function(t,e){this.userCoins+=t,this.userCoins=Math.min(x.default.get("coinCap"),Math.max(0,this.userCoins)),this.saveCoins(),this.signals.coinsEarned.dispatch(this.userCoins,e)},t.saveCoins=function(){_.default.storeObject("userCoins",this.userCoins)},t.savePieces=function(t){this.toSavePieces=[];for(var e=_.default.getCookie("pieces"),i=0;i<this.allPieces.length;i++){var n=this.allPieces[i],r=t===n.id||(e[i].found||!1);this.toSavePieces.push({id:n.id,value:n.value,found:r})}_.default.storeObject("pieces",this.toSavePieces)},t.removeBuilding=function(t){for(var e=this,i=t.currentBuilding,n=0;n<i.requirementPieces.length;n++){var r=i.requirementPieces[n];this.addPieces(r.id,parseInt(r.value))}for(var a=0;a<this.toSaveBuildings.length;a++){var s=this.toSaveBuildings[a];s.i==t.i&&s.j==t.j&&s.zone==t.zone.id&&this.toSaveBuildings.splice(a,1)}_.default.storeObject("buildings",this.toSaveBuildings);for(var o=0;o<this.placedBuildings.length;o++){var h=this.placedBuildings[o].tile;if(h.i==t.i&&h.j==t.j&&h.zone.id==t.zone.id){this.placedBuildings.splice(o,1);break}}this.grid.game.hud&&setTimeout(function(){e.grid.game.hud.updateDropdown()},50)},t.updateBuildings=function(){for(var t=this.availableCoinsToCollect=0;t<this.placedBuildings.length;t++){var e=this.placedBuildings[t];e.update(1/60),e.toCollect&&(this.availableCoinsToCollect+=e.buildingData.revenue)}},Inventory}();e.default=n},711:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;e.default=function(){this.id="",this.image,this.value=0,this.structure=[[1,1],[1,1]],this.customTiles=[],this._structure=[[1,1],[1,1]],this._customTiles=[],this.rotationStructure=[0],this.rarity=1}},712:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n;(n=i(118))&&n.__esModule;var r=function(){function PlacedBuilding(){this.buildingData,this.uid,this.tile,this.placedTime}var t=PlacedBuilding.prototype;return t.build=function(){this.timer=parseFloat(this.buildingData.timeToBuild),this.isBuilt=!1,this.toCollect=!1,this.lastRevenueTimer||this.startRevenue(),this.revenueTimer=(Date.now()-this.lastRevenueTimer)/1e3},t.getFastbuildPrice=function(){this.timer,parseFloat(this.buildingData.timeToBuild);return Math.floor(.5*this.buildingData.revenue)},t.updateTimers=function(){var t=parseFloat(this.buildingData.timeToBuild)-(Date.now()-this.placedTime)/1e3;this.timer=t,this.timer<=0&&(this.isBuilt=!0)},t.getScale=function(){return 1-this.timer/parseFloat(this.buildingData.timeToBuild)},t.getRevenueScale=function(){return Math.min(1,this.revenueTimer/parseFloat(this.buildingData.timeToRevenue))},t.update=function(t){this.isBuilt?this.updateRevenueTimer(t):this.updateBuildTimer(t)},t.startRevenue=function(){this.lastRevenueTimer=Date.now()},t.waitingToCollect=function(){0!=this.buildingData.revenue?this.toCollect=!0:this.toCollect=!1},t.collect=function(){this.toCollect=!1,this.lastRevenueTimer=Date.now(),this.revenueTimer=0},t.updateRevenueTimer=function(t){0!=this.buildingData.revenue?this.revenueTimer>this.buildingData.timeToRevenue?this.toCollect=!0:this.revenueTimer=(Date.now()-this.lastRevenueTimer)/1e3:this.toCollect=!1},t.updateBuildTimer=function(t){if(this.timer<=0)return this.isBuilt=!0,void this.startRevenue();this.timer=this.buildingData.timeToBuild-(Date.now()-this.placedTime)/1e3},PlacedBuilding}();e.default=r},713:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var r=function(i){function Handy(t){var e;return(e=i.call(this)||this).game=t,e.container=new n.Container,e.addChild(e.container),e.handPosition={x:0,y:0},e.normalScale=.2,e.sin=0,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Handy,i);var t=Handy.prototype;return t.build=function(t){this.data=t,this.hand=new n.Sprite.from("hand.png"),this.game.view.notification.addChild(this.hand),this.hand.scale.set(this.normalScale),this.hand.anchor.x=.1,this.hand.anchor.y=.25},t.moveToEntity=function(t,e,i){void 0===e&&(e="left"),void 0===i&&(i={x:0,y:0}),"LEFT"===e.toUpperCase()?this.hand.scale.x=-this.normalScale:"RIGHT"===e.toUpperCase()&&(this.hand.scale.x=this.normalScale);var n=this.game.view.notification.toLocal(t.getGlobalPosition());this.handPosition.x=n.x+i.x,this.handPosition.y=n.y+i.y},t.moveToPosition=function(t,e,i){void 0===i&&(i="left"),"LEFT"===i.toUpperCase()?this.hand.scale.x=-this.normalScale:"RIGHT"===i.toUpperCase()&&(this.hand.scale.x=this.normalScale),this.handPosition.x=t,this.handPosition.y=e},t.show=function(){this.hand.visible=!0},t.hide=function(){this.hand.visible=!1},t.update=function(){this.hand.visible&&(this.hand.x=this.lerp(this.handPosition.x+10*Math.sin(this.sin)+5,this.hand.x,.9),this.hand.y=this.lerp(this.handPosition.y,this.hand.y,.9),this.sin+=.1)},t.lerp=function(t,e,i){return(1-i)*t+i*e},Handy}(n.Container);e.default=r},714:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(29)),a=_interopRequireDefault(i(715)),s=_interopRequireDefault(i(169)),o=_interopRequireDefault(i(13)),h=_interopRequireDefault(i(4)),l=i(7);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var d=function(i){function InventoryPanel(t){var e;return(e=i.call(this)||this).blackShape=(new n.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),e.addChild(e.blackShape),e.blackShape.alpha=.5,e.container=new n.Container,e.addChild(e.container),e.blackShape.interactive=!0,e.backPanel=n.Sprite.from("back_panel_blueprints.png"),e.container.addChild(e.backPanel),e.container.pivot.set(.5*e.container.width,.5*e.container.height),e.backPanel.interactive=!0,e.topContainer=new s.default,e.container.addChild(e.topContainer),e.topContainer.text=o.default.get("inventory_title"),e.blackShape.interactive=!0,e.blackShape.buttonMode=!0,e.blackShape.pointerdown=function(){e.hideCard(!0)},e.game=t,e.inventoryScroll=new a.default(t),e.container.addChild(e.inventoryScroll),e.interactive=!0,e.cancelButton=new r.default({base:"button_no.png"}),e.container.addChild(e.cancelButton),e.cancelButton.x=e.backPanel.width-40,e.cancelButton.y=40,e.cancelButton.onTap=function(){e.hideCard(!0)},e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(InventoryPanel,i);var t=InventoryPanel.prototype;return t.show=function(){var t=this.game.grid.getZoneByOrder(this.game.currentDistrict);this.updateScroll(t.id),this.inventoryScroll.scroller.interactiveChildren=!0,this.inventoryScroll.lockByZones(),this.inventoryScroll.updateCards(),this.blackShape.visible=!0,this.container.visible=!0,this.container.scale.set(.75),h.default.to(this.container.scale,.15,{x:1,y:1,ease:l.Back.easeOut}),this.game.state.setState("menu")},t.build=function(){this.inventoryScroll.build(),this.hideCard(!1)},t.updateScroll=function(t){this.inventoryScroll.updateScroll(t)},t.hideCard=function(){var t=this;h.default.to(this.container.scale,.15,{x:.75,y:.75,ease:l.Back.easeIn,onComplete:function(){t.blackShape.visible=!1,t.container.visible=!1,t.inventoryScroll.scroller.interactiveChildren=!1,t.game.hud.show(),t.game.state.setState("game")}})},t.updateCoins=function(t){this.topContainer.updateCoins(t)},t.resize=function(t,e){this.container.scale.set(e/this.container.height*.75*this.container.scale.y),this.inventoryScroll.x=this.backPanel.width/2-this.inventoryScroll.scroller.rect.w/2,this.inventoryScroll.y=75,this.topContainer.resize(this.backPanel.width,this.backPanel.height)},InventoryPanel}(n.Container);e.default=d},715:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var d=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),c=_interopRequireDefault(i(10)),n=_interopRequireDefault(i(273)),u=_interopRequireDefault(i(716)),p=_interopRequireDefault(i(13)),f=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var r=function(i){function BlueprintScroll(t){var e;return(e=i.call(this)||this).game=t,e.container=new d.Container,e.addChild(e.container),e.bricksContainer=new d.Container,e.container.addChild(e.bricksContainer),e.bricks=[],e.thumbsList=[],e.districtsList=[],e.scroller=new n.default({w:520,h:280},2),e.scroller.snap=!1,e.scroller.cap=!0,e.scroller.y=20,e.scroller.x=-8,e.scroller.updateCallback.add(function(){e.sliderfill.y=(e.sliderbar.height/(e.sliderbar.scale.y-.002)-e.sliderfill.height)*e.scroller.percent}),e.midPanel=d.Sprite.from("mid_panel_menu.png"),e.midPanel.anchor.set(.5),e.midPanel.scale.set(.9,.9),e.midPanel.x=e.scroller.rect.w/2,e.midPanel.y=e.scroller.rect.h/2+e.scroller.y,e.container.addChild(e.midPanel),e.container.addChild(e.scroller),e.sliderbar=d.Sprite.from("slider_bar.png"),e.container.addChild(e.sliderbar),e.sliderbar.scale.set(.5),e.sliderbar.x=e.container.width-35+e.scroller.x,e.sliderbar.y=e.midPanel.y-e.sliderbar.height/2,e.sliderfill=d.Sprite.from("slider_fill.png"),e.sliderbar.addChild(e.sliderfill),e.blocker=(new d.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),e.container.addChild(e.blocker),e.blocker.alpha=.5,e.blocker.visible=!1,e.blocker.interactive=!0,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BlueprintScroll,i);var t=BlueprintScroll.prototype;return t.build=function(){var t=this.game.inventory.inventory.pieces;this.allThumbs=[],this.districtThumbs=[],this.firstCard={thumb:null,x:0,y:0,parent:null},this.secCard={thumb:null,x:0,y:0,parent:null};for(var e=0;e<t.length;e++){var i=new d.Container,n=d.Sprite.from("bar_inventory_generic.png"),r=d.Sprite.from("bar_inventory_tintable.png");n.addChild(r),r.tint=f.default.getColorByDistrict(e+1),i.addChild(n),this.districtsList.push(n);var a=new c.default({fill:16777215,padding:10,fontSize:30,x:n.width/2,y:25});a.text=p.default.get("district_name_"+(e+1),"fontScaleInventory"),n.addChild(a),i.y=i.height*e;for(var s=[],o=0;o<t[e].length;o++){var h=t[e][o],l=new u.default(this.game,e+1);l.setData(h),this.allThumbs.push(l),l.scale.set((n.width-25)/l.width/5),l.x=o*(l.width+2)+10,l.y=55,i.addChild(l),s.push(l),this.firstCard.thumb?this.secCard.thumb||(this.secCard.thumb=l,this.secCard.x=l.x,this.secCard.y=l.y,this.secCard.parent=i):(this.firstCard.thumb=l,this.firstCard.x=l.x,this.firstCard.y=l.y,this.firstCard.parent=i)}this.districtThumbs.push(s),this.scroller.addItem(i,1),i.x=this.scroller.rect.w/2-i.width/2}},t.highlightFirst=function(t){this.isOnboarding=!0;for(var e=0;e<this.allThumbs.length;e++){this.allThumbs[e].lock()}var i=0==t?this.firstCard.thumb:this.secCard.thumb;return i.unlock(),i},t.lockByZones=function(){for(var t=this.game.inventory.inventory.availableZones,e=0;e<this.districtThumbs.length;e++){var i=this.districtThumbs[e],n=t<=e;n?(this.districtsList[e].tint=4210752,this.districtsList[e].children[1].alpha=.5):(this.districtsList[e].tint=16777215,this.districtsList[e].children[1].alpha=1);for(var r=0;r<i.length;r++){var a=i[r];n?a.lock():a.unlock()}}},t.unlockAll=function(){this.isOnboarding=!1,this.lockByZones()},t.updateCards=function(){for(var t=0;t<this.allThumbs.length;t++){this.allThumbs[t].updatePieces()}},t.updateScroll=function(t){this.scroller.updatePosition(t)},t.resize=function(t,e){},BlueprintScroll}(d.Container);e.default=r},716:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),s=(_interopRequireDefault(i(8)),_interopRequireDefault(i(10))),o=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var n=function(r){function BuildingThumbCard(t,e){var i;(i=r.call(this)||this).game=t,i.container=new a.Container,i.addChild(i.container),i.cardBackPanel=a.Sprite.from("piece_inventory_tintable.png"),i.cardBackPanel.tint=o.default.getColorByDistrict(e),i.container.addChild(i.cardBackPanel),i.highlight=a.Sprite.from("piece_inventory_outline.png"),i.cardBackPanel.addChild(i.highlight),i.building=a.Sprite.from(a.Texture.WHITE);var n=.85*i.cardBackPanel.height;return i.building.scale.set(Math.min(n/i.building.height*i.building.scale.x,n/i.building.width*i.building.scale.x)),i.container.addChild(i.building),i.building.anchor.set(.5),i.building.x=i.cardBackPanel.width/2,i.building.y=i.cardBackPanel.height/2,i.isDown=!1,i.locked=!1,i.pieces=[],i.text=new s.default({text:"0",fontSize:30,y:.825*i.cardBackPanel.height,x:.5*i.cardBackPanel.width}),i.cardBackPanel.addChild(i.text),i.lockSprite=a.Sprite.from("lock_icon.png"),i.lockSprite.anchor.set(.5),i.lockSprite.scale.set(.75),i.lockSprite.position.set(i.building.x,i.building.y),i.lockSprite.visible=!1,i.addChild(i.lockSprite),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BuildingThumbCard,r);var t=BuildingThumbCard.prototype;return t.lock=function(){this.locked=!0,this.container.alpha=.5,this.building.tint=4210752,this.lockSprite.visible=!0},t.unlock=function(){this.locked=!1,this.container.alpha=1,this.building.tint=16777215,this.lockSprite.visible=!1},t.setData=function(t){this.buildingData=t,this.building.texture=a.Texture.from(t.image);var e=.5*this.cardBackPanel.height;this.building.y-=.15*this.cardBackPanel.height,this.building.scale.set(Math.min(e/this.building.height*this.building.scale.x,e/this.building.width*this.building.scale.x)),this.text.text=t.value.toString()},t.updatePieces=function(){this.text.text=this.locked?"":"x "+this.buildingData.value.toString()},BuildingThumbCard}(a.Container);e.default=n},717:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var u=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),p=_interopRequireDefault(i(718)),d=_interopRequireDefault(i(723)),c=_interopRequireDefault(i(8)),f=_interopRequireDefault(i(724)),g=_interopRequireDefault(i(725)),m=_interopRequireDefault(i(44)),r=_interopRequireDefault(i(25));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var a=function(l){function GridSystem(t,e){var i;void 0===e&&(e={}),(i=l.call(this,t,e)||this).game=t.game,i.app=t.game.app,i.view=new u.Container,i.allTiles=[],i.fullMap=[],i.allZones=[],i.allTrafficWaypoints=[],i.closestDistrict=null,i.fullMapGrid={i:2,j:3},i.areaGrid={i:5,j:5,width:150,height:150,road:60},i.areaGrid.totalWidth=(i.areaGrid.width+i.areaGrid.road)*i.areaGrid.i,i.areaGrid.totalHeight=(i.areaGrid.height+i.areaGrid.road)*i.areaGrid.j;for(var n=0,r=0;r<i.fullMapGrid.i;r++){for(var a=[],s=0;s<i.fullMapGrid.j;s++){var o=new d.default(i.game);a.push(o),i.allZones.push(o),o.id=n,o.i=r,o.j=s,o.grid=i.areaGrid,n++}i.fullMap.push(a)}for(var h=0;h<i.allZones.length;h++){i.allZones[h].neighbours=i.getNeighbours(h)}return i.gridRotation=Math.PI/4,i.onTileSelected=new c.default,i.onCoinPopped=new c.default,document.addEventListener("keypress",function(t){101===t.keyCode&&i.checkFullDistrict(!0)}),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(GridSystem,l);var t=GridSystem.prototype;return t.getZoneByOrder=function(t){for(var e=this.orderEnabled[t],i=0;i<this.allZones.length;i++){var n=this.allZones[i];if(n.id==e)return n}return null},t.getZone=function(t){for(var e=0;e<this.allZones.length;e++){var i=this.allZones[e];if(i.id==t)return i}return null},t.build=function(){var r=this;if(!this.built){this.background=(new u.Graphics).beginFill(10744668).drawRect(-2500,-2500,5e3,5e3),this.game.view.background.addChild(this.background),this.built=!0,this.game.view.container.addChild(this.view),this.backgroundContainer=new u.Container,this.view.addChild(this.backgroundContainer),this.gridContainer=new u.Container,this.view.addChild(this.gridContainer),this.roadContainer=new u.Container,this.gridContainer.addChild(this.roadContainer),this.eventContainer=new u.Container,this.gridContainer.addChild(this.eventContainer),this.tileContainer=new u.Container,this.gridContainer.addChild(this.tileContainer),this.fenceContainer=new u.Container,this.gridContainer.addChild(this.fenceContainer),this.gridDressing=new g.default,this.gridDressing.build(this);for(var t=0;t<this.fullMap.length;t++)for(var e=this.fullMap[t],i=0;i<e.length;i++){for(var a=e[i],s=this.areaGrid.totalWidth,o=this.areaGrid.totalHeight,h=0;h<this.areaGrid.j;h++){for(var l=[],n=function(t){var n=new p.default(r);r.tileContainer.addChild(n.view),a.tiles.push(n),n.build(h,t,a,r.areaGrid),n.x=h*(r.areaGrid.width+r.areaGrid.road),n.x-=r.areaGrid.j*(r.areaGrid.width+r.areaGrid.road)*.5-.5*r.areaGrid.width,n.y=t*(r.areaGrid.height+r.areaGrid.road),n.y-=r.areaGrid.i*(r.areaGrid.height+r.areaGrid.road)*.5-.5*r.areaGrid.height,n.x+=s*a.i,n.y+=o*a.j;var e=new f.default(!1);e.graph&&r.tileContainer.addChild(e.graph),e.x=n.x-r.areaGrid.width/2-.5*r.areaGrid.road,e.y=n.y-r.areaGrid.height/2-.5*r.areaGrid.road,e.i=h==r.areaGrid.j-1?h+1:h,e.j=t==r.areaGrid.i-1?t+1:t,e.zone=a,l.push(e),e.id=r.allTrafficWaypoints.length,r.allTrafficWaypoints.push(e);r.allTiles.push(n),r.roadContainer.addChild(n.roadChunk),n.roadChunk.x=n.x,n.roadChunk.y=n.y,n.onTileSelected.add(function(t){if(!r.game.drag.blockTileClick()){r.onTileSelected.dispatch(t),r.game.hud.districtDropDown.contract();var e=r.convertPosition(t.view);r.game.camera.setPosition(e.x,e.y)}}),n.onFastBuilding.add(function(t){r.lockOnBuilding(t),r.game.hud.showFastBuilding(t)}),n.onRevenueCollected.add(function(t,e){r.revenueCollected(t,e)}),n.onRevenueReady.add(function(t){r.game.hud.revenueReady()}),n.onBurntCoin.add(function(t){var e=r.game.inventory.inventory,i=m.default.get("burntBuildingCoinValue");e.earnCoins(i),r.game.hud.animateCoins(n,i)}),n.onBuildingBuilt.add(function(t){r.checkFullDistrict()})},d=0;d<this.areaGrid.i;d++)n(d);a.trafficWaypoints.push(l)}var c=(new u.Graphics).beginFill(16711680).drawCircle(0,0,2);c.alpha=0,this.tileContainer.addChild(c),(a.middle=c).x=a.tiles[0].x+s/2-this.areaGrid.width/2,c.y=a.tiles[0].y+o/2-this.areaGrid.height/2}this.row={i:2,j:0},this.tileContainer.rotation=this.gridRotation,this.roadContainer.rotation=this.gridRotation,this.eventContainer.rotation=this.gridRotation,this.gridContainer.scale.y=.6,this.orderEnabled=[5,4,3,2,1,0],this.enabledZones=[this.orderEnabled[0]],this.centerCameraByZoneID(this.orderEnabled[0],!0),this.zoomHideIcons=!1,this.backgroundTilingSprite=u.TilingSprite.from(window.ASSET_URL+"backgrounds/background_tile.jpg?v=wtj5a4k3sr9wh5",this.gridContainer.width+this.gridContainer.width/2,this.gridContainer.height+this.gridContainer.height/1.5),this.backgroundTilingSprite.x=-this.gridContainer.width/1.4,this.backgroundTilingSprite.y=-this.gridContainer.height/2,this.backgroundTilingSprite.alpha=.4;this.backgroundTilingSprite.tileScale.set(.3435,.3435*1.0275),this.backgroundTilingSprite.tilePosition.x=133,this.backgroundTilingSprite.tilePosition.y=61,this.backgroundContainer.addChild(this.backgroundTilingSprite)}},t.hideAllIcons=function(t){if(void 0===t&&(t=!1),window.OPT||t)for(var e=0;e<this.allTiles.length;e++){this.allTiles[e].zoomContainer.visible=!1}},t.showAllIcons=function(t){if(void 0===t&&(t=!1),(window.OPT||t)&&(!t||!this.zoomHideIcons))for(var e=0;e<this.allTiles.length;e++){this.allTiles[e].zoomContainer.visible=!0}},t.checkFullDistrict=function(t){void 0===t&&(t=!1);var e=this.game.inventory.inventory.availableZones,i=this.orderEnabled[e-1];if(this.game.inventory.inventory.availableZones>=this.orderEnabled.length&&this.game.triggerEndGame(),null!=i){for(var n=0,r=this.allZones[i].grid.i*this.allZones[i].grid.j,a=0;a<this.allZones[i].tiles.length;a++){var s=this.allZones[i].tiles[a];s.placedBuildingData&&s.placedBuildingData.isBuilt&&n++}t&&(n=r),r<=n&&this.game.unlockNextDistrict()}},t.checkBuildingAmount=function(){for(var t=0,e=0;e<6;e++)t+=this.buildingCountByDistrict(e).current;return t},t.dist=function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},t.getClosestDistrict=function(t){void 0===t&&(t=!1);for(var e=1e6,i=null,n=window.renderer.width,r=window.renderer.height,a=0;a<this.allZones.length;a++){var s=this.allZones[a];if(!t||this.enabledZones.includes(a))for(var o=0;o<s.tiles.length;o++){var h=s.tiles[o];if(null!==h.view.parent){var l=h.view.getGlobalPosition(),d=Math.sqrt(Math.pow(.5*n-l.x,2)+Math.pow(.5*r-l.y,2));d<e&&(e=d,i=h)}}}return i&&(this.closestDistrict=i.zone),{district:this.closestDistrict,index:this.allZones.indexOf(this.closestDistrict)}},t.highlightOnboarding=function(t,e){var i=this;void 0===t&&(t=!0),void 0===e&&(e=1);for(var n=this.getDistrictFromUnlockOrder(this.orderEnabled[0]),r=0;r<n.tiles.length;r++){var a=n.tiles[r];a.lock(),a.mock.visible=!1,a.locked=!0}var s=Math.floor(this.areaGrid.i*this.areaGrid.j/2),o=t?s:s+e,h=n.tiles[o];return this.onboardingCenter=t,this.currentOnboardedTile=h.view,h.locked=!1,h.unlock(),h.mock.visible=!0,h.onMockSelect.add(function(){i.game.onboard.next(),h.mock.visible=!1}),h},t.updateLockedZones=function(){this.enabledZones=[];for(var t=this.game.inventory.inventory.availableZones,e=0;e<this.orderEnabled.length;e++){var i=this.orderEnabled[e];e<t&&this.enabledZones.push(i)}for(var n=0;n<this.allZones.length;n++){for(var r=this.allZones[n],a=!1,s=0;s<this.enabledZones.length;s++){this.enabledZones[s]==r.id&&(a=!0)}a?r.unlock():r.lock()}for(var o=0;o<this.allZones.length;o++){this.allZones[o].updateZoneFences()}},t.getNeighbours=function(t){void 0===t&&(t=0);for(var e=[],i=this.allZones[t],n=!1,r=0;r<this.allZones.length;r++){var a=this.allZones[r];if(a!==i){var s=Math.abs(a.i-i.i),o=Math.abs(a.j-i.j);s<2&&o<2&&s!==o&&(n=!0)}n&&(e.push(a),n=!1)}return e},t.lockAllTiles=function(t){if(!isNaN(t))for(var e=this.orderEnabled[t],i=this.getDistrictFromUnlockOrder(e),n=0;n<i.tiles.length;n++){i.tiles[n].lock()}else for(var r=0;r<this.allZones.length;r++)for(var a=this.allZones[r],s=0;s<a.tiles.length;s++){a.tiles[s].lock()}},t.unlockAllTiles=function(t){if(!isNaN(t))for(var e=this.orderEnabled[t],i=this.getDistrictFromUnlockOrder(e),n=0;n<i.tiles.length;n++){i.tiles[n].unlock()}else for(var r=0;r<this.allZones.length;r++)for(var a=this.allZones[r],s=0;s<a.tiles.length;s++){a.tiles[s].unlock()}},t.getDistrictFromUnlockOrder=function(t){for(var e=0,i=0;i<this.fullMap.length;i++){var n=this.fullMap[i];if(!(t>e+(n.length-1)))return n[Math.abs(e-t)];e+=n.length}return null},t.afterOnboarding=function(){for(var t=this.fullMap[0][this.orderEnabled[0]].tiles,e=0;e<t.length;e++){t[e].unlock()}var i=t[Math.floor(this.areaGrid.i*this.areaGrid.j/2)];i.unlock(),i.view.pointerup=null},t.lockOnBuilding=function(t){this.centerCameraByBuilding(t),this.game.camera.lock(),this.game.camera.forceZoom(10),this.game.drag.lock()},t.unlockScreen=function(){this.game.camera.unlock(),this.game.drag.unlock()},t.collectAll=function(){for(var t=0;t<this.allTiles.length;t++){this.allTiles[t].collectRevenue(!0)}r.default.playSfx("collect-money"),r.default.playSfx("money-riser",{volume:.2})},t.revenueCollected=function(t,e){this.game.onboard.onboardingData.collectCoin||this.game.onboard.completeCollectCoin();var i=this.game.inventory.inventory;i.collectRevenue(t.placedBuildingData.buildingData,e),i.saveRevenue(t,t.placedBuildingData),this.game.hud.animateCoins(t)},t.centerCameraByZoneID=function(t,e,i){i&&(this.moveCameraCallBack=i),this.game.changingDistrict=!0;for(var n=0;n<this.allZones.length;n++){var r=this.allZones[n];if(r.id==t){var a=this.convertPosition(r.middle);e?this.game.camera.forcePosition(a.x,a.y):this.game.camera.setPosition(a.x,a.y)}}},t.convertPosition=function(t){var e=t.getGlobalPosition();return this.game.view.container.toLocal(e)},t.centerCameraByBuilding=function(t){var e=this.game.culling.getTrueTilePosition(t,this.game.view.container);this.game.camera.setPosition(e.x,e.y)},t.getZoneOrder=function(t){for(var e=0;e<this.orderEnabled.length;e++){if(this.orderEnabled[e]==t)return e}return-1},t.buildingCountByDistrict=function(t,e){void 0===e&&(e=!1);for(var i=this.orderEnabled[t],n=this.allZones[i].tiles,r=0,a=0;a<n.length;a++){var s=n[a];if(s.placedBuildingData){if(e&&!s.placedBuildingData.isBuilt)continue;r++}}return{current:r,max:n.length}},t.depthCompare=function(t,e){var i=t.y,n=e.y;return i===n?0:i<n?-1:n<i?1:0},t.districtHasBuilding=function(t,e,i){if(void 0===i&&(i=!1),!t&&0!==t||!e)return!1;for(var n=this.allZones[t],r=0;r<n.tiles.length;r++){var a=n.tiles[r];if(a.currentBuilding&&a.currentBuilding.name===e)return!(i&&a.placedBuildingData&&!a.placedBuildingData.isBuilt)}return!1},t.updateUIZoom=function(t){for(var e=0;e<this.allTiles.length;e++){var i=this.allTiles[e];i.coinUIWrapper.scale.set(1/t),i.buildingTimer&&i.buildingTimer.hudContainer.scale.set(1/t,1/t*1.4),i.revenueTimer&&i.revenueTimer.hudContainer.scale.set(1/t)}},t.update=function(t){for(var e=0;e<this.allTiles.length;e++){this.allTiles[e].update(t)}},t.postupdate=function(){this.tileContainer.children.sort(this.depthCompare),this.moveCameraCallBack&&this.game.camera.checkNearPosition()&&(this.moveCameraCallBack(),delete this.moveCameraCallBack,this.game.changingDistrict=!1)},GridSystem}(n.default);e.default=a},718:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var s=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(4)),r=i(7),o=_interopRequireDefault(i(8)),a=_interopRequireDefault(i(119)),h=_interopRequireDefault(i(719)),l=_interopRequireDefault(i(720)),d=_interopRequireDefault(i(721)),c=_interopRequireDefault(i(274)),u=_interopRequireDefault(i(275)),p=_interopRequireDefault(i(78)),f=_interopRequireDefault(i(25)),g=_interopRequireDefault(i(10)),m=_interopRequireDefault(i(13)),v=_interopRequireDefault(i(61)),b=_interopRequireDefault(i(722));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var y=function(a){function Tile(t){var n;(n=a.call(this)||this).dragSystem=t.game.drag,n.gridSystem=t,n.tile=(new s.Graphics).beginFill(6645093).drawRect(0,0,10,10);var e=new s.Container;n.isAshPile=!1,e.addChild(n.tile),n.tile.buttonMode=!0,n.tile.interactive=!0,n.ignoreSound=!1,n.view.addChild(e),n.mock=(new s.Graphics).beginFill(6645093).drawRect(-100,-100,200,200),n.mock.alpha=0,n.view.addChild(n.mock),n.mock.visible=!1,n.mock.interactive=!0,n.mock.pointerup=function(){n.onTileSelected.dispatch(_assertThisInitialized(n)),n.onMockSelect.dispatch(_assertThisInitialized(n))},n.districtMock=(new s.Graphics).beginFill(6645093).drawRect(-100,-100,200,200),n.districtMock.alpha=0,n.view.addChild(n.districtMock),n.districtMock.visible=!1,n.districtMock.interactive=!0,n.districtMock.pointerup=function(){var t=m.default.get("district_name_"+Math.abs(n.gridSystem.allZones.length-n.zone.id-1)),e=m.default.get("district_name_"+Math.abs(n.gridSystem.allZones.length-n.zone.id)),i=m.default.get("district_locked_fill")+t+m.default.get("district_locked_buildings")+e;v.default.show(m.default.get("character_mayor"),i),v.default.addIgnoreMessage(i)},n.backFencesContainer=new s.Container,n.view.addChild(n.backFencesContainer),n.buildingContainer=new s.Container,n.view.addChild(n.buildingContainer),n.frontFencesContainer=new s.Container,n.view.addChild(n.frontFencesContainer),n.locked=!1,n.forced=!1,n.tile.mouseover=function(){n.tile.alpha=.75},n.tile.mouseout=function(){n.tile.alpha=1},n.tile.pointerdown=function(){n.isDown=!0},n.tile.pointerup=function(){n.locked||!n.isDown||n.eventBystander||n.inEventCooldown||n.dragSystem.blockTileClick()||(n.waitToCollect?n.collectRevenue():!n.placedBuildingData||n.placedBuildingData&&n.placedBuildingData.isBuilt?(n.onTileSelected.dispatch(_assertThisInitialized(n)),n.revenueTimer&&n.revenueTimer.show()):n.placedBuildingData&&n.fastBuilding(),n.isDown=!1)},n.i=0,n.j=0,n.zone=0,n.originalTexture=null,n.zonesBases=[{texture:"empty_plot_04",amount:3},{texture:"empty_plot_02",amount:5},{texture:"empty_plot_05",amount:3},{texture:"empty_plot_06",amount:3},{texture:"empty_plot_05",amount:3},{texture:"empty_plot_06",amount:3}],n.onTileSelected=new o.default,n.onMockSelect=new o.default,n.onRevenueCollected=new o.default,n.onRevenueReady=new o.default,n.onBurntCoin=new o.default,n.onFastBuilding=new o.default,n.onBuildingBuilt=new o.default,n.onBuildingDestroyed=new o.default,n.signals={eventTap:new o.default},n.waitToCollect=!1,n.zoomContainer=new s.Container,n.view.addChild(n.zoomContainer),n.hudContainer=new s.Container,n.zoomContainer.addChild(n.hudContainer),n.coinUIWrapper=new s.Container,n.coinSprite=s.Sprite.from("coin_collect_indicator.png"),n.coinUIWrapper.addChild(n.coinSprite),n.hudContainer.addChild(n.coinUIWrapper),n.coinSprite.visible=!1,n.coinSprite.anchor.set(.5,1),n.hudContainer.rotation=-n.gridSystem.gridRotation,n.hudContainer.scale.y=1.6,n.hitGraphic=(new s.Graphics).beginFill(0).drawCircle(0,.5*-n.coinSprite.width,.5*n.coinSprite.width),n.hitGraphic.alpha=0,n.coinSprite.addChild(n.hitGraphic),n.hitGraphic.interactive=!0,n.hitGraphic.buttonMode=!0,n.hitGraphic.on("pointerdown",function(){n.hitGraphic.isDown=!0}),n.hitGraphic.on("pointerup",function(){n.hitGraphic.isDown&&n.collectRevenue()});var i=new g.default({text:"",fill:16777215,fontSize:28,stroke:15964447,strokeThickness:4});i.y=i.originalY=-n.coinSprite.height-i.height+25,n.coinSprite.addChild(i),n.coinSprite.label=i,n.roadChunk=new s.Sprite.from("road_chunk.png"),n.roadChunk.anchor.set(.5),n.roadChunk.rotation=-n.gridSystem.gridRotation;var r=n.getPlotTexture(0);return n.plot=new s.Sprite.from(r),n.plot.anchor.set(.5),n.plot.rotation=-n.gridSystem.gridRotation,n.buildingContainer.addChild(n.plot),n.disableTimerTimer=n.defaultDisableTimerTimer=10,n.coinSin=Math.random()*Math.PI*2,n.people=new c.default,n.buildingContainer.addChild(n.people),n.people.rotation=-n.gridSystem.gridRotation,n.people.visible=!1,n.particleSystem=new p.default,n.hudContainer.addChild(n.particleSystem),n.animationBuildingManager=new u.default,n.animationBuildingManager.addAnimation("loop","construction_sitev300",30,.05,{start:0,loop:!0}),n.animationBuildingManager.play("loop"),n.fenceInfo={backLeft:!1,backRight:!1,frontLeft:!1,frontRight:!1},n.eventCooldownTimer=n.defaultEventCooldownTimer=.5,n.inEventCooldown=!1,n}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Tile,a);var t=Tile.prototype;return t.updateFences=function(){if(this.backLeftFence1&&(this.backLeftFence1.parent.removeChild(this.backLeftFence1),delete this.backLeftFence1,this.backLeftFence2.parent.removeChild(this.backLeftFence2),delete this.backLeftFence2),this.backRightFence1&&(this.backRightFence1.parent.removeChild(this.backRightFence1),delete this.backRightFence1,this.backRightFence2.parent.removeChild(this.backRightFence2),delete this.backRightFence2),this.frontLeftFence1&&(this.frontLeftFence1.parent.removeChild(this.frontLeftFence1),delete this.frontLeftFence1,this.frontLeftFence2.parent.removeChild(this.frontLeftFence2),delete this.frontLeftFence2),this.frontRightFence1&&(this.frontRightFence1.parent.removeChild(this.frontRightFence1),delete this.frontRightFence1,this.frontRightFence2.parent.removeChild(this.frontRightFence2),delete this.frontRightFence2),this.zone.locked){this.determindFenceFormation();for(var t=0;t<this.zone.neighbours.length;t++){var e=this.zone.neighbours[t];e.locked&&(e.j<this.zone.j&&(this.fenceInfo.backRight=!1),e.j>this.zone.j&&(this.fenceInfo.frontLeft=!1),e.i<this.zone.i&&(this.fenceInfo.backLeft=!1),e.i>this.zone.i&&(this.fenceInfo.frontRight=!1))}if(this.fenceInfo.backLeft&&!this.backLeftFence1){this.backLeftFence1=s.Sprite.from("fence.png"),this.backFencesContainer.addChild(this.backLeftFence1),this.backLeftFence1.anchor.set(.5,1),this.backLeftFence1.rotation=-this.gridSystem.gridRotation,this.backLeftFence1.scale.set(.49),this.backLeftFence1.scale.x*=-1,this.backLeftFence1.scale.y/=.57,this.backLeftFence1.y=80,this.backLeftFence1.x=-75,this.backLeftFence2=s.Sprite.from("fence.png"),this.backFencesContainer.addChild(this.backLeftFence2),this.backLeftFence2.anchor.set(.5,1),this.backLeftFence2.rotation=-this.gridSystem.gridRotation,this.backLeftFence2.scale.set(.49),this.backLeftFence2.scale.x*=-1,this.backLeftFence2.scale.y/=.57,this.backLeftFence2.y=-25,this.backLeftFence2.x=-75}if(this.fenceInfo.backRight&&!this.backRightFence1&&(this.backRightFence1=s.Sprite.from("fence.png"),this.backFencesContainer.addChild(this.backRightFence1),this.backRightFence1.anchor.set(.5,1),this.backRightFence1.rotation=-this.gridSystem.gridRotation,this.backRightFence1.scale.set(.49),this.backRightFence1.scale.y/=.57,this.backRightFence1.y=-.5*this.tile.height,this.backRightFence1.x=-25,this.backRightFence2=s.Sprite.from("fence.png"),this.backFencesContainer.addChild(this.backRightFence2),this.backRightFence2.anchor.set(.5,1),this.backRightFence2.rotation=-this.gridSystem.gridRotation,this.backRightFence2.scale.set(.49),this.backRightFence2.scale.y/=.57,this.backRightFence2.y=-.5*this.tile.height,this.backRightFence2.x=80),this.fenceInfo.frontLeft&&!this.frontLeftFence1){this.backRightFence1=s.Sprite.from("fence.png"),this.frontFencesContainer.addChild(this.backRightFence1),this.backRightFence1.anchor.set(.5,1),this.backRightFence1.rotation=-this.gridSystem.gridRotation,this.backRightFence1.scale.set(.49),this.backRightFence1.scale.y/=.57,this.backRightFence1.y=.8*this.tile.height+12,this.backRightFence1.x=-25,this.backRightFence2=s.Sprite.from("fence.png"),this.frontFencesContainer.addChild(this.backRightFence2),this.backRightFence2.anchor.set(.5,1),this.backRightFence2.rotation=-this.gridSystem.gridRotation,this.backRightFence2.scale.set(.49),this.backRightFence2.scale.y/=.57,this.backRightFence2.y=.8*this.tile.height+12,this.backRightFence2.x=80}if(this.fenceInfo.frontRight&&!this.frontRightFence1){this.backLeftFence1=s.Sprite.from("fence.png"),this.frontFencesContainer.addChild(this.backLeftFence1),this.backLeftFence1.anchor.set(.5,1),this.backLeftFence1.rotation=-this.gridSystem.gridRotation,this.backLeftFence1.scale.set(.49),this.backLeftFence1.scale.x*=-1,this.backLeftFence1.scale.y/=.57,this.backLeftFence1.y=80,this.backLeftFence1.x=132,this.backLeftFence2=s.Sprite.from("fence.png"),this.frontFencesContainer.addChild(this.backLeftFence2),this.backLeftFence2.anchor.set(.5,1),this.backLeftFence2.rotation=-this.gridSystem.gridRotation,this.backLeftFence2.scale.set(.49),this.backLeftFence2.scale.x*=-1,this.backLeftFence2.scale.y/=.57,this.backLeftFence2.y=-25,this.backLeftFence2.x=132}this.addShade([this.backLeftFence1,this.backLeftFence2,this.backRightFence1,this.backRightFence2])}},t.addShade=function(t){for(var e=0;e<t.length;e++){var i=t[e];i&&(i.scale.x<0?i.tint=10724259:i.tint=16777215)}},t.getPlotTexture=function(t){var e=this.zonesBases[t].texture,i=Math.floor(Math.random()*this.zonesBases[t].amount);return i<10&&(i="0"+i),i="_"+i,s.Texture.from(e+i+".png")},t.cancelPrompt=function(){this.revenueTimer&&this.revenueTimer.hide()},t.hide=function(){this.view.visible=!1,this.roadChunk.visible=!1},t.show=function(){this.view.visible=!0,this.roadChunk.visible=!0},t.determindFenceFormation=function(){0===this.i&&0===this.j&&(this.fenceInfo={backLeft:!0,backRight:!0,frontLeft:!1,frontRight:!1}),0===this.i&&this.j===this.gridSystem.areaGrid.j-1&&(this.fenceInfo={backLeft:!0,backRight:!1,frontLeft:!0,frontRight:!1}),this.i===this.gridSystem.areaGrid.i-1&&0===this.j&&(this.fenceInfo={backLeft:!1,backRight:!0,frontLeft:!1,frontRight:!0}),this.i===this.gridSystem.areaGrid.i-1&&this.j===this.gridSystem.areaGrid.j-1&&(this.fenceInfo={backLeft:!1,backRight:!1,frontLeft:!0,frontRight:!0}),0===this.i&&(this.fenceInfo.backLeft=!0),0===this.j&&(this.fenceInfo.backRight=!0),this.i===this.gridSystem.areaGrid.i-1&&(this.fenceInfo.frontRight=!0),this.j===this.gridSystem.areaGrid.j-1&&(this.fenceInfo.frontLeft=!0)},t.build=function(t,e,i,n){this.i=t,this.j=e,this.zone=i,this.areaGrid=n,this.tile.clear(),this.determindFenceFormation(),0<=this.zone.id&&(this.originalTexture=this.getPlotTexture(this.zone.id),this.plot.texture=this.originalTexture),this.tile.beginFill(16777215).drawRect(-n.width/2,-n.height/2,n.width,n.height),this.tile.tint=7582015;this.people.scale.x=n.width/this.people.width*.1,this.people.scale.y=1.54*Math.abs(this.people.scale.x);var r=[{x:n.width/2-10,y:n.height/2-10},{x:-10,y:n.height/2-10},{x:-n.width/2+10,y:n.height/2-10},{x:-n.width/2+10,y:-n.height/2+10},{x:n.width/2-10,y:-n.height/2+10},{x:n.width/2-10,y:10}];this.downPaths=[0,1,r.length-1],this.people.setWaypoints(r);var a=n.width/this.plot.width*this.plot.scale.x;this.plot.scale.x=1.42*a,this.plot.scale.y=this.plot.scale.x/.58;var s=(n.width+this.areaGrid.road+3)/this.roadChunk.width*this.roadChunk.scale.x;this.roadChunk.scale.x=1.4*s,this.roadChunk.scale.y=this.roadChunk.scale.x/.58},t.collectRevenue=function(t){void 0===t&&(t=!1),this.waitToCollect&&(this.waitToCollect=!1,this.coinSprite.visible=!1,this.placedBuildingData.collect(),this.onRevenueCollected.dispatch(this,t),t||f.default.playSfx("collect-money"))},t.popCoin=function(){this.onRevenueReady.dispatch(),this.waitToCollect=!0,this.coinSprite.visible=!0,this.coinSprite.scale.set(0,2);this.ignoreSound?this.ignoreSound=!1:null!==this.view.parent&&f.default.playSfx("coin_ready"),this.coinSprite.label.text=this.placedBuildingData.buildingData.revenue.toString(),n.default.to(this.coinSprite.scale,.35,{x:.9,y:.9,ease:r.Back.easeOut})},t.hideCoin=function(){this.coinSprite&&(this.coinSprite.visible=!1)},t.dofastBuilding=function(){this.placedBuildingData.timer=0},t.fastBuilding=function(){this.onFastBuilding.dispatch(this)},t.unlock=function(){this.plot.tint=16777215,this.tile.buttonMode=!0,this.tile.interactive=!0,this.locked=!1,this.districtMock.visible=!1},t.lock=function(){this.plot.tint=8421504,this.tile.buttonMode=!1,this.tile.interactive=!1,this.locked=!0,this.districtMock.visible=!0},t.addPlacedBuilding=function(t){this.placedBuildingData=t,this.isBuilding=!0},t.setTimers=function(t,e){this.placedBuildingData.lastRevenueTimer=t,this.placedBuildingData.placedTime=e,this.placedBuildingData.updateTimers(),this.placedBuildingData.isBuilt||(this.add(h.default),this.buildingTimer.reset(),this.buildingTimer.show())},t.addBuilding=function(t,e){this.currentBuilding=t,this.isAshPile&&(this.removeAshPile(),this.isAshPile=!1,Math.random()<.5&&this.onBurntCoin.dispatch()),this.plot.texture=s.Texture.from("building_base.png"),this.sprite=s.Sprite.from(this.currentBuilding.image),this.sprite.scale.x=this.areaGrid.width/this.sprite.width*1.4*.8,this.sprite.scale.y=this.sprite.scale.x/.58,this.sprite.rotation=-this.gridSystem.gridRotation,this.sprite.anchor.x=1,this.sprite.anchor.y=1,this.sprite.x=Math.cos(this.gridSystem.gridRotation)*this.sprite.width,n.default.from(this.sprite,.5,{x:95,y:-30,ease:r.Bounce.easeOut}),this.buildingContainer.addChild(this.sprite),e?(this.forced=!0,this.isBurnt&&this.burntDown(!0)):(this.add(h.default),this.buildingTimer.reset(),this.buildingTimer.show(),f.default.playSfx("construction-start"),this.forced=!1)},t.addPoliceTape=function(){if(!this.backTape&&!this.frontTape){this.removePoliceTape(),this.backTape=s.Sprite.from("police_tape_back.png"),this.buildingContainer.addChild(this.backTape),this.backTape.anchor.set(.5,0),this.backTape.rotation=-this.gridSystem.gridRotation,this.backTape.scale.x=this.areaGrid.width/this.backTape.width*1.4,this.backTape.scale.y=this.backTape.scale.x/.58,this.backTape.originScale={x:this.backTape.scale.x,y:this.backTape.scale.y},this.backTape.y=-.655*this.tile.height-10,this.backTape.x=-.655*this.tile.height-10;var t=this.buildingContainer.getChildIndex(this.sprite);this.buildingContainer.setChildIndex(this.backTape,t),this.frontTape=s.Sprite.from("police_tape_front.png"),this.buildingContainer.addChild(this.frontTape),this.frontTape.anchor.set(.5,1),this.frontTape.rotation=-this.gridSystem.gridRotation,this.frontTape.scale.x=this.areaGrid.width/this.frontTape.width*1.4,this.frontTape.scale.y=this.frontTape.scale.x/.58,this.frontTape.originScale={x:this.frontTape.scale.x,y:this.frontTape.scale.y},this.frontTape.y=.5*this.tile.height-10,this.frontTape.x=.5*this.tile.height-10,this.showPoliceTape()}},t.removePoliceTape=function(){this.backTape&&this.frontTape&&(this.frontTape.parent.removeChild(this.frontTape),this.backTape.parent.removeChild(this.backTape),delete this.frontTape,delete this.backTape)},t.hidePoliceTape=function(){var t=this;this.backTape&&this.frontTape&&(n.default.to(this.backTape.scale,.5,{y:0,x:0}),n.default.to(this.frontTape.scale,.5,{x:0,y:0,onComplete:function(){t.removePoliceTape()}}))},t.showPoliceTape=function(){this.backTape&&this.frontTape&&(this.backTape.visible=!0,this.frontTape.visible=!0,this.backTape.scale.set(0),this.frontTape.scale.set(0),n.default.killTweensOf(this.backTape.scale),n.default.killTweensOf(this.frontTape.scale),n.default.to(this.backTape.scale,.5,{y:this.backTape.originScale.y,x:this.backTape.originScale.x}),n.default.to(this.frontTape.scale,.5,{x:this.frontTape.originScale.x,y:this.frontTape.originScale.y}))},t.addAshPile=function(){this.plot.texture=s.Texture.from("building_base.png"),this.sprite=s.Sprite.from("ash_plot.png"),this.sprite.scale.x=this.areaGrid.width/this.sprite.width*1.4,this.sprite.scale.y=this.sprite.scale.x/.58,this.sprite.rotation=-this.gridSystem.gridRotation,this.sprite.anchor.x=1,this.sprite.anchor.y=1,this.sprite.x=Math.cos(this.gridSystem.gridRotation)*this.sprite.width,n.default.from(this.sprite,.5,{x:95,y:-50,ease:r.Bounce.easeOut}),this.buildingContainer.addChild(this.sprite),this.isAshPile=!0},t.removeAshPile=function(){this.sprite&&this.sprite.parent&&this.sprite.parent.removeChild(this.sprite),this.isBurnt=!1,this.gridSystem.game.inventory.inventory.saveBuildings(this,this.currentBuilding,this.placedBuildingData)},t.burntDown=function(t){void 0===t&&(t=!1),this.isRobbed&&!this.forced&&this.notRobbed(!0),this.isBurnt=!0,t||this.gridSystem.game.inventory.inventory.saveBuildings(this,this.currentBuilding,this.placedBuildingData),this.hadCoin&&(this.hadCoin=!1),this.destroyBuilding(t),this.addAshPile()},t.robbed=function(){this.isRobbed=!0,this.coinSprite.visible=!1,this.hadCoin=!1,this.revenueTimer&&(this.waitToCollect=!1,this.hadRevenue=!0,this.revenueTimer.destroy(),this.remove(l.default)),this.addPoliceTape()},t.notRobbed=function(t){void 0===t&&(t=!1),this.isRobbed=!1,this.hadRevenue&&!t&&(delete this.hadRevenue,this.add(l.default),this.revenueTimer.reset(),this.placedBuildingData.collect()),this.hidePoliceTape()},t.destroyBuilding=function(t){if(void 0===t&&(t=!1),this.sprite&&this.sprite.parent&&this.sprite.parent.removeChild(this.sprite),this.hideCoin(),!t){for(var e=0;e<30;e++)this.createSmokeParticle();f.default.playSfx("destroy-building")}this.plot.texture=this.originalTexture,this.currentBuilding=null,this.placedBuildingData=null,this.buildingTimer&&(this.buildingTimer.destroy(),this.remove(h.default)),this.revenueTimer&&(this.revenueTimer.destroy(),this.remove(l.default)),this.waitToCollect=!1,this.monetize=!1,this.onBuildingDestroyed.dispatch(),this.people.visible=!1},t.createSmokeParticle=function(){var t={x:100*Math.random()-40,y:60*Math.random()-50};this.particleSystem.show(t,1,{texture:"cloud_0"+Math.ceil(9*Math.random())+".png",scale:.6,forceY:50*Math.random()+50,forceX:2*t.x,gravity:30+50*Math.random(),alphaDecress:.75,angSpeed:.2*Math.random()-.1})},t.update=function(t){this.isBuilding?this.updateBuildingTimer():this.monetize&&!this.isRobbed&&this.updateRevenue(),this.coinSprite.visible&&(this.coinSin+=.03,this.coinSprite.y=5*Math.sin(this.coinSin)-30),this.fire&&this.fire.update(),this.inEventCooldown&&(0<this.eventCooldownTimer?this.eventCooldownTimer-=1/60:(this.eventCooldownTimer=this.defaultEventCooldownTimer,this.inEventCooldown=!1)),this.isRobbed&&(0<this.disableTimerTimer?this.disableTimerTimer-=1/60:(this.disableTimerTimer=this.defaultDisableTimerTimer,this.notRobbed())),0<this.particleSystem.particles.length&&this.particleSystem.update(1/60),this.people&&this.currentBuilding&&(this.people.update(1/60),this.isPeopleDown()?this.buildingContainer.setChildIndex(this.people,this.buildingContainer.children.length-1):this.buildingContainer.setChildIndex(this.people,this.buildingContainer.getChildIndex(this.sprite)-1)),this.eventPeopleManager&&this.eventPeopleManager.update(t)},t.isPeopleDown=function(){var e=this;return!!this.downPaths.find(function(t){return t==e.people.currentWaypointID})||!!this.downPaths.find(function(t){return t==e.people.prevWaypointID})},t.updateRevenue=function(){this.revenueTimer&&!this.inEvent&&(this.revenueTimer.update(this.placedBuildingData),!this.placedBuildingData.toCollect||this.waitToCollect||this.eventBystander||(this.popCoin(),this.gridSystem.onCoinPopped.dispatch(this)))},t.summonEventPeople=function(t){this.add(b.default,{grid:this.gridSystem}),this.eventPeopleManager.resetEventPeople(this,t),this.eventPeopleManager.animateEventPeople(this)},t.withdrawEventPeople=function(){this.eventPeopleManager&&this.eventPeopleManager.removeEventPeopleFromTile(this),this.isBurnt||(this.people.visible=!0),this.remove(b.default)},t.createEvent=function(t){this.inEvent=!0,"fire"===t&&(this.add(d.default),this.fire.setFire(this.sprite))},t.removeEvent=function(){this.fire&&(this.fire.removeAll(),this.remove(d.default)),this.inEvent=!1,this.inEventCooldown=!0},t.completeBuilding=function(){if(this.buildingTimer&&this.buildingTimer.destroy(),this.sprite.texture=s.Texture.from(this.currentBuilding.image),this.sprite.anchor.x=1,this.sprite.anchor.y=1,this.isBuilding=!1,this.placedBuildingData.isBuilt=!0,this.monetize=!0,this.onBuildingBuilt.dispatch(),this.add(l.default),this.revenueTimer.reset(),this.people.visible=!0,!this.forced){f.default.playSfx("construction-end");for(var t=0;t<30;t++)this.createSmokeParticle()}},t.updateBuildingTimer=function(){this.placedBuildingData&&this.currentBuilding&&(this.placedBuildingData.isBuilt?this.completeBuilding():(this.buildingTimer&&this.buildingTimer.update(this.placedBuildingData),this.animationBuildingManager.updateAnimation(1/60),this.sprite.texture=this.animationBuildingManager.currentTexture,this.sprite.anchor.x=.87,this.sprite.anchor.y=.8,Math.random()<.1&&this.particleSystem.show({x:100*Math.random()-50,y:-20},1,{texture:"cloud_0"+Math.ceil(9*Math.random())+".png",scale:.4,forceY:150,forceX:100*Math.random()-50,gravity:120+75*Math.random(),alphaDecress:1})))},Tile}(a.default);e.default=y},719:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var h=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(43)),r=_interopRequireDefault(i(118)),l=_interopRequireDefault(i(73)),d=_interopRequireDefault(i(10)),c=_interopRequireDefault(i(23));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=100,a=function(o){function BuildingTimer(t,e){var i;void 0===e&&(e={}),(i=o.call(this,t,e)||this).entity=t,i.hudContainer=new h.Container,i.text=new h.Text("",l.default.getStyle("countdown")),i.text.anchor.set(.5,.75),i.hudContainer.addChild(i.text),i.timeBarContainer=new h.Container,i.hudContainer.addChild(i.timeBarContainer),i.backBack=new h.Sprite.from("bar_ticker_01.png"),i.backBack.x=.5*-i.backBack.width,i.backBar=new h.Sprite.from("bar_ticker_02.png"),i.backBar.x=.5*-i.backBar.width,i.timeBar=new h.Sprite.from("bar_ticker_03.png"),i.timeBar.x=.5*-i.timeBar.width,i.timeBar.y=.5*i.backBack.height,i.timeBar.anchor.set(0,.5),i.timeBar.tint="0x94f846",i.timerContainer=new h.Container,i.timeBarContainer.addChild(i.timerContainer),i.timerContainer.y=10,i.timerContainer.addChild(i.backBack),i.timerContainer.addChild(i.backBar),i.timerContainer.addChild(i.timeBar),i.sprite=new h.Sprite.from("fast_build-up.png"),i.sprite.anchor.set(.5),i.sprite.scale.set(.6),i.timeBarContainer.addChild(i.sprite);var n=.65,r=-32,a=32,s=.55;return c.default.instance.desktop||(i.sprite.scale.set(.9),n=.44,r=-41,a=28,s=.35),i.timerContainer.scale.set(.5),i.valueLabel=new d.default({text:"2500",fill:16777215,fontSize:a,anchorX:1,x:i.sprite.width*n,y:-2}),i.sprite.addChild(i.valueLabel),i.sprite.y=r,i.hudContainer.visible=!1,t.view.addChild(i.hudContainer),i.hudContainer.scale.y=1.4,u=i.sprite.width*s,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BuildingTimer,o);var t=BuildingTimer.prototype;return t.temporaryHide=function(){this.tempHide=!0,this.hudContainer.visible=!1},t.destroy=function(){this.hudContainer.visible=!1},t.reset=function(){this.hudContainer.rotation=-this.entity.gridSystem.gridRotation},t.show=function(){this.entity.placedBuildingData.isBuilt||(this.entity.view.setChildIndex(this.hudContainer,this.entity.view.children.length-1),this.hudContainer.visible=!0,this.tempHide&&delete this.tempHide)},t.update=function(t){this.text.text=r.default.fancyTimeFormat(t.timer+1),this.timeBar.scale.x=t.getScale(),this.valueLabel.text=t.getFastbuildPrice().toString(),this.valueLabel.width>u&&(this.valueLabel.width=u,this.valueLabel.scale.y=this.valueLabel.scale.x)},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(BuildingTimer,[{key:"visible",get:function(){return this.hudContainer.visible}}]),BuildingTimer}(n.default);e.default=a},720:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(43)),a=_interopRequireDefault(i(118)),s=_interopRequireDefault(i(73));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(n){function RevenueTimer(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).entity=t,i.hudContainer=new r.Container,i.text=new r.Text("",s.default.getStyle("countdown")),i.text.anchor.set(.5,.75),i.timeBarContainer=new r.Container,i.hudContainer.addChild(i.timeBarContainer),i.backBack=new r.Sprite.from("bar_ticker_01.png"),i.backBack.x=.5*-i.backBack.width,i.backBar=new r.Sprite.from("bar_ticker_02.png"),i.backBar.x=.5*-i.backBar.width,i.timeBar=new r.Sprite.from("bar_ticker_03.png"),i.timeBar.x=.5*-i.timeBar.width,i.timeBar.y=.5*i.backBack.height,i.timeBar.anchor.set(0,.5),i.timeBar.tint="0xffaf3c",i.timerContainer=new r.Container,i.timeBarContainer.addChild(i.timerContainer),i.timerContainer.y=10,i.timerContainer.addChild(i.backBack),i.timerContainer.addChild(i.backBar),i.timerContainer.addChild(i.timeBar),i.timerContainer.scale.set(.5,.75),t.view.addChild(i.hudContainer),i.hudContainer.scale.set(.75),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(RevenueTimer,n);var t=RevenueTimer.prototype;return t.temporaryHide=function(){this.tempHide=!0,this.hudContainer.visible=!1},t.destroy=function(){this.hudContainer.visible=!1},t.reset=function(){this.hudContainer.rotation=-this.entity.gridSystem.gridRotation},t.hide=function(){},t.show=function(){this.entity.view.setChildIndex(this.hudContainer,this.entity.view.children.length-1),this.hudContainer.visible=!0},t.update=function(t){0!=t.buildingData.revenue?t.toCollect?(this.text.visible=!1,this.timeBarContainer.visible=!1):(this.text.visible=!0,this.timeBarContainer.visible=!0,this.text.text=a.default.fancyTimeFormat(t.buildingData.timeToRevenue-t.revenueTimer+1),this.timeBar.scale.x=t.getRevenueScale()):this.hudContainer.visible=!1},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(RevenueTimer,[{key:"visible",get:function(){return this.hudContainer.visible}}]),RevenueTimer}(n.default);e.default=o},721:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var a=function(n){function Fire(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).container=new r.Container,t.view.addChild(i.container),i.container.rotation=-t.gridSystem.gridRotation,i.container.scale.set(.2,.3),i.flameList=[],i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Fire,n);var t=Fire.prototype;return t.setFire=function(t,e){if(void 0===e&&(e=window.OPT?7:10),t)for(var i=0;i<e;i++){var n=this.addFlame();n.sin=0,n.flipTimer=n.defaultFlipTimer=1.15,this.flameList.push(n);var r=Math.random()<.5?-1:1;n.direction=r,n.scale.x*=r,n.y=Math.random()*(.35*t.height)*r;var a=n.width*(.5+.25*Math.random());n.x=-this.entity.view.width+i*a}},t.addFlame=function(){var t=new r.Sprite.from("fire.png");return t.anchor.set(.5,1),this.container.addChild(t),t},t.removeAll=function(){for(var t=0;t<this.flameList.length;t++){var e=this.flameList[t];e.parent&&e.parent.removeChild(e)}this.flameList=[],this.container.x=0},t.update=function(){for(var t=0;t<this.flameList.length;t++){var e=this.flameList[t];e.sin+=1/60;var i=(e.sin- -.9)/.4,n=.2*Math.sin(i)+.8;e.scale.set(n*e.direction,n),0<e.flipTimer?e.flipTimer-=1/60:(e.flipTimer=e.defaultFlipTimer,e.direction*=-1)}},Fire}(((n=i(43))&&n.__esModule?n:{default:n}).default);e.default=a},722:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(43)),s=_interopRequireDefault(i(274));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var r=function(r){function EventPeopleManager(t,e){var i;void 0===e&&(e={}),(i=r.call(this,t,e)||this).grid=e.grid,i.eventPeopleAmount=5,i.eventPeople=[],i.eventPeopleContainerBehind=new a.Container,i.eventPeopleContainerFront=new a.Container;for(var n=0;n<i.eventPeopleAmount;n++)i.eventPeople[n]=new s.default("fireman"),i.eventPeople[n].rotation=-i.grid.gridRotation,i.eventPeople[n].visible=!1,i.eventPeopleContainerBehind.addChild(i.eventPeople[n]);return i.firemanTexture=a.Texture.from("fireman/fireman-1_00003.png"),i.copTexture=a.Texture.from("cop/cop-1_00003.png"),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(EventPeopleManager,r);var t=EventPeopleManager.prototype;return t.resetEventPeople=function(t,e){var i=t.buildingContainer.getChildIndex(t.sprite);t.buildingContainer.addChildAt(this.eventPeopleContainerFront,i+1),t.buildingContainer.addChildAt(this.eventPeopleContainerBehind,i),t.people.visible=!1;var n=t.areaGrid.width,r=t.areaGrid.height,a="fire"===e?"fireman":"cop",s="fire"===e?this.firemanTexture:this.copTexture;this.eventPeoplePaths=[[{x:-n/2+10,y:-r/2+10,dir:1,anim:"down",next:1,behind:!0},{x:-n/2+10,y:r/2-10,dir:1,anim:"down",next:2,behind:!0},{x:n/2.5-10,y:r/2-10,dir:-1,anim:"down",next:3,behind:!1},{x:n/2-10,y:r/2-10,dir:-1,anim:"down",next:4,behind:!1},{x:n/2-10,y:r/3,dir:-1,anim:"up",next:5,behind:!1},{x:n/2-10,y:r/2-10,dir:1,anim:"down",next:6,behind:!1},{x:10,y:r/2-10,dir:1,anim:"up",next:3,behind:!1}],[{x:-n/2+10,y:-r/2+10,dir:-1,anim:"down",next:1,behind:!0},{x:n/2-10,y:-r/2+10,dir:-1,anim:"down",next:2,behind:!0},{x:n/2-10,y:r/4-25,dir:1,anim:"down",next:3,behind:!1},{x:n/2-10,y:r/3-10,dir:1,anim:"down",next:4,behind:!1},{x:n/2-10,y:-10,dir:-1,anim:"up",next:3,behind:!1}],[{x:-n/2+10,y:-r/2+10,dir:1,anim:"down",next:1,behind:!0},{x:-n/2+10,y:r/2-10,dir:1,anim:"down",next:2,behind:!0},{x:0,y:n/2-10,dir:-1,anim:"down",next:3,behind:!1},{x:10,y:r/2-10,dir:-1,anim:"down",next:4,behind:!1},{x:-n/2+10,y:r/2-10,dir:1,anim:"up",next:3,behind:!1}],[{x:-n/2+10,y:-r/2+10,dir:-1,anim:"down",next:1,behind:!0},{x:n/2-10,y:-r/2+10,dir:-1,anim:"down",next:2,behind:!0},{x:n/2-10,y:-r/4+2.5,dir:1,anim:"down",next:3,behind:!1},{x:n/2-10,y:-r/2+10,dir:-1,anim:"up",next:4,behind:!1},{x:-10,y:-r/2+10,dir:1,anim:"up",next:5,behind:!0},{x:n/2-10,y:-r/2+10,dir:-1,anim:"down",next:6,behind:!0},{x:n/2-10,y:-r/4+2.5,dir:1,anim:"down",next:3,behind:!1}],[{x:-n/2+10,y:-r/2+10,dir:1,anim:"down",next:1,behind:!0},{x:-n/2+10,y:r/2-10,dir:1,anim:"down",next:2,behind:!0},{x:-n/2.5+10,y:r/2-10,dir:-1,anim:"down",next:3,behind:!1},{x:-n/2+10,y:r/2-10,dir:1,anim:"up",next:4,behind:!1},{x:-n/2+10,y:-r/2+40,dir:-1,anim:"up",next:5,behind:!0},{x:-n/2+10,y:r/2-20,dir:1,anim:"down",next:4,behind:!0}]];for(var o=0;o<this.eventPeople.length;o++){var h=this.eventPeople[o],l=h.animationManager;h.sprite.texture=s,h.scale.x=t.areaGrid.width/h.width*.1,h.scale.y=1.54*Math.abs(h.scale.x),h.setAnimationPoints(this.eventPeoplePaths[o]),l.reset(),l.addAnimation("down",a+"/"+a+"-1_000",15,1.5,{loop:!0}),l.addAnimation("up",a+"/"+a+"-2_000",15,1.5,{loop:!0}),l.addAnimation("stopdown",[a+"/"+a+"-2_00003.png"],0,.1),l.addAnimation("stopup",[a+"/"+a+"-2_00003.png"],0,.1)}},t.animateEventPeople=function(){for(var t=0;t<this.eventPeople.length;t++){var e=this.eventPeople[t],i=this.eventPeoplePaths[t];e.visible=!0,e.x=i[0].x,e.y=i[0].y,this.updateEventPeopleAction(this,e,i,0,t/5)}},t.updateEventPeopleAction=function(t,e,i,n,r){void 0===r&&(r=0);var a=i[n].next,s=i[a],o=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2));e.sprite.scale.x=s.dir,e.currentAnimation=s.anim,TweenLite.to(e,.013*o,{x:s.x,y:s.y,ease:Linear.easeInOut,delay:r,onComplete:t.updateEventPeopleAction,onCompleteParams:[t,e,i,a]}),s.behind?(t.eventPeopleContainerFront.removeChild(e),t.eventPeopleContainerBehind.addChild(e)):(t.eventPeopleContainerBehind.removeChild(e),t.eventPeopleContainerFront.addChild(e))},t.removeEventPeopleFromTile=function(t){for(var e=0;e<this.eventPeople.length;e++){var i=this.eventPeople[e];i.visible=!1,this.eventPeopleContainerFront.removeChild(i),this.eventPeopleContainerBehind.addChild(i)}t.buildingContainer.removeChild(this.eventPeopleContainerBehind),t.buildingContainer.removeChild(this.eventPeopleContainerFront)},t.update=function(t){for(var e=0;e<this.eventPeople.length;e++){var i=this.eventPeople[e];"stopup"!==i.currentAnimation&&(i.animationManager.updateAnimation(t),i.animationManager.play(i.currentAnimation),i.sprite.texture=i.animationManager.currentTexture)}},EventPeopleManager}(n.default);e.default=r},723:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;!function(t){{if(t&&t.__esModule)return;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}e.default=t}}(i(1));var n=function(){function Zone(t){this.game=t,this.i=0,this.j=0,this.roads=[],this.tiles=[],this.trafficWaypoints=[],this.id=0,this.grid=null,this.locked=!0,this.neighbours=[]}var t=Zone.prototype;return t.unlock=function(){this.locked=!1;for(var t=0;t<this.tiles.length;t++){this.tiles[t].unlock()}},t.lock=function(){this.locked=!0;for(var t=0;t<this.tiles.length;t++){this.tiles[t].lock()}},t.updateZoneFences=function(){for(var t=0;t<this.tiles.length;t++){this.tiles[t].updateFences()}},t.getTile=function(t,e){for(var i=0;i<this.tiles.length;i++){var n=this.tiles[i];if(n.i==t&&n.j==e)return n}return null},Zone}();e.default=n},724:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function TrafficWaypoint(t){this.id="",this.i,this.j,this._x,this._y,this.iGlobal,this.jGlobal,this._zone,t&&(this.graph=(new n.Graphics).beginFill(65280).drawCircle(0,0,5))}return function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(TrafficWaypoint,[{key:"x",set:function(t){this._x=t,this.graph&&(this.graph.x=t)},get:function(){return this._x}},{key:"y",set:function(t){this._y=t,this.graph&&(this.graph.y=t)},get:function(){return this._y}},{key:"zone",set:function(t){this._zone=t,this.iGlobal=this.i+this._zone.grid.i*this._zone.i,this.jGlobal=this.j+this._zone.grid.j*this._zone.j,this.graph&&(this.text=new n.Text(this.i+" - "+this.j),this.graph.addChild(this.text))}}]),TrafficWaypoint}();e.default=r},725:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var _=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var n=function(){function GridDressing(){}return GridDressing.prototype.build=function(t){this.grid=t,this.fullMapGrid=this.grid.fullMapGrid,this.areaGrid=this.grid.areaGrid,this.container=new _.Container,this.grid.roadContainer.addChild(this.container),this.dressingList=[];var e={topRight:{i:-1,j:-1,x:0,y:0,tile:"road_edge_left.png"},topLeft:{i:this.fullMapGrid.j*this.areaGrid.i,j:-1,x:0,y:0,tile:"road_edge_bottom.png"},bottomLeft:{i:this.fullMapGrid.j*this.areaGrid.i,j:this.fullMapGrid.i*this.areaGrid.j,x:0,y:0,tile:"road_edge_right.png"},bottomRight:{i:-1,j:this.fullMapGrid.i*this.areaGrid.j,x:0,y:0,tile:"road_edge_top.png"},top:{tile:"road_edge_left_top.png"},bottom:{tile:"road_edge_right_bottom.png"},left:{tile:"road_edge_left_bottom.png"},right:{tile:"road_edge_right_top.png"}},i=this.areaGrid.totalWidth,n=this.areaGrid.totalHeight;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r],s=new _.Sprite.from(a.tile);s.scale.set(this.areaGrid.width/s.width,this.areaGrid.height/s.height),this.container.addChild(s),s.x=a.j*(this.areaGrid.width+this.areaGrid.road)-i/2,s.y=a.i*(this.areaGrid.height+this.areaGrid.road)-n/2,"topRight"==r&&(s.x+=.5*this.areaGrid.road,s.y+=.5*this.areaGrid.road),"topLeft"==r&&(s.x+=.5*this.areaGrid.road,s.y-=.5*this.areaGrid.road),"bottomLeft"==r&&(s.x-=.5*this.areaGrid.road,s.y-=.5*this.areaGrid.road),"bottomRight"==r&&(s.x-=.5*this.areaGrid.road,s.y+=.5*this.areaGrid.road),e[r].x=s.x,e[r].y=s.y}for(var o=e.bottomLeft.i-e.bottomRight.i-1,h=0;h<o;h++){var l=this.areaGrid.road,d=new _.Sprite.from(e.right.tile);d.scale.set(this.areaGrid.width/d.width,(this.areaGrid.height+l)/d.height),this.container.addChild(d),this.dressingList.push(d),d.x=e.bottomLeft.x,d.y=h*(this.areaGrid.height+this.areaGrid.road)-n/2-.5*this.areaGrid.road}for(var c=0;c<o;c++){var u=this.areaGrid.road,p=new _.Sprite.from(e.left.tile);p.scale.set(this.areaGrid.width/p.width,(this.areaGrid.height+u)/p.height),this.container.addChild(p),this.dressingList.push(p),p.x=e.topRight.x,p.y=c*(this.areaGrid.height+this.areaGrid.road)-n/2-.5*this.areaGrid.road}for(var f=e.bottomLeft.j-e.topLeft.j-1,g=0;g<f;g++){var m=this.areaGrid.road,v=new _.Sprite.from(e.top.tile);v.scale.set((this.areaGrid.width+m)/v.width,this.areaGrid.height/v.height),this.container.addChild(v),this.dressingList.push(v),v.x=g*(this.areaGrid.width+this.areaGrid.road)-i/2-.5*this.areaGrid.road,v.y=e.topRight.y}for(var b=0;b<f;b++){var y=this.areaGrid.road,w=new _.Sprite.from(e.bottom.tile);w.scale.set((this.areaGrid.width+y)/w.width,this.areaGrid.height/w.height),this.container.addChild(w),this.dressingList.push(w),w.x=b*(this.areaGrid.width+this.areaGrid.road)-i/2-.5*this.areaGrid.road,w.y=e.bottomLeft.y}},GridDressing}();e.default=n},726:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),a=(_interopRequireDefault(i(271)),_interopRequireDefault(i(727))),s=_interopRequireDefault(i(728)),o=_interopRequireDefault(i(4)),h=(_interopRequireDefault(i(168)),i(7));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var l=function(n){function BuildingsSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.app=t.game.app,i.buildingBuyContainer=new r.Container,i.blockScreen=(new r.Graphics).beginFill(0).drawRect(-2500,-2500,5e3,5e3),i.blockScreen.alpha=.65,i.blockScreen.interactive=!0,i.blockScreen.pointerdown=function(){i.hide()},i.buildingBuyContainer.addChild(i.blockScreen),i.game.view.ui.addChild(i.buildingBuyContainer),i.buildingBuyContainer.visible=!1,i.buildingBuyContainer.interactive=!0,i.cardsContainer=new r.Container,i.buildingBuyContainer.addChild(i.cardsContainer),i.blueprintsPanel=new s.default(i.game),i.cardsContainer.addChild(i.blueprintsPanel),i.blueprintsPanel.onCardSelected.add(function(t){i.cardSelected(t)}),i.inventoryContainer=new r.Container,i.onboardBuildingFunc=null,i.onboardCardFunc=null,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BuildingsSystem,n);var t=BuildingsSystem.prototype;return t.hide=function(){this.hideAll()},t.removeCardHighlight=function(){this.blockScreen.interactive=!0,this.blueprintsPanel.cancelButton.visible=!0,this.blueprintsPanel.removeCardHighlight()},t.highlightCard=function(t){return this.blockScreen.interactive=!1,this.onboardCardFunc=t,this.blueprintsPanel.highlightCard()},t.highlightFirst=function(t,e){return void 0===t&&(t=0),this.blockScreen.interactive=!1,this.blueprintsPanel.cancelButton.visible=!1,this.onboardBuildingFunc=e,this.blueprintsPanel.highlightFirst(t)},t.removeHightlight=function(){this.blockScreen.interactive=!0,this.blueprintsPanel.removeHightlight()},t.updateBuilding=function(t){this.blueprintsPanel.updateBuilding(t)},t.cardSelected=function(t){var i=this;if(this.hideAll(),6<=this.game.onboard.onboardingData.step&&this.game.hud.show(),!this.currentTileSlected.placedBuildingData){var e=this.inventory.placeBuilding(this.currentTileSlected,t.buildingData);this.currentTileSlected.addBuilding(t.buildingData),this.inventory.UID++,this.inventory.saveBuildings(this.currentTileSlected,t.buildingData,e);for(var n=0;n<t.buildingData.requirementPieces.length;n++){var r=t.buildingData.requirementPieces[n];this.game.inventory.inventory.getPieceById(r.id).value-=r.value}var a=this.currentTileSlected;this.inventory.savePieces();var s=a.onBuildingBuilt.add(function(){var t=!!a.currentBuilding&&"Fire Station"===a.currentBuilding.name,e=!!a.currentBuilding&&"Police Station"===a.currentBuilding.name;i.game.checkDistrictSupport(t,e),s.detach(),i.game.hud&&i.game.hud.updateDropdown()})}},t.build=function(){if(!this.built){this.built=!0,this.game.grid.onTileSelected.add(this.tileSelected,this),this.currentTileSlected=null,this.blueprintsPanel.build(),this.inventory=this.game.inventory.inventory,this.piecesList=[],this.buildingList=[];for(var t=0;t<this.inventory.pieces[0].length;t++){var e=this.inventory.pieces[0][t],i=new a.default(this.game);i.build(e),this.piecesList.push(i),this.inventoryContainer.addChild(i.view),i.y=(i.view.height+20)*t}this.updateValues()}},t.updateValues=function(){for(var t=0;t<this.piecesList.length;t++){this.piecesList[t].update()}},t.destroyCurrentBuilding=function(){this.inventory.removeBuilding(this.currentTileSlected),this.currentTileSlected.destroyBuilding(),this.game.checkDistrictSupport()},t.tileSelected=function(t){this.currentTileSlected=t,this.currentTileSlected.currentBuilding?(this.game.grid.lockOnBuilding(this.currentTileSlected),this.game.hud.showDestroyBuilding(this.currentTileSlected)):(this.showAll(),this.game.hud.hide()),this.updateValues(),this.game.hud.hideHint()},t.showInventory=function(){this.game.hud.hide(),this.inventoryContainer.visible=!0,this.buildingBuyContainer.visible=!0},t.showBuildingsList=function(){this.game.hud.hide(),this.cardsContainer.visible=!0,this.buildingBuyContainer.visible=!0},t.showAll=function(){this.blueprintsPanel.show(this.currentTileSlected),this.showInventory(),this.showBuildingsList(),this.game.state.setState("menu")},t.hideAll=function(){var t=this;o.default.to(this.blueprintsPanel.container.scale,.15,{x:.75,y:.75,ease:h.Back.easeIn,onComplete:function(){t.inventoryContainer.visible=!1,t.cardsContainer.visible=!1,t.buildingBuyContainer.visible=!1,t.game.state.setState("game"),t.game.hud.show()}})},t.postupdate=function(){},t.resize=function(t,e){this.blueprintsPanel.resize(t,e),this.inventoryContainer.x=-this.app.game.w/2+10,this.inventoryContainer.y=this.cardsContainer.y},BuildingsSystem}(n.default);e.default=l},727:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));_interopRequireDefault(i(43)),_interopRequireDefault(i(4)),i(7),_interopRequireDefault(i(8));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var r=function(e){function PieceCard(){var t;return(t=e.call(this)||this).background=(new n.Graphics).beginFill(6645247).drawRect(0,0,100,50),t.view.addChild(t.background),t.view.interactive=!0,t.view.buttonMode=!0,t.text=new n.Text,t.text.style.fill=16777215,t.text.style.fontSize=18,t.text.style.align="right",t.text.anchor.x=1,t.text.anchor.y=.5,t.view.addChild(t.text),t.text.text="X 2",t.text.x=t.background.width-10,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(PieceCard,e);var t=PieceCard.prototype;return t.update=function(){this.text.text="X "+this.pieceData.value},t.build=function(t){this.pieceData=t,this.sprite=n.Sprite.from(this.pieceData.image),this.sprite.scale.set((this.background.height-20)/this.sprite.height),this.sprite.anchor.y=.5,this.sprite.x=10,this.sprite.y=this.background.height/2,this.text.text="X "+this.pieceData.value,this.text.y=this.background.height/2,this.view.addChild(this.sprite)},PieceCard}(_interopRequireDefault(i(119)).default);e.default=r},728:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=(_interopRequireDefault(i(10)),_interopRequireDefault(i(729))),a=_interopRequireDefault(i(731)),s=i(7),o=_interopRequireDefault(i(8)),h=_interopRequireDefault(i(29)),l=_interopRequireDefault(i(169)),d=_interopRequireDefault(i(732)),c=_interopRequireDefault(i(13));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var u=function(i){function BlueprintPanel(t){var e;return(e=i.call(this)||this).container=new n.Container,e.addChild(e.container),e.inOnboard=!1,e.blackShape=(new n.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),e.addChild(e.blackShape),e.blackShape.alpha=.5,e.blackShape.interactive=!0,e.cardContainer=new n.Container,e.addChild(e.cardContainer),e.mainContainer=new n.Container,e.container.addChild(e.mainContainer),e.backPanel=n.Sprite.from("back_panel_blueprints.png"),e.mainContainer.addChild(e.backPanel),e.blackShape.interactive=!0,e.blackShape.buttonMode=!0,e.blackShape.pointerdown=function(){e.inOnboard||e.hideCard()},e.topContainer=new l.default,e.mainContainer.addChild(e.topContainer),e.topContainer.text=c.default.get("blueprints_title"),e.game=t,e.blueprintScroll=new a.default(t),e.mainContainer.addChild(e.blueprintScroll),e.interactive=!0,e.blueprintContainer=new r.default(t),e.cardContainer.addChild(e.blueprintContainer),e.cancelButton=new h.default({base:"button_no.png"}),e.mainContainer.addChild(e.cancelButton),e.cancelButton.x=e.backPanel.width-40,e.cancelButton.y=40,e.cancelButton.onTap=function(){e.game.buildings.hide()},e.blueprintScroll.onBuildingSelect.add(function(t){e.updateBuilding(t)}),e.blueprintContainer.onCardSelected.add(function(t){e.onCardSelected.dispatch(t)}),e.blueprintContainer.onCardCancel.add(function(t){e.hideCard()}),e.blueprintContainer.onDig.add(function(t){e.hideCard(),e.game.buildings.hideAll(),e.game.onDig(t)}),e.blurFilter=new n.filters.BlurFilter(5),e.onCardSelected=new o.default,e.sidePanel=new d.default(t),e.container.addChild(e.sidePanel),e.sidePanel.onBuildingSelect.add(function(t){e.updateBuilding(t)}),e.container.pivot.set(.5*e.container.width,.5*e.container.height),e.cardContainer.pivot.set(.5*e.cardContainer.width,.5*e.cardContainer.height),e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BlueprintPanel,i);var t=BlueprintPanel.prototype;return t.highlightCard=function(){return this.inOnboard=!0,this.blueprintContainer.blueprintCard.cancelButton.visible=!1,this.blueprintContainer.blueprintCard.buildButton},t.removeCardHighlight=function(){this.inOnboard=!1,this.blueprintContainer.blueprintCard.cancelButton.visible=!0},t.highlightFirst=function(t){void 0===t&&(t=0),this.blueprintScroll.scroller.disable(),this.sidePanel.lockAll(),this.blueprintScroll.lockAll();return t<2?this.sidePanel.highlightFirst(t):(t=-2+t,this.blueprintScroll.highlightFirst(t))},t.removeHightlight=function(){this.blueprintScroll.unlockAll(),this.sidePanel.unlockAll(),this.blueprintScroll.scroller.enable()},t.show=function(t){var e=this,i=this.game.grid.getZoneByOrder(t.zone.id);this.updateScroll(i.id),this.hideCard(!0),this.blueprintScroll.scroller.interactiveChildren=!0,this.blueprintScroll.updateCards(),this.sidePanel.updateCards(),this.blueprintScroll.lockByZones(),this.container.scale.set(.75),s.TweenLite.to(this.container.scale,.15,{x:1,y:1,ease:s.Back.easeOut,onComplete:function(){e.game.buildings.onboardBuildingFunc&&(e.game.buildings.onboardBuildingFunc(),e.game.buildings.onboardBuildingFunc=null)}})},t.build=function(){this.blueprintScroll.build(),this.sidePanel.build(this.game.inventory.inventory.buildings),this.mainContainer.x=.75*this.sidePanel.width,this.sidePanel.y=.5*this.backPanel.height},t.updateScroll=function(t){this.blueprintScroll.updateScroll(t)},t.hideCard=function(t){var e=this;void 0===t&&(t=!1);function JV(){e.cardContainer.filters=[],e.blueprintScroll.scroller.interactiveChildren=!0,e.cardContainer.visible=!1,e.blackShape.visible=!1}s.TweenLite.to(this.cardContainer.scale,.15,{x:.75,y:.75,ease:s.Back.easeIn,onComplete:function(){JV()}}),t&&JV(),s.TweenLite.to(this.blackShape,t?0:.25,{alpha:0})},t.updateBuilding=function(t){var e=this;this.cardContainer.visible=!0,this.cardContainer.alpha=1,this.cardContainer.scale.set(.75),s.TweenLite.to(this.cardContainer.scale,.15,{x:1,y:1,ease:s.Back.easeOut,onComplete:function(){e.game.buildings.onboardCardFunc&&(e.game.buildings.onboardCardFunc(),e.game.buildings.onboardCardFunc=null)}}),s.TweenLite.to(this.blackShape,.25,{alpha:.5}),this.blueprintScroll.scroller.interactiveChildren=!1,this.blackShape.visible=!0,this.blueprintContainer.updateBuilding(t)},t.updateCoins=function(t){this.topContainer.updateCoins(t)},t.resize=function(t,e){this.w=t,this.h=e,this.container.scale.set(e/this.container.height*.75*this.container.scale.y),this.cardContainer.y=.2*-this.cardContainer.height,this.blueprintContainer.resize(this.backPanel.width,this.backPanel.height),this.blueprintScroll.x=this.backPanel.width/2-this.blueprintScroll.scroller.rect.w/2,this.blueprintScroll.y=75,this.container.scale.set(1),this.w/this.container.width<1&&this.container.scale.set(this.w/this.container.width*.85*this.container.scale.x),this.h/this.container.height<1&&this.container.scale.set(this.h/this.container.height*.85*this.container.scale.y),this.cardContainer.scale.set(this.container.scale.x,this.container.scale.y),this.topContainer.resize(this.backPanel.width,this.backPanel.height)},BlueprintPanel}(n.Container);e.default=u},729:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=(_interopRequireDefault(i(10)),i(7),_interopRequireDefault(i(8))),a=_interopRequireDefault(i(730));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(i){function BlueprintContainer(t){var e;return(e=i.call(this)||this).container=new n.Container,e.addChild(e.container),e.blueprintCard=new a.default(t),e.container.addChild(e.blueprintCard),e.blueprintCard.onCardSelected.add(function(t){e.onCardSelected.dispatch(t)}),e.blueprintCard.onCardCancel.add(function(t){e.onCardCancel.dispatch(t)}),e.blueprintCard.onDig.add(function(t){e.onDig.dispatch(t)}),e.onCardSelected=new r.default,e.onCardCancel=new r.default,e.onDig=new r.default,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BlueprintContainer,i);var t=BlueprintContainer.prototype;return t.updateBuilding=function(t){this.blueprintCard.updateBuilding(t)},t.resize=function(t,e){this.blueprintCard.scale.set(e/this.blueprintCard.height*1*this.blueprintCard.scale.y)},BlueprintContainer}(n.Container);e.default=s},73:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=new(function(){function TextManager(){this.styles={blueprintRequirments:{fill:16777215,fontSize:24,fontFamily:"young"},blueprintTitle:{fill:16777215,fontSize:24,fontFamily:"young"},countdown:{fill:16777215,fontSize:18,fontFamily:"young",align:"center",stroke:0,strokeThickness:3,fontWeight:"bold"}}}var t=TextManager.prototype;return t.getMainStyle=function(){return{fill:16777215,fontSize:12,align:"right",fontFamily:"young"}},t.getTitleStyle=function(){return{fill:16777215,fontSize:12,align:"right",fontFamily:"young"}},t.getStyle=function(t){var e={},i=this.styles[t];for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);return e},TextManager}());e.default=n},730:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var h=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),l=_interopRequireDefault(i(10)),n=(i(7),_interopRequireDefault(i(118))),d=_interopRequireDefault(i(8)),c=_interopRequireDefault(i(29)),u=(_interopRequireDefault(i(73)),_interopRequireDefault(i(13)));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var r=function(o){function BlueprintCard(t){var e;(e=o.call(this)||this).container=new h.Container,e.addChild(e.container),e.game=t,e.cardBackPanel=h.Sprite.from("card.png"),e.cardBackPanel.interactive=!0,e.container.scale.set(.7),e.container.addChild(e.cardBackPanel),e.buildButtons=new h.Container,e.container.addChild(e.buildButtons),e.digButtons=new h.Container,e.container.addChild(e.digButtons),e.buildButton=new c.default({base:"button_yes.png"}),e.buildButtons.addChild(e.buildButton),e.buildButton.x=2*e.buildButton.width,e.buildButton.onTap=function(){e.locked||e.onCardSelected.dispatch(_assertThisInitialized(e))},e.cancelButton=new c.default({base:"button_no.png"}),e.buildButtons.addChild(e.cancelButton),e.cancelButton.x=e.cardBackPanel.width-160,e.cancelButton.onTap=function(){e.locked||e.onCardCancel.dispatch(_assertThisInitialized(e))},e.digButton=new c.default({base:"button_blue.png",icon:"icon_dig.png",downDepth:5}),e.digButtons.addChild(e.digButton),e.digButton.x=e.buildButton.x,e.digButton.y=e.buildButton.y,e.digButton.onTap=function(){e.locked||e.onDig.dispatch(_assertThisInitialized(e))},e.buildButtons.addChild(e.digButton),e.buildButtons.y=e.cardBackPanel.height-.9*e.buildButtons.height,e.buildButtons.x=.25*e.buildButtons.width-.25*e.cancelButton.width,e.locked=!1,e.onCardSelected=new d.default,e.onCardCancel=new d.default,e.onDig=new d.default,e.buildingImage=new h.Sprite.from(h.Texture.EMPTY),e.container.addChild(e.buildingImage),e.buildingImage.x=260,e.buildingImage.y=150,e.bricks=[],e.bricksContainer=new h.Container,e.container.addChild(e.bricksContainer),e.bricksContainer.x=35,e.bricksContainer.y=70;for(var i=0;i<3;i++){var n=new h.Container,r=h.Sprite.from("brick_bar_green.png");n.addChild(r),n.y=i*(r.height+15),e.bricksContainer.addChild(n);var a=h.Sprite.from("brick_d1_05.png");n.addChild(a),a.height=.8*r.height,a.scale.x=a.scale.y,a.anchor.set(.5),a.x=.25*r.width,a.y=.5*r.height;var s=new l.default({text:"",fill:16777215,padding:10,fontSize:18,anchorX:1,x:.95*r.width,y:.5*r.height});n.addChild(s),e.bricks.push({container:n,cardBackPanel:r,brick:a,text:s})}return e.revenueContainer=new h.Container,e.container.addChild(e.revenueContainer),e.buildTimer=new l.default({text:"",fill:16777215,padding:10,fontSize:25,anchorX:1,x:335,y:225}),e.cardBackPanel.addChild(e.buildTimer),e.coinRevenue=new l.default({text:"",fill:16777215,padding:10,fontSize:15}),e.revenueContainer.addChild(e.coinRevenue),e.timeRevenue=new l.default({text:"",fill:16777215,padding:10,fontSize:18,x:.375*e.cardBackPanel.width}),e.revenueContainer.addChild(e.timeRevenue),e.revenueContainer.x=.5*e.cardBackPanel.width-.3*e.revenueContainer.width,e.revenueContainer.y=.62*e.cardBackPanel.height,e.name=new l.default({text:"",fill:16777215,padding:10,fontSize:18,y:37,x:e.cardBackPanel.width/2}),e.cardBackPanel.addChild(e.name),e.actionDescription=new l.default({text:u.default.get("blueprints_build"),fill:16777215,padding:10,fontSize:18,y:.77*e.cardBackPanel.height,x:.5*e.cardBackPanel.width}),e.cardBackPanel.addChild(e.actionDescription),e.canBuy=!1,e.canAfford=!1,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BlueprintCard,o);var t=BlueprintCard.prototype;return t.updateBuilding=function(t){this.buildingData=t,this.canAffordDig(),this.buildingImage.texture=h.Texture.from(t.image),this.buildingImage.anchor.set(.5),this.buildingImage.scale.set(Math.min(150/this.buildingImage.height*this.buildingImage.scale.x,150/this.buildingImage.width*this.buildingImage.scale.x));var e=this.buildingData.name.replace(/ /g,"_");e=e.toLowerCase(),this.name.text=u.default.get("building_"+e),this.coinRevenue.text=this.buildingData.revenue+" "+u.default.get("coins"),this.timeRevenue.text=n.default.fancyTimeFormat(this.buildingData.timeToRevenue),this.buildTimer.text=n.default.fancyTimeFormat(this.buildingData.timeToBuild),this.updatePieces()},t.canAffordDig=function(){this.canAfford=this.game.dig.hasEnoughMoney(this.digButton,this.buildingData.districtIndex)},t.updatePieces=function(){for(var t=0;t<this.bricks.length;t++){this.bricks[t].container.visible=!1}this.canBuy=!0;for(var e=0;e<this.buildingData.requirementPieces.length;e++){var i=this.buildingData.requirementPieces[e],n=this.game.inventory.inventory.getPieceById(i.id),r=this.bricks[e];r.container.visible=!0,r.brick.texture=h.Texture.from(n.image),r.brick.height=.9*r.cardBackPanel.height,r.brick.scale.x=r.brick.scale.y;var a=99<n.value?"99+":n.value;r.text.text=a+" / "+i.value,n.value<i.value?(r.cardBackPanel.texture=h.Texture.from("brick_bar_red.png"),this.canBuy=!1):r.cardBackPanel.texture=h.Texture.from("brick_bar_green.png")}this.canBuy?this.actionDescription.text=u.default.get("blueprints_build"):this.canAfford?this.actionDescription.text=u.default.get("blueprints_dig"):this.actionDescription.text=u.default.get("blueprints_earn"),this.bricksContainer.y=152-this.bricksContainer.height/2,this.digButton.visible=!this.canBuy,this.buildButton.visible=!this.digButton.visible},BlueprintCard}(h.Container);e.default=r},731:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var c=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),u=_interopRequireDefault(i(10)),n=(i(7),_interopRequireDefault(i(8))),r=_interopRequireDefault(i(273)),p=_interopRequireDefault(i(276)),f=(_interopRequireDefault(i(73)),_interopRequireDefault(i(13))),g=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var a=function(i){function BlueprintScroll(t){var e;return(e=i.call(this)||this).game=t,e.container=new c.Container,e.addChild(e.container),e.buildingsContainer=new c.Container,e.container.addChild(e.buildingsContainer),e.buildings=[],e.districtsList=[],e.onBuildingSelect=new n.default,e.scroller=new r.default({w:520,h:280},1.75),e.scroller.snap=!1,e.scroller.cap=!0,e.scroller.y=20,e.scroller.x=-8,e.scroller.updateCallback.add(function(){e.sliderfill.y=(e.sliderbar.height/(e.sliderbar.scale.y-.002)-e.sliderfill.height)*e.scroller.percent}),e.midPanel=c.Sprite.from("mid_panel_menu.png"),e.midPanel.anchor.set(.5),e.midPanel.scale.set(.9,.9),e.midPanel.x=e.scroller.rect.w/2,e.midPanel.y=e.scroller.rect.h/2+e.scroller.y,e.container.addChild(e.midPanel),e.container.addChild(e.scroller),e.sliderbar=c.Sprite.from("slider_bar.png"),e.container.addChild(e.sliderbar),e.sliderbar.scale.set(.5),e.sliderbar.x=e.container.width-35+e.scroller.x,e.sliderbar.y=e.midPanel.y-e.sliderbar.height/2,e.sliderfill=c.Sprite.from("slider_fill.png"),e.sliderbar.addChild(e.sliderfill),e.blocker=(new c.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),e.container.addChild(e.blocker),e.blocker.alpha=.5,e.blocker.visible=!1,e.blocker.interactive=!0,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(BlueprintScroll,i);var t=BlueprintScroll.prototype;return t.build=function(){var e=this,t=this.game.inventory.inventory.buildings;this.allThumbs=[],this.districtThumbs=[],this.firstCard={thumb:null,x:0,y:0,parent:null},this.secCard={thumb:null,x:0,y:0,parent:null},this.thirdCard={thumb:null,x:0,y:0,parent:null};for(var i=0;i<t.length-1;i++){var n=new c.Container,r=c.Sprite.from("blueprint_inventory_panel_main.png"),a=c.Sprite.from("blueprint_inventory_panel_header_tintable.png");a.tint=g.default.getColorByDistrict(i+1),r.addChild(a),n.addChild(r),this.districtsList.push(r);var s=new u.default({fill:16777215,padding:10,fontSize:30,x:r.width/2,y:23});s.text=f.default.get("district_name_"+(i+1),"fontScaleBlueprints"),r.addChild(s),n.y=n.height*i;for(var o=[],h=0;h<t[i].length;h++){var l=t[i][h],d=new p.default(this.game,i+1);d.setData(l),d.onBuildingSelect.add(function(t){(e.isOnboarding||e.scroller.getDist()<30)&&e.onBuildingSelect.dispatch(t.buildingData)}),this.allThumbs.push(d),d.scale.set((r.width-25)/d.width/5),d.x=h*(d.width+2)+10,d.y=55,n.addChild(d),o.push(d),this.firstCard.thumb?this.secCard.thumb?this.thirdCard.thumb||(this.thirdCard.thumb=d,this.thirdCard.x=d.x,this.thirdCard.y=d.y,this.thirdCard.parent=n):(this.secCard.thumb=d,this.secCard.x=d.x,this.secCard.y=d.y,this.secCard.parent=n):(this.firstCard.thumb=d,this.firstCard.x=d.x,this.firstCard.y=d.y,this.firstCard.parent=n)}this.districtThumbs.push(o),this.scroller.addItem(n,1),n.x=this.scroller.rect.w/2-n.width/2}},t.highlightFirst=function(t){this.isOnboarding=!0;var e=[this.firstCard.thumb,this.secCard.thumb,this.thirdCard.thumb],i=e[t]?e[t]:e[e.length-1];return i.unlock(),i},t.lockAll=function(){for(var t=0;t<this.allThumbs.length;t++){this.allThumbs[t].lock()}},t.lockByZones=function(){for(var t=this.game.inventory.inventory.availableZones,e=0;e<this.districtThumbs.length;e++){var i=this.districtThumbs[e],n=t<=e;n?(this.districtsList[e].tint=4210752,this.districtsList[e].children[1].alpha=.5):(this.districtsList[e].tint=16777215,this.districtsList[e].children[1].alpha=1);for(var r=0;r<i.length;r++){var a=i[r];n?a.lock():a.unlock()}}},t.unlockAll=function(){this.isOnboarding=!1,this.lockByZones()},t.updateCards=function(){for(var t=0;t<this.allThumbs.length;t++){this.allThumbs[t].updatePieces()}},t.updateScroll=function(t){this.scroller.updatePosition(t)},t.resize=function(t,e){},BlueprintScroll}(c.Container);e.default=a},732:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var o=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),h=_interopRequireDefault(i(276)),n=_interopRequireDefault(i(18));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var r=function(i){function _default(t){var e;return(e=i.call(this)||this).game=t,e.container=new o.Container,e.addChild(e.container),e.allThumbs=[],e.onBuildingSelect=new n.default,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(_default,i);var t=_default.prototype;return t.build=function(t){var e=this,i=t[t.length-1];this.backPanel=o.Sprite.from("panel_police_fire.png"),this.backPanel.anchor.set(.5),this.container.addChild(this.backPanel),this.thumbContainer=new o.Container,this.backPanel.addChild(this.thumbContainer);for(var n=0;n<i.length;n++){var r=i[n],a=0===n?48127:16749329,s=new h.default(this.game,null,null,a);s.setData(r),s.onBuildingSelect.add(function(t){e.onBuildingSelect.dispatch(t.buildingData)}),this.allThumbs.push(s),s.y=n*(1.1*s.height),this.thumbContainer.addChild(s)}this.thumbContainer.y=.5*-this.thumbContainer.height,this.thumbContainer.x=.5*-this.thumbContainer.width},t.highlightFirst=function(t){this.isOnboarding=!0;var e=this.allThumbs[t]?this.allThumbs[t]:this.allThumbs[this.allThumbs.length-1];return e.unlock(),e},t.lockAll=function(){for(var t=0;t<this.allThumbs.length;t++){this.allThumbs[t].lock()}},t.unlockAll=function(){for(var t=0;t<this.allThumbs.length;t++){this.allThumbs[t].unlock()}},t.updateCards=function(){for(var t=0;t<this.allThumbs.length;t++){this.allThumbs[t].updatePieces()}},_default}(o.Container);e.default=r},733:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var l=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),d=_interopRequireDefault(i(29)),c=_interopRequireDefault(i(734)),r=_interopRequireDefault(i(4)),a=i(7),u=_interopRequireDefault(i(735)),p=_interopRequireDefault(i(10)),f=_interopRequireDefault(i(77)),s=_interopRequireDefault(i(18)),g=_interopRequireDefault(i(736)),m=_interopRequireDefault(i(13)),o=_interopRequireDefault(i(25)),v=_interopRequireDefault(i(44)),b=_interopRequireDefault(i(737)),y=_interopRequireDefault(i(738)),w=_interopRequireDefault(i(739)),h=_interopRequireDefault(i(55)),_=_interopRequireDefault(i(41));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var C=function(n){function DigSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.view=new l.Container,i.view.visible=!1,i.attemptsRemaining=i.defaultAttempts=15,i.foundPieces=[],i.forcePieces=[],i.complete=!1,i.preventClicks=!1,i.completeTimer=i.defaultCompleteTimer=.75,i.revealTimer=i.defaultRevealTimer=.1,i.revealBricks=!1,i.bricksToReveal=[],i.revealIndex=0,i.endPanelShown=!1,i.afterReveal=!1,i.signals={tutortialReady:new s.default},i.readyToEnd=!1,i.endTimer=i.defaultEndTimer=.5,i.hasTriedAgain=!1,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DigSystem,n);var t=DigSystem.prototype;return t.build=function(){var e=this;if(!this.built){this.built=!0,this.miniGameContainer=new l.Container,this.miniGameContainer.visible=!1,this.view.addChild(this.miniGameContainer),this.background=new l.Sprite.from("background.jpg"),this.background.anchor.set(.5),this.defaultBgSize={width:this.background.width,height:this.background.height},this.miniGameContainer.addChild(this.background),this.background.interactive=!0,this.visualContainer=new l.Container,this.miniGameContainer.addChild(this.visualContainer),this.game.view.digContainer.addChild(this.view),this.digContainer=new l.Container,this.visualContainer.addChild(this.digContainer),this.grid={i:5,j:5},this.blockSize=100,this.digPanelBackground=new l.Sprite.from("game_panel.png"),this.digContainer.addChild(this.digPanelBackground),this.digPanelBackground.anchor.set(.5),this.btnClose=new d.default({base:"button_no.png",noScale:!0}),this.btnClose.onTap=this.onClose.bind(this),this.digPieces=[];this.gridData=[],this.pieceContainer=new l.Container,this.digContainer.addChild(this.pieceContainer);for(var t=null,i=null,n=0;n<this.grid.i;n++){for(var r=[],a=[],s=0;s<this.grid.j;s++){var o=new c.default(n,s);a.push(o),this.pieceContainer.addChild(o.view);var h=(this.digPanelBackground.width-10*(this.grid.i+1))/this.grid.i;o.view.scale.set(h/o.view.width),o.view.x=Math.floor(n*(o.view.width-1)),o.view.y=Math.floor(s*(o.view.height-1)),r.push(-1),t&&i||(t=.5*o.view.width,i=.5*o.view.height),o.onPieceSelected.add(function(t){e.unvealSlot(t)})}this.digPieces.push(a),this.gridData.push(r)}this.pieceContainer.x=-.5*this.pieceContainer.width+t,this.pieceContainer.y=-.5*this.pieceContainer.height+i,this.createLeftPanel(),this.possiblePieces=new u.default,this.visualContainer.addChild(this.possiblePieces),this.digSitePanel=new g.default(this.game),this.digSitePanel.build(),this.view.addChild(this.digSitePanel),this.mask=(new l.Graphics).beginFill(Math.floor(16777215*Math.random())).drawRect(0,0,this.pieceContainer.width,this.pieceContainer.height),this.mask.x=.5*-this.mask.width,this.mask.y=.5*-this.mask.height,this.digContainer.addChild(this.mask),this.pieceContainer.mask=this.mask,this.digParticles=new b.default,this.digMoreText=new p.default({text:m.default.get("dig_more"),fill:16777215,stroke:0,strokeThickness:2.5,dropShadow:!0,dropShadowDistance:5,dropShadowBlur:4.5,dropShadowAngle:.1*Math.PI,padding:10,fontSize:25}),this.view.addChild(this.digMoreText),this.digMoreText.visible=!1,this.pieceSystem=new y.default,this.pieceSystem.setup({inventory:this.game.inventory.inventory}),this.coinPlacement=new w.default}},t.createLeftPanel=function(){var t=this.game.currentDistrict;this.sidePanel=l.Sprite.from("side_panel.png"),this.visualContainer.addChild(this.sidePanel),this.sidePanel.anchor.set(.5);var e=l.Sprite.from("district_name_tintable.png"),i=l.Sprite.from("district_name_outline.png");i.anchor.set(.5),e.addChild(i),(this.sidePanel.districtPanel=e).y=-.5*this.sidePanel.height+e.height,this.sidePanel.addChild(e),e.anchor.set(.5);var n=new p.default({text:m.default.get("district_name_"+t,"fontScaleMiniGame"),fill:16777215,padding:10,fontSize:25,x:3});this.sidePanel.districtText=n,e.addChild(n);var r=new p.default({text:"15",fill:16777215,padding:10,fontSize:75,x:1.5});r.originalY=r.y=-.25*this.sidePanel.height+.25*r.height,this.sidePanel.attemptsCountText=r,this.sidePanel.addChild(r);var a=new p.default({fill:16777215,padding:10,fontSize:25,x:2,y:20});a.text=m.default.get("attempts")+"\n"+m.default.get("remaining"),this.sidePanel.addChild(a);var s=new p.default({text:this.game.inventory.inventory.userCoins.toString(),fill:16777215,padding:10,fontSize:24,anchorX:1});s.y=s.originalY=.5*this.sidePanel.height-.85*s.height+4,s.x=s.originalX=.3*this.sidePanel.width,this.sidePanel.coinText=s,this.sidePanel.addChild(s)},t.showEndPanel=function(){for(var n=this,r=[],t=0;t<this.foundPieces.length;t++){var e=this.foundPieces[t];r.push({texture:e.piece.image})}var a=!0;if(this.possiblePieces.foundAll()||this.hasTriedAgain){var i=m.default.get("rewards_subtitle_districts"),s=m.default.get("rewards_subtitle_bricks");this.hasTriedAgain&&(0===r.length?(i=m.default.get("rewards_title_bricks_none"),s=m.default.get("rewards_subtitle_bricks_none")):this.possiblePieces.foundAll()||(i=m.default.get("rewards_title_bricks"))),f.default.showObjectReward(r,this.currentDistrict,{subtitle:s,title:i})}else{var o=v.default.get("replayDigCost"),h=this.game.inventory.inventory.userCoins>o[this.currentDistrict-1];f.default.showEmptyWin(this.currentDistrict,h),a=!1}this.endPanelShown=!0,f.default.signals.end.add(function(){if(n.endPanelShown){if(a)n.btnClose.interactive=!0,n.endPanelShown=!1,n.revealUnknown();else{var t=0<n.foundPieces.length,e=t?m.default.get("rewards_title_bricks"):m.default.get("rewards_title_bricks_none"),i=t?m.default.get("rewards_subtitle_bricks"):m.default.get("rewards_subtitle_bricks_none");f.default.showObjectReward(r,n.currentDistrict,{subtitle:i,title:e}),a=!0}n.hasTriedAgain=!1}},this),f.default.signals.continue.add(function(t){n.endPanelShown&&(n.allowDigging(),n.game.inventory.inventory.spendCoins(t),n.btnClose.interactive=!0,n.attemptsRemaining+=v.default.get("extraAttempts"),n.sidePanel.attemptsCountText.text=""+n.attemptsRemaining,n.endPanelShown=!1,n.sidePanel.coinText.text=n.game.inventory.inventory.userCoins.toString(),n.hasTriedAgain=!0)},this)},t.allowDigging=function(){for(var t=0;t<this.digPieces.length;t++)for(var e=this.digPieces[t],i=0;i<e.length;i++){var n=e[i];n.view.interactive=!0,n.view.buttonMode=!0}},t.disallowDigging=function(){for(var t=0;t<this.digPieces.length;t++)for(var e=this.digPieces[t],i=0;i<e.length;i++){var n=e[i];n.view.interactive=!1,n.view.buttonMode=!1}},t.revealUnknown=function(){this.disallowDigging();for(var t=0;t<this.digPieces.length;t++)for(var e=this.digPieces[t],i=0;i<e.length;i++){var n=e[i];n.piece&&!n.found&&this.bricksToReveal.push(n)}0<this.bricksToReveal.length?(this.revealBricks=!0,this.revealIndex=this.bricksToReveal.length):this.onComplete()},t.unvealSlot=function(t){var e=this,i=!t.clicked;this.digMoreText.visible&&(this.digMoreText.visible=!1),i||(this.attemptsRemaining--,this.sidePanel.attemptsCountText.text=""+this.attemptsRemaining),o.default.playSfx("dig");var n=t.revealPiece(i);n&&!i&&(n.count--,this.possiblePieces.brickFound(t.piece),n.count<=0?(this.collect(n),o.default.playSfx("dig-find-brick")):o.default.playSfx("dig-find-piece")),this.canUpdate=!0,this.digParticles.addPieceParticle(this.view,t.background,t.sprite.tint),this.digParticles.addDirtParticle(this.view,t.background),t.revealCoin(function(){e.digParticles.addParticleTarget(e.view,t.background,e.sidePanel,function(){e.game.inventory.inventory.earnCoins(1),e.sidePanel.coinText.text=e.game.inventory.inventory.userCoins.toString()}),o.default.playSfx("dig-find-coins")}),0!==this.attemptsRemaining||i||(this.disallowDigging(),this.readyToEnd=!0)},t.collect=function(t){this.foundPieces.push(t),this.game.inventory.inventory.addPieces(t.piece.id,1),this.possiblePieces.swapToFound(t.piece.id);var e=l.Sprite.from(t.piece.image);e.anchor.set(.5),e.scale.set(.7),r.default.to(e.scale,.5,{x:1.25,y:1.25,ease:a.Back.easeOut}),r.default.to(e,.5,{alpha:0,delay:.5,onCompleteParams:[e],onComplete:function(t){t.parent.removeChild(t)}}),this.view.addChild(e),this.currentCollected++,this.currentCollected===this.totalPieces&&0<this.attemptsRemaining&&(this.digMoreText.visible=!0)},t.onEndMinigame=function(){this.endPanelShown||(this.game.traffic.randomiseVehicles(),this.showEndPanel(),this.disallowDigging(),this.btnClose.interactive=!1,this.digMoreText.visible=!1)},t.onComplete=function(){this.complete=!0,this.bricksToReveal=[]},t.resetGrid=function(){this.gridData=[];for(var t=0;t<this.grid.i;t++){for(var e=[],i=0;i<this.grid.j;i++)e.push(-1);this.gridData.push(e)}},t.reset=function(t){if(void 0===t&&(t=!1),this.game.view.container.visible=!1,!t){for(var e=0;e<this.digPieces.length;e++)for(var i=this.digPieces[e],n=0;n<i.length;n++){var r=i[n];r.reset(this.currentDistrict),this.pieceContainer.setChildIndex(r.view,this.pieceContainer.children.length-1)}this.view.interactiveChildren=!0,this.allowDigging()}this.currentCollected=0,this.resetGrid(),this.bricksToReveal=[],this.pieceSystem.reset(this.currentDistrict),this.uidPlaced={};var a=this.pieceSystem.getAllPieces(),s=this.pieceSystem.getForcedBricks(this.forcePieces),o=0<s.length,h=0,l=0;this.totalPieces=0;for(var d=Math.random()<.75?3:2,c=!0;l<d;){var u=o?s:a;o&&(u=this.pieceSystem.replaceData(u,a));var p=this.pieceSystem.getPieceIndex(u),f=o?0:p;if(this.inTutorial)for(var g=0;g<a.length;g++){var m=a[g];2==m.piece.id&&(f=a.indexOf(m))}if(this.placePiece(u[f])){if("large"===u[f].piece.size&&(d=Math.random()<.25?3:2),o){for(var v=null,b=0;b<a.length;b++){var y=a[b];y.uid===u[f].uid&&(v=y)}var w=a.indexOf(v);s.splice(f,1),a.splice(w,1),o=0<s.length}else a.splice(f,1);l++,this.totalPieces++}if(50<++h){this.reset(!0),c=!1;break}}c&&this.drawGrid()},t.placePiece=function(t){for(var e=Math.floor(4*Math.random()),i=Math.floor(4*Math.random()),n=!0,r=0;r<t.piece.structure.length;r++)for(var a=t.piece.structure[r],s=0;s<a.length;s++)this.gridData[e+r]&&this.gridData[e+r][s+i]?-1!=this.gridData[e+r][s+i]&&(n=!1):n=!1;if(!n)return!1;for(var o=0;o<t.piece.structure.length;o++){var h=t.piece.structure[o],l=null;t.piece.customTiles&&(l=t.piece.customTiles[o]);for(var d=0;d<h.length;d++){var c=h[d],u=null;l&&(u=l[d]),1===c?this.gridData[e+o][d+i]={piece:t,customTex:u}:2===c&&(this.gridData[e+o][d+i]={aestheticOnly:!0,piece:t,customTex:u})}}return!0},t.drawGrid=function(){this.forcePieces=[];for(var t=0;t<this.gridData.length;t++){for(var e=this.gridData[t],i=0;i<e.length;i++)e[i].piece&&0<=e[i].piece.piece.id&&!e[i].aestheticOnly?(" "+e[i].piece.piece.id,this.digPieces[i][t].addPiece(e[i].piece,e[i].customTex),this.uidPlaced["l"+e[i].piece.uid]?this.uidPlaced["l"+e[i].piece.uid].push(this.digPieces[i][t]):(this.uidPlaced["l"+e[i].piece.uid]=[this.digPieces[i][t]],this.possiblePieces.addBrick(e[i].piece,this.currentDistrict))):e[i].aestheticOnly?this.digPieces[i][t].addAesthetic(e[i].piece,e[i].customTex):" *";"\n"}this.coinPlacement.placeCoins(this.digPieces),this.positionPossible(),this.inTutorial&&this.storeTutorialPieces()},t.positionPossible=function(){this.possiblePieces.setMax(),this.possiblePieces.y=this.digPanelBackground.y-.5*this.possiblePieces.height+this.possiblePieces.offsetY,this.possiblePieces.x=this.digPanelBackground.x+.5*this.digPanelBackground.width+.8*this.possiblePieces.width},t.update=function(){this.complete&&(0<this.completeTimer?this.completeTimer-=1/60:(this.completeTimer=this.defaultCompleteTimer,this.onClose(),this.complete=!1)),this.revealBricks&&0<this.bricksToReveal.length&&(0<this.revealTimer?this.revealTimer-=1/60:(this.revealTimer=this.defaultRevealTimer,this.revealIndex--,this.bricksToReveal[this.revealIndex].onReveal(),0===this.revealIndex&&(this.revealBricks=!1,this.afterReveal=!0))),this.afterReveal&&(this.digParticles.hasParticles()||(this.onComplete(),this.afterReveal=!1)),this.digParticles.update(),this.readyToEnd&&(0<this.endTimer?this.endTimer-=1/60:(this.endTimer=this.defaultEndTimer,this.onEndMinigame(),this.readyToEnd=!1))},t.onClose=function(){this.game.view.onDigEnd(),this.hide(),this.game.culling.checkCulling(!0),this.view.interactiveChildren=!1},t.hide=function(){this.view.visible=!1,this.inTutorial&&this.endTutorial(),this.game.view.container.visible=!0,this.digParticles.killAll(),o.default.playMusic("music_loop_01"),this.game.state.setState("game"),this.digMoreText.visible=!1,this.readyToEnd=!1},t.show=function(t){this.forcePieces=this.forcePieces.concat(t.requirementPieces),this.defaultAttempts=v.default.get("digTurns"),this.view.visible=!0,t.district||0===t.district?this.digSitePanel.onDig(null,t.district):(this.miniGameContainer.visible=!1,this.digSitePanel.show()),this.game.state.setState("menu"),this.view.interactiveChildren=!0},t.digSiteChosen=function(t){this.miniGameContainer.visible=!0,this.game.state.setState("minigame"),this.currentDistrict=t+1,this.foundPieces=[],this.attemptsRemaining=this.defaultAttempts,this.sidePanel.districtPanel.tint=h.default.getColorByDistrict(this.currentDistrict),this.sidePanel.attemptsCountText.text=this.attemptsRemaining.toString(),this.sidePanel.districtText.text=m.default.get("district_name_"+this.currentDistrict.toString(),"fontScaleMiniGame"),this.sidePanel.coinText.text=v.default.numberWithCommas(this.game.inventory.inventory.userCoins.toString()),this.game.view.onDigStart(),this.sidePanel.coinText.scale.set(1),this.sidePanel.coinText.width>.5*this.sidePanel.width&&(this.sidePanel.coinText.width=.5*this.sidePanel.width,this.sidePanel.coinText.scale.y=this.sidePanel.coinText.scale.x),this.complete=!1,this.completeTimer=this.defaultCompleteTimer,this.possiblePieces.show(),this.reset(),this.game.dig.inTutorial||(this.digSitePanel.digStep[t]++,_.default.storeObject("digSteps",this.digSitePanel.digStep)),this.resize(this.w,this.h),this.game.hud.updateCurrentDistrict(t),this.music=o.default.playMusic("dig-loop")},t.startTutorial=function(){this.inTutorial=!0,this.btnClose.visible=!1},t.storeTutorialPieces=function(){var t=[];this.disallowDigging();for(var e=0;e<this.digPieces.length;e++)for(var i=this.digPieces[e],n=0;n<i.length;n++){var r=i[n];r.piece&&t.push(r)}this.signals.tutortialReady.dispatch(t)},t.endTutorial=function(){this.btnClose.visible=!0,this.allowDigging(),this.inTutorial=!1},t.hasEnoughMoney=function(t,e){return this.digSitePanel.hasEnoughMoney(t,e)},t.resize=function(t,e){if(this.w=t,this.h=e,this.built){this.btnClose.x=this.digPanelBackground.x-.5*this.digPanelBackground.width-50-.5*this.btnClose.width,this.btnClose.y=-this.game.h/2+50+.75*this.btnClose.height,this.digContainer.scale.set(this.game.h/this.digContainer.height*this.digContainer.scale.y*.8),this.sidePanel.x=this.digPanelBackground.x-.5*this.digPanelBackground.width-.75*this.sidePanel.width,this.sidePanel.y=this.digPanelBackground.y+.5*this.digPanelBackground.height-.5*this.sidePanel.height+18;var i=Math.max(this.h/this.defaultBgSize.height,this.w/this.defaultBgSize.width);this.background.scale.set(i),this.visualContainer.scale.set(1),this.w/this.visualContainer.width<1.1&&this.visualContainer.scale.set(this.w/this.visualContainer.width*.85*this.visualContainer.scale.x),this.h/this.visualContainer.height<1&&this.visualContainer.scale.set(this.h/this.visualContainer.height*.85*this.visualContainer.scale.y),this.digSitePanel.resize(this.w,this.h),this.digParticles.resize(this.w,this.h)}},DigSystem}(n.default);e.default=C},734:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=(_interopRequireDefault(i(43)),_interopRequireDefault(i(4))),s=i(7),o=_interopRequireDefault(i(18)),r=_interopRequireDefault(i(119));_interopRequireDefault(i(78));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h=11494199,l=11494199,d=13403984,c=function(r){function DigPieceCard(t,e,i){var n;void 0===i&&(i=1),(n=r.call(this)||this).sprite=a.Sprite.from("peg_top_smooth.png"),n.sprite.tint=h,n.background=a.Sprite.from("peg_empty.png"),n.background.anchor.set(.5),n.background.scale.y=n.background.scale.x,n.background.tint=l;return n.background.width+=1,n.sprite.height-=6,n.sprite.y-=3,n.pieceData=null,n.view.addChild(n.background),n.i=t,n.j=e,n.view.addChild(n.sprite),n.sprite.anchor.set(.5),n.view.interactive=!0,n.view.interactiveChildren=!1,n.view.hitArea=new a.Rectangle(.5*-n.sprite.width,.5*-n.sprite.height,n.sprite.width,n.sprite.height),n.view.buttonMode=!0,n.view.mouseover=function(){n.sprite.tint=d},n.view.mouseout=function(){n.sprite.tint=h},n.locked=!1,n.view.pointerup=function(){n.locked||(n.locked=!0,n.onReveal(!0))},n.onPieceSelected=new o.default,n.text=new a.Text,n.text.style.fill=16777215,n.text.style.fontSize=18,n.text.style.align="center",n.text.anchor.x=.5,n.text.anchor.y=.5,n.isAesthetic=!1,n.text.text=t+" - "+e,n}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DigPieceCard,r);var t=DigPieceCard.prototype;return t.onReveal=function(t){void 0===t&&(t=!1),this.locked=!0,this.sprite.alpha=0,this.clicked=t,this.onPieceSelected.dispatch(this)},t.highlight=function(){this.background.scale.set(.8),n.default.to(this.background,.35,{alpha:1}),n.default.to(this.background.scale,.65,{x:1,y:1,ease:s.Back.easeOut})},t.addPiece=function(t,e){this.piece=t,this.pieceSprite=a.Sprite.from(e||this.piece.piece.image),this.pieceSprite.tint=this.piece.piece.tint,this.pieceSprite.anchor.set(.5),this.pieceSprite.width=this.sprite.width+1,this.pieceSprite.scale.y=this.pieceSprite.scale.x,this.pieceSprite.originScale={x:this.pieceSprite.scale.x,y:this.pieceSprite.scale.y},this.view.addChildAt(this.pieceSprite,1),this.found=!1,this.pieceSprite.visible=!1},t.addAesthetic=function(t,e){var i=e,n=i.includes("_flip");n&&(i=i.replace("_flip","")),this.pieceSprite=a.Sprite.from(i),this.pieceSprite.anchor.set(.5),this.pieceSprite.addChild(this.pieceSprite),this.pieceSprite.tint=t.piece.tint,this.pieceSprite.width=this.sprite.width+1,this.pieceSprite.scale.y=this.pieceSprite.scale.x,n&&(this.pieceSprite.scale.x=-this.pieceSprite.scale.x),this.pieceData=t,this.pieceSprite.originScale={x:this.pieceSprite.scale.x,y:this.pieceSprite.scale.y},this.view.addChildAt(this.pieceSprite,1),this.pieceSprite.visible=!1,this.isAesthetic=!0},t.revealPiece=function(){return this.piece&&(this.found=!0,this.pieceSprite.visible=!0,this.background.visible=!1),this.isAesthetic&&(this.pieceSprite.visible=!0),this.piece},t.revealCoin=function(t){var e=this;return this.coinSprite&&(this.coinSprite.scale.set(.5),n.default.killTweensOf(this.coinSprite.scale),n.default.to(this.coinSprite.scale,.65,{x:.9*this.coinSprite.originScale.x,y:.9*this.coinSprite.originScale.y,ease:s.Back.easeOut}),n.default.to(this.coinSprite.scale,.4,{x:0,y:0,delay:.65,onUpdate:function(){0<e.coinSprite.alpha&&(e.coinSprite.alpha-=1/60)},onComplete:function(){t&&t()},ease:s.Back.easeIn}),this.coinFound=!0),this.coinSprite},t.addCoin=function(){if(!this.piece){var t=a.Sprite.from("coin.png");t.anchor.set(.5),this.coinSprite=t,this.coinSprite.width=.75*this.sprite.width,this.coinSprite.scale.y=this.coinSprite.scale.x,this.coinSprite.originScale={x:this.coinSprite.scale.x,y:this.coinSprite.scale.y},this.view.addChildAt(this.coinSprite,1)}},t.reset=function(t){this.locked=!1,(this.piece||this.isAesthetic)&&this.view.removeChild(this.pieceSprite),this.coinSprite&&this.view.removeChild(this.coinSprite),this.piece=null,this.coinSprite=null,this.sprite.scale.set(1),this.sprite.alpha=1,this.background.visible=!0,this.isAesthetic=!1,this.pieceData=null},DigPieceCard}(r.default);e.default=c},735:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var p=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(41)),f=_interopRequireDefault(i(10)),r=_interopRequireDefault(i(4)),a=i(7),g=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(e){function DugBricks(){var t;return(t=e.call(this)||this).container=new p.Container,t.addChild(t.container),t.imageList=[],t.shown=!1,t.index=-1,t.checkTextures={empty:p.Texture.from("piece_empty.png"),found:p.Texture.from("piece_full.png")},t.backgroundHeight=0,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DugBricks,e);var t=DugBricks.prototype;return t.show=function(){for(var t=0;t<this.imageList.length;t++){var e=this.imageList[t];e.parent.removeChild(e)}this.imageList=[],this.shown=!1,this.index=-1},t.addBrick=function(t,e){void 0===e&&(e=1);for(var i=!0,n=0;n<this.imageList.length;n++){var r=this.imageList[n];t.uid===r.uid&&(i=!1)}if(i){var a=new p.Sprite.from("piece_panel.png");a.uid=t.uid,a.brick=t,a.currentBricksFound=0,a.brickCount=t.count,this.container.addChild(a),a.pivot.set(a.width/2,a.height/2);var s,o=t.piece.image,h=this.checkFound(t.piece.id);if(this.offsetY||(this.offsetY=.5*a.height),h)(s=p.Sprite.from(""+o)).anchor.set(.5),s.height=.8*a.height,s.scale.set(.75),s.x=.5*a.width,s.y=.5*a.height,a.isHidden=!1;else{(s=p.Sprite.from("piece_district_tintable.png")).tint=g.default.getColorByDistrict(e);var l=p.Sprite.from("piece_district_outline.png");l.anchor.set(.5),s.addChild(l),s.highlight=l,a.isHidden=!0,s.anchor.set(.5),s.foundTexture=p.Texture.from(""+o),s.height=.8*a.height,s.scale.x=s.scale.y,s.scale.set(.95),s.x=.5*a.width,s.y=.5*a.height;var d=new f.default({text:"?",fill:16777215,padding:10,fontSize:75});s.text=d,s.addChild(d)}a.image=s,a.addChild(s),this.imageList.push(a),this.resetPosition(),this.index++,0===this.backgroundHeight&&(this.backgroundHeight=a.height);var c=(new p.Graphics).beginFill(0).drawRoundedRect(0,0,.97*a.width,.97*a.height,15);a.addChild(c);var u=new p.Sprite.from("piece_shine.png");u.anchor.set(.5),u.height=a.height,u.scale.x=u.scale.y,u.x=.5*-u.width,u.y=.5*a.height,a.addChild(u),u.alpha=.4,u.mask=c,a.foreground=u}},t.swapToFound=function(i){for(var n=this,t=function(t){var e=n.imageList[t];e.brick.piece.id===i&&e.isHidden&&(e.isHidden=!1,r.default.to(e.image.scale,.5,{x:0,y:0,ease:a.Back.easeIn,onComplete:function(){e.image.text.visible=!1,e.image.texture=e.image.foundTexture,e.image.removeChild(e.image.highlight),e.image.tint=16777215,r.default.to(e.image.scale,.5,{x:.75,y:.75,ease:a.Back.easeOut})}}))},e=0;e<this.imageList.length;e++)t(e)},t.getBrickAmount=function(t){return n.default.getCookie("pieces")[t].value},t.checkFound=function(t){return n.default.getCookie("pieces")[t].found},t.brickFound=function(t){for(var e=0;e<this.imageList.length;e++){var i=this.imageList[e];i.uid===t.uid&&(i.checkContainer.children[i.currentBricksFound].texture=this.checkTextures.found,i.currentBricksFound++,i.currentBricksFound===i.brickCount&&(i.foreground.x=-i.foreground.width,r.default.to(i.foreground,.5,{x:i.width+i.foreground.width})))}},t.setMax=function(){for(var t=0;t<this.imageList.length;t++){var e=this.imageList[t],i=new p.Container;e.checkContainer=i,e.addChild(i);for(var n=0;n<e.brickCount;n++){var r=new p.Sprite.from(this.checkTextures.empty);r.scale.set(1.25),r.x=n*(r.width+10),i.addChild(r)}i.y=e.height-.5*i.height,i.x=.5*e.width-.5*i.width}},t.foundAll=function(){for(var t=!0,e=0;e<this.imageList.length;e++){var i=this.imageList[e];i.brickCount!==i.currentBricksFound&&(t=!1)}return t},t.resetPosition=function(){for(var t=0;t<this.imageList.length;t++){var e=this.imageList[t];e.y=t*(1.2*e.height)}},DugBricks}(p.Container);e.default=s},736:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var d=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),c=_interopRequireDefault(i(10)),u=_interopRequireDefault(i(29)),n=_interopRequireDefault(i(169)),a=_interopRequireDefault(i(77)),p=_interopRequireDefault(i(13)),r=_interopRequireDefault(i(44)),f=(_interopRequireDefault(i(41)),_interopRequireDefault(i(55))),s=_interopRequireDefault(i(4)),o=i(7);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h=function(i){function DigSitePanel(t){var e;return(e=i.call(this)||this).game=t,e.blackShape=(new d.Graphics).beginFill(0).drawRect(-5e3,-5e3,1e4,1e4),e.addChild(e.blackShape),e.blackShape.alpha=.5,e.container=new d.Container,e.addChild(e.container),e.blackShape.interactive=!0,e.backPanel=d.Sprite.from("back_panel_dig.png"),e.container.addChild(e.backPanel),e.frontPanel=d.Sprite.from("mid_panel_dig.png"),e.frontPanel.width=.95*e.backPanel.width,e.frontPanel.scale.y=e.frontPanel.scale.x,e.frontPanel.anchor.set(.5),e.frontPanel.position.set(.5*e.backPanel.width,.575*e.backPanel.height),e.backPanel.addChild(e.frontPanel),e.backPanel.interactive=!0,e.topContainer=new n.default,e.topContainer.showCoins(),e.container.addChild(e.topContainer),e.topContainer.text=p.default.get("dig_site_title"),e.blackShape.interactive=!0,e.blackShape.buttonMode=!0,e.blackShape.pointerup=function(){e.hideCard()},e.game=t,e.interactive=!0,e.cancelButton=new u.default({base:"button_no.png"}),e.container.addChild(e.cancelButton),e.cancelButton.x=e.backPanel.width-40,e.cancelButton.y=40,e.cancelButton.onTap=function(){e.hideCard()},e.districtCost=[],e.labelCosts=[],e.digStep=[0,0,0,0,0,0],setTimeout(function(){e.digStep=e.game.inventory.inventory.digStep},50),e.possibleIcons={locked:d.Texture.from("icon_lock.png"),person:d.Texture.from("icon_person.png")},e.sectionList=[],e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DigSitePanel,i);var t=DigSitePanel.prototype;return t.tutorialStart=function(t){this.func=t,this.blackShape.interactive=!1,this.cancelButton.visible=!1;for(var e=0;e<this.sectionList.length;e++){this.sectionList[e].button.info.enabled=!1}return this.sectionList[0].button},t.tutorialEnd=function(t){this.blackShape.interactive=!0,this.cancelButton.visible=!0,this.onDig(t);for(var e=0;e<this.sectionList.length;e++){this.sectionList[e].button.info.enabled=!0}},t.show=function(){var t=this;this.visible=!0,this.scale.set(.75),this.game.hud.hide(),this.topContainer.updateCoins(this.game.inventory.inventory.userCoins),this.updateLock();for(var e=0;e<this.labelCosts.length;e++){var i=this.labelCosts[e],n=this.digStep[e];n=Math.min(n,this.districtCost[e].length-1),i.updateText(r.default.numberWithCommas(this.districtCost[e][n].toString()))}s.default.to(this.scale,.15,{x:1,y:1,ease:o.Back.easeOut,onComplete:function(){t.resize(),t.func&&(t.func(),delete t.func)}})},t.build=function(){this.buildDigSiteList(),this.resize()},t.buildDigSiteList=function(){this.tabContainer=new d.Container,this.districtCost=r.default.get("digPrices"),this.frontPanel.addChild(this.tabContainer);for(var t=0;t<this.districtCost.length;t++){var e=this.createSection(t);e.y=t*(1.05*e.height),this.tabContainer.addChild(e),this.sectionList.push(e)}this.tabContainer.y=-.5*this.frontPanel.height+this.tabContainer.height/(1.75*this.districtCost.length),this.tabContainer.x=.5*this.frontPanel.width-.5*this.tabContainer.width},t.createSection=function(t){var e=new d.Container,i=f.default.getColorByDistrict(t+1),n=new u.default({base:"bar_district_tintable.png",noDown:!0,tint:i,tintAlt:i}),r=d.Sprite.from("bar_district_outline.png");r.anchor.set(.5),n.add(r),(e.button=n).onTap=this.onDig.bind(this),n.index=t,e.addChild(n);var a=new u.default({base:"button_information.png",noScale:!0});(n.info=a).index=t,e.addChild(a),a.onTap=this.onInformation.bind(this),a.x=-.5*n.width-.75*a.width,e.addChild(n);var s=new c.default({fill:16777215,padding:10,fontSize:25,y:-.5,anchorX:0,x:-.375*n.width});s.text=p.default.get("district_name_"+(t+1),"fontScaleDigSites"),n.add(s);var o=new d.Sprite.from(d.Texture.WHITE);o.anchor.set(.5),n.add(o),o.height=.75*n.height,o.scale.x=o.scale.y,o.x=-.5*n.width+o.width,o.visible=!1;var h=new c.default({text:this.districtCost[t][0].toString(),fill:16777215,padding:10,fontSize:20,x:150,anchorX:1});this.labelCosts.push(h),n.add(h),e.icon=o;var l=d.Sprite.from("icon_coin.png");return l.anchor.set(.5),l.x=-l.width,n.add(l),e},t.onInformation=function(t){this.showInformation(t.index+1)},t.onDig=function(t,e){this.hideCard(!0);var i=this.game.inventory.inventory,n=e||0===e?e:t.index,r=this.digStep[n];r=Math.min(r,this.districtCost[n].length-1),i.spendCoins(this.districtCost[n][r]),i.saveCoins(),this.game.dig.digSiteChosen(n)},t.hideCard=function(t){var e=this;void 0===t&&(t=!1),s.default.to(this.scale,.15,{x:.75,y:.75,ease:o.Back.easeIn,onComplete:function(){e.visible=!1,e.game.hud.show(),e.game.view.container.visible=!0,t||e.game.state.setState("game")}})},t.updateCoins=function(t){this.topContainer.updateCoins(t)},t.updateLock=function(){for(var t=0;t<this.sectionList.length;t++){var e=this.sectionList[t];if(t<this.game.inventory.inventory.availableZones){var i=this.game.grid.orderEnabled.indexOf(this.game.currentDistrict);this.unlock(e,i===t),this.hasEnoughMoney(e.button,t)}else this.lock(e)}},t.lock=function(t){t.icon.visible=!0,t.icon.texture=this.possibleIcons.locked,t.button.enabled=!1,t.icon.height=.6*t.height,t.icon.scale.x=t.icon.scale.y},t.unlock=function(t,e){e?(t.icon.visible=!0,t.icon.texture=this.possibleIcons.person):t.icon.visible=!1,t.icon.height=.6*t.height,t.icon.scale.x=t.icon.scale.y,t.alpha=1,t.button.enabled=!0,t.interactiveChildren=!0},t.hasEnoughMoney=function(t,e){var i=this.districtCost[e],n=i[Math.min(this.digStep[e],i.length-1)];return this.game.inventory.inventory.userCoins>=n?t.enabled=!0:t.enabled=!1},t.setTint=function(t,e){for(var i=0;i<t.children.length;i++){t.children[i].tint=e}},t.showInformation=function(t){var e=[],i=this.game.inventory.inventory.pieces[t-1];if(i){for(var n=0;n<i.length;n++){var r=i[n];e.push({texture:r.image})}a.default.showUserCoins(this.game.inventory.inventory.userCoins),a.default.showObjectReward(e,t,{title:p.default.get("rewards_title_dig_site"),subtitle:p.default.get("rewards_subtitle_dig_site")},!0)}},t.resize=function(t,e){t&&(this.w=t),e&&(this.h=e),this.container.scale.set(1),this.w/this.container.width<1&&this.container.scale.set(this.w/this.container.width*.85*this.container.scale.x),this.h/this.container.height<1&&this.container.scale.set(this.h/this.container.height*.85*this.container.scale.y),this.container.x=-this.container.width/2,this.container.y=-this.container.height/2,this.topContainer.resize(this.backPanel.width,this.backPanel.height,!0)},DigSitePanel}(d.Container);e.default=h},737:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=(n=i(78))&&n.__esModule?n:{default:n};var s={world:new r.Point,store:new r.Point,target:new r.Point},o=function(){function DigSystemParticles(){this.particleSystem=new a.default}var t=DigSystemParticles.prototype;return t.update=function(){this.particleSystem.update(1/60)},t.addParticleTarget=function(t,e,i,n){var r=t.toLocal(s.world,i,s.target,!0),a=t.toLocal(s.world,e,s.store,!0);r.y+=.4*i.height,r.x-=.35*i.width,this.particleSystem.show(a,15,{value:1,texture:"coin.png",customContainer:t,gravity:this.h,forceX:.5*this.w-.25*this.w,forceY:this.h*Math.random()*.5,targetingSpeed:2,timer:.25,alphaDecress:1,scale:.2,target:{timer:.5,x:r.x,y:r.y,speed:800,onCompleteCallback:function(){n&&n()}}})},t.addDirtParticle=function(t,e){for(var i=t.toLocal(s.world,e,s.store,!0),n=0;n<15;n++)this.particleSystem.show(i,1,{texture:"minigame_particle.png",customContainer:t,gravity:this.h,forceX:300,forceY:300,alphaDecress:1,scale:.05+.1*Math.random(),angSpeed:10,rotateWithMovement:!0})},t.addPieceParticle=function(t,e,i){var n=t.toLocal(s.world,e,s.store,!0);this.particleSystem.show(n,1,{tint:i,texture:"peg_top_smooth.png",customContainer:t,gravity:5*this.h,forceX:300,forceY:1250,alphaDecress:5,scale:1,angSpeed:10,alphaDelay:1,rotateWithMovement:!0})},t.killAll=function(){this.particleSystem.killAll()},t.hasParticles=function(){return 0<this.particleSystem.particles.length},t.resize=function(t,e){this.w=t,this.h=e},DigSystemParticles}();e.default=o},738:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function DigPiecesSystem(){this.district=0,this.inventory=null,this.uid=0}var t=DigPiecesSystem.prototype;return t.setup=function(t){for(var e in t)this[e]=t[e]},t.reset=function(t){this.uid=0,this.district=t-1},t.replaceData=function(t,e){for(var i=[],n=0;n<t.length;n++){for(var r=t[n],a=r,s=null,o=0;o<e.length;o++){var h=e[o];if(h.piece.id===r.id){s=h;break}}var l={piece:a,uid:s.uid,count:s.count};i.push(l)}return i},t.getForcedBricks=function(t){for(var e=[],i=0;i<this.inventory.pieces.length;i++)for(var n=this.inventory.pieces[i],r=0;r<n.length;r++)for(var a=n[r],s=0;s<t.length;s++){t[s].id===a.id&&e.push(a)}return e},t.getAllPieces=function(){for(var t=[],e=0;e<this.inventory.pieces[this.district].length;e++){var i=this.inventory.pieces[this.district][e],n=0,r=Math.max(i.structure.length,i.structure[0].length);if(3<r?i.size="large":3===r?i.size="medium":r<3&&(i.size="small"),!i.noRotation){i.structure=[],i.customTiles=[];for(var a=0;a<i._structure.length;a++){for(var s=[],o=[],h=0;h<i._structure[a].length;h++)s.push(i._structure[a][h]),o.push(i._customTiles[a][h]);i.structure.push(s),i.customTiles.push(o)}for(var l=0;l<3*Math.random();l++)i.structure=this.transposeArray(i.structure,i.structure.length),i.customTiles=this.transposeArray(i.customTiles,i.customTiles.length)}for(var d=0;d<i.structure.length;d++)for(var c=i.structure[d],u=0;u<c.length;u++){1===c[u]&&n++}t.push({piece:i,uid:this.uid,count:n}),this.uid++}for(var p=t.length-1;0<p;p--){var f=Math.floor(Math.random()*p),g=t[p];t[p]=t[f],t[f]=g}return t},t.getPieceIndex=function(t){var e=[];e=e.concat(t);for(var i=[],n=0;n<e.length;n++){var r=e[n];i.push(r.piece.digChance)}var a=i.reduce(function(t,e){return t+e},0),s=0;i=i.map(function(t){return s=t+s});var o=Math.random()*a,h=e[i.filter(function(t){return t<=o}).length];return t.indexOf(h)},t.transposeArray=function(t,e){for(var i=[],n=0;n<t.length;n++)i.push([]);for(var r=0;r<t.length;r++)for(var a=0;a<e;a++)i[a].push(t[r][a]);return i},DigPiecesSystem}();e.default=n},739:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(){function CoinPlacementSystem(){}return CoinPlacementSystem.prototype.placeCoins=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++){var r=i[n];!r.piece&&!r.isAesthetic&&Math.random()<.2&&r.addCoin()}},CoinPlacementSystem}();e.default=n},740:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),a=_interopRequireDefault(i(18)),s=_interopRequireDefault(i(277)),h=_interopRequireDefault(i(77)),l=_interopRequireDefault(i(61)),d=_interopRequireDefault(i(13)),c=_interopRequireDefault(i(44)),o=_interopRequireDefault(i(742)),u=_interopRequireDefault(i(25)),p=_interopRequireDefault(i(23)),f=_interopRequireDefault(i(41));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var g=function(n){function FireSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.app=t.game.app,i.view=new r.Container,i.isPause=!1,i.eventTriggered=!1,i.locked=!1,i.indicatorFollow=!1,i.eventReady=!1,i.firstInteraction=!1,i.isIndicatorDropped=!0,i.eventType="fire",i.fireTimer=i.defaultFireTimer=10,i.signals={start:new a.default,end:new a.default,failedStart:new a.default},i.percentagePerTap=10,i.isNextEvent=!1,i.cooldown=!1,i.storeHappened=!1,i.happenedBeforeTimer=l.default.defaultShownTimer,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(FireSystem,n);var t=FireSystem.prototype;return t.build=function(){var e=this;this.game.view.overlay.addChild(this.view),this.inventory=this.game.inventory.inventory,this.eventCountdown=this.randomTime(),this.waterStreams=new o.default,this.view.addChild(this.waterStreams),this.waterStreams.build(),this.indicator=new s.default,this.indicator.build(this.eventType),this.view.addChild(this.indicator),this.clickContainer=new r.Container,this.clickContainer.visible=!1,this.clickContainer.interactive=!0,this.view.addChild(this.clickContainer),this.blocker=(new r.Graphics).beginFill(0).drawRect(0,0,100,100),this.blocker.pivot.set(.5*this.blocker.width,.5*this.blocker.height),this.clickContainer.addChild(this.blocker),this.blocker.width=this.game.w,this.blocker.height=this.game.h,this.blocker.alpha=.1,this.clickSpot=(new r.Graphics).beginFill(16777215).drawCircle(0,0,1e3),this.clickContainer.addChild(this.clickSpot),this.clickSpot.interactive=!0,this.clickSpot.alpha=0,this.clickSpot.on("pointertap",this.buildingClicked.bind(this)),this.indicator.signals.success.add(this.successfulEvent.bind(this)),this.indicator.signals.failure.add(this.failedEvent.bind(this)),this.indicator.signals.tapped.add(this.buildingFound.bind(this)),document.addEventListener("keypress",function(t){102===t.keyCode&&(e.game.setNextEvent(e.eventType),e.eventCountdown=-1)})},t.successfulEvent=function(){this.stopFire()},t.failedEvent=function(){this.buildingBurnt()},t.update=function(){this.isNextEvent&&(this.indicator&&this.indicator.update(),this.waterStreams&&this.waterStreams.update())},t.postupdate=function(){if(("event"===this.game.state.state||"game"===this.game.state.state)&&this.isNextEvent){if(!this.isPause&&(c.default.getDebug("logEventTime"),this.eventCountdown-=1/60,this.eventCountdown<0)){var t=this.inventory.getRandomPlaced(!0,!0);this.canTrigger(t)?(this.target=t,this.startFire(t),this.eventTriggered=!0):(this.eventCountdown=this.randomTime(),this.signals.failedStart.dispatch())}if(this.eventTriggered&&(this.moveIndicator(),this.checkCameraNearTarget()),this.locked)this.game.camera.checkNearPosition()&&this.locked&&this.eventReady&&(this.eventReady=!1,this.buildingCentered());if((this.locked||this.eventTriggered)&&!this.cooldown){var e=this.fireTimer/this.defaultFireTimer;this.indicator.outerRatio=e,0<this.fireTimer&&(this.fireTimer-=1/60)}this.cooldown&&(0<this.happenedBeforeTimer?this.happenedBeforeTimer-=1/60:this.cooldown=!1)}},t.canTrigger=function(t){return t&&!this.game.idle.eventIdle},t.randomTime=function(){var t=c.default.get("eventCountdownFire");return Math.random()*(t[1]-t[0])+t[0]},t.buildingCentered=function(){this.indicator.animateIn(),this.game.camera.targetZoom=3.5,this.isIndicatorDropped=!1},t.buildingClicked=function(){this.firstInteraction||(this.waterStreams.show(),this.firstInteraction=!0,this.game.idle.eventIdle=!1,this.indicator.drop(),this.cooldown=!1),this.isIndicatorDropped||(this.indicator.drop(),this.isIndicatorDropped=!0);var t=this.indicator.innerRatio+this.percentagePerTap/100;u.default.playSfx("emergency-button-press"),this.indicator.innerRatio=t,this.waterStreams.onClick()},t.moveIndicator=function(){if(this.indicatorFollow){var t=this.game.culling.getTrueTilePosition(this.target.tile,this.view);this.indicator.transformIndicator({x:0,y:0},t),this.indicator.boundaryCollision(this.game.w,this.game.h)}},t.moveIndicatorToTarget=function(t){t&&(this.indicator.position.set(0,-t.height),this.indicator.pointer.rotation=Math.PI,this.indicatorFollow=!1)},t.startFire=function(){this.hasFireStation=this.game.grid.districtHasBuilding(this.target.tile.zone.id,"Fire Station"),this.indicator.reset(),this.isPause=!0,this.eventCountdown=this.randomTime(),this.signals.start.dispatch(this.eventType),this.indicator.show(),this.indicator.animateIn(),this.indicatorFollow=!0,this.game.state.setState("event"),this.target.tile.hideCoin(),this.target.tile.createEvent(this.eventType),this.firstInteraction=!1;var t=p.default.isMobile?d.default.get("click_mobile"):d.default.get("click_desktop"),e=f.default.getCookie("events");e&&!e[this.eventType]&&(this.storeHappened=!0,this.cooldown=!0),l.default.show(d.default.get("character_fire_chief"),t+d.default.get("fire_start"),"fireChief",!1,"nuetral",0,!0);var i=c.default.get("fireTimer");this.fireTimer=this.hasFireStation?i.with:i.without},t.checkCameraNearTarget=function(){"none"===this.boundaryCollision(this.target.tile,{x:this.game.camera.x,y:this.game.camera.y})&&this.buildingFound()},t.buildingFound=function(){this.game.camera.lock(),this.game.grid.centerCameraByBuilding(this.target.tile),this.indicator.animateOut(0),this.locked=!0,this.eventReady=!0,this.eventTriggered=!1,this.moveIndicatorToTarget(this.target.tile.tile),this.clickContainer.visible=!0,this.game.traffic.summonEventVehicles(this.target.tile,this.eventType),this.target.tile.summonEventPeople(this.eventType)},t.boundaryCollision=function(t){var e=t.view.getGlobalPosition(),i=window.renderer.width,n=window.renderer.height,r="none",a=t.tile.width;return e.x<.75*a?r="left":e.x>i-.75*a?r="right":e.y<.75*a?r="top":e.y>n-.75*a&&(r="bottom"),r},t.buildingBurnt=function(){this.game.inventory.inventory.removeBuilding(this.target.tile),this.target.tile.burntDown(),this.stopFire(!0)},t.stopFire=function(t){void 0===t&&(t=!1),this.fireTimer=this.defaultFireTimer,this.game.state.setState("game"),this.currentTaps=0,this.eventTriggered=!1,this.locked=!1,this.isPause=!1,this.game.camera.unlock(),this.signals.end.dispatch(this.eventType),this.target.tile.removeEvent(),this.clickContainer.visible=!1;var e=this.game.grid.orderEnabled.length-this.target.tile.zone.id;if(!t){var i=Math.floor(this.target.tile.currentBuilding.revenue*c.default.get("stopFire")/100);h.default.showCoinReward(i,e)}var n=t?d.default.get("fire_fail"):d.default.get("fire_win"),r=t&&!this.hasFireStation?[n,d.default.get("fire_hint")]:n,a=t?"sad":"happy";if(l.default.show(d.default.get("character_fire_chief"),r,"fireChief",!1,a,0,!0),!this.firstInteraction){this.game.idle.eventIdle=!0;var s=p.default.isMobile?d.default.get("click_mobile"):d.default.get("click_desktop");l.default.show(d.default.get("character_fire_chief"),d.default.get("event_idle_remember")+s+d.default.get("fire_start"),"fireChief",!1,"nuetral",0,!0)}if(this.storeHappened){var o=f.default.getCookie("events");o[this.eventType]=!0,f.default.storeObject("events",o)}this.firstInteraction=!1,this.indicator.container.y-=90,this.indicator.animateOut(),this.game.traffic.withdrawEventVehicles(),this.target.tile.withdrawEventPeople(),this.target=null,this.waterStreams.hide()},t.resize=function(t,e){this.blocker&&(this.blocker.width=t,this.blocker.height=e),this.waterStreams&&this.waterStreams.resize(t,e)},FireSystem}(n.default);e.default=g},741:function(t,e,i){"use strict";function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}e.__esModule=!0,e.default=void 0;var n=function(e){function CircleMask(){var t;return(t=e.call(this)||this).thickness=10,t.startRads=0,t.endRads=Math.PI,t.radius=30,t._ratio=0,t.segments=8,t.redraw(),t}return function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(CircleMask,e),CircleMask.prototype.redraw=function(){this.clear(),this.beginFill(16711680);var t=this.segments,e=2*Math.PI/t,i=Math.ceil(this._ratio*this.segments);this.moveTo(0,0);for(var n=0,r=0;r<i;r++)n=r*e,this.lineTo(Math.sin(n)*-this.radius,Math.cos(n)*-this.radius);n=this._ratio*Math.PI*2,this.lineTo(Math.sin(n)*-this.radius,Math.cos(n)*-this.radius),this.endFill()},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(CircleMask,[{key:"ratio",set:function(t){this._ratio=t,1<this._ratio?this._ratio=1:this._ratio<0&&(this._ratio=0),this.redraw()},get:function(){return this._ratio}}]),CircleMask}(function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)).Graphics);e.default=n},742:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(743)),a=_interopRequireDefault(i(4));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(e){function WaterStreams(){var t;return(t=e.call(this)||this).container=new n.Container,t.addChild(t.container),t.textureList=[n.Texture.from("water_splash_01.png"),n.Texture.from("water_splash_02.png"),n.Texture.from("water_splash_03.png")],t.textureIndex=0,t.firstDown=!1,t.tick=0,t.waterSpouts=4,t.streams=[],t.shown=!1,t.waterIntensity=1,t.maxIntensity=50,t.targetIntensity=1,t.lastClickTimer=t.defaultLastClickTimer=.5,t.lowerIntensity=!1,t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(WaterStreams,e);var t=WaterStreams.prototype;return t.build=function(){for(var t=this,e=0;e<this.waterSpouts;e++){var i=new r.default(500,"water_stream_01.png");i.visible=!1,i.verlet.lockEndPoint(),this.container.addChild(i),i.signals.atCenter.add(function(){t.firstDown||(t.splash.visible=!0,t.splash.alpha=1,t.firstDown=!0)}),this.streams.push(i)}this.splash=n.Sprite.from("water_splash_01.png"),this.splash.anchor.set(.5),this.splash.scale.set(.5),this.splash.visible=!1,this.container.addChild(this.splash),this.container.y-=.25*this.splash.height,setTimeout(function(){t.prep()},500)},t.prep=function(){var t=[{x:"minus",y:"minus"},{x:"plus",y:"minus"},{x:"minus",y:"plus"},{x:"plus",y:"plus"}];if(0<this.streams.length)for(var e=0;e<this.streams.length;e++){var i=this.streams[e];i.xType=t[e].x,i.yType=t[e].y;var n=this.getEndPosition(i.xType,i.yType);i.setup(n.x,n.y)}},t.getEndPosition=function(t,e){return{x:"plus"===t?.5*this.w-100:-.5*this.w+100,y:"plus"===e?.5*this.h+50:-.5*this.h-50}},t.update=function(){if(this.shown){if(this.tick++,this.tick%10==0&&this.splash.visible&&(this.textureIndex++,this.textureIndex=this.textureIndex%this.textureList.length,this.splash.texture=this.textureList[this.textureIndex]),0<this.streams.length)for(var t=0;t<this.streams.length;t++){var e=this.streams[t];e.update(),this.tick%10==0&&e.addParticle(this.container)}this.lowerIntensity?.1<this.targetIntensity&&(this.targetIntensity-=1/60*10):0<this.lastClickTimer?this.lastClickTimer-=1/60:this.lowerIntensity=!0,this.targetIntensity=Math.min(20,Math.max(.1,this.targetIntensity)),this.waterIntensity=this.lerp(this.waterIntensity,this.targetIntensity,.1);var i=Math.min(.5,Math.max(.1,.025*this.waterIntensity));this.splash.scale.set(i);for(var n=0;n<this.streams.length;n++){this.streams[n].waterIntensity=this.waterIntensity}}},t.onClick=function(){this.targetIntensity+=2.5,this.lowerIntensity=!1,this.lastClickTimer=this.defaultLastClickTimer,this.targetIntensity=Math.min(20,Math.max(.1,this.targetIntensity))},t.show=function(){this.shown=!0;for(var t=0;t<this.streams.length;t++){this.streams[t].show()}},t.hide=function(){if(this.shown){this.firstDown=!1,a.default.to(this.splash,1,{alpha:0});for(var t=0;t<this.streams.length;t++){this.streams[t].hide()}this.shown=!1}},t.resize=function(t,e){if(this.w=t,this.h=e,0<this.streams.length)for(var i=0;i<this.streams.length;i++){var n=this.streams[i],r=this.getEndPosition(n.xType,n.yType);n.setEndPoint(r.x,r.y)}},t.lerp=function(t,e,i){return(1-i)*t+i*e},WaterStreams}(n.Container);e.default=s},743:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var g,a=i(1),s=_interopRequireDefault(i(268)),n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(4)),o=_interopRequireDefault(i(78)),h=_interopRequireDefault(i(18));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function updateVertices(){var t=this.points;if(!(t.length<1)){for(var e=this.getBuffer("aTextureCoord").data,i=0;i<e.length;i+=1)e[i]+=.02;this.getBuffer("aTextureCoord").update();for(var n,r=t[0],a=0,s=0,o=this.buffers[0].data,h=t.length,l=0;l<h;l++){var d=t[l],c=4*l;s=-((n=l<t.length-1?t[l+1]:d).x-r.x),a=n.y-r.y;var u=10*(1-l/(h-1));1<u&&(u=1);var p=Math.sqrt(a*a+s*s),f=0<this.textureScale?(this.textureScale,this.width):this.width;a/=p,s/=p,a*=f=g.waterIntensity+1.5*l,s*=f,o[c]=d.x+a,o[1+c]=d.y+s,o[2+c]=d.x-a,o[3+c]=d.y-s,r=d}this.buffers[0].update()}}var r=function(r){function WaterRope(t){var e,i=a.Texture.from(window.ASSET_URL+"event/water/water_stream_01.png?v=wtj5a4k3sr9wh5");i.baseTexture.wrapMode=a.WRAP_MODES.REPEAT;var n=new s.default;return n.build(t),(e=r.call(this,i,n.links)||this).verlet=n,e.sin=0,e.textureIndex=0,e.particleSystem=new o.default,e.splashTextureList=[a.Texture.from("water_splash_01.png"),a.Texture.from("water_splash_02.png"),a.Texture.from("water_splash_03.png")],e.splashTextureIndex=0,e.splash=a.Sprite.from("water_splash_01.png"),e.splash.anchor.set(.5),e.splash.scale.set(.5),e.addChild(e.splash),e.splashAnimation=!0,e.particlesEnabled=!1,e.signals={atCenter:new h.default},g=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e),e.twitchInterval=Math.floor(120+60*Math.random()),e.geometry.updateVertices=updateVertices,e.waterIntensity=1,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(WaterRope,r);var t=WaterRope.prototype;return t.setup=function(t,e){var i=this,n=t||this.endPointOrigin.x,r=e||this.endPointOrigin.y;this.setEndPoint(n,r),this.verlet.startX=this.endPointOrigin.x,this.verlet.startY=this.endPointOrigin.y,this.visible=!0,this.alpha=0,setTimeout(function(){i.visible=!1,i.alpha=1},1e3)},t.show=function(){var t=this;this.splash.visible=!0,this.splashAnimation=!0,n.default.to(this.verlet,.5,{ease:n.Power0.easeOut,startX:0,startY:0,onStart:function(){t.visible=!0,t.particlesEnabled=!0},onComplete:function(){t.splashAnimation=!1,t.splash.visible=!1,t.signals.atCenter.dispatch()}})},t.setEndPoint=function(t,e){this.endPointOrigin=this.verlet.setEndPoint(t,e)},t.addParticle=function(t){if(this.particlesEnabled){var e=Math.random()<.5?-1:1;this.particleSystem.show({x:this.verlet.startX,y:this.verlet.startY},1,{texture:"water_splash_01.png",customContainer:t,scale:.1+.1*Math.random(),forceY:150+100*Math.random(),forceX:200+200*Math.random()*e,gravity:75+75*Math.random(),alphaDecress:.5,angSpeed:5*Math.random()})}},t.update=function(){this.sin++;var t=this.sin%this.twitchInterval==0?0:50;this.verlet.endY=this.endPointOrigin.y+t,this.particleSystem.update(1/60),this.splash.position.set(this.verlet.startX,this.verlet.startY)},t.hide=function(){var t=this;n.default.to(this,.75,{alpha:0,onComplete:function(){t.setup(),t.particleSystem.killAll()}})},t.updateTransform=function(){r.prototype.updateTransform.call(this),this.verlet.update()},t.lerp=function(t,e,i){return(1-i)*t+i*e},WaterRope}(a.SimpleRope);e.default=r},744:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var c=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),u=_interopRequireDefault(i(18)),p=_interopRequireDefault(i(4)),f=i(7),g=_interopRequireDefault(i(23));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var m={x:0,y:0},a={x:0,y:0},r=function(n){function DragSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).hasDragged=!1,i.startGlide=!1,i.currentTouchId=0,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(DragSystem,n);var t=DragSystem.prototype;return t.build=function(){var i=this;if(!this.built){this.dragShape=(new c.Graphics).beginFill(4802116).drawRect(-25e3,-25e3,5e4,5e4),this.game.view.container.addChild(this.dragShape),this.dragShape.alpha=0,this.built=!0,this.fingerMarker=(new c.Graphics).beginFill(16777215).drawCircle(0,0,20),this.game.view.ui.addChild(this.fingerMarker),this.fingerMarker.alpha=.25,this.fingerMarker.scale.set(0),this.isMouseDown=!1,this.game.view.container.interactive=!0,this.currentMouse={x:0,y:0},this.angle=0,this.vel={x:0,y:0},this.dist=0,this.currentGlobalMouse={x:0,y:0},this.dragSpeed=g.default.isMobile?.95:.9,this.isMoving=!1,this.game.view.container.pointermove=function(t){if(t.data.identifier===i.currentTouchId&&i.isMouseDown&&!i.game.camera.locked){i.currentGlobalMouse.x=t.data.global.x,i.currentGlobalMouse.y=t.data.global.y;var e=i.game.view.ui.toLocal(i.currentGlobalMouse);i.game.camera.x+=(i.currentMouse.x-e.x)/i.game.camera.currentZoom,i.game.camera.y+=(i.currentMouse.y-e.y)/i.game.camera.currentZoom,i.currentMouse.x=e.x,i.currentMouse.y=e.y,i.dist=i.distance(i.game.camera.x,i.game.camera.y,m.x,m.y),15<i.dist?i.hasDragged=!0:i.hasDragged=!1}},this.game.view.container.pointerdown=function(t){if(0===i.currentTouchId&&!i.game.camera.locked&&!i.isLock){i.signals.dragStart.dispatch(),i.isMouseDown=!0;var e=i.game.view.ui.toLocal(t.data.global);i.fingerMarker.scale.set(.2),i.fingerMarker.visible=!0,p.default.killTweensOf(i.fingerMarker.scale),p.default.to(i.fingerMarker.scale,.25,{x:1.5,y:1.5,ease:f.Back.easeOut}),i.fingerMarker.x=e.x,i.fingerMarker.y=e.y,i.currentMouse.x=e.x,i.currentMouse.y=e.y,i.currentGlobalMouse.x=t.data.global.x,i.currentGlobalMouse.y=t.data.global.y,m.x=i.game.camera.x,m.y=i.game.camera.y,i.updateFingerMarker(),i.vel.x=0,i.vel.y=0,i.hasDragged=!1,i.dist=0,i.currentTouchId=t.data.identifier}},this.signals={dragStart:new u.default,dragEnd:new u.default},this.game.view.container.pointerupoutside=this.game.view.container.pointerup=function(t){if(t.data.identifier===i.currentTouchId){i.isMouseDown=!1,i.updateVelocity();var e=i.game.view.container.toLocal(t.data.global);p.default.killTweensOf(i.fingerMarker.scale),p.default.to(i.fingerMarker.scale,.15,{x:0,y:0,onComplete:function(){i.fingerMarker.visible=!1},ease:f.Back.easeIn}),i.fingerMarker.x=e.x,i.fingerMarker.y=e.y,i.signals.dragEnd.dispatch(),i.startGlide=!0,i.resetTouchId()}};var t=this.game.grid.areaGrid,e=this.game.grid.fullMapGrid,n=this.game.grid.gridContainer,r=this.game.grid.tileContainer,a=this.game.grid.gridRotation,s=(t.width+t.road)*t.i*e.i,o=(t.height+t.road)*t.j*e.j,h=n.height-r.height,l=this.game.w/5,d=this.game.h/5;this.bound={top:h*n.scale.y+.6*d,bottom:(r.height*Math.cos(a)-h)*n.scale.y-1.2*d,left:-o*Math.cos(a)+l,right:s*Math.cos(a)-l}}},t.resetTouchId=function(){this.currentTouchId=0},t.lock=function(){this.isLock=!0},t.unlock=function(){this.isLock=!1},t.updateFingerMarker=function(){if(this.fingerMarker.visible){var t=this.game.view.ui.toLocal(this.currentGlobalMouse);this.fingerMarker.x=t.x,this.fingerMarker.y=t.y}},t.update=function(){if(this.game.camera.locked&&this.hasDragged&&(this.dist=0,this.hasDragged=!1),this.updateFingerMarker(),this.isMouseDown)this.updateVelocity();else{var t=this.dist<20;this.applyVelocity(t)}this.isMoving=.5<Math.abs(this.vel.x)||.5<Math.abs(this.vel.y),this.startGlide&&!this.isMoving&&(this.startGlide=!1,this.game.checkClosestDistrict()),this.isMoving||(this.vel.x=0,this.vel.y=0),this.restrictCameraBounds()},t.applyVelocity=function(t){if(void 0===t&&(t=!1),t)return this.vel.x=0,void(this.vel.y=0);var e=Math.sign(this.vel.x);0<e?(this.vel.x*=this.dragSpeed,this.vel.x<0&&(this.vel.x=0)):(this.vel.x*=this.dragSpeed,0<this.vel.x&&(this.vel.x=0)),0!==e&&this.game.camera.x!==this.bound.left&&this.game.camera.x!==this.bound.right&&(this.game.camera.x+=this.vel.x),0<(e=Math.sign(this.vel.y))?(this.vel.y*=this.dragSpeed,this.vel.y<0&&(this.vel.y=0)):(this.vel.y*=this.dragSpeed,0<this.vel.y&&(this.vel.y=0)),0!==e&&this.game.camera.y!==this.bound.top&&this.game.camera.y!==this.bound.bottom&&(this.game.camera.y+=this.vel.y)},t.updateVelocity=function(){if(this.isMouseDown){var t=(g.default.isMobile,50),e=Math.min(t,Math.max(Math.abs(this.game.camera.y-a.y),Math.abs(this.game.camera.x-a.x))),i=this.game.camera.x-a.x,n=this.game.camera.y-a.y,r=Math.atan2(n,i);this.vel.x=Math.cos(r)*e,this.vel.y=Math.sin(r)*e,a.x=this.game.camera.x,a.y=this.game.camera.y}},t.reset=function(){this.vel&&(this.vel.x=0,this.vel.y=0),this.isMouseDown=!1,this.isMoving=!1},t.blockTileClick=function(){return this.hasDragged},t.distance=function(t,e,i,n){var r=t-i,a=e-n;return Math.sqrt(r*r+a*a)},t.restrictCameraBounds=function(){(this.game.camera.x>this.bound.right||this.game.camera.x<this.bound.left)&&(this.game.camera.x=this.game.camera.x>this.bound.right?this.bound.right:this.bound.left),(this.game.camera.y>this.bound.bottom||this.game.camera.y<this.bound.top)&&(this.game.camera.y=this.game.camera.y>this.bound.bottom?this.bound.bottom:this.bound.top)},DragSystem}(n.default);e.default=r},745:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),a=_interopRequireDefault(i(18)),s=_interopRequireDefault(i(277)),l=_interopRequireDefault(i(77)),d=_interopRequireDefault(i(61)),o=_interopRequireDefault(i(78)),c=_interopRequireDefault(i(13)),u=_interopRequireDefault(i(44)),h=_interopRequireDefault(i(25)),p=_interopRequireDefault(i(23)),f=_interopRequireDefault(i(41));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var g=function(n){function CrimeSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.app=t.game.app,i.view=new r.Container,i.isPause=!1,i.eventTriggered=!1,i.locked=!1,i.indicatorFollow=!1,i.eventReady=!1,i.eventActive=!1,i.crimeTimer=i.defaultCrimeTimer=10,i.firstInteraction=!1,i.isIndicatorDropped=!0,i.eventType="crime",i.signals={start:new a.default,end:new a.default,failedStart:new a.default},i.percentagePerTap=10,i.sin=0,i.isNextEvent=!1,i.cooldown=!1,i.storeHappened=!1,i.happenedBeforeTimer=d.default.defaultShownTimer,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(CrimeSystem,n);var t=CrimeSystem.prototype;return t.build=function(){var e=this;this.game.view.overlay.addChild(this.view),this.inventory=this.game.inventory.inventory,this.eventCountdown=this.randomTime(),this.particleContainer=new r.Container,this.view.addChild(this.particleContainer),this.particleSystem=new o.default,this.particleContainer.addChild(this.particleSystem),this.indicator=new s.default,this.indicator.build(this.eventType),this.view.addChild(this.indicator),this.clickContainer=new r.Container,this.clickContainer.visible=!1,this.clickContainer.interactive=!0,this.view.addChild(this.clickContainer),this.blocker=(new r.Graphics).beginFill(0).drawRect(0,0,100,100),this.blocker.pivot.set(.5*this.blocker.width,.5*this.blocker.height),this.clickContainer.addChild(this.blocker),this.blocker.width=this.game.w,this.blocker.height=this.game.h,this.blocker.alpha=.1,this.clickSpot=(new r.Graphics).beginFill(16777215).drawCircle(0,0,1e3),this.clickContainer.addChild(this.clickSpot),this.clickSpot.interactive=!0,this.clickSpot.alpha=0,this.clickSpot.on("pointertap",this.buildingClicked.bind(this)),this.sirenContainer=new r.Container,this.view.addChild(this.sirenContainer);var t=new r.Sprite.from("vignette-red.png");this.sirenContainer.addChild(t),t.anchor.set(.5),(this.sirenContainer.red=t).blendMode=r.BLEND_MODES.ADD;var i=new r.Sprite.from("vignette-blue.png");this.sirenContainer.addChild(i),i.anchor.set(.5),(this.sirenContainer.blue=i).blendMode=r.BLEND_MODES.ADD,this.sirenContainer.visible=!1,this.isNextEvent=!1,this.indicator.signals.success.add(this.successfulEvent.bind(this)),this.indicator.signals.failure.add(this.failedEvent.bind(this)),this.indicator.signals.tapped.add(this.buildingFound.bind(this)),document.addEventListener("keypress",function(t){99===t.keyCode&&(e.game.setNextEvent(e.eventType),e.eventCountdown=-1)}),this.tick=0},t.successfulEvent=function(){this.stopCrime()},t.failedEvent=function(){this.buildingRobbed()},t.update=function(){if(0<this.particleSystem.particles.length&&this.particleSystem.update(1/60),this.isNextEvent&&(this.indicator&&this.indicator.update(),this.sirenContainer&&this.eventActive)){this.sin+=1/60;var t=(this.sin-.5)/.2,e=.5*Math.sin(t)+.5;this.sirenContainer.red.alpha=e,this.sirenContainer.blue.alpha=1-e}},t.postupdate=function(){if(("event"===this.game.state.state||"game"===this.game.state.state)&&this.isNextEvent){if(!this.isPause&&(u.default.getDebug("logEventTime"),this.eventCountdown-=1/60,this.eventCountdown<0)){var t=this.inventory.getRandomPlaced(!0,!0);this.canTrigger(t)?(this.target=t,this.startCrime(t),this.eventTriggered=!0):(this.eventCountdown=this.randomTime(),this.signals.failedStart.dispatch())}if(this.eventTriggered&&(this.moveIndicator(),this.checkCameraNearTarget()),this.locked)this.game.camera.checkNearPosition()&&this.locked&&this.eventReady&&(this.eventReady=!1,this.buildingCentered());if((this.locked||this.eventTriggered)&&!this.cooldown){this.tick++,this.tick%15==0&&this.addParticle(this.target.tile.view);var e=this.crimeTimer/this.defaultCrimeTimer;this.indicator.outerRatio=e,0<this.crimeTimer&&(this.crimeTimer-=1/60)}this.cooldown&&(0<this.happenedBeforeTimer?this.happenedBeforeTimer-=1/60:this.cooldown=!1)}},t.canTrigger=function(t){var e=this.game.inventory.inventory.userCoins-u.default.get("getRobbed")>=u.default.get("bankruptcyPrevention");return t&&!t.tile.isRobbed&&!this.game.idle.eventIdle&&e},t.addParticle=function(t){var e=this.view.toLocal(t.getGlobalPosition());e.y-=.25*t.height;var i=Math.random()<.5?-1:1;this.particleSystem.show(e,1,{texture:"dollar_bill.png",customContainer:this.particleContainer,scale:.2,forceY:150+100*Math.random(),forceX:200+200*Math.random()*i,gravity:75+75*Math.random(),alphaDecress:.5,angSpeed:5*Math.random(),scaleSpeed:{x:2+3*Math.random(),y:0}}),this.particleSystem.show(e,1,{texture:"coin.png",customContainer:this.particleContainer,scale:.2,forceY:150+100*Math.random(),forceX:200+200*Math.random()*i,gravity:75+75*Math.random(),alphaDecress:.5})},t.randomTime=function(){var t=u.default.get("eventCountdownCrime");return Math.random()*(t[1]-t[0])+t[0]},t.buildingCentered=function(){this.indicator.animateIn(),this.game.camera.targetZoom=3.5,this.isIndicatorDropped=!1},t.buildingClicked=function(){this.firstInteraction||(this.firstInteraction=!0,this.game.idle.eventIdle=!1,this.cooldown=!1,this.indicator.drop()),this.isIndicatorDropped||(this.indicator.drop(),this.isIndicatorDropped=!0);var t=this.indicator.innerRatio+this.percentagePerTap/100;h.default.playSfx("emergency-button-press"),this.indicator.innerRatio=t},t.moveIndicator=function(){if(this.indicatorFollow){var t=this.game.culling.getTrueTilePosition(this.target.tile,this.view);this.indicator.transformIndicator({x:0,y:0},t),this.indicator.boundaryCollision(this.game.w,this.game.h)}},t.moveIndicatorToTarget=function(t){t&&(this.indicator.position.set(0,-t.height),this.indicator.pointer.rotation=Math.PI,this.indicatorFollow=!1)},t.startCrime=function(){this.hasPoliceStation=this.game.grid.districtHasBuilding(this.target.tile.zone.id,"Police Station"),this.tick=0,this.indicator.reset(),this.isPause=!0,this.eventCountdown=this.randomTime(),this.signals.start.dispatch(this.eventType),this.indicator.show(),this.indicator.animateIn(),this.indicatorFollow=!0,this.game.state.setState("event"),this.target.tile.hideCoin(),this.target.tile.createEvent(this.eventType),this.eventActive=!0,this.sirenContainer.visible=!0,this.firstInteraction=!1;var t=p.default.isMobile?c.default.get("click_mobile"):c.default.get("click_desktop"),e=f.default.getCookie("events");e&&!e[this.eventType]&&(this.storeHappened=!0,this.cooldown=!0),d.default.show(c.default.get("character_police_lieutenant"),t+c.default.get("crime_start"),"policeLieutenant",!1,"nuetral",0,!0);var i=u.default.get("crimeTimer");this.crimeTimer=this.hasPoliceStation?i.with:i.without},t.checkCameraNearTarget=function(){"none"===this.boundaryCollision(this.target.tile,{x:this.game.camera.x,y:this.game.camera.y})&&this.buildingFound()},t.buildingFound=function(){this.game.camera.lock(),this.game.grid.centerCameraByBuilding(this.target.tile),this.indicator.animateOut(0),this.locked=!0,this.eventReady=!0,this.eventTriggered=!1,this.moveIndicatorToTarget(this.target.tile.tile),this.clickContainer.visible=!0,this.game.traffic.summonEventVehicles(this.target.tile,this.eventType),this.target.tile.summonEventPeople(this.eventType)},t.boundaryCollision=function(t){var e=t.view.getGlobalPosition(),i=window.renderer.width,n=window.renderer.height,r="none";return e.x<0?r="left":e.x>i-0?r="right":e.y<0?r="top":e.y>n-0&&(r="bottom"),r},t.buildingRobbed=function(){this.target.tile.robbed(),this.stopCrime(!0)},t.stopCrime=function(t){void 0===t&&(t=!1),this.crimeTimer=this.defaultCrimeTimer,this.game.state.setState("game"),this.currentTaps=0,this.eventTriggered=!1,this.locked=!1,this.eventActive=!1,this.isPause=!1,this.game.camera.unlock(),this.signals.end.dispatch(this.eventType),this.target.tile.removeEvent(),this.clickContainer.visible=!1,this.sirenContainer.visible=!1;var e=this.game.grid.orderEnabled.length-this.target.tile.zone.id,i=Math.floor(this.target.tile.currentBuilding.revenue*u.default.get("getRobbed")/100);if(t)this.game.inventory.inventory.spendCoins(i);else{var n=Math.floor(this.target.tile.currentBuilding.revenue*u.default.get("stopCrime")/100);l.default.showCoinReward(n,e)}if(this.storeHappened){var r=f.default.getCookie("events");r[this.eventType]=!0,f.default.storeObject("events",r)}var a=t?c.default.get("crime_fail")+" "+i+" "+c.default.get("coins"):""+c.default.get("crime_win"),s=t&&!this.hasPoliceStation?[a,c.default.get("crime_hint")]:a,o=t?"sad":"happy";if(d.default.show(c.default.get("character_police_lieutenant"),s,"policeLieutenant",!1,o,0,!0),!this.firstInteraction){this.game.idle.eventIdle=!0;var h=p.default.isMobile?c.default.get("click_mobile"):c.default.get("click_desktop");d.default.show(c.default.get("character_police_lieutenant"),c.default.get("event_idle_remember")+h+c.default.get("crime_start"),"policeLieutenant",!1,"nuetral",0,!0)}this.firstInteraction=!1,this.indicator.animateOut(),this.game.traffic.withdrawEventVehicles(),this.target.tile.withdrawEventPeople(),this.target=null},t.resize=function(t,e){this.blocker&&(this.blocker.width=t,this.blocker.height=e),this.sirenContainer&&(this.sirenContainer.red.width=t,this.sirenContainer.red.height=e,this.sirenContainer.blue.width=t,this.sirenContainer.blue.height=e)},CrimeSystem}(n.default);e.default=g},746:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(i(17)),h=_interopRequireDefault(i(747)),r=_interopRequireDefault(i(4)),a=i(7);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var s=function(n){function TrafficSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=t.game,i.isCarsFading=!1,i.isEventVehiclesFading=!0,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(TrafficSystem,n);var t=TrafficSystem.prototype;return t.build=function(){if(!this.built){this.built=!0,this.carsContainer=this.game.grid.roadContainer,this.eventVehiclesContainer=this.game.grid.eventContainer,this.areaGrid=this.game.grid.areaGrid,this.eventVehicle1=new h.default(!0),this.eventVehicle2=new h.default(!0),this.eventVehicle3=new h.default(!0),this.eventVehicle4=new h.default(!0),this.eventVehicle1.rotation=-this.game.grid.gridRotation,this.eventVehicle2.rotation=-this.game.grid.gridRotation,this.eventVehicle3.rotation=-this.game.grid.gridRotation,this.eventVehicle4.rotation=-this.game.grid.gridRotation,this.eventVehiclesContainer.addChild(this.eventVehicle1),this.eventVehiclesContainer.addChild(this.eventVehicle2),this.eventVehiclesContainer.addChild(this.eventVehicle3),this.eventVehiclesContainer.addChild(this.eventVehicle4),this.eventVehiclesContainer.visible=!1,this.pathsData=[{cars:window.OPT?2:6,path:[{i:1,j:1},{i:1,j:2},{i:2,j:2},{i:2,j:3},{i:3,j:3},{i:3,j:2},{i:4,j:2},{i:4,j:1},{i:3,j:1},{i:2,j:1}],backToFront:Math.random()<.5},{cars:window.OPT?3:6,path:[{i:1,j:3},{i:2,j:3},{i:3,j:3},{i:3,j:2},{i:4,j:2},{i:4,j:3},{i:4,j:4},{i:3,j:4},{i:2,j:4},{i:1,j:4}],offset:!0,backToFront:Math.random()<.5}],this.carZones={},this.allCars=[];for(var t=0;t<this.game.inventory.inventory.availableZones;t++)this.addTrafficOnZone(t+1)}},t.fadeInCars=function(){this.eventVehiclesContainer.visible=!1,this.carsContainer.visible=!0,this.game.culling.inEvent=!1;for(var t=0;t<this.allCars.length;t++){var e=this.allCars[t];e.show(),r.default.to(e.car.shader,.5,{opacity:1,ease:a.Linear.easeNone})}},t.fadeOutCars=function(){var i=this;this.isCarsFading=!0,this.game.culling.inEvent=!0;for(var t=function(t){var e=i.allCars[t];r.default.to(e.car.shader,.5,{opacity:0,ease:a.Linear.easeNone,onComplete:function(){return e.hide()}})},e=0;e<this.allCars.length;e++)t(e)},t.fadeInEventVehicles=function(t){void 0===t&&(t=0),this.eventVehiclesContainer.visible=!0,r.default.to(this.eventVehicle1.car.shader,.5,{opacity:1,ease:a.Linear.easeNone,delay:t}),r.default.to(this.eventVehicle2.car.shader,.5,{opacity:1,ease:a.Linear.easeNone,delay:t}),r.default.to(this.eventVehicle3.car.shader,.5,{opacity:1,ease:a.Linear.easeNone,delay:t}),r.default.to(this.eventVehicle4.car.shader,.5,{opacity:1,ease:a.Linear.easeNone,delay:t})},t.resetEventVehicles=function(t){this.eventVehicle1.x=t.x+102,this.eventVehicle1.y=t.y-200,this.eventVehicle2.x=t.x-200,this.eventVehicle2.y=t.y+102,this.eventVehicle3.x=t.x+200,this.eventVehicle3.y=t.y-90,this.eventVehicle4.x=t.x-90,this.eventVehicle4.y=t.y-200,this.eventVehicle1.car.rotation3d.y=-.08,this.eventVehicle2.car.rotation3d.y=Math.PI/2,this.eventVehicle3.car.rotation3d.y=-Math.PI/2,this.eventVehicle4.car.rotation3d.y=-(.08+2*Math.PI),this.eventVehicle1.car.shader.opacity=0,this.eventVehicle2.car.shader.opacity=0,this.eventVehicle3.car.shader.opacity=0,this.eventVehicle4.car.shader.opacity=0},t.setEvenVehiclesModel=function(t){this.eventVehicle1.setEventVehiclesModel(t),this.eventVehicle2.setEventVehiclesModel(t),this.eventVehicle3.setEventVehiclesModel(t),this.eventVehicle4.setEventVehiclesModel(t)},t.summonEventVehicles=function(t,e){this.fadeOutCars(),this.setEvenVehiclesModel(e),this.resetEventVehicles(t),this.fadeInEventVehicles(1.1),r.default.to(this.eventVehicle1,2.3,{y:t.y,ease:a.Elastic.easeOut.config(.2,.9),delay:1.1}),r.default.to(this.eventVehicle2,2.8,{x:t.x,ease:a.Elastic.easeOut.config(.2,.9),delay:1.1+.1}),r.default.to(this.eventVehicle3,2.5,{x:t.x,ease:a.Elastic.easeOut.config(.2,.9),delay:1.8}),r.default.to(this.eventVehicle4,3,{y:t.y,ease:a.Elastic.easeOut.config(.2,.9),delay:1.6})},t.withdrawEventVehicles=function(){this.fadeInCars()},t.addTrafficOnZone=function(t){if(!this.carZones["zone"+t]){this.carZones["zone"+t]={},this.carZones["zone"+t].cars=[];for(var e=this.game.grid.getZoneByOrder(t-1).trafficWaypoints,i=0;i<this.pathsData.length;i++)for(var n=this.pathsData[i],r=0;r<n.cars;r++){var a=new h.default;a.rotation=-this.game.grid.gridRotation,this.carsContainer.addChild(a);var s=n.backToFront?n.path.length-1-r:r;a.build(e,n.path,s,n.offset),this.carZones["zone"+t].cars.push(a),this.allCars.push(a),a.UID=this.allCars.indexOf(a)}for(var o=0;o<this.allCars.length;o++){this.allCars[o].allCars=this.allCars}}},t.update=function(t){var e=t/60;for(var i in this.carZones)if(this.carZones.hasOwnProperty(i))for(var n=this.carZones[i],r=0;r<n.cars.length;r++){n.cars[r].update(e)}this.updateVisibilities()},t.updateVisibilities=function(){if(this.isCarsFading)for(var t=0;t<this.allCars.length;t++){var e=this.allCars[t];e.car.shader.opacity<=0&&(e.hide(),t===this.allCars.length-1&&(this.isCarsFading=!1))}},t.randomiseVehicles=function(){for(var t=0;t<this.allCars.length;t++){this.allCars[t].randomiseVehicleModel()}},t.dist=function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.angleLerp=function(t,e,i){return t+this.shortAngleDist(t,e)*i},t.shortAngleDist=function(t,e){var i=2*Math.PI,n=(e-t)%i;return 2*n%i-n},TrafficSystem}(n.default);e.default=s},747:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n,r=_interopRequireWildcard(i(1)),l=(n=i(278))&&n.__esModule?n:{default:n},a=_interopRequireWildcard(i(4));function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}var s=[{weight:20,model:"models/vehicles/fireman-car",tex:"firecar-texture_",textureCount:1,scale:.026},{weight:20,model:"models/vehicles/ice-cream-van",tex:"van-icecream-texture_",textureCount:1,scale:.05},{weight:20,model:"models/vehicles/normal-car",tex:"normal-car-texture_",textureCount:3,scale:.015},{weight:20,model:"models/vehicles/police-car",tex:"cop-car-texture_",textureCount:1,scale:.017},{weight:20,model:"models/vehicles/van-truck",tex:"van-truck-texture_",textureCount:1,scale:.034}],o=function(n){function Car(t){var e,i;return void 0===t&&(t=!1),e=n.call(this)||this,t?(i={fire:s[0],crime:s[3]},e.fireTruckGeometry=new r.Geometry.from(i.fire.model),e.fireTruckTexture=r.Texture.from(i.fire.tex+"00.jpg"),e.fireTruckScale=i.fire.scale,e.policeCarGeometry=new r.Geometry.from(i.crime.model),e.policeCarTexture=r.Texture.from(i.crime.tex+"00.jpg"),e.policeCarScale=i.crime.scale,e.car=e.getCarModel(i.fire)):(i=s[Math.floor(s.length*Math.random())],e.car=e.getCarModel(i)),e.addChild(e.car),e.shadow=(new r.Graphics).beginFill(0).drawCircle(0,0,15),e.shadow.alpha=.2,e.path=[],e.currentWaypointID=0,e.waypoints=[],e.velocity={x:0,y:0},e.targetPosition={x:0,y:0},e.target3DAngle=0,e.isNextAngleCalc=!1,e.isInitialised=!1,e.distance=0,e.speed=5,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Car,n);var t=Car.prototype;return t.getCarModel=function(t){var e=t.model,i=t.tex,n=t.textureCount,r=t.scale,a=Math.floor(Math.random()*n);a<10&&(a="0"+a);var s=i+a+".jpg",o=new l.default(e,s);o.rotation3d.x=Math.PI;var h=r;return o.scale.set(h,1.6*h),o},t.setEventVehiclesModel=function(t){if("fire"===t)return this.car.geometry=this.fireTruckGeometry,this.car.shader.map=this.fireTruckTexture,void this.car.scale.set(this.fireTruckScale,1.6*this.fireTruckScale);this.car.geometry=this.policeCarGeometry,this.car.shader.map=this.policeCarTexture,this.car.scale.set(this.policeCarScale,1.6*this.policeCarScale)},t.randomiseVehicleModel=function(){var t=s[Math.floor(s.length*Math.random())],e=Math.floor(Math.random()*t.textureCount);e<10&&(e="0"+e);var i=t.tex+e+".jpg";this.car.geometry=new r.Geometry.from(t.model),this.car.shader.map=r.Texture.from(i),this.car.scale.set(t.scale,1.6*t.scale)},t.build=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=!1),this.waypoints=t,this.path=e,this.currentWaypointID=i,this.offset=n,this.velocity.x=0,this.velocity.y=0,this.direction=1,this.angleDir=0},t.update=function(){if(!this.isInitialised){this.setNextWaypoint(!0);var t=Math.atan2(this.targetPosition.y-this.y,this.targetPosition.x-this.x);this.angleDir=t,this.car.rotation3d.y=this.target3DAngle,this.isInitialised=!0}this.distance=this.dist(this.x,this.y,this.targetPosition.x,this.targetPosition.y),Math.floor(this.distance)<10&&!this.isNextAngleCalc&&(this.setNext3DAngle(),a.default.to(this.car.rotation3d,.4*this.speed,{y:this.target3DAngle,ease:a.Power2.easeOut})),this.distance<.5&&(this.setNextWaypoint(),a.default.to(this,this.speed,{x:this.targetPosition.x,y:this.targetPosition.y,ease:a.Power0.easeNone}))},t.setNextWaypoint=function(t){void 0===t&&(t=!1),t||(this.currentWaypointID++,this.currentWaypointID%=this.path.length,this.isNextAngleCalc=!1),this.currentWayPoint=this.path[this.currentWaypointID];var e=this.waypoints[this.currentWayPoint.i][this.currentWayPoint.j];this.targetPosition.x=e.x,this.targetPosition.y=e.y,t&&t&&(this.x=this.targetPosition.x,this.y=this.targetPosition.y,this.setNext3DAngle(t),this.offset&&(this.setNextWaypoint(),this.x+=.5*(this.targetPosition.x-this.x),this.y+=.5*(this.targetPosition.y-this.y),a.default.to(this,this.speed/2,{x:this.targetPosition.x,y:this.targetPosition.y,ease:a.Power0.easeNone})))},t.setNext3DAngle=function(t){void 0===t&&(t=!1);var e=this.currentWaypointID+1;e%=this.path.length;var i=this.path[e],n=this.waypoints[i.i][i.j];this.newNextAngle=Math.atan2(this.targetPosition.y-n.y,this.targetPosition.x-n.x);var r=Math.floor(this.newNextAngle*(180/Math.PI))+90;this.target3DAngle=this.newNextAngle,0===r&&(this.target3DAngle+=Math.PI/2),90===r&&(this.target3DAngle-=Math.PI/2),180===r&&(this.target3DAngle+=Math.PI/2),270===r&&(this.target3DAngle-=Math.PI/2);var a=Math.round((this.target3DAngle-this.car.rotation3d.y)*(180/Math.PI));270===a&&(this.car.rotation3d.y=this.target3DAngle+Math.PI/2),-270===a&&(this.car.rotation3d.y=this.target3DAngle-Math.PI/2),this.isNextAngleCalc=!0,t&&(this.car.rotation3d.y=this.target3DAngle,this.isNextAngleCalc=!1)},t.dist=function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.angleLerp=function(t,e,i){return t+this.shortAngleDist(t,e)*i},t.shortAngleDist=function(t,e){var i=2*Math.PI,n=(e-t)%i;return 2*n%i-n},t.hide=function(){this.visible=!1},t.show=function(){this.visible=!0},Car}(r.Container);e.default=o},749:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(750)),a=_interopRequireDefault(i(751));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(i){function LittleMaterial(t){var e;return(e=i.call(this,n.Program.from(a.default,r.default,"little-shader"),{uMap:t,opacity:1,uMapFrame:new n.Rectangle(0,0,1,1)})||this).needsUpdate=!0,e.map=t,e}return function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(LittleMaterial,i),function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(LittleMaterial,[{key:"map",set:function(t){var e=this.uniforms,i=e.uMapFrame;this.uniforms.uMap=t;var n=e.uMap.baseTexture,r=e.uMap.frame;i.x=r.x/n.width,i.y=r.y/n.height,i.width=r.width/n.width,i.height=r.height/n.height,this.uniforms.uMapFrame=i},get:function(){return this.uniforms.uMap}},{key:"opacity",set:function(t){this.uniforms.opacity=t},get:function(){return this.uniforms.opacity}}]),LittleMaterial}(n.Shader);e.default=s},750:function(t,e,i){"use strict";i.r(e),e.default="\r\n\r\nuniform sampler2D uMap;\r\nuniform float opacity;\r\n\r\nvarying vec2 vUvs;\r\nvarying vec3 vNormals;\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = texture2D(uMap, vUvs.xy) * opacity;\r\n    gl_FragColor.xyz *= 0.6 + (vNormals.z * 0.4);\r\n    gl_FragColor.xyz *= 2.;\r\n}\r\n"},751:function(t,e,i){"use strict";i.r(e),e.default="\r\nattribute vec3 position;\r\nattribute vec3 normals;\r\nattribute vec2 uvs;\r\n\r\nuniform vec4 uMapFrame;\r\nuniform float aspectRatio;\r\n\r\nuniform mat4 projectionView;\r\nuniform mat3 normalMatrix;\r\n\r\n// 2d..\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\n\r\nvarying vec2 vUvs;\r\nvarying vec3 vNormals;\r\n\r\nvoid main() {\r\n\r\n    vec3 newPos = position;\r\n\r\n    vec4 threedPos = projectionView * vec4(newPos, 1.);\r\n\r\n    threedPos.xy *= vec2(1000., 1000./aspectRatio);\r\n    \r\n    vec4 pos2D = vec4((projectionMatrix * translationMatrix * vec3(threedPos.xy, 1.0)).xy, 0.0, 1.0);\r\n\r\n\r\n    threedPos.xy = pos2D.xy;\r\n\r\n    gl_Position = threedPos;\r\n\r\n    vNormals = normalize(normals * normalMatrix);\r\n    vUvs = (uvs * uMapFrame.zw ) + uMapFrame.xy;\r\n}\r\n"},758:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(17));_interopRequireDefault(i(23));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h={width:0,height:0},l={tile:null,road:null,car:null,dressing:null},a={world:new n.Point,target:new n.Point},s=function(n){function CullingSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).zones=[],i.cars=[],i.tiles=[],i.tick=0,i.inEvent=!1,i.positionsTileList=[],i.positionsCarList=[],i.positionsDressingList=[],i.skipNextCheck=!1,i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(CullingSystem,n);var t=CullingSystem.prototype;return t.setup=function(t){void 0===t&&(t={zones:[],cars:[],dressing:[]}),this.zones=t.zones,this.cars=[],this.cars=this.cars.concat(t.cars),this.dressing=t.dressing,h.width=window.renderer.width,h.height=window.renderer.height,l.tile=this.game.grid.tileContainer,l.road=this.game.grid.roadContainer,l.dressing=this.game.grid.gridDressing.container,l.car=this.game.traffic.carsContainer;for(var e=0;e<this.zones.length;e++)for(var i=this.zones[e],n=0;n<i.tiles.length;n++)l.tile||(l.tile=i.tiles[n].view.parent),l.road||(l.road=i.tiles[n].roadChunk.parent),this.positionsTileList.push({x:i.tiles[n].x,y:i.tiles[n].y}),this.tiles.push(i.tiles[n]);for(var r=0;r<this.cars.length;r++){var a=this.cars[r];this.positionsCarList.push({x:a.x,y:a.y})}for(var s=0;s<this.dressing.length;s++){var o=this.dressing[s];this.positionsDressingList.push({x:o.x,y:o.y})}},t.checkCulling=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=30),void 0===i&&(i=!1),this.tick++,this.game.onboard.isOnboarding&&!t||!t&&this.tick%e!=0||(this.cullTiles(),i||(this.cullCars(),this.cullDressing()))},t.cullTiles=function(t){void 0===t&&(t=!1);for(var e=0,i=0;i<this.tiles.length-1;i++){var n=this.tiles[i];l.tile.toGlobal(this.positionsTileList[i],a.world,!1),this.checkBounds(a.world)?(n.view.parent||l.tile.addChild(n.view),n.roadChunk.parent||l.road.addChildAt(n.roadChunk,0),n.view.parent.setChildIndex(n.view,e),e++):(n.view.parent&&l.tile.removeChild(n.view),n.roadChunk.parent&&l.road.removeChild(n.roadChunk))}},t.checkBounds=function(t,e){void 0===e&&(e=220);var i=e*this.game.camera.currentZoom,n=h.width/h.height;return t.x>-i*n&&t.x<h.width+i*n&&t.y>1.5*-i&&t.y<h.height+1.5*i+50},t.cullCars=function(){if(this.cars&&!this.inEvent)if(this.skipNextCheck)this.skipNextCheck=!1;else for(var t=0;t<this.cars.length;t++){var e=this.cars[t];this.positionsCarList[t].x=e.x,this.positionsCarList[t].y=e.y,l.car.toGlobal(this.positionsCarList[t],a.world,!0),this.checkBounds(a.world)?e.parent||l.car.addChild(e):e.parent&&l.car.removeChild(e)}},t.addCars=function(t){this.skipNextCheck=!0;for(var e=0;e<t.length;e++){var i=t[e];this.cars.includes(i)||(this.cars.push(i),this.positionsCarList.push({x:i.x,y:i.y}))}},t.cullDressing=function(){if(this.dressing)for(var t=0;t<this.dressing.length;t++){var e=this.dressing[t];l.dressing.toGlobal(this.positionsDressingList[t],a.world,!1),this.checkBounds(a.world)?e.parent||l.dressing.addChild(e):e.parent&&l.dressing.removeChild(e)}},t.eventState=function(t){(this.inEvent=t)&&this.forceShow()},t.getTrueTilePosition=function(t,e){var i=this.tiles.indexOf(t);return l.tile.toGlobal(this.positionsTileList[i],a.target,!1),e.toLocal(a.target)},t.forceShow=function(){this.cullCars(!0),this.cullTiles(!0)},t.reset=function(){this.tick=0},t.dist=function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))},t.resize=function(){h.width=window.renderer.width,h.height=window.renderer.height},CullingSystem}(r.default);e.default=s},759:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;!function(t){{if(t&&t.__esModule)return;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}e.default=t}}(i(1));var n=_interopRequireDefault(i(17)),r=_interopRequireDefault(i(61)),a=_interopRequireDefault(i(13));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var s=function(n){function IdleSystem(t,e){var i;return void 0===e&&(e={}),(i=n.call(this,t,e)||this).game=i.entity.game,i.idleTimer=i.defaultIdleTimer=30,i.forceHumour=!1,i.jokeCount=5,i.eventIdle=!1,window.addEventListener("pointerdown",i.interaction.bind(_assertThisInitialized(i))),window.addEventListener("pointerup",i.interaction.bind(_assertThisInitialized(i))),document.addEventListener("keypress",function(t){55===t.keyCode&&(i.humourNotHelp(),i.idleTimer=-1)}),i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(IdleSystem,n);var t=IdleSystem.prototype;return t.update=function(){if("GAME"===this.game.state.currentState.toUpperCase()&&!this.game.endGame.isShown)if(0<this.idleTimer)this.idleTimer-=1/60;else{var t="";if(this.forceHumour||Math.random()<.25){var e=Math.floor(Math.random()*this.jokeCount);t=[a.default.get("reminder_joke_question_"+e),a.default.get("reminder_joke_answer_"+e)],this.forceHumour=!1}else{var i=Math.random()<.5?"coins":"bricks";t=["coins"==i?a.default.get("reminder_dig"):a.default.get("reminder_build"),""+a.default.get("reminder_make_sure")+a.default.get("reminder_"+i)]}r.default.show(a.default.get("character_mayor"),t),this.reset()}},t.humourNotHelp=function(){this.forceHumour=!0},t.helpNotHumour=function(){this.forceHumour=!1},t.interaction=function(){this.reset(),this.eventIdle=!1},t.reset=function(){this.idleTimer=this.defaultIdleTimer},IdleSystem}(n.default);e.default=s},760:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(17)),s=_interopRequireDefault(i(41)),o=_interopRequireDefault(i(270)),h=_interopRequireDefault(i(13)),l=_interopRequireDefault(i(78)),d=_interopRequireDefault(i(4)),c=i(7),u=_interopRequireDefault(i(25));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var p=new a.Point,r=function(r){function EndGameSystem(t,e){var i;void 0===e&&(e={}),(i=r.call(this,t,e)||this).isEndGame=!1,i.isShown=!1,i.triggeredEndGame=!1,i.hasWonBefore=s.default.getCookie("endgame"),i.maxDistricts=0,i.container=new a.Container,i.particleSystem=new l.default,i.particleTextures=[];for(var n=1;n<7;n++)i.particleTextures.push("confetti_0"+n+".png");return i}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(EndGameSystem,r);var t=EndGameSystem.prototype;return t.build=function(){var t=this;this.panelContainer=new a.Container,this.container.addChild(this.panelContainer),this.endPanel=new o.default,this.endPanel.closeWelcome.add(function(){t.endPanel.visible=!0,t.hide()}),this.endPanel.backPanel.width,this.endPanel.message=h.default.get("end_game_message"),this.endPanel.buttonLabel=h.default.get("end_game_button"),this.endPanel.title=h.default.get("end_game_title"),this.panelContainer.addChild(this.endPanel),this.game.view.topMenu.addChild(this.container),this.container.visible=!1},t.celebration=function(){var t=window.OPT?15:30;u.default.playSfx("pop");for(var e=0;e<t;e++){var i=Math.random()<.5?1:-1;p.x=.5*-this.w,p.y=.5*this.container.y+Math.random()*this.container.height*.025*i,this.particleSystem.show(p,1,{texture:this.particleTextures[Math.floor(Math.random()*this.particleTextures.length)],scale:.15+.15*Math.random(),forceY:150,forceX:500,gravity:75+75*Math.random(),alphaDelay:2,alphaDecrease:1,angSpeed:5*Math.random(),scaleSpeed:{x:20*Math.random(),y:0},customContainer:this.container,forceDirectionX:1}),i=Math.random()<.5?1:-1,p.x=.5*this.w,p.y=.5*this.container.y+Math.random()*this.container.height*.025*i,this.particleSystem.show(p,1,{texture:this.particleTextures[Math.floor(Math.random()*this.particleTextures.length)],scale:.15+.15*Math.random(),forceY:150,forceX:500,gravity:75+75*Math.random(),alphaDelay:2,alphaDecrease:1,angSpeed:5*Math.random(),scaleSpeed:{x:20*Math.random(),y:0},customContainer:this.container,forceDirectionX:-1})}},t.update=function(){0<this.particleSystem.particles.length&&this.particleSystem.update(1/60)},t.endGameReached=function(){this.hasWonBefore||(this.game.state.setState("menu"),this.hasWonBefore=!0,this.isShown=!0,this.isEndGame=!0,this.container.visible=!0,s.default.storeObject("endgame",!0),this.show())},t.show=function(){var t=this;this.game.hud.hide(),this.endPanel.backPanel.scale.set(.25),d.default.to(this.endPanel.backPanel.scale,.25,{x:this.endPanel.backPanel.originScale.x,y:this.endPanel.backPanel.originScale.y,ease:c.Back.easeOut,onComplete:function(){t.celebration(),u.default.playSfx("crowd_cheering")}})},t.hide=function(){var t=this;d.default.to(this.endPanel.backPanel.scale,.25,{x:.25,y:.25,ease:c.Back.easeIn,onComplete:function(){t.container.visible=!1,t.isShown=!1,t.game.state.setState("game"),t.game.hud.show()}})},t.resize=function(t,e){this.w=t,this.h=e},EndGameSystem}(n.default);e.default=r},761:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),a=_interopRequireDefault(i(117)),n=_interopRequireDefault(i(272)),s=_interopRequireDefault(i(762));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function Loading(t){this.app=t,this.w=512,this.h=512,this.color=this.app.color,this.view=new r.Container,this._ratio=0,this.app.resources.onLoadStart.add(this.onLoadStart,this),this.app.resources.onLoadProgress.add(this.onLoadProgress,this),this.app.resources.onLoadComplete.add(this.onLoadComplete,this),this.app.size.onResize.add(this.onResize,this),this.fadeAnim=new s.default(this.app.overlay)}var t=Loading.prototype;return t.onLoadStart=function(t){this.ratio=0,"title"===t&&this.showAsFullScreen()},t.onLoadProgress=function(t){this.ratio=t},t.onLoadComplete=function(t){this.ratio=1,"title"!==t&&"game"!==t||this.hide(!0)},t.build=function(){if(!this.bg){this.bg=new a.default(this.color,1),this.view.addChild(this.bg),this.backgroundImage=new r.Sprite.from("background-loading.jpg"),this.backgroundImage.anchor.set(.5),this.view.addChild(this.backgroundImage),this.defaultBgSize={width:this.backgroundImage.width,height:this.backgroundImage.height},this.collectiveContainer=new r.Container,this.view.addChild(this.collectiveContainer),this.logosContainer=new r.Container,this.collectiveContainer.addChild(this.logosContainer),this.gamelogo=new r.Sprite.from("title.png"),this.gamelogo.anchor.set(.5),this.gamelogo.scale.set(.6),this.logosContainer.addChild(this.gamelogo),this.legoLogo=new r.Sprite.from("logo_lego.png"),this.legoLogo.anchor.set(.5),this.legoLogo.x=.5*this.gamelogo.width-.5*this.legoLogo.width,this.legoLogo.y=-.5*this.gamelogo.height-.5*this.legoLogo.height,this.logosContainer.addChild(this.legoLogo),this.nickLogo=new r.Sprite.from("logo_nickelodeon.png"),this.nickLogo.anchor.set(.5),this.nickLogo.x=-.5*this.gamelogo.width+.5*this.nickLogo.width,this.nickLogo.y=-.5*this.gamelogo.height-this.nickLogo.height,this.logosContainer.addChild(this.nickLogo),this.bar=new r.Container,this.collectiveContainer.addChild(this.bar),this.bar.y=160;var t=new r.Sprite.from("bar_back.png");t.anchor.set(.5),this.bar.addChild(t),this.bar.bg=t;var e=new r.Sprite.from("bar_mid.png");e.anchor.set(.5),t.addChild(e),this.bar.mid=e;var i=new r.Sprite.from("bar_front.png");i.anchor.set(.5),t.addChild(i);var n=(new r.Graphics).beginFill(0).drawRect(0,0,i.width,1.1*i.height);n.pivot.set(0,.5*n.height),n.x=t.x-.5*t.width,this.bar.loadMask=n,i.mask=n,this.defaultContainerSize={width:this.collectiveContainer.width,height:this.collectiveContainer.height},t.addChild(n),this.onResize()}},t.onResize=function(){if(this.w=this.app.size.w,this.h=this.app.size.h,this.view.position.x=this.w/2,this.view.position.y=this.h/2,this.bg&&this.bg.resize(this.w,this.h),this.backgroundImage){var t=Math.max(this.h/this.defaultBgSize.height,this.w/this.defaultBgSize.width);this.backgroundImage.scale.set(t)}if(this.defaultContainerSize){var e=Math.min(this.h/this.defaultContainerSize.height,this.w/this.defaultContainerSize.width);this.collectiveContainer.scale.set(.75*e)}},t.showAsFullScreen=function(t){var e=this;if(void 0===t&&(t=!1),t)return this.fadeAnim.onSwap.addOnce(function(){return e.showAsFullScreen()},this),void this.fadeAnim.play();this.build(),this.view.visible=!0,this.logosContainer.visible=!0,this.bg.alpha=1,this.app.overlay.addChild(this.view),this.view.visible=!0,this.bar.y=160},t.showAsOverlay=function(t){var e=this;if(void 0===t&&(t=!1),t)return this.fadeAnim.onSwap.addOnce(function(){return e.showAsOverlay()},this),void this.fadeAnim.play();this.build(),this.view.visible=!0,this.logosContainer.visible=!1,this.bg.alpha=.8,this.app.overlay.addChild(this.view),this.view.visible=!0,this.bar.y=0},t.hide=function(t){var e=this;if(void 0===t&&(t=!1),this.view.visible){if(t)return this.fadeAnim.onSwap.addOnce(function(){return e.hide()},this),void this.fadeAnim.play();this.view.visible=!1,this.view.parent&&this.view.parent.removeChild(this.view)}},function(t,e,i){e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i)}(Loading,[{key:"ratio",get:function(){return this._ratio},set:function(t){this._ratio=n.default.clamp(t),this.bar&&(this.bar.loadMask.scale.x=t)}}]),Loading}();e.default=o},762:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var n=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),r=_interopRequireDefault(i(8)),a=i(4),s=i(7),o=_interopRequireDefault(i(117));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var h=function(i){function FadeAnimation(t){var e;return(e=i.call(this)||this).container=t,e.onSwap=new r.default,e.onComplete=new r.default,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(FadeAnimation,i);var t=FadeAnimation.prototype;return t.build=function(){this.built||(this.built=!0,this.bg=new o.default(0,1),this.addChild(this.bg),this.bg.resize(9999,9999))},t.play=function(){var t=this;this.killTweens(),this.playing=!0,this.killTweens(),this.build(),this.container&&this.container.addChild(this),this.alpha=0,s.TweenLite.to(this,.2,{ease:a.Power0.easeNone,alpha:1,onComplete:function(){return t.swap()}}),s.TweenLite.to(this,.3,{ease:a.Power0.easeNone,alpha:0,delay:.3,onComplete:function(){return t.complete()}})},t.swap=function(){this.onSwap.dispatch(),this.container&&this.container.addChild(this)},t.complete=function(){this.playing&&(this.playing=!1,this.killTweens(),this.parent&&this.parent.removeChild(this),this.onComplete.dispatch())},t.killTweens=function(){s.TweenLite.killTweensOf(this)},FadeAnimation}(n.Container);e.default=h},765:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var r=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),n=_interopRequireDefault(i(149)),a=i(7),s=_interopRequireDefault(i(117));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var o={duration:1},h=function(n){function MisteryTransition(t){var e;return void 0===t&&(t={}),e=n.call(this)||this,t=Object.assign({},o,t),e.duration=t.duration,e}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(MisteryTransition,n);var t=MisteryTransition.prototype;return t.build=function(){this.built||(this.built=!0,this.black=new s.default(0,1),this.black.resize(9999,9999),this.circle=(new r.Graphics).beginFill(1044480).drawCircle(0,0,5))},t.start=function(t,e,i){n.prototype.start.call(this,t,e,i),this.build(),this.resize(),this.currentScreen?this._startTransitionOut():this._startTransitionIn()},t.resize=function(t,e){this.w=t||this.w,this.h=e||this.h,this.targetScale=this.w/100*20,this.circle&&(this.circle.x=this.w/2,this.circle.y=this.h/2),this.black&&(this.black.x=this.w/2,this.black.y=this.h/2)},t._startTransitionOut=function(){TweenLite.killTweensOf(this.black),this.container.addChild(this.black),this.black.alpha=0,TweenLite.to(this.black,.3*this.duration,{alpha:1,ease:Sine.easeOut,onComplete:this._onTransitionOutComplete.bind(this)})},t._onTransitionOutComplete=function(){this.transitionOutComplete.dispatch(),this._startTransitionIn()},t._startTransitionIn=function(){this.black.alpha=0,this.container.addChild(this.circle),this.container.addChild(this.black),this.container.mask=this.circle,TweenLite.killTweensOf(this.circle),this.circle.scale.set(.001),this.circle.rotation=0,TweenLite.to(this.circle.scale,.7*this.duration,{x:this.targetScale,y:this.targetScale,ease:a.Power2.easeIn,onComplete:this._onTransitionInComplete.bind(this)}),TweenLite.to(this.circle,.7*this.duration,{rotation:3*Math.PI}),this.transitionInStart.dispatch()},t._onTransitionInComplete=function(){this.container.removeChild(this.black),this.container.removeChild(this.circle),this.container.mask=null,this.transitionComplete.dispatch()},MisteryTransition}(n.default);e.default=h},766:function(t,e,i){"use strict";e.__esModule=!0,e.default=function(t){void 0===t&&(t=!1);var e=a.default.instance.iPad&&1===window.devicePixelRatio||function(){var t=navigator.userAgent;return/Kindle/i.test(t)||/Silk/i.test(t)||/KFTT/i.test(t)||/KFOT/i.test(t)||/KFJWA/i.test(t)||/KFJWI/i.test(t)||/KFSOWI/i.test(t)||/KFTHWA/i.test(t)||/KFTHWI/i.test(t)||/KFAPWA/i.test(t)||/KFAPWI/i.test(t)}()||function(){if(a.default.instance.iOS_version&&a.default.instance.iOS_version.length)return a.default.instance.iOS_version[0]<10;return!1}()||function(t){if(!t)return!1;var e=0;if(!a.default.instance.iOS_version)return!1;var i=document.createElement("canvas"),n=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");r&&(e=n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));return e<=4}(t),i=o.join(" ");matchItem(i,r),matchItem(i,s);if(i.includes("SM-T113"))return 2;if(e)return 2;var n=function(){if(window.gmi){var t=JSON.parseInt(window.gmi.device.class());return-1!==t?t:3e3}return 3e3}();if(n<2015)return 2;if(n<2015&&a.default.instance.android)return 2;if(2015<n)return 0;return 1};var n,a=(n=i(23))&&n.__esModule?n:{default:n};var r=[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],s=[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],o=[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera];function matchItem(t,e){var i,n,r,a=0,s=0;for(a=0;a<e.length;a+=1)if(new RegExp(e[a].value,"i").test(t)){if(i=new RegExp(e[a].version+"[- /:;]([d._]+)","i"),r="",(n=t.match(i))&&n[1]&&(n=n[1]),n)for(n=n.split(/[._]+/),s=0;s<n.length;s+=1)r+=0===s?n[s]+".":n[s];else r="0";return{name:e[a].name,version:parseFloat(r)}}return{name:"unknown",version:0}}},77:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var u=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1)),s=_interopRequireDefault(i(10)),r=i(7),a=_interopRequireDefault(i(29)),n=_interopRequireDefault(i(18)),o=_interopRequireDefault(i(60)),h=_interopRequireDefault(i(78)),p=_interopRequireDefault(i(13)),l=_interopRequireDefault(i(25)),d=_interopRequireDefault(i(44)),f=_interopRequireDefault(i(55));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var c=new(function(){function RewardsPanel(){this.itemList=[],this.buttons=[],this.signals={end:new n.default,continue:new n.default,reward:new n.default,show:new n.default},this.retryCost=250,this.fromEmpty=!1,this.isClosing=!1,this.isShowing=!1}var t=RewardsPanel.prototype;return t.build=function(){var t=this;this.container=new u.Container,this.blackShape=(new u.Graphics).beginFill(0).drawRect(-1e3,-1e3,1e4,1e4),this.blackShape.alpha=.5,this.blackShape.interactive=!0,this.blackShape.buttonMode=!0,this.blackShape.pointerup=function(){t.onClose()},this.container.addChild(this.blackShape),this.container.interactive=!0,this.container.visible=!1,this.particleContainer=new u.Container,this.particleSystem=new h.default,this.particleContainer.addChild(this.particleSystem),this.background=new u.Sprite.from("back_panel_reward.png"),this.background.anchor.set(.5),this.container.addChild(this.background),this.background.addChild(this.particleContainer),this.background.interactive=!0,this.backPanel=u.Sprite.from("bar_reward_main.png");var e=u.Sprite.from("bar_reward_tintable.png");e.anchor.set(.5),this.backPanel.addChild(e),this.backPanel.highlight=e,this.backPanel.anchor.set(.5),this.backPanel.width=.85*this.background.width,this.background.addChild(this.backPanel),this.emptyWinSubtitle=new s.default({text:p.default.get("rewards_subtitle_nothing"),fill:16777215,padding:10,fontSize:25,y:-10}),this.emptyWinSubtitle.visible=!1,this.background.addChild(this.emptyWinSubtitle);var i=new s.default({text:"YOU WON",fill:16777215,padding:10,fontSize:28});this.backPanel.title=i,this.backPanel.addChild(i),this.typeText=new s.default({text:"NEW BUILDINGS",fill:16777215,padding:10,fontSize:28,x:15,y:-.5*this.background.height+44}),this.background.addChild(this.typeText),this.btnClose=new a.default({base:"button_no.png",noScale:!0}),this.background.addChild(this.btnClose),this.btnClose.onTap=this.onClose.bind(this),this.btnClose.x=.5*this.background.width-.75*this.btnClose.width,this.btnClose.y=-.5*this.background.height+.75*this.btnClose.height,this.buttons.push(this.btnClose),this.btnOk=new a.default({base:"button_yes.png",noScale:!0}),this.background.addChild(this.btnOk),this.btnOk.onTap=this.onClose.bind(this),this.btnOk.y=.5*this.background.height-.75*this.btnOk.height,this.buttons.push(this.btnOk);var n=new s.default({text:"1000",fill:16777215,padding:10,fontSize:24,anchorX:1,x:-.29*this.background.width,y:-.5*this.background.height+43});this.background.coinText=n,this.background.addChild(n),this.currentDistrict=1,this.retryCost=d.default.get("replayDigCost"),this.createMinigameButtons()},t.addParticle=function(t){this.canUpdate=!0;for(var e=this.container.toLocal(t.getGlobalPosition()),i=0;i<20;i++){var n=2*Math.PI/20*i,r=20*Math.cos(n),a=20*Math.sin(n),s=0-r,o=0-a,h=Math.atan2(o,s),l={texture:"minigame_win_particle.png",gravity:0,velocityX:500*Math.cos(h),velocityY:500*Math.sin(h),alphaDelay:.15,x:r,y:a,alphaDecress:1.5,scale:.05+.25*Math.random(),angSpeed:5};this.particleSystem.show(e,1,l),l.velocityY*=.5,l.alphaDelay=.25,this.particleSystem.show(e,1,l)}},t.createMinigameButtons=function(){this.minigameButtonContainer=new u.Container,this.background.addChild(this.minigameButtonContainer),this.btnReplay=new a.default({base:"button_coin_amount.png",noScale:!0,downDepth:5}),this.minigameButtonContainer.addChild(this.btnReplay),this.btnReplay.onTap=this.onContinueMinigame.bind(this),this.buttons.push(this.btnReplay);var t=new s.default({fill:16777215,padding:10,fontSize:17,x:2});t.text=p.default.get("play_again"),t.y=.25*-this.btnReplay.height,this.btnReplay.add(t),this.replayCoinText=new s.default({text:this.retryCost[this.currentDistrict-1].toString(),fill:16777215,fontSize:20,x:10,y:10}),this.btnReplay.add(this.replayCoinText),this.btnEnd=new a.default({base:"button_big.png",noScale:!0,downDepth:5}),this.btnEnd.x=1.5*this.btnReplay.width,this.minigameButtonContainer.addChild(this.btnEnd),this.btnEnd.onTap=this.onEndMinigame.bind(this),this.buttons.push(this.btnEnd);var e=new s.default({fill:16777215,padding:10,fontSize:20,y:-2});e.text=p.default.get("no_thanks"),this.btnEnd.add(e),this.minigameButtonContainer.y=.5*this.background.height-.75*this.minigameButtonContainer.height,this.minigameButtonContainer.x=-.5*this.minigameButtonContainer.width+.5*this.btnReplay.width},t.onContinueMinigame=function(){this.onClose(),this.signalType="continue"},t.onEndMinigame=function(){this.onClose(),this.signalType="end"},t.onClose=function(){this.isClosing||this.isShowing||(this.hide(),this.isClosing=!0,this.signalType="end")},t.hide=function(){var t=this;r.TweenLite.to(this.background.scale,.15,{x:.75,y:.75,ease:r.Back.easeIn,onComplete:function(){t.destroyAll(),t.signals[t.signalType]&&t.signals[t.signalType].dispatch(t.retryCost[t.currentDistrict-1]),t.emptyWinSubtitle.visible=!1,t.fromEmpty&&"continue"!==t.signalType||(t.background.scale.set(0),t.container.visible=!1,o.default.instance.remove(t.update,t),t.particleSystem.killAll(),t.signals.continue.detachAll(),t.signals.end.detachAll()),t.isClosing=!1,t.fromEmpty=!1}})},t.update=function(){this.particleSystem.update(1/60)},t.show=function(t,e){var i=this;void 0===t&&(t=!1),void 0===e&&(e=!0),this.setButtonState(!0),this.isClosing=!1,this.isShowing=!0,t&&(this.addParticle(this.background),l.default.playSfx("dig-results-win")),o.default.instance.add(this.update,this,1),this.signals.show.dispatch(),this.container.visible=!0,this.backPanel.visible=e,r.TweenLite.killTweensOf(this.background.scale);for(var n=0;n<this.itemList.length;n++){this.itemList[n].scale.set(0)}this.background.scale.set(.75),r.TweenLite.to(this.background.scale,.15,{x:1,y:1,ease:r.Back.easeOut,onComplete:function(){i.animateItemsIn()}})},t.animateItemsIn=function(){for(var n=this,t=function(t){var e=n.itemList[t],i=Math.abs(e.x-e.newX)/250;e.scale.set(0),r.TweenLite.to(e.scale,.3,{x:1,y:1,ease:r.Back.easeOut,onComplete:function(){e.newX&&r.TweenLite.to(e,i,{x:e.newX,ease:r.Back.easeOut}),n.isShowing=!1}})},e=0;e<this.itemList.length;e++)t(e);0===this.itemList.length&&(this.isShowing=!1)},t.animateItemsOut=function(){var i=this;if(this.isClosing=!0,this.setButtonState(!1),0<this.itemList.length)for(var t=function(t){function Hia(){r.TweenLite.to(e.scale,.5,{x:0,y:0,ease:r.Back.easeIn,onComplete:function(){t===i.itemList.length-1&&i.hide()}})}var e=i.itemList[t];Math.abs(0-e.newX);e.newX?r.TweenLite.to(e,.5,{x:0,ease:r.Back.easeIn,onComplete:function(){Hia()}}):Hia()},e=0;e<this.itemList.length;e++)t(e);else this.hide()},t.showObjectReward=function(t,e,i,n){void 0===t&&(t=[]),void 0===i&&(i={subtitle:"",title:p.default.get("rewards_subtitle_districts")}),void 0===n&&(n=!1),this.btnOk.visible=!0,this.minigameButtonContainer.visible=!1,this.destroyAll(),this.backPanel.title.text=i.subtitle,this.backPanel.highlight.tint=f.default.getColorByDistrict(e),this.typeText.text=i.title,this.backPanel.title.y=-.35*this.backPanel.height;var r=new u.Container;this.background.addChild(r);for(var a=0;a<t.length;a++){var s=t[a],o=u.Sprite.from("piece_district_tintable.png"),h=u.Sprite.from("piece_district_outline.png");h.anchor.set(.5),o.addChild(h),o.tint=f.default.getColorByDistrict(e),this.itemList.push(o),o.anchor.set(.5);var l=.5*t.length,d=t.length%2==0?.5*o.width+10:0;o.newX=a<l?a*(o.width+10)+d:l<a?(Math.floor(l)-a)*(o.width+10)-d:-d,r.addChild(o);var c=new u.Sprite.from(s.texture||u.Texture.WHITE);c.anchor.set(.5),c.width=.75*o.width,c.scale.y=c.scale.x,o.addChild(c)}0<r.children.length&&(r.x=this.backPanel.x-.5*r.width+.5*r.children[0].width,r.y=this.backPanel.y+.25*r.children[0].height),this.show(!n)},t.showCoinReward=function(t,e){void 0===t&&(t=25),this.btnOk.visible=!0,this.minigameButtonContainer.visible=!1,this.destroyAll(),this.backPanel.highlight.tint=f.default.getColorByDistrict(e),this.typeText.text=p.default.get("rewards_title_coins"),this.backPanel.title.text=p.default.get("rewards_subtitle_coins"),this.backPanel.title.y=-.5*this.backPanel.height+.45*this.backPanel.title.height+2;var i=new u.Sprite.from("piece_money_tintable.png"),n=u.Sprite.from("piece_district_outline.png");n.anchor.set(.5),i.addChild(n);var r=u.Sprite.from("piece_money_coin.png");r.anchor.set(.5),i.addChild(r),i.tint=f.default.getColorByDistrict(e),this.itemList.push(i),i.y=this.backPanel.y+.25*i.height,i.anchor.set(.5),this.background.addChild(i);var a=new s.default({text:t.toString(),fill:16777215,padding:10,fontSize:24});a.scale.set(1),85<a.width&&(a.width=85,a.scale.y=a.scale.x),i.addChild(a),a.y=.3*i.height-2,i.scale.set(.5),this.signals.reward.dispatch(t),this.show(!0)},t.showUserCoins=function(t){this.userCoins=t||0,this.background.coinText.text=d.default.numberWithCommas(this.userCoins.toString()),this.background.coinText.scale.set(1),100<this.background.coinText.width&&(this.background.coinText.width=100,this.background.coinText.scale.y=this.background.coinText.scale.x)},t.showEmptyWin=function(t,e){void 0===t&&(t=2),this.destroyAll(),this.replayCoinText.text=this.retryCost[t-1].toString(),this.emptyWinSubtitle.visible=!0,e?(this.emptyWinSubtitle.text=p.default.get("rewards_subtitle_nothing_afford"),this.typeText.text=p.default.get("rewards_title_nothing_afford"),this.minigameButtonContainer.visible=!0,this.btnOk.visible=!1):(this.emptyWinSubtitle.text=p.default.get("rewards_subtitle_nothing"),this.typeText.text=p.default.get("rewards_title_nothing"),this.minigameButtonContainer.visible=!1,this.btnOk.visible=!0),this.fromEmpty=!0,this.show(!1,!1),l.default.playSfx("dig-results-lose")},t.setButtonState=function(t){for(var e=0;e<this.buttons.length;e++){this.buttons[e].interactive=t}},t.destroyAll=function(){for(var t=0;t<this.itemList.length;t++){var e=this.itemList[t];e.parent.removeChild(e)}this.itemList=[]},RewardsPanel}());e.default=c},78:function(t,e,i){"use strict";e.__esModule=!0,e.default=void 0;var l=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};n.get||n.set?Object.defineProperty(e,i,n):e[i]=t[i]}return e.default=t,e}}(i(1));var n=function(e){function ParticleSystem(){var t;return(t=e.call(this)||this).particles=[],t.PARTICLE_POOL=[],t.maxParticles=150,t.screenSize={width:100,height:100},t}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(ParticleSystem,e);var t=ParticleSystem.prototype;return t.resize=function(t,e){this.screenSize={width:t,height:e}},t.lerp=function(t,e,i){return(1-i)*t+i*e},t.killAll=function(){for(var t=this.particles.length-1;0<=t;t--){var e=this.particles[t];e.parent&&e.parent.removeChild(e),this.PARTICLE_POOL.push(e)}this.particles.length=[]},t.update=function(t){if(this.particles&&this.particles.length)for(var e=this.particles.length-1;0<=e;e--){var i=this.particles[e];if(i.delay<=0){if(i.x+=i.velocity.x*t,i.y+=i.velocity.y*t,i.rotation+=i.angSpeed*i.rotationDirection*t,0!=i.scaleSpeed.x&&(i.currentScale.x+=i.scaleSpeed.x*t,i.scale.x=Math.sin(i.currentScale.x)*i.mainScale),0!=i.scaleSpeed.y&&(i.currentScale.y+=i.scaleSpeed.y*t,i.scale.y=Math.sin(i.currentScale.y)*i.mainScale),i.alphaDelay<=0?i.dontAlphaTween&&!i.target?i.alpha-=Number(t)*i.alphaDecress:i.alpha<i.targetAlpha?(i.alpha+=Number(t)*i.alphaDecress,i.alpha>=i.targetAlpha&&(i.alpha=i.targetAlpha,i.dontAlphaTween=!0)):i.alpha>i.targetAlpha&&(i.alpha-=Number(t)*i.alphaDecress,i.alpha>=i.targetAlpha&&(i.alpha=i.targetAlpha,i.dontAlphaTween=!0)):i.alphaDelay-=t,i.target)if(i.timer-=t,i.timer<=0){var n=Math.atan2(i.target.y-i.y,i.target.x-i.x),r=Math.cos(n)*i.target.speed,a=Math.sin(n)*i.target.speed;i.velocity.x=this.lerp(i.velocity.x,r,.15),i.velocity.y=this.lerp(i.velocity.y,a,.15),Math.sqrt((i.x-i.target.x)*(i.x-i.target.x)+(i.y-i.target.y)*(i.y-i.target.y))<i.height&&(i.alpha=0,i.onCompleteCallback&&i.onCompleteCallback(i),i.onCompleteSignal&&(i.onCompleteSignal.dispatch(i),i.onCompleteSignal.dispose(),i.onCompleteSignal=null))}else i.velocity.y+=i.gravity*t;else i.velocity.y+=i.gravity*t;i.alpha<=0&&(i.parent&&i.parent.removeChild(i),this.PARTICLE_POOL.push(i),this.particles.splice(e,1))}else i.delay-=t}},t.kill=function(){},t.show=function(t,e,i){void 0===e&&(e=10),void 0===i&&(i={}),this.totParticles=e;for(var n=0;n<this.totParticles&&!(this.particles.length>this.maxParticles);n++){var r=void 0;this.PARTICLE_POOL.length&&(r=this.PARTICLE_POOL[0],this.PARTICLE_POOL.shift()),(r=r||new l.Sprite).texture=l.Texture.from(i.texture||"particle.png"),r.tint=i.tint||r.tint,r.gravity=null!=i.gravity?i.gravity:900,r.value=i.value||0,r.alpha=null!=i.customAlpha?i.customAlpha:1,r.targetAlpha=null!=i.targetAlpha?i.targetAlpha:r.alpha,r.alphaDelay=null!=i.alphaDelay?i.alphaDelay:0,r.alpha==r.targetAlpha?r.dontAlphaTween=!0:r.dontAlphaTween=!1,r.tint=i.tint||16777215,r.alphaDecress=null!=i.alphaDecress?i.alphaDecress:1,r.x=t.x,r.y=t.y,r.angSpeed=i.angSpeed||0,r.rotation=0,r.anchor.set(.5),r.scale.set(1),r.blendMode=null!=i.blendMode?i.blendMode:0,r.delay=null!=i.delay?i.delay:0;var a=i.scale||.03;r.timer=0,r.target=i.target,r.target&&(r.target.speed=r.target.speed||500,r.timer=r.target.timer,r.target.onCompleteSignal&&(r.onCompleteSignal=r.target.onCompleteSignal),r.target.onCompleteCallback&&(r.onCompleteCallback=r.target.onCompleteCallback)),r.mainScale=this.screenSize.height/(r.height*r.scale.y)*a,r.scale.set(r.mainScale),r.scaleSpeed=null!=i.scaleSpeed?i.scaleSpeed:{x:0,y:0},r.currentScale={x:0,y:0};var s={x:null!=i.forceX?i.forceX:400,y:null!=i.forceY?i.forceY:500};r.velocity={x:s.x,y:s.y},i.preventRandomX||(r.velocity.x*=.5-Math.random()),i.forceDirectionX&&(r.velocity.x*=i.forceDirectionX),i.preventRandomY||(r.velocity.y*=.5*-Math.random()-.5),i.forceDirectionY&&(r.velocity.y*=i.forceDirectionY),r.velocity.x=i.velocityX?i.velocityX:r.velocity.x,r.velocity.y=i.velocityY?i.velocityY:r.velocity.y;var o=Math.random()<.5?-1:1;r.rotationDirection=i.rotateWithMovement?Math.sign(r.velocity.x):o;var h=this;i.customContainer&&(h=i.customContainer),h.addChild(r),this.particles.push(r)}},ParticleSystem}(l.Container);e.default=n}});