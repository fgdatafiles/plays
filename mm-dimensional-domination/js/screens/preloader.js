var game=game||{};var images=images||{};var ss=ss||{};var jsons=jsons||{};game.screens=game.screens||{};(function(){'use strict';function Preloader(){WONBATS.Screen.call(this);}
Preloader.prototype=Object.create(WONBATS.Screen.prototype);Preloader.prototype.constructor=Preloader;Preloader.prototype.enter=function(name){WONBATS.Screen.prototype.enter.call(this,name);var i,file,path=game.config.loadingspritesheets.path;globalsignal.add(this.onGlobalSignal.bind(this));this.totalFiles=0;this.loadedFiles=0;this.loader=PIXI.loader;this.loader.add("assets/loading-1.json");this.totalFiles+=4;this.totalFiles+=game.config.sound.manifest.length;this.loader.once("complete",this.loadingAtlasLoaded.bind(this));this.loader.load();this.updateProgress=true;};Preloader.prototype.loadingAtlasLoaded=function(){this.view=new WONBATS.MovieClip(loading,"loading");this.asset.addChild(this.view);this.view.update(0);this.view.stop();this.loadedFiles+=1;this.loader.add("assets/all-1.json");this.loader.add("assets/all-2.json");this.loader.add("assets/all-3.json");this.loader.add("assets/all-4.json");this.loader.once("complete",this.gameAtlasLoaded.bind(this));this.loader.load();this.versionText=new PIXI.Text(" v."+game.config.VERSION,{fontFamily:"normal 12px Arial",align:"left",fill:'#ffffff'});this.versionText.x=800-this.versionText.width;this.versionText.y=450-this.versionText.height;this.asset.addChild(this.versionText);};Preloader.prototype.gameAtlasLoaded=function(){this.loadedFiles+=3;this.loader.off("complete");this.loadSound();};Preloader.prototype.loadSound=function(){createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashAudioPlugin]);createjs.Sound.alternateExtensions=["ogg"];createjs.Sound.on("fileload",this.soundLoaded,this);createjs.Sound.registerSounds(game.config.sound);};Preloader.prototype.soundLoaded=function(data){this.loadedFiles+=1;if(this.totalFiles===this.loadedFiles){createjs.Sound.removeAllEventListeners("fileload");this.view.children[0].gotoAndPlay("out");}};Preloader.prototype.onJsonLoaded=function(file,data){this.loadedFiles+=1;jsons[file.split(".json")[0]]=data;};Preloader.prototype.loadJSON=function loadJSON(path,success,error){var xhr=new XMLHttpRequest();xhr.onload=function(){if(xhr.responseText){success(JSON.parse(xhr.responseText));}else{if(error){error(xhr);}}};xhr.open("GET",path,true);xhr.send();};Preloader.prototype.update=function(dt){if(this.view){this.view.getChildByName("loading").gotoAndStop(game.config.LANGUAGE);if(this.updateProgress){var progress=Math.floor((this.loadedFiles/this.totalFiles)*100);this.view.gotoAndStop(progress);if(this.loadedFiles===this.totalFiles){this.updateProgress=false;game.soundManager.load();this.view.gotoAndPlay("out");}}
this.view.update(dt);}};Preloader.prototype.onGlobalSignal=function(emitter,message){if(message==="exit"){this.transitionSignal.emit(this.name,"exit");}};Preloader.prototype.exit=function(name){this.loader=null;globalsignal.clear();WONBATS.Screen.prototype.exit.call(this,name);};game.screens.Preloader=Preloader;}());