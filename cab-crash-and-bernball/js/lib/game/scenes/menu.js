ig.module('game.scenes.menu').requires('cm.game','game.atlas.home','game.atlas.menu','game.atlas.font','game.entities.menu.bg','game.entities.menu.object','game.entities.menu.btn','game.entities.menu.font','game.entities.menu.home.object').defines(function()
{GameMenu=ig.Game.extend({clearColor:false,bgWallpaperImg:new ig.Image('media/images/scenes/menu/bg-wallpaper.png'),textureAtlas:new ig.Image('media/images/scenes/menu/sprites.png'),homeTextureAtlas:new ig.Image('media/images/scenes/menu/home_sprites.png'),fontTextureAtlas:new ig.Image('media/images/scenes/menu/font_sprites.png'),soundHighScore:new ig.Sound('media/audio/sfx2/high_score.*'),soundLoop:new ig.Sound('media/audio/music/finalMenuLoop.*'),soundCrash3:new ig.Sound('media/audio/sfx2/crash3.*'),soundCrash5:new ig.Sound('media/audio/sfx2/crash5.*'),soundGlass:new ig.Sound('media/audio/sfx2/GlassBreak.*'),soundWoosh:new ig.Sound('media/audio/sfx2/woosh.*'),soundScoreTally:new ig.Sound('media/audio/sfx2/scoreTally.*'),inTransit:false,transitTime:1.5,bgOffset:0,setInPlace:false,panels:{},streams:null,localized:ig.Strings[ig.Config.localized],init:function()
{var textureAtlas=new ig.TextureAtlas(this.textureAtlas,new AtlasMenu().sprites);this.addTextureAtlas('menu_sprites',textureAtlas);textureAtlas=new ig.TextureAtlas(this.homeTextureAtlas,new AtlasHome().sprites);this.addTextureAtlas('home_sprites',textureAtlas);textureAtlas=new ig.TextureAtlas(this.fontTextureAtlas,new AtlasFont().sprites);this.addTextureAtlas('font_sprites',textureAtlas);var rw=ig.system.realWidth;var rh=ig.system.realHeight;this.panels.home=[];this.panels.score=[];this.panels.select=[];this.panels.home.push(this.spawnEntity(entMenuBg,rw*0.5,rh*0.5,{name:'board'}));this.panels.score.push(this.spawnEntity(entMenuBg,rw*0.5,rh*0.5,{name:'junk2'}));this.panels.score.push(this.spawnEntity(entMenuBg,rw*0.5,rh*0.5+40,{name:'scorebox'}));this.panels.select.push(this.spawnEntity(entMenuBg,rw*0.5+1250,rh*0.5,{name:'junk'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,rw*0.5+25,-10,{name:'stream'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,95,60,{name:'disney_logo'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,650,95,{name:'lamp'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,575,140,{name:'amp'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,355,140.5,{name:'crash'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,124,318,{name:'bern'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,344,291.5,{name:'ball_home'}));this.panels.home.push(this.spawnEntity(entMenuHomeObject,533,312,{name:'ball'}));this.panels.home.push(this.spawnEntity(entMenuBtn,rw*0.5,rh-65,{name:'play'}));this.panels.score.push(this.spawnEntity(entMenuBtn,40,40,{name:'replay'}));this.panels.score.push(this.spawnEntity(entMenuBtn,rw-40,40,{name:'next'}));this.panels.score.push(this.spawnEntity(entMenuObject,rw*0.5,60,{name:'good_job'}));this.text5=this.spawnEntity(entMenuFont,rw*0.5-197,345,{name:'white_32',align:ig.Font.ALIGN.LEFT});this.text5.text=0;this.text6=this.spawnEntity(entMenuFont,rw*0.5+55,345,{name:'white_32',align:ig.Font.ALIGN.LEFT});this.text6.text=0;this.text7=this.spawnEntity(entMenuFont,rw*0.5,205,{name:'black_48'});this.text7.mask=0;this.text7.text=this.localized.formatScore?ig.gameTank.data.score.format():ig.gameTank.data.score;this.text8=this.spawnEntity(entMenuFont,rw*0.5-300,422,{name:'purple_13',align:ig.Font.ALIGN.LEFT});this.text8.text=this.localized.YourBestScore;this.text8.font.letterSpacing=-1.8;this.text9=this.spawnEntity(entMenuFont,rw*0.5-173,420,{name:'purple_18',align:ig.Font.ALIGN.LEFT});this.text9.text=this.localized.formatScore?parseInt(ig.gameTank.cookie.get(ig.gameTank.data.room+'_score')||0).format():parseInt(ig.gameTank.cookie.get(ig.gameTank.data.room+'_score')||0);this.text9.font.letterSpacing=-1.6;this.panels.score.push(this.text5);this.panels.score.push(this.text6);this.panels.score.push(this.text7);this.panels.score.push(this.text8);this.panels.score.push(this.text9);this.crashScore=this.spawnEntity(entMenuObject,rw*0.5-180,225,{name:'ball_score'});this.panels.score.push(this.crashScore);this.panels.select.push(this.spawnEntity(entMenuBtn,1250+40,40,{name:'home'}));this.panels.select.push(this.spawnEntity(entMenuObject,rw*0.5+1250,60,{name:'choose_a_room'}));this.panels.select.push(this.spawnEntity(entMenuBtn,rw*0.5+1250-173,rh*0.5+40,{name:'living_room_cupboard'}));this.panels.select.push(this.spawnEntity(entMenuBtn,rw*0.5+1250+173,rh*0.5+40,{name:'jasmines_room_cupboard'}));this.panels.select.push(this.spawnEntity(entMenuObject,rw*0.5+1250+335,rh-150,{name:'crash_stand'}));this.text1=this.spawnEntity(entMenuFont,rw*0.5+1250-160,rh*0.5+55,{name:'black_13'});this.text2=this.spawnEntity(entMenuFont,rw*0.5+1250+186,rh*0.5+55,{name:'black_13'});this.text1.font.letterSpacing=this.text2.font.letterSpacing=-1.8;this.text1.text=this.text2.text=this.localized.YourBestScore;this.panels.select.push(this.text1);this.panels.select.push(this.text2);this.text3=this.spawnEntity(entMenuFont,rw*0.5+1250-160,rh*0.5+75,{name:'black_22'});this.text4=this.spawnEntity(entMenuFont,rw*0.5+1250+186,rh*0.5+75,{name:'black_22'});this.text3.text=this.localized.formatScore?parseInt(ig.gameTank.cookie.get('living_room_score')||0).format():parseInt(ig.gameTank.cookie.get('living_room_score')||0);this.text4.text=this.localized.formatScore?parseInt(ig.gameTank.cookie.get('jasmines_room_score')||0).format():parseInt(ig.gameTank.cookie.get('jasmines_room_score')||0);this.text3.font.letterSpacing=this.text4.font.letterSpacing=-1.6;this.panels.select.push(this.text3);this.panels.select.push(this.text4);this.jumpToPanel(ig.gameTank.data.menu);if(this.panel=='home')
{this.getEntityByName('play').pos.y=ig.gameTank.game.h+200;this.getEntityByName('disney_logo').currentAnim.angle=(10).toRad();this.getEntityByName('bern').pos.x=-200;this.getEntityByName('ball').pos.x=ig.gameTank.game.w+200;this.getEntityByName('crash').pos.y=-100;var ball=this.getEntityByName('ball_home');ball.pos.x=275,ball.pos.y=-34;ball.setScale(0.3);this.streams=[0,0,0];}
if(ig.ua.mobile&&ig.gameTank.data.playCount==0)
ig.input.on('mousedown',this.playBgMusic.bind(this),'initBgMusic');else
this.playBgMusic();if(ig.ua.android&&ig.gameTank.data.playCount>0)
ig.gameTank.soundJockey.playSound('gameloops','menu',this.soundComplete.bind(this));else
{if(ig.ua.android)
{var loadSoundJockey=function()
{ig.gameTank.soundJockey.playSound('gameloops','menu',this.soundComplete.bind(this));ig.$('#canvas').removeEventListener(ig.ua.touchDevice?'touchstart':'mousedown',loadSoundJockey);}.bind(this)
ig.$('#canvas').addEventListener(ig.ua.touchDevice?'touchstart':'mousedown',loadSoundJockey);}}
ig.gameTank.data.playCount++;ig.system.context.fillStyle=ig.system.context.createPattern(this.bgWallpaperImg.data,'repeat');},draw:function()
{var ctx=ig.system.context,rw=ig.system.realWidth,rh=ig.system.realHeight;ctx.clearRect(0,0,rw,rh);ctx.save();ctx.translate(-this.screen.x,0);ctx.fillRect(this.screen.x,0,rw,rh);ctx.restore();this.parent();},start:function()
{if(this.panel=='home')
{var ball=this.getEntityByName('ball_home');TweenMax.to(this,1.6,{onComplete:function(){this.streams=null}.bind(this)});TweenMax.to(ball.pos,0.3,{x:192,y:37,ease:Linear.easeNone,onUpdate:function(){this.streams[0]=ball.pos.y}.bind(this),onComplete:function(){this.getEntityByName('disney_logo').currentAnim.angle=0;this.soundCrash3.play();if(ig.ua.android)ig.gameTank.soundJockey.playSound('soundeffects','crash3');}.bind(this)});TweenMax.to(ball.pos,0.35,{x:392,y:56,ease:Linear.easeNone,delay:0.3,onUpdate:function(){this.streams[1]=ball.pos.x}.bind(this)});TweenMax.to(ball.pos,0.35,{x:550,y:115,ease:Linear.easeNone,delay:0.65,onUpdate:function(){this.streams[1]=ball.pos.x}.bind(this),onComplete:function()
{var a=this.getEntityByName('amp');a.currentAnim=a.anims.broken;var l=this.getEntityByName('lamp');l.currentAnim=l.anims.broken;this.soundGlass.play();if(ig.ua.android)
ig.gameTank.soundJockey.playSound('soundeffects','glassBreak');}.bind(this)});TweenMax.to(ball.pos,0.5,{x:368.5,y:285.5,ease:Linear.easeNone,delay:1,onUpdate:function(){this.streams[2]=ball.pos.y}.bind(this),onComplete:this.shakeMe.bind(ball)});TweenMax.to(this.getEntityByName('lamp').pos,0.4,{x:'+=30',delay:1});TweenMax.to(ball.scale,0.3,{x:0.35,y:0.35,ease:Linear.easeNone});TweenMax.to(ball.scale,0.35,{x:0.5,y:0.5,ease:Linear.easeNone,delay:0.3});TweenMax.to(ball.scale,0.35,{x:0.65,y:0.65,ease:Linear.easeNone,delay:0.65});TweenMax.to(ball.scale,0.5,{x:1,y:1,ease:Linear.easeNone,delay:1});TweenMax.to(ball.currentAnim,0.3,{angle:'-='+(135).toRad(),ease:Linear.easeNone});TweenMax.to(ball.currentAnim,0.35,{angle:'+='+(180).toRad(),ease:Linear.easeNone,delay:0.3});TweenMax.to(ball.currentAnim,0.35,{angle:'+='+(180).toRad(),ease:Linear.easeNone,delay:0.65});TweenMax.to(ball.currentAnim,0.5,{angle:0,ease:Linear.easeNone,delay:1});var b=this.getEntityByName('bern');var ll=this.getEntityByName('ball');TweenMax.to(b.pos,0.2,{x:124,ease:Linear.easeNone,delay:1.25,onComplete:this.shakeMe.bind(b)});TweenMax.to(ll.pos,0.2,{x:533,ease:Linear.easeNone,delay:1.25,onComplete:this.shakeMe.bind(ll)});TweenMax.to(this.getEntityByName('crash').pos,0.5,{y:140.5,ease:Bounce.easeOut,delay:1.8,onComplete:function(){this.getEntityByName('play').pos.y=ig.system.realHeight-65}.bind(this)});}
else if(this.panel=='score')
{TweenMax.to(this.text5,1,{text:ig.gameTank.data.combo,ease:Linear.easeNone,delay:1,onStart:function(){this.soundScoreTally.play();if(ig.ua.android)ig.gameTank.soundJockey.playSound('soundeffects','scoreTally');}.bind(this),onUpdate:function(){this.text5.text=this.localized.formatScore?parseInt(this.text5.text).format():parseInt(this.text5.text)}.bind(this)});TweenMax.to(this.text6,1,{text:ig.gameTank.data.destruction,ease:Linear.easeNone,delay:2,onStart:function(){this.soundScoreTally.play();if(ig.ua.android)ig.gameTank.soundJockey.playSound('soundeffects','scoreTally');}.bind(this),onUpdate:function(){this.text6.text=this.localized.formatScore?parseInt(this.text6.text).format():parseInt(this.text6.text)}.bind(this)});TweenMax.to(this.crashScore.currentAnim,1,{angle:'+='+(400).toRad(),ease:Linear.easeNone});TweenMax.to(this.crashScore.pos,1,{x:ig.system.realWidth*0.5+180,ease:Linear.easeNone,onUpdate:function()
{this.text7.mask=this.crashScore.pos.x}.bind(this),onComplete:function()
{this.text7.mask=null;if(ig.gameTank.data.isHighscore)
{this.soundHighScore.play();if(ig.ua.android)
ig.gameTank.soundJockey.playSound('soundeffects','highScore');}}.bind(this)});}},soundComplete:function()
{ig.gameTank.soundJockey.playSound('gameloops','menu',this.soundComplete.bind(this))},playBgMusic:function()
{ig.music.add(this.soundLoop,'loop');ig.music.play('loop');ig.music.volume=0.4;ig.music.loop=true;ig.input.off('initBgMusic');},shakeMe:function()
{if(this.name=='ball_home')
{ig.game.soundCrash5.play();if(ig.ua.android)
ig.gameTank.soundJockey.playSound('soundeffects','crash5');}
var px=this.pos.x;var py=this.pos.y;TweenMax.to(this.pos,0.4,{x:this.pos.x-50,y:this.pos.y+25,ease:Circ.easeOut,onComplete:function()
{TweenMax.to(this.pos,0.8,{x:px,y:py,ease:Elastic.easeOut})}.bind(this)});},jumpToPanel:function(panel)
{if(panel=='home'||panel=='score')
this.screen.x=0;else if(panel=='select')
this.screen.x=1250;if(panel=='home')
{for(var i=0,el;el=this.panels.score[i++];)
el.pos.y-=9999;}
else if(panel=='score')
{for(var i=0,el;el=this.panels.home[i++];)
el.pos.y-=9999;}
this.panel=panel;},gotoPanel:function(panel)
{if(this.inTransit)
return;this.inTransit=true;this.soundWoosh.play();var x;if((this.panel=='home'&&panel=='select')||(this.panel=='score'&&panel=='select'))
x=1250;else if(this.panel=='select'&&panel=='home')
x=0;var ftn;if(this.panel=='home'&&panel=='select')
ftn=function()
{this.inTransit=false}.bind(this);else
ftn=function()
{this.inTransit=false;if(this.panel=='select'&&!this.setInPlace)
{this.setInPlace=true;for(var i=0,el;el=this.panels.score[i++];)
el.pos.y-=9999;for(var i=0,el;el=this.panels.home[i++];)
if(el.pos.y>9000)
break;else
el.pos.y+=9999;}}.bind(this);this.panel=panel;TweenMax.to(this.screen,this.transitTime,{x:x,ease:Back.easeOut,onComplete:ftn})}})})