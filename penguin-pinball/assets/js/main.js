!function(){var a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q=include("PIXI.Point"),r=include("PIXI.Sprite"),t=include("PIXI.Graphics"),u=include("PIXI.Container"),v=include("WGBH.Vector"),w=include("WGBH.UIPanel"),x=include("springroll.EventDispatcher"),y=include("WGBH.PhysicsManagerBox2d"),z=include("WGBH.PhysicsRenderer"),A=include("WGBH.WorldObject"),B=function(a){this.events=new x},C=B.prototype,D={},E="v",F={left:null,top:null,bottom:null,right:null};F=null;var G,H,I,J,K,L,M,N,O=0,P=30,Q=0,R=10,S=!1,T=!0,U=!1,V=!1,W=32,X=W,Y=W,Z={},$={},_={};C.setup=function(a,b,c){this.parent=c,this.panel=a,this.container=b,R=app.config.phys.restspeed,l=app.config.phys.maxforce,n=app.config.phys.minforce,p=app.config.gameoptions.launchertouchradius*app.config.gameoptions.launchertouchradius,h={l:app.config.gameoptions.targetradius.l*app.config.gameoptions.targetradius.l,m:app.config.gameoptions.targetradius.m*app.config.gameoptions.targetradius.m,s:app.config.gameoptions.targetradius.s*app.config.gameoptions.targetradius.s},holedistance=app.config.gameoptions.holedistance,this.sense=this.sense.bind(this),this.collision=this.collision.bind(this),this.stopsense=this.stopsense.bind(this),this.update=this.update.bind(this),this.checkvictory=this.checkvictory.bind(this),this.reload=this.reload.bind(this),this.placetarget=this.placetarget.bind(this),this.togglestar=this.togglestar.bind(this),this.history=[],this.document={},this.draglauncher=this.draglauncher.bind(this),this.movelauncher=this.movelauncher.bind(this),this.droplauncher=this.droplauncher.bind(this),this.dragtarget=this.dragtarget.bind(this),this.movetarget=this.movetarget.bind(this),this.droptarget=this.droptarget.bind(this),this.dragitem=this.dragitem.bind(this),this.moveitem=this.moveitem.bind(this),this.dropitem=this.dropitem.bind(this),this.itemtoadd="",f=new y,g=new z({container:b}),this.rend=g,f.setScale(app.config.phys.scale),f.setGravity(0),g.setphysics(f),g.container.interactive=!0,d=this.panel.items.launcher,this.container.addChild(d),d.aim=new q,d.angle=0,d.last=new q,this.setsize(app.config.gameoptions.rinkframe);var e=app.config.items.icebg.clone();e.frame={x:H.x,y:H.y},e=this.panel.additem(e,this.container),e.buttonMode=!1;var i=app.config.items.iceshine.clone();i.frame={x:H.x+(H.w-i.frame.w)/2,y:H.y+(H.h-i.frame.h)/2};for(var j=(this.panel.additem(i,this.container),[[H.x,H.y,-.5,-.5],[H.x+H.w,H.y,.5,-.5],[H.x+H.w,H.y+H.h,.5,.5],[H.x,H.y+H.h,-.5,.5]]),m=0;4>m;m++){var o=app.config.items.rinkcorner.clone();offsetx=o.frame.w*j[m][2],offsety=o.frame.h*j[m][3],o.frame={x:j[m][0]+offsetx,y:j[m][1]+offsety};var s=this.panel.additem(o,this.container);s.rotation=Math.PI*(.5*m)}this.penguinpathlayer=new t,this.container.addChild(this.penguinpathlayer),this.targetvictory=this.panel.additem(app.config.items.targetwin,this.container),this.targetvictory.visible=!1,this.targetvictory.targetring1=this.panel.items.targetring1,this.targetvictory.targetring2=this.panel.items.targetring2,this.targetvictory.targetring3=this.panel.items.targetring3,this.targetvictory.targetring1.alpha=this.targetvictory.targetring2.alpha=this.targetvictory.targetring3.alpha=.75;var u=function(){if(this.flashtimes--,this.visible=!this.visible,this.flashtimes>0){var a=this;app.setTimeout(a.flash,100)}else this.visible=!1};this.targetvictory.targetring1.flash=u.bind(this.targetvictory.targetring1),this.targetvictory.targetring2.flash=u.bind(this.targetvictory.targetring2),this.targetvictory.targetring3.flash=u.bind(this.targetvictory.targetring3),this.targetvictory.showring=function(a){this.visible=!0;var b;switch(a){case 1:b=10,this.targetring1.visible=!1,this.targetring2.visible=!0,this.targetring3.visible=!1,this.targetring1.flashtimes=b,this.targetring1.flash(),this.targetring2.flashtimes=b,this.targetring2.flash(),this.targetring3.flashtimes=b,this.targetring3.flash();break;case 2:b=8,this.targetring1.visible=!1,this.targetring2.visible=!0,this.targetring3.visible=!1,this.targetring2.flashtimes=b,this.targetring2.flash(),this.targetring3.flashtimes=b,this.targetring3.flash();break;case 3:b=6,this.targetring1.visible=!1,this.targetring2.visible=!1,this.targetring3.visible=!0,this.targetring3.flashtimes=b,this.targetring3.flash();break;case 4:b=4,this.targetring1.visible=!1,this.targetring2.visible=!1,this.targetring3.visible=!0,this.targetring3.flashtimes=b,this.targetring3.flash()}},k=new r(images.patharrow),k.anchor={x:0,y:.5},k.visible=!1,this.container.addChild(k),this.dodrawpaths=!0,this.sanddrag=app.config.phys.drag.sand,this.airdrag=app.config.phys.drag.air,this.icedrag=app.config.phys.drag.ice},C.hide=function(){this.container.visible=!1},C.show=function(){this.container.visible=!0},C.setsize=function(a){H=a?app.config.gameoptions.rinkframe:a,G=new q(H.x+H.w/2,H.y+H.h/2)},C.clearlevel=function(){this.targetvictory.visible=!1;for(var d in a)f.destroyObject(a[d]),g.removeObject(a[d]);this.starsgot=0,this.refresh(),this.usertarget=null,a=[],c={},b=[],D={}},C.adjustpos=function(a,b,c){var d=[0,0];return b?(d[0]=a[0]-H.x,d[1]=a[1]-H.y):(d[0]=a[0]+H.x,d[1]=a[1]+H.y),c&&(d[0]=Math.round(d[0]),d[1]=Math.round(d[1])),d},C.rinkposobj=function(a){var b=a.getvisualposition();return this.adjustpos([b.x,b.y],!0,!0)},C.screentoworld=function(a){var b=[a[0]-H.x,a[1]-H.y];return b},C.worldsetupfromlevel=function(a,b){var c=[];c=c.concat([{id:"target",pos:this.adjustpos(a.target)},{id:"plushie",pos:this.adjustpos(a.plushie)}]);var e,f,g;for(e in a.bonus)f=a.bonus[e],c.push({id:"bonus",pos:this.adjustpos(f)});for(e in a.starguess)f=a.starguess[e],c.push({id:"starguess",pos:this.adjustpos(f)});for(e in a.targetplace)f=a.targetplace[e],c.push({id:"targetplace",pos:this.adjustpos(f)});for(e in a.holes)f=a.holes[e],c.push({id:"icehole",pos:this.adjustpos(f)});for(e in a.sand)f=a.sand[e],c.push({id:"sand",pos:this.adjustpos(f)});for(e in a.penguins)g=a.penguins[e][2]?a.penguins[e][2]:120*v.DEG2RAD,f=[a.penguins[e][0],a.penguins[e][1]],c.push({id:"penguin",pos:this.adjustpos(f),rot:g});for(e in a.movingpenguins){var h=a.movingpenguins[e];f=[h.path[0][0],h.path[0][1]];var i=null,j=[];for(var k in h.path){var l=this.adjustpos([h.path[k][0],h.path[k][1]]);j.push(l)}i={path:j};var m={x:j[0][0],y:j[0][1]},n={x:j[1][0],y:j[1][1]},o=new q(n.x-m.x,n.y-m.y);g=v.getangle(o),c.push({id:"movingpenguin",pos:[m.x,m.y],rot:g,special:i})}var p={type:"normal"};"predict"==a.goal.type&&(p=a.goal);var r=a.force?a.force:0,s=a.shots?a.shots:app.config.gameoptions.shotlimit,t=this.adjustpos(a.launcher),u={position:{x:t[0],y:t[1]},force:r,lockforce:a.lockforce,lockposition:a.lockposition};b&&(u={position:{x:d.position.x,y:d.position.y},force:this.forcelevel,lockforce:d.lockforce,lockposition:d.lockposition});var w={gamelayout:c,shots:s,goal:p,launcher:u};if(a.bushes){w.bushes=[];for(e in a.bushes)f=a.bushes[e],w.bushes.push(f)}return w},C.setlevel=function(a,b){if(!a)return null;j=a,this.stopsim(),this.history=[],this.clearlevel(),F=null,T=!0,noshot=!0,V=!1,f.events.off("collide",this.collision),f.events.off("sense",this.sense),f.events.off("stopsense",this.stopsense),o=0,M=-1;var c=this.worldsetupfromlevel(j,b);return this.startfromstate(c),this.events.trigger("setforce",this.forcelevel),this.shotstatus={force:0,launcherpos:[],stars:null,targetpicked:null,fish:{obstacles:[],icehole:!1},plushie:{target:!1,obstacles:[],icehole:!1,moved:!1}},this.reload(),this.refresh(),f.events.on("collide",this.collision),f.events.on("sense",this.sense),f.events.on("stopsense",this.stopsense),this.startsim(),this.aim(!0),"predict"===_.goal.type?this.parent.hideguidebutton():this.parent.showguidebutton(),j},C.addbush=function(a){var b=this.adjustpos(a),c=this.placeitem("bush",b);return c.vis.anchor=new q(.5,.5),F||(F={}),c.vis.position=new q(b[0],b[1]),a[0]<=0?(F.left||(F.left=[]),F.left.push(a[1])):a[0]>=H.w?(F.right||(F.right=[]),F.right.push(a[1])):a[1]<=0?(F.top||(F.top=[]),F.top.push(a[0])):a[1]>=H.h&&(F.bottom||(F.bottom=[]),F.bottom.push(a[0])),c},C.thumbnailfromstate=function(a){var b,c=new u,d=this.getsprite(app.config.items.icebg,[H.x+H.w/2,H.y+H.h/2]);c.addChild(d);var e,f;for(e in a.gamelayout){f=a.gamelayout[e];if(f.obj){if("wall"===f.obj.type)continue;b=this.getsprite(f.obj.config,f.pos,f.rot),b.id=f.obj.id}else b=this.getsprite(app.config.items[f.id],f.pos,f.rot),b.id=f.id;if(b){if("movingpenguin"===b.id){var g=this.getpath(f.special.path);c.addChild(g)}c.addChild(b)}"target"===f.id&&"predict"===a.goal.type&&(b.visible=!1)}for(e in a.bushes)f=this.adjustpos(a.bushes[e]),b=this.getsprite(app.config.items.bush,f),b&&c.addChild(b);return c},C.getsprite=function(a,b,c){var d=new r(images[a.image]),e=this.adjustpos(b,!0);return d.position={x:e[0],y:e[1]},d.anchor={x:.5,y:.5},c&&(d.rotation=c),d},C.getpath=function(a){var b=new t;b.lineStyle(app.config.gameoptions.penguinpath.size,w.colorfromhex(app.config.gameoptions.penguinpath.color),app.config.gameoptions.penguinpath.alpha);var c=this.adjustpos(a[0],!0);b.moveTo(c[0],c[1]);for(var d in a)d>0&&(c=this.adjustpos(a[d],!0),b.lineTo(c[0],c[1]));return b},C.wheresplushie=function(){var a=this.plushie.getvisualposition();return this.adjustpos([a.x,a.y],!0)},C.getstars=function(){var b=[];for(var c in a)"star"===a[c].type&&b.push(a[c]);return b},C.gettargets=function(){var b=[];for(var c in a)"targetplace"===a[c].id&&b.push(a[c]);return b},C.startfromstate=function(a){this.clearlevel(),_={},_.shotlimit=a.shots,_.launcher={};for(var b in a.launcher)_.launcher[b]=a.launcher[b];var c,e=app.config.gameoptions.wallwidth,f=app.config.items.wall.clone();f.physics.forms[0]=f.physics.forms[0].clone(),f.physics.forms[0].size=[2*e,H.h];var h=[H.x-e,H.y+H.h/2];c=this.addtoworld("leftwall",f,h),c.type="wall",c.nomove=!0;var j=f.clone();h=[H.x+H.w+e,H.y+H.h/2],c=this.addtoworld("rightwall",j,h),c.type="wall",c.nomove=!0;var k=f.clone();k.image="wallruler",k.physics.forms[0]=k.physics.forms[0].clone(),k.physics.forms[0].size=[H.w,2*e],h=[H.x+H.w/2,H.y-e],c=this.addtoworld("topwall",k,h),c.type="wall",c.nomove=!0;var l=k.clone();h=[H.x+H.w/2,H.y+H.h+e],c=this.addtoworld("bottomwall",l,h),c.type="wall",c.nomove=!0;var m=[];this.alwaysupdate=!1;for(var n in a.gamelayout){var o=a.gamelayout[n];if(o.obj){if("wall"===o.obj.type)continue;c=this.addtoworld(o.id,o.obj.config,o.pos,o.rot,o.vel)}else c=this.placeitem(o.id,o.pos,o.rot);if("target"==c.id&&(this.target=c,this.targetvictory.position=this.target.vis.position),"plushie"==c.id&&(this.plushie=c,i=this.plushie),"starguess"==c.id&&(c.type="star",c.starpicked=!1,c.activate(this.togglestar)),"bonus"==c.id&&(c.type="star"),"targetplace"==c.id&&c.activate(this.placetarget),"movingpenguin"==c.id){if(this.alwaysupdate=!0,c.vis.setframerate(12),c.vis.loop=!0,c.vis.stopped=!1,o.obj&&o.obj.special&&(c.special=o.obj.special),o.special&&(c.special=o.special),c.special&&(c.path=c.special.path,c.pathstep=0),c.stopchasing(!0),o.obj&&null!==o.obj.savepathstep)c.pathstep=o.obj.savepathstep,c.startwander();else{var p=new q(c.path[1][0],c.path[1][1]);c.turntoface(p)}m.push(c.vis)}"penguin"==c.id&&m.push(c.vis)}for(var r in a.bushes)this.addbush(a.bushes[r]);d.position.x=_.launcher.position.x,d.position.y=_.launcher.position.y,d.rotation=0,d.lockforce=_.launcher.lockforce,d.lockposition=_.launcher.lockposition,this.forcelevel=_.launcher.force,this.container.setChildIndex(this.target.vis,this.container.getChildIndex(this.panel.items.iceshine)),g.setdrawlayer(this.target),this.container.setChildIndex(this.plushie.vis,this.container.children.length-1);for(var s in m)this.container.setChildIndex(m[s],this.container.children.length-1);return this.container.setChildIndex(d,this.container.children.length-1),_.goal={},"predict"==a.goal.type?(this.target.show(!1),_.goal.type="predict","target"==a.goal.config?(I=!0,this.target.hide(),_.goal.config="target"):"stars"==a.goal.config&&(I=!1,_.goal.config="stars")):(I=!1,_.goal.type="normal",this.target.show()),a},C.clearstars=function(){for(var b in a)"star"==a[b].type&&this.selectstar(a[b],!1)},C.togglestar=function(a){if(!V){var b=a.target.wo;this.selectstar(b,!b.starpicked)}},C.selectstar=function(a,b){a.userchanged=!0,a.starpicked=b;var c=b?"star":"staroutline";a.changeimage(c),a.id=b?"bonus":"starguess"},C.getObjectAtPos=function(b){for(var c in a){var d=a[c].getvisualposition();if(d=this.adjustpos([d.x,d.y],!0,!0),d[0]==b[0]&&d[1]==b[1])return a[c]}return null},C.placetarget=function(a){V||this.selecttarget(a.target.wo,a)},C.selecttarget=function(a,b){var c=a.getworldposition();this.target.userchoice&&this.target.userchoice.show(),this.target.setworldposition(c.x,c.y),a.hide(),this.target.userchoice=a,this.target.show(),this.usertarget=this.target,this.targetvictory.position=this.target.vis.position,this.parent.enableshot(),this.refresh(),c=this.adjustpos([this.target.vis.position.x,this.target.vis.position.y],!0,!0),this.parent.chosetarget(c,[b.data.global.x,b.data.global.y]),this.shotstatus.targetpicked=c},C.configfromstate=function(a){var b=this.adjustpos([a.launcher.position.x,a.launcher.position.y],!0),c={force:a.launcher.force,goal:_.goal,lockforce:_.launcher.lockforce,lockposition:_.launcher.lockposition};c.launcher=[Math.round(b[0]),Math.round(b[1]),a.launcher.force];for(var d in a.gamelayout){var e=a.gamelayout[d],f=e.id,g=this.adjustpos([Math.round(e.pos[0]),Math.round(e.pos[1])],!0);if("penguin"==f&&(c.penguins||(c.penguins=[]),c.penguins.push(g)),"movingpenguin"==f){c.movingpenguins||(c.movingpenguins=[]);var h=[];if(e.obj&&e.obj.special)for(var i in e.obj.special.path)h.push(this.adjustpos(e.obj.special.path[i],!0,!0));h.length<1&&(h=[g]),h[0][2]=e.obj.rotation,c.movingpenguins.push({path:h})}else"plushie"==f?c.plushie=g:"target"==f?c.target=g:"bonus"==f?(c.bonus||(c.bonus=[]),c.bonus.push(g)):"icehole"==f?(c.holes||(c.holes=[]),c.holes.push(g)):e.obj&&"star"==e.obj.type?(c[f]||(c[f]=[]),c[f].push(g)):"sand"==f?(c.sand||(c.sand=[]),c.sand.push(g)):"bush"==f?(c.bushes||(c.bushes=[]),c.bushes.push(g)):"targetplace"==f?(c.targetplace||(c.targetplace=[]),c.targetplace.push(g)):"starguess"==f&&(c.starguess||(c.starguess=[]),c.starguess.push(g))}return c.id=this.gameidfromconfig(c),c},C.getgamesettings=function(){return _},C.setgametype=function(a){switch(a){case"predict":_.goal={type:"predict",config:"target"};break;case"normal":_.goal={type:"normal"};break;case"stars":_.goal={type:"predict",config:"stars"}}},C.setlauncherlock=function(a){d.lockposition=a,_.launcher.lockposition=d.lockposition},C.setsliderlock=function(a){d.lockforce=a,_.launcher.lockforce=d.lockforce},C.gameidfromconfig=function(a){var b={sand:0,holes:0,bonus:0,starguess:0,penguins:0,movingpenguins:0,targetplace:0};for(var c in a)if(void 0!==b[c])for(var d in a[c])b[c]++;var e={NNN:"_X",YNN:"_F",NYN:"_P",YYN:"_FP",NNY:"_T",YNY:"_FT",NYY:"_PT",YYY:"_FPT"},f=a.lockforce?"N":"Y",g=a.lockposition?"N":"Y",h=b.movingpenguins>0?"Y":"N",i=f+g+h,j=e[i],k="pg"+b.penguins+"_sd"+b.sand+"_mp"+b.movingpenguins+"_ih"+b.holes;if("predict"===a.goal.type){var l="";return b.targetplace&&(l+="tgt"+b.targetplace+"_"),b.starguess&&(l+="st"+b.starguess+"_"),"pred_"+l+k+j}return b.bonus&&(k+="_bn"+b.bonus),"chal_"+k+j},C.getlockedforce=function(){return _.launcher?_.launcher.lockforce:!0},C.getlockedposition=function(){return _.launcher?_.launcher.lockposition:!0},C.draggabletarget=function(){this.target&&(this.target.vis.interactive=!0,this.target.vis.off(app.taptype,this.dragtarget),this.target.vis.on(app.taptype,this.dragtarget))},C.dragtarget=function(a){o>0||(this.noplay(),this.container.off(app.dragtype,this.movetarget),this.container.off(app.releasetype,this.droptarget),this.container.on(app.dragtype,this.movetarget),this.container.on(app.releasetype,this.droptarget))},C.movetarget=function(a){var b=(a.data.global.x-this.container.position.x)/this.container.scale.x,c=(a.data.global.y-this.container.position.y)/this.container.scale.y;this.target.setvisualposition(b,c,0)},C.converttappos=function(a){return this.localpos({x:a.data.global.x,y:a.data.global.y})},C.localpos=function(a){var b=(a.x-this.container.position.x)/this.container.scale.x,c=(a.y-this.container.position.y)/this.container.scale.y;return{x:b,y:c}},C.globalpos=function(a){var b=(a.x+this.container.position.x)*this.container.scale.x,c=(a.y+this.container.position.y)*this.container.scale.y;return{x:b,y:c}},C.rinkpos=function(a){var b=this.adjustpos([a.x,a.y],!0,!0);return{x:b[0],y:b[1]}},C.droptarget=function(a){this.noplay(!1),this.target.matchbodypositiontovisual(),this.container.off(app.dragtype,this.movetarget),this.container.off(app.releasetype,this.droptarget)},C.dragitem=function(a){this.noplay();var b=this.converttappos(a),c={x:a.target.position.x-b.x,y:a.target.position.y-b.y};this.dragoffset=c,this.dragging=a.target.wo,"penguin"===this.dragging.id&&!this.dragging.rotation,this.dragging.config.dragimage&&this.dragging.changeimage(this.dragging.config.dragimage),"movingpenguin"===this.dragging.id;var d=this.dragging.getvisualposition();this.dragging.snapback={x:d.x,y:d.y},this.container.off(app.dragtype,this.moveitem),this.container.off(app.releasetype,this.dropitem),this.container.on(app.dragtype,this.moveitem),this.container.on(app.releasetype,this.dropitem),this.parent.dragitem(a.target.wo,a)},C.moveitem=function(a){var b=this.converttappos(a);this.dragging.setvisualposition(b.x+this.dragoffset.x,b.y+this.dragoffset.y,this.dragging.rotation),g.update(),this.editmode&&this.aim(),this.checkinrink(b)?this.dragging.setalpha(1):this.dragging.setalpha(.5);var c;if(this.dragging.special&&this.dragging.special.path)c={x:this.dragging.special.path[1][0],y:this.dragging.special.path[1][1]},this.dragging.turntoface(c,!0),this.updatepenguinpaths();else if("penguinpathpoint"===this.dragging.id&&1===this.dragging.whatpoint.index){c={x:b.x+this.dragoffset.x,y:b.y+this.dragoffset.y};var d=this.dragging.whatpoint.obj;d.turntoface(c),this.updatepenguinpaths()}},C.updatepenguinpaths=function(){g.drawline(this.penguinpathlayer,!1);for(var b in a)if("penguinpathpoint"===a[b].id){var c=[a[b].vis.position.x,a[b].vis.position.y],d=[a[b].whatpoint.obj.vis.position.x,a[b].whatpoint.obj.vis.position.y];g.drawline(this.penguinpathlayer,!0,{x:c[0],y:c[1]},{x:d[0],y:d[1]},app.config.gameoptions.penguinpath.size,app.config.gameoptions.penguinpath.color,app.config.gameoptions.penguinpath.alpha)}},C.dropitem=function(b){this.container.off(app.dragtype,this.moveitem),this.container.off(app.releasetype,this.dropitem),this.noplay(!1);var c=this.converttappos(b),d=!1,e=!1;if(c.x+=this.dragoffset.x,c.y+=this.dragoffset.y,c.x=Math.round(c.x),c.y=Math.round(c.y),this.checkinrink(c)){var h,i;if(d=!0,"bush"===this.dragging.id){var j="",k=1e4,l=this.adjustpos([c.x,c.y],!0),m=l[0];k>m&&(j="left",k=m),m=H.w-l[0],k>m&&(j="right",k=m),m=H.h-l[1],k>m&&(j="bottom",k=m),m=l[1],k>m&&(j="top",k=m);var n=[];switch(j){case"left":n=[0,l[1]];break;case"right":n=[H.w,l[1]];break;case"bottom":n=[l[0],H.h];break;case"top":n=[l[0],0]}return n=this.adjustpos(n),this.dragging.vis.position={x:n[0],y:n[1]},void this.dragging.matchbodypositiontovisual()}if(this.dragging.setvisualposition(c.x,c.y),"movingpenguin"===this.dragging.id){if(this.dragging.pathstep=0,!this.dragging.special){this.dragging.special={path:null};var o=app.config.gameoptions.penguinmovelength,p=new q(G.x-c.x,G.y-c.y);p.normalize(),i=[c.x+o*p.x,c.y+o*p.y];var r=v.getangle(p);this.dragging.special.path=[1,i],h=this.placeitem("penguinpathpoint",i),h.activate(this.dragitem),h.type="editonly",h.whatpoint={obj:this.dragging,index:1},this.dragging.setrotation(r)}this.dragging.special.path[0]=[c.x,c.y],this.updatepenguinpaths()}else if("penguinpathpoint"==this.dragging.id){var s=this.dragging.whatpoint;s.obj.special.path[s.index]=[c.x,c.y]}}else if("target"==this.dragging.id||"plushie"==this.dragging.id)this.dragging.setvisualposition(this.dragging.snapback.x,this.dragging.snapback.y),this.dragging.setalpha(1),"plushie"==this.dragging.id&&this.aim();else if("penguinpathpoint"==this.dragging.id){var t=this.dragging.whatpoint.index;if(1===t){this.dragging.setvisualposition(this.dragging.snapback.x,this.dragging.snapback.y),this.dragging.whatpoint.obj.special.path[t]=[this.dragging.snapback.x,this.dragging.snapback.y],this.dragging.setalpha(1);var u={x:this.dragging.snapback.x,y:this.dragging.snapback.y},w=this.dragging.whatpoint.obj;w.turntoface(u)}else this.dragging.whatpoint.obj.special.path.splice(t,1),this.removeitem(this.dragging,!0),e=!0;this.updatepenguinpaths()}else{if("movingpenguin"===this.dragging.id){for(var x in a)"penguinpathpoint"===a[x].id&&a[x].whatpoint.obj===this.dragging&&this.removeitem(a[x],!0);this.updatepenguinpaths()}this.removeitem(this.dragging,!0),e=!0}g.update(),f.update(1),this.parent.dropitem(this.dragging,d,e,c,this.dragging.isnew),this.guideon&&this.showguide(),this.dragging.isnew=!1},C.checkinrink=function(a){return a.x>H.x&&a.x<H.x+H.w&&a.y>H.y&&a.y<H.y+H.h},C.placeitem=function(a,b,c){var d=app.config.items[a],e=this.addtoworld(a,d,b,c);return e},C.removeallid=function(b){for(var c in a)a[c].id===b&&this.removeitem(a[c]);this.refresh()},C.startpenguinpath=function(a){},C.endpenguinpath=function(){},C.addpenguinpathpoint=function(a){},C.setname=function(a){for(var b=1,c=a.id+"_"+b;D[c];)b++,c=a.id+"_"+b;return D[c]=a,a.setname(c),c},C.addtoworld=function(b,d,e,h,i){if(e||(e=d.pos),!d)return null;b||(b=d.id),h||(h=0);var j={position:e,rotation:h,type:d.physics.type};for(var k in d.physics.settings)j[k]=d.physics.settings[k];var l=new A({id:b,physicsmanager:f,physicsrenderer:g,settings:j,config:d});return a.push(l),c[b]||(c[b]=[]),c[b].push(l),f.addObjectToWorld(l),g.addObjectToDisplay(l,null,{x:e[0],y:e[1],rotation:e[2]}),i&&l.setworldvelocity(i[0],i[1],i[2]),this.setname(l),l},C.showlayout=function(){var a=f.savescaledworldstate(),b={gamelayout:a,goal:_.goal,launcher:this.getlauncherspec()};return this.configfromstate(b)},C.setplaymode=function(a){switch(a){case"replay":L="replay",this.stopsim();break;case"play":L="play",this.clearpaths(),this.alwaysupdate&&this.startsim()}},C.storeit=function(a,b){var c=JSON.stringify(b);localStorage.setItem(a,c)},C.fetchit=function(a){return JSON.parse(localStorage.getItem(a))},C.clearpaths=function(){g.cleardrawing(),k.visible=!1},C.drawpaths=function(a,b){if(lastdrawnframe>a&&(g.cleardrawing(),k.visible=!1,lastdrawnframe=0),this.dodrawpaths||this.dodrawdistance){var c,d,e,f,h=!1;for(var i in this.history[M].steps){var j=this.history[M].steps[i],l=Math.min(a+1,j.length-10),m=D[i],n=0,o=[j[0][0],j[0][1]];for(d=lastdrawnframe+1;l>d;d++){var p=j[d-1],r=j[d];"X"!=p&&(0!==p||0!==r)&&("fish"==m.id&&!h&&r&&(e=[r[0],r[1],p[0],p[1]],f=[r[0],r[1]]),m==this.plushie&&(r?(o=[r[0],r[1]],c=new q(r[0]-p[0],r[1]-p[1]),n+=c.length(),h=!0,e=p?[r[0],r[1],p[0],p[1]]:[r[0],r[1],f[0],f[1]]):o=[p[0],p[1]],1===d&&g.drawcircle({x:p[0],y:p[1]},m.radius()/2,m.pathcolor,!1)),this.dodrawpaths&&(r[3]&&this.editmode&&g.drawcircle({x:r[0],y:r[1]},m.radius(),m.pathcolor,!0),g.drawpath({x:p[0],y:p[1]},{x:r[0],y:r[1]},4,m.pathcolor,.75)))}m==this.plushie&&this.dodrawdistance&&g.drawpath({x:o[0],y:o[1]},{x:this.target.vis.position.x,y:this.target.vis.position.y},1,"#333333")}var s=h?"":"fish";this.editmode?(k.anchor.x=.5,w.setimage(k,images["pathendpoint"+s])):(k.anchor.x=0,w.setimage(k,images["patharrow"+s])),k.visible=!0,k.position={x:e[0],y:e[1]};var t=new q(e[0]-e[2],e[1]-e[3]),u=v.getangle(t);k.rotation=u,lastdrawnframe=a}},C.sense=function(a){if(a.n1&&a.n2){var b;b=this.getrelevantbody(a.n1,a.n2,"bonus"),b&&"plushie"==b[1].id&&this.getstar(b[0]),b=this.getrelevantbody(a.n1,a.n2,"starguess"),b&&"plushie"==b[1].id&&(b[0].id="starmissed"),b=this.getrelevantbody(a.n1,a.n2,"sand"),b&&(b[1].insand=!0,"plushie"==b[1].id&&(this.shotstatus.plushie.hitsand=!0)),b=this.getrelevantbody(a.n1,a.n2,"icehole"),b&&(b[1].nearhole=b[0]),b=this.getrelevantbody(a.n1,a.n2,"target"),b&&"plushie"==b[1].id&&(this.shotstatus.plushie.target=!0,this.plushie.intarget=!0)}},C.stopsense=function(a){if(a.n1&&a.n2){var b;b=this.getrelevantbody(a.n1,a.n2,"icehole"),b&&(b[1].nearhole=null),b=this.getrelevantbody(a.n1,a.n2,"sand"),b&&(b[1].insand=!1),b=this.getrelevantbody(a.n1,a.n2,"target"),b&&"plushie"==b[1].id&&(this.plushie.intarget=!1)}},C.collision=function(a){if(a.n1&&a.n2){this.savecollision(a.n1),this.savecollision(a.n2);var b;if(b=this.getrelevantbody(a.n1,a.n2,"plushie"),b&&(this.gamesound("bump"),this.shotstatus.plushie.moved=!0,this.shotstatus.plushie.obstacles.push({id:b[1].id,pos:this.rinkposobj(b[1]),pos2:this.rinkposobj(b[0])}),"penguin"===b[1].id)){var c=b[1].getrotation(),d=b[1].turntoface(b[0].getscaledworldposition()),e=1;c>d&&(e=-1),b[1].spin(d-c,e)}b=this.getrelevantbody(a.n1,a.n2,"fish"),b&&(this.gamesound("littlebump"),this.shotstatus.fish.obstacles.push(b[1]))}},C.getrelevantbody=function(a,b,c){return a.id==c?[a,b]:b.id==c?[b,a]:!1},C.removeitem=function(b,d){if(f.destroyObject(b),b.status="dead",b.show(!1),d){g.removeObject(b);for(var e in a)if(a[e]==b){a.splice(e,1);break}for(e in c[b.id])if(c[b.id][e]==b){c[b.id].splice(e,1);break}}},C.removealldeadobjects=function(){var b,d=a.length-1;for(b=d;b>=0;b--)"dead"===a[b].status&&(g.removeObject(a[b]),a.splice(b,1));for(var e in c){var h=c[e];for(d=h.length-1,b=d;b>=0;b--)"dead"==h[b].status&&h.splice(b,1)}f.removedestroyed()},C.setforcelevel=function(a){this.forcelevel=a,this.guideon&&this.showguide()},C.aim=function(a){return T&&!a&&0===d.last.distance(d.position)?!1:(d.aim.x=i.vis.position.x-d.position.x,d.aim.y=i.vis.position.y-d.position.y,d.angle=v.getangle(d.aim),d.rotation=d.angle,d.angle>Math.PI/2&&d.angle<3*Math.PI/2?this.parent.panel.items.launchfish.scale.y=-1:this.parent.panel.items.launchfish.scale.y=1,!0)},C.aimpenguins=function(b){for(var c in a)if("penguin"==a[c].id||"movingpenguin"==a[c].id){var d=a[c];b.getvisualposition();d.turntoface(b)}},C.repeatshot=function(){this.stopsim();var a=this.history[M].initial;this.startfromstate(a),this.events.trigger("setforce",this.forcelevel),this.aim(!0)},C.stepphysics=function(){N++,this.physupdate(P)},C.endspeculation=function(){this.shotstatus={force:0,fish:{obstacles:[],icehole:!1},plushie:{target:!1,obstacles:[],icehole:!1,moved:!1}}},C.settestshot=function(a){a||(a=this.forcelevel),M=0,N=0,this.history[M]={steps:{},initial:{}},T=!1;var b=n+(l-n)*a/10;this.getclosewalls(),this.aim(!0),d.aim.normalize(),d.aim.scaleBy(5);var c=this.placeitem(this.tooltype,[d.position.x+d.aim.x,d.position.y+d.aim.y],d.angle);c.recordposition(),this.savepositionstohistory(),f.applyImpulse(c,v.vecam(d.angle,b))},C.guideshot=function(b){if(this.editmode){this.cleareditthings();for(var c in a)"movingpenguin"===a[c].id&&this.removeitem(a[c])}else b=!0;var d=this.completegamestate();this.settestshot(),f.events.off("collide",this.collision),f.events.on("collide",this.collision),f.events.off("sense",this.sense),f.events.off("stopsense",this.stopsense),f.events.on("sense",this.sense),f.events.on("stopsense",this.stopsense),this.gountilstasis();var e=1;lastdrawnframe=0;for(var g in this.history[M].steps){var h=this.history[M].steps[g].length;h>e&&(e=h)}b&&(e=parseInt(.3*e)),f.events.off("collide",this.collision),f.events.off("sense",this.sense),f.events.off("stopsense",this.stopsense),this.drawpaths(e-1),this.startfromstate(d),this.refresh(),this.endspeculation(),this.editmode&&(this.editmode=!1,this.startedit()),this.stopsim(),this.aim(!0)},C.gountilstasis=function(){this.stepphysics(),T||this.gountilstasis()},C.lastshot=function(){var a=this.history[M].initial;this.startfromstate(a),physforce=l},C.gountiltarget=function(){this.stepphysics();var a,b=this.intarget();return T||b?(a=!1,b&&(a=!0)):a=this.gountiltarget(),a},C.predictshot=function(){this.stopsim();var a=this.completegamestate(),b=this.history[M].initial;this.startfromstate(b),this.settestshot(10);var c=this.gountiltarget();return T=!0,this.startfromstate(a),this.stopsim(),this.aim(!0),c},C.intarget=function(){var a=this.plushie.getscaledworldposition(),b=this.target.getscaledworldposition(),c=Math.distSq(a.x,a.y,b.x,b.y),d=0;return c<this.closest&&(this.closest=c),c<h.l&&(d=1,c<h.m&&(d=2,c<h.s&&(d=3))),d},C.getstar=function(a){a.changeimage("starglow"),this.gamesound("correct"),this.starsgot||(this.starsgot=0),this.starsgot++,a.id="stargot"},C.clearguide=function(){g.cleardrawing(),k.visible=!1,this.alwaysupdate&&!this.editmode?this.startsim():this.editmode},C.showguide=function(){g.cleardrawing(),this.guideshot()},C.refresh=function(a){a||(a=1),f.update(a),g.update(a)},C.showpaths=function(){for(var b in a){var c=a[b];if(c.lastpos&&c.speedsq()>.005){Math.sqrt(c.speedsq())}}},C.shootit=function(a){if(this.notplaying||U)return!1;if(0>=a)return this.noforcealert(),!1;if(I&&!this.usertarget)return this.nopredictalert(),!1;if(this.forcelevel=a,Y=W,S=!0,_.shotlimit-o<=0)return!1;this.startsim(),collisionsounds=!0,this.aim(),g.cleardrawing(),this.beginnewshot(),this.getclosewalls(),this.closest=Math.distSq(this.plushie.vis.position.x,this.plushie.vis.position.y,this.target.vis.position.x,this.target.vis.position.y),this.shotstatus.force=this.forcelevel,this.shotstatus.launcherpos=[d.position.x,d.position.y],d.aim.normalize(),d.aim.scaleBy(5),e=this.placeitem(this.tooltype,[d.position.x+d.aim.x,d.position.y+d.aim.y],d.angle),d.angle>Math.PI/2&&d.angle<3*Math.PI/2?e.vis.scale.y=-1:e.vis.scale.y=1;var b=n+(l-n)*this.forcelevel/10;return e.recordposition(),f.applyImpulse(e,v.vecam(d.angle,b)),this.events.on("stasis",this.checkvictory),!0},C.reload=function(){_.shotlimit>o&&(this.parent.reload(),U=!1)},C.outofshots=function(){this.parent.outofshots()},C.draglauncher=function(a){if(!this.notplaying){var b=this.localpos(a),c={x:d.position.x-b.x,y:d.position.y-b.y};this.dragoffset=c,d.mayshoot=!0,(!d.lockposition||this.editmode)&&this.container.on(app.dragtype,this.movelauncher),this.container.on(app.releasetype,this.droplauncher),this.parent.panel.on(app.releasetype,this.droplauncher)}},C.movelauncher=function(a){var b=this.converttappos(a),c=b.x+this.dragoffset.x,e=b.y+this.dragoffset.y;return d.mayshoot=!1,(d.position.x-c)*(d.position.x-c)+(d.position.y-e)*(d.position.y-e)>p?void this.droplauncher():void this.putlauncher(c,e)},C.launchernearcorner=function(){return Math.abs(G.x-d.position.x)>.5*H.w-40&&Math.abs(G.y-d.position.y)>.5*H.h-40?!0:!1},C.placelauncher=function(a,b){var c=this.adjustpos([a,b]);d.position.x=c[0],d.position.y=c[1];var e=this.launcherwall(c[0],c[1]);d.onwall=e,this.aim()},C.launcherwall=function(a,b){var c,d=1e4,e=Math.abs(H.x-a);return d>e&&(c="left",d=e),e=Math.abs(H.x+H.w-a),d>e&&(c="right",d=e),e=Math.abs(H.y+H.h-b),d>e&&(c="bottom",d=e),e=Math.abs(H.y-b),d>e&&(c="top",d=e),c},C.putlauncher=function(a,b){a<H.x&&(a=H.x),a>H.x+H.w&&(a=H.x+H.w),b<H.y&&(b=H.y),b>H.y+H.h&&(b=H.y+H.h);var c=this.launcherwall(a,b);switch(d.onwall||(d.onwall=c),c!=d.onwall&&(this.launchernearcorner()?d.onwall=c:c=d.onwall),c){case"left":a=H.x,E="v";break;case"top":b=H.y,E="h";break;case"right":a=H.x+H.w,E="v";break;case"bottom":b=H.y+H.h,E="h"}if(F&&!this.editmode){var e,f=app.config.items.bush.frame.w,g=app.config.items.bush.frame.h,h=!1,i=d.position.x,j=d.position.y;if("v"==E){var k,l;for(e in F[c])k=F[c][e]+H.y-g/2,l=k+g,k>=j?b>k&&(b=k):j>=l&&l>b&&(b=l)}else if("h"==E){var m,n;for(e in F[c])m=F[c][e]+H.x-f/2,n=m+f,m>=i?a>m&&(a=m,h=!0):i>=n&&n>a&&(a=n)}}d.position.x=a,d.position.y=b,this.aim()&&this.guideon&&this.showguide()},C.getclosewalls=function(){K=[];var a=10;d.position.x<=H.x+a?K.push("leftwall"):d.position.x>=H.x+H.w-a&&K.push("rightwall"),d.position.y<=H.y+a?K.push("topwall"):d.position.y>=H.y+H.h-a&&K.push("bottomwall")},C.droplauncher=function(a){this.container.off(app.dragtype,this.movelauncher),this.container.off(app.releasetype,this.droplauncher),this.parent.panel.off(app.releasetype,this.droplauncher),this.container.off(app.outtype,this.droplauncher),d.last.x=d.position.x,d.last.y=d.position.y,this.parent.droppedlauncher(a)},C.getdistbetweenobjects=function(a,b){var c=a.vis.position.x-b.vis.position.x,d=a.vis.position.y-b.vis.position.y;
return c*c+d*d},C.startsim=function(){O=0,Q=0,app.off("update",this.update),app.on("update",this.update),f.events.off("collide",this.collision),f.events.on("collide",this.collision),f.events.off("sense",this.sense),f.events.on("sense",this.sense),f.events.off("stopsense",this.stopsense),f.events.on("stopsense",this.stopsense)},C.beginnewshot=function(){M++,N=0,this.distancefromtarget=1e6,this.history[M]={steps:{},initial:{}},this.clearguide(),this.savepositionstohistory(),T=!1,noshot=!1,U=!0,V=!0,o++,this.events.trigger("shot"),o>=_.shotlimit&&this.outofshots(),app.setTimeout(this.reload,1e3)},C.getlauncherspec=function(){var a={position:{x:d.position.x,y:d.position.y},force:this.forcelevel,rotation:d.rotation,lockforce:d.lockforce,lockposition:d.lockposition};return a},C.getlauncher=function(){return d},C.savepositionstohistory=function(){this.history[M].initial=this.completegamestate();for(var b=a.length-1,c=b;c>=0;c--){var d=a[c];if("dead"!=d.status){var e=d.getnewpos();this.history[M].steps[d.name]||(this.history[M].steps[d.name]=[]),this.history[M].steps[d.name][N]=[e.x,e.y,e.r],$[d.name]=N}else a.splice(c,1)}},C.completegamestate=function(){var a=f.savescaledworldstate(),b=[];for(var c in a)"movingpenguin"===a[c].obj.id&&null!==a[c].obj.pathstep&&(a[c].obj.savepathstep=a[c].obj.pathstep),"wall"!==a[c].obj.type&&b.push(a[c]);var d={gamelayout:b,launcher:this.getlauncherspec()};return d.goal=_.goal,d.force=this.forcelevel,d.shots=_.shotlimit-o,d},C.addnewtohistory=function(a){this.history[M].steps[a]=[];for(var b=0;N>b;b++)this.history[M].steps[a][b]="X"},C.savecollision=function(a){T||(Z[a.name]=!0)},C.addcollision=function(a,b){if(!(0>b||a.notrace)){var c=this.history[M].steps[a.name];m=c[b],m&&m.length?m[3]=!0:(m=c[$[a.name]],c[b]=[m[0],m[1],m[2],Z[a.name]],b>$[a.name]&&($[a.name]=b)),Z[a.name]=!1}},C.saveposition=function(a){if(T)return 0;var b=a.getlastmove();return this.history[M].steps[a.name]||this.addnewtohistory(a.name),"dead"!=a.status||Z[a.name]?0!==b?(this.history[M].steps[a.name][N]=[b[0],b[1],b[2]],Z[a.name]&&this.addcollision(a,N),$[a.name]=N,1):Z[a.name]?(this.addcollision(a,N),0):(this.history[M].steps[a.name][N]=$[a.name],0):(this.history[M].steps[a.name][N]="X",0)},C.update=function(a){if(O+=a,Q+=a,O>X){Q>Y&&(N++,this.physupdate(P),Q=0),g.update(O),O=0,this.aim()&&this.guideon&&this.showguide();this.checkvictory();this.plushie.speed>.03?this.plushie.insand&&this.plushie.speed>.08?app.soundtrack.playAmbient("sandslide"):app.soundtrack.playAmbient("iceslide"):app.soundtrack.playAmbient(),T&&app.soundtrack.playAmbient(),S&&this.showpaths()}},C.physupdate=function(b){f.update(b);var d,e=!0;for(var h in a){var i=a[h];if(i.recordposition(),"dead"!==i.status&&"wall"!==i.type){var j=this.saveposition(i);if(0!==j&&!i.wandering&&(e=!1,"inkball"==i.id)){var k=g.oneshot(app.config.items.inktrail);g.addObjectToDisplay(k,i),g.setpos(k.vis,i.vis.position)}if(i.nearhole&&(d=this.getdistbetweenobjects(i,i.nearhole),d<holedistance&&("plushie"==i.id?this.shotstatus.plushie.icehole=!0:"fish"==i.id&&(this.shotstatus.fish.icehole=!0),this.fallinhole(i))),"penguin"==i.id&&i.spinning&&i.spin(),("fish"==i.id||"plushie"==i.id)&&(J=i.getworldvelocity(),s=J.x*J.x+J.y*J.y,i.speed=s,0!==s)){var l,m=new q(-1*J.x,-1*J.y);i.insand?(m.truncate(this.sanddrag),l=[m.x,m.y],f.applyForce(i,l)):s<5&&(m.truncate(this.icedrag),l=[m.x,m.y],f.applyForce(i,l))}if("movingpenguin"==i.id){if(i.splashing)break;i.nearhole=null;for(var n in c.icehole){var o=c.icehole[n];d=this.getdistbetweenobjects(i,o),1e3>d&&(i.nearhole=c.icehole[n])}i.chase?i.followitem():i.wander()}}}e&&(T||(this.events.trigger("stasis"),this.stopsim(),T=!0))},C.stopsim=function(){collisionsounds=!1,app.off("update",this.update),f.events.off("collide",this.collision),f.events.off("sense",this.sense),f.events.off("stopsense",this.stopsense)},C.noplay=function(a){a===!1?this.notplaying=!1:this.notplaying=!0},C.checkpredict=function(){return I?this.usertarget?!0:!1:!0},C.checkvictory=function(){if(!this.notplaying&&!noshot){var a=!1,b=Math.distSq(this.plushie.vis.position.x,this.plushie.vis.position.y,this.target.vis.position.x,this.target.vis.position.y);if(b<this.closest){this.closest=b;this.plushie.getworldvelocity()}if(T&&!(this.plushie.speedsq()>R)){if(a&&(this.didwin(2),b=0),"predict"===_.goal.type&&"stars"===_.goal.config)return"winstars"===this.judgestatus()?(this.didwin(),0):(this.didlose(),0);if(b<h.l||this.plushie.intarget){var c=0;b<h.l&&(c=1,b<h.m&&(c=2,b<h.s&&(c=3))),a=!0,this.didwin(c),b=0}return!a&&_.shotlimit-o<=0&&this.didlose(),b}}},C.fallinhole=function(a){if(!a.splashing){this.gamesound("splash");var b=a.nearhole.getworldposition();a.splashing=!0;var c=this.panel.additem(app.config.items.splash,this.container);this.container.setChildIndex(c,this.container.getChildIndex(a.nearhole.vis)+1),this.container.setChildIndex(a.vis,this.container.getChildIndex(c)),a.setworldposition(b.x,b.y,a.getrotation()),a.setworldvelocity(0,0),c.position={x:a.nearhole.vis.position.x-61,y:a.nearhole.vis.position.y-47},c.doonce();var d=this;c.events.on("done",function(b){d.panel.removeitem(b),d.removeitem(a),a.splashing=!1,"plushie"===a.id&&(d.stasis=!0)})}},C.didwin=function(a,b){this.stopsim(),this.noplay(),this.panel.showitem("buttonnext");var c="";switch(a){case 3:c="bullseye",this.targetvictory.showring(1);break;case 2:c="innerring",this.targetvictory.showring(2);break;case 1:c="outerring",this.targetvictory.showring(3);break;case 0:this.targetvictory.showring(4),c="edge"}this.showretry("win");var d=this.winfeedback();d.push(c);var e=d[parseInt(Math.random()*d.length)];this.events.trigger("feedback",{type:"success",goal:_.goal,status:e})},C.winfeedback=function(){var b=_.launcher.lockposition,c=_.launcher.lockforce,d=[];b&&!c&&d.push("rightforce");var e,f,g;for(var h in this.shotstatus.plushie.obstacles)"movingpenguin"===this.shotstatus.plushie.obstacles[h].id?g=!0:"penguin"===this.shotstatus.plushie.obstacles[h].id?f=!0:this.shotstatus.plushie.obstacles[h].id.indexOf("wall")>-1&&(e=!0);if(!g&&!f){var i=!1;for(var j in a)("penguins"===a[j].id||"movingpenguins"===a[j].id)&&(i=!0);i&&d.push("missedpenguins")}return g&&d.push("movingpenguinbank"),f&&d.push("penguinbank"),e&&d.push("bankshot"),d},C.didlose=function(){this.stopsim(),this.distancefromtarget=Math.distSq(this.plushie.vis.position.x,this.plushie.vis.position.y,this.target.vis.position.x,this.target.vis.position.y);var a=this.judgestatus();this.events.trigger("feedback",{type:"fail",goal:_.goal,status:a});this.noplay(),this.showretry()},C.showretry=function(a){this.parent.showretry(a)},C.judgestatus=function(){var b,c,d=_.launcher.lockposition,e=_.launcher.lockforce;if("predict"===_.goal.type){if("stars"===_.goal.config){this.shotstatus.stars={userguess:[],correct:[],incorrect:[]};for(var f in a){var g=a[f];if("star"===g.type){var h=g.getscaledworldposition();switch(h=this.adjustpos([h.x,h.y],!0,!0),this.shotstatus.stars[g.id]?this.shotstatus.stars[g.id]++:this.shotstatus.stars[g.id]=1,"bonus"===g.id&&(g.changeimage("starnope"),this.shotstatus.stars.incorrect.push(h),this.shotstatus.stars.userguess.push(h)),g.id){case"stargot":this.shotstatus.stars.correct.push(h),this.shotstatus.stars.userguess.push(h);break;case"starguess":this.shotstatus.stars.incorrect.push(h);break;case"starmissed":this.shotstatus.stars.correct.push(h),g.changeimage("starnogo")}}}if(!this.shotstatus.stars.stargot)return this.shotstatus.stars.bonus?"starsnone":"starsnochoice";return this.shotstatus.stars.bonus?this.shotstatus.stars.starmissed||this.shotstatus.stars.starguess?"starssome":"starschoseall":this.shotstatus.stars.starmissed?1==this.shotstatus.stars.starguess?"starsmorethanone":1==this.shotstatus.stars.starmissed?"starsone":"starsshort":"winstars"}for(b in this.shotstatus.fish.obstacles)if(c=this.shotstatus.fish.obstacles[b].id,"movingpenguin"==c)return"timingfish";for(b in this.shotstatus.plushie.obstacles)if(c=this.shotstatus.plushie.obstacles[b].id,"movingpenguin"==c)return"timing";return"fail_predict"}if(this.shotstatus.plushie.moved){if(!e&&this.shotstatus.plushie.target)return"forcetoohigh";if(!d&&this.shotstatus.plushie.icehole)return"posicehole";for(b in this.shotstatus.plushie.obstacles){if(c=this.shotstatus.plushie.obstacles[b].id,"movingpenguin"==c)return"timing";if("penguin"==c)return e||10==this.shotstatus.force||!this.predictshot()?"pospenguin":"forcelowpenguin"}return d||10!=this.shotstatus.force&&this.predictshot()?e?"again":"forcelow":"fail_position"}if(this.shotstatus.fish.obstacles.length<1&&!e)return"forceverylow";if(this.shotstatus.fish.icehole&&!d)return"posicehole2";for(b in this.shotstatus.fish.obstacles){if(c=this.shotstatus.fish.obstacles[b].id,"movingpenguin"==c)return"timingfish";if("penguin"==c)return e||10==this.shotstatus.force||!this.predictshot()?"pospenguinfish":"forcelowpenguin"}return e?"fail_position":"forcelow"},C.putdown=function(a,b){if(this.editmode&&a){var c=this.localpos(b),d=this.placeitem(a,[c.x,c.y]);d.activate(this.dragitem),f.update(1),g.update(1),this.showlayout(),this.dragging=d,this.dragoffset={x:0,y:0};var e=d.getvisualposition();return("penguin"===this.dragging.id||"movingpenguin"==this.dragging.id)&&this.dragging.setrotation(120*v.DEG2RAD,!0),this.dragging.config.dragimage&&this.dragging.changeimage(this.dragging.config.dragimage),this.dragging.isnew=!0,this.dragging.snapback={x:e.x,y:e.y},this.container.off(app.dragtype,this.moveitem),this.container.off(app.releasetype,this.dropitem),this.container.on(app.dragtype,this.moveitem),this.container.on(app.releasetype,this.dropitem),d}},C.toggleedit=function(){this.editmode?this.stopedit():this.startedit()},C.startedit=function(){this.editmode=!0,this.stopsim();for(var b in a){var c=a[b];if(!c.nomove)switch(c.activate(this.dragitem),c.config.dragimage&&c.changeimage(c.config.dragimage),c.id){case"targetplace":c.deactivate(this.placetarget);break;case"starguess":c.deactivate(this.togglestar);break;case"movingpenguin":this.connectmovingpenguin(c)}}this.notplaying=!1,this.updatepenguinpaths(),this.penguinpathlayer.visible=!0,g.update()},C.hintclosed=function(){this.noplay(!1)},C.stopedit=function(){this.editmode=!1,this.cleareditthings()},C.connectmovingpenguin=function(a){a.stopchasing(!0),a.pathstep=0,a.setvisualposition(a.special.path[0][0],a.special.path[0][1]);var b=new q(a.special.path[1][0],a.special.path[1][1]);a.turntoface(b);for(var c=1;c<a.special.path.length;c++){var d=[a.special.path[c][0],a.special.path[c][1]],e=this.placeitem("penguinpathpoint",d);e.activate(this.dragitem),e.type="editonly",e.whatpoint={obj:a,index:c}}},C.cleareditthings=function(){for(var b in a){var c=a[b];c.nomove||(c.vis.interactive=!1,c.vis.off(app.taptype,this.dragitem),"editonly"==c.type&&this.removeitem(c))}this.removealldeadobjects(),g.drawline(this.penguinpathlayer,!1),this.penguinpathlayer.visible=!1},C.showeditthings=function(){},C.savecreatedlevel=function(){var a=this.showlayout();a.hint="User Level",this.parent.saveuserlevel(a)},C.noforcealert=function(){},C.gamesound=function(a,b){(collisionsounds||b)&&app.soundtrack.playSFX(a)},C.nopredictalert=function(){this.parent.predictalert()},C.teardown=function(){this.clearguide(),this.clearlevel(),this.editmode=!1,this.stopsim()},namespace("WGBH").IceRink=B}(),function(){var a,b=include("PIXI.Container"),c=include("PIXI.Sprite"),d=include("PIXI.Graphics"),e=include("PIXI.Point"),f=include("createjs.Timeline"),g="springroll.AnimatorInstance",h=include("springroll.EventDispatcher"),i=function(a){this.init(a)},j=extend(i,g);i.makeMovieClipFromZoeSpritesheet=function(a,d,f){for(var g=a.animations[d].frames,i=g.length,j=[],k=[],l=[],m=0;i>m;m++){var n=a.frames[g[m]],o=n[4]?n[4]:0,p=a.images[o];images[p]||(images[p]=PIXI.Texture.fromImage(imageurls[p]));var q=images[p],r=(images[p],q.clone());r.frame=new PIXI.Rectangle(n[0],n[1],n[2],n[3]),k.push(new PIXI.Rectangle(n[0],n[1],n[2],n[3])),l.push(new e(-1*n[5],-1*n[6])),j.push(r)}var s=PIXI.Texture.fromImage(imageurls[a.images[0]]),t=new b;return t.sprite=new c(s),t.addChild(t.sprite),t.sprite.texture=s.clone(),t.frames=k,t.offsets=l,t.ind=0,t.threshold=60,t.tcount=0,t.stopped=!0,t.startloop=function(){this.loop=!0,this.once=!1,this.play()},t.setframerate=function(a){this.threshold=parseInt(1e3/a)},t.doonce=function(){this.once=!0,this.play()},t.update=function(a){if(!this.stopped&&a&&(this.tcount=a+this.tcount,!(this.tcount<this.threshold))){if(this.tcount=0,this.ind=this.ind+1,this.ind>=this.frames.length)if(this.loop)this.ind=0;else{if(this.once)return this.stop(),this.events.trigger("done",this),void app.off("update",this.update);app.off("update",this.update),this.done=!0}this.doframe(this.ind)}},t.doframe=function(a){this.ind=a,this.sprite.texture.frame=this.frames[a],this.sprite.position.x=this.offsets[a].x,this.sprite.position.y=this.offsets[a].y},t.play=function(a){app.off("update",this.update),app.on("update",this.update),this.events=new h,this.events.clip=this,this.stopped=!1},t.stop=function(){app.off("update",this.update),this.stopped=!0},t.gotoAndStop=function(a){app.off("update",this.update),this.doframe(a)},t.gotoAndPlay=function(a){this.ind=a-1,this.play()},f&&t.setframerate(f),t.doframe(0),t.update=t.update.bind(t),t},j.init=function(c){this.visual=new b,a=app.config.ruffwheel.spritesheet;var e=[],g={onTransitionOut:1,onTransitionOut_stop:30,onTransitionIn:50,onTransitionIn_stop:79},h={loop:!0};this.timeline=new f(e,g,h);var j=new d;j.beginFill(UIPanel.colorfromhex("#ffffff"),1),j.drawRect(-171,0,1366,768),j.endFill(),this.visual.addChild(j),this.allruff=new b,this.bar=i.makeMovieClipFromZoeSpritesheet(a,"bar"),this.bar.position={x:285,y:200},this.bar.sprite.anchor={x:.5,y:.5},this.allruff.position={x:300,y:200},this.allruff.addChild(this.bar);var k=this;app.on("update",function(){k.bar.rotation=k.bar.rotation+.1}),this.wheel=i.makeMovieClipFromZoeSpritesheet(a,"wheel"),this.allruff.addChild(this.wheel),this.wheel.setframerate(24),this.wheel.startloop(),this.ruff=i.makeMovieClipFromZoeSpritesheet(a,"ruff"),this.ruff.position={x:30,y:40},this.ruff.setframerate(8),this.ruff.startloop(),this.allruff.addChild(this.ruff),this.visual.addChild(this.allruff)},j.pplay=function(){},j.pgotoAndPlay=function(a){},j.pupdate=function(){},j.penter=function(){this.visual.visible=!0},j.pmiddle=function(){},j.pexit=function(){this.visual.visible=!1},j.padvance=function(){},j.pdone=function(){},namespace("WGBH.pixi").RuffWheel=i}(),function(){var a=include("WGBH.UIPanel"),b=include("PIXI.Sprite"),c=function(){a.call(this),this.items={}},d=extend(c,a);d.setup=function(){this.background1=new b.fromImage(imageurls.bg_zoo),this.background1.interactive=!0,this.background1.on(app.click,this.clickbackground),this.background2=new b.fromImage(imageurls.bg_snow),this.background2.interactive=!0,this.background2.on(app.click,this.clickbackground),this.background3=new b.fromImage(imageurls.bg_blueprint),this.background3.interactive=!0,this.background3.on(app.click,this.clickbackground),this.addChild(this.background1),this.addChild(this.background2),this.addChild(this.background3),this.background2.visible=!1,this.interactive=!0},d.indexpane=function(a){this.hidegamestuff(),this.hideitem("createindex"),this.playbutton.scale.x=this.playbutton.scale.y=1,this.createbutton.scale.x=this.createbutton.scale.y=1,this.background1.visible=!0,this.background2.visible=!1,this.background3.visible=!1,this.items.index.visible=!0,a?this.createbutton.alpha=1:this.createbutton.alpha=.5},d.hideindex=function(){this.items.index.visible=!1},d.hidegamestuff=function(){this.showgamestuff(!1)},d.showgamestuff=function(){this.background2.visible=!0,this.background3.visible=!1,this.background1.visible=!1},d.editmode=function(a){a?(this.background2.visible=!1,this.background3.visible=!0,this.background1.visible=!1):(this.background2.visible=!0,this.background3.visible=!1,this.background1.visible=!1)},d.teardown=function(){this.uiteardown(),this.background1.off(app.click,this.clickbackground),this.background2.off(app.click,this.clickbackground),this.background3.off(app.click,this.clickbackground)},d.addvis=function(a){this.addChild(a)},d.removeitemmain=function(a){for(var b in this.children)if(a==this.children[b])return void this.children.splice(b,1)},d.showitem=function(a,b){var c=this.items[a];c&&(b===!1?(c.visible=!1,c.interactive&&(c.wasinteractive=!0,c.interactive=!1)):(c.visible=!0,c.wasinteractive&&(c.interactive=!0)))},d.hideitem=function(a){this.showitem(a,!1)},namespace("WGBH").GamePanel=c}(),function(){var a=include("WGBH.UIPanel"),b=include("PIXI.Sprite"),c=function(){a.call(this)},d=extend(c,a);d.setup=function(){this.background=new b(images.bg_zoo),this.background.interactive=!0,this.background.on(app.click,this.clickbackground),this.addChild(this.background),this.additem(app.config.index.createbutton),this.additem(app.config.index.playbutton)},d.teardown=function(){this.background.off(app.click,this.clickbackground)},namespace("WGBH").IndexPanel=c}(),function(){var a=include("WGBH.UIPanel"),b=include("PIXI.Sprite"),c=function(){a.call(this)},d=extend(c,a);d.setup=function(){this.background=new b(images.FPO_ruffintro),this.addChild(this.background),this.background.interactive=!0,this.background.on(app.click,this.clickbackground)},d.teardown=function(){this.background.off(app.click,this.clickbackground)},namespace("WGBH").IntroPanel=c}(),function(){var a=include("WGBH.UIPanel"),b=function(){a.call(this)},c=extend(b,a);c.setup=function(){this.bg=new PIXI.Sprite(images.bg_fishforce_title),this.addChild(this.bg),this.bg.interactive=!0,this.bg.on(app.click,this.clickbackground),this.play=new PIXI.Sprite(images.btn_start),this.addChild(this.play),this.play.position={x:750,y:590}},c.teardown=function(){this.bg.off(app.click,this.clickbackground),this.removeChildren()},namespace("WGBH").TitlePanel=b}(),function(){var a,b,c,d,e,f,g,h=include("WGBH.BaseState"),i=include("WGBH.GamePanel"),j=include("PIXI.Point"),k=include("PIXI.Container"),l=include("createjs.Tween"),m=include("createjs.Ease"),n=include("WGBH.pixi.RuffPointer"),o=function(a){h.call(this,new i,a)},p=0,q=new WGBH.SoundSynth,r=(Math.PI/180,function(a){var b=window.location.search.substring(1).split("&"),c=new RegExp(a);for(var d in b)if(c.test(b[d])){var e=b[d].split("=");if(e[0]===a)return e[1]}return!1}),s=document.getElementById("leveloutput"),t=extend(o,h);t.enterDone=function(){q.makenoise(),this.icerink.events.on("stasis",this.stopped),this.icerink.events.on("setforce",this.movethumbto),this.icerink.events.on("shot",this.shot),this.icerink.events.on("feedback",this.givefeedback),this.icerink.tooltype="fish",this.getuserlevels(),this.showindex()},t.buttonclick=function(){app.soundtrack.playSFX("clickey")},t.startsynth=function(){q.makenoise();var a=q.audioCtx.createBuffer(1,1,22050),b=q.audioCtx.createBufferSource();b.buffer=a,b.connect(q.audioCtx.destination),b.noteOn(0),document.removeEventListener("touchend",this.startsynth)},t.setupgame=function(){d=app.config.gameoptions.showadmin,r("admin")&&(d=1==r("admin")),e=app.config.gameoptions.levelbreak,document.addEventListener("touchend",this.startsynth),this.clickedruff=this.clickedruff.bind(this),this.rufflines=app.config.ruffmovements,this.stopped=this.stopped.bind(this),this.movethumbto=this.movethumbto.bind(this),this.shot=this.shot.bind(this),this.givefeedback=this.givefeedback.bind(this),this.nextruff=this.nextruff.bind(this),this.shootit=this.shootit.bind(this),this.chooseskip=this.chooseskip.bind(this),this.choosenext=this.choosenext.bind(this),this.chooseretry=this.chooseretry.bind(this),this.chooseprev=this.chooseprev.bind(this),this.updateeditui=this.updateeditui.bind(this),this.clickice=this.clickice.bind(this),this.clickbg=this.clickbg.bind(this),this.clickhome=this.clickhome.bind(this),this.draglauncher=this.draglauncher.bind(this),this.dragthumb=this.dragthumb.bind(this),this.dropthumb=this.dropthumb.bind(this),this.movethumb=this.movethumb.bind(this),this.addthing=this.addthing.bind(this),this.toggleguide=this.toggleguide.bind(this),this.toplaymode=this.toplaymode.bind(this),this.backtoeditmode=this.backtoeditmode.bind(this),this.chooseplay=this.chooseplay.bind(this),this.choosecreate=this.choosecreate.bind(this),this.clearcreate=this.clearcreate.bind(this),this.choosecreatedlevel=this.choosecreatedlevel.bind(this),this.createnewlevel=this.createnewlevel.bind(this),this.togglelevelconfig=this.togglelevelconfig.bind(this),this.switchcreatetype=this.switchcreatetype.bind(this),this.movelauncher=this.movelauncher.bind(this),this.matchlauncher=this.matchlauncher.bind(this),this.showstar=this.showstar.bind(this),this.showtarget=this.showtarget.bind(this),this.switchmouth=this.switchmouth.bind(this),this.moveslider=this.moveslider.bind(this),this.readthumb=this.readthumb.bind(this),this.adjusttouched=this.adjusttouched.bind(this),this.togglepositionlock=this.togglepositionlock.bind(this),this.toggleforcelock=this.toggleforcelock.bind(this),this.showanswer=this.showanswer.bind(this),this.endinterlude=this.endinterlude.bind(this),this.backhome=this.backhome.bind(this),this.toggleadmin=this.toggleadmin.bind(this),this.icerink=new WGBH.IceRink,this.ruffcorner=new n({itempath:this}),this.saying={audio:null,type:null},this.roundid="",app.roundid=this.roundid,this.currentround=null,this.roundhistory=[],this.roundnumber=0,this.userstatus={heardintro:{}},this.enableon={},this.gamestuff=["icerink","icebg","iceshine","retrypanel","launcher","controls","levelnav","hint","editpanel"];for(var b in app.config.layouts.gameui)var g=this.panel.additem(app.config.layouts.gameui[b]);var h={b_playbutton:[this.chooseplay],b_createbutton:[this.choosecreate],b_buttonshowme:[this.showanswer],b_choosecreatedlevel:[this.choosecreatedlevel],b_createnewlevel:[this.createnewlevel],b_buttonnext:[this.chooseskip],b_buttonprev:[this.chooseprev],b_buttonretry:[this.chooseretry],b_retrybutton:[this.chooseretry],b_nextlevelbutton:[this.choosenext],b_launcher:[this.draglauncher],b_buttonguide:[this.toggleguide],b_clearcreate:[this.clearcreate],b_switchtoplay:[this.toplaymode],b_switchtoedit:[this.backtoeditmode],b_thumb:[this.dragthumb],b_launchbutton:[this.shootit],b_icebg:[this.clickice],b_addbonus:[this.addthing],b_addpenguin:[this.addthing],b_addhole:[this.addthing],b_addsand:[this.addthing],b_addmovingpenguin:[this.addthing],b_addtargetplace:[this.addthing],b_addstarguess:[this.addthing],b_addbush:[this.addthing],b_homebutton:[this.clickhome],b_showconfig:[this.togglelevelconfig],b_switchcreatetype:[this.switchcreatetype],b_lockforce:[this.toggleforcelock],b_lockposition:[this.togglepositionlock],b_showeditguide:[this.toggleguide],b_adminswitch:[this.toggleadmin]};for(var i in h)this.panel.buttons.off(i,h[i][0]),this.panel.buttons.on(i,h[i][0]),h[i][1]&&(this.panel.buttons.off(i+"_o",h[i][1]),this.panel.buttons.on(i+"_o",h[i][1]));this.panel.buttons.on("background",this.clickbg);var j=this;if(this.zamboni=this.panel.items.zamboni,this.zamboni.scaledhalfwidth=this.zamboni.initconfig.frame.w/2,this.zamboni.scaledhalfheight=this.zamboni.initconfig.frame.h/2,this.zamboni.position.x=0-this.zamboni.scaledhalfwidth,c=this.panel.items.thumb,c.range=c.max-c.min,a=this.panel.items.launcher,launchcircle=this.panel.items.launchcircle,launchcircle.gradient.range=[launchcircle.gradient.end[0]-launchcircle.gradient.start[0],launchcircle.gradient.end[1]-launchcircle.gradient.start[1],launchcircle.gradient.end[2]-launchcircle.gradient.start[2]],launchcircle.setcolor=function(a){this.hexcolor=WGBH.UIPanel.rgb2hex(a[0],a[1],a[2]);var b=this.hexcolor;this.cacheAsBitmap=!1,this.clear(),WGBH.UIPanel.makeGraphicsFromShapes({forms:this.initconfig.forms,image:null,fill:{color:b},line:this.initconfig.line},this)},f=app.config.gameoptions.shotlimit,this.rink=new k,this.panel.icerink=this.rink,this.panel.addChild(this.rink),this.background=this.panel.background,this.feedback={},this.panel.setChildIndex(this.panel.items.playitems,this.panel.children.length-1),this.panel.setChildIndex(this.panel.items.scrim,this.panel.children.length-1),this.panel.setChildIndex(this.panel.items.retryscale,this.panel.children.length-1),this.panel.items.retrypanel.xin=this.panel.items.retrypanel.position.x,this.panel.items.retrypanel.xout=this.panel.items.retrypanel.xin+130,this.icerink.setup(this.panel,this.rink,this),this.panel.addChild(this.ruffcorner),this.panel.ruffcorner=this.ruffcorner,this.ruffcorner.on(app.taptype,function(a){j.clickedruff(a)}),this.thumb=c,this.ruffcorner.events.on("movelauncher",this.movelauncher),this.ruffcorner.events.on("moveslider",this.moveslider),this.ruffcorner.events.on("showstar",this.showstar),this.ruffcorner.events.on("showtarget",this.showtarget),this.ruffcorner.events.on("pointedat",this.adjusttouched),this.ruffcorner.events.on("changemouth",this.switchmouth),d){this.panel.showitem("admin"),this.panel.showitem("levelnav"),this.panel.showitem("adminswitch");for(var l in this.panel.admin.initconfig.resets){var m=this.panel.admin.initconfig.resets[l];this.panel[l]&&(m.hidden?this.panel[l].visible=!1:m.frame&&(this.panel[l].position.x=m.frame.x))}this.showlevelinfo()}else this.panel.hideitem("admin"),this.panel.hideitem("levelnav"),this.panel.hideitem("adminswitch"),this.hidelevelinfo()},t.adjusttouched=function(a){a.id&&("playbutton"===a.id||"createbutton"===a.id)&&this.panel.bringtotop(a,a.parent)},t.movelauncher=function(){var a=this.icerink.getlauncher();this.showlauncherpos={x:a.position.x,y:a.position.y},newy=this.showlauncherpos.y-100,oldy=this.showlauncherpos.y;var b=750,c=m.quadInOut;this.ruffcorner.follow(a,"E"),l.get(this.showlauncherpos).to({y:newy},b,c).to({y:oldy},b,c),app.off("update",this.matchlauncher);var d=this;app.setTimeout(function(){app.off("update",d.matchlauncher)},2*b),app.on("update",this.matchlauncher)},t.matchlauncher=function(){this.icerink.putlauncher(this.showlauncherpos.x,this.showlauncherpos.y)},t.moveslider=function(){var a=this.thumb.position.x,b=this.thumb.position.x+200;b>this.thumb.max&&(b=this.thumb.position.x-200);var c=750,d=m.quadInOut;this.ruffcorner.follow(this.thumb,"NE"),l.get(this.thumb.position).to({x:b},c,d).to({x:a},c,d),l.get(this.panel.items.thumbtext.position).to({x:b},c,d).to({x:a},c,d),this.showthumb=!0,app.off("update",this.readthumb),app.on("update",this.readthumb);var e=this;app.setTimeout(function(){e.showthumb=!1,app.off("update",e.readthumb)},2*c)},t.switchmouth=function(a){this.ruffcorner.switchmouth(a)},t.showstar=function(a){if(!this.stars[0].userchanged&&!this.stars[1].userchanged)switch(parseInt(a)){case 1:this.icerink.selectstar(this.stars[0],!0),this.stars[0].userchanged=!1;break;case 2:this.icerink.selectstar(this.stars[0],!1),this.stars[0].userchanged=!1;break;case 3:this.icerink.selectstar(this.stars[1],!0),this.stars[1].userchanged=!1;break;case 4:this.icerink.selectstar(this.stars[1],!1),this.stars[1].userchanged=!1}},t.showtarget=function(){},t.clickhome=function(){app.soundtrack.bequiet(),this.showretry("hide"),this.lastruffmessage=[],this.guideoff(),"create"==g&&null!==this.currentround&&(this.currentlevelchanged&&this.icerink.savecreatedlevel(),this.trackendcreate()),this.icerink.editmode&&this.icerink.stopedit(),this.icerink.teardown(),this.showindex(),this.trackclickhome(g),app.soundtrack.playSFX("hop5")},t.showindex=function(a){if(this.roundid=app.roundid="",this.createisunlocked=app.usersavestate.cancreate,this.panel.indexpane(this.createisunlocked),this.hideconfig(),this.panel.hideitem("createindex"),this.hidegamestuff(),this.panel.hideitem("homebutton"),this.background=this.panel.background1,a){var b=this.rufflines.intros.afterwin.concat(this.rufflines.intros.gameindex);this.ruffsayline(b,"intro")}else this.createisunlocked?this.ruffsayline(this.rufflines.intros.gameindex,"intro"):this.ruffsayline(this.rufflines.intros.indexplay,"intro")},t.hidegamestuff=function(){app.off("update",this.readthumb),app.off("update",this.matchlauncher),this.showgamestuff(!1)},t.showgamestuff=function(a){this.panel.showitem("homebutton");var b=a!==!1;for(var c in this.gamestuff)this[this.gamestuff[c]]?(this[this.gamestuff[c]].visible=b,this.panel.hideitem(this.gamestuff[c])):this.panel[this.gamestuff[c]]&&(this.panel.showitem(this.gamestuff[c]),this.panel[this.gamestuff[c]].visible=b);b?(this.panel.showgamestuff(),this.icerink.show()):(this.dismissruff(),this.icerink.hide()),d||(this.panel.hideitem("levelnav"),this.hidelevelinfo())},t.toggleadmin=function(){d=!d,d?(this.panel.showitem("levelnav"),this.showlevelinfo(this.panel.items.levelinfo.text)):(this.panel.hideitem("levelnav"),this.hidelevelinfo())},t.chooseplay=function(){if(g="play",this.buttonclick(),this.dismissruff(),this.ruffcorner.backtocorner(0),this.trackstartplaymode(),this.iscreating=!1,this.icerink.editmode=!1,this.panel.hideindex(),this.showgamestuff(),this.panel.hideitem("switchtoedit"),currentlevel=-1,this.roundhistory=[],r("rounds")){var a=r("rounds");this.roundnumber=a;for(var b=1;a>b;b++)this.roundhistory.push(app.config.levels.mylist[Math.random(app.config.levels.mylist.length)]);currentlevel=Math.max(-1,a-2)}r("lv")||r("kid")?this.urllevel():this.newround()},t.choosecreate=function(){this.createisunlocked&&(g="create",this.buttonclick(),this.dismissruff(),this.currentround=null,this.roundid=app.roundid="",this.trackstartcreatemode(),this.panel.hideindex(),this.panel.showitem("homebutton"),this.iscreating=!0,this.panel.hideitem("levelnav"),this.hidelevelinfo(),this.showcreateindex())},t.clearcreate=function(){this.buttonclick(),this.setcreate(!1,!0),this.icerink.startedit()},t.thumbnailbuttonfromconfig=function(a){var c=this.panel.additem(app.config.layouts.elements.choosecreatedlevel,"none"),d=this.icerink.worldsetupfromlevel(a,b),e=this.icerink.thumbnailfromstate(d);return e.scale={x:.3,y:.3},e.position=new j(28,102),c.addChild(e),c},t.showcreateindex=function(){this.panel.hideitem("levelnav"),this.hidelevelinfo(),this.panel.showitem("createindex");var a=3;app.off("update",this.readthumb),app.off("update",this.matchlauncher);var b,c=this.usercreatedlevels.length,d=340,e=210;(r("lv")||r("kid"))&&(this.panel.items.thumbnailurl&&this.panel.createindex.removeChild(this.panel.items.thumbnailurl),b=r("kid")?this.thumbnailbuttonfromconfig(this.lookupkidlevel(r("kid"))):this.thumbnailbuttonfromconfig(this.parselevelurl()),b.levelnumber=0,b.position=new j(-1*d,e),this.panel.createindex.addChild(b),b.cacheAsBitmap=!0,this.panel.items.thumbnailurl=b);for(var f=0;c>f;f++)this.usercreatedlevels[f]&&(this.panel.items["thumbnail"+f]&&this.panel.createindex.removeChild(this.panel.items["thumbnail"+f]),b=this.thumbnailbuttonfromconfig(this.usercreatedlevels[f]),b.levelnumber=1+f,b.position=new j(f*d,e),this.panel.createindex.addChild(b),this.panel.items["thumbnail"+f]=b);if(a>f){var g=this.panel.additem(app.config.layouts.elements.createnewlevel,this.panel.createindex);g.position=new j(f*d,e),g.levelnumber=1+f}var h=this.rufflines.intros.createintro.none;c===a?h=this.rufflines.intros.createintro.all:c>0&&(h=this.rufflines.intros.createintro.some),this.ruffsayline(h,"intro")},t.ruffsayline=function(a,b,c,d){this.ruffstuff=[],this.ruffstuff=this.ruffstuff.concat(a),"alert"!=b&&(this.lastruffmessage=[],d?this.lastruffmessage=this.lastruffmessage.concat(d):this.lastruffmessage=this.lastruffmessage.concat(this.ruffstuff)),c?this.ruffstuff=[]:(this.ruffcorner.backtocorner(),this.nextruff()),"intro"==b&&(this.lastintro=a.slice())},t.createnewlevel=function(a){this.panel.hideitem("createindex"),this.createdpick=a.target.levelnumber-1,this.showcreatemode(),this.trackstartcreate(!0),this.userstatus.heardintro.createintro?this.ruffsayline(this.rufflines.intros.chosecreatedshort):(this.ruffsayline(this.rufflines.intros.chosecreated),this.userstatus.heardintro.createintro=!0)},t.choosecreatedlevel=function(a){this.buttonclick(),this.createdpick=0;var b=a.target.levelnumber;this.createdpick=b-1,this.panel.hideitem("createindex"),this.showcreatemode(),this.trackstartcreate(!1),
this.ruffsayline(this.rufflines.intros.choseedited)},t.showcreatemode=function(){this.showgamestuff(),this.setcreate(),this.backtoeditmode()},t.givefeedback=function(a){this.ruffstuff=[],this.lastruffmessage=[];var b,c,d,e;if("fail"===a.type){if("predict"!==a.goal.type&&this.icerink.distancefromtarget<app.config.gameoptions.closetotarget){var f=parseInt(Math.random()*this.rufflines.feedback.generic.fail_close.length);f=this.rufflines.feedback.generic.fail_close[f],this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[f])}var g=parseInt(Math.random()*this.rufflines.feedback.generic.fail_tryagain.length);if(g=this.rufflines.feedback.generic.fail_tryagain[g],this.rufflines.feedback[a.status])if(this.rufflines.feedback[a.status].d){if(c="d",this.feedback[a.status])switch(this.feedback[a.status]){case"d":c="i";break;case"i":c="p";break;case"p":c="d"}this.rufflines.feedback[a.status][c]&&(this.feedback[a.status]=c,this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[a.status][c]))}else this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[a.status]);else this.rufflines.feedback.generic[a.status]&&(this.feedback.generic||(this.feedback.generic={}),d=this.feedback.generic[a.status]?this.feedback.generic[a.status]:0,c=(d+1)%this.rufflines.feedback.generic[a.status].length,b=this.rufflines.feedback.generic[a.status][c],this.feedback.generic[a.status]=c,this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[b]));this.userstatus.heardretry||this.iscreating||(this.ruffstuff=this.ruffstuff.concat(this.rufflines.intros.showretry),this.userstatus.heardretry=!0);var h="forcetoohigh"===a.status||"forcelowpenguin"===a.status;if(this.iscreating){var i=h?.8:.5;if(Math.random()>i){var j=parseInt(Math.random()*this.rufflines.feedback.generic.fail_creation.length);g=this.rufflines.feedback.generic.fail_creation[j],this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[g])}}}else this.userstatus.didplay=!0,"predict"===a.goal.type?"stars"===a.goal.config?(this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback.success_sfx_predictstars),this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback.success_stars)):(this.feedback.generic||(this.feedback.generic={}),this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback.success_sfx_predicttarget),d=this.feedback.generic.success_predict?this.feedback.generic.success_predict:0,c=(d+1)%this.rufflines.feedback.generic.success_predict.length,b=this.rufflines.feedback.generic.success_predict[c],this.feedback.generic.success_predict=c,this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[b])):(this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback.success_sfx),this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback["success_"+a.status])),e=parseInt(Math.random()*this.rufflines.feedback.generic.success_next.length),b=this.rufflines.feedback.generic.success_next[e],this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback[b]),this.userstatus.heardnext||this.iscreating?this.iscreating&&Math.random()<.3&&(this.ruffstuff=this.ruffstuff.concat(this.rufflines.feedback.createsuccess1)):(this.ruffstuff=this.ruffstuff.concat(this.rufflines.intros.shownext),this.userstatus.heardnext=!0);this.lastruffmessage=this.lastruffmessage.concat(this.ruffstuff),this.nextruff()},t.draglauncher=function(a){if("play"==this.playmode){this.icerink.getlockedposition()&&this.positionalert();var b={x:a.x,y:a.y};this.trackdraglauncher(b),this.icerink.editmode||this.guideoff(),this.enableon.launcher&&(this.enableshot(),this.enableon.launcher=null),this.icerink.draglauncher({x:a.x,y:a.y})}},t.droppedlauncher=function(a){var b={x:a.data.global.x,y:a.data.global.y};this.trackadjustedlauncher(b)},t.chooseskip=function(){this.tries=-1,this.trackbeatround(),this.justwon=!0,this.winhistory(this.roundid),this.choosenext()},t.choosenext=function(){this.buttonclick(),currentlevel+1>=app.config.gameoptions.levelpack?this.interlude(!0):this.roundnumber<this.roundhistory.length-1?(this.roundnumber++,this.replayround(this.roundnumber)):(this.roundnumber+1)%e===0?this.interlude():this.newround()},t.winhistory=function(a){if(!this.iscreating&&a!=this.lastroundid){var b={};"intro"==this.getroundtype()?(app.usersavestate.introList[a]=!0,b.introLevelsCompleted=app.usersavestate.introList,a==app.config.gameoptions.unlockcreateon&&(app.usersavestate.cancreate=!0,this.createisunlocked=!0)):app.usersavestate.cancreate||(app.usersavestate.cancreate=!0,this.createisunlocked=!0),this.lastroundid=a,app.usersavestate.levelHistory.length>app.config.gameoptions.historylimit&&app.usersavestate.levelHistory.shift(),app.usersavestate.levelHistory.push(a),app.usersavestate.roundindex=this.roundnumber,b.levelCompleteHistory=app.usersavestate.levelHistory,app.alpPlugin.setState(b),app.saveuserdata()}},t.replayround=function(a){this.roundnumber=a;var b=this.roundhistory[a];this.tries=1,this.justwon=!1,this.setlevel(b),this.trackstartround()},t.newround=function(){this.trackalpsend({req:"getrec"}),this.roundid=app.alpPlugin.getRecommendation(),this.trackalpreceive({uri:this.roundid}),this.tries=1,this.justwon=!1,this.roundhistory.push(this.roundid),this.roundnumber=this.roundhistory.length-1,this.setlevel(this.roundid),currentlevel++,this.roundnumber+1>=app.config.gameoptions.unlockcreate&&(this.createisunlocked=!0),this.trackstartround()},t.interlude=function(a){this.showretry("hide"),this.hidegamestuff(),this.panel.hideitem("homebutton"),this.lastruffmessage=[],this.zamboni.visible=!0,this.panel.setChildIndex(this.zamboni,this.panel.children.length-1);var b,c=app.config.gameoptions.zambonispeed;if(this.zamboni.flipped?(app.soundtrack.playSFX("zamboni_back"),b=0-this.zamboni.scaledhalfwidth):(app.soundtrack.playSFX("zamboni_forth"),b=app.display.width+this.zamboni.scaledhalfwidth),a){var d=this.rufflines.interlude["long"].slice();this.ruffsayline(d),l.get(this.zamboni.position).to({x:b},c),this.afterruff=function(){this.backhome()}}else l.get(this.zamboni.position).to({x:b},c).call(this.endinterlude)},t.endinterlude=function(){this.showgamestuff(),this.zamboni.visible=!1,this.zamboni.flipped=!this.zamboni.flipped,this.zamboni.scale.x=-1*this.zamboni.scale.x,this.newround()},t.backhome=function(){this.zamboni.visible=!1,this.zamboni.flipped=!this.zamboni.flipped,this.zamboni.scale.x=-1*this.zamboni.scale.x,this.icerink.teardown(),this.showindex(!0)},t.chooseprev=function(){this.roundnumber>0&&this.roundnumber--,this.replayround(this.roundnumber)},t.chooseretry=function(){this.buttonclick(),this.iscreating?(this.setcreate(!0),this.icerink.noplay(!1),this.introforcreate()):(this.justwon&&(this.tries=1,this.trackstartround()),this.setlevel(this.roundid,!0))},t.showforce=function(){var a=p/10;this.panel.items.forcecover.scale.x=-1*(1-a),this.icerink.setforcelevel(p);var b=[255,255,255],d=.9+p/16;if(this.panel.items.outline.scale.x=this.panel.items.outline.scale.y=d,this.panel.items.launchscreen.scale.x=this.panel.items.launchscreen.scale.y=d,this.panel.items.launcherbg.scale.x=this.panel.items.launcherbg.scale.y=d,0!==p){for(var e in b)b[e]=launchcircle.gradient.start[e]+Math.round(launchcircle.gradient.range[e]*a);launchcircle.visible=!0,launchcircle.scale.x=launchcircle.scale.y=(.4+.7*a)*d}else launchcircle.visible=!1,b=[255,0,0];launchcircle.setcolor(b),this.icerink.launchcolor=launchcircle.hexcolor,this.panel.items.launchcannon.position.x=-20+-2*p,this.panel.items.thumbtext.text=Math.round(100*p/10),this.panel.items.thumbtext.position.x=c.position.x,0===p||this.cantshootyet?this.disableshot():this.icerink.checkpredict()?this.shotready||this.enableshot():(WGBH.UIPanel.setimage(this.panel.items.launchbutton_button,images.pushbutton_down_disabled),this.panel.items.launchbutton_text.position.y=this.panel.items.launchbutton_text.initconfig.down)},t.addthing=function(a){switch(a.id){case"addpenguin":this.icerink.itemtoadd="penguin";break;case"addbonus":this.icerink.itemtoadd="bonus";break;case"addhole":this.icerink.itemtoadd="icehole";break;case"addsand":this.icerink.itemtoadd="sand";break;case"addmovingpenguin":this.icerink.itemtoadd="movingpenguin";break;case"addtargetplace":this.icerink.itemtoadd="targetplace";break;case"addstarguess":this.icerink.itemtoadd="starguess";break;case"addbush":this.icerink.itemtoadd="bush"}var b=this.icerink.putdown(this.icerink.itemtoadd,{x:a.x,y:a.y});b=this.itemfromworldobject(b),this.trackdragitem(b,{x:a.x,y:a.y,stage_width:app.display.width,stage_height:app.display.height})},t.dragitem=function(a,b){var c={x:b.data.global.x,y:b.data.global.y,stage_width:app.display.width,stage_height:app.display.height},d=this.icerink.rinkpos(c);c.rinkx=d.x,c.rinky=d.y;var e=this.itemfromworldobject(a);this.trackdragitem(e,c)},t.dropitem=function(a,b,c,d,e){var f=this.icerink.rinkpos(d);d={x:d.x,y:d.y,rinkx:f.x,rinky:f.y};var g=this.itemfromworldobject(a);c?this.trackremoveitem(g,d):e?this.trackadditem(g,d):this.trackmoveitem(g,d),c&&e?this.currentlevelchanged=!1:this.currentlevelchanged=!0},t.itemfromworldobject=function(a){var b={id:a.id};return"movingpenguin"==a.id&&a.path?b.path=a.path:"penguinpathpoint"==a.id&&a.whatpoint&&(b.path=a.whatpoint.obj.special.path),b},t.levelintro=function(a){if(this.rufflines.intros[a.id])return this.rufflines.intros[a.id];var b,c,d=[],e=!0;if("predict"===a.goal.type)return b="stars"===a.goal.config?this.rufflines.challenges.generics.predictstar:this.rufflines.challenges.generics.earlyprediction,c=this.rufflines.challenges[b[parseInt(Math.random()*b.length)]];var f=0;a.penguins&&(f+=a.penguins.length,e=!1),a.movingpenguins&&(f+=a.movingpenguins.length,d.push("movingpenguins"),e=!1),1===f?(d.push("singlepenguin"),a.lockposition||d.push("singlepenguinmovable")):f>1&&d.push("multipenguins"),a.holes&&(d.push("icehole"),e=!1),a.sand&&(d.push("sand"),e=!1),a.lockforce?a.lockposition||d.push("lockedforce"):d.push("force"),a.lockposition||(e&&d.push("clear"),d.push("position"));var g=d[parseInt(Math.random()*d.length)];return b=this.rufflines.challenges.generics[g],c=this.rufflines.challenges[b[parseInt(Math.random()*b.length)]]},t.nextruff=function(){if(this.saying.audio&&(this.tracksaying(this.saying.audio,this.saying.type,"audio",!0),this.saying.audio=null,this.saying.type=null),!this.ruffstuff||this.ruffstuff.length<1)return void(this.afterruff&&(this.afterruff(),this.afterruff=null));var a=this.ruffstuff.shift();a.audio&&(this.ruffcorner.saythings(a.audio,this.nextruff),this.tracksaying(a.audio,a.type,"audio"),this.saying.audio=a.audio,this.saying.type=a.type),a.moves&&this.ruffcorner.makemoves(a.moves),a.events&&this.ruffcorner.makeevents(a.events)},t.tracksaying=function(a,b,c,d){switch(b){case"intro":this.trackinstruction(a,c,d);break;case"fail":this.trackincorrectfeedback(a,c,d);break;case"success":this.trackcorrectfeedback(a,c,d)}},t.showcaption=function(a){this.panel.ruffsays(app.captions._data[a.text])},t.setcreate=function(a,b){var c;b||!this.usercreatedlevels[this.createdpick]?this.createdpick<0&&(r("lv")||r("kid"))?r("lv")?c=this.parselevelurl():r("kid")&&(c=this.lookupkidlevel(r("kid"))):(c=app.config.levels.levels.create,b||(this.currentlevelchanged=!1)):c=this.usercreatedlevels[this.createdpick],this.panel.showitem("homebutton"),this.currentround=this.icerink.setlevel(c,a),this.roundid=app.roundid="USER_"+this.currentround.id,this.setcreatetype(this.currentcreatetype()),this.levelready()},t.toggleforcelock=function(){var a=this.icerink.getlockedforce()?!0:!1;this.panel.items.lockforce.text=a?"F:Y":"F:N",this.icerink.setsliderlock(!a)},t.togglepositionlock=function(){var a=this.icerink.getlockedposition()?!0:!1;this.panel.items.lockposition.text=a?"P:Y":"P:N",this.icerink.setlauncherlock(!a)},t.togglelevelconfig=function(){var a=document.getElementById("output");if("none"==a.style.display){var b=this.icerink.showlayout();this.showconfig(b)}else this.hideconfig()},t.chosetarget=function(a,b){var c=this.currentround.solution,d=!1;c&&(d=a[0]==c[0]&&a[1]==c[1]),this.trackuserprediction(b,a,c,d)},t.showconfig=function(a){var b=document.getElementById("output");b.innerHTML="<div>"+JSON.stringify(a)+"</div>";var c=this.showlevelurl(a),d="LINK";b.innerHTML+='<br/><br /><a href="'+c+'" target="new" >'+d+"</a>",b.style.display="block"},t.hideconfig=function(){var a=document.getElementById("output");a.style.display="none"},t.showlevelinfo=function(a){s.style.display="block",s.innerHTML=a},t.hidelevelinfo=function(){s.style.display="none"},t.switchcreatetype=function(){var a={normal:"predict",predict:"stars",stars:"normal"};this.setcreatetype(a[this.currentcreatetype()])},t.currentcreatetype=function(){var a=this.icerink.getgamesettings().goal,b=a.type;return"stars"==a.config&&(b="stars"),b},t.setcreatetype=function(a){switch(this.icerink.setgametype(a),this.createtype=a,a){case"normal":this.icerink.target.show(),this.panel.hideitem("addtargetplace"),this.panel.hideitem("addstarguess"),this.panel.showitem("addbonus"),this.icerink.removeallid("targetplace"),this.icerink.removeallid("starguess");break;case"predict":this.icerink.target.hide(),this.panel.showitem("addtargetplace"),this.panel.hideitem("addstarguess"),this.panel.hideitem("addbonus"),this.icerink.removeallid("starguess");break;case"stars":this.icerink.target.hide(),this.panel.hideitem("addtargetplace"),this.panel.showitem("addstarguess"),this.panel.hideitem("addbonus"),this.icerink.removeallid("targetplace")}},t.lookupkidlevel=function(a){var b=app.config.levels.levels[a];return b||(b=app.config.levels.levels.notfound),b.kid=a,b},t.showlevelurl=function(a){var b=window.location.origin+window.location.pathname+"?lv="+encodeURI(JSON.stringify(a));return b},t.parselevelurl=function(a){a||(a=r("lv")),a=decodeURI(a);var b=JSON.parse(a);return b},t.saveuserlevel=function(a){this.usercreatedlevels[this.createdpick]=a,this.showuserlevel(a),app.usersavestate.createdLevels[parseInt(this.createdpick)]=a,app.saveuserdata(),this.showlevelurl(a)},t.showuserlevel=function(a){document.getElementById("output").innerHTML=JSON.stringify(a)},t.getuserlevels=function(){this.usercreatedlevels=[];var a=app.usersavestate.createdLevels.length;if(a)for(var b=0;a>b;b++){var c=app.usersavestate.createdLevels[b];this.usercreatedlevels[b]=c}},t.urllevel=function(){this.setlevel("url"),r("kid")&&(this.tries=1,this.trackstartround())},t.setlevel=function(a,b){var c;"url"===a?r("kid")?(this.roundid=r("kid"),c=this.lookupkidlevel(this.roundid)):(c=this.parselevelurl(),this.roundid="fromURL"):(this.roundid=a,c=this.lookupkidlevel(this.roundid)),this.panel.showitem("homebutton"),app.roundid=this.roundid,c=this.icerink.setlevel(c,b),this.panel.items.levelinfo.visible=!1,this.panel.items.levelinfo.text="("+(this.roundnumber+1)+") "+this.roundid,s.innerHTML=this.panel.items.levelinfo.text,this.currentround=c,c.id=this.roundid,this.levelready(),this.panel.showitem("editpanel",!1),this.showforce(),this.icerink.noplay(!1),this.lastruffmessage=[];var d,e=!1;b&&"predict"!==this.currentround.goal.type?(this.userstatus.heardhint||(this.userstatus.heardhint=!0,d=this.rufflines.help.notehint),this.showguidebutton()):this.hideguidebutton(),!d&&this.levelintro(c)&&(d=this.levelintro(c),this.userstatus.heardintro[c.id]=!0,b&&(e=!0)),d&&this.ruffsayline(d,"intro",e),this.currentround.solution?(this.panel.items.buttonshowme.visible=!0,b||(this.currentround.lockforce||"intro"===this.getroundtype()||this.movethumbto(1),this.currentround.lockposition||"intro"===this.getroundtype()||this.icerink.placelauncher(0,220))):this.panel.items.buttonshowme.visible=!1,this.enableshot(),this.currentround.mustforce&&(this.disableshot(),this.enableon.thumb=!0,this.cantshootyet=!0),this.currentround.mustlaunch&&(this.disableshot(),this.enableon.launcher=!0,this.cantshootyet=!0),this.stars=this.icerink.getstars(),this.targets=this.icerink.gettargets()},t.levelready=function(){var a=this.icerink.getlockedforce(),b=a?"force_slider_disabled":"force_slider",d=a?"force_gradient_disabled":"force_gradient";this.panel.showitem("sliderslot",!a),WGBH.UIPanel.setimage(this.panel.items.forcegradient,images[d]),WGBH.UIPanel.setimage(c,images[b]),WGBH.UIPanel.setimage(this.panel.items.buttonguide,images.path_button_off),this.showretry("hide"),this.setmode("play")},t.setforcreate=function(){this.setmode("play"),this.panel.hideitem("switchtoedit")},t.ready=function(){this.setupgame(),this.panel.indexpane(this.createisunlocked),this.hideconfig(),this.panel.hideitem("createindex"),this.hidegamestuff(),this.panel.hideitem("homebutton"),this.background=this.panel.background1},t.stopped=function(a){},t.showretry=function(a){if("hide"==a)return l.get(this.panel.items.retrypanel.position).to({x:this.panel.items.retrypanel.xout},200,m.quadOut),void this.panel.hideitem("scrim");if(this.panel.hideitem("homebutton"),this.panel.showitem("scrim"),this.iscreating){if(d&&"win"==a){var b;switch(this.createtype){case"predict":b=this.icerink.shotstatus.targetpicked;break;case"stars":b=this.icerink.shotstatus.stars.correct;break;case"normal":b=[this.icerink.shotstatus.launcherpos[0],this.icerink.shotstatus.launcherpos[1],this.icerink.shotstatus.force]}var c=this.icerink.showlayout();c.solution=b,this.showconfig(c)}this.panel.hideitem("nextlevelbutton"),this.panel.hideitem("nextdisabled"),this.panel.showitem("editbutton")}else"win"==a?(this.panel.showitem("nextlevelbutton"),this.panel.hideitem("nextdisabled"),this.panel.hideitem("editbutton"),this.trackendshot(!0),this.trackbeatround(),this.justwon=!0,this.winhistory(this.roundid)):(this.tries++,this.panel.hideitem("nextlevelbutton"),this.panel.showitem("nextdisabled"),this.panel.hideitem("editbutton"),this.trackendshot(!1));l.get(this.panel.items.retrypanel.position).to({x:this.panel.items.retrypanel.xin},350,m.getBackOut(2)),this.panel.showitem("retrypanel"),this.setmode("retry")},t.setmode=function(a){switch(a){case"play":this.playmode="play",this.panel.showitem("playitems"),this.icerink.setplaymode(this.playmode);break;case"retry":this.playmode="retry";break;case"shot":this.playmode="shot"}},t.shot=function(a){this.icerink.guideon=!1},t.shootit=function(){this.shotready&&this.icerink.shootit(p)&&(this.dismissruff(),this.ruffsayline(this.rufflines.intros.whileshooting,"intro",!0),q.stop(),app.soundtrack.playSFX("zip"),this.guideoff(),this.hideguidebutton(),this.panel.items.launchammo.visible=!1,l.get(this.panel.items.launchcircle.scale).to({x:0,y:0},200),l.get(this.panel.items.launchcannon.position).to({x:-20},50),this.trackshootit(this.icerink.configfromstate(this.icerink.history[0].initial)),this.setmode("shot"))},t.reload=function(){this.panel.items.launchammo.visible=!0,this.showforce()},t.outofshots=function(){this.disableshot()},t.disableshot=function(){this.shotready&&(this.shotready=!1,WGBH.UIPanel.setimage(this.panel.items.launchbutton_button,images.pushbutton_down_disabled),this.panel.items.launchbutton_text.position.y=this.panel.items.launchbutton_text.initconfig.down)},t.enableshot=function(){this.shotready=!0,this.cantshootyet=!1,WGBH.UIPanel.setimage(this.panel.items.launchbutton_button,images.pushbutton),this.panel.items.launchbutton_text.position.y=this.panel.items.launchbutton_text.initconfig.frame.y},t.dragthumb=function(a){if("play"==this.playmode&&!this.icerink.notplaying){if(this.icerink.getlockedforce())return void this.forcealert();this.iscreating||this.dismissruff(),this.guideoff();var b={x:a.x,y:a.y};this.trackdragslider(b),this.enableon.thumb&&(this.enableshot(),this.enableon.thumb=null);var d=a.target.getBounds(),e=d.x+d.width/2-a.x;c.offset=e/a.target.worldTransform.a,this.panel.on(app.dragtype,this.movethumb),this.panel.on(app.releasetype,this.dropthumb),q.setvolume(4)}},t.alertable=function(){return this.ruffstuff&&this.ruffstuff.length>0?!1:!0},t.predictalert=function(){this.alertable()&&("star predict"===this.getroundtype()?this.ruffsayline(this.rufflines.alert.predictionalertstars,"alert"):this.ruffsayline(this.rufflines.alert.predictionalert,"alert"))},t.forcealert=function(){if(this.alertable()){if(this.icerink.getlockedposition())return void this.lockallalert();var a=this.rufflines.alert.force[parseInt(Math.random()*this.rufflines.alert.force.length)];this.ruffsayline(this.rufflines.alert[a],"alert")}},t.positionalert=function(){if(this.alertable()){if(this.icerink.getlockedforce())return void this.lockallalert();var a=this.rufflines.alert.position[parseInt(Math.random()*this.rufflines.alert.position.length)];this.ruffsayline(this.rufflines.alert[a],"alert")}},t.lockallalert=function(){if(this.alertable()){var a=this.rufflines.alert.lockallalert.slice(),b=this.icerink.getgamesettings().goal;"predict"===b.type&&(a="stars"===b.config?a.concat(this.rufflines.alert.predictionalertstars):a.concat(this.rufflines.alert.predictionalert)),this.ruffsayline(a,"alert")}},t.movethumb=function(a){var b=(a.data.global.x-this.panel.items.controls.x)/this.icerink.container.scale.x;b+=c.offset,b>c.max?b=c.max:b<c.min&&(b=c.min),c.position.x=Math.round(b),this.readthumb(),q.setpitch(100+30*p,90+20*p)},t.readthumb=function(){p=10*(c.position.x-c.min)/(c.max-c.min),p=Math.round(10*p)/10,this.showforce()},t.movethumbto=function(a){p=a,c.position.x=Math.round(c.min+c.range*(p/10)),this.showforce()},t.dropthumb=function(a){this.panel.off(app.dragtype,this.movethumb),this.panel.off(app.releasetype,this.dropthumb),this.movethumbto(p);var b={x:a.data.global.x,y:a.data.global.y};this.trackadjustedlauncher(b),q.stop()},t.toplaymode=function(a){this.buttonclick(),this.dismissruff(),this.icerink.stopedit(),this.icerink.savecreatedlevel(),this.icerink.refresh(),this.setmode("play"),this.icerink.noplay(!1),this.hideconfig(),this.setcreate(!0),this.enableshot(),app.setTimeout(this.updateeditui,10),this.introforcreate()},t.introforcreate=function(){this.userstatus.heardintro.createplaylong?this.ruffsayline(this.rufflines.intros.createplay):(this.userstatus.didplay?this.ruffsayline(this.rufflines.intros.createplaymedium):this.ruffsayline(this.rufflines.intros.createplaylong),this.userstatus.heardintro.createplaylong=!0)},t.backtoeditmode=function(a){this.dismissruff(),this.ruffsayline(this.rufflines.intros.createagain,"intro",!0),this.buttonclick(),this.setcreate(!0),this.icerink.startedit(),app.setTimeout(this.updateeditui,10)},t.updateeditui=function(){this.panel.editmode(this.icerink.editmode),this.panel.showitem("editpanel",this.icerink.editmode),this.panel.showitem("controls",!this.icerink.editmode),this.panel.showitem("switchtoedit",!this.icerink.editmode)},t.clickedruff=function(a){this.lastruffmessage&&this.lastruffmessage.length>0&&this.ruffcorner.incorner&&!this.ruffcorner.talking?(this.ruffsayline(this.lastruffmessage),this.trackhint("ruff",{x:a.data.global.x,y:a.data.global.y})):(this.dismissruff(),this.afterruff&&(this.afterruff(),this.afterruff=null))},t.hideguidebutton=function(){this.panel.hideitem("buttonguide")},t.showguidebutton=function(){this.panel.showitem("buttonguide")},t.guideoff=function(){WGBH.UIPanel.setimage(this.panel.items.buttonguide,images.path_button_off),this.icerink.guideon=!1,this.icerink.reverseon=!1,this.icerink.clearguide()},t.guideon=function(){this.icerink.guideon=!0,this.icerink.reverseon=!1,this.icerink.showguide(),WGBH.UIPanel.setimage(this.panel.items.buttonguide,images.path_button_on)},t.toggleguide=function(a){if("play"==this.playmode){if(!this.panel.items.buttonguide)return void(this.icerink.guideon=!1);this.buttonclick(),this.icerink.guideon?this.guideoff():(this.trackhint("guide",{x:a.x,y:a.y}),this.guideon())}},t.showanswer=function(){if(this.currentround.solution)switch(this.getroundtype()){case"challenge":this.icerink.placelauncher(this.currentround.solution[0],this.currentround.solution[1]),this.movethumbto(this.currentround.solution[2]);break;case"star predict":var a;this.icerink.clearstars();for(a in this.currentround.solution){var b=this.icerink.getObjectAtPos(this.currentround.solution[a]);b&&this.icerink.selectstar(b,!0)}break;case"target predict":var c=this.icerink.getObjectAtPos(this.currentround.solution);c&&this.icerink.selecttarget(c)}},t.hsl2rgb=function(a,b,c){},t.rgb2hsl=function(a,b,c){var d,e,f,g,h,i;g=Math.max(a,b,c),h=Math.min(a,b,c);var j,k,l,m={r:0,g:120,b:240},n=[a,b,c],o=["r","g","b"];for(var p in n)n[p]==g?j=o[p]:n[p]==h?l=o[p]:(k=o[p],i=n[p]);return f=(g+h)/2,a==b&&b==c?(d=0,e=0):(d=(a*m[a]+b*m[b]+c*m[c])/(a+b+c),e=128>f?255*(g-h)/(g+h):255*(g-h)/(511-(g+h))),{h:d,s:e,l:f}},t.clickbg=function(a){app.trackstrayclick(a)},t.clickice=function(a){app.trackstrayclick({x:a.x,y:a.y})},t.pointruff=function(a,b){void 0===b&&(b="auto"),this.ruffcorner.pointat(a,500,b)},t.dismissruff=function(){this.saying.audio&&(this.tracksaying(this.saying.audio,this.saying.type,"audio",!0),this.saying.audio=null,this.saying.type=null),this.ruffcorner.switchmouth("happy"),this.ruffstuff=null,app.off("update",this.readthumb),app.off("update",this.matchlauncher),l.removeTweens(this.thumb.position),l.removeTweens(this.panel.items.thumbtext.position),this.showthumb&&(this.readthumb(),this.showthumb=null),this.showlauncherpos&&(l.removeTweens(this.showlauncherpos.y),this.showlauncherpos=null),this.ruffcorner.skipall()},t.exit=function(){this.ruffcorner.events.off("movelauncher",this.movelauncher),this.ruffcorner.events.off("moveslider",this.moveslider),this.ruffcorner.events.off("showstar",this.showstar),this.ruffcorner.events.off("showtarget",this.showtarget),this.ruffcorner.events.off("pointedat",this.adjusttouched),app.off("update",this.readthumb),app.off("update",this.matchlauncher),this.icerink.teardown(),this.stopscale()},t.getrinkstate=function(a){var b=this.icerink.showlayout();if(delete b.hint,b.id=this.roundid,b.solution=this.currentround.solution,a){b.plushiepath={};for(var c in this.icerink.shotstatus.plushie)b.plushiepath[c]=this.icerink.shotstatus.plushie[c];b.stars=this.icerink.shotstatus.stars}return b},t.getplushiehits=function(){var a=[];for(var b in this.icerink.shotstatus.plushie.obstacles){var c=this.icerink.shotstatus.plushie.obstacles[b];a.push({id:c.id,pos:c.pos,plushie:c.pos2})}return a},t.getroundtype=function(a){return a||(a=this.roundid),0===a.indexOf("intro_")?"intro":0===a.indexOf("chal_")?"challenge":0===a.indexOf("pred_")?a.indexOf("_tgt")>-1?"target predict":"star predict":"unknown"},t.trackstartplaymode=function(){app.learning.startTimer("play"),app.trackevent("startPlayMode",{idorder:["kid","coords"],kid:this.roundid,coords:{x:0,y:0}})},t.trackstartround=function(){app.learning.startTimer("round"),app.trackevent("startRound",{idorder:["round_type","initial_state","round_target","kid","resourcelist","wasrecommended"],kid:this.roundid,round_type:this.getroundtype(),round_target:0,initial_state:this.getrinkstate(),wasrecommended:!0,resourcelist:[]})},t.trackbeatround=function(){app.trackevent("endRound",{idorder:["duration","round_type","misses","kid"],kid:this.roundid,round_type:this.getroundtype(),duration:app.learning.stopTimer("round"),misses:this.tries-1})},t.trackshootit=function(a){app.learning.startTimer("shot"),app.trackevent("submitAnswer",{idorder:["coordinates","projectile","rink_state","correct","kid"],kid:this.roundid,projectile:"fish",coordinates:{},rink_state:a,correct:!1})},t.trackendshot=function(a){app.trackevent("endShot",{idorder:["correct","final_state","kid","duration","collisions"],kid:this.roundid,final_state:this.getrinkstate(!0),correct:a,duration:app.learning.stopTimer("shot"),collisions:this.getplushiehits()})},t.trackuserprediction=function(a,b,c,d){b=JSON.stringify(b),c=JSON.stringify(c),app.trackevent("selectAnswer",{idorder:["coordinates","correct","prediction","correct_prediction","kid"],coordinates:a,kid:this.roundid,correct_prediction:c,prediction:b,correct:d})},t.trackalpsend=function(a){app.trackevent("sentALP",{idorder:["data","kid"],kid:this.roundid,data:a})},t.trackalpreceive=function(a){app.trackevent("receivedALP",{idorder:["data","kid"],kid:this.roundid,data:a})},t.trackstartcreatemode=function(){app.learning.startTimer("create"),app.trackevent("startCreateMode",{idorder:["kid","coords"],kid:this.roundid,coords:{x:0,y:0}})},t.trackstartcreate=function(a){app.learning.startTimer("creating"),app.trackevent("startCreation",{idorder:["kid","new_creation"],kid:this.roundid,new_creation:a})},t.trackendcreate=function(){app.trackevent("endCreation",{idorder:["duration","created_level","kid"],kid:this.roundid,duration:app.learning.stopTimer("creating"),created_level:this.getrinkstate()})},t.trackclickhome=function(a){var b=0;app.learning.stopTimer("round"),a&&(b=app.learning.stopTimer(a)),app.trackevent("clickHome",{idorder:["kid","duration","mode"],kid:this.roundid,duration:b,mode:a})},t.trackdragslider=function(a){app.learning.startTimer("dragging")},t.trackdraglauncher=function(a){app.learning.startTimer("dragging"),app.trackevent("startDrag",{idorder:["coordinates","drag_type","kid"],kid:this.roundid,coordinates:a,drag_type:"drag"})},t.trackadjustedlauncher=function(a){var b=this.icerink.getlauncherspec();app.trackevent("adjustLauncher",{idorder:["coordinates","correct","launcher_position","launcher_force","kid","duration"],kid:this.roundid,duration:app.learning.stopTimer("dragging"),coordinates:a,correct:!1,launcher_position:this.icerink.rinkpos(b.position),launcher_force:Math.round(10*b.force)})},t.trackdragitem=function(a,b){app.learning.startTimer("dragging"),app.trackevent("dragItem",{idorder:["coordinates","object","drag_type","kid"],coordinates:b,object:a,drag_type:"drag",kid:this.roundid})},t.trackadditem=function(a,b){app.trackevent("addItem",{idorder:["coordinates","object","kid","duration","rink_state"],coordinates:b,object:a,rink_state:this.getrinkstate(),kid:this.roundid,duration:app.learning.stopTimer("dragging")})},t.trackmoveitem=function(a,b){app.trackevent("moveItem",{idorder:["coordinates","object","rink_state","kid","duration"],coordinates:b,object:a,rink_state:this.getrinkstate(),kid:this.roundid,duration:app.learning.stopTimer("dragging")})},t.trackremoveitem=function(a,b){app.trackevent("removeItem",{idorder:["coordinates","object","rink_state","kid","duration"],coordinates:b,object:a,rink_state:this.getrinkstate(),kid:this.roundid,duration:app.learning.stopTimer("dragging")})},t.trackhint=function(a,b){app.trackevent("clickHelp",{idorder:["coordinates","kid","help_type"],kid:this.roundid,coordinates:b,help_type:a})},t.getfeedbackinfo=function(a){var b=(app.captions.data[a],app.captions.getLength(a)),c=app.captions.getFullCaption(a);return{duration:b,description:c}},t.getfeedbacktrackobject=function(a,b){var c=this.getfeedbackinfo(a);return{media_type:b,duration:c.duration,description:c.description,id:a,kid:this.roundid,add:{kidaptive_uri:this.roundid},idorder:["description","id","media_type","duration","add"]}},t.trackcorrectfeedback=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endCorrectFeedback",d)):(app.learning.startTimer("talking"),app.trackevent("startCorrectFeedback",d))},t.trackincorrectfeedback=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endIncorrectFeedback",d)):(app.learning.startTimer("talking"),app.trackevent("startIncorrectFeedback",d))},t.trackinstruction=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endInstruction",d)):(app.learning.startTimer("talking"),app.trackevent("startInstruction",d))},namespace("WGBH").GameState=o}(),function(){var a=include("WGBH.BaseState"),b=include("WGBH.IndexPanel"),c=function(c){a.call(this,new b,c)},d=extend(c,a);d.enterDone=function(){this.goplay=this.goplay.bind(this)},d.clickbg=function(a){app.trackstrayclick(a.x,a.y)},d.setup=function(){this.background=this.panel.background,this.playbutton=this.panel.items.playbutton,this.panel.playbutton.on(app.taptype,this.goplay),this.panel.buttons.on("background",this.clickbg)},d.ready=function(){this.setup()},d.goplay=function(){this.nextState()},d.exit=function(){},namespace("WGBH").IndexState=c;
}(),function(){var a,b=include("WGBH.BaseState"),c=include("WGBH.IntroPanel"),d=function(a){b.call(this,new c,a)},e=extend(d,b);e.enterDone=function(){this.panel.background.interactive=!0,this.next=this.next.bind(this),this.panel.background.on(app.taptype,this.next),app.soundtrack.playVO("gameintro"),this.talking=!0,app.trackmoviestart("gameintro"),app.on("update",this.update)},e.ready=function(){var a=app.config.spritesheets.intromouth;this.mouth=UIPanel.makeMovieClipFromZoeSpritesheet(a,"mouth"),this.panel.addChild(this.mouth),this.mouth.scale={x:.9,y:.9},this.mouth.position={x:790,y:350},this.mouth.gotoAndStop(0),this.panel.mouth=this.mouth,this.update=this.update.bind(this),this.voplayer=app.voPlayer,this.syncarray=app.config.lipsync.gameintro,this.vopos=0,this.panel.buttons.on("background",this.clickbg)},e.clickbg=function(a){app.trackstrayclick(a.x,a.y)},e.update=function(b){this.talking&&this.syncarray&&(this.vopos=this.voplayer.getElapsed()/this.voplayer.currentDuration,this.setmouth(this.syncarray[parseInt(this.vopos*this.syncarray.length)])),this.voplayer.playing||(this.talking=!1,a||(a=!0,app.trackmovieend("gameintro"),this.nextState()))},e.setmouth=function(a){void 0!==a&&this.mouth.gotoAndStop(a)},e.next=function(b){this.talking&&(app.trackmovieskip("gameintro"),a=!0,this.voplayer.stop(),this.talking=!1),this.nextState()},e.exit=function(){app.off("update",this.update),this.panel.buttons.off("background",this.clickbg),this.panel.background.off(app.taptype,this.next)},namespace("WGBH").IntroState=d}(),function(){var a=include("WGBH.BaseState"),b=include("WGBH.TitlePanel"),c=function(c){a.call(this,new b,c)},d=extend(c,a);d.enterDone=function(){app.soundtrack.playVO("title"),this.next=this.next.bind(this),this.panel.play.interactive=!0,this.panel.play.buttonMode=!0,this.panel.play.defaultCursor="pointer",this.panel.play.on(app.taptype,this.next),this.panel.buttons.on("background",this.clickbg)},d.next=function(a){app.soundtrack.playSFX("clickey");var b={x:a.data.global.x,y:a.data.global.y};app.trackclickplay(b),this.panel.play.off(app.taptype,this.next),this.nextState()},d.clickbg=function(a){app.trackstrayclick(a.x,a.y)},d.exit=function(){this.panel.play.off(app.taptype,this.next),this.panel.removeChild(this.panel.bg),this.panel.removeChild(this.panel.play)},namespace("WGBH").TitleState=c}();var module={};!function(){var a=include("springroll.Application"),b=include("WGBH.TitleState"),c=include("WGBH.IntroState"),d=include("WGBH.IndexState"),e=include("WGBH.GameState"),f=include("springroll.pixi.PixiDisplay"),g=include("WGBH.PIXIText"),h=function(a,b){images[b.id]=new PIXI.Texture.fromImage(imageurls[b.id])},i=[{id:"RuffTransition_atlas_",src:"assets/images/RuffTransition_atlas_.png",complete:h}],j={dev:{apikey:"gLT3kMNM8BmTDrdVpWGD3N12VzAZPO6C",gameuri:"/game/pbskids/ruff_ple/fish_force",nooidc:!0,dev:!0,recLocalDimension:"/local_dimension/pbskids/ruff_ple/forces_and_motion_ff",promptPrefix:"/prompt/pbskids/ruff_ple/fish_force/"},prod:{apikey:"gdBII5L1JygIgwTnuHzQgVrwwnjIQDbmM",gameuri:"/game/pbskids/ruff_ple/fish_force",nooidc:!0,dev:!1,recLocalDimension:"/local_dimension/pbskids/ruff_ple/forces_and_motion_ff",promptPrefix:"/prompt/pbskids/ruff_ple/fish_force/"}},k=j.dev;JSON3.noConflict();var l=new a({name:"Penguin",canvasId:"stage",state:"title",display:f,configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",preload:i,displayOptions:{clearView:!0,forceContext:"canvas2d",transparent:!0},alp:{apiKey:k.apikey,gameUri:k.gameuri,options:{dev:k.dev,noOidc:k.nooidc},recLocalDimension:k.recLocalDimension,promptPrefix:k.promptPrefix,version:{version:"1.0.0",build:"0"},eventOverride:SpringrollAlpPluginPenguinHelper.eventOverride,recCallback:SpringrollAlpPluginPenguinHelper.recCallback,recParams:SpringrollAlpPluginPenguinHelper.recParams}});l.on("init",function(){$(".loading").hide(),this.animator.captions.mute=!0,this.gameid=this.config.gameoptions.gameid;var a=this.config.assets,f=this.config.scaling;this.usersavestate={introList:{},levelHistory:[],cancreate:!0,createdLevels:[]};var h={introLevelsCompleted:{},levelCompleteHistory:[]};if(SpringrollAlpPluginPenguinHelper.init.call(this),l.alpPlugin.setState(h),k.createlearner){var i=Date.now()+"@yopmail.com",j="badpassword";this.alpPlugin.sdk.createUser({email:i,password:j}),this.alpPlugin.sdk.createLearner({name:"L"}).then(function(){})}this.states={title:new b({next:"intro",preload:a.title.concat(a.universal),scaling:f.title}),intro:new c({next:"game",preload:a.intro.concat(a.universal),scaling:f.intro}),index:new d({next:"game",preload:a.index,scaling:f.index}),game:new e({preload:a.game.concat(a.universal),next:"intro",scaling:f.game})},this.taptype="mousedown",this.dragtype="mousemove",this.releasetype="mouseup",this.outtype="mouseout",this.pointer="mouse",this.hovertype="mouseover",this.hoverout="mouseout","ontouchstart"in document.documentElement&&(this.taptype="touchstart",this.dragtype="touchmove",this.outtype="touchleave",this.releasetype="touchend",this.pointer="touch",this.hovertype=null),this.click="click",this.captions.textField=document.getElementById("captions"),this.pixitrans=new WGBH.PixiClip(l.config.PixiWheel),this.pixitrans._clips.bar.update=function(){this.rotation+=.1047197551},this.pixitrans.center=l.config.scalingSize.width/2;var m=new PIXI.Graphics;m.beginFill(UIPanel.colorfromhex("#ffffff"),1),m.drawRect(0,0,l.config.scalingSize.maxWidth,l.config.scalingSize.maxHeight),m.position.x=l.config.scalingSize.maxWidth/-2,this.pixitrans.bg=new PIXI.Container,this.pixitrans.bg.position.x=this.pixitrans.center,this.pixitrans.addChildAt(this.pixitrans.bg,0),this.pixitrans.container.position.x=this.pixitrans.center,this.pixitrans.bg.addChild(m),this.pixitrans.loading=g.maketextobject(l.config.PixiWheel.text.text,l.config.PixiWheel.text.style),this.pixitrans.loading.position=new PIXI.Point(l.config.PixiWheel.text.p.x,l.config.PixiWheel.text.p.y),this.pixitrans.loading.visible=!1,this.pixitrans.bg.addChild(this.pixitrans.loading),this.transition=this.pixitrans,this.manager.on("onTransitionIn",function(){l.pixitrans.loading.visible=!1,createjs.Tween.get(l.transition.container.position).to({x:l.config.scalingSize.maxWidth+l.pixitrans.center,y:0},1e3)}),this.manager.on("onTransitionOut",function(){l.pixitrans.loading.visible=!0,l.transition.container.position={x:l.pixitrans.center-l.config.scalingSize.maxWidth,y:0},createjs.Tween.get(l.transition.container.position).to({x:l.pixitrans.center,y:0},1e3)}),this.loaduserdata(),l.container.on("openIdAuthSuccess",function(a){}),l.container.on("openIdAuthFailure",function(a){}),l.container.on("openIdRefreshAuthSuccess",function(a){"Kidaptive ALP"===a.data.name&&(l.alpPlugin.sdk.refresh(),l.loaduserdata())}),l.container.on("openIdRefreshAuthFailure",function(a){}),l.container.on("openIdRefreshAuthFinished",function(a){}),l.container.on("openIdProviderFailure",function(a){}),l.container.on("openIdRefreshProviderFailure",function(a){})}),l.roundid="",l.container.on("loadeduserdata",function(a){a.data&&(l.usersavestate=a.data,l.updatekidaptivestate())}),l.saveuserdata=function(){this.container.send("savestate",this.usersavestate),this.savejson("state",this.usersavestate)},l.loaduserdata=function(a){var b=this.loadjson("state");b?(this.usersavestate=b,l.updatekidaptivestate()):this.savejson("state",this.usersavestate),this.container.send("loadstate")},l.savejson=function(a,b){springroll.SavedData.write(l.config.gameoptions.gameid+a,JSON.stringify(b))},l.loadjson=function(a){return JSON.parse(springroll.SavedData.read(l.config.gameoptions.gameid+a))},l.updatekidaptivestate=function(){l.alpPlugin.setState({introLevelsCompleted:this.usersavestate.introList,levelCompleteHistory:this.usersavestate.levelHistory})},l.trackevent=function(a,b){if(l.config.gameoptions.trackevents[a]){var c=[];for(var d in b.idorder)c.push(b[b.idorder[d]]);this.learning[a].apply(this.learning,c)}},l.trackstrayclick=function(a){this.trackevent("offClick",{idorder:["coordinates","kid"],kid:this.roundid,coordinates:{x:parseInt(a.x),y:parseInt(a.y),stage_width:l.display.width,stage_height:l.display.height}})},l.trackdwelltime=function(a,b){this.trackevent("dwellTime",{idorder:["dwell_time","object","kid"],kid:this.roundid,dwell_time:a,object:b})},l.trackclickplay=function(a){var b={coordinates:a,kidaptive_uri:this.roundid};this.trackevent("clickPlay",{idorder:["custom"],kid:this.roundid,coordinates:a,custom:b})},l.getmovieinfo=function(a){return this.config.movies[a]},l.trackmoviestart=function(a){var b=this.getmovieinfo(a);this.trackevent("startMovie",{idorder:["collection"],kid:this.roundid,movie_id:a,duration:b.duration,description:b.description,collection:{movie_id:a,duration:b.duration,description:b.description,kidaptive_uri:this.roundid}})},l.trackmovieend=function(a){var b=this.getmovieinfo(a);this.trackevent("endMovie",{idorder:["collection"],kid:this.roundid,movie_id:a,duration:b.duration,description:b.description,collection:{movie_id:a,duration:b.duration,description:b.description,kidaptive_uri:this.roundid}})},l.trackmovieskip=function(a){var b=this.getmovieinfo(a);this.trackevent("skipMovie",{idorder:["collection"],kid:this.roundid,movie_id:a,duration:b.duration,description:b.description,collection:{movie_id:a,duration:b.duration,description:b.description,kidaptive_uri:this.roundid}})},l.startdwelltimer=function(a){l.startdwell=Date.now(),l.dwellobject=a},l.stopdwelltimer=function(){l.startdwell&&(l.dwelltime=Date.now()-l.startdwell,l.dwelltime>1500&&l.trackdwelltime(l.dwelltime,l.dwellobject.id)),l.startdwell=null,l.dwelltime=0},l.soundtrack={played:{},voPlayer:l.voPlayer,playVO:function(a,b){this.voPlayer.play(a,b)},voloc:function(){return 0===this.voPlayer.duration?0:this.voPlayer.currentPosition/this.voPlayer.currentDuration},voplaying:function(){return this.voPlayer.currentVO},stopVO:function(){this.voPlayer.stop()},playSFX:function(a){this.sfx=l.sound.play(a)},bequiet:function(){l.sound.stopAll()},playAmbient:function(a){a!==this.ambientsound&&(this.ambient&&(this.ambient.stop(this.ambientsound),this.ambientsound=null,this.ambient=null),a&&(this.ambient=l.sound.play(a,{loop:-1}),this.ambientsound=a))},stopAmbient:function(){this.ambient.stop(this.ambientsound)},playMusic:function(a){a!==this.musicsound&&(this.music&&(this.music.stop(this.musicsound),this.musicsound=null),a&&(this.music=l.music.play(a,{loop:-1}),this.musicsound=a))}},window.app=l,window.images={},window.imageurls={},document.addEventListener("DOMContentLoaded",function(a){});for(var m in i)window.imageurls[i[m].id]=i[m].src}();