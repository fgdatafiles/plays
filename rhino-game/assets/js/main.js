!function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Sound"),d=function(c,d,e,f){f&&(this.sound=f),b.call(this),this.up=new a(c),this.down=new a(d),this.over=new a(e),this.addChild(this.up),this.onDown=this.onDown.bind(this),this.onOver=this.onOver.bind(this),this.onUp=this.onUp.bind(this),this.onOut=this.onOut.bind(this),this.mouseChildren=!1,this.addEventListener("mousedown",this.onDown),this.addEventListener("mouseover",this.onOver)},e=(b.prototype,extend(d,b));e.enable=function(){this.cursor="pointer",this.alpha=1,this.addEventListener("mousedown",this.onDown),this.addEventListener("mouseover",this.onOver)},e.disable=function(){this.cursor="auto",this.alpha=.25,this.removeEventListener("mousedown",this.onDown),this.removeEventListener("mouseover",this.onOver),this.removeEventListener("mouseout",this.onOut)},e.onDown=function(){this.sound?c.instance.play(this.sound):c.instance.play("clickey"),this.removeChild(this.up),this.addChild(this.down),this.addEventListener("pressup",this.onUp)},e.onUp=function(){this.removeChild(this.down),this.addChild(this.up),this.removeEventListener("pressup",this.onUp)},e.onOver=function(){this.addChild(this.over),this.removeChild(this.up),this.removeEventListener("mouseover",this.onOver),this.addEventListener("mouseout",this.onOut),app.startdwelltimer(this)},e.onOut=function(){this.removeChild(this.over),this.addChild(this.up),this.removeEventListener("mouseout",this.onOut),this.addEventListener("mouseover",this.onOver),app.stopdwelltimer(this)},namespace("wgbh").BitmapButton=d}(),function(){var a=include("createjs.Container"),b=include("createjs.Tween"),c=function(){a.call(this),app.load("assets/images/animations/drone/blossom.json",function(a){var b=new createjs.SpriteSheet(a);this.blossom=new createjs.Sprite(b),this.addChild(this.blossom),this.blossom.framerate=5,this.blossom.gotoAndStop("idle"),this.idle()}.bind(this))},d=(a.prototype,extend(c,a));d.backToIdle=function(){this.blossom.gotoAndStop("idle"),this.idle()},d.idle=function(){b.get(this).wait(3e3+2e3*Math.random()).call(function(){this.stopIdle||(this.blossom.framerate=8,this.blossom.gotoAndPlay("idle"),this.idle())}.bind(this))},d.yes=function(){this.blossom.framerate=20,this.x=this.x-37,this.y=this.y-5,this.stopIdle=!0,this.blossom.gotoAndPlay("yes")},d.no=function(){this.blossom.framerate=20,this.x-=37,this.y-=5,this.stopIdle=!0,this.blossom.gotoAndPlay("no")},namespace("wgbh").Blossom=c}(),function(){var a=include("createjs.Container"),b=include("createjs.Tween"),c=function(b,c,d,e){a.call(this),this.state=e;var f;f=d?"Test:":"Dress:",c?(this.header=new createjs.Text(f,"28px Poppins","#1A2364"),this.newText=new createjs.Text(b,"Bold 28px Poppins","#1A2364")):(this.header=new createjs.Text(f,"42px Poppins","#1A2364"),this.newText=new createjs.Text(b,"Bold 42px Poppins","#1A2364")),this.newText.textAlign="center",this.newText.textBaseline="middle",this.header.textAlign="center",this.header.textBaseline="middle",app.load("assets/images/animations/drone/chetdrone.json",function(a){var b=new createjs.SpriteSheet(a);this.sprite=new createjs.Sprite(b),this.addChild(this.sprite),this.y=175,this.x=-670,this.addChild(this.header),this.addChild(this.newText),this.newText.x=320,this.header.x=320,this.header.y=225,this.newText.y=270,this.animate(),this.bob(),this.go()}.bind(this))},d=(a.prototype,extend(c,a));d.animate=function(){this.sprite.framerate=15,this.sprite.play()},d.go=function(){b.get(this).to({x:300},1500,createjs.Ease.sineOut).wait(1500).to({x:1365},1500,createjs.Ease.sineIn).call(function(){this.state&&(this.state.chetActive=!1,this.state.chartButton.enable())}.bind(this))},d.bob=function(){b.get(this).to({y:this.y+25},750,createjs.Ease.sineInOut).to({y:this.y-25},750,createjs.Ease.sineInOut).call(this.bob.bind(this))},namespace("wgbh").Chet=c}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=function(a){b.call(this),this.gamePanel=a,this.gamestate=this.gamePanel.gamestate,this.setup()},d=b.prototype,e=extend(c,b);e.setup=function(){this.signOne=new a(images.Sign_One),this.signTwo=new a(images.Sign_Two),this.signPost=new a(images.Sign_Post),this.addChild(this.signPost),this.addChild(this.signOne),this.addChild(this.signTwo),this.signOne.y=-25,this.signPost.y=75,this.signPost.x=-5,this.signTwo.y=125,this.signOne.addEventListener("mousedown",this.propertyVO.bind(this)),this.signTwo.addEventListener("mousedown",this.predictionVO.bind(this)),this.signOne.cursor="pointer",this.signTwo.cursor="pointer",this.markContainer=new b,this.addChild(this.markContainer),this.propertyTitle=new createjs.Text("Property:","24px Poppins","#555657"),this.propertyTitle.y=10,this.propertyTitle.x=95,this.propertyTitle.textAlign="center",this.propertyTitle.textBaseline="middle",this.addChild(this.propertyTitle),this.predictionTitle=new createjs.Text("Prediction:","24px Poppins","#555657"),this.predictionTitle.y=160,this.predictionTitle.x=95,this.predictionTitle.textBaseline="middle",this.predictionTitle.textAlign="center",this.addChild(this.predictionTitle)},e.updateText=function(){this.goalText&&this.removeChild(this.goalText),this.goalText2&&this.removeChild(this.goalText2),data=this.gamestate.levelData;1==data.correctAnswer.length?(textData=data.correctAnswer[0],"Soak"==textData&&(textData="Soaks Up"),"Float"==textData&&(textData="Floats")):(textData=data.correctAnswer[0],a=data.correctAnswer[1],"Soak"==a&&(a="Soaks Up"),"Float"==textData&&(textData="Floats"),textData=textData+" and\n"+a);var a,b=this.gamestate.swatchElement.material;this.gamestate.swatchElement.material?(a=b.altName?b.altName:b.name,this.predVO="material-"+b.name.toLowerCase()):a=null,this.propVO="property-"+data.correctAnswer[0].toLowerCase(),data.correctAnswer[1]&&(this.propVO=this.propVO+"-"+data.correctAnswer[1].toLowerCase()),textData&&(this.goalText=new createjs.Text(textData.toLowerCase(),"bold 24px Poppins","#555657"),this.goalText.y=45,this.goalText.textBaseline="middle",this.goalText.textAlign="center",this.addChild(this.goalText),this.goalText.x=95),a&&(this.goalText2=new createjs.Text(a.toLowerCase(),"bold 24px Poppins","#555657"),this.goalText2.y=190,this.goalText2.textAlign="center",this.goalText2.textBaseline="middle",this.addChild(this.goalText2),this.goalText2.x=95)},e.propertyVO=function(){this.defPlayed?this.propVO&&app.voPlayer.play(this.propVO):(app.voPlayer.play("property-definition"),this.defPlayed=!0)},e.predictionVO=function(){app.voPlayer.play(this.predVO)},e.teardown=function(){d.teardown.call(this),this.skin=null},namespace("wgbh").goalUI=c}(),function(){var a=include("springroll.Application"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=function(b,d,e,f){c.call(this),this.gamePanel=b,this.gamestate=d,this.drawSize=f,this.imageID=e,this.workImage=null,this.stage=a.instance.display.stage,this.setup()},e=c.prototype,f=extend(d,c);f.setup=function(){this.workImage=new b(this.imageID),this.addChild(this.workImage),this.cache(0,0,this.workImage.image.width,this.workImage.image.height),this.addChild(this.workImage),this.updateCache("source-over"),this.userDraw=this.userDraw.bind(this),this.startDraw=this.startDraw.bind(this),this.endDraw=this.endDraw.bind(this),this.art=new createjs.Shape,this.addChild(this.art),this.hitArea=new createjs.Shape((new createjs.Graphics).f("#000").dr(0,0,this.workImage.image.width,this.workImage.image.height)),this.on("mousedown",this.startDraw,this),this.drawEnabled=!1,this.isNextEnabled=!1},f.enableDraw=function(a){a?this.drawEnabled=!0:this.drawEnabled=!1},f.startDraw=function(a){this.drawEnabled&&(/Mobi/.test(navigator.userAgent)?this.on("pressmove",this.userDraw,this):this.stage.on("stagemousemove",this.userDraw,this),this.listener=this.addEventListener("mousemove",this.userDraw,this),this.drawX=a.stageX,this.drawY=a.stageY,this.userDraw({localX:this.drawX,localY:this.drawY},!0,!0),this.drawCount=300)},f.userDraw=function(b,c,d){if(this.gamestate.setIdleType("drawn"),this.drawEnabled){!d&!this.drawing&&(this.on("pressup",this.endDraw,this),this.drawing=!0),this.drawPoint=this.globalToLocal(b.localX,b.localY),this.drawX=this.drawPoint.x,this.drawY=this.drawPoint.y,/Mobi/.test(navigator.userAgent)&&(this.drawX=b.localX,this.drawY=b.localY),this.lastDrawX||(this.lastDrawX=this.drawX,this.lastDrawY=this.drawY),this.art.graphics.setStrokeStyle(this.drawSize,1).beginStroke("red").moveTo(this.lastDrawX,this.lastDrawY).lineTo(this.drawX,this.drawY),this.lastDrawX=this.drawX,this.lastDrawY=this.drawY,this.updateCache("destination-out"),this.stage||(this.stage=a.instance.display.stage),this.stage.update(),this.isNextEnabled||this.checkDrawData(),this.drawCount--,this.arr_VO=["draw-whatanoutfit","draw-nicecoloring"];var e,f;this.drawCount<=0&&(e=Math.floor(Math.random()*this.arr_VO.length),f=this.arr_VO[e],this.drawCount=300,app.voPlayer.playing||app.voPlayer.play(f))}},f.endDraw=function(a){if(this.drawEnabled){this.lastDrawX=null,this.lastDrawY=null,this.gamestate.hasDrawnWith(),this.drawing=!1,this.stage.removeAllEventListeners(),a.remove();var b={};b[this.gamestate.swatchElement.material.name]=this.gamestate.swatchElement.material.properties;var c={};c[this.gamestate.levelData.correctMaterial]=this.gamestate.swatchElement.materials[this.gamestate.levelData.correctMaterial];var d=!1;this.gamestate.swatchElement.material==this.gamestate.levelData.correctMaterial&&(d=!0),app.trackevent("paintRhino",{idorder:["round_name","coordinates","correct","amount_painted","material"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},correct:d,amount_painted:this.percentCoverage,material:b})}},f.checkDrawData=function(a){for(var b=this.cacheCanvas,c=0,d=b.height*b.width,e=0,f=b.getContext("2d"),g=f.getImageData(0,0,b.width,b.height),h=0;h<g.data.length;h+=4)g.data[h+3]<1&&c++;e=c/d,this.percentCoverage=e,e>.8&&(this.gamestate.toggleNext(!0),this.isNextEnabled=!0)},f.clearDrawing=function(){this.lastDrawX=null,this.lastDrawY=null,this.removeChild(this.art),this.art=null,this.addChild(this.workImage),this.cache(0,0,this.workImage.image.width,this.workImage.image.height),this.addChild(this.workImage),this.updateCache("source-over"),this.removeChild(this.workImage),this.art=new createjs.Shape,this.addChild(this.art),this.updateCache("source-over"),this.isNextEnabled=!1,this.gamestate.toggleNext(!1),this.gamePanel.swatchElement.unselectMaterial()},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("wgbh").ImagePaint=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(a,c){b.call(this),this.gamestate=app._states.game,this.gamePanel=app._states.game.panel,this.setup(a,c)},e=b.prototype,f=extend(d,b);f.setup=function(c,d){this.on("mousedown",function(){this.hide()},this),c&&(this.levelData=c),d&&(this.callback=d),this.bg=new a(images.Intro_Background),this.bg.x=-170.5,this.ruff=new a(images.Intro_Ruff),this.iPad=new a(images.Intro_iPad),this.ruffHands=new a(images.Intro_Ruff_Hands),this.ruff.x=500,this.ruff.y=800-this.ruff.image.height,this.iPad.x=60,this.iPad.y=190,this.ruffHands.x=505,this.ruffHands.y=460,this.ruffFace=new wgbh.RuffFace,this.ruffFace.x=850,this.ruffFace.y=0;var e;e=c?"assets/images/intro/intro_"+(app.config.gamedata.levelling.currentLevel+1)+".png":"assets/images/intro/intro_img_game.png",app.load(e,function(d){if(this.levelIntro=new a(d),this.levelIntro.x=107,this.levelIntro.y=257,c){this.titleContainer=new b,this.addChild(this.titleContainer),g=new createjs.Graphics,g.beginFill("#4057A9 "),g.drawRect(0,0,677,60),this.textBG=new createjs.Shape(g),this.textBG.x=106,this.textBG.y=256,this.textMask=new createjs.Shape(g),this.textMask.x=106,this.textMask.y=256;var e;e=c.correctAnswer[0],"Soak"==e&&(e="Soaks Up"),"Float"==e&&(e="Floats"),textData2=c.correctAnswer[1],"Soak"==textData2&&(textData2="Soaks Up"),c.correctAnswer[1]&&(e=e+" and "+textData2),this.text=new createjs.Text(e,"35px Poppins","white"),this.text.textAlign="center",this.text.textBaseline="middle",this.text.x=this.iPad.x+this.iPad.image.width/2,this.text.y=290,this.titleContainer.addChild(this.textBG,this.text),this.titleContainer.mask=this.textMask,this.textMask.alpha=0,this.titleContainer.y=-60}this.tweenContainer=new b,this.tweenContainer.y=50,this.tweenContainer.x=-35,this.addChild(this.bg,this.tweenContainer),this.tweenContainer.scaleX=this.tweenContainer.scaleY=.9,this.tweenContainer.addChild(this.ruff,this.iPad,this.levelIntro,this.titleContainer,this.ruffHands,this.ruffFace)}.bind(this))},f.playIntroAudio=function(a,b){var d;d=a?a:"level-intro-"+this.levelData.titleString,b?this.voCallback=b:this.voCallback=this.endIntroAudio.bind(this),app.voPlayer.play(d,this.voCallback),this.ruffFace.syncVO(d),this.titleContainer&&c.get(this.titleContainer).wait(2500).to({y:0},500)},f.endIntroAudio=function(){this.ruffFace.endLipFlap(),this.hide()},f.show=function(){c.get(this).wait(500).call(function(){this.playIntroAudio()}.bind(this))},f.hide=function(){this.removeAllEventListeners(),app.voPlayer.stop(),c.get(this.bg).to({alpha:0},250,createjs.Ease.backIn).call(function(){this.removeAllChildren(),this.removeChild(this.popText),this.removeChild(this.cancelButton),this.callback&&this.callback()}.bind(this))},f.teardown=function(){e.teardown.call(this)},namespace("wgbh").LevelIntro=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Text"),d=include("createjs.Tween"),e=function(c,d){b.call(this),this.state=d,this.panel=c,this.gameData=app.config.gamedata,this.levelData=this.gameData.levels[this.gameData.levelling.currentLevel],this.materialdata=this.gameData.materials,this.currentMaterial=this.gameData.materials[this.gameData.workingVariables.materialSelectID],this.hide=this.hide.bind(this);var e=new createjs.Graphics;e.beginFill("black"),e.drawRect(0,0,1365,768),this.tint=new createjs.Shape(e),this.tint.alpha=.5,this.addChild(this.tint),this.tint.addEventListener("mousedown",this.nothing.bind(this)),this.tweenContainer=new b,this.tweenContainer.scaleX=this.tweenContainer.scaleY=.9,this.addChild(this.tweenContainer),this.ruffContainer=new b,this.addChild(this.ruffContainer),this.ruffContainer.y=50,this.ruffContainer.x=-45,this.ruffContainer.scaleX=this.ruffContainer.scaleY=.9,this.ruff=new a(images.Chart_Ruff),this.ruff.y=800-this.ruff.image.height,this.ruff.x=-65,this.ruffContainer.addChild(this.ruff),this.ruffFace=new wgbh.RuffFace,this.ruffContainer.addChild(this.ruffFace),this.ruffFace.scaleX=-.75,this.ruffFace.scaleY=.75,this.ruffFace.x=300,this.ruffFace.y=140,this.bg=new a(images.Chart_BG),this.tweenContainer.addChild(this.bg),this.tint.x=0-this.x-170.5,this.tint.y=0-this.y,this.checkButton=new wgbh.BitmapButton(images.button_ok,images.button_ok_over,images.button_ok_over),this.panel.skipButtonContainer.addChild(this.checkButton),this.checkButton.alpha=0,this.checkButton.cursor="pointer",this.chartContainer=new b,this.chartContainer.x=58,this.chartContainer.y=345,this.tweenContainer.addChild(this.chartContainer),this.tweenContainer.x=200;var f=new createjs.Graphics;f.setStrokeStyle(1),f.beginStroke("#000000"),f.drawRect(0,0,789,512),this.chartGuide=new createjs.Shape(f),this.showRecordAnswer=this.showRecordAnswer.bind(this),this.chartCells=[],this.chartMark=null,this.matNameVO=null,this.playVO=this.playVO.bind(this)},f=b.prototype,h=extend(e,b);h.checkForData=function(){var a=this.levelData.correctAnswer,b=!1;for(i=0;i<this.levelData.materialSelection.length;i++){mat=this.materialdata[this.levelData.materialSelection[i]];for(var c=0;c<a.length;c++)for(var d=0;d<mat.tested.length;d++)for(var e=0;e<mat.properties.length;e++)mat.tested[d]===a[c]&&(b=!0)}return b},h.generateChart=function(d){var e,f,h,i,j,k=this.levelData.correctAnswer,l=395,m=137,n=100,o=.75,p=1,q="40px";this.levelData.materialSelection.length>3&&(l=264,m=85,n=85,o=.5,p=1,q="25px"),g=new createjs.Graphics,g.beginFill(" #4057A9 "),g.drawRect(0,0,790,n),this.header=new createjs.Shape(g),this.chartContainer.addChild(this.header);for(var r=0;r<k.length;r++){i=k[r].toLowerCase(),"soak"==i&&(i="soaks up"),"float"==i&&(i="floats"),propName=new c(i,q+" Poppins","white"),propName.textBaseline="middle",propName.y=n/2-propName.getBounds().height/2+20,propName.x=l/2-propName.getBounds().width/2+l+l*r,this.chartContainer.addChild(propName);var s=new createjs.Graphics;s.beginFill("white"),s.drawRect(10,5,l-20,n-10);var t=new createjs.Shape(s);t.alpha=.01,t.x=l+l*r,"soaks up"==i&&(i="soak"),"floats"==i&&(i="float"),t.vo="property-"+i.toLowerCase(),t.on("mousedown",this.playVO),t.cursor="pointer",this.chartContainer.addChild(t)}var u={};for(r=0;r<this.levelData.materialSelection.length;r++){g=new createjs.Graphics,g.setStrokeStyle(3),g.beginStroke("#1A2364"),g.moveTo(0,0),g.lineTo(790,0);var v=new createjs.Shape(g);v.y=n+m*r,this.chartContainer.addChild(v),f=this.materialdata[this.levelData.materialSelection[r]];var w=f.name;f.altName&&(w=f.altName);var x=new a(images[f.swatch]);x.regY=x.image.height/2,x.scaleX=x.scaleY=o,x.x=l-x.image.width*o-10,x.y=n+m*r+m/2+f.chartY*o,x.vo="material-"+f.name.toLowerCase(),h=new c(w.toLowerCase(),q+" Poppins","#1A2364"),h.textBaseline="middle",h.textAlign="right",h.x=x.x-15,h.scaleX=h.scaleY=p,h.regY=h.getBounds().height/2,h.y=x.y+20-f.chartY*o,h.vo="material-"+f.name.toLowerCase();var y=new createjs.Graphics;y.beginFill("white"),y.drawRect(10,5,l-20,m-10);var z=new createjs.Shape(y);z.alpha=.01,z.y=n+m*r,z.vo="material-"+f.name.toLowerCase(),this.chartContainer.addChild(h),this.chartContainer.addChild(x),this.chartContainer.addChild(z),z.on("mousedown",this.playVO),z.cursor="pointer",u[w]={};for(var A=0;A<k.length;A++){g=new createjs.Graphics,g.setStrokeStyle(3),g.beginStroke("#1A2364"),g.moveTo(0,0),g.lineTo(0,512);var B=new createjs.Shape(g);B.x=l+l*A,2>r&&this.chartContainer.addChild(B),testProp=k[A],e=new b,e.x=l+l*A,e.y=n+m*r,this.chartContainer.addChild(e);for(var C=!1,D=!1,E=!1,F=0;F<f.tested.length;F++)for(var G=0;G<f.properties.length;G++)f.tested[F]===testProp&&(C=!0,f.tested[F]===f.properties[G]&&(D=!0),this.state.currentMaterial&&f.name==this.state.currentMaterial.name&&testProp==this.levelData.correctAnswer[this.state.testPhase]&&(this.matVO=f.name,E=!0,this.propVO=testProp));if(C&&(D?(u[w][testProp]=!0,j=new a(images.Chart_Check),E&&(this.correctFeedback=!0,this.correctVO="-")):(u[w][testProp]=!1,j=new a(images.Chart_X),E&&(this.correctFeedback=!1,this.correctVO="-not-")),E&&(j.alpha=0,j.scaleX=j.scaleY=0,this.chartMark=j),j.regX=j.image.width/2,j.regY=j.image.height/2,j.x=l/2,j.y=m/2,e.addChild(j)),!C&&this.state==app._states.test&&this.state.testPhase==k.length-1){var H=new createjs.Graphics;H.beginFill("white"),H.drawRect(10,5,l-20,m-10);var I=new createjs.Shape(H);I.alpha=.01,e.addChild(I),I.selectID=this.levelData.materialSelection[r],I.on("mousedown",this.testSelectedMaterial.bind(this)),I.pointer="pointer"}}}app.CHARTCONTENTS=u},h.chartPayoff=function(a){this.checkButton.y=150,this.callback=a,this.generateChart(),d.get(this).wait(500).call(this.showRecordAnswer);var b="table-result-"+this.matVO.toLowerCase()+this.correctVO+this.propVO.toLowerCase();if(this.correctFeedback){if(this.trackCorrect=!0,this.state.testPhase<1){var c=["test-feedback-success5","test-feedback-success6","payoff-wonder"];this.feedbackVO=[c[Math.floor(3*Math.random())]]}else this.feedbackVO="test-feedback-success1";this.gameData.levelling.failedLast&&this.state.testPhase==this.levelData.correctAnswer.length-1&&(arrayThree=["test-feedback-success3","test-kept-trying"],this.feedbackVO=arrayThree[Math.floor(2*Math.random())]),this.state.trackcorrectfeedback(this.feedbackVO,"audio",!1)}else this.trackCorrect=!1,this.failArray=["test-feedback-fail1","test-feedback-success6"],this.feedbackVO=this.failArray[Math.floor(2*Math.random())],this.levelData.hasBeenTested||(this.feedbackVO="test-feedback-fail1"),this.state.trackincorrectfeedback(this.feedbackVO,"audio",!1);this.levelData.hasBeenTested=!0,this.ruffFace.syncVO(b),this.payoffVOPlaying=!0,app.voPlayer.play(b,function(){this.trackCorrect?this.state.trackcorrectfeedback(this.feedbackVO,"audio",!0):this.state.trackincorrectfeedback(this.feedbackVO,"audio",!0),app.voPlayer.play(this.feedbackVO,this.showCloseButton.bind(this)),this.ruffFace.syncVO(this.feedbackVO)}.bind(this))},h.showRecordAnswer=function(){d.get(this.chartMark).to({alpha:1,scaleX:1,scaleY:1},500,createjs.Ease.bounceOut)},h.showCloseButton=function(){this.checkButton.enable(),this.payoffVOPlaying=!1,this.ruffFace.endLipFlap(),this.checkButton.alpha=1,d.get(this.checkButton).wait(1e3).to({y:0},500,createjs.Ease.backOut),d.get(this).wait(1e4).call(function(){(1==this.levelData.correctAnswer.length||this.levelData.correctAnswer.length>1&&this.state.testPhase>0)&&(app.voPlayer.play("table-testmore"),this.ruffFace.syncVO(this.feedbackVO))}.bind(this))},h.playVO=function(a){if(!this.payoffVOPlaying){var b=a.target.vo;app.voPlayer.play(b,this.ruffFace.endLipFlap),this.ruffFace.syncVO(b)}},h.show=function(){this.checkButton.addEventListener("mousedown",this.hide),this.tweenContainer.y=0-this.tweenContainer.getBounds().height,this.panel.popupContainer.addChild(this),this.alpha=0,d.get(this).to({alpha:1},150).call(function(){d.get(this.tweenContainer).to({y:-175},300,createjs.Ease.backOut)}.bind(this)),d.get(this.checkButton).to({alpha:1},150)},h.hide=function(a){this.checkButton.removeEventListener("mousedown",this.hide),this.checkButton.disable(),this.state.idleChart&&(this.state.idleChart=!1),d.removeAllTweens(this),d.get(this.tweenContainer).to({y:0-this.tweenContainer.getBounds().height},300,createjs.Ease.backIn).call(function(){d.get(this.checkButton).to({alpha:0},150),d.get(this).to({alpha:0},250,createjs.Ease.backIn).call(function(){this.callback&&this.callback(),this.callback=null,this.clear()}.bind(this))}.bind(this)),app.trackevent("toggleChart",{idorder:["round_name","coordinates","action","chart_contents"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},action:"close",chart_contents:app.CHARTCONTENTS})},h.testSelectedMaterial=function(a){var b=a.currentTarget.selectID;this.gameData.workingVariables.passSelectedMaterial=b,this.state.testPerformed=!1,this.state.testPhase=0,this.state.twoStageFail=!1,this.state.manager.state="game"},h.clear=function(){this.chartContainer.removeAllChildren()},h.nothing=function(){},h.teardown=function(){f.teardown.call(this),this.skin=null},namespace("wgbh").MaterialChart=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=include("springroll.Application"),e=function(a,c){b.call(this),this.gamePanel=d.instance._states.game.panel,this.setup(a,c)},f=b.prototype,g=extend(e,b);g.setup=function(b,c){this.gamePanel.toggleButtons(!1);var d=new createjs.Graphics;d.beginFill("#cecece"),d.drawRoundRect(0,0,700,500,10,10,10,10),this.bg=new createjs.Shape(d),this.addChild(this.bg),this.regX=300,this.regY=200,this.x=500,this.y=280,this.ruff=new a(images.ruff_reg),this.ruff.x=50,this.ruff.y=100,this.ruff.scaleX=this.ruff.scaleY=.65,this.addChild(this.ruff),this.matInfo=new createjs.Text(b.matInfo,"25px Poppins","black"),this.matInfo.textAlign="center",this.matInfo.x=375,this.matInfo.y=165,this.addChild(this.matInfo),this.matIcon=new a(images[b.swatch]),this.matIcon.x=300,this.matIcon.y=50,this.addChild(this.matInfo),this.checkButton=new a(images.checkBTN),this.checkButton.regX=this.checkButton.regY=60,this.checkButton.x=275,this.checkButton.y=425,this.addChild(this.checkButton),this.cancelButton=new a(images.clearBTN),this.cancelButton.regX=this.cancelButton.regY=60,this.cancelButton.x=475,this.cancelButton.y=425,this.cancelButton.on("mousedown",this.hide,this),this.checkButton.on("mousedown",function(){this.gamePanel.swatchElement.selectMaterial(c),this.hide()},this),this.addChild(this.cancelButton),this.show()},g.show=function(){this.gamePanel.popupContainer.addChild(this),this.scaleX=this.scaleY=0,c.get(this).to({scaleX:1,scaleY:1},250,createjs.Ease.backOut)},g.hide=function(){c.get(this).to({scaleX:0,scaleY:0},250,createjs.Ease.backIn).call(function(){this.removeAllChildren(),this.checkButton.removeAllEventListeners(),this.removeChild(this.matInfo),this.removeChild(this.cancelButton),this.gamePanel.toggleButtons(!0)})},g.teardown=function(){f.teardown.call(this)},namespace("wgbh").MaterialOverlay=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Sound"),d=include("springroll.Application"),e=function(c,e,f){b.call(this),this.gamePanel=d.instance._states.game.panel;var g="assets/images/menu/th_menu_"+(e+1)+".png";app.load(g,function(b){this.bgImage=new a(b);var d=new createjs.Graphics;d.setStrokeStyle(6),d.beginStroke("#1A2364"),d.drawRect(3,3,this.bgImage.image.width-3,this.bgImage.image.height-3),this.stroke=new createjs.Shape(d),d=new createjs.Graphics,d.setStrokeStyle(6),d.beginStroke("#7290E8"),d.drawRect(3,3,this.bgImage.image.width-3,this.bgImage.image.height-3),this.hoverStroke=new createjs.Shape(d),d=new createjs.Graphics,d.beginFill("#000000"),d.drawRect(0,0,this.bgImage.image.width,this.bgImage.image.height),this.shadow=new createjs.Shape(d),this.shadow.x=this.shadow.y=12,this.shadow.alpha=.3,this.addChild(this.shadow),this.addChild(this.bgImage),this.addChild(this.stroke),c.locked?this.lock():this.lockIcon&&this.unlock(),c.levelComplete&&this.completed(),15==e&&f()}.bind(this)),this.completeIcon=null,this.lockIcon=null,this.hover=this.hover.bind(this),this.hoverOut=this.hoverOut.bind(this),this.click=this.click.bind(this),this.clickOut=this.clickOut.bind(this),this.addEventListener("mouseover",this.hover),this.addEventListener("mousedown",this.click),this.mouseChildren=!1,this.cursor="pointer"},f=b.prototype,h=extend(e,b);h.hover=function(){this.lockedIcon||(this.addEventListener("mouseout",this.hoverOut),this.addChild(this.hoverStroke),app.startdwelltimer(this))},h.hoverOut=function(){this.removeEventListener("mouseout",this.hoverOut),this.removeChild(this.hoverStroke),app.stopdwelltimer(this)},h.click=function(){this.lockedIcon||(c.instance.play("hop5"),this.addEventListener("pressup",this.clickOut),this.stroke.x+=5,this.stroke.y+=5,this.bgImage.x+=5,this.bgImage.y+=5,this.hoverStroke.x+=5,this.hoverStroke.y+=5,this.completedIcon&&(this.completedIcon.x+=5,this.completedIcon.y+=5))},h.clickOut=function(){this.removeEventListener("pressup",this.clickOut),this.stroke.x-=5,this.stroke.y-=5,this.bgImage.x-=5,this.bgImage.y-=5,this.hoverStroke.x-=5,this.hoverStroke.y-=5,this.completedIcon&&(this.completedIcon.x-=5,this.completedIcon.y-=5)},h.completed=function(){this.completedIcon||(this.completedIcon=new a(images.Menu_Check),this.completedIcon.x=this.getBounds().width-this.completedIcon.image.width-10,this.completedIcon.y=this.getBounds().height-this.completedIcon.image.height-10,this.addChild(this.completedIcon))},h.lock=function(){this.lockedIcon||(g=new createjs.Graphics,g.beginFill("#FFFFFF"),g.drawRect(6,6,this.bgImage.image.width-9,this.bgImage.image.height-9),this.tint=new createjs.Shape(g),this.tint.alpha=.6,this.addChild(this.tint),this.lockedIcon=new a(images.Menu_Lock),this.lockedIcon.x=this.getBounds().width-this.lockedIcon.image.width-10,this.lockedIcon.y=this.getBounds().height-this.lockedIcon.image.height-10,this.addChild(this.lockedIcon))},h.unlock=function(){this.lockedIcon&&(this.removeChild(this.lockIcon),this.removeChild(this.tint))},h.teardown=function(){f.teardown.call(this)},namespace("wgbh").MenuButton=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=include("springroll.Application"),e=function(){b.call(this),this.gamePanel=d.instance._states.game.panel,this.scrollRight=this.scrollRight.bind(this),this.scrollLeft=this.scrollLeft.bind(this),this.setup()},f=b.prototype,g=extend(e,b);g.setup=function(){this.gamePanel.toggleButtons(!1),this.background=new a(images.Gallery_BG),this.addChild(this.background),this.book=new a(images.Gallery_Book_Open),this.book.y=800-this.book.image.height,this.addChild(this.book),this.checkButton=new wgbh.TextButton(110,60,"#4CCEDE","Close"),this.checkButton.x=800,this.checkButton.y=650,this.addChild(this.checkButton),this.leftArrow=new a(images.Menu_Arrow_Left),this.rightArrow=new a(images.Menu_Arrow_Right),this.leftArrow.scaleX=this.leftArrow.scaleY=.75,this.rightArrow.scaleX=this.rightArrow.scaleY=.75,this.leftArrow.x=0,this.leftArrow.y=400,this.rightArrow.x=850,this.rightArrow.y=400,this.arrowTray=new b,this.arrowTray.addChild(this.leftArrow,this.rightArrow),this.arrowTray.x=640-this.arrowTray.getBounds().width/2-25,this.rightArrow.addEventListener("mousedown",this.scrollRight),this.leftArrow.addEventListener("mousedown",this.scrollLeft),this.show()},g.showPayoff=function(a,b){this.refreshImage(a),this.checkButton.on("mousedown",function(){b()},this),this.show()},g.refreshImage=function(b){this.payoffText&&this.removeChild(this.payoffText),this.payoffImage&&this.removeChild(this.payoffImage),1==b.correctAnswer.length?text=b.correctAnswer[0]:text=b.correctAnswer[0]+" and "+b.correctAnswer[1],this.payoffText=new createjs.Text(text,"35px Poppins","black"),this.payoffText.textAlign="center",this.payoffText.x=640,this.payoffText.y=125,this.addChild(this.payoffText),this.payoffImage=new a(images[b.payoffImage]),this.payoffImage.scaleX=this.payoffImage.scaleY=1,this.payoffImage.regX=this.payoffImage.image.width/2,this.payoffImage.x=615,this.payoffImage.y=200,this.addChild(this.payoffImage),app.voPlayer.play(b.payoffVO)},g.showGallery=function(a,b){this.galleryIndex=0,this.gallery=[];for(var c=0;c<a.length;c++){var d;a[c].levelComplete&&(d={correctAnswer:a[c].correctAnswer,payoffImage:a[c].payoffImage,payoffVO:a[c].payoffVO},this.gallery.push(d))}this.checkButton.on("mousedown",function(){this.hide()},this),this.gallery.length>1&&this.addChild(this.arrowTray),this.refreshImage(this.gallery[this.galleryIndex]),this.show()},g.scrollRight=function(){this.galleryIndex<this.gallery.length-1&&this.galleryIndex++,this.refreshImage(this.gallery[this.galleryIndex])},g.scrollLeft=function(){this.galleryIndex>0&&this.galleryIndex--,this.refreshImage(this.gallery[this.galleryIndex])},g.show=function(){this.gamePanel.popupContainer.addChild(this),this.alpha=0,c.get(this).to({alpha:1},250,createjs.Ease.backOut)},g.hide=function(){c.get(this).to({alpha:0},250,createjs.Ease.backIn).call(function(){this.removeAllChildren(),this.checkButton.removeAllEventListeners(),this.removeChild(this.payoffText),this.removeChild(this.cancelButton),this.gamePanel.toggleButtons(!0)})},g.teardown=function(){f.teardown.call(this)},namespace("wgbh").PayoffGallery=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(c,d){b.call(this),this.state=c,this.panel=d,this.promptBG=new a(images.test_sign),this.yesButton=new wgbh.BitmapButton(images.button_yes,images.button_yes_over,images.button_yes_over),this.noButton=new wgbh.BitmapButton(images.button_no,images.button_no_over,images.button_no_over),this.yesButton.x=30,this.noButton.x=180,this.yesButton.y=this.noButton.y=105,this.addChild(this.promptBG,this.yesButton,this.noButton),this.scaleX=this.scaleY=1,this.x=705,this.y=565,this.wrongAnswer=this.wrongAnswer.bind(this)},e=b.prototype,f=extend(d,b);f.doPrompt=function(a){this.isCorrect=a;var b=this.state.currentMaterial.name,c=this.state.levelData.correctAnswer[this.state.testPhase],d="input-prompt-"+b.toLowerCase()+"-"+c.toLowerCase();this.state.ruffPointer.saythings(d,function(){app.config.gamedata.tutorial.tutorialActive?this.state.ruffPointer.saythings("tap-button-document",this.earlyIdle.bind(this)):this.state.ruffPointer.saythings("lets-document-alt",this.earlyIdle.bind(this));
}.bind(this)),this.promptText&&this.panel.promptContainer.removeChild(this.promptText);var e;e=this.state.currentMaterial.plural?"Are ":"Is ",("Soak"==c||"Float"==c||"Grows"==c)&&(e=this.state.currentMaterial.plural?"Do ":"Does ","Soak"==c&&(c="soak up"),"Grows"==c&&(c="grow"));var f;f=this.state.currentMaterial.altName?this.state.currentMaterial.altName:this.state.currentMaterial.name,this.promptText=new createjs.Text(e+f.toLowerCase()+"\n"+c.toLowerCase()+"?","24px Poppins","black"),this.trackText=e+f.toLowerCase()+"\n"+c.toLowerCase()+"?",this.promptText.textBaseline="middle",this.promptText.textAlign="center",this.promptText.x=this.getBounds().width/2,this.promptText.y=45,this.addChild(this.promptText),this.yesButton.enable(),this.noButton.enable(),this.yesButton.cursor="pointer",this.noButton.cursor="pointer",this.yesButton.removeEventListener("mousedown",this.state.promptPayoff),this.noButton.removeEventListener("mousedown",this.state.promptPayoff),this.yesButton.removeEventListener("mousedown",this.wrongAnswer),this.noButton.removeEventListener("mousedown",this.wrongAnswer),a?(this.yesButton.on("mousedown",this.state.promptPayoff.bind(this.state,"yes",this.trackText)),this.noButton.on("mousedown",this.wrongAnswer.bind(this,"yes"))):(this.noButton.on("mousedown",this.state.promptPayoff.bind(this.state,"no",this.trackText)),this.yesButton.on("mousedown",this.wrongAnswer.bind(this,"yes")))},f.earlyIdle=function(){var a=this.state.levelData.correctAnswer[this.state.testPhase];("Shiny"==a||"Hard"==a||"Grow"==a)&&this.startIdle()},f.startIdle=function(){this.state.animationData.idle&&(this.isCorrect?this.state.ruffPointer.saythings(this.state.animationData.idle.success):this.state.ruffPointer.saythings(this.state.animationData.idle.fail))},f.wrongAnswer=function(a,b){b.target.disable(),this.state.ruffPointer.saythings("try-again",this.startIdle.bind(this),this.state.trackincorrectfeedback.bind(this.state)),this.killTweens(),app.trackevent("selectYesNo",{idorder:["round_name","coordinates","correct","selection","prompt"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(b.stageX),y:parseInt(b.stageY),stage_width:app.display.width,stage_height:app.display.height},correct:!1,selection:"selection",prompt:this.trackText})},f.killTweens=function(){c.removeTweens(this)},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("wgbh").RecordPrompt=d}(),function(){var a=include("createjs.Container"),b=include("createjs.Tween"),c=function(b,c,d){a.call(this),app.load("assets/images/animations/drone/rhinorun.json",function(a){var b=new createjs.SpriteSheet(a);this.sprite=new createjs.Sprite(b),this.addChild(this.sprite),this.y=350,this.x=-1e3}.bind(this))},d=(a.prototype,extend(c,a));d.animate=function(a){a?(this.sprite.framerate=10,this.sprite.play("Rhino_Fluff_Main_Comp")):this.sprite.stop()},d.go=function(a){this.x=-1e3,b.get(this).to({x:8e3},a,createjs.Ease.sineOut)},namespace("wgbh").RhinoRun=c}(),function(){var a=include("createjs.Container"),b=include("createjs.Tween"),c=function(b){a.call(this),this.loadingIndex=0,app.load("assets/images/animations/ruff/mouth.json",function(a){var b=new createjs.SpriteSheet(a);this.mouthSprite=new createjs.Sprite(b),this.mouthSprite.y=325,this.loadingIndex++,3==this.loadingIndex&&this.addLayers()}.bind(this)),app.load("assets/images/animations/ruff/ears.json",function(a){var b=new createjs.SpriteSheet(a);this.ears=new createjs.Sprite(b),this.ears.framerate=5,this.ears.y=15,this.ears.x=35,this.loadingIndex++,3==this.loadingIndex&&this.addLayers()}.bind(this)),app.load("assets/images/animations/ruff/eyes.json",function(a){var b=new createjs.SpriteSheet(a);this.eyes=new createjs.Sprite(b),this.eyes.framerate=15,this.eyes.y=120,this.eyes.x=-35,this.loadingIndex++,3==this.loadingIndex&&this.addLayers()}.bind(this)),this.lipFlapUpdate=this.lipFlapUpdate.bind(this),app.on("update",this.lipFlapUpdate)},d=(a.prototype,extend(c,a));d.addLayers=function(){this.addChild(this.mouthSprite),this.addChild(this.ears),this.addChild(this.eyes),this.idleEyes(),this.idleEars()},d.syncVO=function(a){this.lipFlapActive=!0,this.syncArray=app.config.lipFlapData[a]},d.lipFlapUpdate=function(){if(this.lipFlapActive&&this.syncArray){var a=app.voPlayer.getElapsed()/app.voPlayer.currentDuration,b=this.syncArray[parseInt(a*this.syncArray.length)];this.mouthSprite.gotoAndStop(b)}},d.endLipFlap=function(){this.mouthSprite.gotoAndStop(0),this.lipFlapActive=!1},d.idleEyes=function(){b.get(this).wait(2e3+2e3*Math.random()).call(function(){this.eyes.gotoAndPlay("blink"),this.idleEyes()}.bind(this))},d.idleEars=function(){b.get(this).wait(2e3+1e3*Math.random()).call(function(){this.ears.gotoAndPlay("ears"),this.idleEars()}.bind(this))},namespace("wgbh").RuffFace=c}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Application"),d=include("createjs.Tween"),e=function(a,d){b.call(this),this.gamePanel=a,this.gameData=d,this.settings=this.gameData.settings,this.gamestate=c.instance._states.game,this.setup()},f=b.prototype,g=extend(e,b);g.setup=function(){this.materials=this.gameData.materials,this.arr_swatches=[],this.arr_labels=[],this.selectMaterial=this.selectMaterial.bind(this),this.onSwatchOver=this.onSwatchOver.bind(this),this.onSwatchOut=this.onSwatchOut.bind(this),this.updateSwatches()},g.updateSwatches=function(){this.currentLevel=this.gameData.levels[this.gameData.levelling.currentLevel];var c,d,e,f,g;if(this.arr_swatches[0])for(var h=0;h<this.arr_swatches.length;h++)this.removeChild(this.arr_swatches[h]),this.removeChild(this.arr_labels[h]);this.arr_swatches=[],this.arr_labels=[];for(var i=0;i<this.currentLevel.materialSelection.length;i++)f=this.currentLevel.materialSelection[i],g=this.gameData.materials[f].swatch,c=new b,d=new a(images[g]),e=new a(images.swatch_shadow),c.mat=d,c.shadow=e,d.regX=d.image.width/2,e.regX=e.image.width/2,e.regY=e.image.height/2,e.y=140,gbox=new createjs.Graphics,gbox.beginFill("white"),gbox.drawRect(0,0,d.image.width,d.image.height),hitbox=new createjs.Shape(gbox),hitbox.alpha=.01,hitbox.regX=d.image.width/2,c.addChild(hitbox),c.addChild(e),c.addChild(d),c.x=150*i,c.scaleX=c.scaleY=.95,c.selectID=f,c.trayID=i,c.cursor="pointer",c.addEventListener("mouseover",this.onSwatchOver),this.addChild(c),this.arr_swatches.push(c);this.x=512-this.getBounds().width/2+this.arr_swatches[0].getBounds().width/2,this.y=768-this.getBounds().height-10,this.gamePanel.drawElement.enableDraw(!1),this.toggleSwatches(!0)},g.onSwatchOver=function(a){a.target.removeEventListener("mouseover",this.onSwatchOver),a.target.addEventListener("mouseout",this.onSwatchOut),app.startdwelltimer(a.target)},g.onSwatchOut=function(a){a.target.removeEventListener("mouseout",this.onSwatchOut),a.target.addEventListener("mouseover",this.onSwatchOver),app.stopdwelltimer(a.target)},g.toggleSwatches=function(a,b){for(var c=0;c<this.arr_swatches.length;c++)a?this.arr_swatches[c].addEventListener("mousedown",this.selectMaterial):this.arr_swatches[c].removeEventListener("mousedown",this.selectMaterial)},g.selectMaterial=function(b){this.gamePanel.drawElement.clearDrawing(),this.gamePanel.drawElement.drawEnabled||this.gamePanel.drawElement.enableDraw(!0);var c;if(b?(c=b.currentTarget,this.gamePanel.drawElement.startDraw(b)):this.arr_swatches.forEach(function(a){a.selectID==this.gameData.workingVariables.passSelectedMaterial&&(c=a)}.bind(this)),this.material=this.materials[c.selectID],this.gameData.workingVariables.materialSelectID=c.selectID,this.gamestate.currentMaterial=this.material,this.gamestate.setIdleType("selected"),this.imageID=images[this.materials[c.selectID].image],this.materialImage&&this.materialImage.parent.removeChild(this.materialImage),this.materialImage=new a(images[this.materials[c.selectID].image]),this.gamePanel.materialContainer.addChild(this.materialImage),this.arr_swatches.forEach(function(a){a==c?this.toggleSelectTween(a,!0):this.toggleSelectTween(a,!1)}.bind(this)),this.gamePanel.gamestate.goalUI.updateText(),!this.gamestate.introVOPlaying){var d;c.voPlayed?d="material-"+this.materials[c.selectID].name.toLowerCase():(d="material-info-"+this.materials[c.selectID].name.toLowerCase(),c.voPlayed=!0),this.gamestate.ruffPointer.backtocorner(),this.gamestate.ruffPointer.saythings(d),app.voPlayer.play(d,function(){this.gameData.tutorial.materialSelected||(this.gamestate.ruffPointer.pointat({x:600,y:200}),this.gamestate.ruffPointer.saythings("draw-cover",this.gamestate.ruffPointer.backtocorner.bind(this.gamestate.ruffPointer)),this.gameData.tutorial.materialSelected=!0)}.bind(this));var e={};e[this.material.name]=this.material.properties;var f={};f[this.currentLevel.correctMaterial]=this.materials[this.currentLevel.correctMaterial];var g=!1;this.material.name==this.currentLevel.correctMaterial&&(g=!0),app.trackevent("selectAnswer",{idorder:["round_name","coordinates","correct","material","correct_material"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(b.stageX),y:parseInt(b.stageY),stage_width:app.display.width,stage_height:app.display.height},correct:g,material:e,correct_material:f})}},g.unselectMaterial=function(){this.materialImage&&this.removeChild(this.gamePanel.materialContainer.currentMaterialImage),this.gamePanel.drawElement.enableDraw(!1)},g.toggleSelectTween=function(a,b){b?(d.get(a.mat).to({y:-60},300,createjs.Ease.quadInOut),d.get(a.shadow).to({scaleX:.75,scaleY:.75},300,createjs.Ease.quadInOut)):(d.get(a.mat).to({y:0},300,createjs.Ease.quadInOut),d.get(a.shadow).to({scaleX:1,scaleY:1},300,createjs.Ease.quadInOut))},g.teardown=function(){f.teardown.call(this),this.skin=null},namespace("wgbh").SwatchSelect=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Text"),d=function(d,e,f,g,h){b.call(this),this.text=new c(g,"20px Arial","black"),this.text.x=d/2-this.text.getMeasuredWidth()/2,h?this.text.y=55:this.text.y=8;var i=new createjs.Graphics;i.beginFill(f),i.drawRect(0,0,d,e),this.stroke=new createjs.Shape(i),i=new createjs.Graphics,i.beginFill("#1A2364"),i.drawRect(0,0,d,e),this.shadow=new createjs.Shape(i),this.shadow.y=4,this.addChild(this.shadow),this.addChild(this.stroke),this.addChild(this.text),h&&(this.arrow=new a(images.Button_Arrow),this.arrow.x=25,this.arrow.y=20,this.addChild(this.arrow)),this.cache(0,0,d+5,e+5)},e=b.prototype,f=extend(d,b);f.teardown=function(){e.teardown.call(this)},namespace("wgbh").TextButton=d}(),function(){var a=include("createjs.Container"),b=include("createjs.Sprite"),c=include("createjs.SpriteSheet"),d=include("springroll.easeljs.DisplayAdapter"),e=include("createjs.Tween"),f=include("createjs.Ease"),g=include("springroll.EventDispatcher"),h=function(a){this.init(a)},i=extend(h,a),j=90;h.E=315,h.N=225,h.W=135,h.S=45,h.corner=360,h.makeMovieClipFromZoeSpritesheet=function(a,d){a.copyframes||(a.copyframes=[].concat(a.frames)),a.copyimages||(a.copyimages=[].concat(a.images));for(var e in a.copyimages)"string"==typeof a.copyimages[e]&&(a.images[e]=images[a.copyimages[e]]);d||(d="all");var f=[],g=a.animations[d].frames;for(var h in g)f[h]=a.copyframes[g[h]];return a.frames=f,new b(new c(a))},h.anglefromcompass=function(a){if("corner"===a)return h.corner;var b,c,d=a.split(""),e=0;for(var f in d)"S"===d[f]?b=!0:"E"===d[f]&&(c=!0),e+=h[d[f]];return b&&c&&(e-=h.corner),angle=e/d.length,angle},i.init=function(b){a.call(this),this.events=new g,this.ruffhead=new a,this.ruff=h.makeMovieClipFromZoeSpritesheet(h.spritedef,"ruff"),this.ruffhead.addChild(this.ruff),d.setPivot(this.ruffhead,{x:46,y:46}),d.setPosition(this.ruffhead,{x:61,y:61}),this.defaultduration=500,this.pointer=h.makeMovieClipFromZoeSpritesheet(h.spritedef,"pointer"),this.rotation=h.corner,this.ruffhead.rotation=0,this.addChild(this.pointer),this.addChild(this.ruffhead),this.happymouth=h.makeMovieClipFromZoeSpritesheet(h.spritedef,"happymouth"),this.sadmouth=h.makeMovieClipFromZoeSpritesheet(h.spritedef,"sadmouth"),this.mouth=this.happymouth,d.setPosition(this.mouth,{x:32,y:50}),this.ruffhead.addChild(this.mouth),this.interactive=!0,this.animatedparts=[],this.incorner=!0,this.checkwidth=120*app.scaling._scale,this.voplayer=app.voPlayer,this.lipsyncobject=app.config.lipFlapData,this.itempath=app.states.game.panel,b&&(b.voplayer&&(this.voplayer=b.voplayer),b.lipsync&&(this.lipsyncobject=b.lipsync),b.itempath&&(this.itempath=b.itempath)),this.update=this.update.bind(this),this.clickedme=this.clickedme.bind(this),this.audioend=this.audioend.bind(this),this.nextmove=this.nextmove.bind(this),this.nextevent=this.nextevent.bind(this),this.saynext=this.saynext.bind(this),app.on("update",this.update),this.voplayer.on("end",this.audioend),this.on("click",this.clickedme)},i.clickedme=function(){this.events.trigger("click")},i.saythings=function(a,b,c){return c?this.trackFeedback=c:this.trackFeedback=!1,this.audiocallback=b,"string"==typeof a?void this.saything(a,b):(this.audiosets=[],this.audiosets=this.audiosets.concat(a),void this.saynext())},i.saything=function(a,b){b&&(this.audiocallback=b),this.audiosets=[a],this.saynext()},i.stoptalking=function(){this.syncarray=null,this.talking=!1,this.voplayer.stop(),this.setmouth(0)},i.saynext=function(){this.audiosets.length>1?this.aftersound=this.saynext:this.aftersound=this.audiocallback,this.sayoneaudio(this.audiosets.shift(),this.aftersound)},i.skipall=function(){this.stoptalking(),this.nextmoves=null,this.audiosets=null,this.afteraudio=null;var a;for(a in this.movetimers)this.movetimers[a].destroy();for(a in this.eventtimers)this.eventtimers[a].destroy();this.backtocorner()},i.sayoneaudio=function(a,b){var c;"string"==typeof a?(c=a,this.voplayer.play(a,b),this.talking=!0,this.voplayer.playing=!0,this.syncarray=this.lipsyncobject[c]):(c=a.audio,"string"==typeof a.audio&&(this.syncarray=this.lipsyncobject[a.audio],this.voplayer.play(a.audio,b)),this.talking=!0),this.trackFeedback&&this.trackFeedback(c,"audio",!1),this.audiofile=c},i.backtocorner=function(a){this.incorner||(a=0===a?0:a?a:this.defaultduration,this.pointat({x:0,y:0},a,"corner"),this.following=null,this.incorner=!0,this.nooutline())},i.nooutline=function(){this.pointer.gotoAndStop(0),d.setPosition(this.ruffhead,{x:61,y:61})},i.outline=function(){this.pointer.gotoAndStop(1),d.setPosition(this.ruffhead,{x:66,y:66})},i.rotateto=function(a,b){0===b||b||(b=750),this.rotation>h.corner?(this.rotation-=h.corner,this.ruffhead.rotation+=h.corner):-1*this.rotation>h.corner&&(this.rotation+=h.corner,this.ruffhead.rotation-=h.corner);var c=a-this.rotation;(c>j||-1*c>j)&&(a>this.rotation?a-=h.corner:a+=h.corner),e.get(this).to({rotation:a},b),e.get(this.ruffhead,{override:!0}).to({rotation:h.corner-a},b)},i.displayposition=function(){return this},i.pointat=function(a,b,c){if(a.localToGlobal?a=a.pointerspot?a.localToGlobal(a.pointerspot.x,a.pointerspot.y):a.localToGlobal(0,0):a.length&&2===a.length?a={x:a[0],y:a[1]}:a.x&&a.y||(a={x:0,y:0}),0===b||b||(b=this.defaultduration),e.get(this.displayposition(),{override:!0}).to({x:a.x,y:a.y},b,f.quadInOut),void 0===c&&(c="auto"),"auto"===c){var d="";a.y<this.checkwidth?d="S":a.y>app.realHeight-this.checkwidth&&(d="N"),a.x<this.checkwidth?d+="E":a.x>app.realWidth-this.checkwidth&&(d+="W"),""===d&&(d="N"),c=h.anglefromcompass(d)}else"string"==typeof c?c=h.anglefromcompass(c):c+=h.N;this.rotateto(c,b),app.setTimeout(b,this.finishedmoving),this.incorner=!1,this.outline()},i.pulseitem=function(a,b){if(a.hasOwnProperty("scaleX")&&a.pulse!==!1){b||(b=.25);var c=f.cubicOut,d=f.cubicOut,g=a.getBounds();if(e.get(a).to({scaleX:a.scaleX+a.scaleX*b,scaleY:a.scaleY+a.scaleY*b},500,c).to({scaleX:a.scaleX,scaleY:a.scaleY},500,d),!a.anchor||.5!==a.anchor.x||.5!==a.anchor.y){var h={x:a.x-b*g.width/2,y:a.y-b*g.height/2};e.get(a).to({x:h.x,y:h.y},500,c).to({x:a.x,y:a.y},500,d)}}},i.follow=function(a,b){return a?(this.incorner=!1,this.following=a,void(this.pointfrom=b)):void(this.following=null)},i.setblink=function(){this.nextblink=100+parseInt(200*Math.random()),this.animatedparts.push([this.glasses,this.glasses.blinkframes.copy()])},i.setmouth=function(a){null!==a&&void 0!==a&&this.mouth.gotoAndStop(a)},i.update=function(){if(this.talking&&this.syncarray&&(this.voplayer.playing=!0,this.vopos=this.voplayer.getElapsed()/this.voplayer.currentDuration,this.setmouth(this.syncarray[parseInt(this.vopos*this.syncarray.length)])),this.animatedparts.length>0){for(var a=this.animatedparts.length-1,b=a;b>=0;b--){var c=this.animatedparts[b][0],d=this.animatedparts[b][1].shift();c.gotoAndStop(d),this.animatedparts[b][1].length<1&&this.animatedparts.splice(b,1)}this.nextblink--,this.nextblink<0&&this.setblink()}this.following&&this.pointat(this.following,0,this.pointfrom)},i.makemoves=function(a){if(a){var b,c,d;this.nextmoves=[],this.movetimers=[];var e=this;for(var f in a){var g=a[f];if(b=0===g.duration?0:g.duration?g.duration:this.defaultduration,g.corner)d="corner";else if(g.object){var h=g.object.split(".");d=g.object;var i=this.itempath;for(var j in h)i=i[h[j]];d=i,g.pointerspot&&(d.pointerspot=g.pointerspot)}else g.point&&(d=g.point);c=g.start?g.start:0,loc=g.location?g.location:"auto",this.nextmoves.push([d,b,loc]),this.movetimers.push(app.setTimeout(e.nextmove,c))}}},i.nextmove=function(){if(this.nextmoves&&!(this.nextmoves.length<1)){var a=this.nextmoves.shift();if("corner"===a[0])this.backtocorner(a[1]);else{this.follow(!1),this.pointat(a[0],a[1],a[2]);var b=this;app.setTimeout(function(){b.pulseitem(a[0])},a[1])}}},i.makeevents=function(a){if(a){var b,c,d;this.nextevents=[],this.eventtimers=[];var e=this;for(var f in a){var g=a[f];c=g.start?g.start:0,d=g.name?g.name:"event",g.hasOwnProperty("data")&&(b=g.data),this.nextevents.push([d,b]),this.eventtimers.push(app.setTimeout(e.nextevent,c))}}},i.nextevent=function(){if(this.nextevents&&!(this.nextevents.length<1)){var a=this.nextevents.shift();this.events.trigger(a[0],a[1])}},i.audioend=function(){this.talking=!1,this.events.trigger("audioend"),this.trackFeedback&&(this.trackFeedback(this.audiofile,"audio",!0),this.trackFeedback=null)},h.spritedef={images:["ruffpointer_atlas"],frames:[[1,1,131,131,0,0,0],[1,134,121,121,0,0,0],[124,134,94,94,0,0,0],[124,230,32,22,0,0,0],[158,230,32,22,0,0,0],[192,230,32,22,0,0,0],[220,1,32,22,0,0,0],[220,25,32,20,0,0,0],[220,47,32,20,0,0,0],[220,69,32,20,0,0,0],[220,91,32,19,0,0,0],[134,112,32,19,0,0,0],[168,112,26,19,0,-3,0],[196,112,32,18,0,0,0],[220,132,32,18,0,0,0],[220,152,32,17,0,0,0],[220,171,32,17,0,0,0],[220,190,32,16,0,0,0],[220,208,26,18,0,-4,0],[230,112,13,13,0,-10,-3],[226,228,17,10,0,-15,0],[226,240,13,12,0,-10,-3],[134,1,32,15,0,0,0],[168,1,32,14,0,0,0],[168,17,32,14,0,0,0],[134,18,32,14,0,0,0],[168,33,32,13,0,0,0],[134,34,32,13,0,0,0],[168,48,32,13,0,0,0],[134,49,32,12,0,0,0],[134,63,32,11,0,0,0],[168,63,32,11,0,0,0],[134,76,32,9,0,0,0],[134,87,30,9,0,-1,0],[134,98,31,8,0,-1,0],[166,87,30,8,0,-2,0]],animations:{pointer:{frames:[1,0]},ruff:{frames:[2]},happymouth:{frames:[33,22,7,3,12,19,30,8,15,4,26,27,28,32,20,9,13]},sadmouth:{frames:[34,23,10,5,18,21,31,14,17,6,24,25,29,35,11,16]}}},namespace("WGBH.createjs").RuffPointer=h}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=include("wgbh.goalUI"),e=include("wgbh.ImagePaint"),f=include("wgbh.SwatchSelect"),g=function(b){this.gamestate=b,a.call(this)},h=a.prototype,i=extend(g,a);i.setup=function(){this.gameData=this.gamestate.app.config.gamedata,this.gameSettings=this.gameData.settings,this.rhinoX=25,this.rhinoY=225,this.sceneScale=.8,this.arr_buttons=[],this.background=new b(images.Draw_BG),this.addChild(this.background),this.scalingContainer=new c,this.addChild(this.scalingContainer),this.rhinoShadow=new b(images.Rhino_Shadow),this.rhinoShadow.scaleX=this.rhinoShadow.scaleY,this.rhinoShadow.x=this.rhinoX,this.rhinoShadow.y=this.rhinoY-135,this.scalingContainer.addChild(this.rhinoShadow),this.drawContainer=new c,this.scalingContainer.addChild(this.drawContainer),this.drawContainer.scaleX=this.drawContainer.scaleY=this.sceneScale,this.materialContainer=new c,this.materialContainer.x=this.rhinoX,this.materialContainer.y=this.rhinoY,this.drawContainer.addChild(this.materialContainer),this.drawElement=new e(this,this.gamestate,images.RhinoImg,this.gameSettings.brushSize),this.drawElement.x=this.rhinoX,this.drawElement.y=this.rhinoY,this.drawContainer.addChild(this.drawElement),this.rhinoOutline=new b(images.Rhino_Outline),this.rhinoOutline.x=this.rhinoX,this.rhinoOutline.y=this.rhinoY,this.drawContainer.addChild(this.rhinoOutline),this.Rhino_Mouth_Rest=new b(images.Rhino_Mouth_Rest),this.Rhino_Mouth_Rest.x=this.rhinoX,this.Rhino_Mouth_Rest.y=this.rhinoY,this.drawContainer.addChild(this.Rhino_Mouth_Rest);this.drawContainer.getBounds();this.shelf=new b(images.shelf),this.shelf.y=768-this.shelf.image.height*this.sceneScale,this.shelf.x=512-.95*this.shelf.image.width/2,this.shelf.scaleX=this.shelf.scaleY=.95,this.scalingContainer.addChild(this.shelf),this.swatchElement=new f(this,this.gameData),this.scalingContainer.addChild(this.swatchElement),this.arr_buttons.push(this.swatchElement),this.UIContainer=new c,this.addChild(this.UIContainer),this.chartButtonContainer=new c,this.UIContainer.addChild(this.chartButtonContainer),this.chartButton=new wgbh.BitmapButton(images.Chart_Button,images.Chart_Button_Down,images.Chart_Button_Down),this.chartButton.scaleX=this.chartButton.scaleY=this.sceneScale,this.chartButton.x=-150,this.chartButton.y=660,this.arr_buttons.push(this.chartButton),this.chartButtonContainer.addChild(this.chartButton),this.chartButton.cursor="pointer",this.blossomContainer=new c,this.nextBlossom=new wgbh.BitmapButton(images.NextBlossom,images.NextBlossom_over,images.NextBlossom_over),this.nextBlossom.scaleX=this.nextBlossom.scaleY=this.sceneScale,this.nextBlossom.x=1280,this.nextBlossom.y=768-this.nextBlossom.getBounds().height*this.sceneScale,this.arr_buttons.push(this.nextBlossom),this.blossomContainer.addChild(this.nextBlossom),this.UIContainer.addChild(this.blossomContainer),this.nextBlossom.cursor="pointer",this.goalUI=new d(this),this.goalUI.scaleX=this.goalUI.scaleY=this.sceneScale,this.goalUI.y=250,this.goalUI.x=825,this.scalingContainer.addChild(this.goalUI),this.ruffPointer=new WGBH.createjs.RuffPointer,this.promptContainer=new c,this.promptLayer=new c,this.popupContainer=new c,this.addChild(this.popupContainer),this.skipButtonContainer=new c,this.addChild(this.skipButtonContainer),this.menuButton=new wgbh.BitmapButton(images.button_home,images.button_home_down,images.button_home_over,"hop5"),this.addChild(this.menuButton)},i.toggleButtons=function(a){for(var b=0;b<this.arr_buttons.length;b++)a?this.arr_buttons[b].mouseEnabled=!0:this.arr_buttons[b].mouseEnabled=!1},i.teardown=function(){h.teardown.call(this),this.skin=null},namespace("wgbh").GamePanel=g}(),function(){var a=include("springroll.easeljs.BasePanel"),b=function(){a.call(this)},c=a.prototype,d=extend(b,a);d.setup=function(){this.intro=new wgbh.LevelIntro,this.addChild(this.intro),this.skipButton=new wgbh.BitmapButton(images.Skip_Button,images.Skip_Button_Over,images.Skip_Button_Over),this.skipButton.x=800,this.skipButton.y=650,this.skipButton.cursor="pointer",this.addChild(this.skipButton)},d.teardown=function(){c.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").IntroPanel=b}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.scalingContainer=new c,this.addChild(this.scalingContainer),this.scalingContainer.x=-170.5,this.arr_backgrounds=[],this.arr_buttonTrays=[];for(var a=0;4>a;a++){var d=new b(images.Menu_BG);d.x=a*d.image.width,this.arr_backgrounds.push(d);var e=new c;this.arr_buttonTrays.push(e)}this.scrollContainer=new c,this.bgContainer=new c,this.buttonContainer=new c,this.decorContainer=new c,this.buttonTray=new c,this.arrowTray=new c;var f;app.config.gamedata.menuDecor.forEach(function(a){f=new createjs.Bitmap(images[a.image]),f.x=a.posX,f.y=a.posY,this.decorContainer.addChild(f)}.bind(this)),this.rhino=new wgbh.RhinoRun,this.decorContainer.addChild(this.rhino),this.leftArrow=new wgbh.BitmapButton(images.Menu_Arrow_Left,images.Menu_Arrow_Left_down,images.Menu_Arrow_Left_over,"hop5"),this.rightArrow=new wgbh.BitmapButton(images.Menu_Arrow_Right,images.Menu_Arrow_Right_down,images.Menu_Arrow_Right_over,"hop5"),this.leftArrow.regX=this.leftArrow.regY=this.leftArrow.getBounds().width/2,this.rightArrow.regX=this.rightArrow.regY=this.rightArrow.getBounds().width/2,this.leftArrow.cursor="pointer",this.rightArrow.cursor="pointer",this.arrowTray.addChild(this.leftArrow,this.rightArrow),this.scalingContainer.addChild(this.scrollContainer),this.scrollContainer.addChild(this.bgContainer),this.scrollContainer.addChild(this.buttonContainer),this.scrollContainer.addChild(this.decorContainer),this.addChild(this.arrowTray)},f.teardown=function(){e.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").MenuPanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=function(){a.call(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.ruff=new b(images.ruff_reg),this.ruff.x=500,this.ruff.y=300,this.addChild(this.ruff)},e.teardown=function(){d.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").OutroPanel=c}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.background=new b(images.Test_BG),this.addChild(this.background),this.scalingContainer=new c,this.addChild(this.scalingContainer),this.wallContainer=new c,this.addChild(this.wallContainer),this.wallLeft=new b(images.wall_left),this.wallRight=new b(images.wall_right),this.wallLeft.x=-365,this.wallRight.x=1125,this.wallContainer.addChild(this.wallRight,this.wallLeft),this.popupContainer=new c,this.addChild(this.popupContainer),this.blossomShadow=new b(images.blossom_shadow),this.blossomShadow.x=900,this.blossomShadow.y=505,this.scalingContainer.addChild(this.blossomShadow),this.blossom=new wgbh.Blossom,this.blossom.x=950,this.blossom.y=300,this.blossom.scaleX=this.blossom.scaleY=.8,this.scalingContainer.addChild(this.blossom),this.payoffContainer=new c,this.payoffBG=new b(images.payoff_bg),this.payoffBG.x=-170.5,this.payoffContainer.addChild(this.payoffBG),this.menuButton=new wgbh.BitmapButton(images.button_home,images.button_home_down,images.button_home_over,"hop5"),this.addChild(this.menuButton),this.menuButton.x=150,this.menuButton.y=10,this.skipButtonContainer=new c,this.addChild(this.skipButtonContainer),this.ruffPointer=new WGBH.createjs.RuffPointer,this.addChild(this.ruffPointer)},f.teardown=function(){e.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").TestPanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=function(){a.call(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.background=new b(images.Background),this.addChildAt(this.background,0),this.playButton=new wgbh.BitmapButton(images.StartButton,images.StartButton_Over,images.StartButton_Over),this.addChild(this.playButton),this.playButton.cursor="pointer"},e.teardown=function(){d.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").TitlePanel=c}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("wgbh.GamePanel"),c=include("createjs.Tween"),d=include("wgbh.MaterialChart"),e=function(c){a.call(this,new b(this),c)},f=extend(e,a);f.onAssetsLoaded=function(){this.gameData=this.app.config.gamedata,this.levelData=this.gameData.levels[this.gameData.levelling.currentLevel],this.goalUI=this.panel.goalUI,this.nextBlossom=this.panel.nextBlossom,this.chartButton=this.panel.chartButton,this.testChamber=this.panel.testChamber,this.chartElement=new d(this.panel,this),this.swatchElement=this.panel.swatchElement,this.stageTwoBegin=this.stageTwoBegin.bind(this),this.showChart=this.showChart.bind(this),this.nextBlossom.addEventListener("mousedown",this.stageTwoBegin),this.chartButton.addEventListener("mousedown",this.showChart),this.panel.background.addEventListener("mousedown",function(a){app.trackstrayclick(a)}),this.panel.menuButton.addEventListener("mousedown",function(){this.trackMenu(),this.previousState()}.bind(this)),this.arr_Drawn=[],this.goalUI.updateText(),this.beginDraw(),this.drawIdleUpdate=this.drawIdleUpdate.bind(this),this.idleTime=25e3},f.enterDone=function(){this.gameData.workingVariables.passSelectedMaterial&&(this.swatchElement.selectMaterial(),this.gameData.workingVariables.passSelectedMaterial=null),this.triedAllFired=!1,app.on("update",this.drawIdleUpdate),this.setIdleType("none")},f.introComplete=function(){this.ruffPointer.backtocorner(),this.introVOPlaying=!1,this.chartElement.checkForData()&&c.get(this.chartButton).to({x:0},500).wait(250).call(function(){this.gameData.tutorial.chartButtonTriggered||(this.gameData.tutorial.chartButtonTriggered=!0,this.ruffPointer.saythings(["tap-table","table-definition"],this.ruffPointer.backtocorner.bind(this.ruffPointer),this.trackinstruction.bind(this)),this.ruffPointer.pointat(this.chartButton.localToGlobal(75,0),500,this.ruffPointer.N))}.bind(this))},f.drawIdleUpdate=function(a){this.drawIdleActive&&(this.idleTime-=a,this.idleTime<=0&&(this.idlePrompt(this.idleType),this.idleTime=25e3))},f.setIdleType=function(a){this.idleType=a,this.idleTime=25e3},f.idlePrompt=function(a){if(this.idleChart)return void this.ruffPointer.saythings("table-testmore",null,this.trackinstruction.bind(this));switch(a){case"none":this.ruffPointer.saythings("draw-idle",null,this.trackinstruction.bind(this));break;case"selected":this.ruffPointer.saythings("draw-cover",null,this.trackinstruction.bind(this));break;case"drawn":this.ruffPointer.saythings("draw-needmore",null,this.trackinstruction.bind(this))}},f.hasDrawnWith=function(){var a=!1;this.arr_Drawn.forEach(function(b){b==this.currentMaterial&&(a=!0)}.bind(this)),a||this.arr_Drawn.push(this.currentMaterial),this.arr_Drawn.length!=this.levelData.materialSelection.length||this.triedAllFired||(this.ruffPointer.saythings("draw-tried-all",null,this.trackinstruction.bind(this)),this.triedAllFired=!0)},f.beginDraw=function(){this.addTestProp(),this.toggleNext(!1),this.drawIdleActive=!1,app.ROUNDACTIVE||(this.trackstartround(),app.MISSES=0),this.gameData.workingVariables.passSelectedMaterial?this.drawIntro():(this.levelIntro=new wgbh.LevelIntro(this.levelData,this.drawIntro.bind(this)),this.panel.popupContainer.addChild(this.levelIntro),this.levelIntro.show())},f.drawIntro=function(){this.ruffPointer=this.panel.ruffPointer,this.panel.UIContainer.addChild(this.ruffPointer),this.drawIdleActive=!0,this.setIdleType("none"),c.get(this).wait(1e3).call(this.doChetAnim.bind(this)),this.introVOPlaying=!0,this.gameData.tutorial.tutorialActive?(this.introIndex=0,this.arr_intro=["draw-intro-new","draw-material-definition"],this.ruffPointer.pointat(this.panel.shelf.localToGlobal(105,-50)),this.ruffPointer.saythings(this.arr_intro,this.introComplete.bind(this),this.trackinstruction.bind(this))):(this.ruffPointer.saythings("lets-draw",null,this.trackinstruction.bind(this)),this.panel.toggleButtons(!0),c.get(this).wait(4500).call(this.introComplete))},f.doChetAnim=function(){var a,b=!1,c=this.levelData.correctAnswer[0].toLowerCase();"soak"==c&&(c="soaks up"),"float"==c&&(c="floats"),this.levelData.correctAnswer[1]&&(b=!0,a=this.levelData.correctAnswer[1].toLowerCase(),"soak"==a&&(a="soaks up"),c=c+" and \n"+a),this.chet=new wgbh.Chet(c,b,!1,this),this.panel.scalingContainer.addChild(this.chet),this.chetActive=!0},f.showChart=function(a){this.chetActive||(this.chartElement.generateChart(),this.chartElement.show(),app.trackevent("toggleChart",{idorder:["round_name","coordinates","action","chart_contents"],
round_name:app.ROUNDNAME,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},action:"open",chart_contents:app.CHARTCONTENTS}),this.idleChart=!0)},f.addTestProp=function(){for(var a=0;a<this.levelData.correctAnswer.length;a++){var b=this.levelData.correctAnswer[a],c=!0;if(this.gameData.testedProperties[0])for(var d=0;d<this.gameData.testedProperties.length;d++)this.gameData.testedProperties[d]==b&&(c=!1);c&&this.gameData.testedProperties.push(b)}},f.toggleNext=function(a){this.nextBlossom.removeEventListener("mousedown",this.stageTwoBegin),a?(this.drawIdleActive=!1,this.nextActive=!0,c.get(this.nextBlossom).to({x:904},300,createjs.Ease.quadOut),this.nextBlossom.addEventListener("mousedown",this.stageTwoBegin)):(this.drawIdleActive=!0,this.nextActive=!1,c.get(this.nextBlossom).to({x:1024},300,createjs.Ease.quadIn),this.nextBlossom.removeEventListener("mousedown",this.stageTwoBegin))},f.stageTwoBegin=function(a){var b={};b[this.swatchElement.material.name]=this.swatchElement.material.properties;var c={};c[this.levelData.correctMaterial]=this.gameData.materials[this.levelData.correctMaterial];var d=!1;this.swatchElement.material.name==this.levelData.correctMaterial&&(d=!0),app.trackevent("submitAnswer",{idorder:["round_name","coordinates","material","correct","painted"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},material:b,correct:d,painted:!0}),this.drawIdleActive=!1,app.off("update",this.drawIdleUpdate),app.voPlayer.stop(),this.panel.drawElement.enableDraw(!1),this.manager.state="test",this.chartButton.x=-150},f.exitStart=function(){app.off("update",this.drawIdleUpdate),this.drawIdleActive=!1},f.trackMenu=function(){app.trackevent("exitToMenu",{idorder:["duration","misses","round_name"],duration:app.learning.stopTimer("round"),misses:app.MISSES,round_name:app.ROUNDNAME}),app.ROUNDACTIVE=!1},f.trackstartplaymode=function(){app.learning.startTimer("play"),app.trackevent("startPlayMode",{idorder:["kid","coords"],kid:this.roundid,coords:{x:0,y:0}})},f.trackstartround=function(){app.learning.startTimer("round"),app.ROUNDACTIVE=!0;for(var a=[],b=0;b<this.levelData.materialSelection.length;b++){var c=this.levelData.materialSelection[b],d=this.gameData.materials[c],e=d.properties,f=d.name,g={};g[f]=e,a.push(g)}var h=this.levelData.correctAnswer[0];app.ROUNDNAME=h,this.levelData.correctAnswer[1]&&(h+=this.levelData.correctAnswer[1]),app.trackevent("startRound",{idorder:["materials","correct_material","round_name"],materials:a,correct_material:this.levelData.correctAnswer,round_name:h})},f.trackclickhome=function(a){var b=0;app.learning.stopTimer("round"),a&&(b=app.learning.stopTimer(a)),app.trackevent("clickHome",{idorder:["kid","duration","mode"],kid:this.roundid,duration:b,mode:a})},f.trackhint=function(a,b){app.trackevent("clickHelp",{idorder:["coordinates","kid","help_type"],kid:this.roundid,coordinates:b,help_type:a})},f.getfeedbackinfo=function(a){var b=(app.captions.data[a],5),c="description";return{duration:b,description:c}},f.getfeedbacktrackobject=function(a,b){var c=this.getfeedbackinfo(a);return{media_type:b,total_duration:1e3,description:c.description,identifier:a,custom:{round_name:app.ROUNDNAME},idorder:["description","identifier","media_type","total_duration","custom"]}},f.trackcorrectfeedback=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endCorrectFeedback",d)):(app.learning.startTimer("talking"),app.trackevent("startCorrectFeedback",d))},f.trackincorrectfeedback=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endIncorrectFeedback",d)):(app.learning.startTimer("talking"),app.trackevent("startIncorrectFeedback",d))},f.trackinstruction=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endInstruction",d)):(app.learning.startTimer("talking"),app.trackevent("startInstruction",d))},namespace("wgbh").GameState=e}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("createjs.Tween"),c=include("wgbh.IntroPanel"),d=function(b){a.call(this,new c,b),this.onPlay=this.onPlay.bind(this)},e=extend(d,a);e.enterDone=function(){this.panel.intro.addEventListener("mousedown",function(a){app.trackstrayclick(a)}),this.panel.intro.removeAllEventListeners(),b.get(this).wait(1e3).call(function(){this.panel.intro.playIntroAudio("game-intro",function(){this.panel.intro.playIntroAudio("game-intro-mission",this.onPlay.bind(this))}.bind(this))}.bind(this)),this.panel.skipButton.addEventListener("mousedown",this.onPlay.bind(this))},e.onPlay=function(){app.voPlayer.stop(),this.nextState()},e.exit=function(){this.panel.intro.removeEventListener("click",this.onPlay)},namespace("wgbh").IntroState=d}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("wgbh.MenuPanel"),c=include("springroll.Sound"),d=include("createjs.Tween"),e=function(c){a.call(this,new b,c),this.onSelectLevel=this.onSelectLevel.bind(this),this.scrollRight=this.scrollRight.bind(this),this.scrollLeft=this.scrollLeft.bind(this)},f=extend(e,a);f.onAssetsLoaded=function(){this.gameData=this.app.config.gamedata,this.levels=this.gameData.levels,this.arr_backgrounds=this.panel.arr_backgrounds,this.arr_buttonTrays=this.panel.arr_buttonTrays,this.scrollContainer=this.panel.scrollContainer,this.leftArrow=this.panel.leftArrow,this.rightArrow=this.panel.rightArrow,this.rightArrow.addEventListener("mousedown",this.scrollRight),this.leftArrow.addEventListener("mousedown",this.scrollLeft),this.menuIndex=this.gameData.workingVariables.menuScrollState,0===this.menuIndex?this.leftArrow.disable():1!==this.leftArrow.alpha&&this.leftArrow.enable(),3===this.menuIndex?this.rightArrow.disable():1!==this.rightArrow.alpha&&this.rightArrow.enable(),this.levelButtons=[],this.initButtons()},f.enter=function(){},f.enterDone=function(){this.panel.bgContainer.addEventListener("mousedown",function(a){app.trackstrayclick(a)}),app.hints.enabled=!0,app.hints.vo("menu-choose-alt-2"),app.hints.startTimer(15e3),0===this.menuIndex?this.leftArrow.disable():1!==this.leftArrow.alpha&&this.leftArrow.enable(),3===this.menuIndex?this.rightArrow.disable():1!==this.rightArrow.alpha&&this.rightArrow.enable(),this.gameData.workingVariables.menuReturning?(app.voPlayer.play(["menu-welcome","menu-choose-alt-2"]),this.gameData.workingVariables.menuReturning=!1):this.gameData.workingVariables.menuVisited?app.voPlayer.play(["menu-choose-alt-2"]):app.voPlayer.play("menu-choose-alt"),this.rhinoTimer()},f.rhinoTimer=function(){d.get(this).wait(8e3).call(this.doRhino.bind(this))},f.doRhino=function(){var a=1e4;this.panel.rhino.animate(!0),this.panel.rhino.go(a),d.get(this).wait(a).call(function(){this.panel.rhino.animate(!1),this.rhinoTimer()}.bind(this))},f.initButtons=function(){for(var a=!0,b=0;10>b;b++)this.levels[b].levelComplete||(a=!1);if(a)for(b=10;b<this.levels.length;b++)this.levels[b].locked=!1;for(var c=0;c<this.levels.length;c++){this.levels[c].menuImage;newButton=new wgbh.MenuButton(this.levels[c],c,this.refreshMenu.bind(this,!0)),newButton.selectID=c,this.levelButtons.push(newButton)}this.toggleButtons(!0)},f.refreshMenu=function(a){if(this.currentBG){this.nextBG=this.arr_backgrounds[this.menuIndex],this.panel.bgContainer.addChild(this.nextBG);var b;b=a?0:750,d.get(this.scrollContainer).to({x:-1*this.nextBG.x},b,createjs.Ease.quadInOut).call(function(){this.panel.scrollContainer.removeChild(this.currentBG),this.currentBG=this.nextBG,this.nextBG=null,this.prevIndex&&this.arr_buttonTrays[this.prevIndex].removeAllChildren(),this.scrolling=!1}.bind(this))}else this.currentBG=this.arr_backgrounds[this.menuIndex],this.panel.bgContainer.addChild(this.currentBG);for(var c,e=4*this.menuIndex,f=e+4,g=0,h=e;f>h;h++)c=this.levelButtons[h],c.x=334*g+35*g,g>=2&&(c.x=334*(g-2)+45*(g-2),c.y=245),this.arr_buttonTrays[this.menuIndex].addChild(c),g++;this.arr_buttonTrays[this.menuIndex].x=1365*this.menuIndex+326,this.arr_buttonTrays[this.menuIndex].y=175,this.panel.buttonContainer.addChild(this.arr_buttonTrays[this.menuIndex])},f.scrollRight=function(a){this.scrolling||(this.menuIndex<3&&(this.scrolling=!0,this.prevIndex=this.menuIndex,this.menuIndex++,this.refreshMenu(),c.instance.play("hop5")),this.updateArrows(),app.trackevent("clickedMenuArrow",{idorder:["round_name","coordinates","direction","new_level"],round_name:"NA",coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},direction:"right",new_level:this.menuIndex}))},f.scrollLeft=function(a){this.scrolling||(this.menuIndex>0&&(this.scrolling=!0,this.prevIndex=this.menuIndex,this.menuIndex--,this.refreshMenu(),c.instance.play("hop5")),this.updateArrows(),app.trackevent("clickedMenuArrow",{idorder:["round_name","coordinates","direction","new_level"],round_name:"NA",coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},direction:"left",new_level:this.menuIndex}))},f.updateArrows=function(){3==this.menuIndex?this.rightArrow.disable():1!==this.rightArrow.alpha&&this.rightArrow.enable(),0===this.menuIndex?this.leftArrow.disable():1!==this.leftArrow.alpha&&this.leftArrow.enable()},f.onSelectLevel=function(a){this.gameData.workingVariables.menuVisited=!0,this.gameData.workingVariables.menuScrollState=this.menuIndex;var b,c=a.currentTarget.selectID,d=!1;this.levels[c].locked?(app.voPlayer.play("menu-locked-alt"),d=!0):(this.toggleButtons(!1),this.gameData.levelling.currentLevel=c,b="level-title-"+this.gameData.levels[c].titleString,app.voPlayer.play(b,function(){this.nextState()}.bind(this))),app.trackevent("clickedLevel",{idorder:["round_name","coordinates","unlocked"],round_name:this.gameData.levels[c].titleString,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},unlocked:d}),app.hints.stopTimer(),app.hints.enabled=!1},f.toggleButtons=function(a){for(var b=0;b<this.levelButtons.length;b++)a?this.levelButtons[b].addEventListener("mousedown",this.onSelectLevel):this.levelButtons[b].removeAllEventListeners()},f.exit=function(){d.removeAllTweens()},namespace("wgbh").MenuState=e}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("wgbh.OutroPanel"),c=function(c){a.call(this,new b,c),this.onPlay=this.onPlay.bind(this)},d=extend(c,a);d.enterDone=function(){this.panel.ruff.addEventListener("click",this.onPlay)},d.onPlay=function(){this.nextState()},d.exit=function(){this.panel.ruff.removeEventListener("click",this.onPlay)},namespace("wgbh").OutroState=c}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("createjs.Tween"),c=include("createjs.Bitmap"),d=include("wgbh.TestPanel"),e=function(b){a.call(this,new d,b)},f=extend(e,a);f.onAssetsLoaded=function(){this.gameData=this.app.config.gamedata,this.levelData=this.gameData.levels[this.gameData.levelling.currentLevel],this.currentMaterial=this.gameData.materials[this.gameData.workingVariables.materialSelectID],this.startAuxDrag=this.startAuxDrag.bind(this),this.auxDrag=this.auxDrag.bind(this),this.endAuxDrag=this.endAuxDrag.bind(this),this.performTest=this.performTest.bind(this),this.chartElement=new wgbh.MaterialChart(this.panel,this),this.testPhase=0,this.promptPayoff=this.promptPayoff.bind(this),this.checkAnswer(),this.addTestContainer(),this.ruffPointer=this.panel.ruffPointer},f.enterDone=function(){this.updateData(),this.checkAnswer(),this.testIntro(),this.panel.background.addEventListener("mousedown",function(a){app.trackstrayclick(a)}),this.panel.menuButton.addEventListener("mousedown",this.returnToMenu.bind(this))},f.updateData=function(){this.testID=this.gameData.properties[this.levelData.correctAnswer[this.testPhase]].test,this.animationData=app.config.animationdata[this.testID]},f.enableTest=function(a){this.updateData(),a?this.animationData.interactiveDrag?this.TestContainer.auxiliary.addEventListener("mousedown",this.startAuxDrag):this.TestContainer.addEventListener("mousedown",this.performTest):this.animationData.interactiveDrag?this.TestContainer.auxiliary.removeEventListener("mousedown",this.startAuxDrag):this.TestContainer.removeEventListener("mousedown",this.performTest)},f.testIntro=function(){this.panel.addChild(this.ruffPointer);var a,c;a=this.gameData.tutorial.firstTestComplete?["test-whatdoyouthink","test-whatdoyoupredict"]:["test-intro","test-whatdoyouthink","test-whatdoyoupredict"];var d=Math.floor(a.length*Math.random());c=this.levelData.correctAnswer.length>1?"test-property"+(this.testPhase+1):a[d];var e="test-prompt-"+this.levelData.correctAnswer[this.testPhase].toLowerCase();this.ruffPointer.saythings(c,function(){b.get(this).wait(1e3).call(function(){this.testPerformed||this.ruffPointer.saythings(e),app.hints.enabled=!0,app.hints.func(this.idleHint.bind(this)),app.hints.startTimer(1e4),this.propertyString=e}.bind(this))}.bind(this),this.trackinstruction.bind(this)),this.doChetAnim(),this.gameData.tutorial.firstTestComplete=!0},f.idleHint=function(){this.testPerformed||this.ruffPointer.saythings(this.propertyString),app.hints.enabled=!0},f.doChetAnim=function(){var a=this.currentMaterial.name.toLowerCase();this.currentMaterial.altName&&(a=this.currentMaterial.altName.toLowerCase()),this.chet=new wgbh.Chet(a,!1,!0),this.panel.scalingContainer.addChild(this.chet)},f.startAuxDrag=function(a){this.TestContainer.auxiliary.gotoAndStop(this.TestContainer.auxiliary.spriteSheet._animations[0]),this.aux=this.TestContainer.auxContainer,this.aux.removeEventListener("mousedown",this.startAuxDrag),this.aux.addEventListener("pressup",this.endAuxDrag),this.aux.addEventListener("pressmove",this.auxDrag),this.lastX=a.rawX,this.animationData.isJuice||this.performTest(a)},f.auxDrag=function(a){this.changeX=a.rawX-this.lastX;var b=this.aux.x+this.changeX*(1280/app.realWidth);300>b&&b>-300&&(this.aux.x=b),this.lastX=a.rawX},f.endAuxDrag=function(a){this.lastX=null,this.animationData.isJuice&&this.performTest(a);var b=this.animationData.isJuice&&this.propertyCorrect;this.TestContainer.stopDrag(b),this.aux.removeAllEventListeners(),this.aux.addEventListener("mousedown",this.startAuxDrag)},f.addTestContainer=function(){this.TestContainer&&this.TestContainer.parent&&this.TestContainer.parent.removeChild(this.TestContainer),this.updateData(),this.checkAnswer(),this.TestContainer=new wgbh.TestContainer(this,this.enableTest.bind(this)),"pool"==this.testID&&(this.panel.addChild(this.panel.blossom),this.TestContainer.x-=25),this.panel.scalingContainer.addChild(this.TestContainer)},f.performTest=function(a){app.trackevent("startTest",{idorder:["round_name","coordinates","correct"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height},correct:!0}),this.TestContainer.playAnimations(),this.TestContainer.startDrag(),this.enableTest(!1),this.testPerformed?b.get(this).wait(3e3).call(this.enableTest.bind(this,!0)):(this.testPerformed=!0,this.updateTestResults(),b.get(this).wait(3e3).call(function(){this.doPrompt(this.propertyCorrect)}))},f.checkAnswer=function(){this.propertyCorrect=!1;var a=this.levelData.correctAnswer[this.testPhase];for(i=0;i<this.currentMaterial.properties.length;i++)this.currentMaterial.properties[i]==a&&(this.propertyCorrect=!0)},f.updateTestResults=function(){var a=this.levelData.correctAnswer[this.testPhase],b=!0;if(b=!0,this.currentMaterial.tested[0])for(var c=0;c<this.currentMaterial.tested.length;c++)this.currentMaterial.tested[c]==a&&(b=!1);b&&(this.currentMaterial.tested.push(a),this.currentMaterial.newTest.push(!1))},f.doPrompt=function(){this.prompt=new wgbh.RecordPrompt(this,this.panel),this.prompt.doPrompt(this.propertyCorrect),this.panel.scalingContainer.addChild(this.prompt),app.hints.enabled=!0,app.hints.vo("tap-button-document"),app.hints.startTimer(12e3),this.retest=!0,this.enableTest(!0)},f.promptPayoff=function(a,c,d){app.trackevent("selectYesNo",{idorder:["round_name","coordinates","correct","selection","prompt"],round_name:app.ROUNDNAME,coordinates:{x:parseInt(d.stageX),y:parseInt(d.stageY),stage_width:app.display.width,stage_height:app.display.height},correct:!1,selection:"selection",prompt:c}),app.hints.stopTimer(),this.prompt.killTweens(),this.prompt.parent.removeChild(this.prompt),this.propertyCorrect?this.panel.blossom.yes():this.panel.blossom.no(),b.get(this).wait(3e3).call(function(){this.chartElement.chartPayoff(this.setAnswer.bind(this)),this.chartElement.show(),this.ruffPointer.parent.removeChild(this.ruffPointer),this.panel.menuButton.disable(),this.panel.menuButton.removeAllEventListeners()}.bind(this))},f.setAnswer=function(){this.testPhase<this.levelData.correctAnswer.length-1?(this.propertyCorrect||(this.twoStageFail=!0),this.testPhase++,this.updateData(),this.retest=!1,this.testPerformed=!1,this.restartTest()):!this.propertyCorrect||this.twoStageFail?this.testComplete(!1):this.twoStageFail||this.testComplete(!0)},f.restartTest=function(){this.updateData(),this.checkAnswer(),this.addTestContainer(),this.panel.blossom.backToIdle(),this.testIntro()},f.testComplete=function(a){this.testPerformed=!1,this.testPhase=0,this.twoStageFail=!1,a?(this.levelComplete=!0,this.gameData.levelling.failedLast=!1,this.loadPayoff()):(this.levelComplete=!1,this.gameData.levelling.failedLast=!0,app.MISSES++,this.resetLevel())},f.resetLevel=function(){this.manager.state="game"},f.loadPayoff=function(){var a=this.gameData.levelling.currentLevel+1,b="assets/images/payoff/payoff"+a+".png";app.load(b,function(a){this.payoffImage=new c(a),this.payoff()}.bind(this))},f.payoff=function(){f.trackbeatround(),this.gameData.tutorial.tutorialActive=!1,app.userData.write("tutorial",this.gameData.tutorial),this.TestContainer.destroy(),this.payoffImage.scaleX=this.payoffImage.scaleY=.9,this.payoffImage.x=512-this.payoffImage.image.width/2*.9,this.payoffImage.y=175,this.panel.payoffContainer.addChild(this.payoffImage),this.panel.scalingContainer.addChild(this.panel.payoffContainer);var a,b=["payoff-extra-greattime","payoff-extra-adventure","payoff-extra-bighelp","payoff-extra-petsitting"],c=b[Math.floor(4*Math.random())],d=this.levelData.correctAnswer;a=d[1]?"payoff-"+this.currentMaterial.name+"-"+d[0]+"-"+d[1]:"table-result-"+this.currentMaterial.name+"-"+d[0],a=a.toLowerCase(),this.ruffPointer.saythings([c,a],this.returnToMenu.bind(this),this.trackcorrectfeedback.bind(this)),this.levelData.levelComplete=!0;var e={};e.levels=this.gameData.levels,e.materials=this.gameData.materials,app.userData.write("savegame",e)},f.trackbeatround=function(){app.ROUNDACTIVE=!1,app.trackevent("endRound",{idorder:["duration","misses","round_unlocked","round_name"],duration:app.learning.stopTimer("round"),misses:app.MISSES,round_unlocked:"none",round_name:app.ROUNDNAME})},f.returnToMenu=function(){b.removeAllTweens(),this.testPerformed=!1,this.testPhase=0,this.twoStageFail=!1,this.manager.state="menu",this.trackMenu()},f.trackMenu=function(){app.trackevent("exitToMenu",{idorder:["duration","misses","round_name"],duration:app.learning.stopTimer("round"),misses:app.MISSES,round_name:app.ROUNDNAME}),app.ROUNDACTIVE=!1},f.getfeedbackinfo=function(a){var b=(app.captions.data[a],5),c="description";return{duration:b,description:c}},f.getfeedbacktrackobject=function(a,b){var c=this.getfeedbackinfo(a);return{media_type:b,total_duration:1e3,description:c.description,identifier:a,custom:{round_name:app.ROUNDNAME},idorder:["description","identifier","media_type","total_duration","custom"]}},f.trackcorrectfeedback=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endCorrectFeedback",d)):(app.learning.startTimer("talking"),app.trackevent("startCorrectFeedback",d))},f.trackincorrectfeedback=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endIncorrectFeedback",d)):(app.learning.startTimer("talking"),app.trackevent("startIncorrectFeedback",d))},f.trackinstruction=function(a,b,c){var d=this.getfeedbacktrackobject(a,b);c?(d.duration=app.learning.stopTimer("talking"),app.trackevent("endInstruction",d)):(app.learning.startTimer("talking"),app.trackevent("startInstruction",d))},f.exit=function(){},namespace("wgbh").TestState=e}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("wgbh.TitlePanel"),c=function(c){a.call(this,new b,c),this.onPlay=this.onPlay.bind(this)},d=extend(c,a);d.enterDone=function(){this.panel.background.addEventListener("mousedown",function(a){app.trackstrayclick(a)}),app.userData.read("savegame",function(a){a&&(app.config.gamedata.workingVariables.menuReturning=!0,a.levels&&(app.config.gamedata.levels=a.levels),a.materials&&(app.config.gamedata.materials=a.materials))}),app.voPlayer.play("game-title-A"),this.panel.playButton.addEventListener("click",this.onPlay),this.panel.background.addEventListener("buttonPress",this.onPlay),this.panel.background.cursor="pointer"},d.onPlay=function(a){app.trackevent("clickPlay",{idorder:["coordinates"],coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:app.display.width,stage_height:app.display.height}}),app.voPlayer.stop(),this.nextState()},d.exit=function(){this.panel.background.cursor=null,this.panel.background.removeEventListener("click",this.onPlay),this.panel.playButton.removeEventListener("click",this.onPlay)},namespace("wgbh").TitleState=c}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=include("springroll.Sound"),e=function(c){b.call(this),this.state=c,this.gameData=c.gameData,this.levelData=c.levelData,this.testPhase=c.testPhase,this.testID=this.gameData.properties[this.levelData.correctAnswer[this.testPhase]].test,this.animationData=app.config.animationdata[this.testID],this.animationData.shadow&&(this.rhinoShadow=new a(images.Rhino_Shadow),this.addChild(this.rhinoShadow),this.rhinoShadow.x=75,this.rhinoShadow.y=175),this.loadRhino(),this.testScale=1.28,this.x=-100},f=b.prototype,g=extend(e,b);g.loadRhino=function(){var a="assets/images/animations/"+this.testID+"/rhino/"+this.state.currentMaterial.name+".json";app.load(a,function(a){this.rhinoLoaded(a)}.bind(this))},g.rhinoLoaded=function(a){this.state.propertyCorrect?(this.rhinoType=this.animationData.rhino.success,this.SFX=this.animationData.SFX.success):(this.rhinoType=this.animationData.rhino.fail,this.SFX=this.animationData.SFX.fail);var b=this.SpritesheetEdit(a,"rhino");this.rhinoSpriteSheet=new createjs.SpriteSheet(b),this.rhino=new createjs.Sprite(this.rhinoSpriteSheet),this.rhino.scaleX=this.rhino.scaleY=this.testScale,this.rhino.gotoAndStop(this.rhino.spriteSheet._animations[0]),this.rhinoAnimIndex=0,this.animationData.props?this.loadProps():this.addSprites()},g.loadProps=function(){var a={},b="assets/images/animations/"+this.testID+"/props/";this.animationData.props.background&&(a.background=b+"background.json"),this.animationData.props.foreground&&(a.foreground=b+"foreground.json"),this.animationData.props.auxiliary&&(a.auxiliary=b+"auxiliary.json"),this.animationData.addZs&&(a.Z=b+"Zs.json"),app.load(a,function(a){this.propsLoaded(a)}.bind(this))},g.propsLoaded=function(a){var b;a.background&&(b=this.SpritesheetEdit(a.background,"props"),this.backgroundSpriteSheet=new createjs.SpriteSheet(b),this.background=new createjs.Sprite(this.backgroundSpriteSheet),this.background.scaleX=this.background.scaleY=this.testScale,this.background.framerate=this.animationData.props.background.framerate,"snow"==this.testID?this.background.gotoAndStop(2):this.background.gotoAndStop(0),this.animationData.props.background.fadeIn&&(this.background.alpha=0),this.animationData.props.background.loop||this.background.addEventListener("animationend",this.breakLoop.bind(this))),a.foreground&&(b=this.SpritesheetEdit(a.foreground,"props"),this.foregroundSpriteSheet=new createjs.SpriteSheet(b),this.foreground=new createjs.Sprite(this.foregroundSpriteSheet),this.foreground.scaleX=this.foreground.scaleY=this.testScale,this.foreground.framerate=this.animationData.props.foreground.framerate,this.foreground.gotoAndStop(this.foreground.spriteSheet._animations[0]),this.animationData.props.foreground.loop||this.foreground.addEventListener("animationend",this.breakLoop.bind(this))),a.auxiliary&&!this.state.propertyCorrect&&this.animationData.props.auxiliary[0].hideFail?this.hideAux=!0:this.hideAux=!1,a.auxiliary&&!this.hideAux&&(b=this.SpritesheetEdit(a.auxiliary,"props"),this.auxSpriteSheet=new createjs.SpriteSheet(b),this.auxiliary=new createjs.Sprite(this.auxSpriteSheet),this.auxiliary.scaleX=this.auxiliary.scaleY=this.testScale,this.auxiliary.gotoAndStop(this.auxiliary.spriteSheet._animations[0]),this.animationData.props.auxDogs&&(this.auxB=new createjs.Sprite(this.auxSpriteSheet),this.auxB.scaleX=this.auxB.scaleY=1,this.auxB.x=125,this.auxB.y=200,this.auxC=new createjs.Sprite(this.auxSpriteSheet),this.auxC.scaleX=-.75,this.auxC.scaleY=.75,this.auxC.x=1e3,this.auxC.y=300,this.auxDogs=[this.auxiliary,this.auxB,this.auxC]),this.animationData.props.auxiliary[0].fadeIn&&(this.auxiliary.alpha=0),this.animationData.props.auxiliary.loop||(this.auxiliary.addEventListener("animationend",this.breakLoop.bind(this)),this.auxDogs&&(this.auxB.addEventListener("animationend",this.breakLoop.bind(this)),this.auxC.addEventListener("animationend",this.breakLoop.bind(this))))),this.animationData.addZs&&this.state.propertyCorrect&&(b=this.SpritesheetEdit(a.Z,"props"),this.ZSpriteSheet=new createjs.SpriteSheet(b),this.Z=new createjs.Sprite(this.ZSpriteSheet),this.Z.visible=!1),this.auxAnimIndex=0,this.addSprites()},g.addSprites=function(){if(this.background&&this.addChild(this.background),this.addChild(this.state.panel.blossom),this.addChild(this.rhino),this.foreground&&this.addChild(this.foreground),this.auxiliary&&(this.auxContainer=new b,this.addChild(this.auxContainer),this.auxDogs?this.auxDogs.forEach(function(a){this.auxContainer.addChild(a)}.bind(this)):this.auxContainer.addChild(this.auxiliary)),this.Z&&this.auxContainer.addChild(this.Z),this.animationData.props&&this.animationData.props.auxDogs&&this.auxiliary.gotoAndPlay(this.auxiliary.spriteSheet._animations[0]),this.animationData.clickAnywhere){var a=new createjs.Graphics;a.beginFill("white"),a.drawRect(0,0,1280,800),this.hitbox=new createjs.Shape(a),this.hitbox.alpha=.01,this.addChild(this.hitbox)}this.doneLoading()},g.doneLoading=function(){this.state.enableTest(!0)},g.playAnimations=function(){var a;this.SFX&&(a="hose"==this.SFX?0:500),c.get(this).wait(a).call(function(){this.currentSFX&&this.currentSFX.stop(),this.currentSFX=d.instance.play(this.SFX)}.bind(this)),this.background&&(this.background.gotoAndPlay(this.background.spriteSheet._animations[0]),0===this.background.alpha&&c.get(this.background).to({alpha:1},500)),this.foreground&&this.foreground.gotoAndPlay(this.foreground.spriteSheet._animations[0]),this.auxiliary&&this.playAuxiliary(),this.playRhino()},g.playAuxiliary=function(){this.auxiliary&&(this.animationData.props.auxDogs&&(this.state.propertyCorrect?this.auxAnimIndex=2:this.auxAnimIndex=1),this.Z&&(this.Z.visible=!0,this.Z.framerate=10,this.Z.gotoAndPlay("chet_zzz")),this.auxiliary.removeAllEventListeners(),this.auxiliary.framerate=this.animationData.props.auxiliary[this.auxAnimIndex].framerate,this.auxDogs?this.auxDogs.forEach(function(a){a.framerate=this.animationData.props.auxiliary[this.auxAnimIndex].framerate,a.gotoAndPlay(this.auxiliary.spriteSheet._animations[this.auxAnimIndex])}.bind(this)):this.auxiliary.gotoAndPlay(this.auxiliary.spriteSheet._animations[this.auxAnimIndex]),this.animationData.props.auxiliary[this.auxAnimIndex].loop||(this.animationData.props.auxiliary[this.auxAnimIndex].next?this.auxiliary.addEventListener("animationend",this.nextAux.bind(this)):this.auxiliary.addEventListener("animationend",function(a){this.breakLoop(a,!0)}.bind(this))),0===this.auxiliary.alpha&&c.get(this.auxiliary).to({alpha:1},500))},g.playRhino=function(){this.rhino.removeAllEventListeners(),this.rhinoType[this.rhinoAnimIndex].loop?(this.rhino.addEventListener("animationend",this.loopCount.bind(this)),this.rhinoLoopCount=this.rhinoType[this.rhinoAnimIndex].loopCount):this.rhino.addEventListener("animationend",this.breakLoop.bind(this)),this.rhino.framerate=this.rhinoType[this.rhinoAnimIndex].framerate,this.rhino.gotoAndPlay(this.rhino.spriteSheet._animations[this.rhinoAnimIndex])},g.loopCount=function(){this.rhinoLoopCount&&(this.rhinoLoopCount--,this.rhinoLoopCount<=0&&(this.rhinoAnimIndex++,this.playRhino()))},g.breakLoop=function(a,b){var c=a.currentTarget;c.stop(),b||(this.rhinoAnimIndex>=this.rhinoType.length-1?this.resetAnimations():(this.rhinoAnimIndex++,this.playRhino()))},g.nextAux=function(){this.auxAnimIndex++,this.playAuxiliary()},g.startDrag=function(){this.auxAnimIndex=0,this.playAuxiliary()},g.stopDrag=function(a){this.currentSFX&&this.currentSFX.stop(),a?this.auxAnimIndex=3:this.auxAnimIndex=2,this.playAuxiliary()},g.resetAnimations=function(){this.rhinoAnimIndex=0,this.auxAnimIndex=0},g.SpritesheetEdit=function(a,b){var c=[];for(var d in a.images)c[d]="assets/images/animations/"+this.testID+"/"+b+"/"+a.images[d];var e={images:c,frames:a.frames,animations:a.animations};return e},g.destroy=function(){this.removeAllEventListeners(),this.removeAllChildren(),this.parent.removeChild(this)},g.teardown=function(){f.teardown.call(this)},namespace("wgbh").TestContainer=e}(),function(){var a=include("wgbh.TitleState"),b=include("wgbh.IntroState"),c=include("wgbh.MenuState"),d=include("wgbh.OutroState"),e=include("wgbh.GameState"),f=include("wgbh.TestState"),g=include("springroll.Application"),h=include("lib.RuffTransition"),j=include("springroll.easeljs.EaselJSDisplay"),k=function(a,b){window.images[b.id]=a;var c=lib.ssMetadata;for(i=0;i<c.length;i++)ss[c[i].name]=new createjs.SpriteSheet({images:[window.images[c[i].name]],frames:c[i].frames})},l=new g({fps:60,name:"rtl_rhino",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",display:j,displayOptions:{clearView:!0},preload:[{id:"RuffTransition_atlas_",src:"assets/images/RuffTransition_atlas_.png",complete:k}]});l.on("init",function(){this.animator.captions.mute=!0;var g=this.config.assets,i=this.config.scaling;this.manifests;this.transition=new h,this.transition.framerate=30,this.states={title:new a({next:"intro",preload:g.title,scaling:i.title}),intro:new b({next:"menu",previous:"title",preload:g.game,scaling:i.intro}),menu:new c({next:"game",previous:"intro",preload:g.menu,scaling:i.menu}),game:new e({next:"outro",previous:"menu",preload:g.game,scaling:i.game}),test:new f({next:"game",previous:"game",preload:g.test,scaling:i.test}),outro:new d({next:"game",previous:"title",preload:g.intro,scaling:"panel"})},l.trackstrayclick=l.trackstrayclick.bind(l)}),l.trackevent=function(a,b){var c=[];for(var d in b.idorder)c.push(b[b.idorder[d]]);this.learning[a].apply(this.learning,c)},l.trackstrayclick=function(a){var b="None";l.ROUNDNAME&&(b=l.ROUNDNAME),this.trackevent("offClick",{idorder:["coordinates","round"],round_name:b,coordinates:{x:parseInt(a.stageX),y:parseInt(a.stageY),stage_width:l.display.width,stage_height:l.display.height}})},l.trackclickplay=function(a){this.trackevent("clickPlay",{idorder:["coordinates","kid"],kid:this.roundid,coordinates:a})},l.getmovieinfo=function(a){return this.config.movies[a]},l.trackmoviestart=function(a){this.learning.startTimer("movie");var b=this.getmovieinfo(a);this.trackevent("startMovie",{idorder:["kid","movie_id","duration","description"],kid:this.roundid,movie_id:a,duration:b.duration,description:b.description})},l.trackmovieend=function(a){this.learning.stopTimer("movie");
var b=this.getmovieinfo(a);this.trackevent("endMovie",{idorder:["kid","movie_id","duration","description"],kid:this.roundid,movie_id:a,duration:b.duration,description:b.description})},l.trackmovieskip=function(a){var b=this.getmovieinfo(a);this.trackevent("skipMovie",{idorder:["kid","movie_id","duration","time_played","description"],kid:this.roundid,movie_id:a,duration:b.duration,time_played:this.learning.stopTimer("movie"),description:b.description})},l.startdwelltimer=function(a){l.startdwell=Date.now(),l.dwellobject=a},l.stopdwelltimer=function(){l.startdwell&&(l.dwelltime=Date.now()-l.startdwell,l.dwelltime>1500&&l.trackdwelltime(l.dwelltime,l.dwellobject.id)),l.startdwell=null,l.dwelltime=0},l.trackdwelltime=function(a,b){var c="none";l.ROUNDNAME&&(c=l.ROUNDNAME),this.trackevent("dwellTime",{idorder:["round_name","dwell_time","object"],round_name:c,dwell_time:a,object:b.toString()})},window.app=l}();