pc.script.create("UpgradeSystem",function(a){var b=function(a){this.entity=a,this.from=""};return b.prototype={initialize:function(){var b=a.root.findByName("PauseScene");this.pauseSceneScript=b.script.PauseScene,this.speedBtn=this.entity.findByName("AddSpeed"),this.handlingBtn=this.entity.findByName("AddHandling"),this.dashBtn=this.entity.findByName("AddDash"),this.resetBtn=this.entity.findByName("ResetButton"),this.canisterAmountText=this.entity.findByName("CanisterAmount"),this.goBtn=this.entity.findByName("GoButton"),this.canisterAmount=0,this.canisterAmount=Storage.getUpgradeMutagen(),this.fillings=new MapShim,this.numbers=new MapShim,this.speedButtons=this.entity.findByName("SpeedButtons").getChildren(),this.handlingButtons=this.entity.findByName("HandlingButtons").getChildren(),this.dashButtons=this.entity.findByName("DashButtons").getChildren(),this.speedNumbers=this.entity.findByName("SpeedNumbers").getChildren(),this.handlingNumbers=this.entity.findByName("HandlingNumbers").getChildren(),this.dashNumbers=this.entity.findByName("DashNumbers").getChildren(),this.numbers.set("Speed",this.speedNumbers),this.numbers.set("Handling",this.handlingNumbers),this.numbers.set("Dash",this.dashNumbers),this.initialized=!1,this.currentStats||(this.currentStats={speed:0,handling:0,dash:0}),this._initFillings(),this._showCurrentStats()},update:function(a){this.canisterAmountText.script.font_renderer.text=this.canisterAmount.toString()},onEnable:function(){this.canisterAmount=Storage.getUpgradeMutagen(),this.speedBtn.script.Button.on("onPointerUp",this._buttonHandler,this),this.handlingBtn.script.Button.on("onPointerUp",this._buttonHandler,this),this.dashBtn.script.Button.on("onPointerUp",this._buttonHandler,this),this.resetBtn.script.Button.on("onPointerUp",this._buttonHandler,this),this.goBtn.script.Button.on("onPointerUp",this._buttonHandler,this);for(var a=0;a<this.speedButtons.length;a++)this.speedButtons[a].script.Button.on("onPointerUp",this._onUpgradeBox,this),this.handlingButtons[a].script.Button.on("onPointerUp",this._onUpgradeBox,this),this.dashButtons[a].script.Button.on("onPointerUp",this._onUpgradeBox,this)},onDisable:function(){this.speedBtn.script.Button.off("onPointerUp",this._buttonHandler,this),this.handlingBtn.script.Button.off("onPointerUp",this._buttonHandler,this),this.dashBtn.script.Button.off("onPointerUp",this._buttonHandler,this),this.resetBtn.script.Button.off("onPointerUp",this._buttonHandler,this),this.goBtn.script.Button.off("onPointerUp",this._buttonHandler,this);for(var a=0;a<this.speedButtons.length;a++)this.speedButtons[a].script.Button.off("onPointerUp",this._onUpgradeBox,this),this.handlingButtons[a].script.Button.off("onPointerUp",this._onUpgradeBox,this),this.dashButtons[a].script.Button.off("onPointerUp",this._onUpgradeBox,this)},_showCurrentStats:function(){Storage.getPlayerStats(this.currentStats),this._fill("Speed",this.currentStats.speed,!0,!0),this._fill("Handling",this.currentStats.handling,!0,!0),this._fill("Dash",this.currentStats.dash,!0,!0)},_initFillings:function(){for(var a=this.entity.findByName("Filling"),b=a.getChildren(),c=0;c<b.length;c++){var d=b[c],e=d.getChildren(),f=[];this.fillings.set(d.getName(),f);for(var g=0;g<e.length;g++){var h=e[g];h.getName().indexOf("Filling")>-1&&f.push(h)}}},_fill:function(a,b,c,d){c=c||!0,d=d||!1;var e=this.fillings.get(a);if(b>=0&&b<e.length){if(d)for(var f=0;b>=f;f++){var g=e[f];g.enabled=c}else e[b].enabled=c;var h=this.numbers.get(a);return b-=1,b<h.length&&b>=0&&(h[b].enabled=!0),!0}return!1},_reset:function(a){for(var b=this.fillings.get(a),c=1;c<b.length;c++)b[c].enabled=!1;for(var d=this.numbers.get(a),c=0;c<d.length;c++)d[c].enabled=!1;b[0].enabled=!0},_buttonHandler:function(a){switch(a){case"AddSpeed":this.canisterAmount>this.currentStats.speed&&this._fill("Speed",this.currentStats.speed+1)&&(this.currentStats.speed++,this.canisterAmount-=this.currentStats.speed);break;case"AddHandling":this.canisterAmount>this.currentStats.handling&&this._fill("Handling",this.currentStats.handling+1)&&(this.currentStats.handling++,this.canisterAmount-=this.currentStats.handling);break;case"AddDash":this.canisterAmount>this.currentStats.dash&&this._fill("Dash",this.currentStats.dash+1)&&(this.currentStats.dash++,this.canisterAmount-=this.currentStats.dash);break;case"ResetButton":this._reset("Speed"),this._reset("Handling"),this._reset("Dash"),this.canisterAmount+=this.currentStats.speed*(this.currentStats.speed+1)/2+this.currentStats.handling*(this.currentStats.handling+1)/2+this.currentStats.dash*(this.currentStats.dash+1)/2,this.currentStats.speed=0,this.currentStats.handling=0,this.currentStats.dash=0;break;case"GoButton":Storage.setPlayerStats(this.currentStats),Storage.setUpgradeMutagen(this.canisterAmount),this.fire("upgradeStats",this.currentStats),this.entity.enabled=!1,this.pauseSceneScript.container.enabled=!0,this.pauseSceneScript.noPauseScreen&&(this.pauseSceneScript._onPointerUp("ResumeButton"),this.pauseSceneScript.noPauseScreen=!1);break;default:console.warn("Could not find the button "+a)}},_onUpgradeBox:function(a){var b=a.split("_");switch(b[0]){case"S":var c=parseInt(b[1]);c===this.currentStats.speed+1&&this._buttonHandler("AddSpeed");break;case"H":var c=parseInt(b[1]);c===this.currentStats.handling+1&&this._buttonHandler("AddHandling");break;case"D":var c=parseInt(b[1]);c===this.currentStats.dash+1&&this._buttonHandler("AddDash");break;default:console.warn("_onUpgradeBox : "+a+" does not exist")}},canUpgrade:function(){return this.canisterAmount=Storage.getUpgradeMutagen(),this.currentStats||(this.currentStats={speed:0,handling:0,dash:0},Storage.getPlayerStats(this.currentStats)),this.canisterAmount>this.currentStats.speed||this.canisterAmount>this.currentStats.handling||this.canisterAmount>this.currentStats.dash}},b});