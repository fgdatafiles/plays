window.__require=function e(t,r,n){function o(a,c){if(!r[a]){if(!t[a]){var s=a.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!c&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){return o(t[a][1][e]||e)},u,u.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t){var r,n,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function s(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}})();var l,u=[],p=!1,f=-1;function d(){p&&l&&(p=!1,l.length?u=l.concat(u):f=-1,u.length&&h())}function h(){if(!p){var e=c(d);p=!0;for(var t=u.length;t;){for(l=u,u=[];++f<t;)l&&l[f].run();f=-1,t=u.length}l=null,p=!1,s(e)}}function y(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new y(e,t)),1!==u.length||p||c(h)},y.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(){return[]},o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],2:[function(e,t){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],3:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],4:[function(e,t,r){(function(t,n){var o=/%[sdj%]/g;r.format=function(e){if(!w(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,a=String(e).replace(o,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return e}}),s=n[r];r<i;s=n[++r])b(s)||!C(s)?a+=" "+s:a+=" "+c(s);return a},r.deprecate=function(e,o){if(O(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var i=!1;return function(){if(!i){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),i=!0}return e.apply(this,arguments)}};var i,a={};function c(e,t){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(t)?n.showHidden=t:t&&r._extend(n,t),O(n.showHidden)&&(n.showHidden=!1),O(n.depth)&&(n.depth=2),O(n.colors)&&(n.colors=!1),O(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),p(n,e,n.depth)}function s(e,t){var r=c.styles[t];return r?"\x1b["+c.colors[r][0]+"m"+e+"\x1b["+c.colors[r][1]+"m":e}function l(e){return e}function u(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function p(e,t,n){if(e.customInspect&&t&&j(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return w(o)||(o=p(e,o,n)),o}var i=f(e,t);if(i)return i;var a=Object.keys(t),c=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),T(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(t);if(0===a.length){if(j(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(S(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(P(t))return e.stylize(Date.prototype.toString.call(t),"date");if(T(t))return d(t)}var l,m="",b=!1,v=["{","}"];return _(t)&&(b=!0,v=["[","]"]),j(t)&&(m=" [Function"+(t.name?": "+t.name:"")+"]"),S(t)&&(m=" "+RegExp.prototype.toString.call(t)),P(t)&&(m=" "+Date.prototype.toUTCString.call(t)),T(t)&&(m=" "+d(t)),0!==a.length||b&&0!=t.length?n<0?S(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=b?h(e,t,n,c,a):a.map(function(r){return y(e,t,n,c,r,b)}),e.seen.pop(),g(l,m,v)):v[0]+m+v[1]}function f(e,t){if(O(t))return e.stylize("undefined","undefined");if(w(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return v(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):b(t)?e.stylize("null","null"):void 0}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,r,n,o){for(var i=[],a=0,c=t.length;a<c;++a)E(t,String(a))?i.push(y(e,t,r,n,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(y(e,t,r,n,o,!0))}),i}function y(e,t,r,n,o,i){var a,c,s;if((s=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?c=s.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):s.set&&(c=e.stylize("[Setter]","special")),E(n,o)||(a="["+o+"]"),c||(e.seen.indexOf(s.value)<0?(c=b(r)?p(e,s.value,null):p(e,s.value,r-1)).indexOf("\n")>-1&&(c=i?c.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+c.split("\n").map(function(e){return"   "+e}).join("\n")):c=e.stylize("[Circular]","special")),O(a)){if(i&&o.match(/^\d+$/))return c;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+c}function g(e,t,r){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function _(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function b(e){return null===e}function v(e){return"number"==typeof e}function w(e){return"string"==typeof e}function O(e){return void 0===e}function S(e){return C(e)&&"[object RegExp]"===R(e)}function C(e){return"object"==typeof e&&null!==e}function P(e){return C(e)&&"[object Date]"===R(e)}function T(e){return C(e)&&("[object Error]"===R(e)||e instanceof Error)}function j(e){return"function"==typeof e}function R(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}r.debuglog=function(e){if(O(i)&&(i=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(i)){var n=t.pid;a[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else a[e]=function(){};return a[e]},r.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=_,r.isBoolean=m,r.isNull=b,r.isNullOrUndefined=function(e){return null==e},r.isNumber=v,r.isString=w,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=O,r.isRegExp=S,r.isObject=C,r.isDate=P,r.isError=T,r.isFunction=j,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function D(){var e=new Date,t=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":");return[e.getDate(),A[e.getMonth()],t].join(" ")}function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.log=function(){console.log("%s - %s",D(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!C(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:1,inherits:2}],5:[function(e,t){"use strict";t.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t instanceof Map&&r instanceof Map){if(t.size!==r.size)return!1;for(o of t.entries())if(!r.has(o[0]))return!1;for(o of t.entries())if(!e(o[1],r.get(o[0])))return!1;return!0}if(t instanceof Set&&r instanceof Set){if(t.size!==r.size)return!1;for(o of t.entries())if(!r.has(o[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(r)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(t[o]!==r[o])return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;0!=o--;){var a=i[o];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}},{}],6:[function(e,t,r){(function(e,n){"object"==typeof r&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.sessionStorageWrapper=n()})(this,function(){"use strict";const e=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e};var t;function r(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function n(e,t){return t&&e.then(function(e){t(null,e)},function(e){t(e)}),e}function o(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function i(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function a(e){try{return e.setItem("_localforage_support_test","true"),e.removeItem("_localforage_support_test"),!1}catch(t){return!0}}return{_driver:"sessionStorageWrapper",_initStorage:function(r){void 0===r&&(r={});var n,o=e({},r,{db:sessionStorage,keyPrefix:i(r,this._defaultConfig)});return!a(n=o.db)||n.length>0?(this._dbInfo=o,(this,t||(this&&"function"==typeof this.getSerializer?t=this.getSerializer():Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!")))).then(function(e){o.serializer=e})):Promise.reject()},_support:function(){try{return"undefined"!=typeof sessionStorage&&"setItem"in sessionStorage&&!!sessionStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,o=this.ready().then(function(){for(var t=r._dbInfo,n=t.db,o=t.keyPrefix,i=t.serializer,a=o.length,c=n.length,s=1,l=0;l<c;l++){var u=n.key(l)||"";if(0===u.indexOf(o)){var p=n.getItem(u),f=p?i.deserialize(p):null,d=e(f,u.substring(a),s++);if(void 0!==d)return d}}});return n(o,t),o},getItem:function(e,t){var r=this;e=o(e);var i=this.ready().then(function(){var t=r._dbInfo,n=t.db,o=t.keyPrefix,i=t.serializer,a=n.getItem(o+e);return a?i.deserialize(a):a});return n(i,t),i},setItem:function(e,t,r){var i=this;e=o(e);var a=this.ready().then(function(){void 0===t&&(t=null);var r=t,n=i._dbInfo,o=n.db,a=n.keyPrefix,c=n.serializer;return new Promise(function(n,i){c.serialize(t,function(t,c){if(c)i(c);else try{o.setItem(a+e,t),n(r)}catch(s){"QuotaExceededError"!==s.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==s.name||i(s),i(s)}})})});return n(a,r),a},removeItem:function(e,t){var r=this;e=o(e);var i=this.ready().then(function(){var t=r._dbInfo,n=t.db,o=t.keyPrefix;n.removeItem(o+e)});return n(i,t),i},clear:function(e){var t=this,r=this.ready().then(function(){for(var e=t._dbInfo,r=e.db,n=e.keyPrefix,o=r.length-1;o>=0;o--){var i=r.key(o)||"";0===i.indexOf(n)&&r.removeItem(i)}});return n(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return n(t,e),t},key:function(e,t){var r=this,o=this.ready().then(function(){var t,n=r._dbInfo,o=n.db,i=n.keyPrefix;try{t=o.key(e)||null}catch(a){t=null}return t?t.substring(i.length):t});return n(o,t),o},keys:function(e){var t=this,r=this.ready().then(function(){for(var e=t._dbInfo,r=e.db,n=e.keyPrefix,o=r.length,i=[],a=0;a<o;a++){var c=r.key(a)||"";0===c.indexOf(n)&&i.push(c.substring(n.length))}return i});return n(r,e),r},dropInstance:function(e,t){t=r.apply(this,arguments);var o,a="function"!=typeof e&&e||{};if(!a.name){var c=this.config();a.name=a.name||c.name,a.storeName=a.storeName||c.storeName}if(a.name)try{for(var s=a.storeName?i(a,this._defaultConfig):a.name+"/",l=this._dbInfo.db,u=l.length-1;u>=0;u--){var p=l.key(u)||"";0===p.indexOf(s)&&l.removeItem(p)}o=Promise.resolve()}catch(f){o=Promise.reject(f)}else o=Promise.reject("Invalid arguments");return n(o,t),o}}})},{}],7:[function(e,t,r){(function(n){(function(e){"object"==typeof r&&void 0!==t?t.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).localforage=e()})(function(){return function t(r,n,o){function i(c,s){if(!n[c]){if(!r[c]){var l="function"==typeof e&&e;if(!s&&l)return l(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[c]={exports:{}};r[c][0].call(p.exports,function(e){return i(r[c][1][e]||e)},p,p.exports,t,r,n,o)}return n[c].exports}for(var a="function"==typeof e&&e,c=0;c<o.length;c++)i(o[c]);return i}({1:[function(e,t){(function(e){"use strict";var r,n,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var i=0,a=new o(u),c=e.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var s=new e.MessageChannel;s.port1.onmessage=u,r=function(){s.port2.postMessage(0)}}var l=[];function u(){var e,t;n=!0;for(var r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}n=!1}t.exports=function(e){1!==l.push(e)||n||r()}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t){"use strict";var r=e(1);function n(){}var o={},i=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==n&&f(this,e)}function l(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function u(e,t,n){r(function(){var r;try{r=t(n)}catch(i){return o.reject(e,i)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)})}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var a=d(function(){t(i,n)});"error"===a.status&&n(a.value)}function d(e,t){var r={};try{r.value=e(t),r.status="success"}catch(n){r.status="error",r.value=n}return r}t.exports=s,s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var r=new this.constructor(n);return this.state!==c?u(r,this.state===a?e:t,this.outcome):this.queue.push(new l(r,e,t)),r},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=d(p,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)f(e,n);else{e.state=a,e.outcome=t;for(var i=-1,c=e.queue.length;++i<c;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:o.resolve(new this(n),e)},s.reject=function(e){var t=new this(n);return o.reject(t,e)},s.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var a=new Array(r),c=0,s=-1,l=new this(n);++s<r;)u(e[s],s);return l;function u(e,n){t.resolve(e).then(function(e){a[n]=e,++c!==r||i||(i=!0,o.resolve(l,a))},function(e){i||(i=!0,o.reject(l,e))})}},s.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var i,a=-1,c=new this(n);++a<t;)i=e[a],this.resolve(i).then(function(e){r||(r=!0,o.resolve(c,e))},function(e){r||(r=!0,o.reject(c,e))});return c}},{1:1}],3:[function(e){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function c(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function s(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",f=void 0,d={},h=Object.prototype.toString,y="readwrite";function g(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),o=0;o<t;o++)n[o]=e.charCodeAt(o);return r}function _(e){return new a(function(t){var r=e.transaction(p,y),n=i([""]);r.objectStore(p).put(n,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}function m(e){return"boolean"==typeof f?a.resolve(f):_(e).then(function(e){return f=e})}function b(e){var t=d[e.name],r={};r.promise=new a(function(e,t){r.resolve=e,r.reject=t}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise}function v(e){var t=d[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function w(e,t){var r=d[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function O(e,t){return new a(function(r,n){if(d[e.name]=d[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);b(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),v(e)}})}function S(e){return O(e,!1)}function C(e){return O(e,!0)}function P(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,o=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||r){if(r){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function T(e){return i([g(atob(e.data))],{type:e.type})}function j(e){return e&&e.__local_forage_encoded_blob}function R(e){var t=this,r=t._initReady().then(function(){var e=d[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return s(r,e,e),r}function x(e){b(e);for(var t=d[e.name],r=t.forages,n=0;n<r.length;n++){var o=r[n];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,S(e).then(function(t){return e.db=t,P(e)?C(e):t}).then(function(n){e.db=t.db=n;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=n}).catch(function(t){throw w(e,t),t})}function A(e,t,r,n){void 0===n&&(n=1);try{var o=e.db.transaction(e.storeName,t);r(null,o)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return a.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),C(e)}).then(function(){return x(e).then(function(){A(e,t,r,n-1)})}).catch(r);r(i)}}var D={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var o=d[r.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},d[r.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=R);var i=[];function c(){return a.resolve()}for(var s=0;s<o.forages.length;s++){var l=o.forages[s];l!==t&&i.push(l._initReady().catch(c))}var u=o.forages.slice(0);return a.all(i).then(function(){return r.db=o.db,S(r)}).then(function(e){return r.db=e,P(r,t._defaultConfig.version)?C(r):e}).then(function(e){r.db=o.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var i=u[n];i!==t&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},_support:function(){try{if(!o)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(r){return!1}}(),iterate:function(e,t){var r=this,n=new a(function(t,n){r.ready().then(function(){A(r._dbInfo,"readonly",function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName).openCursor(),c=1;a.onsuccess=function(){var r=a.result;if(r){var n=r.value;j(n)&&(n=T(n));var o=e(n,r.key,c++);void 0!==o?t(o):r.continue()}else t()},a.onerror=function(){n(a.error)}}catch(s){n(s)}})}).catch(n)});return c(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=new a(function(t,n){r.ready().then(function(){A(r._dbInfo,"readonly",function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),j(e)&&(e=T(e)),t(e)},a.onerror=function(){n(a.error)}}catch(c){n(c)}})}).catch(n)});return c(n,t),n},setItem:function(e,t,r){var n=this;e=l(e);var o=new a(function(r,o){var i;n.ready().then(function(){return i=n._dbInfo,"[object Blob]"===h.call(t)?m(i.db).then(function(e){return e?t:(r=t,new a(function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){var n=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:r.type})},n.readAsBinaryString(r)}));var r}):t}).then(function(t){A(n._dbInfo,y,function(i,a){if(i)return o(i);try{var c=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var s=c.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),r(t)},a.onabort=a.onerror=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(l){o(l)}})}).catch(o)});return c(o,r),o},removeItem:function(e,t){var r=this;e=l(e);var n=new a(function(t,n){r.ready().then(function(){A(r._dbInfo,y,function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){n(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(c){n(c)}})}).catch(n)});return c(n,t),n},clear:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){A(t._dbInfo,y,function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(a){r(a)}})}).catch(r)});return c(r,e),r},length:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){A(t._dbInfo,"readonly",function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){r(i.error)}}catch(a){r(a)}})}).catch(r)});return c(r,e),r},key:function(e,t){var r=this,n=new a(function(t,n){e<0?t(null):r.ready().then(function(){A(r._dbInfo,"readonly",function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName),c=!1,s=a.openCursor();s.onsuccess=function(){var r=s.result;r?0===e?t(r.key):c?t(r.key):(c=!0,r.advance(e)):t(null)},s.onerror=function(){n(s.error)}}catch(l){n(l)}})}).catch(n)});return c(n,t),n},keys:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){A(t._dbInfo,"readonly",function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).openCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){r(i.error)}}catch(c){r(c)}})}).catch(r)});return c(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){var i=e.name===n.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):S(e).then(function(t){var r=d[e.name],n=r.forages;r.db=t;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=t;return t});r=e.storeName?i.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;b(e);var n=d[e.name],i=n.forages;t.close();for(var c=0;c<i.length;c++){var s=i[c];s._dbInfo.db=null,s._dbInfo.version=r}return new a(function(t,n){var i=o.open(e.name,r);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<i.length;t++){var r=i[t];r._dbInfo.db=e,v(r._dbInfo)}}).catch(function(t){throw(w(e,t)||a.resolve()).catch(function(){}),t})}}):i.then(function(t){b(e);var r=d[e.name],n=r.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;return new a(function(t,r){var n=o.deleteDatabase(e.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),r(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<n.length;t++)v(n[t]._dbInfo)}).catch(function(t){throw(w(e,t)||a.resolve()).catch(function(){}),t})})}else r=a.reject("Invalid arguments");return c(r,t),r}},E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",I=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:".length,U=N+"arbf".length,M=Object.prototype.toString;function k(e){var t,r,n,o,i,a=.75*e.length,c=e.length,s=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var l=new ArrayBuffer(a),u=new Uint8Array(l);for(t=0;t<c;t+=4)r=E.indexOf(e[t]),n=E.indexOf(e[t+1]),o=E.indexOf(e[t+2]),i=E.indexOf(e[t+3]),u[s++]=r<<2|n>>4,u[s++]=(15&n)<<4|o>>2,u[s++]=(3&o)<<6|63&i;return l}function B(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=E[r[t]>>2],n+=E[(3&r[t])<<4|r[t+1]>>4],n+=E[(15&r[t+1])<<2|r[t+2]>>6],n+=E[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var F={serialize:function(e,t){var r="";if(e&&(r=M.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===M.call(e.buffer))){var n,o="__lfsc__:";e instanceof ArrayBuffer?(n=e,o+="arbf"):(n=e.buffer,"[object Int8Array]"===r?o+="si08":"[object Uint8Array]"===r?o+="ui08":"[object Uint8ClampedArray]"===r?o+="uic8":"[object Int16Array]"===r?o+="si16":"[object Uint16Array]"===r?o+="ur16":"[object Int32Array]"===r?o+="si32":"[object Uint32Array]"===r?o+="ui32":"[object Float32Array]"===r?o+="fl32":"[object Float64Array]"===r?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+B(n))}else if("[object Blob]"===r){var i=new FileReader;i.onload=function(){var r="~~local_forage_type~"+e.type+"~"+B(this.result);t("__lfsc__:blob"+r)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(a){console.error("Couldn't convert value into a JSON string: ",e),t(null,a)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,N))return JSON.parse(e);var t,r=e.substring(U),n=e.substring(N,U);if("blob"===n&&I.test(r)){var o=r.match(I);t=o[1],r=r.substring(o[0].length)}var a=k(r);switch(n){case"arbf":return a;case"blob":return i([a],{type:t});case"si08":return new Int8Array(a);case"ui08":return new Uint8Array(a);case"uic8":return new Uint8ClampedArray(a);case"si16":return new Int16Array(a);case"ur16":return new Uint16Array(a);case"si32":return new Int32Array(a);case"ui32":return new Uint32Array(a);case"fl32":return new Float32Array(a);case"fl64":return new Float64Array(a);default:throw new Error("Unkown type: "+n)}},stringToBuffer:k,bufferToString:B};function V(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function z(e,t,r,n,o,i){e.executeSql(r,n,o,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,c){c.rows.length?i(e,a):V(e,t,function(){e.executeSql(r,n,o,i)},i)},i):i(e,a)},i)}function H(e,t,r,n){var o=this;e=l(e);var i=new a(function(i,a){o.ready().then(function(){void 0===t&&(t=null);var c=t,s=o._dbInfo;s.serializer.serialize(t,function(t,l){l?a(l):s.db.transaction(function(r){z(r,s,"INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){i(c)},function(e,t){a(t)})},function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void i(H.apply(o,[e,c,r,n-1]));a(t)}})})}).catch(a)});return c(i,r),i}function L(e){return new a(function(t,r){e.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(r,n){for(var o=[],i=0;i<n.rows.length;i++)o.push(n.rows.item(i).name);t({db:e,storeNames:o})},function(e,t){r(t)})},function(e){r(e)})})}var G={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var o=new a(function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(o){return n(o)}r.db.transaction(function(o){V(o,r,function(){t._dbInfo=r,e()},function(e,t){n(t)})},n)});return r.serializer=F,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new a(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){z(r,o,"SELECT * FROM "+o.storeName,[],function(r,n){for(var i=n.rows,a=i.length,c=0;c<a;c++){var s=i.item(c),l=s.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,s.key,c+1)))return void t(l)}t()},function(e,t){n(t)})})}).catch(n)});return c(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=new a(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){z(r,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=o.serializer.deserialize(n)),t(n)},function(e,t){n(t)})})}).catch(n)});return c(n,t),n},setItem:function(e,t,r){return H.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=l(e);var n=new a(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){z(r,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)});return c(n,t),n},clear:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){z(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})}).catch(r)});return c(r,e),r},length:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){z(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){var n=r.rows.item(0).c;e(n)},function(e,t){r(t)})})}).catch(r)});return c(r,e),r},key:function(e,t){var r=this,n=new a(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){z(r,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)},function(e,t){n(t)})})}).catch(n)});return c(n,t),n},keys:function(e){var t=this,r=new a(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){z(t,n,"SELECT key FROM "+n.storeName,[],function(t,r){for(var n=[],o=0;o<r.rows.length;o++)n.push(r.rows.item(o).key);e(n)},function(e,t){r(t)})})}).catch(r)});return c(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,o=this;return c(n=e.name?new a(function(t){var n;n=e.name===r.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(L(n))}).then(function(e){return new a(function(t,r){e.db.transaction(function(n){function o(e){return new a(function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){r(t)})})}for(var i=[],c=0,s=e.storeNames.length;c<s;c++)i.push(o(e.storeNames[c]));a.all(i).then(function(){t()}).catch(function(e){r(e)})},function(e){r(e)})})}):a.reject("Invalid arguments"),t),n}};function W(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function q(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}var K={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=W(e,this._defaultConfig),!q()||localStorage.length>0?(this._dbInfo=t,t.serializer=F,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=r.ready().then(function(){for(var t=r._dbInfo,n=t.keyPrefix,o=n.length,i=localStorage.length,a=1,c=0;c<i;c++){var s=localStorage.key(c);if(0===s.indexOf(n)){var l=localStorage.getItem(s);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,s.substring(o),a++)))return l}}});return c(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=r.ready().then(function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n});return c(n,t),n},setItem:function(e,t,r){var n=this;e=l(e);var o=n.ready().then(function(){void 0===t&&(t=null);var r=t;return new a(function(o,i){var a=n._dbInfo;a.serializer.serialize(t,function(t,n){if(n)i(n);else try{localStorage.setItem(a.keyPrefix+e,t),o(r)}catch(c){"QuotaExceededError"!==c.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==c.name||i(c),i(c)}})})});return c(o,r),o},removeItem:function(e,t){var r=this;e=l(e);var n=r.ready().then(function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return c(n,t),n},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}});return c(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return c(t,e),t},key:function(e,t){var r=this,n=r.ready().then(function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(o){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return c(n,t),n},keys:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=localStorage.length,n=[],o=0;o<r;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&n.push(i.substring(e.keyPrefix.length))}return n});return c(r,e),r},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,o=this;return c(n=e.name?new a(function(t){e.storeName?t(W(e,o._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}):a.reject("Invalid arguments"),t),n}},Z=function(e,t){for(var r,n,o=e.length,i=0;i<o;){if((r=e[i])===(n=t)||"number"==typeof r&&"number"==typeof n&&isNaN(r)&&isNaN(n))return!0;i++}return!1},Y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},X={},J={},Q={INDEXEDDB:D,WEBSQL:G,LOCALSTORAGE:K},$=[Q.INDEXEDDB._driver,Q.WEBSQL._driver,Q.LOCALSTORAGE._driver],ee=["dropInstance"],te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),re={description:"",driver:$.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ne(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function oe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(Y(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var ie=new(function(){function e(t){for(var r in n(this,e),Q)if(Q.hasOwnProperty(r)){var o=Q[r],i=o._driver;this[r]=i,X[i]||this.defineDriver(o)}this._defaultConfig=oe({},re),this._config=oe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new a(function(t,r){try{var n=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(o);for(var i=te.concat("_initStorage"),s=0,l=i.length;s<l;s++){var u=i[s];if((!Z(ee,u)||e[u])&&"function"!=typeof e[u])return void r(o)}(function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=a.reject(t);return c(r,arguments[arguments.length-1]),r}},r=0,n=ee.length;r<n;r++){var o=ee[r];e[o]||(e[o]=t(o))}})();var p=function(r){X[n]&&console.info("Redefining LocalForage driver: "+n),X[n]=e,J[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(p,r):p(!!e._support):p(!0)}catch(f){r(f)}});return s(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=X[e]?a.resolve(X[e]):a.reject(new Error("Driver not found."));return s(n,t,r),n},e.prototype.getSerializer=function(e){var t=a.resolve(F);return s(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return s(r,e,e),r},e.prototype.setDriver=function(e,t,r){var n=this;Y(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){n._config.driver=n.driver()}function c(e){return n._extend(e),i(),n._ready=n._initStorage(n._config),n._ready}function l(e){return function(){var t=0;return function r(){for(;t<e.length;){var o=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(o).then(c).catch(r)}i();var s=new Error("No available storage method found.");return n._driverSet=a.reject(s),n._driverSet}()}}var u=null!==this._driverSet?this._driverSet.catch(function(){return a.resolve()}):a.resolve();return this._driverSet=u.then(function(){var e=o[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then(function(e){n._driver=e._driver,i(),n._wrapLibraryMethodsWithReady(),n._initDriver=l(o)})}).catch(function(){i();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet}),s(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!J[e]},e.prototype._extend=function(e){oe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)ne(this,te[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ie},{3:3}]},{},[4])(4)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],Activatable:[function(e,t,r){"use strict";cc._RF.push(t,"3c744MfATpFjouaKeFgjJ6g","Activatable");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("../Util/EventHandlerUtils")),u=s(e("../Util/getComponentInParents")),p=s(e("../Util/Decorators/cache")),f=s(e("../Generic/ButtonAsynchronizer")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.executeInEditMode,_=cc.js,m=_.getClassName,b=_.getClassByName,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._nodes=[],t}var r;return o(t,e),Object.defineProperty(t.prototype,"nodes",{get:function(){return this._nodes.filter(function(e){return e})},enumerable:!1,configurable:!0}),t.prototype.select=function(){this.setSeleted(!0)},t.prototype.deselect=function(){this.setSeleted(!1)},t.prototype.setSeleted=function(e){var t,r;if(0===this.nodes.length)throw new Error(m(this)+" cannot be selected; no configured nodes.");try{for(var n=c(this.nodes),o=n.next();!o.done;o=n.next())o.value.active=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},Object.defineProperty(t.prototype,"isSelected",{get:function(){return 0!==this.nodes.length&&this.nodes.every(function(e){return e.active})},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._ensureEventHandler()},t.prototype._ensureEventHandler=function(){var e=b("ActivateUI"),t=e&&u.default(this.node,e);if(t){var r=f.default.getClickEvents(this.button);l.default.ensure({target:t.node,component:t,handler:"setActivated"},r)}},i([p.default(cc.Button),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Button)?r:Object)],t.prototype,"button",void 0),i([y({visible:!0,type:cc.Node,tooltip:"Nodes that should be active when this component is selected, and inactive when not selected."}),a("design:type",Array)],t.prototype,"_nodes",void 0),i([h,g],t)}(cc.Component);r.default=v,cc._RF.pop()},{"../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","../Util/getComponentInParents":"getComponentInParents"}],ActivateUI:[function(e,t,r){"use strict";cc._RF.push(t,"c9f9df9E2NET4IA703Ovygu","ActivateUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("./Activatable")),u=cc._decorator,p=u.ccclass,f=u.property,d=u.executeInEditMode,h=cc.js.getClassName,y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"activatables",{get:function(){return this.getComponentsInChildren(l.default).filter(function(e){return e.nodes.length>0})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activated",{get:function(){return this.activatables.find(function(e){return e.isSelected})||null},set:function(e){this.setActivated(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activatedNodes",{get:function(){return this.activated?this.activated.nodes:[]},enumerable:!1,configurable:!0}),t.prototype.setActivated=function(e){var t,r,n=e instanceof cc.Event.EventTouch?e.target.getComponent(l.default):e;if(!n)throw new Error(h(l.default)+" required.");if(0===this.activatables.length)throw new Error(this.node.name+" has no tabs.");if(!this.activatables.includes(n))throw new Error(h(l.default)+" "+n.node.name+" is not attached to "+this.node.name+".");try{for(var o=c(this.activatables),i=o.next();!i.done;i=o.next()){var a=i.value;a.setSeleted(a===n)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.onLoad=function(){},t.prototype.onDestroy=function(){},t.prototype._ensureEditorSelectedTab=function(){},i([f({type:l.default}),a("design:type",Object),a("design:paramtypes",[Object])],t.prototype,"activated",null),i([p,d],t)}(cc.Component);r.default=y,cc._RF.pop()},{"./Activatable":"Activatable"}],ActorCommands:[function(e,t,r){"use strict";cc._RF.push(t,"37072VnikRMpo0+415lFB/R","ActorCommands");var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e){return"object"==typeof e&&null!==e}function i(e){if(!o(e))return!1;var t=e;return"string"==typeof t.command&&"number"==typeof t.time&&"number"==typeof t.track}function a(e){if(!o(e))return!1;var t=e;return!!(Array.isArray(t.actors)&&t.actors.every(function(e){return"string"==typeof e})&&Array.isArray(t.commands)&&t.commands.every(i))}function c(e){if(!o(e))return!1;var t=e;return"number"==typeof t.duration&&!(!Array.isArray(t.timelines)||!t.timelines.every(a))}Object.defineProperty(r,"__esModule",{value:!0}),r.TRANSFORM_CHANNELS=r.EASING_TYPES=r.createCommand=r.assertActorSequence=r.isActorSequence=void 0,r.EASING_TYPES=["linear","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","expoIn","expoOut","expoInOut","circIn","circOut","circInOut","elasticIn","elasticOut","elasticInOut","backIn","backOut","backInOut","bounceIn","bounceOut","bounceInOut","smooth","fade"],r.TRANSFORM_CHANNELS=["x","y","scaleX","scaleY","angle","opacity","color"],r.isActorSequence=c,r.assertActorSequence=function(e){if(!c(e))throw new Error("Not a valid ActorSequence.");return e},r.createCommand=function(e,t){var r=e,o={time:0,track:0};switch(r){case"playSpineClip":return n(n({command:r,clip:"",loop:!1,blend:0,alpha:1},o),t);case"clearSpineTrack":return n(n({command:r,blend:0},o),t);case"playAnimationClip":return n(n({command:r,clip:""},o),t);case"playAudioClip":return n(n({command:r,clip:"",volume:1,loop:!1},o),t);case"clearAudioTrack":return n(n({command:r},o),t);case"transform":return n(n({command:r,duration:1,channel:["x","y","scaleX","scaleY","angle"],node:"",easing:"linear"},o),t);case"setParent":return n(n({command:r,node:"",childIndex:-1},o),t);case"setEnabled":return n(n({command:r,component:"",enabled:!0},o),t);case"invokeMethod":return n(n({command:r,component:"",method:"",args:[]},o),t);case"setCharacterFacing":return n(n({command:r,direction:"right"},o),t);case"moveCharacter":return n(n({command:r,node:"",throttle:.5},o),t);default:throw new Error("Command "+r+" does not exist.")}},cc._RF.pop()},{}],ActorRelay:[function(e,t,r){"use strict";cc._RF.push(t,"69883recBxPi5Un1uQV0NqI","ActorRelay");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=e("./ActorCommands"),f=u(e("./Actor")),d=u(e("../Framework/GameComponent")),h=u(e("../Util/Decorators/deferred")),y=u(e("../Util/sortBy")),g=cc._decorator,_=g.ccclass,m=g.property,b=g.menu,v=y.default("time","track"),w=y.default("time");function O(e){var t,r;try{for(var n=c(e.timelines),o=n.next();!o.done;o=n.next())o.value.commands.sort(w)}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._sequence=null,t.playOnStart=!1,t._timelineCommandIndexes=[],t._time=0,t}var r;return o(t,e),Object.defineProperty(t.prototype,"sequence",{get:function(){return this._sequence instanceof cc.JsonAsset?this._sequence.json:this._sequence},set:function(e){if(this.isPlaying)throw new Error("Cannot set sequence while a sequence is being played.");e instanceof cc.JsonAsset&&p.assertActorSequence(e.json),this._sequence=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sequenceUUID",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sequenceName",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._timelineCommandIndexes.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return!this.enabled},set:function(e){this.enabled=!e},enumerable:!1,configurable:!0}),t.prototype.onGameStart=function(){this.playOnStart&&this.sequence&&!this.getComponent("TriggerAction - PlayActorSequence")&&this.playSequence()},t.prototype.onLoad=function(){cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onDestroy=function(){cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onBeforeDraw=function(){if(this.isPlaying&&this.sequence&&this.enabledInHierarchy){var e=cc.director.getDeltaTime();this._executeCommands(e,!1),this._time>=this.sequence.duration&&this.stopSequence()}},t.prototype.playSequence=function(e){if(e&&e!==this.sequence&&(this.sequence=e),!this.sequence)throw new Error("Cannot play, no sequence defined.");if(0===this.sequence.timelines.length)throw new Error("Cannot play, timeline has no sequences.");return this.isPlaying&&this.stopSequence(),O(this.sequence),this._time=0,this._timelineCommandIndexes=this.sequence.timelines.map(function(){return 0}),this._complete},t.prototype.applySequence=function(e){this.playSequence(e),this._executeCommands(1/0),this._resetState()},t.prototype.setTime=function(e){if(!this.isPlaying)throw new Error("No sequence currently playing.");var t=e-this.time;if(t<0)throw new Error("Rewinding is not supported.");this._executeCommands(t,!0)},t.prototype.stopSequence=function(){this._resetState()},t.prototype._executeCommands=function(e,t){var r,n,o,i;if(void 0===t&&(t=!isFinite(e)),this.sequence){this._time+=e;for(var a=0;a<this.sequence.timelines.length;a++){for(var s=this.sequence.timelines[a],u=f.default.getActorsTagged.apply(f.default,l(s.actors)),p=[],d=this._timelineCommandIndexes[a];d<s.commands.length&&!((g=s.commands[d]).time>this._time);d++)p.push(g),this._timelineCommandIndexes[a]=d+1;p.sort(v);try{for(var h=(r=void 0,c(p)),y=h.next();!y.done;y=h.next()){var g=y.value,_=void 0;t&&(_={instant:this._time-g.time});try{for(var m=(o=void 0,c(u)),b=m.next();!b.done;b=m.next())b.value.executeCommand(g,_)}catch(w){o={error:w}}finally{try{b&&!b.done&&(i=m.return)&&i.call(m)}finally{if(o)throw o.error}}}}catch(O){r={error:O}}finally{try{y&&!y.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}}}},t.prototype._resetState=function(){this._timelineCommandIndexes=[],this._time=0,h.default.resolve(this,"_complete"),h.default.reset(this,"_complete")},i([m({type:cc.JsonAsset}),a("design:type",Object)],t.prototype,"_sequence",void 0),i([m({type:cc.JsonAsset,tooltip:"Default sequence that will be played if one is not provided to the executeSequence command."}),a("design:type",Object),a("design:paramtypes",[Object])],t.prototype,"sequence",null),i([m({tooltip:"Executes the provided sequence on game start.",visible:function(){return!!this._sequence&&!this.getComponent("TriggerAction - PlayActorSequence")}}),a("design:type",Boolean)],t.prototype,"playOnStart",void 0),i([h.default,a("design:type","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],t.prototype,"_complete",void 0),i([_,b("Actor Component/Actor Relay")],t)}(d.default);r.default=S,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Util/Decorators/deferred":"deferred","../Util/sortBy":"sortBy","./Actor":"Actor","./ActorCommands":"ActorCommands"}],Actor:[function(e,t,r){"use strict";cc._RF.push(t,"0f7e5a5k95Pf7lAivaji58r","Actor");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.isStatefulActorComponent=r.isActorCommandOptions=void 0;var p=u(e("../Generic/AudioPlayer")),f=u(e("./CharacterController")),d=u(e("../Util/NodeUtils")),h=u(e("../Generic/CameraRig")),y=cc._decorator,g=y.ccclass,_=y.property,m=y.menu,b=1e3;function v(e){return"function"==typeof e.getActorComponentState&&"function"==typeof e.applyActorComponentState}r.isActorCommandOptions=function(e){return"object"==typeof e&&null!==e&&"boolean"==typeof e.instant},r.isStatefulActorComponent=v;var w=function(e){function t(){var t=e.call(this)||this;return t._skeleton=null,t._animator=null,t._audio=null,t._character=null,t._tag="",t._paused=!1,t._lastPlayedSpineAudio={clipName:"",track:0,timestamp:0},t._playSpineAudioEvents=function(e,r){if("number"==typeof r.volume&&r.volume>0&&r.data&&r.data.audioPath&&"string"==typeof r.data.audioPath&&t.audio&&t.audio.enabledInHierarchy){var n=Date.now(),o=r.volume,i=r.data.audioPath,a=e.trackIndex,c=i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."));if(t.audio.hasClip(c)){var s=t._lastPlayedSpineAudio;s.clipName===c&&n-s.timestamp<b||(s.clipName=c,s.track=a,s.timestamp=n,t.playAudioClip({track:e.trackIndex,clip:c,loop:!1,volume:o}))}}},t._registerActor(),t}var r;return o(t,e),r=t,Object.defineProperty(t,"all",{get:function(){return this.getActorsTagged()},enumerable:!1,configurable:!0}),t.getActorsTagged=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=[],i=[];try{for(var a=c(this._all),s=a.next();!s.done;s=a.next()){var l=s.value;if(cc.isValid(l.node,!0)&&d.default.isDescendentOf(l.node,cc.director.getScene())){var u=0===r.length||r.includes(l.tag);u&&(i.includes(l.node)||(i.push(l.node),o.push(l)))}}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return o},Object.defineProperty(t.prototype,"skeleton",{get:function(){return cc.isValid(this._skeleton)||(this._skeleton=this._getActorComponent(sp.Skeleton)),this._skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animator",{get:function(){return cc.isValid(this._animator)||(this._animator=this._getActorComponent(cc.Animation)),this._animator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"audio",{get:function(){return cc.isValid(this._audio)||(this._audio=this._getActorComponent(p.default)),this._audio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"character",{get:function(){return cc.isValid(this._character)||(this._character=this._getActorComponent(f.default)),this._character},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tag",{get:function(){return this._tag},set:function(){throw new Error('"tag" is a readonly property.')},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){if(this.skeleton&&(this.skeleton.paused=e),this.audio&&(this.audio.paused=e),this.audio&&e&&this.audio.stopAllClips(),this.character&&(this.character.paused=e),e?this.node.pauseAllActions():this.node.resumeAllActions(),this.animator){var t=e?"pause":"resume";this.animator[t]()}this._paused=e},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.skeleton&&this.skeleton.setEventListener(this._playSpineAudioEvents)},t.prototype.onDestroy=function(){this._unregisterActor()},t.prototype.executeCommand=function(e,t){return this[e.command](e,t)},t.prototype.playSpineClip=function(e,t){if(this.enabledInHierarchy&&this.skeleton){var r=e.track,n=e.clip,o=e.loop,i=e.blend,a=void 0===i?0:i,c=e.alpha,s=void 0===c?1:c,l=this.skeleton.findAnimation(n);if(l){var u=this.skeleton.setAnimation(r,n,o);u.mixDuration=a,u.alpha=cc.misc.clamp01(s);var p=this._getOptionsTime(t,l.duration);(p>0||a>0)&&this._updateTrackToTime(r,p)}}},t.prototype.clearSpineTrack=function(e,t){if(this.enabledInHierarchy&&this.skeleton){var r=e.track,n=e.blend,o=this.skeleton.getState();if(o){o.setEmptyAnimation(r,n);var i=this._getOptionsTime(t,n);(i>0||n>0)&&this._updateTrackToTime(r,i)}}},t.prototype.playAnimationClip=function(e,t){if(this.enabledInHierarchy&&this.animator){var r=e.clip,n=this.animator.getClips().find(function(e){return e&&e.name===r});if(n){this.animator.play(n.name);var o=this._getOptionsTime(t,n.duration);o>0&&this.animator.setCurrentTime(o,n.name)}}},t.prototype.playAudioClip=function(e,t){if(this.enabledInHierarchy&&this.audio&&!(this.audio.locked||this.audio.paused||this._getOptionsTime(t)>0)){var r=e.clip,n=e.track,o=e.volume,i=e.loop;this.audio.playClip(r,n,o,i)}},t.prototype.clearAudioTrack=function(e){if(this.enabledInHierarchy&&this.audio){var t=e.track;this.audio.stopTrack(t)}},t.prototype.transform=function(e,t){var r,n,o,i;if(this.enabledInHierarchy){var a=d.default.resolveNode(e.node);if(a){var s=e.channel,l=e.easing,u=e.duration,p="string"==typeof s?[s]:s,f=p.includes("x")||p.includes("y")?this.node.parent.convertToNodeSpaceAR(a.convertToWorldSpaceAR(cc.Vec2.ZERO)):cc.Vec2.ZERO,h={};try{for(var y=c(p),g=y.next();!g.done;g=y.next()){var _=g.value;h[_]="x"===_||"y"===_?f[_]:a[_]}}catch(C){r={error:C}}finally{try{g&&!g.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}var m=this._getOptionsTime(t,u);if(this.node.stopActionByTag(80085),m>=u)try{for(var b=c(p),v=b.next();!v.done;v=b.next()){var w=v.value;this.node[w]=h[w]}}catch(P){o={error:P}}finally{try{v&&!v.done&&(i=b.return)&&i.call(b)}finally{if(o)throw o.error}}else{var O="linear"===l?void 0:{easing:l},S=cc.tween(this.node).to(u,h,O).tag(80085).start();m>0&&(S._finalAction._firstTick=!1,S._finalAction.step(m))}}}},t.prototype.setParent=function(e){if(this.enabledInHierarchy){var t=d.default.resolveNode(e.node);if(t){var r=h.default.getCameraOffsets(this.node,t),n=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),o=t.convertToNodeSpaceAR(n).add(cc.v2(r.position));this.node.setParent(t),this.node.setPosition(o),this.node.scale*=r.scale,this.node.angle+=r.angle,this.node.group!==t.group&&(cc.warn(this.node.name+' group changed from "'+this.node.group+'" to match target '+t.name+' group "'+t.group+'"'),d.default.changeGroup(this.node,this.node.group,t.group));for(var i=e.childIndex;i<0;)i+=t.childrenCount;this.node.setSiblingIndex(i)}}},t.prototype.setEnabled=function(e){var t=e.component?this.getComponent(e.component)||this.getComponentInChildren(e.component):this;t&&(t.enabled=e.enabled),t===this&&(this.node.active=t.enabled)},t.prototype.invokeMethod=function(e){if(this.enabledInHierarchy){var t=this.getComponent(e.component)||this.getComponentInChildren(e.component);t&&"function"==typeof t[e.method]&&t[e.method].apply(t,l(e.args))}},t.prototype.setCharacterFacing=function(e,t){if(this.enabledInHierarchy&&this.character){var r=e.direction,n=e.track;this.character.track=n,this.character.setState({state:f.default.State.IDLE,facing:r},t)}},t.prototype.moveCharacter=function(e,t){if(this.enabledInHierarchy&&this.character){var r=e.node,n=e.throttle,o=e.track;this.character.track=o,this.character.setState({state:f.default.State.MOVE,target:d.default.resolveNode(r),throttle:n},t)}},t.prototype.getActorState=function(){var e,t,n=this,o=d.default.getNodeState(this.node,function(e){return!!n.animator&&!e.getComponent(r)}),i=new Map;try{for(var a=c(this._getActorComponents(cc.Component)),s=a.next();!s.done;s=a.next()){var l=s.value;v(l)&&i.set(l,l.getActorComponentState())}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{node:o,components:i}},t.prototype.applyActorState=function(e){var t,r;this.node.stopActionByTag(80085),this.skeleton&&(this.skeleton.clearTracks(),this.skeleton.setToSetupPose()),this.animator&&this.animator.stop(),d.default.applyNodeState(this.node,e.node),this.enabled=this.node.active;try{for(var n=c(e.components),o=n.next();!o.done;o=n.next()){var i=s(o.value,2),a=i[0],l=i[1];cc.isValid(a)&&a.applyActorComponentState(l)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t.prototype._registerActor=function(){r._all.includes(this)||r._all.push(this)},t.prototype._unregisterActor=function(){var e=r._all.indexOf(this);e>-1&&r._all.splice(e,1)},t.prototype._getActorComponent=function(e,t){var n,o;void 0===t&&(t=this.node);var i=t.getComponent(e);if(!i)try{for(var a=c(t.children),s=a.next();!s.done;s=a.next()){var l=s.value;if(!l.getComponent(r)&&(i=this._getActorComponent(e,l)))break}}catch(u){n={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},t.prototype._getActorComponents=function(e,t){var n,o;void 0===t&&(t=this.node);var i=t.getComponents(e);try{for(var a=c(t.children),s=a.next();!s.done;s=a.next()){var u=s.value;u.getComponent(r)||i.push.apply(i,l(this._getActorComponents(e,u)))}}catch(p){n={error:p}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},t.prototype._updateTrackToTime=function(e,t){if(this.skeleton){var r=this.skeleton.getState();if(r){var n=r.tracks,o=n.map(function(t,r){return r===e?t:null});r.tracks=o;var i=t-o[e].trackTime;r.update(i),r.apply(this.skeleton._skeleton),r.tracks=n,this.skeleton.paused&&(this.skeleton.paused=!1,this.skeleton.update(0),this.skeleton.paused=!0)}}},t.prototype._getOptionsTime=function(e,t){return void 0===t&&(t=1/0),e&&e.instant?"number"==typeof e.instant?Math.min(t,e.instant):t:0},t._all=[],i([_(),a("design:type",Object)],t.prototype,"_tag",void 0),i([_({tooltip:"Actor will only be given commands if they're scoped with this actor tag.\n\nIf left blank, this actor will receive no commands."}),a("design:type",String),a("design:paramtypes",[String])],t.prototype,"tag",null),r=i([g,m("Actor Component/Actor"),a("design:paramtypes",[])],t)}(cc.Component);r.default=w,cc._RF.pop()},{"../Generic/AudioPlayer":"AudioPlayer","../Generic/CameraRig":"CameraRig","../Util/NodeUtils":"NodeUtils","./CharacterController":"CharacterController"}],AudioPlayer:[function(e,t,r){"use strict";cc._RF.push(t,"9ede2o5HJNMlKwKvceYAK0E","AudioPlayer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.isAudioClipMeta=r.AUDIO_CLIP_CATEGORIES=void 0;var p=u(e("../Framework/GameComponent")),f=cc._decorator,d=f.ccclass,h=f.disallowMultiple,y=f.property,g=f.menu,_=["voice","music","sfx"];function m(e){if("object"!=typeof e||null===e)return!1;if("category"in e){var t=e.category;if(!_.includes(t))return!1}return!("caption"in e&&"string"!=typeof e.caption)}r.AUDIO_CLIP_CATEGORIES=_,r.isAudioClipMeta=m;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._masterVolume=1,t._voiceVolume=1,t._musicVolume=1,t._sfxVolume=1,t._persist=!1,t._clips=[],t._clipsCache=null,t._meta=[],t._metaCache=null,t._locked=!1,t._playingClipsMeta=new Set,t}return o(t,e),Object.defineProperty(t.prototype,"masterVolume",{get:function(){return this._masterVolume},set:function(e){this._masterVolume=cc.misc.clamp01(e),this._updatePlayingClipsVolume()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"voiceVolume",{get:function(){return this._voiceVolume},set:function(e){this._voiceVolume=cc.misc.clamp01(e),this._updatePlayingClipsVolume()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"musicVolume",{get:function(){return this._musicVolume},set:function(e){this._musicVolume=cc.misc.clamp01(e),this._updatePlayingClipsVolume()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sfxVolume",{get:function(){return this._sfxVolume},set:function(e){this._sfxVolume=cc.misc.clamp01(e),this._updatePlayingClipsVolume()},enumerable:!1,configurable:!0}),t.prototype._setClipsCache=function(){var e=this,t=this._clips.filter(function(e){return e}).reduce(function(t,r){var n=r.name;return t[n]instanceof cc.AudioClip?cc.warn(e.name+": Duplicate cc.AudioClip name: "+n+" will be ignored."):r instanceof cc.AudioClip?t[n]=r:cc.warn(e.name+": Value was not a cc.AudioClip: "+n+" will be ignored."),t},{});return this._clipsCache=t,t},Object.defineProperty(t.prototype,"clips",{get:function(){return null===this._clipsCache?this._setClipsCache():this._clipsCache},enumerable:!1,configurable:!0}),t.prototype._setMetaCache=function(){var e=this,t=this._meta.reduce(function(t,r){var n,o,i=r.json;try{for(var a=c(Object.keys(i)),s=a.next();!s.done;s=a.next()){var l=s.value;"string"==typeof t[l]?cc.warn(e.name+": Duplicate meta key: "+l+" will be ignored."):m(i[l])?t[l]=i[l]:cc.warn(e.name+": Nonstring caption provided: "+l+" will be ignored.")}}catch(u){n={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return t},{});return this._metaCache=t,t},Object.defineProperty(t.prototype,"rawMeta",{get:function(){return l(this._meta)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"meta",{get:function(){return null===this._metaCache?this._setMetaCache():this._metaCache},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"locked",{get:function(){return this._locked},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._setClipsCache(),this._setMetaCache()},t.prototype.onEnable=function(){var e,t;if(cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,this._beforeUpdate,this),!this._locked)try{for(var r=c(this._playingClipsMeta),n=r.next();!n.done;n=r.next()){var o=n.value;this.resumeClip(o.id)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this._syncSpringRollVolume()},t.prototype.onDisable=function(){var e,t;if(cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,this._beforeUpdate,this),!this._locked)try{for(var r=c(this._playingClipsMeta),n=r.next();!n.done;n=r.next()){var o=n.value;this.pauseClip(o.id)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.onDestroy=function(){var e,t;try{for(var r=c(this._playingClipsMeta),n=r.next();!n.done;n=r.next()){var o=n.value;this.stopClip(o.id)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.onSceneEnd=function(e){this.node.parent===e&&this._persist&&this._playingClipsMeta.size>0&&(this._locked=!0,cc.game.addPersistRootNode(this.node))},t.prototype.onSceneStart=function(){cc.game.removePersistRootNode(this.node)},t.prototype._checkLock=function(){this._locked&&(this._playingClipsMeta.size>0||(this._locked=!1,this.node.destroy()))},t.prototype.playClip=function(e,t,r,n){var o=this;if(void 0===t&&(t=0),void 0===r&&(r=1),void 0===n&&(n=!1),this.locked)throw new Error(this.name+": Cannot play any clips. It is locked.");var i="string"==typeof e?e:"string"==typeof t?t:"",a="number"==typeof t?t:0,c=this.getClip(i);if(!c)throw new Error(this.name+": AudioClip with name: "+i+" does not exist and can not be played.");if(!Number.isInteger(a))throw new Error(this.name+": Track provided to play AudioClip with name: "+i+" should be an integer. Received: "+a);r=cc.misc.clamp01(r),n=!0===n;var s=this.getCaption(i)||void 0,l=this.getCategory(i)||void 0,u=cc.audioEngine.play(c,n,this._calculateVolume(r,l));if(this._playingClipsMeta.add({id:u,track:a,clip:c,name:i,volume:r,caption:s,category:l}),cc.audioEngine.setFinishCallback(u,function(){return o.stopClip(u)}),s&&gm.loaded){var p=cc.audioEngine.getDuration(u);gm.captions.showCaption(s,p)}return u},Object.defineProperty(t.prototype,"playingClips",{get:function(){return Array.from(this._playingClipsMeta).map(function(e){return e.clip})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return!this.enabled},set:function(e){this.enabled=!e},enumerable:!1,configurable:!0}),t.prototype.stopClip=function(e,t){var r,n,o=this._getClipNameOrAudioId(e,t);if(cc.isValid(this)){var i=this._getPlayingClipMetas(o);if(0===i.length)throw new Error(this.name+": AudioClip with name or id: "+o+" is not playing and can not be stopped.");try{for(var a=c(i),s=a.next();!s.done;s=a.next()){var l=s.value,u=l.id;cc.audioEngine.stop(u),this._playingClipsMeta.delete(l)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}},t.prototype.pauseClip=function(e,t){var r,n,o=this._getClipNameOrAudioId(e,t),i=this._getPlayingClipMetas(o);try{for(var a=c(i),s=a.next();!s.done;s=a.next()){var l=s.value.id;cc.audioEngine.pause(l)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.prototype.resumeClip=function(e,t){var r,n;if(this.locked)throw new Error(this.name+": Cannot play resume any clips. It is locked.");var o=this._getClipNameOrAudioId(e,t),i=this._getPlayingClipMetas(o);try{for(var a=c(i),s=a.next();!s.done;s=a.next()){var l=s.value.id;cc.audioEngine.resume(l)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.prototype.clipIsPlaying=function(e,t){var r=this._getClipNameOrAudioId(e,t);return this._getPlayingClipMetas(r).length>0},t.prototype.clipIsPaused=function(e,t){var r=this._getClipNameOrAudioId(e,t);return this._getPlayingClipMetas(r).some(function(e){return cc.audioEngine.getState(e.id)===cc.audioEngine.AudioState.PAUSED})},t.prototype.stopTrack=function(e){var t,r,n=Array.from(this._playingClipsMeta).filter(function(t){return t.track===e});try{for(var o=c(n),i=o.next();!i.done;i=o.next()){var a=i.value;this.stopClip(a.id)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.stopAllClips=function(){var e,t;try{for(var r=c(this._playingClipsMeta.values()),n=r.next();!n.done;n=r.next()){var o=n.value;this.stopClip(o.id)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.getPlayingTrack=function(e){var t=s(this._getPlayingClipMetas(e),1)[0];if(!t)throw new Error(this.name+": AudioClip with id: "+e+" is not playing and has no track.");return t.track},t.prototype.getPlayingTrackClips=function(e){return Array.from(this._playingClipsMeta).filter(function(t){return t.track===e}).map(function(e){return e.clip})},t.prototype.setClips=function(e){var t,r;this._clips=e,this._setClipsCache();try{for(var n=c(this._playingClipsMeta),o=n.next();!o.done;o=n.next()){var i=o.value.name;this.hasClip(i)||this.stopClip(i)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t.prototype.hasClip=function(e){return this.clips[e]instanceof cc.AudioClip},t.prototype.getClip=function(e){return this.clips[e]||null},t.prototype.setMeta=function(e){this._meta=e,this._setMetaCache()},t.prototype.hasCaption=function(e){var t=this.meta[e];return"string"==typeof(t&&t.caption)},t.prototype.getCaption=function(e){var t=this.meta[e];return t&&t.caption||null},t.prototype.hasCategory=function(e){var t=this.meta[e];return!!t&&!!t.category&&_.includes(t.category)},t.prototype.getCategory=function(e){var t=this.meta[e];return t&&t.category&&_.includes(t.category)?t.category:null},t.prototype._beforeUpdate=function(){this._syncSpringRollVolume(),this._checkLock()},t.prototype._getClipNameOrAudioId=function(e,t){var r="string"==typeof e||"number"==typeof e?e:t;if(void 0===r)throw new Error("Could not get clip name or play id");return r},t.prototype._calculateVolume=function(e,t){var r;switch(t){case"music":r=this.musicVolume;break;case"sfx":r=this.sfxVolume;break;case"voice":r=this.voiceVolume;break;default:r=1}return cc.misc.clamp01(e*r*this.masterVolume)},t.prototype._updatePlayingClipsVolume=function(){var e,t;try{for(var r=c(this._playingClipsMeta),n=r.next();!n.done;n=r.next()){var o=n.value,i=o.id,a=o.volume,s=o.category,l=this._calculateVolume(a,s);cc.audioEngine.setVolume(i,l)}}catch(u){e={error:u}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._getPlayingClipMetas=function(e){return Array.from(this._playingClipsMeta).filter(function(t){return t.id===e||t.name===e})},t.prototype._syncSpringRollVolume=function(){if(gm.loaded){var e=gm.springroll.state;this.musicVolume!==e.musicVolume.value&&(this.musicVolume=e.musicVolume.value),this.sfxVolume!==e.sfxVolume.value&&(this.sfxVolume=e.sfxVolume.value),this.voiceVolume!==e.voVolume.value&&(this.musicVolume=e.voVolume.value),this.masterVolume!==e.soundVolume.value&&(this.masterVolume=e.soundVolume.value)}},i([y({min:0,max:1,visible:!0,slide:!0,tooltip:"Available for logical purity, but practically this will be overwritten by springroll settings at runtime."}),a("design:type",Object)],t.prototype,"_masterVolume",void 0),i([y({min:0,max:1,visible:!0,slide:!0,tooltip:"Available for logical purity, but practically this will be overwritten by springroll settings at runtime."}),a("design:type",Object)],t.prototype,"_voiceVolume",void 0),i([y({min:0,max:1,visible:!0,slide:!0,tooltip:"Available for logical purity, but practically this will be overwritten by springroll settings at runtime."}),a("design:type",Object)],t.prototype,"_musicVolume",void 0),i([y({min:0,max:1,visible:!0,slide:!0,tooltip:"Available for logical purity, but practically this will be overwritten by springroll settings at runtime."}),a("design:type",Object)],t.prototype,"_sfxVolume",void 0),i([y({tooltip:"Audio player should persist across scene boundaries if audio is not finished playing.",visible:function(){return this.node.parent===cc.director.getScene()}}),a("design:type",Object)],t.prototype,"_persist",void 0),i([y({type:[cc.AudioClip],visible:!0}),a("design:type",Array)],t.prototype,"_clips",void 0),i([y({type:[cc.JsonAsset],visible:!0}),a("design:type",Array)],t.prototype,"_meta",void 0),i([d,g("Generic Component/AudioPlayer"),h],t)}(p.default);r.default=b,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent"}],AudioResourceLoader:[function(e,t,r){"use strict";cc._RF.push(t,"29a88VTryBAToejab6rQ6NA","AudioResourceLoader");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../Generic/AudioPlayer")),f=u(e("../Util/Decorators/cache")),d=u(e("../Framework/GameComponent")),h=cc._decorator,y=h.ccclass,g=h.menu,_=h.property,m=h.executeInEditMode;function b(e){return new Promise(function(t,r){return cc.assetManager.resources.loadDir(e,cc.AudioClip,function(e,n){e?r(e):t(n)})})}var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._resourceFolderPath="",t._loadedAudioClips=[],t}var r;return o(t,e),Object.defineProperty(t.prototype,"loadingComplete",{get:function(){return this._loadedAudioClips.length>0},enumerable:!1,configurable:!0}),t.prototype.onSceneStart=function(){return this._loadAudioClips()},t.prototype.onSceneEnd=function(){return this._releaseAudioClips()},t.prototype._loadAudioClips=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c,u;return s(this,function(s){switch(s.label){case 0:return[4,b(this._resourceFolderPath)];case 1:e=s.sent(),t=this._audioPlayer,r=t._clips,n=r.length,this._loadedAudioClips.length=0;try{for(o=l(e),i=o.next();!i.done;i=o.next())a=i.value,r.includes(a)||(a.addRef(),r.push(a),this._loadedAudioClips.push(a))}catch(p){c={error:p}}finally{try{i&&!i.done&&(u=o.return)&&u.call(o)}finally{if(c)throw c.error}}return r.length!==n&&t._setClipsCache(),[2]}})})},t.prototype._releaseAudioClips=function(){var e,t,r=this._loadedAudioClips,n=this._audioPlayer,o=n._clips,i=o.length;try{for(var a=l(r),c=a.next();!c.done;c=a.next()){for(var s=c.value,u=i-1;u>=0;u--)if(o[u]===s){o.splice(u,1);break}s.decRef()}}catch(p){e={error:p}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}r.length=0,o.length!==i&&n._setClipsCache()},i([_({visible:!0,tooltip:"Resource folder path to load form"}),a("design:type",Object)],t.prototype,"_resourceFolderPath",void 0),i([f.default({type:p.default,scope:"node"}),a("design:type","function"==typeof(r=void 0!==p.default&&p.default)?r:Object)],t.prototype,"_audioPlayer",void 0),i([y,m,g("Generic Component/Audio Resource Loader")],t)}(d.default);r.default=v,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Generic/AudioPlayer":"AudioPlayer","../Util/Decorators/cache":"cache"}],BubbleParticle:[function(e,t,r){"use strict";cc._RF.push(t,"fbda9U9ArRIx7M9WQg8G7yA","BubbleParticle");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},p=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var d=f(e("./Particle")),h=f(e("../Generic/Velocity")),y=f(e("../Util/RandomUtil")),g=f(e("../Util/Decorators/cache")),_=f(e("../Generic/Temporary")),m=f(e("../Util/EventHandlerUtils")),b=cc._decorator,v=b.ccclass,w=b.property,O=cc.Animation.EventType.FINISHED,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._speed=20,t._floatFrequency=1,t._poppedSplatPrefabs=[],t._poppedScale=1.2,t._poppedOpacity=200,t._released=!1,t}var r;return o(t,e),Object.defineProperty(t.prototype,"poppedScale",{get:function(){return this._poppedScale*this.node.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"poppedOpacity",{get:function(){return Math.round(this._poppedOpacity)},enumerable:!1,configurable:!0}),t.prototype.onEmit=function(){this._setChildrenSize(),this.mover.velocity=this.velocity.clone(),this._randomizeTargetVelocity(),this.schedule(this._randomizeTargetVelocity,this._floatFrequency,cc.macro.REPEAT_FOREVER);var e=this.animator&&this.animator.getClips().find(function(e){return e&&e.name.includes("Idle")});this.animator&&e&&this.animator.play(e.name)},t.prototype.onRelease=function(){this._released=!0,this.unschedule(this._randomizeTargetVelocity),this.animator&&this.animator.stop();var e=this.getComponent(_.default);e&&(e.enabled=!1)},t.prototype.onUse=function(e,t){this._released=!1;var r=t.data.getComponent(_.default);if(r){var n=this.getComponent(_.default)||this.addComponent(_.default);n._defaultOnDestroyEventSet=!0,n.enabled=r.enabled,n.onDestroyEvents=[m.default.create({target:this.node,component:this,handler:"pop"})],n.reset.apply(n,u(r.lifetimeRange))}},t.prototype.pop=function(){return c(this,void 0,Promise,function(){var e,t,r,n;return s(this,function(o){switch(o.label){case 0:return!cc.isValid(this)||this._released?[2]:(e=this._createPoppedSplat(),t=this.animator,r=t&&t.getClips().find(function(e){return e&&e.name.includes("Pop")}),t&&r?(t.play(r.name),this._tweenShowPoppedSplat(e,r.duration),[4,new Promise(function(e){return t.once(O,e)})]):[3,2]);case 1:o.sent(),o.label=2;case 2:return n=this.drawing,this.release(),setTimeout(function(){cc.isValid(n)&&n.addSplats([e])}),[2]}})})},t.prototype._setChildrenSize=function(){var e,t,r,n,o=this.node.width/512;try{for(var i=p(this.node.children),a=i.next();!a.done;a=i.next()){var c=a.value,s=c.getComponentsInChildren(cc.Widget);if(s.length>0)try{for(var l=(r=void 0,p(s)),u=l.next();!u.done;u=l.next())u.value.updateAlignment()}catch(f){r={error:f}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}else c.scale*=o}}catch(d){e={error:d}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype._randomizeTargetVelocity=function(){this.mover.targetVelocity=y.default.v2(this._speed)},t.prototype._createPoppedSplat=function(){if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");var e=gm.drawings.useSplat(y.default.item(this._poppedSplatPrefabs));return e.setParent(this.node.parent),e.setPosition(this.node.position),e.setContentSize(this.node.getContentSize()),e.setSiblingIndex(0),e.color=this.node.color.clone(),e.scale=this.poppedScale*this.node.scale,e.opacity=this.poppedOpacity,e.angle=y.default.float(-360,360),e},t.prototype._tweenShowPoppedSplat=function(e,t){var r=this.poppedScale,n=this.poppedOpacity;e.scale*=.25,e.opacity=0,cc.tween(e).to(t,{scale:r,opacity:n}).start()},i([g.default({type:h.default}),a("design:type","function"==typeof(r=void 0!==h.default&&h.default)?r:Object)],t.prototype,"mover",void 0),i([g.default({type:cc.Animation,required:!1}),a("design:type",Object)],t.prototype,"animator",void 0),i([w({min:0,max:100,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_speed",void 0),i([w({tooltip:"Number of seconds it takes for the bubble to change directions",min:.25,max:5,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_floatFrequency",void 0),i([w({visible:!0,type:cc.Prefab}),a("design:type",Array)],t.prototype,"_poppedSplatPrefabs",void 0),i([w({min:.5,max:2,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_poppedScale",void 0),i([w({min:0,max:255,step:1,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_poppedOpacity",void 0),i([v],t)}(d.default);r.default=S,cc._RF.pop()},{"../Generic/Temporary":"Temporary","../Generic/Velocity":"Velocity","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","../Util/RandomUtil":"RandomUtil","./Particle":"Particle"}],BuildPreProcessable:[function(e,t,r){"use strict";cc._RF.push(t,"a6c43qKpH9EI4QjvzYAQAl/","BuildPreProcessable"),Object.defineProperty(r,"__esModule",{value:!0}),cc._RF.pop()},{}],BuildPreprocessCheck:[function(e,t,r){"use strict";cc._RF.push(t,"b45d7GFU0dPDauyYmkQRIJk","BuildPreprocessCheck");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(r,"__esModule",{value:!0});var c,s=cc._decorator,l=s.ccclass,u=s.property;(function(e){e[e.COLOR=0]="COLOR",e[e.PREFAB=1]="PREFAB",e[e.SETACTIVE=2]="SETACTIVE"})(c||(c={}));var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._applyToDebug=!1,t._checkType=c.COLOR,t._targetColor=cc.Color.RED,t._targetPrefab=null,t}return o(t,e),t.prototype.onBuildPreProcess=function(e){return!(e&&!this._applyToDebug||(this._checkType===c.COLOR?(this.node.color=this._targetColor.clone(),0):this._checkType!==c.SETACTIVE||(this.node.active="Debug"===this.node.name&&e||"Production"===this.node.name&&!e,0)))},t.prototype.onLoad=function(){if(this._checkType===c.PREFAB){if(!this._targetPrefab)throw new Error("BuildPreProcessCheck prefab not set");var e=this.node.getChildByName("Check");if(!e)throw new Error("Missing Check node.");var t=cc.instantiate(this._targetPrefab);e.active=0===t.childrenCount&&0===t.getComponents(cc.Component).length}},i([u({visible:!0}),a("design:type",Boolean)],t.prototype,"_applyToDebug",void 0),i([u({visible:!0,type:cc.Enum(c)}),a("design:type",Number)],t.prototype,"_checkType",void 0),i([u({visible:function(){return this._checkType===c.COLOR}}),a("design:type",Object)],t.prototype,"_targetColor",void 0),i([u({visible:function(){return this._checkType===c.PREFAB},type:cc.Prefab}),a("design:type",Object)],t.prototype,"_targetPrefab",void 0),i([l],t)}(cc.Component);r.default=p,cc._RF.pop()},{}],ButtonAsynchronizer:[function(e,t,r){"use strict";cc._RF.push(t,"73f00ZFyndOv6gTh3ybHGk1","ButtonAsynchronizer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},p=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var d=f(e("../Util/Decorators/cache")),h=f(e("../Util/EventHandlerUtils")),y=cc._decorator,g=y.menu,_=y.ccclass,m=y.property,b=y.disallowMultiple,v=y.requireComponent,w=y.executeInEditMode,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.syncNode=null,t.asyncNode=null,t.clickEvents=[],t.sequential=!0,t}var r,n;return o(t,e),r=t,t.getClickEvents=function(e){return(e.getComponent(r)||e).clickEvents},t.prototype.executeClickEvents=function(e){return c(this,void 0,Promise,function(){var t,r;return s(this,function(n){switch(n.label){case 0:t=this.button.interactable,this.button.interactable=!1,this._updateActiveNodes(!0),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,h.default.emit(this.clickEvents,e,this.sequential)];case 2:return n.sent(),cc.isValid(this)?[3,4]:[2];case 3:return r=n.sent(),cc.error(r),[3,4];case 4:return this.button.interactable=t,this._updateActiveNodes(!1),[2]}})})},t.prototype.onLoad=function(){this._ensureEventHandler()},t.prototype.onDestroy=function(){try{this.button.clickEvents=u(this.clickEvents)}catch(e){if(!e.message.includes("requires"))throw e}},t.prototype._updateActiveNodes=function(e){this.asyncNode&&(this.asyncNode.active=e),this.syncNode&&(this.syncNode.active=!e)},t.prototype._editorUpdate=function(){this._updateActiveNodes(!1),this._ensureEventHandler()},t.prototype._ensureEventHandler=function(){var e,t,r=this.button.clickEvents,n={target:this.node,component:this,handler:"executeClickEvents"};this.button.clickEvents=[h.default.create(n)];try{for(var o=p(r),i=o.next();!i.done;i=o.next()){var a=i.value;h.default.equals(a,n)||h.default.includes(a,this.clickEvents)||this.clickEvents.push(a)}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},i([d.default(cc.Button),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Button)?n:Object)],t.prototype,"button",void 0),i([m({tooltip:"Node, typically an icon, that should be active when the asynchronizer is NOT executing events.",type:cc.Node,visible:!0}),a("design:type",Object)],t.prototype,"syncNode",void 0),i([m({tooltip:"Node, typically an icon, that should be active when the asynchronizer IS executing events.",type:cc.Node,visible:!0}),a("design:type",Object)],t.prototype,"asyncNode",void 0),i([m({type:cc.Component.EventHandler}),a("design:type",Array)],t.prototype,"clickEvents",void 0),i([m({tooltip:"Each click event will be fired in order, rather than all at once."}),a("design:type",Object)],t.prototype,"sequential",void 0),r=i([_,b,w,v(cc.Button),g("Generic Component/Button Asynchronizer")],t)}(cc.Component);r.default=O,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils"}],ButtonHover:[function(e,t,r){"use strict";cc._RF.push(t,"1da98JGb95I2KIrlYuCjdFa","ButtonHover");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("../Util/Decorators/cache")),u=c(e("../Util/EventHandlerUtils")),p=cc._decorator,f=p.ccclass,d=p.property,h=p.menu,y=cc.Node.EventType,g=y.MOUSE_ENTER,_=y.MOUSE_LEAVE;(function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.SCALE=3]="SCALE"})(s||(s={}));var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.requireInteractable=!0,t.executeSequential=!1,t._transitionType=s.NONE,t._transitionTarget=null,t._transitionDuration=.25,t._transitionOpacity=125,t._transitionScale=1.25,t._transitionColor=cc.Color.WHITE,t.onHoverEvents=[],t.offHoverEvents=[],t._originalScale=1,t._originalOpacity=255,t._originalColor=cc.Color.WHITE,t._onHover=function(e){t.requireInteractable&&!t.button.interactable||(u.default.emit(t.onHoverEvents,e),t._handleTweening(!0))},t._offHover=function(e){t.requireInteractable&&!t.button.interactable||(u.default.emit(t.offHoverEvents,e),t._handleTweening(!1))},t}var r;return o(t,e),t.prototype.onLoad=function(){this._originalScale=this.node.scale,this._originalOpacity=this.node.opacity,this._originalColor=this.node.color.clone()},t.prototype.onEnable=function(){this.button.node.on(g,this._onHover),this.button.node.on(_,this._offHover)},t.prototype.onDisable=function(){this.button.node.off(g,this._onHover),this.button.node.off(_,this._offHover)},t.prototype._handleTweening=function(e){var t,r,n,o=this._transitionType;if(o!==s.NONE){var i=null!==(r=this._transitionTarget)&&void 0!==r?r:this.node,a=s[o].toLowerCase(),c=this._getTweenTargetValue(e,o),l=null===(n=i.getActionByTag(696969))||void 0===n?void 0:n._originProps;l&&l[a]===c||(l&&i.stopActionByTag(696969),cc.tween(i).tag(696969).to(this._transitionDuration,(t={},t[a]=c,t)).start())}},t.prototype._getTweenTargetValue=function(e,t){switch(void 0===t&&(t=this._transitionType),t){case s.OPACITY:return e?this._transitionOpacity:this._originalOpacity;case s.COLOR:return e?this._transitionColor.clone():this._originalColor.clone();case s.SCALE:return e?this._transitionScale:this._originalScale;case s.NONE:throw new Error(s.NONE+" does not have a target value.");default:throw new Error(s[t]+" is not a recognized HoverType.")}},i([d({tooltip:"Hover events will only fire if the button is interactable"}),a("design:type",Object)],t.prototype,"requireInteractable",void 0),i([d({tooltip:"Hover events, if asyncronous, will wait until the previous is finished executing before executing themselves."}),a("design:type",Object)],t.prototype,"executeSequential",void 0),i([d({type:cc.Enum(s),visible:!0,formerlySerializedAs:"_tweenType",displayName:"Transition"}),a("design:type",Number)],t.prototype,"_transitionType",void 0),i([d({visible:function(){return this._transitionType!==s.NONE},formerlySerializedAs:"_tweenNode",type:cc.Node}),a("design:type",Object)],t.prototype,"_transitionTarget",void 0),i([d({min:0,max:1,slide:!0,visible:function(){return this._transitionType!==s.NONE}}),a("design:type",Object)],t.prototype,"_transitionDuration",void 0),i([d({step:1,min:0,max:255,slide:!0,formerlySerializedAs:"_tweenOpacity",visible:function(){return this._transitionType===s.OPACITY}}),a("design:type",Object)],t.prototype,"_transitionOpacity",void 0),i([d({visible:function(){return this._transitionType===s.SCALE}}),a("design:type",Object)],t.prototype,"_transitionScale",void 0),i([d({visible:function(){return this._transitionType===s.COLOR}}),a("design:type",Object)],t.prototype,"_transitionColor",void 0),i([d({type:cc.Component.EventHandler}),a("design:type",Array)],t.prototype,"onHoverEvents",void 0),i([d({type:cc.Component.EventHandler}),a("design:type",Array)],t.prototype,"offHoverEvents",void 0),i([l.default(cc.Button),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Button)?r:Object)],t.prototype,"button",void 0),i([f,h("UI Component/Button Hover")],t)}(cc.Component);r.default=m,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils"}],ButtonTrigger:[function(e,t,r){"use strict";cc._RF.push(t,"5488fqKt/dE44gWWXtwtgS8","ButtonTrigger");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("./Trigger")),u=s(e("../Util/EventHandlerUtils")),p=s(e("../Generic/ButtonAsynchronizer")),f=s(e("../Util/getComponentsInScene")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.executeInEditMode,_=d.menu,m=(cc.js.getClassName,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._button=null,t}var r;return o(t,e),r=t,t.getTriggerForButton=function(e){var t,n;try{for(var o=c(p.default.getClickEvents(e)),i=o.next();!i.done;i=o.next()){var a=i.value,s=a.target&&a.target.getComponent(r);if(s&&"tryExecute"===a.handler)return s}}catch(l){t={error:l}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return null},Object.defineProperty(t.prototype,"button",{get:function(){return this._button},set:function(e){this._button=e,this._initializeButton()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._initializeButton()},t.prototype.start=function(){this._setButtonInteractable()},t.prototype.update=function(){this._setButtonInteractable()},t.prototype._setButtonInteractable=function(){this.button&&(this.button.interactable=!this.isExecuting&&this.check())},t.prototype._initializeButton=function(){var e,t,n=this;if(cc.isValid(this._button)){var o=f.default(r).filter(function(e){return e!==n&&e.button===n._button});try{for(var i=c(o),a=i.next();!a.done;a=i.next())a.value.button=null}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}var s=p.default.getClickEvents(this._button);s.length=0,s.push(u.default.create({target:this.node,component:this,handler:"tryExecute"}))}},i([y({type:cc.Button}),a("design:type",Object)],t.prototype,"_button",void 0),i([y({visible:!0,type:cc.Button}),a("design:type",Object),a("design:paramtypes",[Object])],t.prototype,"button",null),r=i([h,g,_("Trigger Component/Button Trigger")],t)}(l.default));r.default=m,cc._RF.pop()},{"../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Util/EventHandlerUtils":"EventHandlerUtils","../Util/getComponentsInScene":"getComponentsInScene","./Trigger":"Trigger"}],CameraRig:[function(e,t,r){"use strict";cc._RF.push(t,"07450fP9SxAHZXaW2iWMXcK","CameraRig");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.CameraPresetType=void 0;var u,p=l(e("../Framework/GameComponent")),f=l(e("../Util/Decorators/cache")),d=l(e("../Util/getComponentInParents")),h=cc._decorator,y=h.ccclass,g=h.property,_=h.requireComponent,m=h.disallowMultiple,b=h.executeInEditMode,v=h.menu,w=cc.js.getClassName;(function(e){e[e.Custom=0]="Custom",e[e.Game=1]="Game",e[e.Debug=2]="Debug",e[e.UI=3]="UI"})(u||(u={})),r.CameraPresetType=u;var O=cc.Camera.ClearFlags.COLOR|cc.Camera.ClearFlags.DEPTH|cc.Camera.ClearFlags.STENCIL,S=new cc.Rect(0,0,1,1),C=new Map([[u.Game,{backgroundColor:cc.Color.WHITE,depth:-1,cullingMask:5,clearFlags:O,rect:S,alignWithScreen:!0}],[u.Debug,{backgroundColor:cc.Color.WHITE,depth:-1,cullingMask:21,clearFlags:O,rect:S,alignWithScreen:!0}],[u.UI,{backgroundColor:cc.Color.WHITE,depth:1,cullingMask:8,clearFlags:0,rect:S,alignWithScreen:!0}]]),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._disableBetweenScenes=!0,t._sceneHasStarted=!1,t._editorDefaultPresetApplied=!1,t}var r,n;return o(t,e),r=t,t.getMainCameraRig=function(){var e=cc.Camera.main.getComponent(r);if(!e)throw new Error(cc.Camera.main.node.name+" does not have a "+w(r));return e},t.getCameraRigForNode=function(e){var t=d.default(e,r);if(t||(t=cc.Camera.main.getComponent(r)),!t)throw new Error("Could not find "+w(r)+" for node "+e.name);return t},t.getCameraOffsets=function(e,t){var r=this.getCameraRigForNode(e),n=this.getCameraRigForNode(t),o=1/r.camera.zoomRatio/(1/n.camera.zoomRatio);return{position:r.node.position.sub(n.node.position).div(o),scale:o,angle:r.node.angle-n.node.angle}},Object.defineProperty(t.prototype,"preset",{get:function(){return this._determineEditorPreset()},set:function(e){this.applyPreset(e)},enumerable:!1,configurable:!0}),t.prototype.applyPreset=function(e){var t=C.get(e);return!!t&&(this.camera.backgroundColor=t.backgroundColor.clone(),this.camera.cullingMask=t.cullingMask,this.camera.depth=t.depth,this.camera.clearFlags=t.clearFlags,this.camera.rect=t.rect.clone(),this.camera.alignWithScreen=t.alignWithScreen,!0)},t.prototype.onGameStart=function(){this._sceneHasStarted||this._trySceneCameraSceneBoundaryEnabled(!1)},t.prototype.onSceneStart=function(){this._sceneHasStarted=!0,this._trySceneCameraSceneBoundaryEnabled(!0)},t.prototype.onSceneEnd=function(){this._sceneHasStarted=!1,this._trySceneCameraSceneBoundaryEnabled(!1)},t.prototype.onLoad=function(){cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this._matchZoomToScale,this)},t.prototype.onDestroy=function(){cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this._matchZoomToScale,this)},t.prototype.update=function(){},t.prototype._matchZoomToScale=function(){this.node.scaleY!==this.node.scaleX&&(this.node.scaleY=this.node.scaleX),this.camera.zoomRatio=Math.abs(1/this.node.scaleX)},t.prototype._trySceneCameraSceneBoundaryEnabled=function(e){this.preset===u.UI&&this._disableBetweenScenes&&(this.camera.enabled=e)},t.prototype._determineEditorPreset=function(){var e,t,r=this.camera;try{for(var n=c(C),o=n.next();!o.done;o=n.next()){var i=s(o.value,2),a=i[0],l=i[1];if(r.backgroundColor.equals(l.backgroundColor)&&r.depth===l.depth&&r.cullingMask===l.cullingMask&&r.clearFlags===l.clearFlags&&r.rect.equals(l.rect)&&r.alignWithScreen===l.alignWithScreen)return a}}catch(p){e={error:p}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return u.Custom},t.prototype.onBuildPreProcess=function(e){return!e&&this.preset===u.Debug&&this.applyPreset(u.Game)},i([g({visible:!0,type:cc.Enum(u)}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"preset",null),i([g({visible:function(){return this.preset===u.UI},tooltip:"Can prevent UI Cameras from overlaying unintended objects between scene transitions."}),a("design:type",Object)],t.prototype,"_disableBetweenScenes",void 0),i([f.default(cc.Camera),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Camera)?n:Object)],t.prototype,"camera",void 0),i([g({editorOnly:!0}),a("design:type",Object)],t.prototype,"_editorDefaultPresetApplied",void 0),r=i([y,m,_(cc.Camera),b,v("Other Component/Camera Rig")],t)}(p.default);r.default=P,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Util/Decorators/cache":"cache","../Util/getComponentInParents":"getComponentInParents"}],Captioner:[function(e,t,r){"use strict";cc._RF.push(t,"b1ad0BNUGVFc4Lqxr1jrcU0","Captioner");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./GameComponent")),l=c(e("../Util/Decorators/cache")),u=cc._decorator,p=u.ccclass,f=u.disallowMultiple,d=u.property,h=u.executionOrder,y=function(e,t,r){return void 0===r&&(r=t),e.length<=r?[e]:e.split("").reduce(function(n,o,i){var a=1===n.length?r:t;return i>=e.length-2?n[n.length-1]+=o:n[n.length-1].length<a-2?n[n.length-1]+=o:(n[n.length-1]+=o+"-",n.push("-")),n},[""])},g=function(e,t,r){return e.split(" ").reduce(function(e,n){var o=e[e.length-1],i=o.length>0?1:0,a=t-o.length-i;if(n.length<=a)e[e.length-1]=o+(o.length?" "+n:n);else if(n.length>=r&&a>=3){var c=y(n,t,a);e[e.length-1]=o+(o.length?" "+c[0]:c[0]),e=e.concat(c.slice(1))}else e=e.concat(y(n,t));return e},[""])},_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._hideHesitation=1,t._maxCharactersPerCaption=144,t}var r,n;return o(t,e),t.prototype.onGameLoad=function(){this.enabled=!1,this.clearCaptions()},t.prototype.onLoad=function(){this._maxCharactersPerCaption=this.text.string.length},t.prototype.onDisable=function(){this.clearCaptions()},Object.defineProperty(t.prototype,"hidden",{get:function(){return!this.container.enabled&&!this.text.enabled},set:function(e){this.container.enabled=!e,this.text.enabled=!e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentCaption",{get:function(){return this.hidden?"":this.text.string},enumerable:!1,configurable:!0}),t.prototype.showCaption=function(e,t){if(this.enabledInHierarchy&&e&&!(t<=0)){this.clearCaptions(),this.hidden=!1;for(var r=e.replace(/\s/g," ").replace(/\s+/g," ").trim(),n=Math.max(this._maxCharactersPerCaption,3),o=Math.max(Math.min(this._maxCharactersPerCaption,n),2),i=g(r,n,o),a=0;a<i.length;a++){var c=t/i.length*a,s=i[a];this._scheduleTextChange(s,c)}this._scheduleHide(t+this._hideHesitation)}},t.prototype.clearCaptions=function(){this.unscheduleAllCallbacks(),this.hidden=!0},t.prototype._scheduleTextChange=function(e,t){var r=this.text;t<=0?r.string=e:this.scheduleOnce(function(){r.string=e},t)},t.prototype._scheduleHide=function(e){var t=this;e<=0?this.hidden=!0:this.scheduleOnce(function(){t.hidden=!0},e)},i([d({tooltip:"Amount of time it takes for captions to disappear after they've been written.",visible:!0}),a("design:type",Object)],t.prototype,"_hideHesitation",void 0),i([l.default({type:cc.Sprite,scope:"children"}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Sprite)?r:Object)],t.prototype,"container",void 0),i([l.default({type:cc.Label,scope:"children"}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Label)?n:Object)],t.prototype,"text",void 0),i([p,f,h(-25)],t)}(s.default);r.default=_,cc._RF.pop()},{"../Util/Decorators/cache":"cache","./GameComponent":"GameComponent"}],CharacterController:[function(e,t,r){"use strict";cc._RF.push(t,"fe4009ehntHLq4tPxWIy/Xh","CharacterController");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterState=r.CharacterFacing=void 0;var p,f,d=u(e("../Util/Decorators/cache")),h=u(e("../Util/RandomUtil")),y=u(e("../Util/sortBy")),g=u(e("../Util/approximately")),_=cc._decorator,m=_.ccclass,b=_.property,v=_.menu,w=cc.misc,O=w.clamp01,S=w.lerp,C=Math.sign,P=Math.max,T=Math.round,j=Math.abs,R=y.default("speed");(function(e){e[e.SETUP=0]="SETUP",e[e.IDLE=1]="IDLE",e[e.MOVE=2]="MOVE"})(p||(p={})),r.CharacterState=p,function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(f||(f={})),r.CharacterFacing=f;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.idleAnimations=[],t.walkAnimation="",t.runAnimation="",t._track=0,t._moveSpeedMultiplier=1,t._currentState=p.IDLE,t._idleStateData={state:p.IDLE,facing:"right"},t._moveStateData={state:p.MOVE,target:null,throttle:.25},t._analyzedAnimations=new Map,t}var r;return o(t,e),Object.defineProperty(t.prototype,"track",{get:function(){return this._track},set:function(e){var t=T(P(e,0));this._switchCurrentAnimationToTrack(t),this._track=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_facing",{get:function(){return"left"===this._idleStateData.facing?f.Left:f.Right},set:function(){throw new Error("_facing is an inspector property.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_target",{get:function(){return this._moveStateData.target},set:function(){throw new Error("_world is an inspector property.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_throttle",{get:function(){return this._moveStateData.throttle},set:function(){throw new Error("_throttle is an inspector property.")},enumerable:!1,configurable:!0}),t.prototype.setState=function(e,t){switch(this._currentState=e.state,e.state){case p.SETUP:this._clearTrackEntry();break;case p.IDLE:this._idleStateData=i(i({},this._idleStateData),e),t&&t.instant&&this._ensureFacing(this._idleStateData.facing);break;case p.MOVE:this._moveStateData=i(i({},this._moveStateData),e),this._moveStateData.throttle=O(this._moveStateData.throttle),t&&t.instant&&this._updateMoveState("number"==typeof t.instant?t.instant:1/0,!1);break;default:throw new Error("State "+e+" is not recognized.")}},Object.defineProperty(t.prototype,"paused",{get:function(){return!this.enabled},set:function(e){this.enabled=!e},enumerable:!1,configurable:!0}),t.prototype.onDisable=function(){this.currentState!==p.SETUP&&this._clearTrackEntry()},t.prototype.update=function(e){if(this.skeleton.skeletonData)try{switch(this.currentState){case p.SETUP:break;case p.IDLE:this._updateIdleState();break;case p.MOVE:this._updateMoveState(e);break;default:var t=this.currentState;throw new Error("State "+t+" is not recognized.")}}catch(r){throw this.enabled=!1,r}},t.prototype._updateIdleState=function(){this.idleAnimations.length>0&&this._ensureAnimationPlaying(this.idleAnimations),this._ensureFacing(this._idleStateData.facing)},t.prototype._updateMoveState=function(e,t){void 0===t&&(t=!0);var r=this._moveStateData,n=r.target,o=r.throttle;if(!cc.isValid(n)||o<=0)return this.setState({state:p.IDLE});var i=this._getMoveAnimationData(),a=i.speed,c=i.animation,s=i.alpha;t&&this._ensurePlayingMoveAnimation(c,s),this._moveTowardTarget(n,a,e)},t.prototype._getMoveAnimationData=function(){var e=this._moveStateData.throttle,t=s([this._getAnalyzedAnimation(this.walkAnimation),this._getAnalyzedAnimation(this.runAnimation)].sort(R),2),r=t[0],n=t[1],o=S(0,n.speed,e),i=o<=r.speed?r:n,a=s(i===r?[0,r.speed]:[r.speed,n.speed],2),c=a[0],l=a[1],u=this.skeleton.node.scale;return{speed:o*j(u)*this._moveSpeedMultiplier,alpha:(o-c)/(l-c),animation:i.name}},t.prototype._ensurePlayingMoveAnimation=function(e,t){this._ensureAnimationPlaying(e).alpha=t},t.prototype._moveTowardTarget=function(e,t,r){var n=this.node,o=n.convertToWorldSpaceAR(cc.Vec2.ZERO),i=n.parent.convertToNodeSpaceAR(o),a=e.convertToWorldSpaceAR(cc.Vec2.ZERO),c=n.parent.convertToNodeSpaceAR(a),s=c.sub(i),l=s.len(),u=t*r,f=Math.min(l,u),d=s.normalize().mul(f);n.x+=d.x,n.y+=d.y;var h=cc.v2(n.x,n.y);if(g.default(h,c,1))return n.setPosition(c),this.setState({state:p.MOVE,target:null});var y=a.x-o.x>0?"right":"left";this._ensureFacing(y)},t.prototype._getAnalyzedAnimation=function(e){var t=this._analyzedAnimations.get(e);return t||(t=this._analyzeAnimation(e),this._analyzedAnimations.set(e,t)),t},t.prototype._analyzeAnimation=function(e){var t,r,n,o,i=this.skeleton.findAnimation(e);if(!i)throw new Error('Could not analyze animation "'+e+'", does not exist in rig: '+this.skeleton.node.name);var a=i.duration,c=NaN;try{for(var s=l(i.timelines||[]),u=s.next();!u.done;u=s.next()){var p=u.value;if(Array.isArray(p.events))try{for(var f=(n=void 0,l(p.events)),d=f.next();!d.done;d=f.next()){var h=d.value;if(h&&h.data&&h.data.name&&h.data.name.toLowerCase().includes("walk_amount")){c=h.intValue||h.floatValue||0;break}}}catch(y){n={error:y}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}}}catch(g){t={error:g}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if("number"!=typeof c||Number.isNaN(c))throw new Error("Speed could not be determined in animation "+e+". Walk info event missing or improperly formatted.");return{name:e,speed:c,duration:a}},t.prototype._ensureFacing=function(e){var t="right"===e?1:-1,r=this.skeleton.node.scaleX;C(r)!==t&&(this.skeleton.node.scaleX*=-1)},t.prototype._switchCurrentAnimationToTrack=function(e){var t=this.track;if(e!==t){var r=this._getTrackEntry(t);r&&(this.skeleton.setAnimation(e,r.animation.name,r.loop).trackTime=r.trackTime,this._clearTrackEntry(t))}},t.prototype._getTrackEntry=function(e){return this.skeleton.getState().getCurrent(e)},t.prototype._clearTrackEntry=function(e){void 0===e&&(e=this.track),this._getTrackEntry(e)&&this.skeleton.clearTrack(e)},t.prototype._ensureAnimationPlaying=function(e){"string"==typeof e&&(e=[e]);var t=this._getTrackEntry(this.track),r=!!t&&e.includes(t.animation.name),n=!!t&&t.trackTime>t.animationEnd;if(t&&r&&!n)return t;var o=h.default.item(e);return this.skeleton.setAnimation(this.track,o,!1)},t.prototype.getActorComponentState=function(){return{enabled:this.enabled,currentState:this.currentState,idleStateData:i({},this._idleStateData),moveStateData:i({},this._moveStateData)}},t.prototype.applyActorComponentState=function(e){this.enabled=e.enabled,this._currentState=e.currentState,this._idleStateData=i({},e.idleStateData),this._moveStateData=i({},e.moveStateData)},t.State=p,a([b({type:cc.String}),c("design:type",Array)],t.prototype,"idleAnimations",void 0),a([b(),c("design:type",Object)],t.prototype,"walkAnimation",void 0),a([b(),c("design:type",Object)],t.prototype,"runAnimation",void 0),a([b(),c("design:type",Object)],t.prototype,"_track",void 0),a([b({min:0,step:1}),c("design:type",Number),c("design:paramtypes",[Number])],t.prototype,"track",null),a([b({min:.1,max:5,slide:!0,visible:!0}),c("design:type",Object)],t.prototype,"_moveSpeedMultiplier",void 0),a([b({type:cc.Enum(p),visible:!0}),c("design:type",Number)],t.prototype,"_currentState",void 0),a([b(),c("design:type",Object)],t.prototype,"_idleStateData",void 0),a([b({visible:function(){return this._currentState===p.IDLE},type:cc.Enum(f),displayName:"State - Facing"}),c("design:type",Number),c("design:paramtypes",[Number])],t.prototype,"_facing",null),a([b(),c("design:type",Object)],t.prototype,"_moveStateData",void 0),a([b({visible:function(){return this._currentState===p.MOVE},type:cc.Node,displayName:"State - Target"}),c("design:type",Object),c("design:paramtypes",[Object])],t.prototype,"_target",null),a([b({visible:function(){return this._currentState===p.MOVE},min:0,max:1,slide:!0,displayName:"State - Throttle"}),c("design:type",Number),c("design:paramtypes",[Number])],t.prototype,"_throttle",null),a([d.default({type:sp.Skeleton,scope:["node","children"]}),c("design:type","function"==typeof(r="undefined"!=typeof sp&&sp.Skeleton)?r:Object)],t.prototype,"skeleton",void 0),a([m,v("Actor Component/Character Controller")],t)}(cc.Component);r.default=x,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/RandomUtil":"RandomUtil","../Util/approximately":"approximately","../Util/sortBy":"sortBy"}],CloudParticle:[function(e,t,r){"use strict";cc._RF.push(t,"3976dTFKphPuoKEet6n1Vci","CloudParticle");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var f=p(e("./Particle")),d=p(e("../Util/NodeUtils")),h=p(e("../Util/RandomUtil")),y=cc._decorator,g=y.ccclass,_=y.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fill=null,t._puffTextures=[],t._puffOutlineTemplate=null,t._puffFillTemplate=null,t._appearTime=.5,t._minAddedPuffs=0,t._maxAddedPuffs=3,t._minAddedPuffSize=.25,t._maxAddedPuffSize=.5,t._outlineWidth=3,t._originalScale=1,t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"fill",{get:function(){if(!this._fill)throw new Error('"fill" is not set in the editor.');return this._fill},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"puffOutlineTemplate",{get:function(){if(!this._puffOutlineTemplate)throw new Error('"puffOutlineTemplate" is not set in the editor.');return this._puffOutlineTemplate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"puffFillTemplate",{get:function(){if(!this._puffFillTemplate)throw new Error('"puffFillTemplate" is not set in the editor.');return this._puffFillTemplate},set:function(e){this._puffFillTemplate=e},enumerable:!1,configurable:!0}),t.prototype.onEmit=function(){this._applyNodeColorToFillSprite(),this._applyInitialWidthAndHeight(),this._createRandomPuffs(),this._detachFill(),this._appear(),cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this._matchFill,this)},t.prototype.onRelease=function(){this._removeRandomPuffs(),this._attachFill(),this.node.getActionByTag(18479091823)&&(this.node.stopActionByTag(18479091823),this.node.scale=this._originalScale),cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this._matchFill,this)},t.prototype.onLoad=function(){var e=this.node.getComponent(cc.PhysicsCircleCollider);this._originalColliderRadius=e?e.radius:0,this._originalPuffWidth=this.puffOutlineTemplate.getContentSize(),this._originalFillNodeState=d.default.getNodeState(this.fill),this._originalScale=this.node.scale},t.prototype.onDestroy=function(){cc.isValid(this.fill)&&(this.fill.removeFromParent(),this.fill.destroy()),cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this._matchFill,this)},t.prototype.getParticleState=function(){return i(i({},e.prototype.getParticleState.call(this)),{originalScale:this._originalScale})},t.prototype.applyParticleState=function(t){e.prototype.applyParticleState.call(this,t),this._originalScale!==t.originalScale&&(this._originalScale=t.originalScale,this.node.getActionByTag(18479091823)&&(this.node.stopActionByTag(18479091823),this._appear()))},t.prototype._applyInitialWidthAndHeight=function(){var e=this._originalPuffWidth.width,t=this.node.width/e,r=e*t,n=this.puffOutlineTemplate;n.width=n.height=r;var o=this.puffFillTemplate;o.width=o.height=r-2*this._outlineWidth;var i=this.node.getComponent(cc.PhysicsCircleCollider);i&&(i.radius=this._originalColliderRadius*t)},t.prototype._applyNodeColorToFillSprite=function(){var e,t,r=this.fill.getComponentsInChildren(cc.Sprite);try{for(var n=s(r),o=n.next();!o.done;o=n.next())o.value.node.color=this.node.color.clone()}catch(i){e={error:i}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype._createRandomPuffs=function(){for(var e,t,r=h.default.integer(this._minAddedPuffs,this._maxAddedPuffs),n=[this.puffOutlineTemplate],o=[this.puffFillTemplate],i=0;i<=r;i++)(c=cc.instantiate(this.puffOutlineTemplate)).setParent(this.puffOutlineTemplate.parent),n.push(c),(l=cc.instantiate(this.puffFillTemplate)).setParent(this.puffFillTemplate.parent),o.push(l);var a=n.length;for(i=0;i<a;i++){var c=n[i],l=o[i];if(this._puffTextures.length>0){var u=h.default.item(this._puffTextures);try{for(var p=(e=void 0,s([l,c])),f=p.next();!f.done;f=p.next()){var d=f.value.getComponent(cc.Sprite);d&&(d.spriteFrame=new cc.SpriteFrame(u))}}catch(g){e={error:g}}finally{try{f&&!f.done&&(t=p.return)&&t.call(p)}finally{if(e)throw e.error}}}if(i>0&&(c.height=c.width=h.default.integer(c.width*this._minAddedPuffSize,c.width*this._maxAddedPuffSize)),l.width=l.height=c.width-2*this._outlineWidth,l.angle=c.angle=h.default.float(0,360),i>0){var y=cc.v2(.5*this.puffOutlineTemplate.width,0).rotate(h.default.float(0,360));l.setPosition(y),c.setPosition(y)}}},t.prototype._removeRandomPuffs=function(){var e,t,r,n;try{for(var o=s([this.puffOutlineTemplate,this.puffFillTemplate]),i=o.next();!i.done;i=o.next()){var a=i.value;try{for(var c=(r=void 0,s(u(a.parent.children))),l=c.next();!l.done;l=c.next()){var p=l.value;p!==a&&(p.removeFromParent(),p.destroy())}}catch(f){r={error:f}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}}catch(d){e={error:d}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype._detachFill=function(){this.node.setSiblingIndex(0),d.default.applyNodeState(this.fill,this.node)},t.prototype._attachFill=function(){d.default.applyNodeState(this.fill,this._originalFillNodeState)},t.prototype._matchFill=function(){this.fill.scale=this.node.scale,this.fill.angle=this.node.angle,this.fill.position=this.node.position.clone()},t.prototype._appear=function(){var e=this.node;e.scale=0,cc.tween(e).to(this._appearTime,{scale:this._originalScale}).tag(18479091823).start()},a([_({visible:!0,type:cc.Node}),c("design:type",Object)],t.prototype,"_fill",void 0),a([_({type:cc.Texture2D,visible:!0}),c("design:type",Array)],t.prototype,"_puffTextures",void 0),a([_({type:cc.Node,visible:!0}),c("design:type",Object)],t.prototype,"_puffOutlineTemplate",void 0),a([_(cc.Node),c("design:type",Object)],t.prototype,"_puffFillTemplate",void 0),a([_({type:cc.Node}),c("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Node)?r:Object),c("design:paramtypes",["function"==typeof(n="undefined"!=typeof cc&&cc.Node)?n:Object])],t.prototype,"puffFillTemplate",null),a([_({min:0,max:3,slide:!0,visible:!0}),c("design:type",Object)],t.prototype,"_appearTime",void 0),a([_({min:0,max:10,step:1,visible:!0}),c("design:type",Object)],t.prototype,"_minAddedPuffs",void 0),a([_({min:0,max:10,step:1,visible:!0}),c("design:type",Object)],t.prototype,"_maxAddedPuffs",void 0),a([_({min:.1,max:1,slide:!0,visible:!0}),c("design:type",Object)],t.prototype,"_minAddedPuffSize",void 0),a([_({min:.1,max:1,slide:!0,visible:!0}),c("design:type",Object)],t.prototype,"_maxAddedPuffSize",void 0),a([_({min:1,max:10,visible:!0,slide:!0}),c("design:type",Object)],t.prototype,"_outlineWidth",void 0),a([g],t)}(f.default);r.default=m,cc._RF.pop()},{"../Util/NodeUtils":"NodeUtils","../Util/RandomUtil":"RandomUtil","./Particle":"Particle"}],Comment:[function(e,t,r){"use strict";cc._RF.push(t,"eb584lRdrFANbvortHSbrXY","Comment");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(r,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,l=c.property,u=c.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._comment="",t}return o(t,e),Object.defineProperty(t.prototype,"text",{get:function(){return this._comment},set:function(e){this._comment=e},enumerable:!1,configurable:!0}),t.prototype.onBuildPreProcess=function(){return!!cc.isValid(this,!0)&&(this.destroy(),!0)},i([l({editorOnly:!0}),a("design:type",Object)],t.prototype,"_comment",void 0),i([l({tooltip:"This component acts as a note or comment to be left to clarify or describe intentions about the structure of the node or scene.",multiline:!0}),a("design:type",String),a("design:paramtypes",[String])],t.prototype,"text",null),i([s,u("Development Component/Comment")],t)}(cc.Component);r.default=p,cc._RF.pop()},{}],CreateUIColorButtons:[function(e,t,r){"use strict";cc._RF.push(t,"b3440AeOapDwKI2CVp3H7G0","CreateUIColorButtons");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../DrawingUI/DrawingUIColorButtons")),f=e("../DrawingUI/DrawingUI"),d=u(e("./Createable")),h=cc._decorator,y=h.ccclass,g=h.property,_=h.executeInEditMode,m=p.default.prototype,b=s(f.DEFAULT_COLORS),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._highlightPadding=5,t._animationDuration=.125,t._creatablesNode=null,t._colorButtonPrefab=null,t._color=cc.Color.WHITE,t._scaleButtonHighlights=m._scaleButtonHighlights,t._getSelectedButton=m._getSelectedButton,t._getButtonHighlightNode=m._getButtonHighlightNode,t._ensureButtons=m._ensureButtons,t._createButton=m._createButton,t._leftAlignButtons=m._leftAlignButtons,t}var r,n,c;return o(t,e),Object.defineProperty(t.prototype,"highlightPadding",{get:function(){return this._highlightPadding},set:function(e){this._highlightPadding=cc.misc.clampf(e,0,25),this._scaleButtonHighlights()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createablesNode",{get:function(){if(!this._creatablesNode)throw new Error('"createablesNode" is not set in the editor.');return this._creatablesNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this.setColor(e)},enumerable:!1,configurable:!0}),t.prototype.setColor=function(e){var t,r,n=e instanceof cc.Event.EventTouch?e.target.color:e;this._color=f.getClosestColor(n,b),this._scaleButtonHighlights();var o=this.createablesNode.getComponentsInChildren(d.default);try{for(var i=l(o),a=i.next();!a.done;a=i.next())a.value.node.color=this._color}catch(c){t={error:c}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return this._color.clone()},t.prototype.onLoad=function(){this.setColor(this.color),this._scaleButtonHighlights(),this._ensureButtons(b)},t.prototype._createButtonClickEvent=function(){return{target:this.node,component:this,handler:"setColor"}},i([g(),a("design:type",Object)],t.prototype,"_highlightPadding",void 0),i([g({step:1,min:0,max:25,visible:!0}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"highlightPadding",null),i([g({min:0,max:2,visible:!0}),a("design:type",Object)],t.prototype,"_animationDuration",void 0),i([g({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_creatablesNode",void 0),i([g({visible:!0,type:cc.Prefab}),a("design:type",Object)],t.prototype,"_colorButtonPrefab",void 0),i([g(),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Color)?r:Object)],t.prototype,"_color",void 0),i([g(),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object),a("design:paramtypes",["function"==typeof(c="undefined"!=typeof cc&&cc.Color)?c:Object])],t.prototype,"color",null),i([y,_],t)}(cc.Component);r.default=v,cc._RF.pop()},{"../DrawingUI/DrawingUI":"DrawingUI","../DrawingUI/DrawingUIColorButtons":"DrawingUIColorButtons","./Createable":"Createable"}],CreateUI:[function(e,t,r){"use strict";cc._RF.push(t,"38edc84MC5A4K1sYb9s7r73","CreateUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../Generic/Hider")),p=l(e("./Createable")),f=l(e("./CreateUIColorButtons")),d=l(e("../Util/EventHandlerUtils")),h=l(e("../Util/NodeUtils")),y=l(e("../Generic/CameraRig")),g=l(e("../Util/Decorators/cache")),_=l(e("../Util/RandomUtil")),m=l(e("../Drawing/Particle")),b=l(e("../Drawing/Drawing")),v=cc._decorator,w=v.ccclass,O=v.property,S=v.executeInEditMode,C=cc.js.getClassName;function P(){return d.default.includes({target:this.node,component:this,handler:"tweenInstanceToTarget"},this.createEvents)}function T(){return this._instanceParent instanceof cc.Node}function j(){return this._instanceParentToTarget}function R(e,t){return function(){return e.bind(this)()&&t.bind(this)()}}function x(e){return function(){return!e.bind(this)()}}var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disableAfterCreate=!1,t.createEvents=[d.default.create({target:t.node,component:t,handler:"tweenInstanceToTarget"})],t._instanceTweenTargets=[],t._instanceParentToTarget=!1,t._instanceParent=null,t._instanceRandomRotation=!0,t._mostRencentInstanceTweenTarget=null,t._recentInstanceTweenTargets=[],t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.colorButtons?this.colorButtons.color:cc.Color.WHITE},set:function(e){this.colorButtons&&this.colorButtons.setColor(e)},enumerable:!1,configurable:!0}),t.prototype._getRandomNotRecentTarget=function(){var e=this;if(1===this._instanceTweenTargets.length)return this._instanceTweenTargets[0];var t=this._instanceTweenTargets.filter(function(t){return!e._recentInstanceTweenTargets.includes(t)&&t!==e._mostRencentInstanceTweenTarget}),r=_.default.item(t);return r?(this._recentInstanceTweenTargets.push(r),this._mostRencentInstanceTweenTarget=r,this._recentInstanceTweenTargets.length>=this._instanceTweenTargets.length&&(this._recentInstanceTweenTargets=[]),r):null},t.prototype.create=function(e){return c(this,void 0,Promise,function(){var t,r,n,o,i,a;return s(this,function(c){switch(c.label){case 0:if(!(t=e instanceof cc.Event.EventTouch?e.target.getComponent(p.default):e))throw new Error(C(p.default)+" invalid");if(!(r=t.prefab))throw new Error(C(p.default)+" "+t.node.name+" does not have a prefab.");return(n=cc.instantiate(r)).name=r.name,t.inheritNodeState?h.default.applyNodeState(n,t.node):(n.setParent(t.node.parent),n.setPosition(t.node.position)),o=n.convertToWorldSpaceAR(cc.Vec2.ZERO),this._instanceParent?n.setParent(this._instanceParent):n.setParent(this.node.parent),i=n.parent.convertToNodeSpaceAR(o),n.setPosition(i),n.setSiblingIndex(this.node.getSiblingIndex()+1),a=d.default.emit(this.createEvents,n,!0),this.disableAfterCreate&&(this.enabled=!1),[4,a];case 1:return c.sent(),[2]}})})},t.prototype.createRandom=function(){var e=this.getComponentsInChildren(p.default),t=_.default.item(e);return this.create(t)},t.prototype.tweenInstanceToTarget=function(e,t,r,n){if(t||(t=this&&this._instanceTweenTargets.length>0?this._getRandomNotRecentTarget():null),"string"==typeof t&&(t=h.default.resolveNode(t)),!t)return Promise.resolve();void 0===r&&this&&(r=this._instanceParentToTarget),void 0===n&&this&&(n=this._instanceRandomRotation);var o=null;r&&(o=t),this&&this._instanceParent&&(o=this._instanceParent);var i=y.default.getCameraOffsets(e,t),a=t.convertToWorldSpaceAR(cc.Vec2.ZERO),c=n?_.default.integer(360):t.angle+i.angle;return new Promise(function(r){t=t,cc.tween(e).to(.65,{position:cc.v3(e.parent.convertToNodeSpaceAR(a)).add(i.position),angle:c,scale:t.scale*i.scale},{easing:"quadInOut"}).call(function(){if(o&&e.group!==o.group&&(cc.warn(e.name+' group changed from "'+e.group+'" to match new parent '+o.name+' group "'+o.group+'"'),h.default.changeGroup(e,e.group,o.group)),o){var t=o.getComponent(b.default),r=e.getComponent(m.default);if(t&&r)t.addParticle(r);else{var n=e.convertToWorldSpaceAR(cc.Vec2.ZERO);e.angle-=o.angle,e.scale/=o.scale,e.setPosition(o.convertToNodeSpaceAR(n)),e.setParent(o)}}}).call(r).start()})},i([O({tooltip:"If true, the UI will hide itself after a create button has been pushed.",displayName:"Hide After Create"}),a("design:type",Object)],t.prototype,"disableAfterCreate",void 0),i([O({tooltip:"These will be called with the created instance when an instance button is clicked.",type:cc.Component.EventHandler}),a("design:type",Array)],t.prototype,"createEvents",void 0),i([O({tooltip:"Tween the created instance to one of these targets.",visible:P,type:cc.Node}),a("design:type",Array)],t.prototype,"_instanceTweenTargets",void 0),i([O({tooltip:"Parent the instance to the target once it arrives",visible:R(P,x(T))}),a("design:type",Object)],t.prototype,"_instanceParentToTarget",void 0),i([O({tooltip:"Parent the instance to the this node once it arrives",visible:R(P,x(j)),type:cc.Node,formerlySerializedAs:"_parentInstanceToNode"}),a("design:type",Object)],t.prototype,"_instanceParent",void 0),i([O({tooltip:"If true, instanced creatables will be rotated randomly during tweeen.",visible:P,formerlySerializedAs:"rotateOnCreate",displayName:"Rotate On Create"}),a("design:type",Object)],t.prototype,"_instanceRandomRotation",void 0),i([O({visible:function(){return!!this.colorButtons}}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Color)?r:Object),a("design:paramtypes",["function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object])],t.prototype,"color",null),i([g.default({type:f.default,required:!1,scope:"children"}),a("design:type",Object)],t.prototype,"colorButtons",void 0),i([w,S],t)}(u.default);r.default=A,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../Drawing/Particle":"Particle","../Generic/CameraRig":"CameraRig","../Generic/Hider":"Hider","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","../Util/NodeUtils":"NodeUtils","../Util/RandomUtil":"RandomUtil","./CreateUIColorButtons":"CreateUIColorButtons","./Createable":"Createable"}],Createable:[function(e,t,r){"use strict";cc._RF.push(t,"ce5b4xg4gVK0YCyeq0pithJ","Createable");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../Generic/ButtonAsynchronizer")),l=c(e("../Util/EventHandlerUtils")),u=c(e("../Util/getComponentInParents")),p=c(e("../Util/Decorators/cache")),f=cc._decorator,d=f.ccclass,h=f.property,y=f.executeInEditMode,g=f.disallowMultiple,_=cc.js.getClassByName,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.prefab=null,t.inheritNodeState=!0,t}return o(t,e),t.prototype.onLoad=function(){this._ensureEventHandler()},t.prototype._ensureEventHandler=function(){var e=_("CreateUI"),t=e&&u.default(this.node,e);if(t&&this.button){var r=s.default.getClickEvents(this.button);l.default.ensure({target:t.node,component:t,handler:"create"},r)}},i([p.default({type:cc.Button,required:!1}),a("design:type",Object)],t.prototype,"button",void 0),i([h({visible:!0,type:cc.Prefab,tooltip:"Prefab that will be created by the CreateUI when the button is pressed."}),a("design:type",Object)],t.prototype,"prefab",void 0),i([h({visible:!0,tooltip:"The instanced prefab will inherit this node's state. If disabled, the instanced prefab will inherit position only."}),a("design:type",Object)],t.prototype,"inheritNodeState",void 0),i([d,y,g],t)}(cc.Component);r.default=m,cc._RF.pop()},{"../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","../Util/getComponentInParents":"getComponentInParents"}],DevOptionsUIToggle:[function(e,t,r){"use strict";cc._RF.push(t,"114d3Pz55pMsbWkIah39Bgq","DevOptionsUIToggle");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var d=f(e("../Framework/GameComponent")),h=s(e("../Generic/CameraRig")),y=(f(e("../Util/EventHandlerUtils")),f(e("../Util/Decorators/cache"))),g=cc._decorator,_=g.ccclass,m=g.property,b=g.executeInEditMode,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._disabledIcon=null,t._enabledIcon=null,t._mainCameraRig=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"disabledIcon",{get:function(){if(!this._disabledIcon)throw this.enabled=!1,new Error('"overlayVisibleIcon" is not set in the editor.');return this._disabledIcon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabledIcon",{get:function(){if(!this._enabledIcon)throw this.enabled=!1,new Error('"overlayInvisibleIcon" is not set in the editor.');return this._enabledIcon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mainCameraRig",{get:function(){var e;return cc.isValid(this._mainCameraRig)||(this._mainCameraRig=cc.isValid(null===(e=cc.Camera.main)||void 0===e?void 0:e.node)?cc.Camera.main.getComponent(h.default):null),this._mainCameraRig},enumerable:!1,configurable:!0}),t.prototype.toggleOverlaysVisible=function(){this.overlaysVisible=!this.overlaysVisible,this._setVisibilityIcon(this.overlaysVisible)},t.prototype.toggleCaptions=function(){gm.loaded&&(gm.captions.enabled=!gm.captions.enabled,this._setVisibilityIcon(gm.captions.enabled))},Object.defineProperty(t.prototype,"overlaysVisible",{get:function(){return!!this.mainCameraRig&&this.mainCameraRig.preset===h.CameraPresetType.Debug},set:function(e){this.mainCameraRig&&(this.mainCameraRig.applyPreset(e?h.CameraPresetType.Debug:h.CameraPresetType.Game),gm.loaded&&gm.storage.set({store:"ui",id:"dev-overlays-visible",value:e}))},enumerable:!1,configurable:!0}),t.prototype.onSceneStart=function(){return u(this,void 0,Promise,function(){var e;return p(this,function(t){switch(t.label){case 0:return gm.loaded?(e=this,[4,gm.storage.get({store:"ui",id:"dev-overlays-visible"})]):[2];case 1:return e.overlaysVisible=!!t.sent(),[2]}})})},t.prototype.start=function(){this.node.name.includes("Overlay")},t.prototype.update=function(){if(this.node.name.includes("Overlay")){var e=this.mainCameraRig;this._setInteractable(!!e),this._setVisibilityIcon(this.overlaysVisible)}else this._setInteractable(gm.loaded),this._setVisibilityIcon(gm.loaded&&gm.captions.enabled)},t.prototype._setInteractable=function(e){this.node.opacity=e?255:127.5,this.toggleButton.interactable=e},t.prototype._setVisibilityIcon=function(e){this.enabledIcon.node.active=e,this.disabledIcon.node.active=!e},c([m({visible:!0,type:cc.Sprite}),l("design:type",Object)],t.prototype,"_disabledIcon",void 0),c([m({visible:!0,type:cc.Sprite}),l("design:type",Object)],t.prototype,"_enabledIcon",void 0),c([y.default({type:cc.Button,scope:"children"}),l("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Button)?r:Object)],t.prototype,"toggleButton",void 0),c([_,b],t)}(d.default);r.default=v,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Generic/CameraRig":"CameraRig","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils"}],DevOptionsUI:[function(e,t,r){"use strict";cc._RF.push(t,"dc5f5Hns2NDZ6Se3Nt0N1bj","DevOptionsUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var d=f(e("../Framework/GameComponent")),h=s(e("../Generic/CameraRig")),y=f(e("../Util/EventHandlerUtils")),g=cc._decorator,_=g.ccclass,m=g.property,b=g.executeInEditMode,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._overlayToggle=null,t._captionsToggle=null,t._voiceToggle=null,t._sfxToggle=null,t._musicToggle=null,t._volumeSlider=null,t._fpsCounter=null,t._mainCameraRig=null,t._deltaTimes=[],t}return o(t,e),Object.defineProperty(t.prototype,"mainCameraRig",{get:function(){return cc.isValid(this._mainCameraRig)||(this._mainCameraRig=cc.isValid(cc.Camera.main.node)?cc.Camera.main.getComponent(h.default):null),this._mainCameraRig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overlaysVisible",{get:function(){return!!this.mainCameraRig&&this.mainCameraRig.preset===h.CameraPresetType.Debug},set:function(e){this.mainCameraRig&&(this.mainCameraRig.applyPreset(e?h.CameraPresetType.Debug:h.CameraPresetType.Game),gm.loaded&&gm.storage.set({store:"ui",id:"dev-overlays-visible",value:e}))},enumerable:!1,configurable:!0}),t.prototype.onGameStart=function(){var e,t;if(!gm.loaded)throw new Error(gm.name+" is not loaded");var r=gm.springroll.state;this._setupStateSync(r.voVolume,this._voiceToggle,"voVolume"),this._setupStateSync(r.musicVolume,this._musicToggle,"musicVolume"),this._setupStateSync(r.sfxVolume,this._sfxToggle,"sfxVolume"),this._setupStateSync(r.soundVolume,this._volumeSlider,"soundVolume"),this._setupStateSync(r.captionsMuted,this._captionsToggle,"captionsMuted"),y.default.ensure({target:this.node,component:this,handler:"_toggleOverlays"},null!==(t=null===(e=this._overlayToggle)||void 0===e?void 0:e.checkEvents)&&void 0!==t?t:[]),this.schedule(this._updateFps,1/16)},t.prototype.onSceneStart=function(){return u(this,void 0,Promise,function(){var e,t;return p(this,function(r){switch(r.label){case 0:return gm.loaded&&cc.isValid(this._overlayToggle)?(e=this._overlayToggle,t=this,[4,gm.storage.get({store:"ui",id:"dev-overlays-visible"})]):[2];case 1:return e.isChecked=t.overlaysVisible=!!r.sent(),[2]}})})},t.prototype.setSpringRollStateValue=function(e,t){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");if(!(t&&t in gm.springroll.state))throw new Error(t+" is not a valid springroll state.");var r=gm.springroll.state[t];e instanceof cc.Toggle?r.value="number"==typeof r.value?e.isChecked?1:0:e.isChecked:r.value="number"==typeof r.value?e.progress:e.progress>0},t.prototype._toggleOverlays=function(){this.overlaysVisible=!this.overlaysVisible},t.prototype._getAverageDeltaTime=function(){var e=this._deltaTimes;for(e.push(cc.director.getDeltaTime());e.length>16;)e.shift();return e.length>1?e.reduce(function(e,t){return e+t})/e.length:e[0]},t.prototype._updateFps=function(){if(!cc.isValid(this._fpsCounter))return this.unschedule(this._updateFps);var e=(1/this._getAverageDeltaTime()).toString(),t=e.substring(0,e.lastIndexOf(".")+2);this._fpsCounter.string=t},t.prototype._setupStateSync=function(e,t,r){if(!cc.isValid(t))throw new Error("Cannot ensure handler without a valid UI element");var n=t instanceof cc.Toggle?t.checkEvents:t.slideEvents,o=function(e){t instanceof cc.Toggle?t.isChecked="boolean"==typeof e?e:e>0:t.progress="number"==typeof e?e:e?1:0};e.subscribe(o),o(e.value),y.default.ensure({target:this.node,component:this,handler:"setSpringRollStateValue",customEventData:r},n)},c([m({type:cc.Toggle,visible:!0}),l("design:type",Object)],t.prototype,"_overlayToggle",void 0),c([m({type:cc.Toggle,visible:!0}),l("design:type",Object)],t.prototype,"_captionsToggle",void 0),c([m({type:cc.Toggle,visible:!0}),l("design:type",Object)],t.prototype,"_voiceToggle",void 0),c([m({type:cc.Toggle,visible:!0}),l("design:type",Object)],t.prototype,"_sfxToggle",void 0),c([m({type:cc.Toggle,visible:!0}),l("design:type",Object)],t.prototype,"_musicToggle",void 0),c([m({type:cc.Slider,visible:!0}),l("design:type",Object)],t.prototype,"_volumeSlider",void 0),c([m({type:cc.Label,visible:!0}),l("design:type",Object)],t.prototype,"_fpsCounter",void 0),c([_,b],t)}(d.default);r.default=v,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Generic/CameraRig":"CameraRig","../Util/EventHandlerUtils":"EventHandlerUtils"}],DevelopmentJson:[function(e,t,r){"use strict";cc._RF.push(t,"95218l3sJBAB7iIiVIlPPoF","DevelopmentJson"),Object.defineProperty(r,"__esModule",{value:!0}),r.isDevelopmentJson=void 0,r.isDevelopmentJson=function(e){return null!==e&&"object"==typeof e&&"boolean"==typeof e.forceLowEndDeviceMode},cc._RF.pop()},{}],DrawOrderer:[function(e,t,r){"use strict";cc._RF.push(t,"45e3ciqsHdJ0aapQlWnlYzZ","DrawOrderer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(r,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,l=c.property,u=c.disallowMultiple,p=c.executeInEditMode,f=c.menu,d=.125,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sortingIndicatorName="Draw Order Indicator",t._interval=d,t._timeBuffer=0,t._bySortingIndicatorYAxis=function(e,r){var n=t._getChildSortOrder(e),o=t._getChildSortOrder(r);return n===o?0:n>o?-1:1},t._getChildSortOrder=function(e){var r=e.getChildByName(t.sortingIndicatorName),n=(r&&r.active?r:e).getBoundingBoxToWorld();return Math.round(n.yMin)},t}return o(t,e),Object.defineProperty(t.prototype,"interval",{get:function(){return this._interval},set:function(e){this._interval=Math.max(e,0)},enumerable:!1,configurable:!0}),t.prototype.sort=function(){this.node.children.sort(this._bySortingIndicatorYAxis)},t.prototype.getChildSortOrder=function(e){var t=this.node.children,r=t.length-1;if("number"==typeof e&&e!==cc.misc.clampf(Math.floor(e),0,r))throw new Error("Provided child index must be an integer between 0 and the max child index: "+r);if("number"==typeof e&&(e=this.node.children[e]),e instanceof cc.Node&&!t.includes(e))throw new Error("Provided node must be a child.");return this._getChildSortOrder(e)},t.prototype.update=function(e){this._timeBuffer-=e,this._timeBuffer>0||(this._timeBuffer=this.interval+this._timeBuffer,this.sort())},i([l({tooltip:"If a child node has a node with this name, the position of that node will be used to calculate the child node's draw-order. Otherwise the bottom of the childs bounding box will be used."}),a("design:type",Object)],t.prototype,"sortingIndicatorName",void 0),i([l(),a("design:type",Number)],t.prototype,"_interval",void 0),i([l({tooltip:"How much time, in seconds, between draw order updates. 0 would be every frame."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"interval",null),i([s,u,p,f("Generic Component/Draw Orderer")],t)}(cc.Component);r.default=h,cc._RF.pop()},{}],DrawingBounds:[function(e,t,r){"use strict";cc._RF.push(t,"848c2fOo+1Jo4FP6f6lxTLh","DrawingBounds");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("./Drawing")),u=c(e("../Util/Decorators/cache")),p=e("../Generic/SizeToScreen"),f=cc._decorator,d=f.ccclass,h=f.menu,y=f.property,g=f.disallowMultiple;(function(e){e[e.Center=0]="Center",e[e.CenterOfOpacity=1]="CenterOfOpacity"})(s||(s={}));var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,t._padding=0,t._center=s.Center,t}return o(t,e),t.prototype.onLoad=function(){this.apply=this.apply.bind(this)},t.prototype.onEnable=function(){this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE&&p.onResize(this.apply),cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onDisable=function(){this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE&&p.offResize(this.apply),cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onBeforeDraw=function(){this.enabledInHierarchy&&this.applyMode===cc.Widget.AlignMode.ALWAYS&&this.apply()},t.prototype.apply=function(){if(this.drawing){var e=this.drawing.size,t=2*this._padding,r=cc.size(e.width+t,e.height+t),n=this._center===s.Center?this.drawing.center:this.drawing.centerOfOpacity;this.node.setContentSize(r),this.node.setAnchorPoint(.5-n.x/r.width,.5-n.y/r.height)}},i([y({type:cc.Widget.AlignMode}),a("design:type",Object)],t.prototype,"applyMode",void 0),i([u.default({type:l.default,required:!1,scope:"node"}),a("design:type",Object)],t.prototype,"drawing",void 0),i([y({visible:!0}),a("design:type",Object)],t.prototype,"_padding",void 0),i([y({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_center",void 0),i([d,g,h("Drawing Component/Drawing Bounds")],t)}(cc.Component);r.default=_,cc._RF.pop()},{"../Generic/SizeToScreen":"SizeToScreen","../Util/Decorators/cache":"cache","./Drawing":"Drawing"}],DrawingComponent:[function(e,t,r){"use strict";cc._RF.push(t,"5226clkJFlDZLiKJ8iEZbs9","DrawingComponent");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._requiresBoundsAndOpacityUpdate=!1,t}return o(t,e),Object.defineProperty(t.prototype,"requiresBoundsAndOpacityUpdate",{get:function(){return this._requiresBoundsAndOpacityUpdate},enumerable:!1,configurable:!0}),t.prototype.updateBoundsAndOpacity=function(){this._requiresBoundsAndOpacityUpdate&&(this.onUpdateBoundsAndOpacity(),this._requiresBoundsAndOpacityUpdate=!1)},t}(cc.Component);r.default=i,cc._RF.pop()},{}],DrawingEyeTracker:[function(e,t,r){"use strict";cc._RF.push(t,"ab6caBuVi5K667k0PM8jtDJ","DrawingEyeTracker");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../Actor/CharacterController")),f=u(e("./DrawingUIHandler")),d=u(e("../Generic/Transform")),h=s(e("../Generic/Snapper")),y=u(e("../Util/Decorators/cache")),g=cc._decorator,_=g.ccclass,m=g.property,b=g.menu,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._eyeTrackingBoneName="Eye_Direction",t._range=100,t._delay=1,t._origin=cc.Vec2.ZERO,t._snapper=null,t._transformer=null,t._stroking=!1,t._world=cc.Vec2.ZERO,t._delayTimeSink=0,t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"origin",{get:function(){return cc.v3(this._origin)},enumerable:!1,configurable:!0}),t.prototype.start=function(){this._ensureSnapper(),this._getTransformer(),this._moveToOrigin()},t.prototype.update=function(e){this._updateSnapperEnabled(),this._delayTimeSink-=e,this._delayTimeSink>0||(this._delayTimeSink=0,this._stroking?this._moveToWorld(this._world):this._moveToOrigin())},t.prototype.onDisable=function(){this._updateSnapperEnabled()},t.prototype.onTouchStart=function(e){this._stroking=!0,this._world=e.clone(),this._delayTimeSink=this._delay},t.prototype.onTouchMove=function(e){this._world=e.clone()},t.prototype.onTouchEnd=function(){this._stroking=!1,this._world=cc.Vec2.ZERO,this._delayTimeSink=this._delay},t.prototype.onBuildPreProcess=function(){return!this.origin.equals(this.node.position)&&(this._editorUpdateOrigin(),!0)},t.prototype._moveToWorld=function(e){var t=this.node.parent.convertToNodeSpaceAR(e);this._moveToLocal(t)},t.prototype._moveToOrigin=function(){this._moveToLocal(this._origin)},t.prototype._moveToLocal=function(e){var t=e.clone(),r=e.sub(this._origin),n=this._range/Math.abs(this.node.parent.scale);r.len()>n&&t.subSelf(this._origin).normalizeSelf().mulSelf(n).addSelf(this._origin),this._transformer?this._transformer.position=cc.v3(t):this.node.setPosition(t)},t.prototype._getTransformer=function(){var e=this.getComponent(d.default);e&&e.transformStrategy===d.default.Strategy.Values&&e.applyPosition&&(this._transformer=e)},t.prototype._ensureSnapper=function(){var e=this._snapper=this.getComponent(h.default)||this.addComponent(h.default),t=this.character;e._from=h.SnapType.Bone,e._fromSkeleton=t&&t.skeleton,e._fromBone=this._eyeTrackingBoneName,e._to=h.SnapType.Node,e._toNode=this.node},t.prototype._updateSnapperEnabled=function(){var e=this._transformer?this._transformer.position.equals(this.origin)&&this._transformer.isApplied:this.node.position.equals(this.origin),t=this.enabledInHierarchy&&(this._stroking||!e),r=this._snapper;r&&(r.enabled=t)},t.prototype._editorUpdateOrigin=function(){throw new Error("Cannot update the origin at runtime.")},c([y.default({type:p.default,scope:"parent",required:!1}),l("design:type",Object)],t.prototype,"character",void 0),c([m({visible:!0}),l("design:type",Object)],t.prototype,"_eyeTrackingBoneName",void 0),c([m({tooltip:"Maximum distance tracker can be from it's origin.",visible:!0,min:0,max:500,slide:!0}),l("design:type",Object)],t.prototype,"_range",void 0),c([m({tooltip:"Delay before eye tracking begins/ends",visible:!0,min:0}),l("design:type",Object)],t.prototype,"_delay",void 0),c([m({readonly:!0}),l("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Vec2)?r:Object)],t.prototype,"_origin",void 0),c([m(),l("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Vec3)?n:Object),l("design:paramtypes",[])],t.prototype,"origin",null),c([_,b("Drawing Component/Drawing Eye Tracker")],t)}(f.default);r.default=v,cc._RF.pop()},{"../Actor/CharacterController":"CharacterController","../Generic/Snapper":"Snapper","../Generic/Transform":"Transform","../Util/Decorators/cache":"cache","./DrawingUIHandler":"DrawingUIHandler"}],DrawingMirrorer:[function(e,t,r){"use strict";cc._RF.push(t,"e15e7IRNwhFe7BX8tGgFWtz","DrawingMirrorer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&a(t,e,r);return c(t,e),t},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},f=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},d=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var y=h(e("../../../Drawing/Drawing")),g=h(e("../../../DrawingUI/DrawingUIHandler")),_=h(e("../../../Drawing/DrawingSerializer")),m=h(e("../../../DrawingUI/DrawingUI")),b=l(e("../../../Actor/CharacterController")),v=h(e("../../../Util/Decorators/cache")),w=h(e("../../../Util/getComponentInScene")),O=h(e("../../../Util/sortBy")),S=h(e("../../../Generic/Snapper")),C=cc._decorator,P=C.ccclass,T=C.property,j=cc.js.getClassName,R=O.default("alpha"),x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawingTarget=null,t._mirrorCursor=null,t._scribblesMirror=null,t._inkMirror=null,t._drawAnimations=[],t._drawTrack=10,t._drawPoseMixDuration=.25,t._remappedRgba=new Map,t._maxDrawTrack=NaN,t._scribblesSnapper=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"scribblesSnapper",{get:function(){var e,t;return this._scribblesSnapper||(this._scribblesSnapper=null!==(t=null===(e=this._scribblesMirror)||void 0===e?void 0:e.skeleton.getComponent(S.default))&&void 0!==t?t:null),this._scribblesSnapper},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._createRemappedColors(),this._drawingTarget||(this.enabled=!1)},t.prototype.update=function(){var e;this._syncSourceAndTargetSplats(),(null===(e=this.scribblesSnapper)||void 0===e?void 0:e.enabledInHierarchy)?this._updateDrawCharacters():this._ensureScribblesTracksClear()},t.prototype._syncSourceAndTargetSplats=function(){for(var e=this._drawingSource.splatData,t=this._drawingTarget,r=t.splatData,n=this.scribblesSnapper,o=this._mirrorCursor;r.length<e.length;){var i=r.length,a=this._mutateSplatData(e[i]);(t.getComponent(_.default)||t.addComponent(_.default)).addSplatsFromSplatData(a),(null==n?void 0:n.enabledInHierarchy)&&(null==o||o.setPosition(cc.v2(a.position)))}},t.prototype._mutateSplatData=function(e){var t=i({},e);t.position={x:-1*e.position.x,y:e.position.y},t.scale={x:-1*e.scale.x,y:e.scale.y};var r=this._remappedRgba.get(e.color);return"number"==typeof r&&(t.color=r),t},t.prototype._createRemappedColors=function(){var e=w.default(m.default);if(!e)throw new Error("No "+j(m.default)+" in scene.");var t=e.colors.map(function(e){return e.toRGBValue()}),r=f(t);r.unshift(r.pop());for(var n=0;n<t.length;n++){var o=t[n],i=r[n];this._remappedRgba.set(o,i)}},t.prototype._updateDrawCharacters=function(){var e,t,r,n,o=this._mirrorCursor,i=this._scribblesMirror,a=this._inkMirror;if(o&&i&&a){var c=i.node.convertToWorldSpaceAR(cc.Vec2.ZERO),s=o.convertToWorldSpaceAR(cc.Vec2.ZERO).sub(c),l=s.clone();l.x/=i.skeleton.node.scaleX,l.y/=i.skeleton.node.scaleY;var u=this._getDrawAnimations(l);try{for(var p=d(u),f=p.next();!f.done;f=p.next()){var h=f.value;this._ensureDrawAnimation(h)}}catch(m){e={error:m}}finally{try{f&&!f.done&&(t=p.return)&&t.call(p)}finally{if(e)throw e.error}}this._maxDrawTrack=u.reduce(function(e,t){return Math.max(e,t.track)},0);var y=s.x<0?"left":"right";try{for(var g=d([i,a]),_=g.next();!_.done;_=g.next())_.value.setState({state:b.CharacterState.IDLE,facing:y})}catch(v){r={error:v}}finally{try{_&&!_.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}}},t.prototype._getDrawAnimations=function(e){var t=this,r=cc.v2(Math.abs(e.x),Math.max(e.y,0)),n=this._drawAnimations.map(function(e){var t=p(e.split(/_/).map(parseFloat).filter(function(e){return!Number.isNaN(e)}),2),n=t[0],o=t[1];if(void 0===n||void 0===o)throw new Error('Draw animation "'+e+'" name invalid.');var i=cc.v2(n,o);return{animation:e,pos:i,dist:r.sub(i).len()}}),o=n.reduce(function(e,t){return e.pos.len()>t.pos.len()?e:t}).pos.len(),a=n.reduce(function(e,t){return e.pos.len()<t.pos.len()?e:t}).pos.len();return n.map(function(e){return{alpha:1-(e.dist-a)/(o-a),animation:e.animation}}).sort(R).map(function(e,r){return i(i({},e),{track:t._drawTrack+r})})},t.prototype._ensureDrawAnimation=function(e){var t=this._scribblesMirror;if(t){var r=t.skeleton.getState().tracks[e.track];r?r.animation.name!==e.animation&&(r=t.skeleton.addAnimation(e.track,e.animation,!1)):r=t.skeleton.setAnimation(e.track,e.animation,!1),r&&(r.alpha=e.alpha,r.mixDuration=this._drawPoseMixDuration)}},t.prototype._ensureScribblesTracksClear=function(){var e=this._scribblesMirror;if(e&&!Number.isNaN(this._maxDrawTrack)){for(var t=e.skeleton.getState(),r=this._drawTrack;r<=this._maxDrawTrack;r++)t.tracks[r]&&e.skeleton.clearTrack(r);this._maxDrawTrack=NaN}},s([T({visible:!0,type:y.default}),u("design:type",Object)],t.prototype,"_drawingTarget",void 0),s([T({visible:!0,tooltip:"Node to move the position that is being drawn.",type:cc.Node}),u("design:type",Object)],t.prototype,"_mirrorCursor",void 0),s([T({type:b.default,visible:!0}),u("design:type",Object)],t.prototype,"_scribblesMirror",void 0),s([T({type:b.default,visible:!0}),u("design:type",Object)],t.prototype,"_inkMirror",void 0),s([T({type:cc.String,visible:function(){return!!this._scribblesMirror}}),u("design:type",Array)],t.prototype,"_drawAnimations",void 0),s([T({step:1,min:0,visible:!0}),u("design:type",Object)],t.prototype,"_drawTrack",void 0),s([T({min:0,max:2,slide:!0,visible:!0}),u("design:type",Object)],t.prototype,"_drawPoseMixDuration",void 0),s([v.default(y.default),u("design:type","function"==typeof(r=void 0!==y.default&&y.default)?r:Object)],t.prototype,"_drawingSource",void 0),s([P],t)}(g.default);r.default=x,cc._RF.pop()},{"../../../Actor/CharacterController":"CharacterController","../../../Drawing/Drawing":"Drawing","../../../Drawing/DrawingSerializer":"DrawingSerializer","../../../DrawingUI/DrawingUI":"DrawingUI","../../../DrawingUI/DrawingUIHandler":"DrawingUIHandler","../../../Generic/Snapper":"Snapper","../../../Util/Decorators/cache":"cache","../../../Util/getComponentInScene":"getComponentInScene","../../../Util/sortBy":"sortBy"}],DrawingSerializer:[function(e,t,r){"use strict";cc._RF.push(t,"271cad5SAxGMrleeQEn894q","DrawingSerializer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.toSplatData=void 0;var d=f(e("./Drawing")),h=e("../Generic/Grid"),y=e("../Util/convertTexture"),g=f(e("../Util/milliseconds")),_=f(e("../Util/chunker")),m=e("./DrawingStorage"),b=cc._decorator,v=b.ccclass,w=b.menu,O=b.disallowMultiple,S=cc.js.getClassName,C=cc.v2(-1e6,-1e6);function P(e){return{prefab:e.name,position:{x:e.x,y:e.y},scale:{x:e.scaleX,y:e.scaleY},color:e.color.toRGBValue(),opacity:e.opacity,angle:e.angle,width:e.width,height:e.height}}function T(e){var t=e.getTexture();if(!t)throw new Error("Cell does not have texture.");return{coord:e.coord.toJSON(),topRight:{x:e.topRight.x,y:e.topRight.y},bottomLeft:{x:e.bottomLeft.x,y:e.bottomLeft.y},opacity:e.opacity,dataUrl:y.textureToDataUrl(t)}}function j(e){return i(i({},P(e.node)),e.getParticleState())}r.toSplatData=P;var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var r;return o(t,e),r=t,Object.defineProperty(t.prototype,"drawing",{get:function(){var e=this.getComponent(d.default);if(!e)throw new Error(S(this)+" must have a "+S(d.default)+" component on the same node.");return e},enumerable:!1,configurable:!0}),t.serialize=function(e,t){return(e.getComponent(r)||e.addComponent(r)).serialize(t)},t.deserialize=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,(t=new cc.Node(e.name).addComponent(d.default)).addComponent(r).deserialize(e)];case 1:return n.sent(),[2,t]}})})},t.prototype.serialize=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(r){switch(r.label){case 0:return t=this._serializeSplats(),e!==m.SaveSerializationStrategy.Rasters?[3,2]:[4,this._serializeRaster(t)];case 1:r.sent(),r.label=2;case 2:return[2,t]}})})},t.prototype.deserialize=function(e){return this.drawing.clear(),this.drawing.node.name=e.name,this.drawing.textureResolution=e.textureResolution,this.drawing.textureScale=e.textureScale,this.drawing.baseColor=cc.color(e.baseColor),this._deserializeAndAddParticles(e),e.rasters?this._deserializeRaster(e):this._deserializeAndAddSplats(e)},t.prototype.addSplatsFromSplatData=function(e){var t=this,r=this._validateCanDeserializeNodeData();e=Array.isArray(e)?e:[e],this.drawing.addSplats(e.map(function(e){return t._deserializeSplat(e,r)}))},t.prototype.addPartilesFromParticleData=function(e){var t,r,n=this._validateCanDeserializeNodeData();e=Array.isArray(e)?e:[e];try{for(var o=l(e),i=o.next();!i.done;i=o.next()){var a=i.value;this._deserializeAndAddParticle(a,n)}}catch(c){t={error:c}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype._serializeSplats=function(){var e,t,r=this.drawing,n=r.textureResolution,o=r.textureScale,a=r.baseColor,c=[];try{for(var s=l(r.splatData),u=s.next();!u.done;u=s.next()){var p=u.value;c.push(i(i({},p),{position:i({},p.position),scale:i({},p.scale)}))}}catch(f){e={error:f}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return{name:this.node.name,textureResolution:n,textureScale:o,baseColor:a.toRGBValue(),splats:c,particles:r.particles.map(j).filter(function(e){return e.serialize})}},t.prototype._serializeRaster=function(e){return c(this,void 0,Promise,function(){var t,r,n,o,i,a,c,u;return s(this,function(s){switch(s.label){case 0:t=_.default("serialize"),r=this.drawing,e.rasters=[],s.label=1;case 1:s.trys.push([1,6,7,8]),n=l(r.textureCells),o=n.next(),s.label=2;case 2:return o.done?[3,5]:0===(i=o.value).opacity?[3,4]:(e.rasters.push(T(i)),t.check(1/60)?[4,g.default(0)]:[3,4]);case 3:s.sent(),s.label=4;case 4:return o=n.next(),[3,2];case 5:return[3,8];case 6:return a=s.sent(),c={error:a},[3,8];case 7:try{o&&!o.done&&(u=n.return)&&u.call(n)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})},t.prototype._deserializeAndAddSplats=function(e){return c(this,void 0,Promise,function(){var t,r,n,o,i,a,c,l;return s(this,function(s){switch(s.label){case 0:t=this._validateCanDeserializeNodeData(),r=[],n=_.default("deserialize"),o=0,s.label=1;case 1:return o<e.splats.length?(i=e.splats[o],a=this._deserializeSplat(i,t),r.push(a),c=o===e.splats.length-1,((l=r.length>=50)||c)&&(this.drawing.addSplats(r),r.length=0),c||l&&n.check(1/60)?[4,g.default(0)]:[3,3]):[3,5];case 2:s.sent(),s.label=3;case 3:if(!cc.isValid(this)||!cc.isValid(this.node))return[2];s.label=4;case 4:return o++,[3,1];case 5:return this.drawing._renderTextureCells(),[2]}})})},t.prototype._deserializeSplat=function(e,t){var r=t.drawings.useSplat(e.prefab);return this._applyNodeData(r,e),r},t.prototype._deserializeAndAddParticles=function(e){var t,r;if(0!==e.particles.length){var n=this._validateCanDeserializeNodeData();try{for(var o=l(e.particles),i=o.next();!i.done;i=o.next()){var a=i.value;this._deserializeAndAddParticle(a,n)}}catch(c){t={error:c}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}},t.prototype._deserializeAndAddParticle=function(e,t){var r=t.drawings.useParticle(e.prefab);this._applyNodeData(r.node,e),this.drawing.addParticle(r),r.applyParticleState(e)},t.prototype._deserializeRaster=function(e){return c(this,void 0,Promise,function(){var t,r,n,o,i,a,c,u,f,d;return s(this,function(s){switch(s.label){case 0:if(!e.rasters)throw new Error("_deserializeRaster requires DrawingData with rasters");this.drawing._splatData=p(e.splats),s.label=1;case 1:s.trys.push([1,6,7,8]),t=l(e.rasters),r=t.next(),s.label=2;case 2:return r.done?[3,5]:(n=r.value,o=new h.GridCoord(n.coord),(i=this.drawing._createTextureCell(o))._topRight=cc.v2(n.topRight),i._bottomLeft=cc.v2(n.bottomLeft),i._opacity=n.opacity,[4,y.dataUrlToHtmlImage(n.dataUrl,this.drawing.textureResolution)]);case 3:if(a=s.sent(),!cc.isValid(this)||!cc.isValid(this.node))return[3,5];(c=new cc.RenderTexture).initWithElement(a),i.sprite.spriteFrame=new cc.SpriteFrame(c),s.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return u=s.sent(),f={error:u},[3,8];case 7:try{r&&!r.done&&(d=t.return)&&d.call(t)}finally{if(f)throw f.error}return[7];case 8:return this.drawing._requiresBoundsAndOpacityUpdate=!0,this.drawing.updateBoundsAndOpacity(),[2]}})})},t.prototype._validateCanDeserializeNodeData=function(){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");if(this.node.parent||(this.node.setParent(gm.drawings.node),this.node.setPosition(C)),!this.enabledInHierarchy)throw new Error(S(this)+" must be enabled in order to deserialize splats.");return gm},t.prototype._applyNodeData=function(e,t){var r=this.drawing.node.convertToWorldSpaceAR(cc.v2(t.position));e.setPosition(r),e.setScale(t.scale.x,t.scale.y),e.setContentSize(t.width,t.height),e.angle=t.angle,e.opacity=t.opacity,e.color=cc.color(t.color)},r=a([v,O,w("Drawing Component/Drawing Serializer")],t)}(cc.Component);r.default=R,cc._RF.pop()},{"../Generic/Grid":"Grid","../Util/chunker":"chunker","../Util/convertTexture":"convertTexture","../Util/milliseconds":"milliseconds","./Drawing":"Drawing","./DrawingStorage":"DrawingStorage"}],DrawingSplatAdder:[function(e,t,r){"use strict";cc._RF.push(t,"ac523cTfiNBDaKCDeAfQChN","DrawingSplatAdder");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Drawing")),l=c(e("../Util/RandomUtil")),u=c(e("../Util/getComponentsInScene")),p=c(e("../Util/lerpAngle")),f=c(e("../Framework/GameComponent")),d=cc._decorator,h=d.ccclass,y=d.property,g=cc.js.getClassName,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawing=null,t._transformStart=null,t._transformEnd=null,t.splatPrefab=null,t.splatCount=32,t.drawOnLoad=!0,t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"drawing",{get:function(){if(this._drawing||(this._drawing=l.default.item(u.default(s.default))||null),!cc.isValid(this._drawing))throw new Error(g(s.default)+" could not be found.");return this._drawing},set:function(e){this._drawing=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformStart",{get:function(){if(!cc.isValid(this._transformStart))throw new Error('"Transform Start" not set in editor');return this._transformStart},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformEnd",{get:function(){if(!cc.isValid(this._transformEnd))throw new Error('"Transform End" not set in editor');return this._transformEnd},enumerable:!1,configurable:!0}),t.prototype.onGameStart=function(){this.drawOnLoad&&this.addSplats()},t.prototype.addSplats=function(){if(!gm.loaded)throw new Error(gm.name+" is not loaded");if(!this.splatPrefab)throw new Error("Splat Prefab not defined.");for(var e=this.transformStart,t=this.transformEnd,r=[],n=0;n<this.splatCount;n++){var o=gm.drawings.useSplat(this.splatPrefab);o.setParent(this.drawing.node.parent);var i=n/(this.splatCount-1),a=e.position.lerp(t.position,i),c=p.default(e.angle,t.angle,i),s=cc.misc.lerp(e.scale,t.scale,i),l=cc.misc.lerp(e.width,t.height,i),u=cc.misc.lerp(e.height,t.height,i),f=e.color.lerp(t.color,i),d=cc.misc.lerp(e.opacity,t.opacity,i);o.setPosition(a),o.setScale(s),o.setContentSize(l,u),o.color=f,o.opacity=d,o.angle=c,r.push(o)}return this.drawing.addSplats(r),r},i([y({type:s.default}),a("design:type",Object)],t.prototype,"_drawing",void 0),i([y({type:s.default,tooltip:"Drawing to add splats to. If not set in the inspector, a drawing will be randomly picked from the scene."}),a("design:type","function"==typeof(r=void 0!==s.default&&s.default)?r:Object),a("design:paramtypes",["function"==typeof(n=void 0!==s.default&&s.default)?n:Object])],t.prototype,"drawing",null),i([y({visible:!0,type:cc.Node,tooltip:"Start"}),a("design:type",Object)],t.prototype,"_transformStart",void 0),i([y({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_transformEnd",void 0),i([y({tooltip:"Splat to instance",type:cc.Prefab}),a("design:type",Object)],t.prototype,"splatPrefab",void 0),i([y({step:1,min:1,tooltip:"Number of splats to be added to the drawing."}),a("design:type",Object)],t.prototype,"splatCount",void 0),i([y({tooltip:"If true, the drawing will have splats added it onLoad."}),a("design:type",Object)],t.prototype,"drawOnLoad",void 0),i([h],t)}(f.default);r.default=_,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Util/RandomUtil":"RandomUtil","../Util/getComponentsInScene":"getComponentsInScene","../Util/lerpAngle":"lerpAngle","./Drawing":"Drawing"}],DrawingStorageMeta:[function(e,t,r){"use strict";cc._RF.push(t,"92c29dMYEdKzrnndCs+ShN2","DrawingStorageMeta");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Drawing")),l=c(e("../Util/Decorators/cache")),u=cc._decorator,p=u.ccclass,f=u.executeInEditMode,d=u.disallowMultiple,h=(cc.js.getClassName,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawingId="",t}var r,n;return o(t,e),r=t,t.ensure=function(e,t){if(!t)throw new Error("id cannot be blank");var n=e.getComponent(r)||e.addComponent(r);return n._drawingId=t,n},Object.defineProperty(t.prototype,"id",{get:function(){return this._drawingId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storageKey",{get:function(){if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");return gm.drawings.getStorageKeyById(this.id)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variation",{get:function(){if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");return gm.drawings.getVariationIndexById(this.id)},enumerable:!1,configurable:!0}),t.prototype.isSerialized=function(){if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");return gm.drawings.isIdSerialized(this.id)},t.prototype.onLoad=function(){},i([l.default(s.default),a("design:type","function"==typeof(n=void 0!==s.default&&s.default)?n:Object)],t.prototype,"drawing",void 0),r=i([p,d,f],t)}(cc.Component));r.default=h,cc._RF.pop()},{"../Util/Decorators/cache":"cache","./Drawing":"Drawing"}],DrawingStorage:[function(e,t,r){"use strict";cc._RF.push(t,"69e4eFCTDFI9Y662mElNo1n","DrawingStorage");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.DeleteVariation=r.GetVariation=r.SaveVariation=r.SaveSerializationStrategy=void 0;var d,h,y,g,_=f(e("../Framework/GameComponent")),m=f(e("./Particle")),b=f(e("./Drawing")),v=f(e("./DrawingSerializer")),w=f(e("./DrawingStorageMeta")),O=f(e("../Util/RandomUtil")),S=f(e("../Generic/InstancePool")),C=cc._decorator,P=C.ccclass,T=C.property,j=C.disallowMultiple;(function(e){e[e.Latest=0]="Latest",e[e.Specific=1]="Specific"})(d||(d={})),r.SaveVariation=d,function(e){e[e.Latest=0]="Latest",e[e.Specific=1]="Specific",e[e.Random=2]="Random"}(h||(h={})),r.GetVariation=h,function(e){e[e.Latest=0]="Latest",e[e.Specific=1]="Specific",e[e.Random=2]="Random",e[e.Every=3]="Every"}(y||(y={})),r.DeleteVariation=y,function(e){e[e.None=0]="None",e[e.Splats=1]="Splats",e[e.Rasters=2]="Rasters"}(g||(g={})),r.SaveSerializationStrategy=g;var R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderCameraPrefab=null,t._deserializeTextureCellMaterial=null,t._privateNode=null,t._maxVariations=new Map,t._variationIds=new Map,t._drawingIdCounter=0,t._stdMaxCachedDrawings=10,t._lowEndMaxCachedDrawings=4,t._isLowEndDevice=!1,t}return o(t,e),Object.defineProperty(t.prototype,"renderCameraPrefab",{get:function(){if(!cc.isValid(this._renderCameraPrefab))throw new Error("Render Camera Prefab not set in inspector");return this._renderCameraPrefab},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deserializeTextureCellMaterial",{get:function(){if(!cc.isValid(this._deserializeTextureCellMaterial))throw new Error("Deserialize Texture Cell Material not set in inspector");return this._deserializeTextureCellMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"privateNode",{get:function(){return cc.isValid(this._privateNode)||(this._privateNode=new cc.PrivateNode(this.node.name+" Private Components"),this._privateNode.setParent(this.node),this._privateNode.active=!1),this._privateNode},enumerable:!1,configurable:!0}),t.prototype._ensurePooler=function(e){for(var t="particle"===e?1:0,r=this.privateNode.getComponents(S.default);r.length<t+1;)r.push(this.privateNode.addComponent(S.default));return r[t]},t.prototype._ensurePooledInstanceOfEveryPrefab=function(e){var t,r,n=this._ensurePooler(e);try{for(var o=l(n.prefabs),i=o.next();!i.done;i=o.next()){var a=i.value,c=n.use(a);c.setParent(this.node),n.release(c)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},Object.defineProperty(t.prototype,"particlePrefabs",{get:function(){return this._ensurePooler("particle").prefabs},set:function(e){this._ensurePooler("particle").prefabs=e},enumerable:!1,configurable:!0}),t.prototype.getParticlePrefab=function(e){return this._ensurePooler("particle").getPrefab(e)},t.prototype.useParticle=function(e){return this._ensurePooler("particle").create(e).getComponent(m.default)},t.prototype.releaseParticle=function(e){this._ensurePooler("particle").release(e.node)},Object.defineProperty(t.prototype,"splatPrefabs",{get:function(){return this._ensurePooler("splat").prefabs},set:function(e){this._ensurePooler("splat").prefabs=e},enumerable:!1,configurable:!0}),t.prototype.getSplatPrefab=function(e){return this._ensurePooler("splat").getPrefab(e)},Object.defineProperty(t.prototype,"_maxSplatPoolSize",{get:function(){return this._ensurePooler("splat").maxInstances},set:function(e){var t,r;try{for(var n=l(["splat","particle"]),o=n.next();!o.done;o=n.next()){var i=o.value;this._ensurePooler(i).maxInstances=e}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},enumerable:!1,configurable:!0}),t.prototype.useSplat=function(e){return this._ensurePooler("splat").use(e)},t.prototype.releaseSplat=function(e){this._ensurePooler("splat").release(e)},t.prototype.onGameLoad=function(){this._ensurePooler("particle"),this._ensurePooler("splat")},t.prototype.onGameLoaded=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this._isLowEndDevice=e.isLowEndDevice,this._ensurePooledInstanceOfEveryPrefab("particle"),this._ensurePooledInstanceOfEveryPrefab("splat"),[4,this._createVariationIds()];case 1:return t.sent(),this._setDrawingIDCounter(),this.privateNode.active&&(this.privateNode.active=!1),[2]}})})},t.prototype.storeDrawing=function(e){return c(this,void 0,Promise,function(){var t,r,n,o;return s(this,function(i){switch(i.label){case 0:return t=this._getVariationIds(e.storageKey),(r=e.variationStrategy===d.Latest?t.length:this.getVariationIndex({storageKey:e.storageKey,variationStrategy:h.Specific,variation:e.variation}))>t.length&&(cc.warn("Variation "+r+" out of range. Drawings for storageKey '"+e.storageKey+"' can only set variation"+(t.length>0?"s 0 -":"")+" "+t.length+". If you're unsure, use SaveVariationStrategy.Latest"),r=t.length),(n=t[r])||(n=this._createDrawingID(),t.push(n)),o=this._setCachedDrawing(e.drawing,n),e.serialize===g.None?[3,2]:[4,this._serializeDrawing(e.drawing,n,e.storageKey,e.serialize)];case 1:i.sent(),i.label=2;case 2:return[4,this._deleteExtraneousVariations(e.storageKey,e.serialize!==g.None)];case 3:return i.sent(),[2,o]}})})},t.prototype.getStoredDrawing=function(e){var t=this._getVariationIds(e.storageKey);if(0===t.length)return null;var r=t[this.getVariationIndex(e)];if(!r)return null;var n=this._getCachedDrawing(r);return!n&&e.deserialize&&(n=this._deserializeDrawing(r)),n},t.prototype.copyStoredDrawing=function(e){var t=this.getStoredDrawing(e),r=this.node;return t instanceof Promise?t.then(function(e){return(cc.isValid(r,!0)?e:null)&&e.copy()}):(cc.isValid(r,!0)?t:null)&&t.copy()},t.prototype.deleteStoredDrawing=function(e){return c(this,void 0,Promise,function(){var t,r,n,o,i,a,c,u,p,f,d,h,g;return s(this,function(s){switch(s.label){case 0:t=this._getVariationIds(e.storageKey),e.variationStrategy===y.Every?r=t.splice(0,t.length):(n=this.getVariationIndex({storageKey:e.storageKey,variationStrategy:e.variationStrategy,variation:e.variation}),r=t.splice(n,1));try{for(o=l(r),i=o.next();!i.done;i=o.next())u=i.value,this._deleteCachedDrawing(u)}catch(_){f={error:_}}finally{try{i&&!i.done&&(d=o.return)&&d.call(o)}finally{if(f)throw f.error}}if(!e.serialize)return[3,8];s.label=1;case 1:s.trys.push([1,6,7,8]),a=l(r),c=a.next(),s.label=2;case 2:return c.done?[3,5]:(u=c.value,[4,this._deleteSerializedDrawing(u)]);case 3:s.sent(),s.label=4;case 4:return c=a.next(),[3,2];case 5:return[3,8];case 6:return p=s.sent(),h={error:p},[3,8];case 7:try{c&&!c.done&&(g=a.return)&&g.call(a)}finally{if(h)throw h.error}return[7];case 8:return[2]}})})},t.prototype.hasStoredDrawing=function(e){var t=this._getVariationIds(e.storageKey);return 0!==t.length&&this.getVariationIndex(e)in t},t.prototype.clearCachedDrawings=function(){this.privateNode.removeAllChildren()},t.prototype.clearAllDrawings=function(){return c(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.clearCachedDrawings(),[4,gm.untilLoaded];case 1:return[4,(e=t.sent()).storage.clear({store:"drawing-meta"})];case 2:return t.sent(),[4,e.storage.clear({store:"drawing-data"})];case 3:return t.sent(),this._variationIds.clear(),this._drawingIdCounter=0,[2]}})})},t.prototype.getNumMaxVariations=function(e){var t=this._maxVariations.get(e);return"number"!=typeof t&&(t=1),t},t.prototype.setNumMaxVariations=function(e,t){return c(this,void 0,Promise,function(){return s(this,function(r){switch(r.label){case 0:if(t<1)throw new Error("Must be at least 1");return this._maxVariations.set(e,t),[4,this._deleteExtraneousVariations(e,!0)];case 1:return r.sent(),[2]}})})},t.prototype.getVariationIndex=function(e){var t,r=this._getVariationIds(e.storageKey),n=r?r.length:1,o=n-1;switch(e.variationStrategy){case h.Specific:if("number"!=typeof e.variation)throw new Error("If variationStrategy is set to Specific an accompanying numeric variation must be provided");t=e.variation;break;case h.Random:t=O.default.integer(n);break;default:case h.Latest:t=o}return t},t.prototype.getVariationIndexById=function(e){var t,r;try{for(var n=l(this._variationIds.values()),o=n.next();!o.done;o=n.next()){var i=o.value.indexOf(e);if(i>=0)return i}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}throw new Error("No variation index could be found for id: "+e)},t.prototype.isIdSerialized=function(e){return gm.loaded?gm.storage.has({store:"drawing-meta",id:e}):Promise.resolve(!1)},t.prototype.getStorageKeyById=function(e){var t,r;try{for(var n=l(this._variationIds),o=n.next();!o.done;o=n.next()){var i=u(o.value,2),a=i[0];if(i[1].indexOf(e)>=0)return a}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}throw new Error("No storageKey could be found for id: "+e)},t.prototype.getAllStorageKeys=function(){return p(this._variationIds.keys())},t.prototype._getVariationIds=function(e){return this._variationIds.has(e)||this._variationIds.set(e,[]),this._variationIds.get(e)},t.prototype._createVariationIds=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c;return s(this,function(s){switch(s.label){case 0:return gm.loaded?[4,gm.storage.find({store:"drawing-meta"})]:[2];case 1:e=s.sent();try{for(t=l(e),r=t.next();!r.done;r=t.next())n=u(r.value,2),o=n[0],null!==(p=i=n[1])&&"object"==typeof p&&"string"==typeof p.storageKey&&this._getVariationIds(i.storageKey).push(o)}catch(f){a={error:f}}finally{try{r&&!r.done&&(c=t.return)&&c.call(t)}finally{if(a)throw a.error}}return[2]}var p})})},t.prototype._deleteExtraneousVariations=function(e,t){return c(this,void 0,Promise,function(){var r,n;return s(this,function(o){switch(o.label){case 0:r=this.getNumMaxVariations(e),n=0,o.label=1;case 1:return this._getVariationIds(e).length>r?(n++,[4,this.deleteStoredDrawing({variationStrategy:y.Specific,variation:0,storageKey:e,serialize:t})]):[3,3];case 2:return o.sent(),[3,1];case 3:return[2,n]}})})},t.prototype._setDrawingIDCounter=function(){var e,t,r,n;this._drawingIdCounter=0;try{for(var o=l(this._variationIds.values()),i=o.next();!i.done;i=o.next()){var a=i.value;if(a)try{for(var c=(r=void 0,l(a)),s=c.next();!s.done;s=c.next()){var u=s.value;this._drawingIdCounter=Math.max(parseInt(u),this._drawingIdCounter)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}}catch(f){e={error:f}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype._createDrawingID=function(){for(var e=(++this._drawingIdCounter).toString();e.length<3;)e="0"+e;return e},Object.defineProperty(t.prototype,"_maxCachedDrawings",{get:function(){var e=this._isLowEndDevice?this._lowEndMaxCachedDrawings:this._stdMaxCachedDrawings;return Math.max(e,1)},enumerable:!1,configurable:!0}),t.prototype._setCachedDrawing=function(e,t){if(this._maxCachedDrawings<=0)throw new Error("Maximum cached drawings must be higher than 0");var r=this.privateNode.getChildByName(t);return r&&r.destroy(),e.node.name=t,e.node.setParent(this.privateNode),e.node.setPosition(0,0),e.node.setContentSize(0,0),e.node.angle=0,e.node.opacity=255,e.node.color=cc.Color.WHITE,e.node.scale=1,this._deleteExtraneousCachedDrawings(e),w.default.ensure(e,t)},t.prototype._getCachedDrawing=function(e){var t=this.privateNode.getChildByName(e);return cc.isValid(t,!0)?t.getComponent(b.default):null},t.prototype._deleteCachedDrawing=function(e){var t=this.privateNode.getChildByName(e);if(t){var r=t.getComponent(b.default);r&&(r.enabled=!1,r.destroy()),t.active=!1,t.setParent(null),t.destroy()}},t.prototype._deleteExtraneousCachedDrawings=function(e){var t=this.privateNode.children.filter(function(t){return cc.isValid(t,!0)&&t!==e.node});for(t.sort(function(e,t){return parseInt(e.name)>parseInt(t.name)?1:-1});t.length+1>this._maxCachedDrawings;){var r=t.shift();cc.warn("Number of cached drawings exceeded maximum of "+this._maxCachedDrawings+". Drawing "+r.name+" has been removed."),r.destroy()}},t.prototype._deserializeDrawing=function(e){return c(this,void 0,Promise,function(){var t,r;return s(this,function(n){switch(n.label){case 0:return gm.loaded?[4,gm.storage.get({store:"drawing-data",id:e})]:[2,null];case 1:return null===(o=t=n.sent())||"object"!=typeof o||"string"!=typeof o.name||(i=o.textureResolution,Number.isNaN(i)||Math.ceil(Math.log2(i))!==Math.floor(Math.log2(i)))||"number"!=typeof o.textureScale||"number"!=typeof o.baseColor||!Array.isArray(o.splats)||o.rasters&&!Array.isArray(o.rasters)?(cc.warn("Invalid drawing data was stored for drawing "+e),[2,null]):[4,v.default.deserialize(t)];case 2:return r=n.sent(),this._setCachedDrawing(r,e),[2,r]}var o,i})})},t.prototype._serializeDrawing=function(e,t,r,n){return c(this,void 0,Promise,function(){var o,i,a,c,l;return s(this,function(s){switch(s.label){case 0:return gm.loaded?(o=gm.storage,i=gm.isLowEndDevice,a={storageKey:r},(o.usingLocalStorage||i)&&(n=g.Splats),[4,v.default.serialize(e,n)]):[2];case 1:c=s.sent(),l=0,s.label=2;case 2:if(!(l<3))return[3,11];s.label=3;case 3:return s.trys.push([3,6,,10]),[4,o.set({store:"drawing-meta",id:t,value:a})];case 4:return s.sent(),[4,o.set({store:"drawing-data",id:t,value:c})];case 5:return s.sent(),[3,11];case 6:return"QuotaExceededError"===s.sent().name?[4,this._deleteOldestSerializedDrawing()]:[3,8];case 7:return s.sent(),[3,9];case 8:return[3,11];case 9:return[3,10];case 10:return l++,[3,2];case 11:return[2]}})})},t.prototype._deleteOldestSerializedDrawing=function(){return c(this,void 0,Promise,function(){var e,t,r;return s(this,function(n){switch(n.label){case 0:return gm.loaded?[4,gm.storage.find({store:"drawing-meta"})]:[2];case 1:return e=n.sent(),t=u(p(e.keys()),1),r=t[0],[4,this._deleteSerializedDrawing(r)];case 2:return n.sent(),cc.warn("deleted oldest serialized drawing to make room for more:",r),[2]}})})},t.prototype._deleteSerializedDrawing=function(e){return c(this,void 0,Promise,function(){var t;return s(this,function(r){switch(r.label){case 0:return gm.loaded?[4,(t=gm.storage).remove({store:"drawing-meta",id:e})]:[2];case 1:return r.sent(),[4,t.remove({store:"drawing-data",id:e})];case 2:return r.sent(),[2]}})})},i([T({visible:!0,type:cc.Prefab,tooltip:"Camera configured specifically for allowing Drawings to render texture cells."}),a("design:type",Object)],t.prototype,"_renderCameraPrefab",void 0),i([T({visible:!0,type:cc.Material,tooltip:"Metarial temporarily applied to Drawing Texture nodes that allows rasterized texture cells to be drawn on after deserializing."}),a("design:type",Object)],t.prototype,"_deserializeTextureCellMaterial",void 0),i([T({visible:!1,type:cc.Node}),a("design:type",Object)],t.prototype,"_privateNode",void 0),i([T({type:cc.Prefab}),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"particlePrefabs",null),i([T({type:cc.Prefab}),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"splatPrefabs",null),i([T({min:1,max:256,step:1,slide:!0,visible:!0,tooltip:"Maximum number of splat instances of a given prefab to keep in the splat pools."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"_maxSplatPoolSize",null),i([T({visible:!0,tooltip:"Maximum number of drawings that can exist on the drawing cache node. If this number is exceeded, drawings will be deleted and deleted drawings will have to be deserialized on recall.\n\n",min:1,step:1}),a("design:type",Object)],t.prototype,"_stdMaxCachedDrawings",void 0),i([T({visible:!0,tooltip:"Same as Max Cached Drawings, except for low end devices.",min:1,step:1}),a("design:type",Object)],t.prototype,"_lowEndMaxCachedDrawings",void 0),i([P,j],t)}(_.default);r.default=R,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Generic/InstancePool":"InstancePool","../Util/RandomUtil":"RandomUtil","./Drawing":"Drawing","./DrawingSerializer":"DrawingSerializer","./DrawingStorageMeta":"DrawingStorageMeta","./Particle":"Particle"}],DrawingTextureCell:[function(e,t,r){"use strict";cc._RF.push(t,"62e39WqaERJGZ+YxcTwqivy","DrawingTextureCell");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./DrawingComponent")),l=c(e("../Util/Decorators/cache")),u=c(e("../Util/chunker")),p=cc._decorator,f=p.ccclass,d=p.disallowMultiple,h=p.property,y=cc.js.getClassName,g=Math.ceil,_=Math.min;function m(e){var t=e.clone();return t.setA(0),t}var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._baseColor=null,t._textureScale=null,t._boundsUpdateTimer=u.default("bounds-update"),t._opacity=0,t._topRight=cc.Vec2.ZERO,t._bottomLeft=cc.Vec2.ZERO,t._coord=null,t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"baseColor",{get:function(){return this._baseColor||this.node.color},set:function(e){this._baseColor instanceof cc.Color?cc.warn(this.name+": _baseColor can only be set once."):this._baseColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureScale",{get:function(){return this._textureScale||1},set:function(e){"number"==typeof this._textureScale?cc.warn(this.name+": _textureScale can only be set once."):this._textureScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this._requiresBoundsAndOpacityUpdate&&this.onUpdateBoundsAndOpacity(),this._opacity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return this._requiresBoundsAndOpacityUpdate&&this.onUpdateBoundsAndOpacity(),this._topRight.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return this._requiresBoundsAndOpacityUpdate&&this.onUpdateBoundsAndOpacity(),this._bottomLeft.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coord",{get:function(){if(!this._coord)throw new Error(y(this)+' does not have a set "coord" property.');return this._coord},set:function(e){if(this._coord)throw new Error(".coord should only be set once; by the drawing that created it.");this._coord=e},enumerable:!1,configurable:!0}),t.prototype.render=function(e,t){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");var r=this._ensureTexture(e),n=this._isImageElementTexture(r);n?r=this._createTexture(e):this.sprite.enabled=!1,e.targetTexture=r,e.backgroundColor=m(this.baseColor),e.orthoSize=this.node.width/2,e.render(t),n?this.sprite.spriteFrame=new cc.SpriteFrame(r):this.sprite.enabled=!0,this._requiresBoundsAndOpacityUpdate=!0},t.prototype.getTexture=function(){var e=this.sprite.spriteFrame;return e&&e.getTexture()},t.prototype.onUpdateBoundsAndOpacity=function(){if(cc.isValid(this)&&cc.isValid(this.node)){var e=cc.v2(-1/0,-1/0),t=cc.v2(1/0,1/0),r=0,n=this.getTexture();if(!n)return this._topRight=e,this._bottomLeft=t,void(this._opacity=r);for(var o=n.readPixels(),i=0,a=0;a<n.height;a+=2)for(var c=n.height*a*4,s=0;s<n.width;s+=2){var l=o[c+4*s+3];i++,r+=l,l<=0||(a*this.textureScale>e.y&&(e.y=a*this.textureScale),a*this.textureScale<t.y&&(t.y=a*this.textureScale),s*this.textureScale>e.x&&(e.x=s*this.textureScale),s*this.textureScale<t.x&&(t.x=s*this.textureScale))}var u=cc.v2(n.width*this.textureScale,n.height*this.textureScale).divide(2);this._topRight=e.subtract(u),this._bottomLeft=t.subtract(u),this._opacity=_(g(r/i),255),this._boundsUpdateTimer.reset(!1)}},t.prototype._ensureTexture=function(e){var t=this.sprite,r=t.spriteFrame&&t.spriteFrame.getTexture();return r||(r=this._createTexture(e),t.spriteFrame=this._createSpriteFrame(r)),r},t.prototype._createTexture=function(e){var t=new cc.RenderTexture;t.initWithSize(this.node.width,this.node.height);var r=e.clearFlags;return e.clearFlags=cc.Camera.ClearFlags.COLOR|cc.Camera.ClearFlags.STENCIL,e.targetTexture=t,e.backgroundColor=m(this.baseColor),e.render(e.node),e.clearFlags=r,t},t.prototype._createSpriteFrame=function(e){var t=this.node,r=t.width,n=t.height;return new cc.SpriteFrame(e,cc.rect(0,0,r,n))},t.prototype._isImageElementTexture=function(e){return!!e&&2048===e.width&&2048===e.height},i([l.default({type:cc.Sprite,create:!0}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Sprite)?r:Object)],t.prototype,"sprite",void 0),i([h(),a("design:type",Object)],t.prototype,"_baseColor",void 0),i([h(),a("design:type",Object)],t.prototype,"_textureScale",void 0),i([h(),a("design:type",Object)],t.prototype,"_opacity",void 0),i([h(),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Vec2)?n:Object)],t.prototype,"_bottomLeft",void 0),i([h(),a("design:type",Object)],t.prototype,"_coord",void 0),i([f,d],t)}(s.default);r.default=b,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/chunker":"chunker","./DrawingComponent":"DrawingComponent"}],DrawingToolCursor:[function(e,t,r){"use strict";cc._RF.push(t,"55714DckLhNYoaS+twHO2MM","DrawingToolCursor");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./DrawingTool")),l=c(e("./EmitterDrawingTool")),u=c(e("../Drawing/Drawing")),p=c(e("../Util/Decorators/cache")),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,g=cc.js.getClassName,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tool=null,t.drawing=null,t.touching=!1,t.sizeFactor=.5,t}return o(t,e),Object.defineProperty(t.prototype,"tool",{get:function(){return this._tool},set:function(e){this._tool=e},enumerable:!1,configurable:!0}),t.prototype.playCursorAnimation=function(e){var t=this;return new Promise(function(r,n){var o=t.animator;if(!o)return n(new Error(g(t)+" cannot play a cursor animation without "+g(cc.Animation)+" component."));var i=t._resolveClipName(e,o);if(!i)throw new Error("No playable clip on animator.");o.play(i),o.once(cc.Animation.EventType.FINISHED,r)})},t.prototype.setTouching=function(e){this.touching=e},t.prototype.setSizeFactor=function(e){this.sizeFactor=e},t.prototype.onLoad=function(){this._deferAnimatorAutoPlay()},t.prototype.getActorComponentState=function(){return{enabled:this.enabled,touching:this.touching,tool:this.tool,sizeFactor:this.sizeFactor}},t.prototype.applyActorComponentState=function(e){this.enabled=e.enabled,this.touching=e.touching,this.tool=e.tool,this.sizeFactor=e.sizeFactor},t.prototype.update=function(){var e=this.tool,t=this.drawing,r=this.node;if(cc.isValid(e)){e instanceof l.default&&(e.sizeFactor=this.sizeFactor,r.width=r.height=cc.misc.lerp(e.sizeMin,e.sizeMax,this.sizeFactor)),e.drawing!==t&&(e.drawing=t);var n={world:r.convertToWorldSpaceAR(cc.Vec2.ZERO),scale:1,angle:0};!e.isDrawing&&this.touching?e.touchStart(n):e.isDrawing&&this.touching?e.touchMove(n):e.isDrawing&&!this.touching&&e.touchEnd(n)}},t.prototype._deferAnimatorAutoPlay=function(){var e=this.animator;e&&e.playOnLoad&&(e.playOnLoad=!1,gm.untilLoaded.then(function(){e.play(),e.playOnLoad=!0}))},t.prototype._resolveClipName=function(e,t){var r;return e||(e=t.defaultClip||void 0),e instanceof cc.AnimationClip?(r=e.name,t.getClips().includes(e)||t.addClip(e)):r=e,r},i([h({type:s.default,visible:!0,formerlySerializedAs:"tool"}),a("design:type",Object)],t.prototype,"_tool",void 0),i([h({type:u.default}),a("design:type",Object)],t.prototype,"drawing",void 0),i([h({animatable:!0}),a("design:type",Object)],t.prototype,"touching",void 0),i([h({animatable:!0,min:0,max:1,slide:!0,visible:function(){return null===this.tool||this.tool instanceof l.default}}),a("design:type",Object)],t.prototype,"sizeFactor",void 0),i([p.default({type:cc.Animation,required:!1}),a("design:type",Object)],t.prototype,"animator",void 0),i([d,y("Drawing Component/Drawing Tool Cursor")],t)}(cc.Component);r.default=_,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../Util/Decorators/cache":"cache","./DrawingTool":"DrawingTool","./EmitterDrawingTool":"EmitterDrawingTool"}],DrawingTool:[function(e,t,r){"use strict";cc._RF.push(t,"4aeb8VfUKtBLJ8sGv8OX8aw","DrawingTool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.TouchTool=void 0;var p=u(e("../Util/RandomUtil")),f=cc._decorator,d=f.ccclass,h=f.property,y=cc.js.getClassName,g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(cc.Component);r.TouchTool=g;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._splatPrefabs=[],t._particlePrefabs=[],t.colors=[cc.Color.WHITE],t._isDrawing=!1,t._startTouchCoord={world:cc.Vec2.ZERO,angle:0,scale:1},t._currentTouchCoord={world:cc.Vec2.ZERO,angle:0,scale:1},t._lastCreatedTimeStamp=NaN,t}return o(t,e),Object.defineProperty(t.prototype,"splatPrefabs",{get:function(){return this._splatPrefabs.filter(function(e){return e})},set:function(e){this._splatPrefabs=l(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particlePrefabs",{get:function(){return this._particlePrefabs.filter(function(e){return e})},set:function(e){this._particlePrefabs=l(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDrawing",{get:function(){return this._isDrawing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTouchCoord",{get:function(){if(!this.isDrawing)throw new Error("Not currently drawing.");return i(i({},this._startTouchCoord),{world:this._startTouchCoord.world.clone()})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTouchCoord",{get:function(){if(!this.isDrawing)throw new Error("Not currently drawing.");return i(i({},this._currentTouchCoord),{world:this._currentTouchCoord.world.clone()})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastCreatedTimeStamp",{get:function(){return this._lastCreatedTimeStamp},enumerable:!1,configurable:!0}),t.prototype.touchStart=function(e){this._isDrawing=!0,this._startTouchCoord=e,this._currentTouchCoord=i(i({},e),{world:e.world.clone()})},t.prototype.touchMove=function(e){this._currentTouchCoord=e},t.prototype.touchEnd=function(e){this._currentTouchCoord=e,this._isDrawing=!1},t.prototype.update=function(e){this.drawing&&this.isDrawing&&this.onDraw(e,this.drawing)},t.prototype.createSplat=function(e){"number"!=typeof e&&(e=this.splatPrefabs.length>0?0:p.default.index(this.splatPrefabs));var t=this.splatPrefabs[e];if(!t)throw new Error("Could not create splat on "+y(this.constructor)+" "+this.node.name+", no splat names defined in editor.");if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return gm.drawings.useSplat(t)},t.prototype.createParticle=function(e){"number"!=typeof e&&(e=this.particlePrefabs.length>0?0:p.default.index(this.particlePrefabs));var t=this.particlePrefabs[e];if(!t)throw new Error("Could not create particle on "+y(this.constructor)+" "+this.node.name+", no splat names defined in editor.");if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return gm.drawings.useParticle(t)},t.prototype.createSplatOrParticle=function(){var e=this.splatPrefabs.length,t=e+this.particlePrefabs.length;this._lastCreatedTimeStamp=Date.now();var r=p.default.integer(0,t);if(r<e){var n=r;return this.createSplat(n)}var o=r-e;return this.createParticle(o)},a([h({visible:!0,tooltip:"Should be selected from prefabs in Drawing/Prefabs/Splats",type:cc.Prefab}),c("design:type",Array)],t.prototype,"_splatPrefabs",void 0),a([h({visible:!0,tooltip:"Should be selected from prefabs in Drawing/Prefabs/Particles",type:cc.Prefab}),c("design:type",Array)],t.prototype,"_particlePrefabs",void 0),a([h({tooltip:"Colors this tool can use to color splats.",type:cc.Color}),c("design:type",Array)],t.prototype,"colors",void 0),a([d],t)}(g);r.default=_,cc._RF.pop()},{"../Util/RandomUtil":"RandomUtil"}],DrawingUIColorButtons:[function(e,t,r){"use strict";cc._RF.push(t,"f0c76wxyUZLpZGvTyFNdcYU","DrawingUIColorButtons");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./DrawingUIOptionButtons")),f=s(e("./DrawingUIToolButton")),d=u(e("../Generic/Transform")),h=u(e("../Util/EventHandlerUtils")),y=cc._decorator,g=y.ccclass,_=y.property,m=y.executeInEditMode,b=cc.js.getClassName,v=Math.max,w=Math.ceil,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._colorButtonPrefab=null,t}return o(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.drawingUI.color},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this._ensureButtons(this.drawingUI.colors)},t.prototype.onSelectColor=function(){this._scaleButtonHighlights()},t.prototype.onSetColors=function(e){this._ensureButtons(e)},t.prototype.onSelectTool=function(e){var t=e.getComponent(f.default);t&&t.colorStrategy!==f.ColorStrategy.Inherit?this._hideButtons():this._showButtons()},t.prototype._getSelectedButton=function(e){var t=this;return e.find(function(e){return t.color.equals(e.node.color)})||null},t.prototype._ensureButtons=function(e){for(var t=this.getComponentsInChildren(cc.Button),r=v(t.length,e.length),n=0;n<r;n++){var o=e[n],i=t[n];o&&!i?this._createButton(o,n):o&&i&&!o.equals(i.node.color)?(i.node.color=o.clone(),i.node.name="Color Button #"+o.toHEX("#rrggbb")):!o&&i&&i.node.destroy()}this._leftAlignButtons(),this._scaleButtonHighlights()},t.prototype._createButton=function(e,t){if(!this._colorButtonPrefab)throw new Error('"Color Button Prefab" not set in inspector.');var r=cc.instantiate(this._colorButtonPrefab);r.color=e,r.setParent(this.node),r.setSiblingIndex(t),r.name="Color Button #"+e.toHEX("#rrggbb");var n=r.getComponent(cc.Button);if(!n)throw r.destroy(),new Error('"Color Button Prefab" is corrupt, should have a '+b(cc.Button)+" component attached to it.");h.default.ensure(this._createButtonClickEvent(),n.clickEvents);var o=r.getComponentInChildren(d.default);o&&(o.target=r)},t.prototype._createButtonClickEvent=function(){return{target:this.drawingUI.node,component:this.drawingUI,handler:"selectColor"}},t.prototype._leftAlignButtons=function(){var e=this.getComponent(cc.Layout);if(!e)throw new Error(b(this)+" requires a "+b(cc.Layout)+" component.");var t=this.getComponent(cc.Widget);t&&(t.enabled=!1);var r=this.node.children.filter(function(e){return cc.isValid(e,!0)}).length,n=this.node.children.map(function(e){return e.width})[0]||0,o=w(r/2),i=o*e.spacingX+o*n;this.node.width=i,t&&(t.enabled=!0)},c([_({visible:!0,type:cc.Prefab}),l("design:type",Object)],t.prototype,"_colorButtonPrefab",void 0),c([g,m],t)}(p.default);r.default=O,cc._RF.pop()},{"../Generic/Transform":"Transform","../Util/EventHandlerUtils":"EventHandlerUtils","./DrawingUIOptionButtons":"DrawingUIOptionButtons","./DrawingUIToolButton":"DrawingUIToolButton"}],DrawingUIHandler:[function(e,t,r){"use strict";cc._RF.push(t,"e8b87XdURlEK6WnqNKGpBOp","DrawingUIHandler");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=i(e("./DrawingUI")),c=i(e("../Util/getComponentInScene")),s=i(e("../Util/getComponentInParents")),l=cc.js.getClassName,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawingUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"drawingUI",{get:function(){if(this._drawingUI||(this._drawingUI=s.default(this.node,a.default)||c.default(a.default)),!this._drawingUI)throw new Error(l(a.default)+" could not be found.");return this._drawingUI},enumerable:!1,configurable:!0}),t.prototype.onTouchStart=function(){},t.prototype.onTouchMove=function(){},t.prototype.onTouchEnd=function(){},t.prototype.onSelectTool=function(){},t.prototype.onSelectColor=function(){},t.prototype.onSelectSizeFactor=function(){},t.prototype.onHidden=function(){},t.prototype.onShown=function(){},t.prototype.onToolsHidden=function(){},t.prototype.onToolsShown=function(){},t.prototype.onSetColors=function(){},t}(cc.Component);r.default=u,cc._RF.pop()},{"../Util/getComponentInParents":"getComponentInParents","../Util/getComponentInScene":"getComponentInScene","./DrawingUI":"DrawingUI"}],DrawingUIHider:[function(e,t,r){"use strict";cc._RF.push(t,"271b9clgY9E8JY/dqj1iMFF","DrawingUIHider");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./DrawingUIHandler")),l=c(e("./DrawingUI")),u=c(e("../Generic/ButtonAsynchronizer")),p=c(e("../Generic/Hider")),f=c(e("../Util/Decorators/cache")),d=c(e("../Util/getComponentInScene")),h=cc._decorator,y=h.ccclass,g=h.executeInEditMode,_=h.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toolsOpenNode=null,t._hideUnusedButton=!1,t._hideOnDrawingUIHidden=!0,t._hideOnStroke=!1,t._strokeHideDelay=.4,t._strokeShowDelay=.4,t._isStroking=!1,t._wasHiddenByStroke=!1,t._timeSinceStrokeEnded=0,t._timeSinceStrokeStarted=0,t}var r;return o(t,e),t.prototype.onTouchStart=function(){this._hideOnStroke&&(this._isStroking=!0,this._wasHiddenByStroke=!1)},t.prototype.onTouchEnd=function(){this._hideOnStroke&&(this._hideOnStroke&&(this._timeSinceStrokeEnded=this._strokeShowDelay),this._isStroking=!1)},t.prototype.update=function(e){var t=d.default(l.default),r=this.hider,n=this.toolsOpenNode;if(r.hidden=this._countsAsHidden(e,t),!r.hidden&&r.transform&&r.shownNode&&r.hiddenNode&&n){var o=!r.hidden&&!!t&&!t.toolsHidden;r.transform.target=o?n:r.shownNode}},t.prototype._countsAsHidden=function(e,t){if(this._hideOnStroke&&(this._timeSinceStrokeStarted=cc.misc.clampf(this._timeSinceStrokeStarted+e*(this._isStroking?1:-1),0,this._strokeHideDelay)),this._hideOnStroke&&this._timeSinceStrokeEnded>0&&(this._timeSinceStrokeEnded-=e,this._wasHiddenByStroke))return!0;if(this._hideOnStroke&&this._timeSinceStrokeStarted>=this._strokeHideDelay)return this._wasHiddenByStroke=!0,!0;if(this._hideOnDrawingUIHidden&&(!t||t.hidden))return!0;if(this._hideUnusedButton){var r=this.getComponent(cc.Button);if(r&&(!r.interactable||0===u.default.getClickEvents(r).length))return!0}return!1},i([f.default({type:p.default,create:!0}),a("design:type","function"==typeof(r=void 0!==p.default&&p.default)?r:Object)],t.prototype,"hider",void 0),i([_({type:cc.Node,tooltip:"Optional Node that the attached Transform component will target when the DrawingUI Tools are open.",visible:!0}),a("design:type",Object)],t.prototype,"toolsOpenNode",void 0),i([_({tooltip:"Will count as hidden if the attached button does not have any click events or if it non-interactive.",displayName:"Hide On Unused Button",visible:function(){return!!this.getComponent(cc.Button)}}),a("design:type",Object)],t.prototype,"_hideUnusedButton",void 0),i([_({tooltip:"Will count as hidden if the DrawingUI is hidden. Disable for UI elements that need to avoid DrawingTool strokes, but otherwise don't need to be hidden if the DrawingUI is.",visible:!0,displayName:"Hide on Drawing UI Hidden"}),a("design:type",Object)],t.prototype,"_hideOnDrawingUIHidden",void 0),i([_({tooltip:"Will count as hidden if the current drawing tool is stroking",visible:!0,displayName:"Hide On Stroke",formerlySerializedAs:"_hideOnNearbyStroke"}),a("design:type",Object)],t.prototype,"_hideOnStroke",void 0),i([_({tooltip:"If a stroke starts, this is the amount of seconds that pass before the DrawingUI can count as hidden.",min:0,max:2,slide:!0,visible:function(){return this._hideOnStroke}}),a("design:type",Object)],t.prototype,"_strokeHideDelay",void 0),i([_({tooltip:"If a stroke ends, this is the amount of seconds before being considered as shown again.",min:0,max:2,slide:!0,visible:function(){return this._hideOnStroke}}),a("design:type",Object)],t.prototype,"_strokeShowDelay",void 0),i([y,g],t)}(s.default);r.default=m,cc._RF.pop()},{"../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Generic/Hider":"Hider","../Util/Decorators/cache":"cache","../Util/getComponentInScene":"getComponentInScene","./DrawingUI":"DrawingUI","./DrawingUIHandler":"DrawingUIHandler"}],DrawingUIOptionButtons:[function(e,t,r){"use strict";cc._RF.push(t,"bb26b1r6uBProygzEUjXLZw","DrawingUIOptionButtons");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l,u=s(e("./DrawingUIHandler")),p=s(e("../Generic/Temporary")),f=cc._decorator,d=f.ccclass,h=f.property,y=1/Math.pow(2,10);(function(e){e[e.SHOW=1]="SHOW",e[e.HIDE=2]="HIDE",e[e.DESTROY=3]="DESTROY"})(l||(l={}));var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._highlightPadding=5,t._animationDuration=.125,t}return o(t,e),Object.defineProperty(t.prototype,"highlightPadding",{get:function(){return this._highlightPadding},set:function(e){this._highlightPadding=cc.misc.clampf(e,0,25),this._scaleButtonHighlights()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._scaleButtonHighlights()},t.prototype._showButtons=function(e){void 0===e&&(e=!1),this._animateButtons(l.SHOW,e)},t.prototype._hideButtons=function(e){void 0===e&&(e=!1),this._animateButtons(l.HIDE,e)},t.prototype._destroyButtons=function(e){void 0===e&&(e=!1),this._animateButtons(l.DESTROY,e)},t.prototype._scaleButtonHighlights=function(){var e,t,r=this.getComponentsInChildren(cc.Button),n=this._getSelectedButton(r);try{for(var o=c(r),i=o.next();!i.done;i=o.next()){var a=i.value,s=a===n,l=s?(a.node.width+this.highlightPadding)/a.node.width:y,u=s?(a.node.height+this.highlightPadding)/a.node.height:y,p=this._getButtonHighlightNode(a);p&&(p.stopAllActions(),cc.tween(p).to(this._animationDuration,{scaleX:l,scaleY:u}).start())}}catch(f){e={error:f}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype._getButtonHighlightNode=function(e){return e.target},t.prototype._animateButtons=function(e,t){var r,n,o=e===l.SHOW?1:y,i=this.getComponentsInChildren(cc.Button),a=function(r){if(!cc.isValid(r.node)||r.node.getComponent(p.default))return"continue";t?(r.node.scale=o,r.node.active=e===l.SHOW,e===l.DESTROY&&(r.node.removeFromParent(),r.node.destroy())):(r.node.active=!0,r.node.stopAllActions(),e===l.DESTROY&&(r.addComponent(p.default).lifetime=s._animationDuration),cc.tween(r.node).to(s._animationDuration,{scale:o}).call(function(){e!==l.DESTROY&&(r.node.active=e===l.SHOW)}).start())},s=this;try{for(var u=c(i),f=u.next();!f.done;f=u.next())a(f.value)}catch(d){r={error:d}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}},t.MINIMIZED_SCALE=y,t.MAXIMIZED_SCALE=1,i([h(),a("design:type",Object)],t.prototype,"_highlightPadding",void 0),i([h({step:1,min:0,max:25,visible:!0}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"highlightPadding",null),i([h({min:0,max:2,visible:!0}),a("design:type",Object)],t.prototype,"_animationDuration",void 0),i([d],t)}(u.default);r.default=g,cc._RF.pop()},{"../Generic/Temporary":"Temporary","./DrawingUIHandler":"DrawingUIHandler"}],DrawingUISizeButtons:[function(e,t,r){"use strict";cc._RF.push(t,"3c792cE6QVBra5R6YLUQPyU","DrawingUISizeButtons");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./DrawingUIOptionButtons")),f=s(e("./DrawingUIToolButton")),d=u(e("../Util/EventHandlerUtils")),h=cc._decorator,y=h.ccclass,g=h.executeInEditMode,_=cc.misc.clamp01,m=Math.abs;function b(e){return"number"!=typeof e&&(e=parseFloat(e||"0")||0),_(e)}var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"sizeFactor",{get:function(){return this.drawingUI.sizeFactor},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){e.prototype.onLoad.call(this)},t.prototype.onFocusInEditor=function(){this._ensureButtonEventHandlers()},t.prototype.onSelectSizeFactor=function(){this._scaleButtonHighlights()},t.prototype.onSelectTool=function(e){var t=e.getComponent(f.default);t&&t.sizeStrategy!==f.SizeStrategy.Inherit?this._hideButtons():this._showButtons()},t.prototype._getSelectedButton=function(e){var t=this,r=this.sizeFactor;return e.length<=1?e[0]||null:e.reduce(function(e,n){var o=t._getButtonSizeFactor(e),i=t._getButtonSizeFactor(n);return m(o-r)<m(i-r)?e:n})},t.prototype._getButtonSizeFactor=function(e){var t=e.clickEvents.find(function(e){return"selectSizeFactor"===e.handler});return t?b(t.customEventData):0},t.prototype._ensureButtonEventHandlers=function(){var e,t,r=this.drawingUI;try{for(var n=l(this.getComponentsInChildren(cc.Button)),o=n.next();!o.done;o=n.next()){var i=o.value,a={target:r.node,component:r,handler:"selectSizeFactor",customEventData:this._buttonNameToSizeFactor(i).toString()};d.default.includes(a,i.clickEvents)||(i.clickEvents=[d.default.create(a)])}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype._buttonNameToSizeFactor=function(e){return b(e.node.name.split("").filter(function(e){return/\d|\./.test(e)}).join(""))},c([y,g],t)}(p.default);r.default=v,cc._RF.pop()},{"../Util/EventHandlerUtils":"EventHandlerUtils","./DrawingUIOptionButtons":"DrawingUIOptionButtons","./DrawingUIToolButton":"DrawingUIToolButton"}],DrawingUIToolAudio:[function(e,t,r){"use strict";cc._RF.push(t,"85c49AT92VK7Z/ZW5IirQkF","DrawingUIToolAudio");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../DrawingUI/DrawingUIHandler")),l=c(e("../Util/Decorators/cache")),u=c(e("../Generic/AudioPlayer")),p=c(e("../DrawingTools/DrawingTool")),f=cc._decorator,d=f.menu,h=f.ccclass,y=f.property,g=f.disallowMultiple,_=cc.js.getClassName,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clipName="",t.clipVolume=1,t.continuous=!1,t._persistThreshold=.045,t._playingClipId=NaN,t._playingTimeStamp=NaN,t}var r;return o(t,e),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this.audio&&this.audio.clipIsPlaying(this._playingClipId)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPaused",{get:function(){return!!this.audio&&this.audio.clipIsPaused(this._playingClipId)},enumerable:!1,configurable:!0}),t.prototype.onSelectTool=function(e){this.enabled=e===this.drawingTool},t.prototype.onDisable=function(){this._stopClip()},t.prototype.start=function(){this.enabled=!(!this.drawingUI||!this.drawingUI.selectedTool)},t.prototype.update=function(){this.continuous?this._handleContinuous():this._handleIntermittent()},t.prototype._startClip=function(){var e=this.node.getSiblingIndex();if(this.continuous&&this.isPlaying)throw new Error("When continuous is enabled, audio clip "+this.clipName+"should not be started if it is already playing.");this.audio&&(this._playingTimeStamp=Date.now(),this._playingClipId=this.audio.playClip(this.clipName,e,this.clipVolume,this.continuous))},t.prototype._stopClip=function(){this.isPlaying&&this.audio&&(this.audio.stopClip(this._playingClipId),this._playingClipId=NaN)},t.prototype._setClipPaused=function(e){this.isPaused!==e&&this.audio&&(e?this.audio.pauseClip(this._playingClipId):this.audio.resumeClip(this._playingClipId))},t.prototype._handleContinuous=function(){var e=this.isPlaying;if(e||this.drawingTool.isDrawing){e||this._startClip();var t=!this._drawingToolIsEmittingSplats();this._setClipPaused(t)}},t.prototype._handleIntermittent=function(){var e=this.drawingTool.lastCreatedTimeStamp;if(!Number.isNaN(e)){var t=1e3*this._persistThreshold;(Number.isNaN(this._playingTimeStamp)||e-this._playingTimeStamp>t)&&this._startClip()}},t.prototype._drawingToolIsEmittingSplats=function(){return!!this.drawingTool.isDrawing&&Date.now()-this.drawingTool.lastCreatedTimeStamp<1e3*this._persistThreshold},i([y({tooltip:"Of the clips in the associated "+_(u.default)+" component, which can either be on this node or in one of it's parents, the clip with this name will be used."}),a("design:type",Object)],t.prototype,"clipName",void 0),i([y({tooltip:"Audio to play when using the tool is being used.",slide:!0,min:0,max:1}),a("design:type",Object)],t.prototype,"clipVolume",void 0),i([y({tooltip:"Sound will keep looping as long as the tool is emitting splats."}),a("design:type",Object)],t.prototype,"continuous",void 0),i([y({visible:!0,tooltip:"If continuous, the amount of time that a tool can go without making a splat before the sound is terminated.\nIf not continuous, the minimum amount of time that must pass before subsequent plays.",formerlySerializedAs:"_repeatDelay"}),a("design:type",Object)],t.prototype,"_persistThreshold",void 0),i([l.default({type:u.default,scope:["node","parent"],required:!1}),a("design:type",Object)],t.prototype,"audio",void 0),i([l.default(p.default),a("design:type","function"==typeof(r=void 0!==p.default&&p.default)?r:Object)],t.prototype,"drawingTool",void 0),i([h,g,d("Drawing Component/Drawing Tool Audio")],t)}(s.default);r.default=m,cc._RF.pop()},{"../DrawingTools/DrawingTool":"DrawingTool","../DrawingUI/DrawingUIHandler":"DrawingUIHandler","../Generic/AudioPlayer":"AudioPlayer","../Util/Decorators/cache":"cache"}],DrawingUIToolButton:[function(e,t,r){"use strict";cc._RF.push(t,"1dab7yCC0RDerjAMZU7c4aU","DrawingUIToolButton");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.SizeStrategy=r.ColorStrategy=void 0;var h,y,g=s(e("../DrawingTools/DrawingTool")),_=d(e("../DrawingTools/EmitterDrawingTool")),m=d(e("./DrawingUIHandler")),b=d(e("../Generic/Transform")),v=(d(e("../Development/Excluder")),d(e("../Util/EventHandlerUtils"))),w=d(e("../Util/isInPrefabMode")),O=d(e("../Util/Decorators/cache")),S=d(e("./DrawingUIToolCustomizationButton")),C=d(e("../Generic/FitChildrenToBounds")),P=cc._decorator,T=P.ccclass,j=P.menu,R=P.executeInEditMode,x=P.property;function A(){return this.tool instanceof g.default&&this.colorStrategy!==h.Inherit}(function(e){e[e.Ignore=0]="Ignore",e[e.Inherit=1]="Inherit",e[e.Randomize=2]="Randomize"})(h||(h={})),r.ColorStrategy=h,function(e){e[e.Ignore=0]="Ignore",e[e.Inherit=1]="Inherit"}(y||(y={})),r.SizeStrategy=y;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._colorStrategy=h.Ignore,t._sizeStrategy=y.Ignore,t._customizationButtonPrefabs=[],t._customizationButtonIconParent=null,t._tintNode=null,t._managedButton=null,t._transformer=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"colorStrategy",{get:function(){return this.tool instanceof g.default?this._colorStrategy:h.Ignore},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeStrategy",{get:function(){return this.tool instanceof _.default?this._sizeStrategy:y.Ignore},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customizationButtonPrefabs",{get:function(){return this.tool instanceof g.default&&this.colorStrategy!==h.Inherit?this._customizationButtonPrefabs:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customizationButtonIconParent",{get:function(){return A.call(this)?this._customizationButtonIconParent:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintNode",{get:function(){return this._colorStrategy===h.Inherit?this._tintNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clickEvents",{get:function(){return this.managedButton.clickEvents},set:function(e){this.managedButton.clickEvents=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"managedButton",{get:function(){return this._ensureManagedButton()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){var e;try{e=this.drawingUI.selectedTool===this.tool}catch(t){e=!1}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hovered",{get:function(){return this.managedButton._hovered},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformer",{get:function(){return this._ensureTransfomer()},enumerable:!1,configurable:!0}),t.prototype.setCustomButtonIcon=function(e){var t=this.customizationButtonIconParent;if(!A.call(this)||!t)throw new Error(this.node.name+" cannot have custom button icons.");if(t.removeAllChildren(),e){e.setParent(t);var r=e.getComponent(cc.Widget);r&&t.getComponent(C.default)&&r.destroy()}},t.prototype.onLoad=function(){this._ensureManagedButton(),this._ensureCustomIcon();try{this._setTintColor()}catch(e){throw e}this._attachChildrenToManagedButton(),this._ensureTransfomer(),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,this._managedButtonUpdate,this)},t.prototype.onDestroy=function(){cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,this._managedButtonUpdate,this)},t.prototype.onFocusInEditor=function(){this._ensureManagedButton()},t.prototype.onSelectColor=function(){this._setToolColors()},t.prototype.onSelectSizeFactor=function(){this._setToolSizeFactor()},t.prototype.onSetColors=function(){this._setToolColors()},t.prototype.onSelectTool=function(e){e===this.tool&&(this._setToolColors(),this._setToolSizeFactor())},t.prototype._setToolColors=function(){if(this.tool instanceof g.default)switch(this.colorStrategy){case h.Inherit:this.tool.colors=[this.drawingUI.color];break;case h.Randomize:this.tool.colors=this.drawingUI.colors;break;case h.Ignore:}this._setTintColor()},t.prototype._setToolSizeFactor=function(){this.tool instanceof _.default&&this.sizeStrategy===y.Inherit&&(this.tool.sizeFactor=this.drawingUI.sizeFactor)},t.prototype._ensureCustomIcon=function(){if(A.call(this)&&this.customizationButtonIconParent&&0!==this.customizationButtonPrefabs.length){var e=u(this.customizationButtonPrefabs,1)[0].data.getComponent(S.default),t=e&&e.iconNode;t&&this.setCustomButtonIcon(cc.instantiate(t))}},t.prototype._ensureManagedButton=function(){if(this._managedButtonIsValid())return this._managedButton;this._clearManagedButton();var e=new cc.Node(this.node.name+" Managed Button").addComponent(cc.Button);e.node.setContentSize(this.node.getContentSize()),e.node.setParent(this.node),w.default()||(e.clickEvents=[v.default.create({target:this.drawingUI.node,component:this.drawingUI,handler:"selectTool",customEventData:this.node.name})]);var t=e.node.addComponent(cc.Widget);return t.isAlignTop=t.isAlignRight=t.isAlignBottom=t.isAlignLeft=!0,t.top=t.right=t.bottom=t.left=0,t.alignMode=cc.Widget.AlignMode.ONCE,t.updateAlignment(),this._managedButton=e,e},t.prototype._managedButtonIsValid=function(){var e=this._managedButton;return!(!cc.isValid(e)||e.node instanceof cc.PrivateNode||!w.default()&&!v.default.includes({target:this.drawingUI.node,component:this.drawingUI,handler:"selectTool",customEventData:this.node.name},e.clickEvents))},t.prototype._clearManagedButton=function(){var e,t,r,n,o=this.node.getComponentsInChildren(cc.Button);try{for(var i=p(o),a=i.next();!a.done;a=i.next()){var c=a.value;try{for(var s=(r=void 0,p(f(c.node.children))),l=s.next();!l.done;l=s.next())l.value.setParent(this.node)}catch(u){r={error:u}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}c.node.removeFromParent(),c.node.destroy()}}catch(d){e={error:d}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype._managedButtonUpdate=function(){if(cc.isValid(this)&&cc.isValid(this.drawingUI)){var e=this.hovered,t=this.selected;this.managedButton.enabled=!this.drawingUI.toolsHidden,this.transformer.opacity=e||t?255:180,this.transformer.scale=t?1.25:1,this.transformer.position=t&&this.drawingUI.toolsHidden?this._getHiddenPosition():cc.Vec3.ZERO}},t.prototype._attachChildrenToManagedButton=function(){var e,t;try{for(var r=p(f(this.node.children)),n=r.next();!n.done;n=r.next()){var o=n.value;o!==this.managedButton.node&&o.setParent(this.managedButton.node)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._ensureTransfomer=function(){var e,t;if(cc.isValid(this._transformer))return this._transformer;try{for(var r=p(this.managedButton.getComponents(b.default)),n=r.next();!n.done;n=r.next())n.value.destroy()}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}var o=this._transformer=this.managedButton.addComponent(b.default);return o.transformStrategy=b.default.Strategy.Values,o.applyOpacity=!0,o.applyScale=!0,o.applyPosition=!0,o.opacity=this.managedButton.node.opacity,o.scale=this.managedButton.node.scale,o.position=this.managedButton.node.position.clone(),o.speed=50,o},t.prototype._getHiddenPosition=function(){var e=this._getToolsAnchorNode().convertToWorldSpaceAR(cc.Vec2.ZERO),t=this.node.convertToNodeSpaceAR(e);return cc.v3(t)},t.prototype._getToolsAnchorNode=function(){for(var e=this.node;e.parent!==this.drawingUI.node;)e=e.parent;return e},t.prototype._setTintColor=function(e){void 0===e&&(e=this.drawingUI.color),this.colorStrategy===h.Inherit&&this.tintNode&&(this.tintNode.color=e)},c([x({type:cc.Enum(h),tooltip:"Determines how the Tool's color will be affected by the DrawingUI when the tool is selected.\nIgnore: The DrawingUI's color buttons will be disabled, and the tool will use it's pre configured colors.\nInherit: The DrawingUI's color buttons will be enabled, and the tool's color property will be set to the selected color.",visible:function(){return this.tool instanceof g.default}}),l("design:type",Object)],t.prototype,"_colorStrategy",void 0),c([x({type:cc.Enum(y),visible:function(){return this.tool instanceof _.default}}),l("design:type",Object)],t.prototype,"_sizeStrategy",void 0),c([x({type:cc.Prefab,visible:A,formerlySerializedAs:"_splatButtonPrefabs"}),l("design:type",Array)],t.prototype,"_customizationButtonPrefabs",void 0),c([x({visible:A,tooltip:"Node that custom button icons can be parented to.",type:cc.Node}),l("design:type",Object)],t.prototype,"_customizationButtonIconParent",void 0),c([O.default(g.TouchTool),l("design:type","function"==typeof(r=void 0!==g.TouchTool&&g.TouchTool)?r:Object)],t.prototype,"tool",void 0),c([x({type:cc.Node,visible:function(){return this._colorStrategy===h.Inherit}}),l("design:type",Object)],t.prototype,"_tintNode",void 0),c([x({type:cc.Component.EventHandler}),l("design:type",Array),l("design:paramtypes",[Array])],t.prototype,"clickEvents",null),c([x({type:cc.Button}),l("design:type",Object)],t.prototype,"_managedButton",void 0),c([T,R,j("Drawing Component/Drawing UI Tool Button")],t)}(m.default);r.default=D,cc._RF.pop()},{"../Development/Excluder":"Excluder","../DrawingTools/DrawingTool":"DrawingTool","../DrawingTools/EmitterDrawingTool":"EmitterDrawingTool","../Generic/FitChildrenToBounds":"FitChildrenToBounds","../Generic/Transform":"Transform","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","../Util/isInPrefabMode":"isInPrefabMode","./DrawingUIHandler":"DrawingUIHandler","./DrawingUIToolCustomizationButton":"DrawingUIToolCustomizationButton"}],DrawingUIToolCustomizationButtons:[function(e,t,r){"use strict";cc._RF.push(t,"9759b+Ssw9NNKrXIEaWXA4j","DrawingUIToolCustomizationButtons");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../DrawingTools/DrawingTool")),l=c(e("./DrawingUIToolButton")),u=c(e("./DrawingUIOptionButtons")),p=c(e("./DrawingUIToolCustomizationButton")),f=c(e("../Util/EventHandlerUtils")),d=cc._decorator.ccclass,h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onSelectTool=function(e){if(!(e instanceof s.default))return this._destroyButtons();this._createCustomizationButtons(e),this._ensureDefaultSelection()},t.prototype._getSelectedButton=function(e){return e.find(function(e){var t=e.getComponent(p.default);if(!t)return!1;var r=t.tool,n=t.splatPrefabs,o=t.colors;if(!r)return!1;var i=n.length>0,a=r.splatPrefabs.length===n.length&&n.every(function(e){return r.splatPrefabs.includes(e)}),c=o.length>0,s=r.colors.length===o.length&&o.every(function(e){return r.colors.some(function(t){return t.equals(e)})});return(!i||a)&&(!c||s)})||null},t.prototype._createCustomizationButtons=function(e){var t,r,n=e.getComponent(l.default),o=this.getComponent(cc.Layout),i=n?n.customizationButtonPrefabs:[];this._destroyButtons(!0);var c=0;try{for(var s=a(i),u=s.next();!u.done;u=s.next()){var d=u.value,h=cc.instantiate(d);h.setPosition(cc.Vec3.ZERO),h.setParent(this.node);var y=h.getComponent(p.default);y&&(y.tool=e,c+=y.node.width+(o?o.spacingX:0));var g=y&&y.getComponent(cc.Button);g&&f.default.ensure({target:this.node,component:this,handler:"_scaleButtonHighlights"},g.clickEvents)}}catch(m){t={error:m}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}this._hideButtons(!0),this._showButtons(),this.node.width=c;var _=this.getComponent(cc.Widget);_&&_.updateAlignment(),o&&o.updateLayout()},t.prototype._ensureDefaultSelection=function(){var e=this.getComponentsInChildren(cc.Button),t=this._getSelectedButton(e)||e[0];t&&f.default.emit(t.clickEvents)},i([d],t)}(u.default);r.default=h,cc._RF.pop()},{"../DrawingTools/DrawingTool":"DrawingTool","../Util/EventHandlerUtils":"EventHandlerUtils","./DrawingUIOptionButtons":"DrawingUIOptionButtons","./DrawingUIToolButton":"DrawingUIToolButton","./DrawingUIToolCustomizationButton":"DrawingUIToolCustomizationButton"}],DrawingUIToolCustomizationButton:[function(e,t,r){"use strict";cc._RF.push(t,"e6570a6QidLKaKJNSxJkdHu","DrawingUIToolCustomizationButton");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./DrawingUIHandler")),p=l(e("../DrawingTools/DrawingTool")),f=l(e("../Util/EventHandlerUtils")),d=l(e("./DrawingUIToolButton")),h=cc._decorator,y=h.ccclass,g=h.property,_=cc.js.getClassName,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._splatPrefabs=[],t._colors=[],t.iconNode=null,t._highlightNode=null,t._managedButton=null,t.tool=null,t}return o(t,e),Object.defineProperty(t.prototype,"splatPrefabs",{get:function(){return this._splatPrefabs.filter(function(e){return e})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colors",{get:function(){return s(this._colors)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightNode",{get:function(){return this._highlightNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"managedButton",{get:function(){return this._ensureManagedButton()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._ensureManagedButton()},t.prototype.applyToolCustomizations=function(){if(!this.tool)throw new Error("No "+_(p.default)+" applied to "+this.node.name);this.splatPrefabs.length>0&&(this.tool.splatPrefabs=this.splatPrefabs),this.colors.length>0&&(this.tool.colors=this.colors);var e=this.tool.getComponent(d.default);if(!e)throw new Error("No "+_(d.default)+" applied to "+this.tool.node.name);e.setCustomButtonIcon(this.iconNode&&cc.instantiate(this.iconNode))},t.prototype._ensureManagedButton=function(){if(this._managedButtonIsValid())return this._managedButton;cc.isValid(this._managedButton)&&this._managedButton.destroy();var e=this.addComponent(cc.Button);if(!this.highlightNode)throw new Error("Highlight node required.");return e.target=this.highlightNode,f.default.create({target:this.node,component:this,handler:"applyToolCustomizations"},e.clickEvents),this._managedButton=e,e},t.prototype._managedButtonIsValid=function(){return!!cc.isValid(this._managedButton)&&!!f.default.includes({target:this.node,component:this,handler:"applyToolCustomizations"},this._managedButton.clickEvents)&&this._managedButton.target===this._highlightNode},i([g({visible:!0,tooltip:"Should be selected from prefabs in Drawing/Prefabs/Splats",type:cc.Prefab}),a("design:type",Array)],t.prototype,"_splatPrefabs",void 0),i([g({visible:!0,type:cc.Color,tooltip:"The colors defined here will be applied to the tool when the button is clicked. Note that the tool should NOT be configured to inherit colors from the DrawingUI"}),a("design:type",Array)],t.prototype,"_colors",void 0),i([g({visible:!0,type:cc.Node,tooltip:"The node specified here will be used as an Icon on the target tool when the button is clicked, provided the target tool has a slot for it."}),a("design:type",Object)],t.prototype,"iconNode",void 0),i([g({visible:!0,type:cc.Node,tooltip:"The node that this button will use as a highlight, scaling up when the button is selected."}),a("design:type",Object)],t.prototype,"_highlightNode",void 0),i([g(),a("design:type",Object)],t.prototype,"_managedButton",void 0),i([y],t)}(u.default);r.default=m,cc._RF.pop()},{"../DrawingTools/DrawingTool":"DrawingTool","../Util/EventHandlerUtils":"EventHandlerUtils","./DrawingUIHandler":"DrawingUIHandler","./DrawingUIToolButton":"DrawingUIToolButton"}],DrawingUIToolsConfig:[function(e,t,r){"use strict";cc._RF.push(t,"d3123jEgrtMNoy9G2i1g16b","DrawingUIToolsConfig");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("./DrawingUIHandler")),u=(s(e("../Util/untilConditionOrTimeout")),s(e("../Development/Excluder")),s(e("./DrawingUITraySizer"))),p=cc._decorator,f=p.ccclass,d=p.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._toolPrefabs=[],t._selectedToolPrefab=null,t._containerNode=null,t}return o(t,e),Object.defineProperty(t.prototype,"toolPrefabs",{get:function(){return this._toolPrefabs||[]},set:function(e){this._toolPrefabs=this._validateToolPrefabs(e),this._createToolInstances()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"containerNode",{get:function(){if(!this._containerNode)throw new Error("Container Node not set in Inspector");return this._containerNode},set:function(e){this._containerNode=e,this._containerNode&&this._createToolInstances()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._createToolInstances()},t.prototype._validateToolPrefabs=function(e){var t,r,n=[];try{for(var o=c(e),i=o.next();!i.done;i=o.next()){var a=i.value;a&&!n.includes(a)&&n.push(a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},t.prototype._createToolInstances=function(){var e,t;this.containerNode.removeAllChildren();var r=this._toolPrefabs.filter(function(e){return e}),n=r.indexOf(this._selectedToolPrefab);try{for(var o=c(r),i=o.next();!i.done;i=o.next()){var a=i.value;if(a){var s=cc.instantiate(a);s.name=a.name,s.setPosition(cc.Vec2.ZERO),s.setParent(this.containerNode)}}}catch(p){e={error:p}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n>-1&&this.drawingUI.selectTool(n);var l=this.containerNode.parent.getComponent(u.default);l&&l.scheduleOnce(l.resize,.25)},i([d({type:cc.Prefab}),a("design:type",Array)],t.prototype,"_toolPrefabs",void 0),i([d({visible:!0,type:cc.Prefab}),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"toolPrefabs",null),i([d({type:cc.Prefab,visible:!0}),a("design:type",Object)],t.prototype,"_selectedToolPrefab",void 0),i([d({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_containerNode",void 0),i([f],t)}(l.default);r.default=h,cc._RF.pop()},{"../Development/Excluder":"Excluder","../Util/untilConditionOrTimeout":"untilConditionOrTimeout","./DrawingUIHandler":"DrawingUIHandler","./DrawingUITraySizer":"DrawingUITraySizer"}],DrawingUITraySizer:[function(e,t,r){"use strict";cc._RF.push(t,"1523fjnkVlJAKGQKLMfeWCJ","DrawingUITraySizer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("./DrawingUIHandler")),u=cc._decorator,p=u.ccclass,f=u.property,d=u.executeInEditMode,h=cc.js.getClassName,y=Math.max,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._toolsContainerNode=null,t._splatButtonsNode=null,t._colorButtonsNode=null,t._sizeButtonsNode=null,t}return o(t,e),t.prototype.onLoad=function(){this.resize()},t.prototype.onDestroy=function(){},t.prototype.onSetColors=function(){this.resize()},t.prototype.resize=function(){var e,t;if(!(cc.isValid(this._toolsContainerNode)&&cc.isValid(this._splatButtonsNode)&&cc.isValid(this._colorButtonsNode)&&cc.isValid(this._sizeButtonsNode)))throw new Error(h(this)+" is not properly configured in the editor.");var r=y(this._colorButtonsNode.width,this._splatButtonsNode.width),n=this._sizeButtonsNode.width,o=this._toolsContainerNode.width,i=y(r+n,o)+30;this.node.width=i;var a=this.node.getComponentsInChildren(cc.Widget);try{for(var s=c(a),l=s.next();!l.done;l=s.next()){var u=l.value;u.enabledInHierarchy&&u.updateAlignment()}}catch(p){e={error:p}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},i([f({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_toolsContainerNode",void 0),i([f({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_splatButtonsNode",void 0),i([f({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_colorButtonsNode",void 0),i([f({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_sizeButtonsNode",void 0),i([p,d],t)}(l.default);r.default=g,cc._RF.pop()},{"./DrawingUIHandler":"DrawingUIHandler"}],DrawingUI:[function(e,t,r){"use strict";cc._RF.push(t,"0397fQqIGVHBaHurRKcXoH/","DrawingUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},f=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},d=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e},h=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},y=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_COLORS=r.getClosestColor=void 0;var g=y(e("../Drawing/Drawing")),_=s(e("../DrawingTools/DrawingTool")),m=y(e("./DrawingUIHandler")),b=y(e("../Util/getComponentsInScene")),v=y(e("../Util/RandomUtil")),w=y(e("../Generic/CameraRig")),O=y(e("../Generic/AudioPlayer")),S=cc._decorator,C=S.ccclass,P=S.property,T=S.disallowMultiple,j=cc.js.getClassName,R=cc.misc.clamp01,x=Math.abs,A=cc.Node.EventType,D=A.TOUCH_CANCEL,E=A.TOUCH_END,I=A.TOUCH_MOVE,N=A.TOUCH_START,U=[new cc.Color(126,80,190),new cc.Color(208,1,15),new cc.Color(255,100,9),new cc.Color(249,222,58),new cc.Color(150,104,77),new cc.Color(149,146,141),new cc.Color(40,125,13),new cc.Color(80,193,77),new cc.Color(0,0,0),new cc.Color(0,113,197),new cc.Color(93,206,252),new cc.Color(225,92,174)];function M(e,t){return x(e.getR()-t.getR())+x(e.getG()-t.getG())+x(e.getB()-t.getB())}function k(e,t){if(0===t.length)throw new Error("Provided colors array cannot be empty.");var r=d(t);return r.sort(function(t,r){return M(t,e)-M(r,e)}),r[0].clone()}r.DEFAULT_COLORS=U,r.getClosestColor=k;var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._clearButton=null,t._confirmButton=null,t._color=cc.Color.WHITE,t._colors=[],t._sizeFactor=0,t._hidden=!1,t._toolsHidden=!1,t.drawing=null,t._lastTouchPosition=cc.Vec2.ZERO,t._lastDrawCoord=null,t._touchSurface=null,t._selectedTool=null,t._touchEventsEnabled=!1,t._playButtonSoundHack=function(e){var r=e.target===t.confirmButton.node?"OptionClick":"Garbage";t._playAudioIfTouchEvent(e,r)},t._drawingUIHandlers=[],t}var r,n,i,a;return o(t,e),r=t,Object.defineProperty(t.prototype,"clearButton",{get:function(){if(this._clearButton||(this._clearButton=this.getComponentsInChildren(cc.Button).find(function(e){return e.node.name.includes("Clear")})||null),!this._clearButton)throw new Error('"Clear Button" is not set in the editor.');return this._clearButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"confirmButton",{get:function(){if(this._confirmButton||(this._confirmButton=this.getComponentsInChildren(cc.Button).find(function(e){return e.node.name.includes("Confirm")})||null),!this._confirmButton)throw new Error('"Confirm Button" is not set in the editor.');return this._confirmButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color.clone()},set:function(e){this.selectColor(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colors",{get:function(){return this._colors},set:function(e){this.setSelectableColors(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeFactor",{get:function(){return this._sizeFactor},set:function(e){this.selectSizeFactor(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this._hidden},set:function(e){this.setHidden(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toolsHidden",{get:function(){return this._toolsHidden},set:function(e){this.setToolsHidden(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchSurface",{get:function(){return this._touchSurface||this.node},set:function(e){if(this.touchSurface!==e){var t=this._touchEventsEnabled;t&&this._setTouchEventsEnabled(!1),this._touchSurface=e,t&&this._setTouchEventsEnabled(!0)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedTool",{get:function(){return cc.isValid(this._selectedTool)||(this._selectedTool=this.selectRandomTool()),this._selectedTool},set:function(e){this.selectTool(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tools",{get:function(){return this.getComponentsInChildren(_.TouchTool)},enumerable:!1,configurable:!0}),t.prototype.selectColor=function(e){var t,r;this._playAudioIfTouchEvent(e,"OptionClick");var n=k(e instanceof cc.Event.EventTouch?e.target.color:e,this._colors);if(!this._color.equals(n)){this._color=n;try{for(var o=h(this._iterateDrawingUIHandlers(!0)),i=o.next();!i.done;i=o.next())i.value.onSelectColor(this._color)}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}return this._color},t.prototype.selectSizeFactor=function(e,t){var r,n;this._playAudioIfTouchEvent(e,"OptionClick");var o=e instanceof cc.Event.EventTouch?parseFloat(t||"0")||0:e,i=R(o);if(i!==this._sizeFactor){this._sizeFactor=i;try{for(var a=h(this._iterateDrawingUIHandlers(!0)),c=a.next();!c.done;c=a.next())c.value.onSelectSizeFactor(i)}catch(s){r={error:s}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}return this._sizeFactor},t.prototype.selectTool=function(e,t){var n,o;this._playAudioIfTouchEvent(e,"ToolSelect");var i=e instanceof cc.Event.EventTouch?t||null:e;if("number"==typeof i){var a=i;if(!(i=this.tools[a]))throw new Error("No tool in slot "+a+" in "+j(r))}if("string"==typeof i){var c=i;if(!(i=this.tools.find(function(e){return e.node.name===c})||null))throw new Error("No tool named "+c+" in "+j(r))}if(!i)throw new Error(j(r)+" could not resolve "+j(_.TouchTool)+" to select.");if(i!==this._selectedTool){this._selectedTool=i;try{for(var s=h(this._iterateDrawingUIHandlers(!0)),l=s.next();!l.done;l=s.next())l.value.onSelectTool(i)}catch(u){n={error:u}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}}return this._selectedTool},t.prototype.selectRandomTool=function(){var e=v.default.item(this.tools);return this.selectTool(e)},t.prototype.setSelectableColors=function(e){var t,r;this._colors=e;try{for(var n=h(this._iterateDrawingUIHandlers(!0)),o=n.next();!o.done;o=n.next())o.value.onSetColors(this._colors)}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}this.selectColor(this.color)},t.prototype.clearDrawing=function(){cc.isValid(this.drawing)&&this.drawing.clear()},t.prototype.setHidden=function(e,t){return u(this,void 0,Promise,function(){var r,n,o,i,a;return p(this,function(c){switch(c.label){case 0:(r="boolean"==typeof e?e:"false"!==t)&&!this.toolsHidden&&this.setToolsHidden(!0),this._hidden=r;try{for(n=h(this._iterateDrawingUIHandlers(!0)),o=n.next();!o.done;o=n.next())o.value[r?"onHidden":"onShown"]()}catch(s){i={error:s}}finally{try{o&&!o.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return[4,Promise.resolve()];case 1:return c.sent(),[2]}})})},t.prototype.setToolsHidden=function(e,t){return u(this,void 0,Promise,function(){var r,n,o,i,a;return p(this,function(c){switch(c.label){case 0:if(this._playAudioIfTouchEvent(e,"OptionClick"),r="boolean"==typeof e?e:"false"!==t,this.hidden&&!r)throw new Error("Can't show tools if "+j(this)+" is hidden.");this._toolsHidden=r;try{for(n=h(this._iterateDrawingUIHandlers(!0)),o=n.next();!o.done;o=n.next())o.value[r?"onToolsHidden":"onToolsShown"]()}catch(s){i={error:s}}finally{try{o&&!o.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return[4,Promise.resolve()];case 1:return c.sent(),[2]}})})},t.prototype.toggleToolsHidden=function(e){return this._playAudioIfTouchEvent(e,"ToolSelect"),this.setToolsHidden(!this.toolsHidden)},t.prototype.onRestore=function(){this.setSelectableColors(U),this.setToolsHidden(!0),this.setHidden(!1),this.selectSizeFactor(.5),this.selectColor(U[0])},t.prototype.onEnable=function(){this._setTouchEventsEnabled(!0),this._setButtonSoundEnabled(!0)},t.prototype.onDisable=function(){this._setTouchEventsEnabled(!1),this._setButtonSoundEnabled(!1)},t.prototype.update=function(){if(gm.loaded&&this.drawing&&this.selectedTool&&this._lastDrawCoord){var e=this._getDrawCoord(this._lastTouchPosition);e.world.equals(this._lastDrawCoord.world)||(this._lastDrawCoord=e,this.onTouchMove(e)),this._isValidTouchArea(e.world)||this.onTouchEnd(e)}},t.prototype.onTouchStart=function(e){var t;!this.hidden&&this.drawing&&gm.loaded&&(this.toolsHidden||(this.toolsHidden=!0),e instanceof cc.Event.EventTouch?(this._lastTouchPosition=e.getLocation().clone(),t=this._lastDrawCoord=this._getDrawCoord(e)):t=e,this.selectedTool instanceof _.default&&(this.selectedTool.drawing=this.drawing),this.selectedTool.touchStart(t),this._callStrokeDrawHandlers("onTouchStart",t.world,!0))},t.prototype.onTouchMove=function(e){if(!this.hidden&&this.drawing&&gm.loaded){var t;if(e instanceof cc.Event.EventTouch?(t=this._getDrawCoord(e),this._lastTouchPosition=e.getLocation().clone(),t=this._lastDrawCoord=this._getDrawCoord(e)):t=e,!this._isValidTouchArea(t.world))return this.onTouchEnd(t);var r=this.node.parent.getChildByName("World Point");r&&r.setPosition(r.parent.convertToNodeSpaceAR(t.world)),this.selectedTool.touchMove(t),this._callStrokeDrawHandlers("onTouchMove",t.world,!1)}},t.prototype.onTouchEnd=function(e){var t;!this.hidden&&this.drawing&&gm.loaded&&(t=e instanceof cc.Event.EventTouch?this._getDrawCoord(e):e,this.selectedTool.touchEnd(t),this._callStrokeDrawHandlers("onTouchEnd",t.world,!1),this.selectedTool instanceof _.default&&(this.selectedTool.drawing=null),this._lastDrawCoord=null,this._lastTouchPosition=cc.Vec2.ZERO)},t.prototype.onTouchCancel=function(e){this.onTouchEnd(e)},t.prototype._getDrawCoord=function(e){var t=e instanceof cc.Event.EventTouch?e.getLocation():e;if(!this.drawing)throw new Error("drawing is not set");var r=w.default.getCameraRigForNode(this.drawing.node).camera.getScreenToWorldPoint(t),n=w.default.getCameraOffsets(this.node,this.drawing.node);return{world:cc.v2(r),scale:n.scale,angle:n.angle}},t.prototype._setTouchEventsEnabled=function(e){if(e!==this._touchEventsEnabled){this._touchEventsEnabled=e;var t=e?"on":"off";this.touchSurface[t](E,this.onTouchEnd,this),this.touchSurface[t](I,this.onTouchMove,this),this.touchSurface[t](N,this.onTouchStart,this),this.touchSurface[t](D,this.onTouchCancel,this)}},t.prototype._isValidTouchArea=function(e){return this.touchSurface===this.node||this.touchSurface.getBoundingBoxToWorld().contains(e)},t.prototype._setButtonSoundEnabled=function(e){var t=e?"on":"off";this.confirmButton.node[t](cc.Node.EventType.TOUCH_END,this._playButtonSoundHack),this.clearButton.node[t](cc.Node.EventType.TOUCH_END,this._playButtonSoundHack)},t.prototype._iterateDrawingUIHandlers=function(e){return p(this,function(t){switch(t.label){case 0:return(e||0===this._drawingUIHandlers.length||this._drawingUIHandlers.some(function(e){return!cc.isValid(e)}))&&(this._drawingUIHandlers=b.default(m.default)),[5,h(this._drawingUIHandlers)];case 1:return t.sent(),[2]}})},t.prototype._callStrokeDrawHandlers=function(e,t,r){var n,o;if(!this.drawing)throw new Error("Drawing is missing.");try{for(var i=h(this._iterateDrawingUIHandlers(r)),a=i.next();!a.done;a=i.next())a.value[e](t,this.selectedTool,this.drawing)}catch(c){n={error:c}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},t.prototype._playAudioIfTouchEvent=function(e,t){var r=this.getComponentInChildren(O.default);r&&e instanceof cc.Event.EventTouch&&r.playClip(t)},c([P({visible:!0,type:cc.Button}),l("design:type",Object)],t.prototype,"_clearButton",void 0),c([P({visible:!0,type:cc.Button}),l("design:type",Object)],t.prototype,"_confirmButton",void 0),c([P(),l("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object)],t.prototype,"_color",void 0),c([P({tooltip:"Currently selected color."}),l("design:type","function"==typeof(i="undefined"!=typeof cc&&cc.Color)?i:Object),l("design:paramtypes",["function"==typeof(a="undefined"!=typeof cc&&cc.Color)?a:Object])],t.prototype,"color",null),c([P({type:cc.Color}),l("design:type",Array)],t.prototype,"_colors",void 0),c([P({tooltip:"Buttons will be created that match these colors",type:cc.Color}),l("design:type",Array),l("design:paramtypes",[Array])],t.prototype,"colors",null),c([P(),l("design:type",Object)],t.prototype,"_sizeFactor",void 0),c([P({slide:!0,min:0,max:1}),l("design:type",Number),l("design:paramtypes",[Number])],t.prototype,"sizeFactor",null),c([P(),l("design:type",Object)],t.prototype,"_hidden",void 0),c([P(),l("design:type",Boolean),l("design:paramtypes",[Boolean])],t.prototype,"hidden",null),c([P(),l("design:type",Object)],t.prototype,"_toolsHidden",void 0),c([P(),l("design:type",Boolean),l("design:paramtypes",[Boolean])],t.prototype,"toolsHidden",null),c([P(g.default),l("design:type",Object)],t.prototype,"drawing",void 0),c([P({type:cc.Node,visible:!0}),l("design:type",Object)],t.prototype,"_touchSurface",void 0),r=c([C,T],t)}(cc.Component);r.default=B,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingTools/DrawingTool":"DrawingTool","../Generic/AudioPlayer":"AudioPlayer","../Generic/CameraRig":"CameraRig","../Util/RandomUtil":"RandomUtil","../Util/getComponentsInScene":"getComponentsInScene","./DrawingUIHandler":"DrawingUIHandler"}],Drawing:[function(e,t,r){"use strict";cc._RF.push(t,"5068155GrtEnJEr3S0oqxfQ","Drawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&a(t,e,r);return c(t,e),t},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},d=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.DrawingComponent=void 0;var y=h(e("./DrawingComponent"));r.DrawingComponent=y.default;var g=h(e("./DrawingStorage")),_=h(e("./DrawingTextureCell")),m=e("./DrawingSerializer"),b=l(e("./Particle")),v=e("../Generic/Grid"),w=h(e("../Util/NodeUtils")),O=h(e("../Util/Decorators/cache")),S=h(e("../Util/sortBy")),C=h(e("./DrawingStorageMeta")),P=h(e("../Util/chunker")),T=cc._decorator,j=T.ccclass,R=T.property,x=T.menu,A=T.disallowMultiple,D=Math.pow,E=Math.round,I=Math.log,N=cc.misc.clampf,U=64,M=cc.Color.WHITE,k=cc.v3(0,0,1);function B(e,t){return D(t,E(I(e)/I(t)))}var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._textureResolution=U,t._renderPassOptimization=!0,t._textureScale=1,t._baseColor=M,t._splatData=[],t._texturesNode=null,t._splatsNode=null,t._particlesUnderNode=null,t._particlesOverNode=null,t._requiresDominantColorUpdate=!0,t._dominantColor=cc.Color.WHITE,t._size=cc.size(0,0),t._center=cc.Vec2.ZERO,t._centerOfOpacity=cc.Vec2.ZERO,t._textureCells=[],t._textureCellsToRender=[],t._boundsCheckChunker=P.default(),t}var r,n,a,c,l;return o(t,e),r=t,Object.defineProperty(t.prototype,"textureResolution",{get:function(){return this._textureResolution},set:function(e){if(this.hasTextureCells)throw new Error("textureResolution of "+this.name+" can not be set while DrawingTextureCells exist on the drawing");var t=N(B(e,2),32,512);e!==t&&(cc.warn("textureResolution must be a power of 2 between 32 and 512: "+e+" changed to "+t),e=t),this._textureResolution=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){if(this.hasTextureCells)throw new Error("textureScale of "+this.name+" can not be set while DrawingTextureCells exist on the drawing");this._textureScale=N(e,.1,10)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_adjustedTextureResolution",{get:function(){return this.textureScale*this.textureResolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseColor",{get:function(){return this._baseColor.clone()},set:function(e){if(this.hasTextureCells)throw new Error("baseColor of "+this.name+" can not be set while DrawingTextureCells exist on the drawing");this._baseColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"splatData",{get:function(){return this._splatData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this.getComponentsInChildren(b.default)},enumerable:!1,configurable:!0}),t.prototype._ensureChildNode=function(e){var t="",r=this[e];return cc.isValid(r)&&r.parent===this.node||(t=e.replace(/_|Node/g,"").toUpperCase(),r=this[e]=this.node.getChildByName(t)),cc.isValid(r)||((r=this[e]=new cc.Node(t)).setParent(this.node),this._arrangeChildNodes()),this[e]},t.prototype._arrangeChildNodes=function(){for(var e=[this._particlesUnderNode,this._texturesNode,this._splatsNode,this._particlesOverNode],t=["particles",void 0,"splats","particles"],r=0,n=0;n<e.length;n++){var o=e[n];if(o){o.setSiblingIndex(r++);var i=t[n];i&&(o.group=i)}}},Object.defineProperty(t.prototype,"texturesNode",{get:function(){return this._ensureChildNode("_texturesNode")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"splatsNode",{get:function(){return this._ensureChildNode("_splatsNode")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particlesUnderNode",{get:function(){return this._ensureChildNode("_particlesUnderNode")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particlesOverNode",{get:function(){return this._ensureChildNode("_particlesOverNode")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderCamera",{get:function(){var e=r._renderCamera;if(!cc.isValid(e,!0)){if(r._renderCamera=e=cc.instantiate(this.storage.renderCameraPrefab).getComponent(cc.Camera),!e)throw new Error("Camera component missing on "+this.storage.renderCameraPrefab.name+".");e.enabled=!1,e.node.setParent(cc.director.getScene()),cc.game.addPersistRootNode(e.node)}return e},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this._postUpdate,this)},t.prototype.onDestroy=function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this._postUpdate,this)},t.prototype._postUpdate=function(){this._renderTextureCells()||this._checkTextureCellBoundsAndOpacity()||this.updateBoundsAndOpacity()},t.prototype.addSplats=function(e){var t,r,n,o;if(!this.enabledInHierarchy)throw new Error("Cannot add splats to a disabled drawing");try{for(var i=p(e),a=i.next();!a.done;a=i.next()){var c=a.value,s=c.convertToWorldSpaceAR(cc.Vec2.ZERO),l=this.node.convertToNodeSpaceAR(s);c.setParent(this.splatsNode),c.setPosition(l),this._splatData.push(m.toSplatData(c));try{for(var u=(n=void 0,p(this._ensureTextureCellsForSplat(c,l))),f=u.next();!f.done;f=u.next()){var d=f.value;this._textureCellsToRender.includes(d)||this._textureCellsToRender.push(d)}}catch(h){n={error:h}}finally{try{f&&!f.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}}}catch(y){t={error:y}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}this._renderPassOptimization||this._renderTextureCells()},t.prototype.addParticle=function(e,t){if(!this.enabledInHierarchy)throw new Error("Cannot add particles to a disabled drawing");var r=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),n=this.node.convertToNodeSpaceAR(r);return e.node.setParent(e.order===b.ParticleOrder.UnderSplats?this.particlesUnderNode:this.particlesOverNode),e.node.setPosition(n),t&&(e.velocity=t.clone()),e.emit()},t.prototype.clear=function(){this._clearTexturesNode(),this._clearParticlesNodes(),this._clearSplatsNode(),this._splatData.length=0},t.prototype.copy=function(e){var t,n;if(!gm.loaded)throw new Error(gm.name+" is not loaded.");if(this.updateBoundsAndOpacity(),e)e.node.removeAllChildren();else{var o=w.default.getNodeState(this.node,!1);(e=w.default.createNodeWithState(o).addComponent(r)).enabled=this.enabled}e.name=this.name,e._baseColor=this._baseColor.clone(),e._textureResolution=this._textureResolution,e._textureScale=this._textureScale,e._size=this._size.clone(),e._center=this._center.clone(),e._centerOfOpacity=this._centerOfOpacity.clone(),e._requiresBoundsAndOpacityUpdate=this._requiresBoundsAndOpacityUpdate,e._splatData=this._splatData.map(function(e){return i(i({},e),{position:i({},e.position),scale:i({},e.scale)})}),e._texturesNode&&(e._texturesNode.removeFromParent(),e._texturesNode.destroy()),this._texturesNode&&(e._texturesNode=cc.instantiate(this._texturesNode),e._texturesNode.setParent(e.node),e._fetchTextureCells());try{for(var a=p(this.particles),c=a.next();!c.done;c=a.next()){var s=c.value,l=gm.drawings.useParticle(s.node.name);w.default.applyNodeState(l.node,s.node),l.node.setParent(e.node),e.addParticle(l),l.applyParticleState(s.getParticleState())}}catch(f){t={error:f}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}var u=this.getComponent(C.default);return u&&C.default.ensure(e,u.id),e},t.prototype.getDominantColor=function(){return this._requiresDominantColorUpdate&&(this._dominantColor=this._calculateDominateColor()),this._dominantColor.clone()},t.prototype._calculateDominateColor=function(){var e=cc.Color.WHITE.toRGBValue(),t=this.splatData.filter(function(t){return t.color!==e}).map(function(e){return{rgb:e.color,area:e.width*e.height,opacity:e.opacity}}).reduce(function(e,t){var r=e.get(t.rgb)||0,n=t.area*(t.opacity/255);return e.set(t.rgb,r+n),e},new Map),r=Array.from(t.entries()).reduce(function(e,t){var r=f(t,2),n=r[0],o=r[1];return o>e.score?{rgb:n,score:o}:e},{score:0,rgb:0}).rgb;return new cc.Color(r)},Object.defineProperty(t.prototype,"size",{get:function(){return this.updateBoundsAndOpacity(),this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.updateBoundsAndOpacity(),this._center},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centerOfOpacity",{get:function(){return this.updateBoundsAndOpacity(),this._centerOfOpacity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTextureCells",{get:function(){return this.numTextureCells>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numTextureCells",{get:function(){return this.textureCells.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureCells",{get:function(){return this._textureCells.filter(function(e){return cc.isValid(e)&&e.opacity>0})},enumerable:!1,configurable:!0}),t.prototype._ensureTextureCellsForSplat=function(e,t){var r,n,o,i,a=[],c=e.getBoundingBox();try{for(var s=p(this._signedGridResolutionRange(c.width)),l=s.next();!l.done;l=s.next()){var u=l.value;try{for(var f=(o=void 0,p(this._signedGridResolutionRange(c.height))),d=f.next();!d.done;d=f.next()){var h=d.value,y=t.add(cc.v2(u+.5*this._adjustedTextureResolution,h+.5*this._adjustedTextureResolution)),g=this._convertToGridCoordinate(y),_=this._ensureTextureCell(g);a.includes(_)||a.push(_)}}catch(m){o={error:m}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}}}catch(b){r={error:b}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a},t.prototype._ensureTextureCell=function(e){var t=this._getTextureCell(e);return t||(t=this._createTextureCell(e)),t},t.prototype._getTextureCell=function(e){var t=this.texturesNode.getChildByName(e.toString());return cc.isValid(t,!0)?t.getComponent(_.default):null},t.prototype._createTextureCell=function(e){var t=new cc.Node(e.toString()).addComponent(_.default),r=this._convertFromGridCoordinate(e);return t.coord=e.clone(),t.baseColor=this.baseColor,t.textureScale=this.textureScale,t.node.setParent(this.texturesNode),t.node.setPosition(r),t.node.setContentSize(this.textureResolution,this.textureResolution),t.node.scaleX=this.textureScale,t.node.scaleY=-this.textureScale,t.node.color=this.node.color.clone(),this._fetchTextureCells(),t},t.prototype._clearTexturesNode=function(){this.texturesNode.removeAllChildren(),this._fetchTextureCells()},t.prototype._clearSplatsNode=function(){var e,t;try{for(var r=p(d(this.splatsNode.children)),n=r.next();!n.done;n=r.next()){var o=n.value;this.storage.releaseSplat(o)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._clearParticlesNodes=function(){var e,t;if(!gm.loaded)throw new Error(gm.name+" is not loaded.");var r=d(this.particlesUnderNode.children,this.particlesOverNode.children);try{for(var n=p(r),o=n.next();!o.done;o=n.next()){var i=o.value.getComponent(b.default);i&&gm.drawings.releaseParticle(i)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.particlesUnderNode.removeAllChildren(),this.particlesOverNode.removeAllChildren()},t.prototype._renderTextureCells=function(e){if(void 0===e&&(e=this._textureCellsToRender),0===e.length)return!1;var t=this.renderCamera;for(t.node.setParent(this.node),t.zoomRatio=1/this.node.scale/this.textureScale;e.length>0;){var r=e.shift();cc.isValid(r)&&cc.isValid(r.node)&&(t.node.position=r.node.position.add(k),r.render(t,this.node))}return t.node.setParent(cc.director.getScene()),this._clearSplatsNode(),this._requiresBoundsAndOpacityUpdate=!0,this._requiresDominantColorUpdate=!0,!0},t.prototype._fetchTextureCells=function(){this._textureCells=this.texturesNode.getComponentsInChildren(_.default)},t.prototype._checkTextureCellBoundsAndOpacity=function(){var e,t;this._boundsCheckChunker.reset(!1);var r=!1,n=!1;try{for(var o=p(this._textureCells),i=o.next();!i.done;i=o.next()){var a=i.value;if(cc.isValid(a)&&a.requiresBoundsAndOpacityUpdate&&!this._textureCellsToRender.includes(a)&&(a.updateBoundsAndOpacity(),n=!0,a.opacity<=0&&(r=!0,a.node.removeFromParent(),a.node.destroy()),this._boundsCheckChunker.check(1/60)))break}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return r&&this._fetchTextureCells(),n},t.prototype.onUpdateBoundsAndOpacity=function(){var e,t,r,n,o=cc.v2(-1/0,-1/0),i=cc.v2(1/0,1/0),a=0,c=cc.v2(0,0);try{for(var s=p(this.textureCells),l=s.next();!l.done;l=s.next()){var u=l.value,f=cc.v2(u.node.position);c.x+=f.x*u.opacity,c.y+=f.y*u.opacity,a+=u.opacity;var d=f.add(u.topRight),h=f.add(u.bottomLeft);d.y>o.y&&(o.y=d.y),h.y<i.y&&(i.y=h.y),d.x>o.x&&(o.x=d.x),h.x<i.x&&(i.x=h.x)}}catch(v){e={error:v}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}try{for(var y=p(this.particles),g=y.next();!g.done;g=y.next()){var _=g.value.node;d=cc.v2(_.x+_.width,_.y+_.height),h=cc.v2(_.x-_.width,_.y-_.height),d.y>o.y&&(o.y=d.y),h.y<i.y&&(i.y=h.y),d.x>o.x&&(o.x=d.x),h.x<i.x&&(i.x=h.x)}}catch(w){r={error:w}}finally{try{g&&!g.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}var m=Math.abs(o.x-i.x),b=Math.abs(o.y-i.y);this._size.width=m,this._size.height=b,this._center.x=i.x+.5*m,this._center.y=i.y+.5*b,a>0?(c.x/=a,c.y/=a):(c.x=this._center.x,c.y=this._center.y),this._centerOfOpacity=c},t.prototype._signedGridResolutionRange=function(e){for(var t=[],r=e/2,n=0;n<=r;n+=this._adjustedTextureResolution)t.push(n),0!==n&&t.push(-n);return t.includes(-r)||t.push(-r),t.includes(r)||t.push(r),t.sort(S.default.ascending),t},t.prototype._convertToGridCoordinate=function(e){return new v.GridCoord(e.x/this._adjustedTextureResolution,e.y/this._adjustedTextureResolution)},t.prototype._convertFromGridCoordinate=function(e){var t=this._adjustedTextureResolution;return new cc.Vec2(e.x*t,e.y*t)},t._renderCamera=null,s([R(),u("design:type",Object)],t.prototype,"_textureResolution",void 0),s([R({visible:!0,tooltip:"Wait for render pass when adding splats rather than rendering instantly. This is more performant, but may result in artifacts in drawings that are moving quickly."}),u("design:type",Object)],t.prototype,"_renderPassOptimization",void 0),s([R({min:32,max:512}),u("design:type",Number),u("design:paramtypes",[Number])],t.prototype,"textureResolution",null),s([R(),u("design:type",Object)],t.prototype,"_textureScale",void 0),s([R({visible:!0,min:.1,max:10}),u("design:type",Number),u("design:paramtypes",[Number])],t.prototype,"textureScale",null),s([R(),u("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object)],t.prototype,"_baseColor",void 0),s([R({visible:!0}),u("design:type","function"==typeof(a="undefined"!=typeof cc&&cc.Color)?a:Object),u("design:paramtypes",["function"==typeof(c="undefined"!=typeof cc&&cc.Color)?c:Object])],t.prototype,"baseColor",null),s([R({visible:!1}),u("design:type",Array)],t.prototype,"_splatData",void 0),s([O.default({type:g.default,scope:"scene"}),u("design:type","function"==typeof(l=void 0!==g.default&&g.default)?l:Object)],t.prototype,"storage",void 0),s([R(),u("design:type",Object)],t.prototype,"_size",void 0),s([R(),u("design:type",Object)],t.prototype,"_center",void 0),s([R(),u("design:type",Object)],t.prototype,"_centerOfOpacity",void 0),r=s([j,A,x("Drawing Component/Drawing")],t)}(y.default);r.default=F,cc._RF.pop()},{"../Generic/Grid":"Grid","../Util/Decorators/cache":"cache","../Util/NodeUtils":"NodeUtils","../Util/chunker":"chunker","../Util/sortBy":"sortBy","./DrawingComponent":"DrawingComponent","./DrawingSerializer":"DrawingSerializer","./DrawingStorage":"DrawingStorage","./DrawingStorageMeta":"DrawingStorageMeta","./DrawingTextureCell":"DrawingTextureCell","./Particle":"Particle"}],EditorScript:[function(e,t,r){"use strict";cc._RF.push(t,"e117dPBCgpIKLQCYA+oujZI","EditorScript");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../Util/EventHandlerUtils")),f=u(e("../Util/getComponentsInScene")),d=u(e("../Util/NodeUtils")),h=(u(e("./Excluder")),u(e("../Util/isInPrefabMode"))),y=cc._decorator,g=y.ccclass,_=y.property,m=y.executeInEditMode,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.execute=!1,t.executeOnStart=!1,t.editorEvents=[],t._initialEventAdded=!1,t}var r;return o(t,e),r=t,t.allScenesScript=function(){return c(this,void 0,Promise,function(){var e,t,n,o;return s(this,function(i){switch(i.label){case 0:return e=cc.director.getScene(),t=Date.now(),n=h.default()?e.children[1].name:e.name,(o=r.prototype.runOnBuildPreProcessing.call(null))instanceof Promise?[4,o]:[3,2];case 1:o=i.sent(),i.label=2;case 2:return cc.log(h.default()?"Prefab":"Scene",n,"runOnBuildPreProcessing complete",(Date.now()-t)/1e3,"sec"),[2,"boolean"!=typeof o||o]}})})},t.prototype.start=function(){this.executeOnStart&&(this.execute=!0),this._initialEventAdded||(this._initialEventAdded=!0,p.default.ensure({target:this.node,component:this,handler:"runOnBuildPreProcessing"},this.editorEvents),this.node.name+=" - runOnBuildPreProcessing")},t.prototype.update=function(){},t.prototype.runOnBuildPreProcessing=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c,u;return s(this,function(s){switch(s.label){case 0:e=function(e){return"function"==typeof e.onBuildPreProcess},t=f.default(cc.Component),s.label=1;case 1:s.trys.push([1,6,7,8]),r=l(t),n=r.next(),s.label=2;case 2:return n.done?[3,5]:(o=n.value,e(o)?[4,o.onBuildPreProcess(!1,"scene")]:[3,4]);case 3:i=s.sent(),cc.log(d.default.pathOfNode(o.node).join(" | "),"changed in build:",i),s.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return a=s.sent(),c={error:a},[3,8];case 7:try{n&&!n.done&&(u=r.return)&&u.call(r)}finally{if(c)throw c.error}return[7];case 8:return[2]}})})},i([_({displayName:"Check to Execute"}),a("design:type",Object)],t.prototype,"execute",void 0),i([_({}),a("design:type",Object)],t.prototype,"executeOnStart",void 0),i([_({type:cc.Component.EventHandler}),a("design:type",Array)],t.prototype,"editorEvents",void 0),i([_(),a("design:type",Object)],t.prototype,"_initialEventAdded",void 0),r=i([g,m],t)}(cc.Component);r.default=b,cc._RF.pop()},{"../Util/EventHandlerUtils":"EventHandlerUtils","../Util/NodeUtils":"NodeUtils","../Util/getComponentsInScene":"getComponentsInScene","../Util/isInPrefabMode":"isInPrefabMode","./Excluder":"Excluder"}],EmitterDrawingTool:[function(e,t,r){"use strict";cc._RF.push(t,"ed2b3zvvMpFpbiiPGpZIDNj","EmitterDrawingTool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./DrawingTool")),f=u(e("../Drawing/Particle")),d=u(e("../Util/RandomUtil")),h=u(e("../Util/lerpAngle")),y=u(e("../Util/angleOfVector")),g=cc._decorator,_=g.ccclass,m=g.property,b=cc.misc,v=b.lerp,w=b.clamp01,O=b.clampf,S=Math.round,C=Math.max,P=Math.min,T=Math.floor,j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._smoothColorInterpolation=!0,t._sizeRange=[64,128],t._sizeFactor=.5,t._scaleRange=[1,1],t._speedAffectScaleFactor=0,t._angularVariance=0,t.angleFollowsStroke=!1,t._opacityRange=[255,255],t._speedAffectOpacityFactor=0,t._positionalVariance=0,t._speedMaximum=500,t.drawing=null,t.lastSplatKey=null,t}return o(t,e),Object.defineProperty(t.prototype,"sizeMin",{get:function(){return this._sizeRange[0]},set:function(e){this._sizeRange[0]=S(e),this._sizeRange[1]=C.apply(void 0,s(this._sizeRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeMax",{get:function(){return this._sizeRange[1]},set:function(e){this._sizeRange[1]=S(e),this._sizeRange[0]=P.apply(void 0,s(this._sizeRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeFactor",{get:function(){return this._sizeFactor},set:function(e){this._sizeFactor=w(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMin",{get:function(){return this._scaleRange[0]},set:function(e){this._scaleRange[0]=e,this._scaleRange[1]=C.apply(void 0,s(this._scaleRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMax",{get:function(){return this._scaleRange[1]},set:function(e){this._scaleRange[1]=e,this._scaleRange[0]=P.apply(void 0,s(this._scaleRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speedAffectScaleFactor",{get:function(){return this._speedAffectScaleFactor/100},set:function(e){var t=100*w(e);this._speedAffectScaleFactor=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angularVariance",{get:function(){return this._angularVariance},set:function(e){this._angularVariance=O(e,0,360)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacityMin",{get:function(){return this._opacityRange[0]},set:function(e){this._opacityRange[0]=S(e),this._opacityRange[1]=C.apply(void 0,s(this._opacityRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacityMax",{get:function(){return this._opacityRange[1]},set:function(e){this._opacityRange[1]=S(e),this._opacityRange[0]=P.apply(void 0,s(this._opacityRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speedAffectOpacityFactor",{get:function(){return this._speedAffectOpacityFactor/100},set:function(e){var t=100*w(e);this._speedAffectOpacityFactor=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionalVariance",{get:function(){return this._positionalVariance},set:function(e){this._positionalVariance=O(e,0,100)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speedMaximum",{get:function(){return this._speedMaximum},set:function(e){this._speedMaximum=O(e,0,500)},enumerable:!1,configurable:!0}),t.prototype.touchEnd=function(t){e.prototype.touchEnd.call(this,t),this.lastSplatKey=null},t.prototype.onDraw=function(e,t){var r,n,o=this.lastSplatKey?this.getSplatCount(e,t):1,i=this._createDrawables(o);if(0!==i.length){var a=this._interpolate(i,t).velocity,c=this._seperateSplatsFromParticles(i),s=c.splats,u=c.particles;t.addSplats(s);try{for(var p=l(u),f=p.next();!f.done;f=p.next()){var d=f.value;t.addParticle(d,a)}}catch(h){r={error:h}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}}},t.prototype._createDrawables=function(e){for(var t=[];gm.loaded&&t.length<e;)t.push(this.createSplatOrParticle());return t},t.prototype._createSplatKey=function(e,t,r){var n=r?r.drawing.node.convertToWorldSpaceAR(r.position):this.currentTouchCoord.world,o=this.currentTouchCoord.world.subtract(n),i=t.node.convertToNodeSpaceAR(this.currentTouchCoord.world),a=v(this.sizeMin,this.sizeMax,this.sizeFactor),c=r||e,s=c.angle,l=c.opacity,u=c.scale;return{drawing:t,angle:s,color:this.colors.length>0?d.default.item(this.colors):(r||e).color,opacity:l,position:i,scale:u,size:a,velocity:o}},t.prototype._interpolate=function(e,t){for(var r,n,o=this.lastSplatKey||this._createSplatKey(e[0],t),i=this._createSplatKey(e[e.length-1],t,o),a=0;a<e.length;a++){var c=e[a],s=(a+1)/e.length;c.color=this._lerpColor(o,i,s),c.position=this._lerpPosition(o,i,s),c.opacity=this._lerpOpacity(o,i,s),c.angle=this._lerpAngle(o,i,s),c.scale=this._lerpScale(o,i,s),c.width=c.height=this._lerpSize(o,i,s);var u=c.getComponentsInChildren(cc.Widget);try{for(var p=(r=void 0,l(u)),f=p.next();!f.done;f=p.next())f.value.updateAlignment()}catch(d){r={error:d}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}}return this.lastSplatKey=this._matchSplatKey(e,i),i},t.prototype._seperateSplatsFromParticles=function(e){var t,r,n=[],o=[];try{for(var i=l(e),a=i.next();!a.done;a=i.next()){var c=a.value;c instanceof f.default?n.push(c):o.push(c)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return{particles:n,splats:o}},t.prototype._matchSplatKey=function(e,t){var r=e[e.length-1];return t.color=r.color,t.opacity=r.opacity,t},t.prototype._lerpPosition=function(e,t,r){var n=e.position.lerp(t.position,r),o=.5*this.positionalVariance;n.addSelf(d.default.v2(o));var i=t.drawing.node.convertToWorldSpaceAR(n);return cc.v3(i)},t.prototype._lerpColor=function(e,t,r){return!this._smoothColorInterpolation&&this.colors.length>1?d.default.item(this.colors).clone():e.color.lerp(t.color,r)},t.prototype._lerpOpacity=function(e,t,r){var n=e.velocity.lerp(t.velocity,r),o=O(e.opacity,this.opacityMin,this.opacityMax),i=v(this.opacityMax,this.opacityMin,w(n.len()/this.speedMaximum)),a=d.default.integer(this.opacityMin,this.opacityMax),c=v(a,i,this.speedAffectOpacityFactor);return T(v(o,c,r))},t.prototype._lerpAngle=function(e,t,r){var n=e.velocity.lerp(t.velocity,r),o=this.angleFollowsStroke?y.default(n):h.default(e.angle,t.angle,r),i=this.angularVariance;return o+d.default.float(-i,i)-this.currentTouchCoord.angle},t.prototype._lerpScale=function(e,t,r){var n=this.scaleMin,o=this.scaleMax,i=d.default.float(n,o),a=e.velocity.lerp(t.velocity,r),c=v(n,o,w(a.len()/this.speedMaximum)),s=v(i,c,this.speedAffectScaleFactor);return O(s,n,o)/this.currentTouchCoord.scale/this.drawing.node.scale},t.prototype._lerpSize=function(e,t,r){return v(e.size,t.size,r)},i([m({tooltip:"Color differences between individual emitted splats will be smoothed.",visible:function(){return this.colors.length>1}}),a("design:type",Object)],t.prototype,"_smoothColorInterpolation",void 0),i([m({type:cc.Integer}),a("design:type",Array)],t.prototype,"_sizeRange",void 0),i([m({step:1,slide:!0,min:0,max:400,tooltip:"The minimim size, in pixels, an emitted splat will be sized to when created, according to this tool's size factor."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"sizeMin",null),i([m({step:1,slide:!0,min:0,max:400,tooltip:"The maximum size, in pixels, an emitted splat will be sized to when created, according to this tool's size factor."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"sizeMax",null),i([m(),a("design:type",Object)],t.prototype,"_sizeFactor",void 0),i([m({tooltip:"A size factor will interpolate the size of emitted splats between the minimum and maximum possible values.\nThis default value would be overwritten by the DrawingUI at runtime.",slide:!0,min:0,max:1}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"sizeFactor",null),i([m({type:cc.Integer}),a("design:type",Array)],t.prototype,"_scaleRange",void 0),i([m({slide:!0,min:0,max:5,tooltip:"The minimim scale an emitted splat will be given."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"scaleMin",null),i([m({slide:!0,min:0,max:5,tooltip:"The maximum scale an emitted splat will be given."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"scaleMax",null),i([m({tooltip:"Rather than being just random, Scale of placed splats can be determined by speed by this percentage\n\nFaster values resulting in greater scale.",visible:function(){return this.scaleMin!==this.scaleMax},slide:!0,step:1,min:0,max:100}),a("design:type",Object)],t.prototype,"_speedAffectScaleFactor",void 0),i([m({tooltip:"Each placed splat will fluctuate in angle by this degree.",slide:!0,visible:!0,min:0,max:360}),a("design:type",Object)],t.prototype,"_angularVariance",void 0),i([m({tooltip:"If enabled, the splat will be angled according to the direction of the stroke."}),a("design:type",Object)],t.prototype,"angleFollowsStroke",void 0),i([m({type:cc.Integer}),a("design:type",Array)],t.prototype,"_opacityRange",void 0),i([m({step:1,slide:!0,min:0,max:255,tooltip:"The minimim opacity an emitted splat will be given."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"opacityMin",null),i([m({step:1,slide:!0,min:0,max:255,tooltip:"The maximum opacity an emitted splat will be given."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"opacityMax",null),i([m({tooltip:"Rather than being just random, Opacity of placed splats can be determined by speed by this percentage.\n\nFaster values resulting in lower opacity.",visible:function(){return this.opacityMin!==this.opacityMax},slide:!0,step:1,min:0,max:100}),a("design:type",Object)],t.prototype,"_speedAffectOpacityFactor",void 0),i([m({tooltip:"Random positional variation, in pixels, given to splats from the center of the stroke.",slide:!0,visible:!0,min:0,max:100}),a("design:type",Object)],t.prototype,"_positionalVariance",void 0),i([m({min:0,max:500,tooltip:"For speed calculations, the speed by which to consider full effectiveness. In pixels per second.",visible:function(){return this.speedAffectOpacityFactor>0||this.speedAffectScaleFactor>0}}),a("design:type",Object)],t.prototype,"_speedMaximum",void 0),i([_],t)}(p.default);r.default=j,cc._RF.pop()},{"../Drawing/Particle":"Particle","../Util/RandomUtil":"RandomUtil","../Util/angleOfVector":"angleOfVector","../Util/lerpAngle":"lerpAngle","./DrawingTool":"DrawingTool"}],EraserTool:[function(e,t,r){"use strict";cc._RF.push(t,"4ba24D8dZtLlrJBSKzYrgcd","EraserTool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./StrokeDrawingTool")),l=cc._decorator,u=l.ccclass,p=l.property,f=l.menu,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.colors=[],t}return o(t,e),t.prototype.onDraw=function(t,r){e.prototype.onDraw.call(this,t,r);var n=this.lastSplatKey;n&&r.particles.filter(function(e){return!e.node.getActionByTag(1239480)}).filter(function(e){return cc.Intersection.circleCircle({position:n.position,radius:n.scale*n.size*.5},{position:cc.v2(e.position),radius:e.scale*Math.max(e.width,e.height)*.5})}).forEach(function(e){return cc.tween(e.node).tag(1239480).to(.2,{scale:0}).call(function(){return e.release()}).start()})},t.prototype._lerpColor=function(){var e,t;return null!==(t=null===(e=this.drawing)||void 0===e?void 0:e.baseColor)&&void 0!==t?t:cc.Color.WHITE},i([p({override:!0,visible:!1}),a("design:type",Array)],t.prototype,"colors",void 0),i([u,f("Drawing Component/Eraser Tool")],t)}(s.default);r.default=d,cc._RF.pop()},{"./StrokeDrawingTool":"StrokeDrawingTool"}],EventHandlerUtils:[function(e,t,r){"use strict";cc._RF.push(t,"e39e0O1badLsr7h2dmOWg5v","EventHandlerUtils");var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(r,"__esModule",{value:!0}),r.getComponentId=r.emitEventHandlers=r.ensureEventHandler=r.indexOfEventHandler=r.includesEventHandler=r.equalsEventHandler=r.removeEventHandler=r.createEventHandler=void 0;var a=cc.js,c=a.getClassName,s=a.getClassByName;function l(e){var t=cc.js._getClassId(e);if("string"!=typeof t)throw new Error("Could not find id for "+c(e));return t}function u(e,t){var r=e.target,n=e.component,o=e.handler,i=e.customEventData,a=void 0===i?"":i;if("function"!=typeof n[o])throw new Error(o.toString()+" is not a function on "+c(n));var s=new cc.Component.EventHandler;return s.target=r,s.handler=o.toString(),s.customEventData=a,s._componentId=l(n),t&&t.push(s),s}function p(e,t){var r,o;e instanceof cc.Component.EventHandler||(e=u(e)),t instanceof cc.Component.EventHandler||(t=u(t));var i=e,a=t;try{for(var c=n([i,a]),p=c.next();!p.done;p=c.next()){var f=p.value;!f._componentId&&f.component&&(f._componentId=l(s(f.component)))}}catch(d){r={error:d}}finally{try{p&&!p.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}return e.target===t.target&&i._componentId===a._componentId&&e.handler===t.handler&&e.customEventData===t.customEventData}function f(e,t){for(var r=e instanceof cc.Component.EventHandler?e:u(e),n=0;n<t.length;n++)if(p(r,t[n]))return n;return-1}function d(e,t){return f(e,t)>-1}function h(e,t){var r=f(e,t);return r>-1&&t.splice(r,1),r}function y(e,t){d(e,t)||(e instanceof cc.Component.EventHandler?t.push(e):u(e,t))}function g(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=[]);for(var o=n.length;o<e.length;o++){var a=e[o];a._genCompIdIfNeeded();var c=a._componentId,s=cc.js._getClassById(c);s||cc.warn("No component name found for event with target "+a.target.name+" and handler "+a.handler);var l=s&&a.target&&a.target.getComponent(s),u=l&&"function"==typeof l[a.handler]?l[a.handler](t,a.customEventData):void 0;if(u instanceof Promise&&r)return u.then(function(o){return g(e,t,r,i(n,[o]))});n.push(u)}return n.some(function(e){return e instanceof Promise})?Promise.all(n):n}function _(e,t,r){return void 0===r&&(r=!1),g(e,t,r)}r.getComponentId=l,r.createEventHandler=u,r.equalsEventHandler=p,r.indexOfEventHandler=f,r.includesEventHandler=d,r.removeEventHandler=h,r.ensureEventHandler=y,r.emitEventHandlers=_,r.default={create:u,equals:p,remove:h,includes:d,indexOf:f,ensure:y,find:function(e,t){return t[f(e,t)]||null},emit:_},cc._RF.pop()},{}],Excluder:[function(e,t,r){"use strict";cc._RF.push(t,"6651b0nuPNH4oqI3HlNtTrr","Excluder");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,u=s.menu,p=s.property,f=s.disallowMultiple,d=function(e){function t(){var t=e.call(this)||this;return t._allowInPreview=!0,t._allowInDebug=!1,t._allowInProduction=!1,t}return o(t,e),Object.defineProperty(t.prototype,"allowInPreview",{get:function(){return this._allowInPreview},set:function(e){this._allowInPreview=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"allowInDebug",{get:function(){return this._allowInDebug},set:function(e){this._allowInDebug=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"allowInProduction",{get:function(){return this._allowInProduction},set:function(e){this._allowInProduction=e},enumerable:!1,configurable:!0}),t.prototype.onBuildPreProcess=function(e,t){var r,n;if(e&&this.allowInDebug)return!1;if(!e&&this.allowInProduction)return!1;try{if(this.node.parent===cc.director.getScene()&&"prefab"===t){this.node.removeAllChildren();try{for(var o=c(this.node.getComponents(cc.Component)),i=o.next();!i.done;i=o.next())i.value.destroy()}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}else this.node.removeFromParent(),this.node.destroy();return!0}catch(s){return cc.error("Error excluding nodes from build:",s.message),!1}},i([p({visible:!0}),a("design:type",Object)],t.prototype,"_allowInPreview",void 0),i([p({visible:!0}),a("design:type",Object)],t.prototype,"_allowInDebug",void 0),i([p({visible:!0}),a("design:type",Object)],t.prototype,"_allowInProduction",void 0),i([l,f,u("Development Component/Excluder"),a("design:paramtypes",[])],t)}(cc.Component);r.default=d,cc._RF.pop()},{}],FitChildrenToBounds:[function(e,t,r){"use strict";cc._RF.push(t,"332dcJkPZlDFYQukRd4xkUv","FitChildrenToBounds");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./SizeToScreen"),l=cc._decorator,u=l.ccclass,p=l.executeInEditMode,f=l.menu,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,t._boundNode=null,t._includeDescendants=!0,t._resize=function(){return t.applyChildScaling()},t}return o(t,e),t.prototype.onEnable=function(){this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE&&s.onResize(this._resize),cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onDisable=function(){this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE&&s.offResize(this._resize),cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.start=function(){this.applyChildScaling()},t.prototype.onBeforeDraw=function(){this.enabledInHierarchy&&this.applyMode===cc.Widget.AlignMode.ALWAYS&&this.applyChildScaling()},t.prototype.applyChildScaling=function(){var e,t,r=this.node;try{for(var n=c(this.node.children),o=n.next();!o.done;o=n.next()){var i=o.value,a=this._getChildBoundingBox(i);if(0===a.width||0===a.height)return;var s=Math.min(r.width/a.width,r.height/a.height);i.scaleX*=s,i.scaleY*=s,a=this._getChildBoundingBox(i);var l=r.width*(1-r.anchorX)-a.xMax;l<0&&(i.x+=l);var u=r.width*r.anchorX+a.xMin;u<0&&(i.x-=u);var p=r.height*(1-r.anchorY)-a.yMax;p<0&&(i.y+=p);var f=r.height*r.anchorY+a.yMin;f<0&&(i.y-=f)}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype._getChildBoundingBox=function(e){var t,r,n=this._boundNode||e;if(this._includeDescendants){var o=n.getBoundingBoxToWorld(),i=cc.v2(o.xMin,o.yMin),a=cc.v2(o.xMax,o.yMax);t=this.node.convertToNodeSpaceAR(i),r=this.node.convertToNodeSpaceAR(a)}else{var c=n.getBoundingBox();t=cc.v2(c.xMin,c.yMin),r=cc.v2(c.xMax,c.yMax)}return cc.rect(t.x,t.y,r.x-t.x,r.y-t.y)},i([d({type:cc.Widget.AlignMode}),a("design:type",Object)],t.prototype,"applyMode",void 0),i([d({type:cc.Node,visible:!0,tooltip:"Node to use as bounds for children, instead of the child nodes themselves."}),a("design:type",Object)],t.prototype,"_boundNode",void 0),i([d({visible:!0,tooltip:"Include the descendents of each child or bound node"}),a("design:type",Object)],t.prototype,"_includeDescendants",void 0),i([u,p,f("Generic Component/Fit Children To Bounds")],t)}(cc.Component);r.default=h,cc._RF.pop()},{"./SizeToScreen":"SizeToScreen"}],FourCornerGradientAnimator:[function(e,t,r){"use strict";cc._RF.push(t,"29982RiNKJBaKDlSO5xes7R","FourCornerGradientAnimator");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./FourCornerGradient")),p=cc._decorator,f=p.ccclass,d=p.disallowMultiple,h=p.menu,y=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._opaqueTime=3,t._fadeTime=.5,t._padding=0,t._time=0,t._masterGradient=null,t}return o(t,e),Object.defineProperty(t.prototype,"masterGradient",{get:function(){if(!this._masterGradient){var e=this._masterGradient=new cc.Node(this.node.name+" Master Gradient").addComponent(u.default);e.node.setParent(this.node);var t=e.node.addComponent(cc.Widget);t.isAlignTop=t.isAlignRight=t.isAlignBottom=t.isAlignLeft=!0,t.top=t.bottom=t.right=t.left=this._padding,t.alignMode=cc.Widget.AlignMode.ALWAYS,t.updateAlignment()}return this._masterGradient},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"referenceGradients",{get:function(){var e=this;return this.node.children.map(function(e){return e.getComponent(u.default)}).filter(function(t){return t&&t!==e.masterGradient}).reverse()},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){var e,t;try{for(var r=c(this.referenceGradients),n=r.next();!n.done;n=r.next())n.value.enabled=!1}catch(o){e={error:o}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.onEnable=function(){if(this.referenceGradients.length<2)return cc.warn("Not enough gradients to animate."),void(this.enabled=!1)},t.prototype.update=function(e){var t,r;this._time+=e;var n=this._opaqueTime+this._fadeTime;if(!(this._time<=this._opaqueTime)){var o=s(this.referenceGradients,2),i=o[0],a=o[1],l=(this._time-this._opaqueTime)/this._fadeTime,u=this.masterGradient;try{for(var p=c(["topLeft","topRight","bottomLeft","bottomRight"]),f=p.next();!f.done;f=p.next()){var d=f.value;u[d]=cc.Color.lerp(u[d],i[d],a[d],l)}}catch(h){t={error:h}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}this._time>n&&(this._time-=n,i.node.setSiblingIndex(0))}},i([y({min:0,max:5,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_opaqueTime",void 0),i([y({min:0,max:5,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_fadeTime",void 0),i([y({visible:!0}),a("design:type",Object)],t.prototype,"_padding",void 0),i([f,d,h("Generic Component/4 Corner Gradient Animator")],t)}(cc.Component);r.default=g,cc._RF.pop()},{"./FourCornerGradient":"FourCornerGradient"}],FourCornerGradient:[function(e,t,r){"use strict";cc._RF.push(t,"fc0c8mPSUFPOpEcWLK6sab8","FourCornerGradient");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../Util/Decorators/cache")),p=e("../Util/chunker"),f=l(e("../Util/milliseconds")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.menu,_=d.disallowMultiple,m=d.executeInEditMode,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._topLeft=cc.Color.WHITE,t._topRight=cc.Color.WHITE,t._bottomLeft=cc.Color.WHITE,t._bottomRight=cc.Color.WHITE,t._blockSize=10,t._generateSize=cc.Size.ZERO,t._generateChunker=null,t._requiresGenerating=!0,t}var r,n,l,d,b;return o(t,e),Object.defineProperty(t.prototype,"topLeft",{get:function(){return this._topLeft},set:function(e){this._topLeft.equals(e)||(this._topLeft=e.clone(),this._requiresGenerating=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return this._topRight},set:function(e){this._topRight.equals(e)||(this._topRight=e.clone(),this._requiresGenerating=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return this._bottomLeft},set:function(e){this._bottomLeft.equals(e)||(this._bottomLeft=e.clone(),this._requiresGenerating=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return this._bottomRight},set:function(e){this._bottomRight.equals(e)||(this._bottomRight=e.clone(),this._requiresGenerating=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blockSize",{get:function(){return this._blockSize},set:function(e){this._blockSize!==e&&(this._blockSize=e,this._requiresGenerating=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isGenerating",{get:function(){return!!this._generateChunker},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isGenerated",{get:function(){return this.node.getContentSize().equals(this._generateSize)&&!this._requiresGenerating&&!0},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.isGenerating||this.isGenerated||this.generateGradient()},t.prototype.generateGradient=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a;return s(this,function(c){switch(c.label){case 0:if(this.isGenerated)throw new Error("Gradient is already being generated.");this._generateChunker=new p.Chunker("Generate Gradient on "+this.node.name+" node"),e=this.node.getContentSize().clone(),t=this.node,r=t.anchorX,n=t.anchorY,o=this._blockSize,this.clearGradient(),i=0,c.label=1;case 1:if(!(i<e.width))return[3,6];a=0,c.label=2;case 2:return a<e.height?(this.graphics.fillColor=this._calculateColorAtPosition(i,a),this.graphics.fillRect(i-e.width*r,a-e.height*n,o,o),this._generateChunker.check(10)?[4,f.default(0)]:[3,4]):[3,5];case 3:c.sent(),c.label=4;case 4:return a+=o,[3,2];case 5:return i+=o,[3,1];case 6:return this._generateSize=e,this._generateChunker.reset(!1),this._generateChunker=null,[2]}})})},t.prototype.clearGradient=function(){this.graphics.clear(),this._generateSize=cc.Size.ZERO},t.prototype._calculateColorAtPosition=function(e,t){var r=this.node,n=r.width,o=r.height,i=e/n*(t/o),a=(n-e)/n*(t/o),c=e/n*((o-t)/o),s=(n-e)/n*((o-t)/o),l=this._bottomLeft,u=this._topLeft,p=this._bottomRight,f=this._topRight,d=l.getR()*s+u.getR()*a+f.getR()*i+p.getR()*c,h=l.getG()*s+u.getG()*a+f.getG()*i+p.getG()*c,y=l.getB()*s+u.getB()*a+f.getB()*i+p.getB()*c;return new cc.Color(d,h,y)},i([y({visible:!0}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Color)?r:Object)],t.prototype,"_topLeft",void 0),i([y({visible:!0}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object)],t.prototype,"_topRight",void 0),i([y({visible:!0}),a("design:type","function"==typeof(l="undefined"!=typeof cc&&cc.Color)?l:Object)],t.prototype,"_bottomLeft",void 0),i([y({visible:!0}),a("design:type","function"==typeof(d="undefined"!=typeof cc&&cc.Color)?d:Object)],t.prototype,"_bottomRight",void 0),i([y({type:cc.Integer,min:1,max:100,visible:!0,tooltip:"The width of each calculated block along the gradient",formerlySerializedAs:"_fillWidth"}),a("design:type",Object)],t.prototype,"_blockSize",void 0),i([u.default({type:cc.Graphics,scope:"node",create:!0}),a("design:type","function"==typeof(b="undefined"!=typeof cc&&cc.Graphics)?b:Object)],t.prototype,"graphics",void 0),i([h,m,_,g("Generic Component/4 Corner Gradient")],t)}(cc.Component);r.default=b,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/chunker":"chunker","../Util/milliseconds":"milliseconds"}],GalleryFrame:[function(e,t,r){"use strict";cc._RF.push(t,"fa9d6Ym325PDbsvDju/UxBx","GalleryFrame");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var f=p(e("../../../ActorTrigger/Trigger")),d=p(e("../../../Generic/ButtonAsynchronizer")),h=p(e("../../../Util/EventHandlerUtils")),y=p(e("../../../ActorTrigger/TriggerAction - LoadDrawing")),g=p(e("../../../Drawing/DrawingBounds")),_=e("../../../Drawing/DrawingStorage"),m=p(e("../../../Util/NodeUtils")),b=p(e("../../../Generic/FitChildrenToBounds")),v=p(e("../../../Generic/PrefabTiler")),w=p(e("../../../Util/Decorators/cache")),O=cc._decorator,S=O.ccclass,C=O.property,P=O.executeInEditMode,T=cc.js.getClassName,j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._loadTrigger=null,t._featuredTrigger=null,t._featureTweenDuration=.25,t._featureTransformTarget=null,t._returnToWallTrigger=null,t._wallNodeReference=null,t}return o(t,e),Object.defineProperty(t.prototype,"loadTrigger",{get:function(){return this._validateLoadTrigger(this._loadTrigger)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"featureTransformTarget",{get:function(){if(!this._featureTransformTarget)throw new Error('"featureTransformTarget" has not been assigned to '+T(this)+" "+this.node.name);return this._featureTransformTarget},set:function(e){this._featureTransformTarget=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canBeAssignedArbitraryStorageKey",{get:function(){var e=this._getLoadDrawingActions(),t=l(e,1)[0];return 1===e.length&&!t.storageKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canBeAssignedSpecificVariation",{get:function(){var e=this._getLoadDrawingActions(),t=l(e,1)[0];return 1===e.length&&t.variation===_.GetVariation.Specific&&!!t.storageKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"validStorageKeys",{get:function(){return this.canBeAssignedArbitraryStorageKey?[]:this._getLoadDrawingActions().map(function(e){return e.storageKey})},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._validateLoadTrigger(this._loadTrigger),this._updateAlignmentSizeAndScale(),cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onDestroy=function(){cc.isValid(this.loadTrigger)&&this.loadTrigger.isExecuting&&this.loadTrigger.cancel(),cc.isValid(this._featuredTrigger)&&this._featuredTrigger.isExecuting&&this._featuredTrigger.cancel(),cc.isValid(this._returnToWallTrigger)&&this._returnToWallTrigger.isExecuting&&this._returnToWallTrigger.cancel(),cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.onBeforeDraw,this)},t.prototype.onBeforeDraw=function(){this.node.getActionByTag(100)&&this._updateAlignmentSizeAndScale()},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this.loadTrigger.isExecuting},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!this.loadTrigger.enabled},enumerable:!1,configurable:!0}),t.prototype.toggleFeatured=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:if(this.node.getActionByTag(100))throw new Error("Target is already transitioning!");return this.node.parent===this.featureTransformTarget?[4,this._returnToWall()]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this._feature()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.loadFrame=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:if(!this.loadTrigger.enabledInHierarchy)throw new Error(T(this)+" "+this.node.name+" load "+T(f.default)+" is not enabled!");if(!this.loadTrigger.check())throw new Error(T(this)+" "+this.node.name+" load "+T(f.default)+" condition check failed!");return[4,this.loadTrigger.execute()];case 1:return e.sent(),this._updateAlignmentSizeAndScale(),[2]}})})},t.prototype.reduceStorageKeys=function(e){var t,r;try{for(var n=u(this._getLoadDrawingActions()),o=n.next();!o.done;o=n.next()){var i=o.value;e.includes(i.storageKey)||(i.node.active=!1)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t.prototype.assignArbitraryStorageKey=function(e){var t=this._getLoadDrawingActions();if(1!==t.length)throw new Error(T(this)+" "+this.node.name+" has multiple "+T(y.default)+"s. "+T(this)+"s that are intended to showcase any drawing should only have one.");var r=l(t,1)[0];if(r.storageKey)throw new Error(T(this)+" "+this.node.name+" already has a storageKey assigned.");r.storageKey=e},t.prototype.assignSpecificVariation=function(e){var t=this._getLoadDrawingActions();if(1!==t.length)throw new Error(T(this)+" "+this.node.name+" has multiple "+T(y.default)+"s. "+T(this)+"s that are intended to showcase any variation should only have one.");var r=l(t,1)[0];if(!r.storageKey)throw new Error(T(this)+" "+this.node.name+" "+T(y.default)+" does not have a storageKey. "+T(this)+" that are intended to showcase any drawing should only have one.");r.specificVariation=e},t.prototype._feature=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c,l,u,p,f,d,h,y;return s(this,function(s){switch(s.label){case 0:return t=(e=this).featureTransformTarget,r=e._featuredTrigger,n=e._featureTweenDuration,o=e.node,cc.isValid(this._wallNodeReference)||(this._wallNodeReference=m.default.createNodeWithState(o)),i=t.x,a=t.y,c=t.width,l=t.height,u=t.angle,p=t.opacity,f=t.scaleX,d=t.scaleY,h=o.convertToWorldSpaceAR(cc.Vec2.ZERO),y=t.parent.convertToNodeSpaceAR(h),o.setParent(t),o.setPosition(y),[4,new Promise(function(e){cc.tween(o).tag(100).to(n,{x:i,y:a,scaleX:f,scaleY:d,width:c,height:l,angle:u,opacity:p},{easing:"quadInOut"}).call(function(){o.x=i,o.y=a,o.scaleX=f,o.scaleY=d,o.width=c,o.height=l,o.angle=u,o.opacity=p}).call(e).start()})];case 1:return s.sent(),r?[4,r.tryExecute()]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}})})},t.prototype._returnToWall=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c,l,u,p,f,d,h,y,g,_;return s(this,function(s){switch(s.label){case 0:if(t=(e=this)._returnToWallTrigger,r=e._wallNodeReference,n=e._featureTweenDuration,o=e.node,!cc.isValid(r))throw new Error("_wallNodeReference has not yet been created.");return i=r.x,a=r.y,c=r.width,l=r.height,u=r.angle,p=r.opacity,f=r.scaleX,d=r.scaleY,h=r.parent,y=cc.v2(i,a),g=h.convertToWorldSpaceAR(y),_=o.parent.convertToNodeSpaceAR(g),[4,new Promise(function(e){cc.tween(o).tag(100).to(n,{position:cc.v3(_),width:c,height:l,angle:u,scaleX:f,scaleY:d,opacity:p},{easing:"quadInOut"}).call(function(){o.setParent(h),o.setPosition(y),o.scaleX=f,o.scaleY=d,o.width=c,o.height=l,o.angle=u,o.opacity=p,r.removeFromParent(),r.destroy()}).call(e).start()})];case 1:return s.sent(),t?[4,t.tryExecute()]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}})})},t.prototype._validateLoadTrigger=function(e){if(!e)throw new Error(T(this)+" "+this.node.name+' "loadTrigger" is not set in the editor.');if(!e.disableAfterExecute)throw new Error(T(this)+" "+this.node.name+" load "+T(f.default)+' is not set to disable after execute. In the editor, check "Run Once".');return e},t.prototype._updateAlignmentSizeAndScale=function(){var e,t,r,n,o,i,a,c;if(cc.isValid(this)){try{for(var s=u(this._bounders),l=s.next();!l.done;l=s.next()){var p=l.value;p.enabledInHierarchy&&p.apply()}}catch(w){e={error:w}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}try{for(var f=u(this._widgets),d=f.next();!d.done;d=f.next()){var h=d.value;h.enabledInHierarchy&&h.updateAlignment()}}catch(O){r={error:O}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}try{for(var y=u(this._fitters),g=y.next();!g.done;g=y.next()){var _=g.value;_.enabledInHierarchy&&_.applyChildScaling()}}catch(S){o={error:S}}finally{try{g&&!g.done&&(i=y.return)&&i.call(y)}finally{if(o)throw o.error}}try{for(var m=u(this._tilers),b=m.next();!b.done;b=m.next()){var v=b.value;v.enabledInHierarchy&&v.updatedTiledInstances()}}catch(C){a={error:C}}finally{try{b&&!b.done&&(c=m.return)&&c.call(m)}finally{if(a)throw a.error}}}},t.prototype._getLoadDrawingActions=function(){return this.loadTrigger.actions.filter(function(e){return e instanceof y.default})},t.prototype._ensureButton=function(){this.getComponent(cc.Button)||this.addComponent(cc.Button);var e=this.getComponent(d.default)||this.addComponent(d.default);h.default.ensure({target:this.node,component:this,handler:"toggleFeatured"},e.clickEvents)},i([C({visible:!0,type:f.default}),a("design:type",Object)],t.prototype,"_loadTrigger",void 0),i([C({type:f.default,tooltip:"Trigger to try and execute when this gallery frame has been focused by the user.",visible:!0}),a("design:type",Object)],t.prototype,"_featuredTrigger",void 0),i([C({min:0,max:2,slide:!0,visible:!0,tooltip:"Time it takes to move to/from the featured transform position."}),a("design:type",Object)],t.prototype,"_featureTweenDuration",void 0),i([C({visible:!1,type:cc.Node}),a("design:type",Object)],t.prototype,"_featureTransformTarget",void 0),i([C({type:f.default,tooltip:"Trigger to try and execute when this gallery frame has been focused by the user.",visible:!0}),a("design:type",Object)],t.prototype,"_returnToWallTrigger",void 0),i([w.default({scope:"children",type:[v.default],required:!1}),a("design:type",Array)],t.prototype,"_tilers",void 0),i([w.default({scope:"children",type:[cc.Widget],required:!1}),a("design:type",Array)],t.prototype,"_widgets",void 0),i([w.default({scope:"children",type:[b.default],required:!1}),a("design:type",Array)],t.prototype,"_fitters",void 0),i([w.default({scope:"children",type:[g.default],required:!1}),a("design:type",Array)],t.prototype,"_bounders",void 0),i([C(),a("design:type",Boolean),a("design:paramtypes",[])],t.prototype,"canBeAssignedArbitraryStorageKey",null),i([C(),a("design:type",Boolean),a("design:paramtypes",[])],t.prototype,"canBeAssignedSpecificVariation",null),i([C({type:cc.String,visible:function(){return!this.canBeAssignedArbitraryStorageKey}}),a("design:type",Array),a("design:paramtypes",[])],t.prototype,"validStorageKeys",null),i([S,P],t)}(cc.Component);r.default=j,cc._RF.pop()},{"../../../ActorTrigger/Trigger":"Trigger","../../../ActorTrigger/TriggerAction - LoadDrawing":"TriggerAction - LoadDrawing","../../../Drawing/DrawingBounds":"DrawingBounds","../../../Drawing/DrawingStorage":"DrawingStorage","../../../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../../../Generic/FitChildrenToBounds":"FitChildrenToBounds","../../../Generic/PrefabTiler":"PrefabTiler","../../../Util/Decorators/cache":"cache","../../../Util/EventHandlerUtils":"EventHandlerUtils","../../../Util/NodeUtils":"NodeUtils"}],GalleryPaginator:[function(e,t,r){"use strict";cc._RF.push(t,"3c394XIkdJNQ6h6vb4IpAwc","GalleryPaginator");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Gallery")),l=c(e("../../../Util/EventHandlerUtils")),u=c(e("../../../Util/Decorators/cache")),p=cc._decorator,f=p.ccclass,d=p.property,h=1/Math.pow(2,10),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._specificPageButtonTemplate=null,t._prevPageButton=null,t._nextPageButton=null,t._selectedColor=cc.Color.WHITE,t._deselectedColor=cc.Color.WHITE,t._specificPageButtons=[],t}var r,n,c;return o(t,e),Object.defineProperty(t.prototype,"specificPageButtonTemplate",{get:function(){if(!this._specificPageButtonTemplate)throw new Error('"specificPageButtonTemplate" is not set in the editor.');return this._specificPageButtonTemplate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prevPageButton",{get:function(){if(!this._prevPageButton)throw new Error('"_prevPageButton" is not set in the editor.');return this._prevPageButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageButton",{get:function(){if(!this._nextPageButton)throw new Error('"_nextPageButton" is not set in the editor.');return this._nextPageButton},enumerable:!1,configurable:!0}),t.prototype.onEnable=function(){this._createSpecificPageButtons()},t.prototype.update=function(){this._updateSpecificButtonColor()},t.prototype._createSpecificPageButtons=function(){var e=this.specificPageButtonTemplate,t=e.getComponent(cc.Button);if(!t)throw new Error('"specificPageButtonTemplate" does not have a cc.Button component.');this._specificPageButtons.includes(t)||this._specificPageButtons.unshift(t);for(var r=0;r<this.gallery.numPages;r++){var n=this._specificPageButtons[r];n||((n=cc.instantiate(e).getComponent(cc.Button)).node.setParent(e.parent),n.node.setSiblingIndex(e.getSiblingIndex()+r)),n.clickEvents=[l.default.create({target:this.gallery.node,component:this.gallery,handler:"gotoPage",customEventData:r.toString()})],this._specificPageButtons[r]=n}this.gallery.numPages<=1?(this.prevPageButton.scale=h,this.nextPageButton.scale=h):(this.prevPageButton.scale=1,this.nextPageButton.scale=1);var o=this.node.getComponent(cc.Layout);o&&o.updateLayout()},t.prototype._updateSpecificButtonColor=function(){for(var e=0;e<this._specificPageButtons.length;e++){var t=this._specificPageButtons[e],r=e===this.gallery.currentPageIndex?this._selectedColor:this._deselectedColor;t.target&&!t.target.color.equals(r)&&(t.target.color=r.clone())}},i([d({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_specificPageButtonTemplate",void 0),i([d({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_prevPageButton",void 0),i([d({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_nextPageButton",void 0),i([d({visible:!0}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Color)?r:Object)],t.prototype,"_selectedColor",void 0),i([d({visible:!0}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object)],t.prototype,"_deselectedColor",void 0),i([u.default({type:s.default,scope:"parent"}),a("design:type","function"==typeof(c=void 0!==s.default&&s.default)?c:Object)],t.prototype,"gallery",void 0),i([f],t)}(cc.Component);r.default=y,cc._RF.pop()},{"../../../Util/Decorators/cache":"cache","../../../Util/EventHandlerUtils":"EventHandlerUtils","./Gallery":"Gallery"}],Gallery:[function(e,t,r){"use strict";cc._RF.push(t,"e70dc/8e8xPv6uvy+op5azQ","Gallery");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../../../Generic/Grid")),p=l(e("./GalleryFrame")),f=l(e("../../../Util/sortBy")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.executeInEditMode,_=cc.js.getClassName,m=Math.max,b=Math.round,v=Math.ceil,w=Math.sqrt,O=f.default({key:"order",sorter:f.default.descending});function S(e){var t=e.data.getComponent(p.default);if(!t)throw new Error(e.name+" is missing a "+_(p.default)+" component");return{canBeAssignedArbitraryStorageKey:t.canBeAssignedArbitraryStorageKey,canBeAssignedSpecificVariation:t.canBeAssignedSpecificVariation,validStorageKeys:t.validStorageKeys}}var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numFramesPerPage=9,t._maxCurrentLoadingFrames=1,t._framePrefabs=[],t._framesLayout=null,t._paginationLayout=null,t._featureTransformTarget=null,t._grid=null,t._managedFrameStates=[],t._currentPageIndex=0,t}return o(t,e),Object.defineProperty(t.prototype,"numFramesPerPage",{get:function(){return this._numFramesPerPage},set:function(e){this._numFramesPerPage=m(b(e),1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framesLayout",{get:function(){if(!this._framesLayout)throw new Error(this.node+": Frames Node needs to be set in editor");return this._framesLayout},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"featureTransformTarget",{get:function(){if(!this._featureTransformTarget)throw new Error('"featureTransformTarget" is not set in the editor.');return this._featureTransformTarget},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grid",{get:function(){if(!this._grid)throw new Error('"grid" is not set in the editor.');return this._grid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentPageIndex",{get:function(){return this._currentPageIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageIndex",{get:function(){return this._currentPageIndex+1>=this.numPages?0:this._currentPageIndex+1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prevPageIndex",{get:function(){return this._currentPageIndex-1<0?this.numPages-1:this._currentPageIndex-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numPages",{get:function(){var e=this._managedFrameStates.length;return v(e/this.numFramesPerPage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numFrames",{get:function(){return this._managedFrameStates.length},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.numFrames},t.prototype.gotoPage=function(e,t){var r="number"==typeof e?e:"string"==typeof t&&parseInt(t)||0;this._currentPageIndex=cc.misc.clampf(r,0,this.numPages-1),gm.loaded&&gm.storage.set({store:"ui",id:"gallery-page",value:this._currentPageIndex,memory:!0}),this._clearFrames(),this._buildFrames()},t.prototype.gotoPrevPage=function(){this.gotoPage(this.prevPageIndex)},t.prototype.gotoNextPage=function(){this.gotoPage(this.nextPageIndex)},t.prototype.closeCurrentlyFeaturedFrame=function(){var e=this.featureTransformTarget.getComponentInChildren(p.default);e&&e.toggleFeatured()},t.prototype.onEnable=function(){var e=this;this._managedFrameStates=this._initializeManagedFrameStates(),cc.isValid(this._paginationLayout)&&(this._paginationLayout.active=this.numPages>1),gm.loaded?gm.storage.get({store:"ui",id:"gallery-page",memory:!0}).then(function(t){e.gotoPage("number"==typeof t?t:0)}):this.gotoPage(0)},t.prototype.onDisable=function(){this._clearFrames()},t.prototype.update=function(){this._loadNextFrame()},t.prototype._initializeManagedFrameStates=function(){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");for(var e=[],t=gm.drawings.getAllStorageKeys(),r=function(){var r=t.shift();if(!r)return"break";var o=e.find(function(e){return!e.canBeAssignedArbitraryStorageKey&&e.validStorageKeys.includes(r)&&!e.assignedStorageKeys.includes(r)});if(o)o.assignedStorageKeys.push(r);else for(var a=n._getFramePrefab(r),c=S(a),s=gm.drawings._getVariationIds(r),l=c.canBeAssignedSpecificVariation?s.length:1,u=0;u<l;u++){var p=parseInt(s[u]);e.push(i({order:p,prefab:a,frame:null,assignedStorageKeys:[r],assignedVariation:u},c))}},n=this;t.length>0&&"break"!==r(););return e.sort(O),e},t.prototype._getFramePrefab=function(e){void 0===e&&(e="");var t=this._framePrefabs,r=t.map(S),n=r.findIndex(function(t){return e&&t.validStorageKeys.includes(e)});-1===n&&(n=r.findIndex(function(e){return e.canBeAssignedArbitraryStorageKey}));var o=t[n];if(!o)throw new Error('Could not find frame prefab for storageKey: "'+e+'"');return o},t.prototype._clearFrames=function(){var e,t;try{for(var r=s(this._managedFrameStates),n=r.next();!n.done;n=r.next()){var o=n.value;o.frame&&(o.frame.node.removeFromParent(),o.frame.node.destroy(),o.frame=null)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._buildFrames=function(){for(var e=this.currentPageIndex*this.numFramesPerPage,t=0;t<this.numFramesPerPage;t++){var r=this._managedFrameStates[t+e];if(!r){var n=this._getFramePrefab();r=i(i({prefab:n,assignedVariation:0,assignedStorageKeys:[]},S(n)),{frame:null,order:0})}r.frame=this._createFrame(r),r.frame.node.setParent(this.grid.node),r.frame.node.setSiblingIndex(t)}for(;this.grid.node.childrenCount>this.numFramesPerPage;){var o=this.grid.node.childrenCount-1,a=this.grid.node.children[o];a.removeFromParent(),a.destroy()}this.grid.numCells=b(w(this.numFramesPerPage)),this.grid.updateAlignment()},t.prototype._loadNextFrame=function(){var e,t,r=0;try{for(var n=s(this._managedFrameStates),o=n.next();!o.done;o=n.next()){var i=o.value.frame;if(i&&!i.isLoaded&&(i.isLoading||i.loadFrame(),++r>=this._maxCurrentLoadingFrames))break}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype._createFrame=function(e){var t=e.prefab,r=e.assignedStorageKeys,n=e.assignedVariation,o=e.canBeAssignedArbitraryStorageKey,i=e.canBeAssignedSpecificVariation,a=cc.instantiate(t),c=a.getComponent(p.default);if(!c)throw a.destroy(),new Error(t.name+" does not have a "+_(p.default)+" component");return i&&c.assignSpecificVariation(n),o?c.assignArbitraryStorageKey(r[0]):c.reduceStorageKeys(r),c.featureTransformTarget=this.featureTransformTarget,c},a([y(),c("design:type",Object)],t.prototype,"_numFramesPerPage",void 0),a([y({min:1,max:32,step:1,slide:!0}),c("design:type",Number),c("design:paramtypes",[Number])],t.prototype,"numFramesPerPage",null),a([y({min:1,max:10,step:1,visible:!0}),c("design:type",Object)],t.prototype,"_maxCurrentLoadingFrames",void 0),a([y({type:cc.Prefab,visible:!0,tooltip:""}),c("design:type",Array)],t.prototype,"_framePrefabs",void 0),a([y({type:cc.Node,visible:!0}),c("design:type",Object)],t.prototype,"_framesLayout",void 0),a([y({type:cc.Node,visible:!0}),c("design:type",Object)],t.prototype,"_paginationLayout",void 0),a([y({visible:!0,tooltip:"Node that frames move to when they're being featured",type:cc.Node}),c("design:type",Object)],t.prototype,"_featureTransformTarget",void 0),a([y({visible:!0,type:u.default}),c("design:type",Object)],t.prototype,"_grid",void 0),a([h,g],t)}(cc.Component);r.default=C,cc._RF.pop()},{"../../../Generic/Grid":"Grid","../../../Util/sortBy":"sortBy","./GalleryFrame":"GalleryFrame"}],GameComponent:[function(e,t,r){"use strict";cc._RF.push(t,"8b2003u5MdC+ae8xZ1M1lz7","GameComponent");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=cc._decorator.ccclass,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onGameLoad=function(){},t.prototype.onGameLoaded=function(){},t.prototype.onGameStart=function(){},t.prototype.onSceneStart=function(){},t.prototype.onScenePreload=function(){},t.prototype.onSceneEnd=function(){},t.prototype.__preload=function(){var e=this;gm.loaded?this.node&&this.onGameStart(gm):gm.untilLoaded.then(function(t){return e.node&&e.onGameStart(t)}).catch(cc.error)},i([a],t)}(cc.Component);r.default=c,cc._RF.pop()},{}],GameManager:[function(e,t,r){"use strict";cc._RF.push(t,"aebbawVUkdLO5MY8jGpaPF+","GameManager");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var d=f(e("./GameComponent")),h=f(e("./Storage")),y=f(e("./Statistics")),g=f(e("./Captioner")),_=f(e("../Drawing/DrawingStorage")),m=f(e("./Navigator")),b=f(e("./Springroll")),v=f(e("../Util/Decorators/cache")),w=f(e("../Util/Decorators/deferred")),O=f(e("../Util/getComponentInScene")),S=f(e("../Util/getComponentsInScene")),C=e("../Util/platformDetection"),P=(e("../Util/DevelopmentJson"),s(e("../Generic/CameraRig"))),T=cc._decorator,j=T.ccclass,R=T.property,x=T.executeInEditMode,A=T.disallowMultiple,D=cc.js.getClassName,E=new Promise(function(e){return cc.director.once(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,e)}).then(function(){return N.ensureInstance()}),I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:this||{};Object.defineProperty(I,"gm",{get:function(){return N.instance||{name:D(N),loaded:!1,untilLoaded:E.then(function(e){return e.untilLoaded})}},enumerable:!0,configurable:!1});var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._developmentJson=null,t._loaded=!1,t._isLowEndDevice=!1,t}var r,n,i,a,s,f,T,E,I;return o(t,e),r=t,Object.defineProperty(t.prototype,"developmentJson",{get:function(){throw new Error("development json not available in production.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return D(r)},enumerable:!1,configurable:!0}),t._getPrefab=function(){return u(this,void 0,Promise,function(){var e;return p(this,function(t){switch(t.label){case 0:return this._gameManagerPrefab?[3,2]:(e=this,[4,new Promise(function(e,t){return cc.resources.load("GameManager",cc.Prefab,function(r,n){return r?t(r):e(n)})})]);case 1:e._gameManagerPrefab=t.sent(),t.label=2;case 2:if(!this._gameManagerPrefab)throw new Error("Game Manager prefab could not be found.");return[2,this._gameManagerPrefab]}})})},t.ensureInstance=function(){var e=this._instance||O.default(r);return e?Promise.resolve(e):(this._ensuringInstance||(this._ensuringInstance=u(this,void 0,Promise,function(){var e,t,n,o;return p(this,function(i){switch(i.label){case 0:return[4,this._getPrefab()];case 1:if(e=i.sent(),t=cc.instantiate(e),n=cc.director.getScene(),t.setParent(n),!(o=t.getComponent(r)))throw new Error(D(r)+" component is missing from prefab");return[2,o]}})})),this._ensuringInstance)},Object.defineProperty(t,"instance",{get:function(){return this._instance||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLowEndDevice",{get:function(){return this._isLowEndDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return cc.director.isPaused()},set:function(e){e?(cc.game.pause(),cc.audioEngine.pauseAll()):(cc.game.resume(),cc.audioEngine.resumeAll())},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){return u(this,void 0,Promise,function(){return p(this,function(e){switch(e.label){case 0:return this._validateSingletonInstance()?(this._editorOnLoad(),this._ensurePersistentRootNode(),this._determineDeviceMode(),this._setupUiCamera(),[4,this._gameComponentsLifeCycle("onGameLoad")]):(this.node.destroy(),[2]);case 1:return e.sent(),this._loaded=!0,[4,this._gameComponentsLifeCycle("onGameLoaded")];case 2:return e.sent(),w.default.resolve(this,"untilLoaded",this),[2]}})})},t.prototype.onDestroy=function(){this._editorOnDestroy()},t.prototype.onBuildPreProcess=function(e){return!e&&null!==this._developmentJson&&(this._developmentJson=null,!0)},t.prototype._validateSingletonInstance=function(){var e=S.default(r);if(this!==(cc.isValid(r._instance)?r._instance:e[0])){var t="Only one instance of the "+D(r)+" should ever exist.";return w.default.reject(this,"untilLoaded",t),!1}return r._instance!==this&&(r._instance=this),!0},t.prototype._ensurePersistentRootNode=function(){var e=cc.director.getScene();this.node.parent instanceof cc.Scene||this.node.setParent(e),cc.game.isPersistRootNode(this.node)||cc.game.addPersistRootNode(this.node)},t.prototype._determineDeviceMode=function(){this._isLowEndDevice=C.isLowEndDevice(),this._isLowEndDevice&&cc.view.enableRetina(!1),cc.log(this._isLowEndDevice?"\ud83d\udcc9":"\ud83d\udcc8","initialized as a",this._isLowEndDevice?"low end":"standard","device")},t.prototype._setupUiCamera=function(){(this.uiCamera.getComponent(P.default)||this.uiCamera.addComponent(P.default)).applyPreset(P.CameraPresetType.UI)},t.prototype._editorOnLoad=function(){},t.prototype._editorOnDestroy=function(){},t.prototype._gameComponentsLifeCycle=function(e){return u(this,void 0,Promise,function(){var t=this;return p(this,function(r){switch(r.label){case 0:return[4,Promise.all(S.default(d.default).map(function(r){return r[e](t)}))];case 1:return r.sent(),[2]}})})},c([R({visible:!0,type:cc.JsonAsset}),l("design:type",Object)],t.prototype,"_developmentJson",void 0),c([v.default({type:y.default,scope:"children"}),l("design:type","function"==typeof(n=void 0!==y.default&&y.default)?n:Object)],t.prototype,"statistics",void 0),c([v.default({type:h.default,scope:"children"}),l("design:type","function"==typeof(i=void 0!==h.default&&h.default)?i:Object)],t.prototype,"storage",void 0),c([v.default({type:g.default,scope:["scene","children"]}),l("design:type","function"==typeof(a=void 0!==g.default&&g.default)?a:Object)],t.prototype,"captions",void 0),c([v.default({type:_.default,scope:"children"}),l("design:type","function"==typeof(s=void 0!==_.default&&_.default)?s:Object)],t.prototype,"drawings",void 0),c([v.default({type:m.default,scope:"children"}),l("design:type","function"==typeof(f=void 0!==m.default&&m.default)?f:Object)],t.prototype,"navigator",void 0),c([v.default({type:b.default,scope:"children"}),l("design:type","function"==typeof(T=void 0!==b.default&&b.default)?T:Object)],t.prototype,"springroll",void 0),c([v.default({type:cc.Camera,scope:"children"}),l("design:type","function"==typeof(E="undefined"!=typeof cc&&cc.Camera)?E:Object)],t.prototype,"uiCamera",void 0),c([w.default,l("design:type","function"==typeof(I="undefined"!=typeof Promise&&Promise)?I:Object)],t.prototype,"untilLoaded",void 0),r=c([j,x,A],t)}(cc.Component);r.default=N,cc._RF.pop()},{"../Drawing/DrawingStorage":"DrawingStorage","../Generic/CameraRig":"CameraRig","../Util/Decorators/cache":"cache","../Util/Decorators/deferred":"deferred","../Util/DevelopmentJson":"DevelopmentJson","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","../Util/platformDetection":"platformDetection","./Captioner":"Captioner","./GameComponent":"GameComponent","./Navigator":"Navigator","./Springroll":"Springroll","./Statistics":"Statistics","./Storage":"Storage"}],GrabTool:[function(e,t,r){"use strict";cc._RF.push(t,"0b60aRklupLHL24QwonSw6G","GrabTool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./DrawingTool"),l=c(e("../Drawing/Drawing")),u=c(e("./Grabbable")),p=c(e("./Transformable")),f=c(e("../Util/getComponentsInScene")),d=c(e("./TransformableWidget")),h=cc._decorator,y=h.ccclass,g=h.menu,_=1e3,m=1e3;function b(e,t){var r=t.world.points;return cc.Intersection.pointInPolygon(e,r)}function v(e,t){var r=t.world;return cc.Intersection.circleCircle({position:e,radius:1},r)}function w(e,t){var r=e.node.getSiblingIndex(),n=cc.director.getCollisionManager().enabled&&e.getComponent(cc.Collider);return n&&(r+=(n instanceof cc.PolygonCollider||n instanceof cc.BoxCollider)&&b(t,n)||n instanceof cc.CircleCollider&&v(t,n)?_:0),e instanceof d.default&&(r+=m),r}var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._selected=null,t._grabbed=null,t._touchStartWorld=null,t}return o(t,e),Object.defineProperty(t.prototype,"isGrabbing",{get:function(){return!!this._grabbed},enumerable:!1,configurable:!0}),t.prototype.touchStart=function(e){var t=e.world;this._deselectGrabbable();var r=this._findGrabbableAtWorld(t);r&&(this._selectGrabbable(r),this._grabbed=r,this._grabbed.grab(this,t),this._touchStartWorld=t,this._bringGrabbableToFront())},t.prototype.touchMove=function(e){var t=e.world;this._grabbed&&(this._moveGrabbedPositionFromTouch(t),this._grabbed.move(t))},t.prototype.touchEnd=function(e){var t=e.world;this._grabbed&&this._moveGrabbedPositionFromTouch(t),this._resetGrabState()},t.prototype.touchCancel=function(){if(this._grabbed){var e=this._grabbed.node.parent.convertToNodeSpaceAR(this._grabbed.grabPosition);this._grabbed.node.setPosition(e),this._resetGrabState()}},t.prototype._selectGrabbable=function(e){this._selected=e,e.selected=!0},t.prototype._deselectGrabbable=function(){this._selected&&(this._selected.selected=!1),this._selected=null},t.prototype._bringGrabbableToFront=function(){this._selected&&this._selected.node.getComponent(p.default)&&this._selected.node.setSiblingIndex(-1)},t.prototype._resetGrabState=function(){this._grabbed&&this._grabbed.release(),this._grabbed=null,this._touchStartWorld=null},t.prototype._findGrabbableAtWorld=function(e,t){return void 0===t&&(t=f.default(u.default)),a(t.filter(function(t){if(!t.enabledInHierarchy)return!1;var r=t.getComponent(l.default);return r?r.textureCells.some(function(t){return t.node.getBoundingBoxToWorld().contains(e)}):t.node.getBoundingBoxToWorld().contains(e)}).sort(function(t,r){return w(r,e)-w(t,e)}),1)[0]||null},t.prototype._moveGrabbedPositionFromTouch=function(e){if(this.isGrabbing){var t=this._touchStartWorld,r=this._grabbed,n=e.clone().subtract(t),o=r.grabPosition.add(n),i=r.node.parent.convertToNodeSpaceAR(o);r.node.position=cc.v3(i)}},i([y,g("Drawing Component/Grab Tool")],t)}(s.TouchTool);r.default=O,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../Util/getComponentsInScene":"getComponentsInScene","./DrawingTool":"DrawingTool","./Grabbable":"Grabbable","./Transformable":"Transformable","./TransformableWidget":"TransformableWidget"}],Grabbable:[function(e,t,r){"use strict";cc._RF.push(t,"eeee1WfebFKZYOyoSTscoWm","Grabbable");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(r,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,l=c.menu,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectionPrefab=null,t._selectionPrefabInstance=null,t._selected=!1,t._grabbedBy=null,t._touchGrabPosition=cc.Vec2.ZERO,t._touchCurrentPosition=cc.Vec2.ZERO,t._grabPosition=cc.Vec2.ZERO,t._startTimeStamp=Date.now(),t}return o(t,e),t.isGrabbable=function(e){var t=e.getComponent(this);return!!t&&t.enabledInHierarchy},t.ensureIsGrabbable=function(e){return e.getComponent(this)||e.addComponent(this)},t.ensureNotGrabbable=function(e){var t=e.getComponent(this);t&&(t.enabled=!1,t.destroy())},Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(e){var t=this._selected;this._selected=e,this._updateSelected(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grabbedBy",{get:function(){return this._grabbedBy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grabbed",{get:function(){return!!this._grabbedBy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchGrabPosition",{get:function(){if(!this.grabbed)throw new Error("Not currently being grabbed.");return this._touchGrabPosition.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchCurrentPosition",{get:function(){if(!this.grabbed)throw new Error("Not currently being grabbed.");return this._touchCurrentPosition.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grabPosition",{get:function(){if(!this.grabbed)throw new Error("Not currently being grabbed.");return this._grabPosition.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTimeStamp",{get:function(){return this._startTimeStamp},enumerable:!1,configurable:!0}),t.prototype.grab=function(e,t){this._grabbedBy=e,this._grabPosition=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),this._touchGrabPosition=t,this._touchCurrentPosition=t.clone(),this.onGrab(e)},t.prototype.move=function(e){this._touchCurrentPosition=e},t.prototype.release=function(){this.onGrabRelease(),this._grabbedBy=null,this._touchGrabPosition=cc.Vec2.ZERO,this._touchCurrentPosition=cc.Vec2.ZERO},t.prototype.start=function(){this._startTimeStamp=Date.now()},t.prototype.onSelect=function(){},t.prototype.onDeselect=function(){},t.prototype.onGrab=function(){},t.prototype.onGrabRelease=function(){},t.prototype._updateSelected=function(e){if(this._selected&&!e){if(this.selectionPrefab&&!cc.isValid(this._selectionPrefabInstance)){var t=cc.instantiate(this.selectionPrefab);this._selectionPrefabInstance=t,t.parent=this.node}this.onSelect()}else!this._selected&&e&&(cc.isValid(this._selectionPrefabInstance)&&(this._selectionPrefabInstance.active=!1,this._selectionPrefabInstance.removeFromParent(),this._selectionPrefabInstance.destroy(),this._selectionPrefabInstance=null),this.onDeselect())},i([u({type:cc.Prefab}),a("design:type",Object)],t.prototype,"selectionPrefab",void 0),i([s,l("Drawing Component/Grabbable")],t)}(cc.Component);r.default=p,cc._RF.pop()},{}],Grid:[function(e,t,r){"use strict";cc._RF.push(t,"86582KBZ79HXLKA7Oc7nn5+","Grid");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.GridCoord=void 0;var u,p=cc._decorator,f=p.ccclass,d=p.menu,h=p.property,y=p.executeInEditMode,g=Math.floor,_=Math.max,m=Math.round,b=cc.Widget.AlignMode,v=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=c(1===e.length?[e[0].x,e[0].y]:e,2),n=r[0],o=r[1];this.x=g(n),this.y=g(o)}return e.prototype.clone=function(){return new e(this)},e.prototype.toString=function(){return this.x+","+this.y},e.prototype.toJSON=function(){return{x:this.x,y:this.y}},e}();r.GridCoord=v,function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(u||(u={}));var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alignMode=b.ON_WINDOW_RESIZE,t.gridFitStrategy=u.Horizontal,t._numCells=3,t._paddingX=0,t._gutterY=0,t.updateAlignment=function(){var e,r,n=t.node,o=t._mapChildrenToGridCoords(),i=t._getMaxGridCoord.apply(t,s(o.values())),a=cc.size(n.width/(i.x+1),n.height/(i.y+1));try{for(var u=l(o),p=u.next();!p.done;p=u.next()){var f=c(p.value,2),d=f[0],h=f[1];d.width=a.width-(i.x>0?t.gutterX:0),d.height=a.height-(i.y>0?t.gutterY:0);var y=a.width*h.x+d.width*d.anchorX-n.width*n.anchorX+t.gutterX*(h.x/i.x||0),g=n.height-(a.height*h.y+d.height*(1-d.anchorY)+n.height*n.anchorY+t.gutterY*(h.y/i.y||0));d.width/=d.scaleX,d.height/=d.scaleY,d.setPosition(y,g)}}catch(_){e={error:_}}finally{try{p&&!p.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}},t}return o(t,e),Object.defineProperty(t.prototype,"numCells",{get:function(){return this._numCells},set:function(e){this._numCells=_(m(e),1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gutterX",{get:function(){return this._paddingX},set:function(e){this._paddingX=_(m(e),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gutterY",{get:function(){return this._gutterY},set:function(e){this._gutterY=_(m(e),0)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.alignMode===b.ON_WINDOW_RESIZE&&(window.addEventListener("resize",this.updateAlignment),window.addEventListener("orientationchange",this.updateAlignment))},t.prototype.start=function(){this.alignMode!==b.ONCE&&this.alignMode!==b.ON_WINDOW_RESIZE||this.updateAlignment()},t.prototype.update=function(){this.alignMode===b.ALWAYS&&this.updateAlignment()},t.prototype.onDestroy=function(){this.alignMode===b.ON_WINDOW_RESIZE&&(window.removeEventListener("resize",this.updateAlignment),window.removeEventListener("orientationchange",this.updateAlignment))},t.prototype._mapChildrenToGridCoords=function(){var e,t,r=new Map,n=c(this.gridFitStrategy===u.Horizontal?["x","y"]:["y","x"],2),o=n[0],i=n[1],a=new v(0,0);try{for(var s=l(this.node.children),p=s.next();!p.done;p=s.next()){var f=p.value;r.set(f,a.clone()),a[o]+1<this.numCells?a[o]++:(a[o]=0,a[i]++)}}catch(d){e={error:d}}finally{try{p&&!p.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return r},t.prototype._getMaxGridCoord=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce(function(e,t){return e.x=_(e.x,t.x),e.y=_(e.y,t.y),e},new v(0,0))},i([h({type:b}),a("design:type",Object)],t.prototype,"alignMode",void 0),i([h({type:cc.Enum(u)}),a("design:type",Object)],t.prototype,"gridFitStrategy",void 0),i([h(),a("design:type",Object)],t.prototype,"_numCells",void 0),i([h({min:1,step:1,tooltip:"Number of cells to place before creating another row or column according to the gridFitStrategy."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"numCells",null),i([h(),a("design:type",Object)],t.prototype,"_paddingX",void 0),i([h({min:0,step:1,tooltip:"Number of cells to place before creating another row or column according to the gridFitStrategy."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"gutterX",null),i([h(),a("design:type",Object)],t.prototype,"_gutterY",void 0),i([h({min:0,step:1,tooltip:"Number of cells to place before creating another row or column according to the gridFitStrategy."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"gutterY",null),i([f,y,d("Generic Component/Grid")],t)}(cc.Component);r.default=w,cc._RF.pop()},{}],Hider:[function(e,t,r){"use strict";cc._RF.push(t,"33b14p+fqpPvr8atoLFQoob","Hider");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./Transform")),f=u(e("../Util/Decorators/cache")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.executeInEditMode,_=d.menu,m=cc.js.getClassName,b=1/Math.pow(2,10);function v(){var e=this.getComponent(p.default);return!!e&&e.enabled}var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._hiddenNode=null,t._shownNode=null,t}return o(t,e),Object.defineProperty(t.prototype,"hiddenNode",{get:function(){return this._hiddenNode},set:function(e){this._hiddenNode=e,this._applyTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shownNode",{get:function(){return this._shownNode},set:function(e){this._shownNode=e,this._applyTransform()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return!this.enabled},set:function(e){this.enabled=!e},enumerable:!1,configurable:!0}),t.prototype.setHidden=function(e,t){var r=e instanceof cc.Event.EventTouch?"true"===t||"hidden"===t:e;this.hidden=r},t.prototype.toggleHidden=function(){return this.hidden=!this.hidden,this.hidden},t.prototype.onEnable=function(){this._setChildUIInteractable(!0),this._applyTransform()||this._applyFallbackTween()},t.prototype.onDisable=function(){this._setChildUIInteractable(!1),this._applyTransform()||this._applyFallbackTween()},t.prototype._setChildUIInteractable=function(e){var t,r,n=s(this.getComponents(cc.Component),this.getComponentsInChildren(cc.Component)).filter(function(e){return"boolean"==typeof e.interactable});try{for(var o=l(n),i=o.next();!i.done;i=o.next())i.value.interactable=e}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype._applyTransform=function(){var e=this.getComponent(p.default);if(!(e&&e.enabled&&this.hiddenNode&&this.shownNode))return!1;var t=this.hidden?this.hiddenNode:this.shownNode;return e.transformStrategy=p.default.Strategy.Node,e.target=t,!0},t.prototype._applyFallbackTween=function(){var e=this.hidden?b:1;cc.tween(this.node).to(.4,{scale:e},{easing:"quadInOut"}).start()},t.ALMOST_ZERO_SCALE=b,t.FALLBACK_TWEEN_DURATION=.4,i([y({type:cc.Node,visible:v,tooltip:"Using the attached "+m(p.default)+" component, specify a node to represent this UI's hidden transformation.",formerlySerializedAs:"hiddenNode"}),a("design:type",Object)],t.prototype,"_hiddenNode",void 0),i([y({type:cc.Node,visible:v,tooltip:"Using the attached "+m(p.default)+" component, specify a node to represent this UI's shown transformation.",formerlySerializedAs:"shownNode"}),a("design:type",Object)],t.prototype,"_shownNode",void 0),i([f.default({type:p.default,required:!1}),a("design:type",Object)],t.prototype,"transform",void 0),i([h,g,_("Generic Component/Hider")],t)}(cc.Component);r.default=w,cc._RF.pop()},{"../Util/Decorators/cache":"cache","./Transform":"Transform"}],InstancePool:[function(e,t,r){"use strict";cc._RF.push(t,"235c4ueUZ9HC5Zaw43rgkEa","InstancePool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../Util/NodeUtils")),f=cc._decorator,d=f.ccclass,h=f.property,y=cc.js.getClassName,g=Math.max,_=Math.round;function m(e,t){return"object"==typeof e&&null!==e&&"function"==typeof e[t]}var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prefabs=[],t._maxInstances=32,t._pools=new Map,t}return o(t,e),Object.defineProperty(t.prototype,"prefabs",{get:function(){return this._prefabs.filter(function(e){return e})},set:function(e){this._prefabs=s(e),this._sanitizePrefabs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxInstances",{get:function(){return this._maxInstances},set:function(e){this._maxInstances=g(_(e),0)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._sanitizePrefabs()},t.prototype.getPrefab=function(e){var t=this.prefabs.find(function(t){return t.name===e||t===e});if(!t)throw new Error("string"==typeof e?'Prefab named "'+e+'" could not be found.':"Prefab "+e.name+" is not in the list of prefabs for this "+y(this));return t},t.prototype.use=function(e){var t,r=this.getPrefab(e),n=this._ensureNodePool(r);return n.size()>0?(t=n.get(),this._poolableLifecycleMethod(t,r,"onUse")):t=this.create(r),t},t.prototype.create=function(e){var t=this.getPrefab(e),r=cc.instantiate(t);return r.name=t.name,r},t.prototype.release=function(e){var t=this.getPrefab(e.name),r=this._ensureNodePool(t);r.size()>=this._maxInstances?(e.active=!1,e.removeFromParent(),e.destroy()):(this._poolableLifecycleMethod(e,t,"onRelease"),this._resetInstanceToPrefabState(e,p.default.getNodeState(t.data||t,!0)),r.put(e))},t.prototype.getNumPooledInstances=function(e){var t=this.getPrefab(e),r=this._pools.get(t);return r?r.size():0},t.prototype._poolableLifecycleMethod=function(e,t,r){var n,o,i=e.getComponentsInChildren(cc.Component);try{for(var a=l(i),c=a.next();!c.done;c=a.next()){var s=c.value;m(s,r)&&s[r](this,t)}}catch(u){n={error:u}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}},t.prototype._ensureNodePool=function(e){var t=this._pools.get(e);return t||(t=new cc.NodePool,this._pools.set(e,t)),t},t.prototype._sanitizePrefabs=function(){var e,t,r=[],n=function(e){if(!e)return"continue";if(r.find(function(t){return e.name===t.name}))throw new Error("Prefabs must have unique names.");r.push(e)};try{for(var o=l(this._prefabs),i=o.next();!i.done;i=o.next())n(i.value)}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this._prefabs=r},t.prototype._resetInstanceToPrefabState=function(e,t){var r=this;e.x=t.x,e.y=t.y,e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.angle=t.angle,e.width=t.width,e.height=t.height,e.opacity=t.opacity,e.color=t.color.clone(),e.active=t.active,e.name=t.name,e.parent=t.parent,t.children.forEach(function(t,n){t.parent=e,r._resetInstanceToPrefabState(e.children[n],t)})},i([h({type:cc.Prefab,visible:!0}),a("design:type",Array)],t.prototype,"_prefabs",void 0),i([h({min:0,step:1,visible:!0}),a("design:type",Object)],t.prototype,"_maxInstances",void 0),i([d],t)}(cc.Component);r.default=b,cc._RF.pop()},{"../Util/NodeUtils":"NodeUtils"}],IntervalTrigger:[function(e,t,r){"use strict";cc._RF.push(t,"8ea6eUADihNvpcvtOHHd4LJ","IntervalTrigger");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=cc._decorator,u=l.ccclass,p=l.property,f=l.executeInEditMode,d=l.menu,h=.125,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._interval=h,t._checkDelta=0,t._sceneStarted=!1,t}return o(t,e),Object.defineProperty(t.prototype,"interval",{get:function(){return this._interval},set:function(e){this._interval=Math.max(e,0)},enumerable:!1,configurable:!0}),t.prototype.onSceneStart=function(){this._sceneStarted=!0},t.prototype.update=function(e){this._sceneStarted&&(this._checkDelta+=e,this._checkDelta<this.interval||(this._checkDelta=0,this.isExecuting||this.tryExecute()))},i([p(),a("design:type",Object)],t.prototype,"_interval",void 0),i([p({tooltip:"Frequencey by which trigger conditions will be checked."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"interval",null),i([u,f,d("Trigger Component/Interval Trigger")],t)}(s.default);r.default=y,cc._RF.pop()},{"./Trigger":"Trigger"}],KaleidoscopeDrawing:[function(e,t,r){"use strict";cc._RF.push(t,"82f1fVUsk1Beb/WVeqME2nH","KaleidoscopeDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./Drawing")),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,g=f.disallowMultiple,_=15,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numInstances=_,t._mirror=!1,t._centerPoint=null,t}return o(t,e),t.prototype.addSplats=function(t){var r,n;if(!this.enabledInHierarchy)throw new Error("Cannot add splats to a disabled drawing");var o=[];null===this._centerPoint&&(this._centerPoint=cc.Camera.main.node);for(var i=this._numInstances+1,a=this._mirror&&1===this._numInstances,s=this._centerPoint.convertToWorldSpaceAR(cc.Vec2.ZERO),u=2*Math.PI/i,p=1;p<i;p++)try{for(var f=(r=void 0,c(t)),d=f.next();!d.done;d=f.next()){var h=d.value,y=cc.instantiate(h);a?this._mirrorSplat(y,s):this._rotateSplat(y,u*p,s),o.push(y)}}catch(g){r={error:g}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}e.prototype.addSplats.call(this,l(t,o))},t.prototype._rotateSplat=function(e,t,r){var n=cc.v2(e.position).sub(r).rotate(t).addSelf(r);e.setPosition(n),e.angle+=cc.misc.radiansToDegrees(t)},t.prototype._mirrorSplat=function(e,t){var r=e.position.sub(cc.v3(t)),n=cc.v2(-r.x,r.y).addSelf(t);e.setPosition(n)},i([h({formerlySerializedAs:"numPetals",tooltip:"Number of additional strokes to create.",visible:!0,displayName:"Added Strokes",min:1,step:1}),a("design:type",Number)],t.prototype,"_numInstances",void 0),i([h({visible:function(){return 1===this._numInstances},tooltip:"Instead of being rotated around the center point, the splats can be mirrored across the center point, if there is only 1 additional stroke."}),a("design:type",Object)],t.prototype,"_mirror",void 0),i([h({type:cc.Node,visible:!0}),a("design:type",Object)],t.prototype,"_centerPoint",void 0),i([d,g,y("Drawing Component/KaleidoscopeDrawing")],t)}(p.default);r.default=m,cc._RF.pop()},{"./Drawing":"Drawing"}],KusamaParticle:[function(e,t,r){"use strict";cc._RF.push(t,"2a2e9uloaZNS5VohpZfeNgZ","KusamaParticle");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./Particle")),p=l(e("../Util/RandomUtil")),f=l(e("../Util/NodeUtils")),d=cc._decorator,h=d.ccclass,y=d.property,g=Math.max,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._splatPrefab=null,t._growDuration=.125,t._spawnChance=20,t._spawnCount=5,t._spawnCountRange=2,t._spawnDistanceStep=1.5,t._spawnVelocityDrift=.1,t._spawnScaleTarget=.2,t}return o(t,e),t.prototype.onEmit=function(){return this.velocity.len()>0&&p.default.float()<=this._spawnChance/100?this._spawn():this._grow(!0)},t.prototype._spawn=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c,l,u,d;return s(this,function(s){switch(s.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return[4,this._grow(!1)];case 1:s.sent(),e=cc.misc.degreesToRadians(p.default.item([-90,90])),t=this.velocity.rotate(e).normalize(),r=this.node.position.clone(),n=this.velocity.mul(this._spawnVelocityDrift),o=p.default.integer(-this._spawnCountRange,this._spawnCountRange),i=g(this._spawnCount+o,0),a=0,s.label=2;case 2:return a<i?(c=(a+1)/i,l=gm.drawings.useParticle(this.node.name),f.default.applyNodeState(l.node,this.node),l.scale=cc.misc.lerp(l.scale,l.scale*this._spawnScaleTarget,c),u=l.width*l.scale*this._spawnDistanceStep*.5,d=t.mul(u).add(n),r.x+=d.x,r.y+=d.y,l.position=r,l._spawnChance=0,[4,this.drawing.addParticle(l)]):[3,5];case 3:if(s.sent(),!cc.isValid(this.node)||!cc.isValid(this.node.parent))return[2];s.label=4;case 4:return a++,[3,2];case 5:return this.release(),[2]}})})},t.prototype._grow=function(e){var t=this;if(!this._splatPrefab)throw new Error("Splat prefab not defined.");var r=this.createSplatAndMatchToNode(this._splatPrefab),n=r.scaleX,o=r.scaleY;r.setParent(this.node.parent),r.position=this.node.position.clone(),r.scale=0;var i=this.drawing;return new Promise(function(a){return cc.tween(r).to(t._growDuration,{scaleX:n,scaleY:o}).call(function(){cc.isValid(i)&&i.addSplats([r]),e&&cc.isValid(t.node)&&t.release()}).call(a).start()})},i([y({visible:!0,type:cc.Prefab}),a("design:type",Object)],t.prototype,"_splatPrefab",void 0),i([y({visible:!0,min:.05,max:1,slide:!0,tooltip:"Time it takes for the particle to reach it's maximum size."}),a("design:type",Object)],t.prototype,"_growDuration",void 0),i([y({visible:!0,min:0,max:100,slide:!0,tooltip:"% chance of placed particle spawning additional particles."}),a("design:type",Object)],t.prototype,"_spawnChance",void 0),i([y({visible:!0,tooltip:"Number of spawn particles to create.",min:1,max:10,step:1}),a("design:type",Object)],t.prototype,"_spawnCount",void 0),i([y({visible:!0,tooltip:'Amount by which the "Spawn Count" can vary.',min:0,max:10,step:1}),a("design:type",Object)],t.prototype,"_spawnCountRange",void 0),i([y({visible:!0,min:.5,max:2,slide:!0,tooltip:"Distance in radiis that spawned particles will be placed."}),a("design:type",Object)],t.prototype,"_spawnDistanceStep",void 0),i([y({visible:!0,min:0,max:1,slide:!0,tooltip:"Degree by which the spawned particles will inherit the stroke velocity."}),a("design:type",Object)],t.prototype,"_spawnVelocityDrift",void 0),i([y({visible:!0,min:0,max:1,slide:!0,tooltip:"Degree by which the final spawned particle will be scaled."}),a("design:type",Object)],t.prototype,"_spawnScaleTarget",void 0),i([h],t)}(u.default);r.default=_,cc._RF.pop()},{"../Util/NodeUtils":"NodeUtils","../Util/RandomUtil":"RandomUtil","./Particle":"Particle"}],MusicCell:[function(e,t,r){"use strict";cc._RF.push(t,"2d234UPVvZOEIwmRCKNa+bP","MusicCell");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=cc._decorator.ccclass,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"noiseClipName",{get:function(){return this.node.name},set:function(e){this.node.name=e},enumerable:!1,configurable:!0}),t.prototype.onBuildPreProcess=function(){var e=this.getComponent(cc.Sprite);return!!e&&(e.enabled=!1,e.destroy(),!0)},i([a],t)}(cc.Component);r.default=c,cc._RF.pop()},{}],MusicGrid:[function(e,t,r){"use strict";cc._RF.push(t,"d63efF7CahDXaT0T/dKlL5h","MusicGrid");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},f=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var h=d(e("../../../DrawingUI/DrawingUIHandler")),y=d(e("../../../Generic/AudioPlayer")),g=d(e("../../../DrawingTools/DrawingToolCursor")),_=d(e("../../../Generic/Grid")),m=d(e("./MusicKey")),b=d(e("./MusicCell")),v=d(e("../../../Util/RandomUtil")),w=d(e("../../../Util/Decorators/cache")),O=d(e("../../../Util/sortBy")),S=d(e("../../../DrawingTools/EraserTool")),C=d(e("../../../Drawing/Drawing")),P=d(e("../../../Drawing/DrawingStorageMeta")),T=cc._decorator,j=T.ccclass,R=T.property,x=T.executeInEditMode,A=cc.js.getClassName,D=O.default.ascending,E=O.default.descending,I=O.default({key:"row",sorter:E},{key:"column",sorter:D});function N(e,t){var r=t.exec(e);return r&&(r[1]||r[0])}function U(e){return e instanceof S.default}var M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.time=2,t.beatsPerMinute=100,t.volume=1,t._musicCellPrefab=null,t._musicKeyPrefab=null,t._beatClipName="",t._beatClipVolume=1,t._cursor=null,t._drawing=null,t._currentTime=0,t._musicKeys=[],t._lastCellAddedByStroke=null,t._lastCellAddedByCursor=null,t._keysAddedByCursor=[],t._beatClipId=NaN,t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"musicCellPrefab",{get:function(){if(!this._musicCellPrefab)throw new Error('"Music Cell Prefab" not defined in editor');return this._musicCellPrefab},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"musicKeyPrefab",{get:function(){if(!this._musicKeyPrefab)throw new Error('"Music Key Prefab" not defined in editor');return this._musicKeyPrefab},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beatClipName",{get:function(){if(!this._beatClipName)throw new Error('"beatTrackName" is not set in the editor.');return this._beatClipName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_meta",{get:function(){var e,t=null===(e=this._drawing)||void 0===e?void 0:e.getComponent(P.default);if(!cc.isValid(t))throw new Error("drawing meta is not valid");return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this.grid.node.getComponentsInChildren(b.default)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"musicKeys",{get:function(){return this._musicKeys.filter(function(e){return cc.isValid(e)})},enumerable:!1,configurable:!0}),t.prototype.start=function(){return s(this,void 0,Promise,function(){return l(this,function(e){switch(e.label){case 0:return[4,this._ensureCellsAndGrid()];case 1:return e.sent(),[2]}})})},t.prototype.update=function(e){if(this._addMusicKeysWithCursor(),this.beatIsPlaying&&0!==this.musicKeys.length){var t=this._currentTime,r=t+e;this._playMusic(t,r),r>this.time&&(r=0),this._currentTime=r}},t.prototype.setVolume=function(e,t){var r="number"==typeof e?e:"string"==typeof t?parseFloat(t):1;this.volume=cc.misc.clamp01(r),this.beatIsPlaying&&cc.audioEngine.setVolume(this._beatClipId,this.volume*this._beatClipVolume)},t.prototype.addMusicKey=function(e,t,r){var n=this._getCellAtWorld(e);if(!n)return null;var o=cc.instantiate(this.musicKeyPrefab).getComponent(m.default);if(!o)throw new Error(this.musicKeyPrefab.name+" does not have a "+A(m.default)+" component");if(o.name="Music Key @"+n.name,o.node.setParent(n.node),o.node.setPosition(n.node.convertToNodeSpaceAR(e)),"number"==typeof r)o.time=r;else{var i=this.beatsPerMinute/60,a=this.time*i,c=Math.ceil(this._currentTime*a)/a;o.time=c}o.node.color=t.clone();var s=o.visualizeNode,l=s.parent.convertToNodeSpaceAR(n.node.convertToWorldSpaceAR(cc.Vec2.ZERO));return s.setPosition(l),s.width=n.node.width,s.height=n.node.height,s.color=t.clone(),s.getComponent(cc.Animation),this._musicKeys.push(o),this.enabledInHierarchy&&!this.beatIsPlaying&&this.playBeat(),o.getComponent(m.default)},t.prototype.removeAllMusicKeys=function(){var e,t;try{for(var r=u(this._musicKeys),n=r.next();!n.done;n=r.next()){var o=n.value;cc.isValid(o.node)&&o.node.destroy()}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.playRandomMusicCell=function(){var e=v.default.item(this.grid.node.children);this.audio.playClip(e.name,0,this.volume)},t.prototype.playBeat=function(){this.beatIsPlaying||(this._beatClipId=this.audio.playClip(this.beatClipName,0,this.volume*this._beatClipVolume,!0))},t.prototype.stopBeat=function(){this.beatIsPlaying&&(this.audio.stopClip(this._beatClipId),this._beatClipId=NaN,this._currentTime=0)},Object.defineProperty(t.prototype,"beatIsPlaying",{get:function(){return this.audio.clipIsPlaying(this._beatClipId)},enumerable:!1,configurable:!0}),t.prototype.storeContentSize=function(){return s(this,void 0,Promise,function(){var e,t,r,n;return l(this,function(o){switch(o.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return e=this._meta,t=this.node,r=t.width,n=t.height,[4,gm.storage.set({store:"sl-story-data",id:"content-size-"+e.id,value:{width:r,height:n}})];case 1:return o.sent(),[2]}})})},t.prototype.loadContentSize=function(){return s(this,void 0,Promise,function(){var e,t,r;return l(this,function(n){switch(n.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return e=this._meta,[4,gm.storage.get({store:"sl-story-data",id:"content-size-"+e.id})];case 1:return t=n.sent(),(r=this.getComponent(cc.Widget))&&(r.enabled=!1),t&&(this.node.width=t.width,this.node.height=t.height),[2]}})})},t.prototype.storeMusicKeys=function(){return s(this,void 0,Promise,function(){var e,t,r=this;return l(this,function(n){switch(n.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return e=this._meta,t=this._musicKeys.map(function(e){var t=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),n=r.node.convertToNodeSpaceAR(t);return{time:e.time,color:e.node.color.toRGBValue(),local:{x:n.x,y:n.y}}}),[4,gm.storage.set({store:"sl-story-data",id:"music-keys-"+e.id,value:t})];case 1:return n.sent(),[2]}})})},t.prototype.loadMusicKeys=function(){return s(this,void 0,Promise,function(){var e,t,r,n,o,i,a,c,s,p,f,d;return l(this,function(l){switch(l.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return e=this._meta,[4,gm.storage.get({store:"sl-story-data",id:"music-keys-"+e.id})];case 1:if(!(t=l.sent()))return[2];try{for(r=u(t),n=r.next();!n.done;n=r.next())o=n.value,i=o.color,a=o.local,c=o.time,s=new cc.Color(i),p=this.node.convertToWorldSpaceAR(cc.v2(a)),this.addMusicKey(p,s,c)}catch(h){f={error:h}}finally{try{n&&!n.done&&(d=r.return)&&d.call(r)}finally{if(f)throw f.error}}return[2]}})})},t.prototype.onTouchStart=function(e,t){if(!U(t)){var r=this._getCellAtWorld(e);r&&this._lastCellAddedByStroke!==r&&(this._lastCellAddedByStroke=r,this.addMusicKey(e,this.drawingUI.color.clone()),this._removeKeysAddedByCursor())}},t.prototype.onTouchMove=function(e,t){if(U(t))return this._removeMusicKeysInRange(e,t);var r=this._getCellAtWorld(e);r&&this._lastCellAddedByStroke!==r&&(this._lastCellAddedByStroke=r,this.addMusicKey(e,this.drawingUI.color.clone()))},t.prototype.onTouchEnd=function(){this._lastCellAddedByStroke=null},t.prototype._getCellAtWorld=function(e){return this.cells.find(function(t){return t.node.getBoundingBoxToWorld().contains(e)})||null},t.prototype._removeMusicKeysInRange=function(e,t){for(var r=.5*cc.misc.lerp(t.sizeMin,t.sizeMax,t.sizeFactor),n=this._musicKeys.length-1;n>=0;n--){var o=this._musicKeys[n],i=o.node.convertToWorldSpaceAR(cc.Vec2.ZERO);e.clone().subtract(i).len()<=r&&(o.node.destroy(),this._musicKeys.splice(n,1))}},t.prototype._removeKeysAddedByCursor=function(){var e,t;try{for(var r=u(this._keysAddedByCursor),n=r.next();!n.done;n=r.next()){var o=n.value;cc.isValid(o.node)&&o.node.destroy();var i=this._musicKeys.indexOf(o);i>-1&&this._musicKeys.splice(i,1)}}catch(a){e={error:a}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this._keysAddedByCursor.length=0},t.prototype._ensureCellsAndGrid=function(){return s(this,void 0,Promise,function(){var e,t;return l(this,function(r){switch(r.label){case 0:return[4,gm.untilLoaded];case 1:r.sent(),r.label=2;case 2:return e=Object.keys(this.audio.clips),t=this._getCellData(e),this._ensureCells(t),this.grid.numCells=t.reduce(function(e,t){return Math.max(t.column,e)},0),this.grid.updateAlignment(),[2]}})})},t.prototype._ensureCells=function(e){for(;this.cells.length<e.length;){var t=cc.instantiate(this.musicCellPrefab).getComponent(b.default);if(!t)throw new Error(A(b.default)+" component does not exist on "+this.musicCellPrefab.name+" prefab");t.node.setParent(this.grid.node)}for(;this.cells.length>e.length;)(n=this.cells[this.cells.length-1])&&(n.node.removeFromParent(),n.node.destroy());for(var r=0;r<this.cells.length;r++){var n=this.cells[r],o=e[r];n.node.name=o.name;var i=p(n.node.children,1)[0];i&&(i.opacity=r%2==0?15:30)}return f(this.cells)},t.prototype._getCellData=function(e){return e.map(function(e){return{row:N(e,/_?([A-z])\d\d$/),column:N(e,/(\d\d)$/),name:e}}).filter(function(e){return null!==e.row&&null!==e.column}).map(function(e){return i(i({},e),{row:e.row,column:parseInt(e.column)})}).sort(I)},t.prototype._addMusicKeysWithCursor=function(){var e=this._cursor;if(e&&e.tool&&e.touching){var t=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),r=e.tool.colors.length>0?v.default.item(e.tool.colors):cc.Color.BLACK,n=this._getCellAtWorld(t);if(n&&this._lastCellAddedByCursor!==n){var o=this.addMusicKey(t,r);this._keysAddedByCursor.push(o),this._lastCellAddedByCursor=n}}else e&&e.tool&&!e.touching&&(this._lastCellAddedByCursor=null)},t.prototype._playMusic=function(e,t){var r,n,o=this.musicKeys.filter(function(r){return r.time>=e&&r.time<t});try{for(var i=u(o),a=i.next();!a.done;a=i.next()){var c=a.value,s=c.node.parent.name;this.audio.playClip(s,0,this.volume);var l=c.getComponentInChildren(cc.Animation);l&&l.play()}}catch(p){r={error:p}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},a([R({tooltip:"Number of seconds before music keys repeat."}),c("design:type",Object)],t.prototype,"time",void 0),a([R({step:1,min:1}),c("design:type",Object)],t.prototype,"beatsPerMinute",void 0),a([R({}),c("design:type",Object)],t.prototype,"volume",void 0),a([R({type:cc.Prefab,visible:!0,formerlySerializedAs:"_noiseCellPrefab"}),c("design:type",Object)],t.prototype,"_musicCellPrefab",void 0),a([R({type:cc.Prefab,visible:!0,formerlySerializedAs:"_musicPointPrefab"}),c("design:type",Object)],t.prototype,"_musicKeyPrefab",void 0),a([R({visible:!0}),c("design:type",Object)],t.prototype,"_beatClipName",void 0),a([R({visible:!0,type:cc.Float,min:0,max:1,slide:!0}),c("design:type",Object)],t.prototype,"_beatClipVolume",void 0),a([R({type:g.default,tooltip:"Music Keys can also be emitted by a cursor.",visible:!0}),c("design:type",Object)],t.prototype,"_cursor",void 0),a([R({type:C.default,tooltip:"As a reference for saving/loading music keys and content size.",visible:!0}),c("design:type",Object)],t.prototype,"_drawing",void 0),a([w.default({type:_.default,scope:"children"}),c("design:type","function"==typeof(r=void 0!==_.default&&_.default)?r:Object)],t.prototype,"grid",void 0),a([w.default(y.default),c("design:type","function"==typeof(n=void 0!==y.default&&y.default)?n:Object)],t.prototype,"audio",void 0),a([j,x],t)}(h.default);r.default=M,cc._RF.pop()},{"../../../Drawing/Drawing":"Drawing","../../../Drawing/DrawingStorageMeta":"DrawingStorageMeta","../../../DrawingTools/DrawingToolCursor":"DrawingToolCursor","../../../DrawingTools/EraserTool":"EraserTool","../../../DrawingUI/DrawingUIHandler":"DrawingUIHandler","../../../Generic/AudioPlayer":"AudioPlayer","../../../Generic/Grid":"Grid","../../../Util/Decorators/cache":"cache","../../../Util/RandomUtil":"RandomUtil","../../../Util/sortBy":"sortBy","./MusicCell":"MusicCell","./MusicKey":"MusicKey"}],MusicKey:[function(e,t,r){"use strict";cc._RF.push(t,"1a73dwwoD5C5qdCkAm1d6GV","MusicKey");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a};Object.defineProperty(r,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,u=s.property,p=cc.js.getClassName,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.time=0,t}return o(t,e),Object.defineProperty(t.prototype,"visualizeNode",{get:function(){var e=c(this.node.children,1)[0];if(!e)throw new Error('No "Visualize Node" on '+p(this)+" "+this.node.name);return e},enumerable:!1,configurable:!0}),t.prototype.update=function(){cc.isValid(this.visualizeNode)&&(this.visualizeNode.width=this.node.parent.width,this.visualizeNode.height=this.node.parent.height)},i([u({visible:!1}),a("design:type",Object)],t.prototype,"time",void 0),i([l],t)}(cc.Component);r.default=f,cc._RF.pop()},{}],Navigator:[function(e,t,r){"use strict";cc._RF.push(t,"ec488WSQKRHh43UfpcCUo4Z","Navigator");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./GameComponent")),p=l(e("../Util/getComponentsInScene")),f=l(e("../Util/milliseconds")),d=cc._decorator,h=d.ccclass,y=d.disallowMultiple,g={maxConcurrency:8,maxRequestsPerFrame:8,priority:0},_={maxConcurrency:2,maxRequestsPerFrame:1,priority:-1},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._nextScene=null,t._nextSceneName="",t}return o(t,e),Object.defineProperty(t.prototype,"loadingScene",{get:function(){return this._nextSceneName.replace(/-low$/,"")},enumerable:!1,configurable:!0}),t.prototype.onGameStart=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this._gameComponentsSceneLifeCycle("onScenePreload")];case 1:return e.sent(),[4,this._gameComponentsSceneLifeCycle("onSceneStart")];case 2:return e.sent(),cc.game.setLoadingScreenVisible(!1),[2]}})})},t.prototype.preloadScene=function(e,t){return c(this,void 0,Promise,function(){var r,n;return s(this,function(o){switch(o.label){case 0:if(!gm.loaded)throw new Error("Cannot load scene before "+gm.name+" is loaded");return r=this._getSceneName(e,t),this._nextSceneName=r,this._nextScene=null,n=this,[4,new Promise(function(e,t){return cc.assetManager.main.loadScene(r,gm.isLowEndDevice?g:_,function(r,n){return r?t(i({},r)):e(n)})})];case 1:if(n._nextScene=o.sent(),!this._nextScene)throw this._nextSceneName="",new Error(r+" could not be loaded.");return[4,this._gameComponentsSceneLifeCycle("onScenePreload",this._nextScene.scene.getComponentsInChildren(u.default),this._nextScene.scene)];case 2:return o.sent(),[2,this._nextScene]}})})},t.prototype.loadScene=function(e,t){return c(this,void 0,Promise,function(){var r,n,o,a=this;return s(this,function(c){switch(c.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return r=this._getSceneName(e,t),n=gm.paused,this._nextSceneName===r&&this._nextScene?(o=this._nextScene,[3,3]):[3,1];case 1:return cc.game.setLoadingScreenVisible(!0),gm.paused=!0,[4,this.preloadScene(r)];case 2:o=c.sent(),c.label=3;case 3:return[4,this._gameComponentsSceneLifeCycle("onSceneEnd")];case 4:return c.sent(),[4,new Promise(function(e,t){gm.paused=n,cc.director.runScene(o,void 0,function(r){a._nextScene=null,a._nextSceneName="",r?t(i({},r)):a._gameComponentsSceneLifeCycle("onSceneStart").then(e).catch(t)})})];case 5:return c.sent(),[4,f.default(0)];case 6:return c.sent(),cc.game.setLoadingScreenVisible(!1),[2]}})})},t.prototype._getSceneName=function(e,t){var r="string"==typeof e?e:t||"";if(!r)throw new Error("Name of scene required.");return gm.loaded&&gm.isLowEndDevice&&!r.endsWith("-low")&&cc.assetManager.main.getSceneInfo(r+"-low")&&(r+="-low"),r},t.prototype._gameComponentsSceneLifeCycle=function(e,t,r){return void 0===t&&(t=p.default(u.default)),void 0===r&&(r=cc.director.getScene()),c(this,void 0,Promise,function(){var n;return s(this,function(o){switch(o.label){case 0:if(!gm.loaded)return cc.warn("Could not execute lifecycle method: "+e+" on scene: "+r.name),[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all(t.map(function(t){return t[e](r,gm)}))];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),cc.error("Lifecycle method: "+e+" failed to execute on scene: "+r.name),cc.error(n),[3,4];case 4:return[2]}})})},a([h,y],t)}(u.default);r.default=m,cc._RF.pop()},{"../Util/getComponentsInScene":"getComponentsInScene","../Util/milliseconds":"milliseconds","./GameComponent":"GameComponent"}],NodeUtils:[function(e,t,r){"use strict";cc._RF.push(t,"73b24VbROROgaR3pD+T7An6","NodeUtils");var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function o(e,t,r){var i,a;e.group===t&&(e.group=r);try{for(var c=n(e.children),s=c.next();!s.done;s=c.next())o(s.value,t,r)}catch(l){i={error:l}}finally{try{s&&!s.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}}function i(e,t){var r,o;e.group=t;try{for(var a=n(e.children),c=a.next();!c.done;c=a.next())i(c.value,t)}catch(s){r={error:s}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}}function a(e){for(var t="",r=1,n=e.parent.children.filter(function(t){return t!==e});n.some(function(r){return r.name===e.name+t});)t=" ("+r+++")";e.name=e.name+t}function c(e,t){void 0===t&&(t=!1);var r=e.x,n=e.y,o=e.width,i=e.height,a=e.opacity,s=e.angle,l=e.color,u=e.scaleX,p=e.scaleY,f=e.parent,d=e.active,h=e.name,y=e.uuid;return{x:r,y:n,width:o,height:i,opacity:a,angle:s,color:l,scaleX:u,scaleY:p,parent:f,active:d,children:e.children.filter(function(e){return"function"==typeof t?t(e):t}).map(function(e){return c(e,t)}),uuid:y,name:h}}function s(e,t){e.x=t.x,e.y=t.y,e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.angle=t.angle,e.width=t.width,e.height=t.height,e.opacity=t.opacity,e.color=t.color.clone(),e.parent=t.parent,e.active=t.active,e.name=t.name,t.children.forEach(function(t){var r=e.children.find(function(e){return e.uuid===t.uuid});r&&s(r,t)})}function l(e){var t=new cc.Node;return s(t,e),a(t),t}function u(e,t){for(var r=e;r!==t;)if(!(r=r.parent))return!1;return!0}function p(e){var t=[];do{t.push(e.name),e=e.parent}while(e&&e.parent);return t.reverse()}function f(e,t){var r,o;if(void 0===t&&(t=cc.director.getScene()),e instanceof cc.Node)return u(e,t)?e:null;try{for(var i=n(t.children),a=i.next();!a.done;a=i.next()){var c=a.value;if(c.name===e||c.uuid===e)return c;var s=f(e,c);if(s)return s}}catch(l){r={error:l}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return null}Object.defineProperty(r,"__esModule",{value:!0}),r.resolveNode=r.pathOfNode=r.isDescendentOf=r.createNodeWithState=r.applyNodeState=r.getNodeState=r.ensureUniqueSiblingName=r.setGroup=r.changeGroup=void 0,r.changeGroup=o,r.setGroup=i,r.ensureUniqueSiblingName=a,r.getNodeState=c,r.applyNodeState=s,r.createNodeWithState=l,r.isDescendentOf=u,r.pathOfNode=p,r.resolveNode=f,r.default={changeGroup:o,setGroup:i,getNodeState:c,applyNodeState:s,createNodeWithState:l,isDescendentOf:u,resolveNode:f,pathOfNode:p,ensureUniqueSiblingName:a},cc._RF.pop()},{}],Particle:[function(e,t,r){"use strict";cc._RF.push(t,"10f0dewN9lMErV07Oly1NIl","Particle");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ParticleOrder=void 0;var s,l=c(e("./Drawing")),u=c(e("../Util/NodeUtils")),p=c(e("../Util/getComponentInParents")),f=cc._decorator,d=f.ccclass,h=f.property,y=f.disallowMultiple,g=cc.js.getClassName;(function(e){e[e.UnderSplats=0]="UnderSplats",e[e.OverSplats=1]="OverSplats"})(s||(s={})),r.ParticleOrder=s;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._order=s.OverSplats,t._doSerialize=!1,t._drawing=null,t.velocity=cc.Vec2.ZERO,t}var r;return o(t,e),Object.defineProperty(t.prototype,"order",{get:function(){return this._order},set:function(e){this._order=e,this.node.setParent(e===s.UnderSplats?this.drawing.particlesUnderNode:this.drawing.particlesOverNode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serialize",{get:function(){return this._doSerialize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawing",{get:function(){if(!this._drawing)throw new Error(g(this)+" has not been emitted yet.");return this._drawing},enumerable:!1,configurable:!0}),t.prototype.emit=function(){var e=p.default(this.node,l.default);if(!e||this.node.parent!==e.particlesUnderNode&&this.node.parent!==e.particlesOverNode)throw new Error(g(this)+" must be emitted after being parented to a "+g(l.default)+" particle node.");return this._drawing=e,this.onEmit()},t.prototype.release=function(){if(!gm.loaded)throw new Error(gm.name+" is not loaded");gm.loaded&&gm.drawings.releaseParticle(this)},t.prototype.onEmit=function(){},t.prototype.onRelease=function(){},t.prototype.onUse=function(){},t.prototype.getParticleState=function(){return{velocity:{x:this.velocity.x,y:this.velocity.y},order:this.order,serialize:this.serialize}},t.prototype.applyParticleState=function(e){this.velocity=cc.v2(e.velocity.x,e.velocity.y),this.order=e.order},t.prototype.createSplatAndMatchToNode=function(e,t){if(void 0===t&&(t=this.node),!gm.loaded)throw new Error(gm.name+" is not loaded");var r=gm.drawings.useSplat(e);return u.default.applyNodeState(r,t),r.name=e.name,r},Object.defineProperty(t.prototype,"position",{get:function(){return this.node.position},set:function(e){this.node.position=e.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.node.color},set:function(e){this.node.color=e.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.node.angle},set:function(e){this.node.angle=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this.node.opacity},set:function(e){this.node.opacity=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.node.scale},set:function(e){this.node.scale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.node.width},set:function(e){this.node.width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.node.height},set:function(e){this.node.height=e},enumerable:!1,configurable:!0}),i([h({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_order",void 0),i([h({tooltip:"This particle will be saved when the drawing is.",visible:!0,displayName:"Serialize"}),a("design:type",Object)],t.prototype,"_doSerialize",void 0),i([h({visible:!1}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Vec2)?r:Object)],t.prototype,"velocity",void 0),i([d,y],t)}(cc.Component);r.default=_,cc._RF.pop()},{"../Util/NodeUtils":"NodeUtils","../Util/getComponentInParents":"getComponentInParents","./Drawing":"Drawing"}],PersistOnCanvas:[function(e,t,r){"use strict";cc._RF.push(t,"cda3ciC+EZFUqPZMykMyJ4A","PersistOnCanvas");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},c=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../Framework/GameComponent")),p=l(e("../Util/getComponentInParents")),f=cc._decorator,d=f.ccclass,h=f.menu,y=f.disallowMultiple,g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onSceneStart=function(){this.enabledInHierarchy&&(this._setPersistentRoot(!1),this._ensureParentedToCanvas(),this._updateUiComponents())},t.prototype.onSceneEnd=function(){this.enabledInHierarchy&&(this._ensureParentedToRoot(),this._setPersistentRoot(!0))},t.prototype._ensureParentedToCanvas=function(){p.default(this.node,cc.Canvas)||this.node.setParent(cc.Canvas.instance.node)},t.prototype._ensureParentedToRoot=function(){var e=cc.director.getScene();this.node.setParent(e)},t.prototype._setPersistentRoot=function(e){var t=this.node,r=cc.game.isPersistRootNode(t);e&&!r?cc.game.addPersistRootNode(t):!e&&r&&cc.game.removePersistRootNode(t)},t.prototype._updateUiComponents=function(){var e,t,r,n;try{for(var o=s(c([this.getComponent(cc.Widget)],this.getComponentsInChildren(cc.Widget))),i=o.next();!i.done;i=o.next()){var a=i.value;a&&a.updateAlignment()}}catch(f){e={error:f}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}try{for(var l=s(c([this.getComponent(cc.Layout)],this.getComponentsInChildren(cc.Layout))),u=l.next();!u.done;u=l.next()){var p=u.value;p&&p.updateLayout()}}catch(d){r={error:d}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}},i([d,y,h("Generic Component/Persist On Canvas")],t)}(u.default);r.default=g,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Util/getComponentInParents":"getComponentInParents"}],PetController:[function(e,t,r){"use strict";cc._RF.push(t,"3269dy35NtNRb+vjqYc8sht","PetController");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../../../Actor/CharacterController")),p=l(e("../../../GenericUI/CreateUI")),f=l(e("../../../Generic/Snapper")),d=l(e("../../../Drawing/Drawing")),h=l(e("../../../Util/Decorators/cache")),y=l(e("../../../Util/getComponentsInScene")),g=l(e("../../../Util/getComponentInScene")),_=l(e("../../../DrawingUI/DrawingUI")),m=l(e("../../../Util/RandomUtil")),b=l(e("../../../Drawing/DrawingStorageMeta")),v=l(e("../../../DrawingTools/Transformable")),w=l(e("./PetFoodEater")),O=cc._decorator,S=O.ccclass,C=O.property,P=p.default.prototype.tweenInstanceToTarget,T=cc.js.getClassName,j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._junkAndDrawingParent=null,t._junkPrefabs=[],t._junkTintDuration=.5,t._junk=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"junkAndDrawingParent",{get:function(){if(!this._junkAndDrawingParent)throw new Error('"junkAndDrawingParent" is not set in the editor.');return this._junkAndDrawingParent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"junk",{get:function(){return this._junk},enumerable:!1,configurable:!0}),t.prototype.clearJunk=function(){cc.isValid(this._junk)&&(this._junk.destroy(),this._junk=null)},t.prototype.applyJunk=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this.clearJunk(),this._junk=e,e.removeComponent(v.default),e.removeComponent(cc.Collider),e.parent?[4,P(e,this.junkAndDrawingParent,!0,!1)]:[3,2];case 1:return t.sent(),[3,3];case 2:e.setParent(this.junkAndDrawingParent),e.setPosition(cc.Vec2.ZERO),t.label=3;case 3:return this._junk.setSiblingIndex(0),[2]}})})},t.prototype.tintJunkToDrawingColor=function(e){var t=this._resolveDrawing(e);return this._tintJunkToColor(t.getDominantColor())},t.prototype.tintJunkToEatenColor=function(){var e=g.default(w.default),t=e?e.drawingPreEatenColor:cc.Color.WHITE;this._tintJunkToColor(t)},t.prototype.tintJunkToRandomColor=function(){var e=g.default(_.default);if(!e)throw new Error("Could not find "+_.default+" in scene to get a list of colors from.");var t=m.default.item(e.colors);return this._tintJunkToColor(t)},t.prototype.storeJunk=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i,a;return s(this,function(c){switch(c.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");return this.junk?this.meta?(e=this.junk,t=e.color,r=e.name,n=e.scale,o=e.angle,i=this.meta.id,a=t.toRGBValue(),[4,gm.storage.set({store:"pe-story-data",id:i,value:{rgb:a,scale:n,angle:o,prefabName:r}})]):[2]:[2,cc.warn("No junk on "+T(this)+" to store.")];case 1:return c.sent(),[2]}})})},t.prototype.applyStoredJunk=function(){return c(this,void 0,Promise,function(){var e,t,r,n;return s(this,function(o){switch(o.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");return this.meta?(e=this.meta.id,[4,gm.storage.get({store:"pe-story-data",id:e})]):[2];case 1:if(!(t=o.sent()))return[2];if(!(r=this._junkPrefabs.find(function(e){return e.name===t.prefabName})))throw new Error("No Junk prefab named "+t.prefabName);return(n=cc.instantiate(r)).color=new cc.Color(t.rgb),n.scale=t.scale,n.angle=t.angle,this.applyJunk(n),[2]}})})},t.prototype._resolveDrawing=function(e){var t=e instanceof d.default?e:y.default(d.default).find(function(t){return t.node.name===e})||null;if(!t)throw new Error(T(d.default)+" must be supplied.");return t},t.prototype._tintJunkToColor=function(e){var t=this,r=this.junk;return r?new Promise(function(n){return cc.tween(r).to(t._junkTintDuration,{color:e}).call(n).start()}):Promise.resolve()},i([h.default({type:f.default,scope:"children"}),a("design:type","function"==typeof(r=void 0!==f.default&&f.default)?r:Object)],t.prototype,"snapper",void 0),i([C({visible:!0,type:cc.Node,tooltip:"The node that Junk and "+T(d.default)+" nodes should be parented to."}),a("design:type",Object)],t.prototype,"_junkAndDrawingParent",void 0),i([C({tooltip:"Prefabs that junk can be made out of. Should match the options in the JunkUI. This is neccessary for deserialization.",type:cc.Prefab,visible:!0}),a("design:type",Array)],t.prototype,"_junkPrefabs",void 0),i([C({visible:!0,min:2,slide:!0}),a("design:type",Object)],t.prototype,"_junkTintDuration",void 0),i([h.default({type:b.default,scope:"children",required:!1}),a("design:type",Object)],t.prototype,"meta",void 0),i([S],t)}(u.default);r.default=j,cc._RF.pop()},{"../../../Actor/CharacterController":"CharacterController","../../../Drawing/Drawing":"Drawing","../../../Drawing/DrawingStorageMeta":"DrawingStorageMeta","../../../DrawingTools/Transformable":"Transformable","../../../DrawingUI/DrawingUI":"DrawingUI","../../../Generic/Snapper":"Snapper","../../../GenericUI/CreateUI":"CreateUI","../../../Util/Decorators/cache":"cache","../../../Util/RandomUtil":"RandomUtil","../../../Util/getComponentInScene":"getComponentInScene","../../../Util/getComponentsInScene":"getComponentsInScene","./PetFoodEater":"PetFoodEater"}],PetFoodEater:[function(e,t,r){"use strict";cc._RF.push(t,"154a4FJ9JhLj6uCgxvyjVJR","PetFoodEater");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../../../Drawing/Drawing")),l=c(e("../../../Util/RandomUtil")),u=c(e("../../../Util/Decorators/cache")),p=c(e("../../../Drawing/DrawingStorageMeta")),f=cc._decorator,d=f.ccclass,h=f.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._biteSplatPrefab=null,t._bitesPerSecond=2,t._biteAngularVariance=12,t._biteScale=1,t._biteScaleVariance=.1,t._maxEatTime=5,t._fadeOutTimeAfterMaxTimeReached=1.5,t._timeTilNextBite=0,t._timeTaken=0,t._maxTimeReached=!1,t._drawingPreEatenColor=cc.Color.WHITE,t}var r;return o(t,e),Object.defineProperty(t.prototype,"drawingPreEatenColor",{get:function(){return this._drawingPreEatenColor.clone()},enumerable:!1,configurable:!0}),t.prototype.isDrawingEaten=function(){return 0===this.drawing.numTextureCells},t.prototype.onEnable=function(){this._timeTilNextBite=1/this._bitesPerSecond,this.isDrawingEaten()||(this._drawingPreEatenColor=this.drawing.getDominantColor())},t.prototype.onDisable=function(){this._removedCachePetFoodDrawing()},t.prototype.update=function(e){this._timeTaken+=e,this._timeTaken>this._maxEatTime&&!this._maxTimeReached&&(this._maxTimeReached=!0,this._fadeOutAndClearDrawing()),this._timeTilNextBite-=e,this._timeTilNextBite>0||(this._bite(),this.isDrawingEaten()?this.enabled=!1:this._timeTilNextBite+=1/this._bitesPerSecond)},t.prototype.getActorComponentState=function(){return{enabled:this.enabled,timeTilNextBite:this._timeTilNextBite,timeTaken:this._timeTaken,maxTimeReached:this._maxTimeReached}},t.prototype.applyActorComponentState=function(e){this.enabled=e.enabled,this._timeTilNextBite=e.timeTilNextBite,this._timeTaken=e.timeTilNextBite,this._maxTimeReached=e.maxTimeReached},t.prototype._bite=function(){if(!gm.loaded)throw new Error(gm.name+" is not yet loaded.");var e=this.drawing,t=this._biteAngularVariance,r=this._biteScaleVariance,n=this._biteSplatPrefab;if(!n)throw new Error("No bite splat prefab.");var o=this._getRandomSplat();if(o){var i=cc.v2(o.position),a=this.drawing.node.convertToWorldSpaceAR(i),c=l.default.float(this._biteScale-r,this._biteScale+r),s=l.default.float(-t,t),u=gm.drawings.useSplat(n);u.position=cc.v3(a),u.angle=s,u.scale=c,e.addSplats([u])}},t.prototype._getRandomSplat=function(){var e=cc.Color.WHITE.toRGBValue(),t=this.drawing.splatData.filter(function(t){return t.color!==e});return t.length>0?l.default.item(t):null},t.prototype._fadeOutAndClearDrawing=function(){var e=this,t=this.drawing;return new Promise(function(r){return cc.tween(t.node).to(e._fadeOutTimeAfterMaxTimeReached,{opacity:0}).call(function(){cc.isValid(t)&&(t.clear(),t.node.opacity=255)}).call(r).start()})},t.prototype._removedCachePetFoodDrawing=function(){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");var e=this.drawing.getComponent(p.default);return e?gm.drawings._deleteCachedDrawing(e.id):cc.warn(this.node.name,"drawing could not be removed from cache.")},i([h({visible:!0,type:cc.Prefab}),a("design:type",Object)],t.prototype,"_biteSplatPrefab",void 0),i([h({tooltip:"Bites per second",min:.25,max:20,step:.25,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_bitesPerSecond",void 0),i([h({min:0,max:360,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_biteAngularVariance",void 0),i([h({min:0,max:5,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_biteScale",void 0),i([h({min:0,max:1,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_biteScaleVariance",void 0),i([h({min:1,max:10,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_maxEatTime",void 0),i([h({min:0,max:5,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_fadeOutTimeAfterMaxTimeReached",void 0),i([u.default(s.default),a("design:type","function"==typeof(r=void 0!==s.default&&s.default)?r:Object)],t.prototype,"drawing",void 0),i([d],t)}(cc.Component);r.default=y,cc._RF.pop()},{"../../../Drawing/Drawing":"Drawing","../../../Drawing/DrawingStorageMeta":"DrawingStorageMeta","../../../Util/Decorators/cache":"cache","../../../Util/RandomUtil":"RandomUtil"}],PrefabEmitter:[function(e,t,r){"use strict";cc._RF.push(t,"b9216ajl0BHoaQSEpk6OrK0","PrefabEmitter");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../Util/RandomUtil")),l=c(e("./PrefabInstancer")),u=cc._decorator,p=u.property,f=u.ccclass,d=u.menu,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.secondsMin=0,t.secondsMax=10,t._disableOnMaxInstances=!1,t._createInstanceOnStart=!1,t._timeBuffer=0,t}return o(t,e),t.prototype.start=function(){this._resetTimeBuffer()},t.prototype.update=function(e){this._timeBuffer-=e,this._timeBuffer>0||(this._resetTimeBuffer(),this.instances.length<this.maxInstances&&this.createInstance(),this.instances.length>=this.maxInstances&&this._disableOnMaxInstances&&(this.enabled=!1))},t.prototype._resetTimeBuffer=function(){this._timeBuffer=s.default.float(this.secondsMin,this.secondsMax)},i([p({min:0}),a("design:type",Object)],t.prototype,"secondsMin",void 0),i([p({min:0}),a("design:type",Object)],t.prototype,"secondsMax",void 0),i([p({visible:function(){return this.maxInstances>0}}),a("design:type",Object)],t.prototype,"_disableOnMaxInstances",void 0),i([p({override:!0,visible:!1}),a("design:type",Object)],t.prototype,"_createInstanceOnStart",void 0),i([f,d("Generic Component/Prefab Emitter")],t)}(l.default);r.default=h,cc._RF.pop()},{"../Util/RandomUtil":"RandomUtil","./PrefabInstancer":"PrefabInstancer"}],PrefabInstancer:[function(e,t,r){"use strict";cc._RF.push(t,"0b5e4fEmxBPxLsUBziGOpEb","PrefabInstancer");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../Util/RandomUtil")),f=cc._decorator,d=f.ccclass,h=f.disallowMultiple,y=f.property,g=f.menu,_=function(e){return cc.isValid(e)},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.prefabs=[],t.angleMin=0,t.angleMax=0,t.scaleMin=1,t.scaleMax=1,t._maxInstances=0,t._createInstanceOnStart=!1,t._instances=[],t}return o(t,e),Object.defineProperty(t.prototype,"maxInstances",{get:function(){return this._maxInstances>0?this._maxInstances:1/0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instances",{get:function(){return this._instances.filter(_)},enumerable:!1,configurable:!0}),t.prototype.start=function(){this._createInstanceOnStart&&this.createInstance()},t.prototype.onDestroy=function(){var e,t;try{for(var r=c(this._instances),n=r.next();!n.done;n=r.next()){var o=n.value;cc.isValid(o)&&o.destroy()}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this._instances.length=0},t.prototype.createInstance=function(){var e=this._pickPrefab();if(this.instances.length>=this.maxInstances)throw new Error("Max instance limit reached: "+this.maxInstances);var t=cc.instantiate(e);this._applyInstanceTransform(t),this._instances=l(this.instances,[t])},t.prototype._pickPrefab=function(){if(this.prefabs.length<1)throw new Error("No prefabs configured to instance.");return p.default.item(this.prefabs)},t.prototype._applyInstanceTransform=function(e){e.setParent(this.node.parent),e.setSiblingIndex(this.node.getSiblingIndex());var t=p.default.float(this.angleMin,this.angleMax);e.angle+=t;var r=p.default.float(this.scaleMin,this.scaleMax);e.scaleX*=r,e.scaleY*=r;var n=this._getRandomPositionOnNode();e.setPosition(n)},t.prototype._getRandomPositionOnNode=function(){var e=this.node.getContentSize(),t=e.width,r=void 0===t?0:t,n=e.height,o=void 0===n?0:n,i=cc.v2(p.default.float(r*-this.node.anchorX,r*(1-this.node.anchorX)),p.default.float(o*-this.node.anchorY,o*(1-this.node.anchorY))),a=this.node.convertToWorldSpaceAR(i);return this.node.parent.convertToNodeSpaceAR(a)},i([y({type:[cc.Prefab]}),a("design:type",Array)],t.prototype,"prefabs",void 0),i([y({formerlySerializedAs:"rotationMin"}),a("design:type",Object)],t.prototype,"angleMin",void 0),i([y({formerlySerializedAs:"rotationMax"}),a("design:type",Object)],t.prototype,"angleMax",void 0),i([y(),a("design:type",Object)],t.prototype,"scaleMin",void 0),i([y(),a("design:type",Object)],t.prototype,"scaleMax",void 0),i([y({tooltip:"0 is no limit.",min:0,step:1,visible:!0}),a("design:type",Object)],t.prototype,"_maxInstances",void 0),i([y({visible:!0,tooltip:"This component is generally intended to be used programatically, but as a convenience, an instance can be created on start"}),a("design:type",Object)],t.prototype,"_createInstanceOnStart",void 0),i([d,h,g("Generic Component/Prefab Instancer")],t)}(cc.Component);r.default=m,cc._RF.pop()},{"../Util/RandomUtil":"RandomUtil"}],PrefabTiler:[function(e,t,r){"use strict";cc._RF.push(t,"3ec5dpOjlRKXZs5qxZ/axVu","PrefabTiler");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l,u=s(e("../Util/RandomUtil")),p=s(e("./PrefabInstancer")),f=e("./SizeToScreen"),d=cc._decorator,h=d.ccclass,y=d.property,g=d.executeInEditMode,_=d.menu;(function(e){e[e.Linear=0]="Linear",e[e.Random=1]="Random"})(l||(l={}));var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._offsetMin=cc.Vec2.ZERO,t._offsetMax=cc.Vec2.ZERO,t._placementInterpolation=l.Random,t._placementDensity=1,t.applyMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,t._createInstanceOnStart=!1,t.updatedTiledInstances=function(){for(var e,r,n=t._getMaxPrefabDiameter(),o=t.node,i=o.width>o.height?"width":"height",a=Math.min(Math.round(o[i]/n*t._placementDensity),t.maxInstances);o.children.length<a;)t.createInstance();for(;o.children.length>a;){var s=o.children.length-1,l=o.children[s];l.removeFromParent(),l.destroy()}try{for(var u=c(o.children),p=u.next();!p.done;p=u.next()){var f=p.value;t._applyInstanceTransform(f)}}catch(d){e={error:d}}finally{try{p&&!p.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}},t}var r,n;return o(t,e),t.prototype.start=function(){this.updatedTiledInstances()},t.prototype.update=function(){this.applyMode===cc.Widget.AlignMode.ALWAYS&&this.updatedTiledInstances()},t.prototype.onEnable=function(){this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE&&f.onResize(this.updatedTiledInstances)},t.prototype.onDisable=function(){f.offResize(this.updatedTiledInstances)},t.prototype._pickPrefab=function(){if(this.prefabs.length<1)throw new Error("No prefabs configured to instance.");if(this._placementInterpolation===l.Random)return u.default.item(this.prefabs);var e=this.node.childrenCount%this.prefabs.length;return this.prefabs[e]},t.prototype._applyInstanceTransform=function(e){var t=e.parent!==this.node;t&&e.setParent(this.node);var r=e.getSiblingIndex()/(this.node.children.length-1),n=this._placementInterpolation===l.Random;n&&t?(e.angle=u.default.float(this.angleMin,this.angleMin),e.scale=u.default.float(this.scaleMin,this.scaleMax)):n||(e.angle=cc.misc.lerp(this.angleMin,this.angleMin,r),e.scale=cc.misc.lerp(this.scaleMin,this.scaleMax,r));var o=this._getFactoredPosition(r),i=n?cc.v2(u.default.float(this._offsetMin.x,this._offsetMin.x),u.default.float(this._offsetMin.y,this._offsetMax.y)):this._offsetMin.lerp(this._offsetMin,r);e.position=cc.v3(i).add(o)},t.prototype._getFactoredPosition=function(e){var t=this.node,r=Math.max(t.width,t.height),n=.5*this._getMaxPrefabDiameter(),o=t.width>t.height?"anchorX":"anchorY",i=t.width>t.height?"x":"y",a=n+this.node[o]*-r,c=a-n+(r-n),s=cc.Vec3.ZERO;return s[i]=cc.misc.lerp(a,c,e),s},t.prototype._getMaxPrefabDiameter=function(){return this.prefabs.reduce(function(e,t){return Math.max(e,t.data.width,t.data.height)},0)},i([y({visible:!0}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Vec2)?r:Object)],t.prototype,"_offsetMin",void 0),i([y({visible:!0}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Vec2)?n:Object)],t.prototype,"_offsetMax",void 0),i([y({type:cc.Enum(l),tooltip:"Determins how scale, angle and positional offsets will be applied.",visible:!0}),a("design:type",Object)],t.prototype,"_placementInterpolation",void 0),i([y({min:0,max:2,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_placementDensity",void 0),i([y({type:cc.Widget.AlignMode}),a("design:type",Object)],t.prototype,"applyMode",void 0),i([y({override:!0,visible:!1}),a("design:type",Object)],t.prototype,"_createInstanceOnStart",void 0),i([h,g,_("Generic Component/Prefab Tiler")],t)}(p.default);r.default=m,cc._RF.pop()},{"../Util/RandomUtil":"RandomUtil","./PrefabInstancer":"PrefabInstancer","./SizeToScreen":"SizeToScreen"}],RandomUtil:[function(e,t,r){"use strict";function n(e,t){return void 0===e&&(e=1),void 0===t&&(t=e,e=0),Math.random()*(t-e)+e}function o(e,t){void 0===e&&(e=1);var r=n(e,t);return Math.floor(r)}function i(){return n()>.5}function a(e,t){void 0===e&&(e=1);var r=n(e,t),o=n(0,2*Math.PI);return new cc.Vec2(Math.cos(o)*r,Math.sin(o)*r)}function c(e,t){void 0===e&&(e=1);var r=n(e,t),o=n(0,2*Math.PI),i=n(-r,r);return new cc.Vec3(Math.cos(o)*r,Math.sin(o)*r,i)}function s(e){if(0===e.length)throw new Error("Requires an ArrayLike with a length above 0.");return o(0,e.length)}function l(e){return e[s(e)]}function u(){return o(-1,1)}cc._RF.push(t,"afafdlQOYtMN6N5jKuw0gnG","RandomUtil"),Object.defineProperty(r,"__esModule",{value:!0}),r.sort=r.item=r.index=r.v3=r.v2=r.bool=r.integer=r.float=void 0,r.float=n,r.integer=o,r.bool=i,r.v2=a,r.v3=c,r.index=s,r.item=l,r.sort=u,r.default={float:n,integer:o,bool:i,v2:a,v3:c,index:s,item:l,sort:u},cc._RF.pop()},{}],RedrawUI:[function(e,t,r){"use strict";cc._RF.push(t,"7afc23vBLVOI4CTUoc7HjpE","RedrawUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.REDRAW_TOOLTIPS=void 0;var p=u(e("../Generic/Hider")),f=u(e("../ActorTrigger/Trigger")),d=u(e("../ActorTrigger/StoryTriggerSwitch")),h=u(e("../Actor/Actor")),y=u(e("../Generic/ButtonAsynchronizer")),g=u(e("../Util/EventHandlerUtils")),_=u(e("../Util/Decorators/cache")),m=cc._decorator,b=m.ccclass,v=m.property,w=m.executeInEditMode,O=cc.js.getClassName,S={RedrawStoryTrigger:O(f.default)+" to navigate to if the Re-Draw button is pressed. Must be the child of a "+O(d.default)+".",RedrawActionTrigger:'Not to be confused with the "redrawStoryTrigger", the "redrawActionTrigger" is an optional '+O(f.default)+' that will try to be executed when navigating back to the configured "redrawStoryTrigger". It should NOT be the child of a '+O(d.default)+".",ContinueActionTrigger:"Optional "+O(f.default)+" that will try to be executed pressing the continue button. It should NOT be the child of a "+O(d.default)+"."};r.REDRAW_TOOLTIPS=S;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.redrawStoryTrigger=null,t.redrawActionTrigger=null,t.continueActionTrigger=null,t._redrawButton=null,t._continueButton=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"redrawButton",{get:function(){if(!this._redrawButton)throw new Error('"redrawButton" is not set in the editor.');return this._redrawButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"continueButton",{get:function(){if(!this._continueButton)throw new Error('"continueButton" is not set in the editor.');return this._continueButton},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._ensureClickEventHandlers()},t.prototype.gotoRedrawTrigger=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return this.hidden=!0,this.redrawActionTrigger?[4,this.redrawActionTrigger.tryExecute()]:[3,2];case 1:e.sent(),e.label=2;case 2:return cc.isValid(this)?(this._setActorsPaused(!0),this.redrawStoryTrigger?[4,this.storyTriggerSwitch.switchToTrigger(this.redrawStoryTrigger,!0)]:[3,4]):[2];case 3:e.sent(),e.label=4;case 4:return this._setActorsPaused(!1),[2]}})})},t.prototype.continueOnCurrentTrigger=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return this.hidden=!0,this.continueActionTrigger?[4,this.continueActionTrigger.tryExecute()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype._setActorsPaused=function(e){var t,r;try{for(var n=l(h.default.all),o=n.next();!o.done;o=n.next())o.value.paused=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t.prototype._ensureClickEventHandlers=function(){var e=y.default.getClickEvents(this.redrawButton);e.length=0,e.push(g.default.create({target:this.node,component:this,handler:"gotoRedrawTrigger"}));var t=y.default.getClickEvents(this.continueButton);t.length=0,t.push(g.default.create({target:this.node,component:this,handler:"continueOnCurrentTrigger"}))},i([v({type:f.default,tooltip:S.RedrawStoryTrigger,formerlySerializedAs:"redrawTrigger"}),a("design:type",Object)],t.prototype,"redrawStoryTrigger",void 0),i([v({type:f.default,tooltip:S.RedrawActionTrigger}),a("design:type",Object)],t.prototype,"redrawActionTrigger",void 0),i([v({type:f.default,tooltip:S.ContinueActionTrigger}),a("design:type",Object)],t.prototype,"continueActionTrigger",void 0),i([v({visible:!0,type:cc.Button}),a("design:type",Object)],t.prototype,"_redrawButton",void 0),i([v({visible:!0,type:cc.Button}),a("design:type",Object)],t.prototype,"_continueButton",void 0),i([_.default({type:d.default,scope:"scene"}),a("design:type","function"==typeof(r=void 0!==d.default&&d.default)?r:Object)],t.prototype,"storyTriggerSwitch",void 0),i([b,w],t)}(p.default);r.default=C,cc._RF.pop()},{"../Actor/Actor":"Actor","../ActorTrigger/StoryTriggerSwitch":"StoryTriggerSwitch","../ActorTrigger/Trigger":"Trigger","../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Generic/Hider":"Hider","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils"}],RoomManager:[function(e,t,r){"use strict";cc._RF.push(t,"566bfE+7KFCGbFOrnkAVWz0","RoomManager");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var f=p(e("./Room")),d=p(e("../../../Actor/Actor")),h=p(e("../../../Framework/GameComponent")),y=p(e("../../../Generic/SizeToScreen")),g=cc._decorator,_=g.ccclass,m=g.disallowMultiple,b=g.property,v=cc.js.getClassName,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._roomPrefabNames=[],t._scribbles=null,t._ink=null,t._cameraMoveDuration=2,t._rooms=[],t}var r;return o(t,e),r=t,Object.defineProperty(t.prototype,"scribbles",{get:function(){if(!this._scribbles)throw new Error('"scribbles" is not set in the editor.');return this._scribbles},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ink",{get:function(){if(!this._ink)throw new Error('"ink" is not set in the editor.');return this._ink},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_roomPrefabs",{get:function(){return r._roomPrefabs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_currentRoomIndex",{get:function(){return r._currentRoomIndex},set:function(e){r._currentRoomIndex=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentRoom",{get:function(){return this._rooms[this._currentRoomIndex]||null},enumerable:!1,configurable:!0}),t.prototype.onScenePreload=function(){return c(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,this._restoreCurrentRoomIndex()];case 1:return e=t.sent(),[4,this._ensureRoomPrefabLoaded(e)];case 2:return t.sent(),[2]}})})},t.prototype.onSceneStart=function(){return c(this,void 0,Promise,function(){var e,t,r;return s(this,function(n){switch(n.label){case 0:(e=this.getComponent(y.default))&&e.resize(),this._instantiateRoom(this._currentRoomIndex),this._focusCurrentRoom(),t=this._roomPrefabNames.length,r=0,n.label=1;case 1:return r<t?r===this._currentRoomIndex?[3,3]:[4,this._ensureRoomPrefabLoaded(r)]:[3,4];case 2:if(n.sent(),!cc.isValid(this))return[3,4];this._instantiateRoom(r),n.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},t.prototype.onSceneEnd=function(){this._releaseRoomPrefabs()},t.prototype.allRoomsLoaded=function(){return this._roomPrefabs.length===this._roomPrefabNames.length&&this._roomPrefabs.every(function(e){return!!e})},t.prototype.currentRoomIsFocused=function(){return!!this.currentRoom&&this.currentRoom.isFocused()},t.prototype.gotoNextRoom=function(){return this._gotoRoom(1)},t.prototype.gotoPrevRoom=function(){return this._gotoRoom(-1)},t.prototype._ensureRoomPrefabLoaded=function(e){var t=this,r=this._roomPrefabs[e];return r?Promise.resolve(r):new Promise(function(r,n){var o=t._roomPrefabNames[e];cc.assetManager.resources.load(["StudioRoomPrefabs/"+o],cc.Prefab,function(e,t){var o=l(t,1)[0];e?n(e):r(o)})}).then(function(r){var n=r;return n.addRef(),cc.isValid(t)&&(t._roomPrefabs[e]=n),n})},t.prototype._releaseRoomPrefabs=function(){var e,t;try{for(var r=u(this._roomPrefabs),n=r.next();!n.done;n=r.next()){var o=n.value;o&&o.decRef()}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this._roomPrefabs.length=0},t.prototype._instantiateRoom=function(e){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");var t=this._roomPrefabs[e],r=t&&cc.instantiate(t).getComponent(f.default);if(!r)throw new Error("Room Prefab "+(t?t.name:"room at index "+e)+" did not have a "+v(f.default)+" component");r.getComponentsInChildren(h.default).forEach(function(e){return e.onSceneStart(cc.director.getScene(),gm)}),r.node.active=!1,r.node.setParent(this.node),r.node.setSiblingIndex(0),r.node.setPosition(cc.Vec2.ZERO),this._rooms[e]=r},t.prototype._focusCurrentRoom=function(){if(!this.currentRoom)throw new Error("There is no current room!");this._activateRoom(this.currentRoom),this.currentRoom.foregroundNodeIsAttached&&this.currentRoom.detachForegroundNode(),this._placeScribblesAndInkInRoom(this.currentRoom),this.currentRoom.onFocusTrigger&&this.currentRoom.onFocusTrigger.tryExecute()},t.prototype._gotoRoom=function(e){var t=this,r=this._wrapIndex(this._currentRoomIndex+e),n=this._rooms[r];if(!n)throw new Error("No "+v(f.default)+" at index "+r);var o=this.currentRoom;if(!o)throw new Error("No current room.");if(o===n)throw new Error("Current and Next rooms are the same.");this._activateRoom(n),this._placeNextRoom(n,e),this._placeScribblesAndInkInRoom(n),this._currentRoomIndex=r,this._saveCurrentRoomIndex();var i=o;return i.node.setSiblingIndex(Math.max(n.node.getSiblingIndex()-1,0)),i.onExitTrigger&&i.onExitTrigger.tryExecute(),this._moveCameraToCurrentRoom().then(function(){i!==t.currentRoom&&(i.foregroundNodeIsAttached||i.reattachForegroundNode(),i.node.active=!1),t.currentRoom&&t.currentRoom.isFocused()&&t.currentRoom.onFocusTrigger&&t.currentRoom.onFocusTrigger.tryExecute()})},t.prototype._wrapIndex=function(e){var t=e,r=this._rooms.length-1;return t<0?t=r:t>r&&(t=0),t},t.prototype._activateRoom=function(e){var t;e.node.active=!0,null===(t=e.getComponent(y.default))||void 0===t||t.resize(),e.getComponentsInChildren(cc.Widget).forEach(function(e){return e.updateAlignment()}),e.getComponentsInChildren(cc.Layout).forEach(function(e){return e.updateLayout()}),e.onEnterTrigger&&e.onEnterTrigger.tryExecute();var r=this.scribbles.getComponentInChildren(cc.Button);e.onTouchScribbles?e.onTouchScribbles.button=r:r&&(r.clickEvents=[]);var n=this.ink.getComponentInChildren(cc.Button);e.onTouchInk?e.onTouchInk.button=n:n&&(n.clickEvents=[])},t.prototype._placeNextRoom=function(e,t){var r=this.currentRoom;r&&(e.node.x=r.node.x+(r.backgroundNode.width/r.backgroundNode.scaleX*.5+e.backgroundNode.width/e.backgroundNode.scaleX*.5)*t,e.foregroundNodeIsAttached&&e.detachForegroundNode())},t.prototype._moveCameraToCurrentRoom=function(){var e=this,t=this.currentRoom;if(!t)return Promise.resolve();var r=cc.Camera.main,n=r.getComponent(d.default)||r.addComponent(d.default);return n.transform({node:t.node,easing:"quadInOut",duration:this._cameraMoveDuration,channel:"x"}),new Promise(function(t){return n.scheduleOnce(t,e._cameraMoveDuration)})},t.prototype._placeScribblesAndInkInRoom=function(e){this.ink.setParent({node:e.characterNode,childIndex:-1}),this.ink.moveCharacter({node:e.inkTarget.node,throttle:1,track:0}),this.scribbles.setParent({node:e.characterNode,childIndex:-1}),this.scribbles.moveCharacter({node:e.scribblesTarget.node,throttle:1,track:0})},t.prototype._saveCurrentRoomIndex=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return gm.loaded?[4,gm.storage.set({store:"ui",id:"studio-current-room",value:this._currentRoomIndex,memory:!0})]:[2];case 1:return e.sent(),[2]}})})},t.prototype._restoreCurrentRoomIndex=function(){return c(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return gm.loaded?[4,gm.storage.get({store:"ui",id:"studio-current-room",memory:!0})]:[2,this._currentRoomIndex];case 1:return"number"==typeof(e=t.sent())&&(this._currentRoomIndex=e),[2,this._currentRoomIndex]}})})},t._roomPrefabs=[],t._currentRoomIndex=0,i([b({type:[cc.String],visible:!0,tooltip:"Name of the room in the resources StudioRoomPrefabs folder.\nIndex 0 will be the default room, subsequent rooms will be placed to the 'right'"}),a("design:type",Array)],t.prototype,"_roomPrefabNames",void 0),i([b({visible:!0,type:d.default}),a("design:type",Object)],t.prototype,"_scribbles",void 0),i([b({visible:!0,type:d.default}),a("design:type",Object)],t.prototype,"_ink",void 0),i([b({min:0,max:10,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_cameraMoveDuration",void 0),r=i([_,m],t)}(h.default);r.default=w,cc._RF.pop()},{"../../../Actor/Actor":"Actor","../../../Framework/GameComponent":"GameComponent","../../../Generic/SizeToScreen":"SizeToScreen","./Room":"Room"}],Room:[function(e,t,r){"use strict";cc._RF.push(t,"2ae88cehKpOVKGEbeX5RjDU","Room");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../../../ActorTrigger/TriggerZone")),l=c(e("../../../ActorTrigger/Trigger")),u=c(e("../../../Util/NodeUtils")),p=c(e("../../../Util/getComponentInParents")),f=c(e("../../../ActorTrigger/ButtonTrigger")),d=c(e("../../../Util/approximately")),h=e("../../../Generic/SizeToScreen"),y=c(e("../../../Generic/AudioResourceLoader")),g=cc._decorator,_=g.ccclass,m=g.disallowMultiple,b=g.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._backgroundNode=null,t._characterNode=null,t._foregroundNode=null,t._scribblesTarget=null,t._inkTarget=null,t.onEnterTrigger=null,t.onFocusTrigger=null,t.onExitTrigger=null,t.onTouchScribbles=null,t.onTouchInk=null,t._originalForegroundNodeState=null,t._refreshForegroundNodePlacement=function(){t.foregroundNodeIsAttached||(t.reattachForegroundNode(),t.detachForegroundNode())},t}var r;return o(t,e),r=t,Object.defineProperty(t.prototype,"backgroundNode",{get:function(){if(!this._backgroundNode)throw new Error(this.node+": Background Node needs to be set in editor");return this._backgroundNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"characterNode",{get:function(){if(!this._characterNode)throw new Error(this.node+": Character Node needs to be set in editor");return this._characterNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"foregroundNode",{get:function(){if(!this._foregroundNode)throw new Error(this.node+": Foreground Node needs to be set in editor");return this._foregroundNode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scribblesTarget",{get:function(){if(!this._scribblesTarget)throw new Error('"scribblesTarget" is not set in the editor.');return this._scribblesTarget},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inkTarget",{get:function(){if(!this._inkTarget)throw new Error('"inkTarget" is not set in the editor.');return this._inkTarget},enumerable:!1,configurable:!0}),t.prototype.onEnable=function(){this.getComponentsInChildren(cc.Widget).forEach(function(e){e.enabledInHierarchy&&e.updateAlignment()}),h.onResize(this._refreshForegroundNodePlacement)},t.prototype.onDisable=function(){h.offResize(this._refreshForegroundNodePlacement)},t.prototype.isResourceAudioLoaded=function(){return this.node.getComponentsInChildren(y.default).every(function(e){return e.loadingComplete})},t.prototype.isFocused=function(){try{return this.node.activeInHierarchy&&d.default(cc.Camera.main.node.x,this.node.x,1)}catch(e){return!1}},t.prototype.detachForegroundNode=function(){var e=this.node.parent;if(this._originalForegroundNodeState||(this._originalForegroundNodeState=u.default.getNodeState(this.foregroundNode,!1)),!this.foregroundNodeIsAttached)throw new Error("Foreground node is already detached.");var t=this.foregroundNode.convertToWorldSpaceAR(cc.Vec2.ZERO),r=e.convertToNodeSpaceAR(t),n=this.foregroundNode.getComponent(cc.Widget);n&&(n.enabled=!1),this.foregroundNode.setParent(e),this.foregroundNode.setPosition(r)},t.prototype.reattachForegroundNode=function(){if(this.foregroundNodeIsAttached)throw new Error("Foreground node is already attached.");if(!this._originalForegroundNodeState)throw new Error("Foreground node original node state was not set.");u.default.applyNodeState(this.foregroundNode,this._originalForegroundNodeState);var e=this.foregroundNode.getComponent(cc.Widget);e&&(e.enabled=!0,e.updateAlignment())},Object.defineProperty(t.prototype,"foregroundNodeIsAttached",{get:function(){return p.default(this.foregroundNode,r)===this},enumerable:!1,configurable:!0}),i([b({type:cc.Node,visible:!0}),a("design:type",Object)],t.prototype,"_backgroundNode",void 0),i([b({type:cc.Node,visible:!0,formerlySerializedAs:"_characterLayer"}),a("design:type",Object)],t.prototype,"_characterNode",void 0),i([b({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_foregroundNode",void 0),i([b({visible:!0,type:s.default}),a("design:type",Object)],t.prototype,"_scribblesTarget",void 0),i([b({visible:!0,type:s.default}),a("design:type",Object)],t.prototype,"_inkTarget",void 0),i([b({type:l.default}),a("design:type",Object)],t.prototype,"onEnterTrigger",void 0),i([b({type:l.default}),a("design:type",Object)],t.prototype,"onFocusTrigger",void 0),i([b({type:l.default}),a("design:type",Object)],t.prototype,"onExitTrigger",void 0),i([b({type:f.default}),a("design:type",Object)],t.prototype,"onTouchScribbles",void 0),i([b({type:f.default}),a("design:type",Object)],t.prototype,"onTouchInk",void 0),r=i([_,m],t)}(cc.Component);r.default=v,cc._RF.pop()},{"../../../ActorTrigger/ButtonTrigger":"ButtonTrigger","../../../ActorTrigger/Trigger":"Trigger","../../../ActorTrigger/TriggerZone":"TriggerZone","../../../Generic/AudioResourceLoader":"AudioResourceLoader","../../../Generic/SizeToScreen":"SizeToScreen","../../../Util/NodeUtils":"NodeUtils","../../../Util/approximately":"approximately","../../../Util/getComponentInParents":"getComponentInParents"}],SceneLifecycleTrigger:[function(e,t,r){"use strict";cc._RF.push(t,"a3b71UCqqND/6bHyqvPL625","SceneLifecycleTrigger");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("./Trigger")),u=cc._decorator,p=u.ccclass,f=u.property,d=u.executeInEditMode,h=u.menu;(function(e){e[e.OnSceneStart=0]="OnSceneStart",e[e.OnSceneEnd=1]="OnSceneEnd"})(s||(s={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lifecycleEvent=s.OnSceneStart,t}return o(t,e),Object.defineProperty(t.prototype,"disableAfterExecute",{get:function(){return!1},set:function(){},enumerable:!1,configurable:!0}),t.prototype.onSceneStart=function(){if(this.lifecycleEvent===s.OnSceneStart)return this.tryExecute()},t.prototype.onSceneEnd=function(){if(this.lifecycleEvent===s.OnSceneEnd)return this.tryExecute()},i([f({type:cc.Enum(s)}),a("design:type",Object)],t.prototype,"lifecycleEvent",void 0),i([f({override:!0,visible:!1}),a("design:type",Boolean),a("design:paramtypes",[Boolean])],t.prototype,"disableAfterExecute",null),i([p,d,h("Trigger Component/Scene Lifecycle Trigger")],t)}(l.default);r.default=y,cc._RF.pop()},{"./Trigger":"Trigger"}],ScratchDrawing:[function(e,t,r){"use strict";cc._RF.push(t,"f1b28k9iulAkL2XetA/5qFU","ScratchDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./Drawing")),p=cc._decorator,f=p.ccclass,d=p.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.autoFill=!0,t}return o(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.autoFill&&this.fill()},t.prototype.fill=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i;return s(this,function(a){switch(a.label){case 0:return[4,gm.untilLoaded];case 1:return e=a.sent(),this.clear(),t=e.drawings.useSplat("Simple"),r=this.node,n=r.width,o=r.height,i=r.scale,t.width=n,t.height=o,t.scale=i,t.color=cc.Color.BLACK,t.setPosition(this.node.convertToWorldSpaceAR(cc.Vec2.ZERO)),this.addSplats([t]),[2]}})})},i([d({}),a("design:type",Object)],t.prototype,"autoFill",void 0),i([f],t)}(u.default);r.default=h,cc._RF.pop()},{"./Drawing":"Drawing"}],SizeToScreen:[function(e,t,r){"use strict";cc._RF.push(t,"179ccIrSLJD67tda7LLeaXS","SizeToScreen");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.offResize=r.onResize=void 0;var s=c(e("./CameraRig")),l=cc._decorator,u=l.ccclass,p=l.executeInEditMode,f=l.menu,d=l.property;function h(e){if(cc.sys.isMobile){var t=e;window.addEventListener("resize",t),window.addEventListener("orientationchange",t)}else cc.view.on("canvas-resize",e)}function y(e){if(cc.sys.isMobile){var t=e;window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}else cc.view.off("canvas-resize",e)}r.onResize=h,r.offResize=y;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,t}return o(t,e),t.prototype.onLoad=function(){this.resize=this.resize.bind(this)},t.prototype.onEnable=function(){this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE&&h(this.resize)},t.prototype.onDisable=function(){y(this.resize)},t.prototype.start=function(){this.resize()},t.prototype.update=function(){this.applyMode===cc.Widget.AlignMode.ALWAYS&&this.resize()},t.prototype.resize=function(){var e=this._getCamera();if(e){var t=this._getScreenDimensions(e.zoomRatio),r=t.width,n=t.height,o=e.node.convertToWorldSpaceAR(cc.v2(-r,-n)),i=e.node.convertToWorldSpaceAR(cc.v2(r,n)),a=Math.abs(o.x-i.x),c=Math.abs(o.y-i.y);this.node.width=a,this.node.height=c}},t.prototype._getCamera=function(){try{return s.default.getCameraRigForNode(this.node).camera}catch(e){return cc.Camera.main}},t.prototype._getScreenDimensions=function(e){void 0===e&&(e=1);var t=cc.view.getFrameSize(),r=t.width,n=t.height,o=cc.view.getScaleX(),i=cc.view.getScaleY(),a=.5*cc.view.getDevicePixelRatio();return cc.size(r*a/o*e,n*a/i*e)},i([d({type:cc.Widget.AlignMode}),a("design:type",Object)],t.prototype,"applyMode",void 0),i([u,p,f("Generic Component/Size To Screen")],t)}(cc.Component);r.default=g,cc._RF.pop()},{"./CameraRig":"CameraRig"}],Snapper:[function(e,t,r){"use strict";cc._RF.push(t,"eed14yENyhKr4XgLet1MpK8","Snapper");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ATTACH_PREFIX=r.SnapType=r.getBoneNode=void 0;var s,l=c(e("../Util/NodeUtils")),u=c(e("../Util/Decorators/cache")),p=cc._decorator,f=p.ccclass,d=p.disallowMultiple,h=p.property,y=p.menu,g="ATTACHED_NODE:";function _(e,t){return e&&e.findBone(t)?{type:s.Bone,skeleton:e,bone:t}:null}function m(e){return e?{type:s.Node,node:e}:null}function b(e,t){var r=t.attachUtil;r._attachedRootNode||r.generateAllAttachedNodes();var n=r._attachedNodeArray.find(function(t){return t.name===g+e});if(!n)throw new Error("Could not find bone on skeleton "+t.node.name+' named "'+e+'"');return n}function v(e,t){return function(){return!(this._from!==e||t&&this._thisSkeleton)}}function w(e){return function(){return this._to===e}}function O(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){var t=this;return e.every(function(e){return e.call(t)})}}r.ATTACH_PREFIX=g,function(e){e[e.Bone=0]="Bone",e[e.Node=1]="Node"}(s||(s={})),r.SnapType=s,r.getBoneNode=b;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._from=s.Bone,t._fromSkeleton=null,t._fromBone="",t._to=s.Node,t._toSkeleton=null,t._toBone="",t._toNode=null,t._inheritBoneTransform=!1,t}return o(t,e),Object.defineProperty(t.prototype,"snappingFrom",{get:function(){return this._from===s.Bone?_(this._thisSkeleton||this._fromSkeleton,this._fromBone):m(this.node)},enumerable:!1,configurable:!0}),t.prototype.snapFromBone=function(e,t){this._from=s.Bone,this._fromSkeleton=void 0===t?this._fromSkeleton:this._resolveSkeleton(t),this._fromBone=e},t.prototype.snapFromNode=function(){this._from=s.Node},Object.defineProperty(t.prototype,"snappingTo",{get:function(){return this._to===s.Bone?_(this._toSkeleton,this._toBone):m(this._toNode)},enumerable:!1,configurable:!0}),t.prototype.snapToBone=function(e,t){this._to=s.Bone,this._toSkeleton=void 0===t?this._toSkeleton:this._resolveSkeleton(t),this._toBone=e},t.prototype.snapToNode=function(e){this._to=s.Node,this._toNode=l.default.resolveNode(e)},t.prototype.clearSnapping=function(){this._fromSkeleton=null,this._fromBone="",this._toSkeleton=null,this._toBone="",this._toNode=null},t.prototype.applySnapping=function(){var e=this.snappingFrom,t=this.snappingTo;e&&t&&(e.type===s.Bone?this._applySnapFromBone(e,t):e.type===s.Node&&t.type===s.Bone&&this._inheritBoneTransform?this._applySnapFromNodeToBone(e,t):e.type===s.Node&&this._applySnapFromNode(e,t))},t.prototype.getFromNode=function(){var e=this.snappingFrom;if(!e)throw new Error("Snap from is not correctly configured.");return this._getNode(e)},t.prototype.getToNode=function(){var e=this.snappingTo;if(!e)throw new Error("Snap to is not correctly configured.");return this._getNode(e)},t.prototype.getActorComponentState=function(){return{enabled:this.enabled,to:this._to,toNode:this._toNode,toSkeleton:this._toSkeleton,toBone:this._toBone,from:this._from,fromSkeleton:this._fromSkeleton,fromBone:this._fromBone}},t.prototype.applyActorComponentState=function(e){this.enabled=e.enabled,this._to=e.to,this._toNode=e.toNode,this._toSkeleton=e.toSkeleton,this._toBone=e.toBone,this._from=e.from,this._fromSkeleton=e.fromSkeleton,this._fromBone=e.fromBone},t.prototype.onEnable=function(){cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.applySnapping,this)},t.prototype.onDisable=function(){cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.applySnapping,this)},t.prototype._resolveSkeleton=function(e,t){if(e instanceof sp.Skeleton)return e;if(!e)return null;var r=l.default.resolveNode(e,t);return r&&r.getComponent(sp.Skeleton)},t.prototype._getNode=function(e){return e.type===s.Node?e.node:b(e.bone,e.skeleton)},t.prototype._applySnapFromNodeToBone=function(e,t){this._applySnapFromNode(e,t);var r=this._getNode(e),n=t.skeleton.findBone(t.bone);r.angle=n.rotation,r.scaleX=n.scaleX,r.scaleY=n.scaleY},t.prototype._applySnapFromNode=function(e,t){var r=this._getSnapToWorld(t),n=e.node.parent.convertToNodeSpaceAR(r);e.node.setPosition(n)},t.prototype._applySnapFromBone=function(e,t){var r=this._getSnapToWorld(t),n=e.skeleton.node.convertToNodeSpaceAR(r),o=e.skeleton.findBone(e.bone),i=(o.parent||o).worldToLocal(n);Number.isNaN(i.x)||(o.x=i.x),Number.isNaN(i.y)||(o.y=i.y)},t.prototype._getSnapToWorld=function(e){return this._getNode(e).convertToWorldSpaceAR(cc.Vec2.ZERO)},t.getBoneNode=b,i([h({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_from",void 0),i([h({visible:v(s.Bone,!0),type:sp.Skeleton}),a("design:type",Object)],t.prototype,"_fromSkeleton",void 0),i([h({visible:v(s.Bone)}),a("design:type",Object)],t.prototype,"_fromBone",void 0),i([h({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_to",void 0),i([h({visible:w(s.Bone),type:sp.Skeleton}),a("design:type",Object)],t.prototype,"_toSkeleton",void 0),i([h({visible:w(s.Bone)}),a("design:type",Object)],t.prototype,"_toBone",void 0),i([h({visible:w(s.Node),type:cc.Node}),a("design:type",Object)],t.prototype,"_toNode",void 0),i([h({visible:O(v(s.Node),w(s.Bone)),tooltip:"This node will inherit the target bones scale and rotation as well as it's position"}),a("design:type",Object)],t.prototype,"_inheritBoneTransform",void 0),i([u.default({type:sp.Skeleton,required:!1}),a("design:type",Object)],t.prototype,"_thisSkeleton",void 0),i([f,d,y("Generic Component/Snapper")],t)}(cc.Component);r.default=S,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/NodeUtils":"NodeUtils"}],SnoogleDrawTargeter:[function(e,t,r){"use strict";cc._RF.push(t,"b878fULJpJC16KzYivr/D7R","SnoogleDrawTargeter");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../../../Drawing/Drawing")),p=l(e("../../../DrawingUI/DrawingUIHandler")),f=e("./SnoogleTextureLoader"),d=cc._decorator,h=d.ccclass,y=d.property;function g(e,t){var r,n,o,i,a=[],c=Array.isArray(e)?e:[e];try{for(var l=s(c),u=l.next();!u.done;u=l.next()){var p=u.value;"string"==typeof p&&f.isSnoogledorfTextureSlot(p)&&a.push(p)}}catch(g){r={error:g}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}if(t)try{for(var d=s(t.split(",").map(function(e){return e.trim()})),h=d.next();!h.done;h=d.next()){var y=h.value;f.isSnoogledorfTextureSlot(y)&&a.push(y)}}catch(_){o={error:_}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}return a}var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._background=null,t._currentDrawings=[],t}return o(t,e),Object.defineProperty(t.prototype,"background",{get:function(){if(!this._background)throw new Error('"background" is not set in the editor.');return this._background},enumerable:!1,configurable:!0}),t.prototype.onTouchStart=function(e,t,r){this._cullExtraneousTextureCells(),this._focusCorrectDrawing(e,r)},t.prototype.onTouchMove=function(e,t,r){this._cullExtraneousTextureCells(),this._focusCorrectDrawing(e,r)},t.prototype.onTouchEnd=function(){this._cullExtraneousTextureCells()},t.prototype.onLoad=function(){this.clearDrawableBodyPart()},t.prototype.setDrawableBodyParts=function(e,t){var r=this,n=g(e,t),o=this.getComponentsInChildren(u.default),i=n.map(function(e){var t=o.find(function(t){return t.node.name===e+" Drawing"});if(!t)throw new Error("No drawing for "+e+" under "+r.node.name);return t});this._currentDrawings=i,this._updateActiveOutline()},t.prototype.clearDrawableBodyPart=function(){this.setDrawableBodyParts(null)},t.prototype.getActorComponentState=function(){var e=this._currentDrawings.map(function(e){return e.node.name.replace("Drawing","").trim()});if(!e.every(f.isSnoogledorfTextureSlot))throw new Error(e+" contains invalid texture slot names.");return{enabled:this.enabled,currentTextureSlots:e}},t.prototype.applyActorComponentState=function(e){this.enabled=e.enabled,this.setDrawableBodyParts(e.currentTextureSlots)},t.prototype._updateActiveOutline=function(){var e,t,r=function(e){if(!e.name.endsWith("Outline"))return"continue";var t=n._currentDrawings.some(function(t){return t.node.name.replace("Drawing","Outline")===e.name});e.active=t},n=this;try{for(var o=s(this.node.children),i=o.next();!i.done;i=o.next())r(i.value)}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype._focusCorrectDrawing=function(e,t){var r,n,o=this._currentDrawings;if(this.node.activeInHierarchy&&o.length>0){var a=this.background;try{for(var c=s(o),l=c.next();!l.done;l=c.next()){var u=l.value;u.node.getBoundingBoxToWorld().contains(e)&&(a=u)}}catch(f){r={error:f}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}if(t!==a){var p=this.drawingUI._lastDrawCoord||{scale:1,angle:0};this.drawingUI.onTouchEnd(i({world:e},p)),this.drawingUI.drawing=a,this.drawingUI.onTouchStart(i({world:e},p))}}},t.prototype._cullExtraneousTextureCells=function(){var e,t,r,n;try{for(var o=s(this._currentDrawings),i=o.next();!i.done;i=o.next()){var a=i.value;try{for(var c=(r=void 0,s(a.textureCells)),l=c.next();!l.done;l=c.next()){var u=l.value;0===u.coord.x&&0===u.coord.y||(u.node.removeFromParent(),u.node.destroy())}}catch(p){r={error:p}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}}catch(f){e={error:f}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},a([y({visible:!0,tooltip:"Drawing that will receive splats if the current touch target is not under any limb.",type:u.default}),c("design:type",Object)],t.prototype,"_background",void 0),a([h],t)}(p.default);r.default=_,cc._RF.pop()},{"../../../Drawing/Drawing":"Drawing","../../../DrawingUI/DrawingUIHandler":"DrawingUIHandler","./SnoogleTextureLoader":"SnoogleTextureLoader"}],SnoogleTextureLoader:[function(e,t,r){"use strict";cc._RF.push(t,"72547VvLHpFp4E+sYvtKHqw","SnoogleTextureLoader");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.isSnoogledorfTextureSlot=r.SNOOGLEDORF_TEXTURE_SLOTS=void 0;var p=u(e("../../../Drawing/DrawingTextureCell")),f=e("../../../Generic/SpriteAdditionalBlendModes"),d=e("../../../Drawing/DrawingStorage"),h=u(e("../../../Util/Decorators/cache")),y=e("../../../Generic/Grid"),g=cc._decorator.ccclass,_=cc.macro.BlendFactor,m=["SD_Arm_R","SD_Leg_R","SD_Leg_L","SD_Body","SD_Arm_L","SD_Head"];function b(e){return m.some(function(t){return e===t})}r.SNOOGLEDORF_TEXTURE_SLOTS=m,r.isSnoogledorfTextureSlot=b;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._slotToMaterial=new Map,t}var r;return o(t,e),t.prototype.applyBodyPartTexture=function(e,t){return c(this,void 0,Promise,function(){var r,n;return s(this,function(o){switch(o.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded");if(!b(r="string"==typeof e?e:t||""))throw new Error(r+" is not a valid texture slot");return[4,gm.drawings.copyStoredDrawing({storageKey:r,variationStrategy:d.GetVariation.Latest,deserialize:!0})];case 1:if(!(n=o.sent()))throw new Error("Cannot apply BodyPart texture, no drawing stored with key "+r+".");return cc.isValid(this)?(n.node.setParent(this.node),this._replaceBodyPartTexture(r,n),n.node.destroy(),[2]):[2]}})})},t.prototype.clearBodyPartTextures=function(){var e,t,r=this._createEmptyTexture();try{for(var n=l(m),o=n.next();!o.done;o=n.next()){var i=o.value,a=this._getSpineMaterial(i);a&&a.setProperty("texture",r)}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.applyAllBodyPartTextures=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o,i;return s(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,7]),e=l(m),t=e.next(),a.label=1;case 1:return t.done?[3,4]:(r=t.value,[4,this.applyBodyPartTexture(r)]);case 2:if(a.sent(),!cc.isValid(this))return[3,4];a.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return n=a.sent(),o={error:n},[3,7];case 6:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.bodyPartTexturesApplied=function(){var e=this;return m.every(function(t){return e._slotToMaterial.has(t)})},t.prototype._replaceBodyPartTexture=function(e,t){var r=this._getSpineMaterial(e);if(r){var n=this._createFlippedTexture(t);r.setBlend(!0,f.BlendFunc.FUNC_ADD,_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA,f.BlendFunc.FUNC_ADD,_.ONE,_.ONE),r.setProperty("texture",n)}else cc.warn("Could not get spine material for "+e+" on drawing "+this.node.name)},t.prototype._createFlippedTexture=function(e){var t=e.textureCells.find(function(e){return 0===e.coord.x&&0===e.coord.y});t||(t=e._createTextureCell(new y.GridCoord(0,0)));var r=new cc.Node("Flipped "+t.node.name).addComponent(p.default);r.node.setParent(t.node.parent),r.node.setPosition(t.node.position),r.node.setSiblingIndex(0),r.node.setContentSize(t.node.getContentSize());var n=t.node.scaleY;return t.node.scaleY=-n,e._renderTextureCells([r]),t.node.scaleY=n,r.node.removeFromParent(),r.node.destroy(),r.getTexture()},t.prototype._createEmptyTexture=function(){var e=new cc.RenderTexture;return e.initWithSize(2,2),e},t.prototype._getSpineMaterial=function(e){var t=this._slotToMaterial.get(e);if(!t){var r=this.skeleton._skeleton;if(!r)throw new Error(this.node.name+" skeleton is not yet initialized.");var n=r.slots.find(function(t){return t.attachment.name===e});if(!n)return cc.warn('Could not find slot "'+e+'"'),null;var o=n.attachment.region.texture._texture._texture,i=this.skeleton._materialCache;(t=Object.values(i).find(function(e){return e.getProperty("texture",0)===o}))&&this._slotToMaterial.set(e,t)}return t||null},i([h.default({type:sp.Skeleton,scope:["node","children"]}),a("design:type","function"==typeof(r="undefined"!=typeof sp&&sp.Skeleton)?r:Object)],t.prototype,"skeleton",void 0),i([g],t)}(cc.Component);r.default=v,cc._RF.pop()},{"../../../Drawing/DrawingStorage":"DrawingStorage","../../../Drawing/DrawingTextureCell":"DrawingTextureCell","../../../Generic/Grid":"Grid","../../../Generic/SpriteAdditionalBlendModes":"SpriteAdditionalBlendModes","../../../Util/Decorators/cache":"cache"}],SpinnerUI:[function(e,t,r){"use strict";cc._RF.push(t,"2ea19kinfpL5o91q/HrYWQd","SpinnerUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../../../Util/Decorators/cache")),p=l(e("../../../Generic/Transform")),f=l(e("../../../Util/untilConditionOrTimeout")),d=cc._decorator,h=d.ccclass,y=d.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._animator=null,t._leverTransformer=null,t._leverAngleWhenSlowest=-10,t._leverAngleWhenFastest=100,t._speedSteps=[0,.5,1,1.5],t._stepIndex=0,t}var r;return o(t,e),Object.defineProperty(t.prototype,"spinnerAnimator",{get:function(){if(!this._animator)throw new Error('"spinnerAnimator" is not set in the editor.');return this._animator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leverTransformer",{get:function(){if(!this._leverTransformer)throw new Error('"leverTransformer" is not set in the editor.');if(this._leverTransformer.transformStrategy!==p.default.Strategy.Values)throw new Error("Lever "+p.default.name+" component must be set to use transform strategy "+p.default.Strategy[p.default.Strategy.Values]);if(!this._leverTransformer.applyAngle)throw new Error("Lever "+p.default.name+" component must be set up to applyAngle");return this._leverTransformer},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){return c(this,void 0,Promise,function(){var e=this;return s(this,function(t){switch(t.label){case 0:return[4,f.default(function(){return!!e.spinnerAnimator.currentClip})];case 1:return t.sent(),this.setSpinnerSpeed(this._stepIndex),[2]}})})},t.prototype.setSpinnerSpeed=function(e){var t=this._speedSteps.length-1;if(0===t)throw new Error("No speed steps defined.");var r=this._speedSteps[e];if(void 0===r)throw new Error("Invalid stepIndex: "+e+". Must be between 0 and "+t);var n=cc.misc.lerp(this._leverAngleWhenSlowest,this._leverAngleWhenFastest,e/t);this.leverTransformer.angle=n;var o=this.spinnerAnimator;if(!o.currentClip)throw new Error("cc.Animation is not playing a clip.");o.getAnimationState(o.currentClip.name).speed=r,this._stepIndex=e},t.prototype.incrementSpinnerSpeed=function(){var e=this._stepIndex+1;e>=this._speedSteps.length&&(e=0),this.setSpinnerSpeed(e)},i([y({visible:!0,tooltip:"Animator component to affect the animation state speed of.",type:cc.Animation}),a("design:type",Object)],t.prototype,"_animator",void 0),i([y({visible:!0,type:p.default}),a("design:type",Object)],t.prototype,"_leverTransformer",void 0),i([u.default({type:cc.Button,scope:"children"}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Button)?r:Object)],t.prototype,"button",void 0),i([y({visible:!0,min:-180,max:180,slide:!0}),a("design:type",Object)],t.prototype,"_leverAngleWhenSlowest",void 0),i([y({visible:!0,min:-180,max:180,slide:!0}),a("design:type",Object)],t.prototype,"_leverAngleWhenFastest",void 0),i([y({type:[cc.Float],visible:!0}),a("design:type",Array)],t.prototype,"_speedSteps",void 0),i([y({min:0,step:1,visible:!0,displayName:"Starting Speed Step"}),a("design:type",Object)],t.prototype,"_stepIndex",void 0),i([h],t)}(cc.Component);r.default=g,cc._RF.pop()},{"../../../Generic/Transform":"Transform","../../../Util/Decorators/cache":"cache","../../../Util/untilConditionOrTimeout":"untilConditionOrTimeout"}],SprayDrawingTool:[function(e,t,r){"use strict";cc._RF.push(t,"f7c75aeqRBK7qWjjnFwQP40","SprayDrawingTool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./EmitterDrawingTool")),l=cc._decorator,u=l.ccclass,p=l.property,f=l.menu,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._emitRate=10,t._timeBeforeNextEmit=0,t}return o(t,e),Object.defineProperty(t.prototype,"emitRate",{get:function(){return this._emitRate},set:function(e){this._emitRate=cc.misc.clampf(e,.01,500)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_timeBetweenEmits",{get:function(){return 1/this.emitRate},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._resetTimeBeforeNextEmit()},t.prototype._resetTimeBeforeNextEmit=function(){this._timeBeforeNextEmit=this._timeBetweenEmits},t.prototype.getSplatCount=function(e){if(this._timeBeforeNextEmit-=e,this._timeBeforeNextEmit>0)return 0;var t=-this._timeBeforeNextEmit;return this._resetTimeBeforeNextEmit(),Math.ceil(t/this._timeBetweenEmits*this.currentTouchCoord.scale)},i([p({type:cc.Float,tooltip:"Number of splats to be emitted, per second.",step:.01,min:.01,max:500,visible:!0}),a("design:type",Object)],t.prototype,"_emitRate",void 0),i([u,f("Drawing Component/Spray Drawing Tool")],t)}(s.default);r.default=d,cc._RF.pop()},{"./EmitterDrawingTool":"EmitterDrawingTool"}],Springroll:[function(e,t,r){"use strict";cc._RF.push(t,"c966bBy/1lM86HPPGHEpq5q","Springroll");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./GameComponent")),p=l(e("../Generic/AudioPlayer")),f=l(e("../Util/getComponentsInScene")),d=cc._decorator,h=d.ccclass,y=d.disallowMultiple,g="sr-dev-",_=function(){function e(e,t){this._subscribers=[],this._value=e,this._storageId=g+t,this._updateValueFromStorage()}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,this._subscribers.forEach(function(t){return t(e)}),this._setValueInStorage(e)},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e){this._subscribers.push(e)},e.prototype.unsubscribe=function(e){this._subscribers=this._subscribers.filter(function(t){return t!==e})},e.prototype._updateValueFromStorage=function(){return a(this,void 0,Promise,function(){var e;return c(this,function(t){switch(t.label){case 0:return[4,gm.untilLoaded];case 1:return[4,t.sent().storage.get({id:this._storageId,store:"ui"})];case 2:return null!=(e=t.sent())&&(this._value=e),[2]}})})},e.prototype._setValueInStorage=function(e){return a(this,void 0,Promise,function(){return c(this,function(t){switch(t.label){case 0:return gm.loaded?[4,gm.storage.set({id:this._storageId,store:"ui",value:e})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e}(),m=function(){this.pause=new _(!1,"pause"),this.captionsMuted=new _(!0,"captions-muted"),this.voVolume=new _(1,"vo-volume"),this.musicVolume=new _(1,"music-volume"),this.sfxVolume=new _(1,"sfx-volume"),this.soundVolume=new _(1,"master-volume")};function b(){var e=window,t=e.Application,r=e.GoogleAnalytics;return"function"!=typeof t?new m:("function"==typeof r&&t.uses(new r),new t({features:{captions:!0,sound:!0,vo:!0,music:!0,sfx:!0}}).state)}function v(){return f.default(p.default)}var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onPause=function(e){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");gm.paused=e},t._onSetCaptionsMuted=function(e){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");gm.captions.enabled=!e},t._onSetVolume=function(e){var t,r;try{for(var n=s(v()),o=n.next();!o.done;o=n.next())o.value.masterVolume=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t._onSetMusicVolume=function(e){var t,r;try{for(var n=s(v()),o=n.next();!o.done;o=n.next())o.value.musicVolume=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t._onSetSfxVolume=function(e){var t,r;try{for(var n=s(v()),o=n.next();!o.done;o=n.next())o.value.sfxVolume=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t._onSetVoiceVolume=function(e){var t,r;try{for(var n=s(v()),o=n.next();!o.done;o=n.next())o.value.voiceVolume=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},t}return o(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.onGameLoaded=function(){this._state=b(),this._addSpringRollStateListeners()},t.prototype.onSceneStart=function(){this._state&&this._applySpringRollState()},t.prototype.onDestroy=function(){this._state&&this._removeSpringRollStateListeners()},t.prototype._addSpringRollStateListeners=function(){var e=this._state;e.pause.subscribe(this._onPause),e.soundVolume.subscribe(this._onSetVolume),e.musicVolume.subscribe(this._onSetMusicVolume),e.sfxVolume.subscribe(this._onSetSfxVolume),e.voVolume.subscribe(this._onSetVoiceVolume),e.captionsMuted.subscribe(this._onSetCaptionsMuted)},t.prototype._removeSpringRollStateListeners=function(){var e=this._state;e.pause.unsubscribe(this._onPause),e.soundVolume.unsubscribe(this._onSetVolume),e.musicVolume.unsubscribe(this._onSetMusicVolume),e.sfxVolume.unsubscribe(this._onSetSfxVolume),e.voVolume.unsubscribe(this._onSetVoiceVolume),e.captionsMuted.unsubscribe(this._onSetCaptionsMuted)},t.prototype._applySpringRollState=function(){var e=this._state;this._notifyStateSubscribers(e.pause),this._notifyStateSubscribers(e.soundVolume),this._notifyStateSubscribers(e.musicVolume),this._notifyStateSubscribers(e.sfxVolume),this._notifyStateSubscribers(e.voVolume),this._notifyStateSubscribers(e.captionsMuted)},t.prototype._notifyStateSubscribers=function(e){e.value=e.value},i([h,y],t)}(u.default);r.default=w,cc._RF.pop()},{"../Generic/AudioPlayer":"AudioPlayer","../Util/getComponentsInScene":"getComponentsInScene","./GameComponent":"GameComponent"}],SpriteAdditionalBlendModes:[function(e,t,r){"use strict";cc._RF.push(t,"cb5afFhqvJPXZtbMN/MQoNQ","SpriteAdditionalBlendModes");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.BlendFunc=void 0;var s=c(e("../Util/Decorators/cache")),l=cc._decorator,u=l.ccclass,p=l.property,f=l.executionOrder,d=l.menu;function h(e){var t=cc.gfx;if(e in t&&"number"!=typeof t[e])throw new Error(e+" does not exist on the hidden cc.gfx object.");return t[e]}var y,g=cc.Sprite.prototype._updateMaterial;(function(e){e[e.FUNC_ADD=h("BLEND_FUNC_ADD")]="FUNC_ADD",e[e.FUNC_SUBTRACT=h("BLEND_FUNC_SUBTRACT")]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=h("BLEND_FUNC_REVERSE_SUBTRACT")]="FUNC_REVERSE_SUBTRACT"})(y||(y={})),r.BlendFunc=y;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendEq=y.FUNC_ADD,t._blendAlphaEq=y.FUNC_ADD,t._blendSrcAlpha=cc.macro.BlendFactor.SRC_ALPHA,t._blendDstAlpha=cc.macro.BlendFactor.ONE_MINUS_SRC_ALPHA,t._spriteUpdateMaterial=function(){var e=t.sprite;g.call(e),e.getMaterial(0).setBlend(!0,t._blendEq,t._blendSrc,t._blendDst,t._blendAlphaEq,t._blendSrcAlpha,t._blendDstAlpha)},t}var r,n,c,l,h,_,m,b,v;return o(t,e),Object.defineProperty(t.prototype,"_blendSrc",{get:function(){return this.sprite.srcBlendFactor},set:function(e){this.sprite.srcBlendFactor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_blendDst",{get:function(){return this.sprite.dstBlendFactor},set:function(e){this.sprite.dstBlendFactor=e},enumerable:!1,configurable:!0}),t.prototype.onEnable=function(){this._setSpriteMaterialUpdateMethodOverridden(!0)},t.prototype.onDisable=function(){this._setSpriteMaterialUpdateMethodOverridden(!1)},t.prototype._setSpriteMaterialUpdateMethodOverridden=function(e){this.sprite._updateMaterial=e?this._spriteUpdateMaterial:g},i([s.default(cc.Sprite),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Sprite)?r:Object)],t.prototype,"sprite",void 0),i([p({type:cc.Enum(y),visible:!0}),a("design:type",Object)],t.prototype,"_blendEq",void 0),i([p({type:cc.macro.BlendFactor,visible:!0}),a("design:type","function"==typeof(c="undefined"!=typeof cc&&void 0!==(n=cc.macro)&&n.BlendFactor)?c:Object),a("design:paramtypes",["function"==typeof(h="undefined"!=typeof cc&&void 0!==(l=cc.macro)&&l.BlendFactor)?h:Object])],t.prototype,"_blendSrc",null),i([p({type:cc.macro.BlendFactor,visible:!0}),a("design:type","function"==typeof(m="undefined"!=typeof cc&&void 0!==(_=cc.macro)&&_.BlendFactor)?m:Object),a("design:paramtypes",["function"==typeof(v="undefined"!=typeof cc&&void 0!==(b=cc.macro)&&b.BlendFactor)?v:Object])],t.prototype,"_blendDst",null),i([p({type:cc.Enum(y),visible:!0}),a("design:type",Object)],t.prototype,"_blendAlphaEq",void 0),i([p({type:cc.macro.BlendFactor,visible:!0}),a("design:type",Object)],t.prototype,"_blendSrcAlpha",void 0),i([p({type:cc.macro.BlendFactor,visible:!0}),a("design:type",Object)],t.prototype,"_blendDstAlpha",void 0),i([u,f(-100),d("Renderer Component/Sprite Additional Blend Modes")],t)}(cc.Component);r.default=_,cc._RF.pop()},{"../Util/Decorators/cache":"cache"}],Statistics:[function(e,t,r){"use strict";cc._RF.push(t,"f403cKlDEJKebiGAvsnm/E6","Statistics");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var f=p(e("./GameComponent")),d=p(e("./GameManager")),h=cc._decorator,y=h.ccclass,g=h.disallowMultiple,_=function(e,t){return void 0===t&&(t=0),"number"==typeof e&&!Number.isNaN(e)&&isFinite(e)?e:t},m=function(e){return{event_category:e.category,event_label:e.label,value:_(e.value,1)}},b=function(e){return e.action+"-"+e.category},v=function(e){return"object"==typeof e&&null!==e?e:{}},w=function(e,t){var r=0,n=v(e);if(""===t)for(var o in n)r+=_(n[o]);else r+=_(n[t]);return r},O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lastStatisticTimestamp=Date.now(),t._lastUITimestamp=Date.now(),t}return o(t,e),t.prototype.send=function(e){if(this._updateStatisticTimestamp(),e.gtag){var t=e.action,r=s(e,["action"]);this._sendToSpringRollGAPlugin("event",t,m(r))}return this._setValues(e)},t.prototype.retreive=function(e){return this._getValues(e)},t.prototype.log=function(e){return void 0===e&&(e=!0),a(this,void 0,Promise,function(){var t,r,n,o,i,a,s,p;return c(this,function(c){switch(c.label){case 0:if(!gm.loaded)throw new Error(gm.name+" is not loaded.");return[4,gm.storage.find({store:"statistics",memory:e})];case 1:t=c.sent();try{for(r=l(t.entries()),n=r.next();!n.done;n=r.next())o=u(n.value,2),i=o[0],a=o[1],cc.log(i.substring(0,i.lastIndexOf("-")),a)}catch(f){s={error:f}}finally{try{n&&!n.done&&(p=r.return)&&p.call(r)}finally{if(s)throw s.error}}return[2]}})})},Object.defineProperty(t.prototype,"lastStatisticTimestamp",{get:function(){return this._lastStatisticTimestamp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastUITimestamp",{get:function(){return this._lastUITimestamp},enumerable:!1,configurable:!0}),t.prototype.updateUITimestamp=function(){return this._lastUITimestamp=Date.now(),this._lastUITimestamp},t.prototype._updateStatisticTimestamp=function(){this._lastStatisticTimestamp=Date.now(),this.updateUITimestamp()},t.prototype._getValues=function(e){return a(this,void 0,Promise,function(){var t,r,n,o;return c(this,function(i){switch(i.label){case 0:return[4,d.default.ensureInstance()];case 1:return t=i.sent().storage,r=b(e),[4,t.get({store:"statistics",id:r})];case 2:return n=i.sent(),[4,t.get({store:"statistics",id:r,memory:!0})];case 3:return o=i.sent(),[2,{current:w(o,e.label),total:w(n,e.label)}]}})})},t.prototype._setValues=function(e){return a(this,void 0,Promise,function(){var t,r,n,o,i,a,s,l,u,p;return c(this,function(c){switch(c.label){case 0:return[4,d.default.ensureInstance()];case 1:return t=c.sent().storage,r=e.label,n=void 0===r?"":r,o=e.value,i=_(o,1),a=b(e),l=v,[4,t.get({store:"statistics",id:a})];case 2:return(s=l.apply(void 0,[c.sent()]))[n]=_(s[n])+i,[4,t.set({store:"statistics",value:s,id:a})];case 3:return c.sent(),p=v,[4,t.get({store:"statistics",id:a,memory:!0})];case 4:return(u=p.apply(void 0,[c.sent()]))[n]=_(u[n])+i,[4,t.set({store:"statistics",id:a,value:u,memory:!0})];case 5:return c.sent(),[2,{current:w(u,n),total:w(s,n)}]}})})},t.prototype._sendToSpringRollGAPlugin=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=window.Application,o=null==n?void 0:n.getPlugin("GoogleAnalytics");if(o&&"event"===e){var i=u(t,2),a=i[0],c=i[1];o.event(c.event_category,a,c.event_label,c.value)}},i([y,g],t)}(f.default);r.default=O,cc._RF.pop()},{"./GameComponent":"GameComponent","./GameManager":"GameManager"}],Storage:[function(e,t,r){"use strict";cc._RF.push(t,"ed1e2nMtbRIsZkjGy8vLm3K","Storage");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=e("localforage"),p=l(e("localforage-sessionstoragewrapper")),f=cc._decorator,d=f.ccclass,h=f.property,y=p.default._driver,g=!1,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._databaseKey="",t._databaseVersion=0,t._memoryStores=new Map,t._serialStores=new Map,t}return o(t,e),Object.defineProperty(t.prototype,"databaseKey",{get:function(){return this._databaseKey+"@"+this._databaseVersion},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usingLocalStorage",{get:function(){return!!this._usingLocalStorage},enumerable:!1,configurable:!0}),t.prototype.set=function(e){return this._getStore(e).setItem(e.id,e.value)},t.prototype.get=function(e){return this._getStore(e).getItem(e.id)},t.prototype.has=function(e){return this._getStore(e).iterate(function(t,r){return e.id===r})},t.prototype.remove=function(e){return this._getStore(e).removeItem(e.id)},t.prototype.clear=function(e){var t=e.query,r=this._getStore(e);return t?r.iterate(function(e,n){t(e,n,r)&&r.removeItem(n)}):r.clear()},t.prototype.find=function(e){return c(this,void 0,Promise,function(){var t,r,n;return s(this,function(o){switch(o.label){case 0:return t=e.query,r=new Map,[4,(n=this._getStore(e)).iterate(function(e,o){t&&!t(e,o,n)||r.set(o,e)})];case 1:return o.sent(),[2,r]}})})},t.prototype.stores=function(e){return(e&&e.memory?this._memoryStores:this._serialStores).keys()},t.prototype.onLoad=function(){g||(g=!0,u.defineDriver(p.default))},t.prototype._getStore=function(e){var t=this,r=e.memory,n=e.store,o=r?this._memoryStores:this._serialStores,i=o.get(n);if(!i){var a=r?y:[u.INDEXEDDB,u.LOCALSTORAGE];(i=u.createInstance({name:this.databaseKey,driver:a,storeName:n}))._driverSet.then(function(){void 0===t._usingLocalStorage&&(t._usingLocalStorage=(null==i?void 0:i.driver())===u.LOCALSTORAGE)}),o.set(n,i)}return i},i([h({visible:!0}),a("design:type",Object)],t.prototype,"_databaseKey",void 0),i([h({min:0,step:1,visible:!0}),a("design:type",Object)],t.prototype,"_databaseVersion",void 0),i([d],t)}(cc.Component);r.default=_,cc._RF.pop()},{localforage:7,"localforage-sessionstoragewrapper":6}],StoryPlaybackUIHandler:[function(e,t,r){"use strict";cc._RF.push(t,"9da6cO5hkNJdIFa1AJRfnBb","StoryPlaybackUIHandler");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=i(e("../Framework/GameComponent")),c=i(e("./StoryPlaybackUI")),s=i(e("../Util/getComponentInParents")),l=i(e("../Util/getComponentInScene")),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._storyPlaybackUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"storyPlaybackUI",{get:function(){if(this._storyPlaybackUI||(this._storyPlaybackUI=s.default(this.node,c.default)||l.default(c.default)),!this._storyPlaybackUI)throw new Error(cc.js.getClassName(c.default)+" could not be found.");return this._storyPlaybackUI},enumerable:!1,configurable:!0}),t.prototype.setUIElementUsable=function(e,t,r){void 0===r&&(r=!1),e.interactable=t,r?e.node.active=t:e.node.opacity=255*(t?1:.5)},t.prototype.onSetVisible=function(){},t.prototype.onSetPaused=function(){},t}(a.default);r.default=u,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Util/getComponentInParents":"getComponentInParents","../Util/getComponentInScene":"getComponentInScene","./StoryPlaybackUI":"StoryPlaybackUI"}],StoryPlaybackUITimelineControls:[function(e,t,r){"use strict";cc._RF.push(t,"54f83o+WO9OEKRfkky9L+jP","StoryPlaybackUITimelineControls");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=e("./StoryPlaybackUI"),p=l(e("./StoryPlaybackUIHandler")),f=l(e("../Util/EventHandlerUtils")),d=l(e("../Util/milliseconds")),h=cc._decorator,y=h.ccclass,g=h.property,_=h.executeInEditMode,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prevButton=null,t._nextButton=null,t._playPauseButton=null,t._pauseIcon=null,t._playIcon=null,t}return o(t,e),t.prototype.onLoad=function(){this._ensureEventHandlers()},t.prototype.onFocusInEditor=function(){this._ensureEventHandlers()},t.prototype.update=function(){var e=this.storyPlaybackUI.storyTriggerSwitch;if(e){var t=e.previousTrigger,r=e.nextTrigger;!this.storyPlaybackUI.paused&&cc.isValid(this._prevButton)&&this.setUIElementUsable(this._prevButton,!!t),!this.storyPlaybackUI.paused&&cc.isValid(this._nextButton)&&this.setUIElementUsable(this._nextButton,!!r)}},t.prototype.onSetPaused=function(e,t){var r=t.includes(u.PAUSE_REASON_USER);cc.isValid(this._pauseIcon)&&(this._pauseIcon.node.active=r),cc.isValid(this._playIcon)&&(this._playIcon.node.active=!r)},t.prototype.gotoPreviousTrigger=function(){return c(this,void 0,Promise,function(){var e,t;return s(this,function(r){switch(r.label){case 0:return e=this.storyPlaybackUI.storyTriggerSwitch,t=e.previousTrigger,e.enabled=!1,[4,this.storyPlaybackUI.setCurrentTrigger(t)];case 1:return r.sent(),[4,d.default(300)];case 2:return r.sent(),e.enabled=!0,[2]}})})},t.prototype.gotoNextTrigger=function(){var e=this.storyPlaybackUI.storyTriggerSwitch.nextTrigger;return this.storyPlaybackUI.setCurrentTrigger(e)},t.prototype._ensureEventHandlers=function(){var e={target:this.node,component:this,handler:"gotoPreviousTrigger"},t={target:this.node,component:this,handler:"gotoNextTrigger"},r=this.storyPlaybackUI,n={target:r.node,component:r,handler:"togglePause"};cc.isValid(this._prevButton)&&f.default.ensure(e,this._prevButton.clickEvents),cc.isValid(this._nextButton)&&f.default.ensure(t,this._nextButton.clickEvents),cc.isValid(this._playPauseButton)&&f.default.ensure(n,this._playPauseButton.clickEvents)},i([g({visible:!0,type:cc.Button}),a("design:type",Object)],t.prototype,"_prevButton",void 0),i([g({visible:!0,type:cc.Button}),a("design:type",Object)],t.prototype,"_nextButton",void 0),i([g({visible:!0,type:cc.Button}),a("design:type",Object)],t.prototype,"_playPauseButton",void 0),i([g({visible:!0,type:cc.Sprite}),a("design:type",Object)],t.prototype,"_pauseIcon",void 0),i([g({visible:!0,type:cc.Sprite}),a("design:type",Object)],t.prototype,"_playIcon",void 0),i([y,_],t)}(p.default);r.default=m,cc._RF.pop()},{"../Util/EventHandlerUtils":"EventHandlerUtils","../Util/milliseconds":"milliseconds","./StoryPlaybackUI":"StoryPlaybackUI","./StoryPlaybackUIHandler":"StoryPlaybackUIHandler"}],StoryPlaybackUITimelineScrubber:[function(e,t,r){"use strict";cc._RF.push(t,"8b17bWj1h5LQajnOO3Nf/ol","StoryPlaybackUITimelineScrubber");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./StoryPlaybackUIHandler")),f=u(e("../Util/EventHandlerUtils")),d=u(e("../Util/Decorators/cache")),h=e("../ActorTrigger/StoryTriggerSwitch"),y=cc._decorator,g=y.ccclass,_=y.property,m=y.executeInEditMode,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._timeLabel=null,t._triggerLabel=null,t._sceneInTriggerLabel=!0,t._triggerInTriggerLabel=!0,t._actionInTriggerLabel=!0,t._timeIsBeingUpdated=!1,t}var r;return o(t,e),Object.defineProperty(t.prototype,"scrubbing",{get:function(){return!!this.slider._dragging},enumerable:!1,configurable:!0}),t.prototype.scrubTimeline=function(e){return c(this,void 0,Promise,function(){var t,r,n;return s(this,function(o){switch(o.label){case 0:return this._timeIsBeingUpdated?[2]:(t=e instanceof cc.Slider?e.progress:e,this.slider.progress=cc.misc.clamp01(t),(r=h.getPlaybackData(this.storyPlaybackUI.storyTriggerSwitch.currentTrigger))?(n=t*r.duration,this.storyPlaybackUI.setPaused(!0,"scrubbing-timeline"),this._timeIsBeingUpdated=!0,[4,this.storyPlaybackUI.setCurrentTriggerSequenceTime(n)]):[3,2]);case 1:o.sent(),this._timeIsBeingUpdated=!1,o.label=2;case 2:return[2]}})})},t.prototype.onFocusInEditor=function(){this._ensureEventHandler()},t.prototype.onLoad=function(){this._ensureEventHandler()},t.prototype.update=function(){if(this.storyPlaybackUI.storyTriggerSwitch){var e=this.storyPlaybackUI.storyTriggerSwitch.currentTrigger;!cc.isValid(this._triggerLabel)||this.scrubbing||this._timeIsBeingUpdated||(this._triggerLabel.string=this._getTriggerLabel(e)),this.scrubbing||this.storyPlaybackUI.setPaused(!1,"scrubbing-timeline");var t=h.getPlaybackData(e);t&&!this.scrubbing&&(this.slider.progress=t.time/t.duration),t&&cc.isValid(this._timeLabel)&&(this._timeLabel.string=this._getTimeLabel(t.time));var r=this.scrubbing||!!t&&t.relay.isPlaying;this._setSliderHandleVisible(r)}},t.prototype._ensureEventHandler=function(){var e={target:this.node,component:this,handler:"scrubTimeline"};f.default.ensure(e,this.slider.slideEvents)},t.prototype._getTriggerLabel=function(e){var t=cc.director.getScene(),r=this._sceneInTriggerLabel?t.name:"";if(!e)return"\u2705 "+r+" Complete";var n="\u231b",o="",i=e.currentActions,a=e.currentConditions;return i.length>0?(n="\ud83e\udd16",o=1===i.length?i[0].node.name:"Actions: ("+i.length+")"):a.length>0&&(n="\ud83d\udcad",o=1===a.length?a[0].node.name:"Conditions: ("+a.length+")"),this._actionInTriggerLabel||(o=""),(n+" "+r+" "+(e&&this._triggerInTriggerLabel?e.node.name:"")+" "+o).replace(/_+/g,"_").trim()},t.prototype._getTimeLabel=function(e){return Math.floor(60*e)+"f"},t.prototype._setSliderHandleVisible=function(e){var t,r;try{for(var n=l(this.slider.handle.node.children),o=n.next();!o.done;o=n.next())o.value.active=e}catch(i){t={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},i([d.default(cc.Slider),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Slider)?r:Object)],t.prototype,"slider",void 0),i([_({visible:!0,type:cc.Label}),a("design:type",Object)],t.prototype,"_timeLabel",void 0),i([_({visible:!0,type:cc.Label}),a("design:type",Object)],t.prototype,"_triggerLabel",void 0),i([_({tooltip:"Show the current scene in the timeline label.",visible:function(){return!!this._triggerLabel}}),a("design:type",Object)],t.prototype,"_sceneInTriggerLabel",void 0),i([_({tooltip:"Show the current triger in the timeline label.",visible:function(){return!!this._triggerLabel}}),a("design:type",Object)],t.prototype,"_triggerInTriggerLabel",void 0),i([_({tooltip:"Show the current action in the timeline label.",visible:function(){return!!this._triggerLabel}}),a("design:type",Object)],t.prototype,"_actionInTriggerLabel",void 0),i([g,m],t)}(p.default);r.default=b,cc._RF.pop()},{"../ActorTrigger/StoryTriggerSwitch":"StoryTriggerSwitch","../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","./StoryPlaybackUIHandler":"StoryPlaybackUIHandler"}],StoryPlaybackUIVisibilityToggle:[function(e,t,r){"use strict";cc._RF.push(t,"60e5cltf2FEh5ahvLy0lmOj","StoryPlaybackUIVisibilityToggle");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./StoryPlaybackUIHandler")),l=c(e("../Util/EventHandlerUtils")),u=c(e("../Util/Decorators/cache")),p=cc._decorator,f=p.ccclass,d=p.property,h=p.executeInEditMode,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._visibileIcon=null,t._invisibleIcon=null,t}var r;return o(t,e),t.prototype.onLoad=function(){this._ensureEventHandler()},t.prototype.onFocusInEditor=function(){this._ensureEventHandler()},t.prototype.onEnable=function(){this.setUIElementUsable(this.button,!0)},t.prototype.onDisable=function(){this.setUIElementUsable(this.button,!1)},t.prototype.onSetVisible=function(e){cc.isValid(this._visibileIcon)&&(this._visibileIcon.node.active=e),cc.isValid(this._invisibleIcon)&&(this._invisibleIcon.node.active=!e)},t.prototype._ensureEventHandler=function(){var e=this.storyPlaybackUI,t={target:e.node,component:e,handler:"toggleVisibile"};l.default.ensure(t,this.button.clickEvents)},i([u.default(cc.Button),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Button)?r:Object)],t.prototype,"button",void 0),i([d({visible:!0,type:cc.Sprite}),a("design:type",Object)],t.prototype,"_visibileIcon",void 0),i([d({visible:!0,type:cc.Sprite}),a("design:type",Object)],t.prototype,"_invisibleIcon",void 0),i([f,h],t)}(s.default);r.default=y,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/EventHandlerUtils":"EventHandlerUtils","./StoryPlaybackUIHandler":"StoryPlaybackUIHandler"}],StoryPlaybackUI:[function(e,t,r){"use strict";cc._RF.push(t,"adfe7UenBFJQ5Jnv9bEkdrR","StoryPlaybackUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},f=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},d=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},h=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e},y=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.PAUSE_REASON_USER=void 0;var g=y(e("../Framework/GameComponent")),_=s(e("../ActorTrigger/StoryTriggerSwitch")),m=y(e("../ActorTrigger/Trigger")),b=y(e("../ActorTrigger/TriggerAction - PlayActorSequence")),v=y(e("./StoryPlaybackUIHandler")),w=y(e("./StoryPlaybackUIVisibilityToggle")),O=y(e("../Actor/Actor")),S=y(e("../Util/getComponentsInScene")),C=y(e("../ActorTrigger/TriggerSwitch")),P=cc._decorator,T=P.ccclass,j=P.property,R=P.executeInEditMode,x=cc.js.getClassName;function A(e){if("object"!=typeof e||!e)return!1;var t=e,r=t.paused,n=t.visible,o=t.sceneName,i=t.time,a=t.triggerIndex;return"string"==typeof o&&"number"==typeof a&&"number"==typeof i&&!Number.isNaN(i)&&"boolean"==typeof r&&"boolean"==typeof n}r.PAUSE_REASON_USER="user";var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._timelineContainer=null,t._errorLabel=null,t._largePauseButton=null,t._pauseReasons=new Set,t._storageOperations=0,t._storyTriggerSwitch=null,t}return o(t,e),Object.defineProperty(t.prototype,"timelineContainer",{get:function(){if(!this._timelineContainer)throw new Error('"timelineContainer" is not set in the editor.');return this._timelineContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorLabel",{get:function(){if(!this._errorLabel)throw new Error('"errorLabel" is not set in the editor.');return this._errorLabel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"largePauseButton",{get:function(){if(!this._largePauseButton)throw new Error('"pausedByUserIcon" is not set in the editor.');return this._largePauseButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this.timelineContainer.active},set:function(e){this.setVisible(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._pauseReasons.size>0},set:function(e){this.setPaused(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storyTriggerSwitch",{get:function(){if(!this._storyTriggerSwitch)throw new Error(cc.js.getClassName(_.default)+" is not available in this scene.");return this._storyTriggerSwitch},enumerable:!1,configurable:!0}),t.prototype.setVisible=function(e){var t,r,n=e instanceof cc.Toggle?e.isChecked:e;this.timelineContainer.active=n;try{for(var o=f(this._eachHandler()),i=o.next();!i.done;i=o.next())i.value.onSetVisible(n)}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.toggleVisibile=function(){this.setVisible(!this.visible)},t.prototype.setPaused=function(e,t){var r,n;void 0===t&&(t="user");var o=e instanceof cc.Toggle?e.isChecked:e,i=this._pauseReasons.size;if(o?this._pauseReasons.add(t):this._pauseReasons.delete(t),this.largePauseButton.node.active=this._pauseReasons.has("user"),i!==this._pauseReasons.size){this._updatePauseState(),"user"===t&&cc.log("\u23ef",o?"Paused":"Un-Paused");try{for(var a=f(this._eachHandler()),c=a.next();!c.done;c=a.next())c.value.onSetPaused(o,h(this._pauseReasons))}catch(s){r={error:s}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}},t.prototype.togglePause=function(){this.setPaused(!this.paused)},t.prototype.setCurrentTriggerSequenceTime=function(e){return u(this,void 0,Promise,function(){var t,r;return p(this,function(n){switch(n.label){case 0:return t=this.storyTriggerSwitch,(r=t.currentTrigger)?(this.setPaused(!0,"prevent-sound-glitches"),[4,t.switchToTriggerAndTime(r,e)]):[2];case 1:return n.sent(),this.setPaused(!1,"prevent-sound-glitches"),[2]}})})},t.prototype.setCurrentTrigger=function(e){return u(this,void 0,Promise,function(){var t;return p(this,function(r){switch(r.label){case 0:return e?(t=this.storyTriggerSwitch,this.setPaused(!0,"prevent-sound-glitches"),[4,t.switchToTrigger(e,!0)]):[2];case 1:return r.sent(),this.setPaused(!1,"prevent-sound-glitches"),[2]}})})},t.prototype.start=function(){this.enabled=!1},t.prototype.update=function(){this._updatePauseState(),0===this._storageOperations&&this._saveState()},t.prototype.onEnable=function(){this._setVisibilityToggleEnabled(!0)},t.prototype.onDisable=function(){this._setVisibilityToggleEnabled(!1),this.setVisible(!1),this.setPaused(!1)},t.prototype.onSceneStart=function(){return u(this,void 0,Promise,function(){return p(this,function(e){switch(e.label){case 0:return[4,this._getStoryTriggerSwitch()];case 1:return e.sent(),[2]}})})},t.prototype._setVisibilityToggleEnabled=function(e){var t=this.getComponentInChildren(w.default);t&&(t.enabled=e)},t.prototype._eachHandler=function(){return p(this,function(e){switch(e.label){case 0:return[5,f(S.default(v.default))];case 1:return e.sent(),[2]}})},t.prototype._saveState=function(){return u(this,void 0,Promise,function(){var e,t,r,n,o,i;return p(this,function(a){switch(a.label){case 0:return gm.loaded?(e=this.visible,t=this.storyTriggerSwitch,r=t.currentTrigger,n=t.triggers,o=_.getPlaybackData(r),i={sceneName:cc.director.getScene().name,triggerIndex:r?n.indexOf(r):0,time:o?o.time:0,paused:this._pauseReasons.has("user"),visible:e},this._storageOperations++,[4,gm.storage.set({store:"ui",id:"story-playback-ui-state",value:i})]):[2];case 1:return a.sent(),this._storageOperations--,[2]}})})},t.prototype._restoreState=function(){return u(this,void 0,Promise,function(){var e,t,r,n,o,i;return p(this,function(a){switch(a.label){case 0:return gm.loaded?(this.storyTriggerSwitch.node.active=!1,this._storageOperations++,[4,gm.storage.get({store:"ui",id:"story-playback-ui-state"})]):[2];case 1:return e=a.sent(),this._storageOperations--,t=this.storyTriggerSwitch,r=t.currentTrigger,n=t.triggers,o=cc.director.getScene().name,(i=A(e)?e:{time:0,sceneName:o,triggerIndex:r?n.indexOf(r):0,visible:!0,paused:!1}).visible&&(this.setVisible(!0),this.setPaused(i.paused)),[3,3];case 2:a.sent(),a.label=3;case 3:return this.storyTriggerSwitch.node.active=!0,[2]}})})},t.prototype._updatePauseState=function(){var e,t,r=_.getPlaybackData(this._storyTriggerSwitch&&this._storyTriggerSwitch.currentTrigger);r&&(r.relay.paused=this.paused);try{for(var n=f(O.default.all),o=n.next();!o.done;o=n.next())o.value.paused=this.paused}catch(i){e={error:i}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype._getStoryTriggerSwitch=function(){return u(this,void 0,Promise,function(){return p(this,function(e){switch(e.label){case 0:return this.enabled=!0,this._storyTriggerSwitch=this._getValidTriggerSwitch(),this._storyTriggerSwitch?[4,this._restoreState()]:(this.enabled=!1,[2]);case 1:return e.sent(),[2]}})})},t.prototype._getValidTriggerSwitch=function(){var e,t,r=this.errorLabel;r.string="";var n=S.default(_.default);if(n.length>1)return r.string="Too many "+x(_.default)+"s in scene "+cc.director.getScene().name,null;var o=d(n,1)[0];if(!o&&S.default(C.default).length>0&&(r.string="No "+x(_.default)+" in scene."),!o)return null;try{for(var i=f(o.triggers),a=i.next();!a.done;a=i.next()){var c=a.value;if(c.actions.filter(function(e){return e instanceof b.default}).length>1)return r.string=c.node.name+" has too many "+x(b.default).split(" - ")[1]+" actions",null}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return 0===o.triggers.length?(r.string="No Story "+x(m.default)+"'s in scene",null):o.currentTrigger?o:(r.string="No initial Story "+x(m.default),null)},c([j({visible:!0,type:cc.Node}),l("design:type",Object)],t.prototype,"_timelineContainer",void 0),c([j({visible:!0,type:cc.Label}),l("design:type",Object)],t.prototype,"_errorLabel",void 0),c([j({visible:!0,type:cc.Button}),l("design:type",Object)],t.prototype,"_largePauseButton",void 0),c([T,R],t)}(g.default);r.default=D,cc._RF.pop()},{"../Actor/Actor":"Actor","../ActorTrigger/StoryTriggerSwitch":"StoryTriggerSwitch","../ActorTrigger/Trigger":"Trigger","../ActorTrigger/TriggerAction - PlayActorSequence":"TriggerAction - PlayActorSequence","../ActorTrigger/TriggerSwitch":"TriggerSwitch","../Framework/GameComponent":"GameComponent","../Util/getComponentsInScene":"getComponentsInScene","./StoryPlaybackUIHandler":"StoryPlaybackUIHandler","./StoryPlaybackUIVisibilityToggle":"StoryPlaybackUIVisibilityToggle"}],StoryTriggerSwitch:[function(e,t,r){"use strict";cc._RF.push(t,"42fd4/H5mpIxpXnY/KDfpYT","StoryTriggerSwitch");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getPlaybackData=void 0;var f=p(e("./Trigger")),d=p(e("./TriggerSwitch")),h=p(e("./TriggerAction - PlayActorSequence")),y=p(e("../Actor/Actor")),g=p(e("./TriggerAction - ConfigureDrawingUI")),_=p(e("./TriggerAction - SetDrawingUIState")),m=p(e("../DrawingUI/DrawingUI")),b=p(e("../DrawingUI/DrawingUIToolsConfig")),v=p(e("../Development/Comment")),w=p(e("../Util/getComponentInScene")),O=p(e("../Generic/ButtonAsynchronizer")),S=p(e("./ButtonTrigger")),C=cc._decorator,P=C.ccclass,T=C.executeInEditMode,j=C.menu,R=cc.js.getClassName,x="Action: Apply initial "+R(m.default)+" config",A="These actions are created automatically by the "+R(d.default)+".They are necessary to ensure the "+R(m.default)+" is in it's correct state if any intra-scene navigation happens, such as moving to a previous scene after the LoopUI has been used.";function D(e){var t=e&&(e.actions.find(function(e){return e instanceof h.default})||null);return t&&t.actorRelay&&t.sequence?{time:t.actorRelay.time,duration:t.sequence.duration,relay:t.actorRelay,sequence:t.sequence}:null}r.getPlaybackData=D;var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._initialActorState=new Map,t}return o(t,e),t.prototype.update=function(){e.prototype.update.call(this)},t.prototype.onSceneStart=function(){e.prototype.onSceneStart.call(this),this._saveInitialActorState()},Object.defineProperty(t.prototype,"currentTime",{get:function(){var e=D(this.currentTrigger);return e?e.time:0},enumerable:!1,configurable:!0}),t.prototype.switchToTriggerAtIndex=function(e,t){var r="number"==typeof e?e:parseInt(t||"0"),n=this.triggers[r];if(!n)throw new Error("No "+R(f.default)+" at index "+r);return this.switchToTrigger(n,!0)},t.prototype.switchToNextTrigger=function(){if(!this.nextTrigger)throw new Error("No next "+R(f.default)+" to switch to.");return this.switchToTrigger(this.nextTrigger,!1)},t.prototype.switchToPreviousTrigger=function(){if(!this.previousTrigger)throw new Error("No next "+R(f.default)+" to switch to.");return this.switchToTrigger(this.previousTrigger,!0)},t.prototype.switchToTrigger=function(t,r){return a(this,void 0,Promise,function(){var n,o,i,a;return c(this,function(c){switch(c.label){case 0:if(o=(n=this).triggers,i=n.currentTrigger,!o.includes(t))throw new Error(t.node.name+" is an invalid trigger.");return void 0===typeof r&&(r=this._switchingToTriggerRequiresActorStateUpdate(t)),r?(a=this.enabled,this.enabled=!1,[4,this._cancelExecution()]):[2,e.prototype.switchToTrigger.call(this,t)];case 1:return c.sent(),cc.isValid(this)?(t!==i&&cc.log(!i||o.indexOf(i)>o.indexOf(t)?"\u23ea":"\u23e9",t.node.name),this._restoreActorState(),this._instantlyExecuteAllTriggersTo(t),this.enabled=a,[2]):[2]}})})},t.prototype.switchToTriggerAndTime=function(e,t){return a(this,void 0,Promise,function(){var r;return c(this,function(n){switch(n.label){case 0:return[4,this.switchToTrigger(e,!0)];case 1:return n.sent(),cc.isValid(this)&&(r=this._getCurrentPlayActorSequenceAction())?(this._instantlyExecuteAllActionsTo(r),r.actorRelay&&r.actorRelay.setTime(t),[2]):[2]}})})},t.prototype._saveInitialActorState=function(){if(!this.currentTrigger)throw new Error("No initial trigger.");this._initialActorState=y.default.all.reduce(function(e,t){return e.set(t,t.getActorState())},new Map)},t.prototype._restoreActorState=function(){var e=this;if(0===this._initialActorState.size)throw new Error("Actor state not yet saved.");y.default.all.forEach(function(t){var r=e._initialActorState.get(t);r?t.applyActorState(r):(t.setEnabled({enabled:!1,component:""}),cc.warn(t.node.name," does not have an initial state. Was not present during scene start?"))})},t.prototype._getCurrentPlayActorSequenceAction=function(){return this.currentTrigger&&this.currentTrigger.actions.find(function(e){return e instanceof h.default&&e.actorRelay&&e.sequence})||null},t.prototype._switchingToTriggerRequiresActorStateUpdate=function(e){if(!this.currentTrigger)return!0;if(e===this.currentTrigger)return!1;var t=this.triggers;return t.indexOf(e)!==t.indexOf(this.currentTrigger)+1},t.prototype._instantlyExecuteAllTriggersTo=function(e){var t,r,n=y.default.all.reduce(function(e,t){return e.set(t,t.paused),e},new Map);l(n.keys()).forEach(function(e){e.paused=!0});try{for(var o=u(this.triggers),i=o.next();!i.done;i=o.next()){var a=i.value;if(a===e){this.switchToTrigger(a,!1);break}a.execute({instant:!0,log:!1})}}catch(c){t={error:c}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}n.forEach(function(e,t){t.paused=e})},t.prototype._instantlyExecuteAllActionsTo=function(e){var t={instant:e,log:!1};this.currentTrigger&&(this._currentTriggerWasExecuted=!0,this.currentTrigger.execute(t))},t.prototype._ensureCreateDrawingUIActions=function(){for(var e=w.default(m.default),t=this.triggers,r=0;r<t.length;r++){var n=t[r],o=0===r,i=this._getInitialDrawingUIAction(n);!i&&o&&e?this._createInitialDrawingUIAction(n,e):!i||o&&e?i&&e&&this._syncInitialDrawingUIAction(i,e):i.node.destroy()}},t.prototype._getInitialDrawingUIAction=function(e){return e.getComponentsInChildren(g.default).find(function(e){return e.node&&e.node.name===x})||null},t.prototype._createInitialDrawingUIAction=function(e,t){var r=(e.node.getChildByName(x)||new cc.Node(x)).addComponent(g.default);r.node.setParent(e.node),this._syncInitialDrawingUIAction(r,t)},t.prototype._syncInitialDrawingUIAction=function(e,t){e.node.name=x,e.editorAutoName=!1,e.applyClear=!0,e.applyConfirm=!0,e.applyColors=!0,e.applyTools=!0;var r=t.getComponent(b.default)||t.getComponentInChildren(b.default);e.colors=t.colors,e.toolPrefabs=r?r.toolPrefabs:[],e.confirmTrigger=this._findButtonTrigger(t.confirmButton),e.clearTrigger=this._findButtonTrigger(t.clearButton);var n=e.getComponent(_.default)||e.addComponent(_.default);n.editorAutoName=!1,n.applyHidden=!0,n.applyDrawing=!0,n.applyTouchSurface=!0,n.applyCurrentColor=!1,n.applyCurrentTool=!1,n.applySizeFactor=!1,n.hidden=t.hidden,n.drawing=t.drawing,n.touchSurface=t.touchSurface,(e.getComponent(v.default)||e.addComponent(v.default)).text=A,e.node.name=x},t.prototype._findButtonTrigger=function(e){var t=S.default.getTriggerForButton(e),r=O.default.getClickEvents(e);return!t&&r.length>0&&(cc.warn(R(m.default)+" "+(e&&e.node.name)+"'s Button component should","not define it's own event handlers to be compatible with "+R(this)+".\n","Instead, it should be targeted by a "+R(S.default)),r.length=0),t},i([P,T,j("Trigger Component/Story Trigger Switch")],t)}(d.default);r.default=E,cc._RF.pop()},{"../Actor/Actor":"Actor","../Development/Comment":"Comment","../DrawingUI/DrawingUI":"DrawingUI","../DrawingUI/DrawingUIToolsConfig":"DrawingUIToolsConfig","../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Util/getComponentInScene":"getComponentInScene","./ButtonTrigger":"ButtonTrigger","./Trigger":"Trigger","./TriggerAction - ConfigureDrawingUI":"TriggerAction - ConfigureDrawingUI","./TriggerAction - PlayActorSequence":"TriggerAction - PlayActorSequence","./TriggerAction - SetDrawingUIState":"TriggerAction - SetDrawingUIState","./TriggerSwitch":"TriggerSwitch"}],StrokeDrawingTool:[function(e,t,r){"use strict";cc._RF.push(t,"a3c6cls26dD4bWV+n+zG1W4","StrokeDrawingTool");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./EmitterDrawingTool")),l=cc._decorator,u=l.ccclass,p=l.menu,f=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._emitStep=10,t}return o(t,e),Object.defineProperty(t.prototype,"emitStep",{get:function(){return this._emitStep},set:function(e){this._emitStep=cc.misc.clampf(e,.01,10)},enumerable:!1,configurable:!0}),t.prototype.getSplatCount=function(e,t){var r=this.lastSplatKey;if(!r)return 1;var n=.5*r.size,o=t.node.convertToWorldSpaceAR(r.position),i=this.currentTouchCoord.world.subtract(o).len(),a=this.emitStep/this.currentTouchCoord.scale;if(!(i-.5*this.positionalVariance>a*n))return 0;var c=i/n;return Math.round(c/a)},i([f({type:cc.Float,tooltip:"Distance between splats, in radiis",step:.01,min:.01,max:10,visible:!0}),a("design:type",Object)],t.prototype,"_emitStep",void 0),i([u,p("Drawing Component/Stroke Drawing Tool")],t)}(s.default);r.default=d,cc._RF.pop()},{"./EmitterDrawingTool":"EmitterDrawingTool"}],Temporary:[function(e,t,r){"use strict";cc._RF.push(t,"d8c0d9DP6RDQYwYLG4jrfRj","Temporary");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("../Util/RandomUtil")),p=l(e("../Util/EventHandlerUtils")),f=Math.min,d=Math.max,h=cc._decorator,y=h.ccclass,g=h.disallowMultiple,_=h.executeInEditMode,m=h.property,b=h.menu,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lifetimeRange=[32,128],t.onDestroyEvents=[],t._defaultOnDestroyEventSet=!1,t._lifetime=1/0,t}return o(t,e),Object.defineProperty(t.prototype,"lifetimeRange",{get:function(){return s(this._lifetimeRange)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lifetimeMin",{get:function(){return this._lifetimeRange[0]},set:function(e){this._lifetimeRange[0]=e,this._lifetimeRange[1]=d.apply(void 0,s(this._lifetimeRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lifetimeMax",{get:function(){return this._lifetimeRange[1]},set:function(e){this._lifetimeRange[1]=e,this._lifetimeRange[0]=f.apply(void 0,s(this._lifetimeRange))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lifetime",{get:function(){return this._lifetime},set:function(e){this._lifetime=d(0,e)},enumerable:!1,configurable:!0}),t.prototype.reset=function(e,t){void 0===e&&(e=this.lifetimeMin),void 0===t&&(t=this.lifetimeMax),this.lifetimeMin=e,this.lifetimeMax=t,this.lifetime=u.default.float.apply(u.default,s(this._lifetimeRange))},t.prototype.cancel=function(){this.onDestroyEvents.length=0,this.destroy()},t.prototype.destroyNode=function(){cc.isValid(this.node)&&this.node.destroy()},t.prototype.onLoad=function(){this.reset(),this._defaultOnDestroyEventSet||this._ensureDefaultEventHandler()},t.prototype.update=function(e){this.lifetime-=e,this.lifetime>0||(this.enabled=!1,this.destroy())},t.prototype.onDestroy=function(){this.onDestroyEvents&&cc.Component.EventHandler.emitEvents(this.onDestroyEvents)},t.prototype._ensureDefaultEventHandler=function(){this._defaultOnDestroyEventSet=!0,p.default.ensure({target:this.node,component:this,handler:"destroyNode"},this.onDestroyEvents)},i([m({type:cc.Integer}),a("design:type",Array)],t.prototype,"_lifetimeRange",void 0),i([m({slide:!0,min:0,max:30,tooltip:"The minimum number of seconds this node will survive."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"lifetimeMin",null),i([m({slide:!0,min:0,max:30,tooltip:"The maximum number of seconds this node will survive."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"lifetimeMax",null),i([m(cc.Component.EventHandler),a("design:type",Array)],t.prototype,"onDestroyEvents",void 0),i([m(),a("design:type",Object)],t.prototype,"_defaultOnDestroyEventSet",void 0),i([y,g,_,b("Generic Component/Temporary")],t)}(cc.Component);r.default=v,cc._RF.pop()},{"../Util/EventHandlerUtils":"EventHandlerUtils","../Util/RandomUtil":"RandomUtil"}],TransformableRotateButton:[function(e,t,r){"use strict";cc._RF.push(t,"4becd40oPNPwp17bJNI0TNd","TransformableRotateButton");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("./TransformableWidget")),u=cc._decorator,p=u.ccclass,f=u.menu,d=u.property,h=10,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._degrees=45,t._turnDuration=.125,t._maxRelativeSize=.33,t._minRelativeScale=.5,t._hasTransformableBeenTurnedThisGrab=!1,t.relativeSiblingIndex=h,t}return o(t,e),t.prototype.onGrab=function(){e.prototype.onGrab.call(this),this._hasTransformableBeenTurnedThisGrab=!1},t.prototype.updateTransformable=function(e){this._hasTransformableBeenTurnedThisGrab||(this._hasTransformableBeenTurnedThisGrab=!0,cc.tween(e.node).by(this._turnDuration,{angle:this._degrees}).start())},t.prototype.lockToTransformable=function(e){var t,r,n=this._getOffset(e),o=e.node.position.add(n);this.node.setPosition(o),this._applyRelativeSize(e);try{for(var i=c(this.node.children),a=i.next();!a.done;a=i.next()){var s=a.value;s.scaleX=Math.sign(s.scaleX),s.scaleY=Math.sign(s.scaleY)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},t.prototype.lockDetachedChildrenToTransformable=function(e,t,r){for(var n=e.node,o=this._getOffset(e),i=0;i<t.length;i++){var a=t[i],c=cc.v3(r[i]),s=n.position.add(c.add(o));a.setPosition(s),a.scaleX=this.node.scaleX*Math.sign(a.scaleX),a.scaleY=this.node.scaleY*Math.sign(a.scaleY)}},t.prototype._getOffset=function(e){var t=e.node,r=Math.max(t.width*t.scaleX*.5,t.height*t.scaleY*.5)+.5*this.padding,n=this._degrees>0;return cc.v3(r*(n?-1:1),0,0)},t.prototype._applyRelativeSize=function(e){var t=this.node,r=Math.max(t.width,t.height),n=Math.max(e.node.width*e.node.scaleX,e.node.height*e.node.scaleY);t.scale=cc.misc.clampf(n*(this._maxRelativeSize/r),this._minRelativeScale,1)},i([d({visible:!0,min:-180,max:180,slide:!0,tooltip:"Amount to turn the transformable, per press."}),a("design:type",Object)],t.prototype,"_degrees",void 0),i([d({visible:!0,min:0,max:1,slide:!0,tooltip:"Time taken for a turn to complete."}),a("design:type",Object)],t.prototype,"_turnDuration",void 0),i([d({min:0,max:1,slide:!0,tooltip:"Button will be scaled down if it is larger than this percentage of its parent transformable.",visible:!0}),a("design:type",Object)],t.prototype,"_maxRelativeSize",void 0),i([d({min:0,max:1,slide:!0,tooltip:"Scale will not be dropped below this value when correcting for Max Relative Size.",visible:!0}),a("design:type",Object)],t.prototype,"_minRelativeScale",void 0),i([p,f("Drawing Component/Transformable Rotate Button")],t)}(l.default);r.default=y,cc._RF.pop()},{"./TransformableWidget":"TransformableWidget"}],TransformableRotator:[function(e,t,r){"use strict";cc._RF.push(t,"78e74+Ki+BLtrcLIH/RpDNC","TransformableRotator");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TransformableWidget")),l=c(e("../Util/angleOfVector")),u=cc._decorator,p=u.ccclass,f=u.menu,d=u.property,h=-1,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._angleVisualizerNode=null,t._startAngle=0,t._defaultWidth=0,t.relativeSiblingIndex=h,t}return o(t,e),t.prototype.turn=function(e,t){var r="number"==typeof e?e:"string"==typeof t?parseFloat(t):NaN;if(Number.isNaN(r))throw new Error("Degrees must be a number.");this.transformable&&(this.transformable.node.angle+=r,this._visualizeAngle(this.transformable.node.angle))},t.prototype.onGrab=function(){e.prototype.onGrab.call(this),this.transformable&&(this._startAngle=this.transformable.node.angle)},t.prototype.onLoad=function(){this._defaultWidth=this.node.width},t.prototype.updateTransformable=function(e){var t=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),r=l.default(this.touchGrabPosition.sub(t)),n=l.default(this.touchCurrentPosition.sub(t)),o=this._startAngle+n-r;e.node.angle=o,this._visualizeAngle(o)},t.prototype.lockToTransformable=function(e){var t=e.node,r=Math.max(t.width*t.scaleX,t.height*t.scaleY)+this.padding;this.node.width=r,this.node.height=r,this._visualizeAngle(e.node.angle),this._angleVisualizerNode&&!this._angleVisualizerNode.getComponent(cc.Widget)&&(this._angleVisualizerNode.scale=this.node.width/this._defaultWidth),this.node.setPosition(e.node.position)},t.prototype.lockDetachedChildrenToTransformable=function(e,t,r){for(var n=e.node.angle,o=0;o<t.length;o++){var i=t[o],a=r[o],c=e.node.position.add(cc.v3(a));i.setPosition(c),i.angle=n}},t.prototype._visualizeAngle=function(e){(this._angleVisualizerNode||this.node).angle=e},i([d({type:cc.Node,visible:!0,tooltip:"To visualize the rotation of the target transformable without rotating the entire instance."}),a("design:type",Object)],t.prototype,"_angleVisualizerNode",void 0),i([p,f("Drawing Component/Transformable Rotator")],t)}(s.default);r.default=y,cc._RF.pop()},{"../Util/angleOfVector":"angleOfVector","./TransformableWidget":"TransformableWidget"}],TransformableScalar:[function(e,t,r){"use strict";cc._RF.push(t,"d75e37QPxZKjYCkXm8T/V+5","TransformableScalar");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./TransformableWidget")),p=l(e("./Transformable")),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,g=cc.js.getClassName,_=15,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._originalScale=1,t._minScaleNode=null,t._maxScaleNode=null,t._scaleNodeDisabledColor=cc.Color.WHITE,t._scaleNodeEnabledColor=cc.Color.WHITE,t._pressScaleDuration=.125,t.relativeSiblingIndex=_,t}return o(t,e),t.prototype.onGrab=function(){e.prototype.onGrab.call(this),this.transformable&&(this._originalScale=this.transformable.node.scale)},t.prototype.onGrabRelease=function(){e.prototype.onGrabRelease.call(this);var t=this.touchGrabPosition,r=this.touchCurrentPosition,n=this._minScaleNode,o=this._maxScaleNode;if(n&&o&&t.sub(r).len()<10){var i=c([n,o].sort(function(e,t){return e.convertToWorldSpaceAR(cc.Vec2.ZERO).sub(r).len()-t.convertToWorldSpaceAR(cc.Vec2.ZERO).sub(r).len()}),1)[0]===o?1:-1;this._applyNextScaleKey(i)}},t.prototype.updateTransformable=function(e){var t,r=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),n=this.touchGrabPosition.sub(r).len(),o=this.touchCurrentPosition.sub(r).len()/n;e.node.scale=(t=cc.misc).clampf.apply(t,s([this._originalScale*o],e.scaleRange))},t.prototype.lockToTransformable=function(e){this._lockNodeToTopRight(e,this.node),this._setMinMaxNodesActive(e)},t.prototype.lockDetachedChildrenToTransformable=function(e,t,r){for(var n=0;n<t.length;n++){var o=t[n],i=r[n];this._lockNodeToTopRight(e,o,i)}this._setMinMaxNodesActive(e)},t.prototype._lockNodeToTopRight=function(e,t,r){void 0===r&&(r=cc.Vec2.ZERO);var n=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),o=Math.max(e.node.width*e.node.scaleX*.5,e.node.height*e.node.scaleY*.5)+.5*this.padding+15,i=cc.v2(0,o).rotate(cc.misc.degreesToRadians(-45)),a=this.node.parent.convertToNodeSpaceAR(n).add(i).add(r);t.setPosition(a)},t.prototype._setMinMaxNodesActive=function(e){var t=e.node;this._minScaleNode&&this._setMinMaxNodeEnabledColor(this._minScaleNode,t.scale>e.scaleMin),this._maxScaleNode&&this._setMinMaxNodeEnabledColor(this._maxScaleNode,t.scale<e.scaleMax)},t.prototype._setMinMaxNodeEnabledColor=function(e,t){var r=t?this._scaleNodeEnabledColor:this._scaleNodeDisabledColor;e.color.equals(r)||(e.color=r.clone())},t.prototype._applyNextScaleKey=function(e){var t=this.transformable;if(!t)throw new Error("No "+g(p.default)+" assigned.");var r=t.scaleMin,n=t.scaleMax,o=Array.from({length:4},function(e,t){return cc.misc.lerp(r,n,t/3)}),i=s(o).sort(function(e,r){return Math.abs(t.node.scale-e)-Math.abs(t.node.scale-r)})[0],a=o.indexOf(i),c=o[a+e];void 0!==c&&cc.tween(t.node).to(this._pressScaleDuration,{scale:c}).start()},i([h({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_minScaleNode",void 0),i([h({visible:!0,type:cc.Node}),a("design:type",Object)],t.prototype,"_maxScaleNode",void 0),i([h({visible:function(){return!(!this._minScaleNode&&!this._maxScaleNode)}}),a("design:type",Object)],t.prototype,"_scaleNodeDisabledColor",void 0),i([h({visible:function(){return!(!this._minScaleNode&&!this._maxScaleNode)}}),a("design:type",Object)],t.prototype,"_scaleNodeEnabledColor",void 0),i([h({visible:!0,min:0,max:1,slide:!0,tooltip:"Time taken for a scale press to complete."}),a("design:type",Object)],t.prototype,"_pressScaleDuration",void 0),i([d,y("Drawing Component/Transformable Scalar")],t)}(u.default);r.default=m,cc._RF.pop()},{"./Transformable":"Transformable","./TransformableWidget":"TransformableWidget"}],TransformableWidget:[function(e,t,r){"use strict";cc._RF.push(t,"f90b7Kv2ZxCtpZmh1nOcgeH","TransformableWidget");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./Grabbable")),f=cc._decorator,d=f.ccclass,h=f.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tintNode=null,t._padding=50,t._transfomable=null,t._detachedChildren=[],t._detachedChildrenOffsets=[],t}return o(t,e),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformable",{get:function(){return cc.isValid(this._transfomable)?this._transfomable:null},set:function(e){this._transfomable=e},enumerable:!1,configurable:!0}),t.prototype.onGrab=function(){this._detachChildrenAndCreateOffsets()},t.prototype.onGrabRelease=function(){this._attachChildrenAndApplyOffsets()},t.prototype.update=function(){var e,t;if(this.transformable){this._applyTint(this.transformable.node.color),this._applyRelativeSiblingIndex(this.transformable.node.getSiblingIndex()),this.grabbed&&this.transformable&&this.transformable.resetWidgetTimeBuffer(),this.grabbed?(this.updateTransformable(this.transformable),this.lockDetachedChildrenToTransformable(this.transformable,this._detachedChildren,this._detachedChildrenOffsets)):this.lockToTransformable(this.transformable);try{for(var r=c(this._detachedChildren),n=r.next();!n.done;n=r.next())n.value.opacity=this.node.opacity}catch(o){e={error:o}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}},t.prototype.onDestroy=function(){var e,t;try{for(var r=c(this._detachedChildren),n=r.next();!n.done;n=r.next())n.value.destroy()}catch(o){e={error:o}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._applyTint=function(e){cc.isValid(this._tintNode)&&(this._tintNode.color=e)},t.prototype._applyRelativeSiblingIndex=function(e){var t=Math.max(e+this.relativeSiblingIndex,0);this.node.setSiblingIndex(t)},t.prototype._detachChildrenAndCreateOffsets=function(){var e,t;this._detachedChildren=l(this.node.children),this._detachedChildrenOffsets=this._detachedChildren.map(function(e){return cc.v2(e.position)});try{for(var r=c(this._detachedChildren),n=r.next();!n.done;n=r.next()){var o=n.value;o.setParent(this.node.parent),this._setChildWidgetEnabled(o,!1)}}catch(i){e={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype._attachChildrenAndApplyOffsets=function(){for(var e=0;e<this._detachedChildren.length;e++){var t=this._detachedChildren[e],r=this._detachedChildrenOffsets[e]||cc.Vec2.ZERO;t.setParent(this.node),t.setPosition(r),t.angle=0,this._setChildWidgetEnabled(t,!0)}this._detachedChildren=[],this._detachedChildrenOffsets=[]},t.prototype._setChildWidgetEnabled=function(e,t){var r=e.getComponent(cc.Widget);r&&(r.enabled=t)},i([h({type:cc.Node,visible:!0,tooltip:"If configured, the tint node will inherit the node color of the transformable."}),a("design:type",Object)],t.prototype,"_tintNode",void 0),i([h({tooltip:"Buffer, in pixels, to be seperated from parent Transformable",visible:!0,step:1,min:0,max:150,slide:!0}),a("design:type",Object)],t.prototype,"_padding",void 0),i([d],t)}(p.default);r.default=y,cc._RF.pop()},{"./Grabbable":"Grabbable"}],Transformable:[function(e,t,r){"use strict";cc._RF.push(t,"c2e17oinExKUr04FRiE2gwD","Transformable");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("./Grabbable")),u=s(e("../DrawingUI/DrawingUIToolButton")),p=s(e("./TransformableWidget")),f=s(e("./TransformableScalar")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.menu,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._widgetPrefabs=[],t._scaleMin=.25,t._scaleMax=4,t._widgetPersistTime=4,t._widgetFadeTime=1,t._widgetInstances=[],t._grabToolButton=null,t._widgetTimeBuffer=0,t}return o(t,e),Object.defineProperty(t.prototype,"widgetPrefabs",{get:function(){return this._widgetPrefabs.filter(function(e){return e})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRange",{get:function(){return[this._scaleMin,this._scaleMax].sort(function(e,t){return e-t})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMin",{get:function(){return this.scaleRange[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMax",{get:function(){return this.scaleRange[1]},enumerable:!1,configurable:!0}),t.prototype.resetWidgetTimeBuffer=function(){this._widgetTimeBuffer=this._widgetPersistTime},t.prototype.onLoad=function(){this._widgetInstances=this._widgetPrefabs.map(function(){return null}),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this._afterUpdate,this),this.resetWidgetTimeBuffer()},t.prototype.onDestroy=function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this._afterUpdate,this),this._destroyWidgets()},t.prototype.update=function(e){var t,r;this._widgetTimeBuffer>0&&(this._widgetTimeBuffer-=e);var n=e*(255/this._widgetFadeTime)*(this._widgetTimeBuffer>0?1:-1);try{for(var o=c(this._widgetInstances),i=o.next();!i.done;i=o.next()){var a=i.value;a&&(a.node.opacity=cc.misc.clampf(a.node.opacity+n,0,255))}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this._widgetInstances.every(function(e){return!e||e.node.opacity<=0})&&this._destroyWidgets()},t.prototype.onGrab=function(e){this._grabToolButton=e.getComponent(u.default),this.resetWidgetTimeBuffer()},t.prototype.onSelect=function(){this._createWidgets(),this.resetWidgetTimeBuffer()},t.prototype.onUse=function(){},t.prototype.onRelease=function(){this._destroyWidgets()},t.prototype._afterUpdate=function(){(this._grabToolButton&&!this._grabToolButton.selected||!this.selected&&!this._hasAtLeastOneSelectedWidget)&&this._destroyWidgets()},t.prototype._createWidgets=function(){for(var e=0;e<this.widgetPrefabs.length;e++)if(!cc.isValid(this._widgetInstances[e])){var t=cc.instantiate(this.widgetPrefabs[e]),r=t.getComponent(p.default);r?(r.transformable=this,t.setParent(this.node.parent),this._widgetInstances[e]=r):(cc.warn(t.name+" prefab root node is missing TransformableWidget component in inspector."),this._widgetInstances[e]=null)}},t.prototype._destroyWidgets=function(){for(var e=0;e<this._widgetInstances.length;e++){var t=this._widgetInstances[e];cc.isValid(t)&&(t.node.destroy(),this._widgetInstances[e]=null)}},Object.defineProperty(t.prototype,"_hasAtLeastOneSelectedWidget",{get:function(){return this._widgetInstances.some(function(e){return e&&e.selected})},enumerable:!1,configurable:!0}),i([y({type:[cc.Prefab],tooltip:"Each prefab needs a TransformableWidget component attached,If not, it will be ignored and a warning will be printed.",visible:!0}),a("design:type",Array)],t.prototype,"_widgetPrefabs",void 0),i([y({tooltip:"Minimum scale that a scale widget will be able to apply to this transformable.",min:0,visible:function(){return this.widgetPrefabs.some(function(e){return e.data.getComponent(f.default)})}}),a("design:type",Object)],t.prototype,"_scaleMin",void 0),i([y({tooltip:"Maximum scale that a scale widget will be able to apply to this transformable.",min:0,visible:function(){return this.widgetPrefabs.some(function(e){return e.data.getComponent(f.default)})}}),a("design:type",Object)],t.prototype,"_scaleMax",void 0),i([y({visible:!0,min:0,max:5,slide:!0,tooltip:"Amount of time widgets will be shown without being used before they fade away."}),a("design:type",Object)],t.prototype,"_widgetPersistTime",void 0),i([y({visible:!0,min:0,max:2,slide:!0,tooltip:"Amount of time widgets will be shown without being used before they fade away."}),a("design:type",Object)],t.prototype,"_widgetFadeTime",void 0),i([h,g("Drawing Component/Transformable")],t)}(l.default);r.default=_,cc._RF.pop()},{"../DrawingUI/DrawingUIToolButton":"DrawingUIToolButton","./Grabbable":"Grabbable","./TransformableScalar":"TransformableScalar","./TransformableWidget":"TransformableWidget"}],Transform:[function(e,t,r){"use strict";cc._RF.push(t,"f6a20EfIzhDu60X8MlvWqMl","Transform");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l,u=s(e("../Util/lerpAngle")),p=s(e("../Util/approximately")),f=cc._decorator,d=f.ccclass,h=f.menu,y=f.property,g=f.executeInEditMode;function _(){return this.transformStrategy===l.Node}function m(e){return function(){return this[e]&&this.transformStrategy===l.Values}}function b(e){var t=[];for(var r in e)t.push(r);return t}(function(e){e[e.Values=0]="Values",e[e.Node=1]="Node"})(l||(l={}));var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyPosition=!1,t.applyScale=!1,t.applyAngle=!1,t.applyOpacity=!1,t.applyColor=!1,t.applyWidth=!1,t.applyHeight=!1,t.applyInEditor=!1,t.transformStrategy=l.Values,t.target=null,t.position=cc.Vec3.ZERO,t.scale=1,t.angle=0,t.opacity=255,t.color=cc.Color.WHITE,t.width=0,t.height=0,t._speed=10,t}var r;return o(t,e),r=t,t.add=function(e,t,n){var o,i,a,s,u=e.addComponent(r);try{for(var p=c(b(t)),f=p.next();!f.done;f=p.next())u[y=f.value]=t[y]}catch(g){o={error:g}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(o)throw o.error}}if(n instanceof cc.Node)u.transformStrategy=l.Node,u.target=n;else{u.transformStrategy=l.Values;try{for(var d=c(b(n)),h=d.next();!h.done;h=d.next()){var y;u[y=h.value]=n[y]}}catch(_){a={error:_}}finally{try{h&&!h.done&&(s=d.return)&&s.call(d)}finally{if(a)throw a.error}}}return u},Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=cc.misc.clampf(e,0,100)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_editorSpeedReadout",{get:function(){var e=this.speed,t=cc.misc.clampf;return 0===e?"Instant":e===t(e,0,25)?"Slow":e===t(e,25,50)?"Medium":100===e?"Maximum":"Fast"},enumerable:!1,configurable:!0}),t.prototype.apply=function(e){var t="number"!=typeof e||Number.isNaN(e)?1:e,r=this.transformStrategy===l.Node?this.target:this;if(r){var n=this.node;if(this.applyPosition){var o=n.position.lerp(r.position,t);n.x=o.x,n.y=o.y,n.z=o.z}this.applyAngle&&(n.angle=u.default(n.angle,r.angle,t)),this.applyScale&&(n.scale=cc.misc.lerp(n.scale,r.scale,t)),this.applyOpacity&&(n.opacity=cc.misc.lerp(n.opacity,r.opacity,t)),this.applyColor&&(n.color=n.color.lerp(r.color,t)),this.applyWidth&&(n.width=cc.misc.lerp(n.width,r.width,t)),this.applyHeight&&(n.height=cc.misc.lerp(n.height,r.height,t))}},Object.defineProperty(t.prototype,"isApplied",{get:function(){var e=this.transformStrategy===l.Node?this.target:this;if(!e)return!0;var t=this.node;return!(this.applyPosition&&!p.default(t.position,e.position,1)||this.applyAngle&&!p.default(t.angle,e.angle,1)||this.applyScale&&!p.default(t.scale,e.scale,.01)||this.applyOpacity&&!p.default(t.opacity,e.opacity,1)||this.applyColor&&!p.default(t.color,e.color,1)||this.applyWidth&&!p.default(t.width,e.width,1)||this.applyHeight&&!p.default(t.height,e.height,1))},enumerable:!1,configurable:!0}),t.prototype.update=function(e){var t=0===this.speed?1:cc.misc.clamp01(e*this.speed*.2);this.apply(t)},t.Strategy=l,i([y(),a("design:type",Object)],t.prototype,"applyPosition",void 0),i([y(),a("design:type",Object)],t.prototype,"applyScale",void 0),i([y(),a("design:type",Object)],t.prototype,"applyAngle",void 0),i([y(),a("design:type",Object)],t.prototype,"applyOpacity",void 0),i([y(),a("design:type",Object)],t.prototype,"applyColor",void 0),i([y(),a("design:type",Object)],t.prototype,"applyWidth",void 0),i([y(),a("design:type",Object)],t.prototype,"applyHeight",void 0),i([y({editorOnly:!0}),a("design:type",Object)],t.prototype,"applyInEditor",void 0),i([y({type:cc.Enum(l)}),a("design:type",Object)],t.prototype,"transformStrategy",void 0),i([y({type:cc.Node,visible:_}),a("design:type",Object)],t.prototype,"target",void 0),i([y({visible:m("applyPosition")}),a("design:type",Object)],t.prototype,"position",void 0),i([y({visible:m("applyScale")}),a("design:type",Object)],t.prototype,"scale",void 0),i([y({visible:m("applyAngle")}),a("design:type",Object)],t.prototype,"angle",void 0),i([y({visible:m("applyOpacity"),min:0,max:255,step:1,slide:!0}),a("design:type",Object)],t.prototype,"opacity",void 0),i([y({visible:m("applyColor")}),a("design:type",Object)],t.prototype,"color",void 0),i([y({visible:m("applyWidth")}),a("design:type",Object)],t.prototype,"width",void 0),i([y({visible:m("applyHeight")}),a("design:type",Object)],t.prototype,"height",void 0),i([y({min:0,max:100,slide:!0,visible:!0,formerlySerializedAs:"speed"}),a("design:type",Object)],t.prototype,"_speed",void 0),i([y({displayName:" ",visible:!0}),a("design:type",String),a("design:paramtypes",[])],t.prototype,"_editorSpeedReadout",null),r=i([d,g,h("Generic Component/Transformer")],t)}(cc.Component);r.default=v,cc._RF.pop()},{"../Util/approximately":"approximately","../Util/lerpAngle":"lerpAngle"}],"TriggerAction - CancelActorSequence":[function(e,t,r){"use strict";cc._RF.push(t,"3f266sqyAlPcKSggUp+Z9mp","TriggerAction - CancelActorSequence");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./TriggerAction")),f=u(e("../Actor/ActorRelay")),d=u(e("../Actor/Actor")),h=e("./TriggerCondition - CheckActorSequencePlaying"),y=u(e("../Util/getComponentsInScene")),g=cc._decorator,_=g.ccclass,m=g.menu,b=g.property,v=cc.js.getClassName,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._relaySelection=h.SelectionStrategy.Any,t._relay=null,t._sequenceSelection=h.SelectionStrategy.Any,t._sequence=null,t._clearSpineActorTracks=!0,t._clearTrackBlend=0,t}return o(t,e),t.prototype.onExecute=function(){var e,t,r,n=this._relay,o=this._relaySelection,i=this._sequence,a=this._sequenceSelection,s=o===h.SelectionStrategy.Any?y.default(f.default):[n];try{for(var l=c(s),u=l.next();!u.done;u=l.next()){var p=u.value;p&&p.isPlaying&&(a!==h.SelectionStrategy.Any&&p.sequenceUUID!==(null===(r=i)||void 0===r?void 0:r._uuid)||this._cancelSequence(p))}}catch(d){e={error:d}}finally{try{u&&!u.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}},t.prototype.onCancel=function(){},t.prototype._cancelSequence=function(e){e.stopSequence(),this._clearSpineActorTracks&&e.sequence&&this._clearSpineActorTracksUsedBySequence(e.sequence)},t.prototype._clearSpineActorTracksUsedBySequence=function(e){var t,r,n,o,i=this._getTracksAndActorsToClear(e),a=i.actorTags,s=i.spineClips,u=i.tracks,p=d.default.getActorsTagged.apply(d.default,l(a));try{for(var f=c(p),h=f.next();!h.done;h=f.next()){var y=h.value;try{for(var g=(n=void 0,c(u)),_=g.next();!_.done;_=g.next()){var m=_.value;y.clearSpineTrack({track:m,blend:this._clearTrackBlend})}}catch(b){n={error:b}}finally{try{_&&!_.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}y.skeleton&&y.audio&&this._stopAudioClipsStartedBySpine(y,s)}}catch(v){t={error:v}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}},t.prototype._stopAudioClipsStartedBySpine=function(e,t){var r,n,o,i,a,s,l=e.skeleton,u=e.audio;if(!l||!u)throw new Error(v(d.default)+" does not have "+v(l)+" or "+v(u)+" components.");try{for(var p=c(t),f=p.next();!f.done;f=p.next()){var h=f.value,y=l.findAnimation(h);if(y)try{for(var g=(o=void 0,c(y.timelines)),_=g.next();!_.done;_=g.next()){var m=_.value;if(m instanceof sp.spine.EventTimeline)try{for(var b=(a=void 0,c(m.events)),w=b.next();!w.done;w=b.next()){var O=w.value,S=(null==O?void 0:O.data).audioPath;if(S){var C=S.substring(S.lastIndexOf("/")+1,S.lastIndexOf("."));u.clipIsPlaying(C)&&u.stopClip(C)}}}catch(P){a={error:P}}finally{try{w&&!w.done&&(s=b.return)&&s.call(b)}finally{if(a)throw a.error}}}}catch(T){o={error:T}}finally{try{_&&!_.done&&(i=g.return)&&i.call(g)}finally{if(o)throw o.error}}}}catch(j){r={error:j}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}},t.prototype._getTracksAndActorsToClear=function(e){var t,r,n,o,i,a,s=[],l=[],u=[];try{for(var p=c(e.timelines),f=p.next();!f.done;f=p.next()){var d=f.value,h=!1;try{for(var y=(n=void 0,c(d.commands)),g=y.next();!g.done;g=y.next()){var _=g.value;"playSpineClip"===_.command&&(l.includes(_.clip)||l.push(_.clip),u.includes(_.track)||(u.push(_.track),h=!0))}}catch(w){n={error:w}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(n)throw n.error}}if(h)try{for(var m=(i=void 0,c(d.actors)),b=m.next();!b.done;b=m.next()){var v=b.value;s.includes(v)||s.push(v)}}catch(O){i={error:O}}finally{try{b&&!b.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}}}catch(S){t={error:S}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}return{actorTags:s,spineClips:l,tracks:u}},t.prototype._getEditorAutoName=function(){var t=this._sequenceSelection===h.SelectionStrategy.Any?"any sequence":this._sequence?'sequence "'+this._sequence.name+'"':"sequence (unset)",r=this._relaySelection===h.SelectionStrategy.Any?"in all relays":this._relay?'in relay "'+this._relay.node.name+'"':"in relay (unset)",n=this._clearSpineActorTracks?"and reset actor tracks":"";return e.prototype._getEditorAutoName.call(this,("Cancel "+t+" "+r+" "+n).replace(/ +/g," ").trim())},i([b({type:cc.Enum(h.SelectionStrategy),visible:!0}),a("design:type",Object)],t.prototype,"_relaySelection",void 0),i([b({type:f.default,visible:function(){return this._relaySelection===h.SelectionStrategy.Specific}}),a("design:type",Object)],t.prototype,"_relay",void 0),i([b({type:cc.Enum(h.SelectionStrategy),visible:!0}),a("design:type",Object)],t.prototype,"_sequenceSelection",void 0),i([b({type:cc.JsonAsset,visible:function(){return this._sequenceSelection===h.SelectionStrategy.Specific}}),a("design:type",Object)],t.prototype,"_sequence",void 0),i([b({visible:!0}),a("design:type",Object)],t.prototype,"_clearSpineActorTracks",void 0),i([b({min:0,max:1,slide:!0,visible:function(){return this._clearSpineActorTracks}}),a("design:type",Object)],t.prototype,"_clearTrackBlend",void 0),i([_,m("Trigger Component/Actions/Cancel Actor Sequence")],t)}(p.default);r.default=w,cc._RF.pop()},{"../Actor/Actor":"Actor","../Actor/ActorRelay":"ActorRelay","../Util/getComponentsInScene":"getComponentsInScene","./TriggerAction":"TriggerAction","./TriggerCondition - CheckActorSequencePlaying":"TriggerCondition - CheckActorSequencePlaying"}],"TriggerAction - CancelTrigger":[function(e,t,r){"use strict";cc._RF.push(t,"88850RvW2dOCKXFFIbfH4Wd","TriggerAction - CancelTrigger");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=c(e("./TriggerAction")),u=c(e("../Util/untilConditionOrTimeout")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetTrigger=null,t}return o(t,e),t.prototype.onExecute=function(e){var t=this.targetTrigger;if(!cc.isValid(t))throw new Error("Target trigger is not valid.");if(t.isExecuting)return t.cancel(),e&&e.instant?void 0:u.default(function(){return!t.isExecuting}).then(function(){})},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.targetTrigger?'"'+this.targetTrigger.node.name+'"':"";return e.prototype._getEditorAutoName.call(this,"Cancel trigger "+t)},i([y({type:s.default}),a("design:type",Object)],t.prototype,"targetTrigger",void 0),i([d,h,f("Trigger Component/Actions/Cancel Trigger")],t)}(l.default);r.default=g,cc._RF.pop()},{"../Util/untilConditionOrTimeout":"untilConditionOrTimeout","./Trigger":"Trigger","./TriggerAction":"TriggerAction"}],"TriggerAction - ClearDrawing":[function(e,t,r){"use strict";cc._RF.push(t,"4ef4fbr6LxI6I6QHcGB9ihz","TriggerAction - ClearDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=s(e("./TriggerActionDrawing")),f=u(e("../Drawing/Drawing")),d=cc._decorator,h=d.menu,y=d.ccclass,g=d.executeInEditMode,_=d.property,m=cc.js.getClassName,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fadeTime=0,t._fadeResolve=function(){},t}return o(t,e),t.prototype.onExecute=function(e){var t=this,r=this.drawing;if(r){if(this._fadeTime>0&&(!e||!e.instant)){var n=r.node.opacity;return new Promise(function(e){t._fadeResolve=e,cc.tween(r.node).to(t._fadeTime,{opacity:0}).call(function(){return r.clear()}).call(function(){r.node.opacity=n}).call(e).tag(696969).start()})}r.clear()}},t.prototype.onCancel=function(){cc.isValid(this.drawing)&&this.drawing.node.stopActionByTag(696969),this._fadeResolve()},t.prototype._getEditorAutoName=function(){var t=this.selector===p.DrawingSelector.Specific?this.drawing?""+this.drawing.node.name:"specific "+m(f.default):"current "+m(f.default),r=this._fadeTime>0?"Clear & Fade":"Clear",n=this._fadeTime>0?"over "+this._fadeTime+" "+(1===this._fadeTime?"second":"seconds"):"";return e.prototype._getEditorAutoName.call(this,r+" "+t+" "+n)},c([_({tooltip:"Convenience propety; fade the drawing before clearing it.",slide:!0,min:0,max:5,visible:!0}),l("design:type",Object)],t.prototype,"_fadeTime",void 0),c([y,g,h("Trigger Component/Actions/Clear Drawing")],t)}(p.default);r.default=b,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","./TriggerActionDrawing":"TriggerActionDrawing"}],"TriggerAction - Concurrent":[function(e,t,r){"use strict";cc._RF.push(t,"6223fjLsxNN863WFkBs4/38","TriggerAction - Concurrent");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&a(t,e,r);return c(t,e),t};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./TriggerAction")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onExecute=function(e){e&&e.instant instanceof u.default&&this.actions.includes(e.instant)&&(e=i(i({},e),{instant:!1}));var t=this.actions.map(function(t){return t.execute(e)});if(t.some(function(e){return e instanceof Promise}))return Promise.all(t).then(function(){})},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"Concurrent")},s([d,h,f("Trigger Component/Actions/Concurrent")],t)}(u.TriggerActionContainer);r.default=y,cc._RF.pop()},{"./TriggerAction":"TriggerAction"}],"TriggerAction - ConfigureDrawingUI":[function(e,t,r){"use strict";cc._RF.push(t,"4dcffVG94ZFv5r3pw1OW8Lj","TriggerAction - ConfigureDrawingUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./Trigger")),p=l(e("./ButtonTrigger")),f=l(e("../DrawingUI/DrawingUI")),d=l(e("../DrawingUI/DrawingUIToolsConfig")),h=l(e("./TriggerActionDrawingUI")),y=l(e("../Util/arrayDescriber")),g=l(e("../Generic/ButtonAsynchronizer")),_=cc._decorator,m=_.menu,b=_.ccclass,v=_.executeInEditMode,w=_.property,O=cc.js.getClassName,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyTools=!1,t._toolPrefabs=[],t.applyColors=!1,t._colors=[],t.applyClear=!1,t._clearTrigger=null,t.applyConfirm=!1,t._confirmTrigger=null,t}return o(t,e),Object.defineProperty(t.prototype,"toolPrefabs",{get:function(){return this._toolPrefabs},set:function(e){this._toolPrefabs=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colors",{get:function(){return this._colors},set:function(e){this._colors=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearTrigger",{get:function(){return this._clearTrigger},set:function(e){this._clearTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"confirmTrigger",{get:function(){return this._confirmTrigger},set:function(e){this._confirmTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(){var e=this.drawingUI;if(e){var t=this.applyTools?e.getComponent(d.default)||e.getComponentInChildren(d.default):null;this.applyTools&&t&&(t.toolPrefabs=s(this._toolPrefabs)),this.applyColors&&(e.colors=s(this._colors)),this.applyClear&&this._clearTrigger?this._clearTrigger.button=e.clearButton:this.applyClear&&!this._clearTrigger&&(g.default.getClickEvents(e.clearButton).length=0),this.applyConfirm&&this._confirmTrigger?this._confirmTrigger.button=e.confirmButton:this.applyConfirm&&!this._confirmTrigger&&(g.default.getClickEvents(e.confirmButton).length=0)}},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=[];this.applyColors&&t.push("colors"),this.applyTools&&t.push("tool"),this.applyClear&&t.push("clear"),this.applyConfirm&&t.push("confirm");var r=Object.keys(this).filter(function(e){return e.includes("apply")}).length;t.length===r&&(t.length=0);var n=this.drawingUI?this.drawingUI.node.name:O(f.default);return e.prototype._getEditorAutoName.call(this,("Configure "+n+" "+y.default(t,"and")).trim())},i([w(),a("design:type",Object)],t.prototype,"applyTools",void 0),i([w({type:cc.Prefab}),a("design:type",Array)],t.prototype,"_toolPrefabs",void 0),i([w({type:cc.Prefab,visible:function(){return this.applyTools},displayName:" "}),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"toolPrefabs",null),i([w(),a("design:type",Object)],t.prototype,"applyColors",void 0),i([w({type:cc.Color}),a("design:type",Array)],t.prototype,"_colors",void 0),i([w({type:cc.Color,visible:function(){return this.applyColors},displayName:" "}),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"colors",null),i([w({tooltip:"A "+O(u.default)+" must be assigned to manage the "+O(f.default)+" confirm button, rather than defining individual event handlers."}),a("design:type",Object)],t.prototype,"applyClear",void 0),i([w({type:p.default}),a("design:type",Object)],t.prototype,"_clearTrigger",void 0),i([w({type:p.default,visible:function(){return this.applyClear},displayName:" "}),a("design:type",Object),a("design:paramtypes",[Object])],t.prototype,"clearTrigger",null),i([w({tooltip:"A "+O(u.default)+" must be assigned to manage the "+O(f.default)+" clear button, rather than defining individual event handlers."}),a("design:type",Object)],t.prototype,"applyConfirm",void 0),i([w({type:p.default}),a("design:type",Object)],t.prototype,"_confirmTrigger",void 0),i([w({type:p.default,visible:function(){return this.applyConfirm},displayName:" "}),a("design:type",Object),a("design:paramtypes",[Object])],t.prototype,"confirmTrigger",null),i([b,v,m("Trigger Component/Actions/Configure Drawing UI")],t)}(h.default);r.default=S,cc._RF.pop()},{"../DrawingUI/DrawingUI":"DrawingUI","../DrawingUI/DrawingUIToolsConfig":"DrawingUIToolsConfig","../Generic/ButtonAsynchronizer":"ButtonAsynchronizer","../Util/arrayDescriber":"arrayDescriber","./ButtonTrigger":"ButtonTrigger","./Trigger":"Trigger","./TriggerActionDrawingUI":"TriggerActionDrawingUI"}],"TriggerAction - Custom":[function(e,t,r){"use strict";cc._RF.push(t,"9ef690a4aNLV7dtY5JvnPTg","TriggerAction - Custom");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=c(e("../Util/EventHandlerUtils")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.actionEvent=new cc.Component.EventHandler,t}var r,n;return o(t,e),t.prototype.onExecute=function(e){var t=l.default.emit([this.actionEvent],e,!1);if(!(e&&e.instant&&t instanceof Promise))return t instanceof Promise?t.then(function(){}):void 0;cc.warn(this.actionEvent.handler,"on node",this.actionEvent.target.name,"did not return a syncronous result with options.instant enabled.")},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.actionEvent||{},r=t.target,n=t.handler,o=t.customEventData;return e.prototype._getEditorAutoName.call(this,((r?r.name:"Custom")+" "+(n||"(unset)")+" "+(o?'"'+o+'"':"")).trim())},i([h({visible:!0,type:cc.Component.EventHandler}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&void 0!==(r=cc.Component)&&r.EventHandler)?n:Object)],t.prototype,"actionEvent",void 0),i([f,d,p("Trigger Component/Actions/Custom")],t)}(s.default);r.default=y,cc._RF.pop()},{"../Util/EventHandlerUtils":"EventHandlerUtils","./TriggerAction":"TriggerAction"}],"TriggerAction - Else":[function(e,t,r){"use strict";cc._RF.push(t,"c823cqmCFVPDa+piWv0CODz","TriggerAction - Else");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var c=a(e("./TriggerAction - Sequential")),s=a(e("./TriggerAction - If")),l=a(e("../Development/Comment")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=cc.js.getClassName,y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"ifAction",{get:function(){var e=this.node.parent.children[this.node.getSiblingIndex()-1];return e&&e.getComponent(s.default)},enumerable:!1,configurable:!0}),t.prototype.check=function(){var e=this.ifAction;return!!e&&!e.check()},t.prototype.onExecute=function(t){if(this.check())return e.prototype.onExecute.call(this,t)},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"Else")},t.prototype._editorAddNameStatusIcons=function(){if(e.prototype._editorAddNameStatusIcons.call(this),!this.ifAction){this.node.name.includes("\u2757\ufe0f")||(this.node.name="\u2757\ufe0f"+this.node.name);var t=h(this)+" needs to be placed after a "+h(s.default);this._editorStatusIconComment&&this._editorStatusIconComment.text.includes(t)||(this._editorStatusIconComment=this._editorStatusIconComment||this.addComponent(l.default),this._editorStatusIconComment.text+=t)}},i([f,d,p("Trigger Component/Actions/Else")],t)}(c.default);r.default=y,cc._RF.pop()},{"../Development/Comment":"Comment","./TriggerAction - If":"TriggerAction - If","./TriggerAction - Sequential":"TriggerAction - Sequential"}],"TriggerAction - ExecuteActorCommand":[function(e,t,r){"use strict";cc._RF.push(t,"5bdd18/0SRDxJvbqTpoSPCT","TriggerAction - ExecuteActorCommand");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p,f=u(e("./TriggerAction")),d=e("./TriggerCondition - ActorAtZone"),h=u(e("../Actor/Actor")),y=e("../Actor/ActorCommands"),g=e("../Actor/CharacterController"),_=u(e("../Util/arrayDescriber")),m=cc._decorator,b=m.menu,v=m.ccclass,w=m.executeInEditMode,O=m.property,S=cc.js.getClassName;(function(e){e[e.PlaySpineClip=0]="PlaySpineClip",e[e.ClearSpineTrack=1]="ClearSpineTrack",e[e.PlayAnimationClip=2]="PlayAnimationClip",e[e.PlayAudioClip=3]="PlayAudioClip",e[e.ClearAudioTrack=4]="ClearAudioTrack",e[e.Transform=5]="Transform",e[e.SetParent=6]="SetParent",e[e.SetEnabled=7]="SetEnabled",e[e.InvokeMethod=8]="InvokeMethod",e[e.SetCharacterFacing=9]="SetCharacterFacing",e[e.MoveCharacter=10]="MoveCharacter"})(p||(p={}));var C={__enums__:y.EASING_TYPES.map(function(e,t){return{name:e,value:t}})},P={__enums__:y.TRANSFORM_CHANNELS.map(function(e,t){return{name:e,value:t}})};function T(e){var t=p[e]||null;return t&&t.charAt(0).toLowerCase()+t.slice(1)}function j(e){return function(){var t=T(this._command);if(!t)return!1;var r=y.createCommand(t);return e in r}}function R(){var e=this._command;return e===p.PlaySpineClip||e===p.ClearSpineTrack||e===p.PlayAudioClip||e===p.ClearAudioTrack||e===p.SetCharacterFacing||e===p.MoveCharacter}var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._actorSelection=d.ActorSelection.ByComponent,t._actors=[null],t._actorTags=[""],t._command=p.PlayAnimationClip,t._node=null,t._component="",t._method="",t._clip="",t._volume=1,t._loop=!1,t._blend=0,t._targetEnabled=!0,t._throttle=1,t._durationInSeconds=1,t._childIndex=-1,t._track=0,t._direction=g.CharacterFacing.Right,t._easing=0,t._channel=[0,1,2,3,4],t}return o(t,e),Object.defineProperty(t.prototype,"_durationInFrames",{get:function(){return 60*this._durationInSeconds},set:function(e){this._durationInSeconds=e/60},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(e){var t,r,n=this._actorSelection===d.ActorSelection.ByComponent?this._actors:h.default.getActorsTagged.apply(h.default,s(this._actorTags)),o={instant:!(!e||!e.instant)},i=this.getAsCommand();try{for(var a=l(n),c=a.next();!c.done;c=a.next()){var u=c.value;u&&u.executeCommand(i,o)}}catch(p){t={error:p}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},t.prototype.onCancel=function(){},t.prototype.getAsCommand=function(){var e=T(this._command);if(!e)throw new Error(p[this._command]+" not recognized.");return y.createCommand(e,{track:this._track,clip:this._clip,node:this._node,component:this._component,method:this._method,loop:this._loop,blend:this._blend,volume:this._volume,throttle:this._throttle,duration:this._durationInSeconds,enabled:this._targetEnabled,childIndex:this._childIndex,easing:y.EASING_TYPES[this._easing],channel:this._channel.map(function(e){return y.TRANSFORM_CHANNELS[e]}),direction:this._direction===g.CharacterFacing.Right?"right":"left"})},t.prototype._getEditorAutoName=function(){var t=this._actorSelection===d.ActorSelection.ByTag,r=(t?this._actorTags:this._actors.map(function(e){return e&&e.node.name})).filter(function(e){return e}),n=(t?"actors tagged "+_.default(r,"or",'"'):_.default(r,"and"))||"Actor",o=p[this._command]||"Command",i=this._component&&this._component!==S(h.default)?this._component.replace("cc.","")+" component ":"",a=this._clip?'"'+this._clip+'"':"",c=this._node?'to "'+this._node.name+'"':"",s="";switch(this._command){case p.ClearSpineTrack:s="Clear spine track "+this._track+" on "+n;break;case p.ClearAudioTrack:s="Clear audio track "+this._track+" on "+n;break;case p.SetEnabled:s=(this._targetEnabled?"Enable":"Disable")+" "+i+" "+n;break;case p.Transform:s="Transform "+n+" "+c;break;case p.SetParent:s="Parent "+n+" "+c;break;case p.PlayAnimationClip:s="Play animation "+a+" on "+n;break;case p.PlaySpineClip:s="Play spine animation "+a+" on "+n;break;case p.PlayAudioClip:s="Play audio "+a+" on "+n;break;case p.SetCharacterFacing:s="Face character "+n.replace("actors","")+" "+(this._direction===g.CharacterFacing.Right?"right":"left");break;case p.MoveCharacter:s=(this._throttle>.5?"Run":"Walk")+" character "+n.replace("actors","")+" "+c;break;case p.InvokeMethod:s="Invoke "+i+" method"+(this._method?'"'+this._method+'"':"")+" on "+n+" ";break;default:s="Execute["+o+"]on "+n+" "}return e.prototype._getEditorAutoName.call(this,s)},i([O({type:cc.Enum(d.ActorSelection),visible:!0}),a("design:type",Object)],t.prototype,"_actorSelection",void 0),i([O({visible:function(){return this._actorSelection===d.ActorSelection.ByComponent},type:h.default}),a("design:type",Array)],t.prototype,"_actors",void 0),i([O({visible:function(){return this._actorSelection===d.ActorSelection.ByTag},type:cc.String}),a("design:type",Array)],t.prototype,"_actorTags",void 0),i([O({type:cc.Enum(p),visible:!0}),a("design:type",Number)],t.prototype,"_command",void 0),i([O({visible:j("node"),type:cc.Node}),a("design:type",Object)],t.prototype,"_node",void 0),i([O({visible:j("component")}),a("design:type",Object)],t.prototype,"_component",void 0),i([O({visible:j("method")}),a("design:type",Object)],t.prototype,"_method",void 0),i([O({visible:j("clip")}),a("design:type",Object)],t.prototype,"_clip",void 0),i([O({visible:j("volume"),min:0,max:1,slide:!0}),a("design:type",Object)],t.prototype,"_volume",void 0),i([O({visible:j("loop")}),a("design:type",Object)],t.prototype,"_loop",void 0),i([O({visible:j("blend"),min:0,max:1,slide:!0}),a("design:type",Object)],t.prototype,"_blend",void 0),i([O({visible:j("enabled"),displayName:"Enabled"}),a("design:type",Object)],t.prototype,"_targetEnabled",void 0),i([O({visible:j("throttle"),min:0,max:1,slide:!0}),a("design:type",Object)],t.prototype,"_throttle",void 0),i([O({min:0,formerlySerializedAs:"_duration"}),a("design:type",Object)],t.prototype,"_durationInSeconds",void 0),i([O({visible:j("duration"),step:1,min:0,displayName:"Duration",tooltip:"In frames."}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"_durationInFrames",null),i([O({visible:j("childIndex"),step:1}),a("design:type",Object)],t.prototype,"_childIndex",void 0),i([O({min:0,step:1,visible:R}),a("design:type",Object)],t.prototype,"_track",void 0),i([O({visible:j("direction"),type:cc.Enum(g.CharacterFacing)}),a("design:type",Object)],t.prototype,"_direction",void 0),i([O({type:C,visible:j("easing")}),a("design:type",Object)],t.prototype,"_easing",void 0),i([O({type:P,visible:j("channel"),displayName:"Channels"}),a("design:type",Object)],t.prototype,"_channel",void 0),i([v,w,b("Trigger Component/Actions/Execute Actor Command")],t)}(f.default);r.default=x,cc._RF.pop()},{"../Actor/Actor":"Actor","../Actor/ActorCommands":"ActorCommands","../Actor/CharacterController":"CharacterController","../Util/arrayDescriber":"arrayDescriber","./TriggerAction":"TriggerAction","./TriggerCondition - ActorAtZone":"TriggerCondition - ActorAtZone"}],"TriggerAction - ExecuteTrigger":[function(e,t,r){"use strict";cc._RF.push(t,"5d7b6ym5nJHMaHajZsLzcRR","TriggerAction - ExecuteTrigger");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=c(e("./TriggerAction")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetTrigger=null,t._force=!1,t}return o(t,e),t.prototype.onExecute=function(e){if(!cc.isValid(this.targetTrigger))throw new Error("Target trigger is not valid.");var t=this._force?this.targetTrigger.execute():this.targetTrigger.tryExecute();if(!e||!e.instant)return t},t.prototype.onCancel=function(){cc.isValid(this.targetTrigger)&&this.targetTrigger.isExecuting&&this.targetTrigger.cancel()},t.prototype._getEditorAutoName=function(){var t=this._force?"Force execute":"execute",r=this.targetTrigger?'"'+this.targetTrigger.node.name+'"':"";return e.prototype._getEditorAutoName.call(this,t+" trigger "+r)},i([h({type:s.default}),a("design:type",Object)],t.prototype,"targetTrigger",void 0),i([h({visible:!0,tooltip:"Force the trigger to execute, even if conditions arn't passing."}),a("design:type",Object)],t.prototype,"_force",void 0),i([f,d,p("Trigger Component/Actions/Execute Trigger")],t)}(l.default);r.default=y,cc._RF.pop()},{"./Trigger":"Trigger","./TriggerAction":"TriggerAction"}],"TriggerAction - If":[function(e,t,r){"use strict";cc._RF.push(t,"654afBlwqNDjpnfll7TV9oK","TriggerAction - If");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var c=a(e("./TriggerAction - Sequential")),s=a(e("./TriggerCondition")),l=cc._decorator,u=l.menu,p=l.ccclass,f=l.executeInEditMode,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._conditions=[],t}return o(t,e),Object.defineProperty(t.prototype,"conditions",{get:function(){return 0===this._conditions.length&&(this._conditions=this.getEnabledComponentsInImmediateChildren(s.default)),this._conditions},enumerable:!1,configurable:!0}),t.prototype.check=function(){return this.conditions.every(function(e){return e.check()})},t.prototype.onExecute=function(t){if(this.check())return e.prototype.onExecute.call(this,t)},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"If")},i([p,f,u("Trigger Component/Actions/If")],t)}(c.default);r.default=d,cc._RF.pop()},{"./TriggerAction - Sequential":"TriggerAction - Sequential","./TriggerCondition":"TriggerCondition"}],"TriggerAction - LoadDrawing":[function(e,t,r){"use strict";cc._RF.push(t,"48dc4nUfxBHWqIJfd+GteHq","TriggerAction - LoadDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerActionDrawing")),l=e("../Drawing/DrawingStorage"),u=c(e("../Drawing/Drawing")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=p.property,g=Math.round,_=Math.max,m=cc.js.getClassName,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageKey="",t.deserialize=!0,t.variation=l.GetVariation.Latest,t._specificVariation=0,t._clampVariation=!0,t._applyCenter=!1,t._applyCenterOfOpacity=!1,t}return o(t,e),Object.defineProperty(t.prototype,"specificVariation",{get:function(){if(this.variation!==l.GetVariation.Specific)throw new Error("Cannot get specific vartion, strategy mismatch.");return this._specificVariation},set:function(e){if(this.variation!==l.GetVariation.Specific)throw new Error("Cannot get specific vartion, strategy mismatch.");this._specificVariation=g(_(e,0))},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(e){var t=this;if(gm.loaded&&this.drawing){var r=gm.drawings.getStoredDrawing({variationStrategy:this.variation,storageKey:this.storageKey,deserialize:this.deserialize,variation:this._calculateVariation()}),n=r instanceof Promise?r.then(function(e){return t._applyDrawing(e)}):this._applyDrawing(r);return e&&e.instant?void 0:n}},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.drawing?""+this.drawing.node.name:m(u.default),r=l.GetVariation[this.variation].toLowerCase(),n=this.storageKey?"from "+r+' "'+this.storageKey+'"':"";return e.prototype._getEditorAutoName.call(this,("Load "+t+" "+n).trim())},t.prototype._calculateVariation=function(){if(!gm.loaded||this.variation!==l.GetVariation.Specific)return 0;var e=gm.drawings._getVariationIds(this.storageKey);return this._specificVariation in e||!this._clampVariation?this._specificVariation:e.length-1},t.prototype._applyDrawing=function(e){var t=this.drawing;if(t&&(e?e.copy(t):t.clear(),e&&this._applyCenter)){var r=this._applyCenterOfOpacity?e.centerOfOpacity:e.center,n=cc.v2(t.node.position).add(r.mul(-1));t.node.setPosition(n)}},i([y(),a("design:type",Object)],t.prototype,"storageKey",void 0),i([y(),a("design:type",Object)],t.prototype,"deserialize",void 0),i([y({type:cc.Enum(l.GetVariation)}),a("design:type",Object)],t.prototype,"variation",void 0),i([y({visible:function(){return this.variation===l.GetVariation.Specific},step:1,min:0}),a("design:type",Object)],t.prototype,"_specificVariation",void 0),i([y({visible:function(){return this.variation===l.GetVariation.Specific},tooltip:"If the specific version specified does not exist, clamp it down to the latest one."}),a("design:type",Object)],t.prototype,"_clampVariation",void 0),i([y({visible:!0}),a("design:type",Object)],t.prototype,"_applyCenter",void 0),i([y({visible:function(){return this._applyCenter}}),a("design:type",Object)],t.prototype,"_applyCenterOfOpacity",void 0),i([d,h,f("Trigger Component/Actions/Load Drawing")],t)}(s.default);r.default=b,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../Drawing/DrawingStorage":"DrawingStorage","./TriggerActionDrawing":"TriggerActionDrawing"}],"TriggerAction - LoadScene":[function(e,t,r){"use strict";cc._RF.push(t,"95417asf+tOZI17Dx2FoSQr","TriggerAction - LoadScene");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var u=l(e("./TriggerAction")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.preloadOnly=!1,t.sceneName="",t}return o(t,e),t.prototype.onExecute=function(e){if(!this.sceneName)throw new Error("No scene name configured.");var t=this._load();if(!e||!e.instant)return t},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.sceneName?' "'+this.sceneName+'"':"";return e.prototype._getEditorAutoName.call(this,(this.preloadOnly?"Prel":"L")+"oad scene "+t)},t.prototype._load=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return gm.loaded?this.preloadOnly?[4,gm.navigator.preloadScene(this.sceneName)]:[3,2]:[2];case 1:return e.sent(),[3,4];case 2:return[4,gm.navigator.loadScene(this.sceneName)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},i([y({tooltip:"Preload the scene only. Another Action down the chain will be required to finish the transition."}),a("design:type",Object)],t.prototype,"preloadOnly",void 0),i([y({tooltip:"Scene to load. Must be included in the build settings to work in production."}),a("design:type",Object)],t.prototype,"sceneName",void 0),i([d,h,f("Trigger Component/Actions/Load Scene")],t)}(u.default);r.default=g,cc._RF.pop()},{"./TriggerAction":"TriggerAction"}],"TriggerAction - PlayActorSequence":[function(e,t,r){"use strict";cc._RF.push(t,"2c9d1SQAqJLJ74BOuXAHqhS","TriggerAction - PlayActorSequence");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=e("../Actor/ActorCommands"),u=c(e("../Actor/ActorRelay")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._actorRelay=null,t._sequence=null,t}return o(t,e),Object.defineProperty(t.prototype,"actorRelay",{get:function(){return this.getComponent(u.default)||this._actorRelay},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sequence",{get:function(){var e=this.actorRelay;return e&&e.node===this.node?e.sequence:this._sequence&&l.assertActorSequence(this._sequence.json)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sequenceName",{get:function(){var e=this.actorRelay;return e&&e.node===this.node?e.sequenceName:this._sequence?this._sequence.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sequenceUUID",{get:function(){var e=this.actorRelay;return e&&e.node===this.node?e.sequenceUUID:this._sequence?this._sequence._uuid:""},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(e){if(this.sequence){if(!cc.isValid(this.actorRelay)){var t=new Error(cc.js.getClassName(u.default)+" is invalid.");if(e&&e.instant)throw t;return Promise.reject(t)}return this.actorRelay._sequence=this._sequence,e&&e.instant?this.actorRelay.applySequence():this.actorRelay.playSequence()}},t.prototype.onCancel=function(){cc.isValid(this)&&cc.isValid(this.actorRelay)&&this.actorRelay.stopSequence()},t.prototype._getEditorAutoName=function(){var t=this.sequenceName?'"'+this.sequenceName+'"':"";return e.prototype._getEditorAutoName.call(this,"Play sequence "+t)},i([y({visible:function(){return!this.getComponent(u.default)},type:u.default}),a("design:type",Object)],t.prototype,"_actorRelay",void 0),i([y({visible:function(){return!!this._actorRelay&&this._actorRelay.node!==this.node},formerlySerializedAs:"_actorSequence",type:cc.JsonAsset}),a("design:type",Object)],t.prototype,"_sequence",void 0),i([d,h,f("Trigger Component/Actions/Play Actor Sequence")],t)}(s.default);r.default=g,cc._RF.pop()},{"../Actor/ActorCommands":"ActorCommands","../Actor/ActorRelay":"ActorRelay","./TriggerAction":"TriggerAction"}],"TriggerAction - Random":[function(e,t,r){"use strict";cc._RF.push(t,"4b60eh+LFNIL5h7ivTjFEb6","TriggerAction - Random");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=e("./TriggerAction"),u=s(e("../Util/RandomUtil")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.property,y=p.executeInEditMode;function g(e){return"function"==typeof e.check}var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._preventDuplicates=!0,t._lastAction=null,t}return o(t,e),t.prototype.onExecute=function(e){if(cc.isValid(this)){var t=this._pickRandomAction();return t?t.execute(e):void 0}},t.prototype.onCancel=function(){var e,t,r=this.actions;try{for(var n=c(r),o=n.next();!o.done;o=n.next()){var i=o.value;cc.isValid(i)&&i.isExecuting&&i.cancel()}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"Random")},t.prototype._pickRandomAction=function(){var e,t=this.actions.filter(function(e){return!g(e)||e.check()});if(0===t.length)return null;do{e=u.default.item(t)}while(this._preventDuplicates&&t.length>1&&e===this._lastAction);return this._lastAction=e,e},i([h({tooltip:"Prevent the same action from running twice in a row.",visible:!0}),a("design:type",Object)],t.prototype,"_preventDuplicates",void 0),i([d,y,f("Trigger Component/Actions/Random")],t)}(l.TriggerActionContainer);r.default=_,cc._RF.pop()},{"../Util/RandomUtil":"RandomUtil","./TriggerAction":"TriggerAction"}],"TriggerAction - SaveDrawing":[function(e,t,r){"use strict";cc._RF.push(t,"e81d0GtschIU6q8yf6rTpse","TriggerAction - SaveDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=s(e("./TriggerActionDrawing")),f=e("../Drawing/DrawingStorage"),d=u(e("../Drawing/Drawing")),h=u(e("../Drawing/DrawingStorageMeta")),y=cc._decorator,g=y.menu,_=y.ccclass,m=y.executeInEditMode,b=y.property,v=cc.js.getClassName,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageKey="",t._obsoleteSerializeFlag=!0,t.serializationStrategy=t._obsoleteSerializeFlag?f.SaveSerializationStrategy.Rasters:f.SaveSerializationStrategy.None,t.variation=f.SaveVariation.Latest,t.maxVariations=1,t}return o(t,e),t.prototype.onExecute=function(e){var t=this;if(gm.loaded&&this.drawing&&(!e||!e.instant)){var r=this.storageKey;return gm.drawings.setNumMaxVariations(r,this.maxVariations),gm.drawings.storeDrawing({storageKey:r,serialize:this.serializationStrategy,variationStrategy:this.variation,drawing:this.drawing.copy()}).then(function(e){t.drawing&&h.default.ensure(t.drawing,e.id)})}},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.selector===p.DrawingSelector.Specific?this.drawing?""+this.drawing.node.name:"specific "+v(d.default):"current "+v(d.default),r=f.SaveVariation[this.variation].toLowerCase(),n=this.storageKey?"as "+r+' "'+this.storageKey+'"':"";return e.prototype._getEditorAutoName.call(this,("Save "+t+" "+n).trim())},c([b(),l("design:type",Object)],t.prototype,"storageKey",void 0),c([b({visible:!1,formerlySerializedAs:"serialize"}),l("design:type",Object)],t.prototype,"_obsoleteSerializeFlag",void 0),c([b({type:cc.Enum(f.SaveSerializationStrategy)}),l("design:type",Object)],t.prototype,"serializationStrategy",void 0),c([b({type:cc.Enum(f.SaveVariation)}),l("design:type",Object)],t.prototype,"variation",void 0),c([b({step:1,min:1}),l("design:type",Object)],t.prototype,"maxVariations",void 0),c([_,m,g("Trigger Component/Actions/Save Drawing")],t)}(p.default);r.default=w,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../Drawing/DrawingStorage":"DrawingStorage","../Drawing/DrawingStorageMeta":"DrawingStorageMeta","./TriggerActionDrawing":"TriggerActionDrawing"}],"TriggerAction - SendAnalytic":[function(e,t,r){"use strict";cc._RF.push(t,"28083+tGbZLS767YoojFqLJ","TriggerAction - SendAnalytic");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=cc._decorator,u=l.menu,p=l.ccclass,f=l.property,d=l.executeInEditMode,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._action="",t._label="",t._value=1,t}return o(t,e),t.prototype.onExecute=function(){if(!gm.loaded)throw new Error(gm.name+" is not loaded.");var e=this._action,t=this._label,r=this._value;gm.statistics.send({action:e,category:"Scribbles & Ink",label:t,value:r,gtag:!0})},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this._action,r=this._label,n=this._value;return e.prototype._getEditorAutoName.call(this,'Send Analytic "'+t+(r?"@"+r:"")+'" with value '+n)},i([f({visible:!0}),a("design:type",Object)],t.prototype,"_action",void 0),i([f({visible:!0}),a("design:type",Object)],t.prototype,"_label",void 0),i([f({visible:!0}),a("design:type",Object)],t.prototype,"_value",void 0),i([p,d,u("Trigger Component/Actions/Send Analytic")],t)}(s.default);r.default=h,cc._RF.pop()},{"./TriggerAction":"TriggerAction"}],"TriggerAction - Sequential":[function(e,t,r){"use strict";cc._RF.push(t,"b6e74a7rwpEGoK2yz2NHviI","TriggerAction - Sequential");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var c=e("./TriggerAction"),s=cc._decorator,l=s.menu,u=s.ccclass,p=s.executeInEditMode,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._cancelQueuedActions=!1,t}return o(t,e),t.prototype.onExecute=function(e){return this._cancelQueuedActions=!1,this._runChildActionsSequentially(e)},t.prototype.onCancel=function(){this._cancelQueuedActions=!0,e.prototype.onCancel.call(this)},t.prototype._runChildActionsSequentially=function(e,t){var r=this;if(void 0===t&&(t=0),cc.isValid(this)&&!this._cancelQueuedActions)for(var n=this.actions,o=function(t){var o=n[t];e&&e.instant===o&&(e=i(i({},e),{instant:!1}));var a=o.execute(e);if(a instanceof Promise)return{value:a.then(function(){return r._runChildActionsSequentially(e,t+1)})}},a=t;a<n.length;a++){var c=o(a);if("object"==typeof c)return c.value}},t.prototype._getEditorAutoName=function(t){return e.prototype._getEditorAutoName.call(this,t||"Sequential")},a([u,p,l("Trigger Component/Actions/Sequential")],t)}(c.TriggerActionContainer);r.default=f,cc._RF.pop()},{"./TriggerAction":"TriggerAction"}],"TriggerAction - SetCreateUIActive":[function(e,t,r){"use strict";cc._RF.push(t,"85629VHQtxFmq/i6LyWejmX","TriggerAction - SetCreateUIActive");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=c(e("../GenericUI/CreateUI")),u=c(e("../Util/getComponentInScene")),p=c(e("../Util/getComponentsInScene")),f=cc._decorator,d=f.menu,h=f.ccclass,y=f.executeInEditMode,g=f.property,_=cc.js.getClassName,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.active=!1,t._createUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"createUI",{get:function(){return cc.isValid(this._createUI)||(this._createUI=u.default(l.default)),this._createUI},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(){var e=this.createUI;e&&(e.enabled=this.active,e.node.active=!0)},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.createUI?this.createUI.node.name:_(l.default);return e.prototype._getEditorAutoName.call(this,this.active?"Activate "+t:"Deactivate "+t)},i([g(),a("design:type",Object)],t.prototype,"active",void 0),i([g({visible:function(){return p.default(l.default).length>1},type:l.default}),a("design:type",Object)],t.prototype,"_createUI",void 0),i([h,y,d("Trigger Component/Actions/Set CreateUI Active")],t)}(s.default);r.default=m,cc._RF.pop()},{"../GenericUI/CreateUI":"CreateUI","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","./TriggerAction":"TriggerAction"}],"TriggerAction - SetDrawingUIState":[function(e,t,r){"use strict";cc._RF.push(t,"c5a3cyZ9pVHX5d1PHNn1s4X","TriggerAction - SetDrawingUIState");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p,f,d=u(e("./TriggerActionDrawingUI")),h=s(e("../DrawingUI/DrawingUI")),y=u(e("../Drawing/Drawing")),g=u(e("../Util/arrayDescriber")),_=(u(e("./TriggerAction - ConfigureDrawingUI")),u(e("../Util/RandomUtil"))),m=s(e("../DrawingUI/DrawingUIToolButton")),b=cc._decorator,v=b.menu,w=b.ccclass,O=b.executeInEditMode,S=b.property,C=cc.js.getClassName;function P(e){var t=e.getComponent(m.default);return!!t&&t.colorStrategy!==m.ColorStrategy.Ignore}(function(e){e[e.Hidden=0]="Hidden",e[e.Shown=1]="Shown"})(p||(p={})),function(e){e[e.Specific=0]="Specific",e[e.Random=1]="Random"}(f||(f={}));var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyCurrentColor=!1,t.applyCurrentColorStrategy=f.Specific,t._currentColor=cc.Color.WHITE,t.applyCurrentTool=!1,t.applyCurrentToolStrategy=f.Specific,t.currentToolPrefab=null,t.applySizeFactor=!1,t.sizeFactor=.5,t.applyTouchSurface=!1,t.touchSurface=null,t.applyDrawing=!1,t.drawing=null,t.applyHidden=!0,t._hidden=p.Shown,t}var r,n,i;return o(t,e),Object.defineProperty(t.prototype,"currentColor",{get:function(){return this._currentColor},set:function(e){this._currentColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this._hidden===p.Hidden},set:function(e){this._hidden=e?p.Hidden:p.Shown},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(){var e=this.drawingUI;e&&(this.applyHidden&&e.setHidden(this.hidden),this.applyTouchSurface&&(e.touchSurface=this.touchSurface||e.node),this.applyCurrentColor&&(e.color=this.currentColor&&this.applyCurrentColorStrategy===f.Specific?this.currentColor:_.default.item(e.colors)),this.applyCurrentTool&&this.applyCurrentToolStrategy===f.Specific&&this.currentToolPrefab?e.selectTool(this.currentToolPrefab.name):this.applyCurrentTool&&this.applyCurrentColorStrategy===f.Random&&e.selectTool(_.default.item(e.tools.filter(P))),this.applySizeFactor&&(e.sizeFactor=this.sizeFactor),this.applyDrawing&&(e.drawing=this.drawing))},t.prototype.onCancel=function(){var e=this.drawingUI;cc.isValid(e)&&e.hidden===this.hidden&&e.setHidden(!this.hidden)},t.prototype._getEditorAutoName=function(){var t=[];this.applyHidden&&t.push(this.hidden?"hidden":"shown"),this.applyCurrentColor&&t.push("current color"),this.applyCurrentTool&&t.push("current tool"),this.applySizeFactor&&t.push("size"),this.applyDrawing&&t.push("drawing"),this.applyTouchSurface&&t.push("touch-surface");var r=this.drawingUI?this.drawingUI.node.name:C(h.default);return e.prototype._getEditorAutoName.call(this,("Set "+r+" "+g.default(t,"and")).trim())},c([S(),l("design:type",Object)],t.prototype,"applyCurrentColor",void 0),c([S({type:cc.Enum(f),visible:function(){return this.applyCurrentColor},displayName:" "}),l("design:type",Number)],t.prototype,"applyCurrentColorStrategy",void 0),c([S(),l("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Color)?r:Object)],t.prototype,"_currentColor",void 0),c([S({visible:function(){return this.applyCurrentColor&&this.applyCurrentColorStrategy===f.Specific},displayName:" "}),l("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Color)?n:Object),l("design:paramtypes",["function"==typeof(i="undefined"!=typeof cc&&cc.Color)?i:Object])],t.prototype,"currentColor",null),c([S(),l("design:type",Object)],t.prototype,"applyCurrentTool",void 0),c([S({type:cc.Enum(f),visible:function(){return this.applyCurrentTool},displayName:" "}),l("design:type",Number)],t.prototype,"applyCurrentToolStrategy",void 0),c([S({type:cc.Prefab,visible:function(){return this.applyCurrentTool&&this.applyCurrentToolStrategy===f.Specific},displayName:" "}),l("design:type",Object)],t.prototype,"currentToolPrefab",void 0),c([S(),l("design:type",Object)],t.prototype,"applySizeFactor",void 0),c([S({visible:function(){return this.applySizeFactor},displayName:" ",slide:!0,min:0,max:1}),l("design:type",Object)],t.prototype,"sizeFactor",void 0),c([S(),l("design:type",Object)],t.prototype,"applyTouchSurface",void 0),c([S({type:cc.Node,visible:function(){return this.applyTouchSurface},displayName:" "}),l("design:type",Object)],t.prototype,"touchSurface",void 0),c([S(),l("design:type",Object)],t.prototype,"applyDrawing",void 0),c([S({type:y.default,visible:function(){return this.applyDrawing},displayName:" "}),l("design:type",Object)],t.prototype,"drawing",void 0),c([S(),l("design:type",Object)],t.prototype,"applyHidden",void 0),c([S({visible:function(){return this.applyHidden},type:cc.Enum(p),displayName:" "}),l("design:type",Object)],t.prototype,"_hidden",void 0),c([w,O,v("Trigger Component/Actions/Set DrawingUI State")],t)}(d.default);r.default=T,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingUI/DrawingUI":"DrawingUI","../DrawingUI/DrawingUIToolButton":"DrawingUIToolButton","../Util/RandomUtil":"RandomUtil","../Util/arrayDescriber":"arrayDescriber","./TriggerAction - ConfigureDrawingUI":"TriggerAction - ConfigureDrawingUI","./TriggerActionDrawingUI":"TriggerActionDrawingUI"}],"TriggerAction - SetGrabbableSelected":[function(e,t,r){"use strict";cc._RF.push(t,"56216RjNiJI44z9+uhs6DKk","TriggerAction - SetGrabbableSelected");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l,u=s(e("./TriggerAction")),p=s(e("../DrawingTools/Grabbable")),f=s(e("../Util/getComponentsInScene")),d=s(e("../Util/RandomUtil")),h=s(e("../Util/sortBy")),y=cc._decorator,g=y.menu,_=y.ccclass,m=y.executeInEditMode,b=y.property,v=h.default({key:"startTimeStamp",sorter:h.default.descending});(function(e){e[e.Specific=0]="Specific",e[e.Latest=1]="Latest",e[e.Random=2]="Random"})(l||(l={}));var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._strategy=l.Specific,t._specificGrabbable=null,t}return o(t,e),Object.defineProperty(t.prototype,"grabbable",{get:function(){switch(this._strategy){case l.Specific:return this._specificGrabbable;case l.Latest:return(e=f.default(p.default)).sort(v)[0]||null;case l.Random:var e;return(e=f.default(p.default)).length>0?d.default.item(e):null;default:var t=this._strategy;throw new Error(t+" is not a valid SelectionStrategy")}},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(){var e,t,r=this.grabbable;try{for(var n=c(f.default(p.default)),o=n.next();!o.done;o=n.next()){var i=o.value;i.selected=i.enabledInHierarchy&&i===r}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,this._strategy!==l.Specific||this._specificGrabbable?this._strategy===l.Specific&&this._specificGrabbable?'Select Grabbable "'+this._specificGrabbable.node.name+'"':"Select "+l[this._strategy].toLowerCase()+" Grabbable":"Deselect Grabbable")},i([b({type:cc.Enum(l),visible:!0}),a("design:type",Object)],t.prototype,"_strategy",void 0),i([b({type:p.default,visible:function(){return this._strategy===l.Specific},formerlySerializedAs:"grabbable"}),a("design:type",Object)],t.prototype,"_specificGrabbable",void 0),i([_,m,g("Trigger Component/Actions/Set Grabbable Selected")],t)}(u.default);r.default=w,cc._RF.pop()},{"../DrawingTools/Grabbable":"Grabbable","../Util/RandomUtil":"RandomUtil","../Util/getComponentsInScene":"getComponentsInScene","../Util/sortBy":"sortBy","./TriggerAction":"TriggerAction"}],"TriggerAction - SetRedrawUIActive":[function(e,t,r){"use strict";cc._RF.push(t,"a9c35b4MI5Lm4AwVGsO0W0V","TriggerAction - SetRedrawUIActive");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./Trigger")),f=u(e("./TriggerAction")),d=s(e("../GenericUI/RedrawUI")),h=u(e("../Util/getComponentsInScene")),y=u(e("../Util/getComponentInScene")),g=cc._decorator,_=g.menu,m=g.ccclass,b=g.executeInEditMode,v=g.property,w=cc.js.getClassName,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.active=!1,t.redrawStoryTrigger=null,t.redrawActionTrigger=null,t.continueActionTrigger=null,t._redrawUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"redrawUI",{get:function(){return cc.isValid(this._redrawUI)||(this._redrawUI=y.default(d.default)),this._redrawUI},enumerable:!1,configurable:!0}),t.prototype.onExecute=function(){var e=this.redrawUI;if(e){var t=this.active,r=this.redrawStoryTrigger,n=this.redrawActionTrigger,o=this.continueActionTrigger;e.enabled=t,e.node.active=!0,e.redrawStoryTrigger=t?r:null,e.redrawActionTrigger=t?n:null,e.continueActionTrigger=t?o:null}},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.redrawUI?this.redrawUI.node.name:w(d.default);return e.prototype._getEditorAutoName.call(this,this.active?"Activate "+t+(this.redrawStoryTrigger?" for "+this.redrawStoryTrigger.node.name:""):"Deactivate "+t)},c([v(),l("design:type",Object)],t.prototype,"active",void 0),c([v({type:p.default,visible:function(){return this.active},tooltip:d.REDRAW_TOOLTIPS.RedrawStoryTrigger}),l("design:type",Object)],t.prototype,"redrawStoryTrigger",void 0),c([v({type:p.default,visible:function(){return this.active},tooltip:d.REDRAW_TOOLTIPS.RedrawActionTrigger}),l("design:type",Object)],t.prototype,"redrawActionTrigger",void 0),c([v({type:p.default,visible:function(){return this.active},tooltip:d.REDRAW_TOOLTIPS.ContinueActionTrigger}),l("design:type",Object)],t.prototype,"continueActionTrigger",void 0),c([v({visible:function(){return h.default(d.default).length>1},type:d.default}),l("design:type",Object)],t.prototype,"_redrawUI",void 0),c([m,b,_("Trigger Component/Actions/Set RedrawUI Active")],t)}(f.default);r.default=O,cc._RF.pop()},{"../GenericUI/RedrawUI":"RedrawUI","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","./Trigger":"Trigger","./TriggerAction":"TriggerAction"}],"TriggerAction - SetScenePhysics":[function(e,t,r){"use strict";cc._RF.push(t,"4a86cfnX+VLcLDmAP+ovX/r","TriggerAction - SetScenePhysics");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=cc._decorator,u=l.menu,p=l.ccclass,f=l.executeInEditMode,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._physics=!0,t._collisions=!0,t}return o(t,e),t.prototype.onExecute=function(){cc.director.getPhysicsManager().enabled=this._physics,cc.director.getCollisionManager().enabled=this._collisions},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this._physics,r=this._collisions,n=t?"enabled":"disabled",o=r?"enabled":"disabled",i=t===r?"physics and collisions "+(n||o):"physics "+n+" and collisions "+o;return e.prototype._getEditorAutoName.call(this,"Set "+i)},i([d({visible:!0}),a("design:type",Object)],t.prototype,"_physics",void 0),i([d({visible:!0}),a("design:type",Object)],t.prototype,"_collisions",void 0),i([p,f,u("Trigger Component/Actions/Set Scene Physics")],t)}(s.default);r.default=h,cc._RF.pop()},{"./TriggerAction":"TriggerAction"}],"TriggerAction - SetTriggerActive":[function(e,t,r){"use strict";cc._RF.push(t,"82fd7pFJkZASJdh8ux6Y3JX","TriggerAction - SetTriggerActive");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=c(e("./TriggerAction")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetTrigger=null,t.targetTriggerActive=!1,t}return o(t,e),t.prototype.onExecute=function(){if(!cc.isValid(this.targetTrigger))throw new Error("Target trigger is not valid.");this.targetTrigger.setActive(this.targetTriggerActive)},t.prototype.onCancel=function(){cc.isValid(this.targetTrigger)&&this.targetTrigger.setActive(!this.targetTriggerActive)},t.prototype._getEditorAutoName=function(){var t=this.targetTrigger?'"'+this.targetTrigger.node.name+'"':"",r=this.targetTriggerActive?"active":"inactive";return e.prototype._getEditorAutoName.call(this,("Set trigger "+t+" "+r).replace("  ",""))},i([h({type:s.default}),a("design:type",Object)],t.prototype,"targetTrigger",void 0),i([h({displayName:"Active"}),a("design:type",Object)],t.prototype,"targetTriggerActive",void 0),i([f,d,p("Trigger Component/Actions/Set Trigger Active")],t)}(l.default);r.default=y,cc._RF.pop()},{"./Trigger":"Trigger","./TriggerAction":"TriggerAction"}],"TriggerAction - SetTriggerData":[function(e,t,r){"use strict";cc._RF.push(t,"fb9621+rZlGoqD25Qc6e4il","TriggerAction - SetTriggerData");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=c(e("./TriggerAction")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetTrigger=null,t.dataKey="",t.value=!1,t}return o(t,e),t.prototype.onExecute=function(){var e=this.targetTrigger&&this.targetTrigger.getData(this.dataKey);e&&(e.value=this.value)},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.targetTrigger?this.targetTrigger.node.name:"(unset)",r=t.toLowerCase().includes("trigger")?"":"trigger ";return e.prototype._getEditorAutoName.call(this,"Set "+r+'"'+t+'" data "'+this.dataKey+'" to '+this.value)},i([h({type:s.default}),a("design:type",Object)],t.prototype,"targetTrigger",void 0),i([h(),a("design:type",Object)],t.prototype,"dataKey",void 0),i([h(),a("design:type",Object)],t.prototype,"value",void 0),i([f,d,p("Trigger Component/Actions/Set Trigger Data")],t)}(l.default);r.default=y,cc._RF.pop()},{"./Trigger":"Trigger","./TriggerAction":"TriggerAction"}],"TriggerAction - Wait":[function(e,t,r){"use strict";cc._RF.push(t,"4520cXwek9MypdBdQf3d/03","TriggerAction - Wait");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=cc._decorator,u=l.menu,p=l.ccclass,f=l.executeInEditMode,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._seconds=1,t._timerId=NaN,t}return o(t,e),t.prototype.onExecute=function(e){var t=this;if(!e||!e.instant)return new Promise(function(e){t._resolve=e,t._timerId=setTimeout(function(){e(),t._resolve=void 0},1e3*t._seconds)})},t.prototype.onCancel=function(){Number.isNaN(this._timerId)||clearTimeout(this._timerId),this._resolve&&(this._resolve(),this._resolve=void 0)},t.prototype._getEditorAutoName=function(){var t=(Math.round(10*this._seconds)/10).toString(),r="1"===t?"second":"seconds";return e.prototype._getEditorAutoName.call(this,"Wait "+t+" "+r)},i([d({visible:!0,min:0}),a("design:type",Object)],t.prototype,"_seconds",void 0),i([p,f,u("Trigger Component/Actions/Wait")],t)}(s.default);r.default=h,cc._RF.pop()},{"./TriggerAction":"TriggerAction"}],TriggerActionDrawingUI:[function(e,t,r){"use strict";cc._RF.push(t,"37221HfdhFOkpr4dctPUgjn","TriggerActionDrawingUI");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerAction")),l=c(e("../DrawingUI/DrawingUI")),u=c(e("../Util/getComponentsInScene")),p=c(e("../Util/getComponentInScene")),f=cc._decorator,d=f.ccclass,h=f.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawingUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"drawingUI",{get:function(){return cc.isValid(this._drawingUI)||(this._drawingUI=p.default(l.default)),this._drawingUI},enumerable:!1,configurable:!0}),i([h({visible:function(){return u.default(l.default).length>1},type:l.default}),a("design:type",Object)],t.prototype,"_drawingUI",void 0),i([d],t)}(s.default);r.default=y,cc._RF.pop()},{"../DrawingUI/DrawingUI":"DrawingUI","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","./TriggerAction":"TriggerAction"}],TriggerActionDrawing:[function(e,t,r){"use strict";cc._RF.push(t,"c6e74poEAdLFL/zBKKvh9bR","TriggerActionDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.DrawingSelector=void 0;var s,l=c(e("./TriggerAction")),u=c(e("../Drawing/Drawing")),p=c(e("../Util/getComponentInScene")),f=c(e("../DrawingUI/DrawingUI")),d=cc._decorator,h=d.ccclass,y=d.property;(function(e){e[e.Current=0]="Current",e[e.Specific=1]="Specific"})(s||(s={})),r.DrawingSelector=s;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selector=s.Current,t._specificDrawing=null,t}return o(t,e),Object.defineProperty(t.prototype,"drawing",{get:function(){if(this.selector===s.Specific)return this._specificDrawing;var e=p.default(f.default);return e&&e.drawing},enumerable:!1,configurable:!0}),i([y({type:cc.Enum(s),tooltip:"Current - Affect the drawing that is currently being drawn on. \nSpecific - Select a drawing in the scene."}),a("design:type",Number)],t.prototype,"selector",void 0),i([y({type:u.default,visible:function(){return this.selector===s.Specific}}),a("design:type",Object)],t.prototype,"_specificDrawing",void 0),i([h],t)}(l.default);r.default=g,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingUI/DrawingUI":"DrawingUI","../Util/getComponentInScene":"getComponentInScene","./TriggerAction":"TriggerAction"}],TriggerAction:[function(e,t,r){"use strict";cc._RF.push(t,"00e00b98KpANbbuchFsXbbZ","TriggerAction");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.TriggerActionContainer=r.isTriggerActionOptions=void 0;var c=a(e("./TriggerChildComponent"));r.isTriggerActionOptions=function(e){if(!e&&"object"!=typeof e)return!1;var t=e;return"boolean"==typeof t.instant||t.instant instanceof s||"boolean"==typeof t.log};var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isExecuting=!1,t}return o(t,e),Object.defineProperty(t.prototype,"isExecuting",{get:function(){return this._isExecuting},enumerable:!1,configurable:!0}),t.prototype.execute=function(e){var t=this;if(this._isExecuting)throw new Error(cc.js.getClassName(this)+" "+this.node.name+" is already executing.");this._isExecuting=!0,this.trigger.node!==this.node&&e&&e.log&&cc.log("\ud83e\udd16",this.trigger.node.name,this.node.name);var r=this.onExecute(e);if(r instanceof Promise&&e&&!0===e.instant&&cc.warn(this.node.name,"did not asyncronously execute triggers when configured with options.instant"),r instanceof Promise)return r.then(function(){t._isExecuting=!1});this._isExecuting=!1},t.prototype.cancel=function(){this._isExecuting&&this.onCancel()},t.prototype._getEditorAutoName=function(t){var r=t.startsWith("Action: ")?t:"Action: "+t.trim();return e.prototype._getEditorAutoName.call(this,r)},t}(c.default);r.default=s;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._actions=[],t}return o(t,e),Object.defineProperty(t.prototype,"actions",{get:function(){return 0===this._actions.length&&(this._actions=this.getEnabledComponentsInImmediateChildren(s)),this._actions},enumerable:!1,configurable:!0}),t.prototype.onCancel=function(){var e,t;if(cc.isValid(this))try{for(var r=i(this.actions),n=r.next();!n.done;n=r.next()){var o=n.value;cc.isValid(o)&&o.cancel()}}catch(a){e={error:a}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t}(s);r.TriggerActionContainer=l,cc._RF.pop()},{"./TriggerChildComponent":"TriggerChildComponent"}],TriggerChildComponent:[function(e,t,r){"use strict";cc._RF.push(t,"c69fdPgs45PYYmkNTQZdwAF","TriggerChildComponent");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=c(e("./TriggerComponent")),u=c(e("../Util/getComponentInParents")),p=c(e("../Development/Comment")),f=cc._decorator,d=f.ccclass,h=f.property,y=cc.js.getClassName,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.editorAutoName=!0,t._trigger=null,t._editorStatusIconComment=null,t}var r;return o(t,e),r=t,Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger||(this._trigger=this._getTrigger()),this._trigger},enumerable:!1,configurable:!0}),t.prototype._isFirstComponent=function(){return this.getComponent(r)===this},t.prototype._getTrigger=function(){var e=this.getComponent(s.default)||u.default(this.node,s.default);if(e||this.node.destroy(),!e)throw new Error(y(this)+" "+this.node.name+" does not have a "+y(s.default));return e},t.prototype._editorUpdate=function(){cc.isValid(this)&&(this._editorRemoveNameStatusIcons(),this._trigger=this._editorValidateTrigger(),!this.editorAutoName||this._trigger&&this._trigger.node===this.node||!this._isFirstComponent()||(this.node.name=this._getEditorAutoName(this.node.name)),this._editorAddNameStatusIcons())},t.prototype._editorValidateTrigger=function(){if(this.getComponent(s.default))throw this.destroy(),new Error(y(this)+" cannot be on the same node as a "+y(s.default));return u.default(this.node,s.default)},t.prototype._getEditorAutoName=function(e){return e.replace(/ +/g," ").replace(/\//g,"|")},t.prototype._editorRemoveNameStatusIcons=function(){for(;this.node.name.includes("\u2757\ufe0f");)this.node.name=this.node.name.replace("\u2757\ufe0f","");for(;this.node.name.includes("\ud83d\udeab");)this.node.name=this.node.name.replace("\ud83d\udeab","")},t.prototype._editorAddNameStatusIcons=function(){this._trigger?this._editorStatusIconComment&&(this._editorStatusIconComment.destroy(),this._editorStatusIconComment=null):(this.node.name+="\u2757\ufe0f",this._editorStatusIconComment=this._editorStatusIconComment||this.addComponent(p.default),this._editorStatusIconComment.text=y(this)+" does not have a "+y(s.default)+"\u2757\ufe0f"),this.node.active||"TriggerData"===y(this)||(this.node.name="\ud83d\udeab"+this.node.name)},i([h({visible:function(){return this._isFirstComponent()},editorOnly:!0,displayName:"Auto Name",tooltip:"Automatically create a descriptive name in the editor."}),a("design:type",Object)],t.prototype,"editorAutoName",void 0),i([h({type:p.default,editorOnly:!0}),a("design:type",Object)],t.prototype,"_editorStatusIconComment",void 0),r=i([d],t)}(l.default);r.default=g,cc._RF.pop()},{"../Development/Comment":"Comment","../Util/getComponentInParents":"getComponentInParents","./Trigger":"Trigger","./TriggerComponent":"TriggerComponent"}],TriggerComponent:[function(e,t,r){"use strict";cc._RF.push(t,"cdb03SKbkVHNrn8ouQ+VPnG","TriggerComponent");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("../Framework/GameComponent")),f=cc._decorator,d=f.ccclass,h=f.executeInEditMode,y=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.getEnabledComponentsInImmediateChildren=function(e){var t,r,n=[];try{for(var o=c(this.node.children),i=o.next();!i.done;i=o.next()){var a=i.value;n.push.apply(n,l(a.getComponents(e)))}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n.filter(function(e){return e.enabled&&e.node.active})},t.prototype.onDestroy=function(){},t.prototype._editorUpdate=function(){},i([d,h,a("design:paramtypes",[])],t)}(p.default);r.default=y,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent"}],"TriggerCondition - ActorAtZone":[function(e,t,r){"use strict";cc._RF.push(t,"a8434W0rjNKj6KcTeFIBltl","TriggerCondition - ActorAtZone");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ActorSelection=void 0;var p,f=u(e("./TriggerZone")),d=u(e("./TriggerCondition")),h=u(e("../Actor/Actor")),y=u(e("../Util/arrayDescriber")),g=cc._decorator,_=g.menu,m=g.ccclass,b=g.executeInEditMode,v=g.property;(function(e){e[e.ByTag=0]="ByTag",e[e.ByComponent=1]="ByComponent"})(p=r.ActorSelection||(r.ActorSelection={}));var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._actorSelection=p.ByComponent,t._actors=[],t._actorTags=[],t._zone=null,t}return o(t,e),t.prototype.check=function(){var e,t,r=this._actorSelection===p.ByTag?h.default.getActorsTagged.apply(h.default,s(this._actorTags)):this._actors;try{for(var n=l(r),o=n.next();!o.done;o=n.next()){var i=o.value;if(i&&(!this._zone||!this._zone.containsActor(i)))return!1}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return!0},t.prototype._getEditorAutoName=function(){var t=this._actorSelection===p.ByTag,r=(t?this._actorTags:this._actors.map(function(e){return e&&e.node.name})).filter(function(e){return e}),n=(t?r.length>0?"Actors tagged "+y.default(r,"and",'"'):"Actors":y.default(r,"and"))||["Actor"],o=t||1!==this._actors.length?"are":"is",i=this._zone?'"'+this._zone.node.name+'"':"Zone";return e.prototype._getEditorAutoName.call(this,n+" "+o+" at "+i)},i([v({type:cc.Enum(p),visible:!0}),a("design:type",Object)],t.prototype,"_actorSelection",void 0),i([v({visible:function(){return this._actorSelection===p.ByComponent},type:h.default}),a("design:type",Array)],t.prototype,"_actors",void 0),i([v({visible:function(){return this._actorSelection===p.ByTag},type:cc.String}),a("design:type",Array)],t.prototype,"_actorTags",void 0),i([v({type:f.default,visible:!0}),a("design:type",Object)],t.prototype,"_zone",void 0),i([m,b,_("Trigger Component/Condition/Actor At Zone")],t)}(d.default);r.default=w,cc._RF.pop()},{"../Actor/Actor":"Actor","../Util/arrayDescriber":"arrayDescriber","./TriggerCondition":"TriggerCondition","./TriggerZone":"TriggerZone"}],"TriggerCondition - And":[function(e,t,r){"use strict";cc._RF.push(t,"4d405y2rvhNo7j+RTgdNpbr","TriggerCondition - And");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=e("./TriggerCondition"),c=cc._decorator,s=c.menu,l=c.ccclass,u=c.executeInEditMode,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.check=function(){return this.conditions.every(function(e){return e.check()})},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"And")},i([l,u,s("Trigger Component/Condition/And")],t)}(a.TriggerConditionContainer);r.default=p,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckActorSequencePlaying":[function(e,t,r){"use strict";cc._RF.push(t,"bcbf91c+TdLR41eoorkY98c","TriggerCondition - CheckActorSequencePlaying");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionStrategy=void 0;var s,l=c(e("../Actor/ActorRelay")),u=c(e("./TriggerCondition")),p=c(e("../Util/getComponentsInScene")),f=cc._decorator,d=f.ccclass,h=f.menu,y=f.property;(function(e){e[e.Any=0]="Any",e[e.Specific=1]="Specific"})(s||(s={})),r.SelectionStrategy=s;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._relaySelection=s.Any,t._relay=null,t._sequenceSelection=s.Any,t._sequence=null,t}return o(t,e),t.prototype.check=function(){var e=this._relay,t=this._relaySelection,r=this._sequence,n=this._sequenceSelection;return(t===s.Any?p.default(l.default):[e]).some(function(e){var t;return e&&e.isPlaying&&(n===s.Any||e.sequenceName===(null===(t=r)||void 0===t?void 0:t.name))})},t.prototype._getEditorAutoName=function(){var t=this._sequenceSelection===s.Any?"Any sequence":this._sequence?'Sequence "'+this._sequence.name+'"':"Sequence (unset)",r=this._relaySelection===s.Any?"":this._relay?'in relay "'+this._relay.node.name+'"':"in relay (unset)";return e.prototype._getEditorAutoName.call(this,(t+" is playing "+r).trim())},i([y({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_relaySelection",void 0),i([y({type:l.default,visible:function(){return this._relaySelection===s.Specific}}),a("design:type",Object)],t.prototype,"_relay",void 0),i([y({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_sequenceSelection",void 0),i([y({type:cc.JsonAsset,visible:function(){return this._sequenceSelection===s.Specific}}),a("design:type",Object)],t.prototype,"_sequence",void 0),i([d,h("Trigger Component/Condition/Check Actor Sequence Playing")],t)}(u.default);r.default=g,cc._RF.pop()},{"../Actor/ActorRelay":"ActorRelay","../Util/getComponentsInScene":"getComponentsInScene","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckCreateUIActive":[function(e,t,r){"use strict";cc._RF.push(t,"650a4ergkVKDLSXXzB6H42h","TriggerCondition - CheckCreateUIActive");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../GenericUI/CreateUI")),l=c(e("./TriggerCondition")),u=c(e("../Util/getComponentInScene")),p=c(e("../Util/getComponentsInScene")),f=cc._decorator,d=f.menu,h=f.ccclass,y=f.property,g=f.executeInEditMode,_=cc.js.getClassName,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._createUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"createUI",{get:function(){return cc.isValid(this._createUI)||(this._createUI=u.default(s.default)),this._createUI},enumerable:!1,configurable:!0}),t.prototype.check=function(){return!!this.createUI&&this.createUI.enabledInHierarchy},t.prototype._getEditorAutoName=function(){var t=this.createUI?this.createUI.node.name:_(s.default);return e.prototype._getEditorAutoName.call(this,t+" is active")},i([y({visible:function(){return p.default(s.default).length>1},type:s.default}),a("design:type",Object)],t.prototype,"_createUI",void 0),i([h,g,d("Trigger Component/Condition/Check CreateUI Active")],t)}(l.default);r.default=m,cc._RF.pop()},{"../GenericUI/CreateUI":"CreateUI","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckCurrentScene":[function(e,t,r){"use strict";cc._RF.push(t,"5c4b3ixVwBBl41sh/44x/Wf","TriggerCondition - CheckCurrentScene");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=cc._decorator,u=l.menu,p=l.ccclass,f=l.executeInEditMode,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sceneName="",t}return o(t,e),t.prototype.check=function(){return cc.director.getScene().name.replace(/-low$/,"")===this.sceneName.replace(/-low$/,"")},t.prototype._getEditorAutoName=function(){var t=this.sceneName?'is "'+this.sceneName+'"':"";return e.prototype._getEditorAutoName.call(this,"Name of current scene "+t)},i([d({tooltip:"Name of current scene."}),a("design:type",Object)],t.prototype,"sceneName",void 0),i([p,f,u("Trigger Component/Condition/Check Current Scene")],t)}(s.default);r.default=h,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckDevice":[function(e,t,r){"use strict";cc._RF.push(t,"0fd20d240tM6KT5TTYkylXF","TriggerCondition - CheckDevice");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("./TriggerCondition")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property;(function(e){e[e.Low=0]="Low",e[e.Std=1]="Std"})(s||(s={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._device=s.Std,t}return o(t,e),t.prototype.check=function(){var e=this._device===s.Low;return gm.loaded&&gm.isLowEndDevice===e},t.prototype._getEditorAutoName=function(){var t=this._device===s.Low;return e.prototype._getEditorAutoName.call(this,"User device is "+(t?"low-end":"standard"))},i([h({type:cc.Enum(s),visible:!0}),a("design:type",Number)],t.prototype,"_device",void 0),i([f,d,p("Trigger Component/Condition/Check Device")],t)}(l.default);r.default=y,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckDrawingColor":[function(e,t,r){"use strict";cc._RF.push(t,"d00dcT7UtlEh7oLlE+ORFni","TriggerCondition - CheckDrawingColor");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("../Drawing/Drawing")),u=c(e("../DrawingUI/DrawingUI")),p=c(e("../Util/Decorators/cache")),f=e("./TriggerActionDrawing"),d=c(e("./TriggerCondition")),h=cc._decorator,y=h.menu,g=h.ccclass,_=h.executeInEditMode,m=h.property;(function(e){e[e.DominantColor=0]="DominantColor",e[e.BackgroundColor=1]="BackgroundColor"})(s||(s={}));var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._color=cc.Color.WHITE,t._strategy=s.DominantColor,t.selector=f.DrawingSelector.Current,t._specificDrawing=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"drawing",{get:function(){return this.selector===f.DrawingSelector.Specific?this._specificDrawing:this.drawingUI&&this.drawingUI.drawing},enumerable:!1,configurable:!0}),t.prototype.check=function(){var e=this.drawing;return!!e&&this._color.equals(e.getDominantColor())},t.prototype._getEditorAutoName=function(){var t=this.selector===f.DrawingSelector.Current?"Current drawing":this.drawing?'Drawing "'+this.drawing.node.name+'"':"Specific drawing",r=s[this._strategy].toLowerCase().replace("color"," color");return e.prototype._getEditorAutoName.call(this,t+" "+r+" is #"+this._color.toHEX("#rrggbb"))},i([m({tooltip:"Color to compare against.",visible:!0}),a("design:type",Object)],t.prototype,"_color",void 0),i([m({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_strategy",void 0),i([m({type:cc.Enum(f.DrawingSelector),tooltip:"Current - Affect the drawing that is currently being drawn on. \nSpecific - Select a drawing in the scene."}),a("design:type","function"==typeof(r=void 0!==f.DrawingSelector&&f.DrawingSelector)?r:Object)],t.prototype,"selector",void 0),i([m({type:l.default,visible:function(){return this.selector===f.DrawingSelector.Specific}}),a("design:type",Object)],t.prototype,"_specificDrawing",void 0),i([p.default({type:u.default,scope:"scene",required:!1}),a("design:type",Object)],t.prototype,"drawingUI",void 0),i([g,_,y("Trigger Component/Condition/Check Drawing Color")],t)}(d.default);r.default=b,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingUI/DrawingUI":"DrawingUI","../Util/Decorators/cache":"cache","./TriggerActionDrawing":"TriggerActionDrawing","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckDrawingEmpty":[function(e,t,r){"use strict";cc._RF.push(t,"c62b46cwIJF571OKe5qTSdn","TriggerCondition - CheckDrawingEmpty");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../Drawing/Drawing")),l=c(e("../DrawingUI/DrawingUI")),u=c(e("../Util/Decorators/cache")),p=e("./TriggerActionDrawing"),f=c(e("./TriggerCondition")),d=cc._decorator,h=d.menu,y=d.ccclass,g=d.executeInEditMode,_=d.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selector=p.DrawingSelector.Current,t._specificDrawing=null,t}var r;return o(t,e),Object.defineProperty(t.prototype,"drawing",{get:function(){return this.selector===p.DrawingSelector.Specific?this._specificDrawing:this.drawingUI&&this.drawingUI.drawing},enumerable:!1,configurable:!0}),t.prototype.check=function(){var e=this.drawing;return!e||0===e.textureCells.length},t.prototype._getEditorAutoName=function(){var t=this.selector===p.DrawingSelector.Current?"Current drawing":this.drawing?'Drawing "'+this.drawing.node.name+'"':"Specific drawing";return e.prototype._getEditorAutoName.call(this,t+" is empty")},i([_({type:cc.Enum(p.DrawingSelector),tooltip:"Current - Affect the drawing that is currently being drawn on. \nSpecific - Select a drawing in the scene."}),a("design:type","function"==typeof(r=void 0!==p.DrawingSelector&&p.DrawingSelector)?r:Object)],t.prototype,"selector",void 0),i([_({type:s.default,visible:function(){return this.selector===p.DrawingSelector.Specific}}),a("design:type",Object)],t.prototype,"_specificDrawing",void 0),i([u.default({type:l.default,scope:"scene",required:!1}),a("design:type",Object)],t.prototype,"drawingUI",void 0),i([y,g,h("Trigger Component/Condition/Check Drawing Empty")],t)}(f.default);r.default=m,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingUI/DrawingUI":"DrawingUI","../Util/Decorators/cache":"cache","./TriggerActionDrawing":"TriggerActionDrawing","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckDrawingSaved":[function(e,t,r){"use strict";cc._RF.push(t,"9b862T5ASZMN7FaUYTTiA0Q","TriggerCondition - CheckDrawingSaved");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=e("../Drawing/DrawingStorage"),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageKey="",t}return o(t,e),t.prototype.check=function(){return gm.loaded&&gm.drawings.hasStoredDrawing({storageKey:this.storageKey,deserialize:!0,variationStrategy:l.GetVariation.Latest})},t.prototype._getEditorAutoName=function(){var t=this.storageKey?' "'+this.storageKey+'" ':"";return e.prototype._getEditorAutoName.call(this,("Drawing"+t+"is saved").trim())},i([h(),a("design:type",Object)],t.prototype,"storageKey",void 0),i([f,d,p("Trigger Component/Condition/Check Drawing Saved")],t)}(s.default);r.default=y,cc._RF.pop()},{"../Drawing/DrawingStorage":"DrawingStorage","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckDrawingUIState":[function(e,t,r){"use strict";cc._RF.push(t,"ec7bbAvVOlIUZ8vCzO98D7s","TriggerCondition - CheckDrawingUIState");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=c(e("../DrawingUI/DrawingUI")),u=c(e("../Util/getComponentInScene")),p=c(e("../Util/getComponentsInScene")),f=c(e("../Util/arrayDescriber")),d=c(e("../Util/approximately")),h=c(e("../Drawing/Drawing")),y=cc._decorator,g=y.menu,_=y.ccclass,m=y.property,b=y.executeInEditMode,v=cc.js.getClassName,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkHidden=!0,t.checkToolsHidden=!1,t.checkCurrentColor=!1,t._color=cc.Color.WHITE,t.checkSelectedTool=!1,t._toolPrefab=null,t.checkCurrentSizeFactor=!1,t._sizeFactor=0,t.checkCurrentDrawing=!1,t._drawing=null,t._drawingUI=null,t}return o(t,e),t.prototype.check=function(){var e=this.drawingUI;return!(!(!this.checkHidden||e&&e.hidden)||!(!this.checkToolsHidden||e&&e.toolsHidden)||!e||this.checkCurrentColor&&!this._color.equals(e.color)||this.checkSelectedTool&&this._toolPrefab&&e.selectedTool&&e.selectedTool.node.name!==this._toolPrefab.name||this.checkCurrentSizeFactor&&!d.default(e.sizeFactor,this._sizeFactor,.125)||this.checkCurrentDrawing&&e.drawing!==this._drawing)},Object.defineProperty(t.prototype,"drawingUI",{get:function(){return cc.isValid(this._drawingUI)||(this._drawingUI=u.default(l.default)),this._drawingUI},enumerable:!1,configurable:!0}),t.prototype._getEditorAutoName=function(){var t=v(l.default),r=[];return this.checkHidden&&r.push("is hidden"),this.checkToolsHidden&&r.push("tools are hidden"),this.checkCurrentColor&&r.push("color is #"+this._color.toHEX("#rrggbb")),this.checkSelectedTool&&r.push("selected tool"+(this._toolPrefab?" is "+this._toolPrefab.name:"")),this.checkCurrentSizeFactor&&r.push("current size factor is "+this._sizeFactor),this.checkCurrentDrawing&&r.push("current drawing"+(this._drawing?' is "'+this._drawing.node.name+'"':"")),e.prototype._getEditorAutoName.call(this,t+" "+f.default(r,"and"))},i([m(),a("design:type",Object)],t.prototype,"checkHidden",void 0),i([m(),a("design:type",Object)],t.prototype,"checkToolsHidden",void 0),i([m(),a("design:type",Object)],t.prototype,"checkCurrentColor",void 0),i([m({visible:function(){return this.checkCurrentColor}}),a("design:type",Object)],t.prototype,"_color",void 0),i([m(),a("design:type",Object)],t.prototype,"checkSelectedTool",void 0),i([m({visible:function(){return this.checkSelectedTool},type:cc.Prefab}),a("design:type",Object)],t.prototype,"_toolPrefab",void 0),i([m(),a("design:type",Object)],t.prototype,"checkCurrentSizeFactor",void 0),i([m({min:0,max:1,slide:!0,visible:function(){return this.checkCurrentSizeFactor}}),a("design:type",Object)],t.prototype,"_sizeFactor",void 0),i([m(),a("design:type",Object)],t.prototype,"checkCurrentDrawing",void 0),i([m({type:h.default,visible:function(){return this.checkCurrentDrawing}}),a("design:type",Object)],t.prototype,"_drawing",void 0),i([m({visible:function(){return p.default(l.default).length>1},type:l.default}),a("design:type",Object)],t.prototype,"_drawingUI",void 0),i([_,b,g("Trigger Component/Condition/Check Drawing UI State")],t)}(s.default);r.default=w,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingUI/DrawingUI":"DrawingUI","../Util/approximately":"approximately","../Util/arrayDescriber":"arrayDescriber","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckGrabbableSelected":[function(e,t,r){"use strict";cc._RF.push(t,"d130dpG1QFIca5ZbGC5GBMu","TriggerCondition - CheckGrabbableSelected");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=c(e("../DrawingTools/Grabbable")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.grabbable=null,t}return o(t,e),t.prototype.check=function(){return!!this.grabbable&&this.grabbable.selected},t.prototype._getEditorAutoName=function(){var t=this.grabbable?'"'+this.grabbable.node.name+'"':"";return e.prototype._getEditorAutoName.call(this,("Grabbable "+t+" is selected").replace(/ {2}/," "))},i([h({tooltip:"Grabbable to check",type:l.default}),a("design:type",Object)],t.prototype,"grabbable",void 0),i([f,d,p("Trigger Component/Condition/Check Grabbable Selected")],t)}(s.default);r.default=y,cc._RF.pop()},{"../DrawingTools/Grabbable":"Grabbable","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckLoadingScene":[function(e,t,r){"use strict";cc._RF.push(t,"f18f1pKoZBPjJQXDBZ52pWu","TriggerCondition - CheckLoadingScene");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("./TriggerCondition")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property;(function(e){e[e.Specific=0]="Specific",e[e.Any=1]="Any"})(s||(s={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkStrategy=s.Specific,t.sceneName="",t}return o(t,e),t.prototype.check=function(){if(!gm.loaded)return!1;var e=gm.navigator.loadingScene;return this.checkStrategy===s.Specific?this.sceneName.length>0&&this.sceneName.replace(/-low$/,"")===e.replace(/-low$/,""):e.length>0},t.prototype._getEditorAutoName=function(){var t=this.checkStrategy===s.Specific?'Scene "'+this.sceneName+'"':"Any scene";return e.prototype._getEditorAutoName.call(this,t+" is loading")},i([h({type:cc.Enum(s)}),a("design:type",Object)],t.prototype,"checkStrategy",void 0),i([h({tooltip:"Name of current scene.",visible:function(){return this.checkStrategy===s.Specific}}),a("design:type",Object)],t.prototype,"sceneName",void 0),i([f,d,p("Trigger Component/Condition/Check Loading Scene")],t)}(l.default);r.default=y,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckRedrawUIActive":[function(e,t,r){"use strict";cc._RF.push(t,"24e00JJaq5E5YWKli9TWYAz","TriggerCondition - CheckRedrawUIActive");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=c(e("../GenericUI/RedrawUI")),u=c(e("../Util/getComponentsInScene")),p=c(e("../Util/getComponentInScene")),f=cc._decorator,d=f.menu,h=f.ccclass,y=f.property,g=f.executeInEditMode,_=cc.js.getClassName,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._redrawUI=null,t}return o(t,e),Object.defineProperty(t.prototype,"redrawUI",{get:function(){return cc.isValid(this._redrawUI)||(this._redrawUI=p.default(l.default)),this._redrawUI},enumerable:!1,configurable:!0}),t.prototype.check=function(){return!!this.redrawUI&&(!!this.redrawUI.enabledInHierarchy||!!this.redrawUI.redrawActionTrigger&&this.redrawUI.redrawActionTrigger.isExecuting||!!this.redrawUI.continueActionTrigger&&this.redrawUI.continueActionTrigger.isExecuting)},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,_(l.default)+" is active")},i([y({visible:function(){return u.default(l.default).length>1},type:l.default}),a("design:type",Object)],t.prototype,"_redrawUI",void 0),i([h,g,d("Trigger Component/Condition/Check RedrawUI Active")],t)}(s.default);r.default=m,cc._RF.pop()},{"../GenericUI/RedrawUI":"RedrawUI","../Util/getComponentInScene":"getComponentInScene","../Util/getComponentsInScene":"getComponentsInScene","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckTriggerActive":[function(e,t,r){"use strict";cc._RF.push(t,"b523573bYFFIa4C1cviVwTq","TriggerCondition - CheckTriggerActive");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("./Trigger")),u=c(e("./TriggerCondition")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=p.property;(function(e){e[e.Enabled=0]="Enabled",e[e.Executing=1]="Executing"})(s||(s={}));var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetTrigger=null,t._activeType=s.Enabled,t}return o(t,e),t.prototype.check=function(){return!!this.targetTrigger&&(this._activeType===s.Enabled?this.targetTrigger.enabledInHierarchy:this.targetTrigger.isExecuting)},t.prototype._getEditorAutoName=function(){var t=this.targetTrigger?'"'+this.targetTrigger.node.name+'"':"",r=s[this._activeType].toLowerCase();return e.prototype._getEditorAutoName.call(this,"Trigger "+t+" is "+r)},i([y({type:l.default}),a("design:type",Object)],t.prototype,"targetTrigger",void 0),i([y({type:cc.Enum(s),visible:!0}),a("design:type",Object)],t.prototype,"_activeType",void 0),i([d,h,f("Trigger Component/Condition/Check Trigger Active")],t)}(u.default);r.default=g,cc._RF.pop()},{"./Trigger":"Trigger","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - CheckTriggerData":[function(e,t,r){"use strict";cc._RF.push(t,"cab57Kkk1xMnr+720eYwJ18","TriggerCondition - CheckTriggerData");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./Trigger")),l=c(e("./TriggerCondition")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetTrigger=null,t.dataKey="",t.value=!1,t}return o(t,e),t.prototype.check=function(){var e=this.targetTrigger,t=e&&e.getData(this.dataKey);return null!==t&&t.value===this.value},t.prototype.onCancel=function(){},t.prototype._getEditorAutoName=function(){var t=this.targetTrigger?this.targetTrigger.node.name:"(unset)",r=t.toLowerCase().includes("trigger")?"":"Trigger ";return e.prototype._getEditorAutoName.call(this,r+'"'+t+'" data "'+this.dataKey+'" is '+this.value)},i([h({type:s.default}),a("design:type",Object)],t.prototype,"targetTrigger",void 0),i([h(),a("design:type",Object)],t.prototype,"dataKey",void 0),i([h({}),a("design:type",Object)],t.prototype,"value",void 0),i([f,d,p("Trigger Component/Condition/Check Trigger Data")],t)}(l.default);r.default=y,cc._RF.pop()},{"./Trigger":"Trigger","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - Custom":[function(e,t,r){"use strict";cc._RF.push(t,"a3678x3Lm1IFL9Tv4/88rOC","TriggerCondition - Custom");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=c(e("../Util/EventHandlerUtils")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.conditionEvent=new cc.Component.EventHandler,t}var r,n;return o(t,e),t.prototype.check=function(){if(!this.conditionEvent)return!1;var e=l.default.emit([this.conditionEvent],null,!1);if(e instanceof Promise)throw new Error('Method handler "'+this.conditionEvent.handler+'" can not return an asyncronous result.');return!!e[0]},t.prototype._getEditorAutoName=function(){var t=this.conditionEvent||{},r=t.target,n=t.handler;return e.prototype._getEditorAutoName.call(this,(r?r.name:"Custom")+" "+(n||"condition"))},i([h({type:cc.Component.EventHandler,visible:!0}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&void 0!==(r=cc.Component)&&r.EventHandler)?n:Object)],t.prototype,"conditionEvent",void 0),i([f,d,p("Trigger Component/Condition/Custom")],t)}(s.default);r.default=y,cc._RF.pop()},{"../Util/EventHandlerUtils":"EventHandlerUtils","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - ElapsedTime":[function(e,t,r){"use strict";cc._RF.push(t,"1bbdedZuFtOaKDKCW7go+PP","TriggerCondition - ElapsedTime");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s,l=c(e("./TriggerCondition")),u=cc._decorator,p=u.menu,f=u.ccclass,d=u.executeInEditMode,h=u.property;(function(e){e[e.AtLeast=0]="AtLeast",e[e.AtMost=1]="AtMost"})(s||(s={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._comparer=s.AtLeast,t._seconds=1,t._sceneStart=Date.now(),t}return o(t,e),t.prototype.onSceneStart=function(){this._sceneStart=Date.now()},t.prototype.check=function(){var e=(Date.now()-this._sceneStart)/1e3;switch(this._comparer){case s.AtLeast:return e>=this._seconds;case s.AtMost:return e<=this._seconds;default:var t=this._comparer;throw new Error("CompareOption "+(s[t]||t)+" is not recognized.")}},t.prototype._getEditorAutoName=function(){var t=(Math.round(10*this._seconds)/10).toString(),r="1"===t?"second":"seconds",n=s[this._comparer].replace("Least"," least").replace("Most"," most");return e.prototype._getEditorAutoName.call(this,n+" "+t+" "+r+" has elapsed")},i([h({type:cc.Enum(s),visible:!0}),a("design:type",Number)],t.prototype,"_comparer",void 0),i([h({visible:!0,min:0}),a("design:type",Object)],t.prototype,"_seconds",void 0),i([f,d,p("Trigger Component/Condition/Elapsed Time")],t)}(l.default);r.default=y,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - Not":[function(e,t,r){"use strict";cc._RF.push(t,"08222Tx2XFLipAFaS/YyNHX","TriggerCondition - Not");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=e("./TriggerCondition"),c=cc._decorator,s=c.menu,l=c.ccclass,u=c.executeInEditMode,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.check=function(){return!this.conditions.every(function(e){return e.check()})},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"Not")},i([l,u,s("Trigger Component/Condition/Not")],t)}(a.TriggerConditionContainer);r.default=p,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - Or":[function(e,t,r){"use strict";cc._RF.push(t,"8019e525o1D8auHgrzpstwe","TriggerCondition - Or");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=e("./TriggerCondition"),c=cc._decorator,s=c.menu,l=c.ccclass,u=c.executeInEditMode,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.check=function(){return 0===this.conditions.length||this.conditions.some(function(e){return e.check()})},t.prototype._getEditorAutoName=function(){return e.prototype._getEditorAutoName.call(this,"Or")},i([l,u,s("Trigger Component/Condition/Or")],t)}(a.TriggerConditionContainer);r.default=p,cc._RF.pop()},{"./TriggerCondition":"TriggerCondition"}],"TriggerCondition - Random":[function(e,t,r){"use strict";cc._RF.push(t,"24487rSK+lJSaMwxHT1kW0m","TriggerCondition - Random");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=c(e("../Util/RandomUtil")),u=c(e("../Util/chunker")),p=cc._decorator,f=p.menu,d=p.ccclass,h=p.executeInEditMode,y=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._chance=.5,t._interval=.125,t._pass=!1,t._randomizeTimer=u.default(),t}return o(t,e),t.prototype.check=function(){return this._randomizeTimer.check(this._interval)&&this._randomize(),this._pass},t.prototype.onLoad=function(){this._randomize()},t.prototype._randomize=function(){this._pass=l.default.float()<this._chance},t.prototype._getEditorAutoName=function(){var t=""+Math.round(100*this._chance);return e.prototype._getEditorAutoName.call(this,t+"% chance")},i([y({min:0,max:1,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_chance",void 0),i([y({min:0,max:1,slide:!0,visible:!0}),a("design:type",Object)],t.prototype,"_interval",void 0),i([d,h,f("Trigger Component/Condition/Random")],t)}(s.default);r.default=g,cc._RF.pop()},{"../Util/RandomUtil":"RandomUtil","../Util/chunker":"chunker","./TriggerCondition":"TriggerCondition"}],"TriggerCondition - UserIsDrawing":[function(e,t,r){"use strict";cc._RF.push(t,"a0948A3W2ZBNpMVoKP49u9V","TriggerCondition - UserIsDrawing");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("./TriggerCondition")),l=e("./TriggerActionDrawing"),u=c(e("../Drawing/Drawing")),p=c(e("../DrawingUI/DrawingUI")),f=c(e("../DrawingTools/DrawingTool")),d=c(e("../Util/Decorators/cache")),h=cc._decorator,y=h.menu,g=h.ccclass,_=h.property,m=h.executeInEditMode,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selector=l.DrawingSelector.Current,t._specificDrawing=null,t._toolUseTime=4,t._toolRecentUseThreshold=3,t._toolUseTimeBuffer=0,t._toolLastUsedTimeStamp=0,t}var r;return o(t,e),Object.defineProperty(t.prototype,"drawing",{get:function(){return this.selector===l.DrawingSelector.Specific?this._specificDrawing:this.drawingUI&&this.drawingUI.drawing},enumerable:!1,configurable:!0}),t.prototype.update=function(e){var t=this.drawingUI,r=this.drawing;if(!t||!r||t.hidden||t.drawing!==r)return this._toolLastUsedTimeStamp=0,void(this._toolUseTimeBuffer=0);var n=t.selectedTool instanceof f.default?t.selectedTool:null;this._toolLastUsedTimeStamp=Math.max(this._toolLastUsedTimeStamp,n&&n.lastCreatedTimeStamp||0),n&&n.isDrawing&&(this._toolUseTimeBuffer+=e)},t.prototype.check=function(){var e=this.drawing,t=!e||0===e.numTextureCells,r=this._toolUseTimeBuffer>this._toolUseTime,n=this._toolLastUsedTimeStamp>=Date.now()-1e3*this._toolRecentUseThreshold;return!t&&r&&n},t.prototype._getEditorAutoName=function(){var t=this.selector===l.DrawingSelector.Current?"current drawing":this.drawing?"drawing "+this.drawing.node.name:"specific drawing";return e.prototype._getEditorAutoName.call(this,"User has drawn on "+t+" within "+this._toolRecentUseThreshold+" seconds")},i([_({type:cc.Enum(l.DrawingSelector),tooltip:"Current - Affect the drawing that is currently being drawn on. \nSpecific - Select a drawing in the scene."}),a("design:type","function"==typeof(r=void 0!==l.DrawingSelector&&l.DrawingSelector)?r:Object)],t.prototype,"selector",void 0),i([_({type:u.default,visible:function(){return this.selector===l.DrawingSelector.Specific}}),a("design:type",Object)],t.prototype,"_specificDrawing",void 0),i([_({min:0,visible:!0,tooltip:"Amount of time tools must be used on drawing before being considered."}),a("design:type",Object)],t.prototype,"_toolUseTime",void 0),i([_({min:0,visible:!0,tooltip:"Time since a tool must have been used to be considered"}),a("design:type",Object)],t.prototype,"_toolRecentUseThreshold",void 0),i([d.default({type:p.default,scope:"scene",required:!1}),a("design:type",Object)],t.prototype,"drawingUI",void 0),i([g,m,y("Trigger Component/Condition/User Is Drawing")],t)}(s.default);r.default=b,cc._RF.pop()},{"../Drawing/Drawing":"Drawing","../DrawingTools/DrawingTool":"DrawingTool","../DrawingUI/DrawingUI":"DrawingUI","../Util/Decorators/cache":"cache","./TriggerActionDrawing":"TriggerActionDrawing","./TriggerCondition":"TriggerCondition"}],TriggerCondition:[function(e,t,r){"use strict";cc._RF.push(t,"1c27e3LSfhOQoAnoSW5TCXx","TriggerCondition");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.TriggerConditionContainer=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype._getEditorAutoName=function(t){return e.prototype._getEditorAutoName.call(this,t.startsWith("Condition: ")?t:"Condition: "+t.trim())},t}(i(e("./TriggerChildComponent")).default);r.default=a;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._conditions=[],t}return o(t,e),Object.defineProperty(t.prototype,"conditions",{get:function(){return 0===this._conditions.length&&(this._conditions=this.getEnabledComponentsInImmediateChildren(a)),this._conditions},enumerable:!1,configurable:!0}),t}(a);r.TriggerConditionContainer=c,cc._RF.pop()},{"./TriggerChildComponent":"TriggerChildComponent"}],TriggerData:[function(e,t,r){"use strict";cc._RF.push(t,"20eda6mu1xNm5Nm5DBFlENz","TriggerData");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.TriggerDataSerialization=void 0;var u,p=l(e("./TriggerChildComponent")),f=l(e("./Trigger")),d=cc._decorator,h=d.ccclass,y=d.property,g=d.menu,_=d.executeInEditMode,m=cc.js.getClassName;(function(e){e[e.Scene=0]="Scene",e[e.Session=1]="Session",e[e.Always=2]="Always"})(u||(u={})),r.TriggerDataSerialization=u;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.serialization=u.Scene,t.dataKey="",t._boolean=!1,t}var r;return o(t,e),r=t,Object.defineProperty(t.prototype,"editorAutoName",{get:function(){return!1},set:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._boolean},set:function(e){this.setValue(e)},enumerable:!1,configurable:!0}),t.prototype.onLostFocusInEditor=function(){this._validateDataKey(!0)},t.prototype.onSceneStart=function(){if(this._validateDataKey(!0))return this._restoreValue()},t.prototype.setValue=function(e){return this._boolean=e,this._storeValue()},t.prototype.onBuildPreProcess=function(){return!this._validateDataKey(!1)},t.prototype._restoreValue=function(){return c(this,void 0,Promise,function(){var e,t;return s(this,function(r){switch(r.label){case 0:if(!gm.loaded||!this.dataKey)return[2];switch(this.serialization){case u.Scene:return[3,1];case u.Session:case u.Always:return[3,2]}return[3,4];case 1:return[3,5];case 2:return[4,gm.storage.get({store:"trigger-data",id:this.dataKey,memory:this.serialization===u.Session})];case 3:return e=r.sent(),this._boolean=!!e,[3,5];case 4:throw t=this.serialization,new Error((u[t]||t)+" is not recognized.");case 5:return[2]}})})},t.prototype._storeValue=function(){return c(this,void 0,Promise,function(){var e,t;return s(this,function(r){switch(r.label){case 0:if(!gm.loaded||!this.dataKey)return[2];switch(this.serialization){case u.Scene:return[3,1];case u.Session:case u.Always:return[3,2]}return[3,4];case 1:return[3,5];case 2:return[4,gm.storage.set({store:"trigger-data",id:this.dataKey,memory:this.serialization===u.Session,value:this._boolean})];case 3:return e=r.sent(),this._boolean=!!e,[3,5];case 4:throw t=this.serialization,new Error((u[t]||t)+" is not recognized.");case 5:return[2]}})})},t.prototype._getTrigger=function(){var e=this.getComponent(f.default);if(!e)throw this.destroy(),new Error(m(this)+" must be attached to a "+m(f.default)+" component");return e},t.prototype._editorValidateTrigger=function(){return this.getComponent(f.default)},t.prototype._validateDataKey=function(e){var t=this;return this.dataKey?!this.getComponents(r).filter(function(e){return e!==t&&cc.isValid(e,!0)}).some(function(e){return e.dataKey&&e.dataKey===t.dataKey})||(e&&cc.error(m(this)+' dataKey "'+this.dataKey+'" must be unique on node.'),this.destroy(),!1):(e&&cc.warn(m(this)+" on node "+this.node.name+" did not have a data key."),this.destroy(),!1)},i([y({override:!0,visible:!1}),a("design:type",Boolean),a("design:paramtypes",[Boolean])],t.prototype,"editorAutoName",null),i([y({type:cc.Enum(u),tooltip:"Always:\n  Value will persist between sessions.\nSession:\n  Value will persist during this session only.Scene:\n  Value will persist until the scene is changed."}),a("design:type",Object)],t.prototype,"serialization",void 0),i([y(),a("design:type",Object)],t.prototype,"dataKey",void 0),i([y({visible:!0,displayName:"Default Boolean Value",tooltip:""}),a("design:type",Object)],t.prototype,"_boolean",void 0),r=i([h,_,g("Trigger Component/Trigger Data")],t)}(p.default);r.default=b,cc._RF.pop()},{"./Trigger":"Trigger","./TriggerChildComponent":"TriggerChildComponent"}],TriggerSwitch:[function(e,t,r){"use strict";cc._RF.push(t,"74565Xo2mBCMbJAE3lzck4g","TriggerSwitch");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var p=u(e("./Trigger")),f=u(e("../Framework/GameComponent")),d=u(e("../Util/untilConditionOrTimeout")),h=cc._decorator,y=h.ccclass,g=h.property,_=h.executeInEditMode,m=cc.js.getClassName,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._currentTrigger=null,t._currentTriggerWasExecuted=!1,t._sceneStarted=!1,t}return o(t,e),Object.defineProperty(t.prototype,"currentTrigger",{get:function(){return this._currentTrigger},set:function(e){e?this.switchToTrigger(e):(this._cancelExecution(),this._currentTrigger=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triggers",{get:function(){return this.getComponentsInChildren(p.default)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousTrigger",{get:function(){return this._getAdjacentTrigger(-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextTrigger",{get:function(){return this._getAdjacentTrigger(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"allTriggersExecuted",{get:function(){var e=this.triggers;return this._currentTriggerWasExecuted&&this.currentTrigger===e[e.length-1]&&!this.currentTrigger.isExecuting},enumerable:!1,configurable:!0}),t.prototype.switchToTrigger=function(e){if(!this.triggers.includes(e))throw new Error(cc.js.getClassName(p.default)+" must be a child of this node.");this._cancelExecution(),this._currentTrigger=e},t.prototype.switchToNextTrigger=function(){if(!this.nextTrigger)throw new Error("No next enabled "+cc.js.getClassName(p.default)+" to switch to.");this.switchToTrigger(this.nextTrigger)},t.prototype.switchToPreviousTrigger=function(){if(!this.previousTrigger)throw new Error("No previous enabled "+cc.js.getClassName(p.default)+" to switch to.");this.switchToTrigger(this.previousTrigger)},t.prototype.onSceneStart=function(){this._sceneStarted=!0},t.prototype.update=function(){if(this._sceneStarted){var e=this._currentTrigger;!cc.isValid(e)||this._currentTriggerWasExecuted&&!e.isExecuting||!e.enabledInHierarchy?(this._currentTriggerWasExecuted=!1,this.nextTrigger&&this.switchToNextTrigger()):this._currentTriggerWasExecuted||e.isExecuting||!e.check()||(this._currentTriggerWasExecuted=!0,e.execute())}},t.prototype._getAdjacentTrigger=function(e){var t=this.currentTrigger,r=this.triggers;return t?0===e?t:r[r.indexOf(t)+e]:null},t.prototype._cancelExecution=function(){return c(this,void 0,Promise,function(){var e,t,r,n,o=this;return s(this,function(i){switch(i.label){case 0:try{for(e=l(this.triggers),t=e.next();!t.done;t=e.next())t.value.cancel()}catch(a){r={error:a}}finally{try{t&&!t.done&&(n=e.return)&&n.call(e)}finally{if(r)throw r.error}}return this._currentTriggerWasExecuted=!1,[4,d.default(function(){return o.triggers.every(function(e){return!e.isExecuting})})];case 1:return i.sent(),[2]}})})},t.prototype._validateTriggers=function(){var e,t,r=function(e){if(e.constructor===p.default)return e.disableAfterExecute=!1,"continue";e.constructor!==p.default&&(cc.warn(m(n)+" should only have "+m(p.default)+" componentss as children. "+m(e)+" replaced."),e.destroy(),setTimeout(function(){e.node.addComponent(p.default).disableAfterExecute=!1}))},n=this;try{for(var o=l(this.triggers),i=o.next();!i.done;i=o.next())r(i.value)}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},i([g({type:p.default}),a("design:type",Object)],t.prototype,"_currentTrigger",void 0),i([g({type:p.default,displayName:"Start Trigger",tooltip:"First trigger.",readonly:!0,visible:!1}),a("design:type",Object),a("design:paramtypes",[Object])],t.prototype,"currentTrigger",null),i([y,_],t)}(f.default);r.default=b,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Util/untilConditionOrTimeout":"untilConditionOrTimeout","./Trigger":"Trigger"}],TriggerZone:[function(e,t,r){"use strict";cc._RF.push(t,"ac10b2/GBVBsofZuN9DRo1r","TriggerZone");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,l=c.disallowMultiple,u=c.executeInEditMode,p=c.menu,f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"isPoint",{get:function(){var e=this.node,t=e.width,r=e.height;return 0===t&&0===r},enumerable:!1,configurable:!0}),t.prototype.containsActor=function(e){var t=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO);return this.node.getBoundingBoxToWorld().contains(t)},t.prototype.onLoad=function(){},t.prototype.onDestroy=function(){},t.prototype._editorUpdateLabel=function(){var e=this._getVisualNode("Name"),t=e&&e.getComponent(cc.Label);t&&(t.string=this.node.name=this.node.name.replace(/(zone|point)$/i,this.isPoint?"Point":"Zone").trim());var r=this._getVisualNode("Point");r&&(r.active=this.isPoint);var n=this._getVisualNode("Transform");n&&(n.active=!this.isPoint),t&&(t.node.angle=n&&n.active?-this.node.angle:0);var o=t&&t.getComponent(cc.Widget);if(o){var i=!!n&&n.active,a=!n&&!this.isPoint;o.isAlignHorizontalCenter=this.isPoint||i,o.isAlignVerticalCenter=this.isPoint||i,o.isAlignVerticalCenter&&(o.verticalCenter=this.isPoint&&r?5-r.scaleY*r.height:0),o.isAlignLeft=a,o.isAlignLeft&&(o.left=5),o.isAlignTop=a,o.isAlignTop&&(o.top=5)}},t.prototype._getVisualNode=function(e){var t,r;try{for(var n=a(this.node.children),o=n.next();!o.done;o=n.next()){var i=o.value;if(i.name===e&&"overlay"===i.group)return i}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return null},i([s,l,u,p("Trigger Component/Trigger Zone")],t)}(cc.Component);r.default=f,cc._RF.pop()},{}],Trigger:[function(e,t,r){"use strict";cc._RF.push(t,"3ed4f6AIAZIiZADHBYIZX3w","Trigger");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var d=f(e("./TriggerComponent")),h=s(e("./TriggerAction")),y=s(e("./TriggerCondition")),g=f(e("./TriggerData")),_=f(e("../Util/getComponentInParents")),m=cc._decorator,b=m.menu,v=m.ccclass,w=m.property,O=m.disallowMultiple,S=m.executeInEditMode,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._logActions=!1,t.disableAfterExecute=!1,t._runtimeCondition=null,t._runtimeAction=null,t._conditions=[],t._actions=[],t._disableAfterExecuteIfNecessary=function(){t.disableAfterExecute&&t.setActive(!1)},t}return o(t,e),Object.defineProperty(t.prototype,"runtimeCondition",{get:function(){return this._runtimeCondition||(this._runtimeCondition=this.addComponent("TriggerCondition - And")),this._runtimeCondition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"runtimeAction",{get:function(){return this._runtimeAction||(this._runtimeAction=this.addComponent("TriggerAction - Sequential")),this._runtimeAction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isExecuting",{get:function(){return this.runtimeAction.isExecuting},enumerable:!1,configurable:!0}),t.prototype.check=function(){return this.enabledInHierarchy&&this.runtimeCondition.check()},t.prototype.tryExecute=function(e){if(this.enabledInHierarchy&&!this.isExecuting&&this.check())return this.execute(e)},t.prototype.execute=function(e){var t=h.isTriggerActionOptions(e)?e:{log:void 0,instant:!1};void 0===t.log&&(t.log=this._logActions);var r=this.runtimeAction.execute(t);return r instanceof Promise?r.then(this._disableAfterExecuteIfNecessary):this._disableAfterExecuteIfNecessary()},t.prototype.cancel=function(){this.runtimeAction.cancel()},t.prototype.setActive=function(e){cc.isValid(this)&&cc.isValid(this.node)&&(this.enabled=this.node.active=e)},Object.defineProperty(t.prototype,"conditions",{get:function(){return 0===this._conditions.length&&(this._conditions=this.getComponentsInChildren(y.default).filter(function(e){return e instanceof y.TriggerConditionContainer==0}).filter(function(e){return!e.node.parent.getComponent(h.default)})),p(this._conditions)},enumerable:!1,configurable:!0}),t.prototype.getData=function(e){return e&&this.getComponents(g.default).find(function(t){return t.dataKey===e})||null},Object.defineProperty(t.prototype,"currentConditions",{get:function(){return this.conditions.filter(function(e){return e.enabledInHierarchy&&!e.check()})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){return 0===this._actions.length&&(this._actions=this.getComponentsInChildren(h.default).filter(function(e){return e instanceof h.TriggerActionContainer==0})),p(this._actions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentActions",{get:function(){return this.actions.filter(function(e){return e.enabledInHierarchy&&e.isExecuting})},enumerable:!1,configurable:!0}),t.prototype.onEnable=function(){},t.prototype.onDestroy=function(){this.cancel()},t.prototype.onBuildPreProcess=function(e){return!(e||!this._logActions||(this._logActions=!1,0))},t.prototype._editorUpdate=function(){this._sortChildren()},t.prototype._sortChildren=function(){var e=this;this.node.children.sort(function(t,r){return e._getChildSortOrder(t)-e._getChildSortOrder(r)})},t.prototype._getChildSortOrder=function(e){return e.getComponent(y.default)?-1:1},c([w({tooltip:"Log actions as they're executed in the console.",visible:!0}),l("design:type",Object)],t.prototype,"_logActions",void 0),c([w({tooltip:"This trigger will automatically disable itself after a single execution.\n",displayName:"Execute Once",visible:function(){return!_.default(this,"TriggerSwitch")}}),l("design:type",Object)],t.prototype,"disableAfterExecute",void 0),c([v,O,S,b("Trigger Component/Trigger")],t)}(d.default);r.default=C,cc._RF.pop()},{"../Util/getComponentInParents":"getComponentInParents","./TriggerAction":"TriggerAction","./TriggerComponent":"TriggerComponent","./TriggerCondition":"TriggerCondition","./TriggerData":"TriggerData"}],Velocity:[function(e,t,r){"use strict";cc._RF.push(t,"a02a8ZrsdVB6ILNdSjcGOPU","Velocity");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=c(e("../Util/lerpAngle")),l=c(e("../Util/approximately")),u=cc._decorator,p=u.ccclass,f=u.property,d=u.menu,h=100,y=50,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._mass=0,t.angularVelocity=0,t.targetAngularVelocity=0,t.velocity=cc.Vec2.ZERO,t.targetVelocity=cc.Vec2.ZERO,t.force=h,t.rotationalForce=y,t}var r,n;return o(t,e),Object.defineProperty(t.prototype,"mass",{get:function(){return this._mass},set:function(e){this._mass=Math.max(e,0)},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.mass<=0&&(this.targetVelocity=this.velocity.clone(),this.targetAngularVelocity=this.angularVelocity)},t.prototype.update=function(e){this._updateAngularPosition(e),this._updateLinearPosition(e),this._updateVelocity(e),this._updateAngularVelocity(e)},t.prototype.getActorComponentState=function(){return{enabled:this.enabled,mass:this.mass,angularVelocity:this.angularVelocity,targetAngularVelocity:this.targetAngularVelocity,velocity:this.velocity.clone(),targetVelocity:this.targetVelocity.clone()}},t.prototype.applyActorComponentState=function(e){this.enabled=e.enabled,this.mass=e.mass,this.angularVelocity=e.angularVelocity,this.targetAngularVelocity=e.targetAngularVelocity,this.velocity=e.velocity.clone(),this.targetVelocity=e.targetVelocity.clone()},t.prototype._updateLinearPosition=function(e){this.node.position=this.node.position.add(cc.v3(this.velocity.x*e,this.velocity.y*e,0))},t.prototype._updateVelocity=function(e){if(this.mass<=0&&(this.velocity=this.targetVelocity.clone()),!this.velocity.fuzzyEquals(this.targetVelocity,.01)){var t=this.targetVelocity.x<this.velocity.x?-1:1,r=this.targetVelocity.y<this.velocity.y?-1:1;this.velocity.x+=t*Math.abs(this.force)*e/this.mass,this.velocity.y+=r*Math.abs(this.force)*e/this.mass,this.velocity.x=1===t?Math.min(this.velocity.x,this.targetVelocity.x):Math.max(this.velocity.x,this.targetVelocity.x),this.velocity.y=1===r?Math.min(this.velocity.y,this.targetVelocity.y):Math.max(this.velocity.y,this.targetVelocity.y)}},t.prototype._updateAngularPosition=function(e){this.node.angle+=360*this.angularVelocity*e,this.node.angle=s.default(this.node.angle)},t.prototype._updateAngularVelocity=function(e){if(this.mass<=0&&(this.angularVelocity=this.targetAngularVelocity),!l.default(this.angularVelocity,this.targetAngularVelocity,.001)){var t=this.targetAngularVelocity<this.angularVelocity?-1:1;this.angularVelocity+=12*t*Math.abs(this.rotationalForce)*e/(this.mass*(Math.pow(this.node.width,2)+Math.pow(this.node.height,2))),this.angularVelocity=1===t?Math.min(this.angularVelocity,this.targetAngularVelocity):Math.max(this.angularVelocity,this.targetAngularVelocity)}},i([f({formerlySerializedAs:"mass"}),a("design:type",Object)],t.prototype,"_mass",void 0),i([f({min:0,tooltip:"Adding a mass allows for acceleration to a target velocity"}),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"mass",null),i([f({formerlySerializedAs:"torque",displayName:"Rotations/Second"}),a("design:type",Object)],t.prototype,"angularVelocity",void 0),i([f({displayName:"Target Rotations/Second",visible:function(){return this.mass>0}}),a("design:type",Object)],t.prototype,"targetAngularVelocity",void 0),i([f({displayName:"Pixels/Second"}),a("design:type","function"==typeof(r="undefined"!=typeof cc&&cc.Vec2)?r:Object)],t.prototype,"velocity",void 0),i([f({displayName:"Target Pixels/Second",visible:function(){return this.mass>0}}),a("design:type","function"==typeof(n="undefined"!=typeof cc&&cc.Vec2)?n:Object)],t.prototype,"targetVelocity",void 0),i([p,d("Generic Component/Velocity")],t)}(cc.Component);r.default=g,cc._RF.pop()},{"../Util/approximately":"approximately","../Util/lerpAngle":"lerpAngle"}],WidgetInsetterForTabDevices:[function(e,t,r){"use strict";cc._RF.push(t,"0b7fdytJLNPyYpRlPkIbiMB","WidgetInsetterForTabDevices");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("../Util/Decorators/cache")),u=e("../Util/platformDetection"),p=cc._decorator,f=p.ccclass,d=p.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._top=0,t._left=0,t._right=0,t._bottom=0,t._applied=!1,t}return o(t,e),Object.defineProperty(t.prototype,"isTabbedIOSDevice",{get:function(){return u.isTabbedIOSDevice()},enumerable:!1,configurable:!0}),t.prototype.onEnable=function(){this._setWidgetPaddingApplied(!0)},t.prototype.onDisable=function(){this._setWidgetPaddingApplied(!1)},t.prototype._setWidgetPaddingApplied=function(e){var t=e?1:-1;cc.isValid(this.widget)&&this.widget.enabledInHierarchy&&this.isTabbedIOSDevice&&this._applied!==e&&(this._applied=e,this.widget.top+=this._top*t,this.widget.bottom+=this._bottom*t,this.widget.left+=this._left*t,this.widget.right+=this._right*t,this._updateAlignment())},t.prototype._updateAlignment=function(){var e,t,r=this.node.getComponentsInChildren(cc.Widget);try{for(var n=c(r),o=n.next();!o.done;o=n.next())o.value.updateAlignment()}catch(i){e={error:i}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},i([l.default({type:cc.Widget,scope:"node",required:!1}),a("design:type",Object)],t.prototype,"widget",void 0),i([d({visible:!0,tooltip:"Delta change to the attached widgets top property if this is a tabbed device."}),a("design:type",Object)],t.prototype,"_top",void 0),i([d({visible:!0,tooltip:"Delta change to the attached widgets left property if this is a tabbed device."}),a("design:type",Object)],t.prototype,"_left",void 0),i([d({visible:!0,tooltip:"Delta change to the attached widgets right property if this is a tabbed device."}),a("design:type",Object)],t.prototype,"_right",void 0),i([d({visible:!0,tooltip:"Delta change to the attached widgets bottom property if this is a tabbed device."}),a("design:type",Object)],t.prototype,"_bottom",void 0),i([f],t)}(cc.Component);r.default=h,cc._RF.pop()},{"../Util/Decorators/cache":"cache","../Util/platformDetection":"platformDetection"}],angleOfVector:[function(e,t,r){"use strict";cc._RF.push(t,"56209SXtHhJnLHhzFcQS5Nq","angleOfVector"),Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return(180*Math.atan2(e.y,e.x)/Math.PI-90+360)%360},cc._RF.pop()},{}],approximately:[function(e,t,r){"use strict";cc._RF.push(t,"056ecJhuwRCc6F/dYUfWvK6","approximately");var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function a(e){var t,r,n=[];if("number"==typeof e)n.push({axis:"",value:e});else if(e instanceof cc.Color)n.push({axis:"red",value:e.getR()},{axis:"green",value:e.getG()},{axis:"blue",value:e.getB()},{axis:"alpha",value:e.getA()});else if(Array.isArray(e))n.push.apply(n,o(e.map(function(e,t){return{axis:t.toString(),value:e}})));else try{for(var a=i(["width","height","x","y","z"]),c=a.next();!c.done;c=a.next()){var s=c.value;s in e&&n.push({axis:s,value:e[s]})}}catch(l){t={error:l}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){var n,o;void 0===r&&(r=1/Math.pow(2,10));var c=a(e),s=a(t),l=function(e){var t=c.find(function(t){return t.axis===e.axis});if(Math.abs(e.value-t.value)>r)return{value:!1}};try{for(var u=i(s),p=u.next();!p.done;p=u.next()){var f=l(p.value);if("object"==typeof f)return f.value}}catch(d){n={error:d}}finally{try{p&&!p.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}return!0},cc._RF.pop()},{}],arrayDescriber:[function(e,t,r){"use strict";cc._RF.push(t,"6c44e/MSHpLeKFWnnGQjFmz","arrayDescriber"),Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){void 0===t&&(t="or"),void 0===r&&(r="");var n=e.map(function(e){return""+r+e+r});if(n.length<=1)return n[0]||"";var o=n.splice(n.length-1,1);return n.join(", ")+" "+t+" "+o},cc._RF.pop()},{}],assert:[function(e,t,r){"use strict";cc._RF.push(t,"6c45f021SVK0ZM2htmErfOF","assert");this&&this.__createBinding||Object.create,this&&this.__setModuleDefault||Object.create;var n=(this&&this.__importStar,this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})}),o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var c,s=a(e("./approximately")),l=function(){return cc.error("Deep Equals should not be used in builds; supressing Error."),!0};function u(e){return c?c(e):""+e}function p(e){if("string"==typeof e)return e;if("object"==typeof e&&null!==e&&"number"==typeof e.length)return e;throw new Error("Provided value does not have numeric length property")}function f(e){for(var t,r,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];try{for(var a=i(n),c=a.next();!c.done;c=a.next())if(e instanceof c.value)return e}catch(s){t={error:s}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}throw new Error("Provided value is not "+(n.length>1?"any of: "+n.map(function(e){return e.name}).join(","):"a "+n[0].name))}var d=function(){function e(e){this._context=e}return e.prototype.isTruthy=function(e){if(void 0===e&&(e="The provided value was not truthy"),!this._context)throw new Error(e);return this},e.prototype.isTrue=function(e){if(void 0===e&&(e="The provided value was not true"),!0!==this._context)throw new Error(e);return this},e.prototype.isFalsey=function(e){if(void 0===e&&(e="The provided value was not falsey"),this._context)throw new Error(e);return this},e.prototype.isFalse=function(e){if(void 0===e&&(e="The provided value was not false"),!1!==this._context)throw new Error(e);return this},e.prototype.throws=function(e,t){var r=f(this._context,Function);t=t||(r&&r.name||"function")+" did not throw Error";var n=null;try{r()}catch(o){n=o}if(!n)throw new Error(t);if(e&&!n.name.includes(e)&&!n.message.includes(e))throw new Error("Error was thrown, but name or message did not contain: "+e+"\nname: "+n.name+"\nmessage: "+n.message)},e.prototype.notThrows=function(e,t){var r=f(this._context,Function);try{r()}catch(o){var n=!e||o.name.includes(e)||o.message.includes(e);if(n&&!t&&(t=(r.name||"function")+" expected to not throw "+(e?"an error with name or message: "+e:"any error")+" but threw error: "+o.name+" "+o.message+" "),n)throw new Error(t)}},e.prototype.resolves=function(e){return n(this,void 0,Promise,function(){var t,r,n,i,a,c;return o(this,function(o){switch(o.label){case 0:t=f(this._context,Promise),n=null,i=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t];case 2:return r=o.sent(),[3,4];case 3:return a=o.sent(),i=!0,n=a,[3,4];case 4:if(i)throw c=n?n.message:"rejected without reason",new Error(e||"Promise was rejected: "+c);return[2,r]}})})},e.prototype.rejects=function(e,t){return void 0===t&&(t="Promise was fulfilled"),n(this,void 0,Promise,function(){var r,n,i;return o(this,function(o){switch(o.label){case 0:r=f(this._context,Promise),n=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,r];case 2:return o.sent(),[3,4];case 3:return i=o.sent(),n=i instanceof Error?i:new Error(i),[3,4];case 4:if(!n)throw new Error(t);if(e&&!n.name.includes(e)&&!n.message.includes(e))throw new Error("Promise rejected, but name or message did not contain: "+e+" \nname: "+n.name+" \nmessage: "+n.message+" ");return[2]}})})},e.prototype.equal=function(e,t){if(t=t||"Provided values were not equal\nreceived: "+u(this._context)+" \nexpected: "+u(e),this._context!==e)throw new Error(t);return this},e.prototype.notEqual=function(e,t){if(t=t||"Provided values were equal\nreceived: "+u(this._context)+" \nexpected: "+u(e),this._context===e)throw new Error(t);return this},e.prototype.deepEqual=function(e,t){if(t=t||"Provided values were not deeply equal\nreceived: "+u(this._context)+" \nexpected: "+u(e),!l(this._context))throw new Error(t);return this},e.prototype.notDeepEqual=function(e,t){if(t=t||"Provided values were deeply equal\nreceived: "+u(this._context)+" \nexpected: "+u(e),l(this._context))throw new Error(t);return this},e.prototype.compare=function(e,t,r){r=r||"Provided value did not satisfy "+e+" "+t+" \nreceived: "+this._context+" ";var n=this._context;switch(e){case"<":if(n>=t)throw new Error(r);break;case"<=":if(n>t)throw new Error(r);break;case"===":if(n!==t)throw new Error(r);break;case"!==":if(n===t)throw new Error(r);break;case">":if(n<=t)throw new Error(r);break;case">=":if(n<t)throw new Error(r);break;default:throw new Error("Operator must be one of > | >= | <= | < | === | !== \nRecieved: "+e+" ")}return this},e.prototype.greaterThan=function(e,t){return this.compare(">",e,t)},e.prototype.greaterThanOrEqualTo=function(e,t){return this.compare(">=",e,t)},e.prototype.lessThan=function(e,t){return this.compare("<",e,t)},e.prototype.lessThanOrEqualTo=function(e,t){return this.compare("<=",e,t)},e.prototype.between=function(e,t,r){return r=r||u(this._context)+" is not between "+e+" and "+t,this.greaterThanOrEqualTo(e,r).lessThan(t,r)},e.prototype.approximately=function(e,t,r){void 0===t&&(t=1/Math.pow(2,10));var n="number"==typeof this._context?this._context:f(this._context,cc.Vec2,cc.Vec3,cc.Size);if(r=r||u(n)+" is not approximately "+u(e)+" within "+t,!s.default(n,e,t))throw new Error(r);return this},e.prototype.includes=function(e,t){void 0===t&&(t="Provided collection did not include "+u(e)+" ");var r=this._context;if(!("string"==typeof r?r:Array.prototype.slice.call(r)).includes(e))throw new Error(t);return this},e.prototype.notIncludes=function(e,t){void 0===t&&(t="Provided collection did include "+u(e)+" ");var r=this._context;if(("string"==typeof r?r:Array.prototype.slice.call(r)).includes(e))throw new Error(t);return this},e.prototype.instanceOf=function(e,t){if(void 0===t&&(t="Provided value was not an instance of "+e.name+" "),!(this._context instanceof e))throw new Error(t);return this},e.prototype.notInstanceOf=function(e,t){if(void 0===t&&(t="Provided value was an instance of "+e.name+" "),this._context instanceof e)throw new Error(t);return this},e.prototype.hasComponent=function(e,t){var r=f(this._context,cc.Node,cc.Component);t=t||"Provided node "+r.name+" did not have component "+("string"==typeof e?e:e.name)+" ";var n=r.getComponent(e);if(!n)throw new Error(t);return n},e.prototype.notHaveComponent=function(e,t){var r=f(this._context,cc.Node);if(t=t||"Provided node "+r.name+" did have component "+("string"==typeof e?e:e.name),r.getComponent(e))throw new Error(t);return this},e.prototype.isDestroyed=function(e){var t=f(this._context,cc.Object);if(cc.isValid(t,!0))throw e=e||"Provided object "+(t?t.name+" ":"")+"was not destroyed",new Error(e);return this},e.prototype.isNotDestroyed=function(e){var t=f(this._context,cc.Object);if(!cc.isValid(t,!0))throw e=e||"Provided object was destroyed",new Error(e);return this},e.prototype.isEnabled=function(e){var t=f(this._context,cc.Component);if(e=e||"Provided component "+t.name+" is not enabled",!t.enabledInHierarchy||!t.node.activeInHierarchy)throw new Error(e);return this},e.prototype.isNotEnabled=function(e){var t=f(this._context,cc.Component);if(e=e||"Provided component "+t.name+" is enabled",t.enabledInHierarchy)throw new Error(e);return this},e.prototype.isActive=function(e){var t=f(this._context,cc.Node);if(e=e||"Provided node "+t.name+" is not active",!t.activeInHierarchy)throw new Error(e);return this},e.prototype.isNotActive=function(e){var t=f(this._context,cc.Node);if(e=e||"Provided node "+t.name+" is active",t.activeInHierarchy)throw new Error(e);return this},e.prototype.isPersistent=function(e){var t=f(this._context,cc.Node);if(e=e||"Provided node "+t.name+" is not persistent",!cc.game.isPersistRootNode(t))throw new Error(e);return this},e.prototype.isNotPersistent=function(e){var t=f(this._context,cc.Node);if(e=e||"Provided node "+t.name+" is persistent",cc.game.isPersistRootNode(t))throw new Error(e);return this},e.prototype.property=function(e,t){var r=f(this._context,Object);if(e in r==0)throw t=t||"Property "+e.toString()+" does not exist in "+u(r)+" ",new Error(t);return this._context=r[e],this},Object.defineProperty(e.prototype,"length",{get:function(){var e=p(this._context).length;return this._context=e,this},enumerable:!1,configurable:!0}),e}();r.default=function(e){return new d(e)},cc._RF.pop()},{"./approximately":"approximately","fast-deep-equal/es6":5,util:4}],cache:[function(e,t,r){"use strict";cc._RF.push(t,"915f3JE2AFKVZuDWE19dPml","cache");var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var l=s(e("../getComponentInParents")),u=s(e("../getComponentsInParents")),p=s(e("../getComponentInScene")),f=s(e("../getComponentsInScene")),d=cc.js.getClassName;function h(e){return"object"==typeof e&&!Array.isArray(e)}var y=function(e){function t(t,r,n,o){var i=t+" requires ";if(o&&(i+="at least one "),i+=r+" ",1===n.length)i+="in "+n[0];else{var c=a(n),s=c.pop();i+="in either "+c+" or "+s}return e.call(this,i)||this}return o(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"ComponentRequiredError"},enumerable:!1,configurable:!0}),t}(Error);function g(e,t){if(e.includes("node"))return function(e){return e.addComponent(t)};if(e.includes("scene"))return function(){var e=new cc.Node(d(t));return e.setParent(cc.director.getScene()),e.addComponent(t)};if(e.includes("children"))return function(e){var r=new cc.Node(d(t));return r.setParent(e),r.addComponent(t)};if(e.includes("parent"))return function(e){return e.parent.addComponent(t)};throw new Error("Cannot auto create build function for scopes: "+e)}function _(e,t){var r,n;try{for(var o=c(t),i=o.next();!i.done;i=o.next()){var a=i.value;e.includes(a)||e.push(a)}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}function m(e,t,r){var n,o,i=[];try{for(var a=c(t),s=a.next();!s.done;s=a.next())switch(s.value){case"node":_(i,e.getComponents(r));break;case"parent":_(i,u.default(e,r));break;case"children":_(i,e.getComponentsInChildren(r));break;case"scene":_(i,f.default(r))}}catch(l){n={error:l}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i}function b(e,t,r){var n,o,i=null;try{for(var a=c(t),s=a.next();!s.done;s=a.next()){switch(s.value){case"node":i=e.getComponent(r);break;case"parent":i=l.default(e,r);break;case"children":i=e.getComponentInChildren(r);break;case"scene":i=p.default(r)}if(i)break}}catch(u){n={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i}function v(e){return Array.isArray(e)?e.length>0&&e.every(function(e){return cc.isValid(e)}):cc.isValid(e)}r.default=function(e){var t=h(e)?e:{type:e,required:!0,scope:"node"},r=!("required"in t&&!t.required),n=t.scope||"node",o=Array.isArray(n)?n:[n];if(0===o.length)throw new Error("At least one scope must be declared for the cache decorator");var i=Array.isArray(t.type),a=Array.isArray(t.type)?t.type[0]:t.type,c=!0===t.create?g(o,a):t.create;return function(e,t){var n="_"+t.toString();return{get:function(){if(v(this[n])||(this[n]=i?m(this,o,a):b(this,o,a)),c&&!v(this[n])&&(this[n]=c.call(this,this.node)),r&&!v(this[n]))throw new y(t.toString(),a.name,o,i);return this[n]},enumerable:!1,configurable:!1}}},cc._RF.pop()},{"../getComponentInParents":"getComponentInParents","../getComponentInScene":"getComponentInScene","../getComponentsInParents":"getComponentsInParents","../getComponentsInScene":"getComponentsInScene"}],chunker:[function(e,t,r){"use strict";cc._RF.push(t,"bbfb26LjTpHn6KieD22+NGd","chunker"),Object.defineProperty(r,"__esModule",{value:!0}),r.Chunker=r.chunker=void 0;var n=function(){if("peformance"in window&&"now"in window.performance)return window.performance.now;var e=Date.now();return function(){return Date.now()-e}}(),o=function(){function e(e){void 0===e&&(e=""),this.end=this.reset,this.name=e,this.reset(!1)}return Object.defineProperty(e.prototype,"time",{get:function(){return(n()-this._start)/1e3},enumerable:!1,configurable:!0}),e.prototype.check=function(e){return void 0===e&&(e=1/60),this.time>e&&(this.reset(!1),!0)},e.prototype.reset=function(e){if(void 0===e&&(e=!1),e){var t="string"==typeof e?e:(this.name&&this.name+" ")+"complete:";cc.log(t,this.time,"seconds")}this._start=n()},e}();function i(e){return new o(e)}r.Chunker=o,r.default=i,r.chunker=i,cc._RF.pop()},{}],componentIsLoaded:[function(e,t,r){"use strict";cc._RF.push(t,"4cd05w4clFHg4Y1w6rBWVfp","componentIsLoaded");var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.untilComponentIsLoaded=r.componentIsLoaded=void 0;var o=n(e("./untilConditionOrTimeout")),i=cc.Object.Flags.IsOnLoadCalled;function a(e){if(!cc.isValid(e))throw new Error("Component is destroyed");return!!(e._objFlags&i)}r.componentIsLoaded=a,r.untilComponentIsLoaded=function(e,t,r){return void 0===t&&(t=1/0),void 0===r&&(r=25),o.default(function(){return a(e)},t,r)},r.default=a,cc._RF.pop()},{"./untilConditionOrTimeout":"untilConditionOrTimeout"}],convertTexture:[function(e,t,r){"use strict";cc._RF.push(t,"7a17aZjzexKkLO2EzUNFCis","convertTexture");var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.dataUrlToRgba=r.dataUrlToHtmlImage=r.rgbaToDataUrl=r.textureToDataUrl=void 0;var i="image/png",a=function(e){var t=document.createElement("canvas");t.width=e,t.height=e,this.canvas=t,this.ctx=t.getContext("2d")},c=null;function s(e,t){c||(c=new a(t)),c.canvas.width=c.canvas.height=t;for(var r=4*t,n=t-1;n>=0;n--){for(var o=n*r,s=c.ctx.createImageData(t,1),l=0;l<r;l++){var u=o+l;s.data[l]=e[u]}c.ctx.putImageData(s,0,n)}return c.canvas.toDataURL(i)}function l(e,t){return new Promise(function(r){var n=new Image(t,t);n.src=e,n.onload=function(){return r(n)}})}r.rgbaToDataUrl=s,r.dataUrlToHtmlImage=l,r.dataUrlToRgba=function(e,t){return n(this,void 0,Promise,function(){var r,n;return o(this,function(o){switch(o.label){case 0:return[4,l(e,t)];case 1:return r=o.sent(),c||(c=new a(t)),c.ctx.drawImage(r,0,0),n=c.ctx.getImageData(0,0,t,t),[2,new Uint8Array(n.data)]}})})},r.textureToDataUrl=function(e){var t=e.readPixels();if(t)return s(t,e.width||e.height);var r=e.getHtmlElementObj();if(r&&r.src.includes("data:"+i))return r.src;throw new Error("Texture could not be converted into a data url")},cc._RF.pop()},{}],deferred:[function(e,t,r){"use strict";function n(e,t){var r,n=e[t]instanceof Promise,o=e["_"+t.toString()];if(!(null!==(r=o)&&"object"==typeof r&&r.promise instanceof Promise&&r.resolve instanceof Function&&r.reject instanceof Function&&"boolean"==typeof r.fulfilled&&n))throw new Error(t.toString()+" has not been decorated with @deferred.");return o}function o(e){return function(t,r,o){var i=n(t,r);if(i.fulfilled)throw new Error(r.toString()+" has already been fulfilled.");return i.fulfilled=!0,i[e](o),i.promise}}function i(e,t){var r="_"+t.toString();return{enumerable:!0,configurable:!1,get:function(){if(!this[r]){var e={};e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r,e.fulfilled=!1}),this[r]=e}return this[r].promise}}}cc._RF.push(t,"bb058ib7fhFUbrMjtKQw8XQ","deferred"),Object.defineProperty(r,"__esModule",{value:!0}),i.resolve=o("resolve"),i.reject=o("reject"),i.reset=function(e,t){if(!n(e,t).fulfilled)throw new Error(t.toString()+" can not be reset, it has not yet been fulfilled.");delete e["_"+t.toString()]},r.default=i,cc._RF.pop()},{}],getComponentInParents:[function(e,t,r){"use strict";cc._RF.push(t,"38d3cJXgDpI/JRwX1bchdGt","getComponentInParents"),Object.defineProperty(r,"__esModule",{value:!0});var n=cc.js.getClassName;r.default=function(e,t,r){for(var o=e instanceof cc.Component?e.node:e,i=null;!i&&o.parent&&o.parent instanceof cc.Scene==0;)i=(o=o.parent).getComponent(t);if(!i&&r)throw new Error("Could not find component of type: "+n(t));return i},cc._RF.pop()},{}],getComponentInScene:[function(e,t,r){"use strict";cc._RF.push(t,"3937aWk71BDPKjyw+zBY63o","getComponentInScene"),Object.defineProperty(r,"__esModule",{value:!0});var n=cc.js.getClassName;r.default=function(e,t){var r=cc.director.getScene().getComponentInChildren(e);if(!r&&t)throw new Error("Could not find component of type: "+n(e));return r},cc._RF.pop()},{}],getComponentsInParents:[function(e,t,r){"use strict";cc._RF.push(t,"cac87hB8p1Asqofjz47HW1y","getComponentsInParents");var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(r,"__esModule",{value:!0});var i=cc.js.getClassName;r.default=function(e,t,r){for(var n=e instanceof cc.Component?e.node:e,a=[];n.parent&&n.parent instanceof cc.Scene==0;)n=n.parent,a.push.apply(a,o(n.getComponents(t)));var c="number"==typeof r?r:r?1:0;if(a.length<c)throw new Error("Could not find at least "+c+" components of type "+i(t));return a},cc._RF.pop()},{}],getComponentsInScene:[function(e,t,r){"use strict";cc._RF.push(t,"28922xymwVO5rakGFNKYVi3","getComponentsInScene"),Object.defineProperty(r,"__esModule",{value:!0});var n=cc.js.getClassName;r.default=function(e,t){var r=cc.director.getScene().getComponentsInChildren(e),o="number"==typeof t?t:t?1:0;if(r.length<o)throw new Error("Could not find at least "+o+" components of type "+n(e));return r},cc._RF.pop()},{}],isInPrefabMode:[function(e,t,r){"use strict";cc._RF.push(t,"539b6ohBk1ErYBMSFSI5tqp","isInPrefabMode"),Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){return!1},cc._RF.pop()},{}],lerpAngle:[function(e,t,r){"use strict";cc._RF.push(t,"766ec1L9JxJLZkycr5mHY/r","lerpAngle"),Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){for(void 0===t&&(t=e),void 0===r&&(r=1);e>t+180;)t+=360;for(;t>e+180;)t-=360;return cc.misc.lerp(e,t,r)},cc._RF.pop()},{}],milliseconds:[function(e,t,r){"use strict";cc._RF.push(t,"af4b9qWezhMZoT6APFBr32u","milliseconds"),Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return new Promise(function(t){return setTimeout(t,e)})},cc._RF.pop()},{}],platformDetection:[function(e,t,r){"use strict";var n;cc._RF.push(t,"870cb9sUapMD724No8nidSH","platformDetection"),Object.defineProperty(r,"__esModule",{value:!0}),r.AppleMobileDevice=r.isTabbedIOSDevice=r.isLowEndDevice=void 0,function(e){e[e.NotAppleMobileDevice=0]="NotAppleMobileDevice",e[e.iPad2OrOlder=1]="iPad2OrOlder",e[e.iPadPro97OrOlder=2]="iPadPro97OrOlder",e[e.iPadPro105OrNewer=3]="iPadPro105OrNewer",e[e.iPhone4OrOlder=4]="iPhone4OrOlder",e[e.iPhone8OrOlder=5]="iPhone8OrOlder",e[e.iPhoneXOrNewer=6]="iPhoneXOrNewer"}(n||(n={})),r.AppleMobileDevice=n;function o(){try{if(window.top.devicePixelRatio>=0)return window.top}catch(e){}return window}function i(){var e=o(),t=e.screen,r=e.devicePixelRatio,n=t.width*r,i=t.height*r;return{short:Math.min(n,i),long:Math.max(n,i)}}function a(){var e=i(),t=e.short,r=e.long,o=window.devicePixelRatio,a=r/t;return navigator.userAgent.includes("iPad;")?a===1024/768?1===o?n.iPad2OrOlder:n.iPadPro97OrOlder:n.iPadPro105OrNewer:navigator.userAgent.includes("iPhone;")?3===o&&a===736/414||a===667/375?n.iPhone8OrOlder:1.775===a&&2===o?n.iPhone8OrOlder:1.5===a&&o<=2?n.iPhone4OrOlder:1===o?n.iPhone4OrOlder:n.iPhoneXOrNewer:n.NotAppleMobileDevice}function c(){switch(a()){case n.iPad2OrOlder:case n.iPhone4OrOlder:case n.iPadPro97OrOlder:return!0}return!1}function s(){var e=o().device;if(null==e)return-1;var t=e.memory;return null==t?-1:t}r.isLowEndDevice=function(){if(!cc.sys.isMobile)return!1;var e=s();return e>0?e<=1024:a()!==n.NotAppleMobileDevice?c():i().long<=2e3},r.isTabbedIOSDevice=function(){return cc.sys.isMobile&&a()===n.iPhoneXOrNewer},cc._RF.pop()},{}],sortBy:[function(e,t,r){"use strict";cc._RF.push(t,"a4f27NUPupDVa9lUKPvh3Ln","sortBy");var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("./RandomUtil"));function i(e,t){return e>t?1:e<t?-1:0}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,r){for(var n=0;n<e.length;n++){var o=n===e.length-1,a=e[n],c="object"==typeof a?a:{key:a,sorter:i},s=c.key,l=c.sorter;if(t[s]!==r[s]||o)return l(t[s],r[s])}return 0}}a.ascending=i,a.descending=function(e,t){return e<t?1:e>t?-1:0},a.random=o.default.sort,r.default=a,cc._RF.pop()},{"./RandomUtil":"RandomUtil"}],untilConditionOrTimeout:[function(e,t,r){"use strict";cc._RF.push(t,"06bc24OrXhLB6uspUgfXUTs","untilConditionOrTimeout");var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=i(e("./milliseconds"));r.default=function(e,t,r){return void 0===t&&(t=1/0),void 0===r&&(r=25),n(this,void 0,Promise,function(){var n;return o(this,function(o){switch(o.label){case 0:n=0,o.label=1;case 1:return e()?[3,3]:[4,a.default(r)];case 2:return o.sent(),(n+=r)>=t?[2,!1]:[3,1];case 3:return[2,!0]}})})},cc._RF.pop()},{"./milliseconds":"milliseconds"}]},{},["Actor","ActorCommands","ActorRelay","CharacterController","ButtonTrigger","IntervalTrigger","SceneLifecycleTrigger","StoryTriggerSwitch","Trigger","TriggerAction - CancelActorSequence","TriggerAction - CancelTrigger","TriggerAction - ClearDrawing","TriggerAction - Concurrent","TriggerAction - ConfigureDrawingUI","TriggerAction - Custom","TriggerAction - Else","TriggerAction - ExecuteActorCommand","TriggerAction - ExecuteTrigger","TriggerAction - If","TriggerAction - LoadDrawing","TriggerAction - LoadScene","TriggerAction - PlayActorSequence","TriggerAction - Random","TriggerAction - SaveDrawing","TriggerAction - SendAnalytic","TriggerAction - Sequential","TriggerAction - SetCreateUIActive","TriggerAction - SetDrawingUIState","TriggerAction - SetGrabbableSelected","TriggerAction - SetRedrawUIActive","TriggerAction - SetScenePhysics","TriggerAction - SetTriggerActive","TriggerAction - SetTriggerData","TriggerAction - Wait","TriggerAction","TriggerActionDrawing","TriggerActionDrawingUI","TriggerChildComponent","TriggerComponent","TriggerCondition - ActorAtZone","TriggerCondition - And","TriggerCondition - CheckActorSequencePlaying","TriggerCondition - CheckCreateUIActive","TriggerCondition - CheckCurrentScene","TriggerCondition - CheckDevice","TriggerCondition - CheckDrawingColor","TriggerCondition - CheckDrawingEmpty","TriggerCondition - CheckDrawingSaved","TriggerCondition - CheckDrawingUIState","TriggerCondition - CheckGrabbableSelected","TriggerCondition - CheckLoadingScene","TriggerCondition - CheckRedrawUIActive","TriggerCondition - CheckTriggerActive","TriggerCondition - CheckTriggerData","TriggerCondition - Custom","TriggerCondition - ElapsedTime","TriggerCondition - Not","TriggerCondition - Or","TriggerCondition - Random","TriggerCondition - UserIsDrawing","TriggerCondition","TriggerData","TriggerSwitch","TriggerZone","Comment","BuildPreprocessCheck","DevOptionsUI","DevOptionsUIToggle","EditorScript","Excluder","StoryPlaybackUI","StoryPlaybackUIHandler","StoryPlaybackUITimelineControls","StoryPlaybackUITimelineScrubber","StoryPlaybackUIVisibilityToggle","BubbleParticle","CloudParticle","Drawing","DrawingBounds","DrawingComponent","DrawingSerializer","DrawingSplatAdder","DrawingStorage","DrawingStorageMeta","DrawingTextureCell","KaleidoscopeDrawing","KusamaParticle","Particle","ScratchDrawing","DrawingTool","DrawingToolCursor","EmitterDrawingTool","EraserTool","GrabTool","Grabbable","SprayDrawingTool","StrokeDrawingTool","Transformable","TransformableRotateButton","TransformableRotator","TransformableScalar","TransformableWidget","DrawingEyeTracker","DrawingUI","DrawingUIColorButtons","DrawingUIHandler","DrawingUIHider","DrawingUIOptionButtons","DrawingUISizeButtons","DrawingUIToolAudio","DrawingUIToolButton","DrawingUIToolCustomizationButton","DrawingUIToolCustomizationButtons","DrawingUIToolsConfig","DrawingUITraySizer","Captioner","GameComponent","GameManager","Navigator","Springroll","Statistics","Storage","AudioPlayer","AudioResourceLoader","ButtonAsynchronizer","ButtonHover","CameraRig","DrawOrderer","FitChildrenToBounds","FourCornerGradient","FourCornerGradientAnimator","Grid","Hider","InstancePool","PersistOnCanvas","PrefabEmitter","PrefabInstancer","PrefabTiler","SizeToScreen","Snapper","SpriteAdditionalBlendModes","Temporary","Transform","Velocity","WidgetInsetterForTabDevices","Activatable","ActivateUI","CreateUI","CreateUIColorButtons","Createable","RedrawUI","PetController","PetFoodEater","DrawingMirrorer","MusicCell","MusicGrid","MusicKey","SnoogleDrawTargeter","SnoogleTextureLoader","SpinnerUI","Gallery","GalleryFrame","GalleryPaginator","Room","RoomManager","BuildPreProcessable","cache","deferred","DevelopmentJson","EventHandlerUtils","NodeUtils","RandomUtil","angleOfVector","approximately","arrayDescriber","assert","chunker","componentIsLoaded","convertTexture","getComponentInParents","getComponentInScene","getComponentsInParents","getComponentsInScene","isInPrefabMode","lerpAngle","milliseconds","platformDetection","sortBy","untilConditionOrTimeout"]);