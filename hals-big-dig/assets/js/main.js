!function(){var a=include("PIXI.WebGLRenderer"),b=a.prototype;b.__initContext=b._initContext,b._initContext=function(){this.__initContext(),this._useFXAA=!1,this._FXAAFilter=null}}(),namespace("nature").BuildRotatedGrid=function(a,b){var c,d,e,f,g,h=a.length;if(h){var i=a[0].length;for(rotatedGrid=new Array(i),e=0,f=rotatedGrid.length;f>e;++e)rotatedGrid[e]=new Array(h);if(1.5708==b||90==b)for(g=h,c=0,f=i;f>c;++c)for(d=0;g>d;++d)rotatedGrid[c][d]=a[h-1-d][c];else if(4.71239==b||270==b)for(g=h,c=0,f=i;f>c;++c)for(d=0;g>d;++d)rotatedGrid[c][d]=a[d][i-c-1];return rotatedGrid}},function(){var a=function(a){this.enable=function(b){this.interactive=b,this.buttonMode=b,this.off("mousedown",a),this.off("touchstart",a),b&&(this.on("mousedown",a),this.on("touchstart",a))}.bind(this)};namespace("nature").Clickable=a}(),namespace("nature").EnsureGridIsRectangular=function(a){var b=a.length;if(!b)return{rows:0,columns:0};var c=a[0].length;for(i=1;i<b;i++)a[i].length!=c;return{rows:b,columns:c}},function(){var a=include("createjs.Tween"),b=function(a,b){this.pulseTime=a||250,this.holdTime=b||this.pulseTime},c=extend(b);c.pulse=function(b){function c(a){d?(e=a.timeStamp-d,e>g&&(this.finish=!0)):d=a.timeStamp,this.finish&&this.green>240?(this.finish=!1,this.stop()):this.tint=this.red|this.green<<8|this.blue}b=b-1||-1;var d=null,e=0,f=3*this.pulseTime+this.holdTime,g=f*b;this.green=255,this.blue=255,this.red=255<<16,a.get(this,{loop:!0}).to({green:0,blue:0},this.pulseTime).to({},this.holdTime).to({green:255,blue:255},this.pulseTime).to({},this.pulseTime).addEventListener("change",c.bind(this))},c.stop=function(){a.removeTweens(this),this.tine="0xFFFFFF"},c.destroy=function(){s.destroy.call(this)},namespace("nature").PulseFlash=b}(),namespace("nature").TestLevel=function(a,b,c){var d=new nature.TileGrid,e=app.getGrids(a);e.forEach(function(b,c,e){var f=nature.EnsureGridIsRectangular(b),g=app.config.game.maxRows,h=app.config.game.maxColumns;f.rows>g,f.columns>h,a.fossils.bucket.forEach(function(c,e,f){var g=(c.asset,app.allFindables[c.asset]);d.clean(),d.makeGrid(a,b),d.placeItem(g,"fossils")})})},namespace("nature").WeightedArray=function(a){if(a.bucket&&(a=a.bucket),Array.isArray(a)){if(a.length){for(var b=[],c=0,d=a.length;d>c;++c){var e=a[c];if(e)for(var f=e.weight,g=0;f>g;++g)b.push(e.asset)}return b}return[a.asset]}return"string"==typeof a?[a]:null},function(){var a={String:"string",Boolean:"boolean",Number:"number",Int:"int"},b=[{name:"testGrids",type:a.String,log:"Check all the configs and make sure all parts fit all grids"},{name:"state",type:a.String,log:"title, select, game, doghouse, fossil"},{name:"muteMusic",type:a.Boolean,log:"Mute the music context"},{name:"showItems",type:a.Boolean,log:"Show the location of the items on level start"},{name:"level",type:a.Int,log:"Start at level"},{name:"Keys: 1, 2, 3...",type:a.Int,log:"Numeric keys from 1-? will trigger powerups"},{name:"gameover",type:a.Boolean,log:"Show the gameover dialog"},{name:"levelup",type:a.Boolean,log:"Show the level up dialog"},{name:"lockdown",type:a.Boolean,log:"Test the lockdown portion of the tutorial"},{name:"pause",type:a.Boolean,log:"Show the pause dialog"},{name:"fossil",type:a.String,log:"Which fossil to test in the fossil state. Only need to enter the first three letters of a dinosaur's name (tri for triceratops, par for parasaurolophus, &c.)"},{name:"part",type:a.String,log:"Which fossil to test in grid, must be the full name eg. stegosaurus_tail"},{name:"unlockAll",type:a.Boolean,log:"All parts have been found"},{name:"allPlaced",type:a.Boolean,log:"All found part start in their correct positions"}],c={init:function(){for(var a=springroll.Application.instance.options,d=include("springroll.DebugOptions",!1),e=0,f=b.length;f>e;e++){var g=b[e];a[g.name]?c[g.name]=a[g.name]:c[g.name]=null,d&&[g.type]&&d[g.type](g.name,g.log)}d&&d.log()}};namespace("nature").DebugOptions=c}(),namespace("nature.data").Tiles={rock:{sfx:["DigRock"],image:"Tile_rock",depth:0,particles:["Pebble1","Pebble2","Pebble3","Pebble4"]},pebbles:{sfx:["DigPebbles"],image:"Tile_pebbles",depth:1,particles:["Pebble1","Pebble2","Pebble3","Pebble4","Grass1"]},grass:{sfx:["DigGrass","animal-19"],image:"Tile_grass",depth:2,particles:["Grass1","Grass2","Grass3","Grass4","Dirt1"]},soil:{sfx:["DigSoil","animal-20"],image:"Tile_soil",depth:3,particles:["Dirt1","Dirt2","Dirt3","Dirt4","Dirt5","Dirt6","Dirt7","Dirt8","Dirt9"]},cleared:{image:"Tile_bedrock",depth:4}},namespace("nature.data").VO={},function(){var a,b,c,d=include("springroll.Application"),e=include("nature.data.Tiles"),f=3e3,g=function(){a=d.instance,b=[],this.update=this.update.bind(this)},h=g.prototype;h.reset=function(){if(c=f,b)for(var a=0,d=b.length;d>a;a++){var e=b[a];e&&(e.isHinting=!1,e.highlight.update.apply(e.highlight,null))}},h.show=function(c,d){b&&this.reset();var f,g,h,j=d.grid,k=function(a,b,c){var d=j[a];if(d){var f=d[b];if(f&&f.type.depth!==e.cleared.depth&&!f.hiddenByLayout&&(c||f.isHinting===!1))return f}return null};for(h=d.tilesById.length,g=0;h>g;g++)d.tilesById[g].isHinting=!1;var l=c.piecesTotal-c.piecesFound;3>l&&(l=3);var m=l,n=function(a){var b=[k(a.row-1,a.column),k(a.row,a.column-1),k(a.row,a.column),k(a.row,a.column+1),k(a.row+1,a.column)];for(g=b.length-1;g>=0;g--)b[g]||b.splice(g,1);return b}.bind(this),o=d.tilesById.slice(),p=c.asset;for(g=o.length-1;g>=0;g--)f=o[g],f.item&&f.item.asset==p||o.splice(g,1);b=[o.random()];for(var q,r=0;b.length<=m&&++r<30;)if(q=b.random(),q&&(q=k(q.row,q.column,!0))){var s=n(q);h=s.length;for(var t=0;h>t;t++){var u=s[t];u.isHinting===!1&&(u.isHinting=!0,b.push(u))}}this.updateHint=function(a){if(h=b.length){if(a)for(g=0;h>g;g++)if(f=b[g],f.row==a.row&&f.column==a.column){b.splice(g,1),h=b.length;break}for(g=0;h>g;g++)if(f=b[g]){var c=d.getSurroundingTiles(f);c=i(c),f.highlight.update.apply(f.highlight,c)}}}.bind(this),this.updateHint(),a.on("update",this.update)};var i=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];a[b]=d?!d.isHinting:!0}return a};h.update=function(d){c-=d,0>c&&(a.off("update",this.update),this.reset(),b=null)},h.destroy=function(){s.destroy.call(this),c=null,a=null},namespace("nature.powerups").HintCloud=g}();var DelayedCall=include("springroll.DelayedCall");namespace("nature.powerups").Shockwave=function(a,b,c){var d=a.grid,e=d[b][c],f=100,g=80,h=e.row,i=e.column;d[h][i].dig(1,!0);var j,k,l,m,n,o=1,p=1,q=function(){function a(a){a&&(b=!1,a.dig(1,!0))}var b=!0;for(j=d[h],a(j[i-o]),a(j[i+o]),p=1;o>=p;p++)k=d[h-p],l=d[h+p],m=i-(o-p),n=i+(o-p),k&&(a(k[m]),m!=n&&a(k[n])),l&&(a(l[m]),m!=n&&a(l[n]));(++o==f||b===!0)&&r.destroy()},r=new DelayedCall(q,g,{repeat:!0})},namespace("nature.powerups").Shovel=function(a,b,c){c=c||1;var d,e,f=b.row,g=b.column,h=[],i=[];for(i.push(a[f]),d=1;c>=d;++d)i.push(a[f-d],a[f+d]);for(d=0,e=i.length;e>d;d++)if(row=i[d],row){h.push(row[g]);for(var j=1;c>=j;j++)h.push(row[g-j],row[g+j])}for(d=0,e=h.length;e>d;++d){var k=h[d];k&&k.dig(4,!0)}},function(){var a,b=include("springroll.Application"),d=include("springroll.DelayedCall"),e=include("nature.data.Tiles"),f=100,g=e.cleared.depth,h=e.soil,i={x:-4,y:12},j=function(){this.app=b.instance,a=[]},k=j.prototype;k.add=function(b,e){function j(){var a=q.length,b=A?a-1-x:x,c=q[b];c.dig(g,!0),m.add(h,c.x,c.y,{count:50,minX:20,maxX:50,minY:700,maxY:1e3}),++x>=a&&z.destroy()}var k=b.grid,l=b.altGrid,m=b.digParticles,n=9999,o=(b.rows-b.columns)*g;0>o&&(o=0);var p=(b.columns-b.rows)*g;0>p&&(p=0);var q,s,t,u=b.rows,v=b.columns;for(r=0;r<u;++r){for(t=0,c=0;c<v;++c)s=k[r][c],t+=s.hiddenByLayout?g:s.type.depth,t+=o;n>t&&(n=t,q=k[r])}for(c=0;c<v;++c){for(t=0,r=0;r<u;++r)s=l[c][r],t+=s.hiddenByLayout?g:s.type.depth,t+=p;n>t&&(n=t,q=l[c])}var w,x=0,y=a.length;w=y&&!a[y-1].visible?a.pop():new pixiflash_lib.Vole,w.x=e.x+i.x,w.y=e.y+i.y;var z;w.visible=!0,this.app.animator.play(w,"vole",function(){z=new d(j,f,{repeat:!0})}),b.foundItemContainer.addChild(w),a.push(w);var A=[!1,!0].random()},k.reset=function(){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.app.animator.stop(d),d.visible=!1}},k.destroy=function(){this.reset();for(var b=0;b<a.length;++b)a[b].destroy();a=null},namespace("nature.powerups").Voles=j}(),function(){var a,b,c=include("springroll.Application"),d=include("PIXI.Container"),e=include("createjs.Ease"),f=include("PIXI.Sprite"),g=include("createjs.Tween"),h=function(){a=c.instance,d.call(this),b=new f(a.getCache("GameUI").getFrame("arrow"));var e=b.texture;b.x=-e.width,b.y=-e.height,this.addChild(b),this.visible=!1},i=extend(h,d),j=d.prototype;i.show=function(a,c,d,f){a?(this.visible=!0,b.visible=!0,this.x=a,this.y=c,this.rotation=d,f!==!1&&g.get(b,{loop:!0}).to({y:b.y+20},220,e.sineInOut).to({y:b.y},220,e.sineInOut)):(g.removeTweens(b),this.visible=!1)},i.destroy=function(){this.removeChildren(),g.removeTweens(b),a=null,b=null,j.destroy.call(this)},namespace("nature").BouncingArrow=h}(),function(){var a=include("springroll.Application"),b=include("PIXI.extras.BitmapText"),c=include("springroll.pixi.Button"),d=include("springroll.ButtonSounds"),e=include("PIXI.Graphics"),f=include("PIXI.Rectangle"),g=include("PIXI.Sprite"),h=include("PIXI.Container"),i=100,j=parseInt("000000",16),k=.6,l=function(l,m){h.call(this),this.items=l,this.app=a.instance,this.blocker=new e,this.blocker.beginFill(j,k);var n=1200/i,o=800/i;this.blocker.drawRect(0,0,n,o),this.blocker.hitRect=new f(0,0,n,o),this.blocker.interactive=!0,this.blocker.endFill(),this.addChild(this.blocker);var p=this.app.getCache(m),q=[];for(var r in l){var s,t=l[r];if(l[r].up)s=new c(t),s.isButton=!0,q.push(s);else if(t.font||t.text)s=new b("",t),s.setPivotToAlign=!0;else{var u=p.getFrame(r);u&&(s=new g(u))}s&&(s.key=r,this.addChild(s),this.app.scaling.addItem(s,t),this[r]=s)}this.buttonSounds=new d("ButtonSelect","ButtonRollover",q),this.onResize=this.onResize.bind(this),this.app.on("resize",this.onResize,-3),setTimeout(this.onResize,1),this.visible=!1},m=extend(l,h),n=h.prototype;m.onResize=function(a,b){var c=this.app.scaling.scale*i;this.blocker.scale.x=c,this.blocker.scale.y=c},m.show=function(a){var b=this.items;for(var c in b){var d=this[c];d&&d.isButton&&(d.enabled&&(d.enabled=!1,d.enabled=!0),d.off("buttonPress",this.onButtonPress),a&&d.on("buttonPress",this.onButtonPress))}a&&this.parent.addChild(this),this.visible=a;var e=this.app.manager.currentState.panel.pauseButton;e&&(e.visible=!a)},m.destroy=function(){this.app.off("resize",this.onResize),this.removeChildren&&this.removeChildren(),n.destroy.call(this)},namespace("nature").Dialog=l}(),function(){var a,b=include("springroll.Application"),c=include("nature.Dialog"),d={endHeader:{x:223,y:22},accentMud:{x:548,y:364},boneMud:{x:300,y:380},toyMud:{x:300,y:194},boneIcon:{x:350,y:446},toyIcon:{x:360,y:242},endMud:{align:"bottom-right",x:564,y:358},houseButton:{align:"bottom-right",x:640,y:475,up:"houseButton_up",over:"houseButton_over",down:"houseButton_down"},houseButtonNew:{align:"bottom-right",x:640,y:475,up:"houseButton_upNew",over:"houseButton_overNew",down:"houseButton_downNew"},restartButton:{align:"bottom-right",x:720,y:376,up:"restartButton_up",over:"restartButton_over",down:"restartButton_down"},levelTitle:{font:"86px levelTitleFont",align:"center",x:450,y:14},toysFound:{font:"86px itemsFoundFont",align:"left",titleSafe:!0,x:470,y:225},fossilsFound:{font:"86px itemsFoundFont",align:"left",titleSafe:!0,x:470,y:410}},e=function(){a=b.instance,this.onButtonPress=this.onButtonPress.bind(this),c.call(this,d,"GameUI")},f=extend(e,c),g=c.prototype;f.show=function(b,c,d,e){if(b){a.sound.stop("5Seconds");var f=a.Unlocks;this.levelTitle.text="Level "+(c+1),this.toysFound.text=(f.toys.length||0).toString(),this.fossilsFound.text=(f.fossils.length||0).toString(),this.houseButton.visible=!f.newUnlock,this.houseButtonNew.visible=f.newUnlock}g.show.call(this,b)},f.onButtonPress=function(b){switch(this.houseButton.off("buttonPress",this.onButtonPress),this.restartButton.off("buttonPress",this.onButtonPress),b){case this.houseButton:case this.houseButtonNew:a.manager.currentState.onDoghouseButton();break;case this.restartButton:a.manager.currentState.onRestartButton()}},f.destroy=function(){this.houseButton.off("buttonPress",this.onButtonPress),this.restartButton.off("buttonPress",this.onButtonPress),this.houseButton.destroy(),this.restartButton.destroy(),g.destroy.call(this),this.levelTitle=null,this.toysFound=null,this.fossilsFound=null,this.houseButton=null,this.restartButton=null,this.houseButton=null,this.restartButton=null,a=null},namespace("nature").GameOverDialog=e}(),function(){var a,b,c,d=include("springroll.Application"),e=include("PIXI.extras.BitmapText"),f=include("PIXI.Container"),g=include("PIXI.Sprite"),h=function(){f.call(this);var h=d.instance.getCache("GameUI");a=new g(h.getFrame("levelContainer")),this.addChild(a),c=new e("level",{font:"22px levelTitleFont",align:"right"}),c.x=12,c.y=10,this.addChild(c),b=new e("99",{font:"36px levelNumberFont",align:"right"}),b.x=80,b.y=0,this.addChild(b)},i=extend(h,f),j=f.prototype;i.set=function(a){a+=1,9>=a?(c.x=23,b.x=88):99>=a?(c.x=15,b.x=76):(c.x=12,b.x=70),b.text=a},i.destroy=function(){j.destroy.call(this),a.destroy(),a=null,c=null,b=null},namespace("nature").LevelIndicator=h}(),function(){var a,b,c,d=include("springroll.Application"),e=include("nature.Dialog"),f=include("createjs.Tween"),g=.3,h={fossilName:{font:"38px fossilTypeFoundFont",align:"center",x:450,y:130},fossilBurst:{x:440,y:320},fossilHeader:{x:190,y:32},nextButton:{x:324,y:444,up:"nextButton_up",over:"nextButton_over",down:"nextButton_down"}},i=function(){a=d.instance,this.onButtonPress=this.onButtonPress.bind(this),this.update=this.update.bind(this),e.call(this,h,"GameUI"),b=this.fossilBurst;var c=b.texture;b.pivot.x=c.width/2,b.pivot.y=c.height/2},j=extend(i,e),k=e.prototype;j.show=function(d,e){if(a.off("update",this.update),k.show.call(this,d),d&&e){c=e;var h=c.levelUpPosition||{};c.visible=!0,c.rotation=0,c.x=450+(h.x||0),c.y=325+(h.y||0),c.scale.x=c.scale.x*(h.scale||1.5),c.scale.y=c.scale.y*(h.scale||1.5),a.scaling.addItem(c),this.addChild(c);var i={x:c.scale.x,y:c.scale.y},j={x:b.scale.x,y:b.scale.y};b.scale.x=0,b.scale.y=0,c.scale.x=0,c.scale.y=0;var l=a.sound;f.get(c.scale).wait(50).to({x:i.x,y:i.y},350),f.get(b.scale).wait(50).to({x:j.x,y:j.y},250).call(function(){l.play("human-41",{loop:!0})});var m=c.asset.split("_"),n=a.config.fossils[m[0]];if(n&&(1==n.parts.length?this.fossilName.text=n.displayName:this.fossilName.text=n.displayName+" "+m[1]),this.addChild(this.fossilName),Math.random()<g){var o=a.manager.currentState.panel,p=o.halFossilFound;o.addChild(p),p.visible=!0,a.animator.play(p,[{anim:"goodOne",audio:{alias:"BigDig_Fossil_GoodOne",start:0}},{anim:"nextRound",audio:{alias:"BigDig_Fossil_OntoNextRound",start:333}},{anim:"niceFind",audio:{alias:"BigDig_Fossil_NiceFind",start:66}},{anim:"checkOut",audio:{alias:"BigDig_Fossil_CheckOutThatFossil",start:33}}].random())}else Math.random()<g&&a.voPlayer.play(["Hal_Game_DidIt","Hal_Game_DidIt2","Hal_Game_DidIt3"].random());a.on("update",this.update)}else a.sound.stop("human-41"),this.removeChild(c),a.scaling.removeItem(c),c=null},j.update=function(a){b.rotation+=.01/a},j.onButtonPress=function(b){this.nextButton.off("buttonPress",this.onButtonPress),a.manager.currentState.startNextLevel()},j.destroy=function(){a.off("update",this.update),k.destroy.call(this),this.fossilBurst=null,this.fossil=null,this.fossilName=null,b=null,c=null,a=null},namespace("nature").LevelUpDialog=i}(),function(){var a,b=include("springroll.Application"),c=include("nature.Dialog"),d={pauseMenu:{x:70,y:40},restartButton:{x:266,y:264,up:"restartButton_up",over:"restartButton_over",down:"restartButton_down"},resumeButton:{x:475,y:264,up:"resumeButton_up",over:"resumeButton_over",down:"resumeButton_down"},quitButton:{x:378,y:344,up:"quitButton_up",over:"quitButton_over",down:"quitButton_down"}},e=function(){a=b.instance,this.onButtonPress=this.onButtonPress.bind(this),c.call(this,d,"GameUI")},f=extend(e,c),g=c.prototype;f.onButtonPress=function(b){switch(b){case this.quitButton:a.manager.currentState.onQuitButton();break;case this.restartButton:a.manager.currentState.onRestartButton();break;case this.resumeButton:a.manager.currentState.onResumeButton()}},f.destroy=function(){this.onButtonPress=null,g.destroy.call(this)},namespace("nature").PauseDialog=e}(),function(){var a,b,c=include("springroll.Application"),d=include("nature.Dialog"),e={powerupHeader:{x:190,y:32},drill_large:{x:290,y:120,scale:.75},shockwave_large:{x:290,y:120,scale:.75},shovel_large:{x:290,y:120,scale:.75},search_large:{x:290,y:120,scale:.75},vole_large:{x:290,y:120,scale:.75},okButton:{x:350,y:460,up:"okButton_up",over:"okButton_over",down:"okButton_down"}},f=function(b,f){a=c.instance,this.onButtonPress=this.onButtonPress.bind(this),d.call(this,e,"GameUI")},g=extend(f,d),h=d.prototype;g.show=function(c){if(this.shovel_large.visible=!1,this.vole_large.visible=!1,this.shockwave_large.visible=!1,this.search_large.visible=!1,this.drill_large.visible=!1,c)switch(b=c,this[c.asset+"_large"].visible=!0,name){case"shovel":a.voPlayer.play("BigDig_Tutorial_Shovel");break;case"vole":a.voPlayer.play("BigDig_Tutorial_Vole");break;case"shockwave":a.voPlayer.play("BigDig_Tutorial_Shockwave");break;case"search":a.voPlayer.play("BigDig_Tutorial_Hint");break;case"drill":case"pickaxe":a.voPlayer.play("BigDig_Tutorial_Pickaxe")}h.show.call(this,!!c)},g.onButtonPress=function(c){this.okButton.off("buttonPress",this.onButtonPress),this.show(!1);var d=b;b=null,a.manager.currentState.onPowerupDialogClose(d)},g.destroy=function(){h.destroy.call(this),this.okButton=null,this.shovel_large.visible=null,this.vole_large.visible=null,this.shockwave_large.visible=null,this.search_large.visible=null,this.drill_large.visible=null,b=null,a=null},namespace("nature").PowerupDialog=f}(),function(){var a=include("springroll.Application"),b=include("PIXI.extras.BitmapText"),c=include("PIXI.Container"),d=include("PIXI.Sprite"),e=function(e,f){c.call(this),this.asset=e.asset,this.atlas=a.instance.getCache("GameElements"),this.icon=new d(this.atlas.getFrame(e.asset)),this.icon.x=0,this.icon.y=this.icon.texture.height/2,this.icon.anchor.y=.5,this.addChild(this.icon),this.uses=new b("",{font:"30px levelNumberFont",align:"left"}),this.uses.x=this.icon.x+20,this.uses.y=this.icon.y+10,this.uses.text=f,this.addChild(this.uses)},f=extend(e,c);c.prototype;f.reset=function(a,b){this.asset=a.asset,this.icon.texture=this.atlas.getFrame(a.asset),this.uses.text=b,this.visible=!0},f.decrement=function(){var a=parseInt(this.uses.text)-1;return this.uses.text=a,a},namespace("nature").PowerupIcon=e}(),function(){var a,b,c,d,e=include("springroll.Application"),f=include("PIXI.Container"),g=include("createjs.Ease"),h=include("springroll.pixi.PercentTexture"),i=include("PIXI.Sprite"),j=include("createjs.Tween"),k=function(){f.call(this),a=e.instance;var g=a.getCache("GameUI");this.back=new i(g.getFrame("Timer_back")),this.addChild(this.back),this.timerTexture=new h(g.getFrame("Timer_fill"),void 0,void 0,void 0,void 0,!0),this.fill=new i(this.timerTexture),this.addChild(this.fill),this.fill.x-=20,this.update=this.update.bind(this);var j=a.config.game;d=j.maxGameTime,b=j.flashWarningPulseSpeed,c=j.flashWarningSecondsLeft},l=extend(k,f),m=f.prototype;Object.defineProperty(l,"paused",{set:function(b){b?(a.sound.stop("5Seconds"),a.off("update",this.update)):(!this.flashTween||this.addTimeTween||a.sound.isPlaying("5Seconds")||a.sound.play("5Seconds",{loop:!0}),a.on("update",this.update))}}),l.reset=function(){j.removeTweens(this),this.flashTween=null,this.green=255,this.blue=255,this.fill.tint=16777215,this.time=d},l.update=function(e){if(!(this.time<0)){this.time-=e,this.time<=0&&(this.time=0,this.timeUp(),a.off("update",this.update));var f=this.time/d;this.timerTexture.setPercent(f),this.flashTween?this.fill.tint=this.red|this.green<<8|this.blue:this.fill.tint=16777215,!this.addTimeTween&&this.time&&(this.time>c&&this.flashTween&&this.green>230?(a.sound.stop("5Seconds"),j.removeTweens(this),this.flashTween=null,this.fill.tint=16777215):this.time<c&&(this.flashTween||(a.sound.isPlaying("5Seconds")||a.sound.play("5Seconds",{loop:!0}),this.green=255,this.blue=255,this.red=255<<16,this.flashTween=j.get(this,{loop:!0}).to({green:0,blue:0},b).to({green:255,blue:255},b))))}},l.addTime=function(b,c){var e=this.time+b;if(e>d&&(e=d),this.addTimeTween=!0,j.get(this).to({time:e},b/6,g.cubicInOut).call(function(){this.addTimeTween=!1,this.flashTween&&!a.sound.isPlaying("5Seconds")&&a.sound.play("5Seconds",{loop:!0})}.bind(this)),c){a.voPlayer.play(["Hal_Game_BonusTime","Hal_Game_AddingTime"].random());var f=this.parent.toLocal({x:c.x,y:c.y},c.parent);c.x=f.x,c.y=f.y,this.parent.addChild(c),baseTime=1.5*Math.dist(f.x,f.y,450,50),j.get(c.scale).to({x:1.4,y:1.4},200,g.backOut).to({x:0,y:0},baseTime),j.get(c).wait(150).to({x:450,y:50},.9*baseTime,g.quartIn).call(function(){c.parent.removeChild(c)})}},l.timeUp=function(){a.off("update",this.update),a.sound.stop("5Seconds"),a.sound.play("EndTimer"),a.manager.currentState.gameOver()},l.destroy=function(){m.destroy.call(this),a.off("update",this.update),j.removeTweens(this),this.back.destroy(),this.fill.destroy(),this.timerTexture.destroy(),this.back=null,this.blue=null,this.fill=null,this.flashTween=null,this.timerTexture=null,this.green=null,this.time=null,this.red=null,this.timerTexture=null,a=null},namespace("nature").Timer=k}(),function(){var a,b=include("springroll.Application"),c=include("PIXI.Container"),d=include("PIXI.Sprite"),e=400,f=.8,g=[],h=[],i=function(){c.call(this),a=b.instance,_atlas=a.getCache("GameElements"),this.update=this.update.bind(this)},j=extend(i,c);j.update=function(b){if(!h.length)return void a.off("update",this.update);for(var c=b/1e3,d=h.length-1;d>=0;--d){var i=h[d];i.y+=i.force.y*c,i.force.y*=i.friction.y,i.y+=e*c,i.x+=i.force.x*c,i.rotation+=i.torque*c,i.lifetime-=b,i.lifetime<0&&(i.alpha*=f,i.alpha<.05&&(this.removeChild(i),g.push(h.splice(d,1))))}},j.add=function(b,c,e,f){void 0===f&&(f={});for(var i=b.particles,j=f.count||Math.randomInt(2,5),k=f.minX||50,l=f.maxX||200,m=f.minY||1100,n=f.maxY||1300,o=nature.TileGrid.tilePixelSize,p=o/2,q=j-1;q>=0;--q){var r=g.length?g.pop()[0]:new d;r.texture=_atlas.getFrame(i.random()),r.pivot.x=r.texture.width/[2,2.5,3].random(),r.pivot.y=r.texture.height/[2,2.5,3].random();var s=Math.randomInt(0,o),t=Math.randomInt(0,o);r.x=c+s,r.y=e+t,r.force={x:Math.randomInt(k,l)*(p>s?-1:1),y:-1*Math.randomInt(m,n)},r.friction={x:.9,y:.9},r.torque=.1*r.force.x,r.alpha=1,h.push(r),r.lifetime=200*Math.random()+100,this.addChild(r)}a.off("update",this.update),a.on("update",this.update)},spritedestroy=function(){s.destroy.call(this)},namespace("nature").DigParticles=i}(),function(){var a=include("springroll.Application"),b=include("PIXI.Sprite"),c=function(a){b.call(this),a&&this.init(a)},d=extend(c,b),e=b.prototype;d.init=function(b){if(this.levelUpPosition=b.levelUpPosition,this.digPosition=b.digPosition,this.grid=b.grid,this.grid90=this.grid270=null,this.sprite=b.sprite,this.rows=b.rows,this.columns=b.columns,this.piecesTotal=b.piecesTotal,this.canRotate=b.canRotate!==!1,this.piecesFound=0,this.app=a.instance,b.asset){var c=this.app.getCache(this.sprite||"GameElements");this.texture=c.getFrame(b.asset)}return this.asset=b.asset,b.name=this.name=b.name||b.asset,this},d.reset=function(){this.asset=null,this.canRotate=null,this.category=null,this.columns=null,this.digPosition=null,this.doghousePos=null,this.grid=null,this.lockedPosition=null,this.name=null,this.piecesFound=0,this.piecesTotal=null,this.rotation=0,this.rows=null,this.scale.x=1,this.scale.y=1,this.sfx=null,this.texture=null},d.destroy=function(){e.destroy.call(this)},namespace("nature").Findable=c}(),function(){var a,b,c=include("springroll.Application"),d=include("PIXI.Container"),e=include("nature.PowerupIcon"),f=include("createjs.Ease"),g=include("nature.data.Tiles"),h=include("createjs.Tween"),i=40,j=function(){d.call(this),j.addChild=this.addChild,a=c.instance,b=a.manager.currentState;for(var e in a.config.powerups)j[e]=0;this.queue=[],this.iconPool=[],j.Decrement=this.decrement.bind(this)},k=extend(j,d),l=d.prototype;k.reset=function(){for(;this.queue.length;){var a=this.queue.pop();a.visible=!1,this.iconPool.push(a)}this.queue=[]},k.add=function(a,b){b=b||a.uses;var c,d=this.iconPool.length;d&&!this.iconPool[d-1].visible?(c=this.iconPool.pop(),c.reset(a,b)):c=new e(a,b),this.queue.push(c);var f=this.queue.length-1;c.x=i*f,c.alpha=1-.2*f,c.scale.x=c.scale.y=1-.2*f,c.uses.visible=0===f,this.addChild(c)},k.decrement=function(a){var b=this.queue.length?this.queue[0]:null;if(b){if("drill"==b.asset&&a==g.cleared.depth)return null;var c=b.decrement();if(!c){var d=this.queue.shift();h.get(d.scale).to({x:0,y:0},250).call(function(){d.visible=!1,this.iconPool.push(d)}.bind(this,d));for(var e=0,j=this.queue.length;j>e;e++){var k=this.queue[e];h.get(k).to({x:k.x-i,alpha:1-.2*e},250,f.cubicInOut),h.get(k.scale).to({x:1-.2*e,y:1-.2*e},250,f.bounceOut),k.uses.visible=0===e}}}return b},j.HideIcon=function(a){h.get(j[a+"Icon"].scale).to({x:0,y:0},100,f.backIn),h.get(j[a+"Count"].scale).to({x:0,y:0},100,f.backIn).call(function(){j[a+"Icon"].visible=!1,j[a+"Count"].visible=!1})},k.destroy=function(a){l.destroy.call(this)},namespace("nature").Powerups=j}(),function(){var a,b,c=include("springroll.Application"),d=include("nature.DebugOptions"),e=include("nature.Powerups"),f=include("PIXI.Sprite"),g=include("nature.data.Tiles"),h=include("nature.powerups.Shovel"),i=function(d,e,g,h,i,j){f.call(this),a=c.instance,b=a.states.game,this.delayedMoveToBack=this.delayedMoveToBack.bind(this),this.onMousedown=this.onMousedown.bind(this),this.tileGrid=d,this.init(e,g,h,i,j)},j=extend(i,f),k=f.prototype;j.init=function(a,c,e,f,h){return this.item=null,this.texture=null,this.buttonMode=!1,this.interactive=!1,this.column=c,this.row=a,this.id=e,this.type=f,this.hiddenByLayout=h,this.hiddenByLayout||this.tileGrid.coverTiles.addChild(this),d.testGrids||(this.texture=b.panel.tileTextures[this.type.depth],this.pivot.x=this.texture.width/2,this.pivot.y=this.texture.height/2,this.type.depth==g.rock.depth?this.rotation=0:this.rotation=[0,1.5708,Math.PI,4.71239].random(),this.enable(!0)),this},j.enable=function(a){a=a&&this.type.depth!=g.cleared.depth,this.buttonMode=this.interactive=a,this.off("mousedown",this.onMousedown),this.off("touchstart",this.onMousedown),a&&(this.on("mousedown",this.onMousedown),this.on("touchstart",this.onMousedown))},j.onMousedown=function(c){b.onTileClicked(),this.type.sfx&&a.sound.play(this.type.sfx.random());var d=e.Decrement(this.type.depth);if(d)switch(d.asset){case"shovel":h(this.tileGrid.grid,this,1);break;case"drill":case"pickaxe":this.dig(4,!0)}else this.type.depth<g.cleared.depth&&this.dig(1,!1)},j.dig=function(c,d){if(!(this.hiddenByLayout||this.type.depth>=g.cleared.depth)){this.tileGrid.digParticles.add(this.type,this.x,this.y);var e=this.type.depth+c;switch(e>=g.cleared.depth&&(e=g.cleared.depth),e){case g.rock.depth:this.type=i.rock;break;case g.pebbles.depth:this.type=g.pebbles;break;case g.grass.depth:this.type=g.grass;break;case g.soil.depth:this.type=g.soil;break;case g.cleared.depth:this.type=g.cleared,this.item&&(this.tileGrid.revealItem(this.item),this.item=!1),b.onTileCleared(this,d),this.tileGrid.updateBorders(this),a.setTimeout(this.delayedMoveToBack,0)}this.texture=b.panel.tileTextures[this.type.depth]}},j.delayedMoveToBack=function(){this.tileGrid.backTiles.addChild(this)},j.destroy=function(){this.enable(!1),k.destroy.call(this),this.tileGrid=null,this.delayedMoveToBack=this.onMousedown=null,b=null},namespace("nature").Tile=i}(),function(){var a,b=include("springroll.Application"),c=include("PIXI.Container"),d=include("PIXI.Sprite"),e=_southeast={x:50,y:0,rotation:1.5708},f=_southwest={x:50,y:50,rotation:Math.PI},g=_northwest={x:0,y:50,rotation:4.71239},h=northeast={x:0,y:0,rotation:0},i=[],j=function(d,e,f){c.call(this),this.pieceType=f,this.app=b.instance,a=this.app.getCache("GameElements"),this.x=d,this.y=e},k=extend(j,c),l=c.prototype;k.add=function(b,c){var e=i.pop();e||(e=new d),e.texture=a.getFrame(c),e.x=b.x,e.y=b.y,e.rotation=b.rotation,this.addChild(e),this.active=!0},k.update=function(a,b,c,d,i,j,k,l){this.clear();var m=this.pieceType.side;a&&this.add(e,m),c&&this.add(f,m),i&&this.add(g,m),k&&this.add(h,m);var n=this.pieceType.corner;l&&(a||k||this.add(_northwest,n)),!j||i||k||this.add(f,n),!b||a||c||this.add(h,n),!d||i||c||this.add(e,n)},k.clear=function(){for(var a=0,b=this.children.length;b>a;++a)i.push(this.children[a]);this.removeChildren(),this.active=!1},k.destroy=function(){l.destroy.call(this)},namespace("nature").TileBorder=j}(),function(){var a=include("springroll.Application"),b=include("nature.BuildRotatedGrid"),d=include("PIXI.Container"),e=include("nature.DebugOptions"),f=include("nature.DigParticles"),g=include("nature.EnsureGridIsRectangular"),h=include("nature.Findable"),j=include("nature.Tile"),k=include("nature.TileBorder"),l=include("nature.data.Tiles"),m=include("nature.WeightedArray"),n=1.5708,o=4.71239,p=[0,n,o],q=function(){d.call(this),this._app=a.instance,this.backTiles=new d,this.addChild(this.backTiles),this.itemLayer=new d,this.addChild(this.itemLayer),this.borderLayer=new d,this.addChild(this.borderLayer),this.coverTiles=new d,this.addChild(this.coverTiles),this.foundItemContainer=new d,this.addChild(this.foundItemContainer),this.digParticles=new f,this.foundItemContainer.addChild(this.digParticles),this._tilePool=[],this._findablesPool=[],this._enabled=!0,this.foundItemQueue=[]};q.tilePixelSize=49;var s=extend(q,d),t=d.prototype;Object.defineProperty(s,"enabled",{get:function(){return this._enabled},set:function(a){if(this.tilesById){this._enabled=a;for(var b=0,c=this.tilesById.length;c>b;b++)this.tilesById[b].enable(a)}}}),s.clean=function(){if(this.borderLayer.removeChildren(),this.findables){var a,b;for(a=this.findables.length-1;a>=0;--a){var c=this.findables[a];c.parent&&c.parent.removeChild(c),c.reset(),this._findablesPool.push(c)}for(a=0,b=this.tilesById.length;b>a;a++){var d=this.tilesById[a];d.parent&&d.parent.removeChild(d),this._tilePool.push(d)}this.tilesById=null,this.findables=null,this.foundItemQueue=null,this.grid=[]}},s.makeGrid=function(a,b){if(this.clean(),b){var c=g(b);this.rows=c.rows,this.columns=c.columns,this.grid=b}else for(this.columns=a.columns,this.rows=a.rows,this.grid=new Array(this.rows),i=0;i<this.rows;++i)this.grid[i]=new Array(this.columns);for(this.altGrid=new Array(this.columns),i=0;i<this.columns;++i)this.altGrid[i]=new Array(this.rows);this.totalTiles=-1,this.tilesById=new Array(this.rows*this.columns);var d=[l.rock,l.pebbles,l.grass,l.soil],f=a.tileWeights;if(f){d=[];for(var h in f){var m=f[h];for(i=0;i<m;++i)d.push(l[h])}}var n=q.tilePixelSize/2,o=-(this.columns*n)+n,p=-(this.rows*n-n)+n;for(r=0;r<this.rows;r++)for(var s=0;s<this.columns;s++){var t,u=b?b[r][s]:1,v=0===u;t=this._tilePool.length?this._tilePool.pop().init(r,s,++this.totalTiles,d.random(),v):new j(this,r,s,++this.totalTiles,d.random(),v);var w=this.grid[r][s]=this.altGrid[s][r]=t;if(this.tilesById[w.id]=w,w.x=o+q.tilePixelSize*s,w.y=p+q.tilePixelSize*r,!e.testGrids){var x=new k(w.x-w.pivot.x,w.y-w.pivot.y,{side:"dirt_side",corner:"dirt_corner"});this.borderLayer.addChild(x),w.border=x;var y=new k(w.x-w.pivot.x,w.y-w.pivot.y,{side:"highlight_side",corner:"highlight_corner"});this.foundItemContainer.addChild(y),w.highlight=y}}this.findables=[],this.foundItemQueue=[]},s.placeCategory=function(a,b){if(a){Array.isArray(a)===!1&&(a=[a]);for(var c=0;c<a.length;++c){var d=a[c];if(d&&(weightedArray=m(d),weightedArray))for(i=0;i<d.count;++i){var e=weightedArray.random(),f=this._app.allFindables[e];this.placeItem(f,b)}}}},s.placeItem=function(a,b,c,d){var e;if(this._findablesPool.length?(e=this._findablesPool.pop(),e.reset(),e.init(a)):e=new h(a),homeTile=this.findPosition(e,b,c,d),
homeTile){a.digPosition=a.digPosition||{};var f={x:a.digPosition.x||0,y:a.digPosition.y||0,scale:a.digPosition.scale||1,rotation:a.digPosition.rotation*(Math.PI/180)||0};e.homeTile=homeTile,"fossils"==b?(e.x=homeTile.x-homeTile.pivot.x,e.y=homeTile.y-homeTile.pivot.y,e.pivot.x=e.texture.width/2,e.pivot.y=e.texture.height/2,e.gridRotation==n?(e.x+=q.tilePixelSize*e.rows,e.x-=f.y+e.pivot.y,e.y+=f.x+e.pivot.x):e.gridRotation==o?(e.y+=q.tilePixelSize*e.columns,e.x+=f.y+e.pivot.y,e.y-=f.x+e.pivot.x):(e.x+=f.x+e.pivot.x,e.y+=f.y+e.pivot.y)):(e.pivot.x=e.texture.width/2,e.pivot.y=e.texture.height/2,e.x=homeTile.x-homeTile.pivot.x+e.pivot.x,e.y=homeTile.y-homeTile.pivot.y+e.pivot.y,e.x+=f.x,e.y+=f.y,e.scale.x=f.scale,e.scale.y=f.scale,e.rotation=f.rotation),e.scale.x=e.scale.y=f.scale,e.rotation=e.gridRotation+f.rotation;e.category=b,e.visible=!1,this.itemLayer.addChild(e),this.findables.push(e),"fossils"==b&&(this.fossil=e)}},s.findPosition=function(a,b,c,d){for(var e=null,f=[],g=0;g<=this.totalTiles;g++)f[g]=g;f.shuffle();var h,i=0;for(a.canRotate?(h=p,h.shuffle()):h=[0],null!=d&&(h=[d]);!e;){var j=f.pop();if(null==j)break;if(e=this.tilesById[j],null!=c&&(e=this.tilesById[c]),e.item||e.hiddenByLayout)e=null;else{var k=!1,l=h.length;for(i=0;l>i;i++){var m=h[i];0===m?a.columns:a.rows,0===m?a.rows:a.columns;if(this.testItemGridAgainstTileGrid(a,e,m))return a.gridRotation=m,k=!0,e}k||(e=null)}}return!1},s.testItemGridAgainstTileGrid=function(a,d,e){var f,g=null;0===e?g=a.grid:e==n?(a.grid90||(a.grid90=b(a.grid,90)),g=a.grid90):e==o&&(a.grid270||(a.grid270=b(a.grid,270)),g=a.grid270);var h,i=[],j=g.length;for(r=0;r<j;++r){var k=g[r].length;for(c=0;c<k;++c)if(g[r][c]){h=null;var l=this.grid[d.row+r];if(!l)return!1;if(h=l[d.column+c],!h||h.hiddenByLayout||h.item)return!1;i.push(h)}}for(f=0,j=i.length;j>f;f++)h=i[f],h.item=a;return!0},s.updateBorders=function(a){for(var b=this.tilesById,c=0,d=b.length;d>c;++c)b[c].borderUpdated=!1;this.updateBorder(a)},s.updateBorder=function(a){if(a.borderUpdated!==!0){var b,c,d,e=this.getSurroundingTiles(a),f=l.cleared.depth,g=[];for(b=0,c=e.length;c>b;b++)d=e[b],g.push(d?d.type.depth!=f:!0);for(a.border.update.apply(a.border,g),a.borderUpdated=!0,b=0,c=e.length;c>b;b++)d=e[b],d&&d.type.depth===f&&this.updateBorder(d)}},s.getSurroundingTiles=function(a){var b=this.grid,c=a.row,d=a.column,e=b[c],f=b[c-1]||{},g=b[c+1]||{};return[f[d],f[d+1],e[d+1],g[d+1],g[d],g[d-1],e[d-1],f[d-1]]},s.revealItem=function(a){var b=this._app.states.game;a.visible||("fossils"==a.category&&a.piecesTotal>1&&b.findFirstFossil(),a.visible=!0),a.piecesFound++,a.piecesFound>=a.piecesTotal&&this.foundItemQueue.push(a)},s.prioritizeQueue=function(){for(var a=[],b=[],c=[];this.foundItemQueue.length;){var d=this.foundItemQueue.pop();switch(d.category){case"fossils":a.push(d);break;case"powerups":b.push(d);break;case"toys":c.push(d)}}this.foundItemQueue=[].concat(a,c,b)},s.destroy=function(){t.destroy.call(this),this.backTiles.destroy(),this.borderLayer.destroy(),this.coverTiles.destroy(),this.digParticles.destroy(),this.foundItemContainer.destroy(),this.itemLayer.destroy(),this.backTiles=null,this.borderLayer=null,this.coverTiles=null,this.digParticles=null,this.foundItemContainer=null,this.foundItemQueue=null,this.grid=null,this.itemLayer=null,this._app=null,this._enabled=null,this._findablesPool=null,this._tilePool=null},namespace("nature").TileGrid=q}(),function(){var a,b,c,d,e,f=include("springroll.Application"),g=include("nature.BouncingArrow"),h=include("createjs.Ease"),j=include("nature.data.Tiles"),k=include("createjs.Tween"),l=function(e){d=e,b=f.instance,c=b.config.game.minHighScoreForTutorial,a=new g,b.scaling.addItem(a),d.panel.addChild(a),this.enabled=!0},m=l.prototype;Object.defineProperty(m,"enabled",{get:function(){return l.sessionHighScore?l.sessionHighScore<c:!0}}),m.firstLevelInstructions=function(c){b.voPlayer.play(["Hal_Tutorial_OneFossil",function(){var b=d.panel.timer;a.show(b.x+140,b.y+20,.75*-Math.PI)}.bind(this),"Hal_Tutorial_Timer",a.show.bind(a,!1)],c)},m.lockdownInstructions=function(c){this.lockdownEnabled=!1,this.clickToCompleteLockdown=!0;var e=d.panel.tileGrid,f=o()[0];b.voPlayer.play([function(){a.show(410,300,.25*-Math.PI,!1);var b=1800;k.get(a).to({x:a.x+200},b/2,h.sineInOut).to({x:a.x},b/2,h.sineInOut),k.get(a).to({y:a.y-85},b/4,h.sineInOut).to({y:a.y+85},b/2).to({y:a.y},b/4,h.sineInOut),l.highlight(!0)},"Hal_Tutorial_PlacesToDig",function(){a.show(!1),l.highlight(!1)},"Hal_Tutorial_WhenFossil",function(){var b=[!0,!0,!0,!0,!0,!0,!0,!0,!0];f.highlight.update.apply(f.highlight,b);var c=a.parent.toLocal({x:f.x,y:f.y},f.parent);a.show(c.x+10,c.y-40,.25*-Math.PI)},"Hal_Tutorial_SomeSoft",b.isMobile?"Hal_Tutorial_OneTap":"Hal_Tutorial_OneClick",function(){var b=[!1,!1,!1,!1,!1,!1,!1,!1,!1];f.highlight.update.apply(f.highlight,b),a.show(!1),e.enabled=!0},"BigDig_Tutorial_TryDigging",150,this.lockdownInstructionsComplete.bind(this)])},m.lockdownInstructionsComplete=function(){e=new DelayedCall(function(){b.voPlayer.play([b.isMobile?"Hal_Tutorial_OneTap":"Hal_Tutorial_OneClick","BigDig_Tutorial_TryDigging"])},15e3,{repeat:!0})},l.highlight=function(a){var b=d.panel.tileGrid;if(a){var c=o();for(i=0,len=c.length;i<len;i++){tile=c[i];var e=b.getSurroundingTiles(tile);e=n(e),tile.highlight.update.apply(tile.highlight,e)}}else for(i=0,len=b.tilesById.length;i<len;i++)tile=b.tilesById[i],tile.highlight.update.apply(tile.highlight,null);l.isHighlighting=a};var n=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];a[b]=d?d.type.depth===j.cleared.depth:!0}return a},o=function(){var a=d.panel.tileGrid,b=[];for(i=0,len=a.tilesById.length;i<len;i++)tile=a.tilesById[i],tile.type.depth<j.cleared.depth&&b.push(tile);return b};m.stop=function(){k.removeTweens(a),e&&e.destroy(),a.visible=!1},m.destroy=function(){e&&e.destroy(),d.panel.removeChild(a),b.scaling.removeItem(a),a.destroy(),e=null,b=null,a=null,d=null},namespace("nature").Tutorial=l}(),function(){var a,b,c,d,e=include("springroll.Application"),f=include("PIXI.Sprite"),g=function(g,h){f.call(this,g),c=e.instance,this.update=this.update.bind(this),this.trackMovement=this.trackMovement.bind(this),this.resize=this.resize.bind(this),c.on("resize",this.resize,-3),a||(d=nature.DogHouseState.TOY_VIEW_X,a={left:230+d,right:860+d,y:245},b={left:230+d,right:860+d,y:396}),this.anchor.x=.5,this.anchor.y=1,this.reset=function(){this.x=h.doghousePos.x+d,this.y=h.doghousePos.y,this.isWaitingForFetch=!1,this.visible=!0},this.reset(),this.asset=h.asset},h=25,i=350,j=1.1,k=.998,l=g.FLOOR=585,m=extend(g,f);f.prototype;m.enable=function(a){this.locked||(a=a||void 0===a,this.buttonMode=this.interactive=a)},m.determineStopPlane=function(){var c=.5*Math.abs(this.velocity.y);if(this.x>a.left&&this.x<a.right){if(this.y<a.y+c)return a.y;if(this.y<b.y+c)return b.y}return l},m.layerCheck=function(){this.stopPlane==l?this.parent.addChild(this):c.states.doghouse.panel.moveToyBelowHal(this)},m.onDragStart=function(){this.parent.addChild(this),c.sound.play(this.sfx),this.scale.x=1,this.scale.y=1,c.has("update",this.update)||(this.orig={x:this.x,y:this.y}),this.movement=[],this.trackingMovement=!0,c.off("update",this.update),c.on("update",this.trackMovement)},m.onDragEnd=function(){if(c.off("update",this.trackMovement),this.movement.length>=2){var a=this.movement.length-1;for(this.gravity=h;!this.movement[a]&&a>1;)a--;this.movement[a]||(a=1),this.velocity={x:1.25*(this.movement[0].x-this.movement[a].x),y:1.25*(this.movement[0].y-this.movement[a].y)},this.stopPlane=null,this.movement.length=0,this.trackingMovement=!1,c.on("update",this.update)}else this.x=this.orig.x,this.y=this.orig.y},m.trackMovement=function(a){c.display.stage;this.movement.unshift({x:this.x,y:this.y}),this.movement.length>10&&(this.movement.length=10)},m.update=function(a){var b=a/1e3*3.6;this.velocity.y>0&&(this.stopPlane=this.determineStopPlane()),this.stopPlane&&this.y>this.stopPlane&&(this.y=this.stopPlane,this.velocity.y>50&&(this.scale.x=Math.max(1+this.velocity.y/1e3,this.scale.x)),this.velocity.y>0&&this.velocity.y<100&&Math.abs(this.velocity.x)<20?(this.velocity.x=null,this.velocity.y=null,this.layerCheck()):(this.velocity.y*=-0.4,this.velocity.x*=.6)),null!==this.velocity.x&&(this.x+=this.velocity.x*b,this.velocity.x*=k),null!==this.velocity.y&&(this.y+=this.velocity.y*b,this.gravity*=j,this.gravity>i&&(this.gravity=i),this.velocity.y+=this.gravity*b),this.scale.x-=1*b,this.scale.x<1&&(this.scale.x=1),this.movement.unshift({x:this.x,y:this.y});var e=2;if(this.movement.length>e){var f=Math.abs(this.movement[e-2].y-this.movement[e-1].y);this.scale.y=1+f/100-(this.scale.x-1)}if(this.velocity.x||this.velocity.y||1!=this.scale.x||(this.scale.y=1,c.off("update",this.update)),!this.isWaitingForFetch){var g=c.manager.currentState,h=c.display.width/c.scaling.scale,l=(h-c.config.scalingSize.width)/2;this.x-d>h-l?(this.isWaitingForFetch=!0,this.visible=!1,g.playRetrieve(this,"fetchR")):this.x<d-l&&(this.isWaitingForFetch=!0,this.visible=!1,g.playRetrieve(this,"fetchL"))}},m.resize=function(){if(!this.isWaitingForFetch){var a=c.manager.currentState,b=c.display.width/c.scaling.scale,e=(b-c.config.scalingSize.width)/2;this.x-d>b-e?(this.isWaitingForFetch=!0,this.visible=!1,a.playRetrieve(this,"fetchR")):this.x<d-e&&(this.isWaitingForFetch=!0,this.visible=!1,a.playRetrieve(this,"fetchL"))}},m.throwableDestroy=function(){c.off("update",this.update),c.off("update",this.trackMovement),c.off("resize",this.resize),this.update=this.trackMovement=this.onDragStart=this.onDragEnd=this.reset=this.movement=null},namespace("nature").Throwable=g}(),function(){var a=include("springroll.Application"),b=include("springroll.pixi.Button"),c=include("springroll.ButtonSounds"),d=include("PIXI.Container"),e=include("springroll.pixi.DragManager"),f=include("createjs.Ease"),g=include("springroll.Positioner"),h=include("PIXI.Polygon"),i=include("PIXI.Sprite"),j=include("nature.Throwable"),k=include("createjs.Tween"),l=1300,m=f.sineInOut,n="toy_locked",o="fossil_locked",p={x:-150,y:0},q={x:1150,y:0},r=function(){d.call(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onFossilsShown=this.onFossilsShown.bind(this),this.onToysShown=this.onToysShown.bind(this)},s=extend(r,d);s.setup=function(){var f,k;this.app=a.instance,this.panningScaler=new d,this.addChild(this.panningScaler),this.panner=new d,this.panningScaler.addChild(this.panner),this.leftBG=new i(this.app.getCache("DoghouseBG_left")),g.init(this.leftBG,{x:-150}),this.panner.addChild(this.leftBG),this.rightBG=new i(this.app.getCache("DoghouseBG_right")),g.init(this.rightBG,{x:1045}),this.panner.addChild(this.rightBG);var l=this.app.getCache("DogHouseUI");this.dragManager=new e(this.onDragStart,this.onDragEnd),this.toys=[];var m,q=nature.DogHouseState.TOY_VIEW_X,r=this.app.config.toys,s=0;for(f in r){k=r[f];var t=this.app.isToyFound(f);m=t?k.asset:n;var u=pixiflash_images[m]?new j(pixiflash_images[m],k):u=new j(l.getFrame(m),k);if(u.sfx=k.sfx,this.toys.push(u),t?this.panner.addChild(u):(u.scale.x=.7,u.scale.y=.7,u.y-=15,this.panner.addChildAt(u,2)),u.locked=!t,t)this.dragManager.addObject(u,null);else{var v=k.lockedPosition;v&&(v.x&&(u.x=v.x+q),v.y&&(u.y=v.y))}this[f]=u}var w=[];this.fossils=[],this.singles=[];var x=this.app.config.fossils,y=l.getFrame(o);for(f in x){k=x[f].doghouseIcon,k.priority=["notFound","disabled","down","over","up"],k.notFound=y;var z=this.app.isAnyFossilPartFound(f),A=x[f].parts,B=this.app.saveData.fossilAssembly[f],C=B?B.complete:!1,D=nature["enum"].FossilStatus.Placed,E=!1;if(void 0===B&&z)E=!0;else for(s=0,len=A.length;s<len;s++)if(m=A[s].asset,this.app.isFossilFound(m)&&parseInt(B[m])!=D){E=!0;break}if("shell"==f||"fern"==f||"amber"==f){var F=z?f+"_complete":o,G=new i(l.getFrame(F));G.notFound=!z,this.singles.push(G),g.init(G,k),this.panner.addChild(G)}else{k.up=f+(C?"_complete":"_incomplete");var H=new b(k);if(H.notFound=!z,H.fossilComplete=C,H.newPartFound=E,H.fossil=f,this.fossils.push(H),this.panner.addChild(H),g.init(H,k),w.push(H),E){var I=new i(l.getFrame("newBone"));H.addChild(I);var J;J=I.texture,I.pivot.x=J.width/2,I.pivot.y=J.height/2,J=H.back.texture,I.x+=J.width/2,I.y+=J.height/2,this.newBoneIcon=I}this[f]=H}}this.hal=new pixiflash_lib.HalDoghouse,this.hal.framerate=30,this.panner.addChild(this.hal),this.hal.gotoAndStop(0),this.hal.x=p.x,this.hal.y=p.y,this.exitButton=new b({up:"exitButton_up",over:"exitButton_over",down:"exitButton_down"}),this.app.scaling.addItem(this.exitButton,{x:10,y:10}),this.addChild(this.exitButton),w.push(this.exitButton),this.rightButton=new b({up:"rightButton_up",over:"rightButton_over",down:"rightButton_down"}),this.app.scaling.addItem(this.rightButton,{x:780,y:25,align:"center-right"}),this.addChild(this.rightButton),w.push(this.rightButton),this.leftButton=new b({up:"leftButton_up",over:"leftButton_over",down:"leftButton_down"}),this.app.scaling.addItem(this.leftButton,{align:"center-left",x:10,y:25}),this.addChild(this.leftButton),w.push(this.leftButton);var K=[1050,372,1050,526,1e3,540,855,522,850,396,880,370];this.toyChestArea=new d,this.toyChestArea.hitArea=new h(K),this.panningScaler.addChild(this.toyChestArea),this.buttonSounds=new c("ButtonSelect","ButtonRollover",w)},s.onDragStart=function(a){a.onDragStart()},s.onDragEnd=function(a){a.onDragEnd()},s.moveToyBelowHal=function(a){var b=this.panner.getChildIndex(a),c=this.panner.getChildIndex(this.hal);b>c&&this.panner.setChildIndex(a,c)},s.panToFossils=function(){for(var a=this.fossils,b=0,c=a.length;c>b;++b)a[b].visible=!0;this.exitButton.visible=!1,this.leftButton.visible=!1,this.rightButton.visible=!1,k.get(this.panner).to({x:0},l,m).call(this.onFossilsShown)},s.onFossilsShown=function(){for(var a=this.toys,b=0,c=a.length;c>b;++b)a[b].visible=!1;this.toyChestArea.enable(!0),this.toyChestArea.visible=!0,this.exitButton.visible=!0,this.rightButton.visible=!0,this.hal.x=p.x,this.hal.y=p.y,this.emit("fossilsShown")},s.panToToys=function(a){this.toyChestArea.enable(!1),this.toyChestArea.visible=!1,this.exitButton.visible=!1,this.leftButton.visible=!1,this.rightButton.visible=!1;for(var b=this.toys,c=0,d=b.length;d>c;++c){var e=b[c];e.visible=!0,e.locked||e.enableDrag()}a=null!=a?a:l,k.get(this.panner).to({x:-nature.DogHouseState.TOY_VIEW_X},a,m).call(this.onToysShown)},s.onToysShown=function(){for(var a=0,b=this.fossils.length;b>a;++a)this.fossils[a].visible=!1;this.leftButton.visible=!0,this.hal.x=q.x,this.hal.y=q.y,this.emit("toysShown")},s.stop=function(){k.removeTweens(this.panner);for(var b=this.toys,c=a.instance,d=0,e=b.length;e>d;++d){var f=b[d];f.locked||(f.disableDrag(),c.off("update",f.update),c.off("update",f.trackMovement))}},s.teardown=function(){this.removeChildren(),this.panningScaler.destroy(),this.panner.destroy(),this.hal.destroy(),this.exitButton.destroy(),this.leftButton.destroy(),this.rightButton.destroy(),this.dragManager.destroy(),this.dragManager=null;for(var a=this.toys,b=0,c=a.length;c>b;++b){var d=a[b];d.throwableDestroy&&d.throwableDestroy(),d.destroy()}this.hal=null,this.exitButton=null,this.leftButton=null,this.rightButton=null,this.panningScaler=null,this.fossils=null,this.toys=null,this.panner=null,this.leftBG=null,this.rightBG=null},namespace("nature").DogHousePanel=r}(),function(){var a=include("springroll.Application"),b=include("PIXI.extras.BitmapText"),c=include("springroll.pixi.Button"),d=include("springroll.ButtonSounds"),e=include("PIXI.Container"),f=include("nature.DebugOptions"),g=include("PIXI.Point"),h=include("PIXI.Sprite"),i=include("PIXI.Texture"),j=function(){e.call(this)},k=extend(j,e);namespace("nature.enum").FossilStatus={Seen:1,Placed:2},k.setup=function(){this.app=a.instance,this.background=new h(this.app.getCache("FossilBackground")),this.addChild(this.background),this.fossilContainer=new e,this.addChild(this.fossilContainer);var j=this.app.states.fossil.fossil,k=this.app.config.fossils[j],l=this.app.getCache(k.sprite.id);this.app.saveData.fossilAssembly[j]||(this.app.saveData.fossilAssembly[j]={});var m=this.app.saveData.fossilAssembly[j],n=(k.outline.position,k.outline.flaPosition);this.outline=new h(l.getFrame(k.outline.asset)),this.fossilContainer.addChild(this.outline);var o=this.outline.texture,p=k.outline.pedestalOffset||new g(0,0);this.outline.position.x=(n.x||0)+450-o.width/2+(p.x||0),this.outline.position.y=(n.y||0)+350-o.height+(p.y||0),this.hasNewFossils=!1,this.parts=[];for(var q=this.outline.position.x,r=this.outline.position.y,s=0,t=k.parts.length;t>s;++s){var u=k.parts[s];if(this.app.isFossilFound(u.asset)||f.unlockAll){m[u.asset]||(m[u.asset]=nature["enum"].FossilStatus.Seen,this.hasNewFossils=!0),o=l.getFrame(u.asset);var v=new h;v.asset=u.asset,v.texture=new i(o,o.crop),v.correct=new g(u.correct.x+q-n.x,u.correct.y+r-n.y);var w=u.drawer;v.drawer=w,v.x=w.x,v.y=w.y,v.scale.x=v.scale.y=w.scale||1,w.rotation&&(w.rotation=w.rotation*(Math.PI/180),v.rotation=w.rotation),this.parts.push(v),this.fossilContainer.addChild(v),(m[u.asset]==nature["enum"].FossilStatus.Placed||f.allPlaced)&&(v.scale.x=v.scale.y=1,v.rotation=0,v.x=v.correct.x,v.y=v.correct.y)}}this.exitButton=new c(this.app.config.scaling.fossil.exitButton),this.exitButton.scale.x=.7,this.exitButton.scale.y=.7,this.buttonSounds=new d("ButtonSelect","ButtonRollover",this.exitButton),this.addChild(this.exitButton);var x=this.app.getCache("DogHouseUI");this.goldPlate=new h(x.getFrame("goldPlate")),this.addChild(this.goldPlate),this.plate=new b("",{font:"24px fossilPlateName",align:"center"}),this.plate.x=this.goldPlate.texture.width/2,this.plate.setPivotToAlign=!0,this.goldPlate.addChild(this.plate),this.plate.text=k.displayName,this.goldPlate.visible=!1},k.teardown=function(){this.removeChildren(),this.background.destroy(),this.exitButton.destroy(),this.fossilContainer.destroy(),this.background=null,this.exitButton=null,this.fossilContainer=null},namespace("nature").FossilPanel=j}(),function(){var a=include("springroll.Application"),b=include("springroll.pixi.Button"),c=include("springroll.ButtonSounds"),d=include("PIXI.Container"),e=include("nature.GameOverDialog"),f=include("nature.LevelIndicator"),g=include("nature.LevelUpDialog"),h=include("nature.PauseDialog"),i=include("nature.PowerupDialog"),j=include("nature.Powerups"),k=include("PIXI.Sprite"),l=include("nature.TileGrid"),m=include("nature.Timer"),n=function(){d.call(this),this.app=a.instance},o=extend(n,d);o.setup=function(){this.background=new k(this.app.getCache("gameBG")),this.addChild(this.background),this.tileGrid=new l,this.addChild(this.tileGrid),this.timer=new m,this.addChild(this.timer),this.powerups=new j,this.addChild(this.powerups),this.levelIndicator=new f,this.addChild(this.levelIndicator);var a=this.app.getCache("GameElements");this.tileTextures=[];var d=-1,n=nature.data.Tiles;for(var o in n){n[o].frame=++d;var p=a.getFrame(n[o].image);this.tileTextures.push(p)}this.pauseButton=new b({up:"pauseButton_up",over:"pauseButton_over",down:"pauseButton_down"}),this.addChild(this.pauseButton),this.buttonSounds=new c("ButtonSelect","ButtonRollover",[this.pauseButton]),this.pauseDialog=new h,this.addChild(this.pauseDialog),this.levelUpDialog=new g,this.addChild(this.levelUpDialog),this.gameOverDialog=new e,this.addChild(this.gameOverDialog),this.powerupDialog=new i,this.addChild(this.powerupDialog),this.halFossilFound=new pixiflash_lib.HalFossilFound,this.halFossilFound.framerate=30,this.addChild(this.halFossilFound),this.halFossilFound.stop(),this.halFossilFound.visible=!1,this.halResult=new pixiflash_lib.HalResultScreen,this.halResult.framerate=30,this.addChild(this.halResult),this.halResult.stop(),this.halResult.visible=!1},o.teardown=function(){this.removeChildren(),this.buttonSounds.destroy(),this.levelIndicator.destroy(),this.background.destroy(),this.timer.destroy(),this.tileGrid.destroy(),this.levelUpDialog.destroy(),this.pauseDialog.destroy(),this.powerupDialog.destroy(),this.gameOverDialog.destroy(),this.halFossilFound.destroy(),this.halResult.destroy(),this.pauseButton.destroy(),this.powerups.destroy(),this.background=this.gameOverDialog=this.halFossilFound=this.halResult=this.levelUpDialog=this.pauseDialog=this.tileGrid=this.tileTextures=this.timer=this.levelIndicator=this.pauseButton=this.powerupDialog=this.powerups=null},namespace("nature").GamePanel=n}(),function(){var a,b=include("springroll.Application"),c=include("springroll.pixi.Button"),d=include("springroll.ButtonSounds"),e=include("PIXI.Container"),f=include("PIXI.Sprite"),g=function(){e.call(this)},h=extend(g,e);h.setup=function(){a=b.instance,this.background=new f(a.getCache("selectBG")),this.addChild(this.background),this.hal=new pixiflash_lib.HalMainScreen,this.hal.framerate=30,this.addChild(this.hal),this.playButton=new c({up:"playButton_up",over:"playButton_over",down:"playButton_down"}),this.addChild(this.playButton),this.selectHouseButton=new c({priority:["highlighted","disabled","down","over","up"],up:"selectHouseButton_up",over:"selectHouseButton_over",down:"selectHouseButton_down",highlighted:"selectHouseButton_over"}),this.addChild(this.selectHouseButton),this.buttonSounds=new d("ButtonSelect","ButtonRollover",[this.playButton,this.selectHouseButton])},h.teardown=function(){this.removeChildren(),this.background.destroy(),this.hal.destroy(),this.playButton.destroy(),this.selectHouseButton.destroy(),this.background=null,this.hal=null,this.playButton=null,this.selectHouseButton=null},namespace("nature").SelectPanel=g}(),function(){var a=include("springroll.Application"),b=include("springroll.pixi.Button"),c=include("PIXI.Container"),d=include("springroll.ButtonSounds"),e=include("PIXI.Sprite"),f=function(){c.call(this)},g=extend(f,c);g.setup=function(){this.app=a.instance,this.background=new e(this.app.getCache("titleBG")),this.addChild(this.background),this.playButton=new b({up:"playButton_up",over:"playButton_over",down:"playButton_down"}),this.addChild(this.playButton),this.buttonSounds=new d("ButtonSelect","ButtonRollover",[this.playButton])},g.teardown=function(){this.removeChildren(),this.background.destroy(),this.playButton.destroy(),this.background=this.playButton=null},namespace("nature").TitlePanel=f}(),function(){var a,b=include("springroll.Application"),c=include("nature.Clickable"),d=include("nature.DogHousePanel"),e=include("springroll.State"),f=include("springroll.DelayedCall"),g={Fossils:1,Toys:2},h=15e3,i=.35,j=!0,k={anim:"haventFoundAnything",audio:{alias:"BigDig_Collection_HaventFoundAnything",start:266}},l={anim:"haventFoundThat",audio:{alias:"BigDig_Collection_HaventFoundThatYet",start:33}},m=function(c){e.call(this,new d,c),a=b.instance,this.goToFossilState=this.goToFossilState.bind(this),this.haventFoundThat=this.haventFoundThat.bind(this),this.onExitButton=this.onExitButton.bind(this),this.onFossil=this.onFossil.bind(this),this.onLoaded=this.onLoaded.bind(this),this.onNavButton=this.onNavButton.bind(this),this.onTimeout=this.onTimeout.bind(this),this.playHalIdle=this.playHalIdle.bind(this),this.panel.on("toysShown",this.onToysShown.bind(this)),this.panel.on("fossilsShown",this.onFossilsShown.bind(this)),this.on("loaded",this.onLoaded)};m.TOY_VIEW_X=1296;var n=e.prototype,o=extend(m,e);o.onLoaded=function(){a.music="BigDig_MenuLoop",this.panel.setup(),this.hasToyWelcomed=!1,this.panel.leftButton.visible=!1,this.panel.exitButton.on("buttonPress",this.onExitButton),this.panel.leftButton.on("buttonPress",this.onNavButton),this.panel.rightButton.on("buttonPress",this.onNavButton);var b=this.panel.toyChestArea;b.name="toyChestArea";var c=this.onNavButton;b.enable=function(a){void 0===a&&(a=!0),b.interactive=a,b.buttonMode=a,b.off("click",c),b.off("tap",c),a&&(b.on("click",c),b.on("tap",c))},this.panel.toyChestArea.enable(!0)},o.enterDone=function(){this.mode=g.Fossils;var b,d,e=this.panel,i=e.hal,j=e.fossils;for(b=0,d=j.length;d>b;++b)j[b].on("buttonPress",this.onFossil);var l=e.singles;for(b=0,d=l.length;d>b;++b){var m=l[b];mixin(m,c,this.onFossil),m.enable(m.notFound)}var n=[];a.saveData.visitedDoghouse||(n.push({anim:"welcome",audio:"BigDig_Collection_Welcome"}),a.saveData.visitedDoghouse=!0),a.saveData.fossilsFound.length>0?n.push({anim:"checkOutFossils",audio:{alias:"BigDig_Collection_CheckOutFossils",start:200}}):n.push(k),this.timeout=new f(this.onTimeout,h,{autoDestroy:!1}),this.timeout.stop(),a.animator.play(i,n,this.playHalIdle),mixin(e.rightButton.back,nature.PulseFlash),mixin(i,c,this.onTimeout);var o=e.toys;for(b=0,d=o.length;d>b;++b){var p=o[b];p.locked&&mixin(p,c,this.haventFoundThat)}},o.haventFoundThat=function(){var b=a.animator,c=this.panel.hal;"idle"==b.getTimeline(c).instance.currentName&&b.play(c,l,this.playHalIdle)},o.playHalIdle=function(){var b=this.panel.hal;a.animator.play(b,"idle"),b.enable(!0),this.timeout&&this.timeout.restart()},o.onTimeout=function(){this.timeout&&this.timeout.stop();var b=this.panel.hal;this.stopAllHal();var c;if(this.mode==g.Fossils){var d=1,e=2,f=[d];a.saveData.fossilsFound.length>0&&f.push(e),f=f.random(),f==e?(c=a.hasTouch?{anim:"tapFossils",audio:{alias:"BigDig_Collection_FossilTap",start:33}}:{anim:"clickFossils",audio:{alias:"BigDig_Collection_FossilsClick",start:100}},a.animator.play(b,c,this.playHalIdle)):(this.panel.rightButton.back.pulse(3),this.playHalIdle())}else this.mode==g.Toys&&(c=a.saveData.toysFound.length>0?a.hasTouch?{anim:"toyTap",audio:{alias:"BigDig_Collection_ToyTap",start:100}}:{anim:"toyClick",audio:{alias:"BigDig_Collection_ToyClick",start:66}}:k,a.animator.play(b,c,this.playHalIdle))},o.onExitButton=function(){this.manager.state="select"},o.stopAllHal=function(){var b=this.panel.hal;a.animator.stop(b),b.enable(!1),this.timeout&&this.timeout.stop()},o.onNavButton=function(a){if(this.mode=null,this.stopAllHal(),a==this.panel.leftButton){this.panel.panToFossils();for(var b=this.panel.toys,c=0,d=b.length;d>c;++c)b[c].isWaitingForFetch&&(b[c].visible=!1)}else(a==this.panel.rightButton||(a.target?a.target.name:"")===this.panel.toyChestArea.name)&&this.panel.panToToys()},o.onFossilsLeave=function(){this.isHalRetrieving=!1,this.panel.toyChestArea.enable(!1)},o.onFossilsShown=function(){this.isHalRetrieving=!1;for(var b=this.panel.toys,c=0,d=b.length;d>c;++c)b[c].reset();this.mode=g.Fossils,a.animator.play(this.panel.hal,"walkLeft",this.playHalIdle)},o.onToysShown=function(){this.toyFetchQueue=[];var b=this.panel,c=b.hal;this.mode=g.Toys,this.hasToyWelcomed||a.saveData.toysFound.length<1?a.animator.play(c,"walkR",this.playHalIdle):(this.hasToyWelcomed=!0,a.animator.play(c,["walkR",{anim:"lookAtAllTheToys",audio:{alias:"BigDig_Collection_ToyWelcome",start:66}}],this.playHalIdle));var d=a.config.toys;for(var e in d)b[e].enable(!0)},o.playToyResponse=function(){this.isHalRetrieving||(this.timeout&&this.timeout.stop(),Math.random()<i&&a.animator.play(this.panel.hal,[{anim:"loveMyToys",audio:{alias:"BigDig_Collection_LoveMyToys",start:133}},{anim:"laugh",audio:{alias:"BigDig_Collection_Hehe",start:133}}].random(),this.playHalIdle))},o.onFossil=function(b){return b.target&&(b=b.target),this.timeout&&this.timeout.stop(),b.notFound?void a.animator.play(this.panel.hal,l,this.playHalIdle):void(b.fossil&&(a.states.fossil.fossil=b.fossil,b.fossilComplete?a.animator.play(this.panel.hal,{anim:"youBuiltThat",audio:{alias:"BigDig_Collection_BuiltThat",start:166}},this.goToFossilState):b.newPartFound?a.animator.play(this.panel.hal,{anim:"newFossil",audio:{alias:"BigDig_Collection_NewFossil",start:66}},this.goToFossilState):this.goToFossilState()))},o.playRetrieve=function(b,c){if(this.timeout&&this.timeout.stop(),this.isHalRetrieving)return void(this.toyFetchQueue.indexOf(b)<0&&this.toyFetchQueue.push(b,c));this.stopAllHal(),this.isHalRetrieving=!0;var d=.25;j&&(j=!1,d=1),Math.random()<=d?a.animator.play(this.panel.hal,{anim:"getIt",audio:{alias:"BigDig_Collection_Fetch",start:100}},this.onGetItComplete.bind(this,b,c)):this.onGetItComplete(b,c)},o.onGetItComplete=function(b,c){var d=this.panel.hal;this.timeout&&this.timeout.stop();var e,f,g;d.gotoAndStop(c);var h=d.children[0],i=pixiflash_lib.Hal_3Q_HeadNest2,j=pixiflash_lib.Toy;for(var k in h.children)h.children[k]instanceof j&&(e=h.children[k]),h.children[k]instanceof i&&(f=h.children[k],g=f.toy);e.gotoAndStop(b.asset),g.gotoAndStop(b.asset),d.parent.addChild(d);for(var l=this.panel.toys,n=0,o=l.length;o>n;++n)l[n].layerCheck();a.animator.play(d,c,function(){var a=this.panel.panningScaler.toLocal({x:e.x,y:e.y},e.parent);b.x=a.x+m.TOY_VIEW_X,b.y=a.y+b.texture.height/2,b.isWaitingForFetch=!1,b.visible=!0,this.toyFetchQueue.length?this.onGetItComplete(this.toyFetchQueue.shift(),this.toyFetchQueue.shift()):(this.isHalRetrieving=!1,this.playHalIdle())}.bind(this))},o.goToFossilState=function(){this.manager.state="fossil"},o.exitStart=function(){this.stopAllHal(),this.panel.toyChestArea.enable(!1),this.timeout&&this.timeout.stop();for(var a=this.panel.fossils,b=0,c=a.length;c>b;++b)a[b].off("buttonPress",this.onFossil);this.panel.stop(),this.panel.exitButton.off("buttonPress",this.onExitButton),this.panel.leftButton.off("buttonPress",this.onNavButton),this.panel.rightButton.off("buttonPress",this.onNavButton)},o.exit=function(){n.exit.call(this),this.panel.teardown(),this.timeout&&this.timeout.destroy(),this.timeout=null},o.destroy=function(){n.destroy.call(this),this.onGameButton=null},namespace("nature").DogHouseState=m}(),function(){var a=include("springroll.Application"),b=include("nature.DebugOptions"),c=include("springroll.pixi.DragManager"),d=include("createjs.Ease"),e=include("nature.FossilPanel"),f=include("PIXI.Point"),g=include("springroll.State"),h=include("createjs.Tween"),i=include("springroll.DelayedCall"),j=1600,k=8e3,l=["Hal_FossilView_NewFossil","Hal_FossilView_LookAtThatFossil"],m=null,n=null,o={Placed:2},p=function(c){g.call(this,new e,c),n=a.instance,m=n.config,this.onDragStart=this.onDragStart.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onExitButton=this.onExitButton.bind(this),this.startTimeout=this.startTimeout.bind(this),this.onTimeout=this.onTimeout.bind(this),this.on("loading",this.onLoading.bind(this)),this.on("loaded",this.onLoaded.bind(this)),this.fossil=null,b.fossil&&(this.fossil=b.fossil),this.fossil||(this.fossil="iguanodon")},q=g.prototype,r=extend(p,g);r.onLoading=function(a){a.push(m.fossils[this.fossil].sprite)},r.onLoaded=function(){n.music="BigDig_MenuLoop",this.panel.setup(),this.dragManager=new c(this.onDragStart,this.onDragEnd);for(var a=this.panel.parts,b=n.saveData.fossilAssembly[this.fossil],d=0,e=0,g=a.length;g>e;++e){var h=a[e];b[a[e].asset]==o.Placed?d++:(this.dragManager.addObject(h,null,new f(h.texture.width/2,h.texture.height/2)),h.enableDrag())}this.panel.exitButton.on("buttonPress",this.onExitButton),b.complete&&(b.complete=!0,this.panel.outline.visible=!1,this.panel.goldPlate.visible=!0)},r.enterDone=function(){this.timeout=new i(this.onTimeout,k,{autoDestroy:!1}),this.panel.hasNewFossils?(n.dirtySave=!0,n.makeDelayedSave(),n.voPlayer.play(l.random(),this.startTimeout)):this.startTimeout()},r.startTimeout=function(){for(var a=n.saveData.fossilAssembly[this.fossil],b=0,c=this.panel.parts,d=c.length,e=0;d>e;++e)a[c[e].asset]==o.Placed&&b++;b!=d&&this.timeout.restart()},r.onTimeout=function(){n.voPlayer.play([l.random(),250,n.hasTouch?"Hal_FossilView_TapPiece":"Hal_FossilView_ClickPiece"],this.startTimeout)},r.onDragStart=function(a){n.sound.play("FossilPickUp"),this.timeout.stop(),h.removeTweens(a.position),h.removeTweens(a.scale),a.scale.x=a.scale.y=1,a.rotation=0},r.onDragEnd=function(a){if(n.sound.play("FossilPlacedDown"),Math.distSq(a.position,a.correct)<=j){a.disableDrag(),a.x=a.correct.x,a.y=a.correct.y;var b=n.saveData.fossilAssembly[this.fossil];b[a.asset]=o.Placed;for(var c=this.panel,e=c.parts,f=0,g=0,i=e.length;i>g;++g)b[e[g].asset]==o.Placed&&f++;f==m.fossils[this.fossil].parts.length&&(n.sound.play("DinoComplete"),b.complete=!0,h.get(c.outline).to({alpha:0},700),goldPlate=c.goldPlate,goldPlate.alpha=0,goldPlate.visible=!0,h.get(goldPlate).to({
alpha:1},700),n.voPlayer.play("Hal_FossilView_BuiltDino")),n.dirtySave=!0,n.makeDelayedSave()}else{var k=a.drawer,l=Math.distSq(a.position,k),p=1.1*Math.sqrt(l);h.get(a.position).to(k,p,d.sineOut),h.get(a.scale).wait(.1*p).to({x:k.scale,y:k.scale},.8*p,p>200?d.backIn:d.linear),k.rotation&&h.get(a).to({rotation:k.rotation},p,d.backOut)}this.startTimeout()},r.onExitButton=function(){this.manager.state="doghouse"},r.exitStart=function(){this.timeout.stop(),n.voPlayer.stop()},r.exit=function(){q.exit.call(this),this.panel.teardown(),this.timeout.destroy(),this.dragManager.destroy(),this.timeout=null,this.dragManager=null},r.destroy=function(){q.destroy.call(this),n=null,m=null},namespace("nature").FossilState=p}(),function(){var a,b,c,d,e,f,g,h,i,j,k=include("nature.DebugOptions"),l=include("createjs.Ease"),m=include("nature.powerups.HintCloud"),n=include("nature.GamePanel"),o=include("nature.powerups.Shockwave"),p=include("springroll.State"),q=include("nature.Tutorial"),r=include("createjs.Tween"),s=include("nature.powerups.Voles"),t=!0,u=0,v=function(c){p.call(this,new n,c),this.onQuitButton=this.onQuitButton.bind(this),this.onDoghouseButton=this.onDoghouseButton.bind(this),this.onRestartButton=this.onRestartButton.bind(this),this.onPauseButton=this.onPauseButton.bind(this),this.update=this.update.bind(this),this.startNextLevel=this.startNextLevel.bind(this),this.onTileCleared=this.onTileCleared.bind(this),this.onCountdownFinished=this.onCountdownFinished.bind(this),this.on("loading",this.onLoading.bind(this)),this.on("loaded",this.onLoaded.bind(this)),a=this.app,b=a.config.game,e=b.lockdownTutorialTime,f=b.mobileGridScaling},w=p.prototype,x=extend(v,p);x.onLoading=function(b){var c=a.config.fossils;for(var d in c)b.push(c[d].sprite);a.sound.preload(["BigDig_GameLoop","DigGrass","DigPebbles","DigRock","DigSoil"])},x.onLoaded=function(){a.music="BigDig_GameLoop",this.panel.setup(),i=new q(this),this.onRestartButton()},x.generateLevel=function(b){b||(b=a.config.levels.last());var c=a.getGrids(b);layout=c.random();var d=this.panel.tileGrid;d.makeGrid(b,layout),this.tilesLeft=0;for(var e=d.tilesById,g=e.length-1;g>=0;--g)e[g].hiddenByLayout||this.tilesLeft++;if(a.isTouch){nature.TileGrid.tilePixelSize;d.scale.x=f,d.scale.y=f}if(k.part){var h=k.part,i=a.allFindables[h];if(!i)return;return d.placeItem(i,"fossils",0,0),d.placeItem(i,"fossils",i.columns,1.5708),void d.placeItem(i,"fossils",i.columns+i.rows,4.71239)}d.placeCategory(b.fossils,"fossils"),d.placeCategory(b.powerups,"powerups"),d.placeCategory(b.toys,"toys")},x.findPowerup=function(b){var c=this.panel,d=c.tileGrid,e=b.asset||b;a.config.powerups[e];switch(d.foundItemContainer.addChild(b),b.name){case"shovel":case"search":case"drill":case"shockwave":a.sound.play("PowerUpFound"),r.get(b.scale).wait(100).to({x:1.6,y:1.6},200,l.backOut).wait(100).to({x:0,y:0},100,l.backIn).call(function(){b.visible=!1}),u=200}"time"!=b.name&&a.isNewPowerup(b.name)?(this.paused=!0,c.powerupDialog.show(b)):this.triggerPowerup(b)},x.triggerPowerup=function(b){var d=this.panel,e=d.tileGrid,f=a.config.powerups[b.name||b.asset||b];switch(f.uses>0&&d.powerups.add(f),b.asset){case"time":d.timer.addTime(f.time,b),u=250;break;case"vole":a.sound.play("Vole"),b.visible=!1,j||(j=new s),j.add(e,b),u=1e3;break;case"shockwave":a.sound.play("Shockwave"),r.get(b).to({rotation:b.rotation+2*Math.PI},800,l.quartOut),o(e,Math.floor(e.rows/2),Math.floor(e.columns/2)),u=1e3;break;case"search":var g=e.findables;c||(c=new m);for(var h=0,i=g.length;i>h;++h){var k=g[h];if("fossils"===k.category){c.show(k,e);break}}u=100}},x.onPowerupDialogClose=function(a){this.paused=!1,this.triggerPowerup(a)},x.enterDone=function(){var c=this.panel;if(k.gameover)c.timer.timeUp();else if(k.levelup)this.findFossil(c.tileGrid.fossil);else if(k.pause)this.pauseDialog.visible=!0;else{if(h=b.timeout,0===d){this.paused=!0;var f=this.panel.countdown=new pixiflash_lib.Countdown;f.framerate=30,this.panel.addChild(f),this.app.scaling.addItem(f,{x:-150,y:0,align:"top-left",titleSafe:!0}),this.app.animator.play(f,{anim:"countdown",audio:"Hal_Countdown"},this.onCountdownFinished)}g=!1,c.pauseButton.once("buttonPress",this.onPauseButton),a.on("update",this.update),k.lockdown&&(c.timer.time=e+1e3),c.timer.paused=!0}},x.onCountdownFinished=function(){this.paused=!1;var b=this.panel.countdown;this.panel.removeChild(b),this.app.scaling.removeItem(b),this.panel.countdown=null,b.destroy(),i.lockdownEnabled=!0,i.enabled&&!k.lockdown?(i.firstLevelInstructions(this.onFirstLevelTutorialComplete.bind(this)),h+=1e4):k.lockdown||a.voPlayer.play("Hal_Game_Round1")},x.onFirstLevelTutorialComplete=function(){this.paused=!1},x.onPauseButton=function(a){this.paused=!0,this.panel.pauseDialog.show(!0)},Object.defineProperty(x,"paused",{set:function(b){var c=this.panel;b?(a.voPlayer.stop(),i&&i.stop(),a.off("update",this.update)):a.on("update",this.update),c.timer.paused=b,c.pauseButton.visible=!b;for(var d=c.tileGrid.tilesById,e=0,f=d.length;f>e;++e)d[e].enable(!b)}}),x.update=function(c){var f=this.panel,j=f.tileGrid;if(h>0&&j.enabled&&(h-=c,0>=h&&(h=b.timeout,Math.random()<b.timeoutVOChance))){var k=["Hal_Game_Keep%UI%","Hal_Game_Go","Hal_Game_Dig","Hal_Game_PickNewSpot"].random();a.voPlayer.play(a.filters.filter(k))}var l=f.timer.time;if(l>0&&1e4>=l&&!a.voPlayer.playing&&!g&&(g=!0,a.voPlayer.play(["Hal_Game_UhOhTimeRunning","Hal_Game_Quick","Hal_Game_Hurry"].random())),0===d&&i.lockdownEnabled&&e>l&&(i.lockdownEnabled=!1,this.paused=!0,i.lockdownInstructions()),(u>0||j.foundItemQueue.length)&&(u-=c,0>=u&&j.foundItemQueue.length)){u=0;var m=this.panel.tileGrid.foundItemQueue.shift();switch(m.category){case"fossils":this.findFossil(m);break;case"powerups":this.findPowerup(m);break;case"toys":this.findToy(m)}}},x.onTileClicked=function(){h=b.timeout,i.clickToCompleteLockdown&&(this.paused=!1)},x.onTileCleared=function(d,e){var f=d.item;if(d.isHinting&&(d.isHinting=!1,c.updateHint(d),d.highlight.update()),--this.tilesLeft<=0)return void this.findFossil(this.panel.tileGrid.fossil);if(!e){var g=a.voPlayer;!f&&!g.playing&&Math.random()<b.bottomVOChance&&g.play(["Hal_Game_NothingThere","Hal_Game_Nothing","Hal_Game_ThatsOkKeepGoing","Hal_Game_KeepDigging","Hal_Game_BottomNewSpot","Hal_Game_Zero","Hal_Game_Zilch","Hal_Game_Zip"].random())}},x.findToy=function(c){this.panel.tileGrid.foundItemContainer.addChild(c),r.get(c.scale).wait(100).to({x:1.5,y:1.5},150,l.backIn).wait(500).to({x:0,y:0},150,l.cubicIn),a.unlockToy(c.asset),a.Unlocks.toys.push(c),Math.random()<b.toyVOChance&&a.voPlayer.play(["Hal_Game_FoundToy","Hal_Game_FoundToy2"].random()),a.sound.play("ToyFound"),u=300},x.findFirstFossil=function(){var c=b.firstFossilVOChance;t&&(t=!1,c=1),Math.random()<c&&a.voPlayer.play([["Hal_Game_PartFossil","Hal_Game_DigAroundIt"],["Hal_Game_PartFossil","Hal_Game_DigOtherUncover"]].random())},x.findFossil=function(b){i&&i.stop(),a.sound.play("FossilFound"),c&&c.reset();var d=a.unlockFossil(b.asset);d&&(a.Unlocks.newUnlock=!0),a.Unlocks.fossils.push(b),this.paused=!0;var e=b.texture;e.width/2,e.height/2;r.get(b.scale).wait(500).to({x:0,y:0},250,l.backIn).wait(300).call(function(){this.stopAllHal(),a.sound.play("alert-114"),this.panel.levelUpDialog.show(!0,b)}.bind(this))},x.stopAllHal=function(){var b=a.animator,c=this.panel;b.stop(c.halResult),b.stop(c.halFossilFound),a.voPlayer.stop()},x.onRestartButton=function(){var b=this.panel;d=k.level?k.level-2:-1,this.sharedReset(),b.timer.reset(),a.Unlocks.reset(),b.gameOverDialog.show(!1),this.onResumeButton()},x.startNextLevel=function(){this.sharedReset();var a=this.panel;a.timer.addTime(b.timeBonusPerLevel),a.levelUpDialog.show(!1),this.paused=!1},x.sharedReset=function(){var e=this.panel;e.halFossilFound.visible=!1,e.halResult.visible=!1,g=!1,this.nextLevelTimer=null,this.stopAllHal(),h=b.timeout,u=500,e.powerups.reset(),c&&c.reset(),j&&j.reset(),d++,e.levelIndicator.set(d),this.generateLevel(a.config.levels[d]),1===d&&i.enabled?a.voPlayer.play("BigDig_Tutorial_Grass"):2===d&&i.enabled?a.voPlayer.play("BigDig_Tutorial_Rocks"):d>2&&Math.random()<.5&&a.voPlayer.play("Hal_Game_NextRound")},x.gameOver=function(){this.paused=!0;var b=this.panel;b.timer.time=0,b.gameOverDialog.show(!0,d);var c=a.Unlocks,e=c.toys.length+c.fossils.length;if(e>0){var f=b.halResult;b.addChild(f),f.visible=!0;for(var g=[{minItems:11,anim:"treasureFinder",audio:{alias:"BigDig_Result_BestTreasureFinder",start:633}},{minItems:6,anim:"fineDigging",audio:{alias:"BigDig_Result_MightyFine",start:233}},{minItems:1,anim:"wow",audio:{alias:"BigDig_Result_Wow",start:0}}],h=0,i=g.length;i>h;++h)if(g[h].minItems<=e){this.stopAllHal(),a.animator.play(f,g[h]);break}}},x.onQuitButton=function(){this.manager.state="select"},x.onDoghouseButton=function(){this.manager.state="doghouse"},x.onResumeButton=function(){var a=this.panel;a.pauseDialog.show(!1),a.pauseButton.visible=!0,a.pauseButton.once("buttonPress",this.onPauseButton),this.paused=!1},x.exitStart=function(){this.stopAllHal(),d>a.sessionHighScore&&(a.sessionHighScore=d),a.off("update",this.update),this.nextLevelTimer&&(this.nextLevelTimer.destroy(),this.nextLevelTimer=null)},x.exit=function(){this.panel.teardown();var b=a.config.fossils;for(var c in b)a.unload(b[c].sprite.id);j&&(j.destroy(),j=null),w.exit.call(this)},x.destroy=function(){w.destroy.call(this),this.onQuitButton=null,this.onDoghouseButton=null,this.onRestartButton=null,this.update=null,this.startNextLevel=null,this.onPauseButton=null,this.nextLevelTimer=null,i=null},namespace("nature").GameState=v}(),function(){var a,b,c,d=include("nature.Clickable"),e=include("nature.SelectPanel"),f=include("springroll.State"),g=15e3,h=function(c){f.call(this,new e,c),a=this.app,this.highlightDoghouse=this.highlightDoghouse.bind(this),this.onDig=this.onDig.bind(this),this.onDoghouse=this.onDoghouse.bind(this),this.onLoaded=this.onLoaded.bind(this),this.onTimeout=this.onTimeout.bind(this),this.startTimeout=this.startTimeout.bind(this),this.unhighlightDoghouse=this.unhighlightDoghouse.bind(this),this.update=this.update.bind(this),b=a.saveData.highestLevel<1,this.on("loading",this.onLoading),this.on("loaded",this.onLoaded)},i=f.prototype,j=extend(h,f);j.onLoading=function(a){c=b?{anim:"intro",audio:"BigDig_Main_Intro"}:[{anim:"welcomeBack",audio:{alias:"BigDig_Main_WelcomeBack",start:133}},{anim:"foundCoolThings",audio:{alias:"BigDig_Main_FoundCoolThings",start:233}},{anim:"checkOutStuff",audio:{alias:"BigDig_Main_CheckOutStuff",start:66}}].random(),a.push({id:"audioPreload",sounds:[c.audio.alias||c.audio]})},j.onLoaded=function(){a.music="BigDig_MenuLoop";var b=this.panel;b.setup(),b.hal.gotoAndStop(c.anim)},j.enterDone=function(){var b=this.panel.hal;mixin(b,d,this.onTimeout),this.enable(!0),c&&a.animator.play(b,c,this.startTimeout)},j.startTimeout=function(){var b=this.panel.hal;this.unhighlightDoghouse(),this.timeoutTimer=g,a.on("update",this.update),a.animator.play(b,"idle"),b.enable(!0)},j.update=function(a){this.timeoutTimer>0&&(this.timeoutTimer-=a,this.timeoutTimer<=0&&this.onTimeout())},j.onTimeout=function(){var b=this.panel.hal;b.enable(!1),this.timeoutTimer=-1;"intro"==c?c=a.hasTouch?{anim:"startDiggingClick",audio:{alias:"BigDig_Main_StartDiggingClick",start:66}}:{anim:"startDiggingTap",audio:{alias:"BIgDig_Main_StartDiggingTap",start:66}}:(c=a.hasTouch?{anim:"collectionTap",audio:{alias:"BigDig_Main_CollectionTap",start:0}}:{anim:"collectionClick",audio:{alias:"BigDig_Main_CollectionClick",start:33}},this.highlightDoghouse()),a.animator.play(b,c,this.startTimeout,this.unhighlightDoghouse)},j.onDig=function(){var b=this.panel;b.playButton.enabled=!1,b.selectHouseButton.enabled=!1,b.hal.enable(!1),this.enable(!1),a.off("update",this.update);var c=[{anim:"letsGo",audio:{alias:"BigDig_Main_LetsGo",start:166}},{anim:"timeToGoDigging",audio:{alias:"BigDig_Main_TimeToGoDigging",start:0}},{anim:"wonderWhatWellFind",audio:{alias:"BIgDig_Main_WonderWhatWellFind",start:0}}];a.animator.play(b.hal,c.random(),function(a){this.manager.state="game"}.bind(this))},j.enable=function(a){var b=this.panel,c=b.playButton,d=b.selectHouseButton;c.off("buttonPress",this.onDig),d.off("buttonPress",this.onDoghouse),a&&(c.on("buttonPress",this.onDig),d.on("buttonPress",this.onDoghouse))},j.highlightDoghouse=function(){this.panel.selectHouseButton.highlighted=!0},j.unhighlightDoghouse=function(){this.panel.selectHouseButton.highlighted=!1},j.onDoghouse=function(){this.panel.hal.enable(!1),this.manager.state="doghouse"},j.exitStart=function(){this.enable(!1),b=!1,a.animator.stop(this.panel.hal),a.off("update",this.update)},j.exit=function(){i.exit.call(this),this.panel.teardown()},j.destroy=function(){i.destroy.call(this),this.highlightDoghouse=null,this.onDig=null,this.onDoghouse=null,this.onLoaded=null,this.onLoaded=null,this.startTimeout=null,this.timeoutTimer=null,this.unhighlightDoghouse=null,this.update=null,a=null,c=null,b=null},namespace("nature").SelectState=h}(),function(){var a=include("springroll.State"),b=include("nature.TitlePanel"),c=function(c){a.call(this,new b,c),this.onGameButton=this.onGameButton.bind(this),this.onLoaded=this.onLoaded.bind(this),this.on("loaded",this.onLoaded)},d=a.prototype,e=extend(c,a);e.onLoaded=function(){this.app.music="BigDig_MenuLoop",this.panel.setup()},e.enterDone=function(){var a=this.panel.background;a.interactive=!0,a.on("touchstart",this.onGameButton),a.on("mousedown",this.onGameButton),this.panel.playButton.on("buttonPress",this.onGameButton)},e.onGameButton=function(){this.manager.state="select"},e.exitStart=function(){var a=this.panel.background;a.off("touchstart",this.onGameButton),a.off("mousedown",this.onGameButton),this.panel.playButton.off("buttonPress",this.onGameButton)},e.exit=function(){d.exit.call(this),this.panel.teardown()},e.destroy=function(){d.destroy.call(this),this.onGameButton=null},namespace("nature").TitleState=c}(),function(){var a=include("nature.DebugOptions"),b=include("springroll.pixi.PixiDisplay"),d=include("nature.EnsureGridIsRectangular"),e=include("PIXI.utils");e.useFilenamesForTextures=!0;var f=new springroll.Application({fps:30,name:"Hal's Big Dig",useQueryString:!1,autoPause:window.top==window,configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",canvasId:"stage",display:b,displayOptions:{clearView:!0,antiAlias:!0},transitionSounds:{out:"Transition_Start","in":"Transition_End"}}),g="hbd-save";f.once("configLoaded",function(b,e){a.init();var f,g,h={};for(g in b.powerups)h[g]=b.powerups[g];for(g in b.toys)h[g]=b.toys[g];var i=b.fossils;for(var j in i){var k=i[j],l=k.parts;for(f=0,len=l.length;f<len;++f){var m=l[f];m.sprite=k.sprite.id,h[m.asset]=m}}for(g in h){var n=h[g],o=0,p=d(n.grid),q=n.rows=p.rows,s=n.columns=p.columns,t=new Array(q);for(r=0;r<q;++r)for(t[r]=new Array(s),c=0;c<s;++c)t[r][c]=!!n.grid[r][c],t[r][c]&&o++;n.piecesTotal=o,n.grid=t}if(this.allFindables=h,b.assets.init.forEach(function(a){e.push(a)}),a.testGrids)for(f in b.fossils)e.push(b.fossils[f].sprite)}),f.once("loading",function(a){a.push({id:"gameSave",cache:!1,async:function(a){f.userData.read(g,function(b){f.saveData=b,a()})}})}),f.getGrids=function(a){if(a.grid)return[a.grid];for(var b=1,c=[];a["grid"+b];)c.push(a["grid"+b]),++b;return c},f.makeDelayedSave=function(){f.dirtySave&&(f.dirtySave=!1,f.userData.write(g,f.saveData))},f.on("init",function(){this.display.autoPreventDefault=this.hasTouch,this.saveData||(this.saveData={fossilsFound:[],toysFound:[],fossilAssembly:{},highestLevel:0,visitedDoghouse:!1});this.transition=new pixiflash_lib.Transition,this.transition.framerate=30;var b=this.config.assets,c=this.config.scaling;return this.states={title:new nature.TitleState({preload:b.title,scaling:c.title}),select:new nature.SelectState({preload:b.select,scaling:c.select,delayLoad:4}),game:new nature.GameState({preload:b.game,scaling:c.game}),doghouse:new nature.DogHouseState({preload:b.doghouse,scaling:c.doghouse,delayLoad:4}),fossil:new nature.FossilState({preload:b.fossil,scaling:c.fossil})},a.testGrids?void this.config.levels.forEach(nature.TestLevel):(this.options.state||(this.manager.state="title"),a.muteMusic&&this.sound.setContextVolume("music",0),void(this.sessionHighScore=0))}),f.unlockToy=function(a){-1==this.saveData.toysFound.indexOf(a)&&(this.saveData.toysFound.push(a),this.dirtySave=!0,setTimeout(this.makeDelayedSave,3))},f.unlockFossil=function(a){return-1==this.saveData.fossilsFound.indexOf(a)?(this.saveData.fossilsFound.push(a),this.dirtySave=!0,setTimeout(this.makeDelayedSave,3),!0):!1},f.isToyFound=function(a){return this.saveData.toysFound.indexOf(a)>=0},f.isFossilFound=function(a){return this.saveData.fossilsFound.indexOf(a)>=0},f.isNewPowerup=function(a){return this.saveData.powerups||(this.saveData.powerups=[]),-1==this.saveData.powerups.indexOf(a)?(this.saveData.powerups.push(a),this.dirtySave=!0,setTimeout(this.makeDelayedSave,3),!0):!1},f.isAnyFossilPartFound=function(a){for(var b=this.config.fossils[a].parts,c=this.saveData.fossilsFound,d=0,e=b.length;e>d;++d)if(c.indexOf(b[d].asset)>=0)return!0;return!1},f.Unlocks={toys:[],sfossils:[],newUnlock:!1,reset:function(){f.Unlocks.toys=[],f.Unlocks.fossils=[],f.Unlocks.newUnlock=!1}}}();