window.Box2D=window.Box2D(),function(){"use strict";var t=include("Box2D.b2Color"),e=include("Box2D.b2Transform"),i=include("Box2D.b2Vec2"),n=include("Box2D.JSDraw"),s=include("Box2D.destroy"),r=include("Box2D.wrapPointer"),o={},a=1,h=[],l=function(e,i){var n=r(i,t),s=(255*n.get_r()|0)+","+(255*n.get_g()|0)+","+(255*n.get_b()|0);e.fillStyle="rgba("+s+",0.25)",e.strokeStyle="rgb("+s+")",e.lineWidth=.04},c=function(t,e,n,s){var o=0,a=null;for(t.beginPath(),o=0;o<n;o++)a=r(e+8*o,i),0===o?t.moveTo(a.get_x(),a.get_y()):t.lineTo(a.get_x(),a.get_y());t.closePath(),s&&t.fill(),t.stroke()},p=function(t,e,n,o,a){var h=r(e,i),l=r(o,i),c=null,p=null;t.beginPath(),t.arc(h.get_x(),h.get_y(),n,0,2*Math.PI,!1),a&&t.fill(),t.stroke(),a&&(p=new i(h.get_x(),h.get_y()),c=new i(n*l.get_x(),n*l.get_y()),p.op_add(c),t.beginPath(),t.moveTo(h.get_x(),h.get_y()),t.lineTo(p.get_x(),p.get_y()),t.stroke(),s(p),s(c))};o[0]=null,window.Box2D.helpers={getCanvasDebugDraw:function(t){var o=new n;return o.DrawSegment=function(e,n,s){l(t,s),function(t,e,n){var s=r(e,i),o=r(n,i);t.beginPath(),t.moveTo(s.get_x(),s.get_y()),t.lineTo(o.get_x(),o.get_y()),t.stroke()}(t,e,n)},o.DrawPolygon=function(e,i,n){l(t,n),c(t,e,i,!1)},o.DrawSolidPolygon=function(e,i,n){l(t,n),c(t,e,i,!0)},o.DrawCircle=function(e,n,r){var o=new i(0,0);l(t,r),p(t,e,n,o,!1),s(o)},o.DrawSolidCircle=function(e,i,n,s){l(t,s),p(t,e,i,n,!0)},o.DrawTransform=function(i){!function(t,i){var n,s=r(i,e),o=s.get_p(),a=s.get_q();t.save(),t.translate(o.get_x(),o.get_y()),t.scale(.5,.5),t.rotate(a.GetAngle()),t.lineWidth*=2,(n=t).strokeStyle="rgb(192,0,0)",n.beginPath(),n.moveTo(0,0),n.lineTo(1,0),n.stroke(),n.strokeStyle="rgb(0,192,0)",n.beginPath(),n.moveTo(0,0),n.lineTo(0,1),n.stroke(),t.restore()}(t,i)},o},getUserData:function(t){return o[t.GetUserData()]},setUserData:function(t,e){var i=t.GetUserData();i||(h.length?i=h.pop():(i=a,a+=1),t.SetUserData(i)),o[i]=e},clearUserData:function(t){var e=t.GetUserData();e&&(o.hasOwnProperty(e)&&h.indexOf(e)<0?(h.push(e),o[e]=null):platypus.debug.warn("Box2D `userData` Helper: Tried to clear userData with an invalid ID."))}}}(),platypus.Badger=function(){"use strict";var t=[],e=function(e,i,n,s){var r=null,o=0,a="",h=0,l="",c={},p=null,u={},d=null;for(a in this.badgesAwarded=[],this.keys=c,this.userData=n,this.badges=u,this.loading=!0,this.gameId=i,e)if(e.hasOwnProperty(a))for(r=e[a].badges,u[a]=[],h=r.length;h--;){for(l in d=r[h],u[a][d.id]=p={},d)d.hasOwnProperty(l)&&(p[l]=d[l]);if(p.subgoals)for(o=p.subgoals.length;o--;)c[p.subgoals[o].key]||(c[p.subgoals[o].key]=[]),c[p.subgoals[o].key].push(p)}n.readGameData("SpaceScouts","BadgeProgress",function(e){var i="",n=e||{},r=t.length;for(i in this.progress=n,n.badges||(n.badges={}),n)n.hasOwnProperty(i)&&"badges"!==i&&this.setProgress(i,n[i]);for(this.loading=!1;r--;)t[r]();t=null,s&&s(this.badges,this.getBadgeStatusForLAP())}.bind(this))},i=e.prototype;return i.increment=function(e){this.loading?t.push(this.increment.bind(this,e)):this.setProgress(e,(this.progress[e]||0)+1)},i.setProgress=function(t,e){var i=this.keys[t],n=!1,s=0,r=0,o=!this.loading,a=0,h=this.progress,l=null;if(i){for(s=i.length,o&&platypus.debug.orange&&platypus.debug.orange('Badger: "'+t+'" badge subgoal incremented for '+s+" badge"+(s>1?"s":"")+".");s--;){for(r=(l=i[s].subgoals).length,n=!0;r--;)l[r].key===t&&(a=l[r].progress||0,l[r].progress=Math.min(e,+l[r].count),l[r].progress===+l[r].count&&(l[r].completed=!0),o&&a!==l[r].progress&&(platypus.game.currentScene?platypus.game.currentScene.triggerOnChildren("badge-incremented",{badge:i[s],subgoal:t,originalProgress:a,progress:l[r].progress,count:+l[r].count}):platypus.debug.warn("Badger: just tried to show a badge notification, but there is no current scene."))),l[r].completed||(n=!1);!n||i[s].completed||this.gameId&&this.gameId!==i[s]["game-id"]||(i[s].completed=!0,h.badges[i[s].name]||this.badgesAwarded.push(i[s]))}this.loading||(h[t]=e,this.userData.writeGameData("SpaceScouts","BadgeProgress",h))}else platypus.debug.warn('Badger: There are no badges that have a "'+t+'" subgoal. Progress for this key will not be saved.')},i.award=function(){var t=this.badgesAwarded,e=t.length,i=this.progress,n=null;if(e){for(n=t.greenSlice(),t.length=0;e--;)this.increment("earned-badge"),i.badges[n[e].name]=!0;return this.userData.writeGameData("SpaceScouts","BadgeProgress",i),n}return null},i.getBadges=function(t){return t?this.badges[t]:this.badges},i.getBadgeStatusForLAP=function(t){var e=[],i=this.badges,n=null,s=null,r="",o=0,a=null,h=null,l=0,c=0,p=0;for(r in i)if(i.hasOwnProperty(r))for(c=(n=i[r]).length;c--;)if(p=(h=(s=n[c]).subgoals).length,l=0,o=0,a={},t){if(t===s.name){for(;p--;)a[h[p].key]=h[p].completed||!1;return{name:s.name,unlocked:s.completed||!1,steps:a}}}else{for(;p--;)a[h[p].key]=h[p].completed||!1,l+=+h[p].count,o+=h[p].progress||0;e.push({name:s.name,unlocked:s.completed||!1,progress:o/l,steps:a})}return e},e}(),platypus.DragGroup=function(){"use strict";var t=include("platypus.Data"),e=include("platypus.Vector"),i=function(t,e){return t*t+e*e},n=function(t,e){for(var i=e.length,n=0,s=0,r=t.getPinnedEntities(),o=null;i--;)for(o=e[i].getPinnedEntities(),n=r.length;n--;)for(s=o.length;s--;)if(r[n]===o[s]&&!r[n].multiSnap)return!1;return!0},s=function(t,e){return t.distance-e.distance},r=function(e){this.trashable=!0,this.effected=Array.setUp(),this.immobile=!1,this.valid=!1,this.lastValidPosition=null,this.justUnsnapped=!1,this.validSnaps=Array.setUp(),this.entities=Array.setUp(),this.offsets=Array.setUp(),this.saOrigin=t.setUp("x",e.x,"y",e.y),this.lastPosition=null,this.state=0,this.snap=null,this.snappingEnabled=!1,this.readyToEnd=null,this.collisionComplete=!1,this.originalEntityCount=0,this.allowPops=!0},o=r.prototype;return o.addEntity=function(t){t.inDragGroup&&t.inDragGroup!==this&&platypus.debug.warn("Attempting to add an entity to a new drag group that is already in a drag group."),this.entities.indexOf(t)<0&&(this.entities.push(t),this.offsets.push(e.setUp(t.x-this.saOrigin.x,t.y-this.saOrigin.y)),t.inDragGroup=this)},o.checkValidity=function(){var t,e,i=this.entities,n=null,s=this.effected,r=i.length,o=0;for(i[0].parent.world.Step(0,1,1);r--;){if((!(n=i[r]).inBuildingArea||n.overlaps&&!this.lastValidPosition||n.inTrash&&(t=n.inTrash,e=n.body.GetPosition(),t[0].TestPoint(e)))&&this.trashable){o=2;break}n.overlaps&&(o=1)}if(0===o&&s.length>i.length)for(r=s.length;r--;)if(s[r].overlaps){o=1;break}this.state=o,this.lastPosition&&(0!==o||this.justUnsnapped?this.lastPosition.recycle():this.lastValidPosition=this.lastPosition,this.lastPosition=null),this.justUnsnapped=!1},o.startMovement=function(t){var i=this.entities,n=null,s=i.length;for(this.originalEntityCount=s;s--;)(n=i[s]).startMovement(n);this.state=0,this.immobile=!1,this.snappingEnabled=!0,this.lastPosition=e.setUp(t.x,t.y),this.trashable||(this.lastValidPosition=e.setUp(t.x,t.y))},o.selectAll=function(){var t=this.entities,i=null,n=t.length,s=this.originalEntityCount,r=0;if(n!==s){for(s=this.originalEntityCount;s<n;s++)(i=t[s]).startMovement(i),"pin"!==i.type&&r++;r>1&&(this.allowPops=!1),this.trashable||this.lastValidPosition||(this.lastValidPosition=e.setUp(this.lastPosition.x,this.lastPosition.y))}},o.validateMotion=function(s,r){for(var o,a=this.entities,h=a.length,l=3+h,c=null,p=this.offsets,u=null,d=t.setUp("adjusted",null,"valid",!0,"movable",!0,"entity",null,"position",e.setUp(),"forSnap",!!s.pinTo),g=null,y=d.position;l--;){for(h=a.length;h--;){if(c=p[h],y.x=s.x+c.x,y.y=s.y+c.y,d.entity=a[h],d.valid=!0,d.adjusted=null,a[h].validateMotion(d,3),!d.valid){d.movable||(this.immobile=!0);break}if(d.adjusted){if(s.pinTo){d.valid=!1;break}s.x=d.adjusted.x-c.x,s.y=d.adjusted.y-c.y;break}}if(!d.valid||!d.adjusted)break}if(o=d.valid&&!d.adjusted,d.recycle(),o&&s.pinTo){for((g=Array.setUp()).push(s.pinTo),h=0;h<r.length;h++)if((u=r[h]).pinFrom&&u!==s&&.9>i(s.x-u.x,s.y-u.y)){if(!n(u.pinTo,g))return g.recycle(),!1;g.push(u.pinTo)}return g.recycle(),!0}return o},o.continueMovement=function(t,i){for(var n=this.entities,s=n.length,r=null,o=this.offsets,a=e.setUp();s--;)r=o[s],a.x=t.x+r.x,a.y=t.y+r.y,n[s].continueMovement(a);for(s=n.length;s--;)n[s].triggerEvent("resolve-bodies");for(s=n.length;s--;)n[s].triggerEvent("resolve-joints");if(i&&i.length)for(s=n.length;s--;)n[s].triggerEvent("resolve-snaps",i);this.lastPosition=e.setUp(t.x,t.y),a.recycle()},o.endMovement=function(t){for(var i=this.entities,n=i.length,s=null,r=this.offsets,o=e.setUp(),a=this.validSnaps,h=a.length;n--;)i[n].destroyed||(s=r[n],o.x=t.x+s.x,o.y=t.y+s.y,i[n].endMovement(o,this.state,this.immobile)),i[n].inDragGroup=null;if(0===this.state){for(;h--;)a[h].panel?(a[h].pinFrom.state.set("panelled",!0),a[h].pinFrom.state.set("almost-pinned",!1),a[h].pinFrom.panelled=a[h].pinTo,a[h].pinFrom.tint=null):a[h].pinFrom.triggerEvent("snap-to-pin",a[h].pinTo),a[h].recycle();for(n=i.length;n--;)if("pin"===i[n].type){i[n].triggerEvent("update-group-id");break}a.length=0}else{for(;h--;)a[h].pinFrom.destroyed||(a[h].pinFrom.tint=null),a[h].recycle();a.length=0}o.recycle()},o.getSnap=function(e,n,s){var r=platypus.game.app.config.pins.snapDistance,o=r*r,a=0,h=null,l=null,c=null,p=s.length;if(e.destroyed)return null;for(;p--;)e!==(c=s[p])&&(a=i(c.x-n.x,c.y-n.y))<o&&(l=t.setUp("pinFrom",e,"pinTo",c,"snappable",!0),e.canSnapTo(l,0)&&(o=a,h=c),l.recycle());return h?t.setUp("distance",o,"pinTo",h,"pinFrom",e):null},o.getSnaps=function(t,n,r,o){var a=null,h=this.entities,l=h.length,c=null,p=this.offsets,u=this.saOrigin,d=null,g=null;if(this.snappingEnabled){for(g=e.setUp();l--;)"pin"===(a=h[l]).type&&(c=p[l],g.x=n.x+c.x,g.y=n.y+c.y,(d=this.getSnap(a,g,r))&&(d.x=d.pinTo.x-c.x,d.y=d.pinTo.y-c.y,t.push(d)));t.length>1&&t.sort(s),g.recycle()}return o&&i(n.x-u.x,n.y-u.y)<25?t.push(e.setUp(u.x,u.y)):t.push(e.setUp(n.x,n.y)),t},o.getPanelSnaps=function(e,i){for(var n=null,s=this.entities,r=s.length,o=0,a=null,h=this.offsets,l=t.setUp("x",0,"y",0,"panelled",null,"pin",null),c=t.setUp("panel",null,"pin",null),p=null;r--;)if("pin"!==(n=s[r]).type||n.handshake){if(n.velcro)for(c.panel=n,n.velcroed.length=0,p=n.parent.pins,o=0;o<p.length;o++)p[o].panelled===n&&(p[o].panelled=!1,p[o].state.set("was-panelled",p[o].state.get("panelled")),p[o].state.set("panelled",!1)),p[o].panelled||(c.pin=null,p[o].triggerEvent("can-you-pin-to-this-panel",c),c.pin?e.push(t.setUp("pinTo",n,"pinFrom",c.pin,"panel",!0)):p[o].state.set("was-panelled",!1))}else a=h[r],l.x=i.x+a.x,l.y=i.y+a.y,l.pin=n,n.panelled=!1,n.state.set("was-panelled",n.state.get("panelled")),n.state.set("panelled",!1),n.parent.triggerEventOnChildren("pin-on-panel",l),l.panelled&&(e.push(t.setUp("pinTo",l.panelled,"pinFrom",n,"panel",!0)),l.panelled=!1);return l.recycle(),e},recycle.add(r,!!springroll.Debug,"DragGroup",function(){this.lastValidPosition&&this.lastValidPosition.recycle(),this.readyToEnd&&this.readyToEnd.recycle(),this.effected.recycle(),this.validSnaps.recycle(),this.entities.recycle(),this.offsets.recycle(),this.saOrigin.recycle(),r.recycle(this)}),r}(),platypus.LabRetriever=function(){"use strict";var t=include("springroll.Debug",!1),e=[],i=function(i,n){this.labItemsUnlocked=[],this.userData=i,this.loading=!0,this.onLoaded=!1,i.readGameData("space-scouts-lab","LabUnlocks",function(t){var i=t||{},s=e.length;for(this.progress=i,this.loading=!1;s--;)e[s]();e=null,n&&n(this),this.onLoaded&&this.onLoaded()}.bind(this)),t&&(this.has=function(){return!0})},n=i.prototype;return n.has=function(t){return!!this.progress[t]},n.isNew=function(t){return!(this.progress[t]&&this.progress[t].used)},n.unlock=function(t,i){this.loading?e.push(this.unlock.bind(this,t,i)):(this.progress[t]||(this.labItemsUnlocked.push(t),this.progress[t]={},this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress)),i&&this.use(t))},n.use=function(t){"space-scouts-lab"===platypus.game.app.name?this.loading||!this.progress[t]||this.progress[t].used||(this.progress[t].used=!0,this.userData.writeGameData("space-scouts-lab","LabUnlocks",this.progress)):platypus.debug.warn('LabRetriever: Only the Lab is allowed to mark "'+t+'" as a used item.')},n.award=function(){var t=this.labItemsUnlocked;return t.length?t:null},n.getUnlocks=function(){var t={},e=this.progress,i="";for(i in e)e.hasOwnProperty(i)&&(t[i]=!!e[i]);return t},i}(),function(){"use strict";var t,e,i,n,s,r,o,a,h=window.navigator.userAgent.toLowerCase(),l=include("platypus.Data"),c=[["os 9_","","ios935"],["os 10_","","ios935"],["kfgiwi","","small"],["kfdowi","","small"],["os 11_","","small"],["iphone","dpi2","small"],["iphone","dpi3","small"],["ipad; cpu os 12_","scr4:3","small"],["ipad; cpu os 13_","scr4:3","small"],["android 4.","","small"],["android 5.","","small"],["android 6.","","small"]],p=0,u=null,d="",g=platypus.PIXIAnimation.formatSpriteSheet.bind(platypus.PIXIAnimation);for(p=0;p<c.length;p++)if(u=c[p],h.indexOf(u[0])>=0&&(!u[1]||"scr4:3"===u[1]&&window.screen.height/window.screen.width==1024/768||"dpi2"===u[1]&&2===window.devicePixelRatio||"dpi3"===u[1]&&3===window.devicePixelRatio)){d=u[2];break}d?(platypus.modifyAllAssets={ios935:4,small:2}[d],springroll.Task.prototype.filter=(a="/"+d+"/",function(t){var e=t.lastIndexOf("/"),i=t.substring(t.lastIndexOf(".")+1),n=t.substring(e+1);return"png"===i||"jpg"===i?t.substring(0,e)+a+n:t}),platypus.PIXIAnimation.formatSpriteSheet=(t=/([\w-]+)\.(\w+)$/,e=function(t,e,i){var n=platypus.modifyAllAssets,s=null,r=0;for(r=0;r<t.length;r++)s=t[r],e.push(Array.setUp(s[0]/n>>0,s[1]/n>>0,s[2]/n>>0,s[3]/n>>0,s[4]+i,s[5]/n>>0,s[6]/n>>0))},i=function(t){for(var e=t.length,i="",n="";e--;)i+=n+(t[e].src||t[e]).substring(0,128),n=",";return i},n=function(t,n){var o=n.animations,a=n.images,h=n.framerate||60,l=n.frames,c=0,p=Array.setUp(),u=a.length,d=l.length,y=t.animations,m=t.images,f=t.framerate||60,w=t.frames,v=null;for(n.id?n.id+=";"+(t.id||i(t.images)):n.id=t.id||i(t.images),c=0;c<m.length;c++)p.push(r(m[c])),a.push(p[c]);return Array.isArray(w)?e(w,l,u):(v=g(t),e(v.frames,l,u),v.recycleSpriteSheet()),function(t,e,i,n,r){var o="";for(o in t)t.hasOwnProperty(o)&&(e[o]&&(e[o].frames.recycle(),e[o].recycle(),platypus.debug.olive('PIXIAnimation "'+r+'": Overwriting duplicate animation for "'+o+'".')),e[o]=s(o,t[o],i,n))}(y,o,f/h,d,n.id),p.recycle(),n},s=function(t,e,i,n){var s=0,r=0,o=Array.setUp(),a=0;if("number"==typeof e)return o.push(e+n),l.setUp("frames",o,"next",t,"speed",i);if(Array.isArray(e)){for(r=e[0]||0,a=(e[1]||r)+1+n,s=r+=n;s<a;s++)o.push(s);return l.setUp("frames",o,"next",e[2]||t,"speed",(e[3]||1)*i)}for(s=0;s<e.frames.length;s++)o.push(e.frames[s]+n);return l.setUp("frames",o,"next",e.next||t,"speed",(e.speed||1)*i)},r=function(e){var i=!1;return"string"==typeof e&&(i=e.match(t))?i[1]:e},o=function(){var t=this.animations,e="";for(e in t)t.hasOwnProperty(e)&&t[e].frames.recycle(),t[e].recycle();this.frames.recycle(2),this.images.recycle(),this.recycle()},function(t){var e=platypus.PIXIAnimation.EmptySpriteSheet,i=t;if("string"==typeof i&&(i=platypus.game.settings.spriteSheets[t]),i){if(e=l.setUp("animations",l.setUp(),"framerate",60,"frames",Array.setUp(),"id","","images",Array.setUp(),"recycleSpriteSheet",o),Array.isArray(i))return function(t,e){for(var i=t.length,s=null;i--;)"string"==typeof(s=t[i])&&(s=platypus.game.settings.spriteSheets[s]),s&&n(s,e);return e}(i,e);if(i)return n(i,e)}return e})):platypus.modifyAllAssets=1}(),function(){"use strict";var t=include("springroll.SavedData"),e=include("springroll.UserData").prototype;e.readGameData=function(e,i,n){this.container.supported?this.container.fetch("userDataRead",function(t){n(t.data)},e+i,!0):n(t.read(e+i))},e.writeGameData=function(e,i,n,s){if(!this.container.supported)return t.write(e+i,n),void(s&&s());this.container.fetch("userDataWrite",function(){s&&s()},{name:e+i,value:n},!0)},e.removeGameData=function(e,i,n){if(!this.container.supported)return t.remove(e+i),void(n&&n());this.container.fetch("userDataRemove",function(){n&&n()},e+i,!0)},e.fixFetch=function(){var t,e,i,n=this.container;n.___fetch||(n.___fetch=n.fetch,n.fetch=(t=!1,e=function(n,s){var r=null;n(s),i.length?(r=i.shift(),this.___fetch(r.event,e.bind(this,r.callback),r.options,r.once)):t=!1},i=[],function(n,s,r,o){t?i.push({event:n,callback:s,options:r,once:o}):(t=!0,this.___fetch(n,e.bind(this,s),r,o))}))}}(),function(){"use strict";var t,e="file:"===window.location.protocol||"ionic:"===window.location.protocol||"localhost:8080"===window.location.host,i=window.navigator.userAgent.toLowerCase(),n=i.indexOf("os 9_")>=0||i.indexOf("os 10_")>=0,s=include("springroll.Application"),r=include("platypus.Badger"),o=include("springroll.pixi.PixiDisplay"),a=include("springroll.Debug",!1),h=include("platypus.LabRetriever"),l=document.getElementById("interaction"),c=function(){l.style.display="none",p=!1,u.paused=!1;try{document.body.removeChild(l)}catch(t){}},p=!e||i.indexOf("os 9_")>=0,u=new s({name:"space-scouts-lab",canvasId:"stage",captions:"captions",configPath:"assets/config/config.json",display:o,displayOptions:{clearView:!0,preserveDrawingBuffer:!0},enableHiDPI:!0,brainpoints:{callback:function(t){u.trigger("brainpoint",t)},apiOverride:"https://proxy.services.pbskids.org/enlearn",appData:{releaseBuild:!a}},preload:(t=[],n||t.push({id:"ScreenBadge_Standard",src:"assets/images/ScreenBadge_Standard.png"}),t),resizeElement:"content",responsive:!0,uniformResize:!1,state:"menu",version:"1.0.1"}),d=function(){var t=document.getElementById("frame"),e=window.innerHeight,i=window.innerWidth,n=.75*i>>0,s=2*e>>0;e>n?(t.style.height=n+"px",t.style.top=((e-n)/2>>0)+"px",t.style.width="",t.style.left=""):i>s?(t.style.width=s+"px",t.style.left=((i-s)/2>>0)+"px",t.style.height="",t.style.top=""):(t.style.height="",t.style.top="",t.style.width="",t.style.left="")};if(u.userData.fixFetch(),u.on("init",function(){var t=new r(u.config["badge-list"],"space-scouts-home-base"!==u.name?u.name:"",u.userData,function(t,e){a&&u.analyticsEmitter.enableLogging(),platypus.labRetriever=new h(u.userData,function(t){t.unlock("block-cooking-school",!0),t.unlock("chopper",!0),t.unlock("conveyor-left",!0),t.unlock("conveyor-right",!0),t.unlock("oven",!0),t.unlock("planetato",!0),t.unlock("anchor",!0),t.unlock("astronaut-a",!0),t.unlock("astronaut-b",!0),t.unlock("astronaut-c",!0),t.unlock("astronaut-d",!0),t.unlock("v-beam",!0),t.unlock("d1-roof-beam",!0),t.unlock("d2-roof-beam",!0),t.unlock("foundation",!0),t.unlock("jet2",!0),t.unlock("block-1x1",!0),t.unlock("block-1x2",!0),t.unlock("block-2x1",!0),t.unlock("block-3x1",!0),t.unlock("cockpit",!0),t.unlock("tail-fin",!0),t.unlock("wheel",!0),t.unlock("wheel-small",!0),t.unlock("pumpkin",!0),u.analyticsEmitter.startGame(u.options.version,t.getUnlocks(),e)}),u.googleAnalytics.event(u.name,"StartGame")});u.container.on("download-complete",function(){u.sound.play("download-complete")}),u.paused=p,platypus.badger=t,t.increment("tried-"+u.name),u.captions.data=u.config.captions,platypus.game.settings.entities["action-layer"].maxStepsPerTick=60/platypus.modifyAllAssets}),u.once("endGame",function(t){u.analyticsEmitter.endGame(t,platypus.labRetriever.getUnlocks(),platypus.badger.getBadgeStatusForLAP()),u.googleAnalytics.event(u.name,"EndGame")}),u.on("resize",function(t,e){u.transition?(u.transition.x=t/2,u.transition.y=e/2,u.transition.scale.x=u.transition.scale.y=e/880):(platypus.savedWidth=t,platypus.savedHeight=e)}),platypus.savedGame=sessionStorage.getItem("load-saved-game")||null,platypus.savedGame){sessionStorage.removeItem("load-saved-game");try{platypus.savedGame=JSON.parse(platypus.savedGame)}catch(t){platypus.savedGame=null}}u.on("brainpoint",function(t){platypus.debug.log('Brain Point "'+t.type+'" received! '+t.message,t),u.analyticsEmitter.receivedBrainPoint(t),u.googleAnalytics.event(u.name,"ReceivedBrainPoint"),platypus.badger&&u.config.brainPoints[t.type]&&(platypus.badger.increment(u.config.brainPoints[t.type]),u.voPlayer.playing||u.voPlayer.play("brain-point-"+t.type))}),window.app=u,window.addEventListener("resize",d,!1),window.addEventListener("orientationchange",d,!1),window.addEventListener("focus",d,!1),window.addEventListener("load",d,!1);try{!p||window.AudioContext&&"running"!==(new window.AudioContext).state||window.webkitAudioContext&&"running"!==(new window.webkitAudioContext).state||(p=!1)}catch(t){platypus.debug.warn("Unlocking audio error: "+t.message)}p&&(l.addEventListener("pointerdown",c),l.addEventListener("mousedown",c),l.addEventListener("touchstart",c),l.style.display="block")}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data");platypus.createComponentClass({id:"ActionButton",properties:{onPress:"",onRelease:"",onCancel:"",onHover:"",useOnce:!1,disabled:!1,toggle:!1,pressed:!1},publicProperties:{bottom:null,left:null,right:null,top:null},initialize:function(){var e=this.owner.state;this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.state=e,e.set("disabled",this.disabled),e.set("released",!this.pressed),e.set("pressed",this.pressed),e.set("highlighted",!1),this.owner.buttonMode=!this.disabled,this.cancelled=!1,this.readyToToggle=!1,this.coolDown=0,this.dragging=[]},events:{"let-jet-talk":function(){this.coolDown=12e3},"handle-logic":function(t){var e=this.bottom,i=this.left,n=this.right,s=this.top;this.lastBottom===e&&this.lastLeft===i&&this.lastRight===n&&this.lastTop===s||(this.updatePosition(this.aabb),this.lastBottom=e,this.lastLeft=i,this.lastRight=n,this.lastTop=s),this.coolDown>0&&(this.coolDown-=t.delta,this.coolDown<0&&(this.coolDown=0))},"camera-update":function(t){this.aabb.set(t.viewport),this.updatePosition(this.aabb)},pointerdown:function(t){this.state.get("disabled")||(this.toggle?this.coolDown||(this.readyToToggle=!0):(this.onPress&&this.owner.trigger(this.onPress),this.updateStateAndTrigger("pressed"),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&this.removeEventListener("pointerdown")))},pressup:function(t){var e=this.state;e.get("disabled")||(this.cancelled?(this.onCancel&&this.owner.trigger(this.onCancel),this.updateStateAndTrigger("cancelled")):this.toggle?this.readyToToggle&&(this.coolDown=500,e.get("pressed")?this.updateStateAndTrigger("released"):this.updateStateAndTrigger("pressed")):(this.onRelease&&this.owner.trigger(this.onRelease),this.updateStateAndTrigger("released")),t&&t.pixiEvent&&t.pixiEvent.stopPropagation&&t.pixiEvent.stopPropagation(),this.useOnce&&this.removeEventListener&&(this.removeEventListener("pressup"),this.state.set("disabled",!0),this.owner.buttonMode=!1)),this.cancelled=!1,this.readyToToggle=!1},disable:function(){this.state.set("disabled",!0),this.owner.buttonMode=!1},enable:function(){this.state.set("disabled",!1),this.owner.buttonMode=!0},"toggle-disabled":function(){var t=this.state.get("disabled");this.owner.buttonMode=t,this.state.set("disabled",!t)},highlight:function(){this.state.set("highlighted",!0)},unhighlight:function(){this.state.set("highlighted",!1)},"toggle-highlight":function(){var t=this.state;t.set("highlighted",!t.get("highlighted"))},"dragging-taking-place":function(){this.owner.triggerEvent("disable")},"no-dragging-taking-place":function(){this.owner.triggerEvent("enable")}},methods:{updatePosition:function(t){var e=this.bottom,i=this.left,n=this.owner,s=this.right,r=this.top;"number"==typeof i?n.x=t.left+i:"number"==typeof s&&(n.x=t.right-s),"number"==typeof r?n.y=t.top+r:"number"==typeof e&&(n.y=t.bottom-e)},updateStateAndTrigger:function(t){var i=null,n=this.owner,s=this.state,r=s.get("pressed"),o=s.get("released"),a=!1;o&&"pressed"===t?(s.set("pressed",!0),s.set("released",!1),a=!0):!r||"released"!==t&&"cancelled"!==t||(s.set("pressed",!1),s.set("released",!0),a=!0),a&&(i=e.setUp("released",r,"pressed",o,"triggered",o,"entity",n),n.triggerEvent(t,i),i.recycle())},destroy:function(){this.aabb.recycle(),this.aabb=null,this.owner.buttonMode=!1,this.state=null}}})}(),function(){"use strict";platypus.createComponentClass({id:"AstronautLogic",properties:{character:""},publicProperties:{},initialize:function(){var t=Math.floor(3*Math.random());this.owner.state.set("failure",!1),this.success=!1,this.owner.parent.triggerEvent("goal-check-in",this.owner),this.started=!1,this.character?this.owner.state.set(this.character,!0):this.owner.state.set("astro-"+t,!0)},events:{"simulation-started":function(){this.started=!0},"simulation-stopped":function(){this.started=!1,this.owner.triggerEvent("detach-failure"),this.owner.triggerEvent("detach-success"),this.owner.state.set("failure",!1),this.success=!1,this.owner.state.set("wet",!1),this.owner.state.set("bumped",!1),this.owner.state.set("tipped",!1),this.owner.state.set("dirty",!1)},"got-wet":function(){this.fail("wet")},"got-bumped":function(){var t=Math.abs(this.owner.orientation%Math.PI);t>=Math.PI/4&&t<=2*Math.PI-Math.PI/4?this.fail("tipped"):this.fail("bumped")},"got-dirty":function(){this.fail("dirty")},"check-for-completion":function(){this.owner.state.get("failure")||(this.success=!0,this.owner.triggerEvent("attach-success"),this.owner.parent.triggerEvent("goal-completed",this.owner))}},methods:{fail:function(t){!this.started||this.owner.state.get("failure")||this.success||(this.owner.state.set(t,!0),this.owner.state.set("failure",!0),this.owner.triggerEvent("attach-failure"),this.owner.parent.triggerEvent("goal-failed-immediately",this.owner),platypus.game.app.analyticsEmitter.astroFail({stage_width:6400,stage_height:2560,x:this.owner.x>>0,y:this.owner.y>>0},this.owner.type,t))}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.StateMap"),i={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:!1,paused:!1,playthrough:!1},n=function(e){var n="",s=null;return"string"==typeof e?(n=e,s={}):(n=e.sound,s={interrupt:e.interrupt,delay:e.delay,offset:e.offset,loop:e.loop,volume:e.volume,pan:e.pan,startTime:e.startTime,duration:e.duration,mute:e.mute,paused:e.paused,playthrough:e.playthrough}),function(e){var r=null;e=e||s,(r=t.setUp("interrupt",e.interrupt||s.interrupt||i.interrupt,"delay",e.delay||s.delay||i.delay,"loop",e.loop||s.loop||i.loop,"offset",e.offset||s.offset||i.offset,"volume",void 0!==e.volume?e.volume:void 0!==s.volume?s.volume:i.volume,"pan",e.pan||s.pan||i.pan,"mute",e.mute||s.mute||i.mute,"paused",e.paused||s.paused||i.paused,"playthrough",e.playthrough||s.playthrough||i.playthrough)).complete=function(t){t.audio&&!this.owner.destroyed&&(this.removeClip(t.audio),this.owner.triggerEvent("clip-complete")),t.recycle()}.bind(this,r),r.audio=this.player.play(n,r),r.audio&&(r.audio.soundId=n,r.audio.playthrough=r.playthrough,this.activeAudioClips.push(r.audio))}};platypus.createComponentClass({id:"AudioSFX",properties:{audioMap:null,forcePlayThrough:!0,eventBased:!0,stateBased:!1},initialize:function(t){var e="",i=null,s=null;if(this.activeAudioClips=Array.setUp(),this.state=this.owner.state,this.stateChange=!1,this.player=platypus.game.app.sound,t.audioMap)for(e in this.stateBased&&(this.checkStates=Array.setUp()),t.audioMap)t.audioMap.hasOwnProperty(e)&&(s=t.audioMap[e],i=n(s),s.sound&&(s=s.sound),this.eventBased&&this.addEventListener(e,i),this.stateBased&&this.addStateCheck(e,s,i));this.paused=!1},events:{"handle-render":function(){var t=0,e=null,i=this.state;if(!this.paused&&this.stateBased&&this.stateChange){for(t=(e=this.checkStates).length;t--;)e[t].check(i);this.stateChange=!1}},"state-changed":function(){this.stateChange=!0},"toggle-mute":function(t){this.handleClip(t,function(t){t&&(t.unmuted?(t.volume=t.unmuted,delete t.unmuted):(t.unmuted=t.volume,t.volume=0))})},"stop-audio":function(t){t?"string"==typeof t?this.stopAudio(t):this.stopAudio(t.audioId||!1,t.playthrough||!1):this.stopAudio()},"mute-audio":function(t){this.handleClip(t,function(t){t&&(t.unmuted=t.volume,t.volume=0)})},"unmute-audio":function(t){this.handleClip(t,function(t){t&&(t.volume=t.unmuted,delete t.unmuted)})},"pause-audio":function(t){this.handleClip(t,function(t){t&&t.pause()})},"unpause-audio":function(t){this.handleClip(t,function(t){t&&t.unpause()})},"set-pan":function(t,e){var i=e||"",n=function(t,e){e&&(e.pan=t)};e?this.handleClip(i,n.bind(null,t)):this.getAllClips(n.bind(null,t))},"set-volume":function(t,e){var i=e||"",n=function(t,e){e&&(e.volume=t)};e?this.handleClip(i,n.bind(null,t)):this.getAllClips(n.bind(null,t))}},methods:{handleClip:function(t,e){"string"==typeof t?this.getClipById(t,e):this.getAllClips(e)},getClipById:function(t,e){var i=0,n=this.activeAudioClips;for(i=0;i<n.length;i++)if(n[i].soundId===t)return e&&e(n[i]),n[i];return e&&e(null),null},getAllClips:function(t){var e=0,i=this.activeAudioClips;if(t)for(e=0;e<i.length;e++)t(i[e]);return i},stopAudio:function(t,e){var i=this.activeAudioClips,n=(function(t){this.stopAudioInstance(t.currentTarget)}.bind(this),i.length);if(t)for(;n--;)i[n].soundId===t&&(i[n].playthrough||e||(i[n].stop(),i.greenSplice(n)));else{for(;n--;)e||i[n].playthrough||i[n].stop();i.length=0}},stopAudioInstance:function(t){var e=this.activeAudioClips,i=e?e.indexOf(t):-1;i>=0&&e.greenSplice(i),t.stop()},removeClip:function(t){var e=this.activeAudioClips.indexOf(t);e>=0&&this.activeAudioClips.greenSplice(e)},addStateCheck:function(i,n,s){var r=e.setUp(i),o=t.setUp("states",r,"playing",!1);o.check=function(t,e,i,n){var s=n.includes(t.states);s!==t.playing&&(s?i():this.stopAudio(e,this.forcePlaythrough),t.playing=s)}.bind(this,o,n,s.bind(this)),this.checkStates.push(o)},destroy:function(){var t=this.checkStates,e=null,i=0;if(this.stopAudio(),this.activeAudioClips.recycle(),this.activeAudioClips=null,this.state=null,t){for(i=t.length;i--;)(e=t[i]).states.recycle(),e.recycle();t.recycle(),this.checkStates=null}}}})}(),function(){"use strict";var t=include("platypus.Data"),e=function(t,e){return t.time-e.time},i=function(i,n){var s=0;for(s=0;s<i.length;s++)n.push(t.setUp("event",i[s].event,"time",i[s].time||0,"message",i[s].message));return s&&n.sort(e),n},n=function(i,n,s){var r=0,o=s.getElapsed();for(r=0;r<i.length;r++)n.push(t.setUp("event",i[r].event,"time",(i[r].time||0)+o,"message",i[r].message||null));r&&n.sort(e)},s=function(t,e,i){var s=0,r=Array.setUp();for(s=0;s<t.length;s++)t[s].sound?(t[s].events&&r.push(n.bind(this,t[s].events,e,i)),r.push(t[s].sound)):r.push(t[s]);return r},r=function(t,e){this.playingAudio=!1,this.player.unloadSound(),this.owner.destroyed||(this.checkTimeEvents(!0),this.owner.triggerEvent("sequence-complete")),e.recycle()},o=function(t,e){var n=null,o=Array.setUp(),a=this.player;"string"==typeof t?n=Array.setUp(t):Array.isArray(t)?n=s(t,o,a):(t.events&&i(t.events,o),n=Array.isArray(t.sound)?s(t.sound,o,a):Array.setUp(t.sound)),e&&e.events&&i(e.events,o),a.play(n,r.bind(this,!0,n),r.bind(this,!1,n)),this.eventList.recycle(),this.eventList=o,this.playingAudio=!0};platypus.createComponentClass({id:"AudioVO",properties:{audioMap:null},initialize:function(){var t="";if(this.eventList=Array.setUp(),this.playingAudio=!1,this.player=platypus.game.app.voPlayer,this.player.trackSound=platypus.supports.iOS,this.audioMap)for(t in this.audioMap)this.audioMap.hasOwnProperty(t)&&this.addEventListener(t,o.bind(this,this.audioMap[t]));this.paused=!1},events:{"handle-render":function(){this.paused||this.checkTimeEvents(!1)},"stop-audio":function(){this.player.stop(),this.player.voList=[]}},methods:{checkTimeEvents:function(t){var e=null,i=this.eventList,n=0,s=this.owner;if(i&&i.length)for(n=this.player.getElapsed();i.length&&(t||i[0].time<=n);)e=i.greenSplice(0),s.trigger(e.event,e.message),e.recycle()},destroy:function(){this.playingAudio&&(this.player.stop(),this.player.voList=[]),this.eventList.recycle()}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeBannerBuilder",properties:{bannerPositions:null,toBuild:"all",zoomOutWidth:1816,zoomOutHeight:1360,zoomInWidth:908,zoomInHeight:680},publicProperties:{},initialize:function(){var t=platypus.game.app,e=t.name,i=platypus.badger.getBadges(),n=0,s=null;if(this.showEverything="space-scouts-home-base"===e,this.zoomBanners=[],this.banners=[],this.badges={},this.badgeHighlight=null,this.collectedBadges=0,this.zooming=!1,this.cameraX=0,this.cameraY=0,this.tweenWidth=1816,this.tweenHeight=1360,this.targetBanner=null,this.zoomed="out",this.showEverything)for(s in i)i.hasOwnProperty(s)&&(this.buildBanner(s,i[s],n),n++);else this.buildBanner(e,i[e],n);this.badgeHighlight=this.owner.addEntity({type:"badge-highlight",properties:{x:0,y:0,z:100.5,opacity:.001}}),t.music="jam",t.musicInstance.volume=.5,this.badgeTime=Date.now(),t.googleAnalytics.event(t.name,"EnterBadgeScreen","BadgesCollected",this.collectedBadges)},events:{"scene-live":function(t){var e=0;if(this.showEverything){if(t&&t.banner)for(e=this.banners.length;e--;)if(this.banners[e].game===t.banner){this.owner.triggerEvent("zoom-in",this.banners[e]);break}}else this.owner.triggerEvent("zoom-in",this.banners[0])},tick:function(){this.zooming&&this.resizeCamera()},"camera-update":function(t){this.tweenWidth=t.viewport.width,this.tweenHeight=t.viewport.height,this.cameraX=t.viewport.x,this.cameraY=t.viewport.y},"zoom-out":function(){this.zooming||("out"!==this.zoomed&&this.showEverything?(this.zooming=!0,this.owner.triggerEvent("rl-hide-info-panel"),this.targetBanner.zoomBanner.triggerEvent("show-sprite"),this.targetBanner=null,this.badgeHighlight.opacity=.001,t.get(this).to({cameraX:0,cameraY:0,tweenWidth:this.zoomOutWidth,tweenHeight:this.zoomOutHeight},1e3,e.sineInOut).call(function(){this.zoomed="out",this.zooming=!1,this.resizeCamera()}.bind(this))):this.owner.triggerEvent("new-scene"))},"zoom-in":function(i){this.zooming||"out"!==this.zoomed||(this.zooming=!0,this.targetBanner=i,this.showEverything?i.state.get("app")?t.get(this).to({cameraX:this.targetBanner.x+225,cameraY:this.targetBanner.y,tweenWidth:this.zoomInWidth,tweenHeight:this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):t.get(this).to({cameraX:this.targetBanner.x+180,cameraY:this.targetBanner.y,tweenWidth:.8*this.zoomInWidth,tweenHeight:.8*this.zoomInHeight},1e3,e.sineInOut).call(this.zoomInComplete.bind(this,i,!1)):(this.cameraX=this.targetBanner.x+225,this.cameraY=this.targetBanner.y,this.tweenWidth=this.zoomInWidth,this.tweenHeight=this.zoomInHeight,this.zoomInComplete(i,!0)))}},methods:{zoomInComplete:function(t,e){this.zoomed="in",this.zooming=!1,this.resizeCamera(),this.targetBanner.zoomBanner.triggerEvent("hide-sprite"),this.badges[t.game][0].triggerEvent("send-highlight-info"),this.owner.triggerEvent("rl-show-info-panel",e)},resizeCamera:function(){this.owner.triggerEvent("resize-camera",{width:this.tweenWidth,height:this.tweenHeight}),this.owner.triggerEvent("relocate",{x:this.cameraX,y:this.cameraY})},buildBanner:function(t,e,i){var n=null,s=this.bannerPositions&&this.bannerPositions[t],r=null,o=450*(i%3),a=650*Math.floor(i/3);this.showEverything?s?(o=s.x,a=s.y):(o+=-450,a+=-325):o-=225,(n=this.owner.addEntity({type:"badge-banner",properties:{x:o,y:a,z:100,game:t}})).state.set(t,!0),r=this.owner.addEntity({type:"zoom-banner",properties:{x:o,y:a,z:102}}),n.zoomBanner=r,r.banner=n,this.banners.push(n),this.zoomBanners.push(r),this.buildBadges(t,e,o,a,s)},buildBadges:function(t,e,i,n,s){var r=0,o=0,a=null,h=null,l=0,c=0,p=0,u="",d="",g=s&&s.badgeOffsetX?s.badgeOffsetX:-91,y=s&&s.badgeOffsetY?s.badgeOffsetY:-70;for(r=0;r<e.length;r++)h=e[r],s.specials&&s.specials[r]?(o-=1,c=i+s.specials[r].x,p=n+s.specials[r].y):(l=Math.floor((r+o)/3),c=i+g+91*((r+o)%3),p=n+y+91*l),u=h.name,d=h.description,a=this.owner.addEntity({type:"badge",properties:{x:c,y:p,z:101,animation:t+"-"+h.id,highlight:h.highlight||"circle",name:u||t+"-"+h.id,description:d||"Undescribed",level:h.level,collected:h.completed,game:t,directive:h.directive,progress:this.getProgress(h)}}),this.addGroupInfo(h,a,"group1"),this.addGroupInfo(h,a,"group2"),this.addGroupInfo(h,a,"group3"),this.addGroupInfo(h,a,"group4"),a.collected?(a.state.set(a.animation,!0),this.collectedBadges+=1):a.opacity=.2,h.highlight?(a.state.set(h.highlight,!0),a.collected?a.scaleX=a.scaleY=.203452:a.scaleX=a.scaleY=.203452/.6):a.scaleX=a.scaleY=.6344*.38,this.badges[t]||(this.badges[t]=[]),this.badges[t].push(a)},addGroupInfo:function(t,e,i){var n=0,s=0,r=null,o=0,a=0;if(t[i]){if(e[i]=t[i],e[i+"-directive"]=t[i+"-directive"],!t.subgoals)return e[i+"-complete"]=!1,void(e[i+"-progress"]=0);for(n=(r=t[i+"-subgoals"].split(",")).length;n--;)for(s=t.subgoals.length;s--;)if(t.subgoals[s].key===r[n]){a+=Math.min(t.subgoals[s].progress||0,+(t.subgoals[s].count||0)),o+=+(t.subgoals[s].count||0);break}a!==o?(e[i+"-complete"]=!1,e[i+"-progress"]=a/o):e[i+"-complete"]=!0}},getProgress:function(t){var e=0,i=0,n=0;if(!t.subgoals)return 0;for(e=t.subgoals.length;e--;)n+=Math.min(t.subgoals[e].progress||0,+(t.subgoals[e].count||0)),i+=+(t.subgoals[e].count||0);return n/i},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitBadgeScreen","BadgeScreenTime",Date.now()-this.badgeTime>>0)}},publicMethods:{},getAssetList:function(){for(var t=null,e=["badge-banner","badge","badge-highlight","zoom-banner"],n=e.length,s=Array.setUp();n--;)t=i.getAssetList({type:e[n]}),s.union(t),t.recycle();return s}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeHighlightLogic",properties:{},publicProperties:{},initialize:function(){this.prevAnimation=null},events:{"highlight-badge":function(t){this.owner.opacity=1,this.owner.x=t.x,this.owner.y=t.y,this.owner.triggerEvent("set-animation",t.highlight)},"set-animation":function(t){""!==this.prevAnimation&&this.owner.state.set(this.prevAnimation,!1),this.owner.state.set(t,!0),this.prevAnimation=t}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("platypus.Data"),i=include("platypus.Entity");platypus.createComponentClass({id:"BadgeInfoPanelLogic",properties:{},publicProperties:{},initialize:function(){this.highlightedBadge=null,this.prevAnimation="",this.badgeInfo=null,this.rows=Array.setUp()},events:{"scene-loaded":function(){var t=platypus.game.app,e=t.name,i=null,n=t.config["badge-list"],s=null,r=null;if(this.highlightedBadge=this.owner.parent.addEntity({type:"highlighted-badge",properties:{x:this.owner.x,y:this.owner.y+-270,z:101}}),this.rows.push(this.createGoRow(0),this.createGoRow(1),this.createGoRow(2),this.createGoRow(3)),"space-scouts-home-base"===e){for(i in n)if(n.hasOwnProperty(i)){r={name:(s=n[i].badges[0]).name,description:s.description,level:s.level,animation:i+"-"+s.id,game:i};break}}else r={name:(s=n[e].badges[0]).name,description:s.description,level:s.level,animation:e+"-"+s.id,game:e};this.owner.triggerEvent("highlight-badge",r,!0),this.owner.triggerEvent("hide-sprite"),this.highlightedBadge.triggerEvent("hide-sprite"),this.rows[0].checkmark.triggerEvent("hide-sprite"),this.rows[1].checkmark.triggerEvent("hide-sprite"),this.rows[2].checkmark.triggerEvent("hide-sprite"),this.rows[3].checkmark.triggerEvent("hide-sprite")},"highlight-badge":function(t,e){var i=this.highlightedBadge;this.badgeInfo=t,i.scaleX=i.scaleY=1,t.collected?(this.owner.triggerEvent("set-badge-animation",t.animation),"circle"!==t.highlight&&(i.scaleX=i.scaleY=2/3),this.owner.state.set("earned",!0),e||(this.owner.triggerEvent(t.animation+"-earned"),platypus.game.app.voPlayer.play(t.animation))):(this.owner.triggerEvent("set-badge-animation",t.highlight||"empty"),this.owner.state.set("earned",!1),e||(this.owner.triggerEvent(t.animation),platypus.game.app.voPlayer.play([t.animation,t.game+"-to-earn-badge",t.animation+"-requirements"]))),this.owner.triggerEvent("set-title-text",t.name),this.loadRows(t)},"set-badge-animation":function(t){""!==this.prevAnimation&&this.highlightedBadge.state.set(this.prevAnimation,!1),this.highlightedBadge.state.set(t,!0),this.prevAnimation=t},"hide-info-panel":function(){this.tweenHide(this.owner),this.tweenHide(this.highlightedBadge),this.tweenHide(this.rows[0].checkmark),this.tweenHide(this.rows[1].checkmark),this.tweenHide(this.rows[2].checkmark),this.tweenHide(this.rows[3].checkmark)},"show-info-panel":function(e){var i=e?0:300;this.owner.triggerEvent("show-sprite"),this.highlightedBadge.triggerEvent("show-sprite"),this.rows[0].checkmark.triggerEvent("show-sprite"),this.rows[1].checkmark.triggerEvent("show-sprite"),this.rows[2].checkmark.triggerEvent("show-sprite"),this.rows[3].checkmark.triggerEvent("show-sprite"),this.owner.opacity=.001,this.highlightedBadge.opacity=.001,this.rows[0].checkmark.opacity=.001,this.rows[1].checkmark.opacity=.001,this.rows[2].checkmark.opacity=.001,this.rows[3].checkmark.opacity=.001,t.get(this.owner).to({opacity:1},i),t.get(this.highlightedBadge).to({opacity:1},i),t.get(this.rows[0].checkmark).to({opacity:1},i),t.get(this.rows[1].checkmark).to({opacity:1},i),t.get(this.rows[2].checkmark).to({opacity:1},i),t.get(this.rows[3].checkmark).to({opacity:1},i)},"get-badge":function(t){var e=null,i=this.badgeInfo.game,n=platypus.game.app.config.games;t.directive?(i=(e=t.directive.split(":"))&&e[0]||this.badgeInfo.game,platypus.debug.olive("This one has a directive! "+t.directive)):platypus.debug.olive("Wants to achieve badge. Opening Level Select for all cases at this point."),"space-scouts-home-base"===platypus.game.app.name?"app"===i?this.owner.triggerEvent("look-at-all-badges"):"true"===sessionStorage.getItem("space-scouts-home-base-loaded-by-app")?platypus.game.app.container.send("load-game",{game:i,getBadge:e}):n[i]?(this.loadSavedGame&&sessionStorage.setItem("get-badge",JSON.stringify(e)),window.top.location=n[i]):platypus.debug.warn('"'+i+'" does not seem to be a valid game id.'):platypus.game.loadScene("level-select")}},methods:{createGoRow:function(t){var i=this.owner,n=e.setUp("checkmark",i.parent.addEntity({type:"go-to-badge-button",properties:{x:i.x+-300,y:i.y+100+100*t,z:101}}),"directive","","visible",!1);return n.checkmark.on("released",i.triggerEvent.bind(i,"get-badge",n)),n},loadRows:function(t){for(var e=["group1","group2","group3","group4"],i=e.length,n=0,s=null,r=null,o=null;i--;){for(o=(r=(s=this.rows[i]).checkmark).state,n=1;n<=16;n++)o.set("filled-"+n,!1);t[e[i]]?(r.x=this.owner.x+-300,r.triggerEvent("set-text",t[e[i]]),s.visible=!0,s.directive=t[e[i]+"-directive"],t[e[i]+"-complete"]?r.triggerEvent("disable"):(o.set("filled-"+(Math.ceil(16*t[e[i]+"-progress"])||1),!0),r.triggerEvent("enable"))):(r.x=-6e3,s.visible=!1)}t.group1?(r.components[3].sprite.y=0,r.components[3].sprite.anchor.y=.5):((r=(s=this.rows[0]).checkmark).x=this.owner.x+-300,r.triggerEvent("set-text",t.description),s.visible=!0,s.directive=t.directive,t.collected?r.triggerEvent("disable"):(o.set("filled-"+(Math.ceil(16*t.progress)||1),!0),r.triggerEvent("enable")),r.components[3].sprite.y=-24,r.components[3].sprite.anchor.y=0)},tweenHide:function(e){t.get(e).to({opacity:0},300).call(function(){e.triggerEvent("hide-sprite")})}},publicMethods:{},getAssetList:function(){for(var t=null,e=["highlighted-badge","go-to-badge-button"],n=e.length,s=Array.setUp();n--;)t=i.getAssetList({type:e[n]}),s.union(t),t.recycle();return s}})}(),function(){"use strict";platypus.createComponentClass({id:"BadgeLogic",properties:{},publicProperties:{animation:"",highlight:"circle",name:"default name",description:"default description",level:"",collected:!1,game:""},initialize:function(){},events:{"send-highlight-info":function(){this.owner.triggerEvent("rl-highlight-badge",this.owner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Ease"),i=include("PIXI.Graphics"),n=include("createjs.Tween"),s=function(t,e,n){var s=new i;return t.mask=s,s.isMask=!0,s.z=1,e.addChild(s),s.clear(),s.beginFill(0,1),s.r(n.left,n.top,n.width,n.height),s.endFill(),s};platypus.createComponentClass({id:"BadgeNotifier",properties:{},publicProperties:{showLength:5e3},initialize:function(){this.hideSoon=0,this.hiding=!0,this.lastState=null,this.list=Array.setUp()},events:{load:function(){this.progressMask=s(this.owner.components[3].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.activeMask=s(this.owner.components[5].sprite,this.owner.container,t.setUp(-200,0,400,140)),this.progressMask.y=170,this.activeMask.y=170},adopted:function(){this.handler=function(t){for(var e=this.list,i=e.length;i--;)if(t.badge===e[i].badge)return;e.push(t)}.bind(this),this.owner.parent.on("badge-incremented",this.handler)},"handle-logic":function(t){var e=null,i=null,n=0,s=this.owner.state;if(this.hiding){if(this.list.length){if(i=(e=this.list.pop()).badge,this.lastState&&s.set(this.lastState,!1),this.lastState=i["game-id"]+"-"+i.id,s.set(this.lastState,!0),n="app-1"===this.lastState||"app-2"===this.lastState||"app-3"===this.lastState||"app-4"===this.lastState,this.createProgress(i,e,!n),n)return;this.owner.triggerEvent("show-progress"),this.owner.triggerEvent("set-text",i.name),this.hiding=!1,this.hideSoon=this.showLength}}else this.hideSoon>0&&(this.hideSoon-=t.delta,this.hideSoon<=0&&this.owner.triggerEvent("hide-progress"))},hiding:function(){this.hiding=!0}},methods:{createProgress:function(t,i,s){for(var r=platypus.game.app,o=t.subgoals,a=o.length,h=0,l=0,c=0;a--;)h+=+o[a].count,l+=o[a].progress||0;r.analyticsEmitter.progressBadge(t.name,l/h),r.googleAnalytics.event(r.name,"BadgeProgress",t.name,l-i.originalProgress),s&&(c=(l-i.progress+i.originalProgress)/h*400,this.activeMask.x=c,this.progressMask.x=c,n.get(this.activeMask).wait(500).to({x:l/h*400},1200,e.sineInOut))},destroy:function(){this.owner.parent.off("badge-incremented",this.handler),this.list.recycle(),this.list=null}},publicMethods:{}})}(),function(){"use strict";var t=[];platypus.createComponentClass({id:"BatteryLogic",properties:{},publicProperties:{power:1,order:0},initialize:function(){var e=0,i=!1;for(this.simulating=!1,this.prevPower=0,this.power=1,this.owner.state.set("power-8",!0),this.owner.state.set("power-7",!1),this.owner.state.set("power-6",!1),this.owner.state.set("power-5",!1),this.owner.state.set("power-4",!1),this.owner.state.set("power-3",!1),this.owner.state.set("power-2",!1),this.owner.state.set("power-1",!1),this.owner.state.set("power-0",!1),this.owner.state.set("dead",!1),e=0;e<t.length;e++)if(e<t[e]){this.order=e,t.splice(e,0,e),i=!0;break}i||(this.order=t.length,t.push(this.order))},events:{"update-group-id":function(){this.owner.triggerEvent("rl-battery-moved",this.owner)},"handle-ai":function(){this.simulating&&(0!==this.prevPower&&this.power<=0?this.owner.state.set("dead",!0):this.prevPower<=0&&this.power>0&&this.owner.state.set("dead",!1),this.prevPower=this.power,this.owner.state.set("power-8",!1),this.owner.state.set("power-7",!1),this.owner.state.set("power-6",!1),this.owner.state.set("power-5",!1),this.owner.state.set("power-4",!1),this.owner.state.set("power-3",!1),this.owner.state.set("power-2",!1),this.owner.state.set("power-1",!1),this.owner.state.set("power-0",!1),this.power<=0?this.owner.state.set("power-0",!0):this.power<=.125?this.owner.state.set("power-1",!0):this.power<=.25?this.owner.state.set("power-2",!0):this.power<=.375?this.owner.state.set("power-3",!0):this.power<=.5?this.owner.state.set("power-4",!0):this.power<=.625?this.owner.state.set("power-5",!0):this.power<=.75?this.owner.state.set("power-6",!0):this.power<=.875?this.owner.state.set("power-7",!0):this.power<=1&&this.owner.state.set("power-8",!0))},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.owner.state.set("power-8",!0),this.owner.state.set("power-7",!1),this.owner.state.set("power-6",!1),this.owner.state.set("power-5",!1),this.owner.state.set("power-4",!1),this.owner.state.set("power-3",!1),this.owner.state.set("power-2",!1),this.owner.state.set("power-1",!1),this.owner.state.set("power-0",!1),this.simulating=!1,this.power=1,this.prevPower=0}},methods:{destroy:function(){var e=0;for(e=0;e<t.length;e++)this.order===t[e]&&t.splice(e,1)}},publicMethods:{drain:function(t){return!this.owner.state.get("dead")&&(this.power-=t,this.power=Math.max(0,this.power),!0)},charge:function(t){return this.power<1&&(this.power+=t,this.power=Math.min(1,this.power),!0)}}})}(),function(){"use strict";platypus.createComponentClass({id:"Beamable",properties:{},publicProperties:{},initialize:function(){this.connectedTo=null,this.beamJoint=null,this.createBeamJoint=null,this.bc=-1,this.beamFX=[],this.needDisconnect=!1,this.beaming=!1},events:{adopted:function(){},"handle-logic":function(){},"beam-on":function(t){this.owner.y-t.y<700&&Math.abs(this.owner.x-t.x)<200&&(this.beaming||this.owner.parent.triggerEvent("beamLoop"),this.beaming=!0,this.connectedTo=t,this.createBeamJoint=t)},"beam-off":function(t){this.connectedTo&&(this.needDisconnect=!0,this.beaming=!1,this.owner.parent.triggerEvent("stop-audio","beamLoop"))},"collide-with-goal":function(){this.remove=!0},"prepare-logic":function(){if(this.remove?(this.connectedTo&&(this.disconnect(),this.beaming=!1,this.owner.parent.triggerEvent("stop-audio","beamLoop")),this.owner.parent&&(this.owner.parent.removeEntity(this.owner),this.remove=!1)):this.connectedTo&&this.needDisconnect&&(this.disconnect(),this.needDisconnect=!1),this.createBeamJoint&&(this.beamJoint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:(this.owner.y-this.createBeamJoint.y)/30},length:10,collideConnected:!0,dampingRatio:.1,frequencyHz:10},this.createBeamJoint,1),this.createBeamJoint.beamConnect(this.owner.type),this.createBeamJoint=null),this.connectedTo){if(this.bc++,this.bc%50==0&&this.beamFX.length<5){var t=this.owner.parent.addEntity({id:"beamFX",components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"beam"}}],properties:{x:this.owner.x,y:this.owner.y-50,z:this.owner.z-1,scaleX:.66,scaleY:.66,opacity:.5}});this.beamFX.push(t)}for(var e in this.beamFX){var i=this.beamFX[e];i.opacity-=.0025,i.x=this.owner.x,i.y=this.owner.y-50-500*(.5-i.opacity),i.opacity<.005&&(i.opacity=.5,i.y=this.owner.y-50)}}}},methods:{destroy:function(){this.connectedTo=null,this.beamJoint=null,this.createBeamJoint=null,this.beamFX=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{disconnect:function(){for(var t in this.owner.removeJoint(this.beamJoint),this.beamJoint=null,this.connectedTo.beamConnect(null),this.connectedTo=null,this.bc=-1,this.beamFX){var e=this.beamFX[t];this.owner.parent.removeEntity(e)}this.beamFX=[]}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Bird",properties:{carrying:null,ship:!1,dir:1},publicProperties:{},initialize:function(){this.joint=null,this.flyForce=new t(0,0),this.originX=0,this.originY=0,this.hoverC=0,this.carryingObj=null,this.free=!1,this.scale=this.owner.scaleX||1,this.shakeC=0,this.shakeX=0,this.shakeY=0,this.simulationStarted=!1,this.wearingHelmet=!1},events:{"simulation-started":function(){this.originX=this.owner.x,this.originY=this.owner.y,this.simulationStarted=!0},"simulation-stopped":function(){this.dir=1,this.owner.scaleX=this.dir*this.scale,this.simulationStarted=!1},whistle:function(t){var e,i;(e=this.owner.x-t.x,i=this.owner.y-t.y,e*e+i*i)<5e5&&!this.free&&(this.owner.removeJoint(this.joint),this.free=!0,this.carryingObj.released())},"handle-logic":function(){var t=1===this.owner.parent.gravityMultiplier;if(this.wearingHelmet===t&&(this.wearingHelmet=!t,this.owner.state.set("in-space",this.wearingHelmet)),this.simulationStarted){this.hoverC+=this.randRange(.1,.5);var e=Math.sin(this.hoverC),i=this.originY-this.owner.y;i<0&&(e=Math.abs(e)*i),this.flyForce.set_y(e),this.flyForce.set_x(this.randRange(7,13)*this.dir),this.owner.body.ApplyForce(this.flyForce,this.owner.body.GetWorldCenter());var n=!1;if(!this.free&&!this.ship)Math.abs(this.owner.x-this.originX)>300&(this.originX-this.owner.x)*this.dir<0&&(n=!0);return(Math.random()<.001||n)&&!this.ship&&(this.dir*=-1),this.owner.scaleX=this.dir*this.scale,this.shakeC?(this.owner.x=this.shakeX+this.randRange(-1,1)*(this.shakeC/10),this.owner.y=this.shakeY+this.randRange(-1,1)*(this.shakeC/10),this.shakeC--,void(0===this.shakeC&&(this.owner.x=this.shakeX,this.owner.y=this.shakeY))):void 0}},adopted:function(){this.originX=this.owner.x,this.originY=this.owner.y,null!==this.carrying&&(this.carryingObj=this.owner.parent.addEntity({type:this.carrying,properties:{x:this.owner.x,y:this.owner.y+100,z:this.owner.z+1,carried:!0}}),this.joint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:0},length:50,dampingRatio:1,frequencyHz:5},this.carryingObj,1),this.wearingHelmet=1!==this.owner.parent.gravityMultiplier,this.owner.state.set("in-space",this.wearingHelmet))}},methods:{destroy:function(){this.flyForce=null,this.carryingObj=null,this.joint=null},randRange:function(t,e){return Math.random()*(e-t)+t}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.destroy"),i=include("Box2D.getPointer");platypus.createComponentClass({id:"BoopArm",events:{adopted:function(){this.owner.state.set("arm",!0),this.owner.body.SetGravityScale(0)},"simulation-started":function(){var t=this.owner.body,e=null;if(!this.simulating&&t)for(this.simulating=!0,e=t.GetFixtureList();0!==i(e);)e.SetSensor(!1),e=e.GetNext()},"simulation-stopped":function(){var n=this.owner.body,s=null,r=null;if(this.simulating&&n)for(this.simulating=!1,r=new t(0,0),n.SetAngularVelocity(0),n.SetLinearVelocity(r),this.owner.orientation=0,this.owner.rotation=0,this.owner.matchBodyToEntity(),e(r),s=n.GetFixtureList();0!==i(s);)s.SetSensor(!0),s=s.GetNext()}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.destroy"),i=include("Box2D.getPointer");platypus.createComponentClass({id:"BoopHand",properties:{main:null},publicProperties:{magnet:!0,facing:"X"},initialize:function(){this.state="claw",this.connectedTrash=[],this.suckFX=[],this.suckC=-1,this.mag=!1},events:{adopted:function(){this.owner.state.set("claw",!0),this.owner.body.SetGravityScale(0)},reset:function(){},"get-soil":function(){this.owner.parent.parent.layers[1].triggerEvent("kill-magnet"),this.owner.state.set("magnet",!1),this.owner.state.set("claw",!0),this.owner.state.set("camera",!1)},camera:function(){this.owner.parent.parent.layers[1].triggerEvent("kill-magnet"),this.owner.state.get("camera")?(this.takePicture(),this.owner.parent.triggerEvent("camClick")):(this.owner.state.set("magnet",!1),this.owner.state.set("claw",!1),this.owner.state.set("camera",!0))},"magnet-toggle":function(){this.owner.state.set("magnet",!0),this.owner.state.set("claw",!1),this.owner.state.set("camera",!1)},"magnet-on":function(t){this.mag||this.owner.parent.triggerEvent("magnet"),this.mag=!0},"magnet-off":function(){for(var t=this.connectedTrash.length,e=0;e<t;e++)this.connectedTrash[e].disconnect(!0);for(var i in this.connectedTrash=[],this.mag=!1,this.suckFX){var n=this.suckFX[i];this.owner.parent.removeEntity(n)}this.suckFX=[],this.owner.parent.triggerEvent("stop-audio","magnet")},"handle-logic":function(){if(this.mag){var t,e,i,n;if(this.suckC++,this.suckC%5==0&&this.suckFX.length<18){e=(t=20*this.suckFX.length)+180,i=t*(Math.PI/180),n=e*(Math.PI/180);var s=this.owner.parent.addEntity({id:"suckFX",components:[{type:"RenderSprite",spriteSheet:"fx",rotate:!0,animationMap:{default:"suck"}}],properties:{x:this.owner.x+150*Math.cos(i),y:this.owner.y+150*Math.sin(i),z:this.owner.z-1,scaleX:this.randRange(.5,.75),scaleY:.66,opacity:.15,speedX:Math.cos(n),speedY:Math.sin(n),rotation:t,ang:t}});this.suckFX.push(s)}for(var r in this.suckFX){var o=this.suckFX[r];o.x+=o.speedX,o.y+=o.speedY,o.speedX*=1.02,o.speedY*=1.02,o.scaleX-=.01,o.opacity+=.01,o.opacity>.6&&(e=(t=o.ang)+180,i=t*(Math.PI/180),n=e*(Math.PI/180),o.x=this.owner.x+100*Math.cos(i),o.y=this.owner.y+100*Math.sin(i),o.scaleX=this.randRange(.5,.75),o.opacity=.15,o.speedX=Math.cos(n),o.speedY=Math.sin(n),o.rotation=t)}}},"simulation-started":function(){var t=this.owner.body,e=null;if(!this.simulating&&t)for(this.simulating=!0,e=t.GetFixtureList();0!==i(e);)e.SetSensor(!1),e=e.GetNext()},"simulation-stopped":function(){var n=this.owner.body,s=null,r=null;if(this.simulating&&n)for(this.simulating=!1,r=new t(0,0),n.SetAngularVelocity(0),n.SetLinearVelocity(r),this.owner.orientation=0,this.owner.rotation=0,this.owner.matchBodyToEntity(),e(r),s=n.GetFixtureList();0!==i(s);)s.SetSensor(!0),s=s.GetNext()}},methods:{destroy:function(){this.main=null,this.connectedTrash=null}},publicMethods:{takePicture:function(){var t=this.owner.orientation,e=10*Math.cos(t),i=10*Math.sin(t);this.owner.parent.addEntity({type:"camPath",properties:{x:this.owner.x+e,y:this.owner.y+i,vx:100*e,vy:100*i}})},addTrash:function(t){this.connectedTrash.push(t)},removeTrash:function(t){var e=this.connectedTrash.indexOf(t);e>-1&&this.connectedTrash.splice(e,1)},randRange:function(t,e){return Math.random()*(e-t)+t}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.destroy"),i=include("Box2D.getPointer");platypus.createComponentClass({id:"BoopHead",events:{adopted:function(){this.owner.state.set("head",!0),this.owner.body.SetGravityScale(0)},"simulation-started":function(){var t=this.owner.body,e=null;if(!this.simulating&&t)for(this.simulating=!0,e=t.GetFixtureList();0!==i(e);)e.SetSensor(!1),e=e.GetNext()},"simulation-stopped":function(){var n=this.owner.body,s=null,r=null;if(this.simulating&&n)for(this.simulating=!1,r=new t(0,0),n.SetAngularVelocity(0),n.SetLinearVelocity(r),this.owner.orientation=0,this.owner.rotation=0,this.owner.matchBodyToEntity(),e(r),s=n.GetFixtureList();0!==i(s);)s.SetSensor(!0),s=s.GetNext()},"handle-logic":function(){this.owner.orientation>0&&this.owner.body.ApplyTorque(-2.5),this.owner.orientation<-1&&this.owner.body.ApplyTorque(2.5)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("platypus.AABB"),i=include("Box2D.destroy"),n=include("Box2D.getPointer");platypus.createComponentClass({id:"BoopMain",properties:{npc:!1},publicProperties:{grounded:!1},initialize:function(){this.originX=0,this.originY=0,this.reset=!1,this.groundContacts=0,this.soilContacts=0,this.activateJump=new t(0,-1),this.leftWheel=null,this.centerWheel=null,this.rightWheel=null,this.arm=null,this.head=null,this.magnet=null,this.canCollectSoil=!1,this.camera=e.setUp(),this.psc=0,this.psp=0,this.partsHitGround=0,this.simulating=!1},events:{adopted:function(){this.npc||(this.camLock=this.owner.parent.addEntity({type:"camLock",properties:{target:this.owner,x:this.owner.x,y:this.owner.y,levelId:this.owner.parent.levelId}})),this.owner.state.set("body",!0),this.originX=this.owner.x,this.originY=this.owner.y,this.buildBoop()},"collide-with-hole":function(){this.owner.parent.parent.layers[1].triggerEvent("show-mindy-panel","canyon")},"camera-update":function(t){this.camera.set(t.viewport)},"simulation-started":function(){var t=this.owner.body;!this.simulating&&t&&(this.connectArm(this.arm),this.connectHead(this.head),this.connectHand(this.magnet),this.connectWheel(this.leftWheel,"left"),this.connectWheel(this.centerWheel,"center"),this.connectWheel(this.rightWheel,"right"),t.ApplyLinearImpulse(this.activateJump,t.GetWorldCenter()),this.simulating=!0)},"simulation-stopped":function(){for(var t=this.owner,e=t.body,i=e.GetJointList().get_joint();0!==n(i);)t.removeJoint(i),i=e.GetJointList().get_joint();for(i=(e=this.magnet.body).GetJointList().get_joint();0!==n(i);)t.removeJoint(i),i=e.GetJointList().get_joint();this.simulating=!1},"collide-with-fail":function(){this.reset=!0},"collide-with-ground":function(){this.groundContacts++,this.grounded=this.groundContacts>0,this.grounded&&this.owner.body.SetAngularDamping(0),"level-17"==this.owner.parent.levelId&&Math.abs(this.owner.orientation)>2.2&&platypus.game.app.userData.read("played-VO-session",function(t){null===t&&(t=[]);var e="boopWrong";-1==t.indexOf(e)&&(this.owner.parent.triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO-session",t))}.bind(this))},"end-collide-with-ground":function(){this.groundContacts--,this.grounded=this.groundContacts>0,this.grounded||this.owner.body.SetAngularDamping(25)},"collide-with-soil":function(t){this.soilContacts++;var e=t.entity;this.canCollectSoil=!e.collected},"end-collide-with-soil":function(){this.soilContacts--,this.canCollectSoil=this.soilContacts>0},"get-soil":function(){this.canCollectSoil&&(this.canCollectSoil=!1)},"part-hit-ground":function(){"level-12"==this.owner.parent.levelId&&(this.partsHitGround++,7==this.partsHitGround&&this.owner.parent.parent.layers[1].triggerEvent("show-mindy-panel","level12NoBadge"))},"level-12-end":function(){this.partsHitGround<7&&platypus.badger.increment("part-protector")},"prepare-logic":function(){if(this.reset){this.reset=!1;var t=this.owner.parent.parent.layers[0];t.triggerEvent("reset"),(t=this.owner.parent.parent.layers[1]).triggerEvent("reset")}},reset:function(){this.owner.x=this.originX,this.owner.y=this.originY,this.owner.orientation=0},rescue:function(){this.owner.y=this.owner.y-50,this.owner.orientation=0,this.owner.parent.triggerEvent("rescueFX")},"handle-logic":function(){var t=this.owner;if(this.simulating)null!==this.magnet&&(this.magnet.orientation=this.arm.orientation);else if(this.leftWheel.x=t.x-90,this.leftWheel.y=t.y+45,this.leftWheel.z=t.z+.01,this.centerWheel.x=t.x-13,this.centerWheel.y=t.y+45,this.centerWheel.z=t.z+.01,this.rightWheel.x=t.x+90,this.rightWheel.y=t.y+45,this.rightWheel.z=t.z+.01,this.arm.x=t.x+0,this.arm.y=t.y-120,this.arm.z=t.z+.01,this.magnet.x=t.x+60,this.magnet.y=t.y-120,this.magnet.z=t.z+.02,this.head.x=t.x+120,this.head.y=t.y-100,this.head.z=t.z+.01,this.leftWheel.renderGroup!==t.renderGroup)try{this.leftWheel.renderGroup=t.renderGroup,this.centerWheel.renderGroup=t.renderGroup,this.rightWheel.renderGroup=t.renderGroup,this.arm.renderGroup=t.renderGroup,this.magnet.renderGroup=t.renderGroup,this.head.renderGroup=t.renderGroup}catch(t){}},"boop-cw":function(){this.owner.body.ApplyTorque(-15)},"boop-ccw":function(){this.owner.body.ApplyTorque(15)}},methods:{randRange:function(t,e){return Math.random()*(e-t)+t},destroy:function(){i(this.activateJump),this.activateJump=null,this.owner.parent.removeEntity(this.leftWheel),this.leftWheel=null,this.owner.parent.removeEntity(this.centerWheel),this.centerWheel=null,this.owner.parent.removeEntity(this.rightWheel),this.rightWheel=null,this.owner.parent.removeEntity(this.arm),this.arm=null,this.owner.parent.removeEntity(this.head),this.head=null,this.owner.parent.removeEntity(this.magnet),this.magnet=null,this.camera.recycle()},buildBoop:function(){this.leftWheel=this.owner.parent.addEntity({type:"boopSuperWheel",properties:{main:this.owner,name:"left",z:this.owner.z+1,npc:this.npc}}),this.centerWheel=this.owner.parent.addEntity({type:"boopSuperWheelMiddle",properties:{main:this.owner,name:"center",z:this.owner.z+1,npc:this.npc}}),this.rightWheel=this.owner.parent.addEntity({type:"boopSuperWheel",properties:{main:this.owner,name:"right",z:this.owner.z+1,npc:this.npc}}),this.leftWheel.x=this.owner.x-60,this.leftWheel.y=this.owner.y,this.centerWheel.x=this.owner.x-20,this.centerWheel.y=this.owner.y,this.rightWheel.x=this.owner.x+50,this.rightWheel.y=this.owner.y,this.arm=this.owner.parent.addEntity({type:"boopArm",properties:{main:this.owner,z:this.owner.z+1}}),this.arm.x=this.owner.x-125,this.arm.y=this.owner.y-100,this.magnet=this.owner.parent.addEntity({type:"boopHand",properties:{main:this.owner,z:this.owner.z+2}}),this.magnet.x=this.owner.x+40,this.magnet.y=this.owner.y-100,this.head=this.owner.parent.addEntity({type:"boopHead",properties:{main:this.owner,z:this.owner.z+1}}),this.head.x=this.owner.x+90,this.head.y=this.owner.y-90}},publicMethods:{connectWheel:function(t,e){var i=0;switch(e){case"left":i=-3.2;break;case"center":i=-.6;break;case"right":i=3}this.owner.createJoint("revolute",{localAnchorA:{x:i,y:1.5},localAnchorB:{x:0,y:0}},t,1)},connectArm:function(t){this.owner.createJoint("revolute",{localAnchorA:{x:-1.6,y:-4},localAnchorB:{x:-1.5,y:0}},t,1)},connectHead:function(t){this.owner.createJoint("revolute",{localAnchorA:{x:2.5,y:-3.45},localAnchorB:{x:-1.5,y:0}},t,1)},connectHand:function(t){this.arm.createJoint("revolute",{localAnchorA:{x:2,y:0},localAnchorB:{x:0,y:0}},t,1)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.destroy"),i=include("Box2D.getPointer");platypus.createComponentClass({id:"BoopWheel",properties:{main:null,name:"",npc:!1},publicProperties:{grounded:!1},initialize:function(){this.groundContacts=0,this.wheelTouch=0},events:{adopted:function(){this.owner.state.set("wheel",!0)},"simulation-started":function(){var t=this.owner.body,e=null;if(!this.simulating&&t)for(this.simulating=!0,e=t.GetFixtureList();0!==i(e);)e.SetSensor(!1),e=e.GetNext()},"simulation-stopped":function(){var n=this.owner.body,s=null,r=null;if(this.simulating&&n)for(this.simulating=!1,r=new t(0,0),n.SetAngularVelocity(0),n.SetLinearVelocity(r),this.owner.orientation=0,this.owner.rotation=0,this.owner.matchBodyToEntity(),e(r),s=n.GetFixtureList();0!==i(s);)s.SetSensor(!0),s=s.GetNext()},"collide-with-ground":function(){this.groundContacts++,this.grounded=this.groundContacts>0,this.npc&&this.owner.x>3500&&this.owner.x<5950&&(this.wheelTouch++,1===this.wheelTouch&&(this.owner.triggerEvent("boop-touch-other-side"),this.owner.parent.parent.layers[1].triggerEvent("kill-beam")))},"end-collide-with-ground":function(){this.groundContacts--,this.grounded=this.groundContacts>0}}})}(),function(){"use strict";var t={static:0,kinematic:1,dynamic:2},e=include("Box2D.b2Vec2"),i=include("Box2D.b2BodyDef"),n=include("Box2D.b2Filter"),s=include("Box2D.b2FixtureDef"),r=include("Box2D.b2PolygonShape"),o=include("Box2D.b2CircleShape"),a=include("platypus.Data"),h=include("platypus.Async"),l=include("Box2D.helpers.clearUserData"),c=include("Box2D.destroy"),p=include("Box2D.getPointer"),u=include("Box2D.helpers.setUserData"),d=include("decomp.quickDecomp"),g=new s,y={distance:Box2D.b2DistanceJoint,revolute:Box2D.b2RevoluteJoint,prismatic:Box2D.b2PrismaticJoint,pulley:Box2D.b2PulleyJoint,gear:Box2D.b2GearJoint,mouse:Box2D.b2MouseJoint,wheel:Box2D.b2WheelJoint,weld:Box2D.b2WeldJoint,rope:Box2D.b2RopeJoint,friction:Box2D.b2FrictionJoint,motor:Box2D.b2MotorJoint},m={distance:new Box2D.b2DistanceJointDef,revolute:new Box2D.b2RevoluteJointDef,prismatic:new Box2D.b2PrismaticJointDef,pulley:new Box2D.b2PulleyJointDef,gear:new Box2D.b2GearJointDef,mouse:new Box2D.b2MouseJointDef,wheel:new Box2D.b2WheelJointDef,weld:new Box2D.b2WeldJointDef,rope:new Box2D.b2RopeJointDef,friction:new Box2D.b2FrictionJointDef,motor:new Box2D.b2MotorJointDef},f=function(t){return Math.round(16384*t)/16384},w=function(t){for(var i=Array.setUp(),n=t.length,s=null;n--;)(s=new e).Set(t[n][0],t[n][1]),i[n]=s;return i},v=function(t,e,i,n,s){for(var r=function(t,e){for(var i=Array.setUp(),n=t.length;n--;)i[n]=Array.setUp(t[n].x/e,t[n].y/e);return i}(e,n),o=null,a=r.length<=4?[r]:d(r),h=null,l=null,p=a.length,g=0;p--;){if(a[p].length>8){for(o=[],g=a[p].length-6;g<a[p].length;g++)o.push(a[p][g]);a[p].length-=5,a[p].push(o[5]),p+=1,a.splice(p,0,o)}for(l=w(a[p]),t.set_shape(x(l)),h=i.CreateFixture(t),u(h,s),g=l.length;g--;)c(l[g]);l.recycle()}r.recycle(2)},b=function(t){return"string"==typeof t?function(e){this.owner.triggerEvent(t,e)}:t.length?function(e){this.owner.trigger(t,e)}:null},x=function(t){var e,i=new r,n=Box2D._malloc(8*t.length),s=0,o=0;for(o=0;o<t.length;o++)Box2D.HEAPF32[n+s>>2]=t[o].get_x(),Box2D.HEAPF32[n+(s+4)>>2]=t[o].get_y(),s+=8;return e=Box2D.wrapPointer(n,Box2D.b2Vec2),i.Set(e,t.length),i},C=function(t,e){var i=this.owner.parent.addEntity(t,e);this.connectedEntities.push(i)};platypus.createComponentClass({id:"BoxCollision",properties:{bodyDefinition:null,connectingEntities:null,joints:null,resolution:null},publicProperties:{shape:null},initialize:function(e,n){var s=null,r=null,o=this.resolution,a="",l="",c="",p=new i,d=this.bodyDefinition,g=null,y=d.fixtureDefinitions,m=0,f=null,w=null,v=null,x=0,E=[];if(this.owner.body=null,this.world=this.owner.parent.world,this.drawScale=this.owner.parent.drawScale,this.owner.orientation=this.owner.orientation||0,this.connectedEntities=[],o)for(a in o)if(o.hasOwnProperty(a))for(l in"default"===(r=a)&&(r=this.owner.type),o[a])if(o[a].hasOwnProperty(l))if("beginContact"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("begin-contact-"+r+"-and-"+c,b(s[c]));else if("endContact"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("end-contact-"+r+"-and-"+c,b(s[c]));else if("preSolve"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("pre-solve-"+r+"-and-"+c,b(s[c]));else if("postSolve"===l)for(c in s=o[a][l])s.hasOwnProperty(c)&&this.addEventListener("post-solve-"+r+"-and-"+c,b(s[c]));if(d){if(void 0!==d.type&&p.set_type(t[d.type]),void 0!==d.active&&p.set_active(d.active),void 0!==d.allowSleep&&p.set_allowSleep(d.allowSleep),void 0!==d.angle?p.set_angle(d.angle):this.owner.orientation&&p.set_angle(this.owner.orientation),void 0!==d.angularDamping&&p.set_angularDamping(d.angularDamping),void 0!==d.angularVelocity&&p.set_angularVelocity(d.angularVelocity),void 0!==d.awake&&p.set_awake(d.awake),void 0!==d.bullet&&p.set_bullet(d.bullet),void 0!==d.fixedRotation&&p.set_fixedRotation(d.fixedRotation),void 0!==d.inertiaScale&&p.set_inertiaScale(d.inertiaScale),void 0!==d.linearDamping&&p.set_linearDamping(d.linearDamping),void 0!==d.gravityScale&&p.set_gravityScale(d.gravityScale),g=p.get_position(),d.position?(g.set_x((this.owner.x||d.position.x||0)/this.drawScale),g.set_y((this.owner.y||d.position.y||0)/this.drawScale)):(g.set_x((this.owner.x||0)/this.drawScale),g.set_y((this.owner.y||0)/this.drawScale)),this.owner.body=this.world.CreateBody(p),this.matchEntityToBody(),u(this.owner.body,{entity:this.owner}),!this.owner.body)return platypus.debug.warn('Unable to create Box2D Body for "'+this.owner.type+'".'),!1;for(m=0;m<y.length;m++)this.createFixture(y[m],d.defaultFixtureData||{})}else platypus.debug.warn(this.owner.type+": This entity has no defined body.");if(this.connectingEntities)for(x=0;x<this.connectingEntities.length;x++){for(v in w={},(f=this.connectingEntities[x]).properties)f.properties.hasOwnProperty(v)&&(w[v]=f.properties[v]);w.x=this.owner.x,w.y=this.owner.y,w.z=this.owner.z,f.offset&&(w.x+=f.offset.x||0,w.y+=f.offset.y||0,w.z+=f.offset.z||0),w.joinId=f.joinId||"entity-"+x,E.push(C.bind(this,{type:f.type,properties:w}))}return h.setUp(E,function(t){var e=null,i=null;if(this.joints)for(i=0;i<this.joints.length;i++)e=this.joints[i],this.createJoint(e.type,e);this.owner.triggerEvent("box2d-body-initialized",this.owner.body),t()}.bind(this,n)),!0},events:{"before-box2d-update":function(){this.matchBodyToEntity()},"after-box2d-update":function(){this.matchEntityToBody()},"add-collision-listener":function(t){var e=t,i=e.thisType||this.owner.type;"beginContact"===e.when&&this.addEventListener("begin-contact-"+i+"-and-"+e.otherType,b(e.message)),"endContact"===e.when&&this.addEventListener("end-contact-"+i+"-and-"+e.otherType,b(e.message)),"preSolve"===e.when&&this.addEventListener("pre-solve-"+i+"-and-"+e.otherType,b(e.message)),"postSolve"===e.when&&this.addEventListener("post-solve-"+i+"-and-"+e.otherType,b(e.message))}},methods:{destroy:function(){var t=0,e=this.owner,i=this.owner.body,n=i.GetFixtureList();for(this.owner.destroyThePins&&this.owner.destroyThePins(),e.parent.triggerEvent("body-removed",i),l(i);0!==p(n);)l(n),n=n.GetNext();for(e.body=null,this.world=null,t=0;t<this.connectedEntities.length;t++)this.owner.parent.removeEntity(this.connectedEntities[t]);this.connectedEntities.length=0}},publicMethods:{createFixture:function(t,i){var s=g,h=null,l="",c=this.owner,p=null,d=null,y=new n,m=t.shape||this.shape||c;if(m=a.setUp("radius",m.radius,"points",m.points,"halfHeight",m.halfHeight||(m.height||0)/2,"halfWidth",m.halfWidth||(m.width||0)/2,"x",(m===c?0:m.x)||0,"y",(m===c?0:m.y)||0),void 0!==t.density?s.set_density(t.density):void 0!==i.density?s.set_density(i.density):s.set_density(1),void 0!==t.friction?s.set_friction(t.friction):void 0!==i.friction?s.set_friction(i.friction):s.set_friction(.5),void 0!==t.restitution?s.set_restitution(t.restitution):void 0!==i.restitution?s.set_restitution(i.restitution):s.set_restitution(.2),t.filter&&void 0!==t.filter.categoryBits?y.set_categoryBits(t.filter.categoryBits):i.filter&&void 0!==i.filter.categoryBits?y.set_categoryBits(i.filter.categoryBits):y.set_categoryBits(1),t.filter&&void 0!==t.filter.groupIndex?y.set_groupIndex(t.filter.groupIndex):i.filter&&void 0!==i.filter.groupIndex?y.set_groupIndex(i.filter.groupIndex):y.set_groupIndex(0),t.filter&&void 0!==t.filter.maskBits?y.set_maskBits(t.filter.maskBits):i.filter&&void 0!==i.filter.maskBits?y.set_maskBits(i.filter.maskBits):y.set_maskBits(65535),s.set_filter(y),void 0!==t.isSensor?s.set_isSensor(t.isSensor):void 0!==i.isSensor?s.set_isSensor(i.isSensor):s.set_isSensor(!1),d={collisionType:this.owner.type},void 0!==t.userData)for(l in t.userData)t.userData.hasOwnProperty(l)&&(d[l]=t.userData[l]);else if(void 0!==i.userData)for(l in i.userData)i.userData.hasOwnProperty(l)&&(d[l]=i.userData[l]);m.radius?((p=new o).set_m_radius(m.radius/this.drawScale),(m.x||m.y)&&p.get_m_p().Set((m.x||0)/this.drawScale,(m.y||0)/this.drawScale),s.set_shape(p),h=c.body.CreateFixture(s),u(h,d)):m.points?v(s,m.points,c.body,this.drawScale,d):m.halfWidth&&m.halfHeight?((p=new r).SetAsBox(m.halfWidth/this.drawScale,m.halfHeight/this.drawScale,new e((m.x||0)/this.drawScale,(m.y||0)/this.drawScale),0),s.set_shape(p),h=c.body.CreateFixture(s),u(h,d)):platypus.debug.warn(c.type+": Unhandled shape definition.",m),m.recycle()},findConnectedByJoinId:function(t){var e=null,i=0;for(i=0;i<this.connectedEntities.length;i++)if(this.connectedEntities[i].joinId===t){e=this.connectedEntities[i];break}return e},createJoint:function(t,i,n,s){var r=m[t],o=new e(0,0),a=new e(0,0),h=null,l=null,c=null,p="",d=null,g=null;switch(void 0===s&&(s=this.drawScale),n?(h=this.owner,l=n):"string"==typeof i.join?(h=this.owner,l=this.findConnectedByJoinId(i.join)):i.join?(h=i.join.A?this.findConnectedByJoinId(i.join.A):this.owner,l=i.join.B?this.findConnectedByJoinId(i.join.B):this.owner):(h=this.owner,l=this.findConnectedByJoinId("entity-0")),i.anchor?(o.set_x(i.anchor.x),o.set_y(i.anchor.y),r.Initialize(h.body,l.body,o)):(r.set_bodyA(h.body),r.set_bodyB(l.body),i.localAnchorA&&o.Set(i.localAnchorA.x/s,i.localAnchorA.y/s),r.set_localAnchorA(o),i.localAnchorB&&a.Set(i.localAnchorB.x/s,i.localAnchorB.y/s),r.set_localAnchorB(a)),r.set_collideConnected(!!i.collideConnected),t){case"distance":r.set_length(i.length/this.drawScale||1),r.set_dampingRatio(i.dampingRatio||0),r.set_frequencyHz(i.frequencyHz||0);break;case"revolute":r.set_referenceAngle(i.referenceAngle||0),r.set_enableLimit(!!i.enableLimit),r.set_lowerAngle(i.lowerAngle||0),r.set_upperAngle(i.upperAngle||0),r.set_enableMotor(!!i.enableMotor),r.set_maxMotorTorque(i.maxMotorTorque||0),r.set_motorSpeed(i.motorSpeed||0);break;case"prismatic":g=new e(1,0),i.localAxisA&&g.Set(i.localAxisA.x,i.localAxisA.y),r.set_localAxisA(g),r.set_referenceAngle(i.referenceAngle||0),r.set_enableLimit(!!i.enableLimit),r.set_lowerTranslation(i.lowerTranslation/this.drawScale||0),r.set_upperTranslation(i.upperTranslation/this.drawScale||0),r.set_enableMotor(!!i.enableMotor),r.set_maxMotorForce(i.maxMotorForce||0),r.set_motorSpeed(i.motorSpeed||0);break;case"weld":r.set_referenceAngle(i.referenceAngle||0);break;case"pulley":case"gear":case"mouse":case"wheel":case"rope":case"friction":case"motor":default:platypus.debug.warn(t+" joints are not implemented at this point")}if(d={},i.userData)for(p in i.userData)i.userData.hasOwnProperty(p)&&(d[p]=i.userData[p]);return c=this.world.CreateJoint(r),c=Box2D.castObject(c,y[t]),u(c,d),h.triggerEvent("joint-attached",c),l.triggerEvent("joint-attached",c),c},removeJoint:function(t){l(t),this.world.DestroyJoint(t)},matchEntityToBody:function(t,e){var i=this.owner.body,n=t||i.GetPosition(),s=e||i.GetAngle(),r=n.get_x(),o=n.get_y();r===this.lastBodyX&&o===this.lastBodyY&&s===this.lastBodyAngle||(this.lastBodyX=r,this.lastBodyY=o,this.lastBodyAngle=s,this.lastX=this.owner.x=f(r*this.drawScale),this.lastY=this.owner.y=f(o*this.drawScale),this.lastOrientation=this.owner.orientation=f(s),this.owner.rotation=180*s/Math.PI)},matchBodyToEntity:function(){var t=this.owner,i=null,n=0,s=0;return(t.x!==this.lastX||t.y!==this.lastY||t.orientation!==this.lastOrientation)&&(this.lastX=t.x,this.lastY=t.y,this.lastOrientation=t.orientation,this.lastBodyX=n=f(t.x/this.drawScale),this.lastBodyY=s=f(t.y/this.drawScale),this.lastBodyAngle=f(t.orientation),i=new e(n,s),t.body.SetAwake(!0),t.body.SetTransform(i,this.lastBodyAngle),c(i),!0)}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.DragGroup"),n=include("platypus.Vector"),s=function(t,e){return t*t+e*e},r=function(t){var e=null,i=this.camera,n=this.owner.container.parent.transform.worldTransform;i.empty||(this.tempEvents.length||this.increaseTempEvents(),(e=this.tempEvents.pop()).x=t.data.global.x/n.a+i.left,e.y=t.data.global.y/n.d+i.top,e.event=t.data.originalEvent,e.pixiEvent=t,e.entity=this.owner,this.mouseArray.push(function(t){var e=platypus.game.app;1!==this.dragTypeResolved&&(2===this.dragTypeResolved&&(this.dragTypeResolved=1),this.groupMovement&&this.continueInputMovement(t),this.triggeredLAPStartDragStall||0===t.event.movementX&&0===t.event.movementY?this.triggeredLAPStartDragStall&&!this.triggeredLAPStartDrag&&(this.triggeredLAPStartDrag=!0,e.analyticsEmitter.startDrag({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"click-n-stick",this.owner.type,this.neverMovedPreviously?"toolbox":"kitchen")):this.triggeredLAPStartDragStall=!0,this.recycleTempEvent(t))}.bind(this,e)))},o=function(t){var e=null;this.owner.parent.zooming?this.ignoreInput=!0:(this.dragged=!1,this.dragTypeResolved=2,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick&&this.stickyClick(t,this)?(this.ignoreInput=!0,this.stickyClick=null):(e=r.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",e),this.stickyClick=function(t,e,i){return this.owner.container.removeListener("pointermove",t),e&&!this.owner.destroyed?this.endInputMovement(e,!0):this.owner.destroyed&&platypus.debug.warn("BoxDragger: Somehow a sticky-click stayed stuck on a destroyed entity."),i===this}.bind(this,e))):this.startInputMovement(t),this.recycleTempEvent(t))};platypus.createComponentClass({id:"BoxDragger",properties:{useNodes:!1},publicProperties:{untrashable:!1,dragging:!1,movable:!0,inTrash:null,inBuildingArea:!1,neverMovedPreviously:null,overlaps:0,z:0},initialize:function(){Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.firstRun=!0,this.sensorState=!1,this.groupMovement=null,this.locked=!0,this.ignoreInput=!1,this.mouseArray=[],this.tempEvents=[],this.increaseTempEvents(),this.wentOutsideTheScreen=!1,this.time=0,this.triggeredLAPStartDrag=!1,this.triggeredLAPStartDragStall=!1,this.dragTypeResolved=0},events:{adopted:function(){this.owner.state.get("block")&&(this.untrashable=!0),this.untrashable&&(this.inBuildingArea=!0)},"camera-update":function(t){this.camera.set(t.viewport)},"handle-logic":function(){},"handle-render":function(t){var i=this.groupMovement,n=this.owner.parent,s=null;i&&(i.readyToEnd?i.collisionComplete&&(i.endMovement(i.readyToEnd),i.recycle(),this.groupMovement=null):(n.triggerEvent("hover-state",i.state),this.countDown&&(this.countDown-=t.delta,this.countDown<=0&&(s=e.setUp("criteria",this.owner.groupId,"group",i,"invalid",!1),n.triggerEventOnChildren("validate-select-all",s),s.invalid?this.countDown=1/0:(n.triggerEventOnChildren("select-all",i,this.owner.groupId),i.selectAll(),this.countDown=0),s.recycle()))))},"handle-ai":function(){var t=0;for(t=0;t<this.mouseArray.length&&!this.willSoonBeDestroyed;t++)this.mouseArray[t]();1===this.dragTypeResolved&&(this.dragTypeResolved=0),this.mouseArray.length=0},pointerdown:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(o.bind(this,e))},pointermove:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){var e=platypus.game.app;this.ignoreInput||0===t.event.movementX&&0===t.event.movementY||(t.event?(this.dragged=!0,1!==this.dragTypeResolved&&(2===this.dragTypeResolved&&(this.dragTypeResolved=1),this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.groupMovement?this.continueInputMovement(t):platypus.debug.warn('BoxDragger: Received "pointermove" event, but have no group to move. This is bizarre.'),this.triggeredLAPStartDrag||(this.triggeredLAPStartDrag=!0,e.analyticsEmitter.startDrag({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},"press-n-drag",this.owner.type,this.neverMovedPreviously?"toolbox":"build-area")),this.recycleTempEvent(t))):platypus.debug.warn("Mouse event received before entity was created."))}.bind(this,e))},pointerup:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created.")}.bind(this,e))},pointerupoutside:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created.")}.bind(this,e))},pointercancel:function(t){var e=this.copyMouseEvent(t);this.mouseArray.push(function(t){this.groupMovement&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:t.event?(this.endInputMovement(t,!1),this.recycleTempEvent(t)):platypus.debug.warn("Mouse event received before entity was created."))}.bind(this,e))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off"),i.removeComponent(this),e?i.addComponent(new platypus.components.BoxDraggerFrozen(this.owner,{})):i.addComponent(new platypus.components.FindMovables(this.owner,{})),t||i.parent.triggerEvent("child-entity-updated",i)},"before-box2d-update":function(){},"collide-with-building-region":function(){this.untrashable||(this.inBuildingArea=!0)},"collided-with-building-region":function(){this.untrashable||(this.inBuildingArea=!1)},"collide-with-trash":function(t){this.untrashable?this.owner.triggerEvent("begin-drag-overlap"):(this.inTrash||(this.inTrash=Array.setUp()),this.inTrash.push(t.otherFixture))},"collided-with-trash":function(t){var e;this.untrashable?this.owner.triggerEvent("end-drag-overlap"):(e=this.inTrash.indexOf(t.otherFixture))>=0?(this.inTrash.greenSplice(e),0===this.inTrash.length&&(this.inTrash.recycle(),this.inTrash=null)):platypus.debug.warn("Trying to remove a fixture that is not in trash.")},"begin-drag-overlap":function(){this.owner.state.get("block")||(this.overlaps+=1)},"end-drag-overlap":function(){this.owner.state.get("block")||(this.overlaps-=1)},"box2d-step-complete":function(){var t=this.groupMovement;this.vector&&t&&(t.readyToEnd&&(t.collisionComplete=!0),t.checkValidity())},"include-in-group":function(t){t.addEntity(this.owner)},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&this.groupMovement&&t.group!==this.groupMovement&&(t.invalid=!0)},"select-all":function(t,e){this.owner.groupId&&this.owner.groupId===e&&this.owner.triggerEvent("include-in-group",t)},"select-effected":function(t,e){this.owner.groupId&&this.owner.groupId===e&&t.push(this.owner)}},methods:{recycleTempEvent:function(t){t.x=0,t.y=0,t.event=null,t.pixiEvent=null,t.entity=null,this.tempEvents.push(t)},copyMouseEvent:function(t){var e=null;return this.tempEvents.length||this.increaseTempEvents(),(e=this.tempEvents.pop()).x=t.x,e.y=t.y,e.event=t.event,e.pixiEvent=t.pixiEvent,e.entity=t.entity,e},increaseTempEvents:function(){for(var t=5;t;)--t,this.tempEvents.push({x:0,y:0,event:null,pixiEvent:null,entity:null})},startInputMovement:function(t){var n,s=null,r=this.owner,o=e.setUp("invalid",!1);this.time=Date.now(),r.triggerEvent("validate-begin-group-movement",o),n=this.owner.parent.isThisGroupMoving(this.owner.groupId),o.invalid||n?this.ignoreInput=!0:(this.owner.parent.triggerEvent("dragging-a-piece",this.owner),this.groupMovement=s=i.setUp(t),s.addEntity(r),r.triggerEvent("begin-group-movement",s),s.startMovement(t),this.countDown=1250,r.parent.triggerEventOnChildren("select-effected",s.effected,r.groupId),r.parent.triggerEvent("pause-zooming")),o.recycle()},continueInputMovement:function(t){var i,r,o=this.groupMovement,a=null,h=null,l=0,c=null,p=null,u=null,d=Array.setUp(),g=0,y=!1,m=0;if(o){if(this.owner.destroyed)return platypus.debug.warn("BoxDragger: Cannot move a destroyed entity. Bailing!"),o.endMovement(t),o.recycle(),void(this.groupMovement=null);for(i=n.setUp(t.x,t.y),r=o.saOrigin,p=Array.setUp(),g=(u=o.validSnaps).length,void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),o.getSnaps(p,i,this.owner.parent.pins,this.countDown),l=0;l<p.length;l++)if(c=p[l],o.validateMotion(c,p)){if(this.countDown){if(c.x===r.x&&c.y===r.y)break;this.countDown=0,this.owner.triggerEvent("break-away")}if(!u.length&&c.pinTo)for(p[m].pinFrom.beam&&p[m].pinFrom.triggerEvent("pop-round"),m=0;m<p.length-1;m++)p[m].pinFrom.handshake&&(p[m].pinFrom.vertical?p[m].pinFrom.triggerEvent("pop-v"):p[m].pinFrom.triggerEvent("pop-h"));if(g){for(y=!0;g--;)d.push(u[g].pinFrom),u[g].pinFrom.state.set("almost-pinned",!1),u[g].recycle();u.length=0}for(c.pinTo?(c.pinFrom.state.set("almost-pinned",!0),u.push(e.setUp("pinTo",c.pinTo,"pinFrom",c.pinFrom))):y&&(y=!1,o.justUnsnapped=!0),g=l+1;g<p.length;g++)(h=p[g]).pinFrom&&.9>s(c.x-h.x,c.y-h.y)&&(h.pinFrom.state.set("almost-pinned",!0),u.push(e.setUp("pinTo",h.pinTo,"pinFrom",h.pinFrom)));for(a=Array.setUp(),o.getPanelSnaps(a,c),l=a.length,o.justUnsnapped&&l&&(o.justUnsnapped=!1);l--;)!o.allowPops||a[l].pinFrom.state.get("was-panelled")||a[l].pinFrom.state.get("almost-pinned")||-1!==d.indexOf(a[l].pinFrom)||(a[l].pinFrom.beam?a[l].pinFrom.triggerEvent("pop-round"):a[l].pinFrom.kitchen?a[l].pinFrom.triggerEvent("pop-silent"):a[l].pinFrom.triggerEvent("pop")),a[l].pinFrom.state.set("was-panelled",!1),a[l].pinFrom.state.set("almost-pinned",!0),u.push(a[l]);a.recycle(),d.recycle(),o.continueMovement(c,u);break}p.recycle(2)}else platypus.debug.warn("BoxDragger: No group movement for this input. Bailing!")},endInputMovement:function(t,e){var i=platypus.game.app,s=this.groupMovement,r=s.lastValidPosition||t;this.owner.parent.triggerEvent("finished-dragging-a-piece",this.owner),2===s.state?(i.analyticsEmitter.removeAnswer({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:r.x-this.camera.left>>0,y:r.y-this.camera.top>>0},this.owner.type,{board_w:6400,board_h:2560,x:s.saOrigin.x+s.offsets[0].x>>0,y:s.saOrigin.y+s.offsets[0].y>>0},i.getLayout(),e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0),s.endMovement(r),this.groupMovement.recycle(),this.groupMovement=null):(1===s.state&&(this.owner.parent.triggerEvent("rl-play-cannot-place",s),i.analyticsEmitter.endDragOutside({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:t.x-this.camera.left>>0,y:t.y-this.camera.top>>0},e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0,this.owner.type,{kitchen_w:this.camera.width>>0,kitchen_h:this.camera.height>>0,x:this.owner.x-this.camera.left>>0,y:this.owner.y-this.camera.top>>0},this.neverMovedPreviously?"toolbox":"build-area")),this.continueInputMovement(r),r=s.lastValidPosition||t,s.readyToEnd=n.setUp(r.x,r.y),this.neverMovedPreviously&&(window.setTimeout(function(){i.analyticsEmitter.selectAnswer({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:r.x-this.camera.left>>0,y:r.y-this.camera.top>>0},this.owner.type,{build_w:6400,build_h:2560,x:this.owner.x>>0,y:this.owner.y>>0},i.getLayout(),e?"click-n-stick":"press-n-drag",Date.now()-this.time>>0,this.owner.getConnectedEntities?this.owner.getConnectedEntities():[])}.bind(this),1),this.neverMovedPreviously=null)),this.owner.destroyed||(this.owner.parent.triggerEvent("unpause-zooming"),this.owner.parent.triggerEvent("moved-item"),this.triggeredLAPStartDrag=!1,this.triggeredLAPStartDragStall=!1)},destroy:function(){this.camera.recycle()}},publicMethods:{startMovement:function(t){this.vector?this.vector.recycle():this.owner.renderGroup="hover",this.vector=n.setUp(t.x,t.y),this.locked=!1,this.owner.triggerEvent("starting-drag")},continueMovement:function(t){var e=this.owner;this.vector.x=t.x,this.vector.y=t.y,e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endMovement:function(t,e,i){this.vector&&(i||this.continueMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,this.owner.renderGroup="blueprint",this.owner.triggerEvent("motion-ended"),2!==e||i||this.owner.destroyed||(this.willSoonBeDestroyed=!0,this.stickyClick&&this.stickyClick(),this.addEventListener("prepare-logic",function(){this.owner.triggerEvent("throw-away"),this.owner.destroyed||this.owner.parent.removeEntity(this.owner)})))},validateMotion:function(t,e){if(!this.movable)return t.valid=!1,void(t.movable=!1);this.owner.triggerEvent("validate-motion",t),t.valid||e&&t.adjusted&&(t.position=t.adjusted,t.adjusted=null,t.valid=!0,this.validateMotion(t,e-1))}}})}(),function(){"use strict";platypus.createComponentClass({id:"BoxDraggerFrozen",publicProperties:{overlaps:0},initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.triggerEvent("input-on"),t.removeComponent(this),t.addComponent(new platypus.components.BoxDragger(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"begin-drag-overlap":function(){this.overlaps+=1},"end-drag-overlap":function(){this.overlaps-=1}}})}(),function(){"use strict";var t=include("Box2D.b2AABB"),e=include("Box2D.b2Contact"),i=include("Box2D.b2Fixture"),n=include("Box2D.b2Vec2"),s=include("Box2D.b2World"),r=include("Box2D.JSContactListener"),o=include("Box2D.JSQueryCallback"),a=include("springroll.Debug",!1),h=include("Box2D.helpers.getCanvasDebugDraw"),l=include("Box2D.helpers.getUserData"),c=include("Box2D.destroy"),p={collisionType:"none",entity:null},u=include("Box2D.wrapPointer"),d={entity:null,contact:null,thisFixture:null,otherFixture:null,oldManifold:null,impulse:null},g=function(t){var i=platypus.game.app,n=u(t,e),s=n.GetFixtureA(),r=n.GetFixtureB(),o=l(s).collisionType,a=l(r).collisionType,h=l(s.GetBody()).entity,c=l(r.GetBody()).entity;d.contact=n,d.oldManifold=null,d.impulse=null,d.thisFixture=s,d.otherFixture=r,d.entity=c,h.triggerEvent("begin-contact-"+o+"-and-"+a,d),d.thisFixture=r,d.otherFixture=s,d.entity=h,c.triggerEvent("begin-contact-"+a+"-and-"+o,d),i.analyticsEmitter.collision({stage_width:6400,stage_height:2560,x:(h.x+c.x)/2>>0,y:(h.y+c.y)/2>>0},[h.type,c.type])},y=function(t){var i=u(t,e),n=i.GetFixtureA(),s=i.GetFixtureB(),r=(l(n)||p).collisionType,o=(l(s)||p).collisionType,a=(l(n.GetBody())||p).entity,h=(l(s.GetBody())||p).entity;d.contact=i,d.oldManifold=null,d.impulse=null,a&&(d.thisFixture=n,d.otherFixture=s,d.entity=h,a.triggerEvent("end-contact-"+r+"-and-"+o,d)),h&&(d.thisFixture=s,d.otherFixture=n,d.entity=a,h.triggerEvent("end-contact-"+o+"-and-"+r,d))},m=function(t,i){var n=u(t,e),s=n.GetFixtureA(),r=n.GetFixtureB(),o=l(s).collisionType,a=l(r).collisionType,h=l(s.GetBody()).entity,c=l(r.GetBody()).entity;d.contact=n,d.oldManifold=i,d.impulse=null,d.thisFixture=s,d.otherFixture=r,d.entity=c,h.triggerEvent("pre-solve-"+o+"-and-"+a,d),d.thisFixture=r,d.otherFixture=s,d.entity=h,c.triggerEvent("pre-solve-"+a+"-and-"+o,d)},f=function(t,i){var n=u(t,e),s=n.GetFixtureA(),r=n.GetFixtureB(),o=l(s).collisionType,a=l(r).collisionType,h=l(s.GetBody()).entity,c=l(r.GetBody()).entity;d.contact=n,d.oldManifold=null,d.impulse=i,d.thisFixture=s,d.otherFixture=r,d.entity=c,h.triggerEvent("post-solve-"+o+"-and-"+a,d),d.thisFixture=r,d.otherFixture=s,d.entity=h,c.triggerEvent("post-solve-"+a+"-and-"+o,d)};platypus.createComponentClass({id:"BoxHandler",properties:{gravity:null,simulationFrequency:1/60,velocityIterations:10,positionIterations:10,debugFlags:null},publicProperties:{world:null,drawScale:30,logicStepsPerBox2DStep:1},initialize:function(t){var e=this.gravity||{x:0,y:0},i=new r,o=void 0===t.allowSleep||t.allowSleep;this.destroyBodies=[],this.inCollisionLoop=!1,this.paused=!1,this.totalTime=0,this.world=new s(new n(e.x,e.y),o),i.BeginContact=g,i.EndContact=y,i.PreSolve=m,i.PostSolve=f,this.world.SetContactListener(i),(t.debug||!1!==t.debug&&(this.owner.debug||a))&&(this.debugCanvas=document.createElement("canvas"),this.debugCanvas.style.pointerEvents="none",this.debugCanvas.id="box2D-debug-canvas",this.ctx=this.debugCanvas.getContext("2d"),document.body.appendChild(this.debugCanvas),this.debugDraw=h(this.ctx),this.debugDraw.SetFlags(this.debugFlags?this.debugFlags:3),this.world.SetDebugDraw(this.debugDraw))},events:{"body-removed":function(t){this.inCollisionLoop?this.destroyBodies.push(t):this.world.DestroyBody(t)},"check-collision-group":function(t){var e=this.debugCanvas,i=this.destroyBodies,n=0,s=this.owner,r=this.simulationFrequency,o=this.world;if(i.length){for(n=0;n<i.length;n++)o.DestroyBody(i[n]);i.length=0}if(!this.paused)for(this.totalTime+=t.delta/(1e3*r);this.totalTime>0;)this.totalTime-=this.logicStepsPerBox2DStep,s.triggerEvent("before-box2d-update",t,r),s.triggerEventOnChildren("before-box2d-update",t,r),this.inCollisionLoop=!0,o.Step(r,this.velocityIterations,this.positionIterations),this.inCollisionLoop=!1,e&&(this.ctx.clearRect(0,0,e.width,e.height),o.DrawDebugData()),o.ClearForces(),s.triggerEventOnChildren("after-box2d-update",t,r),s.triggerEvent("after-box2d-update",t,r),s.triggerEventOnChildren("box2d-step-complete")},"camera-update":function(t){var e=window.devicePixelRatio||1,i=t.scaleY*this.drawScale/e,n=t.scaleX*this.drawScale/e;this.debugCanvas&&(this.debugCanvas.width===this.debugCanvas.offsetWidth&&this.debugCanvas.height===this.debugCanvas.offsetHeight||(this.debugCanvas.width=this.debugCanvas.offsetWidth,this.debugCanvas.height=this.debugCanvas.offsetHeight),this.ctx.restore(),this.ctx.save(),this.ctx.translate(-t.viewport.left*t.scaleX/e,-t.viewport.top*t.scaleY/e),this.ctx.scale(i,n))},"pause-collision":function(){this.paused=!0},"unpause-collision":function(){this.paused=!1}},methods:{destroy:function(){c(this.world),this.world=null,this.debugCanvas&&this.debugCanvas.parentNode&&this.debugCanvas.parentNode.removeChild(this.debugCanvas),this.debugCanvas=null,this.debugDraw=null,this.ctx=null}},publicMethods:{getEntitiesAtPoint:function(e,s){var r=new t,a=Array.setUp(),h=e/this.drawScale,p=s/this.drawScale,d=new n(h-.01,p-.01),g=new n(h+.01,p+.01),y=new o,m=null;return r.set_lowerBound(d),r.set_upperBound(g),y.ReportFixture=function(t){var e=u(t,i);return e.TestPoint(this.m_point)&&(m=l(e.GetBody()))&&m.entity&&a.push(m.entity),!0},y.m_point=new n(h,p),this.world.QueryAABB(y,r),c(d),c(g),c(r),a}}})}(),function(){"use strict";var t,e,i=include("platypus.AABB"),n=include("Box2D.b2Vec2"),s=include("PIXI.filters.ColorMatrixFilter"),r=include("PIXI.Container"),o=include("PIXI.Graphics"),a=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},h=include("Box2D.destroy");platypus.createComponentClass({id:"BoxStateSaver",properties:{renderDebug:!1,useStressSignals:!0},publicProperties:{buildingArea:null,engine:null,world:null,gravityMultiplier:1,planet:"",levelId:""},initialize:function(){this.busySaving=!1,this.simulationStarted=!1,this.initialCamera=i.setUp(0,0,960,720),this.camera=i.setUp(),this.mask=null,this.level=null,this.stage=null,this.gravityStrength=50,this.gravity=new n(0,this.gravityStrength),this.noGravity=new n(0,0),springroll.Debug&&(window.makeEverythingMovable=this.makeEverythingMovable.bind(this),window.exportLevel=this.exportLevel.bind(this)),this.owner.stickyClick=null},events:{"set-gravity":function(t){this.gravityMultiplier=t},"hover-state":function(t){if(this.stage!==t)switch(this.stage=t,t){case 2:this.updateFilter(1,0,0);break;case 1:this.updateFilter(1,.6,.6);break;default:this.updateFilter(1,1,.4)}},"render-world":(e=function(t,e,i){for(var n=e.length,s=null;n--;)if(e[n].name===t)return e[n];return(s=new r).name=t,e.push(s),i.addChild(s),s},function(t){var i=t.renderGroups,n=t.world,r=e("blueprint",i,n),a=e("hover",i,n);r.z=0,this.mask=function(t,e){var i=new o;return t.mask=i,i.isMask=!0,i.z=1,e.addChild(i),i}(r,n),this.hover=a,a.filters=Array.setUp(new s),this.updateFilter(1,1,.6),a.z=2e3,t.world.reorder=!0}),"world-loaded":function(t){var e=0,i=null,n=platypus.labRetriever,s=this.owner.labUnlocks;if(this.level=t.level,s)for(e=(s=s.split(",")).length;e--;)i=s[e],n.has(i)||platypus.labRetriever.unlock(i)},"start-simulation":function(){this.simulationStarted?platypus.debug.warn("Simulation asked to start, but it is already started."):this.startSimulation()},"stop-simulation":function(){this.simulationStarted?this.stopSimulation():platypus.debug.warn("Simulation asked to stop, but it is not started.")},"camera-update":function(t){this.camera.set(t.viewport),this.updateMask()},"building-area-ready":function(t){this.buildingArea=t},"stop-following-if-simulating":function(){this.followingItem&&(this.followingItem=!1,this.owner.triggerEvent("follow",{mode:"static"}))},"child-entity-removed":function(t){this.simulationStarted||this.owner.triggerEvent("entity-discarded",t.type)},"recycle-everything":function(){for(var t=this.owner,e=(t.parent.app,t.entities.greenSlice()),i=null,n=e.length;n--;)!(i=e[n]).destroyed&&i.savable&&(t.removeEntity(i),1);e.recycle()},"photo-ready":(t=function(t,e,i){var n=0,s=platypus.game.app.config.journal,r={thumbnail:function(t,e,i){var n=0,s=0,r=t.width,o=t.height,a=document.createElement("canvas"),h=a.getContext("2d");a.width=e,a.height=i,r/o>e/i?(n=i*(r/o),s=i):r/o<e/i?(n=e,s=e*(o/r)):(n=e,s=i);try{return h.drawImage(t,0,0,r,o,(e-n)/2,(i-s)/2,n,s),a.toDataURL()}catch(t){return null}}(platypus.game.app.display.renderer.extract.canvas(this.owner.worldContainer),s.thumbnail.width/2,s.thumbnail.height/2),level:this.getSaveState()};for(Array.isArray(i)||(i=[]),n=0;n<i.length&&i[n];n++);if(n>=s.maxSavesPerGame)platypus.debug.olive("Will need to remove a picture to make room!"),platypus.game.loadScene("journal-menu",{insertSave:r});else{i[n]=r;try{t.write(s.storageKey,i,e)}catch(n){r.thumbnail=null,t.write(s.storageKey,i,e)}}},function(){var e=this.owner.parent.app.userData,i=platypus.game.app.config.journal;this.busySaving||(this.busySaving=!0,e.read(i.storageKey,t.bind(this,e,function(){this.busySaving=!1}.bind(this))))})},methods:{startSimulation:function(){var t=this.owner,e=0,i=null,n=this.useStressSignals;for(this.simulationStarted=!0,this.updateMask(),this.gravity.set_y(this.gravityStrength*this.gravityMultiplier),this.world.SetGravity(this.gravity),this.level=this.getSaveState(),this.owner.triggerEvent("pre-simulation-started"),e=t.pins&&t.pins.length;e--;)t.pins[e].getConstraints().length>0&&(i={},t.pins[e].panelled?(i.distance=.9,n=!1):t.pins[e].handshake?(i.distance=.35,n=!1):(i.angle="default",i.reaction="default",i.distance="default",n=this.useStressSignals),this.owner.triggerEvent("add-joint-cluster",t.pins[e].getConstraints(),i,n));this.owner.triggerEvent("simulation-started")},stopSimulation:function(){var t=this.owner.getEntitiesByType("building-region")[0],e=i.setUp(t.x-140,t.y,1,1),n=this.owner;this.simulationStarted=!1,this.updateMask(),this.world.SetGravity(this.noGravity),n.triggerEventOnChildren("restore-save-state"),n.triggerEvent("simulation-stopped"),n.triggerEvent("follow",{mode:"static"}),n.triggerEvent("relocate",e),e.recycle()},updateFilter:function(t,e,i){var n=this.hover.filters[0].matrix;n[0]=t,n[6]=e,n[12]=i},updateMask:function(){var t=i.setUp(this.camera),e=Math.min(t.width/this.initialCamera.width,t.height/this.initialCamera.height);this.simulationStarted||t.setAll(t.x+128*e,t.y,t.width-256*e,t.height),function(t,e){e.clear(),e.beginFill(0,1),e.r(t.left-1,t.top-1,t.width+2,t.height+2),e.endFill()}(t,this.mask),t.recycle()},destroy:function(){h(this.gravity),h(this.noGravity),this.camera.recycle(),this.camera=null,this.initialCamera.recycle(),this.initialCamera=null}},publicMethods:{getSaveState:function(){var t=this.owner,e=Array.setUp(),i=null;return t.triggerEventOnChildren("retrieve-save-state",e,this.editingLevel),i=function(t,e,i){var n=JSON.parse(JSON.stringify(e)),s=null,r=null,o=n.layers,h=o.length,l=0,c=null;for(delete n.assets;h--;)if(o[h].objects){r=o[h].objects;break}for(h=r.length;h--;)s=r[h],a(s.properties,"savable")||i&&a(s.properties,"movable")?r.splice(h,1):l=Math.max(l,s.id+1);for(h=n.tilesets.length;h--;)c=n.tilesets[h],n.tilesets[h]={firstgid:c.firstgid,source:c.source||c.name+".json"};return t.forEach(function(t){t.id=l++,r.push(t)}),n}(e,this.level,this.editingLevel),e.recycle(),i.planet="level-all"===this.levelId?this.planet||"earth":this.levelId.replace("level-",""),i},makeEverythingMovable:function(){for(var t=this.owner.entities,e=t.length,i=null;e--;)!(i=t[e]).hasOwnProperty("movable")||i.neverSave||i.movable||(i.movable=!0)},exportLevel:function(){return this.simulationStarted?"Restart simulation before attempting to export.":(this.editingLevel=!0,JSON.stringify(this.getSaveState()))},getSavedLevel:function(){return this.level}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"ButtonHideShow",properties:{showHides:null},publicProperties:{focusOn:"",focusBackup:"",focusBackup2:"",activeLeft:0,inactiveLeft:0},initialize:function(){this.tweenTime=500},events:{"show-0":function(){this.showHides[0].show.left=this.activeLeft,this.show(this.showHides[0].show)},"hide-0":function(){this.showHides[0].hide.left=this.inactiveLeft,this.hide(this.showHides[0].hide)},"show-1":function(){this.show(this.showHides[1].show)},"hide-1":function(){this.hide(this.showHides[1].hide)},reveal:function(){this.owner.opacity=1},pressed:function(){var t=null;this.focusOn&&(t=window.getEntitiesByType(this.focusOn)[0]||window.getEntitiesByType(this.focusBackup)[0]||window.getEntitiesByType(this.focusBackup2)[0]||null)&&this.owner.triggerEvent("follow-this",{mode:"forward",entity:t,offsetY:-100})}},methods:{show:function(i){var n=null,s={},r=this.owner.trigger,o=null;for(n in i)"disable"!==n&&(s[n]=i[n]);t.removeTweens(this.owner),this.owner.opacity=1,(o=t.get(this.owner).call(r,["enable"])).to(s,this.tweenTime,e.sineOut),o.call(r,["button-shown"])},hide:function(i){var n=null,s={},r=!1;for(n in i)"disable"===n?r=!0:s[n]=i[n];t.removeTweens(this.owner),r&&(this.owner.triggerEvent("disable"),this.owner.triggerEvent("button-hiding")),t.get(this.owner).to(s,this.tweenTime,e.sineOut)}},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",properties:{propertyName1:"property-value"},publicProperties:{propertyName2:"property-value"},initialize:function(){},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e="";platypus.createComponentClass({id:"Controllable",properties:{rotateCW:0,rotateCCW:0,moveRight:0,moveLeft:0,moveUp:0,moveDown:0,jump:0,superJump:0,stop:0,open:0,close:0,magnet:0,light:0,horn:0,rotateArmCW:0,rotateArmCCW:0,flyRight:0,flyLeft:0,flyDown:0,flyUp:0,throttle:0,beam:0,eject:0},publicProperties:{},initialize:function(){this.zeroVec2=new t(0,0),0!==this.moveRight&&(this.rightVec2=new t(this.moveRight,0)),this.rightVec2Air=new t(this.moveRight/3,0),0!==this.moveLeft&&(this.leftVec2=new t(-this.moveLeft,0)),this.leftVec2Air=new t(-this.moveLeft/3,0),0!==this.flyUp&&(this.flyVec2=new t(0,0)),0!==this.jump&&(this.jumpVec2=new t(0,-this.jump)),0!==this.superJump&&(this.superJumpVec2=new t(0,-this.superJump)),this.magnetOn=!1,this.beamOn=!1,this.lightOn=!1,this.facingVal=1},events:{adopted:function(){this.stopAll()},reset:function(){this.owner.body.SetLinearVelocity(this.zeroVec2),this.owner.body.SetAngularVelocity(0),e=""},"simulation-stopped":function(){e=""},"move-right-start":function(){0!==this.moveRight&&(e="move-right",this.facingVal=1)},"move-right-end":function(){0!==this.moveRight&&(e="")},"move-left-start":function(){0!==this.moveLeft&&(e="move-left",this.facingVal=-1)},"move-left-end":function(){0!==this.moveLeft&&(e="")},"move-down-start":function(){0!==this.moveDown&&this.owner.body.SetLinearVelocity(this.downVec2)},"move-down-end":function(){this.moveDown},"move-up-start":function(){0!==this.moveUp&&this.owner.body.SetLinearVelocity(this.upVec2)},"move-up-end":function(){this.moveUp},"fly-right":function(){0!==this.flyRight&&(this.owner.colliding||(this.flyVec2.set_x(this.throttle),this.flyVec2.set_y(0),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-left":function(){0!==this.flyLeft&&(this.owner.colliding||(this.flyVec2.set_x(-this.throttle),this.flyVec2.set_y(0),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-up":function(){0!==this.flyUp&&(this.owner.colliding||(this.flyVec2.set_x(0),this.flyVec2.set_y(-this.throttle),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-down":function(){0!==this.flyDown&&(this.owner.colliding||(this.flyVec2.set_x(0),this.flyVec2.set_y(this.throttle),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"rotate-cw-start":function(){0!==this.rotateCW&&(""===e&&this.owner.parent.triggerEvent("boopMove"),e="rotate-cw")},"rotate-cw-end":function(){0!==this.rotateCW&&(this.owner.parent.triggerEvent("stop-audio","boopMove"),e="")},"rotate-ccw-start":function(){0!==this.rotateCCW&&(""===e&&this.owner.parent.triggerEvent("boopMove"),e="rotate-ccw")},"rotate-ccw-end":function(){0!==this.rotateCCW&&(this.owner.parent.triggerEvent("stop-audio","boopMove"),e="")},"rotate-arm-cw-start":function(){0!==this.rotateArmCW&&(""===e&&this.owner.parent.triggerEvent("armMove"),e="rotate-arm-cw")},"rotate-arm-cw-end":function(){0!==this.rotateArmCW&&(this.owner.parent.triggerEvent("stop-audio","armMove"),e="")},"rotate-arm-ccw-start":function(){0!==this.rotateArmCCW&&(""===e&&this.owner.parent.triggerEvent("armMove"),e="rotate-arm-ccw")},"rotate-arm-ccw-end":function(){0!==this.rotateArmCCW&&(this.owner.parent.triggerEvent("stop-audio","armMove"),e="")},stop:function(){0!==this.stop&&this.stopAll()},"jump-start":function(){0!==this.jump&&this.owner.grounded&&(e="",this.jumpVec2.set_y(.85*-this.jump),this.jumpVec2.set_x(1.6*this.facingVal),this.owner.body.ApplyLinearImpulse(this.jumpVec2,this.owner.body.GetWorldCenter()),this.owner.jumping=!0,this.owner.parent.triggerEvent("jump"))},"super-jump-start":function(){0!==this.superJump&&this.owner.grounded&&(e="",this.superJumpVec2.set_y(.85*-this.superJump),this.superJumpVec2.set_x(9.4*this.facingVal),this.owner.body.ApplyLinearImpulse(this.superJumpVec2,this.owner.body.GetWorldCenter()),this.owner.jumping=!0,this.owner.parent.triggerEvent("superJump"))},"magnet-toggle":function(){0!==this.magnet&&(this.magnetOn=!this.magnetOn,this.magnetOn?this.owner.parent.triggerEvent("magnet-on",this.owner):this.owner.parent.triggerEvent("magnet-off",this.owner))},"beam-toggle":function(){0!==this.beam&&(this.beamOn=!this.beamOn,this.beamOn?this.owner.parent.triggerEvent("beam-on",this.owner):this.owner.parent.triggerEvent("beam-off",this.owner))},"light-toggle":function(){this.lightOn=!this.lightOn,this.lightOn?this.owner.parent.triggerEvent("light-on"):this.owner.parent.triggerEvent("light-off")},"throttle-none":function(){0!==this.throttle&&(this.throttle=1e-7)},"throttle-low":function(){0!==this.throttle&&(this.throttle=7)},"throttle-med":function(){0!==this.throttle&&(this.throttle=12)},"throttle-high":function(){0!==this.throttle&&(this.throttle=18)},eject:function(){0!==this.eject&&this.owner.triggerEvent("eject-item",this.eject)},"handle-logic":function(){switch(this.magnetOn&&this.owner.parent.triggerEvent("magnet-on",this.owner),e){case"rotate-cw":this.owner.body.ApplyTorque(this.rotateCW),this.owner.grounded||this.owner.parent.triggerEvent("boop-cw");break;case"rotate-ccw":this.owner.body.ApplyTorque(-this.rotateCCW),this.owner.grounded||this.owner.parent.triggerEvent("boop-ccw");break;case"rotate-arm-cw":this.owner.body.ApplyTorque(this.rotateArmCW);break;case"rotate-arm-ccw":this.owner.body.ApplyTorque(-this.rotateArmCCW);break;case"move-right":this.owner.grounded?this.owner.body.ApplyForce(this.rightVec2,this.owner.body.GetWorldCenter()):this.owner.body.ApplyForce(this.rightVec2Air,this.owner.body.GetWorldCenter());break;case"move-left":this.owner.grounded?this.owner.body.ApplyForce(this.leftVec2,this.owner.body.GetWorldCenter()):this.owner.body.ApplyForce(this.leftVec2Air,this.owner.body.GetWorldCenter());break;case"fly-left":this.owner.body.ApplyForce(this.leftVec2,this.owner.body.GetWorldCenter())}}},methods:{stopAll:function(){e=""}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e="";platypus.createComponentClass({id:"ControllableJet",properties:{rotateCW:0,rotateCCW:0,moveRight:0,moveLeft:0,moveUp:0,moveDown:0,jump:0,superJump:0,stop:0,open:0,close:0,magnet:0,light:0,horn:0,rotateArmCW:0,rotateArmCCW:0,flyRight:0,flyLeft:0,flyDown:0,flyUp:0,throttle:0,beam:0,eject:0},publicProperties:{},initialize:function(){this.zeroVec2=new t(0,0),0!==this.moveRight&&(this.rightVec2=new t(this.moveRight,0)),this.rightVec2Air=new t(this.moveRight/3,0),0!==this.moveLeft&&(this.leftVec2=new t(-this.moveLeft,0)),this.leftVec2Air=new t(-this.moveLeft/3,0),0!==this.flyUp&&(this.flyVec2=new t(0,0)),0!==this.jump&&(this.jumpVec2=new t(0,-this.jump)),0!==this.superJump&&(this.superJumpVec2=new t(0,-this.superJump)),this.magnetOn=!1,this.beamOn=!1,this.lightOn=!1,this.facingVal=1},events:{adopted:function(){this.stopAll()},reset:function(){this.owner.body.SetLinearVelocity(this.zeroVec2),this.owner.body.SetAngularVelocity(0),e=""},"simulation-stopped":function(){e=""},"move-right-start":function(){0!==this.moveRight&&(e="move-right",this.facingVal=1)},"move-right-end":function(){0!==this.moveRight&&(e="")},"move-left-start":function(){0!==this.moveLeft&&(e="move-left",this.facingVal=-1)},"move-left-end":function(){0!==this.moveLeft&&(e="")},"move-down-start":function(){0!==this.moveDown&&this.owner.body.SetLinearVelocity(this.downVec2)},"move-down-end":function(){this.moveDown},"move-up-start":function(){0!==this.moveUp&&this.owner.body.SetLinearVelocity(this.upVec2)},"move-up-end":function(){this.moveUp},"fly-right":function(){0!==this.flyRight&&(this.owner.colliding||(this.flyVec2.set_x(this.throttle),this.flyVec2.set_y(0),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-left":function(){0!==this.flyLeft&&(this.owner.colliding||(this.flyVec2.set_x(-this.throttle),this.flyVec2.set_y(0),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-up":function(){0!==this.flyUp&&(this.owner.colliding||(this.flyVec2.set_x(0),this.flyVec2.set_y(-this.throttle),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"fly-down":function(){0!==this.flyDown&&(this.owner.colliding||(this.flyVec2.set_x(0),this.flyVec2.set_y(this.throttle),this.owner.body.ApplyLinearImpulse(this.flyVec2,this.owner.body.GetWorldCenter())))},"rotate-cw-start":function(){0!==this.rotateCW&&(""===e&&this.owner.parent.triggerEvent("boopMove"),e="rotate-cw")},"rotate-cw-end":function(){0!==this.rotateCW&&(this.owner.parent.triggerEvent("stop-audio","boopMove"),e="")},"rotate-ccw-start":function(){0!==this.rotateCCW&&(""===e&&this.owner.parent.triggerEvent("boopMove"),e="rotate-ccw")},"rotate-ccw-end":function(){0!==this.rotateCCW&&(this.owner.parent.triggerEvent("stop-audio","boopMove"),e="")},"rotate-arm-cw-start":function(){0!==this.rotateArmCW&&(""===e&&this.owner.parent.triggerEvent("armMove"),e="rotate-arm-cw")},"rotate-arm-cw-end":function(){0!==this.rotateArmCW&&(this.owner.parent.triggerEvent("stop-audio","armMove"),e="")},"rotate-arm-ccw-start":function(){0!==this.rotateArmCCW&&(""===e&&this.owner.parent.triggerEvent("armMove"),e="rotate-arm-ccw")},"rotate-arm-ccw-end":function(){0!==this.rotateArmCCW&&(this.owner.parent.triggerEvent("stop-audio","armMove"),e="")},stop:function(){0!==this.stop&&this.stopAll()},"jump-start":function(){0!==this.jump&&this.owner.grounded&&(e="",this.jumpVec2.set_y(.85*-this.jump),this.jumpVec2.set_x(0),this.owner.body.ApplyLinearImpulse(this.jumpVec2,this.owner.body.GetWorldCenter()),this.owner.jumping=!0,this.owner.parent.triggerEvent("jump"))},"super-jump-start":function(){0!==this.superJump&&this.owner.grounded&&(e="",this.superJumpVec2.set_y(.85*-this.superJump),this.superJumpVec2.set_x(0),this.owner.body.ApplyLinearImpulse(this.superJumpVec2,this.owner.body.GetWorldCenter()),this.owner.jumping=!0,this.owner.parent.triggerEvent("superJump"))},"magnet-toggle":function(){0!==this.magnet&&(this.magnetOn=!this.magnetOn,this.magnetOn?this.owner.parent.triggerEvent("magnet-on",this.owner):this.owner.parent.triggerEvent("magnet-off",this.owner))},"beam-toggle":function(){0!==this.beam&&(this.beamOn=!this.beamOn,this.beamOn?this.owner.parent.triggerEvent("beam-on",this.owner):this.owner.parent.triggerEvent("beam-off",this.owner))},"light-toggle":function(){this.lightOn=!this.lightOn,this.lightOn?this.owner.parent.triggerEvent("light-on"):this.owner.parent.triggerEvent("light-off")},"throttle-none":function(){0!==this.throttle&&(this.throttle=1e-7)},"throttle-low":function(){0!==this.throttle&&(this.throttle=7)},"throttle-med":function(){0!==this.throttle&&(this.throttle=12)},"throttle-high":function(){0!==this.throttle&&(this.throttle=18)},eject:function(){0!==this.eject&&this.owner.triggerEvent("eject-item",this.eject)},"handle-logic":function(){switch(this.magnetOn&&this.owner.parent.triggerEvent("magnet-on",this.owner),e){case"rotate-cw":this.owner.body.ApplyTorque(this.rotateCW),this.owner.grounded||this.owner.parent.triggerEvent("boop-cw");break;case"rotate-ccw":this.owner.body.ApplyTorque(-this.rotateCCW),this.owner.grounded||this.owner.parent.triggerEvent("boop-ccw");break;case"rotate-arm-cw":this.owner.body.ApplyTorque(this.rotateArmCW);break;case"rotate-arm-ccw":this.owner.body.ApplyTorque(-this.rotateArmCCW);break;case"move-right":this.owner.grounded?this.owner.body.ApplyForce(this.rightVec2,this.owner.body.GetWorldCenter()):this.owner.body.ApplyForce(this.rightVec2Air,this.owner.body.GetWorldCenter());break;case"move-left":this.owner.grounded?this.owner.body.ApplyForce(this.leftVec2,this.owner.body.GetWorldCenter()):this.owner.body.ApplyForce(this.leftVec2Air,this.owner.body.GetWorldCenter());break;case"fly-left":this.owner.body.ApplyForce(this.leftVec2,this.owner.body.GetWorldCenter())}}},methods:{stopAll:function(){e=""}},publicMethods:{}})}(),function(){"use strict";var t=!1;platypus.createComponentClass({id:"ControllablePiece",properties:{},publicProperties:{},initialize:function(){this.allBatteries=[],this.myBatteries=[],this.checkIfConnected=!0,this.owner.state.set("connected-to-battery",!1),this.beingDragged=!1,this.playedMessage=!1},events:{"scene-live":function(){this.owner.triggerEvent("piece-added",this.owner.type)},adopted:function(){this.owner.triggerEvent("piece-added",this.owner.type)},"peer-entity-added":function(t){"battery"===t.type&&this.allBatteries.push(t)},"peer-entity-removed":function(t){var e=0;if("battery"===t.type){for(e=0;e<this.allBatteries;e++)if(this.allBatteries[e]===t){this.allBatteries.splice(e,1);break}for(e=0;e<this.myBatteries;e++)if(this.myBatteries[e]===t){this.myBatteries.splice(e,1);break}}},"update-group-id":function(){this.checkIfConnected=!0},"battery-moved":function(){this.checkIfConnected=!0},"starting-drag":function(){this.beingDragged=!0,this.owner.state.set("connected-to-battery",!1)},"motion-ended":function(){this.beingDragged=!1},"handle-logic":function(){var t=0,e=0,i=!1;if(!this.beingDragged&&this.checkIfConnected){for(this.myBatteries.length=0,t=0;t<this.allBatteries.length;t++)if(this.allBatteries[t].groupId===this.owner.groupId){for(e=0;e<this.myBatteries.length;e++)if(this.allBatteries[t].order<this.myBatteries[e].order){this.myBatteries.splice(e,0,this.allBatteries[t]),i=!0;break}i||this.myBatteries.push(this.allBatteries[t]),i=!1}this.myBatteries.length?this.owner.state.set("connected-to-battery",!0):this.owner.state.set("connected-to-battery",!1)}this.checkIfConnected=!1},"simulation-stopped":function(){this.playedMessage=!1,t=!1}},methods:{destroy:function(){this.owner.triggerEvent("piece-removed",this.owner.type),this.allBatteries=null,this.myBatteries=null}},publicMethods:{drainBattery:function(e){var i=0;for(i=0;i<this.myBatteries.length;i++)if(this.myBatteries[i].drain(e))return!0;return this.myBatteries.length>0&&(this.playedMessage||(this.owner.parent.triggerEvent("rl-play-battery-is-dead"),this.playedMessage=!0),t||(t=!0,this.owner.triggerEvent("battery-dead-sfx"))),!1},chargeBattery:function(e){var i=0;for(i=this.myBatteries.length-1;i>=0;i--)if(this.myBatteries[i].charge(e))return t=!1,!0;return!1}}})}(),function(){"use strict";platypus.createComponentClass({id:"ControlPanel",properties:{x:0,y:-1e3,div:50,controls:""},publicProperties:{},initialize:function(){var t,e,i=this.owner,n=0,s=0,r=function(t,e){t.has(e)&&this.owner.triggerEvent("unlock-"+e)}.bind(this,platypus.labRetriever);switch(this.controls){case"jet2":this.width=6,this.height=4,i.triggerEvent("unlock-control-left"),i.triggerEvent("unlock-control-right"),r("control-horn"),r("control-jump"),r("control-super-jump"),r("control-whistle");break;default:this.width=4,this.height=3,i.triggerEvent("unlock-control-rotate-cw"),i.triggerEvent("unlock-control-rotate-ccw"),r("control-rotate-arm-cw"),r("control-rotate-arm-ccw"),r("control-rescue")}for(t=this.width*this.div*2,e=this.height*this.div*2,n=0;n<this.width;n++)for(s=0;s<this.height;s++)this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-cell",animationMap:{default:"default",active:"active"},offsetX:n*this.div*2-t/2+this.div,offsetY:s*this.div*2-e}));this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"topLeft"},offsetX:-t/2,offsetY:-e-this.div})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"topRight"},offsetX:t/2,offsetY:-e-this.div})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"top"},offsetX:0,offsetY:-e-this.div,localScaleX:2*this.width})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"left"},offsetX:-t/2,offsetY:-e/2-this.div,localScaleY:2*this.height})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"right"},offsetX:t/2,offsetY:-e/2-this.div,localScaleY:2*this.height})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"leftBottom"},offsetX:-t/2,offsetY:-this.div})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"rightBottom"},offsetX:t/2,offsetY:-this.div})),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{spriteSheet:"control-panel-border",animationMap:{default:"bottom"},offsetX:0,offsetY:-this.div,localScaleX:2*this.width})),this.owner.width=.75*(t/2+this.div)}})}(),function(){"use strict";platypus.createComponentClass({id:"Conveyor",properties:{},publicProperties:{speed:-5},initialize:function(){var t=this.owner.state,e=t.get("reversed");this.simulationStarted=!1,"boolean"!=typeof e?t.set("reversed",!1):e&&(this.speed=-this.speed)},events:{"handle-logic":function(){var t=this.owner,e=!1,i=t.state;!this.simulationStarted&&t.pointA&&t.pointB&&(e=t.pointB.x-t.pointA.x<0)!==i.get("reversed")&&(i.set("reversed",e),this.speed=-this.speed)},"prepare-for-simulation":function(){this.simulationStarted=!0},"convey-on-collision":function(t){this.simulationStarted&&t.contact.SetTangentSpeed(this.speed)}}})}(),function(){"use strict";var t,e=["liquid","meat-diced","hoagie-loaf-diced","moon-cheese-diced"],i=include("platypus.Data"),n=include("platypus.Entity"),s=include("Box2D.getPointer");platypus.createComponentClass({id:"Cooker",properties:{defaultOut:"",recipeMinIn:1,spawnPoint:null,ejectForce:null,intake:{x:0,y:0},ingredientDelay:2e3,itemDelay:500,zOffset:-1,only:"",absorb:!1,waitForMatch:4e3},publicProperties:{recipes:null},initialize:function(t){var e=0;if(this.touchingIngredients=Array.setUp(),this.spawnQueue=Array.setUp(),this.newTouches=Array.setUp(),this.removeTouches=Array.setUp(),t.spawnPoint?this.spawnPoint=t.spawnPoint:this.spawnPoint={x:0,y:0},this.spawnTimer=this.ingredientDelay,"string"==typeof this.recipes&&(this.recipes=platypus.game.app.config[this.recipes]),this.recipes||(this.recipes=[]),this.only)for(e=this.recipes.length;e--;)if(this.recipes[e].name===this.only){this.recipes=[this.recipes[e]],this.defaultOut="";break}this.recipeMinIn=1e3;var i=0;for(e=0;e<this.recipes.length;e++)(i=this.recipes[e].in.length)<this.recipeMinIn&&(this.recipeMinIn=i);this.defaultOut&&(this.recipes.length||(this.recipeMinIn=1),this.waiting=this.waitForMatch)},events:{"animation-ended":function(t){this.owner.state.get("cooking")?this.owner.triggerEvent("working"):this.owner.triggerEvent("idle")},"start-touch-ingredient":function(t){var e=t.entity,i=this.newTouches;this.owner.simulating&&i.indexOf(e)<0&&i.push(e)},"simulation-stopped":function(){for(var t=this.spawnQueue,e=null,i=t.length,n=0;i--;)for(n=(e=t[i]).length;n--;)e[n].state.recycle(),e[n].recycle();t.length=0,this.owner.state.set("cooking",!1),this.touchingIngredients.length=0,this.newTouches.length=0,this.removeTouches.length=0},"handle-logic":(t={"packet-taco":48,"packet-b":48},function(n){var s=null,r=null,o=null,a=null,h=this.newTouches,l=this.removeTouches.length,c=this.owner.parent,p=this.touchingIngredients,u={x:0,y:0};if(this.owner.simulating){for(u.x=Math.cos(this.owner.orientation)*this.spawnPoint.x-Math.sin(this.owner.orientation)*this.spawnPoint.y,u.y=Math.sin(this.owner.orientation)*this.spawnPoint.x+Math.cos(this.owner.orientation)*this.spawnPoint.y,l=h.length;l--;)s=h.greenSplice(l),this.absorb?(s.body.SetActive(!1),s.absorbIngredient&&s.triggerEvent("shrink-pop",[{scaleX:.5,scaleY:.5,x:this.owner.x+this.intake.x,y:this.owner.y+this.intake.y,time:100},{opacity:0,time:100},{scaleX:1,scaleY:1,opacity:s.opacity||1,time:0},{event:"absorb-ingredient"}],!0)||(s.x=-1e3,s.y=-1e3)):this.startOverlaps(s.body),p.push(i.setUp("entity",this.absorb?null:s,"base",s.base,"type",s.type)),this.owner.triggerEvent("acquired-ingredient",s),this.defaultOut?this.waiting=this.waitForMatch:p.length>=this.recipeMinIn&&this.checkRecipes();this.spawnQueue.length>0?this.spawnTimer<=0?(r=(o=this.spawnQueue[0]).shift(),o.length?this.spawnTimer=this.itemDelay:(o.recycle(),this.spawnQueue.shift(),this.spawnTimer=this.ingredientDelay),a=c.addEntity({type:r.type||r,properties:{active:!1,simulating:!0,savable:!0,movable:!1,modify:r.state,hue:r.hue,x:this.owner.x+u.x,y:this.owner.y+u.y,z:this.owner.z+this.zOffset,orientation:this.owner.orientation}},function(i){var n={x:0,y:0},s={x:0,y:0};s.x=Math.cos(this.owner.orientation)*(this.spawnPoint.x+(t[i.type]||55))-Math.sin(this.owner.orientation)*this.spawnPoint.y,s.y=Math.sin(this.owner.orientation)*(this.spawnPoint.x+(t[i.type]||55))+Math.cos(this.owner.orientation)*this.spawnPoint.y,n.x=Math.cos(this.owner.orientation)*this.ejectForce.x-Math.sin(this.owner.orientation)*this.ejectForce.y,n.y=Math.sin(this.owner.orientation)*this.ejectForce.x+Math.cos(this.owner.orientation)*this.ejectForce.y,e.indexOf(i.type)>=0?i.triggerEvent("shrink-pop",[{opacity:0,time:0},{time:300},{opacity:i.opacity||1,time:0},{event:"eject",message:n}]):"dehydrator"===this.owner.type?i.triggerEvent("shrink-pop",[{bodyScaleX:.1,bodyScaleY:.2,scaleX:.1,scaleY:.2,gravityScale:0,x:0,y:0,offOriginX:0,offOriginY:this.spawnPoint.y,orientation:0,relativeTo:this.owner,time:0},{x:0,y:0,offOriginX:0,offOriginY:this.spawnPoint.y,orientation:0,relativeTo:this.owner,time:600},{bodyScaleX:1,scaleX:1,x:this.spawnPoint.x+(t[i.type]||55),y:this.spawnPoint.y,offOriginX:0,offOriginY:this.spawnPoint.y,orientation:0,relativeTo:this.owner,time:1e3},{x:this.spawnPoint.x+(t[i.type]||55),y:this.spawnPoint.y,offOriginX:this.spawnPoint.x+(t[i.type]||55),offOriginY:this.spawnPoint.y,bodyScaleY:1,scaleY:1,orientation:0,relativeTo:this.owner,time:1e3},{gravityScale:1,time:0},{event:"eject",message:n}]):i.triggerEvent("shrink-pop",[{bodyScale:.5,scaleX:.5,scaleY:.5,opacity:0,time:0},{time:1},{opacity:i.opacity||1,time:0},{event:"eject",message:n},{bodyScale:1,scaleX:1,scaleY:1,time:150}])}.bind(this)),this.owner.state.set("default"),this.owner.triggerEvent("make-recipe",{type:a.type}),this.owner.triggerEvent("eject"),r.recycle()):(this.spawnTimer-=n.delta,this.owner.state.set("cooking",!0)):this.owner.state.set("cooking",!1),this.waiting&&(p.length?(this.waiting-=n.delta,this.waiting<=0&&(p.length>=this.recipeMinIn&&this.checkRecipes(),this.waiting=this.waitForMatch)):this.waiting=this.waitForMatch)}})},methods:{checkRecipes:function(){var t=0,e="",i=null,n=this.touchingIngredients;for(t=0;t<this.recipes.length;t++){var s;e=this.recipes[t].in,i=[];var r=0;for(r=0;r<e.length;r++){s=e[r];var o=0;for(o=0;o<n.length;o++){if(s===n[o].type&&i.indexOf(o)<0){i.push(o);break}if(0===s.indexOf("base:")&&s.substr(5)===n[o].base&&i.indexOf(o)<0){i.push(o);break}}if(i.length<=r)break}if(i.length===e.length){for(i.sort(function(t,e){return t-e}),r=i.length;r--;)i[r]=n.greenSplice(i[r]);this.makeRecipe(this.recipes[t],i)}}n.length&&this.defaultOut&&this.makeRecipe(this.defaultOut,this.touchingIngredients.splice(0,1))},makeRecipe:function(t,e){var n=Array.setUp(),s=0,r=t.out,o=null,a=this.owner;if(r)for(s=r.length;s--;)o="string"==typeof r[s]?i.setUp("type",r[s],"state",i.setUp()):i.setUp("type",r[s].type,"hue",r[s].hue,"state",i.setUp(r[s].state)),n.unshift(o);else Array.isArray(t)&&(t=t[e[0].type.charCodeAt(0)%t.length]),(o=i.setUp("type",t,"state",i.setUp())).state[e[0].type]=!0,e[0].base&&(o.state[e[0].base]=!0),n.push(o);this.owner.triggerEvent("start-recipe",t),n.length?this.spawnQueue.push(n):n.recycle(),platypus.game.app.analyticsEmitter.cooking({stage_width:6400,stage_height:2560,x:a.x>>0,y:a.y>>0},function(t){var e=0,i="",n="";for(e=0;e<t.length;e++)n+=i+t[e].type,i=",";return n}(e),n[0]?n[0].type:"")},destroy:function(){this.recipes=null,this.spawnPoint=null,this.ejectForce=null,this.touchingIngredients=null,this.spawnQueue.recycle(),this.spawnQueue=null,this.newTouches.recycle(),this.newTouches=null,this.removeTouches.recycle(),this.removeTouches=null},startOverlaps:function(t){for(var e=null,i=t.GetFixtureList();0!==s(i);)(e=i.GetFilterData()).set_groupIndex(-12),i.SetFilterData(e),i=i.GetNext()},stopOverlaps:function(t){for(var e=null,i=t.GetFixtureList();0!==s(i);)(e=i.GetFilterData()).set_groupIndex(0),i.SetFilterData(e),i=i.GetNext()}},publicMethods:{},getAssetList:function(t,e,i){var s=Array.setUp(),r=null,o=t.defaultOut||e.defaultOut||i&&i.defaultOut,a=t.recipes||e.recipes||i&&i.recipes,h=a&&a.length||0,l=null,c=0;for("string"==typeof a&&(h=(a=platypus.game.app.config[a])&&a.length||0);h--;)if(l=a[h].out)for(c=l.length;c--;)r=n.getAssetList({type:l[c].type||l[c]}),s.union(r),r.recycle();if(o)if(Array.isArray(o))for(c=o.length;c--;)r=n.getAssetList({type:o[c]}),s.union(r),r.recycle();else r=n.getAssetList({type:o}),s.union(r),r.recycle();return s}})}(),function(){"use strict";var t=include("PIXI.filters.ColorMatrixFilter");platypus.createComponentClass({id:"Desaturator",publicProperties:{enabled:!0},initialize:function(){var e=null,i=this.owner.container;this.colorMatrix=e=new t,i.filters=[e],e.blackAndWhite(),e.enabled=this.enabled,this.wasEnabled=this.enabled},events:{"handle-logic":function(){this.checkDisabled()},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0}},methods:{checkDisabled:function(){this.enabled!==this.wasEnabled&&(this.wasEnabled=this.enabled,this.colorMatrix.enabled=this.enabled)}}})}(),function(){"use strict";var t=include("createjs.Ease"),e=include("createjs.Tween");platypus.createComponentClass({id:"Dust",properties:{},initialize:function(){},events:{adopted:function(){var i=this.owner;e.get(i).to({x:i.x-95,opacity:.01,scaleX:2,scaleY:2},1500,t.sineOut).call(function(){var t=this.owner;t.parent.removeEntity(t)}.bind(this))}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.destroy");platypus.createComponentClass({id:"DustParticleLogic",properties:{lifetime:700,direction:-1},publicProperties:{maxOpacity:1},initialize:function(){this.owner.opacity=this.owner.opacity||0,this.oX=0,this.fadeIn=!1,this.fadeOut=!1,this.fadeSpeed=250,this.inStorm=!0,this.force=new t(.04*this.direction,0),this.maxVelocity=55*this.direction,this.bouncesLeft=10},events:{"handle-logic":function(t){var e=t.delta,i=0;this.inStorm||(this.direction>0?this.owner.body.GetLinearVelocity().get_x()<this.maxVelocity&&this.owner.body.ApplyForce(this.force,this.owner.body.GetWorldCenter()):this.owner.body.GetLinearVelocity().get_x()>this.maxVelocity&&this.owner.body.ApplyForce(this.force,this.owner.body.GetWorldCenter()),this.fadeIn?(this.owner.opacity+=e/this.fadeSpeed,this.owner.opacity>=this.maxOpacity&&(this.owner.opacity=this.maxOpacity,this.fadeIn=!1)):this.fadeOut?(this.owner.opacity-=e/this.fadeSpeed,this.owner.opacity<=0&&(this.owner.opacity=0,this.fade=!1,this.owner.triggerEvent("reset"))):(i=Math.abs(this.owner.x-this.oX),this.lifetime<=i&&(this.fadeOut=!0)))},blow:function(i){var n=new t(i*this.direction,0);this.owner.body.SetLinearVelocity(n),e(n),this.inStorm=!1,this.owner.body.SetActive(!0),this.owner.body.SetAwake(!0),this.fadeIn=!0,this.maxVelocity=i*this.direction,this.oX=this.owner.x},reset:function(){this.fadeOut=!1,this.inStorm=!0,this.owner.x=0,this.owner.y=-1e3,this.owner.opacity=0,this.owner.orientation=0,this.owner.body.SetActive(!1),this.owner.body.SetAwake(!1),this.bouncesLeft=10,this.owner.storm.triggerEvent("return-to-storm",this.owner)},"hit-something":function(){this.bouncesLeft--,this.bouncesLeft<=0&&(this.fadeOut=!0)},"simulation-stopped":function(){this.inStorm||this.owner.triggerEvent("reset")}},methods:{destroy:function(){e(this.force)}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Entity"),e=Math.floor(15);platypus.createComponentClass({id:"DustStormLogic",properties:{direction:1,offsetUnit:-2,stormLength:7e3,introOutroLength:3e3,interval:50,velocity:55},publicProperties:{},initialize:function(){this.started=!1,this.availableParticles=[],this.availableClouds=[],this.cloudInterval=0,this.thingsToHit=Array.setUp(this.owner,this.owner,this.owner,this.owner,this.owner),this.hitDex=0,this.lifetime=0,this.timer=0,this.yOffsets=[.1,-1.4,2.8,-1.5,1,-2.1,2,-1.6,2.6,-.3,1.4,-1.8,.4,-1.3,3,-2.3,.6,-2.2,1.6,-.9,1.9,-2,2.4,-1.8,.5,-.7,1.1,-1.7,1.2,-2.5,2.9,-1.3,1.7,-.8,2.7],this.offsetIndex=0,this.velocityOffsets=[1.1,.6,1,.5,1.2,1.5,.8,1.1,.9,1.3,1,.9,.8,1.2,1,.7,1.4,.8,1.2,1.1,1],this.inFront=!1,this.specialCloudCount=0,this.specialCloudEvery=8,this.specialCloudIndex=0},events:{"peer-entity-added":function(t){t.movable&&this.thingsToHit.push(t)},"peer-entity-removed":function(t){var e=0;t.movable&&(e=this.thingsToHit.indexOf(t))>=0&&this.thingsToHit.greenSplice(e)},"camera-update":function(t){this.owner.x=t.viewport.x,this.owner.y=t.viewport.y,this.owner.height=t.viewport.height},"handle-logic":function(t){var e=null,i=null,n=.5,s=null,r=0,o=0,a=0;this.started&&(this.lifetime+=t.delta,this.lifetime<this.introOutroLength?o=this.lifetime/this.introOutroLength:this.lifetime>2*this.introOutroLength+this.stormLength?this.started=!1:o=this.lifetime>this.introOutroLength+this.stormLength?(2*this.introOutroLength+this.stormLength-this.lifetime)/this.introOutroLength:1,this.availableParticles.length>0&&(this.timer+=t.delta,this.timer>=this.interval/o&&(this.timer=0,a=this.velocity*this.velocityOffsets[this.offsetIndex%this.velocityOffsets.length],this.hitDex+=499,r=(s=this.thingsToHit[this.hitDex%this.thingsToHit.length]).y+this.yOffsets[this.offsetIndex]*this.offsetUnit*(s.height||64)/4,this.cloudInterval+=.75,this.cloudInterval>=1&&this.availableClouds.length>0&&(this.cloudInterval=0,(i=this.availableClouds.pop()).x=s.x+1e3*-this.direction,i.y=r,this.inFront=!this.inFront,n+=1.2*(this.yOffsets.length-this.yOffsets[this.offsetIndex])/this.yOffsets.length,i.scaleX=n,i.scaleY=n,i.maxOpacity=.5+.5*Math.random(),i.triggerEvent("blow",a),i.state.set("cloud-0",!1),i.state.set("cloud-1",!1),i.state.set("cloud-2",!1),i.state.set("cloud-3",!1),i.state.set("cloud-4",!1),i.state.set("cloud-5",!1),this.specialCloudCount++,this.specialCloudCount===this.specialCloudEvery?(this.specialCloudCount=0,i.state.set("cloud-"+this.specialCloudIndex,!0),this.specialCloudIndex++,this.specialCloudIndex>2&&(this.specialCloudIndex=0)):i.state.set("cloud-"+(Math.floor(3*Math.random())+3),!0)),(e=this.availableParticles.pop()).x=s.x+500*-this.direction,e.y=r,e.maxOpacity=.9,e.triggerEvent("mote-"+this.offsetIndex%4),e.triggerEvent("blow",a),this.offsetIndex++,this.offsetIndex>=this.yOffsets.length&&(this.offsetIndex=0))),this.lifetime>2*this.introOutroLength+this.stormLength&&this.stopStorm())},"return-to-storm":function(t){this.started?"dust-particle"===t.type?this.availableParticles.push(t):this.availableClouds.push(t):this.owner.parent.removeEntity(t)},"start-the-wind":function(){var t=0,i=null,n=null,s=null;for(this.started=!0,this.owner.triggerEvent("play-dust-storm"),t=0;t<20;t++)i={type:"dust-particle",properties:{direction:this.direction,x:0,y:-1e3,z:this.owner.z+.01*t,storm:this.owner}},n=this.owner.parent.addEntity(i),this.availableParticles.push(n);for(t=0;t<e;t++)i={type:"dust-cloud",properties:{direction:this.direction,x:0,y:-1e3,z:this.owner.z+110+.01*t,storm:this.owner}},s=this.owner.parent.addEntity(i),this.availableClouds.push(s)},"simulation-stopped":function(){this.stopStorm()},"chose-earth":function(){this.assignCloudsToPlanet("on-earth")},"chose-mars":function(){this.assignCloudsToPlanet("on-mars")}},methods:{assignCloudsToPlanet:function(t){for(var e=this.availableClouds,i=e.length;i--;)e[i].triggerEvent(t)},stopStorm:function(){var t=0;for(this.started=!1,this.owner.triggerEvent("stop-audio"),t=0;t<this.availableClouds.length;t++)this.owner.parent.removeEntity(this.availableClouds[t]);for(this.availableClouds=[],t=0;t<this.availableParticles.length;t++)this.owner.parent.removeEntity(this.availableParticles[t]);this.availableParticles=[],this.cloudInterval=0,this.lifetime=0,this.timer=0,this.offsetIndex=0,this.hitDex=0,this.owner.triggerEvent("wind-has-stopped")}},getAssetList:function(){for(var e=null,i=["dust-cloud","dust-particle"],n=i.length,s=Array.setUp();n--;)e=t.getAssetList({type:i[n]}),s.union(e),e.recycle();return s}})}(),function(){"use strict";var t=include("createjs.Tween");platypus.createComponentClass({id:"FindMovables",properties:{useNodes:!1},initialize:function(){this.activeEntities=null},events:{"handle-logic":function(t){this.activeEntities=t.entities},"validate-select-all":function(t){this.owner.groupId&&this.owner.groupId===t.criteria&&(t.invalid=!0)},pointerdown:function(){for(var e=this.activeEntities,i=e.length,n=null;i--;)(n=e[i]).movable&&("number"!=typeof n.opacity&&(n.opacity=1),t.get(n).to({opacity:.01},250).to({opacity:1},250).to({opacity:.01},250).to({opacity:1},250).to({opacity:.01},250).to({opacity:1},250))},"remove-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-off")},"restore-dragging":function(t,e){var i=this.owner;e&&i.triggerEvent("input-on")}}})}(),function(){"use strict";var t=include("createjs.Ease"),e=include("createjs.Tween");platypus.createComponentClass({id:"Flourish",properties:{range:null,golden:!0,count:1,offsetX:0,offsetY:0,offsetZ:10,spawns:""},publicProperties:{},initialize:function(){},events:{flourish:function(t){var e=0,i=0,n=this.range,s=0,r=t||this.count,o=this.owner.x,a=this.owner.y;if("number"==typeof n)for(e=2*Math.PI/r;r--;)o=this.owner.x+this.range*Math.cos(e*r),a=this.owner.y+this.range*Math.sin(e*r),this.addHere(o,a);else if(n.width&&n.height)for(s=(2*n.width+2*n.height)/r,o-=n.width/2,a-=n.height/2,i=0;r--;)(i=s*r)<=n.width?this.addHere(o+i,a):i<=n.width+n.height?this.addHere(o+n.width,a+i-n.width):i<=2*n.width+n.height?this.addHere(o+n.width-(i-n.width-n.height),a+n.height):this.addHere(o,a+n.height-(i-2*n.width-n.height));else for(;r--;)this.addHere(o,a)}},methods:{addHere:function(i,n){var s=.6*Math.random()+.3,r=this.owner.parent.addEntity({type:this.spawns,properties:{opacity:1,rotation:0,scaleX:2*s,scaleY:2*s,tint:this.golden?16776960+255*Math.random()>>0:null,x:this.offsetX+i,y:this.offsetY+n,z:this.owner.z+this.offsetZ}}),o=i-this.owner.x,a=n-this.owner.y,h=o*o+a*a;e.get(r).to({opacity:0,rotation:(Math.random()<.5?1:-1)*(720+1440*Math.random()),scaleX:s,scaleY:s,x:this.offsetX+i+(o>0?1:-1)*s*150*o*o/h,y:this.offsetY+n+(a>0?1:-1)*s*150*a*a/h},1e3+2e3*Math.random(),t.sineOut).call(function(t){!t.destroyed&&this.owner.parent&&this.owner.parent.removeEntity(t)}.bind(this,r))}}})}(),function(){"use strict";platypus.createComponentClass({id:"GameChanger",properties:{game:"",loadSavedGame:null},initialize:function(){},events:{"load-game":function(){platypus.game.app.container.send("load-game",{game:this.game,loadSavedGame:this.loadSavedGame})}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Entity");platypus.createComponentClass({id:"GameMaster",initialize:function(){this.camera=t.setUp(),this.countDown=!1,this.levelTime=1e4,this.levelFailed=null,this.meteorOffset=0,this.usedToolBox=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"launch-meteor":function(t){var e=null,i={},n={type:t.type||"meteor",properties:{x:this.camera.x+(t.x||0),y:this.camera.y+(t.y||0),z:10080+this.meteorOffset}};e=this.owner.addEntity(n),this.meteorOffset+=.01,i.x=.06*t.impulse.x||0,i.y=.06*t.impulse.y||0,i.rotation=.06*t.rotation||(t.impulse.x>0?.12:-.12),e.triggerEvent("launch",i)},"simulation-stopped":function(){this.levelEnded=!1,this.owner.triggerEvent("rl-stop-disaster-timeline"),this.owner.triggerEvent("rl-reset-timer")}},methods:{destroy:function(){this.camera.recycle()}},getAssetList:function(){for(var t=null,i=["meteor","meteor-big"],n=i.length,s=Array.setUp();n--;)t=e.getAssetList({type:i[n]}),s.union(t),t.recycle();return s}})}(),function(){"use strict";var t=include("PIXI.filters.ColorMatrixFilter");platypus.createComponentClass({id:"Huey",properties:{hue:0},publicProperties:{},initialize:function(){var e=null,i=this.owner.container;this.hue&&(e=new t,i.filters=[e],e.hue(this.hue))},events:{},methods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ImpactAudio",properties:{variations:0,minAudibleSpeed:15,maxAudibleSpeed:50,maxVolume:1},publicProperties:{},initialize:function(){this.soundSpecs={volume:1,pan:0},this.simulating=!1,this.cameraPosition=t.setUp(),this.soundInterval=0,this.interval=85,this.panRange=0},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.25*this.cameraPosition.width,2)},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.simulating=!1},"handle-logic":function(t){var e=t.delta;this.soundInterval>0&&(this.soundInterval=Math.max(0,this.soundInterval-e))},"hit-something":function(t){var e=0,i=Math.floor(Math.random()*this.variations),n=0,s=null,r=null,o=this.cameraPosition,a=0,h=0,l=0;this.simulating&&0===this.soundInterval&&(s=t.contact.GetManifold().get_localNormal(),r=this.owner.body.GetLinearVelocity(),a=Math.pow(this.owner.x-o.x,2)+Math.pow(this.owner.y-o.y,2),h=Math.max(1-a/this.panRange,0),0===s.get_x()&&0===s.get_y()&&(s.set_x(this.owner.x-t.entity.x),s.set_y(this.owner.y-t.entity.y),s.Normalize()),n=(e=Math.abs(s.get_x()*r.get_x()+s.get_y()*r.get_y()))<this.minAudibleSpeed?0:Math.min(e/this.maxAudibleSpeed,1)*this.maxVolume*h,l=this.owner.x>o.right?1:this.owner.x<o.left?-1:(this.owner.x-o.left)/o.width*2-1,this.soundSpecs.volume=n,this.soundSpecs.pan=l,this.owner.triggerEvent("impact-"+i,this.soundSpecs),this.soundInterval=this.interval)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=function(){this.owner.body.IsAwake()||this.fade||(this.fade=!0,this.owner.body.SetActive(!1))},e=function(t){this.owner.state.set("on-something",!0),t.contact.SetRestitution(0),this.fade=!0},i=function(t){t.contact.SetRestitution(.1),this.owner.state.set("on-something",!0)},n=function(t){if(this.fade&&(this.owner.opacity-=t.delta/this.fadeSpeed,this.owner.scaleY=this.originalScaleY*this.owner.opacity,this.owner.opacity<=0))return this.owner.opacity=0,this.fade=!1,void this.owner.parent.removeEntity(this.owner);this.fade||(Math.pow(this.prevX-this.owner.x,2)+Math.pow(this.prevY-this.owner.y,2)>.1?this.stillTimer=500:(this.stillTimer-=t.delta,this.stillTimer<=0&&(this.fade=!0,this.fadeSpeed=100))),this.prevX=this.owner.x,this.prevY=this.owner.y};platypus.createComponentClass({id:"Ingredient",properties:{modify:null},publicProperties:{},initialize:function(){var s=this.modify,r="",o=this.owner.state;for(r in s)s.hasOwnProperty(r)&&o.set(r,s[r]);o.get("liquid")&&(this.fade=!1,this.owner.state.set("on-something",!1),this.prevX=0,this.prevY=0,this.stillTimer=500,this.fadeSpeed=50,this.originalScaleY=this.owner.scaleY,this.owner.opacity=1,this.addEventListener("prepare-logic",n),this.addEventListener("after-box2d-update",t),this.addEventListener("hit-ground",e),this.addEventListener("hit-roof",i)),o.get("weightless")&&(this.owner.body.SetGravityScale(.1),this.owner.opacity=.75),this.absorbMe=!1},events:{"absorb-ingredient":function(){this.absorbMe=!0},"prepare-logic":function(){var t=this.owner;this.absorbMe&&!t.destroyed&&t.parent&&(t.snapShot?(t.x=-1e3,t.y=-1e3,t.body.SetActive(!1),this.absorbMe=!1):t.parent.removeEntity(t))}},methods:{},publicMethods:{absorbIngredient:function(){this.absorbMe=!0}}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("platypus.Entity"),n=e?[{type:"magnifying-glass"},{type:"magnification-dialog"},{type:"magnification-dialog-blind"}]:[{type:"camera-flash"},{type:"magnifying-glass"},{type:"magnification-dialog"},{type:"magnification-dialog-blind"},{type:"badge-notifier"}];platypus.createComponentClass({id:"IOS935",events:{load:function(){for(var t=n.length,e=this.owner;t--;)e.addEntity(n[t])}},getAssetList:function(){for(var t=Array.setUp(),e=null,s=n.length;s--;)e=i.getAssetList(n[s]),t.union(e),e.recycle();return t}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Jet2",properties:{npc:!1},publicProperties:{grounded:!1,facing:"R"},initialize:function(){this.originX=0,this.originY=0,this.reset=!1,this.groundContacts=0,this.activateJump=new t(0,-.03),this.camLock=null,this.owner.normal=0,this.owner.walled=!1,this.body=null,this.head=null,this.arm1=null,this.arm2=null,this.arm1A=45,this.arm2A=45,this.arm1AC=0,this.arm2AC=0,this.suckFX=[],this.suckC=-1,this.facingVal=1,this.mag=!1,this.ejectFX=[],this.ejectC=0,this.noteFX=[],this.noteC=0},events:{adopted:function(){this.npc||(this.camLock=this.owner.parent.addEntity({type:"camLock",properties:{target:this.owner,x:this.owner.x,y:this.owner.y,levelId:this.owner.parent.levelId}}),this.originX=this.owner.x,this.originY=this.owner.y),this.owner.state.set("idle",!0),this.addPart("body",0,-55,1),this.addPart("head",0,-140,2),this.addPart("arm1",0,-100,2),this.addPart("arm2",0,-100,-2)},"magnet-on":function(t){this.mag||this.owner.parent.triggerEvent("vacuumLoop"),this.mag=!0},"magnet-off":function(t){for(var e in this.mag=!1,this.suckFX){var i=this.suckFX[e];this.owner.parent.removeEntity(i)}this.suckFX=[],this.owner.parent.triggerEvent("stop-audio","vacuumLoop")},"simulation-started":function(){this.owner.body.ApplyLinearImpulse(this.activateJump,this.owner.body.GetWorldCenter())},"collide-with-fail":function(){this.reset=!0},"collide-with-hole":function(){},"collide-with-star":function(){},"collide-with-apple":function(e){"level-7"===this.owner.parent.levelId&&Math.abs(e.contact.GetManifold().get_localNormal().get_x())<1&&this.owner.jumping&&(this.owner.body.ApplyLinearImpulse(new t(0,-400)),this.owner.parent.triggerEvent("boing"))},"hit-ground":function(t){this.groundContacts++,this.grounded=this.groundContacts>0,this.grounded&&(this.owner.jumping&&this.owner.parent.triggerEvent("thud"),this.owner.body.SetLinearDamping(5),this.owner.jumping=!1)},"left-ground":function(t){this.groundContacts--,this.grounded=this.groundContacts>0,this.grounded||this.owner.body.SetLinearDamping(0)},"prepare-logic":function(){if(this.reset){this.reset=!1;var t=this.owner.parent.parent.layers[0];t.triggerEvent("reset"),(t=this.owner.parent.parent.layers[1]).triggerEvent("reset")}},reset:function(){this.owner.x=this.originX,this.owner.y=this.originY,this.owner.orientation=0},"light-on":function(){this.head.state.set("light",!0),this.head.state.set("default",!1),this.owner.parent.triggerEvent("click")},"light-off":function(){this.head.state.set("light",!1),this.head.state.set("default",!0),this.owner.parent.triggerEvent("click")},"horn-start":function(){this.owner.parent.triggerEvent("horn",this.owner),this.owner.parent.triggerEvent("honkFX")},"whistle-start":function(){this.owner.parent.triggerEvent("whistle",this.owner),this.noteC=1,this.owner.parent.triggerEvent("whistleFX")},"jump-start":function(){},"eject-item":function(t){this.owner.parent.parent.layers[1].triggerEvent("kill-magnet");var e=this.owner.parent.inventory;if(0!==e.length){var i=e.pop();this.owner.parent.addEntity({type:i,properties:{ejectSpeed:t*this.owner.scaleX*2,x:this.owner.x+150*this.owner.scaleX,y:this.owner.y-100,z:this.owner.z+1}}),this.owner.parent.parent.layers[2].triggerEvent("remove-from-inventory",i);for(var n=0;n<10;n++){var s="R"==this.facing?35-12*n:125+12*n,r=this.randRange(.5,.1),o=this.owner.parent.addEntity({id:"suckFX",components:[{type:"RenderSprite",spriteSheet:"fx",rotate:!0,animationMap:{default:"suck"}}],properties:{x:this.owner.x+35*this.facingVal,y:this.owner.y-(40+2*n),z:this.owner.z,scaleX:.5,rotation:s,opacity:.5,speedX:3*Math.cos(s*(Math.PI/180))*r,speedY:3*Math.sin(s*(Math.PI/180))*r}});this.ejectFX.push(o)}}},"suckable-touch-jet2":function(t){this.owner.parent.parent.layers[1];this.owner.parent.inventory.push(t.type),this.owner.parent.parent.layers[2].triggerEvent("add-to-inventory",t.type),platypus.game.app.userData.read("played-VO",function(t){null===t&&(t=[]);var e="trash-collect";-1==t.indexOf(e)&&(this.owner.parent.parent.layers[1].triggerEvent("show-mindy-panel",e),t.push(e),platypus.game.app.userData.write("played-VO",t))}.bind(this)),"satPartTree"==t.type&&(this.owner.parent.parent.layers[1].triggerEvent("show-mindy-panel","story-1"),this.owner.parent.triggerEvent("scanner"))},"move-right-end":function(){this.owner.state.set("move",!1),this.owner.state.set("idle",!0),this.owner.parent.triggerEvent("stop-audio","jetMove")},"move-left-end":function(){this.owner.state.set("move",!1),this.owner.state.set("idle",!0),this.owner.parent.triggerEvent("stop-audio","jetMove")},"move-right-start":function(){this.owner.scaleX=.4,this.head.scaleX=.35,this.body.scaleX=.35,this.arm1.scaleX=.35,this.arm2.scaleX=.35,this.facing="R",this.facingVal=1,this.owner.state.set("move",!0),this.owner.state.set("idle",!1),this.arm1.rotation="R"==this.facing?this.arm1A:360-this.arm1A,this.arm2.rotation="R"==this.facing?this.arm2A:360-this.arm2A,this.owner.parent.triggerEvent("jetMove")},"move-left-start":function(){this.owner.scaleX=-.4,this.head.scaleX=-.35,this.body.scaleX=-.35,this.arm1.scaleX=-.35,this.arm2.scaleX=-.35,this.facing="L",this.facingVal=-1,this.owner.state.set("move",!0),this.owner.state.set("idle",!1),this.arm1.rotation="R"==this.facing?this.arm1A:360-this.arm1A,this.arm2.rotation="R"==this.facing?this.arm2A:360-this.arm2A,this.owner.parent.triggerEvent("jetMove")},"after-box2d-update":function(){if(this.body.x=this.owner.x,this.body.y+=.5*(this.owner.y-55-this.body.y),this.body.z=this.owner.z+.01,this.head.x=this.owner.x,this.head.y+=.5*(this.body.y-85-this.head.y),this.head.z=this.owner.z+.02,this.arm1.x=this.owner.x,this.arm1.y=this.body.y-15,this.arm1.z=this.owner.z+.02,this.arm2.x=this.owner.x,this.arm2.y=this.body.y-15,this.arm2.z=this.owner.z-.01,this.body.renderGroup!==this.owner.renderGroup)try{this.body.renderGroup=this.owner.renderGroup,this.head.renderGroup=this.owner.renderGroup,this.arm1.renderGroup=this.owner.renderGroup,this.arm2.renderGroup=this.owner.renderGroup}catch(t){}this.arm1A+=(this.owner.y-55-this.body.y+80-this.arm1A)/10,this.arm2A+=(this.owner.y-55-this.body.y+65-this.arm2A)/15,this.arm1.rotation="R"==this.facing?this.arm1A:360-this.arm1A,this.arm2.rotation="R"==this.facing?this.arm2A:360-this.arm2A},"handle-logic":function(){var e,i=this.owner.body.GetLinearVelocity();if(i.get_x()>15&&(i.set_x(15),this.owner.body.SetLinearVelocity(i)),i.get_x()<-15&&(i.set_x(-15),this.owner.body.SetLinearVelocity(i)),this.owner.jumping&&Math.abs(this.owner.body.GetLinearVelocity().get_x())<10&&this.owner.body.ApplyForce(new t(this.owner.scaleX/4,0),this.owner.body.GetWorldCenter()),this.owner.state.get("move")?(this.arm1AC+=.0066,this.arm1A+=.5*Math.cos(this.arm1AC),this.arm2AC+=.0033,this.arm2A+=.4*Math.cos(this.arm2AC)):(this.arm1AC+=.0033,this.arm1A+=.15*Math.cos(this.arm1AC),this.arm2AC+=.0015,this.arm2A+=.1*Math.cos(this.arm2AC)),this.mag){if(this.suckC++,this.suckC%5==0&&this.suckFX.length<10){var n=this.owner.y-this.randRange(0,80),s=this.owner.parent.addEntity({id:"suckFX",components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"suck"}}],properties:{x:this.owner.x+this.randRange(75,150)*this.facingVal,y:n,z:this.owner.z,scaleX:this.randRange(.3,.6),scaleY:.66,opacity:.15,speedX:0,speedY:.01*(this.owner.y-40-n)}});this.suckFX.push(s)}for(e in this.suckFX){var r=this.suckFX[e];r.x-=r.speedX,r.y+=r.speedY,r.speedX+=.05*this.facingVal,r.scaleX-=.001,r.opacity+=.01;("R"==this.facing?r.x<this.owner.x+25:r.x>this.owner.x-25)&&(r.x=this.owner.x+this.randRange(75,150)*this.facingVal,r.scaleX=this.randRange(.3,.6),r.opacity=.1,r.speedX=0,r.y=this.owner.y-this.randRange(0,80),r.speedY=.01*(this.owner.y-40-r.y))}}if(this.noteC>0){if(this.noteC++,this.noteC%12==0&&this.noteC<40){var o=this.owner.parent.addEntity({id:"noteFX",components:[{type:"RenderSprite",spriteSheet:"fx",animationMap:{default:"note"+Math.round(this.randRange(1,3))}}],properties:{x:this.owner.x+50*this.facingVal,y:this.owner.y-120,z:this.owner.z,scaleX:.75,scaleY:.75,opacity:1,speedY:this.randRange(-.25,-.5),speedX:this.randRange(0,.04)*this.facingVal,oscC:0,oscCI:this.randRange(-.01,.01)}});this.noteFX.push(o)}for(e in this.noteFX){var a=this.noteFX[e];a.oscC+=a.oscCI,a.x+=a.speedX+.5*("L"==this.facing?Math.sin(a.oscC):Math.cos(a.oscC)),a.y+=a.speedY,a.opacity-=.002,a.opacity<=0&&this.owner.parent.removeEntity(a)}}var h=!1;if(this.ejectFX.length>0)for(var l in this.ejectC++,h=this.ejectC>200,this.ejectFX){var c=this.ejectFX[l];c.x+=c.speedX,c.y+=c.speedY,c.opacity-=.0015,c.scaleX-=.0012,c.speedX*=.995,c.speedY*=.995}if(h){for(var p in this.ejectFX){var u=this.ejectFX[p];this.owner.parent.removeEntity(u)}this.ejectFX=[],this.ejectC=0}}},methods:{addPart:function(t,e,i,n){return this[t]=this.owner.parent.addEntity({type:"jet2-"+t,properties:{x:this.owner.x+e,y:this.owner.y+i,z:this.owner.z+n}}),this[t]},destroy:function(){this.activateJump=null,this.removePart("camLock"),this.removePart("arm1"),this.removePart("arm2"),this.removePart("body"),this.removePart("head"),this.suckFX=null},removePart:function(t){var e=this[t];e.destroyed||this.owner.parent.removeEntity(e),this[t]=null},randRange:function(t,e){return Math.random()*(e-t)+t}}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.helpers.getUserData"),i=Math.PI/4;platypus.createComponentClass({id:"JointWatcher",properties:{enactStress:!0,stressModifiers:null},publicProperties:{},initialize:function(){this.watchJoints=!1,this.jointClusters=Array.setUp(),this.stressSignals=Array.setUp(),this.stressSignalsToRemove=Array.setUp(),this.firstBreak=!0,this.firstPass=!0,this.usesAnchors=!1,this.stressModifiers?this.modify=this.modifiedStress.bind(this,this.stressModifiers):this.modify=this.unmodifiedStress.bind(this)},events:{"logic-tick":function(){var t=0,e=0;if(this.stressSignalsToRemove.length){for(t=this.stressSignalsToRemove.length-1;t>=0;t--)for(e=this.stressSignals.length-1;e>=0;e--)if(this.stressSignalsToRemove[t]===this.stressSignals[e]){this.owner.removeEntity(this.stressSignals.splice(e,1)[0]);break}this.stressSignalsToRemove.length=0}},"after-box2d-update":function(i,n){var s=0,r=0,o=0,a=null,h=null,l=null,c=null,p=null,u=null,d=[],g=null,y=null,m=null,f=0,w=1,v=0,b=0,x=0,C=null,E=null,S=0,A=0,k=null,P=null;if(this.enactStress&&this.watchJoints){for(s=this.jointClusters.length-1;s>=0;s--){for(a=this.jointClusters[s],h=t.setUp(),r=0;r<a.length;r++)c=(p=a[r]).joint,0===r&&(S=30*(c.GetAnchorA().get_x()+c.GetAnchorB().get_x())/2,A=30*(c.GetAnchorA().get_y()+c.GetAnchorB().get_y())/2,this.stressSignals.length&&(this.stressSignals[s].x=S,this.stressSignals[s].y=A)),h[p.entityA.id]||(h[p.entityA.id]=Array.setUp(0,0,0)),h[p.entityB.id]||(h[p.entityB.id]=Array.setUp(0,0,0)),"number"==typeof p.stressValues.angle&&(E=e(c),!this.firstPass||"piston-beam"!==p.entityA.type&&"piston-beam"!==p.entityB.type||(E.oAngle=c.GetJointAngle()),w=(f=c.GetJointAngle()-E.oAngle)>0?1:-1,"piston-beam"===p.entityA.type||"piston-beam"===p.entityB.type?c.SetMotorSpeed(Math.max(-.08,-10*Math.pow(f,2))*w):c.SetMotorSpeed(-20*w*Math.pow(f,2)),v=Math.min(Math.abs(f)/p.stressValues.angle,1),h[p.entityA.id][2]=Math.max(v,h[p.entityA.id][2]),h[p.entityB.id][2]=Math.max(v,h[p.entityB.id][2])),"number"==typeof p.stressValues.reaction&&(b=p.joint.GetReactionForce(1/n).Length(),b=Math.min(this.modify(b,p.entityA.jointType,p.stressValues.reaction),this.modify(b,p.entityB.jointType,p.stressValues.reaction),1),h[p.entityA.id][0]=Math.max(b,h[p.entityA.id][0]),h[p.entityB.id][0]=Math.max(b,h[p.entityB.id][0])),"number"==typeof p.stressValues.distance&&(x=Math.pow(c.GetAnchorA().get_x()-c.GetAnchorB().get_x(),2)+Math.pow(c.GetAnchorA().get_y()-c.GetAnchorB().get_y(),2),x/=p.stressValues.distance,x=Math.min(1,x),h[p.entityA.id][1]=Math.max(x,h[p.entityA.id][1]),h[p.entityB.id][1]=Math.max(x,h[p.entityB.id][1]));for(u in h)1!==h[u][0]&&1!==h[u][1]&&1!==h[u][2]||(d.push(u),this.firstBreak&&(this.firstBreak=!1,this.owner.triggerEvent("slo-mo"))),this.stressSignals.length&&this.stressSignals[s].triggerEvent("stress",Math.max(Math.max(h[u][2],h[u][0]),h[u][1]));for(l in h)h[l].recycle();for(h.recycle(),r=0;r<d.length;r++)for(g=d[r],o=a.length-1;o>=0;o--)y=a[o].entityA.id,m=a[o].entityB.id,y!==g&&m!==g||(k=a[o].entityA.type,P=a[o].entityB.type,platypus.game.app.analyticsEmitter.machineBroke({stage_w:6400,stage_h:2560,x:a[o].entityA.x>>0,y:a[o].entityA.y>>0},k),"wheel"!==k&&"wheel-powered"!==k&&"wheel-small"!==k&&"rocket"!==k&&"h-rocket"!==k&&"tread"!==k||a[o].entityA.state.set("axeled",!1),"wheel"!==P&&"wheel-powered"!==P&&"wheel-small"!==P&&"rocket"!==P&&"h-rocket"!==P&&"tread"!==P||a[o].entityB.state.set("axeled",!1),this.owner.world.DestroyJoint(a[o].joint),a[o].entityA=null,a[o].entityB=null,a[o].joint=null,a.splice(o,1));d.length&&(this.owner.triggerEvent("joint-broke"),this.owner.triggerEvent("play-break"),C={type:"explosion",properties:{x:S,y:A,z:10110}},this.owner.addEntity(C)),d=[],0===a.length&&(this.jointClusters.splice(s,1),this.stressSignals.length&&this.stressSignalsToRemove.push(this.stressSignals[s]))}this.firstPass=!1}},"simulation-started":function(){this.watchJoints=!0,this.usesAnchors&&this.owner.triggerEvent("uses-anchors")},"simulation-stopped":function(){var t=null,e=this.jointClusters,i=e.length,n=0,s=this.owner,r=this.stressSignals,o=this.stressSignalsToRemove,a=s.world;for(this.usesAnchors=!1;i--;)for(n=(t=e[i]).length;n--;)a.DestroyJoint(t[n].joint);for(i=r.length;i--;)o.push(r[i]);this.owner.triggerEvent("watched-joints-removed"),e.length=0,this.owner.triggerEvent("normal-mo"),this.watchJoints=!1,this.firstBreak=!0,this.firstPass=!0},"add-joint-cluster":function(t,n,s){var r=0,o=[],a=null,h=null,l=null,c=null;for("default"===n.angle&&(n.angle=i),"default"===n.reaction&&(n.reaction=3.5),"default"===n.distance&&(n.distance=.8),r=0;r<t.length;r++)o[r]={},o[r].stressValues=n,o[r].joint=t[r],o[r].entityA=e(t[r].GetBodyA()).entity,o[r].entityB=e(t[r].GetBodyB()).entity,l=o[r].entityA.type,c=o[r].entityB.type,"anchor"!==l&&"anchor"!==c||(this.usesAnchors=!0),"wheel"!==l&&"wheel-powered"!==l&&"wheel-small"!==l&&"rocket"!==l&&"h-rocket"!==l&&"tread"!==l||o[r].entityA.state.set("axeled",!0),"wheel"!==c&&"wheel-powered"!==c&&"wheel-small"!==c&&"rocket"!==c&&"h-rocket"!==c&&"tread"!==c||o[r].entityB.state.set("axeled",!0);o.length&&(this.jointClusters.push(o),s&&(a={type:"stress-signal",properties:{x:0,y:0,z:3020}},h=this.owner.addEntity(a),this.stressSignals.push(h)))}},methods:{destroy:function(){this.jointClusters.recycle(),this.jointClusters=null,this.stressSignals.recycle(),this.stressSignals=null,this.stressSignalsToRemove.recycle(),this.stressSignalsToRemove=null},modifiedStress:function(t,e,i,n){return e/(n*(t[i]||1))},unmodifiedStress:function(t,e,i){return t/i}},publicMethods:{}})}(),function(){"use strict";var t=include("PIXI.filters.OutlineFilter");platypus.createComponentClass({id:"Labeller",properties:{childIndex:0,scale:1,thickness:5},publicProperties:{},initialize:function(){var e=this.owner.container,i=platypus.modifyAllAssets;e.children[this.childIndex].scale.x=this.scale*i,e.children[this.childIndex].scale.y=this.scale*i,e.children[this.childIndex].filters=[new t(this.thickness,16777215)]},events:{},methods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=function(){var t=getEntitiesByType("cockpit")[0]||getEntitiesByType("wheel-powered")[0]||getEntitiesByType("tread")[0]||null;return t?{x:t.x>>0,y:t.y>>0,stage_w:6400,stage_h:2560}:{x:0,y:0,stage_w:0,stage_h:0}};platypus.createComponentClass({id:"LAPActionButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var i=platypus.game.app,n=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;"stopSimulation"===this.lapEvent?i.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0},i.getLayout(),e(),i.getEnlearnStopData()):i.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0},i.getLayout(),e())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPBadgeButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y,s=platypus.badger.getBadgeStatusForLAP();e.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},s)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPDwellTimer",publicProperties:{hover:!0},initialize:function(){this.camera=t.setUp(),this.time=-1,this.x=0,this.y=0,this.xs=0,this.ys=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(t){var e=t.delta;this.time>=0&&(this.time+=e,this.xs+=this.x*e,this.ys+=this.y*e)},pointerover:function(t){this.time=0,this.x=t.x,this.y=t.y,this.ys=0,this.xs=0},pointermove:function(t){this.x=t.x,this.y=t.y},pointerout:function(t){var e=platypus.game.app;t&&t.event&&"mouse"===t.event.pointerType&&this.time>=1e3&&e.analyticsEmitter.dwellTime(this.time>>0,this.owner.type,{stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.xs/this.time-this.camera.left>>0,y:this.ys/this.time-this.camera.top>>0}),this.time=-1}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPHelpButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y,s=e.getLayout();e.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},s)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=function(){var t=getEntitiesByType("cockpit")[0]||getEntitiesByType("wheel-powered")[0]||getEntitiesByType("tread")[0]||null;return t?{x:t.x>>0,y:t.y>>0,stage_w:6400,stage_h:2560}:{x:0,y:0,stage_w:0,stage_h:0}};platypus.createComponentClass({id:"LAPMotorActivate",properties:{activateEvent:"",deactivateEvent:"",direction:"right"},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.startTime=0},events:{"camera-update":function(t){this.camera.set(t.viewport)},activate:function(t){var i=platypus.game.app,n=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y;i.analyticsEmitter[this.activateEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0},this.direction,e()),this.startTime=Date.now()},deactivate:function(t){var i=platypus.game.app,n=t&&"number"==typeof t.x?t.x:this.x,s=t&&"number"==typeof t.y?t.y:this.y,r=Date.now()-this.startTime;i.analyticsEmitter[this.deactivateEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:n-this.camera.left>>0,y:s-this.camera.top>>0},this.direction,e(),r)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPPointerEvent",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPRecycleButton",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},e.getLayout(),e.getEnlearnData())},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSavedGame",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0})},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPScrollButton",properties:{direction:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y,this.coords=null},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=t&&"number"==typeof t.x?t.x:this.x,i=t&&"number"==typeof t.y?t.y:this.y;platypus.game.app.analyticsEmitter.scrollin({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:e-this.camera.left>>0,y:i-this.camera.top>>0},this.direction||t.direction||"indeterminate",this.owner.parent.getVisibleMenuItems(null,!0))},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPSelectMenu",properties:{},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},pointerup:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y,s=this.owner,r=this.owner.type.substring(7);e.analyticsEmitter.changeMenu({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},r,s.parent.getVisibleMenuItems(r))},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPTogglePlanet",properties:{},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},pointerup:function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y,s=this.owner.type.substring(14);e.analyticsEmitter.togglePlanet({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},s)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"LAPWeatherEvent",properties:{lapEvent:""},initialize:function(){this.camera=t.setUp(),this.x=this.owner.x,this.y=this.owner.y},events:{"camera-update":function(t){this.camera.set(t.viewport)},"pointer-event":function(t){var e=platypus.game.app,i=t&&"number"==typeof t.x?t.x:this.x,n=t&&"number"==typeof t.y?t.y:this.y;e.analyticsEmitter[this.lapEvent]({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:i-this.camera.left>>0,y:n-this.camera.top>>0},this.owner.type.substring(6)),this.time=Date.now()},enable:function(){this.time&&(platypus.game.app.analyticsEmitter.weatherDone(Date.now()-this.time>>0,this.owner.type.substring(6)),this.time=null)},"hide-weather-button":function(){this.time&&(platypus.game.app.analyticsEmitter.weatherDone(Date.now()-this.time>>0,this.owner.type.substring(6)),this.time=null)},pointerdown:function(t){this.x=t.x,this.y=t.y},pointermove:function(t){this.x=t.x,this.y=t.y},pointerup:function(t){this.x=t.x,this.y=t.y}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=Date.now().toString(16);platypus.createComponentClass({id:"LevelCompleter",properties:{},publicProperties:{levelId:"",levelProgress:0,next:""},initialize:function(e,i){var n=platypus.game.app;this.alreadyAttempted=!1,this.camera=t.setUp(),this.completedLevels=null,this.owner.parent.app.userData.read("Completed-Levels",function(t){this.completedLevels=t||[],i()}.bind(this)),n.getLayout=function(){return function(t,e){for(var i=null,n=null,s=t.length,r={};s--;)!(i=t[s]).destroyed&&i.miniGame&&(n={name:i.type,position:{x:i.x-e.left>>0,y:i.y-e.top>>0,stage_w:e.width>>0,stage_h:e.height>>0}},r[i.miniGame]||(r[i.miniGame]=[]),r[i.miniGame].push(n));return r}(this.owner.entities,this.camera)}.bind(this),n.getEnlearnStopData=function(){return function(t,e){for(var i=null,n=e.length,s=[],r=[];n--;)(i=e[n]).destroyed||(i.savable?r.push({part_type:i.type,mini_game:i.miniGame||t.name,location:"number"==typeof i.x&&"number"==typeof i.y?{x:i.x,y:i.y}:null}):i.isObstacle&&s.push(i.type));return 0===s.length&&s.push(t.levelId+"-obstacle"),t.getEnlearnData({obstacle_types:s,parts:r})}(platypus.game.app,this.owner.entities.greenSlice())}.bind(this),this.roundTime=Date.now(),this.testTime=0,this.buildTime=0,this.failedAttempts=0,this.badgesEarned=[],this.savedGame=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"scene-loaded":function(t){var e=t.level;this.savedGame="string"!=typeof e},"world-loaded":function(){var t=platypus.game.app;t.levelId=this.levelId||"unspecified",t.levelInstanceId=(this.levelId||"unspecified")+"-"+Date.now().toString(16),t.getEnlearnData=function(i){var n="",s={mini_game_instance_id:e,level_id:t.levelId,level_instance_id:t.levelInstanceId};if(i)for(n in i)i.hasOwnProperty(n)&&(s[n]=i[n]);return s},this.buildTime=Date.now()},"simulation-started":function(){var t=platypus.game.app;this.testTime=Date.now(),t.googleAnalytics.event(t.name,"BuildFinish-"+t.levelId,"BuildTime",this.testTime-this.buildTime>>0)},"simulation-stopped":function(){var t=platypus.game.app;this.buildTime=Date.now(),t.googleAnalytics.event(t.name,"TestFinish-"+t.levelId,"TestTime",this.buildTime-this.testTime>>0)},"begin-level-success-sequence":function(){var t,e=platypus.badger,i=this.levelId,n=this.owner,s=n.parent.app,r=s.userData,o=this.lastSuccess,a=0;if(e.increment("completed-"+s.name+"-"+i),this.alreadySecondSuccessed||e.badges.app[7].completed||(this.lastSuccess=JSON.stringify(this.owner.getSavedLevel()),o&&this.lastSuccess!==o&&(e.increment("second-success"),this.alreadySecondSuccessed=!0)),(t=e.award())&&t.length){for(a=t.length;a--;)this.badgesEarned.push(t[a].name);this.owner.triggerEvent("rl-earned-badge",t)}this.completedLevels.includes(i)||this.completedLevels.push(i),r.write("Completed-Levels",this.completedLevels),r.write("Recently-Completed-Level",i),"level-select"===this.next?n.triggerEvent("rl-set-next-scene","level-select"):(n.triggerEvent("rl-set-next-scene","scene-level"),n.triggerEvent("rl-set-next-scene-data",{level:this.next}))},"round-ended":function(){this.roundEnded(!0)},"round-ended-home":function(){this.roundEnded(!1)}},methods:{roundEnded:function(t){var e=platypus.game.app;Date.now(),this.roundTime;e.analyticsEmitter[t?"endRound":"endRoundHome"](Date.now()-this.roundTime>>0,e.getLayout(),{unlocked_recipes:[],badges_earned:this.badgesEarned},this.failedAttempts)},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("createjs.Ease"),i=include("platypus.Entity"),n=include("createjs.Tween");platypus.createComponentClass({id:"ListItem",properties:{infinite:!1,opacity:1,isNew:!1},publicProperties:{count:1,z:0,spawns:""},initialize:function(e){this.item=this.owner.item||e.item,this.generatedItem=!1,this.dragging=!1,this.readyToDrag=null,this.pointerIsDown=!1,this.show=this.owner.left,this.hide=-this.owner.left,this.motion=t.setUp("x",0,"y",0),this.owner.state.set("infinite",this.infinite),this.owner.state.set("is-new",this.isNew),this.updateCount(this.count)},events:{adopted:function(){var t=platypus.modifyAllAssets;this.isNew?n.get(this.owner.components[12].sprite.scale,{loop:-1}).to({x:1.1*t,y:1.1*t},500,e.sineInOut).to({x:1*t,y:1*t},500,e.sineInOut):t>1&&n.get(this.owner.components[12].sprite.scale).to({x:1.001*t,y:1.001*t},500,e.sineInOut).to({x:1*t,y:1*t},500,e.sineInOut)},"increase-count":function(){this.updateCount(this.count+1)},"decrease-count":function(){this.updateCount(this.count-1)},"item-returned":function(t){t===this.spawns&&this.updateCount(this.count+1)},pointerdown:function(t){this.readyToDrag=!0,this.motion.x=t.x,this.motion.y=t.y,this.pointerIsDown=!0},pointermove:function(t){var e=0,i=0;this.pointerIsDown&&!this.generatedItem&&(this.readyToDrag?(e=Math.abs(this.motion.x-t.x),i=Math.abs(this.motion.y-t.y),this.owner.parent.scrollable?2*e>i&&e>7?this.createEntity(t)||(this.readyToDrag=!1,this.scroll(t)):i>2*e&&i>7&&(this.readyToDrag=!1,this.scroll(t)):this.createEntity(t)):this.scroll(t))},pointerup:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.owner.triggerEvent("end-scroll",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointerupoutside:function(t){this.scrolling?(this.owner.parent.triggerEvent("end-swipe",t),this.owner.triggerEvent("end-scroll",t),this.scrolling=!1):this.generatedItem||this.createEntity(t),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},pointercancel:function(t){this.scrolling&&(this.owner.parent.triggerEvent("end-swipe",t),this.owner.triggerEvent("end-scroll",t),this.scrolling=!1),this.dragging=!1,this.generatedItem=!1,this.pointerIsDown=!1},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{createEntity:function(t){var e=null;return!!this.count&&(this.isNew&&(this.owner.state.set("is-new",!1),platypus.labRetriever.use(this.spawns),this.isNew=!1,this.updateCount(this.count),e=this.owner.components[12].sprite.scale,n.removeTweens(e),e.x=platypus.modifyAllAssets,e.y=platypus.modifyAllAssets),this.generatedItem=!0,this.owner.triggerEvent("generate-item",t),this.owner.triggerEvent("decrease-count"),this.dragging=!0,!0)},scroll:function(t){this.owner.parent.triggerEvent("swipe",t),this.scrolling=!0},updateCount:function(t){var e="";this.infinite||this.isNew||(t>0?(e+=t,this.owner.opacity=1):0===t&&(e="0",this.owner.opacity=.2),this.count=t,this.owner.triggerEvent("set-text",e))}},getAssetList:function(t,e,n){var s=t.spawns||e.spawns||n&&n.spawns;return s?i.getAssetList({type:s}):Array.setUp()}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Vector");platypus.createComponentClass({id:"Magnifier",properties:{offsetX:56,offsetY:-61},publicProperties:{dragging:!1},initialize:function(){this.details=platypus.game.app.config["magnify-list"],Object.defineProperty(this,"stickyClick",{set:function(t){this.stickyClick=t}.bind(this.owner.parent),get:function(){return this.stickyClick}.bind(this.owner.parent)}),this.camera=t.setUp(),this.vector=null,this.state=this.owner.state,this.sensorState=!1,this.groupMovement=null,this.locked=!1,this.ignoreInput=!1,this.top=this.owner.top,this.left=this.owner.left,this.detail=null,this.detailEntity=null,this.wentOutsideTheScreen=!1},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-render":function(){var t=null,e=this.camera,n=null,s=null,r=this.owner,o=r.parent,a=null,h=r.parent.parent.layers,l=r.state,c=this.vector,p=null,u=null,d=null,g=h.length,y=0,m=0;if(l.get("focus")&&l.set("focus",!1),c&&l.get("dragging")){for(this.detail=null,c=i.setUp(c.x+this.offsetX,c.y+this.offsetY),y=0;y<g;y++)if((a=h[y])!==o&&(p=a.windowToWorld(o.worldToWindow(c)),m=(t=a.getEntitiesAtPoint?a.getEntitiesAtPoint(p.x,p.y):this.getEntitiesAtPoint(a,p.x,p.y)).length)){for(;m--;)s=t[m],(n=this.details[s.spawns||s.type])&&(l.set("focus",!0),this.detail=n,u=a.windowToWorld(o.worldToWindow(i.setUp(e.left,e.top))),d=a.windowToWorld(o.worldToWindow(i.setUp(e.width,e.height))),this.detailEntity={stage_w:d.x>>0,stage_h:d.y>>0,x:s.x-u.x>>0,y:s.y-u.y>>0},this.time=Date.now(),u.recycle(),d.recycle());if(n)break}c.recycle()}},pointerdown:function(t){var i=null;this.owner.parent.zooming||this.locked?this.ignoreInput=!0:(this.dragged=!1,"mouse"===t.pixiEvent.data.pointerType?this.stickyClick?(this.ignoreInput=!0,this.stickyClick(t),this.stickyClick=null):(i=function(t){var i=this.camera,n=this.owner.container.parent.transform.worldTransform,s=e.setUp("event",t.data.originalEvent,"pixiEvent",t,"x",t.data.global.x/n.a+i.left,"y",t.data.global.y/n.d+i.top,"entity",this.owner);this.continueInputMovement(s),s.recycle()}.bind(this),this.startInputMovement(t),this.ignoreInput||(this.owner.container.addListener("pointermove",i),this.stickyClick=function(t,e){this.owner.container.removeListener("pointermove",t),e&&this.endInputMovement(e)}.bind(this,i))):this.startInputMovement(t))},pointermove:function(t){this.ignoreInput||this.vector.x===t.x&&this.vector.y===t.y||(this.dragged=!0,this.stickyClick&&(this.stickyClick(),this.stickyClick=null),this.continueInputMovement(t))},pointerup:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointerupoutside:function(t){this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t)},pointercancel:function(t){this.vector&&(this.ignoreInput||this.stickyClick?this.ignoreInput=!1:this.endInputMovement(t))},"unlock-magnifying-glass":function(){var t=this.owner;t.top=this.top,t.left=this.left,this.locked=!1,t.state.set("dragging",!1),this.dragging=!1},hide:function(){var t=platypus.game.app;this.detail&&(t.analyticsEmitter.closeMagnificationDialog({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,!t.voPlayer.playing,Date.now()-this.time>>0,t.getEnlearnData()),this.detail=null,this.detailEntity=null),this.time=0},"ui-simulation-started":function(){this.owner.left=this.left=20},"ui-simulation-stopped":function(){this.owner.left=this.left=276}},methods:{getEntitiesAtPoint:function(e,i,n){for(var s=t.setUp(),r=Array.setUp(),o=e.entities,a=null,h=o.length;h--;)a=o[h],s.setAll(a.x||0,a.y||0,a.width||0,a.height||0),s.containsPoint(i,n)&&r.push(a);return s.recycle(),r},startInputMovement:function(t){var e=this.owner;this.vector&&this.vector.recycle(),this.vector=i.setUp(t.x,t.y),e.parent.triggerEvent("pause-zooming"),this.dragging=!0},continueInputMovement:function(t){var e=this.owner,i=e.state;this.dragging&&!i.get("dragging")&&(i.set("dragging",!0),e.triggerEvent("magnifying"),this.owner.top=null,this.owner.left=null),void 0===this.camera.x||void 0===this.camera.y||this.camera.containsVector(t)||this.wentOutsideTheScreen||(this.wentOutsideTheScreen=!0,this.detail=null,this.endInputMovement(t),this.ignoreInput=!0,this.wentOutsideTheScreen=!1),this.vector&&(this.vector.x=t.x,this.vector.y=t.y),e.x=t.x,e.y=t.y,e.triggerEvent("dragged",t)},endInputMovement:function(t){var e=platypus.game.app,i=this.owner,n=this.detail,s="";this.continueInputMovement(t),this.vector.recycle(),this.vector=null,this.locked=!0,i.parent.triggerEvent("unpause-zooming"),n?(e.analyticsEmitter.magnifyAnEntity({stage_width:this.camera.width>>0,stage_height:this.camera.height>>0,x:this.owner.x+this.offsetX-this.camera.left>>0,y:this.owner.y+this.offsetY-this.camera.top>>0},this.detail.id,this.detailEntity),i.triggerEvent("send-title",n.title),i.triggerEvent("set-photo",n.id),i.triggerEvent("show-magnification"),platypus.game.app.voPlayer.play(n["vo-id"]||"mag-"+n.id),"cracker-a"!==(s=n.id)&&"cracker-b"!==s&&"cracker-c"!==s&&"cracker-d"!==s||(s="cracker"),platypus.badger.increment("inspected-"+s),this.time=Date.now()):i.triggerEvent("early-reset-magnification")},destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"MagnifierPhotoSetter",initialize:function(){this.photos=platypus.game.app.config["magnify-list"]},events:{"set-photo-id":function(t){var e=this.photos[t],i=platypus.modifyAllAssets;this.scale||(this.scale=function(t){for(var e=t.length;e--;)if(1===t[e].offsetZ)return t[e].sprite.scale}(this.owner.components)),e&&(this.owner.triggerEvent(e.image),e.credit&&(this.scale.x=i,this.scale.y=i,e["image-title"]?"*"+e["image-title"]+"* by ":"This photo is by ",e.credit+" at "+e.link),e.scale?(this.scale.x=+e.scale*i,this.scale.y=+e.scale*i):(this.scale.x=i,this.scale.y=i))}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"MeteorLogic",properties:{},publicProperties:{},initialize:function(){this.impulseVector=null,this.rotation=0,this.hit=!1,this.soundSpecs={volume:1}},events:{launch:function(e){this.impulseVector=new t(e.x,e.y),this.rotation=e.rotation},"after-box2d-update":function(){this.impulseVector&&(this.owner.body.ApplyLinearImpulse(this.impulseVector,this.owner.body.GetWorldCenter(),!0),this.owner.body.ApplyAngularImpulse(this.rotation),this.impulseVector=null)},"hit-something":function(){var t=0,e=Math.floor(3*Math.random());this.hit||(this.hit=!0,this.owner.body.SetGravityScale(1)),(t=this.owner.body.GetLinearVelocity().Length())<15&&(t=0),t=Math.min(t/100,.5),this.soundSpecs.volume=t,this.owner.triggerEvent("play-meteor-hit-"+e,this.soundSpecs)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"MoonQuakeLogic",properties:{},publicProperties:{},initialize:function(){this.amplitude=7.5,this.frequency=1,this.cycles=10,this.distance=0,this.shaking=!1,this.position=0,this.velocity=new t(0,0),this.oX=this.owner.x,this.oY=this.owner.y,this.update={x:0,y:0}},events:{"handle-logic":function(t){var e=t.delta,i=0;this.shaking&&(this.position+=.03*e,this.position>=this.distance?(this.velocity.Set(0,0),this.shaking=!1):(i=this.position<this.distance/2?this.position/(this.distance/2)*this.amplitude:(2-this.position/(this.distance/2))*this.amplitude,this.velocity.Set(i*Math.cos(this.frequency*this.position),0)),this.owner.body.SetLinearVelocity(this.velocity))},"simulation-started":function(){this.oX=this.owner.x,this.oY=this.owner.y},"handle-render":function(){this.update.x=this.owner.x-this.oX,this.update.y=this.owner.y-this.oY,this.owner.triggerEvent("rl-quake-update",this.update)},quake:function(t){this.amplitude=t.amplitude||7.5,this.frequency=t.frequency||1,this.cycles=t.cycles||10,this.distance=(this.cycles+.25)*Math.PI*2,this.shaking=!0,this.position=0,this.owner.triggerEvent("play-earthquake")},"simulation-stopped":function(){this.owner.x=this.oX,this.owner.y=this.oY,this.distance=0,this.position=0,this.velocity.Set(0,0),this.owner.body.SetLinearVelocity(this.velocity),this.owner.triggerEvent("stop-audio")}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"MoonQuakeShake",properties:{},publicProperties:{},initialize:function(){this.oX=this.owner.x,this.oY=this.owner.y},events:{"quake-update":function(t){this.owner.x=this.oX+t.x,this.owner.y=this.oY+t.y}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Motor",properties:{accel:40,damping:.8,isTread:!1,batteryDrain:.0013},publicProperties:{},initialize:function(){this.simulationStarted=this.isTread||!1,this.torque=0,this.direction=0,this.wheelSounding=!1,this.wheelAudioLevel=0,this.owner.state.set("powered",!1),"moon"===this.owner.parent.planet?this.accel=62:"mars"===this.owner.parent.planet||"europa"===this.owner.parent.planet&&(this.accel=40),this.isTread?this.connector=this.owner.tread:this.connector=this.owner,this.cameraPosition=t.setUp(),this.panRange=0},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.15*this.cameraPosition.width,2)},load:function(){this.torque=this.owner.body.GetMass()*this.accel*(this.owner.radius/30)},"simulation-started":function(){this.simulationStarted=!0},"simulation-stopped":function(){this.simulationStarted=!1},"motor-cw-start":function(){this.connector.state.get("connected-to-battery")&&(this.direction=1,this.owner.body.SetAngularDamping(this.damping))},"motor-cw-stop":function(){this.connector.state.get("connected-to-battery")&&1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"motor-ccw-start":function(){this.connector.state.get("connected-to-battery")&&(this.direction=-1,this.owner.body.SetAngularDamping(this.damping))},"motor-ccw-stop":function(){this.connector.state.get("connected-to-battery")&&-1===this.direction&&(this.owner.body.SetAngularDamping(0),this.direction=0)},"handle-logic":function(t){var e=0;this.isTread||(this.wheelSounding&&this.wheelAudioLevel<=1?(e=this.figureOutPan(),0===this.wheelAudioLevel&&this.owner.triggerEvent("wheel-running"),this.wheelAudioLevel=Math.min(1,this.wheelAudioLevel+t.delta/500),this.owner.triggerEvent("set-volume",.25*this.wheelAudioLevel*e,"motor-running")):!this.wheelSounding&&this.wheelAudioLevel>0&&(e=this.figureOutPan(),this.wheelAudioLevel=Math.max(0,this.wheelAudioLevel-t.delta/200),this.owner.triggerEvent("set-volume",.25*this.wheelAudioLevel*e,"motor-running"),0===this.wheelAudioLevel&&this.owner.triggerEvent("stop-audio","motor-running")))},"before-box2d-update":function(){this.isTread||this.owner.triggerEvent("move-wheels")},"move-wheels":function(){this.simulationStarted?this.direction&&this.connector.state.get("connected-to-battery")?this.isTread?(this.owner.myJoint.EnableLimit(!1),this.owner.body.SetAwake(!0),this.owner.body.ApplyTorque(this.direction*this.torque)):this.connector.drainBattery(this.batteryDrain)?(this.owner.body.SetAwake(!0),this.owner.body.ApplyTorque(this.direction*this.torque),this.wheelSounding||(this.wheelSounding=!0)):this.wheelSounding&&(this.wheelSounding=!1):this.wheelSounding&&(this.wheelSounding=!1):this.wheelSounding=!1},"stop-wheels":function(){var t=0;this.isTread&&(this.owner.body.SetAngularVelocity(0),t=this.owner.myJoint.GetJointAngle(),this.owner.myJoint.SetLimits(t,t),this.owner.myJoint.EnableLimit(!0))},"apply-special-friction":function(t){this.simulationStarted&&"ice"===t.entity.type&&t.contact.SetFriction(.8)}},methods:{figureOutPan:function(){var t,e,i=this.cameraPosition,n=0;return t=Math.pow(this.owner.x-i.x,2)+Math.pow(this.owner.y-i.y,2),e=Math.max(1-t/this.panRange,0),n=this.owner.x>i.right?1:this.owner.x<i.left?-1:(this.owner.x-i.left)/i.width*2-1,this.owner.triggerEvent("set-pan",n,"motor-running"),e}},publicMethods:{}})}(),function(){"use strict";var t;platypus.createComponentClass({id:"Mouth",properties:{animationMap:null},initialize:(t=function(t){this.spine&&this.spine.skeleton.setAttachment("Mouth",t)},function(){var e="",i=this.animationMap;for(e in this.spine=null,i)i.hasOwnProperty(e)&&this.addEventListener(e,t.bind(this,i[e]))}),events:{load:function(){for(var t=this.owner.components,e=t.length;e--;)if(t[e].spine){this.spine=t[e].spine;break}}}})}(),function(){"use strict";var t=include("platypus.Data"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),n=new(include("Box2D.b2Vec2"))(0,0),s=-6e3;platypus.createComponentClass({id:"Pin",properties:{},publicProperties:{handshake:0,vertical:!1,weld:!1,tread:!1,beam:!1,kitchen:!1},initialize:function(){this.constraints=Array.setUp(),this.temporaryConstraints=Array.setUp(),this.entities=Array.setUp(),this.defaultZ=this.handshake?3015:this.owner.z,this.pinnedZ=this.defaultZ-.1,this.owner.parent.addPin(this.owner),this.hiding=!1,this.handshake&&this.owner.state.set("block",!0),this.vertical&&this.owner.state.set("vertical",!0),(this.weld||this.tread)&&(this.owner.scaleX=.6,this.owner.scaleY=.6),this.beam&&this.owner.state.set("beam",!0),this.kitchen&&this.owner.state.set("kitchen",!0)},events:{adopted:function(){this.owner.parent.triggerEvent("pin-on-panel",this.owner)},"snap-to-pin":function(t){for(var e=this.entities,i=e.length,n=null;i--;)n=e[i],this.detach(n),t.attach(n,!1,!0);this.owner.parent.removeEntity(this.owner)},"validate-motion":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("validate-constraint",t)},dragged:function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("pin-moved",t);this.destroyTemporaryJoints()},"resolve-bodies":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-bodies")},"resolve-joints":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("resolve-joints")},"resolve-snaps":function(e){for(var i=this.entities,n=null,s=null,r=this.temporaryConstraints,o=e.length,a=0,h=0;o--;)if((n=e[o]).pinFrom===this.owner&&!n.panel)for(a=(s=n.pinTo.getPinnedEntities()).length;a--;)for(h=i.length;h--;)r.push(t.setUp("pinned",s[a],"entity",i[h]))},"motion-ended":function(){var t=this.entities,e=t.length;for(this.destroyTemporaryJoints();e--;)t[e].triggerEvent("pin-motion-ended",this.owner)},"update-group-id":function(t){var e=this.entities,i=e.length;if(!t||t!==this.owner.groupId){for(t?this.owner.groupId=t:(this.owner.groupId=--s,t=this.owner.groupId);i--;)e[i].groupId!==t&&e[i].triggerEvent("update-group-id",t);this.owner.panelled&&this.owner.panelled.triggerEvent("update-group-id",t)}},"pre-simulation-started":function(){this.owner.panelled&&this.attach(this.owner.panelled)},"prepare-for-simulation":function(){var t=0,e=null;for(t=0;t<this.constraints.length;t++)e=this.constraints[t],this.owner.handshake||this.owner.panelled||(e.EnableMotor(!0),e.SetMaxMotorTorque(.5),i(e).oAngle=e.GetJointAngle());this.owner.parent.removeEntity(this.owner)},"throw-away":function(){for(var t=this.entities,e=t.length;e--;)t[e].triggerEvent("lost-pin",this.owner)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.entities,i=e.length;i--;)e[i].triggerEvent("begin-pin-group-movement",t)},"before-box2d-update":function(){for(var t=null,e=this.temporaryConstraints,i=e.length;i--;)(t=e[i]).joint=this.createJoint(t.pinned,t.entity,!0)},"after-box2d-update":function(){for(var t=this.owner,e=null,i=this.temporaryConstraints,n=i.length;n--;)e=i[n],t.removeJoint(e.joint),e.joint=null},"can-you-pin-to-this-panel":function(t){var i=null,s=[0,-2,2],r=0;if(!this.owner.handshake&&-1===this.owner.getPinnedEntities().indexOf(t.panel))for(i=t.panel.body.GetFixtureList();0!==e(i);){for(r=0;r<s.length;r++)if(n.Set((this.owner.x+s[r])/30,(this.owner.y+s[r])/30),i.TestPoint(n))return t.pin=this.owner,this.owner.panelled=t.panel,this.owner.state&&(this.owner.state.get("panelled")||this.owner.state.set("panelled",!0)),void t.panel.velcroed.push(this.owner);i=i.GetNext()}}},methods:{createJoint:function(t,e,i){var n=this.owner,s=n.x/30,r=n.y/30;return this.handshake?t.createJoint("weld",{anchor:{x:s,y:r},collideConnected:i||!1},e,1):this.weld?t.createJoint("weld",{anchor:{x:s,y:r}},e,1):this.tread?t.createJoint("revolute",{anchor:{x:s,y:r},lowerAngle:-Math.PI/6,upperAngle:Math.PI/6,enableLimit:!0},e,1):t.createJoint("revolute",{anchor:{x:s,y:r}},e,1)},destroyTemporaryJoints:function(){for(var t=this.temporaryConstraints,e=t.length;e--;)t[e].recycle();t.length=0},updateRendering:function(){var t=this.entities.length>1;this.owner.state.set("pinned",t),this.owner.z=t?this.pinnedZ:this.defaultZ},destroy:function(){var t=this.owner.parent;t.removePin&&t.removePin(this.owner),this.constraints.recycle(),this.constraints=null,this.entities.recycle(),this.entities=null},detachPinAndJoint:function(t){var e=t.body,i=this.owner,n=this.constraints,s=null,r=this.entities,o=r.indexOf(t),a=0;if(o>=0){for(a=n.length;a--;)if(e===(s=n[a]).GetBodyA()||e===s.GetBodyB()){n.greenSplice(a);try{i.removeJoint(s)}catch(t){platypus.debug.warn("Joint removal caused an error.",t)}}if(this.handshake&&(this.handshake-=1e3,0===o&&(this.handshake*=-1)),r.greenSplice(o),this.owner.immobile&&!t.movable)for(o=r.length,this.owner.immobile=!1;o--;)if(!r[o].movable){this.owner.immobile=!0;break}t.triggerEvent("pin-removed",i)}else platypus.debug.warn("Attempting to detach an unattached entity. This is incorrect; please fix.")}},publicMethods:{getConstraints:function(){return this.constraints},attach:function(t,e,i){var n=this.constraints,s=this.entities,r=s.length;for(i&&this.handshake&&(this.handshake+=1e3);r--;)n.push(this.createJoint(t,s[r]));s.push(t),t.movable||(this.owner.immobile=!0),e||t.triggerEvent("pin-added",this.owner),this.owner.loadingComponents?t.groupId&&!this.owner.groupId&&(this.owner.groupId=t.groupId):this.owner.groupId?t.triggerEvent("update-group-id",this.owner.groupId):this.owner.triggerEvent("update-group-id"),this.updateRendering()},canSnapTo:function(t,e){var i=this.entities,n=i.length,s=!0,r=t.pinTo.getPinnedEntities(),o=r.length;if(t.pinFrom.handshake+t.pinTo.handshake!==0||!t.pinFrom.handshake&&t.pinTo.handshake||t.pinFrom.handshake&&!t.pinTo.handshake||!t.pinFrom.beam&&t.pinTo.beam||t.pinFrom.beam&&!t.pinTo.beam||!t.pinFrom.beam&&!t.pinFrom.handshake||!t.pinTo.beam&&!t.pinTo.handshake)return!1;if(t.pinFrom.inDragGroup&&t.pinTo.inDragGroup)return!1;for(;n--;)for(o=r.length;o--;)if(i[n]===r[o])return!1;for(n=i.length;n--;)if(i[n].triggerEvent("valid-snap",t,e),!t.snappable){s=!1;break}return s},isConstrained:function(){return!!this.entities.length},hasJoint:function(t){for(var i=this.constraints,n=i.length;n--;)if(e(i[n])===e(t))return!0;return!1},detach:function(t){this.detachPinAndJoint(t)&&(this.owner.triggerEvent("update-group-id"),this.updateRendering())},getPinnedEntities:function(){return this.entities},resetJoints:function(){for(var t=this.owner,e=this.constraints,i=e.length,n=this.entities,s=0;i--;)t.removeJoint(e[i]);for(e.length=0,i=n.length;i--;)for(s=i;s--;)e.push(this.createJoint(n[i],n[s]))},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake?9999999:0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1,beam:t.beam||!1,kitchen:t.kitchen||!1}})},split:function(t){var e=this.owner.parent,i=this.entities,n=i.length,s=null,r=null;if(1===n)return null;for(this.owner.immobile&&t.movable&&(this.owner.immobile=!1),r=this.createPin(this.owner,e);n--;)i[n]!==t&&(s=i[n],this.detachPinAndJoint(s),r.attach(s,!1),this.handshake&&(r.handshake=-this.handshake,r.state.set("block",!0)));return this.owner.triggerEvent("update-group-id"),this.updateRendering(),r},detachPermanently:function(t){this.detach(t),this.entities.length?this.updateRendering():this.owner.parent.removeEntity(this.owner)}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinManager",initialize:function(){this.pins=this.owner.pins=Array.setUp()},events:{},methods:{destroy:function(){this.pins.recycle(),this.pins=this.owner.pins=null}},publicMethods:{addPin:function(t){this.pins.push(t),this.owner.pinsImmovable&&(t.triggerEvent("input-off"),t.interactive=!1)},removePin:function(t){var e=this.pins,i=e.indexOf(t);i>=0&&e.greenSplice(i)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("Box2D.getPointer"),i=new t(0,0),n=function(t){var n=t.pin||t,s=this.owner.velcroed.indexOf(n),r=null,o=[0,-2,2],a=0;if(-1===n.getPinnedEntities().indexOf(this.owner)){for(r=this.owner.body.GetFixtureList();0!==e(r);){for(a=0;a<o.length;a++)if(i.Set((t.x+o[a])/30,(t.y+o[a])/30),r.TestPoint(i))return t.panelled=this.owner,t.state&&t.state.set("panelled",!0),void(-1===s&&this.owner.velcroed.push(n));r=r.GetNext()}-1!==s&&this.owner.velcroed.splice(s,1)}};platypus.createComponentClass({id:"Pinnable",properties:{pinLocations:null,validate:!0},publicProperties:{z:0,velcro:!1,velcroed:null},initialize:function(){this.owner.parent.pins;var t=this.pinLocations,e=0,i=t&&t.length||0;for(this.onlyRemovingComponentSoDontDropThePins=!1,this.pins=Array.setUp(),e=0;e<i;e++)this.addPin(t[e]);this.velcroed=[],this.velcro&&this.addEventListener("pin-on-panel",n)},events:{"peer-entity-added":function(t){"pin"!==t.type||t.handshake||this.owner.triggerEvent("pin-on-panel",t)},"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.PinnableFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.validate&&t.valid&&this.tryAdjustment(t.entity,t)},"update-group-id":function(t){var e=this.pins,i=e.length,n=this.velcroed.length;for(this.owner.groupId=t;i--;)t!==e[i].groupId&&e[i].triggerEvent("update-group-id",t);for(;n--;)t!==this.velcroed[n].groupId&&this.velcroed[n].triggerEvent("update-group-id",t)},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){this.pins.push(t)},"resolve-bodies":function(){var t=this.owner;t.body&&t.matchBodyToEntity()},"pin-removed":function(t){for(var e=this.pins,i=e.length;i--;)if(t===e[i])return void e.greenSplice(i)},"begin-pin-group-movement":function(t){var e=this.pins,i=e.length;for(this.owner.triggerEvent("include-in-group",t);i--;)e[i].triggerEvent("include-in-group",t)},"validate-begin-group-movement":function(t){!t.invalid&&this.owner.inDragGroup&&(t.invalid=!0)},"begin-group-movement":function(t){for(var e=this.pins,i=e.length,n=!1;i--;)e[i].triggerEvent("include-in-group",t),e[i].immobile&&(n=!0);if(this.owner.movable&&n)for(i=e.length;i--;)e[i].split(this.owner);else this.prepareForBreakage=!0},"break-away":function(){var t=this.pins,e=t.length;if(this.prepareForBreakage)for(this.prepareForBreakage=!1;e--;)t[e].split(this.owner)},"include-in-group":function(){this.prepareForBreakage=!1},"remove-pinnable-component":function(){this.owner.removeComponent(this),this.owner.parent.triggerEvent("child-entity-updated",this.owner)}},methods:{addPin:function(t){var e=this.owner,i=this.createOrFindPin({x:e.x+t.x,y:e.y+t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1,beam:t.beam||!1,kitchen:t.kitchen||!1},e.parent);return this.pins.push(i),i.getPinnedEntities().length?i.attach(e,!0,!0):i.attach(e,!0),i},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins),n=this.pins.indexOf(i);return i&&n<0?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1,beam:t.beam||!1,kitchen:t.kitchen||!1}})},findPin:function(t,e){var i,n,s=platypus.game.app.config.pins.mergeDistance,r=0,o=null,a=e&&e.length,h=s*s,l=null;if(a)for(;a--;)o=e[a],i=o.x-t.x,n=o.y-t.y,(r=i*i+n*n)<h&&o.handshake+t.handshake===0&&(h=r,l=o);return l},tryAdjustment:function(t,e){var i=this.pins,n=i.length;if(!this.alreadyTryingAdjustment){for(this.alreadyTryingAdjustment=!0;n--;)t!==i[n]&&i[n].triggerEvent("validate-constraint",e);this.alreadyTryingAdjustment=!1}}},publicMethods:{destroyThePins:function(){var t=this.pins,e=t.length;if(!this.onlyRemovingComponentSoDontDropThePins)try{for(;e--;)t[e].detachPermanently(this.owner)}catch(t){}t.recycle()},getConnectedEntities:function(){for(var t=[],e=null,i=this.pins,n=i.length,s=0;n--;)for(s=(e=i[n].getPinnedEntities()).length;s--;)e[s]!==this.owner&&t.indexOf(e[s].id)<0&&t.push(e[s].id);return t}}})}(),function(){"use strict";platypus.createComponentClass({id:"PinnableFrozen",initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.removeComponent(this),t.addComponent(new platypus.components.Pinnable(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)}}})}(),function(){"use strict";var t=include("platypus.Entity");platypus.createComponentClass({id:"PistonConvertor",properties:{},publicProperties:{},initialize:function(){},events:{"pre-simulation-started":function(){var t,e,i,n,s=null,r=null,o=0,a=0,h=0,l=0,c=this.owner.parent;this.owner.pointA?(o=this.owner.pointA.x,a=this.owner.pointA.y,h=this.owner.pointB.x,l=this.owner.pointB.y):"v-piston-beam"===this.owner.type?(o=this.owner.x,a=this.owner.y-64,h=this.owner.x,l=this.owner.y+64):"h-piston-beam"===this.owner.type?(o=this.owner.x-64,a=this.owner.y,h=this.owner.x+64,l=this.owner.y):"d1-piston-beam"===this.owner.type?(o=this.owner.x-64,a=this.owner.y-64,h=this.owner.x+64,l=this.owner.y+64):"d2-piston-beam"===this.owner.type&&(o=this.owner.x-64,a=this.owner.y+64,h=this.owner.x+64,l=this.owner.y-64),i=Math.atan2(l-a,h-o),n=Math.sqrt(Math.pow(h-o,2)+Math.pow(l-a,2)),t={type:"piston-beam",properties:{x:o,y:a,z:this.owner.z+.01,pistonLinkId:this.owner.id,orientation:0,endA:"piston-outer,end",middle:"piston-outer,middle",stretchLength:n,offsetX:n,shape:{type:"circle",radius:10,x:1*n},original:{type:this.owner.type,x:this.owner.x,y:this.owner.y,z:this.owner.z,savable:this.owner.savable}}},e={type:"piston-beam",properties:{x:h,y:l,z:this.owner.z,pistonLinkId:this.owner.id,orientation:0,endA:"piston-inner,end",middle:"piston-inner,middle",stretchLength:n,offsetX:n,shape:{type:"circle",radius:10,x:1*n}}},s=c.addEntity(t),r=c.addEntity(e),this.owner.parent.removeEntity(this.owner),s.createJoint("distance",{length:n,frequencyHz:8,dampingRatio:.1},r),s.createJoint("prismatic",{localAnchorA:{x:n/2,y:0},localAnchorB:{x:n/2,y:0},localAxisA:{x:1,y:0},referenceAngle:Math.PI,enableLimit:!0,lowerTranslation:-n/5,upperTranslation:n/5},r),s.orientation=i,r.orientation=i+Math.PI}},methods:{},getAssetList:function(){for(var e=null,i=["piston-beam"],n=i.length,s=Array.setUp();n--;)e=t.getAssetList({type:i[n]}),s.union(e),e.recycle();return s},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"PistonDeconvertor",properties:{original:null},publicProperties:{},initialize:function(){},events:{"watched-joints-removed":function(){var t=null;this.original&&(t={type:this.original.type,properties:{x:this.original.x,y:this.original.y,z:this.original.z,savable:this.original.savable}},this.owner.parent.addEntity(t)),this.owner.parent.removeEntity(this.owner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t={sun:274,jupiter:24.92,neptune:11.15,saturn:10.44,earth:9.798,uranus:8.87,venus:8.87,mars:3.71,mercury:3.7,moon:1.62,pluto:.58,europa:1.32},e={earth:["wind","rain","asteroid","quake"],moon:["asteroid","quake"],mars:["wind","asteroid"],mercury:["asteroid","quake"],europa:["asteroid","quake"]};platypus.createComponentClass({id:"PlanetChanger",publicProperties:{levelId:"",planet:""},initialize:function(){this.onPlanetTime=Date.now()},events:{"scene-live":function(t){var e=this.levelId.substring(this.levelId.indexOf("-")+1);"level-all"===this.levelId?t&&t.level&&t.level.planet?this.owner.triggerEvent("choose-"+t.level.planet):this.owner.triggerEvent("choose-earth"):this.owner.triggerEvent("choose-"+e)},"simulation-started":function(){var t=e[this.planet],i=t.length;for(this.owner.triggerEvent("hide-planet-toggle");i--;)this.owner.triggerEvent("show-"+t[i]+"-toggle")},"simulation-stopped":function(){this.owner.triggerEvent("hide-weather-toggle"),this.owner.triggerEvent("show-planet-toggle")},"choose-earth":function(){this.choosePlanet("earth")},"choose-moon":function(){this.choosePlanet("moon")},"choose-mars":function(){this.choosePlanet("mars")},"choose-mercury":function(){this.choosePlanet("mercury")},"choose-europa":function(){this.choosePlanet("europa")}},methods:{choosePlanet:function(e){var i=platypus.game.app,n=Date.now()-this.onPlanetTime>>0;this.onPlanetTime=Date.now(),this.planet&&i.googleAnalytics.event(i.name,"ExitPlanet-"+this.planet,"PlanetTime",n),platypus.supports.mobile&&this.levelId!=="level-"+e?platypus.game.loadScene("scene-level",{level:function(t,e){var i=platypus.game.settings.levels["level-"+e],n=t.properties,s=0;for(t.tilesets=i.tilesets,t.layers[0]=i.layers[0],t.layers[1]=i.layers[1],s=0;s<n.length;s++)if("levelId"===n[s].name){n[s].value="level-"+e;break}return t}(this.owner.getSaveState(),e)}):(this.owner.triggerEvent("set-gravity",function(e){return t[e]/t.earth}(e)),this.planet=e,i.googleAnalytics.event(i.name,"EnterPlanet-"+e))}}})}(),function(){"use strict";var t=include("createjs.Tween"),e=include("createjs.Ease");platypus.createComponentClass({id:"PointerBehaviors",properties:{bounceDistance:30,scaleBy:1.25},publicProperties:{},initialize:function(){this.degToRad=Math.PI/180,this.originalX=this.owner.x,this.originalY=this.owner.y,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY},events:{"handle-logic":function(t){},move:function(t){this.owner.x=t.x,this.owner.y=t.y,this.owner.rotation=t.rotation||this.owner.rotation,this.originalX=this.owner.x,this.originalY=this.owner.y},"smooth-move":function(i){this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner).to({x:i.x,y:i.y,rotation:i.rotation||this.owner.rotation},i.time||250,e.sineInOut).call(function(){this.originalX=this.owner.x,this.originalY=this.owner.y}.bind(this))},show:function(){t.get(this.owner).to({opacity:1},100)},hide:function(){t.get(this.owner).to({opacity:0},100)},"start-pulse":function(i){i=i||-1,this.originalScaleX=this.owner.scaleX,this.originalScaleY=this.owner.scaleY,t.get(this.owner,{loop:i}).to({scaleX:this.originalScaleX*this.scaleBy,scaleY:this.originalScaleY*this.scaleBy},250,e.sineInOut).to({scaleX:this.originalScaleX,scaleY:this.originalScaleY},250,e.sineInOut)},"start-bounce":function(i){i=i||-1,this.originalX=this.owner.x,this.originalY=this.owner.y,t.get(this.owner,{loop:i}).to({x:this.originalX+Math.cos(this.owner.rotation*this.degToRad)*this.bounceDistance,y:this.originalY+Math.sin(this.owner.rotation*this.degToRad)*this.bounceDistance},250,e.sineInOut).to({x:this.originalX,y:this.originalY},250,e.sineInOut)},stop:function(){t.removeTweens(this.owner),this.owner.x=this.originalX,this.owner.y=this.originalY,this.owner.scaleX=this.originalScaleX,this.owner.scaleY=this.originalScaleY},"set-state":function(t){this.owner.state.set(t.state,t.value)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Data"),e=platypus.supports.mobile?2e3:1e4,i=function(t,e,i){t.worldToWindow(i,!0,i),e.windowToWorld(i,!0,i),i.pixiEvent.stopPropagation()},n=function(t){t.pixiEvent.stopPropagation()},s=function(i){this.owner.parent.zooming||this.newEntity||(this.convert(i),this.newEntityReady=!1,this.storedInputs.length=0,this.newEntity=this.targetLayer.addEntity({type:this.spawns,properties:{savable:!0,movable:!0,miniGame:this.category,neverMovedPreviously:this.owner,x:i.x,y:i.y}},function(t,i){var n=!1,s=this.storedInputs,r=0;for(i.relayPointer?(this.newEntity=i.relayPointer,i.relayPointer=null):this.newEntity=i,this.newEntityReady=!0,this.newEntity.triggerEvent("pointerdown",t),r=0;r<s.length;r++)this.newEntity.triggerEvent(s[r].event.type,s[r]),n=n||s[r].done,s[r].recycle();s.length=0,"pointerup"!==t.event.type&&"touchend"!==t.event.type||(this.newEntity.triggerEvent("pointerup",t),this.newEntity=null),"pointerupoutside"===t.event.type&&(this.newEntity.triggerEvent("pointerupoutside",t),this.newEntity=null),"pointercancel"===t.event.type&&(this.newEntity.triggerEvent("pointercancel",t),this.newEntity=null),n&&(this.newEntity=null),t.recycle(),e+=1e-6,i.z+=e}.bind(this,t.setUp("entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y))),platypus.badger.increment("used-"+this.category+"-item-in-lab"))};platypus.createComponentClass({id:"PointerPassalong",properties:{spawnEvent:"pointerdown",targetLayerType:"action-layer"},publicProperties:{category:"",spawns:""},initialize:function(){this.newEntity=null,this.targetLayer=null,this.convert=n,this.storedInputs=Array.setUp(),this.addEventListener(this.spawnEvent,s.bind(this))},events:{adopted:function(){var t=this.owner.parent.parent.layers,e=t.length,n=this.targetLayerType;if(n){for(;e--;)if(n===t[e].type){this.targetLayer=t[e],this.convert=i.bind(null,this.owner.parent,this.targetLayer);break}this.targetLayer||platypus.debug.warn('PointerPassalong: "'+n+'" is not an available layer in this scene. Entity will be spawned on the same layer.')}},pointermove:function(t){this.passEvent("pointermove",t)},pointerup:function(t){this.passEvent("pointerup",t,!0)},pointerupoutside:function(t){this.passEvent("pointerupoutside",t,!0)},pointercancel:function(t){this.passEvent("pointercancel",t,!0)}},methods:{passEvent:function(e,i,n){this.newEntity&&(this.convert(i),this.newEntityReady?(this.newEntity.triggerEvent(e,i),n&&(this.newEntity=null)):this.storedInputs.push(t.setUp("done",n,"entity",i.entity,"event",i.event,"pixiEvent",i.pixiEvent,"x",i.x,"y",i.y)))},destroy:function(){this.storedInputs.recycle(),this.storedInputs=null}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=Math.PI/2;platypus.createComponentClass({id:"RainCloudLogic",properties:{drift:.06,direction:-1},publicProperties:{},initialize:function(){this.started=!1,this.rain=[],this.rainCount=0,this.rainInterval=200,this.rainTimer=0,this.rainSlots=[-38,-75,38,-50,-25,-62,-100,75,62,-25,38,75,0,50,-38,-62,-100,50,100,25,100,-50,0,-13,25],this.rainSlotIndex=0,this.pulseTicker=0,this.verticalTicker=0,this.windDown=!1,this.windDownRate=3e-6,this.oX=this.owner.x,this.oY=this.owner.y,this.camera=t.setUp()},events:{"camera-update":function(t){this.camera.set(t.viewport)},"handle-logic":function(t){var i=null;this.started&&(this.drift>0&&(this.windDown&&(this.drift=Math.max(0,this.drift-this.windDownRate*t.delta)),this.owner.x+=this.drift*this.direction*t.delta,this.rain.length>0&&(this.rainTimer+=t.delta,this.rainTimer>=this.rainInterval&&(this.rainTimer=0,(i=this.rain.pop()).x=this.owner.x+this.rainSlots[this.rainSlotIndex],i.y=this.owner.y,this.rainSlotIndex++,this.rainSlotIndex>=this.rainSlots.length&&(this.rainSlotIndex=0),i.triggerEvent("fall")))),this.pulseTicker+=t.delta/1e3,this.pulseTicker>=2*Math.PI&&(this.pulseTicker=0),this.verticalTicker+=t.delta/800,this.verticalTicker>=2*Math.PI&&(this.verticalTicker=0),this.owner.scaleX=1+.07*Math.sin(this.verticalTicker),this.owner.scaleY=1+.07*Math.cos(this.verticalTicker+e),this.owner.y=this.camera.top+20*Math.sin(this.verticalTicker),this.owner.x<this.camera.left-200&&this.stopRain())},"return-to-cloud":function(t){this.started?this.rain.push(t):this.owner.parent.removeEntity(t)},"start-the-storm":function(){var t=0,e=null,i=null;for(this.started=!0,this.owner.x=this.camera.right+200,this.owner.triggerEvent("rumble"),t=0;t<20;t++)e={type:"rain-drop",properties:{x:0,y:-1e3,z:this.owner.z-.01*t,cloud:this.owner}},i=this.owner.parent.addEntity(e),this.rain.push(i)},"simulation-stopped":function(){this.stopRain()},"times-up":function(){this.windDown=!0},"level-fail":function(){this.windDown=!0}},methods:{stopRain:function(){var t=0;for(this.started=!1,t=0;t<this.rain.length;t++)this.owner.parent.removeEntity(this.rain[t]);this.rain=[],this.owner.x=this.oX,this.owner.y=this.oY,this.owner.scaleX=1,this.owner.scaleY=1,this.pulseTicker=0,this.verticalTicker=0,this.windDown=!1,this.drift=.06,this.rainTimer=0,this.rainSlotIndex=0,this.owner.triggerEvent("stop-audio"),this.owner.triggerEvent("rain-has-stopped")},destroy:function(){this.camera.recycle()}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"RainDropLogic",properties:{},publicProperties:{},initialize:function(){this.fade=!1,this.inCloud=!0,this.owner.state.set("on-roof",!1),this.velocity=new t(0,0),this.prevX=0,this.prevY=0,this.stillTimer=500,this.fadeSpeed=50,this.originalScaleY=this.owner.scaleY,this.audibleSpeed=10,this.dripSoundCount=9,this.soundIndex=Math.floor(Math.random()*this.dripSoundCount)},events:{"handle-logic":function(t){this.inCloud||(this.fade&&(this.owner.opacity-=t.delta/this.fadeSpeed,this.owner.scaleY=this.originalScaleY*this.owner.opacity,this.owner.opacity<=0&&(this.owner.opacity=0,this.fade=!1,this.owner.triggerEvent("evaporate"))),this.fade||(Math.pow(this.prevX-this.owner.x,2)+Math.pow(this.prevY-this.owner.y,2)>.1?this.stillTimer=500:(this.stillTimer-=t.delta,this.stillTimer<=0&&(this.fade=!0,this.fadeSpeed=100)))),this.prevX=this.owner.x,this.prevY=this.owner.y},"after-box2d-update":function(){this.owner.body.IsAwake()||this.inCloud||this.fade||(this.fade=!0,this.owner.body.SetActive(!1))},fall:function(){this.inCloud=!1,this.owner.body.SetActive(!0),this.owner.body.SetAwake(!0),this.owner.opacity=1,this.owner.body.SetGravityScale(1),this.owner.state.set("on-roof",!1)},evaporate:function(){this.inCloud=!0,this.owner.scaleY=this.originalScaleY,this.owner.x=0,this.owner.y=-1e3,this.owner.opacity=0,this.owner.body.SetGravityScale(0),this.owner.orientation=0,this.owner.body.SetLinearVelocity(this.velocity),this.owner.body.SetAngularVelocity(0),this.owner.body.SetActive(!1),this.fadeSpeed=50,this.owner.cloud.triggerEvent("return-to-cloud",this.owner)},"simulation-stopped":function(){this.inCloud||this.owner.triggerEvent("evaporate")},"hit-ground":function(t){this.playSound(),this.owner.state.set("on-roof",!0),t.contact.SetRestitution(0),this.fade=!0},"hit-roof":function(t){this.playSound(),t.contact.SetRestitution(.1),this.owner.state.set("on-roof",!0)},"in-barrel":function(t){this.playSound(),this.owner.state.set("on-roof",!0),t.contact.SetRestitution(0),this.fade=!0}},methods:{playSound:function(){Math.abs(this.owner.body.GetLinearVelocity().get_y())>this.audibleSpeed&&(this.owner.triggerEvent("drip-"+this.soundIndex),this.soundIndex++,this.soundIndex>=this.dripSoundCount&&(this.soundIndex=0))}},publicMethods:{}})}(),function(){"use strict";var t={};platypus.createComponentClass({id:"RandomizeVariant",properties:{numVariants:3},publicProperties:{},initialize:function(){this.alphabet="abcdefghij",this.variant="",void 0===t[this.owner.type]&&(t[this.owner.type]=Math.floor(Math.random()*this.numVariants)),this.owner.state.set("variant-"+this.alphabet[t[this.owner.type]],!0),t[this.owner.type]++,t[this.owner.type]>=this.numVariants&&(t[this.owner.type]=0)},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"Region",properties:{},publicProperties:{height:0,width:0,x:0,y:0},initialize:function(){this.aabb=t.setUp(this.x,this.y,this.width,this.height),this.entities=Array.setUp()},events:{adopted:function(){var e=t.setUp(this.owner.x-140,this.owner.y,1,1),i=this.owner,n=i.parent;this.addBorderingRegions(),n.triggerEvent("building-area-ready",i),n.triggerEvent("relocate",e),e.recycle()},"prepare-for-simulation":function(){for(var t=this.entities,e=t.length;e--;)this.owner.parent.removeEntity(t[e]);t.length=0,this.owner.body.SetActive(!1)},"simulation-stopped":function(){this.addBorderingRegions(),this.owner.body.SetActive(!0)},"handle-logic":function(){this.x===this.aabb.x&&this.y===this.aabb.y||this.aabb.move(this.x,this.y)}},methods:{addBorderingRegions:function(){var t=this.aabb,e=this.entities,i=this.owner.parent;e.push(i.addEntity({type:"trash",properties:{width:500,height:2e3,x:-500,y:0}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.left-250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.top-250}}),i.addEntity({type:"wall-hidden",properties:{width:500,height:t.height+1e3,x:t.right+250,y:t.y}}),i.addEntity({type:"wall-hidden",properties:{width:t.width,height:500,x:t.x,y:t.bottom+250}}))},destroy:function(){this.aabb.recycle(),this.aabb=null,this.entities.recycle(),this.entities=null}},publicMethods:{inBounds:function(t,e){return this.aabb.containsPoint(t,e)}}})}(),function(){"use strict";var t,e=include("PIXI.Graphics"),i=include("platypus.components.RenderContainer"),n=(t=function(t,e){var i=0,n=e.indexOf("("),s=e.substring(0,n),r=e.substring(n+1,e.indexOf(")"));if(r.length){for(i=(r=r.greenSplit(",")).length;i--;)r[i]=+r[i];t[s].apply(t,r),r.recycle()}else t[s]()},function(e,i){var n=0,s=i.greenSplit(".");for(n=0;n<s.length;n++)t(e,s[n]);s.recycle()});platypus.createComponentClass({id:"RenderGraphics",properties:{offsetX:0,offsetY:0,offsetZ:0,shape:""},publicProperties:{color:16776960,width:100,height:100},initialize:function(t){var e,s,r,o,a;"string"==typeof this.color&&(this.color=parseInt(this.color.replace("#","0x"),16)),e=this,s=this.shape,r=this.color,o=this.width,a=this.height,e.beginFill(r,1),s&&"string"==typeof s?n(e,s):s&&s.radius?e.dc(s.x||0,s.y||0,s.radius):s&&s.width&&s.height?e.r(s.x||0,s.y||0,s.width,s.height):e.r(-o/2,-a/2,o,a),e.endFill(),this.x=this.offsetX,this.y=this.offsetY,this.z=this.offsetZ,this.owner.container?this.addToContainer():this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this)))},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this),t.reorder=!0},destroy:function(){this.owner.container.removeChild(this)}}},e)}(),function(){"use strict";var t=include("platypus.Data"),e=include("platypus.components.RenderContainer"),i=include("PIXI.Graphics"),n=include("platypus.Vector");platypus.createComponentClass({id:"RenderShape",properties:{mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,rotate:!1,mirror:!1,flip:!1,visible:!0,cache:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0,shape:null},initialize:function(){var s=null,r=this.owner,o=r.shape,a=o&&o.points||null,h=this.gfx=new i,l=o&&o.translation?n.setUp(o.translation.x,o.translation.y):n.setUp(0,0);h.beginFill(16777215,1),a?h.drawPolygon(function(t,e){var i=Array.setUp(),n=0;for(n=0;n<t.length;n++)i.push(t[n].x+e.x,t[n].y+e.y);return i}(a,{x:l.x,y:l.y})):o&&"circle"===o.type?h.drawCircle(this.offsetX,this.offsetY,o.radius||r.radius||r.width/2):h.drawRect(this.offsetX-r.width/2,this.offsetY-r.height/2,r.width,r.height),h.endFill(),l.recycle(),this.owner.container?this.addToContainer():(s=t.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new e(this.owner,s,this.addToContainer.bind(this))),s.recycle())},events:{},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.gfx),t.reorder=!0}}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.RenderContainer"),n=include("platypus.PIXIAnimation");platypus.createComponentClass({id:"RenderSpan",properties:{spriteSheet:null,offsetX:0,offsetY:0,offsetZ:0,endA:"end-a",endAReversed:"",endALength:0,endB:"end-b",endBReversed:"",endBLength:0,middle:"middle",middleReversed:"",middleLength:120,scaleLength:!1},publicProperties:{scaleX:1,stretchLength:0},initialize:function(){var t=null,s=n.formatSpriteSheet(this.spriteSheet),r=this.reversed=this.owner.state.get("reversed");s===n.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),this.endAReversed||(this.endAReversed=this.endA),this.middleReversed||(this.middleReversed=this.middle),this.endBReversed||(this.endBReversed=this.endB),this.sprite=new n(s,r?this.middleReversed:this.middle),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=platypus.modifyAllAssets,this.sprite.scale.y=platypus.modifyAllAssets,0!==this.endALength&&(this.spriteEndA=new n(s,r?this.endAReversed:this.endA),this.spriteEndA.y=this.offsetY,this.spriteEndA.z=this.offsetZ+.01,this.spriteEndA.scale.x=platypus.modifyAllAssets,this.spriteEndA.scale.y=platypus.modifyAllAssets),0!==this.endBLength&&(this.spriteEndB=new n(s,r?this.endBReversed:this.endB),this.spriteEndB.y=this.offsetY,this.spriteEndB.z=this.offsetZ+.02,this.spriteEndB.scale.x=platypus.modifyAllAssets,this.spriteEndB.scale.y=platypus.modifyAllAssets),this.currentStretchLength=0,this.stretch(this.stretchLength),this.owner.container?this.addToContainer():(t=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new i(this.owner,t,this.addToContainer.bind(this))),t.recycle()),s.recycleSpriteSheet()},events:{"handle-render":function(){this.sprite&&this.stretchLength!==this.currentStretchLength&&this.stretch(this.stretchLength)},"state-changed":function(){var t=this.owner.state.get("reversed");this.reversed!==t&&(this.reversed=t,t?(this.spriteEndA.gotoAndPlay(this.endAReversed),this.sprite.gotoAndPlay(this.middleReversed),this.spriteEndB.gotoAndPlay(this.endBReversed)):(this.spriteEndA.gotoAndPlay(this.endA),this.sprite.gotoAndPlay(this.middle),this.spriteEndB.gotoAndPlay(this.endB)))}},methods:{stretch:function(t){var e=this.scaleLength?1:1/this.scaleX,i=(t||this.middleLength+(this.endALength+this.endBLength)/2)*e,n=this.sprite,s=this.spriteEndA,r=this.spriteEndB,o=i/2-1;s&&(s.x=-o+this.offsetX),r&&(r.x=o+this.offsetX),n.scale.x=platypus.modifyAllAssets*(i-this.endALength/2-this.endBLength/2)/this.middleLength},addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),this.spriteEndA&&t.addChild(this.spriteEndA),this.spriteEndB&&t.addChild(this.spriteEndB),t.reorder=!0},destroy:function(){var t=this.owner.container;t.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null,this.spriteEndA&&(t.removeChild(this.spriteEndA),this.spriteEndA.destroy()),this.spriteEndA=null,this.spriteEndB&&(t.removeChild(this.spriteEndB),this.spriteEndB.destroy()),this.spriteEndB=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||n.spriteSheet;if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}return t(h,a)})})}(),function(){"use strict";var t,e,i=include("PIXI.spine.core.TextureAtlas",!1),n=include("PIXI.spine.core.AtlasAttachmentLoader",!1),s=include("PIXI.BaseTexture"),r=include("platypus.Data"),o=include("platypus.components.EventRender"),a=include("platypus.components.RenderContainer"),h=include("PIXI.spine.core.SkeletonJson",!1),l=include("PIXI.spine.Spine",!1),c=include("platypus.components.StateRender");l&&platypus.createComponentClass({id:"RenderSpine",properties:{localScaleX:1,localScaleY:1,animationMap:null,mask:null,interactive:!1,mixTimes:0,offsetX:0,offsetY:0,offsetZ:0,atlas:"",skeleton:null,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0},publicProperties:{dragMode:!1,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,x:0,y:0,z:0},initialize:(e=function(t,e,i){var n,r,o=(n=e,(r=platypus.game.app.assetManager.cache.read(n.substring(n.lastIndexOf("/")+1,n.lastIndexOf("."))))||platypus.debug.warn('RenderSpine: "'+n+'" is not a loaded asset.'),new s(r));i(o),o.isLoading?o.on("loaded",t):t()},function(t,s){var p,u="",d=null,g=platypus.game.settings,y=g.atlases[this.atlas+"-"+platypus.modifyAllAssets],m=g.skeletons[this.skeleton],f=new i(y,e.bind(null,s)),w=new h(new n(f)).readSkeletonData(m),v=this.spine=new l(w);return v.state.addListener({event:function(t,e){var i=e.data.name;this.playAnimation(i)&&this.spine.update(1e-6),this.owner.trigger(i,e.data)}.bind(this),complete:function(){this.owner.triggerEvent("animation-ended",this.currentAnimation)}.bind(this)}),v.autoUpdate=!1,p=function(t,e){var i=null,n="";if(t)return t;for(n in i={},e)e.hasOwnProperty(n)&&(i[n]=n);return i}(this.animationMap,m.animations),this.stateBased=p&&this.stateBased,this.eventBased=p&&this.eventBased,p&&(u=p.default||"",this.eventBased&&(d=r.setUp("animationMap",p,"component",this),this.owner.addComponent(new o(this.owner,d)),d.recycle()),this.stateBased&&(d=r.setUp("animationMap",p,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new c(this.owner,d)),d.recycle())),this.mixTimes&&this.setMixTimes(this.mixTimes),u&&(this.currentAnimation=u,v.state.setAnimation(0,u,!0)),v.x=this.offsetX,v.y=this.offsetY,v.z=this.offsetZ,v.scale.x=this.localScaleX,v.scale.y=this.localScaleY,this.owner.container?this.addToContainer():(d=r.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new a(this.owner,d,this.addToContainer.bind(this))),d.recycle()),!0}),events:{"handle-render":function(t){this.spine&&(this.owner.triggerEvent("update-animation",!0),this.spine.update(t.delta/1e3))},"set-mix-times":function(t){this.setMixTimes(t)},hide:function(){this.visible=!1},show:function(){this.visible=!0},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t){this.playAnimation(t)},"change-skin":function(t){var e=0,i=this.spine.spineData.skins,n=null;for(e=0;e<i.length;e++)if(i[e].name===t){n=i[e];break}this.spine.skeleton.setSkin(n),this.spine.skeleton.setSlotsToSetupPose(),this.spine.state.apply(this.spine.skeleton)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.spine),t.reorder=!0},playAnimation:function(t){var e=this.spine;return!(!t||!e.state.hasAnimation(t))&&(this.currentAnimation=t,e.state.setAnimation(0,t,!0),this.paused=!1,!0)},stopAnimation:function(t){var e=this.spine;t&&e.state.hasAnimation(t)&&(this.currentAnimation=t,e.state.setAnimation(0,t,!1)),this.paused=!0},setMixTimes:function(t){var e=this.spine,i=e.spineData.animations,n=0,s=0,r=0,o="",a=e.stateData;if("number"==typeof t)for(s=i.length;s--;)for(r=i.length;r--;)s!==r&&a.setMix(i[s].name,i[r].name,t);else for(o in t)t.hasOwnProperty(o)&&(n=o.indexOf(":"))>=0&&a.setMix(o.substring(0,n),o.substring(n+1),t[o]);this.mixTimes=a.animationToMixTime},destroy:function(){this.owner.container.removeChild(this.spine),this.spine.destroy(),this.spine=null,this.mixTimes=null}},getAssetList:(t=function(t,e){var i=Array.setUp(),n=null,s=0;if(t){if(1===(n=t.split("\n")).length){if(!(t=e[t+"-"+platypus.modifyAllAssets]))return i;n=t.split("\n")}for(s=n.length;s--;)".png"===n[s].substr(n[s].length-4)&&i.push(n[s])}return i},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.atlases,h=e.atlas||i.atlas||n.atlas;if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}return t(h,a)})})}(),function(){"use strict";var t,e=include("platypus.Data"),i=include("platypus.components.EventRender"),n=include("platypus.components.RenderContainer"),s=include("platypus.PIXIAnimation"),r=include("platypus.components.StateRender");platypus.createComponentClass({id:"RenderSprite",properties:{localScaleX:1,localScaleY:1,spriteSheet:null,animationMap:null,mask:null,interactive:!1,offsetX:0,offsetY:0,offsetZ:0,restart:!0,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0,cache:!1,forcePlayThrough:!1,ignoreOpacity:!1,scale:1,scaleX:1,scaleY:1,skew:0,skewX:0,skewY:0,rotation:0},initialize:function(){var t,o="",a=null,h=s.formatSpriteSheet(this.spriteSheet);h===s.EmptySpriteSheet&&platypus.debug.warn('Entity "'+this.owner.type+'": RenderSprite sprite sheet not defined.'),t=function(t,e){var i=null,n="",s=null,r=0;if(t)return t;if(Array.isArray(e.frames)&&1===e.frames.length)return null;for(n in i={},s=Array.setUp(),e.animations)e.animations.hasOwnProperty(n)&&(s.push(n),i[n]=n);if("default"===s[0])for(r=s.length,i={};r--;)i[s[r]]=s[r];return s.recycle(),i}(this.animationMap,h),this.stateBased=t&&this.stateBased,this.eventBased=t&&this.eventBased,t&&(o=t.default||"",this.eventBased&&(a=e.setUp("animationMap",t,"restart",this.restart,"component",this),this.owner.addComponent(new i(this.owner,a)),a.recycle()),this.stateBased&&(a=e.setUp("animationMap",t,"forcePlayThrough",this.forcePlayThrough,"component",this),this.owner.addComponent(new r(this.owner,a)),a.recycle())),this.sprite=new s(h,o),this.sprite.on("complete",function(t){this.owner.triggerEvent("animation-ended",t)}.bind(this)),this.sprite.x=this.offsetX,this.sprite.y=this.offsetY,this.sprite.z=this.offsetZ,this.sprite.scale.x=this.localScaleX*platypus.modifyAllAssets,this.sprite.scale.y=this.localScaleY*platypus.modifyAllAssets,this.owner.container?this.addToContainer():(a=e.setUp("interactive",this.interactive,"mask",this.mask,"rotate",this.rotate,"mirror",this.mirror,"flip",this.flip,"visible",this.visible,"cache",this.cache,"ignoreOpacity",this.ignoreOpacity,"scaleX",this.scaleX,"scaleY",this.scaleY,"skewX",this.skewX,"skewY",this.skewY,"rotation",this.rotation),this.owner.addComponent(new n(this.owner,a,this.addToContainer.bind(this))),a.recycle()),h.recycleSpriteSheet()},events:{"handle-render":function(t){this.sprite&&(this.owner.triggerEvent("update-animation",!0),this.sprite.update(t.delta))},"stop-animation":function(t){this.stopAnimation(t)},"play-animation":function(t,e){this.playAnimation(t,e)}},methods:{addToContainer:function(){var t=this.owner.container;t.addChild(this.sprite),t.reorder=!0},playAnimation:function(t,e){var i=this.sprite;t&&i.has(t)?i.gotoAndPlay(t,e):i.play()},stopAnimation:function(t){var e=this.sprite;t&&e.has(t)?e.gotoAndStop(t):e.stop()},destroy:function(){this.owner.container.removeChild(this.sprite),this.sprite.destroy(),this.sprite=null}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||n.spriteSheet;if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}return t(h,a)})})}(),function(){"use strict";var t,e=include("platypus.AABB"),i=include("platypus.PIXIAnimation"),n=include("springroll.Application"),s=include("PIXI.CanvasRenderer"),r=include("PIXI.Container"),o=include("PIXI.Graphics"),a=r,h=include("PIXI.Rectangle"),l=include("platypus.components.RenderContainer"),c=include("PIXI.RenderTexture"),p=include("PIXI.Sprite"),u=function(t,e,i){var n=e.baseTexture._glRenderTargets[t.CONTEXT_UID];n&&n.clear(i)},d=function(){return null},g=e.setUp(),y=function(t,e){return t.z-e.z},m=function(t){for(var e=1;e<t;)e*=2;return e},f=function(t,e){this.id=e,this.instances=Array.setUp(t),this.index=0,t.template=this},w={getNext:d,destroy:d},v=f.prototype;v.getNext=function(){var t=this.instances[this.index],e=null;return t||(e=this.instances[0],(t=this.instances[this.index]=new p(e.texture)).scale=e.scale,t.rotation=e.rotation,t.anchor=e.anchor),this.index+=1,t},v.clear=function(){this.index=0},v.destroy=function(){var t=0;for(t=0;t<this.instances.length;t++)this.instances[t].destroy();this.instances.recycle(),this.recycle()},recycle.add(f,!!springroll.Debug,"Template"),platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10,top:0,left:0},initialize:function(t){var o=platypus.modifyAllAssets,h=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=n.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=e.setUp(),this.tileWidth/=o,this.tileHeight/=o,this.scaleX*=o,this.scaleY*=o,this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=e.setUp(),this.cachePixels=e.setUp(),this.spriteSheet=i.formatSpriteSheet(this.spriteSheet),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof s?new r:new a(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new r,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=Array.setUp(this.createMap(h)),this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(m(this.layerWidth+2),this.maximumBuffer),this.cacheHeight=Math.min(m(this.layerHeight+2),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1),this.ready=!1,this.owner.container?this.addToContainer():this.owner.addComponent(new l(this.owner,t,this.addToContainer.bind(this)))},events:{"cache-sprite":function(t){this.cacheSprite(t)},"peer-entity-added":function(t){this.cacheSprite(t)},"add-tiles":function(t){var e=t.imageMap;e&&(this.imageMap.push(this.createMap(e)),this.updateCache=!0)},"change-tile":function(t,e,i,n){var s=this.imageMap;s&&(this.updateTile(t,s[n||0],e,i),this.updateCache=!0)},"camera-loaded":function(t){this.worldWidth=t.world.width,this.worldHeight=t.world.height,this.buffer&&!this.cacheAll&&this.updateBufferRegion(t.viewport)},"camera-update":function(t){this.ready&&this.updateCamera(t)},"handle-render":function(){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{addToContainer:function(){var t=this.container=this.owner.container,e=this.mapContainer,i=null,n=this.owner.z;t.reorder=!0,this.ready=!0,this.updateRegion(0),this.tileCache?(this.mapContainerWrapper=new r,this.mapContainerWrapper.addChild(e),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.render=this.renderCache,this.cacheTexture=c.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=i=new p(this.cacheTexture),i.scale.x=this.scaleX,i.scale.y=this.scaleY,i.z=n,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),t.addChild(i)):(this.render=this.renderCache,this.cacheAll=!1,this.cacheTexture=c.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=new p(this.cacheTexture),this.tilesSprite.scale.x=this.scaleX,this.tilesSprite.scale.y=this.scaleY,this.tilesSprite.z=n,this.cacheTexture.alternate=c.create(this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new p(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,t.addChild(this.tilesSprite))):(this.render=d,e.scale.x=this.scaleX,e.scale.y=this.scaleY,e.x=this.left,e.y=this.top,e.z=n,t.addChild(e))},cacheSprite:function(t){var e=0,i=0,n=t.cacheRender,s=null,r=0,o=0,a=0,h=0;if(this.entityCache&&n){for(this.doMap||(this.doMap=Array.setUp(),this.cachedDisplayObjects=Array.setUp(),this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(n),(s=n.getBounds(n.transformMatrix)).x-=this.left,s.y-=this.top,r=Math.max(0,Math.floor(s.y/this.tileHeight)),o=Math.min(this.tilesHeight,Math.ceil((s.y+s.height)/this.tileHeight)),h=Math.max(0,Math.floor(s.x/this.tileWidth)),a=Math.min(this.tilesWidth,Math.ceil((s.x+s.width)/this.tileWidth)),e=h;e<a;e++)for(this.doMap[e]||(this.doMap[e]=Array.setUp()),i=r;i<o;i++)this.doMap[e][i]||(this.doMap[e][i]=Array.setUp()),this.doMap[e][i].push(n);t.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(t){var e=this.layerWidth*this.scaleX,i=this.layerHeight*this.scaleY,n=this.worldWidth,s=n-t.width,r=this.worldHeight,o=r-t.height,a=this.laxCam;return n!==e&&s?a.moveX((t.left-this.left)*(e-t.width)/s+t.halfWidth+this.left):a.moveX(t.x),r!==i&&o?a.moveY((t.top-this.top)*(i-t.height)/o+t.halfHeight+this.top):a.moveY(t.y),t.width===a.width&&t.height===a.height||a.resize(t.width,t.height),a},createTile:function(t){var e,n=null;return"tile-1"===t?w:(e="tile"+function(t,e){var i=+t.substring(4),n=0;return 2147483648&i&&(e.scale.x=-1),1073741824&i&&(e.scale.y=-1),536870912&i&&(n=e.scale.x,e.scale.x=e.scale.y,e.scale.y=-n,e.rotation=Math.PI/2),268435455&i}(t,n=new i(this.spriteSheet)),n.gotoAndStop(e),f.setUp(n,t))},createMap:function(t){var e=0,i=0,n="",s=null;if("string"!=typeof t[0][0])return t;for(s=Array.setUp(),e=0;e<t.length;e++)for(s[e]=Array.setUp(),i=0;i<t[e].length;i++)n=t[e][i],this.updateTile(n,s,e,i);return s},updateCamera:function(t){var e=0,i=0,n=!1,s=null,r=0,o=0,a=0,h=0,l=this.cache,c=this.cachePixels,p=t.viewport,u=this.buffer&&(p.width!==this.laxCam.width||p.height!==this.laxCam.height),d=g,y=this.convertCamera(p);if(!this.cacheAll&&(c.empty||!c.contains(y))&&this.imageMap.length>0&&(u&&this.updateBufferRegion(y),a=(r=this.cacheTilesWidth-1)/2,h=(o=this.cacheTilesHeight-1)/2,d.setAll(Math.round((y.x-this.left)/(this.tileWidth*this.scaleX)-a)+a,Math.round((y.y-this.top)/(this.tileHeight*this.scaleY)-h)+h,r,o),d.left<0?d.moveX(d.halfWidth):d.right>this.tilesWidth-1&&d.moveX(this.tilesWidth-1-d.halfWidth),d.top<0?d.moveY(d.halfHeight):d.bottom>this.tilesHeight-1&&d.moveY(this.tilesHeight-1-d.halfHeight),this.tileCache?!l.empty&&d.contains(l)||(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,d,this.tilesSpriteCache,l)):this.update(null,d),c.setAll((l.x+.5)*this.tileWidth+this.left,(l.y+.5)*this.tileHeight+this.top,(l.width+1)*this.tileWidth,(l.height+1)*this.tileHeight)),this.cacheGrid)for(e=0;e<this.cacheGrid.length;e++)for(i=0;i<this.cacheGrid[e].length;i++)s=this.cacheGrid[e][i],c.setAll((e+.5)*this.cacheClipWidth+this.left,(i+.5)*this.cacheClipHeight+this.top,this.cacheClipWidth,this.cacheClipHeight),n=c.intersects(y),s.visible&&!n?s.visible=!1:!s.visible&&n&&(s.visible=!0),s.visible&&n&&(s.x=p.left-y.left+e*this.cacheClipWidth+this.left,s.y=p.top-y.top+i*this.cacheClipHeight+this.top);else this.tileCache&&(this.tilesSprite.x=p.left-y.left+l.left*this.tileWidth*this.scaleX+this.left,this.tilesSprite.y=p.top-y.top+l.top*this.tileHeight*this.scaleY+this.top)},updateTile:function(t,e,i,n){var s=null,r=this.tiles;t.id&&(t=t.id),(s=r[t])||null===s||(s=r[t]=this.createTile(t)),e[i][n]=s},createGrid:function(t){var e=this.cacheHeight,i=this.cacheWidth,n=this.cacheTilesHeight,s=this.cacheTilesWidth,r=0,o=0,a=null,l=this.scaleX,u=this.scaleY,d=this.tileHeight,g=this.tileWidth,y=this.tilesHeight,f=this.tilesWidth,w=0,v=0,b=this.owner.z,x=null,C=null,E=Array.setUp();for(w=0;w<f;w+=s)for(x=Array.setUp(),E.push(x),v=0;v<y;v+=n)o=Math.min(m((f-w)*g+2),i),r=Math.min(m((y-v)*d+2),e),(a=c.create(o,r)).frame=new h(1,1,((o-2)/g>>0)*g+1,((r-2)/d>>0)*d+1),(C=new p(a)).z=b,C.scale.x=l,C.scale.y=u,x.push(C),t.addChild(C),b-=1e-6;return E},updateRegion:function(t){var e=this.tileWidth,i=this.tileHeight,n=Math.min(this.tilesWidth,(this.cacheWidth-2)/e>>0),s=Math.min(this.tilesHeight,(this.cacheHeight-2)/i>>0);n||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+e+"px wide which is larger than "+(this.cacheWidth-2)+"px (maximum cache size of "+this.cacheWidth+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),s||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+i+"px high which is larger than "+(this.cacheHeight-2)+"px (maximum cache size of "+this.cacheHeight+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),this.cacheTilesWidth=n,this.cacheTilesHeight=s,this.cacheClipWidth=n*e,this.cacheClipHeight=s*i,this.tileCache&&(this.mapContainer.mask=(new o).beginFill(0).drawRect(0,0,this.cacheClipWidth+t,this.cacheClipHeight+t).endFill())},updateBufferRegion:function(t){var e=this.tileWidth,i=this.tileHeight;this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((t.width+2*this.buffer)/e),this.cacheWidth/e>>0),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((t.height+2*this.buffer)/i),this.cacheHeight/i>>0),this.cacheClipWidth=this.cacheTilesWidth*e,this.cacheClipHeight=this.cacheTilesHeight*i,this.mapContainer.mask=(new o).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(t,e,i,n){this.populate(e,n),this.render(e,t,this.mapContainer,this.mapContainerWrapper,i,n),n&&n.set(e)},populateTiles:function(t,e){var i=0,n=0,s=0,r=0,o=null,a=Array.setUp();for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(n=t.top;n<=t.bottom;n++)if(!e||e.empty||n>e.bottom||n<e.top||i>e.right||i<e.left)for(r=0;r<this.imageMap.length;r++)(o=this.imageMap[r][i][n].getNext())&&(o.template&&a.push(o.template),o.x=(i+.5)*this.tileWidth,o.y=(n+.5)*this.tileHeight,this.tileContainer.addChild(o));for(s=0;s<a.length;s++)a[s].clear();a.recycle()},populateTilesAndEntities:function(t,e){var i=0,n=0,s=0,r=0,o=null,a=null,h=Array.setUp(),l=Array.setUp(),c=null;for(this.tileContainer.removeChildren(),i=t.left;i<=t.right;i++)for(n=t.top;n<=t.bottom;n++)if(!e||e.empty||n>e.bottom||n<e.top||i>e.right||i<e.left){for(r=0;r<this.imageMap.length;r++)(o=this.imageMap[r][i][n].getNext())&&(o.template&&l.push(o.template),o.x=(i+.5)*this.tileWidth,o.y=(n+.5)*this.tileHeight,this.tileContainer.addChild(o));if(this.doMap[i]&&this.doMap[i][n])for(c=this.doMap[i][n],s=0;s<c.length;s++)c[s].drawn||(c[s].drawn=!0,h.push(c[s]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),h.length)for(h.sort(y),s=0;s<h.length;s++)delete(a=h[s]).drawn,this.mapContainer.addChild(a),a.mask&&this.mapContainer.addChild(a.mask);for(s=0;s<l.length;s++)l[s].clear();l.recycle(),h.recycle()},renderCache:function(t,e,i,n,s,r){var o=this.renderer;s&&!r.empty&&(s.x=r.left*this.tileWidth,s.y=r.top*this.tileHeight,i.addChild(s)),u(o,e),i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight,o.render(n,e),e.requiresUpdate=!0},renderCacheWithExtrusion:function(t,e,i,n){var s=new o,r=this.renderer;s.lineStyle(1,0),s.drawRect(.5,.5,this.cacheClipWidth+1,this.cacheClipHeight+1),u(r,e),n.mask=s,i.x=-t.left*this.tileWidth,i.y=-t.top*this.tileHeight+1,r.render(n,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight,r.render(n,e),i.x=-t.left*this.tileWidth+2,i.y=-t.top*this.tileHeight+1,r.render(n,e),i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+2,r.render(n,e),n.mask=null,i.x=-t.left*this.tileWidth+1,i.y=-t.top*this.tileHeight+1,r.render(n,e),e.requiresUpdate=!0},updateGrid:function(){var t=this.cache,e=this.cacheTilesHeight,i=this.cacheTilesWidth,n=this.tilesHeight-1,s=this.tilesWidth-1,r=0,o=0,a=this.cacheGrid;for(r=0;r<a.length;r++)for(o=0;o<a[r].length;o++)t.setBounds(r*i,o*e,Math.min((r+1)*i,s),Math.min((o+1)*e,n)),this.update(a[r][o].texture,t)},toJSON:function(){for(var t=this.imageMap[0],e=[],i=t.length,n=0;i--;)for(n=t[i].length,e[i]=[];n--;)e[i][n]=t[i][n].id;return{type:"RenderTiles",buffer:this.buffer,cacheAll:this.cacheAll,entityCache:this.entityCache,imageMap:e,maximumBuffer:this.maximumBuffer,scaleX:this.scaleX,scaleY:this.scaleY,spriteSheet:this.spriteSheet,tileCache:this.tileCache,tileHeight:this.tileHeight,tileWidth:this.tileWidth,top:this.top,left:this.left}},destroy:function(){var t=0,e=0,i="",n=this.cacheGrid,s=this.doMap,r=this.imageMap;if(n){for(t=0;t<n.length;t++)for(e=0;e<n[t].length;e++)n[t][e].texture.destroy(!0),this.container.removeChild(n[t][e]);n.recycle(2),delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.container.removeChild(this.tilesSprite)):this.container.removeChild(this.mapContainer);for(i in r.recycle(2),this.tiles)this.tiles.hasOwnProperty(i)&&this.tiles[i].destroy();if(this.tiles=null,this.container=null,this.tilesSprite=null,this.spriteSheet.recycleSpriteSheet(),s){for(t=0;t<this.cachedDisplayObjects.length;t++)this.cachedDisplayObjects[t].destroy();for(this.cachedDisplayObjects.recycle(),t=0;t<s.length;t++)if(s[t]){for(e=0;e<s.length;e++)s[t][e]&&s[t][e].recycle();s[t].recycle()}s.recycle()}this.laxCam.recycle(),this.cache.recycle(),this.cachePixels.recycle()}},getAssetList:(t=function(e,i){if(e){if("string"==typeof e)return t(i[e],i);if(e.images)return e.images.greenSlice()}return Array.setUp()},function(e,i,n){var s=null,r=0,o=null,a=platypus.game.settings.spriteSheets,h=e.spriteSheet||i.spriteSheet||n.spriteSheet;if(h){if("string"==typeof h&&"import"!==h)return t(h,a);if(Array.isArray(h)){for(r=h.length,o=Array.setUp();r--;)s=t(h[r],a),o.union(s),s.recycle();return o}if(h.images)return h.images.greenSlice()}return Array.setUp()})})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"ResizeSnapper",properties:{cameraSizes:null},publicProperties:{bottom:null,left:null,right:null,top:null,x:0,y:0},initialize:function(){this.aabb=t.setUp(),this.lastBottom=null,this.lastLeft=null,this.lastRight=null,this.lastTop=null,this.cameraSizesIndex=-1},events:{"handle-logic":function(){var t=this.bottom,e=this.left,i=this.right,n=this.top;this.lastBottom===t&&this.lastLeft===e&&this.lastRight===i&&this.lastTop===n||(this.updatePosition(this.aabb),this.lastBottom=t,this.lastLeft=e,this.lastRight=i,this.lastTop=n)},"camera-update":function(t){this.aabb.set(t.viewport),this.cameraSizes&&this.checkCamera(this.aabb),this.updatePosition(this.aabb)}},methods:{checkCamera:function(t){var e=this.cameraSizes,i=0,n=t.width/t.height;for(i=0;i<e.length;i++)if(n>e[i].minRatio){i!==this.cameraSizesIndex&&(this.updateProperties(e[i]),this.cameraSizesIndex=i);break}},updateProperties:function(t){this.right="number"==typeof t.right?t.right:null,this.left="number"==typeof t.left?t.left:null,this.top="number"==typeof t.top?t.top:null,this.bottom="number"==typeof t.bottom?t.bottom:null,"number"==typeof t.x&&(this.x=t.x),"number"==typeof t.y&&(this.y=t.y)},updatePosition:function(t){var e=this.bottom,i=this.left,n=this.owner,s=this.right,r=this.top;"number"==typeof i?n.x=t.left+i:"number"==typeof s&&(n.x=t.right-s),"number"==typeof r?n.y=t.top+r:"number"==typeof e&&(n.y=t.bottom-e)},destroy:function(){this.aabb.recycle(),this.aabb=null}}})}(),function(){"use strict";var t={age:1,orientation:0,velocity:null},e=include("platypus.AABB"),i=include("Box2D.b2Vec2"),n=include("Box2D.b2Fixture"),s=include("Box2D.helpers.getUserData"),r=Math.PI/2,o=new i(0,0),a=new i(0,0),h=new Box2D.JSRayCastCallback;h.ReportFixture=function(t,e,r,o){var a=Box2D.wrapPointer(t,n),h=Box2D.wrapPointer(e,i),l=Box2D.wrapPointer(r,i),c=s(a.GetBody()).entity.type;return"wall"===c||"wall-storm"===c||"ice"===c?(this.m_fixture=a,this.m_point=h,this.m_normal=l,this.m_fraction=o,o):-1},platypus.createComponentClass({id:"Rocket",properties:{horizontal:!1,defaultVolume:1},publicProperties:{},initialize:function(){this.owner.parent.smokeParticles||(this.owner.parent.smokeParticles=[]),this.smokeParticles=this.owner.parent.smokeParticles,this.maxForce=.14,this.minForce=.07,"moon"===this.owner.parent.planet?(this.maxForce=.14,this.minForce=.07):"mars"===this.owner.parent.planet?(this.maxForce=.14*1.5,this.minForce=.07*1.5):"europa"===this.owner.parent.planet&&(this.maxForce=.14,this.minForce=.07),this.fuel=1e4,this.firing=!1,this.firingTime=0,this.accelTime=200,this.forceVector=new i(0,0),this.boostDistance=512/30,this.sinceLastParticle=0,this.owner.state.set("used",!1),this.ifHorizontal=0,this.horizontal&&(this.ifHorizontal=Math.PI/2),this.cameraPosition=e.setUp(),this.panRange=0,this.simulating=!1},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.15*this.cameraPosition.width,2)},"handle-logic":function(t){var e=t.delta,i=0,n=0,s=0,a=null;this.simulating&&this.firing&&(this.fuel?(this.figureOutPan(),this.fuel=Math.max(this.fuel-e,0),this.firingTime+=e,s=this.owner.orientation-r+this.ifHorizontal,a=this.owner.body.GetWorldCenter(),o.Set(a.get_x()+Math.cos(s)*this.boostDistance,a.get_y()+Math.sin(-s)*this.boostDistance),this.owner.parent.world.RayCast(h,a,o),n=h.m_fraction<1?Math.pow(.25,2*h.m_fraction)*this.maxForce:0,this.firingTime<=this.accelTime&&(i=this.firingTime/this.accelTime,n*=Math.sin(i*Math.PI-r)/2+.5),n+=this.minForce,this.emitParticles(e,this.fuel/1e4,1),this.forceVector.Set(Math.cos(s)*n,Math.sin(s)*n),this.owner.body.ApplyForce(this.forceVector,this.owner.body.GetWorldCenter(),!0)):(this.owner.triggerEvent("stop-audio"),this.firing=!1,this.owner.state.set("used",!0),this.owner.parent.triggerEvent("rl-play-rocket-is-dead")))},"rocket-start":function(){this.simulating&&this.fuel&&!this.firing&&(this.firing=!0,this.owner.triggerEvent("burn-"+Math.floor(5*Math.random())))},"rocket-stop":function(){this.owner.triggerEvent("stop-audio"),this.firing=!1,this.firingTime=0},"simulation-started":function(){this.simulating=!0},"simulation-stopped":function(){this.simulating=!1,this.firing=!1,this.owner.state.set("used",!1),this.fuel=1e4,this.owner.triggerEvent("stop-audio"),this.owner.body.SetLinearVelocity(a),this.owner.body.SetAngularVelocity(0),this.owner.body.SetAwake(!1)},"recycle-particle":function(t){this.smokeParticles.push(t)}},methods:{figureOutPan:function(){var t,e,i=this.cameraPosition,n=0;t=Math.pow(this.owner.x-i.x,2)+Math.pow(this.owner.y-i.y,2),e=Math.max(1-t/this.panRange,0),n=this.owner.x>i.right?1:this.owner.x<i.left?-1:(this.owner.x-i.left)/i.width*2-1,this.owner.triggerEvent("set-pan",n,"rocket-engine"),this.owner.triggerEvent("set-volume",e*this.defaultVolume,"rocket-engine")},emitParticles:function(t,e,i){var n=750*(1-i<.1?.1:1-i);this.sinceLastParticle+=t,this.sinceLastParticle>=n&&(this.sinceLastParticle-=n,this.launchParticle(e))},launchParticle:function(e){var i=null,n=0,s=null,o=this.owner.orientation-r+this.ifHorizontal;if(this.smokeParticles.length>0)(i=this.smokeParticles.pop()).x=this.owner.x-32*Math.cos(o),i.y=this.owner.y+32*Math.sin(-o),i.z=this.owner.z-.01;else{for(n=0;n<10;n++)s={type:"smoke-particle",properties:{x:this.owner.x-32*Math.cos(o),y:this.owner.y+32*Math.sin(-o),z:this.owner.z-.01,rocket:this.owner}},i=this.owner.parent.addEntity(s),this.smokeParticles.push(i);i=this.smokeParticles.pop()}t.fuel=e,t.orientation=this.owner.orientation+r+this.ifHorizontal,t.velocity=this.owner.body.GetLinearVelocity(),i.triggerEvent("launch",t)}},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.Vector"),e=include("Box2D.getPointer"),i=include("Box2D.helpers.getUserData"),n=function(t,e){return t*t+e*e},s={x:0,y:0},r={points:[s,s,s,s,s,s,s,s]},o=1+Math.SQRT2;platypus.createComponentClass({id:"Rod",properties:{faceUpward:!1,maximum:500,minimum:50,width:100,height:40,unpinnable:!1},publicProperties:{z:0,pointA:null,pointB:null,shape:null,trussLength:0,rotation:0,stretchLength:0,movable:!0},initialize:function(){var t,e=this.shape||r,i=this.owner.parent,n=e.points,s=n.length;for(this.shape={points:[]};s--;)this.shape.points.unshift({x:n[s].x,y:n[s].y});this.unpinnable&&this.movable&&(this.unpinnable=!1),this.onlyRemovingComponentSoDontDropThePins=!1,this.trussLength=this.trussLength||this.owner.width||this.minimum,t=this.trussLength/2,this.pointA=this.pointA||{x:this.owner.x-t,y:this.owner.y},this.unpinnable||(this.pinA=this.createOrFindPin(this.pointA,i)),this.pointB?this.unpinnable||(this.pinB=this.createOrFindPin(this.pointB,i)):(this.pointB={x:this.owner.x+t,y:this.owner.y},this.unpinnable||(this.pinB=this.createPin(this.pointB,i))),this.graceMargin=platypus.game.app.config.pins.snapGraceMargin,this.originalMax=this.maximum,this.originalMin=this.minimum,this.graceMax=2*this.maximum,this.graceMin=this.minimum/2,this.enactAdjustment(),this.owner.matchBodyToEntity(),this.unpinnable||(this.pinA.attach(this.owner,!0,!1),this.pinB.attach(this.owner,!0,!1)),this.inMotion=!1},events:{"prepare-for-simulation":function(){var t=this.owner;this.onlyRemovingComponentSoDontDropThePins=!0,t.removeComponent(this),t.addComponent(new platypus.components.RodFrozen(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)},"validate-constraint":function(t){this.unpinnable||(t.entity===this.pinA?this.tryAdjustment(this.pinA,this.pinB,t):t.entity===this.pinB?this.tryAdjustment(this.pinB,this.pinA,t):platypus.debug.warn("Something odd occurred: notified about an unattached constraint movement."))},"pin-moved":function(){var t=this.pinA,e=this.pinB,i=this.pointA,n=this.pointB;t.x===i.x&&t.y===i.y&&e.x===n.x&&e.y===n.y||this.enactAdjustment()},"resolve-bodies":function(){this.owner.matchBodyToEntity()},"resolve-joints":function(){this.unpinnable||(this.pinA.resetJoints(),this.pinB.resetJoints())},"update-group-id":function(t){this.owner.groupId=t,this.unpinnable||(t!==this.pinA.groupId&&this.pinA.triggerEvent("update-group-id",t),t!==this.pinB.groupId&&this.pinB.triggerEvent("update-group-id",t))},"lost-pin":function(){var t=this.owner;t.parent.removeEntity(t)},"pin-added":function(t){var e=this.closestPin(t);this.unpinnable||(e===this.pointA?this.pinA=t:e===this.pointB?this.pinB=t:platypus.debug.warn("Rod: uh, this is odd."))},"pin-removed":function(t){t===this.pinA?this.pinA=null:t===this.pinB?this.pinB=null:platypus.debug.warn("Rod: A pin was removed that cannot be removed so it was not removed.")},"validate-begin-group-movement":function(t){this.unpinnable||t.invalid||!this.pinA.inDragGroup&&!this.pinB.inDragGroup||(t.invalid=!0)},"begin-group-movement":function(t){this.unpinnable||(this.pinA.triggerEvent("include-in-group",t),this.pinB.triggerEvent("include-in-group",t),this.inMotion=!0,this.owner.movable&&(this.pinA.immobile||this.pinB.immobile)?(this.pinA.split(this.owner),this.pinB.split(this.owner)):this.prepareForBreakage=!0)},"break-away":function(){this.prepareForBreakage&&(this.prepareForBreakage=!1,this.pinA.split(this.owner),this.pinB.split(this.owner))},"include-in-group":function(){this.prepareForBreakage=!1,this.inMotion=!0},"motion-ended":function(){this.inMotion=!1},"pin-motion-ended":function(){this.minimum=Math.min(this.trussLength,this.originalMin),this.maximum=Math.max(this.trussLength,this.originalMax)},"valid-snap":function(t,e){var i=t.pinFrom,n=t.pinTo;0===e?i===this.pinA?t.snappable=this.pinB.canSnapTo(t,e+1):i===this.pinB&&(t.snappable=this.pinA.canSnapTo(t,e+1)):1===e&&(this.pinA!==n&&this.pinB!==n||(t.snappable=!1))}},methods:{closestPin:function(t){var e=this.pointA,i=this.pointB;return n(e.x-t.x,e.y-t.y)>n(i.x-t.x,i.y-t.y)?i:e},createOrFindPin:function(t,e){var i=this.findPin(t,e.pins);return i&&i!==this.pinA&&i!==this.pinB?i:this.createPin(t,e)},createPin:function(t,e){return e.addEntity({type:"pin",properties:{x:t.x,y:t.y,handshake:t.handshake||0,vertical:t.vertical||!1,weld:t.weld||!1,tread:t.tread||!1,beam:!0,kitchen:t.kitchen||!1}})},findPin:function(t,e){var i=platypus.game.app.config.pins.mergeDistance,s=0,r=null,o=e&&e.length,a=i*i,h=null;if(o)for(;o--;)r=e[o],(s=n(r.x-t.x,r.y-t.y))<a&&r.handshake+t.handshake===0&&(a=s,h=r);return h},stretch:function(t,n){var s=this.owner,r=s.body,a=null,h=null,l=null,c=this.shape.points,p=this.pointA,u=this.pointB;if(4===c.length)!function(t,e,i){var n=t[0],s=t[1],r=t[2],o=t[3];n.x=-e,n.y=-i,s.x=e,s.y=-i,r.x=e,r.y=i,o.x=-e,o.y=i}(c,t/2,n/2);else if(6===c.length)!function(t,e,i){var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],h=t[5];n.x=-e,n.y=-i,s.x=e,s.y=-i,r.x=e+i,r.y=0,o.x=e,o.y=i,a.x=-e,a.y=i,h.x=-e-i,h.y=0}(c,t/2,n/2);else{if(8!==c.length)return void platypus.debug.warn(this.owner.type+": This entity is not using a rectangle for stretching.");!function(t,e,i){var n=i/o,s=t[0],r=t[1],a=t[2],h=t[3],l=t[4],c=t[5],p=t[6],u=t[7];s.x=-e-n,s.y=-i,r.x=e+n,r.y=-i,a.x=e+i,a.y=-n,h.x=e+i,h.y=n,l.x=e+n,l.y=i,c.x=-e-n,c.y=i,p.x=-e-i,p.y=n,u.x=-e-i,u.y=-n}(c,t/2,n/2)}s.x=(p.x+u.x)/2,s.y=(p.y+u.y)/2,r&&(l={},h=r.GetFixtureList(),0!==e(h)&&(a=h.GetFilterData(),l.filter={categoryBits:a.get_categoryBits(),groupIndex:a.get_groupIndex(),maskBits:a.get_maskBits()},l.density=h.GetDensity(),l.friction=h.GetFriction(),l.restitution=h.GetRestitution(),l.isSensor=h.IsSensor(),l.userData=i(h),r.DestroyFixture(h)),this.owner.createFixture(l,{}))},tryAdjustment:function(e,i,s){var r,o=null,a=s.position,h=a.x,l=a.y,c=null,p=this.minimum,u=this.maximum;this.inMotion||(this.owner.movable?(s.forSnap&&((p-=this.graceMargin)<this.graceMin&&(p=this.graceMin),(u+=this.graceMargin)>this.graceMax&&(u=this.graceMax)),(r=Math.sqrt(n(h-i.x,l-i.y)))<p?(c=t.setUp(i.x,i.y),s.adjusted=o=t.setUp(h,l),o.subtractVector(c).normalize(),0!==o.magnitude()?o.multiply(p).addVector(c):(o.x=p,o.addVector(c))):r>u&&(c=t.setUp(i.x,i.y),s.adjusted=o=t.setUp(h,l),o.subtractVector(c).normalize(),o.multiply(u).addVector(c))):s.adjusted=t.setUp(e.x,e.y))},enactAdjustment:function(){var t=this.owner,e=this.pinA,i=this.pinB,s=this.pointA,r=this.pointB,o=e?s.x=e.x:s.x,a=e?s.y=e.y:s.y,h=(i?r.x=i.x:r.x)-o,l=(i?r.y=i.y:r.y)-a,c=Math.sqrt(n(h,l)),p=Math.atan(l/h);!this.faceUpward&&h<0&&(p+=Math.PI),this.stretch(c,this.height),t.orientation=p,this.trussLength=c,this.stretchLength=c,this.rotation=180*p/Math.PI},destroy:function(){var t=this.pinA,e=this.pinB;this.onlyRemovingComponentSoDontDropThePins||(t&&!t.destroyed&&t.detachPermanently(this.owner),e&&!e.destroyed&&e.detachPermanently(this.owner))}},publicMethods:{getConnectedEntities:function(){var t=[],e=null,i=0;for(i=(e=this.pinA.getPinnedEntities()).length;i--;)e[i]!==this.owner&&t.indexOf(e[i].id)<0&&t.push(e[i].id);for(i=(e=this.pinB.getPinnedEntities()).length;i--;)e[i]!==this.owner&&t.indexOf(e[i].id)<0&&t.push(e[i].id);return t}}})}(),function(){"use strict";platypus.createComponentClass({id:"RodFrozen",initialize:function(){},events:{"restore-dragging":function(){var t=this.owner;t.pinA=null,t.pinB=null,t.removeComponent(this),t.addComponent(new platypus.components.Rod(this.owner,{})),t.parent.triggerEvent("child-entity-updated",t)}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"SailLogic",properties:{},publicProperties:{},initialize:function(){this.owner.state.set("high",!1),this.owner.state.set("full",!1),this.fullTimer=0,this.forceVector=null},events:{"handle-logic":function(t){var e=t.delta;this.fullTimer&&(this.fullTimer-=e,this.fullTimer<=0?(this.fullTimer=0,this.owner.state.set("full",!1)):this.owner.body.ApplyForce(this.forceVector,this.owner.body.GetWorldCenter(),!0))},"simulation-started":function(){var e=this.owner.parent.getEntitiesByType("sail").length;this.forceVector=new t(.16/(e+1),0)},"simulation-stopped":function(){this.fullTimer=0},"sail-up":function(){this.owner.state.set("high",!0)},"sail-down":function(){this.fullTimer=0,this.owner.state.set("full",!1),this.owner.state.set("high",!1)},"caught-wind":function(){this.owner.state.get("high")&&(this.owner.state.set("full",!0),this.fullTimer=2500)}},methods:{},publicMethods:{}})}(),function(){"use strict";platypus.createComponentClass({id:"SavedGameChecker",events:{"scene-live":function(){var t=platypus.savedGame;t?platypus.game.loadScene("scene-level",{level:t.level}):platypus.supports.mobile?platypus.game.loadScene("scene-level",{level:"level-earth"}):platypus.game.loadScene("scene-level",{level:"level-all"})}}})}(),function(){"use strict";var t,e=include("platypus.Data"),i=0;platypus.createComponentClass({id:"SavedGameLister",properties:{},publicProperties:{},initialize:function(t,e){var i=platypus.game.app,n=platypus.game.app.config.journal;return this.saves=null,this.savesTotal=0,this.saveTime=Date.now(),this.buttons=[],this.owner.parent.app.userData.read(n.storageKey,function(t){var i=platypus.game.app,s=0,r=this.buttons,o=n.maxSavesPerGame;for(this.saves=t,s=0;s<o;s++)t&&t[s]?r.push(this.addSave(t[s],0,0,s)):r.push(this.addEmpty(0,0));this.tableColumns=this.tableColumns||3,this.updateLocations(),i.googleAnalytics.event(i.name,"EnterSaveMenu","NumberOfSaves",this.savesTotal),e()}.bind(this)),i.music="jam",i.musicInstance.volume=.5,platypus.badger.increment("tried-journal"),!0},events:{"camera-update":function(t){var e=t.viewport,i=e.width/e.height>1.766?3:2;this.tableColumns!==i&&(this.tableColumns=i,this.updateLocations())},"scene-loaded":function(t){var e=t.insertSave,i=null,n=this.owner.getEntitiesByType("journal-insert")[0];e?(this.insertSave=e,this.savedEntry=this.addSave(e,0,n.y,-1,function(){this.triggerEvent("insert-incoming")}.bind(this.owner),n.cameraSizes),(i=this.savedEntry.deletes).scaleX=.5,i.scaleY=.5,i.z=20,i.on("handle-render",function(t){t.x=this.x+135}.bind(i,this.savedEntry)),this.savedEntry.y=-550,this.savedEntry.z=30):this.saves&&this.saves.length?this.owner.triggerEvent("journal-some"):this.owner.triggerEvent("journal-none")},"return-to-game":function(){this.returnToGame&&this.returnToGame.deletes.triggerEvent("new-scene")},"delete-me":(t=function(t){this.removeEntity(t.deletes),this.removeEntity(t)},function(e){var i=platypus.game.app,n=i.userData,s=e.entity,r=this.savedEntry,o=i.config.journal;if(r){if(-1===s.deletes.saveIndex)return void s.deletes.triggerEvent("new-scene");this.saves[s.deletes.saveIndex]=this.insertSave,this.buttons[s.deletes.saveIndex]=this.returnToGame=this.addSave(this.insertSave,s.deletes.x,s.deletes.y,s.deletes.saveIndex),r.on("prepare-logic",t.bind(this.owner,r)),this.insertSave=null,this.savedEntry=null,this.owner.triggerEvent("inserted-save")}else this.saves[s.deletes.saveIndex]=null,this.buttons[s.deletes.saveIndex]=this.addEmpty(s.deletes.x,s.deletes.y);try{n.write(o.storageKey,this.saves)}catch(t){this.saves[s.deletes.saveIndex]&&(this.saves[s.deletes.saveIndex].thumbnail=null,n.write(o.storageKey,this.saves))}s.on("prepare-logic",t.bind(this.owner,s))})},methods:{addEmpty:function(t,e){var i=platypus.game.app.config.journal.thumbnail;return this.owner.addEntity({type:"saved-game-empty",properties:{width:i.width,height:i.height,x:t,y:e,z:8}})},addSave:function(t,n,s,r,o,a){var h=null,l=null,c=new Image,p=platypus.game.app.config.journal,u=platypus.modifyAllAssets,d=p.thumbnail.width/2,g=p.thumbnail.height/2,y=d/2,m=g/2;return this.savesTotal+=1,o&&(h=function(t,e){t.count-=1,t.count||(t.recycle(),e())}.bind(null,e.setUp("count",2),o)),t.thumbnail?c.src=t.thumbnail:c="thumbnail-backup",l=this.owner.addEntity({type:"saved-game-button",properties:{x:n,y:s,z:15,cameraSizes:a,spriteSheet:{id:"saved-ss-"+i,images:[c],frames:[[0,0,d*u,g*u,0,y*u,m*u]]},persistentData:{level:t.level},events:null,saveIndex:r}},h),i+=1,l.components[l.components.length-3].sprite.scale.x=2,l.components[l.components.length-3].sprite.scale.y=2,this.owner.addEntity({type:"delete-saved-game-button",properties:{deletes:l,x:n+y,y:s-m,z:16}},h)},updateLocations:function(){for(var t=this.buttons,e=null,i=t.length,n=platypus.game.app.config.journal,s=n.thumbnail.width,r=s/2,o=n.thumbnail.height,a=o/2,h=n.maxSavesPerGame,l=this.tableColumns,c=(h/l-1)/2,p=0,u=0,d=n.spacing+s,g=n.spacing+o;i--;)p=(i%l-(l-1)/2)*d,u=((i/l>>0)-c)*g,(e=t[i]).deletes&&(e.x=p+r,e.y=u-a,e=e.deletes),e.x=p,e.y=u,e.totalSaves=this.savesTotal},destroy:function(){var t=platypus.game.app;t.googleAnalytics.event(t.name,"ExitSaveMenu","SaveMenuTime",Date.now()-this.saveTime>>0)}},getAssetList:function(){return Array.setUp("assets/images/delete-button.png","assets/images/journal-frame.png","assets/images/thumbnail-backup.png")}})}(),function(){"use strict";var t=include("platypus.Data");platypus.createComponentClass({id:"SceneChanger",properties:{scene:"",persistentData:null},initialize:function(){this.persistentData=t.setUp(this.persistentData),this.loadingScene=!1},events:{"new-scene":function(t){var e=t||this,i=e.scene||this.scene,n=e.persistentData||this.persistentData;this.loadingScene||(this.loadingScene=!0,platypus.game.loadScene(i,n))},"set-scene":function(t){this.scene=t},"set-persistent-scene-data":function(t){var e=this.persistentData,i="";for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}},methods:{destroy:function(){}}})}(),function(){"use strict";platypus.createComponentClass({id:"Scroller",properties:{direction:""},publicProperties:{},initialize:function(){this.c=0,this.show=this.owner.left,this.hide=-this.owner.left},events:{adopted:function(){this.owner.state.set(this.direction,!0)},pointerdown:function(){this.owner.parent.triggerEvent("scroll-"+this.direction),this.owner.state.set(this.direction,!1),this.owner.state.set(this.direction+"-pressed",!0),this.c=1},pointerup:function(){this.release()},pointerupoutside:function(){this.release()},pointercancel:function(){this.release()},pointerover:function(){this.owner.state.set("hover",!0)},pointerout:function(){this.owner.state.set("hover",!1)},"hide-sprite":function(){this.release()},"handle-logic":function(){this.c>0&&(this.c++,this.c%20==0&&this.owner.parent.triggerEvent("scroll-"+this.direction))},"start-simulation":function(){this.owner.left=this.hide},"stop-simulation":function(){this.owner.left=this.show}},methods:{release:function(){this.owner.state.set(this.direction+"-pressed",!1),this.owner.state.set(this.direction,!0),this.c=0}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("platypus.Data"),i=include("Box2D.destroy"),n=include("Box2D.getPointer"),s=include("Box2D.helpers.getUserData");platypus.createComponentClass({id:"ShrinkPopper",properties:{ejectForce:null,size:.5,slowExpand:!1,transition:10,single:!0},publicProperties:{shape:null},initialize:function(t){var e=this.owner;this.scaleX=0,this.scaleY=0,this.transition=t.ticks||10,this.delay=this.transition+(t.delay||0),this.finish=this.delay+this.transition,this.ticks=this.transition,this.stage="begin",this.shrinker=t.shrinker||this.owner,e.scaleX=this.scaleX=e.scaleX||1,e.scaleY=this.scaleY=e.scaleY||1,e.state.shrunk=!0,this.saved={points:this.shape.points||null,radius:this.shape.radius||0,scaleX:e.scaleX=e.scaleX||1,scaleY:e.scaleY=e.scaleY||1,width:this.shape.width,height:this.shape.height},this.shape={points:this.shape.points||null,radius:this.shape.radius||0,width:this.shape.width,height:this.shape.height},this.busy=!1},events:{"handle-logic":function(){},"shrink-pop":function(t,i){var n=null;this.busy||(this.busy=this.single,n=e.setUp("sequence",Array.isArray(t)?t:[t],"time",0,"finish",null),this.owner.body.SetActive(!1),n.finish=function(t,e,i){t.recycle(),e||this.owner.body.SetActive(!0),this.removeEventListener("handle-logic",i),this.busy=!1}.bind(this,n,i,this.addEventListener("handle-logic",function(t,e){this.resolveSequence(t,e.delta)}.bind(this,n))))},eject:function(e){var n=this.owner.body,s=new t(e.x,e.y);n.SetActive(!0),n.SetLinearVelocity(s),n.SetAngularVelocity(e.x>0?3:e.x<0?-3:0),i(s)}},methods:{destroy:function(){},updateVertices:function(t,e,i){var n=t.length,s=[];for(n=0;n<t.length;n++)s.push({x:t[n].x*e,y:t[n].y*i});return s},resolveSequence:function(t,e){var i=t.sequence,n=i[0],s=typeof n;"undefined"===s?t.finish():"number"===s?n>e?i[0]-=e:(i.greenSplice(0),this.resolveSequence(t,e-n)):"string"===s||n.event||Array.isArray(n)?(n.relativeTo&&(n.message.x=Math.cos(n.relativeTo.orientation)*n.message.x-Math.sin(n.relativeTo.orientation)*n.message.y,n.message.y=Math.sin(n.relativeTo.orientation)*n.message.x+Math.cos(n.relativeTo.orientation)*n.message.y,n.relativeTo=null),this.owner.trigger(n),i.greenSplice(0),this.resolveSequence(t,e)):void 0!==n.time&&(n.progress=n.progress||0,n.progress+=e,n.progress<n.time?this.updateValues(n,n.progress/n.time):(this.updateValues(n,1),i.greenSplice(0),this.resolveSequence(t,e-(n.progress-n.time))))},scaleFixture:function(t,e){var i=this.owner.body,r=null,o=null,a=null,h=this.saved,l=h.points,c=h.radius,p=h.width,u=h.height,d=null;if(l)this.shape.points=this.updateVertices(l,t,e);else if(c)this.shape.radius=c*t;else{if(!p||!u)return void platypus.debug.warn(this.owner.type+": This entity is not scalable using ShrinkPopper.");this.shape.width=p*t,this.shape.height=u*e}if(i){for(a={},o=i.GetFixtureList();0!==n(o);)r=o.GetFilterData(),a.filter={categoryBits:r.get_categoryBits(),groupIndex:r.get_groupIndex(),maskBits:r.get_maskBits()},a.density=o.GetDensity(),a.friction=o.GetFriction(),a.restitution=o.GetRestitution(),a.isSensor=o.IsSensor(),a.userData=s(o),d=o.GetNext(),i.DestroyFixture(o),o=d;this.owner.createFixture(a,{})}},updateValues:function(t,e){var i=this.saved,n=t.originals,s="",r=0,o=0,a=0,h=0;if(!n){for(s in n={},t)t.hasOwnProperty(s)&&"time"!==s&&"progress"!==s&&"relativeTo"!==s&&(void 0===this.owner[s]?this.owner[s]=t[s]:typeof this.owner[s]==typeof t[s]&&(i[s]||(i[s]=1),n[s]=i[s]*this.owner[s]));t.originals=n}for(s in n)n.hasOwnProperty(s)&&(t.relativeTo&&("x"===s||"y"===s)||t.relativeTo&&"orientation"===s||(this.owner[s]=i[s]*(n[s]*(1-e)+t[s]*e)));t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.relativeTo&&(r=Math.cos(t.relativeTo.orientation)*t.x-Math.sin(t.relativeTo.orientation)*t.y,o=Math.sin(t.relativeTo.orientation)*t.x+Math.cos(t.relativeTo.orientation)*t.y,a=Math.cos(t.relativeTo.orientation)*t.offOriginX-Math.sin(t.relativeTo.orientation)*t.offOriginY,h=Math.sin(t.relativeTo.orientation)*t.offOriginX+Math.cos(t.relativeTo.orientation)*t.offOriginY,this.owner.x=t.relativeTo.x+a*(1-e)+r*e,this.owner.y=t.relativeTo.y+h*(1-e)+o*e),t.hasOwnProperty("orientation")&&t.relativeTo&&(this.owner.orientation=t.relativeTo.orientation,this.owner.rotation=180*this.owner.orientation/Math.PI),(n.bodyScale||n.bodyScaleX||n.bodyScaleY)&&(1===e||this.owner.body.IsActive())&&this.scaleFixture(this.owner.bodyScaleX||this.owner.bodyScale||1,this.owner.bodyScaleY||this.owner.bodyScale||1),n.gravityScale&&this.owner.body.SetGravityScale(this.owner.gravityScale)}}})}(),function(){"use strict";var t=2,e={pointA:"json",pointB:"json",radius:"string",renderGroup:"string",stretchLength:"string",trussLength:"string"},i=include("Box2D.b2Vec2"),n=include("Box2D.destroy"),s=include("Box2D.getPointer"),r=function(t,e,i,n){switch(t){case"json":o(e,i,n);break;default:a(e,i,n)}},o=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:JSON.stringify(e[i])})},a=function(t,e,i){void 0!==e[i]&&t.push({name:i,type:"string",value:e[i]+""})};platypus.createComponentClass({id:"Sim",properties:{},publicProperties:{movable:!0,savable:!1,inBuildingArea:!1,interactive:!1,simulating:!1},initialize:function(){this.allowSleep=!1,this.sensors=Array.setUp(),this.activeType=0,this.snapShot=null},events:{load:function(){!this.simulating&&this.movable||this.owner.triggerEvent("remove-dragging",!0,this.simulating)},"box2d-body-initialized":function(){var e=this.owner.body,i=e.GetFixtureList(),n=this.sensors;if(!this.simulating)for(e.IsSleepingAllowed()&&(this.allowSleep=!0,e.SetSleepingAllowed(!1)),this.activeType=e.GetType(),this.interactive&&this.activeType!==t&&(e.SetType(t),this.owner.parent.buildingArea&&(this.inBuildingArea=this.owner.parent.buildingArea.body.GetFixtureList().TestPoint(e.GetPosition())));0!==s(i);)n.push(i.IsSensor()),i.SetSensor(!0),i=i.GetNext()},"retrieve-save-state":function(t,i){var n=null;(this.savable||i&&"boolean"==typeof this.owner.movable&&!this.owner.neverSave)&&(n=function(t,i){var n=e,s="",o=[],a={height:t.height||0,id:0,name:"",properties:o,rotation:t.rotation||0,type:t.type,visible:!0,width:t.width||0,x:t.x||0,y:t.y||0},h=!1;for(s in o.push({name:"z",type:"string",value:t.z%1e3}),t.shape&&t.saveShape?t.shape.points?(h=!0,a.polygon=t.shape.points):(o.push({name:"shape",type:"string",value:JSON.stringify(t.shape)}),"circle"===t.shape.type&&(a.ellipse=!0,a.width=2*t.shape.radius,a.height=2*t.shape.radius),a.x-=a.width/2,a.y-=a.height/2):(a.x-=a.width/2,a.y-=a.height/2),h||t.width||t.height||(a.point=!0),n)n.hasOwnProperty(s)&&r(n[s],o,t,s);return!i&&t.savable&&o.push({name:"savable",type:"string",value:"true"}),i&&t.movable&&o.push({name:"movable",type:"string",value:"false"}),a}(this.owner,i),t.push(n)),this.owner.snapShot=this.snapShot={rotation:this.owner.rotation,x:this.owner.x,y:this.owner.y}},"restore-save-state":function(){var t,e;this.snapShot?(t=this.owner,e=this.snapShot,t.x=e.x,t.y=e.y,t.rotation=e.rotation,t.body&&t.body.SetActive(!0)):this.savable&&this.owner.parent.removeEntity(this.owner)},"simulation-started":function(){var e=this.owner.body,i=null,n=this.sensors,r=0;if(!this.simulating&&e)for(this.simulating=!0,this.interactive&&this.activeType!==t&&e.SetType(this.activeType),this.allowSleep&&e.SetSleepingAllowed(!0),i=e.GetFixtureList();0!==s(i);)i.SetSensor(n[r]),r+=1,i=i.GetNext();this.owner.triggerEvent("prepare-for-simulation"),this.owner.triggerEvent("remove-dragging",!1,!0)},"simulation-stopped":function(){var e=this.owner.body,r=null,o=null;if(this.simulating&&e)for(this.simulating=!1,this.interactive&&this.activeType!==t&&e.SetType(t),this.allowSleep&&e.SetSleepingAllowed(!1),o=new i(0,0),e.SetAngularVelocity(0),e.SetLinearVelocity(o),this.owner.orientation=0,this.owner.matchBodyToEntity(),n(o),r=e.GetFixtureList();0!==s(r);)r.SetSensor(!0),r=r.GetNext();this.owner.triggerEvent("restore-dragging",!1,!0)}},methods:{destroy:function(){this.sensors.recycle(),this.sensors=null}},publicMethods:{}})}(),function(){"use strict";var t=include("createjs.Ease"),e=include("createjs.Tween");platypus.createComponentClass({id:"Smoke",properties:{},initialize:function(){},events:{adopted:function(){var i=this.owner;e.get(i).to({y:i.y-95,opacity:.01,scaleX:2,scaleY:2},1500,t.sineOut).call(function(){var t=this.owner;t.destroyed||t.parent.removeEntity(t)}.bind(this))}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"SmokeParticleLogic",properties:{rocket:null},publicProperties:{},initialize:function(){this.lifetime=1e3,this.active=!1,this.linearVelocity=new t(0,0),this.angularVelocity=0,this.owner.state.set("particle-0",!1),this.owner.state.set("particle-1",!1),this.owner.state.set("particle-2",!1),this.owner.scaleX=.6,this.owner.scaleY=.6,this.owner.tint="#ffffff"},events:{"handle-logic":function(t){var e=0,i=t.delta;this.active&&(this.lifetime-=t.delta,e=this.lifetime/1e3,this.lifetime<=0?this.recycleMe():(this.owner.opacity=e,this.owner.scaleX=.6+1.25*(1-e),this.owner.scaleY=.6+1.25*(1-e),this.owner.x+=this.linearVelocity.get_x()*i,this.owner.y+=this.linearVelocity.get_y()*i,this.linearVelocity.op_mul(.97),this.owner.rotation+=this.angularVelocity*i))},launch:function(t){var e=t.fuel,i=Math.random()+Math.random()-1,n=t.orientation+i*Math.PI/4,s=.3*(1-Math.abs(i))+.04,r=Math.floor(3*Math.random());this.active||(this.active=!0,this.owner.opacity=1,this.owner.state.set("particle-"+r,!0),this.owner.z+=.005*i,e<.1?this.owner.tint="#444444":e<.2?this.owner.tint="#777777":e<.3?this.owner.tint="#999999":e<.4?this.owner.tint="#aaaaaa":e<.5&&(this.owner.tint="#dddddd"),this.linearVelocity.Set(Math.cos(n)*s,Math.sin(n)*s),this.angularVelocity=i)},"simulation-stopped":function(){this.recycleMe()}},methods:{recycleMe:function(){this.lifetime=1e3,this.owner.x=-1e3,this.owner.y=-1e3,this.owner.scaleX=.6,this.owner.scaleY=.6,this.owner.tint="#ffffff",this.active=!1,this.opacity=0,this.owner.state.set("particle-0",!1),this.owner.state.set("particle-1",!1),this.owner.state.set("particle-2",!1),this.linearVelocity.Set(0,0),this.angularVelocity=0,this.rocket.triggerEvent("recycle-particle",this.owner)}},publicMethods:{}})}(),function(){"use strict";var t=include("Box2D.b2Vec2");platypus.createComponentClass({id:"Suckable",properties:{ejectSpeed:0,carried:!1,slow:!1},publicProperties:{},initialize:function(){this.attractedTo=null,this.suckForce=new t(0,0),this.originX=0,this.originY=0,this.remove=!1,this.magJoint=null,this.createMagJoint=null,this.canEnterJet2=0,this.connectedTo=null,this.lvl12Damaged=!1},events:{adopted:function(){if(this.originX=this.owner.x,this.originY=this.owner.y,0!==this.ejectSpeed){this.owner.body.GetFixtureList().GetDensity()<.002&&(this.owner.body.GetFixtureList().SetDensity(.1),this.owner.body.ResetMassData());var e=new t(.2*this.ejectSpeed,-1*Math.abs(.8*this.ejectSpeed));this.owner.body.ApplyLinearImpulse(e,this.owner.body.GetWorldCenter()),this.owner.body.SetGravityScale(1),this.owner.body.ApplyTorque(this.randRange(-10,10)),this.owner.parent.triggerEvent("ejectFX")}this.slow&&this.owner.body.SetGravityScale(.075)},"handle-logic":function(){if(this.attractedTo&&!this.magJoint){if((this.owner.x<this.attractedTo.x?"L":"R")!=this.attractedTo.facing&&!this.attractedTo.magnet)return;if((a=this.attractedTo.x-this.owner.x,h=this.attractedTo.y-this.owner.y,a*a+h*h)>15e4)return;this.slow&&this.owner.body.SetGravityScale(1);var e=this.owner.body.GetWorldCenter(),i=this.attractedTo.body.GetWorldCenter(),n=0;"X"!=this.attractedTo.facing&&(n=-1);var s=new t(i.get_x()-e.get_x(),i.get_y()+n-e.get_y()),r=s.Length(),o=("X"==this.attractedTo.facing?30:40)*this.owner.body.GetMass()*7/(r*r);this.suckForce.set_x(s.get_x()*o),this.suckForce.set_y(s.get_y()*o*3),this.owner.body.ApplyForce(this.suckForce,this.owner.body.GetWorldCenter(),!0),this.canEnterJet2=200}var a,h;this.canEnterJet2>0&&this.canEnterJet2--},"magnet-on":function(t){0===this.owner.body.GetGravityScale()||this.carried||this.attractedTo||(this.attractedTo=t)},"magnet-off":function(t){0===this.owner.body.GetGravityScale()||this.carried||(this.attractedTo=null)},reset:function(){this.owner.x=this.originX,this.owner.y=this.originY,this.owner.orientation=0},"collide-with-magnet":function(t){!this.magJoint&&this.attractedTo&&(this.createMagJoint=t.entity)},"collide-with-goal":function(){"level-17"!=this.owner.parent.levelId&&(this.remove=!0,this.owner.parent.triggerEvent("hand-out"),this.owner.parent.triggerEvent("enterBin"),this.owner.parent.triggerEvent("good"))},"prepare-logic":function(){this.remove&&(this.magJoint&&this.disconnect(),this.owner.parent.removeEntity(this.owner),this.remove=!1),this.createMagJoint&&(this.magJoint=this.owner.createJoint("distance",{localAnchorA:{x:0,y:0},localAnchorB:{x:0,y:0},length:55,collideConnected:!0},this.createMagJoint,1),this.createMagJoint.addTrash(this),this.owner.body.SetGravityScale(0),this.connectedTo=this.createMagJoint,this.createMagJoint=null)},"collide-with-jet2":function(){(null!==this.attractedTo||this.canEnterJet2>0)&&(this.remove=!0,this.owner.parent.triggerEvent("suckable-touch-jet2",this.owner),this.owner.parent.triggerEvent("enterJet"))},"collide-with-ground":function(){this.owner.body.SetAngularDamping(5),this.slow&&(this.owner.body.SetGravityScale(1),this.lvl12Damaged||this.owner.parent.triggerEvent("part-hit-ground"),this.lvl12Damaged=!0),this.owner.body.GetLinearVelocity()>1&&this.owner.parent.triggerEvent("thud")},"collide-with-trash":function(){this.owner.body.SetGravityScale(1)},"collide-with-apple":function(){this.owner.body.SetGravityScale(1)}},methods:{destroy:function(){this.attractedTo=null,this.suckForce=null,this.magJoint=null,this.createMagJoint=null,this.connectedTo=null},randRange:function(t,e){return Math.random()*(e-t)+t}},publicMethods:{released:function(){this.carried=!1},disconnect:function(t){this.owner.body.SetGravityScale(1),this.owner.removeJoint(this.magJoint),this.magJoint=null,this.attractedTo=null,t||this.connectedTo.removeTrash(this),this.connectedTo=null}}})}(),function(){"use strict";var t=include("platypus.Data"),e=function(t,e){for(var i=t.length;i--;)if(e===t[i].entity)return t[i];return null};platypus.createComponentClass({id:"Thrower",properties:{force:null,offset:null},publicProperties:{},initialize:function(){this.currents=Array.setUp(),this.launching=!1},events:{"throw-right":function(i){var n=this.currents,s=i.entity,r=e(n,s);r?(r.count+=1,r.eject="right"):n.push(t.setUp("entity",s,"eject","right","count",1,"sinceLaunch",1700))},"throw-left":function(i){var n=this.currents,s=i.entity,r=e(n,s);r?(r.count+=1,r.eject="left"):n.push(t.setUp("entity",s,"eject","left","count",1,"sinceLaunch",1700))},"lost-item":function(t){var i=this.currents,n=t.entity,s=e(i,n);s?(s.count-=1,s.count||function(t,e){for(var i=t.length;i--;)if(e===t[i].entity)return t.greenSplice(i);return null}(i,n).recycle()):platypus.debug.olive("Well, that was odd. Lost contact with a contact that was never made.")},"handle-logic":function(t){var e=this.currents,i=e.length,n=null,s=(this.owner,{x:0,y:0}),r={x:0,y:0};if(this.owner.simulating)for(;i--;)n=e[i],s.x=Math.cos(this.owner.orientation)*this.offset[n.eject].x-Math.sin(this.owner.orientation)*this.offset[n.eject].y,s.y=Math.sin(this.owner.orientation)*this.offset[n.eject].x+Math.cos(this.owner.orientation)*this.offset[n.eject].y,r.x=Math.cos(this.owner.orientation)*this.force[n.eject].x-Math.sin(this.owner.orientation)*this.force[n.eject].y,r.y=Math.sin(this.owner.orientation)*this.force[n.eject].x+Math.cos(this.owner.orientation)*this.force[n.eject].y,!this.launching&&n.sinceLaunch>=1700?(this.owner.triggerEvent("eject-"+n.eject),n.sinceLaunch=0,n.entity.triggerEvent("shrink-pop",[{bodyScale:.5,scaleX:.5,scaleY:.5,x:-1e3,y:-1e3,time:0},{time:1e3},{bodyScale:.5,scaleX:.5,scaleY:.5,x:this.offset[n.eject].x,y:this.offset[n.eject].y,relativeTo:this.owner,time:0},{event:"eject",message:{x:this.force[n.eject].x,y:this.force[n.eject].y},relativeTo:this.owner},{bodyScale:1,scaleX:1,scaleY:1,time:100}]),this.launching=!0):n.sinceLaunch+=t.delta},"animation-ended":function(t){this.owner.triggerEvent("stop-animation",t),this.launching=!1}},methods:{destroy:function(){this.currents.recycle(2),this.currents=null}},publicMethods:{}})}(),function(){"use strict";var t,e,i=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?(?:(([^\/?]+)\.(\w+))|([^\/?]+))(?:\?((?:(?:[^&]*?[\/=])?(?:((?:(?:[^\/?&=]+)\.(\w+)))\S*?)|\S+))?)?$/,n=include("platypus.AABB"),s=include("platypus.Data"),r=include("platypus.Entity"),o=(t=function(t,e){return t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24)>>>0},e=function(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0},function(i,n){var s=4,r=[],o=atob(i.replace(/\\/g,""));if("zlib"===n)for(o=pako.inflate(o);s<=o.length;)r.push(e(o,s-4)),s+=4;else for(;s<=o.length;)r.push(t(o,s-4)),s+=4;return r}),a=function(t){var e=t.match(i);return e[5]||e[7]},h=function(t){for(var e=1;e<t;)e*=10;return e},l={x:1,y:1,id:-1},c=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null},p=function(t,e,i){var n=0;if(t)if(Array.isArray(t)){for(n=t.length;n--;)if(t[n].name===e)return t[n].type=typeof i,void(t[n].value=i);t.push({name:e,type:typeof i,value:i})}else t[e]=i},u=function(t,e){var i,n,s,r,o=0,a=t.gid||-1,h={},c={gid:-1,transform:null,properties:h,type:""},p=null,u=null,g=0;for(-1!==a&&(c.transform=(s=!!(1073741824&(i=a)),r=!!(2147483648&i),(n=l).id=268435455&i,n.x=1,n.y=1,s&&(n.y=-1),r&&(n.x=-1),n),a=c.gid=l.id),o=0;o<e.length&&!(e[o].firstgid>a);o++)u=e[o];return u&&(g=a-u.firstgid,u.tileproperties&&u.tileproperties[g]&&(p=u.tileproperties[g]),u.tiles&&u.tiles[g]&&(c.type=u.tiles[g].type||"")),c.type=t.type||c.type,""===c.type&&(t.name?(c.type=t.name,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type using the "name" property has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):p&&(p.entity?(c.type=p.entity,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type using the "entity" property in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')):p.type&&(c.type=p.type,platypus.debug.warn('Component TiledLoader (loading "'+c.type+'"): Defining the entity type in the object properties has been deprecated. Define the type using the object\'s "type" property in Tiled instead.')))),c.type?(c.transform?(h.scaleX=c.transform.x,h.scaleY=c.transform.y):(h.scaleX=1,h.scaleY=1),d(p,c.properties),d(t.properties,c.properties),c):null},d=function(t,e){var i=0,n="";if(t&&e)if(Array.isArray(t))for(i=0;i<t.length;i++)p(e,t[i].name,g(t[i].value));else for(n in t)t.hasOwnProperty(n)&&p(e,n,g(t[n]));return e},g=function(t){var e=0;if("string"==typeof t){if(0===(e=parseFloat(t))||e)return e;if("true"===t)return!0;if("false"===t)return!1;if(t.length>1&&("{"===t[0]&&"}"===t[t.length-1]||"["===t[0]&&"]"===t[t.length-1]))try{return JSON.parse(t)}catch(t){}}return t},y=function(t,e){var i=0,n=0,o=Array.setUp(),a=null,h=Array.setUp(),l=null,p=null,d=null;if("string"==typeof t&&(t=platypus.game.settings.levels[t]),t)if(t.tilesets&&(t.tilesets=w(t.tilesets)),t.assets)h.union(t.assets);else if(t.layers){for(i=0;i<t.layers.length;i++)if("objectgroup"===t.layers[i].type)for(n=0;n<t.layers[i].objects.length;n++)(p=u(t.layers[i].objects[n],t.tilesets))&&(d=r.getAssetList(p),h.union(d),d.recycle());else"imagelayer"===t.layers[i].type?h.union([t.layers[i].image]):(p=c(t.layers[i].properties,"entity"))&&(l=s.setUp("type",p),a=r.getAssetList(l),h.union(a),a.recycle(),l.recycle());if(!e){for(i=0;i<t.tilesets.length;i++)o.push(t.tilesets[i].image);h.union(o),o.recycle()}t.assets=h.greenSlice()}return h},m={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]}},f=function(t){var e="",i=platypus.game.settings.levels[t.source.replace(".json","")];for(e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return delete t.source,t},w=function(t){var e=0;for(e=0;e<t.length;e++)t[e].source&&(t[e]=f(t[e]));return t};platypus.createComponentClass({id:"TiledLoader",properties:{offsetMap:!1,showCollisionTiles:!1,images:null,layerIncrement:1e3,separateTiles:!1,spriteSheet:null},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},initialize:function(){this.assetCache=platypus.game.app.assetManager.cache,this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(t,e){this.manuallyLoad||(e.count+=1,this.loadLevel({level:this.level||t.level,persistentData:t},e.release))},"load-level":function(t,e){this.loadLevel(t,e)}},methods:{createLayer:function(t,e,i,n,s,o,a,h,l,p){var u=null,g=null,y=e.width,f=e.height,w=e.tileheight||o,v=e.tilewidth||s,b=0,x=0,C=0,E=0,S=0,A=JSON.parse(JSON.stringify(platypus.game.settings.entities[t]||m[t])),k={},P=[],M=[],B=[],T={images:e.image?[e.image]:h,frames:M,animations:k},D=!1,L=null,I=null,z=0,X=0,O=0,U="",_=null,F=function(t,e,i,n){var s=i.margin||0,r=i.spacing||0,o=i.tilewidth,a=i.tileheight,h=o/2,l=a/2,c=o+r,p=a+r,u=2*s-r,d=i.columns||i.imagewidth/c+u>>0,g=i.imageheight/p+u>>0,y=0,m=0;for(o*=n,a*=n,h*=n,l*=n,c*=n,p*=n,m=0;m<g;m++)for(y=0;y<d;y++)t.push([s+y*c,s+m*p,o,a,e,h,l])};if(this.decodeLayer(e),_=e.data,i+=e.offsetx||0,n+=e.offsety||0,A.properties=A.properties||{},e.properties){if((E=c(e.properties,"width"))&&(b=parseInt(E,10)),(C=c(e.properties,"height"))&&(x=parseInt(C,10)),b||x){for(b=b||y,x=x||f,_=[],X=0;X<b;X++)for(O=0;O<x;O++)_[X+O*b]=X<y&&O<f?e.data[X+O*y]:0;y=b,f=x}d(e.properties,A.properties)}if("collision-layer"===t)for(I=[],X=0;X<a.length;X++)if((L=a[X]).tileproperties)for(U in L.tileproperties)L.tileproperties.hasOwnProperty(U)&&L.tileproperties[U].jumpThrough&&I.push(L.firstgid+parseInt(U,10));if(A.properties.width=v*y*this.unitsPerPixel,A.properties.height=w*f*this.unitsPerPixel,A.properties.columns=y,A.properties.rows=f,A.properties.tileWidth=v*this.unitsPerPixel,A.properties.tileHeight=w*this.unitsPerPixel,A.properties.scaleX=this.imagesScale,A.properties.scaleY=this.imagesScale,A.properties.layerZ=this.layerZ,A.properties.left=A.properties.x||i,A.properties.top=A.properties.y||n,A.properties.z=A.properties.z||this.layerZ,a.length){for(X=0;X<a.length;X++)F(M,X,a[X],this.unitsPerPixel/this.imagesScale);for(S=(u=a[a.length-1]).firstgid+u.tilecount,X=-1;X<S;X++)k["tile"+X]=X}for(X=0;X<y;X++)for(P[X]=[],B[X]=[],O=0;O<f;O++)z=+_[X+O*y]-1,B[X][O]="tile"+z,z+=1,I&&I.length&&I[0]===(268435455&z)&&(z|=268435456),P[X][O]=z;for(X=0;X<A.components.length;X++)"RenderTiles"===A.components[X].type&&(D=A.components[X]),"import"===A.components[X].spriteSheet?A.components[X].spriteSheet=T:A.components[X].spriteSheet&&("string"==typeof A.components[X].spriteSheet&&platypus.game.settings.spriteSheets[A.components[X].spriteSheet]&&(A.components[X].spriteSheet=platypus.game.settings.spriteSheets[A.components[X].spriteSheet]),A.components[X].spriteSheet.animations||(A.components[X].spriteSheet.animations=k)),"import"===A.components[X].collisionMap&&(A.components[X].collisionMap=P),"import"===A.components[X].imageMap&&(A.components[X].imageMap=B);return this.layerZ+=this.layerIncrement,"render-layer"===t&&!this.separateTiles&&l&&l.tileHeight===w&&l.tileWidth===v&&l.columns===y&&l.rows===f?(l.triggerEvent("add-tiles",D),this.updateLoadingProgress(p),l):(g={},"render-layer"===t&&this.spriteSheet&&("string"==typeof this.spriteSheet?g.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]:g.spriteSheet=this.spriteSheet,g.spriteSheet.animations||(g.spriteSheet.animations=k)),this.owner.addEntity(new r(A,{properties:g},this.updateLoadingProgress.bind(this,p),this.owner)))},convertImageLayer:function(t){var e,i=null,n=0,s="",r=t.properties||{},o=c(r,"repeat"),h=c(r,"repeat-x"),l=c(r,"repeat-y"),p={data:[],image:"",height:1,name:t.name,type:"tilelayer",width:1,tileheight:1,tilewidth:1,x:t.x,y:t.y,properties:r};for(o&&(p.width=+o,p.height=+o),h&&(p.width=+h),l&&(p.height=+l),e=p.width*p.height,n=0;n<e;n++)p.data.push(1);return(i=this.assetCache.read(t.name))?(p.image=t.name,p.tileheight=i.height,p.tilewidth=i.width):(s=a(t.image),(i=this.assetCache.read(s))?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+t.name+'", so using "'+t.image+'" instead.'),p.image=s,p.tileheight=i.height,p.tilewidth=i.width):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+t.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+t.name+'".'),p.image=t.image)),p.tileset={columns:1,image:p.image,imageheight:p.tileheight,imagewidth:p.tilewidth,margin:0,name:t.name,spacing:0,tilecount:1,tileheight:p.tileheight,tilewidth:p.tilewidth,type:"tileset"},p},loadLevel:function(t,e){var i,r,o,l,p,u,g=!0,y=null,m=0,f="",v=null,b=null,x=null,C=null,E=s.setUp("count",0,"progress",0,"total",0),S=0,A=0;if(i=(y="string"==typeof t.level?platypus.game.settings.levels[t.level]:t.level).layers,o=w(y.tilesets),l=y.tilewidth,p=y.tileheight,y.properties&&d(y.properties,this.owner),0===(v=this.images?this.images.greenSlice():Array.setUp()).length)for(m=0;m<o.length;m++)C=o[m],this.assetCache.read(C.name)?v.push(C.name):(f=a(C.image),this.assetCache.read(f)?(platypus.debug.warn('Component TiledLoader: Did not find a spritesheet for "'+C.name+'", so using "'+C.image+'" instead.'),v.push(f)):(platypus.debug.warn('Component TiledLoader: Cannot find the "'+C.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+C.name+'".'),v.push(C.image)));for(u=y.width*l*this.unitsPerPixel,r=y.height*p*this.unitsPerPixel,this.offsetMap&&(S=h(u),A=h(r)),E.total=m=i.length;m--;)"objectgroup"===i[m].type?E.total+=i[m].objects.length:!g||"collision"!==i[m].name&&"collision-layer"!==c(i[m].properties,"entity")||(g=!1);for(this.finishedLoading=function(t,e,i,r,o,a,h,l){var c=s.setUp("level",null,"world",n.setUp(),"tile",n.setUp(),"camera",null);c.level=t,c.camera=this.followEntity,c.width=r,c.height=o,c.world.setBounds(e,i,e+r,i+o),c.tile.setBounds(0,0,a,h),this.owner.triggerEvent("world-loaded",c),c.world.recycle(),c.tile.recycle(),c.recycle(),this.owner.removeComponent(this),l&&l()}.bind(this,y,S,A,u,r,l,p,e),m=0;m<i.length;m++)switch((x=i[m]).type){case"imagelayer":b=this.convertImageLayer(x),b=this.createLayer("image-layer",b,S,A,b.tilewidth,b.tileheight,[b.tileset],v,b,E);break;case"objectgroup":this.setUpEntities(x,S,A,l,p,o,E),b=null,this.updateLoadingProgress(E);break;case"tilelayer":b=this.setupLayer(x,g,b,S,A,l,p,o,v,E);break;default:platypus.debug.warn('Component TiledLoader: Platypus does not support Tiled layers of type "'+x.type+'". This layer will not be loaded.'),this.updateLoadingProgress(E)}},setUpEntities:function(t,e,i,n,s,o,a){var h=0,l=0,p=0,d=0,g=0,y=0,m=0,f=null,w=0,v=null,b=null,x=null,C=c(t.properties,"entityPositionX")||this.entityPositionX,E=c(t.properties,"entityPositionY")||this.entityPositionY,S="",A=-1,k=1/0,P=-1/0,M=1/0,B=-1/0,T=null,D=null,L=null,I=0,z=0;for(e+=t.offsetx||0,i+=t.offsety||0,w=0;w<t.objects.length;w++)if(v=t.objects[w],T=u(v,o)){if(A=T.gid,S=T.type,x=(b=platypus.game.settings.entities[S])&&b.properties||null,D=T.properties,v.polygon||v.polyline){for(k=1/0,P=-1/0,M=1/0,B=-1/0,L=null,v.polygon?L=v.polygon:v.polyline&&(L=v.polyline),p=0;p<L.length;p++)L[p].x>P&&(P=L[p].x),L[p].x<k&&(k=L[p].x),L[p].y>B&&(B=L[p].y),L[p].y<M&&(M=L[p].y);if(D.width=P-k,D.height=B-M,D.x=v.x+k,D.y=v.y+M,h=0,l=0,D.width=D.width*this.unitsPerPixel,D.height=D.height*this.unitsPerPixel,D.x=D.x*this.unitsPerPixel+e,D.y=D.y*this.unitsPerPixel+i,v.polygon)for(D.shape={},D.shape.type="polygon",D.shape.points=[],d=0;d<L.length;d++)D.shape.points.push({x:(L[d].x-k)*this.unitsPerPixel+e,y:(L[d].y-M)*this.unitsPerPixel+i});else if(v.polyline)for(D.shape={},D.shape.type="polyline",D.shape.points=[],d=0;d<L.length;d++)D.shape.points.push({x:(L[d].x-k)*this.unitsPerPixel+e,y:(L[d].y-M)*this.unitsPerPixel+i})}else I=n*this.unitsPerPixel,z=s*this.unitsPerPixel,h=0,l=0,D.width=(v.width||0)*this.unitsPerPixel,D.height=(v.height||0)*this.unitsPerPixel,x&&("number"==typeof x.width&&(D.width=x.width,h=I),"number"==typeof x.height&&(D.height=x.height,l=z)),v.point||(D.width||(D.width=I),D.height||(D.height=z),h=h||D.width,l=l||D.height),D.x=v.x*this.unitsPerPixel,D.y=v.y*this.unitsPerPixel,v.rotation&&(g=(v.width||I)/2,y=(v.height||z)/2,m=v.rotation/180%2*Math.PI,f=platypus.Vector.setUp(g,-y).rotate(m),D.rotation=v.rotation,D.x=Math.round(1e3*(D.x+f.x-g))/1e3,D.y=Math.round(1e3*(D.y+f.y+y))/1e3,f.recycle()),"left"===C?D.regX=0:"center"===C?(D.regX=D.width/2,D.x+=h/2):"right"===C&&(D.regX=D.width,D.x+=h),D.x+=e,-1===A&&(D.y+=D.height),"bottom"===E?D.regY=D.height:"center"===E?(D.regY=D.height/2,D.y-=l/2):"top"===E&&(D.regY=0,D.y-=l),D.y+=i,v.ellipse?(D.shape={},D.shape.type="circle",D.shape.width=D.width*this.unitsPerPixel,D.shape.height=D.height*this.unitsPerPixel,D.shape.radius=(D.width+D.height)*this.unitsPerPixel/4):v.width&&v.height&&(D.shape={},D.shape.type="rectangle",D.shape.width=D.width*this.unitsPerPixel,D.shape.height=D.height*this.unitsPerPixel);x?(D.scaleX*=this.imagesScale*(x.scaleX||1),D.scaleY*=this.imagesScale*(x.scaleY||1)):(D.scaleX*=this.imagesScale,D.scaleY*=this.imagesScale),D.layerZ=this.layerZ,D.z?D.z+=this.layerZ:x&&"number"==typeof x.z?D.z=this.layerZ+x.z:D.z=this.layerZ,(v=this.owner.addEntity(new r(b,{properties:D},this.updateLoadingProgress.bind(this,a),this.owner)))&&(v.camera&&(this.followEntity={entity:v,mode:v.camera}),this.owner.triggerEvent("entity-created",v))}else this.updateLoadingProgress(a);this.layerZ+=this.layerIncrement},setupLayer:function(t,e,i,n,s,r,o,a,h,l){var p=!1,u=c(t.properties,"entity"),d=u||"render-layer",g=null,y=0;if(u||("collision"===t.name?d="collision-layer":"action"===t.name&&(d=e?"tile-layer":"render-layer")),"tile-layer"===d||this.showCollisionTiles&&platypus.game.settings.debug)return l.count+=1,this.createLayer("collision-layer",t,n,s,r,o,a,h,i,l),this.createLayer("render-layer",t,n,s,r,o,a,h,i,l);if("collision-layer"===d)return this.createLayer("collision-layer",t,n,s,r,o,a,h,i,l),null;if(g=platypus.game.settings.entities[d])for(y=g.components.length;y--;)if("RenderTiles"===g.components[y].type){p=!0;break}return p?this.createLayer(d,t,n,s,r,o,a,h,i,l):(this.createLayer(d,t,n,s,r,o,a,h,i,l),null)},updateLoadingProgress:function(t){t.count+=1,t.progress=t.count/t.total,this.owner.triggerEvent("level-loading-progress",t),t.count===t.total&&(t.recycle(),this.finishedLoading())},destroy:function(){}},publicMethods:{decodeLayer:function(t){return"base64"===t.encoding&&(t.data=o(t.data,t.compression),t.encoding="csv"),t}},getAssetList:function(t,e,i){var n=e||{},s=i||{},r=t.spriteSheet||n.spriteSheet||s.spriteSheet,o=t.images||n.images||s.images,a=y(t.level||n.level||s.level,r);return r&&("string"==typeof r?a.union(platypus.game.settings.spriteSheets[r].images):a.union(r.images)),o&&a.union(o),a},getLateAssetList:function(t,e,i,n){var s=e||{},r=i||{},o=t.spriteSheet||s.spriteSheet||r.spriteSheet;return n&&n.level?y(n.level,o):Array.setUp()}})}(),function(){"use strict";var t={bb:"base-builder",cs:"cooking-school",ff:"food-farmer",mc:"mission-control",rm:"rover-maker"},e=include("platypus.AABB"),i=include("PIXI.Container"),n=include("platypus.Data"),s=include("createjs.Ease"),r=include("platypus.Entity"),o=include("PIXI.Graphics"),a=include("createjs.Tween"),h=function(t,e){var i=0;if(t){if(Array.isArray(t)){for(i=t.length;i--;)if(t[i].name===e)return t[i].value;return null}return t[e]}return null};platypus.createComponentClass({id:"ToolBoxHandler",properties:{toolBoxHeight:550,toolBoxTop:-300},publicProperties:{scrollable:!0},initialize:function(t,e){return this.categories=n.setUp(),this.mask=null,this.verticalSpacing=h(platypus.game.settings.entities["toolbox-item"].properties,"height"),this.upperLimit=this.toolBoxTop+this.verticalSpacing/2,this.playerResources=Array.setUp(),this.scrollDistance=Math.max(Math.floor(this.toolBoxHeight/this.verticalSpacing)-1,1)*this.verticalSpacing,this.target={y:this.upperLimit},this.scrollTween=null,this.panel=null,this.currentCategory=null,platypus.game.app.userData.read("lastCategory",function(t){this.lastCategoryUsed=t||"base-builder",e()}.bind(this)),platypus.game.app.getResources=function(){return this.playerResources}.bind(this),platypus.game.app.isReallyReady=function(){for(var t=this.owner.getEntitiesByType("toolbox-item"),e=t.length;e--;)if(t[e].count&&!t[e].state.get("infinite"))return!1;return!0}.bind(this),!0},events:{"child-entity-added":function(t){"scroll-down"===t.type?(this.scrollDown=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop+this.toolBoxHeight):"scroll-up"===t.type?(this.scrollUp=t,t.triggerEvent("hide-sprite"),t.y=this.toolBoxTop):"panel"===t.type&&(this.panel=t)},"process-level":function(t){platypus.labRetriever.loading?platypus.labRetriever.onLoaded=this.processLevel.bind(this,t):this.processLevel(t)},"render-world":function(t){var n=t.renderGroups,s=t.world,r=function(t,e,n){for(var s=e.length,r=null;s--;)if(e[s].name===t)return e[s];return(r=new i).name=t,e.push(r),n.addChild(r),r}("toolbox",n,s);r.z=1,this.toolbox=r,this.mask=function(t,e,i){var n=new o;return t.mask=n,n.isMask=!0,n.z=1,e.addChild(n),n.clear(),n.beginFill(0,1),n.r(i.left,i.top,i.width,i.height),n.endFill(),n}(r,s,e.setUp(0,this.toolBoxTop+this.toolBoxHeight/2,2e3,this.toolBoxHeight)),t.world.reorder=!0},"scroll-up":function(){var t=this.target.y+this.scrollDistance;this.swipe||(t>=this.upperLimit&&(t=this.upperLimit),this.scrollTween=a.get(this.target,{override:!0}).to({y:t},300,s.sineInOut))},"scroll-down":function(){var t=this.target.y-this.scrollDistance;this.swipe||(t<=this.currentCategory.lowerLimit&&(t=this.currentCategory.lowerLimit),this.scrollTween=a.get(this.target,{override:!0}).to({y:t},300,s.sineInOut))},swipe:function(t){this.swipe||(a.removeTweens(this.target),this.swipe=function(t,e,i){var n=e-t+i.y;n>=this.upperLimit?(n=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):n<=this.currentCategory.lowerLimit?(n=this.currentCategory.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=n,this.forceCameraUpdate()}.bind(this,t.y,this.toolbox.y)),this.swipe(t)},"end-swipe":function(t){this.swipe&&(this.swipe(t),this.swipe=null)},tick:function(){var t=this.target.y;this.toolbox.y!==t&&(this.swipe?this.target.y=this.toolbox.y:(t>=this.upperLimit?(t=this.upperLimit,this.scrollUp.triggerEvent("hide-sprite")):t<=this.currentCategory.lowerLimit?(t=this.currentCategory.lowerLimit,this.scrollDown.triggerEvent("hide-sprite")):(this.scrollDown.triggerEvent("show-sprite"),this.scrollUp.triggerEvent("show-sprite")),this.toolbox.y=t,this.forceCameraUpdate()))},"show-submenu-base-builder":function(){this.switchCategory("base-builder")},"show-submenu-cooking-school":function(){this.switchCategory("cooking-school")},"show-submenu-food-farmer":function(){this.switchCategory("food-farmer")},"show-submenu-mission-control":function(){this.switchCategory("mission-control")},"show-submenu-rover-maker":function(){this.switchCategory("rover-maker")}},methods:{addMenuItem:function(t,e,i,n,s){var r={},o={state:r,category:n,isNew:s};this.playerResources.push({name:t,count:e}),r[t]=!0,o.itemType=t,-1==+e?o.infinite=!0:(i&&(e-=i),o.count=e),o.spawns=t,this.addToCategory(this.lastEntityAdded=this.owner.addEntity({type:"toolbox-item",properties:o}),n),this.owner.triggerEvent("added-item-to-toolbox",t),this.lastEntityAdded.y=(this.categories[n].count-1)*this.verticalSpacing},addToCategory:function(t,e){var i=this.categories;i[e]||(i[e]=n.setUp("count",0,"lowerLimit",0,"items",Array.setUp())),i[e].count+=1,i[e].lowerLimit=Math.min(this.upperLimit,this.upperLimit-i[e].count*this.verticalSpacing+this.toolBoxHeight),i[e].items.push(t),t.triggerEvent("hide-sprite"),t.isNew&&(this.newItemAt=e)},processLevel:function(e){for(var i,s="",r=e.level.properties,o="",a=n.setUp(),l=e.level.layers,c=l.length,p=0,u=null,d=null,g=platypus.labRetriever;c--;)if(d=l[c].objects)for(p=d.length;p--;)(u=d[p]).type&&"true"===h(u.properties,"savable")&&(a[u.type]=(a[u.type]||0)+1);for(c=0;c<r.length;c++)"menu."===(o=r[c].name).substring(0,5)&&(s=o.substring(8),g.has(s)&&this.addMenuItem(s,r[c].value,a[s],t[o.substring(5,7)],g.isNew(s)));a.recycle(),i=this.newItemAt||this.lastCategoryUsed,this.switchCategory(i),this.owner.getEntitiesByType("button-"+i)[0].triggerEvent("disable"),this.toolbox.y=this.upperLimit,this.upperLimit===this.currentCategory.lowerLimit?this.scrollable=!1:this.scrollDown.triggerEvent("show-sprite")},switchCategory:function(t){var e=this.categories,i=null,n=0;if(e[t]&&this.currentCategory!==e[t]){if(this.currentCategory)for(n=(i=this.currentCategory.items).length;n--;)i[n].triggerEvent("hide-sprite");for(this.currentCategory=e[t],this.currentCategoryId=t,n=(i=this.currentCategory.items).length;n--;)i[n].triggerEvent("show-sprite");this.toolbox.y!==this.upperLimit&&(this.scrollTween=a.get(this.target,{override:!0}).to({y:this.upperLimit},300,s.sineInOut)),this.upperLimit===this.currentCategory.lowerLimit?(this.scrollable=!1,this.scrollDown.triggerEvent("hide-sprite"),this.scrollUp.triggerEvent("hide-sprite")):(this.scrollable=!0,this.scrollDown.triggerEvent("show-sprite")),this.panel&&this.panel.triggerEvent(t),t!==this.lastCategoryUsed&&(this.lastCategoryUsed=t,platypus.game.app.userData.write("lastCategory",t))}},forceCameraUpdate:function(){this.lastEntityAdded&&this.owner.triggerEvent("child-entity-updated",this.lastEntityAdded)},destroy:function(){platypus.labRetriever.onLoaded&&(platypus.labRetriever.onLoaded=null),this.playerResources.recycle(),this.playerResources=null}},publicMethods:{getEntitiesAtPoint:function(t,i){for(var n=e.setUp(),s=Array.setUp(),r=this.owner.entities,o=null,a=r.length;a--;)o=r[a],n.setAll(o.x||0,o.y||0,o.width||0,o.height||0),!n.containsPoint(t,i-this.toolbox.y)||o.category&&o.category!==this.currentCategoryId||s.push(o);return n.recycle(),s},getVisibleMenuItems:function(t,e){for(var i=[],n=this.categories,s=n[t]?n[t].items:this.currentCategory.items,r=s?s.length:0,o=0;r--;)o=s[r].y+this.toolbox.y-this.toolBoxTop,(!e||o>0&&o<this.toolBoxHeight)&&i.push(s[r].itemType);return i}},getAssetList:function(){return r.getAssetList({type:"toolbox-item"})},getLateAssetList:function(t,e,i,n){var s,o=null,a=Array.setUp(),h=0,l=n&&n.level,c="";if("string"==typeof l&&(l=platypus.game.settings.levels[l]),s=l.properties)for(h=0;h<s.length;h++)"menu."===(c=s[h].name).substring(0,5)&&(o=r.getAssetList({type:c.substring(8)}),a.union(o),o.recycle());return a}})}(),function(){"use strict";var t=window.navigator.userAgent.toLowerCase(),e=t.indexOf("os 9_")>=0||t.indexOf("os 10_")>=0,i=include("PIXI.spine.core.TextureAtlas",!1),n=include("PIXI.spine.core.AtlasAttachmentLoader",!1),s=include("PIXI.BaseTexture"),r=include("PIXI.spine.core.SkeletonJson",!1),o=include("PIXI.spine.Spine",!1),a=function(){var t=platypus.game.app,e=t.config.platypus;t.transition=new o(new r(new n(new i(e.atlases["ScreenBadge_Standard-"+platypus.modifyAllAssets],function(t,e){var i,n;e((i=t,(n=platypus.game.app.assetManager.cache.read(i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."))))||platypus.debug.warn('SavedGameChecker: "'+i+'" is not a loaded asset.'),new s(n)))}))).readSkeletonData(e.skeletons.ScreenBadge_Standard)),t.transition.children[0].mask=t.transition.children[2].children[0],platypus.savedWidth&&platypus.savedHeight&&(t.transition.x=platypus.savedWidth/2,t.transition.y=platypus.savedHeight/2,t.transition.scale.x=t.transition.scale.y=platypus.savedHeight/880),t.transition.visible=!1};platypus.createComponentClass({id:"TransitionLoader",events:{tick:function(){platypus.game.app.transition||e||(this.tickCount=(this.tickCount||0)+1,30===this.tickCount&&a())}}})}(),function(){"use strict";var t=include("platypus.AABB");platypus.createComponentClass({id:"TrashRegion",initialize:function(){this.initialCamera=t.setUp(0,0,960,720)},properties:{panelOffset:300},publicProperties:{width:500},events:{"camera-update":function(t){var e=this.owner,i=Math.min(t.viewport.width/this.initialCamera.width,t.viewport.height/this.initialCamera.height);e.x=t.viewport.left+(this.width-this.panelOffset)*i-this.width/2,e.y=t.viewport.y}},methods:{destroy:function(){this.initialCamera.recycle(),this.initialCamera=null}}})}(),function(){"use strict";var t=include("Box2D.b2Vec2"),e=include("platypus.AABB"),i=new t(0,0);platypus.createComponentClass({id:"TreadLogic",properties:{},publicProperties:{speed:0},initialize:function(){var t=this.owner.state,i=t.get("reversed");this.owner.state.set("simming",!1),this.simulationStarted=!1,this.moving=0,this.batteryDrain=4e-4,this.owner.state.set("moving",!1),"boolean"!=typeof i&&t.set("reversed",!1),this.wheels=[],this.treadSounding=!1,this.treadAudioLevel=0,this.cameraPosition=e.setUp(),this.panRange=0},events:{"camera-update":function(t){this.cameraPosition.set(t.viewport),this.panRange=Math.pow(1.15*this.cameraPosition.width,2)},"handle-logic":function(t){var e=0;this.simulationStarted&&(this.treadSounding&&this.treadAudioLevel<=1?(e=this.figureOutPan(),0===this.treadAudioLevel&&this.owner.triggerEvent("tread-running"),this.treadAudioLevel=Math.min(1,this.treadAudioLevel+t.delta/500),this.owner.triggerEvent("set-volume",.25*this.treadAudioLevel*e,"motor-running")):!this.treadSounding&&this.treadAudioLevel>0&&(e=this.figureOutPan(),this.treadAudioLevel=Math.max(0,this.treadAudioLevel-t.delta/200),this.owner.triggerEvent("set-volume",.25*this.treadAudioLevel*e,"motor-running"),0===this.treadAudioLevel&&this.owner.triggerEvent("stop-audio","motor-running")))},"before-box2d-update":function(t){var e=0;if(this.simulationStarted)if(this.moving&&this.owner.drainBattery(this.batteryDrain)){for(this.owner.state.set("moving",!0),e=0;e<this.wheels.length;e++)this.wheels[e].triggerEvent("move-wheels");this.treadSounding||(this.treadSounding=!0)}else{for(this.owner.state.set("moving",!1),e=0;e<this.wheels.length;e++)this.wheels[e].triggerEvent("stop-wheels");this.treadSounding&&(this.treadSounding=!1)}},"simulation-started":function(){this.simulationStarted=!0,this.owner.state.set("simming",!0)},"simulation-stopped":function(){this.simulationStarted=!1,this.owner.state.set("simming",!1),this.moving=0,this.speed=0,this.owner.state.set("reversed",!1),this.wheels=[],this.owner.triggerEvent("stop-audio","motor-running"),this.owner.state.set("moving",!1),this.owner.body.SetLinearVelocity(i),this.owner.body.SetAngularVelocity(0),this.owner.body.SetAwake(!1)},"tread-cw-start":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-cw-start");this.owner.state.set("reversed",!1),this.moving++}},"tread-cw-stop":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-cw-stop");this.moving>0&&this.moving--}},"tread-ccw-start":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-ccw-start");this.owner.state.set("reversed",!0),this.moving++}},"tread-ccw-stop":function(){var t=0;if(this.simulationStarted){for(t=0;t<this.wheels.length;t++)this.wheels[t].triggerEvent("motor-ccw-stop");this.moving>0&&this.moving--}},"pre-simulation-started":function(){var t=null,e=null,i=null,n=null,s=null;t={type:"tread-wheel",properties:{tread:this.owner,x:this.owner.x,y:this.owner.y,z:this.owner.z+.01,orientation:0}},e=this.owner.parent.addEntity(t),this.wheels.push(e),t={type:"tread-wheel",properties:{tread:this.owner,x:this.owner.x-32,y:this.owner.y,z:this.owner.z+.01,orientation:0}},i=this.owner.parent.addEntity(t),this.wheels.push(i),t={type:"tread-wheel",properties:{tread:this.owner,x:this.owner.x+32,y:this.owner.y,z:this.owner.z+.01,orientation:0}},n=this.owner.parent.addEntity(t),this.wheels.push(n),s=e.createJoint("revolute",{anchor:{x:e.x/30,y:e.y/30}},this.owner,1),e.myJoint=s,s=i.createJoint("revolute",{anchor:{x:i.x/30,y:i.y/30}},this.owner,1),i.myJoint=s,s=n.createJoint("revolute",{anchor:{x:n.x/30,y:n.y/30}},this.owner,1),n.myJoint=s}},methods:{figureOutPan:function(){var t,e,i=this.cameraPosition,n=0;return t=Math.pow(this.owner.x-i.x,2)+Math.pow(this.owner.y-i.y,2),e=Math.max(1-t/this.panRange,0),n=this.owner.x>i.right?1:this.owner.x<i.left?-1:(this.owner.x-i.left)/i.width*2-1,this.owner.triggerEvent("set-pan",n,"motor-running"),e}}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("createjs.Tween"),i=["intro-action","intro-refresh","intro-tablet","intro-magnify","intro-planets","intro-home"],n=0,s=!1;platypus.createComponentClass({id:"TutorialSystem",initialize:function(){this.camera=t.setUp(),this.countdown=5e3,this.simulationStarted=!1,this.nextPrompt=!0},events:{"camera-update":function(t){this.camera.set(t.viewport),s||(s=!0,this.owner.triggerEvent("lab-intro"))},"handle-logic":function(t){this.countdown>0&&(platypus.game.app.voPlayer.playing?this.countdown=5e3:(this.countdown-=t.delta,this.countdown<=0&&(this.countdown=5e3,!this.simulationStarted&&this.nextPrompt&&(this.nextPrompt=!1,this.owner.triggerEvent(i[n]),n=(n+1)%i.length))))},"ui-simulation-started":function(){this.nextPrompt=!0,this.countdown=25e3,this.simulationStarted=!0},"ui-simulation-stopped":function(){this.countdown=5e3,this.simulationStarted=!1},"level-successful":function(){this.countdown=0},"did-something":function(){this.simulationStarted||(this.countdown=5e3)},"start-pointing":function(){var t=this.owner.trigger;e.get(this.owner).wait(4e3).to({rotation:180,x:this.camera.left+250,y:-230},100).call(t,["show-sprite"]).to({opacity:1},300).to({y:170},2e3).to({opacity:0},300).to({x:this.camera.left+400,y:200},100).call(t,["show-sprite"]).to({opacity:1},300).to({y:-200},2e3).to({opacity:0},300).call(t,["hide-sprite"])},"intro-planets":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:0,x:this.camera.right-300,y:-200},100).call(t,["show-sprite"]).to({opacity:1},300).to({y:125},2e3).to({opacity:0},300).call(t,["hide-sprite"])},"intro-action":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:45,x:this.camera.right-250,y:this.camera.bottom-250},100).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2500).to({opacity:0},300).call(t,["hide-sprite"])},"intro-home":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:-45,x:this.camera.right-210,y:this.camera.top+210},100).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2500).to({opacity:0},300).call(t,["hide-sprite"])},"intro-tablet":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:-135,x:this.camera.left+275,y:this.camera.top+190},100).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2500).to({opacity:0},300).call(t,["hide-sprite"])},"intro-refresh":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:-135,x:this.camera.left+365,y:this.camera.top+190},100).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2500).to({opacity:0},300).call(t,["hide-sprite"])},"instruct-a":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,n=0,s="";if(this.time=Date.now(),this.duration=function(t){var e=createjs.Sound._getSrcById(t);return e&&e.src&&(e=createjs.Sound.activePlugin._audioSources[e.src])?1e3*(e.duration||0)>>0:0}(t),i)for(n=0;n<i.length;n++)s+=i[n].content+" ";e.analyticsEmitter.startInstruction("audio",this.duration,s,t)},"instruct-b":function(t){var e=platypus.game.app,i=e.config.captions[t]&&e.config.captions[t].lines,n=0,s="",r=Date.now()-this.time,o=r<this.duration;if(i)for(n=0;n<i.length;n++)s+=i[n].content+" ";e.analyticsEmitter.endInstruction("audio",r>>0,s,t,o,e.getEnlearnData())}},methods:{beginTalking:function(t){return t.to({x:this.camera.right-150,y:this.camera.top+150},100),t},"intro-magnify":function(){var t=this.owner.trigger;e.get(this.owner).to({rotation:-135,x:this.camera.left+450,y:this.camera.top+190},100).call(t,["show-sprite"]).to({opacity:1},300).call(t,["pointy"]).wait(2500).to({opacity:0},300).call(t,["hide-sprite"])}}})}(),function(){"use strict";platypus.createComponentClass({id:"UnlockSequence",properties:{},publicProperties:{},initialize:function(){},events:{"complete-level":function(){this.owner.state.set("completing",!0)},"unlock-level":function(){this.owner.state.set("unlocking",!0)},"animation-ended":function(t){"completing"===t&&(this.owner.state.set("completing",!1),this.owner.state.set("complete",!0),this.owner.parent.triggerEvent("level-unlock-sequence")),"unlocking"===t&&(this.owner.state.set("unlocking",!1),this.owner.state.set("disabled",!1))}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=["wheel-control-tray","rocket-control-tray","sail-control-tray","tread-control-tray","control-panel-jet2","control-panel-boop"],e=include("createjs.Tween"),i=include("createjs.Ease"),n=include("platypus.Entity");platypus.createComponentClass({id:"VehicleControlsManager",properties:{},publicProperties:{},initialize:function(){this.controls={},this.showingControls=[],this.controlDependentsCount={"wheel-control-tray":0,"rocket-control-tray":0,"sail-control-tray":0,"tread-control-tray":0,"control-panel-boop":0,"control-panel-jet2":0},this.inactiveBuffer=266,this.activeBuffer=10,this.betweenBuffer=10},events:{"add-piece-control":function(t){var e=this.lookUpController(t);e&&!this.controls[e]&&this.addControl(e)},"controllable-piece-added":function(t){var e=this.lookUpController(t);e&&(this.owner.triggerEvent("add-piece-control",t),this.controlDependentsCount[e]||this.showControl(e),this.controlDependentsCount[e]++)},"controllable-piece-removed":function(t){var e=this.lookUpController(t);e&&(this.controlDependentsCount[e]--,this.controlDependentsCount[e]||this.hideControl(e))}},methods:{lookUpController:function(t){switch(t){case"wheel-powered":return"wheel-control-tray";case"rocket":case"h-rocket":return"rocket-control-tray";case"sail":return"sail-control-tray";case"tread":return"tread-control-tray";case"boopMain":return"control-panel-boop";case"jet2":return"control-panel-jet2"}return null},addControl:function(t){var e,i={type:t,properties:{bottom:-300}};e=this.owner.addEntity(i),this.controls[t]=e},showControl:function(t){var e=null,i=0,n=null;e=this.controls[t],this.showingControls.length>0?(i=(n=this.showingControls[this.showingControls.length-1]).left+n.width/2+this.betweenBuffer+e.width/2,e.activeLeft=n.activeLeft+n.width/2+this.betweenBuffer+e.width/2):(i=this.inactiveBuffer+e.width/2,e.activeLeft=this.activeBuffer+e.width/2),e.left=i,e.bottom=-300,e.inactiveLeft=i,this.showingControls.push(e),e.triggerEvent("pop-up")},hideControl:function(t){var n=0,s=-1,r=null,o=0,a=0;for(n=0;n<this.showingControls.length;n++)r=this.showingControls[n],-1!==s?(e.get(r).wait(300).to({left:o+r.width/2},750,i.quadInOut),r.inactiveLeft=o+r.width/2,r.activeLeft=a+r.width/2,o+=r.width+this.betweenBuffer,a+=r.width+this.betweenBuffer):r.type===t&&(s=n,r.triggerEvent("pop-down"),n>0?(o=this.showingControls[n-1].left+this.showingControls[n-1].width/2+this.betweenBuffer,a=this.showingControls[n-1].activeLeft+this.showingControls[n-1].width/2+this.betweenBuffer):(o=this.inactiveBuffer,a=this.activeBuffer));this.showingControls.splice(s,1)}},getAssetList:function(){for(var e=null,i=t,s=i.length,r=Array.setUp();s--;)e=n.getAssetList({type:i[s]}),r.union(e),e.recycle();return r}})}(),function(){"use strict";var t=include("platypus.components.AudioVO"),e=include("platypus.components.RenderAnimation"),i=include("platypus.components.RenderSprite"),n=function(t,e){return" "===e?t+"default":t+e},s=function(t,e,i){this.owner.addComponent(new t(this.owner,e,i))},r=function(t,e,i,s){var r=0,o="",a={},h=0,l="",c="",p=t.voice,u=t.mouthCues;if("string"==typeof t)a.sound=t,a.events=Array.setUp();else if("string"==typeof t.sound)a.sound=t.sound,a.events=Array.setUp();else{for(o in t.sound)t.sound.hasOwnProperty(o)&&(a[o]=t.sound[o]);a.events?a.events=a.events.greenSlice():a.events=Array.setUp()}if(p||u||!platypus.game.app.config.mouthCues||(u=platypus.game.app.config.mouthCues[a.sound]),p)for(p+=" ",r=0;r<p.length;r++)(c=p[r])!==l&&(l=c,a.events.push({time:h,event:n(i,c)})),h+=s;else if(u)for(r=0;r<u.length;r++)c=u[r],a.events.push({time:1e3*c.start,event:n(i,c.value)}),h+=s;return a},o=function(t,e,i,n){var s=0,o=Array.setUp();if(e[" "]||(e[" "]=e.default),Array.isArray(t)){for(s=0;s<t.length;s++)"number"==typeof t[s]?o.push(t[s]):o.push(r(t[s],0,i,n));return o}return r(t,0,i,n)};platypus.createComponentClass({id:"VoiceOver",properties:{animationMap:{default:"default"},renderComponent:"",frameLength:100,messagePrefix:"",voiceOverMap:{}},initialize:function(r,a){var h="",l=Array.setUp(),c={audioMap:{},aliases:r.aliases},p={acceptInput:r.acceptInput,aliases:r.aliases,animation:r.animation,animationMap:{},eventBased:!0,flip:r.flip,hidden:r.hidden,interactive:r.interactive,mask:r.mask,mirror:r.mirror,offsetZ:r.offsetZ,regX:r.regX,regY:r.regY,restart:r.restart,rotate:r.rotate,scaleX:r.scaleX,scaleY:r.scaleY,spriteSheet:r.spriteSheet,stateBased:r.stateBased||!1};for(h in this.messagePrefix?this.message=this.messagePrefix+"-":this.message="",this.animationMap)this.animationMap.hasOwnProperty(h)&&(p.animationMap[n(this.message,h)]=this.animationMap[h]);for(h in p.animationMap.default=this.animationMap.default,this.renderComponent?l.push(s.bind(this,platypus.components[this.renderComponent],p)):l.push(s.bind(this,r.animation?e:i,p)),this.voiceOverMap)this.voiceOverMap.hasOwnProperty(h)&&(c.audioMap[h]=o(this.voiceOverMap[h],this.animationMap,this.message,this.frameLength));return l.push(s.bind(this,t,c)),platypus.Async.setUp(l,a),l.recycle(),!0},events:{load:function(){this.owner.removeComponent(this)}},getAssetList:function(t,e,i){var n=t.spriteSheet||e.spriteSheet||i&&i.spriteSheet;return"string"==typeof n?platypus.game.settings.spriteSheets[n].images.greenSlice():n?n.images.greenSlice():Array.setUp()}})}(),function(){"use strict";platypus.createComponentClass({id:"WhatsBeingDragged",properties:{},publicProperties:{},initialize:function(){this.dragging=[]},events:{"dragging-a-piece":function(t){this.dragging.includes(t)||(this.dragging.push(t),1===this.dragging.length&&this.owner.triggerEvent("rl-dragging-taking-place"))},"finished-dragging-a-piece":function(t){var e;(e=this.dragging.indexOf(t))>=0&&(this.dragging.splice(e,1),0===this.dragging.length&&this.owner.triggerEvent("rl-no-dragging-taking-place"))}},methods:{},publicMethods:{isThisGroupMoving:function(t){var e=0;for(e=0;e<this.dragging.length;e++)if(this.dragging[e].groupId===t)return!0;return!1}}})}(),function(){"use strict";platypus.createComponentClass({id:"ZoomBannerLogic",properties:{},publicProperties:{banner:null},initialize:function(){},events:{zoom:function(){this.owner.parent.triggerEvent("zoom-in",this.owner.banner)}},methods:{},publicMethods:{}})}(),function(){"use strict";var t=include("platypus.AABB"),e=include("platypus.Data"),i=include("platypus.Vector"),n=include("createjs.Tween");platypus.createComponentClass({id:"Zoomer",properties:{maxZoom:2048,minZoom:240},publicProperties:{zooming:!1,zoomEnabled:!0,zoomPaused:!1},initialize:function(){var e=this.interaction=platypus.game.app.display.renderer.plugins.interaction;this.zoomLocks=0,this.camera=t.setUp(),this.pointers=Array.setUp(),this.mouseWorldOrigin=i.setUp(),this.pinchCam=null,this.wheelie=function(t){var e=5e-4*t.deltaY,n=window.devicePixelRatio||1,s=1+e/this.currentZoom,r=this.owner,o=i.setUp(t.clientX*n,t.clientY*n),a=r.windowToWorld(o,!0);this.zoomEnabled&&!this.zoomPaused&&this.zoom(a,s,this.camera),o.recycle(),a.recycle(),t.preventDefault()}.bind(this),window.addEventListener("wheel",this.wheelie),this.continuing=function(e){var i=null,n=this.pointers,s=n.length,r=e.data.identifier,o=!1;if(this.pinchCam||1!==s){if(2===s){if(!this.pinchCam){for(this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y;s--;)(i=n[s]).x=i.toX,i.y=i.toY;s=n.length,this.pinchCam=t.setUp(this.camera)}for(;s--;)if((i=n[s]).identifier===r){i.toX=e.data.global.x,i.toY=e.data.global.y,o=!0;break}o?this.pinchZoom():platypus.debug.warn("Well, that was odd. Unregistered input pointer!")}}else this.repositionCamera(n[0],e.data.global),e.stopPropagation();this.pinchCam&&e.stopPropagation()}.bind(this),e.on("pointermove",this.continuing),this.ending=function(t){for(var e=null,i=this.pointers,n=i.length,s=t.data.identifier;n--;)if(i[n].identifier===s){i.greenSplice(n).recycle();break}this.pinchCam&&(this.pinchCam.recycle(),this.pinchCam=null),1===i.length&&((e=i[0]).x=e.toX,e.y=e.toY,this.mouseWorldOrigin.x=this.camera.x,this.mouseWorldOrigin.y=this.camera.y),this.zooming&&t.stopPropagation(),i.length||(this.zooming=!1)}.bind(this),e.on("pointerup",this.ending),e.on("pointerupoutside",this.ending),e.on("pointercancel",this.ending),this.zoomDimensionsCollected=!1,this.zoomDimensions={width:0,height:0,lastWidth:0},this.initialZoomDimensions={width:0,height:0}},events:{tick:function(){this.zoomDimensions.width!==this.zoomDimensions.lastWidth&&(this.zoomDimensions.lastWidth=this.zoomDimensions.width,this.owner.triggerEvent("resize-camera",this.zoomDimensions))},"camera-update":function(t){this.camera.set(t.viewport),this.currentZoom=t.scaleX,this.zoomDimensionsCollected||(this.zoomDimensionsCollected=!0,this.zoomDimensions={width:t.viewport.width,height:t.viewport.height,lastWidth:t.viewport.width},this.initialZoomDimensions={width:t.viewport.width,height:t.viewport.height})},"tween-zoom-out":function(){var t=Math.min(1.4*this.initialZoomDimensions.height,this.maxZoom);this.zoomDimensions.changing=!0,n.get(this.zoomDimensions,{override:!0}).to({height:t,width:4*t/3},600,createjs.Ease.sineInOut)},"tween-zoom-in":function(){this.zoomDimensions.changing=!0,n.get(this.zoomDimensions,{override:!0}).to({height:this.initialZoomDimensions.height,width:this.initialZoomDimensions.width},600,createjs.Ease.sineInOut)},"workspace-pointerdown":function(t){this.zoomEnabled&&!this.zoomPaused&&this.start(t),this.owner.triggerEvent("follow",{mode:"static"})},"pause-zooming":function(){this.zoomLocks+=1,this.zoomPaused=!0},"unpause-zooming":function(){this.zoomLocks-=1,this.zoomLocks<0&&(this.zoomLocks=0),this.zoomPaused=!!this.zoomLocks}},methods:{destroy:function(){var t=this.interaction;this.camera.recycle(),this.camera=null,this.mouseWorldOrigin.recycle(),this.mouseWorldOrigin=null,this.pointers.recycle(2),this.pointers=null,window.removeEventListener("wheel",this.wheelie),t.off("pointermove",this.continuing),t.off("pointerup",this.ending),t.off("pointerupoutside",this.ending),t.off("pointercancel",this.ending)},start:function(t){var i=this.camera,n=this.pointers;this.zooming=!0,this.owner.triggerEvent("stop-following-if-simulating"),n.push(e.setUp("toX",t.pixiEvent.data.global.x,"toY",t.pixiEvent.data.global.y,"x",t.pixiEvent.data.global.x,"y",t.pixiEvent.data.global.y,"identifier",t.pixiEvent.data.identifier)),1===n.length&&(this.mouseWorldOrigin.x=i.x,this.mouseWorldOrigin.y=i.y),t.pixiEvent.stopPropagation()},pinchZoom:function(){var t=this.pointers,e=t[0],n=t[1],s=Math.hypot(e.x-n.x,e.y-n.y),r=Math.hypot(e.toX-n.toX,e.toY-n.toY),o=i.setUp((e.toX+n.toX)/2,(e.toY+n.toY)/2),a=this.owner.windowToWorld(o);this.zoom(a,s/r,this.pinchCam),a.recycle(),o.recycle()},zoom:function(e,i,n){var s=Math.min(this.maxZoom,Math.max(this.minZoom,n.height*i)),r=this.owner,o=4*s/3,a=1-s/n.height,h=t.setUp(n.x+(e.x-n.x)*a,n.y+(e.y-n.y)*a,o,s);r.triggerEvent("resize-camera",h),r.triggerEvent("relocate",h),h.recycle()},repositionCamera:function(t,e){var n=i.setUp(t.x-e.x,t.y-e.y),s=this.owner.windowToWorld(n,!1);s.x+=this.mouseWorldOrigin.x,s.y+=this.mouseWorldOrigin.y,this.owner.triggerEvent("relocate",s),n.recycle(),s.recycle()}}})}(),function(){"use strict";platypus.createComponentClass({id:"ZYManipulator",properties:{conversionMultiplier:1,baseZ:platypus.supports.mobile?500:4500},publicProperties:{y:0,z:0},initialize:function(){},events:{"handle-logic":function(){this.z=this.baseZ+this.y*this.conversionMultiplier}}})}();