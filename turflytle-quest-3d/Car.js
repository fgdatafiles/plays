pc.script.attribute("speedMax","number",20),pc.script.attribute("speedmin","number",10),pc.script.create("Car",function(a){var b=function(a){this.entity=a},c=3,d=null,e=null,f="3176272",g="3176275",h="3176274",i="3176273",j=[f,g,h,i];return b.prototype={initialize:function(){if(this.heading=new pc.Vec3,this.z=new pc.Vec3,this.x=new pc.Vec3,this._calculateXZSpeed(),this.speed=pc.math.random(this.speedmin,this.speedMax),this.turningSpeed=this.speed,this.cacheTween=null,this.yaw=this.entity.getEulerAngles().y,this.isTurning=!1,this.entity.model.model){this.meshInstances=this.entity.model.model.meshInstances[0];var b=this.meshInstances.material.clone(),c=Math.floor(pc.math.random(0,j.length)),d=a.assets.get(j[c]);b.diffuseMap=d.resource,b.update(),this.meshInstances.material=b}this.playerEntity=a.root.findByName("Player"),this.playerPos=new pc.Vec3,this.audioControllerScript=a.root.findByName("AudioPlayer").script.AudioController},update:function(a){if(!PAUSE){this.entity.model.model&&pc.Utils.calculateSegment(this.entity.getPosition(),this.entity.model.model.meshInstances[0].node.renderingSegment),this.playerPos.copy(this.playerEntity.getPosition());var b=this.playerPos.sub(this.entity.getPosition()).length();10>b?(3!==c||d||(d=this,this.audioControllerScript._playSFX("carHorn")),d===this&&(c-=a,0>c&&(d=null,c=3))):d===this&&(d=null,c=3),30>b?e&&e!==this||(e=this,this.audioControllerScript.adjustVolume("SFX","carEngine",.5*(1-b/30))):e===this&&(this.audioControllerScript.adjustVolume("SFX","carEngine",0),e=null);var f=this.speed*a;if(this.entity.translate(this.heading.x*f,this.heading.y*f,this.heading.z*f),this.isTurning&&this.turningAngle>0){var g=this.turningSpeed*a*8;Math.abs(g)>this.turningAngle&&(g=this.turningAngle*g/Math.abs(g)),this.entity.rotateLocal(0,g,0),this.turningAngle-=Math.abs(g),this._calculateXZSpeed(),pc.Utils.approx_eq(this.turningAngle,0)&&(this.isTurning=!1,this.turningSpeed=this.speed)}}},turn:function(a){if(!this.isTurning){switch(this.isTurning=!0,a){case"left":this.turningAngle=90;break;case"right":this.turningAngle=-90;break;default:this.turningAngle=0;var b=this;setTimeout(function(){b.isTurning=!1,b.turningSpeed=b.speed},1e3)}this.turningSpeed*=0===this.turningAngle?0:this.turningAngle/Math.abs(this.turningAngle),this.turningAngle=Math.abs(this.turningAngle)}},_calculateXZSpeed:function(){var a=this.entity.getWorldTransform();this.heading.set(0,0,0),a.getZ(this.z),this.z.y=0,this.z.normalize(),this.heading.add(this.z)}},b});