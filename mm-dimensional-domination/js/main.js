var game=game||{};var globalsignal=new WONBATS.Signal();var globaltick=0;(function(){'use strict';function Main(){this.last=Date.now();this.slow=1;this.fps=game.config.FIXED_FPS;this.step=1/this.fps;this.rdt=0;this.ticks=0;var rendererOptions={antialiasing:true,transparent:false,resolution:window.devicePixelRatio,view:document.getElementById("gamecanvas"),backgroundColor:0x000000};this.renderer=PIXI.autoDetectRenderer(game.config.GAME_WIDTH,game.config.GAME_HEIGHT,rendererOptions);this.rotateImage=PIXI.Sprite.fromImage("assets/rotate.png");this.rotateImage.interactive=true;this.rotateImage.buttonMode=true;this.stage=new PIXI.Container();var canvas=this.renderer.view;setInterval(function(){window.focus();},1000);game.renderer=this.renderer;this.isMobile={Android:function(){return navigator.userAgent.match(/Android/i);},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i);},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i);},Opera:function(){return navigator.userAgent.match(/Opera Mini/i);},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i);},any:function(){return(isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows());}};document.body.appendChild(this.renderer.view);if(game.config.RESIZE){this.resize();window.addEventListener("resize",this.resize.bind(this));if(this.isMobile.iOS()){window.addEventListener("orientationchange",this.resize.bind(this));}}
if(game.config.FPS_METER){this.meter=new FPSMeter();}
game.soundManager=new WONBATS.SoundManager();this.screenflow=new WONBATS.Screenflow(game.config.SCREENS,this.stage,game.config.GAME_WIDTH,game.config.GAME_HEIGHT);if(game.config.DATA_RESET){this.screenflow.start("data_reset");}else{this.screenflow.start("preloader");}
requestAnimationFrame(this.frame.bind(this));console.log('%c Version '+game.config.VERSION+'! ','background: #222; color: #bada55');}
Main.ratio=1;Main.prototype.frame=function(){var now=0,dt=0;now=Date.now();dt=dt+Math.min(0.1,(now-this.last)/1000);var isPortraitAndLevelScreen=(this.screenflow.getLastScreen().name==="level")&&!this.isLandscape;if(!isPortraitAndLevelScreen){this.rdt+=dt;this.ticks+=1;while(this.rdt>this.step){globaltick+=1;this.rdt-=this.step;this.fixedUpdate(this.step*this.slow);}}
this.last=now;this.update(dt*this.slow);requestAnimationFrame(this.frame.bind(this));};Main.prototype.fixedUpdate=function(fdt){this.screenflow.update(fdt);};Main.prototype.update=function(dt){if(game.config.FPS_METER){this.meter.tickStart();}
this.renderer.render(this.stage);if(game.config.FPS_METER){this.meter.tick();}
this.rotateMessage();};Main.prototype.resize=function(){Main.ratio=Math.min(window.innerWidth/game.config.GAME_WIDTH,window.innerHeight/game.config.GAME_HEIGHT);this.renderer.view.style.width=(game.config.GAME_WIDTH*Main.ratio)+"px";this.renderer.view.style.height=(game.config.GAME_HEIGHT*Main.ratio)+"px";this.checkOrientation();};Main.prototype.checkOrientation=function(e){if(!this.isMobile.iOS()){if(screen.width<screen.height){this.isLandscape=false;}else{this.isLandscape=true;}}else{if(window.orientation==0){this.isLandscape=false;}else{this.isLandscape=true;}}};Main.prototype.rotateMessage=function(){if(this.isLandscape){if(this.rotateImage.parent){this.rotateImage.parent.removeChild(this.rotateImage);}}else{if(!this.rotateImage.parent){this.stage.addChild(this.rotateImage);}else{this.stage.setChildIndex(this.rotateImage,this.stage.children.length-1);}}};game.Main=Main;}());