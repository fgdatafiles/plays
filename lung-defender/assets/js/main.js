function shuffleArray(t){for(var i,s,e=t.length;e;i=Math.floor(Math.random()*e),s=t[--e],t[e]=t[i],t[i]=s);return t}!function(){var t=include("createjs.Container"),i=function(i,s){t.call(this),this.mc=i,this.callbackFunc=s,this.setWing=this.setWing.bind(this),this.shuffleTriggers=this.shuffleTriggers.bind(this),this.updateProgress=this.updateProgress.bind(this),this.setRound=this.setRound.bind(this),this.changeLevel=this.changeLevel.bind(this),this.setScore=this.setScore.bind(this),this.setTrigger=this.setTrigger.bind(this),this.getRound=this.getRound.bind(this),this.setTotal=this.setTotal.bind(this),this.getScore=this.getScore.bind(this),this.getLevel=this.getLevel.bind(this),this.getTrigger=this.getTrigger.bind(this),this.getTriggersArr=this.getTriggersArr.bind(this),this.reset=this.reset.bind(this),this.addScore=this.addScore.bind(this),this.missedScore=this.missedScore.bind(this),this.calcScore=this.calcScore.bind(this),this.triggersArr=app.config.gameData.triggers,this.roundIndx=0,this.totalTriggers=0,this.releasedTriggers=0,this.levelIndx=0,this.score=0,this.currentScore=0,this.missed=0,this.collected=0,this.round=0,this.levelsArr=app.config.gameData.triggerMovements,this.SCincrements=app.config.gameData.scoreIncrement,this.rangesArr=app.config.gameData.missedRange,this.totalLength=app.config.gameData.progressBarLength,this.totalLevels=app.config.gameData.totalLevels,this._scoreTxt=new createjs.Text("0","24px nunitobold","#FFFF99"),this.mc.addChild(this._scoreTxt),this._scoreTxt.textBaseline="top",this._scoreTxt.x=297,this._scoreTxt.y=3.55+app.textOffset,this.mc._progressbar.scaleX=0,this.setTotal(20),this.setScore(),this.shuffleTriggers(),this.setTrigger(),this.updateProgress(),this.setWing()},s=(t.prototype,extend(i,t));s.addScore=function(){return this.collected++,this.currentScore+=this.SCincrements,this.updateProgress(),this.setScore(),this.collected},s.missedScore=function(){this.missed++;for(var t=0;t<this.rangesArr.length;t++)this.missed==this.rangesArr[t]&&(app.sound.play("wall_"+this.missed),this.callbackFunc(app.CLOSE_WALL_EVENT),t==this.rangesArr.length-1&&this.callbackFunc(app.CREATE_INHALER_EVENT));this.updateProgress()},s.calcScore=function(){return this.score+=this.currentScore,this.currentScore=0,this.round<4?(this.setRound(),!1):(this.changeLevel(),!0)},s.setWing=function(){this.mc._wing.gotoAndStop(this.levelIndx)},s.shuffleTriggers=function(){this.roundIndx=0,this.triggersArr=shuffleArray(this.triggersArr)},s.updateProgress=function(){this.releasedTriggers=this.collected+this.missed;var t=this.releasedTriggers/this.totalTriggers,i=this.totalLength*t;this.mc._progressbar.scaleX=124*t,this.mc._ship.x=this.mc._progressbar.x+i+5,this.releasedTriggers==this.totalTriggers&&this.callbackFunc(app.LEVEL_COMPLETE_EVENT)},s.setRound=function(){this.missed=0,this.collected=0,this.round++,this.roundIndx++,this.setScore(),this.updateProgress()},s.changeLevel=function(){this.totalTriggers,this.SCincrements,this.totalLevels,this.rangesArr[2],this.SCincrements,this.totalLevels;var t={type:"level",up:!1,missed:this.missed,indx:this.levelIndx,score:this.score};this.score>=0&&(t.up=!0,this.levelIndx<this.levelsArr.length&&(this.levelIndx++,t.indx=this.levelIndx)),this.callbackFunc(app.SOUND_DONE_EVENT,t),this.round=0,this.missed=0,this.collected=0,this.updateProgress(),this.setScore(),this.shuffleTriggers(),this.setWing()},s.setVisible=function(t){this.mc.visible=t},s.setScore=function(){this._scoreTxt.text=this.currentScore},s.setTrigger=function(){for(var t=0;t<5;++t){var i=this.mc["_trigger"+t];this.roundIndx==t?i.gotoAndStop(this.triggersArr[t]+"_on"):i.gotoAndStop(this.triggersArr[t]+"_off")}},s.getRound=function(){return this.round},s.setTotal=function(t){this.totalTriggers=t},s.getScore=function(){return this.currentScore},s.getLevel=function(){return this.levelsArr[this.levelIndx]},s.getTrigger=function(){return this.triggersArr[this.roundIndx]},s.getTriggersArr=function(){return this.triggersArr},s.reset=function(){this.levelIndx=0,this.score=0,this.currentScore=0,this.missed=0,this.collected=0,this.round=0,this.setWing()},namespace("WGBH").InfoBarMC=i}(),function(){var t=include("createjs.Container"),i=function(i,s){t.call(this),this.mc=i,this.endCallback=s,this.instrArr=app.config.gameData.instructLabelsArr,this.instrIndex=0,this.instrAudioDone=!1,this.closeIt=!1,this.update=this.update.bind(this),this.startInstruction=this.startInstruction.bind(this),this.soundDone=this.soundDone.bind(this),this.skipIntro=this.skipIntro.bind(this),this.replayInstruction=this.replayInstruction.bind(this)},s=(t.prototype,extend(i,t));s.startInstruction=function(){this.mc.gotoAndPlay(this.instrArr[this.instrIndex]),this.instrAudioDone=!0,app.on("update",this.update),this.mc.btn_skip.addEventListener("click",this.skipIntro),this.mc.btn_go.addEventListener("click",this.skipIntro),this.mc.btn_replay.addEventListener("click",this.replayInstruction)},s.replayInstruction=function(t){app.voPlayer.stop(),app.sound.play("click"),this.instrAudioDone=!0,this.instrIndex=0,this.mc.gotoAndPlay(16),app.on("update",this.update)},s.update=function(t){!this.closeIt&&this.mc.currentLabel!=this.instrArr[this.instrIndex]&&this.instrAudioDone?(this.instrIndex++,this.instrIndex>=this.instrArr.length?app.off("update",this.update):(this.instrAudioDone=!1,this.mc.gotoAndPlay(this.instrArr[this.instrIndex]),app.voPlayer.play(["instr_"+this.instrArr[this.instrIndex],this.soundDone]))):this.closeIt&&this.mc.currentFrame==this.mc.timeline.duration-1&&(app.off("update",this.update),this.endCallback(app.INSTR_DONE_EVENT))},s.skipIntro=function(t){this.closeIt=!0,app.voPlayer.stop(),app.on("update",this.update),app.sound.play("click"),this.mc.gotoAndPlay("up")},s.soundDone=function(t){this.instrAudioDone=!0},namespace("WGBH").InstructionMC=i}(),function(){var t=include("createjs.Container"),i=function(i,s,e){t.call(this),this.update=this.update.bind(this),this.showTrigger=this.showTrigger.bind(this),this.introDone=this.introDone.bind(this),this.showButton=this.showButton.bind(this),this.startTransitionIn=this.startTransitionIn.bind(this),this.showTrans=this.showTrans.bind(this),this.introAudioDone=this.introAudioDone.bind(this),this.asthmaGame=i,this.bar=s,this.callbackFunc=e,this.intro=this.asthmaGame._intro,this.transin=this.asthmaGame._transin,this.triggerIntro=this.asthmaGame._triggerintro,this.AMP_ARR=app.config.introData.ampArr,this.EYE_BLINK_ARR=app.config.introData.eyeBlinkArr,this.ampIndex=0,this.blinkIndex=0,this.firstTime=!0,this.intro.visible=!0,this.transin.visible=!1,this.triggerIntro.visible=!1,this.intro.gotoAndStop(),this.triggerIntro.gotoAndStop(),this.triggerIntro.btn_enter.visible=!1},s=(t.prototype,extend(i,t));s.playIntro=function(){this.intro.gotoAndPlay(1),app.voPlayer.play("intro",this.introAudioDone),app.on("update",this.update)},s.showTrigger=function(t,i){app.on("update",this.update),this.triggerIntro.btn_enter.visible=!1,this.intro.visible=!1,this.triggerIntro.visible=!0,this.partType=this.bar.getTrigger(),i&&(this.firstTime=!1);var s=1;this.firstTime?(s=0==t?1:2==t?2:3,0==t?app.voPlayer.play(["trigger_intro"+s,"trigger_"+this.partType,"trigger_def_"+this.partType,"itstime",this.introDone]):app.voPlayer.play(["trigger_intro"+s,"trigger_"+this.partType,"trigger_def_"+this.partType,this.showButton])):0==t?app.voPlayer.play(["watchout","trans_"+this.partType,"itstime",this.introDone]):app.voPlayer.play(["watchout","trans_"+this.partType,this.showButton]),this.triggerIntro.gotoAndStop(this.partType)},s.introDone=function(){app.sound.play("tada",{complete:this.showButton})},s.showButton=function(){this.firstTime&&app.voPlayer.play("clicklungs"),this.triggerIntro.btn_enter.visible=!0,this.triggerIntro.btn_enter.addEventListener("click",this.startTransitionIn)},s.startTransitionIn=function(t){this.triggerIntro.btn_enter.removeEventListener("click",this.startTransitionIn),app.sound.stopAll(),app.voPlayer.play(["goingin",this.showTrans]),app.sound.play("click")},s.showTrans=function(){this.triggerIntro.visible=!1,this.transin.visible=!0,this.transin.gotoAndPlay(0),app.sound.play("rocket")},s.update=function(){this.intro.visible?(this.ampIndex==this.EYE_BLINK_ARR[this.blinkIndex][0]&&(this.intro.buster._eyes.gotoAndStop(this.EYE_BLINK_ARR[this.blinkIndex][1]),this.blinkIndex=this.blinkIndex<this.EYE_BLINK_ARR.length-1?this.blinkIndex+1:this.EYE_BLINK_ARR.length-1),this.intro.buster._head.gotoAndStop(this.AMP_ARR[this.ampIndex]),this.ampIndex=this.ampIndex<this.AMP_ARR.length-1?this.ampIndex+1:this.AMP_ARR.length-1,this.intro.currentFrame==this.intro.timeline.duration-1&&this.intro.stop()):this.transin.visible&&(this.transin.currentFrame==this.transin.timeline.duration-1?(this.transin.visible=!1,app.off("update",this.update),this.callbackFunc(app.TRANS_DONE_EVENT)):"gameIn"==this.transin.currentLabel&&this.callbackFunc(app.SET_GAME_EVENT))},s.introAudioDone=function(){this.showTrigger(0)},namespace("WGBH").Intros=i}(),function(){var t=include("createjs.Container"),i=function(i,s){t.call(this),this.setupScore=this.setupScore.bind(this),this.formatNumber=this.formatNumber.bind(this),this.nextRound=this.nextRound.bind(this),this.mc=i,this.endCallback=s,this.badgeArr=app.config.gameData.badges,this.rankIndx=1,this.mc.visible=!1,this.mc.btn_again.visible=!1,this.scoreTxt=new createjs.Text("10","42px nunitobold","#FFFF99"),this.scoreTxtShad=new createjs.Text("10","42px nunitobold","#000000"),this.scoreTxt.x=276,this.scoreTxt.y=390+2*app.textOffset,this.scoreTxtShad.x=this.scoreTxt.x+2,this.scoreTxtShad.y=this.scoreTxt.y+2,this.mc.addChild(this.scoreTxtShad,this.scoreTxt)},s=(t.prototype,extend(i,t));s.setupScore=function(t){t.indx&&this.rankIndx++;for(var i=1;i<7;i++){var s=this.mc["_level"+i];i<=this.rankIndx?s.gotoAndStop("on"):s.gotoAndStop("off")}this.mc._wings.gotoAndStop(this.rankIndx-1),this.mc.txt_rank.gotoAndStop(this.rankIndx-1),this.scoreTxt.text=this.formatNumber(t.score),this.scoreTxtShad.text=this.scoreTxt.text,this.mc.visible=!0,this.isEnd=!0,6==this.rankIndx?(this.mc.btn_again.visible=!0,this.mc.btn_again.addEventListener("click",this.nextRound),this.mc.btn_next.visible=!1):(this.mc.btn_again.visible=!1,this.mc.btn_next.visible=!0,this.mc.btn_next.addEventListener("click",this.nextRound),this.isEnd=!1);var e=[];t.missed<=3?e.push("exit_great"):e.push("exit_good"),t.up?(e.push("exit_promotion"),3==this.rankIndx||this.rankIndx>=5?e.push("exit_an"):e.push("exit_a"),e.push("title_"+this.badgeArr[this.rankIndx-1]),this.end&&e.push("complete_thebest","complete_congrats")):e.push("exit_remember"),app.voPlayer.play(e)},s.formatNumber=function(t){return t.toLocaleString()},s.nextRound=function(t){this.mc.btn_next.visible?(this.mc.btn_next.removeEventListener("click",this.nextRound),this.endCallback(app.END_LEVEL_EVENT)):(this.rankIndx=1,this.mc.btn_again.removeEventListener("click",this.nextRound),this.endCallback(app.END_GAME_EVENT)),this.mc.visible=!1},namespace("WGBH").ScoreboardMC=i}(),function(){var t=include("createjs.Container"),i=include("springroll.DelayedCall"),s=function(i,s){t.call(this),this.setShip=this.setShip.bind(this),this.extendGrabber=this.extendGrabber.bind(this),this.extending=this.extending.bind(this),this.animateBack=this.animateBack.bind(this),this.retractGrabber=this.retractGrabber.bind(this),this.getTest=this.getTest.bind(this),this.setTest=this.setTest.bind(this),this.getShipHeight=this.getShipHeight.bind(this),this.removeTimer=this.removeTimer.bind(this),this.mc=i,this.endCallback=s,this.delay=null,this.testIt=!0,this.partType="",this.DELAY_TIME=app.config.shipData.delayTime,this.GRABBER_EXTEND=app.config.shipData.grabberExtendLong,this.GRABBER_START=app.config.shipData.grabberStartY,this.LINE_HEIGHT=0,this.duration=0,this.GRABBER_SPEED=app.config.shipData.grabberSpeed,this.RETRACT_SPEED=app.config.shipData.retractSpeed,this.CONSUME_SPEED=app.config.shipData.consumeSpeed,this.GRABBER_ARM_SPEED=app.config.shipData.grabberArmSpeed,this.RETRACT_ARM_SPEED=app.config.shipData.retractArmSpeed,this.CONSUME_ARM_SPEED=app.config.shipData.consumeArmSpeed,this.mc.grabber.gotoAndStop("open"),this.mc.grabber_line.scaleY=0,this.mc.grabber_line.y=0},e=(t.prototype,extend(s,t));e.setShip=function(t,i){this.mc.mouseChildren=!1,this.partType=t,this.mc.grabber.y=this.GRABBER_START,this.mc.grabber_line.scaleY=this.LINE_HEIGHT,this.mc.grabber.gotoAndStop("open"),this.GRABBER_EXTEND="all"==i?app.config.shipData.grabberExtendShort:app.config.shipData.grabberExtendLong},e.extendGrabber=function(){this.testIt=!0,this.mc.grabber.gotoAndStop("open"),this.mc.grabber.visible=!0,this.mc.grabber.y=this.GRABBER_START,this.mc.grabber_line.scaleY=this.LINE_HEIGHT,this.delay&&(this.delay.stop(),this.delay.destroy(),this.delay=null),this.delay=new i(this.extending,this.DELAY_TIME,{repeat:!0})},e.extending=function(){this.mc.grabber.y>-this.GRABBER_EXTEND?(this.mc.grabber.y-=this.GRABBER_SPEED,this.mc.grabber_line.scaleY-=this.GRABBER_ARM_SPEED):(this.delay.stop(),this.delay.destroy(),this.delay=null,this.animateBack(!1))},e.animateBack=function(t,s){this.testIt=!1,this.delay&&(this.delay.stop(),this.delay.destroy(),this.delay=null),t?this.mc.grabber.gotoAndStop(this.partType):s?this.mc.grabber.gotoAndStop("inhaler"):this.mc.grabber.gotoAndStop("close"),this.delay=new i(this.retractGrabber,this.DELAY_TIME,{repeat:!0})},e.retractGrabber=function(){this.mc.grabber_line.scaleY>=this.LINE_HEIGHT?this.mc.grabber_line.scaleY+=this.CONSUME_ARM_SPEED:this.mc.grabber_line.scaleY<this.LINE_HEIGHT&&(this.mc.grabber_line.scaleY+=this.RETRACT_ARM_SPEED),this.mc.grabber.y>=this.GRABBER_START?this.mc.grabber.y+=this.CONSUME_SPEED:this.mc.grabber.y<0&&(this.mc.grabber.y+=this.RETRACT_SPEED),this.mc.grabber.y>=0&&(this.testIt=!0,this.mc.grabber.y=0,this.mc.grabber.gotoAndStop("open"),this.mc.grabber.y=this.GRABBER_START,this.mc.grabber_line.scaleY=this.LINE_HEIGHT,this.delay.stop(),this.delay.destroy(),this.delay=null,this.endCallback(app.SHIP_DONE_EVENT))},e.removeTimer=function(){this.delay&&(this.delay.stop(),this.delay.destroy(),this.delay=null)},e.getTest=function(){return this.testIt},e.setTest=function(t){this.testIt=t},e.getShipHeight=function(){return this.mc.grabber.y-this.GRABBER_START},namespace("WGBH").ShipMC=s}(),function(){var t=include("createjs.Container"),i=function(i,s){t.call(this),this.update=this.update.bind(this),this.labelIndex=0,this.mc=i,this.callbackFunc=s,this.mc.visible=!1,this.mc.gotoAndStop(0),this.playPoint=!1,this.checkPoint=!1},s=(t.prototype,extend(i,t));s.startTransOut=function(t){this.playPoint=!1,this.checkPoint=!1,this.points=t,this.mc.visible=!0,this.mc.gotoAndPlay(1),this.mc.pointsMC.gotoAndStop(0),this.labelIndex=0,app.on("update",this.update)},s.update=function(){"scoreIn"==this.mc.currentLabel?this.callbackFunc(app.SET_NEXT_EVENT):"points"!=this.mc.currentLabel||this.playPoint?this.mc.currentFrame==this.mc.timeline.duration-1&&(app.off("update",this.update),this.mc.stop(),this.mc.visible=!1):(this.playPoint=!0,this.mc.stop(),this.mc.pointsMC.gotoAndPlay(2)),this.mc.pointsMC.currentLabel==this.labelIndex.toString()&&(this.labelIndex+=10,app.sound.play("click")),this.mc.pointsMC.currentLabel!=this.points.toString()||this.checkPoint||(this.checkPoint=!0,this.mc.pointsMC.stop(),this.mc.gotoAndPlay(this.mc.currentFrame+1))},namespace("WGBH").TransOutMC=i}(),function(){var t=include("createjs.Container"),i=include("springroll.DelayedCall"),s=function(i,s,e,a,h,n,r,o,l){t.call(this),this.mc=null,this.partRef=null,this.ship=s,this.mainRef=i,this.partType=e,this.xPos=a,this.yPos=h,this.vy=n,this.movement=r,this.centerX=a,this.hitTest=l,this.endCallback=o,this.createTrigger=this.createTrigger.bind(this),this.moving=this.moving.bind(this),this.removeSelf=this.removeSelf.bind(this),this.hitTesting=this.hitTesting.bind(this),this.removeTimer=this.removeTimer.bind(this),this.changeX=this.changeX.bind(this),this.createTrigger()},e=(t.prototype,extend(s,t));e.createTrigger=function(){this.particlesArr=["mold","pollen","smoke","dander","dust"],this.radius=100,this.speed=.1,0!=this.vy&&null!=this.vy||(this.vy=2),this.angle=0,this.centerX=this.xPos,this.mc=new lib.cParticles,this.addChild(this.mc);for(var t=0;t<5;t++)this.partRef=this.mc[this.particlesArr[t]],this.partType==this.particlesArr[t]?this.partRef.visible=!0:this.partRef.visible=!1;var s=Math.random()*this.partRef.timeline.duration|0;this.partRef.gotoAndPlay(s),this.dir=2*Math.random()|0,0==this.dir&&(this.mc.scaleX=-1),"random"==this.movement?(this.vx=10*Math.random()-5,this.changeXDelay=new i(this.changeX,50)):"wave_big"==this.movement?this.radius=200:"wave_sm"==this.movement&&(this.radius=50),this.x=this.xPos,this.y=this.yPos},e.changeX=function(){this.vx<0?this.vx=Math.ceil(10*Math.random()):this.vx=-Math.ceil(10*Math.random()),this.changeXDelay=new i(this.changeX,2e3*Math.random())},e.moving=function(){return"wave_big"==this.movement||"wave_sm"==this.movement?(0==this.dir?this.x=this.centerX+Math.sin(this.angle)*this.radius:this.x=this.centerX+Math.cos(this.angle)*this.radius,this.angle+=this.speed):"random"==this.movement&&(this.x<this.mainRef.wallLeft&&this.vx<0&&(this.vx=-this.vx),this.x>this.mainRef.wallRight&&this.vx>0&&(this.vx=-this.vx),this.x+=this.vx),this.y+=this.vy,this.y>app.config.gameData.offstageY&&(this.removeSelf(),this.endCallback(app.MISSED_PARTICLE_EVENT,this),!0)},e.hitTesting=function(){if(this.ship.getTest()&&this.hitTest){var t=Math.abs(this.x-this.ship.mc.x),i=Math.abs(this.y-(this.ship.mc.y+this.ship.getShipHeight()));if(t<=65&&i<=75&&this.y<this.ship.mc.y){var s=new lib.cPlusTen;this.mainRef.addChild(s),s.x=this.x,s.y=this.y,app.sound.play("triggergrab"),this.endCallback(app.GOT_PARTICLE_EVENT,this),this.removeSelf()}}},e.removeSelf=function(){this.changeXDelay&&(this.changeXDelay.stop(),this.changeXDelay.destroy(),this.changeXDelay=null),this.parent&&this.parent.removeChild(this)},e.removeTimer=function(){this.removeSelf()},namespace("WGBH").TriggerParticleMC=s}(),function(){var t=include("springroll.easeljs.BasePanel"),i=include("createjs.Container"),s=include("springroll.DelayedCall"),e=function(){t.call(this),this.setupWall=this.setupWall.bind(this),this.gameLoop=this.gameLoop.bind(this),this.createParticle=this.createParticle.bind(this),this.initGame=this.initGame.bind(this),this.playGroundAnimation=this.playGroundAnimation.bind(this),this.moving=this.moving.bind(this),this.fireGrabber=this.fireGrabber.bind(this),this.barDispatchEvent=this.barDispatchEvent.bind(this),this.instrDispatchEvent=this.instrDispatchEvent.bind(this),this.shipDispatchEvent=this.shipDispatchEvent.bind(this),this.introDispatchEvent=this.introDispatchEvent.bind(this),this.scoreDispatchEvent=this.scoreDispatchEvent.bind(this),this.transOutDispatchEvent=this.transOutDispatchEvent.bind(this),this.particleDispatchEvent=this.particleDispatchEvent.bind(this),this.pauseGame=this.pauseGame.bind(this),this.setupExit=this.setupExit.bind(this),this.resetGame=this.resetGame.bind(this),this.animateWallLoop=this.animateWallLoop.bind(this),this.animateOpenWallLoop=this.animateOpenWallLoop.bind(this),this.chatterDone=this.chatterDone.bind(this),this.update=this.update.bind(this)},a=t.prototype,h=extend(e,t);h.setup=function(){this.particleSFXCount=0,this.particleSFX1=null,this.particleSFX2=null,this.chatterSFX=null,this.chatterArr=["chatter_12","chatter_copy","chatter_fast","chatter_keep","chatter_stay","chatter_steady","cmt_goodeye","cmt_gotone","cmt_takethat","cmt_waytogo","cmt_woohoo"],this.chatterIndx=0,this.numParticles=15,this.score=0,this.createInhaler=0,this.animatingWall="none",this.particlesArr=[],this.partPerRound=1,this.partType="pollen",this.mouseX=0,this.mouseY=0,this.vx=0,this.vy=0,this.particleVY=[],this.shipVY=8,this.shipVX=8,this.particleMovement="",this.shipMovement="all",this.origWallLeft=0,this.origWallRight=0,this.wallLeft=0,this.wallRight=0,this.leftBound=0,this.offset=0,this.gotInhaler=!1,this.gameOver=!1,this.animateGrabber=!0,this.fullInstr=!0,this.firstPlay=!0,this.hasExit=!1,this.LEFT=app.config.gameData.stageLeftBound,this.RIGHT=app.config.gameData.stageRightBound,this.UP=app.config.gameData.stageUpBound,this.DOWN=app.config.gameData.stageDownBound,this.SPRING=app.config.shipData.shipSpring,app.isFF=!1,app.textOffset=0,/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&(app.isFF=!0,app.textOffset=5),this.delay=null,this.triggersMC=new i,this.asthmaGame=new lib.Game,this.addChild(this.asthmaGame),this.chatterArr=shuffleArray(this.chatterArr),this.wall_left=this.asthmaGame.wall.wall_left,this.wall_right=this.asthmaGame.wall.wall_right,this.exit=this.asthmaGame._exit,this.inhaler=this.asthmaGame._triggersMC.inhaler,this.mist=this.asthmaGame.mist,this.mist.gotoAndStop(0),this.inhaler.visible=!1,this.exit.visible=!1,this.exit.gotoAndStop(0),this.wall_left.gotoAndStop(0),this.wall_right.gotoAndStop(0),this.wall_left.wall.fill.gotoAndStop(0),this.wall_right.wall.fill.gotoAndStop(0),this.origWallLeft=this.wall_left.x,this.origWallRight=this.wall_right.x,this.bar=new WGBH.InfoBarMC(this.asthmaGame.bar,this.barDispatchEvent),this.bar.setTotal(this.numParticles),this.instr=new WGBH.InstructionMC(this.asthmaGame._instr,this.instrDispatchEvent),this.shooter=new WGBH.ShipMC(this.asthmaGame.shooter,this.shipDispatchEvent),this.intros=new WGBH.Intros(this.asthmaGame,this.bar,this.introDispatchEvent),this.scoreboard=new WGBH.ScoreboardMC(this.asthmaGame._scoreboard,this.scoreDispatchEvent),this.transOut=new WGBH.TransOutMC(this.asthmaGame._transout,this.transOutDispatchEvent),this.asthmaGame.ground.gotoAndStop(0),this.asthmaGame._triggersMC.addChild(this.triggersMC)},h.barDispatchEvent=function(t,i){t==app.CLOSE_WALL_EVENT?this.closeInWall():t==app.CREATE_INHALER_EVENT?this.createInhaler++:t==app.LEVEL_COMPLETE_EVENT?this.shooter.getTest()?this.pauseGame():this.gameOver=!0:t==app.SOUND_DONE_EVENT&&"level"==i.type&&this.scoreboard.setupScore(i)},h.instrDispatchEvent=function(t){t==app.INSTR_DONE_EVENT&&this.initGame()},h.shipDispatchEvent=function(t){t==app.SHIP_DONE_EVENT&&(this.animateGrabber=!0,this.exit.visible||(this.gotInhaler&&"none"==this.animatingWall&&(this.gotInhaler=!1,this.openWall()),this.gameOver&&this.pauseGame()))},h.introDispatchEvent=function(t){if(t==app.TRANS_DONE_EVENT)app.firstTime?(app.firstTime=!1,this.partType=this.bar.getTrigger(),this.instr.startInstruction()):this.initGame();else if(t==app.SET_GAME_EVENT){this.bar.setTrigger(),this.partType=this.bar.getTrigger(),this.shooter.setShip(this.partType,this.shipMovement);this.asthmaGame.getChildIndex(this.transin);this.wall_left.x=this.origWallLeft,this.wall_right.x=this.origWallRight,this.wall_left.wall.mucus.x=app.config.gameData.mucusInitX,this.wall_right.wall.mucus.x=app.config.gameData.mucusInitX,this.asthmaGame.wall.visible=!0,this.bar.setVisible(!0),this.shooter.mc.x=app.config.shipData.shipInitX,this.shooter.mc.y=app.config.shipData.shipInitY}},h.scoreDispatchEvent=function(t){app.sound.stopAll(),t==app.END_LEVEL_EVENT?(this.partType=this.bar.getTrigger(),this.intros.showTrigger(this.bar.getRound(),!0),app.sound.play("click")):t==app.END_GAME_EVENT&&(this.bar.reset(),this.partType=this.bar.getTrigger(),this.intros.showTrigger(0,!0),app.sound.play("click"))},h.transOutDispatchEvent=function(t){t==app.SET_NEXT_EVENT&&(this.bar.calcScore()||(this.partType=this.bar.getTrigger(),this.intros.showTrigger()))},h.particleDispatchEvent=function(t,i){if(t==app.MISSED_PARTICLE_EVENT)this.bar.missedScore();else if(t==app.GOT_PARTICLE_EVENT){this.shooter.animateBack(!0);var s=this.bar.addScore();(1==s||s%3==0&&this.total>2)&&null==this.chatterSFX&&(this.chatterSFX=app.voPlayer.play([this.chatterArr[this.chatterIndx]],this.chatterDone),this.chatterIndx<this.chatterArr.length-1?this.chatterIndx++:(this.chatterIndx=0,this.chatterArr=shuffleArray(this.chatterArr)))}var e=this.particlesArr.indexOf(i);this.particlesArr.splice(e,1),1==this.particlesArr.length?this.particleSFX2.pause():0==this.particlesArr.length&&this.particleSFX1.pause()},h.chatterDone=function(){this.chatterSFX=null},h.playGroundAnimation=function(){this.asthmaGame.ground.y=app.config.gameData.groundInitY,createjs.Tween.get(this.asthmaGame.ground,{loop:!0}).to({y:app.config.gameData.groundEndY},7e3)},h.startGame=function(){this.intros.playIntro()},h.initGame=function(){this.particleSFXCount=0,this.particleSFX1=null,this.particleSFX2=null,this.wall_left.play(),this.wall_right.play(),this.playGroundAnimation();var t=this.bar.getLevel();this.particleVY=t.speed,this.particleMovement=t.movement,this.animatingWall="none",this.animateGrabber=!0,this.total=this.numParticles,this.gameOver=!1,this.createInhaler=0,this.gotInhaler=!1,app.sound.play("spaceship",{loop:!0}),app.on("update",this.gameLoop),this.addEventListener("click",this.fireGrabber),app.on("update",this.moving),this.addEventListener("pressmove",this.moving),this.delay=new s(this.createParticle,this.bar.getLevel().delay),this.setupWall()},h.setupWall=function(){this.wallLeft=this.LEFT+this.offset,this.wallRight=this.RIGHT-this.offset},h.createParticle=function(t){var i,e=0;e=this.total<.5*this.numParticles||"straight"==this.particleMovement?(e=3*Math.random())==parseInt(e)?e:parseInt(e)+1:2*Math.random()|0;for(var a=0;a<this.partPerRound;a++){var h=Math.random()*(this.wallRight-this.wallLeft)+this.wallLeft;i=0==a?new WGBH.TriggerParticleMC(this,this.shooter,this.partType,h,-30,this.particleVY[this.indx],this.particleMovement,this.particleDispatchEvent,!0):new WGBH.TriggerParticleMC(this,this.shooter,this.partType,h,-30,1,this.particleMovement,this.particleDispatchEvent,!0),this.triggersMC.addChild(i),this.particlesArr.push(i),this.total--}this.particlesArr.length>0&&(1==this.particlesArr.length?(this.particleSFXCount++,null!=this.particleSFX1&&this.particleSFX1.pause(),this.particleSFX1=app.sound.play("triggerloop_"+this.partType,{loop:!0})):this.particlesArr.length>1&&(null!=this.particleSFX2&&this.particleSFX2.pause(),this.particleSFX2=app.sound.play("triggerloop_"+this.partType,{loop:!0}),this.particleSFXCount++)),this.total>0||0==this.numParticles?this.delay=new s(this.createParticle,this.bar.getLevel().delay):(this.delay.stop(),this.delay.destroy(),this.delay=null)},h.fireGrabber=function(t){this.animateGrabber&&(this.animateGrabber=!1,this.shooter.extendGrabber())},h.gameLoop=function(t){var i=(this.mouseX-(this.shooter.mc.x-5))*this.SPRING;this.shooter.mc.x>this.wallLeft?this.shooter.mc.x+=i:this.shooter.mc.x=this.wallLeft,this.shooter.mc.x<this.wallRight?this.shooter.mc.x+=i:this.shooter.mc.x=this.wallRight;var s=(this.mouseY-(this.shooter.mc.y-30))*this.SPRING;if(this.shooter.mc.y>this.UP?this.shooter.mc.y+=s:this.shooter.mc.y=this.UP,this.shooter.mc.y<this.DOWN?this.shooter.mc.y+=s:this.shooter.mc.y=this.DOWN,this.inhaler.visible&&!this.gotInhaler&&!this.exit.visible){var e=Math.abs(this.inhaler.x-this.shooter.mc.x),a=Math.abs(this.inhaler.y-(this.shooter.mc.y+this.shooter.getShipHeight()));e<=70&&a<=93&&this.y<this.shooter.mc.y&&(this.gotInhaler=!0,this.inhaler.visible=!1,this.shooter.animateBack(!1,!0),app.voPlayer.play("inhaler2"))}for(var h=0;h<this.particlesArr.length;h++){this.particlesArr[h].moving()||this.particlesArr[h].hitTesting()}},h.moving=function(t){var i=t==this?t.stageX:app.display.stage.mouseX,s=t==this?t.stageY:app.display.stage.mouseY;this.mouseX=i/app.scaling.scale,this.mouseY=s/app.scaling.scale},h.pauseGame=function(){for("none"!=this.animatingWall&&(this.animatingWall="none",this.wall_left.wall.gotoAndStop(1),this.wall_right.wall.gotoAndStop(1),this.wall_left.wall.fill.gotoAndStop(1),this.wall_right.wall.fill.gotoAndStop(1)),null!=this.inhaler&&(this.inhaler.visible=!1),this.delay&&(this.delay.stop(),this.delay.destroy(),this.delay=null),this.shooter.removeTimer();this.triggersMC.getNumChildren>0;)this.triggersMC.removeChildAt(0);for(;this.particlesArr.length>0;)this.particlesArr[0].removeTimer(),this.particlesArr.shift();this.setupExit()},h.setupExit=function(){app.voPlayer.play("exit_headingout"),this.exit.visible=!0,this.exit.gotoAndPlay(1),app.on("update",this.update)},h.resetGame=function(){app.sound.stop("spaceship"),app.sound.stop("triggerloop_"+this.partType),app.sound.play("rocket"),app.off("update",this.gameLoop),this.removeEventListener("click",this.fireGrabber),app.off("update",this.moving),this.removeEventListener("pressmove",this.moving),this.shooter.visible=!1,this.inhaler.visible=!1,this.gotInhaler=!1,this.hasExit=!1,this.LEFT=app.config.gameData.stageLeftBound,this.RIGHT=app.config.gameData.stageRightBound,this.offset=0,createjs.Tween.removeTweens(this.asthmaGame.ground),this.asthmaGame.wall.visible=!1,this.bar.visible=!1,this.partType=this.bar.getTrigger(),this.bar.setTrigger(),this.transOut.startTransOut(this.bar.getScore())},h.closeInWall=function(){this.animatingWall="close",this.leftBound=this.wall_left.x+app.config.gameData.wallCloseInIncrement,this.wall_left.wall.fill.gotoAndPlay(1),this.wall_right.wall.fill.gotoAndPlay(1),app.on("update",this.animateWallLoop)},h.openWall=function(){this.animatingWall="open",this.mist.visible=!0,this.mist.gotoAndPlay(1),this.leftBound=this.wall_left.x-this.bar.rangesArr.length*app.config.gameData.wallCloseInIncrement,app.on("update",this.animateOpenWallLoop)},h.animateWallLoop=function(t){this.wall_left.x<this.leftBound?(this.offset++,this.wall_left.x+=1,this.wall_right.x-=1,this.wall_left.wall.mucus.x-=app.config.gameData.mucusCLoseInIncrement,this.wall_right.wall.mucus.x-=app.config.gameData.mucusCLoseInIncrement,this.shooter.mc.x>=this.wallRight&&this.shooter.mc.x--,this.shooter.mc.x<=this.wallLeft&&this.shooter.mc.x++):this.gotInhaler?(this.gotInhaler=!1,this.openWall(),this.animatingWall="open",app.off("update",this.animateWallLoop)):(1==this.createInhaler&&this.bar.releasedTriggers<this.bar.totalTriggers-1&&(this.createInhaler++,this.inhaler.visible=!0,this.inhaler.x=app.config.gameData.inhalerInitX,this.inhaler.y=app.config.gameData.inhalerInitY,app.voPlayer.play("inhaler1")),this.animatingWall="none",this.wall_left.wall.fill.gotoAndStop(1),this.wall_right.wall.fill.gotoAndStop(1),app.off("update",this.animateWallLoop)),this.setupWall()},h.animateOpenWallLoop=function(t){this.wall_left.x>this.leftBound?(this.offset--,this.wall_left.x-=1,this.wall_right.x+=1,this.wall_left.wall.mucus.x+=app.config.gameData.mucusCLoseInIncrement,this.wall_right.wall.mucus.x+=app.config.gameData.mucusCLoseInIncrement,this.shooter.mc.x<=this.wallRight&&this.shooter.mc.x++,this.shooter.mc.x>=this.wallLeft&&this.shooter.mc.x--):(this.animatingWall="none",app.off("update",this.animateOpenWallLoop)),this.setupWall()},h.update=function(t){this.exit.visible&&("ah"!=this.exit.currentLabel||this.hasExit?this.exit.currentFrame==this.exit.timeline.duration-1&&(app.off("update",this.update),this.exit.visible=!1,this.exit.gotoAndStop(0),this.resetGame()):(this.hasExit=!0,app.voPlayer.play("exit_ahchoo")))},h.teardown=function(){a.teardown.call(this),this.skin=null,this.asthmaGame=null,app.off("update",this.moving),app.off("update",this.gameLoop)},namespace("WGBH").GamePanel=e}(),function(){var t=include("springroll.easeljs.BasePanel"),i=include("createjs.Bitmap"),s=function(){t.call(this)},e=t.prototype,a=extend(s,t);a.setup=function(){this.background=new i(images.TitleBackground),this.addChildAt(this.background,0)},a.teardown=function(){e.teardown.call(this),this.background=null},namespace("WGBH").TitlePanel=s}(),function(){var t=include("springroll.easeljs.BaseState"),i=include("WGBH.GamePanel"),s=function(s){t.call(this,new i,s),this.nextScreen=this.nextScreen.bind(this)},e=extend(s,t);e.enterDone=function(){this.panel.startGame()},e.nextScreen=function(t){this.panel.showGame()},e.exitStart=function(){},namespace("WGBH").GameState=s}(),function(){var t=include("springroll.easeljs.BaseState"),i=include("WGBH.TitlePanel"),s=function(s){t.call(this,new i,s),this.onPlay=this.onPlay.bind(this)},e=extend(s,t);e.enterDone=function(){this.panel.background.addEventListener("click",this.onPlay),this.panel.background.cursor="pointer"},e.onPlay=function(){app.sound.play("click"),this.nextState()},e.exit=function(){this.panel.background.cursor=null,this.panel.background.removeEventListener("click",this.onPlay)},namespace("WGBH").TitleState=s}(),function(){var t=include("WGBH.TitleState"),i=include("WGBH.GameState"),s=include("springroll.Application"),e=include("lib.Transition"),a=new s({fps:24,name:"arthur_lungdefender",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",display:include("springroll.easeljs.EaselJSDisplay"),displayOptions:{clearView:!0},preload:[{id:"Game_atlas_",src:"assets/images/Game_atlas_.json",complete:function(t,i){ss[i.id]=new createjs.SpriteSheet(t)}}]});a.firstTime=!0,a.CLOSE_WALL_EVENT="CLOSE_WALL_EVENT",a.CREATE_INHALER_EVENT="CREATE_INHALER_EVENT",a.INSTR_DONE_EVENT="INSTR_DONE_EVENT",a.SHIP_DONE_EVENT="SHIP_DONE_EVENT",a.TRANS_DONE_EVENT="TRANS_DONE_EVENT",a.SET_GAME_EVENT="SET_GAME_EVENT",a.LEVEL_COMPLETE_EVENT="LEVEL_COMPLETE_EVENT",a.SOUND_DONE_EVENT="SOUND_DONE_EVENT",a.END_LEVEL_EVENT="END_LEVEL_EVENT",a.END_GAME_EVENT="END_GAME_EVENT",a.SET_NEXT_EVENT="SET_NEXT_EVENT",a.MISSED_PARTICLE_EVENT="MISSED_PARTICLE_EVENT",a.GOT_PARTICLE_EVENT="GOT_PARTICLE_EVENT",a.on("init",(function(){var s=this.config.assets,a=this.config.scaling;this.manifests;this.transition=new e,this.transition.framerate=24,this.states={title:new t({next:"game",preload:s.title,scaling:a.title}),game:new i({next:"title",previous:"title",scaling:"panel"})}})),window.app=a}();