pc.script.attribute("speed","number",5),pc.script.attribute("minAmplitude","number",100),pc.script.attribute("shootInterval","number",2),pc.script.attribute("chargeTime","number",1),pc.script.attribute("hp","number",5),pc.script.attribute("randomPath","boolean",!0);var HP;pc.script.create("Boss",function(a){var b=function(a){this.entity=a,this.currentIndex=-1,this.tween=null,this.p0=new pc.Vec3,this.p1=new pc.Vec3,this.p2=new pc.Vec3,this.t=0,this.res=new pc.Vec3};return b.prototype={initialize:function(){HP=this.hp,this.chargeTime=1,this.levelControllerScript=a.root.findByName("Master").script.LevelController,this.bodyWrapper=this.entity.script.BodyWrapper,this.originalPoint=this.entity.getPosition().clone(),this.body=this.bodyWrapper.body,this.body.maskBit=PhysicsBits.SNITCH,this.body.categoryBit=PhysicsBits.PLAYER,this.model=this.entity.findByName("Model"),this.material1=this.model.model.model.meshInstances[0].material.clone(),this.material2=this.model.model.model.meshInstances[1].material.clone(),this.model.model.model.meshInstances[0].material=this.material1,this.model.model.model.meshInstances[1].material=this.material2,this.hitEffectTimer=.5,this.showRed=!0,this.originalColor=this.material1.diffuse.clone(),this.shootTimer=this.shootInterval,this.chargeTimer=this.chargeTime,this.laserBeamEntity=this.entity.getParent().findByName("LaserBeam"),this.laserBeamScript=this.laserBeamEntity.script.LaserBeam,this.playerEntity=a.root.findByName("Player"),this.audioControllerScript=a.root.findByName("AudioPlayer").script.AudioController,this.spawnEvent()},onEnable:function(){this._changeDirection(),this.levelControllerScript.on("pause",this._onGamePause,this)},onDisable:function(){this.levelControllerScript.off("pause",this._onGamePause,this),this.tween.stop()},update:function(a){PAUSE||(this.currentIndex>=0&&this.path&&(this.entity.lookAt(this.playerEntity.getPosition(),new pc.Vec3(0,1,0)),this.entity.rotateLocal(0,180,0)),this._shootTimer(a),this._hitEffect(a),this._chargeEffect(a),this.shootReady&&this.can("chargeEvent")&&this.chargeEvent())},_onGamePause:function(a){this.tween&&(a?this.tween.pause():this.tween.resume())},_shootTimer:function(a){this.shootTimer<=0?this.shootReady=!0:this.shootTimer-=a},_chargeEffect:function(a){"charge"===this.current&&(this.chargeTimer-=a,this.chargeTimer<0?(this.shootEvent(),this.material2.diffuse.set(this.originalColor.r,this.originalColor.g,this.originalColor.b,this.originalColor.a)):this.material2.diffuse.set(196/255,30/255,.8,1),this.material2.update())},_hitEffect:function(a){"hit"===this.current&&(this.hitEffectTimer-=a,this.hitEffectTimer<0?(this.hitEffectTimer=.5,this.moveEvent(),this.material1.diffuse.set(this.originalColor.r,this.originalColor.g,this.originalColor.b,this.originalColor.a),this.material2.diffuse.set(this.originalColor.r,this.originalColor.g,this.originalColor.b,this.originalColor.a)):(this.showRed?this.showRed&&(this.material1.diffuse.set(1,0,0,1),this.material2.diffuse.set(1,0,0,1)):(this.material1.diffuse.set(1,1,1,1),this.material2.diffuse.set(1,1,1,1)),this.showRed=!this.showRed),this.material1.update(),this.material2.update())},_getNextPosition:function(){if(this.randomPath){for(var a=pc.Utils.getRandomInt(0,this.path.length);a===this.currentIndex;)a=pc.Utils.getRandomInt(0,this.path.length);this.currentIndex=a}else this.currentIndex++,this.currentIndex>this.path.length-1&&(this.currentIndex=0);return this.path[this.currentIndex]},_changeDirection:function(a){a&&(this.currentIndex<0&&(this.currentIndex=0),this.bodyWrapper.body.position.copy(this.path[this.currentIndex].getPosition()),this.bodyWrapper.update(1));var b=this._getNextPosition().getPosition(),c=this.entity.getPosition();this.p0.copy(c),this.p2.copy(b),this._generateControlPoint(this.p0,this.p1,this.p2);var d=new pc.Vec3;d.sub2(b,c);var e=d.length(),f=e/this.speed*1e3,g=this;this.tween=new TWEEN.Tween({t:0}).to({t:1},f).onUpdate(function(){g._quadraticBezierCurve(g.p0,g.p1,g.p2,this.t,g.res),g.bodyWrapper.body.position.copy(g.res)}).onComplete(function(){g._changeDirection()}).start()},_quadraticBezierCurve:function(a,b,c,d,e){var f=this.p0.clone(),g=this.p1.clone(),h=this.p2.clone();e.add2(f.scale((1-d)*(1-d)),g.scale(2*(1-d)*d)),e.add2(e,h.scale(d*d))},_generateControlPoint:function(a,b,c){b.x=a.x+this._generateAmplitude(this.minAmplitude,Math.abs(c.x-a.x)),b.y=a.y+this._generateAmplitude(this.minAmplitude,Math.abs(c.y-a.y)),b.z=a.z+this._generateAmplitude(this.minAmplitude,Math.abs(c.z-a.z))},_generateAmplitude:function(a,b){var c=pc.math.random(a,b);return c*=Math.random()<.5?-1:1},initializePath:function(a){this.path=a},removeBody:function(){nick.engine.removeBody(this.bodyWrapper.body)},reset:function(){this.hp=HP,this.currentIndex=-1,this.bodyWrapper.body.position.set(this.originalPoint.x,this.originalPoint.y,this.originalPoint.z)},hit:function(a,b){return this.hp-=b,this.hp<=0?(this.entity.enabled=!1,this.fire("kill"),this.destroyEvent(),!0):(this.hitEvent(),!1)},onstart:function(a,b,c){this.moveEvent()},onmove:function(a,b,c){this.tween&&this.tween.resume()},onhit:function(a,b,c){this.tween.stop()},onleavehit:function(a,b,c){this.shootReady=!1,this.shootTimer=this.shootInterval,this._changeDirection(!0)},oncharge:function(a,b,c){this.tween.pause()},onleavecharge:function(a,b,c){this.chargeTimer=this.chargeTime,this.material2.diffuse.set(this.originalColor.r,this.originalColor.g,this.originalColor.b,this.originalColor.a)},onshoot:function(a,b,c){this.audioControllerScript._playSFX("kraangShoot"),this.shootReady=!1,this.shootTimer=this.shootInterval;var d=this.entity.getPosition().clone(),e=d.sub(this.playerEntity.getPosition()).normalize();this.laserBeamScript.emit(e,this.entity.getPosition()),this.moveEvent()}},StateMachine.create({target:b.prototype,events:[{name:"spawnEvent",from:["none"],to:"start"},{name:"moveEvent",from:["start","hit","shoot","charge"],to:"move"},{name:"chargeEvent",from:["move"],to:"charge"},{name:"shootEvent",from:["charge"],to:"shoot"},{name:"hitEvent",from:["charge","move","shoot"],to:"hit"},{name:"destroyEvent",from:["hit","charge","move","shoot"],to:"destroy"}]}),b});