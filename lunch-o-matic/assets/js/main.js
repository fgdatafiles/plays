!function(){var t=include("createjs.Container"),e=include("springroll.DelayedCall"),a=function(){t.call(this),this.showTarget=this.showTarget.bind(this),this.showFood=this.showFood.bind(this),this.showChoices=this.showChoices.bind(this),this.showCorrect=this.showCorrect.bind(this),this.gotCorrect=this.gotCorrect.bind(this),this.tallyEnd=this.tallyEnd.bind(this),this.tallyCompleted=this.tallyCompleted.bind(this),this.init()},s=(t.prototype,extend(a,t));s.init=function(){for(this.TIMER_INTERVAL=170,this.ev_disp=new springroll.EventDispatcher,this.tallymc=new lib.tallyMC,this.addChild(this.tallymc),this.visible=!1,i=5;i>0;i--)this.tallymc["targ"+i].gotoAndStop(0),this.tallymc["targ"+i].visible=!1;this.tallymc.contBtn.on("click",this.tallyCompleted)},s.setup=function(){for(this.visible=!0,this.tallymc.contBtn.visible=!1,i=5;i>0;i--){this.tallymc["targ"+i].visible=!1;for(var t=4;t>0;t--)this.tallymc["r"+(i-1)+t].visible=!1,this.tallymc["f"+(i-1)+t].visible=!1}this.numCount=1,app.voPlayer.play(["b_askedfor",500],this.showTarget),app.sound.play("bgmusic",{loop:!0,volume:.2})},s.showTarget=function(){this.tallymc["targ"+this.numCount].gotoAndStop(app.curRnd[this.numCount-1][0]-1),this.tallymc["targ"+this.numCount].visible=!0,app.sound.play("sfx_rolo1"),this.numCount++,this.numCount<6?this.delayTO=new e(this.showTarget,this.TIMER_INTERVAL):(this.numCount=0,app.voPlayer.play(["b_options",300],this.showFood))},s.showFood=function(){var t;for(t=4;t>0;t--)this.tallymc["r"+this.numCount+t].gotoAndStop(app.curRnd[this.numCount][t]),this.tallymc["r"+this.numCount+t].children[0].gotoAndStop(0),this.tallymc["r"+this.numCount+t].visible=!0;app.sound.play("sfx_rolo2"),this.numCount++,this.numCount<5?this.delayTO=new e(this.showFood,this.TIMER_INTERVAL):app.voPlayer.play([500,"m_youchose"],this.showChoices)},s.showChoices=function(){for(var t=0;t<5;t++)for(var e=4;e>0;--e)this.tallymc["r"+t+e].currentFrame==app.curRnd[t][6]?this.tallymc["r"+t+e].children[0].gotoAndStop(1):this.tallymc["f"+t+e].visible=!0;app.sound.play("sfx_rolo3"),app.voPlayer.play([500,"m_heresright"],this.showCorrect)},s.showCorrect=function(){for(var t=0;t<5;t++)for(var e=4;e>0;--e)this.tallymc["r"+t+e].currentFrame==app.curRnd[t][5]-1&&(this.tallymc["r"+t+e].children[0].gotoAndStop(3),this.tallymc["f"+t+e].visible=!1);app.sound.play("sfx_rolo4"),app.voPlayer.play([500,"m_numcorrect"],this.gotCorrect)},s.gotCorrect=function(){for(var t=0;t<5;t++)for(var e=4;e>0;--e)app.curRnd[t][5]-1!=app.curRnd[t][6]&&(this.tallymc["f"+t+e].visible=!0);app.voPlayer.play(["b_cnt"+app.numCor,500],this.tallyEnd)},s.tallyEnd=function(){3==app.rndNum?app.voPlayer.play(["m_totalright",500,"b_cnt"+app.totCor],this.tallyCompleted):this.tallymc.contBtn.visible=!0},s.tallyCompleted=function(){app.sound.stop("bgmusic"),3==app.rndNum?this.ev_disp.trigger("GAME_OVER"):this.ev_disp.trigger("TALLY_DONE")},namespace("WGBH").TallyScreenMC=a}(),function(){var t=include("springroll.easeljs.BasePanel"),e=function(){t.call(this),this.setup=this.setup.bind(this)},i=t.prototype,a=extend(e,t);a.setup=function(){var t=new createjs.Shape;t.graphics.f("white").dr(0,0,600,350),this.addChild(t),this.gamemc=new lib.gameMC,this.addChild(this.gamemc),this.gamemc.framerate=24,this.gamemc.statCor.text="0 of 15",this.gamemc.statCor.font="23px nunitobold",this.tallymc=new WGBH.TallyScreenMC,this.addChild(this.tallymc),this.gameovermc=new lib.gameOverMC,this.addChild(this.gameovermc),this.gameovermc.visible=!1},a.teardown=function(){i.teardown.call(this),this.gamemc=null},namespace("WGBH").GamePanel=e}(),function(){var t=include("springroll.easeljs.BasePanel"),e=include("createjs.Bitmap"),i=function(){t.call(this)},a=t.prototype,s=extend(i,t);s.setup=function(){this.background=new e(images.TitleBackground),this.addChildAt(this.background,0)},s.teardown=function(){a.teardown.call(this),this.background=null},namespace("WGBH").TitlePanel=i}(),function(){var t=include("springroll.easeljs.BaseState"),e=include("springroll.DelayedCall"),i=include("WGBH.GamePanel"),a=function(e){t.call(this,new i,e),this.lipSyncLoop=this.lipSyncLoop.bind(this),this.getNextAudio=this.getNextAudio.bind(this),this.frameLoop=this.frameLoop.bind(this),this.frameLoop2=this.frameLoop2.bind(this),this.frameLoop3=this.frameLoop3.bind(this),this.showInfo=this.showInfo.bind(this),this.hideInfo=this.hideInfo.bind(this),this.gameOver=this.gameOver.bind(this),this.resetGame=this.resetGame.bind(this),this.setupTally=this.setupTally.bind(this),this.restateTask=this.restateTask.bind(this),this.setupInfoPage=this.setupInfoPage.bind(this),this.choose=this.choose.bind(this)},s=extend(a,t);s.enterDone=function(){this.questions=app.config.gameData.questions,this.todoBatchArr=app.config.gameData.todoBatchArr.slice(),this.todoQuest=app.config.gameData.todoQuest.slice(),this.targets=app.config.gameData.targets,this.fbNeg=app.config.gameData.fbNeg,this.fbPos=app.config.gameData.fbPos,this.hrdLong=Object.assign({},app.config.gameData.hrdLong),this.level=0,app.curRnd=[],this.audioArr=[],app.numCor=0,app.totCor=0,this.totErr=0,this.targ=null,this.answer=null,this.mLine=null,this.bLine=null,this.mIndx=0,this.bIndx=0,app.rndNum=1,this.fstPly=!0,this.loopMC=null,this.waitTime=15,this.HALF_SEC_PAUSE=15,this.infoBtn=0,this.bLips=app.config.gameData.bLips,this.mLips=app.config.gameData.mLips,this.mMouth=this.panel.gamemc.convey.head.mouth,this.bMouth=this.panel.gamemc.brain.mouth,app.sound.play("cafeamb",{loop:!0,volume:.1});for(var t=1;t<5;t++)this.panel.gamemc["btn"+t].indx=t.toString(),this.panel.gamemc["btn"+t].on("mousedown",this.choose),this.panel.gamemc["name"+t].indx=t.toString(),this.panel.gamemc["name"+t].btn.on("mousedown",this.showInfo);this.panel.gamemc.help.name="help",this.panel.gamemc.help.on("mousedown",this.showInfo),this.panel.gamemc.trayBtn.on("mousedown",this.restateTask),this.panel.gamemc.mBtn.on("mousedown",this.restateTask),this.panel.gamemc.bBtn.on("mousedown",this.restateTask),this.panel.gamemc.info.visible=!1,this.panel.gamemc.info.page.gotoAndStop(0),this.panel.gamemc.info.page.visible=!1,this.panel.gamemc.info.closeBtn.visible=!1,this.panel.gamemc.info.closeBtn.mouseEnabled=!0,this.panel.gamemc.info.closeBtn.on("mousedown",this.hideInfo),this.panel.tallymc.ev_disp.on("TALLY_DONE",this.resetGame),this.panel.tallymc.ev_disp.on("GAME_OVER",this.gameOver),this.panel.gameovermc.playBtn.on("mousedown",this.resetGame),this.startGame(!0)},s.gameOver=function(){this.panel.tallymc.visible=!1,this.panel.gameovermc.visible=!0,this.panel.gameovermc.playBtn.mouseEnabled=!1,app.voPlayer.play("m_whatagame",function(){this.hrdLong.gameOver?(this.hrdLong.gameOver=!1,this.panel.gameovermc.playBtn.mouseEnabled=!0):(this.hrdLong.gameOver=!1,app.voPlayer.play("m_wantmore",function(){this.panel.gameovermc.playBtn.mouseEnabled=!0}.bind(this)))}.bind(this))},s.startGame=function(t){this.panel.gamemc.light.gotoAndStop(0),this.panel.gamemc.statTarg.visible=!1,this.panel.gamemc.statCor.text=app.totCor+" of 15";var e=0;/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&(e=5),this.panel.gamemc.statCor.y=30+e,this.enabBtns(!1),this.audioArr=[],t?(1==app.rndNum?this.audioArr=this.fstPly?["m_alanhelp","b_needto","m_yourjob","b_herecomes"]:["m_alanhelp","b_herecomes"]:2==app.rndNum?this.audioArr=["m_fivemore","b_herecomes"]:3==app.rndNum&&(this.audioArr=["m_lastfive","b_herecomes"]),this.audioArr.length>0?this.playCharVO("m",this.audioArr):this.setupQuestion()):this.setupQuestion()},s.lipSyncLoop=function(t){null!=this.mLine?Math.floor(this.mIndx/3)<this.mLips[this.mLine].length?(this.mMouth.gotoAndStop(this.mLips[this.mLine][Math.floor(this.mIndx/3)]),this.mIndx++):this.mMouth.gotoAndStop(0):null!=this.bLine&&(Math.floor(this.bIndx/3)<this.bLips[this.bLine].length?(this.bMouth.gotoAndStop(this.bLips[this.bLine][Math.floor(this.bIndx/3)]),this.bIndx++):this.bMouth.gotoAndStop(0))},s.getNextAudio=function(){if(this.mLine=null,this.bLine=null,this.mIndx=0,this.bIndx=0,this.mMouth.gotoAndStop(0),this.bMouth.gotoAndStop(0),this.instrAudioIndx<this.instrAudioArr.length-1){this.instrAudioIndx++;var t=this.instrAudioArr[this.instrAudioIndx],i=t.split("_")[0];this.waitTime=this.HALF_SEC_PAUSE,"m"==i?(this.mLine=t,app.voPlayer.play([this.waitTime,this.mLine],this.getNextAudio)):"b"==i&&(this.bLine=t,"m_thisneeds"==this.instrAudioArr[this.instrAudioIndx-1]&&(this.waitTime=7),app.voPlayer.play([this.waitTime,this.bLine],this.getNextAudio))}else switch(app.off("update",this.lipSyncLoop),this.instrAudioArr[this.instrAudioIndx]){case"b_herecomes":this.setupQuestion();break;case"b_"+this.targets[this.targ-1]:case"b_"+this.targets[this.targ-1]+"2":this.fstPly?(this.fstPly=!1,this.playCharVO("b",["b_clickfood","m_clickname"])):this.enabBtns(!0);break;case"m_clickname":this.enabBtns(!0);break;case"b_food"+(this.panel.gamemc.info.page.currentFrame+1):this.enabInfoBtns(!0);break;case"m_wrongexplain":case"m_sorry":case"m_wasntit":case"m_notquite":this.todoQuest.length>0?this.playCharVO("b",["b_trynew"]):this.showTally();break;case"b_trynew":case"b_nexttray":this.panel.gamemc.convey.gotoAndStop(0),this.startGame();break;case"m_letslook":app.sound.stop("cafeamb");new e(this.setupTally,500)}},s.setupTally=function(){this.panel.gamemc.visible=!1,this.panel.tallymc.setup()},s.showTally=function(){app.off("update",this.frameLoop),app.off("update",this.frameLoop2),app.off("update",this.frameLoop3),this.playCharVO("m",["m_letslook"])},s.resetGame=function(){this.panel.gameovermc.visible=!1,this.panel.tallymc.visible=!1,this.panel.gamemc.visible=!0,app.sound.play("cafeamb",{loop:!0,volume:.1}),app.numCor=0,this.todoQuest=app.config.gameData.todoQuest.slice(),this.panel.gamemc.convey.gotoAndStop(0),this.panel.gamemc.statTarg.gotoAndStop(0),app.curRnd=[],app.rndNum++,app.rndNum>3&&(app.rndNum=1,app.totCor=0,this.hrdLong=Object.assign({},app.config.gameData.hrdLong)),this.startGame(!0)},s.setupQuestion=function(){this.panel.gamemc.brain.play(),this.loopMC=this.panel.gamemc.brain,this.newQuestion(),app.on("update",this.frameLoop)},s.frameLoop=function(){var t;if("open"==this.loopMC.currentLabel){if(this.loopMC==this.panel.gamemc.brain){for(t=1;t<5;t++)this.panel.gamemc["shade"+t].play(),1==t&&(this.loopMC=this.panel.gamemc["shade"+t]);this.panel.gamemc.convey.play(),this.panel.gamemc.light.play(),app.on("update",this.frameLoop2),app.sound.play("full_refresh")}else if(this.loopMC==this.panel.gamemc.shade1){for(app.off("update",this.frameLoop),t=1;t<5;t++)this.panel.gamemc["name"+t].hide.visible=!1;switch(this.audioArr=[],this.todoQuest.length){case 4:this.audioArr.push("m_thisneeds");break;case 3:case 1:this.audioArr.push("m_whatnow");break;default:this.audioArr.push("m_whatnext")}var e="";null==this.hrdLong[this.targets[this.targ-1]]||this.hrdLong[this.targets[this.targ-1]]||(e="2",this.hrdLong[this.targets[this.targ-1]]=!0),this.audioArr.push("b_"+this.targets[this.targ-1]+e),this.playCharVO("m",this.audioArr)}}else"show"==this.loopMC.currentLabel?this.loopMC==this.panel.gamemc.info&&(app.off("update",this.frameLoop),this.setupInfoPage()):"steamEnd"==this.loopMC.currentLabel&&(app.off("update",this.frameLoop),this.panel.gamemc.convey.gotoAndPlay("right"),app.on("update",this.frameLoop2),this.audioArr=[],this.audioArr.push(this.fbPos[app.totCor%this.fbPos.length]),this.todoQuest.length>0&&this.audioArr.push("b_nexttray"),this.playCharVO("m",this.audioArr))},s.setupInfoPage=function(){this.panel.gamemc.info.stop(),this.panel.gamemc.info.page.visible=!0,this.panel.gamemc.info.closeBtn.visible=!0,this.panel.gamemc.info.page.currentFrame<33&&this.playCharVO("b",["b_food"+(this.panel.gamemc.info.page.currentFrame+1)])},s.playCharVO=function(t,e){this.instrAudioArr=e,this.instrAudioIndx=0,"m"==t?(this.mLine=this.instrAudioArr[this.instrAudioIndx],app.voPlayer.play(this.mLine,this.getNextAudio)):(this.bLine=this.instrAudioArr[this.instrAudioIndx],app.voPlayer.play(this.bLine,this.getNextAudio)),app.on("update",this.lipSyncLoop)},s.frameLoop2=function(){"beltIn"==this.panel.gamemc.convey.currentLabel?(app.off("update",this.frameLoop2),this.panel.gamemc.light.gotoAndStop(0),this.panel.gamemc.statTarg.gotoAndStop(this.targ-1),this.panel.gamemc.statTarg.visible=!0):"wrongExplain"==this.panel.gamemc.convey.currentLabel?(app.off("update",this.frameLoop2),this.audioArr=[],this.totErr>1?this.audioArr.push(this.fbNeg[this.totErr%this.fbNeg.length]):this.audioArr.push("m_wrongexplain"),this.playCharVO("m",this.audioArr)):"trayOff"==this.panel.gamemc.convey.currentLabel?app.sound.play("tray_off"):"removeTray"==this.panel.gamemc.convey.currentLabel?app.sound.play("remove_tray"):"rightDone"==this.panel.gamemc.convey.currentLabel&&(app.off("update",this.frameLoop2),0==this.todoQuest.length&&this.showTally())},s.frameLoop3=function(){if("sfx"==this.panel.gamemc.chute.currentLabel)app.sound.play("shoot_food");else if("steamOn"==this.panel.gamemc.chute.currentLabel)this.panel.gamemc.steam.gotoAndPlay(1),this.loopMC=this.panel.gamemc.steam,app.on("update",this.frameLoop),this.panel.gamemc.convey.tray.choice.gotoAndStop(app.curRnd[app.curRnd.length-1][6]),this.panel.gamemc.convey.tray.choice.children[0].stop(),this.panel.gamemc.convey.tray.choice.visible=!0,this.panel.gamemc.convey.tray.choice.y-=10,app.sound.play("cluck");else if("addToTray"==this.panel.gamemc.chute.currentLabel){this.panel.gamemc.convey.tray.choice.y+=10,this.panel.gamemc.convey.tray.exist2.x+=16;for(var t=1;t<5;t++)this.panel.gamemc["name"+t].hide.visible=!0,this.panel.gamemc["shade"+t].gotoAndStop(0);this.panel.gamemc.statTarg.visible=!1,app.off("update",this.frameLoop3)}},s.newQuestion=function(){var t=this.todoQuest.splice(Math.floor(Math.random()*this.todoQuest.length),1).shift();this.batArr=this.todoBatchArr[this.level].slice(),this.batch=this.batArr.splice(Math.floor(Math.random()*this.batArr.length),1).shift(),this.targ=this.questions[this.level][this.batch][t][0],this.answer=this.questions[this.level][this.batch][t][4];var e=this.questions[this.level][this.batch][t][5],i=this.questions[this.level][this.batch][t][6],a=this.questions[this.level][this.batch][t][7],s=[1,2,3,4],n=s.splice(Math.floor(Math.random()*s.length),1).shift();this.panel.gamemc["choice"+n].gotoAndStop(this.answer-1),this.panel.gamemc["name"+n].gotoAndStop(this.answer-1),n=s.splice(Math.floor(Math.random()*s.length),1).shift(),this.panel.gamemc["choice"+n].gotoAndStop(e-1),this.panel.gamemc["name"+n].gotoAndStop(e-1),n=s.splice(Math.floor(Math.random()*s.length),1).shift(),this.panel.gamemc["choice"+n].gotoAndStop(i-1),this.panel.gamemc["name"+n].gotoAndStop(i-1),this.panel.gamemc["choice"+s[0]].gotoAndStop(a-1),this.panel.gamemc["name"+s[0]].gotoAndStop(a-1),this.choicesArr=[];for(var o=1;o<5;o++){var h=this.panel.gamemc["choice"+o].currentFrame;this.choicesArr.push(h),this.panel.gamemc["choice"+o].visible=!0,this.panel.gamemc["choice"+o].children[0].gotoAndStop(0)}s=[1,2,3],this.panel.gamemc.convey.tray.exist2.x=98.8,this.panel.gamemc.convey.tray.choice.y=-4.3,this.panel.gamemc.convey.tray.exist1.gotoAndStop(this.questions[this.level][this.batch][t][s.splice(Math.floor(Math.random()*s.length),1).shift()]-1),this.panel.gamemc.convey.tray.exist2.gotoAndStop(this.questions[this.level][this.batch][t][s.splice(Math.floor(Math.random()*s.length),1).shift()]-1),this.panel.gamemc.convey.tray.exist3.gotoAndStop(this.questions[this.level][this.batch][t][s[0]]-1),this.panel.gamemc.convey.tray.exist1.children[0].gotoAndStop(0),this.panel.gamemc.convey.tray.exist2.children[0].gotoAndStop(0),this.panel.gamemc.convey.tray.exist3.children[0].gotoAndStop(0),this.panel.gamemc.convey.tray.choice.visible=!1},s.enabBtns=function(t){for(var e=1;e<5;e++)this.panel.gamemc["btn"+e].mouseEnabled=t,this.panel.gamemc["name"+e].btn.mouseEnabled=t,this.panel.gamemc.mBtn.mouseEnabled=t,this.panel.gamemc.bBtn.mouseEnabled=t,this.panel.gamemc.trayBtn.mouseEnabled=t;this.panel.gamemc.bBtn.mouseEnabled=t,this.panel.gamemc.mBtn.mouseEnabled=t,this.panel.gamemc.trayBtn.mouseEnabled=t,this.panel.gamemc.help.mouseEnabled=t},s.enabInfoBtns=function(t){for(var e=1;e<5;e++)t&&e==this.infoBtn||(this.panel.gamemc["name"+e].btn.mouseEnabled=t)},s.choose=function(t){var e=this.panel.gamemc["choice"+t.target.indx],i=this.choicesArr[t.target.indx-1];if(e.visible=!1,app.curRnd.push([this.targ,this.panel.gamemc.choice1.currentFrame,this.panel.gamemc.choice2.currentFrame,this.panel.gamemc.choice3.currentFrame,this.panel.gamemc.choice4.currentFrame,this.answer,i]),i==this.answer-1)app.numCor++,this.panel.gamemc.statCor.text=++app.totCor+" of 15",this.panel.gamemc.chute.play(),app.on("update",this.frameLoop3);else{for(var a=1;a<5;a++)this.panel.gamemc["shade"+a].gotoAndPlay("close"),this.panel.gamemc["name"+a].hide.visible=!0;this.totErr++,this.panel.gamemc.statTarg.visible=!1,this.panel.gamemc.convey.gotoAndPlay("wrong"),app.sound.play("sfx_wrong"),app.on("update",this.frameLoop2)}this.enabBtns(!1)},s.showInfo=function(t){this.infoBtn=t.target.parent.indx,"help"==t.target.name?this.panel.gamemc.info.page.gotoAndStop(33):this.panel.gamemc.info.page.gotoAndStop(t.target.parent.currentFrame),this.panel.gamemc.info.visible=!0,9==this.panel.gamemc.info.currentFrame?(app.sound.play("btn_click"),this.enabInfoBtns(!1),this.setupInfoPage()):(app.sound.play("transition"),this.panel.gamemc.info.play(),this.loopMC=this.panel.gamemc.info,app.on("update",this.frameLoop),this.enabBtns(!1))},s.hideInfo=function(t){app.sound.play("btn_click"),this.enabBtns(!0),this.panel.gamemc.info.gotoAndStop(0),this.panel.gamemc.info.visible=!1,this.panel.gamemc.info.closeBtn.visible=!1,this.panel.gamemc.info.page.visible=!1},s.restateTask=function(t){this.enabBtns(!1),this.playCharVO("m",["m_thisneeds","b_"+this.targets[this.targ-1]])},s.exitStart=function(){},namespace("WGBH").GameState=a}(),function(){var t=include("springroll.easeljs.BaseState"),e=include("WGBH.TitlePanel"),i=function(i){t.call(this,new e,i),this.onPlay=this.onPlay.bind(this)},a=extend(i,t);a.enterDone=function(){this.panel.background.addEventListener("click",this.onPlay)},a.onPlay=function(){app.sound.play("btn_click"),this.nextState()},a.exit=function(){this.panel.background.removeEventListener("click",this.onPlay)},namespace("WGBH").TitleState=i}(),function(){var t=include("WGBH.TitleState"),e=include("WGBH.GameState"),i=include("springroll.Application"),a=include("lib.Transition"),s=new i({fps:30,name:"lunchomatic",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",display:include("springroll.easeljs.EaselJSDisplay"),displayOptions:{clearView:!0},preload:[{id:"Game_atlas_",src:"assets/images/Game_atlas_.json",complete:function(t,e){ss[e.id]=new createjs.SpriteSheet(t)}}]});s.on("init",(function(){var i=this.config.assets,s=this.config.scaling;this.manifests;this.transition=new a,this.transition.framerate=24,this.states={title:new t({next:"game",preload:i.title,scaling:s.title}),game:new e({next:"title",previous:"title",preload:i.game,scaling:"panel"})}})),window.app=s}();