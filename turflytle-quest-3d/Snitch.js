pc.script.attribute("speed","number",5),pc.script.attribute("minAmplitude","number",100),pc.script.create("Snitch",function(a){var b=function(a){this.entity=a,this.currentIndex=-1,this.tween=null,this.p0=new pc.Vec3,this.p1=new pc.Vec3,this.p2=new pc.Vec3,this.t=0,this.res=new pc.Vec3};return b.prototype={initialize:function(){this.bodyWrapper=this.entity.script.BodyWrapper,this.bodyWrapper.offset.set(0,1.61,0),this.originalPoint=this.entity.getPosition().clone(),this.levelControllerScript=a.root.findByName("Master").script.LevelController,this.audioControllerScript=a.root.findByName("AudioPlayer").script.AudioController,this.playerEntity=a.root.findByName("Player"),this.playerPos=new pc.Vec3,this.body=this.bodyWrapper.body,this.body.maskBit=PhysicsBits.SNITCH,this.body.categoryBit=PhysicsBits.PLAYER},onEnable:function(){this.bodyWrapper&&this.bodyWrapper.on("onCollisionEnter",this._onCollisionEnter,this),this._changeDirection(),this.levelControllerScript.on("pause",this._onGamePause,this)},onDisable:function(){this.bodyWrapper&&this.bodyWrapper.off("onCollisionEnter",this._onCollisionEnter,this),this.levelControllerScript.off("pause",this._onGamePause,this),this.audioControllerScript.adjustVolume("SFX","close",0)},update:function(a){if(!PAUSE){this.currentIndex>=0&&this.path&&(this.entity.lookAt(this.playerEntity.getPosition(),new pc.Vec3(0,1,0)),this.entity.rotateLocal(0,180,0)),this.playerPos.copy(this.playerEntity.getPosition());var b=this.playerPos.sub(this.entity.getPosition()).length(),c=Math.max(0,200-b)/200;this.audioControllerScript.adjustVolume("SFX","close",c)}},_onCollisionEnter:function(a){"Player"===a.name&&(this.fire("Caught"),this.entity.enabled=!1)},_onGamePause:function(a){a?this.tween.pause():this.tween.resume()},_getNextPosition:function(){return this.currentIndex++,this.currentIndex>this.path.length-1&&(this.currentIndex=0),this.path[this.currentIndex]},_changeDirection:function(){var a=this._getNextPosition().getPosition(),b=this.entity.getPosition();this.p0.copy(b),this.p2.copy(a),this._generateControlPoint(this.p0,this.p1,this.p2);var c=new pc.Vec3;c.sub2(a,b);var d=c.length(),e=d/this.speed*1e3,f=this;this.tween=new TWEEN.Tween({t:0}).to({t:1},e).onUpdate(function(){f._quadraticBezierCurve(f.p0,f.p1,f.p2,this.t,f.res),f.bodyWrapper.body.position.copy(f.res)}).onComplete(function(){f._changeDirection()}).start()},_quadraticBezierCurve:function(a,b,c,d,e){var f=this.p0.clone(),g=this.p1.clone(),h=this.p2.clone();e.add2(f.scale((1-d)*(1-d)),g.scale(2*(1-d)*d)),e.add2(e,h.scale(d*d))},_generateControlPoint:function(a,b,c){b.x=a.x+this._generateAmplitude(this.minAmplitude,Math.abs(c.x-a.x)),b.y=a.y+this._generateAmplitude(this.minAmplitude,Math.abs(c.y-a.y)),b.z=a.z+this._generateAmplitude(this.minAmplitude,Math.abs(c.z-a.z))},_generateAmplitude:function(a,b){var c=pc.math.random(a,b);return c*=Math.random()<.5?-1:1},initializePath:function(a){this.path=a},removeBody:function(){nick.engine.removeBody(this.bodyWrapper.body)},reset:function(){this.currentIndex=-1,this.bodyWrapper.body.position.set(this.originalPoint.x,this.originalPoint.y,this.originalPoint.z)}},b});