window.__require=function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return o(t[a][1][e]||e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<r.length;a++)o(r[a]);return o}({Activator:[function(e,t,n){"use strict";cc._RF.push(t,"3f04fOXTs5DKIAQeQvy2MFO","Activator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(n,"__esModule",{value:!0});var c,l,u=cc._decorator,d=u.ccclass,p=u.menu,f=u.property,h=u.executeInEditMode,y=function(e){return!cc.isValid(e,!0)};function v(){return this===this.firstActivator}function _(){return this._activatorStrategy===c.Component&&this===this.firstActivator}function g(){return this._activatorStrategy===c.Node&&this===this.firstActivator}function m(){return this.allActivators.length>1&&this===this.firstActivator}(function(e){e[e.ChildNodes=0]="ChildNodes",e[e.Component=1]="Component",e[e.Node=2]="Node"})(c||(c={})),function(e){e[e.Every=0]="Every",e[e.Any=1]="Any"}(l||(l={}));var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activatorStrategy=c.ChildNodes,t._multiStrategy=l.Every,t._targetComponentName="",t._targetNode=null,t._interval=.25,t._targetComponent=void 0,t._intervalBuffer=0,t._isDeterminingActive=!1,t._shouldBeActive=!1,t._allActivators=[],t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"targetComponent",{get:function(){return this._targetComponent&&this._targetComponentName!==this._targetComponent.constructor.name&&(this._targetComponent=void 0),void 0===this._targetComponent&&(this._targetComponent=this.getComponent(this._targetComponentName)),this._targetComponent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shouldBeActive",{get:function(){return this._shouldBeActive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allActivators",{get:function(){return(0===this._allActivators.length||this._allActivators.some(y))&&(this._allActivators=this.getComponents(n)),this._allActivators},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstActivator",{get:function(){return this.allActivators[0]},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){this._intervalBuffer=this.firstActivator._interval},t.prototype.update=function(e){this._isDeterminingActive||(this._intervalBuffer-=e,this._intervalBuffer>0||(this._intervalBuffer=this.firstActivator._interval,this.determineAndApplyActive()))},t.prototype.determineAndApplyActive=function(){return i(this,void 0,Promise,function(){var e,t,n,r,o,i,l,u,d,p;return a(this,function(a){switch(a.label){case 0:return this._isDeterminingActive=!0,n=this,"function"!=typeof this.determineActive?[3,2]:[4,this.determineActive()];case 1:return r=a.sent(),[3,3];case 2:r=!1,a.label=3;case 3:if(n._shouldBeActive=r,this._isDeterminingActive=!1,o=this.firstActivator,i=o.firstActivator,l=o._activatorStrategy,i!==this)return[2];if(u=this.determineIfActiveAccordingToMultiStrategy(),l===c.Component&&i.targetComponent)i.targetComponent.enabled=u;else if(l===c.Node&&i._targetNode)i._targetNode.active=u;else if(l===c.ChildNodes)try{for(d=s(i.node.children),p=d.next();!p.done;p=d.next())p.value.active=u}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}return[2]}})})},t.prototype.determineIfActiveAccordingToMultiStrategy=function(){var e,t,n=this.allActivators,r=0,o=0;try{for(var i=s(n),a=i.next();!a.done;a=i.next()){var c=a.value;c.enabled&&(o++,c._shouldBeActive&&r++)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return this._multiStrategy===l.Every?r===o:r>0},o([f({visible:v,type:cc.Enum(c)})],t.prototype,"_activatorStrategy",void 0),o([f({type:cc.Enum(l),visible:m})],t.prototype,"_multiStrategy",void 0),o([f({visible:_})],t.prototype,"_targetComponentName",void 0),o([f({type:cc.Node,visible:g})],t.prototype,"_targetNode",void 0),o([f({min:0,tooltip:"Interval by which the activator condition will be checked.",visible:v})],t.prototype,"_interval",void 0),t=n=o([d,h,p("Scribbles And Ink/Generic/Activator")],t)}(cc.Component);n.default=b,cc._RF.pop()},{}],AnalyticValueActivator:[function(e,t,n){"use strict";cc._RF.push(t,"fec46uvlhBPwIDlQc9i86/p","AnalyticValueActivator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l,u=c(e("../../Framework/GameManager")),d=c(e("../../Generic/Activator")),p=e("../../constants"),f=cc._decorator,h=f.ccclass,y=f.property,v=Object.keys(p.ANALYTICS).reduce(function(e,t,n){return e[t]=n,e},{}),_=Object.values(p.ANALYTICS);(function(e){e[e.Current=0]="Current",e[e.Total=1]="Total"})(l||(l={}));var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._analyticOption=Object.values(v)[0],t._label="",t._comparer=p.Comparer.AtMost,t._value=0,t._count=l.Current,t}return r(t,e),Object.defineProperty(t.prototype,"analytic",{get:function(){return o({},_[this._analyticOption],{label:this._label})},enumerable:!0,configurable:!0}),t.prototype.determineActive=function(){return a(this,void 0,Promise,function(){var e,t,n,r;return s(this,function(o){switch(o.label){case 0:return[4,u.default.analytics.retreive(this.analytic)];case 1:return e=o.sent(),t=e.current,n=e.total,r=this._count===l.Current?t:n,[2,this._comparer===p.Comparer.AtMost?r<=this._value:r>=this._value]}})})},i([y({type:cc.Enum(v),visible:!0,displayName:"Analytic"})],t.prototype,"_analyticOption",void 0),i([y({visible:!0,displayName:"Analytic Label",tooltip:"Leave blank to count analytics with any label."})],t.prototype,"_label",void 0),i([y({type:cc.Enum(p.Comparer),visible:!0})],t.prototype,"_comparer",void 0),i([y({visible:!0})],t.prototype,"_value",void 0),i([y({type:cc.Enum(l),visible:!0})],t.prototype,"_count",void 0),t=i([h],t)}(d.default);n.default=g,cc._RF.pop()},{"../../Framework/GameManager":"GameManager","../../Generic/Activator":"Activator","../../constants":"constants"}],Analytics:[function(e,t,n){"use strict";cc._RF.push(t,"bbaf4V/7ohD97favzRwNKOI","Analytics");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=l(e("./GameComponent")),d=l(e("./GameManager")),p=cc._decorator,f=p.ccclass,h=p.menu,y=p.disallowMultiple,v=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=window.Application;if(r&&"event"===e){var o=c(t,2),i=o[0],a=o[1],s=r.getPlugin("GoogleAnalytics");s&&s.event(a.event_category,i,a.event_label,a.value)}},_=function(e){return{event_category:e.category,event_label:e.label,value:m(e.value,1)}},g=function(e){return(e.action+"-"+e.category).toLowerCase()},m=function(e,t){return void 0===t&&(t=0),"number"==typeof e&&!Number.isNaN(e)&&isFinite(e)?e:t},b=function(e){return"object"==typeof e&&null!==e?e:{}},w=function(e,t){var n=0,r=b(e);if(""===t)for(var o in r)n+=m(r[o]);else n+=m(r[t]);return n},S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lastAnalyticTimestamp=Date.now(),t._lastUITimestamp=Date.now(),t}return r(t,e),t.prototype.onRegisterStores=function(){return["analytics"]},t.prototype.send=function(e){if(this.updateAnalyticTimestamp(),e.gtag){var t=e.action,n=s(e,["action"]);v("event",t,_(n))}return this.setValues(e)},t.prototype.retreive=function(e){return this.getValues(e)},Object.defineProperty(t.prototype,"lastAnalyticTimestamp",{get:function(){return this._lastAnalyticTimestamp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastUITimestamp",{get:function(){return this._lastUITimestamp},enumerable:!0,configurable:!0}),t.prototype.updateUITimestamp=function(){return this._lastUITimestamp=Date.now(),this._lastUITimestamp},t.prototype.updateAnalyticTimestamp=function(){this._lastAnalyticTimestamp=Date.now(),this.updateUITimestamp()},t.prototype.getValues=function(e){return i(this,void 0,Promise,function(){var t,n,r,o;return a(this,function(i){switch(i.label){case 0:return t=d.default.storage,n=g(e),[4,t.get("analytics",n)];case 1:return r=i.sent(),o=t.getMem("analytics",n),[2,{current:w(o,e.label),total:w(r,e.label)}]}})})},t.prototype.setValues=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i,s,c,l,u;return a(this,function(a){switch(a.label){case 0:return t=d.default.storage,n=e.label,r=void 0===n?"":n,o=e.value,i=m(o,1),s=g(e),l=b,[4,t.get("analytics",s)];case 1:return(c=l.apply(void 0,[a.sent()]))[r]=m(c[r])+i,[4,t.set("analytics",s,c)];case 2:return a.sent(),(u=b(t.getMem("analytics",s)))[r]=m(u[r])+i,t.setMem("analytics",s,u),[2,{current:w(u,r),total:w(c,r)}]}})})},t=o([f,y,h("Scribbles And Ink/Framework/Analytics")],t)}(u.default);n.default=S,cc._RF.pop()},{"./GameComponent":"GameComponent","./GameManager":"GameManager"}],ApplyAnimationsToEmittedInstances:[function(e,t,n){"use strict";cc._RF.push(t,"7c213ir15REAZMJxWHDzr8p","ApplyAnimationsToEmittedInstances");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./PrefabEmitter")),c=cc._decorator,l=c.ccclass,u=c.property,d=c.menu,p=c.requireComponent,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.animations=[],t}return r(t,e),t.prototype.start=function(){this.node.on(s.default.EventType.Emit,this.applyAnimationToEmittedInstances,this)},t.prototype.onDestroy=function(){this.node.off(s.default.EventType.Emit,this.applyAnimationToEmittedInstances,this)},t.prototype.applyAnimationToEmittedInstances=function(e){var t,n;if(this.enabled&&this.enabledInHierarchy){var r=e.getComponent(cc.Animation)||e.getComponentInChildren(cc.Animation)||e.addComponent(cc.Animation);try{for(var o=i(this.animations),a=o.next();!a.done;a=o.next()){var s=a.value;r.getClips().includes(s)||r.addClip(s),r.playAdditive(s.name)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}},o([u({type:cc.AnimationClip})],t.prototype,"animations",void 0),t=o([l,p(s.default),d("Scribbles And Ink/Generic/Apply Animations To Emitted Instances")],t)}(cc.Component);n.default=f,cc._RF.pop()},{"./PrefabEmitter":"PrefabEmitter"}],ApplySkeletonRootMotion:[function(e,t,n){"use strict";cc._RF.push(t,"de5939YAQRF/oAoHNVmWHRi","ApplySkeletonRootMotion");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../Util"),a=cc._decorator,s=a.ccclass,c=a.disallowMultiple,l=a.requireComponent,u=a.menu,d=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._skeleton=null,t._rootResetThreshold=250,t._rootPositionLast=cc.Vec2.ZERO,t}return r(t,e),Object.defineProperty(t.prototype,"skeleton",{get:function(){if(this._skeleton||(this._skeleton=this.getComponent(sp.Skeleton)),!this._skeleton)throw new Error(i.nameOfComponent(this)+" requires a sp.Skeleton component");return this._skeleton},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.node.parent.getComponent(cc.Canvas)&&cc.warn("ApplySkeletonRootMotion affets it's parent node, are you sure it was placed correctly?")},t.prototype.lateUpdate=function(){var e=this.skeleton,t=cc.v2(e._rootBone),n=this.node,r=n.scaleX,o=n.scaleY;this.node.x=-t.x*r,this.node.y=-t.y*o;var i=t.sub(this._rootPositionLast).mag()>this._rootResetThreshold?t:t.sub(this._rootPositionLast),a=this.node.parent;a.x+=i.x*r*a.scaleX,a.y+=i.y*o*a.scaleY,this._rootPositionLast=t},o([d({tooltip:"If a skeleton moves beyond this threshold (such as when a walk loop resets) root motion will not be applied so that motion stays continuous.",visible:!0,min:50,step:50})],t.prototype,"_rootResetThreshold",void 0),t=o([s,c,l(sp.Skeleton),u("Scribbles And Ink/Generic/Apply Skeleton Root Motion")],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../Util":"index"}],AreaSpawner:[function(e,t,n){"use strict";cc._RF.push(t,"d8148hI2i9HlpdJIdQ5T0IN","AreaSpawner");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e};Object.defineProperty(n,"__esModule",{value:!0});var c=cc._decorator,l=c.ccclass,u=c.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._spawnTarget=null,t._spawnTargetOriginalChildren=[],t}return r(t,e),t.prototype.prepareAreas=function(){var e,t;try{for(var n=i(this.node.children),r=n.next();!r.done;r=n.next()){r.value.active=!1}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._spawnTarget&&(this._spawnTargetOriginalChildren=s(this._spawnTarget.children))},t.prototype.spawnArea=function(e){var t,n;if(this.node.parent&&this._spawnTarget){var r=this.node.getChildByName(e);if(r){this.clearArea();try{for(var o=i(s(r.children)),a=o.next();!a.done;a=o.next()){a.value.setParent(this._spawnTarget)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}}},t.prototype.clearArea=function(){var e,t;if(this._spawnTarget)try{for(var n=i(s(this._spawnTarget.children)),r=n.next();!r.done;r=n.next()){var o=r.value;this._spawnTargetOriginalChildren.includes(o)||o.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},o([u({type:cc.Node,visible:!0})],t.prototype,"_spawnTarget",void 0),t=o([l],t)}(cc.Component);n.default=d,cc._RF.pop()},{}],AssetLoader:[function(e,t,n){"use strict";cc._RF.push(t,"86eceB5lUdJh7XY2GBwbf/q","AssetLoader");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=l(e("./GameComponent")),d=l(e("./GameManager")),p=cc._decorator,f=p.menu,h=p.ccclass,y=p.property,v=p.disallowMultiple,_="low/",g="standard/",m=/\/\*$/,b=function(){return null};function w(e,t){return new Promise(function(n,r){var o=t?"loadResDir":"loadRes";cc.loader[o](e,function(o,i){o&&r(new Error("Error loading asset @"+e+": "+o.message)),t&&i instanceof Array&&0===i.length&&r(new Error("No assets could be found @"+e)),n(i)})})}function S(e,t){return a(this,void 0,Promise,function(){var n,r,o,i,a,l,u,d,p;return s(this,function(s){switch(s.label){case 0:return(o=m.test(e))&&(e=e.replace(m,"")),i=null,t?[4,w(_+e,o).catch(b)]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return i?[3,4]:[4,w(g+e,o)];case 3:a=s.sent(),i=i||a,s.label=4;case 4:if(l={},o)try{for(u=c(i),d=u.next();!d.done;d=u.next())p=d.value,l[e+"/"+p.name]=p}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}else l[e]=i;return[2,l]}})})}var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._staticAssetPaths=[],t._staticAssets={},t._dynamicAssets={},t._audioToDipose={},t}return r(t,e),Object.defineProperty(t.prototype,"staticAssets",{get:function(){return o({},this._staticAssets)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"staticAssetPaths",{get:function(){return Object.keys(this._staticAssets)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"staticAssetNames",{get:function(){return Object.values(this._staticAssets).map(function(e){return e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dynamicAsset",{get:function(){return o({},this._dynamicAssets)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dynamicAssetPaths",{get:function(){return Object.keys(this._dynamicAssets)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dynamicAssetNames",{get:function(){return Object.values(this._dynamicAssets).map(function(e){return e.name})},enumerable:!0,configurable:!0}),t.prototype.onGameLoad=function(e){return a(this,void 0,Promise,function(){var t,n,r,o,i,a,l;return s(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),r=c(this._staticAssetPaths),o=r.next(),s.label=1;case 1:return o.done?[3,4]:[4,S(o.value,e)];case 2:for(a in i=s.sent())this._staticAssets[a]=i[a];s.label=3;case 3:return o=r.next(),[3,1];case 4:return[3,7];case 5:return l=s.sent(),t={error:l},[3,7];case 6:try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}return[7];case 7:return this.schedule(this.disposeAudioIfNotPlaying,1,cc.macro.REPEAT_FOREVER),[2]}})})},t.prototype.hasStaticAssets=function(e){return this.hasAssets(e,!1)},t.prototype.getStaticAssets=function(e){var t=this.getAssets(e,!1);if(0===Object.keys(t).length)throw new Error("No Asset with path "+e+" was loaded, ensure it is registered in the AssetLoader's static asset paths.");return t},t.prototype.hasDynamicAssets=function(e){return this.hasAssets(e,!0)},t.prototype.getDynamicAssets=function(e){return this.getAssets(e,!0)},t.prototype.loadDynamicAssets=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(r){switch(r.label){case 0:return[4,S(e,d.default.isLowEndDevice)];case 1:for(n in t=r.sent())this._dynamicAssets[n]=t[n],n in this._audioToDipose&&delete this._audioToDipose[n];return[2,t]}})})},t.prototype.disposeDynamicAssets=function(e){var t=this.getAssets(e,!0);for(var n in t){var r=t[n];r instanceof cc.AudioClip?(delete this._dynamicAssets[n],this._audioToDipose[n]=r):this.disposeDynamicAsset(n)}},t.prototype.hasSingleAsset=function(e){return this.hasStaticAssets(e)||this.hasDynamicAssets(e)},t.prototype.getSingleAsset=function(e){return this.hasDynamicAssets(e)?this.getDynamicAssets(e)[e]:this.hasStaticAssets(e)?this.getStaticAssets(e)[e]:null},t.prototype.filterAssets=function(e){var t=o({},this._dynamicAssets,this._staticAssets),n=[];for(var r in t){var i=t[r];e(i)&&n.push(i)}return n},t.prototype.findAsset=function(e){var t=o({},this._dynamicAssets,this._staticAssets);for(var n in t){var r=t[n];if(e(r))return r}return null},t.prototype.getAssets=function(e,t){var n=t?this._dynamicAssets:this._staticAssets,r={},o=m.test(e);if(o&&(e=e.replace("*","")),o)for(var i in n)i.includes(e)&&(r[i]=n[i]);else e in n&&(r[e]=n[e]);return r},t.prototype.hasAssets=function(e,t){return m.test(e)?(e=e.replace("*",""),(t?this.dynamicAssetPaths:this.staticAssetPaths).some(function(t){return t.includes(e)})):!!(t?this._dynamicAssets:this._staticAssets)[e]},t.prototype.disposeDynamicAsset=function(e,t){void 0===t&&(t=this._dynamicAssets);var n=t[e];delete t[e];var r=this.getUnsharedDependsOfReleasedAsset(n);cc.loader.releaseAsset(n),cc.loader.release(r)},t.prototype.getUnsharedDependsOfReleasedAsset=function(e){var t=cc.loader.getDependsRecursively(e),n=o({},this._audioToDipose,this._dynamicAssets,this._staticAssets);for(var r in n)for(var i=n[r],a=cc.loader.getDependsRecursively(i),s=t.length-1;s>=0;s--){var c=t[s];a.includes(c)&&t.splice(s,1)}return t},t.prototype.disposeAudioIfNotPlaying=function(){for(var e in this._audioToDipose){var t=this._audioToDipose[e];d.default.audio.playing.includes(t.name)||(cc.audioEngine.uncache(t),this.disposeDynamicAsset(e,this._audioToDipose))}},i([y({type:cc.String,tooltip:"Assets at these paths will be loaded during the Game's initialization phase.\n\nThis should NOT be used for content, but for assets that are tightly coupled to game components.\n\nPaths should be relative to either the resources/standard or resources/low folders. If we've detected a low end devices, paths will first be loaded from the /low folder, then the /standard folder. If paths are missing from the /standard folder, weatherthey exist in the /low folder or not, there will be an error.If you don't know what you're doing, don't change this.",visible:!0})],t.prototype,"_staticAssetPaths",void 0),t=i([h,v,f("Scribbles And Ink/Framework/Asset Loader")],t)}(u.default);n.default=O,cc._RF.pop()},{"./GameComponent":"GameComponent","./GameManager":"GameManager"}],Audio:[function(e,t,n){"use strict";cc._RF.push(t,"3f390N5dcpDvZ3y3CxtVwQw","Audio");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c,l=s(e("./GameManager")),u=cc._decorator,d=u.ccclass,p=u.property;(function(e){e[e.Voice=0]="Voice",e[e.Music=1]="Music",e[e.FX=2]="FX"})(c||(c={}));var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._maxWebAudioSize=256,t._volume=1,t._voVolume=1,t._sfxVolume=1,t._musicVolume=1,t._playing=new Map,t.onSpringRollSetVolume=function(e){t.volume=e},t.onSpringRollSetMusicVolume=function(e){t.musicVolume=e},t.onSpringRollSetSfxVolume=function(e){t.sfxVolume=e},t.onSpringRollSetVoiceVolume=function(e){t.voVolume=e},t}return r(t,e),t.prototype.onLoad=function(){cc.audioEngine.setMaxWebAudioSize(this._maxWebAudioSize),this.handleSpringRollAudio()},t.prototype.onDestroy=function(){this.unhandleSpringRollAudio()},Object.defineProperty(t.prototype,"volume",{get:function(){return cc.misc.clamp01(this._volume)},set:function(e){this._volume=e,this.updateClipVolume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"voVolume",{get:function(){return cc.misc.clamp01(this._voVolume)},set:function(e){this._voVolume=e,this.updateClipVolume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sfxVolume",{get:function(){return cc.misc.clamp01(this._sfxVolume)},set:function(e){this._sfxVolume=e,this.updateClipVolume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"musicVolume",{get:function(){return cc.misc.clamp01(this._musicVolume)},set:function(e){this._musicVolume=e,this.updateClipVolume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playing",{get:function(){var e,t,n=[];try{for(var r=i(this._playing.values()),o=r.next();!o.done;o=r.next()){var a=o.value;n.push(a.name)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),t.prototype.isPlaying=function(e){var t,n;try{for(var r=i(this._playing.values()),o=r.next();!o.done;o=r.next()){if(o.value.name===e)return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},t.prototype.isPaused=function(e){var t,n;try{for(var r=i(this._playing.values()),o=r.next();!o.done;o=r.next()){var a=o.value;if(a.name===e)return a.paused}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},t.prototype.play=function(e){var t=this,n=e.name,r=e.loop,o=void 0!==r&&r,i=e.volume,a=void 0===i?1:i,s=e.maxConcurrent,u=void 0===s?1/0:s;if(n&&!l.default.isPaused&&!(this.playing.filter(function(e){return e===n}).length>=u)){var d=l.default.assets.findAsset(function(e){return e instanceof cc.AudioClip&&e.name===n});if(!d)return cc.warn("audio clip "+n+" could not be found");var p={name:n,volume:cc.misc.clamp01(a),type:this.getClipType(n),paused:!1},f=cc.audioEngine.play(d,o,this.getCompiledVolume(p));if(this._playing.set(f,p),p.type===c.Voice){var h=cc.audioEngine.getDuration(f);l.default.captions.showCaption(n,h)}return new Promise(function(e){return cc.audioEngine.setFinishCallback(f,function(){t._playing.delete(f),e()})})}},t.prototype.stop=function(e){var t,n,r=e.name;try{for(var o=i(this._playing),s=o.next();!s.done;s=o.next()){var c=a(s.value,2),l=c[0];r===c[1].name&&(cc.audioEngine.stop(l),this._playing.delete(l))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.pause=function(e){var t,n,r=e.name;try{for(var o=i(this._playing),s=o.next();!s.done;s=o.next()){var c=a(s.value,2),l=c[0],u=c[1];r===u.name&&(u.paused=!0,cc.audioEngine.pause(l))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.resume=function(e){var t,n,r=e.name;try{for(var o=i(this._playing),s=o.next();!s.done;s=o.next()){var c=a(s.value,2),l=c[0],u=c[1];r===u.name&&(u.paused=!1,cc.audioEngine.resume(l))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.stopAll=function(){var e,t;try{for(var n=i(this._playing.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;cc.audioEngine.stop(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._playing.clear()},t.prototype.getClipType=function(e){return e.includes("SFX")||e.includes("Background")?c.FX:e.includes("MUSIC")?c.Music:c.Voice},t.prototype.handleSpringRollAudio=function(){cc.springRoll&&(cc.springRoll.soundVolume.subscribe(this.onSpringRollSetVolume),cc.springRoll.musicVolume.subscribe(this.onSpringRollSetMusicVolume),cc.springRoll.sfxVolume.subscribe(this.onSpringRollSetSfxVolume),cc.springRoll.voVolume.subscribe(this.onSpringRollSetVoiceVolume),this.onSpringRollSetVolume(cc.springRoll.soundVolume.value),this.onSpringRollSetMusicVolume(cc.springRoll.musicVolume.value),this.onSpringRollSetSfxVolume(cc.springRoll.voVolume.value),this.onSpringRollSetVoiceVolume(cc.springRoll.sfxVolume.value))},t.prototype.unhandleSpringRollAudio=function(){cc.springRoll&&(cc.springRoll.soundVolume.unsubscribe(this.onSpringRollSetVolume),cc.springRoll.musicVolume.unsubscribe(this.onSpringRollSetMusicVolume),cc.springRoll.sfxVolume.unsubscribe(this.onSpringRollSetSfxVolume),cc.springRoll.voVolume.unsubscribe(this.onSpringRollSetVoiceVolume))},t.prototype.updateClipVolume=function(){var e,t;try{for(var n=i(this._playing),r=n.next();!r.done;r=n.next()){var o=a(r.value,2),s=o[0],c=o[1];cc.audioEngine.setVolume(s,this.getCompiledVolume(c))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.getCompiledVolume=function(e){var t=e.type===c.FX?this.sfxVolume:e.type===c.Music?this.musicVolume:this.voVolume,n=e.volume;return this._volume*t*n},t.ClipType=c,o([p({tooltip:"Any audio clip over this size will be resolved into a DOM node??\n\n(This setting will used as an argument when calling cc.audioEngine.setMaxWebAudioSize())",visible:!0})],t.prototype,"_maxWebAudioSize",void 0),o([p({visible:!0,min:0,max:1,slide:!0})],t.prototype,"_volume",void 0),o([p({visible:!0,min:0,max:1,slide:!0})],t.prototype,"_voVolume",void 0),o([p({visible:!0,min:0,max:1,slide:!0})],t.prototype,"_sfxVolume",void 0),o([p({visible:!0,min:0,max:1,slide:!0})],t.prototype,"_musicVolume",void 0),t=o([d],t)}(cc.Component);n.default=f,cc._RF.pop()},{"./GameManager":"GameManager"}],ButtonAction:[function(e,t,n){"use strict";cc._RF.push(t,"6a31a4mi/tHBoCsbiuS1Eub","ButtonAction");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./Button")),s=e("../Util"),c=cc._decorator,l=c.ccclass,u=c.property,d=c.menu,p=c.requireComponent;function f(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){var t=this;return e.some(function(e){return t.button[e]})}}var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=a.ButtonState.IDLE,t.color=cc.Color.WHITE,t.opacity=255,t.scale=1.2,t.sprite=null,t.animation=null,t.events=[],t._button=null,t}return r(t,e),Object.defineProperty(t.prototype,"button",{get:function(){if(this._button&&cc.isValid(a.default,!0)||(this._button=this.getComponent(a.default)),!this._button)throw new Error(s.nameOfComponent(this)+" should be attached to a "+a.default.name+" component.");return this._button},enumerable:!0,configurable:!0}),o([u({type:cc.Enum(a.ButtonState)})],t.prototype,"state",void 0),o([u({visible:f("applyColor")})],t.prototype,"color",void 0),o([u({visible:f("applyOpacity"),min:0,max:255,step:1})],t.prototype,"opacity",void 0),o([u({visible:f("applyScale"),min:0})],t.prototype,"scale",void 0),o([u({type:cc.SpriteFrame,visible:f("applySprite")})],t.prototype,"sprite",void 0),o([u({type:cc.AnimationClip,visible:f("applyAnimation")})],t.prototype,"animation",void 0),o([u(cc.Component.EventHandler)],t.prototype,"events",void 0),t=o([l,p(a.default),d("Scribbles And Ink/UI/Button Action")],t)}(a.ButtonStateAction);n.default=h,cc._RF.pop()},{"../Util":"index","./Button":"Button"}],ButtonResolvingActivator:[function(e,t,n){"use strict";cc._RF.push(t,"5011aXhgoVNBa+c2pthyjMO","ButtonResolvingActivator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a,s=i(e("../UI/Button")),c=e("../Util"),l=i(e("../Generic/Activator")),u=cc._decorator,d=u.ccclass,p=u.property,f=u.menu,h=u.disallowMultiple;(function(e){e[e.ShowOnButtonResolving=0]="ShowOnButtonResolving",e[e.HideOnButtonResolving=1]="HideOnButtonResolving"})(a||(a={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._hidden=!1,t.activateStrategy=a.ShowOnButtonResolving,t._button=null,t}return r(t,e),Object.defineProperty(t.prototype,"button",{get:function(){return cc.isValid(this._button)||(this._button=this.getComponent(s.default)||c.getComponentInParents(this.node,s.default)),this._button},set:function(e){this._button=e},enumerable:!0,configurable:!0}),t.prototype.determineActive=function(){switch(this.activateStrategy){case a.ShowOnButtonResolving:return!!this.button&&!this.button.resolving;case a.HideOnButtonResolving:return!!this.button&&this.button.resolving}},t.ActivateStrategy=a,o([p({visible:!1,override:!0})],t.prototype,"_hidden",void 0),o([p({type:cc.Enum(a)})],t.prototype,"activateStrategy",void 0),o([p({type:s.default,visible:!0,tooltip:"Button check resolving status of. If not defined, hider will look for a button on this node or in it's parents"})],t.prototype,"_button",void 0),t=o([d,h,f("Scribbles And Ink/UI/Button Resolving Activator")],t)}(l.default);n.default=y,cc._RF.pop()},{"../Generic/Activator":"Activator","../UI/Button":"Button","../Util":"index"}],Button:[function(e,t,n){"use strict";cc._RF.push(t,"9bc6fMTHOpOeroVQeKWLezF","Button");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("../Framework/GameManager")),u=e("../Util"),d=cc._decorator,p=d.ccclass,f=d.menu,h=d.executeInEditMode,y=d.property,v=d.disallowMultiple;function _(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){var t=this;return e.some(function(e){return t[e]})}}var g;(function(e){e[e.IDLE=0]="IDLE",e[e.DISABLED=1]="DISABLED",e[e.HOVER=2]="HOVER",e[e.PRESS=3]="PRESS",e[e.RESOLVING=4]="RESOLVING"})(g=n.ButtonState||(n.ButtonState={}));var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(cc.Component);n.ButtonStateAction=m;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t.applyColor=!1,t.applyOpacity=!1,t.applyScale=!1,t.applySprite=!1,t.applyAnimation=!1,t.duration=.1,t.clickEvents=[],t._state=g.IDLE,t._hover=!1,t._press=!1,t._resolving=!1,t._eventHandlesEnabled=!1,t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hover",{get:function(){return this._hover},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"press",{get:function(){return this.press},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolving",{get:function(){return this._resolving},enumerable:!0,configurable:!0}),t.prototype.getStateAction=function(e){return this.getComponents(m).find(function(t){return t.state===e})||null},t.prototype.click=function(e){return void 0===e&&(e=null),i(this,void 0,Promise,function(){var t,n,r,o,i,c,d,p,f;return a(this,function(a){switch(a.label){case 0:if(this._resolving)return[2];l.default.analytics.updateUITimestamp(),a.label=1;case 1:a.trys.push([1,9,10,11]),r=s(this.clickEvents),o=r.next(),a.label=2;case 2:if(o.done)return[3,8];i=o.value,a.label=3;case 3:return a.trys.push([3,6,,7]),c=u.executeEventHandler(i,e),(d=c instanceof Promise)&&!this._resolving&&(this._resolving=!0,this.updateState(e)),d?[4,c]:[3,5];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:return p=a.sent(),cc.error(p),[3,7];case 7:return o=r.next(),[3,2];case 8:return[3,11];case 9:return f=a.sent(),t={error:f},[3,11];case 10:try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}return[7];case 11:return this._resolving&&(this._resolving=!1),this.updateState(null),[2]}})})},t.prototype.playSound=function(e,t){void 0===e&&(e=null);var n="string"==typeof e?e:t;l.default.audio.play({name:n})},t.prototype.onLoad=function(){this._state=-1,this.updateState(null)},t.prototype.onEnable=function(){this.setEventHandlersEnabled(!0),this.updateState(null)},t.prototype.onDisable=function(){this.setEventHandlersEnabled(!1),this.updateState(null)},t.prototype.onFocusInEditor=function(){var e,t,r=this.getComponentsInChildren(m),o={};try{for(var i=s(r),a=i.next();!a.done;a=i.next()){var c=a.value,l=c.state;o[l]=o[l]||0,o[l]+=1,!this.applySprite&&c.sprite&&(c.sprite=null),!this.applyAnimation&&c.animation&&(c.animation=null),cc.log(c.animation&&c.animation.name)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var u in o)if(o[u]>1){cc.warn(n.name+" has multiple ButtonAction components with the same state. Note that only the first defined ButtonAction component will be used.");break}this.updateState(null)},t.prototype.touchStart=function(e){this.enabled&&this.enabledInHierarchy&&(this._press=!0,this.updateState(e),e.stopPropagation())},t.prototype.touchMove=function(e){this.enabled&&this.enabledInHierarchy&&this._press&&(this.node._hitTest(e.getLocation())||(this._press=!1),this.updateState(e),e.stopPropagation())},t.prototype.touchEnd=function(e){this.enabled&&this.enabledInHierarchy&&(this._press&&!this._resolving&&this.click(e),this._press=!1,this.updateState(e),e.stopPropagation())},t.prototype.touchCancel=function(e){this._press=!1,this.updateState(e)},t.prototype.mouseEnter=function(e){this._hover=!0,this.updateState(e)},t.prototype.mouseLeave=function(e){this._hover=!1,this.updateState(e)},t.prototype.setEventHandlersEnabled=function(e){if(this._eventHandlesEnabled!==e){var t=cc.Node.EventType,n=t.TOUCH_START,r=t.TOUCH_MOVE,o=t.TOUCH_END,i=t.TOUCH_CANCEL,a=t.MOUSE_ENTER,s=t.MOUSE_LEAVE,c=e?"on":"off";this.node[c](n.toString(),this.touchStart,this),this.node[c](r.toString(),this.touchMove,this),this.node[c](o.toString(),this.touchEnd,this),this.node[c](i.toString(),this.touchCancel,this),this.node[c](a.toString(),this.mouseEnter,this),this.node[c](s.toString(),this.mouseLeave,this)}},t.prototype.updateState=function(e){if(!cc.isValid(this,!0))return!1;var t=g.IDLE,n=this.state;this._resolving?t=g.RESOLVING:this.enabled||this.enabledInHierarchy?this._hover&&!this._press?t=g.HOVER:this._press&&(t=g.PRESS):t=g.DISABLED;var r=t!==n;if(r){this._state=t;var o=this.getStateAction(t);this.applyStateActionToTarget(o),this.executeStateEvents(o,e)}return r},t.prototype.applyStateActionToTarget=function(e){if(e){var t=this.target||this.node;this.applyColor&&(t.color=e.color);var n=0===this.duration;if(this.applyOpacity&&n?t.opacity=e.opacity:this.applyOpacity&&t.runAction(cc.fadeTo(this.duration,e.opacity)),this.applyScale&&n?t.scale=e.scale:this.applyScale&&t.runAction(cc.scaleTo(this.duration,e.scale)),this.applySprite&&e.sprite){var r=t.getComponent(cc.Sprite);r&&(r.spriteFrame=e.sprite)}if(this.applyAnimation){var o=t.getComponent(cc.Animation),i=e.animation;o&&o.stop(),o&&i&&!o.getClips().includes(i)&&o.addClip(i),o&&i&&o.play(i.name)}}},t.prototype.executeStateEvents=function(e,t){return void 0===t&&(t=null),i(this,void 0,Promise,function(){var n,r,o,i,c,l,d;return a(this,function(a){switch(a.label){case 0:if(!(o=e&&e.events))return[2];this.state===g.PRESS||this.state===g.HOVER||this.state===g.RESOLVING||(t=null),a.label=1;case 1:a.trys.push([1,6,7,8]),i=s(o),c=i.next(),a.label=2;case 2:return c.done?[3,5]:(l=c.value,[4,u.executeEventHandler(l,t)]);case 3:a.sent(),a.label=4;case 4:return c=i.next(),[3,2];case 5:return[3,8];case 6:return d=a.sent(),n={error:d},[3,8];case 7:try{c&&!c.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}return[7];case 8:return[2]}})})},o([y({type:cc.Node})],t.prototype,"target",void 0),o([y({animatable:!1})],t.prototype,"applyColor",void 0),o([y({animatable:!1})],t.prototype,"applyOpacity",void 0),o([y({animatable:!1})],t.prototype,"applyScale",void 0),o([y({animatable:!1})],t.prototype,"applySprite",void 0),o([y({animatable:!1})],t.prototype,"applyAnimation",void 0),o([y({visible:_("applyScale","applyOpacity"),animatable:!1,displayName:"Scale/Fade Duration for attached ButtonAction components.",min:0})],t.prototype,"duration",void 0),o([y({type:cc.Component.EventHandler,tooltip:"Events executed when Button is used as intended: click and released."})],t.prototype,"clickEvents",void 0),t=n=o([p,h,v,f("Scribbles And Ink/UI/Button")],t)}(cc.Component);n.default=b,cc._RF.pop()},{"../Framework/GameManager":"GameManager","../Util":"index"}],CameraRig:[function(e,t,n){"use strict";cc._RF.push(t,"fd596aUxdNEKIbCySbluACC","CameraRig");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../Util"),c=cc._decorator,l=c.ccclass,u=c.property,d=c.requireComponent,p=c.disallowMultiple,f=c.executeInEditMode,h=c.menu,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._target=null,t._camera=null,t}return r(t,e),Object.defineProperty(t.prototype,"camera",{get:function(){if(this._camera||(this._camera=this.getComponent(cc.Camera)),!this._camera)throw new Error("CameraRig requires Camera component.");return this._camera},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.camera.zoomRatio=1/this.node.scale,cc.isValid(this._target)&&(this.node.position=s.getLocalPosition(this._target,this.node))},t.prototype.followTarget=function(e,t,n){return void 0===t&&(t=.25),void 0===n&&(n="linear"),i(this,void 0,Promise,function(){return a(this,function(r){switch(r.label){case 0:return this._target=null,[4,s.transformToTarget(this.node,e,t,n)];case 1:return r.sent(),this._target=e,[2]}})})},t.prototype.matchTarget=function(e,t,n){return void 0===t&&(t=.25),void 0===n&&(n="linear"),s.transformToTarget(this.node,e,t,n)},o([u({type:cc.Node,displayName:"Follow Target"})],t.prototype,"_target",void 0),t=o([l,p,d(cc.Camera),f,h("Scribbles And Ink/Generic/Camera Rig")],t)}(cc.Component);n.default=y,cc._RF.pop()},{"../Util":"index"}],Captions:[function(e,t,n){"use strict";cc._RF.push(t,"ff203EUrLRJjpUO1a6SSZVi","Captions");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./GameComponent")),s=i(e("./GameManager")),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.property,p=c.menu,f=c.executionOrder,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._maxCharacters=144,t._hideHesitation=1,t._label=null,t._sprite=null,t._captions=null,t._hideDelay=0,t.onSpringRollCaptionMute=function(e){t.enabled=!e},t}return r(t,e),Object.defineProperty(t.prototype,"label",{get:function(){if(cc.isValid(this._label)||(this._label=this.getComponentInChildren(cc.Label)),!this._label)throw new Error("Captions Text Label could not be found");return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{get:function(){if(cc.isValid(this._label)||(this._sprite=this.getComponentInChildren(cc.Sprite)),!this._sprite)throw new Error("Captions Container Sprite could not be found");return this._sprite},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return!this.sprite.enabled&&!this.label.enabled},set:function(e){this.sprite.enabled=this.label.enabled=!e},enumerable:!0,configurable:!0}),t.prototype.onGameStart=function(){var e=s.default.assets.getSingleAsset("Common/Captions").json;this._captions=e,this.enabled=!1,cc.springRoll&&(cc.springRoll.captionsMuted.subscribe(this.onSpringRollCaptionMute),this.onSpringRollCaptionMute(cc.springRoll.captionsMuted.value))},t.prototype.onDestroy=function(){cc.springRoll&&cc.springRoll.captionsMuted.unsubscribe(this.onSpringRollCaptionMute)},t.prototype.update=function(e){this._hideDelay>0?this._hideDelay-=e:this.hidden=!0},t.prototype.onDisable=function(){this.hidden=!0},t.prototype.showCaption=function(e,t){var n=this;if(this.enabled){var r=this._captions&&this._captions[e];if(r){for(var o=Math.max(Math.floor(r.length/this._maxCharacters),1),i=function(e){var i=t/o*e,s=r.slice(a._maxCharacters*e,a._maxCharacters*(e+1));a.schedule(function(){n.label.string=s},0,0,i)},a=this,s=0;s<o;s++)i(s);this.hidden=!1,this._hideDelay=t+this._hideHesitation}}},o([d({visible:!0})],t.prototype,"_maxCharacters",void 0),o([d({tooltip:"Amount of time it takes for captions to disappear after they've been written.",visible:!0})],t.prototype,"_hideHesitation",void 0),t=o([l,u,f(-25),p("Scribbles And Ink/Framework/Captions")],t)}(a.default);n.default=h,cc._RF.pop()},{"./GameComponent":"GameComponent","./GameManager":"GameManager"}],ChangeHiderShowTransformerOnCaptionHidden:[function(e,t,n){"use strict";cc._RF.push(t,"477c3jGZadKxpuGeOJ2SJ43","ChangeHiderShowTransformerOnCaptionHidden");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./Hider")),s=i(e("../Framework/GameManager")),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.requireComponent,p=c.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._position=cc.Vec2.ZERO,t._hider=null,t._originalPosition=null,t}return r(t,e),Object.defineProperty(t.prototype,"hider",{get:function(){if(cc.isValid(this._hider)||(this._hider=this.getComponent(a.default)),!this._hider)throw new Error("No Hider on this node.");return this._hider},enumerable:!0,configurable:!0}),t.prototype.update=function(){var e=this.hider.showTransformer;if(e){this._originalPosition||(this._originalPosition=e.position);var t=s.default.captions.hidden?this._originalPosition:this._position;e.position.equals(t)||(e.position=t.clone())}},o([p({visible:!0,tooltip:"When a caption is being shown, the Hider component on this node will have it's position value set to this."})],t.prototype,"_position",void 0),t=o([l,u,d(a.default)],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Framework/GameManager":"GameManager","./Hider":"Hider"}],ComponentExistsActivator:[function(e,t,n){"use strict";cc._RF.push(t,"3075aWAKDlMZ68Ji3zsac/H","ComponentExistsActivator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./Activator")),c=e("../Util"),l=e("../constants"),u=cc._decorator,d=u.ccclass,p=u.menu,f=u.property;function h(e,t){t.includes(e)||t.push(e)}function y(){return!this._inScene}var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._componentName="",t._inScene=!0,t._inParents=!1,t._onNode=!1,t._inChildren=!1,t._comparer=l.Comparer.AtLeast,t._value=1,t}return r(t,e),t.prototype.determineActive=function(){var e,t,n,r,o,a;if(!this._componentName)return!1;var s=[];if(this._inScene)try{for(var u=i(c.getComponentsInScene(this._componentName)),d=u.next();!d.done;d=u.next()){h(_=d.value,s)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}if(!this._inScene&&this._onNode)try{for(var p=i(this.getComponents(this._componentName)),f=p.next();!f.done;f=p.next()){h(_=f.value,s)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}if(!this._inScene&&this._inChildren)try{for(var y=i(this.getComponentsInChildren(this._componentName)),v=y.next();!v.done;v=y.next()){var _;h(_=v.value,s)}}catch(e){o={error:e}}finally{try{v&&!v.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}!this._inScene&&this._inParents&&((_=c.getComponentInParents(this,this._componentName))&&h(_,s));return this._comparer===l.Comparer.AtLeast?s.length>=this._value:s.length<=this._value},o([f({visible:!0})],t.prototype,"_componentName",void 0),o([f({visible:!0})],t.prototype,"_inScene",void 0),o([f({visible:y})],t.prototype,"_inParents",void 0),o([f({visible:y})],t.prototype,"_onNode",void 0),o([f({visible:y})],t.prototype,"_inChildren",void 0),o([f({type:cc.Enum(l.Comparer),visible:!0})],t.prototype,"_comparer",void 0),o([f({visible:!0,min:0,step:1})],t.prototype,"_value",void 0),t=o([d,p("Scribbles And Ink/Generic/Component Exists Activator")],t)}(s.default);n.default=v,cc._RF.pop()},{"../Util":"index","../constants":"constants","./Activator":"Activator"}],ConstrainScaleToPosition:[function(e,t,n){"use strict";cc._RF.push(t,"83bd1BjkmxNJbibqA/q4oDN","ConstrainScaleToPosition");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.disallowMultiple,c=i.executeInEditMode,l=i.property,u=i.menu,d=cc.Enum({X:0,Y:1}),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.axis=d.Y,t.fromAxisValue=320,t.toAxisValue=-320,t.minScale=.25,t.maxScale=1,t}return r(t,e),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){var e=this.node,t=this.axis,n=this.fromAxisValue,r=this.toAxisValue,o=e[t===d.X?"x":"y"];return cc.misc.clamp01((o-n)/(r-n))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"constrainedScale",{get:function(){var e=this.scaleFactor,t=this.minScale,n=this.maxScale;return cc.misc.lerp(t,n,e)},enumerable:!0,configurable:!0}),t.prototype.setEnabled=function(e){e||(this.node.scale=1),this.enabled=e},t.prototype.update=function(){var e=this.constrainedScale;this.node.setScale(e,e)},t.ConstrainAxes=d,o([l({type:d})],t.prototype,"axis",void 0),o([l()],t.prototype,"fromAxisValue",void 0),o([l()],t.prototype,"toAxisValue",void 0),o([l()],t.prototype,"minScale",void 0),o([l()],t.prototype,"maxScale",void 0),t=o([a,s,c,u("Scribbles And Ink/Generic/Constrain Scale To Position")],t)}(cc.Component);n.default=p,cc._RF.pop()},{}],ContentLoader:[function(e,t,n){"use strict";cc._RF.push(t,"5a4143j/ZZC3LHdoYwZ1A33","ContentLoader");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=l(e("./GameComponent")),d=l(e("./GameManager")),p=cc._decorator,f=p.ccclass,h=p.property,y=p.menu,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contentPaths=[],t._autoLoad=!0,t._autoInstance=!0,t._autoDispose=!0,t._instances=[],t._contentsBeingLoaded=null,t._contents={},t.autoCreateInstanceOnceLoaded=function(e){t._autoInstance&&(e?e.then(t.autoCreateInstanceOnceLoaded):t.createInstances())},t}return r(t,e),Object.defineProperty(t.prototype,"autoLoad",{get:function(){return this._autoLoad},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoInstance",{get:function(){return this._autoInstance},set:function(e){this._autoInstance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoDispose",{get:function(){return this._autoDispose},set:function(e){this._autoDispose=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instances",{get:function(){for(var e=this._instances.length-1;e>=0;e--){var t=this._instances[e];cc.isValid(t,!0)||this._instances.splice(e,1)}return s(this._instances)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contents",{get:function(){return o({},this._contents)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return Object.keys(this._contents).length>=this.contentPaths.length},enumerable:!0,configurable:!0}),t.prototype.onDestroy=function(){this._autoDispose&&this.disposeContent()},t.prototype.onScenePreLoad=function(){return this.autoLoadAssetsIfNeeded(!1)},t.prototype.onSceneStart=function(){var e=this.autoLoadAssetsIfNeeded(!0);this._autoLoad&&this.autoCreateInstanceOnceLoaded(e)},t.prototype.loadContent=function(){return this._contentsBeingLoaded||(this._contentsBeingLoaded=this.getOrLoadAssets()),this._contentsBeingLoaded},t.prototype.disposeContent=function(){var e,t;try{for(var n=c(this.contentPaths),r=n.next();!r.done;r=n.next()){var o=r.value;d.default.assets.disposeDynamicAssets(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._contents={}},t.prototype.destroyInstancesAndDisposeContent=function(){var e,t;try{for(var n=c(this.instances),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.disposeContent()},t.prototype.createInstances=function(){var e=[];for(var t in this._contents){var n=this._contents[t];if(n instanceof cc.Prefab!=!1){var r=cc.instantiate(n);r.setParent(this.node.parent),r.setSiblingIndex(this.node.getSiblingIndex()),r.setPosition(this.node.position),r.scaleX=this.node.scaleX,r.scaleY=this.node.scaleY,r.skewX=this.node.skewX,r.skewY=this.node.skewY,r.angle=this.node.angle,e.push(r)}}return this._instances=s(this.instances,e),e},t.prototype.autoLoadAssetsIfNeeded=function(e){if(this._autoLoad&&(!e||this.node.active&&this.node.activeInHierarchy)&&!this._contentsBeingLoaded&&!this.loaded)return this.loadContent().then(function(){})},t.prototype.getOrLoadAssets=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null);for(var r=d.default.assets,o=function(o){var a=i.contentPaths[o],s=o===e&&t?t:r.hasDynamicAssets(a)?r.getDynamicAssets(a):r.loadDynamicAssets(a);if(s instanceof Promise)return{value:s.then(function(e){return n.getOrLoadAssets(o,e)})};for(var c in s)i._contents[c]=s[c]},i=this,a=e;a<this.contentPaths.length;a++){var s=o(a);if("object"==typeof s)return s.value}return this._contentsBeingLoaded=null,Promise.resolve(this.contents)},i([h({type:cc.String,tooltip:"Like the AssetLoader's asset paths, the content paths are relative to either the resources/low or resources/standard folders.If were in lowEndDevice mode, assets will attempt to be loaded from resources/lowfirst.",visible:!0})],t.prototype,"contentPaths",void 0),i([h({tooltip:"If false, the Asset would have to be loaded programatically, or through thevia an event relay with an actor attached to this node.",visible:!0})],t.prototype,"_autoLoad",void 0),i([h({tooltip:"If any the loaded contents are prefabs, they will automatically be instantiated.",visible:!0})],t.prototype,"_autoInstance",void 0),i([h({visible:!0})],t.prototype,"_autoDispose",void 0),t=i([f,y("Scribbles And Ink/Framework/Content Loader")],t)}(u.default);n.default=v,cc._RF.pop()},{"./GameComponent":"GameComponent","./GameManager":"GameManager"}],Costume:[function(e,t,n){"use strict";cc._RF.push(t,"f046dd6/X5PyoJoixAd6ibu","Costume");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Framework/EventRelay")),s=i(e("../../Drawing/DrawingSpot")),c=i(e("../../Character/SnapNodeToBone")),l=cc._decorator,u=l.ccclass,d=l.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._characterName="",t._back=void 0,t._front=void 0,t._drawingSpot=void 0,t._character=void 0,t._snapper=void 0,t}return r(t,e),Object.defineProperty(t.prototype,"back",{get:function(){if(!this._back)throw new Error("Back node was not set in inspector");return this._back},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"front",{get:function(){if(!this._front)throw new Error("Front node was not set in inspector");return this._front},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawingSpot",{get:function(){if(!this._drawingSpot)throw new Error("Drawing Spot was not set in inspector");return this._drawingSpot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"character",{get:function(){var e=this;return this._character||(this._character=a.default.actors.find(function(t){return t.node.name===e._characterName})),this._character},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapper",{get:function(){if(this._snapper||(this._snapper=this.getComponent(c.default)||void 0),!this._snapper)throw new Error("Costume requires a 'SnapNodeToBone' component");return this._snapper},enumerable:!0,configurable:!0}),t.prototype.setAttached=function(e){this.setBoxVisible(!e),this.character&&(this.snapper.enabled=e,e&&(this.snapper.target=this.character,this.node.scaleX=this.character.node.scaleX,this.node.scaleY=this.character.node.scaleY))},t.prototype.setBoxVisible=function(e){this.front.active=e,this.back.active=e},o([d({visible:!0})],t.prototype,"_characterName",void 0),o([d({type:cc.Node,visible:!0})],t.prototype,"_back",void 0),o([d({type:cc.Node,visible:!0})],t.prototype,"_front",void 0),o([d({type:s.default,visible:!0})],t.prototype,"_drawingSpot",void 0),t=o([u],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../Character/SnapNodeToBone":"SnapNodeToBone","../../Drawing/DrawingSpot":"DrawingSpot","../../Framework/EventRelay":"EventRelay"}],CurrentSceneActivator:[function(e,t,n){"use strict";cc._RF.push(t,"e998fq16yJCJLFq0IMJ7wES","CurrentSceneActivator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Generic/Activator")),s=i(e("../Framework/GameManager")),c=cc._decorator,l=c.ccclass,u=c.property,d=c.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentScene="",t}return r(t,e),t.prototype.determineActive=function(){return!!s.default.initialized&&s.default.currentSceneName===this.currentScene},o([u({tooltip:"Target will be activated if the current scene name is a match"})],t.prototype,"currentScene",void 0),t=o([l,d("Scribbles And Ink/Generic/Current Scene Activator")],t)}(a.default);n.default=p,cc._RF.pop()},{"../Framework/GameManager":"GameManager","../Generic/Activator":"Activator"}],Door:[function(e,t,n){"use strict";cc._RF.push(t,"944d8+ybHlDM6X3N+gIBcRH","Door");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Framework/EventActor")),s=cc._decorator,c=s.ccclass,l=s.requireComponent,u=s.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.opened=null,t.closed=null,t}return r(t,e),t.prototype.start=function(){this.close()},t.prototype.open=function(){if(!this.opened||!this.closed)throw new Error("opened and closed nodes need to be filled in the inspector.");this.opened.active=!0,this.closed.active=!1},t.prototype.close=function(){if(!this.opened||!this.closed)throw new Error("opened and closed nodes need to be filled in the inspector.");this.opened.active=!1,this.closed.active=!0},t.prototype.toggle=function(){if(!this.opened||!this.closed)throw new Error("opened and closed nodes need to be filled in the inspector.");var e=!this.opened.active;this.opened.active=e;var t=!e;this.closed.active=t},o([u(cc.Node)],t.prototype,"opened",void 0),o([u(cc.Node)],t.prototype,"closed",void 0),t=o([c,l(a.default)],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../../Framework/EventActor":"EventActor"}],DrawRocketManager:[function(e,t,n){"use strict";cc._RF.push(t,"aadfamFP19ByYQmzeylr967","DrawRocketManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Framework/StoryManager")),s=i(e("../../Framework/ContentLoader")),c=i(e("../../Drawing/Drawing")),l=e("../../Util"),u=cc._decorator,d=u.ccclass,p=u.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rocketSpawner=null,t}return r(t,e),t.prototype.attachDrawingToRocket=function(){if(this.rocketSpawner){var e=this.rocketSpawner.instances[0];if(e){var t=l.getComponentInScene(c.default);if(t){var n=t.node.convertToWorldSpaceAR(cc.Vec2.ZERO),r=e.convertToNodeSpaceAR(n);t.node.setParent(e),t.node.setPosition(r),t.node.setSiblingIndex(1)}}}},o([p(s.default)],t.prototype,"rocketSpawner",void 0),t=o([d],t)}(a.default);n.default=f,cc._RF.pop()},{"../../Drawing/Drawing":"Drawing","../../Framework/ContentLoader":"ContentLoader","../../Framework/StoryManager":"StoryManager","../../Util":"index"}],DrawToolExampleStrokes:[function(e,t,n){"use strict";cc._RF.push(t,"3eab7R4cLVE85EmdgUVI0yK","DrawToolExampleStrokes");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var d=e("../../../Code/Drawing/DrawingTool"),p=u(e("../../../Code/Drawing/DrawingUI")),f=e("../../../Code/Util"),h=u(e("../../../Code/Drawing/Drawing")),y=u(e("../../../Code/Framework/GameManager")),v=cc._decorator,_=v.ccclass,g=v.property,m=v.executeInEditMode;function b(e){return function(){e.inspectedTool=this,e.inspectedToolConfig=null,e.node.color=this.inheritColor?cc.Color.WHITE:cc.Color.GRAY}}function w(e){return new Promise(function(t){return setTimeout(t,1e3*e)})}var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._strokeAnimation=null,t._strokeRange=100,t._previewInEditor=!0,t._drawingUi=null,t._creatingExampleSplats=!1,t._runtimeSplatColor=cc.Color.WHITE,t.inspectedTool=null,t.inspectedToolConfig=null,t}return r(t,e),Object.defineProperty(t.prototype,"drawingUi",{get:function(){return this._drawingUi||(this._drawingUi=f.getComponentInScene(p.default)),this._drawingUi},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.node.removeAllChildren(),this.node.color=cc.Color.WHITE},t.prototype.update=function(){this.createRuntimeExampleSplats()},t.prototype.createRuntimeExampleSplats=function(){if(y.default.initialized&&this._strokeAnimation&&(this.inspectedTool===this.drawingUi.currentTool&&this._runtimeSplatColor===this.drawingUi.color||(this.inspectedTool=this.drawingUi.currentTool,this._runtimeSplatColor=this.drawingUi.color,this.playRuntimePointerAnimation()),this._creatingExampleSplats&&this.inspectedTool&&this.inspectedTool.isStroking)){var e=this.getPointerForExampleSplats()||this.createPointerForExampleSplats();this.inspectedTool.strokeMove(e.node.convertToWorldSpaceAR(cc.Vec2.ZERO))}},t.prototype.playRuntimePointerAnimation=function(){return i(this,void 0,Promise,function(){var e,t,n,r,o,i,c,l,u,d=this;return a(this,function(a){switch(a.label){case 0:this._creatingExampleSplats=!0,n=this.getPointerForExampleSplats()||this.createPointerForExampleSplats(),r=this.inspectedTool,o=this._strokeAnimation,this.drawingUi.clearDrawing(),a.label=1;case 1:a.trys.push([1,6,7,8]),i=s([0,.5,1]),c=i.next(),a.label=2;case 2:return c.done?[3,5]:(l=c.value,this.drawingUi.setSizeFactor(l),n.node.parent.y=cc.misc.lerp(-this._strokeRange,this._strokeRange,l),n.play(o.name),n.once(cc.Animation.EventType.PLAY,function(){r.strokeStart(d.drawingUi.currentDrawing,n.node.convertToWorldSpaceAR(cc.Vec2.ZERO))}),[4,new Promise(function(e){n.once(cc.Animation.EventType.FINISHED,e)})]);case 3:a.sent(),r.strokeEnd(),a.label=4;case 4:return c=i.next(),[3,2];case 5:return[3,8];case 6:return u=a.sent(),e={error:u},[3,8];case 7:try{c&&!c.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}return[7];case 8:return this._creatingExampleSplats=!1,[2]}})})},t.prototype.getPointerForExampleSplats=function(){var e=this.node.getChildByName("Pointer Anchor");return e?e.getChildByName("Pointer").getComponent(cc.Animation):null},t.prototype.createEditorExampleSplats=function(){var e,t;try{for(var n=s(this.drawingUi.tools),r=n.next();!r.done;r=n.next()){var o=r.value;this._previewInEditor&&!o.onFocusInEditor?o.onFocusInEditor=b(this):!this._previewInEditor&&o.onFocusInEditor&&(o.onFocusInEditor=null)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._previewInEditor?this.doInspectedToolConfigsMatch()&&!this.buildingExampleSplatsWillCrash()&&this.createExampleSplatsUsingAnimatedPointer():(this.node.removeAllChildren(),this.node.color=cc.Color.WHITE)},t.prototype.buildingExampleSplatsWillCrash=function(){return!this.inspectedTool||(this.inspectedTool.emitStrategy===d.EmitStrategy.Distance&&0===this.inspectedTool.emitStep||!(!this.inspectedTool.inheritSize||!this.inspectedTool.sizeMap.some(function(e){return e<5})))},t.prototype.initializeInspectorToolConfig=function(){var e,t,n={},r=this.inspectedTool,o=l(Object.keys(r),["sizeMap"]);try{for(var i=s(o),a=i.next();!a.done;a=i.next()){var c=a.value;if(0!==c.indexOf("_")){var u=r[c];"boolean"==typeof u||"number"==typeof u?n[c]=u:u instanceof Array&&(0===u.length||u.every(function(e){return"number"==typeof e}))&&(n[c]=l(u))}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.inspectedToolConfig=n},t.prototype.doInspectedToolConfigsMatch=function(){if(!this.inspectedTool)return!1;if(this._creatingExampleSplats)return!1;var e=!1;if(this.inspectedToolConfig){var t=this.inspectedTool,n=function(n){var o=r.inspectedToolConfig[n],i=t[n];if(o instanceof Array){var a=i;o.length===a.length&&o.every(function(e,t){return e===a[t]})||(e=!0,r.inspectedToolConfig[n]=l(a))}else o!==i&&(e=!0,r.inspectedToolConfig[n]=i)},r=this;for(var o in this.inspectedToolConfig)n(o)}else e=!0,this.initializeInspectorToolConfig();return e},t.prototype.createDrawingForExampleSplats=function(){if(!this.inspectedTool)throw new Error("Can't create drawing for example splats without a tool being inspected.");var e=new cc.Node(this.inspectedTool.node.name+" Example Stroke").addComponent(h.default);return e.node.setParent(this.node),e},t.prototype.createPointerForExampleSplats=function(){if(!this._strokeAnimation)throw new Error("Needs a stroke animaton.");var e=new cc.Node("Pointer Anchor");e.setParent(this.node);var t=new cc.Node("Pointer");t.setParent(e);var n=t.addComponent(cc.Animation);return n.addClip(this._strokeAnimation),n.defaultClip=this._strokeAnimation,n},t.prototype.createExampleSplatsUsingAnimatedPointer=function(){return i(this,void 0,Promise,function(){var e,t,n,r,o,i,c,l,u,d;return a(this,function(a){switch(a.label){case 0:return this._creatingExampleSplats?[2]:this.inspectedTool?this._strokeAnimation?(this._creatingExampleSplats=!0,[4,w(1)]):[2,cc.error("No stroke animation defined on "+f.nameOfComponent(this)+".")]:[2];case 1:a.sent(),this.node.removeAllChildren(),n=this.createDrawingForExampleSplats(),r=this.createPointerForExampleSplats(),f.chunker.start("draw-tool-example"),a.label=2;case 2:a.trys.push([2,10,11,12]),o=s([0,.5,1]),i=o.next(),a.label=3;case 3:if(i.done)return[3,9];c=i.value,r.node.parent.y=cc.misc.lerp(-this._strokeRange,this._strokeRange,c),r.play(),this.drawingUi._sizeFactor=c,this.inspectedTool.onLoad(),this.inspectedTool.strokeStart(n,r.node.convertToWorldSpaceAR(cc.Vec2.ZERO)),l=1/this._strokeAnimation.sample,u=0,a.label=4;case 4:return u<this._strokeAnimation.duration?(r.setCurrentTime(u),this.inspectedTool.strokeMove(r.node.convertToWorldSpaceAR(cc.Vec2.ZERO)),this.inspectedTool.update(l),f.chunker.check("draw-tool-example",.25)?[4,w(0)]:[3,6]):[3,7];case 5:a.sent(),a.label=6;case 6:return u+=l,[3,4];case 7:this.inspectedTool.strokeEnd(),r.stop(),a.label=8;case 8:return i=o.next(),[3,3];case 9:return[3,12];case 10:return d=a.sent(),e={error:d},[3,12];case 11:try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}return[7];case 12:return this._creatingExampleSplats=!1,[2]}})})},o([g({type:cc.AnimationClip,visible:!0})],t.prototype,"_strokeAnimation",void 0),o([g({visible:!0})],t.prototype,"_strokeRange",void 0),o([g({visible:!0})],t.prototype,"_previewInEditor",void 0),t=o([_,m],t)}(cc.Component);n.default=S,cc._RF.pop()},{"../../../Code/Drawing/Drawing":"Drawing","../../../Code/Drawing/DrawingTool":"DrawingTool","../../../Code/Drawing/DrawingUI":"DrawingUI","../../../Code/Framework/GameManager":"GameManager","../../../Code/Util":"index"}],DrawingConditionalDestroy:[function(e,t,n){"use strict";cc._RF.push(t,"d71c555WJFAf63CaKUu7XA9","DrawingConditionalDestroy");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Framework/GameComponent")),s=i(e("../Framework/GameManager")),c=e("./DrawingStorage"),l=cc._decorator,u=l.ccclass,d=l.menu,p=l.property,f=cc.Enum({Missing:0,Exists:1}),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.drawingKey="",t.destroyIf=f.Missing,t}return r(t,e),t.prototype.onGameStart=function(){s.default.drawingStorage.hasStoredDrawing({storageKey:this.drawingKey,variationStrategy:c.GetVariation.Latest,deserialize:!0})===(this.destroyIf===f.Exists)&&this.node.destroy()},o([p()],t.prototype,"drawingKey",void 0),o([p({type:f})],t.prototype,"destroyIf",void 0),t=o([u,d("Scribbles And Ink/Drawing/Drawing Conditional Destroy")],t)}(a.default);n.default=h,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Framework/GameManager":"GameManager","./DrawingStorage":"DrawingStorage"}],DrawingConditionalSpineClip:[function(e,t,n){"use strict";cc._RF.push(t,"6387asp7bNDY7x1YltIiGIP","DrawingConditionalSpineClip");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Framework/EventActor")),s=i(e("../Framework/GameManager")),c=e("./DrawingStorage"),l=cc._decorator,u=l.ccclass,d=l.menu,p=l.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.drawingKey="",t.drawingExistsClip="",t.drawingMissingClip="",t.track=0,t}return r(t,e),t.prototype.playClip=function(){var e=this.getComponent(a.default);if(e){var t=s.default.drawingStorage.hasStoredDrawing({storageKey:this.drawingKey,variationStrategy:c.GetVariation.Latest,deserialize:!0})?this.drawingExistsClip:this.drawingMissingClip;e.playSpineClip(t,this.track,0,!1)}},o([p()],t.prototype,"drawingKey",void 0),o([p()],t.prototype,"drawingExistsClip",void 0),o([p()],t.prototype,"drawingMissingClip",void 0),o([p({step:1,min:0})],t.prototype,"track",void 0),t=o([u,d("Scribbles And Ink/Drawing/Drawing Conditional Spine Clip")],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Framework/EventActor":"EventActor","../Framework/GameManager":"GameManager","./DrawingStorage":"DrawingStorage"}],DrawingHandler:[function(e,t,n){"use strict";cc._RF.push(t,"50a4eyA3sVD0JnqG4Nax7b2","DrawingHandler");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onStrokeStart=function(e){},t.prototype.onStrokeMove=function(e){},t.prototype.onStrokeEnd=function(){},t.prototype.onDrawingSave=function(e,t){},t.prototype.onDrawingClear=function(e,t){},t.prototype.onDrawEnabled=function(){},t.prototype.onDrawDisabled=function(){},t}(o(e("../Framework/GameComponent")).default);n.default=i,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent"}],DrawingSelectSplatPrefabsButton:[function(e,t,n){"use strict";cc._RF.push(t,"1f763b8zmdLFq7zWtyXbZdP","DrawingSelectSplatPrefabsButton");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../Framework/GameManager")),l=cc._decorator,u=l.ccclass,d=l.property,p=l.disallowMultiple,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.splatPrefabs=[],t}return r(t,e),t.prototype.assignPrefabsToCurrentTool=function(){c.default.drawingUI.currentTool.splatPrefabs=a(this.splatPrefabs),this.placeSelectedPrefabVisualizer()},t.prototype.placeSelectedPrefabVisualizer=function(e){var t=c.default.drawingUI,n=(e=e||t.currentTool.node).getChildByName("Chosen Splat Prefab");if(n){var r=this.node.children[0];if(r){var o=cc.instantiate(r);n.removeAllChildren(),n.addChild(o);var i=n.getBoundingBox().width/o.getBoundingBox().width;o.scale*=i}}},o([d({type:cc.Prefab,tooltip:"Prefabs placed here will be instanced and placed onto drawing as splats at random.",displayName:"Splat Prefabs",formerlySerializedAs:"prefabs"})],t.prototype,"splatPrefabs",void 0),t=o([u,p],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Framework/GameManager":"GameManager"}],DrawingSpot:[function(e,t,n){"use strict";cc._RF.push(t,"a9436bhrG1DXI0qKwffECed","DrawingSpot");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a,s=i(e("../Framework/GameManager")),c=i(e("./Drawing")),l=i(e("./DrawingHandler")),u=e("./DrawingStorage"),d=cc._decorator,p=d.ccclass,f=d.menu,h=d.property;function y(){return this.node.width>0&&this.node.height>0}function v(){return this._variationStrategy===u.GetVariation.Specific}(function(e){e[e.AsDrawn=0]="AsDrawn",e[e.Center=1]="Center",e[e.CenterOfOpacity=2]="CenterOfOpacity"})(a||(a={}));var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageKey="",t.fitStrategy=a.Center,t._autoRefresh=!0,t._variationStrategy=u.GetVariation.Latest,t._variation=0,t._$deserialize=!0,t}return r(t,e),t.prototype.onGameStart=function(){if(this._autoRefresh)return this.refreshDrawing()},t.prototype.onScenePreLoad=function(){if(this._autoRefresh)return this.refreshDrawing()},Object.defineProperty(t.prototype,"drawing",{get:function(){return this.getComponentInChildren(c.default)},enumerable:!0,configurable:!0}),t.prototype.refreshDrawing=function(){this.clearDrawing(),this.attachDrawing()},t.prototype.clearDrawing=function(){this.node.removeAllChildren()},t.prototype.fitDrawing=function(e,t){if(void 0===e&&(e=this.drawing),void 0===t&&(t=0),e){if(e!==this.drawing&&this.drawing&&this.drawing.node.destroy(),e!==this.drawing){var n=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),r=this.node.convertToNodeSpaceAR(n);e.node.setParent(this.node),e.node.setPosition(r),e.node.scale/=this.node.scale,cc.log(e.node.name.toUpperCase())}var o=this.getFittedScalePos(e);t>0?e.node.runAction(cc.spawn(cc.scaleTo(t,o.scale),cc.moveTo(t,o.position))):(e.node.setScale(o.scale),e.node.setPosition(o.position))}},t.prototype.getFittedScalePos=function(e){var t,n,r=this.node.getContentSize(),o=r.width>0&&r.height>0;if(!e.isEmpty&&o)switch(this.fitStrategy){case a.Center:t=e.size,n=e.center;break;case a.CenterOfOpacity:t=e.size,n=e.centerOfOpacity;break;default:case a.AsDrawn:t=cc.view.getFrameSize(),n=cc.Vec2.ZERO}else t=r,n=cc.Vec2.ZERO;var i=o?Math.min(r.width/t.width,r.height/t.height):e.node.scale;return{scale:i,position:n.mulSelf(-i)}},t.prototype.attachDrawing=function(e){var t=this;void 0===e&&(e=null);var n=s.default.drawingStorage.getVariationIndex({variation:this._variation,variationStrategy:this._variationStrategy,storageKey:this.storageKey});arguments.length>0||(e=s.default.drawingStorage.copyStoredDrawing({variation:n,variationStrategy:u.GetVariation.Specific,storageKey:this.storageKey,deserialize:this._$deserialize})),e instanceof Promise?e.then(function(e){return cc.isValid(t)&&t.attachDrawing(e)}):e&&(e.node.setParent(this.node),this.fitDrawing(e))},o([h()],t.prototype,"storageKey",void 0),o([h({type:cc.Enum(a),visible:y})],t.prototype,"fitStrategy",void 0),o([h({visible:!0,displayName:"Auto Load"})],t.prototype,"_autoRefresh",void 0),o([h({type:cc.Enum(u.GetVariation),visible:!0,displayName:"Get Variation"})],t.prototype,"_variationStrategy",void 0),o([h({visible:v,min:0,step:1})],t.prototype,"_variation",void 0),o([h({visible:!0,displayName:"Deserialize"})],t.prototype,"_$deserialize",void 0),t=o([p,f("Scribbles And Ink/Drawing/Drawing Spot")],t)}(l.default);n.default=_,cc._RF.pop()},{"../Framework/GameManager":"GameManager","./Drawing":"Drawing","./DrawingHandler":"DrawingHandler","./DrawingStorage":"DrawingStorage"}],DrawingStorage:[function(e,t,n){"use strict";cc._RF.push(t,"c203bcX69VIx7kjNHxBYRTF","DrawingStorage");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var d,p,f,h=u(e("../Framework/GameManager")),y=u(e("./Drawing")),v=e("../Util"),_=u(e("../Framework/GameComponent")),g=cc._decorator,m=g.ccclass,b=g.menu,w=g.property,S=g.disallowMultiple;function O(e){return null!==e&&"object"==typeof e&&"number"==typeof e.serializeStrategy}function P(e){return null!==e&&"object"==typeof e&&"string"==typeof e.storageKey}(function(e){e[e.Latest=0]="Latest",e[e.Specific=1]="Specific"})(d=n.SaveVariation||(n.SaveVariation={})),function(e){e[e.Latest=0]="Latest",e[e.Specific=1]="Specific",e[e.Random=2]="Random"}(p=n.GetVariation||(n.GetVariation={})),function(e){e[e.Latest=0]="Latest",e[e.Specific=1]="Specific",e[e.Random=2]="Random",e[e.Every=3]="Every"}(f=n.DeleteVariation||(n.DeleteVariation={}));var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._maxVariations=new Map,t._variationIds=new Map,t._drawingIdCounter=0,t._maxCachedDrawings=10,t._lowEndMaxCachedDrawings=4,t._cacheNode=null,t}return r(t,e),t.prototype.onRegisterStores=function(){return["drawing-data","drawing-meta"]},t.prototype.onGameLoad=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.createVariationIds()];case 1:return e.sent(),this.setDrawingIDCounter(),[2]}})})},t.prototype.storeDrawing=function(e){return i(this,void 0,Promise,function(){var t,n,r,o;return a(this,function(i){switch(i.label){case 0:return t=this.getVariationIds(e.storageKey),(n=e.variationStrategy===d.Latest?t.length:this.getVariationIndex({storageKey:e.storageKey,variationStrategy:p.Specific,variation:e.variation}))>t.length&&(cc.warn("Variation "+n+" out of range. Drawings for storageKey '"+e.storageKey+"' can only set variation"+(t.length>0?"s 0 -":"")+" "+t.length+". If you're unsure, use SaveVariationStrategy.Latest"),n=t.length),(r=t[n])||(r=this.createDrawingID(),t.push(r)),this.setCachedDrawing(e.drawing,r),e.serialize?[4,this.serializeDrawing(e.drawing,r,e.storageKey)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[4,this.deleteExtraneousVariations(e.storageKey,e.serialize)];case 3:return o=i.sent(),[2,cc.misc.clampf(n-o,-1,n)]}})})},t.prototype.getStoredDrawing=function(e){var t=this.getVariationIds(e.storageKey);if(0===t.length)return null;var n=t[this.getVariationIndex(e)];if(!n)return null;var r=this.getCachedDrawing(n);return!r&&e.deserialize&&(r=this.deserializeDrawing(n)),r},t.prototype.copyStoredDrawing=function(e){var t=this.getStoredDrawing(e);return t instanceof Promise?t.then(function(e){return e&&e.copy()}):t&&t.copy()},t.prototype.deleteStoredDrawing=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i,c,l,u,d,p,h,y,v;return a(this,function(a){switch(a.label){case 0:i=this.getVariationIds(e.storageKey),e.variationStrategy===f.Every?c=i.splice(0,i.length):(l=this.getVariationIndex({storageKey:e.storageKey,variationStrategy:e.variationStrategy,variation:e.variation}),c=i.splice(l,1));try{for(u=s(c),d=u.next();!d.done;d=u.next())y=d.value,this.deleteCachedDrawing(y)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(!e.serialize)return[3,8];a.label=1;case 1:a.trys.push([1,6,7,8]),p=s(c),h=p.next(),a.label=2;case 2:return h.done?[3,5]:(y=h.value,[4,this.deleteSerializedDrawing(y)]);case 3:a.sent(),a.label=4;case 4:return h=p.next(),[3,2];case 5:return[3,8];case 6:return v=a.sent(),r={error:v},[3,8];case 7:try{h&&!h.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}return[7];case 8:return[2]}})})},t.prototype.hasStoredDrawing=function(e){var t=this.getVariationIds(e.storageKey);return 0!==t.length&&this.getVariationIndex(e)in t},t.prototype.clearCachedDrawings=function(){this.cacheNode.removeAllChildren()},t.prototype.getNumMaxVariations=function(e){var t=this._maxVariations.get(e);return"number"!=typeof t&&(t=1),t},t.prototype.setNumMaxVariations=function(e,t){return i(this,void 0,Promise,function(){return a(this,function(n){switch(n.label){case 0:if(t<1)throw new Error("Must be at least 1");return this._maxVariations.set(e,t),[4,this.deleteExtraneousVariations(e,!0)];case 1:return n.sent(),[2]}})})},t.prototype.getVariationIndex=function(e){var t,n=this.getVariationIds(e.storageKey),r=n?n.length:1;switch(e.variationStrategy){case p.Specific:if("number"!=typeof e.variation)throw new Error("If variationStrategy is set to Specific an accompanying numeric variation must be provided");t=e.variation;break;case p.Random:t=v.Random.integer(0,r);break;default:case p.Latest:t=r-1}return Math.max(t,0)},t.prototype.getVariationIds=function(e){return this._variationIds.has(e)||this._variationIds.set(e,[]),this._variationIds.get(e)},t.prototype.createVariationIds=function(){return i(this,void 0,Promise,function(){var e,t,n,r,o,i,l,u;return a(this,function(a){switch(a.label){case 0:return[4,h.default.storage.find("drawing-meta")];case 1:n=a.sent();try{for(r=s(n),o=r.next();!o.done;o=r.next())i=c(o.value,2),l=i[0],P(u=i[1])&&this.getVariationIds(u.storageKey).push(l)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return[2]}})})},t.prototype.deleteExtraneousVariations=function(e,t){return i(this,void 0,Promise,function(){var n,r;return a(this,function(o){switch(o.label){case 0:n=this.getNumMaxVariations(e),r=0,o.label=1;case 1:return this.getVariationIds(e).length>n?(r++,[4,this.deleteStoredDrawing({variationStrategy:f.Specific,variation:0,storageKey:e,serialize:t})]):[3,3];case 2:return o.sent(),[3,1];case 3:return[2,r]}})})},t.prototype.setDrawingIDCounter=function(){var e,t,n,r;this._drawingIdCounter=0;try{for(var o=s(this._variationIds.values()),i=o.next();!i.done;i=o.next()){var a=i.value;if(a)try{for(var c=s(a),l=c.next();!l.done;l=c.next()){var u=l.value;this._drawingIdCounter=Math.max(parseInt(u),this._drawingIdCounter)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype.createDrawingID=function(){for(var e=(++this._drawingIdCounter).toString();e.length<3;)e="0"+e;return e},Object.defineProperty(t.prototype,"maxCachedDrawings",{get:function(){return Math.max(h.default.isLowEndDevice?this._lowEndMaxCachedDrawings:this._maxCachedDrawings,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheNode",{get:function(){return cc.isValid(this._cacheNode,!0)||(this._cacheNode=this.node.getChildByName("Drawing Cache")),this._cacheNode||(this._cacheNode=new cc.Node("Drawing Cache"),this._cacheNode.setParent(this.node),this._cacheNode.active=!1),this._cacheNode},enumerable:!0,configurable:!0}),t.prototype.setCachedDrawing=function(e,t){if(!(this.maxCachedDrawings<=0)){var n=this.cacheNode.getChildByName(t);n&&n.destroy(),e.node.name=t,e.node.setPosition(0,0),e.node.setContentSize(0,0),e.node.angle=0,e.node.opacity=255,e.node.skewX=0,e.node.skewY=0,e.node.color=cc.Color.WHITE,e.node.setParent(this.cacheNode),this.deleteExtraneousCachedDrawings(e)}},t.prototype.getCachedDrawing=function(e){var t=this.cacheNode.getChildByName(e);return cc.isValid(t,!0)?t.getComponent(y.default):null},t.prototype.deleteCachedDrawing=function(e){var t=this.cacheNode.getChildByName(e);t&&t.destroy()},t.prototype.deleteExtraneousCachedDrawings=function(e){var t=this.cacheNode.children.filter(function(t){return cc.isValid(t,!0)&&t!==e.node});for(t.sort(function(e,t){return parseInt(e.name)>parseInt(t.name)?1:-1});t.length+1>this.maxCachedDrawings;){var n=t.shift();cc.warn("Number of cached drawings exceeded maximum of "+this.maxCachedDrawings+". Drawing "+n.name+" has been removed."),n.destroy()}},t.prototype.deserializeDrawing=function(e){return i(this,void 0,Promise,function(){var t,n;return a(this,function(r){switch(r.label){case 0:return[4,h.default.storage.get("drawing-data",e)];case 1:return O(t=r.sent())?[4,y.default.deserialize(t)]:(cc.warn("Invalid drawing data was stored for drawing "+e),[2,null]);case 2:return(n=r.sent())&&this.setCachedDrawing(n,e),[2,n]}})})},t.prototype.serializeDrawing=function(e,t,n){return i(this,void 0,Promise,function(){var r,o,i,s,c;return a(this,function(a){switch(a.label){case 0:return r=h.default.storage,o={storageKey:n},[4,e.serialize()];case 1:i=a.sent(),s=0,a.label=2;case 2:if(!(s<3))return[3,11];a.label=3;case 3:return a.trys.push([3,6,,10]),[4,r.set("drawing-meta",t,o)];case 4:return a.sent(),[4,r.set("drawing-data",t,i)];case 5:return a.sent(),[3,11];case 6:return c=a.sent(),"QuotaExceededError"===c.name?[4,this.deleteOldestSerializedDrawing()]:[3,8];case 7:return a.sent(),[3,9];case 8:return[3,11];case 9:return[3,10];case 10:return s++,[3,2];case 11:return[2]}})})},t.prototype.deleteOldestSerializedDrawing=function(){return i(this,void 0,Promise,function(){var e,t,n;return a(this,function(r){switch(r.label){case 0:return[4,h.default.storage.find("drawing-meta")];case 1:return e=r.sent(),t=c(l(e.keys()),1),n=t[0],[4,this.deleteSerializedDrawing(n)];case 2:return r.sent(),cc.warn("deleted oldest serialized drawing to make room for more:",n),[2]}})})},t.prototype.deleteSerializedDrawing=function(e){return i(this,void 0,Promise,function(){var t;return a(this,function(n){switch(n.label){case 0:return[4,(t=h.default.storage).delete("drawing-meta",e)];case 1:return n.sent(),[4,t.delete("drawing-data",e)];case 2:return n.sent(),[2]}})})},o([w({visible:!0,tooltip:"Maximum number of drawings that can exist on the drawing cache node. If this number is exceeded, drawings will be deleted and deleted drawings will have to be deserialized on recall.\n\n",min:1,step:1})],t.prototype,"_maxCachedDrawings",void 0),o([w({visible:!0,tooltip:"Same as Max Cached Drawings, except for low end devices.",min:1,step:1})],t.prototype,"_lowEndMaxCachedDrawings",void 0),t=o([m,S,b("Scribbles And Ink/Drawing/Drawing Storage")],t)}(_.default);n.default=C,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Framework/GameManager":"GameManager","../Util":"index","./Drawing":"Drawing"}],DrawingToolAudio:[function(e,t,n){"use strict";cc._RF.push(t,"574aauEX/NA37UJ4Zivkf4G","DrawingToolAudio");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("./DrawingTool")),l=s(e("../Framework/GameManager")),u=s(e("../Framework/GameComponent")),d=cc._decorator,p=d.menu,f=d.ccclass,h=d.property,y=d.disallowMultiple,v=d.requireComponent,_="Drawing/Audio/";function g(){return this.audioPlayStrategy===n.PlayAudioStrategy.OnEmit}n.PlayAudioStrategy=cc.Enum({OnPress:1,OnMove:2,OnEmit:3});var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.audioClip="",t.audioVolume=1,t.audioPlayStrategy=n.PlayAudioStrategy.OnPress,t.minEmitDelay=.045,t._drawTool=null,t._strokePosition=cc.Vec2.ZERO,t._lastSplatEmitSound=NaN,t._audioId=-1,t.startPlaying=function(e){var n=l.default.assets.getSingleAsset(_+t.audioClip);n&&(t._audioId=cc.audioEngine.play(n,e,t.audioVolume))},t.stopPlaying=function(){cc.audioEngine.stop(t._audioId)},t.pauseLooping=function(){cc.audioEngine.pause(t._audioId)},t.resumeLooping=function(){cc.audioEngine.resume(t._audioId)},t}return r(t,e),Object.defineProperty(t.prototype,"drawTool",{get:function(){if(this._drawTool||(this._drawTool=this.getComponent(c.default)),!this._drawTool)throw new Error("Requires Drawing Tool");return this._drawTool},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return cc.audioEngine.getState(this._audioId)===cc.audioEngine.AudioState.PLAYING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPaused",{get:function(){return cc.audioEngine.getState(this._audioId)===cc.audioEngine.AudioState.PAUSED},enumerable:!0,configurable:!0}),t.prototype.onSceneStart=function(){return i(this,void 0,Promise,function(){var e,t;return a(this,function(n){switch(n.label){case 0:return this.enabled&&this.enabledInHierarchy?(e=l.default.assets,!(t=this.audioClip&&_+this.audioClip)||e.hasSingleAsset(t)?[3,2]:[4,e.loadDynamicAssets(t)]):[2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},t.prototype.start=function(){this._strokePosition=this.drawTool.strokePosition,this.audioClip||(cc.warn(this.node.name+" DrawToolAudio is missing an audio clip."),this.enabled=!1)},t.prototype.update=function(){if(l.default.initialized){if(l.default.drawingUI.currentTool!==this.drawTool)return this.stopPlaying();switch(this.audioPlayStrategy){case n.PlayAudioStrategy.OnPress:this.handlePress();break;case n.PlayAudioStrategy.OnMove:this.handleMove();break;case n.PlayAudioStrategy.OnEmit:this.handleEmit()}}},t.prototype.onDestroy=function(){this.stopPlaying(),l.default.assets.disposeDynamicAssets(_+this.audioClip)},t.prototype.handlePress=function(){var e=this.isPlaying;this.drawTool.isStroking&&!e?this.startPlaying(!0):!this.drawTool.isStroking&&e&&this.stopPlaying()},t.prototype.handleMove=function(){var e=this.isPlaying,t=this.isPaused,n=this.drawTool.isStroking,r=this._strokePosition.equals(this.drawTool.strokePosition);return this._strokePosition=this.drawTool.strokePosition,n?!n||r||e||t?n&&r&&e&&!t?this.pauseLooping():n&&!r&&!e&&t?this.resumeLooping():void 0:this.startPlaying(!0):this.stopPlaying()},t.prototype.handleEmit=function(){var e=this.drawTool.lastSplatEmit;if(!Number.isNaN(e)){var t=1e3*this.minEmitDelay;(Number.isNaN(this._lastSplatEmitSound)||e-this._lastSplatEmitSound>t)&&(this.startPlaying(!1),this._lastSplatEmitSound=e)}},o([h({tooltip:"Audio to play when using the tool is being used."})],t.prototype,"audioClip",void 0),o([h({tooltip:"Audio to play when using the tool is being used.",slide:!0,min:0,max:1})],t.prototype,"audioVolume",void 0),o([h({type:n.PlayAudioStrategy,displayName:"Play Audio When",tooltip:"Determins how the audio will be played.\nOnPress - The sound will play on a loop as long as the tool is being used.\nOnMove - The sound will play on a loop as long as the tool is being used and moving.\nOnEmit - The sound will play once for every splat that is emitted.\n"})],t.prototype,"audioPlayStrategy",void 0),o([h({visible:g,tooltip:"If the play strategy is OnEmit, the minimum amount of time that must pass before.",formerlySerializedAs:"minSecondsBetween"})],t.prototype,"minEmitDelay",void 0),t=o([f,y,v(c.default),p("Scribbles And Ink/Drawing/Drawing Tool Audio")],t)}(u.default);n.default=m,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","../Framework/GameManager":"GameManager","./DrawingTool":"DrawingTool"}],DrawingToolButton:[function(e,t,n){"use strict";cc._RF.push(t,"cf950/mvGFGOJSjWVd41cYx","DrawingToolButton");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../UI/Button")),s=i(e("./DrawingUI")),c=i(e("./DrawingTool")),l=e("../Util"),u=i(e("./DrawingSelectSplatPrefabsButton")),d=cc._decorator,p=d.menu,f=d.ccclass,h=d.property,y=d.disallowMultiple,v=d.requireComponent,_=d.executeInEditMode,g=cc.v2(0,75),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t.applyColor=!1,t.applyOpacity=!0,t.applyScale=!0,t.applySprite=!1,t.applyAnimation=!1,t._interchangableStates=!1,t.duration=1.25,t._tintNode=null,t._selectedScale=1.25,t._deselectedScale=.75,t._deselectedOpacity=255,t.menuOpenPosition=cc.Vec2.ZERO,t._drawingUI=null,t._drawingTool=null,t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"drawingUI",{get:function(){return this._drawingUI||(this._drawingUI=l.getComponentInParents(this.node,s.default)),this._drawingUI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawingTool",{get:function(){if(this._drawingTool||(this._drawingTool=this.getComponent(c.default)),!this._drawingTool)throw new Error(n.name+" must have a "+c.default.name+" component.");return this._drawingTool},enumerable:!0,configurable:!0}),t.prototype.onFocusInEditor=function(){this.ensureSelectHandler()},t.prototype.onLoad=function(){this.ensureSelectHandler(),e.prototype.onLoad.call(this)},t.prototype.start=function(){this.tryPlaceChosenPrefabIcon()},t.prototype.update=function(){if(this.drawingUI){if(this._tintNode&&this._tintNode.color!==this.node.color&&(this._tintNode.color=this.node.color),!(this.node.getNumberOfRunningActions()>0)){var e=!!this.drawingUI&&this.drawingUI.currentTool===this.drawingTool,t=this.enabled?this.hover||e?255:this._deselectedOpacity:0;this.node.opacity!==t&&this.node.runAction(cc.fadeTo(this.duration,t));var n=e?this._selectedScale:this._deselectedScale;this.node.scale!==n&&this.node.runAction(cc.scaleTo(this.duration,n,n));var r=e&&this.drawingUI&&this.drawingUI.toolsHidden?g:this.menuOpenPosition;this.node.position.equals(r)||this.node.runAction(cc.moveTo(this.duration,r).easing(cc.easeQuadraticActionInOut()))}}else this.node.active=!1},t.prototype.setSelectedToolOrOpenMenu=function(e,t){this.drawingUI&&this.drawingUI.enabled&&(this.drawingUI.toolsHidden?this.drawingUI.showTools():this.drawingUI.setCurrentTool(e,t))},t.prototype.ensureSelectHandler=function(){l.ensureEventHandler(this.clickEvents,{target:this.node,handler:"setSelectedToolOrOpenMenu",component:l.nameOfComponent(this)})},t.prototype.tryPlaceChosenPrefabIcon=function(){var e=this.drawingTool.splatPrefabButtons[0];if(e){var t=e.data.getComponent(u.default);t&&t.placeSelectedPrefabVisualizer(this.node)}},o([h({type:cc.Node,visible:!1,override:!0})],t.prototype,"target",void 0),o([h({visible:!1,override:!0})],t.prototype,"applyColor",void 0),o([h({visible:!1,override:!0})],t.prototype,"applyOpacity",void 0),o([h({visible:!1,override:!0})],t.prototype,"applyScale",void 0),o([h({visible:!1,override:!0})],t.prototype,"applySprite",void 0),o([h({visible:!1,override:!0})],t.prototype,"applyAnimation",void 0),o([h({visible:!1,override:!0})],t.prototype,"_interchangableStates",void 0),o([h({visible:!0,override:!0,displayName:"Transition Duration"})],t.prototype,"duration",void 0),o([h({visible:!0,type:cc.Node})],t.prototype,"_tintNode",void 0),o([h({visible:!0})],t.prototype,"_selectedScale",void 0),o([h({})],t.prototype,"_deselectedScale",void 0),o([h({})],t.prototype,"_deselectedOpacity",void 0),o([h({visible:!1})],t.prototype,"menuOpenPosition",void 0),t=n=o([f,y,_,v(c.default),p("Scribbles And Ink/Drawing/Drawing Tool Button")],t)}(a.default);n.default=m,cc._RF.pop()},{"../UI/Button":"Button","../Util":"index","./DrawingSelectSplatPrefabsButton":"DrawingSelectSplatPrefabsButton","./DrawingTool":"DrawingTool","./DrawingUI":"DrawingUI"}],DrawingTool:[function(e,t,n){"use strict";cc._RF.push(t,"aa92766Sa5PI7pq2DZnNaUW","DrawingTool");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("./Drawing")),u=e("../Util"),d=c(e("./DrawingUI")),p=c(e("./DynamicSplat")),f=cc._decorator,h=f.ccclass,y=f.executeInEditMode,v=f.disallowMultiple,_=f.property,g=f.menu;function m(){return this.emitStrategy===n.EmitStrategy.Time}function b(){return this.emitStrategy===n.EmitStrategy.Distance}function w(){return!this.inheritColor}function S(){return this.inheritSize}function O(){return this.inheritSize&&!u.getComponentInParents(this.node,d.default)}function P(){return 0===this.splatPrefabButtons.length}function C(){return 0===this.splatPrefabs.length}n.EmitStrategy=cc.Enum({Distance:0,Time:1}),n.SizeWidget=cc.Enum({Radio:0,Slider:1});function x(e){var t=e.getBoundingBoxToWorld();return(t.width+t.height)/2/2}function R(e,t){var n=("node"in t?t.node:t).convertToWorldSpaceAR(cc.Vec2.ZERO);return e.node.convertToNodeSpaceAR(n)}function k(e,t){if(0===e.length)return t;var n=e.length-1,r=Math.floor(t*n),o=Math.min(r+1,n);if(r===o)return e[r];var i=r/n,a=(t-i)/(o/n-i);return cc.misc.lerp(e[r],e[o],a)}function D(){return cc.color(u.Random.integer(0,256),u.Random.integer(0,256),u.Random.integer(0,256),255)}function A(e){return!!e&&cc.isValid(e.local)}var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.splatPrefabs=[],t.splatPrefabButtons=[],t.inheritColor=!1,t.randomColor=!1,t.inheritSize=!1,t.sizeFactor=.5,t.sizeWidget=n.SizeWidget.Radio,t._sizeMap=[8,16,24],t.emitStrategy=n.EmitStrategy.Distance,t._emitRateMap=[10],t._emitStepMap=[1],t.interpolateGaps=!0,t.angularVariance=0,t.angleFollowsStroke=!1,t.positionalVariance=0,t.scaleVariance=0,t.speedScaleMultiplier=0,t.speedAffectsOpacity=!1,t._minOpacityMap=[255],t._maxOpacityMap=[255],t.getRandomColor=D,t._drawing=null,t._strokeWorld=cc.Vec2.ZERO,t._lastSplatEmit=NaN,t._lastStrokeKey=null,t._timeBeforeNextEmit=0,t}return r(t,e),Object.defineProperty(t.prototype,"sizeMap",{get:function(){return this._sizeMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emitByTime",{get:function(){return this.emitStrategy===n.EmitStrategy.Time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emitByDistance",{get:function(){return this.emitStrategy===n.EmitStrategy.Distance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emitRate",{get:function(){return k(this._emitRateMap,this.sizeFactor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emitStep",{get:function(){return k(this._emitStepMap,this.sizeFactor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minOpacity",{get:function(){return k(this._minOpacityMap,this.sizeFactor)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxOpacity",{get:function(){return k(this._maxOpacityMap,this.sizeFactor)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){this.emitStrategy===n.EmitStrategy.Time&&(this._timeBeforeNextEmit=1/this.emitRate)},t.prototype.update=function(e){this.isStroking&&this.strokeEmitSplats(e)},t.prototype.onDisable=function(){this.isStroking&&this.strokeEnd()},Object.defineProperty(t.prototype,"isStroking",{get:function(){return!!this._drawing},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokePosition",{get:function(){return this._strokeWorld.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastSplatEmit",{get:function(){return this._lastSplatEmit},enumerable:!0,configurable:!0}),t.prototype.strokeStart=function(e,t){this._drawing=e,this._strokeWorld=t,this._lastStrokeKey=null},t.prototype.strokeMove=function(e){this._drawing&&(this._strokeWorld=e)},t.prototype.strokeEnd=function(){this._drawing=null,this._strokeWorld=cc.Vec2.ZERO,this._lastStrokeKey=null},t.prototype.strokeEmitSplats=function(e){if(!this._drawing)throw new Error(u.nameOfComponent(this)+" "+this.node.name+" is not currently stroking.");if(!A(this._lastStrokeKey))return this.emitFirstSplat();var t=this.getNumSplatsToEmit(e);t>0&&this.emitSplats(t)},t.prototype.getInheritedSplatSize=function(){return k(this._sizeMap,this.sizeFactor)},t.prototype.getNumSplatsToEmit=function(e){this.emitByTime&&(this._timeBeforeNextEmit-=e);var t=this.emitByTime?this.getNumTimedSplatsToEmit():this.getNumDistSplatsToEmit();return this.emitByTime&&this._timeBeforeNextEmit<0&&(this._timeBeforeNextEmit=1/this.emitRate),t},t.prototype.getNumDistSplatsToEmit=function(){var e=this._lastStrokeKey,t=this._drawing,n=e.radius,r=t.node.convertToWorldSpaceAR(e.local),o=this._strokeWorld.sub(r).mag();if(!(o-.5*this.positionalVariance>this.emitStep*n))return 0;if(!this.interpolateGaps)return 1;var i=o/n;return Math.round(i/this.emitStep)},t.prototype.getNumTimedSplatsToEmit=function(){if(this._timeBeforeNextEmit>0)return 0;if(!this.interpolateGaps)return 1;var e=Math.abs(this._timeBeforeNextEmit),t=1/this.emitRate;return Math.ceil(e/t)},t.prototype.emitFirstSplat=function(){var e=a(this.createStrokeKey(),2),t=e[0],n=e[1],r=this.createSplat(this._strokeWorld.clone(),t.angle,t.scale,t.opacity);this._lastStrokeKey=o({},t,{local:R(this._drawing,r),radius:x(r.node)}),this.addSplatsToDrawing([r],n),this._lastSplatEmit=Date.now()},t.prototype.emitSplats=function(e){if(!A(this._lastStrokeKey))throw new Error("emitSplats() should not be called until the first stroke keyfor a stroke has been created. Call emitFirstSplat() beforehand.");for(var t=a(this.createStrokeKey(),2),n=t[0],r=t[1],i=this._drawing,s=i.node.convertToWorldSpaceAR(this._lastStrokeKey.local),c=s.clone(),l=[],d=0;d<e;d++){var p=(d+1)/e;s.lerp(this._strokeWorld,p,c);var f=u.lerpAngle(this._lastStrokeKey.angle,n.angle,p),h=cc.misc.lerp(this._lastStrokeKey.scale,n.scale,p),y=cc.misc.lerp(this._lastStrokeKey.opacity,n.opacity,p),v=this.createSplat(c.clone(),f,h,y);l.push(v)}var _=l[l.length-1];this._lastStrokeKey=o({},n,{local:R(i,_),radius:x(_.node)}),this.addSplatsToDrawing(l,r),this._lastSplatEmit=Date.now()},t.prototype.addSplatsToDrawing=function(e,t){var n,r,o=this._drawing,i=[];try{for(var a=s(e),c=a.next();!c.done;c=a.next()){var l=c.value;l.dynamic?l.dynamic.emit(o,t):i.push(l.node)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}o.addSplats(i)},t.prototype.createStrokeKey=function(){var e=this._drawing,t=this._strokeWorld,n=A(this._lastStrokeKey)?t.sub(e.node.convertToWorldSpaceAR(this._lastStrokeKey.local)):cc.Vec2.ZERO,r=n.mag(),o=1+Math.min(r,500)/500*this.speedScaleMultiplier,i=(1+u.Random.float(-this.scaleVariance,this.scaleVariance))*o,a=.5*this.angularVariance,s=(this.angleFollowsStroke?u.angleOfVector(n):0)+u.Random.float(-a,a),c=u.Random.float(this.minOpacity,this.maxOpacity);if(this.speedAffectsOpacity){var l=Math.min(r,250)/250;c=cc.misc.lerp(this.maxOpacity,this.minOpacity,l)}return[{angle:s,opacity:c,scale:i,local:cc.Vec2.ZERO,radius:0},n]},t.prototype.createSplat=function(e,t,n,r){var o=u.Random.item(this.splatPrefabs);if(!o)throw new Error("No splats are defined on DrawingTool "+this.node.name);var i=!!o.data.getComponent(p.default),a=i?cc.instantiate(o):l.default.useSplat(o.name),s=i?a.getComponent(p.default):null;if(this.positionalVariance>0){var c=.5*this.positionalVariance;e.addSelf(u.Random.v2(c))}if(a.setPosition(e),this.inheritColor&&(a.color=this.node.color.clone()),!this.inheritColor&&this.randomColor&&(a.color=this.getRandomColor()),this.inheritSize){var d=this.getInheritedSplatSize();a.setContentSize(d,d)}return a.angle=t,a.scale=n,a.opacity=r,{node:a,dynamic:s}},i([_({type:cc.Prefab,tooltip:"Prefabs placed here will be instanced and placed onto drawing as splats at random.",visible:P,formerlySerializedAs:"prefabs"})],t.prototype,"splatPrefabs",void 0),i([_({type:cc.Prefab,tooltip:"Has Buttons for changing the current selection of splat prefabs.Should not specify more than 3.",visible:C,formerlySerializedAs:"prefabButtons"})],t.prototype,"splatPrefabButtons",void 0),i([_({tooltip:"Will the drawn splats inherit the currently set DrawUI color?"})],t.prototype,"inheritColor",void 0),i([_({tooltip:"Will the drawn splats inherit a random color from the DrawUI?",visible:w})],t.prototype,"randomColor",void 0),i([_({tooltip:"Will the generated splats be scaled according to the drawingUI's current sizeFactor?"})],t.prototype,"inheritSize",void 0),i([_({visible:O,tooltip:"Size factor that will be used if this tool is set to inherit size.\nThis value will be overridden by the value on the DrawingUI, if this tool is set as it's decendent."})],t.prototype,"sizeFactor",void 0),i([_({type:n.SizeWidget,tooltip:"Which Sizing Widget will the tool use in the Drawing UI?",visible:S})],t.prototype,"sizeWidget",void 0),i([_({type:[cc.Integer],tooltip:"Size, in pixels, that the brushes will map to, according to the DrawingUI's currently selected size.\nIf there are only 2 entries, the 'Medium' size will be between the smallest and largest",visible:S})],t.prototype,"_sizeMap",void 0),i([_({type:n.EmitStrategy,tooltip:"Strategy that determines how prefabs are drawn.\n\nTime - While a tool is being pressed, prefabs will be drawn randomly every min to max seconds. Good for making sprays or pattern emitters.\n\nDistance - While a tool is being moved, prefabs will be drawn if the tool moves far enough away. Good for making pencils or brushes.",displayName:"Emit By"})],t.prototype,"emitStrategy",void 0),i([_({type:[cc.Float],tooltip:"Number of splats to be emitted, per second.",visible:m,displayName:"Emit Rate Map",step:.01,min:.01,max:1e3})],t.prototype,"_emitRateMap",void 0),i([_({type:[cc.Float],tooltip:"Distance from the last prefab, in multiples of prefab radius, before a prefab can be emitted.",visible:b,displayName:"Emit Step Map",min:.01,max:3,step:.01})],t.prototype,"_emitStepMap",void 0),i([_({tooltip:"If true multiple splats will be formed during quick movements to connect splats together, giving the appearance of lines. Good for pencils or brushes."})],t.prototype,"interpolateGaps",void 0),i([_({tooltip:"Random rotational variation, in degrees, given to prefabs as they are being drawn.",min:0,max:180,slide:!0})],t.prototype,"angularVariance",void 0),i([_({tooltip:"If enabled, the splat will be angled according to the direction of the stroke."})],t.prototype,"angleFollowsStroke",void 0),i([_({tooltip:"Random positional variation, in pixels, given to prefabs from the center of where they are being drawn.",min:0,max:50,slide:!0})],t.prototype,"positionalVariance",void 0),i([_({tooltip:"Random scale variation given to prefabs as they are being drawn.",min:0,max:1,slide:!0})],t.prototype,"scaleVariance",void 0),i([_({tooltip:"Factor by which the speed of the tool being used will affect the scale of the prefab being drawn.",min:0,max:5,step:.01,slide:!0})],t.prototype,"speedScaleMultiplier",void 0),i([_({tooltip:"Opacity will be determined by speed, faster values resulting in lower opacity. If disabled, opacity will be random."})],t.prototype,"speedAffectsOpacity",void 0),i([_({type:cc.Integer,tooltip:"Minimum opacity for a prefab to be assigned when being drawn.",displayName:"Min Opacity Map",visible:!0,step:1,min:0,max:255})],t.prototype,"_minOpacityMap",void 0),i([_({type:cc.Integer,tooltip:"Maximum opacity for a prefab to be assigned when being drawn.",displayName:"Max Opacity Map",visible:!0,step:1,min:0,max:255})],t.prototype,"_maxOpacityMap",void 0),t=i([h,v,y,g("Scribbles And Ink/Drawing/Drawing Tool")],t)}(cc.Component);n.default=E,cc._RF.pop()},{"../Util":"index","./Drawing":"Drawing","./DrawingUI":"DrawingUI","./DynamicSplat":"DynamicSplat"}],DrawingUIConfig:[function(e,t,n){"use strict";cc._RF.push(t,"204a12p+AdIprGvUjmKLnSy","DrawingUIConfig");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Framework/GameComponent")),s=e("./DrawingStorage"),c=cc._decorator,l=c.ccclass,u=c.property;function d(){return this.variationStrategy===s.SaveVariation.Specific}var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._touchSurface=null,t.storageKey="Studio",t.variationStrategy=s.SaveVariation.Latest,t.variation=0,t._onConfirm=[],t._onClear=[],t}return r(t,e),o([u({type:cc.Node,tooltip:"This is the node that will receive the DrawingUI's touch events. A touch surface is necessary if the drawing area is intended to be restricted or obscured.If left null, the DrawingUI will use it's own node as a touch surface.",visible:!0})],t.prototype,"_touchSurface",void 0),o([u()],t.prototype,"storageKey",void 0),o([u({type:cc.Enum(s.SaveVariation),displayName:"Save Variation"})],t.prototype,"variationStrategy",void 0),o([u({visible:d,min:0,step:1})],t.prototype,"variation",void 0),o([u({tooltip:"Actions that will be carried out when the Confirm button is clicked.\n\nIf empty, the Confirm button will not be shown.",type:cc.Component.EventHandler,visible:!0})],t.prototype,"_onConfirm",void 0),o([u({tooltip:"Actions that will be carried out when the Clear button is clicked.\n\nIf empty, the Clear button will not be shown.",type:cc.Component.EventHandler,visible:!0})],t.prototype,"_onClear",void 0),t=o([l],t)}(a.default);n.default=p,cc._RF.pop()},{"../Framework/GameComponent":"GameComponent","./DrawingStorage":"DrawingStorage"}],DrawingUIHiddenActivator:[function(e,t,n){"use strict";cc._RF.push(t,"99c4bwJ3wJOYaUiNqSI7jZ5","DrawingUIHiddenActivator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Generic/Activator")),s=i(e("../Framework/GameManager")),c=cc._decorator,l=c.ccclass,u=c.property,d=c.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isHidden=!0,t.isHiddenTemporarilyWhileDrawing=!0,t}return r(t,e),t.prototype.determineActive=function(){return!s.default.initialized||(s.default.drawingUI.hidden&&this.isHidden||s.default.drawingUI.hiddenWhileDrawing&&this.isHiddenTemporarilyWhileDrawing)},o([u()],t.prototype,"isHidden",void 0),o([u()],t.prototype,"isHiddenTemporarilyWhileDrawing",void 0),t=o([l,d("Scribbles And Ink/Drawing/Drawing UI Hidden Activator")],t)}(a.default);n.default=p,cc._RF.pop()},{"../Framework/GameManager":"GameManager","../Generic/Activator":"Activator"}],DrawingUIOverride:[function(e,t,n){"use strict";cc._RF.push(t,"1e7c6KrxVRDSpcxG/ppaLOH","DrawingUIOverride");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./DrawingUIConfig")),c=a(e("../Framework/GameManager")),l=a(e("./DrawingTool")),u=a(e("./DrawingToolButton")),d=a(e("../Framework/ContentLoader")),p=cc._decorator,f=p.ccclass,h=p.menu,y=p.property,v=p.disallowMultiple,_=p.executeInEditMode,g=function(){return function(e){this.onClear=e.onClear,this.onConfirm=e.onConfirm,this.storageKey=e.storageKey,this.touchSurface=e.touchSurface,this.variationStrategy=e.variationStrategy,this.variation=e.variation}}(),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._autoOverride=!0,t._savedConfig=null,t}return r(t,e),Object.defineProperty(t.prototype,"overridden",{get:function(){return!!this._savedConfig},enumerable:!0,configurable:!0}),t.prototype.override=function(){if(this._savedConfig)return cc.warn("DrawingUI is already overridden");var e=c.default.drawingUI;this._savedConfig=new g(e),e.storageKey=this.storageKey,e.setTouchSurface(this._touchSurface),e.onClear=this._onClear,e.onConfirm=this._onConfirm,e.variationStrategy=this.variationStrategy,e.variation=this.variation,this.switchTools()},t.prototype.reset=function(){if(!this._savedConfig)return cc.warn("DrawingUI is already not overridden");var e=c.default.drawingUI,t=this._savedConfig;this._savedConfig=null,e.storageKey=t.storageKey,e.setTouchSurface(t.touchSurface),e.variationStrategy=t.variationStrategy,e.variation=t.variation,e.onClear=t.onClear,e.onConfirm=t.onConfirm,this.switchTools()},t.prototype.saveDrawing=function(e){return c.default.drawingUI.saveDrawing(e)},t.prototype.clearDrawing=function(){return c.default.drawingUI.clearDrawing()},Object.defineProperty(t.prototype,"touchSurface",{get:function(){return this._touchSurface},set:function(e){this._touchSurface=e},enumerable:!0,configurable:!0}),t.prototype.onGameStart=function(){this._autoOverride&&this.override()},t.prototype.onSceneEnd=function(){this.overridden&&this.reset()},t.prototype.onDestroy=function(){this.overridden&&this.reset()},t.prototype.switchTools=function(){var e,t,n=c.default.drawingUI;this.getComponentsInChildren(d.default).filter(function(e){return e.autoInstance&&0===e.instances.length}).forEach(function(e){e.autoInstance=!1,e.createInstances()});try{for(var r=i(this.getComponentsInChildren(l.default)),o=r.next();!o.done;o=r.next()){var a=o.value,s=this.switchTool(a,n.tools);s&&(n.currentTool===s&&n.setCurrentTool(a),a.node.active=!0,s.node.active=!1)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.switchTool=function(e,t){var n=t.reduce(function(t,n,r){return n.node.name===e.node.name?r:t},-1);if(n<0)return cc.warn("Could not find tool named",e.node.name+":","tools can only be replaced, not added."),null;var r=t[n],o=e.node.parent,i=e.node.getSiblingIndex(),a=e.node.position.clone();e.node.setParent(r.node.parent),e.node.setSiblingIndex(r.node.getSiblingIndex()),e.node.setPosition(r.node.position);var s=e.getComponent(u.default),c=r.getComponent(u.default);return s&&c&&s.menuOpenPosition.set(c.menuOpenPosition),t.splice(n,1,e),r.node.setParent(o),r.node.setSiblingIndex(i),r.node.setPosition(a),r},o([y({visible:!0})],t.prototype,"_autoOverride",void 0),t=o([f,_,v,h("Scribbles And Ink/Drawing/Drawing UI Override")],t)}(s.default);n.default=m,cc._RF.pop()},{"../Framework/ContentLoader":"ContentLoader","../Framework/GameManager":"GameManager","./DrawingTool":"DrawingTool","./DrawingToolButton":"DrawingToolButton","./DrawingUIConfig":"DrawingUIConfig"}],DrawingUI:[function(e,t,n){"use strict";cc._RF.push(t,"a6ad3hSTJBISJ9rHxqgpwdL","DrawingUI");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var f=d(e("./DrawingTool")),h=d(e("./Drawing")),y=p(e("./DrawingHandler")),v=p(e("../Framework/GameManager")),_=p(e("../UI/Button")),g=e("../Util"),m=p(e("../Util/isUnsetOrInPrefabMode")),b=p(e("./DrawingUIConfig")),w=e("../constants"),S=p(e("./DrawingSelectSplatPrefabsButton")),O=p(e("../Scene/Studio/Room")),P=cc._decorator,C=P.ccclass,x=P.menu,R=P.property,k=P.disallowMultiple,D=P.executeInEditMode,A="Background",E="Outline";function I(e){return(e=e.toLowerCase()).includes("small")?0:e.includes("medium")?.5:1}function M(e){return e<1/3?0:e>2/3?1:.5}function T(e){var t=e.getChildByName(A);if(!t)throw new Error("Color node "+e.name+" missing background node.");return t.color}function j(e,t,n){var r,o;e.clickEvents=[],e.node.active=t.length>0,e.node.active&&n&&g.ensureEventHandler(e.clickEvents,{target:e.node,component:g.nameOfComponent(e),handler:"playSound",customEventData:n});try{for(var i=c(t),a=i.next();!a.done;a=i.next()){var s=a.value;e.clickEvents.push(s)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}function F(e,t,n){var r=t.getComponent(cc.Animation);if(!r)throw new Error("Could not find "+t.name+" with an animation component.");var o=r.getClips().find(function(t){return t.name.toLowerCase().includes(e)});if(!o)throw new Error("Could not play "+e+" animation on "+t.name+"; Animation missing.");if(r.play(o.name,n?o.duration:0),!n)return new Promise(function(e){return r.once(cc.Animation.EventType.FINISHED,e)})}function N(e){var t=e.children.reduce(function(e,t){return e||t.getChildByName(E)},null);if(!t)throw new Error("Could not find "+E+" node as a descendent of "+e.name+" buttons.");return t}function B(e,t,n){var r,o,i=.5*n;e.stopAllActions();try{for(var a=c(e.children),s=a.next();!s.done;s=a.next()){var l=s.value,u=g.Random.float(0,i),d=t?1:1/32;l.stopAllActions(),l.runAction(cc.sequence(cc.delayTime(u),cc.scaleTo(i,d)))}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}t?(e.active=!0,e.runAction(cc.sequence(cc.delayTime(n),cc.callFunc(function(){return e.getComponentsInChildren(cc.Widget).forEach(function(e){return e.updateAlignment()})})))):e.runAction(cc.sequence(cc.delayTime(n),cc.callFunc(function(){e.active=!1})))}function U(e,t,n){var r=.5*n;e.stopAllActions();var o=function(){t&&(e.setParent(t),e.setSiblingIndex(0),e.setContentSize(t.getContentSize()))};e.activeInHierarchy&&t?e.runAction(cc.sequence(cc.scaleTo(r,.75,.75),cc.callFunc(o),cc.scaleTo(r,1,1))):e.activeInHierarchy&&!t?e.runAction(cc.scaleTo(r,.75,.75)):!e.activeInHierarchy&&t?(e.setScale(1,1),o()):e.activeInHierarchy||t||e.setScale(.75,.75)}function L(e,t,n){var r=g.Random.float(0,n);e.stopAllActions(),e.runAction(cc.sequence(cc.delayTime(r),cc.callFunc(function(){e.color=t})))}function z(){var e;return v.default.currentStoryName?v.default.currentStoryName:(e=g.getComponentInScene(O.default))?e.node.name:v.default.currentSceneName}var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.serializeOnSave=!0,t._drawHideDelay=.4,t._hidden=!1,t._actionDurationRange=.2,t._tools=null,t._canvas=null,t._touchCamera=null,t.toolsMenuNode=null,t.sizeRadioOptionsNode=null,t.sizeSliderOptionsNode=null,t.colorOptionsNode=null,t.splatOptionsNode=null,t.clearButton=null,t.confirmButton=null,t.openToolsButton=null,t.closeToolsButton=null,t._currentTool=null,t._currentDrawing=null,t._color=cc.Color.BLACK,t._sizeFactor=0,t._toolsHidden=!0,t._unsavedChanges=!1,t._touchEventsApplied=!1,t._drawTempHideTimeBuffer=0,t._drawTempHidden=!1,t._drawHandlers=[],t.onCanvasHover=function(e){cc.isValid(t)&&(!(1===(e.buttons||e.which))&&t.currentTool.isStroking&&t.onTouchEnd())},t.getRandomColor=function(){var e=t.getColors();return e[g.Random.index(e)]},t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"hidden",{get:function(){return this._hidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onConfirm",{get:function(){return this._onConfirm},set:function(e){this._onConfirm=u(e),j(this.confirmButton,this._onConfirm,"OptionClick")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{get:function(){return this._onClear},set:function(e){this._onClear=u(e),j(this.clearButton,this._onClear,"Garbage")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tools",{get:function(){if(this._tools||(this._tools=this.getComponentsInChildren(f.default)),0===this._tools.length)throw new Error("Could not find any tools in the "+g.nameOfComponent(this)+". Ensure that the prefab is not corrupt.");return this._tools},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas||(this._canvas=g.getComponentInParents(this.node,cc.Canvas)),this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchCamera",{get:function(){return cc.isValid(this._touchCamera)||(this._touchCamera=g.getComponentInParents(this.touchSurface,cc.Camera)||v.default.mainCamera),this._touchCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTool",{get:function(){return cc.isValid(this._currentTool,!0)||this.setRandomTool(),this._currentTool},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDrawing",{get:function(){return this._currentDrawing},set:function(e){this._currentDrawing=e,this._unsavedChanges=!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sizeFactor",{get:function(){return this._sizeFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toolsHidden",{get:function(){return this._toolsHidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unsavedChanges",{get:function(){return this._unsavedChanges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hiddenWhileDrawing",{get:function(){return!this._hidden&&this._drawTempHidden},enumerable:!0,configurable:!0}),t.prototype.onFocusInEditor=function(){var e,t,n,r,o,i;this.validateEditorReferences(),g.ensureEventHandler(this.openToolsButton,{target:this.openToolsButton.node,component:g.nameOfComponent(this.openToolsButton),handler:"playSound",customEventData:"OptionClick"}),g.ensureEventHandler(this.openToolsButton,{target:this.node,component:g.nameOfComponent(this),handler:"showTools"}),g.ensureEventHandler(this.closeToolsButton,{target:this.closeToolsButton.node,component:g.nameOfComponent(this.closeToolsButton),handler:"playSound",customEventData:"OptionClick"}),g.ensureEventHandler(this.closeToolsButton,{target:this.node,component:g.nameOfComponent(this),handler:"hideTools"});try{for(var a=c(u(this.colorOptionsNode.children,this.sizeRadioOptionsNode.children)),s=a.next();!s.done;s=a.next()){var l=s.value,d=l.getComponent(cc.Button);d&&d.destroy(),l.getComponent(_.default)||l.addComponent(_.default)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}try{for(var p=c(this.sizeRadioOptionsNode.getComponentsInChildren(_.default)),f=p.next();!f.done;f=p.next()){var h=f.value;g.ensureEventHandler(h,{target:h.node,component:g.nameOfComponent(h),handler:"playSound",customEventData:"OptionClick"}),g.ensureEventHandler(h,{target:this.node,component:g.nameOfComponent(this),handler:"setSizeFactor"})}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}try{for(var y=c(this.colorOptionsNode.getComponentsInChildren(_.default)),v=y.next();!v.done;v=y.next()){h=v.value;g.ensureEventHandler(h,{target:h.node,component:g.nameOfComponent(h),handler:"playSound",customEventData:"OptionClick"}),g.ensureEventHandler(h,{target:this.node,component:g.nameOfComponent(this),handler:"setColor"})}}catch(e){o={error:e}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(o)throw o.error}}},t.prototype.validateEditorReferences=function(){var e,t;try{for(var n=c(["toolsMenuNode","sizeRadioOptionsNode","sizeSliderOptionsNode","colorOptionsNode","splatOptionsNode","clearButton","confirmButton","openToolsButton","closeToolsButton"]),r=n.next();!r.done;r=n.next()){var o=r.value;if(!cc.isValid(this[o],!0))throw new Error("Reference to '"+o+"' is missing. Ensure that the "+g.nameOfComponent(this)+" prefab is not corrupt.")}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.onRegisterStores=function(){return[w.UI_STORE_KEY]},t.prototype.onGameStart=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return j(this.confirmButton,this._onConfirm,"OptionClick"),j(this.clearButton,this._onClear,"Garbage"),[4,this.restoreUserState()];case 1:return e.sent(),this._hidden||F("show",this.node,!1),[2]}})})},t.prototype.onLoad=function(){F("hide",this.node,!0),this.enabled||this.onDisable(),this===g.getComponentsInScene(n)[0]?cc.game.canvas.addEventListener("mouseenter",this.onCanvasHover):(this.node.destroy(),cc.error("Only one instance of the "+g.nameOfComponent(this)+" should ever exist."))},t.prototype.onEnable=function(){var e,t;this.clearButton.enabled=!0,this.confirmButton.enabled=!0,this.openToolsButton.enabled=!0,this.closeToolsButton.enabled=!0,this.setTouchEventsEnabled(!0);try{for(var n=c(this.getEnabledDrawHandlers(!0)),r=n.next();!r.done;r=n.next()){r.value.onDrawEnabled()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.onDisable=function(){var e,t;this.clearButton.enabled=!1,this.confirmButton.enabled=!1,this.openToolsButton.enabled=!1,this.closeToolsButton.enabled=!1,this.toolsHidden||this.hideTools(),this.setTouchEventsEnabled(!1);try{for(var n=c(this.getEnabledDrawHandlers(!0)),r=n.next();!r.done;r=n.next()){r.value.onDrawDisabled()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.update=function(e){if(cc.isValid(this._currentDrawing)||(this.enabled=!1),cc.isValid(this._touchSurface,!0)||this._touchSurface===this.node||(this.touchSurface=this.node),!this.hidden){var t=this.currentTool.isStroking?1:-.5;this._drawTempHideTimeBuffer=cc.misc.clampf(this._drawTempHideTimeBuffer+e*t,0,this._drawHideDelay),this._drawTempHideTimeBuffer>=this._drawHideDelay&&!this._drawTempHidden?(this._drawTempHidden=!0,F("hide",this.node,!1)):this._drawTempHideTimeBuffer<=0&&this._drawTempHidden&&(this._drawTempHidden=!1,F("show",this.node,!1))}},t.prototype.onDestroy=function(){cc.game.canvas.removeEventListener("mouseenter",this.onCanvasHover),this.setTouchEventsEnabled(!1)},t.prototype.getTouchWorldPosition=function(e){var t=e.getLocation();return this.touchCamera.getCameraToWorldPoint(t,cc.Vec2.ZERO)},t.prototype.onTouchStart=function(e){var t,n;if(this.currentTool.enabled){var r=this.getTouchWorldPosition(e);if(this.toolsHidden||this.hideTools(),!this.currentDrawing)throw new Error("Cannot start drawing without the "+g.nameOfComponent(this)+" being focused on a drawing.");this.currentTool.strokeStart(this.currentDrawing,r),this._unsavedChanges=!0;try{for(var o=c(this.getEnabledDrawHandlers(!0)),i=o.next();!i.done;i=o.next()){i.value.onStrokeStart(r)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}v.default.analytics.updateUITimestamp()}},t.prototype.onTouchMove=function(e){var t,n;if(this.currentTool.enabled){var r=this.getTouchWorldPosition(e);this.currentTool.strokeMove(r);try{for(var o=c(this.getEnabledDrawHandlers(!1)),i=o.next();!i.done;i=o.next()){i.value.onStrokeMove(r)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}v.default.analytics.updateUITimestamp()}},t.prototype.onTouchEnd=function(){var e,t;if(this.currentTool.enabled){this.currentTool.strokeEnd();try{for(var n=c(this.getEnabledDrawHandlers(!1)),r=n.next();!r.done;r=n.next()){r.value.onStrokeEnd()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}v.default.analytics.updateUITimestamp()}},t.prototype.onTouchCancel=function(){var e,t;if(this.currentTool.enabled){this.currentTool.strokeEnd();try{for(var n=c(this.getEnabledDrawHandlers(!0)),r=n.next();!r.done;r=n.next()){r.value.onStrokeEnd()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}v.default.analytics.updateUITimestamp()}},t.prototype.saveDrawing=function(e){return void 0===e&&(e=null),a(this,void 0,Promise,function(){var t,n,r,i,a,l,u,d,p;return s(this,function(s){switch(s.label){case 0:return this.currentDrawing&&this.storageKey?(r=Date.now(),this.hideTools(),this.enabled=!1,i="boolean"==typeof e?e:this.serializeOnSave,[4,v.default.drawingStorage.storeDrawing({storageKey:this.storageKey,drawing:this.currentDrawing.copy(),serialize:i,variation:this.variation,variationStrategy:this.variationStrategy})]):[2,-1];case 1:a=s.sent();try{for(l=c(this.getEnabledDrawHandlers(!0)),u=l.next();!u.done;u=l.next())u.value.onDrawingSave(this.currentDrawing,this.storageKey)}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return this._unsavedChanges=!1,this.enabled=!0,[4,v.default.analytics.send(o({},w.ANALYTICS.SaveDrawing,{label:z()}))];case 2:return s.sent(),d=Date.now()-r,(p=500-d)>0?[4,new Promise(function(e){return setTimeout(e,p)})]:[3,4];case 3:s.sent(),s.label=4;case 4:return[2,a]}})})},t.prototype.clearDrawing=function(){return a(this,void 0,Promise,function(){var e,t,n,r;return s(this,function(i){switch(i.label){case 0:if(!this.currentDrawing)return[2];this._unsavedChanges=!this.currentDrawing.isEmpty,this.currentDrawing.clear();try{for(n=c(this.getEnabledDrawHandlers(!0)),r=n.next();!r.done;r=n.next())r.value.onDrawingClear(this.currentDrawing,this.storageKey)}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return[4,v.default.analytics.send(o({},w.ANALYTICS.ClearDrawing,{label:this.storageKey}))];case 1:return i.sent(),[2]}})})},t.prototype.hide=function(e){if(!this._hidden)return e="boolean"==typeof e&&e,this.toolsHidden||this.hideTools(e),this._hidden=!0,F("hide",this.node,e)},t.prototype.show=function(e){if(this._hidden)return e="boolean"==typeof e&&e,this._hidden=!1,F("show",this.node,e)},t.prototype.hideTools=function(e){if(!this._toolsHidden)return e="boolean"==typeof e&&e,this._toolsHidden=!0,F("hide",this.toolsMenuNode,e)},t.prototype.showTools=function(e){if(this._toolsHidden)return e="boolean"==typeof e&&e,this._toolsHidden=!1,F("show",this.toolsMenuNode,e)},t.prototype.setColor=function(e){var t,n,r=e instanceof cc.Color?e:T(e.target);U(N(this.colorOptionsNode),this.colorOptionsNode.children.reduce(function(e,t){return T(t).equals(r)?t:e},null),this._actionDurationRange/2);try{for(var o=c(this.tools),i=o.next();!i.done;i=o.next()){var a=i.value;a.inheritColor&&L(a.node,r,this._actionDurationRange)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._color=r,e instanceof cc.Event.EventTouch&&this.saveUserState()},t.prototype.setSizeFactor=function(e,t){var n="number"==typeof e?cc.misc.clamp01(e)||0:e instanceof cc.Slider?e.progress:I(t||e.target.name),r=this.sizeRadioOptionsNode.children.map(function(e){return{node:e,size:e.getChildByName(A).getContentSize().width,factor:I(e.name)}}),o=r[0].size,i=r[r.length-1].size,a=cc.misc.lerp(o,i,n);(this.sizeSliderOptionsNode.getComponentInChildren(cc.Button).node.setContentSize(a,a),e instanceof cc.Slider)?v.default.analytics.updateUITimestamp():this.sizeSliderOptionsNode.getComponentInChildren(cc.Slider).progress=n;var s=r.reduce(function(e,t){return Math.abs(n-t.factor)<Math.abs(n-e.factor)?t:e}).node;U(N(this.sizeRadioOptionsNode),s,this._actionDurationRange/2),this._sizeFactor=n,this.currentTool.inheritSize&&(this.currentTool.sizeFactor=n),(e instanceof cc.Event.EventTouch||e instanceof cc.Slider)&&this.saveUserState()},t.prototype.setCurrentTool=function(e,t){var n=e instanceof cc.Event.EventTouch;if(n){var r=e.target,i=r.getComponent(f.default);if(i)e=i;else{if(!(!i&&t&&t.length>0))throw new Error(r.name+" called .setCurrentToolwithout an attached DrawTool component or customEventData to use as a DrawTool name.");e=t}}if(!e&&t&&(e=t),"string"==typeof e){var a=this.tools.find(function(t){return t.node.name===e});if(a)e=a;else{var s=this.tools[0];cc.warn("Could not find DrawTool named "+e+", settingto "+s.node.name+" "),e=s}}var c=e;if(c!==this._currentTool){if(B(this.sizeRadioOptionsNode,c.inheritSize&&c.sizeWidget===f.SizeWidget.Radio,this._actionDurationRange),B(this.sizeSliderOptionsNode,c.inheritSize&&c.sizeWidget===f.SizeWidget.Slider,this._actionDurationRange),B(this.colorOptionsNode,c.inheritColor,this._actionDurationRange),B(this.splatOptionsNode,c.splatPrefabButtons.length>0,this._actionDurationRange),c.inheritSize&&c.sizeWidget===f.SizeWidget.Radio){var l=M(this.sizeFactor);l!==this.sizeFactor&&this.setSizeFactor(l)}if(this._hidden||cc.log("using","drawtool",c.node.name),c.inheritSize&&(c.sizeFactor=this.sizeFactor),c.inheritColor&&(c.node.color=this.color),c.randomColor&&(c.getRandomColor=this.getRandomColor),this._currentTool=e,c.splatPrefabButtons.length>0&&this.createPrefabButtonsForCurrentTool(),n){this.saveUserState();var u=this._currentTool.node.name;v.default.analytics.send(o({},w.ANALYTICS.UseToolInScene,{label:u+"|"+z()})),v.default.analytics.send(o({},w.ANALYTICS.UseTool,{label:u}))}}},t.prototype.getColors=function(){return this.colorOptionsNode.children.map(T)},t.prototype.createNewDrawing=function(e,t){void 0===e&&(e=v.default.isLowEndDevice?64:128),void 0===t&&(t=v.default.storage.usingLocalStorage?h.SerializeStrategy.Splats:h.SerializeStrategy.Raster);var n=v.default.isLowEndDevice?2:1,r=h.default.create(this.storageKey,e,t);return r.node.setParent(this.touchSurface.parent),r.node.setSiblingIndex(this.touchSurface.getSiblingIndex()),r.node.setPosition(this.touchSurface.position),r.node.angle=this.touchSurface.angle,r.node.scale=n,this.currentDrawing=r,r},Object.defineProperty(t.prototype,"touchSurface",{get:function(){return cc.isValid(this._touchSurface)?this._touchSurface:this.node},set:function(e){this.setTouchSurface(e)},enumerable:!0,configurable:!0}),t.prototype.setTouchSurface=function(e){var t=this._touchEventsApplied;this._touchEventsApplied&&this.setTouchEventsEnabled(!1),this._touchSurface=e,this._touchCamera=null,t&&this.setTouchEventsEnabled(!0)},t.prototype.setRandomTool=function(e){void 0===e&&(e=!0);var t=this._actionDurationRange;e||(this._actionDurationRange=0);var n=this.tools.filter(function(e){return"Eraser"!==e.node.name&&"ActionBrush"!==e.node.name});this.setCurrentTool(g.Random.item(n));var r=this.getColors();this.setColor(g.Random.item(r)),this.setSizeFactor(.5),this._actionDurationRange=t},t.prototype.createPrefabButtonsForCurrentTool=function(){for(var e=this.currentTool.splatPrefabButtons,t=u(this.splatOptionsNode.children),n=0;n<t.length;n++){var r=t[n],o=e[n];if(r.removeAllChildren(),o){var i=cc.instantiate(o);if(i.setPosition(cc.Vec2.ZERO),r.addChild(i),0===n){var a=i.getComponent(S.default);a&&a.assignPrefabsToCurrentTool()}}}},t.prototype.getEnabledDrawHandlers=function(e){return void 0===e&&(e=0===this._drawHandlers.length),e&&(this._drawHandlers=g.getComponentsInScene(y.default)),this._drawHandlers.filter(function(e){return cc.isValid(e,!0)&&e.enabled&&e.enabledInHierarchy})},t.prototype.restoreUserState=function(){return a(this,void 0,Promise,function(){var e,t,n,r,o;return s(this,function(i){switch(i.label){case 0:return[4,v.default.storage.get(w.UI_STORE_KEY,this.node.name)];case 1:return(e=i.sent())&&"object"==typeof e||(e={}),n=(t=e).color&&"object"==typeof t.color?cc.Color.prototype.clone.call(t.color):this.getRandomColor(),this.getColors().some(function(e){return e.equals(n)})||(n=this.getRandomColor()),r="number"==typeof t.sizeFactor?t.sizeFactor:1,o=t.tool?t.tool:this.currentTool,this.setColor(n),this.setSizeFactor(r),this.setCurrentTool(o),[4,g.asyncSchedule(this,this._actionDurationRange)];case 2:return i.sent(),[2]}})})},t.prototype.saveUserState=function(){var e={color:this.color,sizeFactor:this.sizeFactor,tool:this.currentTool.node.name};return v.default.storage.set(w.UI_STORE_KEY,this.node.name,e)},t.prototype.setTouchEventsEnabled=function(e){if(e!==this._touchEventsApplied){var t=cc.Node.EventType,n=t.TOUCH_CANCEL,r=t.TOUCH_END,o=t.TOUCH_MOVE,i=t.TOUCH_START;this._touchEventsApplied=e;var a=e?"on":"off";this.touchSurface[a](r.toString(),this.onTouchEnd,this),this.touchSurface[a](o.toString(),this.onTouchMove,this),this.touchSurface[a](i.toString(),this.onTouchStart,this),this.touchSurface[a](n.toString(),this.onTouchCancel,this),cc.game.setCanvasScrollable(!e)}},i([R({tooltip:"When saving, the drawing will also be serialized to the database.",displayName:"Store on Save"})],t.prototype,"serializeOnSave",void 0),i([R({tooltip:"Amount of time a draw tool needs to be pressed before hiding buttons as a convenience feature.",step:.1,min:.1,max:2,slide:!0,visible:!0})],t.prototype,"_drawHideDelay",void 0),i([R({visible:!0})],t.prototype,"_hidden",void 0),i([R({tooltip:"Amount of time for animated accents to complete:\n\n - Tools visually adopting new colors\n - Color options being hidden or shown\n - Size options being hidden or shown",displayName:"Action Duration",visible:!0,slide:!0,min:0,max:1})],t.prototype,"_actionDurationRange",void 0),i([R({type:cc.Node,visible:m.default("toolMenuNode")})],t.prototype,"toolsMenuNode",void 0),i([R({type:cc.Node,visible:m.default("sizeRadioOptionsNode")})],t.prototype,"sizeRadioOptionsNode",void 0),i([R({type:cc.Node,visible:m.default("sizeSliderOptionsNode")})],t.prototype,"sizeSliderOptionsNode",void 0),i([R({type:cc.Node,visible:m.default("colorOptionsNode")})],t.prototype,"colorOptionsNode",void 0),i([R({type:cc.Node,visible:m.default("splatOptionsNode")})],t.prototype,"splatOptionsNode",void 0),i([R({type:_.default,visible:m.default("clearButton")})],t.prototype,"clearButton",void 0),i([R({type:_.default,visible:m.default("confirmButton")})],t.prototype,"confirmButton",void 0),i([R({type:_.default,visible:m.default("openToolsButton")})],t.prototype,"openToolsButton",void 0),i([R({type:_.default,visible:m.default("closeToolsButton")})],t.prototype,"closeToolsButton",void 0),t=n=i([C,D,k,x("Scribbles And Ink/Drawing/Drawing UI")],t)}(b.default);n.default=V,cc._RF.pop()},{"../Framework/GameManager":"GameManager","../Scene/Studio/Room":"Room","../UI/Button":"Button","../Util":"index","../Util/isUnsetOrInPrefabMode":"isUnsetOrInPrefabMode","../constants":"constants","./Drawing":"Drawing","./DrawingHandler":"DrawingHandler","./DrawingSelectSplatPrefabsButton":"DrawingSelectSplatPrefabsButton","./DrawingTool":"DrawingTool","./DrawingUIConfig":"DrawingUIConfig"}],Drawing:[function(e,t,n){"use strict";cc._RF.push(t,"5095enfv1BFFrP2uEdqZTxg","Drawing");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var p,f=d(e("../Framework/GameManager")),h=e("../Util"),y=e("../constants"),v=cc._decorator,_=v.ccclass,g=v.menu,m=v.disallowMultiple,b=1.25*y.ONE_FRAME,w=2*y.ONE_FRAME;function S(e){var t=e.clone();return t.setA(0),t}function O(e,t){for(var n=[],r=0;r<=e;r+=t)n.push(r),0!==r&&n.push(-r);return n.push(e,-e),n}function P(e){return e.x+","+e.y}function C(e){var t=e.opacity,n=e.scaleX,r=e.scaleY,o=e.height,i=e.width,a=e.position,s=e.angle,c=e.color,l=e.skewX,u=e.skewY;return{prefab:e.name,position:a,scale:{x:n,y:r},skew:{x:l,y:u},color:{_val:c._val},opacity:t,angle:s,width:i,height:o}}(function(e){e[e.Raster=0]="Raster",e[e.Splats=1]="Splats"})(p=n.SerializeStrategy||(n.SerializeStrategy={}));var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._texturesNode=null,t._splatsNode=null,t._texCellsRequiringDensityCheck=[],t._textureResolution=void 0,t._serializeStrategy=void 0,t._texCells=new Map,t._splatData=null,t._size=cc.Size.ZERO,t._center=cc.Vec2.ZERO,t._centerOfOpacity=cc.Vec2.ZERO,t._deserializing=!1,t._boundsNeedCalculating=!1,t}var n;return r(t,e),n=t,t.getSplatPrefab=function(e){var t="Drawing/Splats/"+e,n=f.default.assets.getStaticAssets(t)[t];if(!n)throw new Error("No such splat: "+e+" ensure all possible splats are placed in the Drawing/Splats asset path.");return n},t.useSplat=function(e){var t,n=this._splatPools.get(e);if(n||(n=new cc.NodePool,this._splatPools.set(e,n)),n.size()>0)t=n.get();else{var r=this.getSplatPrefab(e);(t=cc.instantiate(r)).name=e}return t},t.releaseSplat=function(e){var t=e.name,n=this._splatPools.get(t);if(!n)throw new Error("Get a splat via Drawing.useSplat before releasing it.");if(n.size()>100)e.setParent(null),e.active=!1,e.destroy();else{var r=this.getSplatPrefab(t);e.color._value=r.data.color._value,e.width=r.data.width,e.height=r.data.height,e.scale=r.data.scale,e.angle=r.data.angle,e.skewX=r.data.skewX,e.skewY=r.data.skewY,e.active=r.data.active,e.opacity=r.data.opacity,n.put(e)}},t.create=function(e,t,r){var o=new cc.Node(e).addComponent(n);return o._textureResolution=t,o._serializeStrategy=r,o._serializeStrategy===p.Splats&&(o._splatData=[]),o},t.deserialize=function(e){return n.create(e.name,e.textureResolution,e.serializeStrategy).deserialize(e)},Object.defineProperty(t,"deserializeRasterMaterial",{get:function(){return this._deserializeRasterMaterial||(this._deserializeRasterMaterial=f.default.assets.getSingleAsset("Drawing/Materials/deserialize-raster-texture-cell")),this._deserializeRasterMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t,"renderCamera",{get:function(){var e=n._renderCamera;if(!e||!cc.isValid(e,!0)){var t=f.default.assets.getSingleAsset("Drawing/DrawingRenderCamera");if(!(e=cc.instantiate(t).getComponent(cc.Camera)))throw new Error("Camera component missing on Render Camera Prefab.\nEnsure that the Render Camera Prefab is not corrupt.");e.node.setParent(cc.director.getScene()),e.enabled=!1,cc.game.addPersistRootNode(e.node),n._renderCamera=e}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texturesNode",{get:function(){return this._texturesNode&&cc.isValid(this._texturesNode)||(this._texturesNode=this.node.getChildByName("Textures")),this._texturesNode||(this._texturesNode=new cc.Node("Textures"),this._texturesNode.setParent(this.node),this._texturesNode.setPosition(0,0),this._texturesNode.setSiblingIndex(0)),this._texturesNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"splatsNode",{get:function(){return this._splatsNode&&cc.isValid(this._splatsNode)||(this._splatsNode=this.node.getChildByName("Splats")),this._splatsNode||(this._splatsNode=new cc.Node("Splats"),this._splatsNode.setParent(this.node),this._splatsNode.setPosition(0,0),this._splatsNode.group="splats"),this._splatsNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureResolution",{get:function(){if(void 0===this._textureResolution)throw new Error("Drawing must be created with a texture resolution.");return this._textureResolution},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serializeStrategy",{get:function(){if(void 0===this._serializeStrategy)throw new Error("Drawing was not created with a serialization strategy.");return this._serializeStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"splatData",{get:function(){if(this.serializeStrategy!==p.Splats)throw new Error("splatData does not exist on a drawing that is not using SerializeStrategy.Splats");return this._splatData||(this._splatData=[]),this._splatData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeserializing",{get:function(){return this._deserializing},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._texCells.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._boundsNeedCalculating&&this.calculateBounds(),this._size.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this._boundsNeedCalculating&&this.calculateBounds(),this._center.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerOfOpacity",{get:function(){return this._boundsNeedCalculating&&this.calculateBounds(),this._centerOfOpacity.clone()},enumerable:!0,configurable:!0}),t.prototype.addSplats=function(e){var t,r,o,i,a,s,c,d;if(this.enabled&&this.enabledInHierarchy){e instanceof cc.Node&&(e=[e]);try{for(var f=u(l(this.splatsNode.children)),h=f.next();!h.done;h=f.next()){var y=h.value;n.releaseSplat(y)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}var v=[];try{for(var _=u(e),g=_.next();!g.done;g=_.next()){var m=(y=g.value).convertToWorldSpaceAR(cc.Vec2.ZERO),b=this.node.convertToNodeSpaceAR(m);y.setParent(this.splatsNode),y.setPosition(b),this.serializeStrategy===p.Splats&&this.splatData.push(C(y)),y.scaleX/=this.node.scaleX,y.scaleY/=this.node.scaleY;var w=this.ensureTexCellsForSplat(y,b);try{for(var S=u(w),O=S.next();!O.done;O=S.next()){var P=O.value;v.includes(P)||v.push(P),this._texCellsRequiringDensityCheck.includes(P)||this._texCellsRequiringDensityCheck.push(P)}}catch(e){a={error:e}}finally{try{O&&!O.done&&(s=S.return)&&s.call(S)}finally{if(a)throw a.error}}}}catch(e){o={error:e}}finally{try{g&&!g.done&&(i=_.return)&&i.call(_)}finally{if(o)throw o.error}}try{for(var x=u(v),R=x.next();!R.done;R=x.next()){P=R.value;this.renderTexCell(P)}}catch(e){c={error:e}}finally{try{R&&!R.done&&(d=x.return)&&d.call(x)}finally{if(c)throw c.error}}}},t.prototype.clear=function(){this.splatsNode.removeAllChildren(),this.texturesNode.removeAllChildren(),this._texCells.clear(),this._splatData&&(this._splatData.length=0),this._boundsNeedCalculating=!0},t.prototype.copy=function(){var e,t;if(this.isDeserializing)throw new Error("Cannot copy a Drawing while it is deserializing.");var r=n.create(this.node.name,this.textureResolution,this.serializeStrategy);r.node.scale=this.node.scale,r._texturesNode=cc.instantiate(this.texturesNode),r._texturesNode.setParent(r.node),r._splatsNode=cc.instantiate(this.splatsNode),r._splatsNode.setParent(r.node),r._size=this.size,r._center=this.center,r._centerOfOpacity=this.centerOfOpacity,this._splatData&&(r._splatData=l(this._splatData));try{for(var o=u(this._texCells.values()),i=o.next();!i.done;i=o.next()){var a=i.value,s=P(a.coord),c=r._texturesNode.getChildByName(s),d={density:a.density,node:c,sprite:c.getComponent(cc.Sprite),coord:a.coord.clone()};r._texCells.set(s,d),this._texCellsRequiringDensityCheck.includes(a)&&r._texCellsRequiringDensityCheck.push(d)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return r},t.prototype.serialize=function(){return this.serializeStrategy===p.Raster?this.serializeRaster():this.serializeSplats()},t.prototype.deserialize=function(e){return a(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return this._deserializing=!0,this.clear(),this.node.scale=e.scale,e.serializeStrategy!==p.Raster?[3,2]:[4,this.deserializeRaster(e)];case 1:return t.sent(),[3,4];case 2:return[4,this.deserializeSplats(e)];case 3:t.sent(),t.label=4;case 4:return this._deserializing=!1,[2,this]}})})},t.prototype.onLoad=function(){if(this.texturesNode.childrenCount!==this._texCells.size)throw this.node.destroy(),new Error("Do not directly instantiate a drawing node. Use Drawing.copy instead.")},t.prototype.update=function(){var e="release-texture-nodes";if(0!==this._texCellsRequiringDensityCheck.length){for(h.chunker.start(e);this._texCellsRequiringDensityCheck.length>0;){var t=this._texCellsRequiringDensityCheck.pop();if(t.density!==this.updateTexCellDensity(t)&&(this._boundsNeedCalculating=!0),t.density<=0&&this.removeTexCell(t),h.chunker.check(e,w))break}h.chunker.end(e,!1)}},t.prototype.convertToGridCoordinate=function(e){var t=Math.floor(e.x/this.textureResolution),n=Math.floor(e.y/this.textureResolution);return new cc.Vec2(t,n)},t.prototype.convertFromGridCoordinate=function(e){var t=Math.floor(e.x)*this.textureResolution,n=Math.floor(e.y)*this.textureResolution;return new cc.Vec2(t,n)},t.prototype.getTexCellAtGridCoord=function(e){var t=P(e);return this._texCells.get(t)||null},t.prototype.ensureTexCellAtGridCoord=function(e){var t=this.getTexCellAtGridCoord(e);return t||(t=this.createTexCellAtGridCoord(e,this.createRenderSpriteTexture(),{density:0})),t},t.prototype.createTexCellAtGridCoord=function(e,t,n){var r=P(e),i=new cc.Node(r),a=cc.v2(.5*this.textureResolution,.5*this.textureResolution),s=cc.rect(0,0,this.textureResolution,this.textureResolution);i.setContentSize(this.textureResolution,this.textureResolution),i.setParent(this.texturesNode),i.setPosition(this.convertFromGridCoordinate(e).addSelf(a)),i.scaleY=-1;var c=i.addComponent(cc.Sprite);c.spriteFrame=new cc.SpriteFrame(t,s);var l=o({},n,{node:i,sprite:c,coord:e});return this._boundsNeedCalculating=!0,this._texCells.set(r,l),l},t.prototype.removeTexCell=function(e){var t=P(e.coord);this._texCells.delete(t),this._boundsNeedCalculating=!0,e.node.destroy()},t.prototype.ensureTexCellsForSplat=function(e,t){var n,r,o,i,a=[],s=e.getBoundingBox(),c=.5*s.width,l=.5*s.height;try{for(var d=u(O(c,this.textureResolution)),p=d.next();!p.done;p=d.next()){var f=p.value;try{for(var h=u(O(l,this.textureResolution)),y=h.next();!y.done;y=h.next()){var v=y.value,_=t.add(cc.v2(f,v)),g=this.convertToGridCoordinate(_),m=this.ensureTexCellAtGridCoord(g);a.includes(m)||a.push(m)}}catch(e){o={error:e}}finally{try{y&&!y.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return a},t.prototype.updateTexCellDensity=function(e){var t=e.sprite.spriteFrame.getTexture(),n=!!t.readPixels&&t.readPixels();if(!n)throw new Error("Texture node at @"+e.coord+" did not receive any pixels from .readPixels()\nEnsure that tryReleaseTextureNodeAtGridCoord is only receiving coordinatesof live render textures.");for(var r=0,o=0,i=3;i<=n.length;i+=20)r+=n[i]/255,o++;return r/=o,e.density=r,r},t.prototype.createRenderSpriteTexture=function(){var e=new cc.RenderTexture;e.setPremultiplyAlpha(!0),e.initWithSize(this.textureResolution,this.textureResolution);var t=n.renderCamera.clearFlags;return n.renderCamera.clearFlags=cc.Camera.ClearFlags.COLOR|cc.Camera.ClearFlags.STENCIL,n.renderCamera.targetTexture=e,n.renderCamera.backgroundColor=S(this.node.color),n.renderCamera.render(n.renderCamera.node),n.renderCamera.clearFlags=t,e},t.prototype.renderTexCell=function(e){var t=e.sprite.spriteFrame.getTexture(),r=null,o=!!t.getHtmlElementObj();o?(t=this.createRenderSpriteTexture(),r=e.sprite.getMaterial(0),e.sprite.srcBlendFactor=cc.macro.BlendFactor.ONE,e.sprite.dstBlendFactor=cc.macro.BlendFactor.ZERO,e.sprite.setMaterial(0,n.deserializeRasterMaterial)):e.sprite.enabled=!1;var i=n.renderCamera.node.parent;if(n.renderCamera.node.setParent(this.node),n.renderCamera.node.setPosition(e.node.position),n.renderCamera.zoomRatio=1/this.node.scale,n.renderCamera.targetTexture=t,n.renderCamera.render(this.node),n.renderCamera.node.setParent(i),o){var a=cc.rect(0,0,this.textureResolution,this.textureResolution);e.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,e.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE_MINUS_SRC_ALPHA,e.sprite.setMaterial(0,r),e.sprite.spriteFrame=new cc.SpriteFrame(t,a)}else e.sprite.enabled=!0},t.prototype.calculateBounds=function(){var e,t,n,r;this._boundsNeedCalculating=!1;var o=cc.v2(1/0,1/0),i=cc.v2(-1/0,-1/0),a=.5*this.textureResolution;try{for(var s=u(this._texCells.values()),c=s.next();!c.done;c=s.next()){var l=(_=c.value).node.position;o.x=Math.min(l.x-a,o.x),o.y=Math.min(l.y-a,o.y),i.x=Math.max(l.x+a,i.x),i.y=Math.max(l.y+a,i.y)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}var d=Math.abs(i.x-o.x),p=Math.abs(i.y-o.y);this._size.width=d,this._size.height=p,this._center.x=o.x+.5*d,this._center.y=o.y+.5*p;var f=cc.Vec2.ZERO,h=0;try{for(var y=u(this._texCells.values()),v=y.next();!v.done;v=y.next()){var _;h+=(_=v.value).density,f.x+=_.node.position.x*_.density,f.y+=_.node.position.y*_.density}}catch(e){n={error:e}}finally{try{v&&!v.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}h>0?(f.x/=h,f.y/=h):(f.x=this._center.x,f.y=this._center.y),this._centerOfOpacity=f},t.prototype.serializeRaster=function(){return a(this,void 0,Promise,function(){var e,t,n,r,o,i,a,c,l,d,p,f,v;return s(this,function(s){switch(s.label){case 0:n=[],r="raster-serialize-"+this.node.name+h.chunker.uniqueKey(),h.chunker.start(r),s.label=1;case 1:s.trys.push([1,6,7,8]),o=u(this._texCells.values()),i=o.next(),s.label=2;case 2:return i.done?[3,5]:(a=i.value,c=a.sprite.spriteFrame,(l=c&&c.getTexture())?(d=void 0,(p=l.readPixels())?d=h.rgbaToDataUrl(p,this.textureResolution):(f=l.getHtmlElementObj(),d=f&&f.src),d?(n.push({density:a.density,dataUrl:d,coord:{x:a.coord.x,y:a.coord.y}}),h.chunker.check(r,b)?[4,h.asyncSchedule(this,y.ONE_FRAME)]:[3,4]):[3,4]):[3,4]);case 3:s.sent(),s.label=4;case 4:return i=o.next(),[3,2];case 5:return[3,8];case 6:return v=s.sent(),e={error:v},[3,8];case 7:try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}return[7];case 8:return h.chunker.end(r),[2,{texCells:n,scale:this.node.scale,name:this.node.name,textureResolution:this.textureResolution,serializeStrategy:this.serializeStrategy}]}})})},t.prototype.serializeSplats=function(){return Promise.resolve({splats:l(this.splatData),scale:this.node.scale,name:this.node.name,textureResolution:this.textureResolution,serializeStrategy:this.serializeStrategy})},t.prototype.deserializeRaster=function(e){return a(this,void 0,Promise,function(){var t,n,r,o,i,a,c,l,d,p;return s(this,function(s){switch(s.label){case 0:r="deserialize-raster-"+e.name+"-"+h.chunker.uniqueKey(),h.chunker.start(r),s.label=1;case 1:s.trys.push([1,7,8,9]),o=u(e.texCells),i=o.next(),s.label=2;case 2:return i.done?[3,6]:(a=i.value,[4,h.dataUrlToHtmlImage(a.dataUrl)]);case 3:return c=s.sent(),(l=new cc.RenderTexture).initWithElement(c),d=new cc.Vec2(a.coord.x,a.coord.y),this.createTexCellAtGridCoord(d,l,a),h.chunker.check(r,b)?[4,h.asyncSchedule(this,y.ONE_FRAME)]:[3,5];case 4:s.sent(),s.label=5;case 5:return i=o.next(),[3,2];case 6:return[3,9];case 7:return p=s.sent(),t={error:p},[3,9];case 8:try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}return[7];case 9:return h.chunker.end(r),[2]}})})},t.prototype.deserializeSplats=function(e){return a(this,void 0,Promise,function(){var t,r,o,i,a,c,l,d,p,f,v,_,g,m;return s(this,function(s){switch(s.label){case 0:if(o="deserialize-splats-"+e.name+"-"+h.chunker.uniqueKey(),i=!this.enabledInHierarchy,a=i?{parent:this.node.parent,group:this.node.group}:null,i&&(this.node.setParent(cc.director.getScene()),this.node.group="splats"),!this.enabled||!this.enabledInHierarchy)throw new Error(h.nameOfComponent(this)+" must be enabled in order to deserialize splats.");c=[],h.chunker.start(o),s.label=1;case 1:s.trys.push([1,6,7,8]),l=u(e.splats),d=l.next(),s.label=2;case 2:return d.done?[3,5]:(p=d.value,f=n.useSplat(p.prefab),v=cc.v2(p.position.x,p.position.y),_=this.node.convertToWorldSpaceAR(v),f.setPosition(_),f.setScale(p.scale.x,p.scale.y),f.setContentSize(p.width,p.height),f.angle=p.angle,f.skewX=p.skew.x,f.skewY=p.skew.y,f.opacity=p.opacity,f.color=cc.Color.prototype.clone.call(p.color),c.push(f),(g=c.length>=50)&&(this.addSplats(c),c.length=0),g&&h.chunker.check(o,b)?[4,h.asyncSchedule(this,y.ONE_FRAME)]:[3,4]);case 3:s.sent(),s.label=4;case 4:return d=l.next(),[3,2];case 5:return[3,8];case 6:return m=s.sent(),t={error:m},[3,8];case 7:try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}return[7];case 8:return h.chunker.end(o),c.length>0&&this.addSplats(c),i&&a&&(this.node.setParent(a.parent),this.node.group=a.group),[2]}})})},t._splatPools=new Map,t._deserializeRasterMaterial=null,t._renderCamera=null,t=n=i([_,m,g("Scribbles And Ink/Drawing/Drawing")],t)}(cc.Component);n.default=x,cc._RF.pop()},{"../Framework/GameManager":"GameManager","../Util":"index","../constants":"constants"}],DynamicRainDrop:[function(e,t,n){"use strict";cc._RF.push(t,"05350TmbHBP9bnm+cQeLJiT","DynamicRainDrop");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./RainOutsideStoryManager")),s=i(e("./SidewalkSensor")),c=i(e("./PuddleSensor")),l=i(e("../../Drawing/DynamicSplat")),u=i(e("../../Generic/Temporary")),d=e("../../Util"),p=cc._decorator,f=p.ccclass,h=p.property,y=p.requireComponent,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._splashPrefab=null,t._gravity=cc.v2(0,-1400),t._collider=null,t._sidewalk=null,t._puddle=null,t}return r(t,e),Object.defineProperty(t.prototype,"collider",{get:function(){return this._collider||(this._collider=this.getComponent(cc.CircleCollider)),this._collider},enumerable:!0,configurable:!0}),t.prototype.onEmit=function(e){this.velocity=e.mul(.75),this.setLifeTime(8),this.scaleUp(),this.incrementCloudClearCount()},t.prototype.update=function(e){this.velocity.addSelf(this._gravity.mul(e));var t=this.velocity.mul(e),n=this.node.position.add(t);this.node.setPosition(n)},t.prototype.onCollisionEnter=function(e){var t=!(!this._sidewalk&&!this._puddle),n=e.getComponent(s.default);n&&(this._sidewalk=n);var r=e.getComponent(c.default);r&&(this._puddle=r),!n&&!r||t||this.setLifeTime(0,.15)},t.prototype.onCollisionExit=function(e){this._sidewalk&&this._sidewalk===e.getComponent(s.default)&&this.destroy()},t.prototype.onDestroy=function(){if((this._puddle||this._sidewalk)&&this._splashPrefab){var e=cc.instantiate(this._splashPrefab);e.setParent(this.node.parent),e.setPosition(this.node.position),e.color=this.node.color,e.scale=this.node.scale}cc.isValid(this.node,!0)&&this.node.destroy()},t.prototype.setLifeTime=function(e,t){void 0===t&&(t=e);var n=this.getComponent(u.default);n?n.delay=d.Random.float(e,t):((n=this.addComponent(u.default)).shrinkTime=0,n.secondsMin=e,n.secondsMax=t)},t.prototype.scaleUp=function(){var e=this.node.scale;this.node.scale=0,this.node.runAction(cc.scaleTo(.08,e))},t.prototype.incrementCloudClearCount=function(){var e=d.getComponentInScene(a.default);e&&e.incrementCloudFormDropCount()},o([h({type:cc.Prefab,visible:!0})],t.prototype,"_splashPrefab",void 0),o([h({visible:!0})],t.prototype,"_gravity",void 0),t=o([f,y(cc.CircleCollider)],t)}(l.default);n.default=v,cc._RF.pop()},{"../../Drawing/DynamicSplat":"DynamicSplat","../../Generic/Temporary":"Temporary","../../Util":"index","./PuddleSensor":"PuddleSensor","./RainOutsideStoryManager":"RainOutsideStoryManager","./SidewalkSensor":"SidewalkSensor"}],DynamicSplat:[function(e,t,n){"use strict";cc._RF.push(t,"2aa9fagTsxPB4sGw7Fq1ftI","DynamicSplat");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=o(e("./Drawing")),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawing=null,t.velocity=cc.Vec2.ZERO,t}return r(t,e),Object.defineProperty(t.prototype,"drawing",{get:function(){if(!this._drawing)throw new Error("Dynamic Splat must be emitted before accessing it's drawing");return this._drawing},enumerable:!0,configurable:!0}),t.prototype.emit=function(e,t){this._drawing=e,this.velocity=t;var n=this.node.position.clone();this.node.setParent(e.node.parent),this.node.setPosition(this.node.parent.convertToNodeSpaceAR(n)),this.onEmit(t)},Object.defineProperty(t.prototype,"emitted",{get:function(){return!!this._drawing},enumerable:!0,configurable:!0}),t.prototype.onEmit=function(e){},t.prototype.addSplat=function(e){cc.isValid(this.drawing)&&(e instanceof cc.Prefab&&(e=i.default.useSplat(e.name)),e.setParent(this.node.parent),e.setPosition(this.node.position),e.setContentSize(this.node.getContentSize()),e.angle=this.node.angle,e.scaleX=this.node.scaleX,e.scaleY=this.node.scaleY,e.color=this.node.color,this.drawing.addSplats([e]))},t}(cc.Component);n.default=a,cc._RF.pop()},{"./Drawing":"Drawing"}],EventActor:[function(e,t,n){"use strict";cc._RF.push(t,"f709e9bafZFup6OpzK1VVoh","EventActor");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./GameManager")),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._skeleton=null,t._animator=null,t._skeletonEventHandlers=[],t.skeletonResetHackFlag=!1,t.skeletonEventUniversalHandler=function(e,n){var r,o;if(t._skeleton){var a=n.data,c=t.getSpineEventAudioClipName(a);if(c){var l=cc.misc.clampf(a.floatValue,-1,1)+1;s.default.audio.play({name:c,volume:l,maxConcurrent:1})}else try{for(var u=i(t._skeletonEventHandlers),d=u.next();!d.done;d=u.next()){(0,d.value)(e,n)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}}},t}var n;return r(t,e),n=t,Object.defineProperty(t,"every",{get:function(){return this._every},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return!this._skeleton&&cc.isValid(this)&&(this._skeleton=this.getComponent(sp.Skeleton)||this.getComponentInChildren(sp.Skeleton)),this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator||(this._animator=this.getComponent(cc.Animation)),this._animator},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){n._every.includes(this)||n._every.push(this),this.skeleton&&(this.skeleton.loop=!1,this.resetSpineTrack(0,0)),this.skeleton&&this.skeleton.setEventListener(this.skeletonEventUniversalHandler)},t.prototype.onDestroy=function(){var e=n._every.indexOf(this);e>-1&&n._every.splice(e,1)},t.prototype.playSpineClip=function(e,t,n,r){if(this._skeleton&&(this.skeletonResetHackFlag&&this.applySkeletonResetHackFlag(),e&&this._skeleton.findAnimation(e))){try{this._skeleton.animation&&this._skeleton.setMix(this._skeleton.animation,e,n)}catch(e){cc.warn(e)}this._skeleton.setAnimation(t,e,r)}},t.prototype.resetSpineTrack=function(e,t){if(this._skeleton){var n=this._skeleton._state;n&&n.setEmptyAnimation(e,t)}},t.prototype.playAnimation=function(e){this.animator&&(this.animator.getClips().some(function(t){return t.name===e})&&this.animator.play(e))},t.prototype.getSpineAudioClipNames=function(e){var t,n,r,o,a=[];if(!this.skeleton)return a;var s=this.skeleton.skeletonData;if(!s)return a;"string"==typeof e&&(e=[e]);try{for(var c=i(e),l=c.next();!l.done;l=c.next()){var u=l.value,d=s.skeletonJson&&s.skeletonJson.animations&&s.skeletonJson.animations[u];if(d&&d.events)try{for(var p=i(d.events),f=p.next();!f.done;f=p.next()){var h=f.value,y=this.getSpineEventAudioClipName(h);y&&!a.includes(y)&&a.push(y)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return a},t.prototype.onSkeletonEvent=function(e){this._skeleton&&this._skeletonEventHandlers.push(e)},t.prototype.offSkeletonEvent=function(e){if(this._skeleton){var t=this._skeletonEventHandlers.indexOf(e);t>-1&&this._skeletonEventHandlers.splice(t,1)}},t.prototype.getSpineEventAudioClipName=function(e){if(!this.skeleton)return null;var t=this.skeleton.skeletonData.skeletonJson.events[e.name];if("audio"in t==!1)return null;var n=t.audio;return n.substring(n.lastIndexOf("/")+1,n.lastIndexOf("."))},t.prototype.applySkeletonResetHackFlag=function(){this.skeletonResetHackFlag=!1,this.skeleton&&(this.skeleton.clearTracks(),this.skeleton.setToSetupPose())},t._every=[],t=n=o([l,u,d("Scribbles And Ink/Framework/Event Actor")],t)}(cc.Component);n.default=p,cc._RF.pop()},{"./GameManager":"GameManager"}],EventRelayAudioLoader:[function(e,t,n){"use strict";cc._RF.push(t,"8d640uysAZNC7gKFhMoB/u9","EventRelayAudioLoader");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var p=d(e("./GameManager")),f=d(e("./EventRelay")),h=cc._decorator,y=h.ccclass,v=h.property,_=h.menu,g=h.requireComponent;function m(e){var t,n,r=[];if(e.events)try{for(var o=c(e.events),i=o.next();!i.done;i=o.next()){var a=i.value;if("actorPlaySpineClip"===a.func||"actorAddSpineMotion"===a.func){var s=a.params[0];s&&r.push({name:s,time:a.frame})}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function b(e){var t,n,r=[];if(e.events)try{for(var o=c(e.events),i=o.next();!i.done;i=o.next()){var a=i.value;if("playAudioClip"===a.func){var s=a.params[0];s&&r.push({name:s,time:a.frame})}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function w(e,t){return e.time-t.time}function S(e,t,n,r){var o,i,a,s,l,u,d=m(e),p=b(e);try{for(var f=c(t),h=f.next();!h.done;h=f.next()){var y=h.value;try{for(var v=c(d),_=v.next();!_.done;_=v.next()){var g=_.value,w=y.getSpineAudioClipNames(g.name);try{for(var S=c(w),O=S.next();!O.done;O=S.next()){var P=O.value;p.push({name:P,time:g.time})}}catch(e){l={error:e}}finally{try{O&&!O.done&&(u=S.return)&&u.call(S)}finally{if(l)throw l.error}}}}catch(e){a={error:e}}finally{try{_&&!_.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}return p}var O=function(){},P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._audioAssetDir="",t.preloadDuration=10,t._lowEndBgSfxOrMusicNames=[],t._eventRelay=null,t.audioKeyFrames=[],t.onSequencePlay=function(e){t.loadSequenceAudio(e),t.updateSequencePaused()},t}return r(t,e),Object.defineProperty(t.prototype,"audioAssetDir",{get:function(){var e=this._audioAssetDir;return e.length>0&&"/"!==e.charAt(e.length-1)&&(e+="/"),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventRelay",{get:function(){if(this._eventRelay||(this._eventRelay=this.getComponent(f.default)),!this._eventRelay)throw new Error("EventRelayAudioLoader requires an event relay");return this._eventRelay},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){this.eventRelay.node.on(f.default.EventTypes.PLAY_SEQUENCE,this.onSequencePlay)},t.prototype.onDestroy=function(){this.disposeAllAudio(),cc.isValid(this.eventRelay.node)&&this.eventRelay.node.off(f.default.EventTypes.PLAY_SEQUENCE,this.onSequencePlay)},t.prototype.update=function(){p.default.initialized&&(this.updateSequencePaused(),this.eventRelay.sequence&&this.ensureAudioLoadingInRange(this.eventRelay.sequence),this.checkDisposableAudio())},t.prototype.loadSequenceAudio=function(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=n+this.preloadDuration),this.fillAudioKeyFramesFromSequence(e,t),this.ensureAudioLoadingInRange(e,n,r)},t.prototype.ensureAudioLoadingInRange=function(e,t,n){var r,o;void 0===t&&(t=this.eventRelay.sequenceTime),void 0===n&&(n=this.eventRelay.sequenceTime+this.preloadDuration);var i=[];try{for(var a=c(this.getKeyFramesInRange(t,n,e)),s=a.next();!s.done;s=a.next()){var l=s.value;l.loading||l.loadingError||this.isAudioClipLoaded(l.name)||i.push(this.loadAudio(l))}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return Promise.all(i).then(O)},t.prototype.disposeSequenceAudio=function(e){var t,n,r=[],o=[];try{for(var i=c(this.audioKeyFrames),a=i.next();!a.done;a=i.next()){var s=a.value;s.sequence===e?r.push(s):o.push(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.disposeAudio(r),this.audioKeyFrames=o},t.prototype.hasAudioKeyFrame=function(e){var t,n;try{for(var r=c(this.audioKeyFrames),o=r.next();!o.done;o=r.next()){var i=o.value;if(e.name===i.name&&e.time===i.time&&e.sequence===i.sequence)return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},t.prototype.isAudioUsedInFutureKeyframes=function(e,t){void 0===t&&(t=0);for(var n=t;n<this.audioKeyFrames.length;n++){var r=this.audioKeyFrames[n];if(r.name===e.name&&r.sequence===e.sequence)return!0}return!1},t.prototype.checkDisposableAudio=function(){for(var e=this.audioKeyFrames,t=this.eventRelay,n=p.default.audio,r=[],o=0;o<e.length;o++){var i=e[o],a=t.sequence===i.sequence&&t.sequenceTime>i.time,s=this.isAudioUsedInFutureKeyframes(i,o+1),c=n.isPlaying(i.name);!s&&c&&a&&r.push(i)}this.disposeAudio(r)},t.prototype.updateSequencePaused=function(){var e,t,n=this.eventRelay,r=!1;try{for(var o=c(this.getKeyFramesAtPlayhead()),i=o.next();!i.done;i=o.next()){var a=i.value;if(r=!a.loadingError&&!this.isAudioClipLoaded(a.name)&&this.canLoadAudioClip(a.name)&&a.time<n.sequenceTime+10)break}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}r&&!n.sequenceIsPaused?n.pauseSequence():!r&&n.sequenceIsPaused&&n.resumeSequence()},t.prototype.fillAudioKeyFramesFromSequence=function(e,t){var n,r;void 0===t&&(t=u(f.default.actors));var i=S(e,t),a=p.default.assets;try{for(var s=c(i),l=s.next();!l.done;l=s.next()){var d=l.value,h=o({},d,{loading:!1,sequence:e});if(!this.hasAudioKeyFrame(h)&&!this.isAudioClipLoaded(d.name)){var y=this.audioAssetDir+d.name;a.hasDynamicAssets(y)||this.audioKeyFrames.push(h)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}this.audioKeyFrames.sort(w)},t.prototype.loadAudio=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(r){switch(r.label){case 0:return t=p.default.assets,n=this.audioAssetDir+e.name,e.loading=!0,this.canLoadAudioClip(e.name)?[4,t.loadDynamicAssets(n).catch(function(t){cc.warn(t),e.loadingError=t.message})]:[3,2];case 1:r.sent(),r.label=2;case 2:return e.loading=!1,[2]}})})},t.prototype.getKeyFramesInRange=function(e,t,n){var r,o,i,a,l,u;return s(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),i=c(this.audioKeyFrames),a=i.next(),s.label=1;case 1:return a.done?[3,4]:(l=a.value).sequence!==n?[3,3]:l.time>=t?[3,4]:l.time>=e?[4,l]:[3,3];case 2:s.sent(),s.label=3;case 3:return a=i.next(),[3,1];case 4:return[3,7];case 5:return u=s.sent(),r={error:u},[3,7];case 6:try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}return[7];case 7:return[2]}})},t.prototype.getKeyFramesAtPlayhead=function(){var e=this.eventRelay,t=this.preloadDuration;return this.getKeyFramesInRange(e.sequenceTime,e.sequenceTime+t,e.sequence)},t.prototype.disposeAllAudio=function(){this.disposeAudio(u(this.audioKeyFrames))},t.prototype.disposeAudio=function(e){var t,n;Array.isArray(e)||(e=[e]);var r=p.default.assets;try{for(var o=c(e),i=o.next();!i.done;i=o.next()){var a=i.value,s=this.audioAssetDir+a.name;r.disposeDynamicAssets(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.isAudioClipLoaded=function(e){var t=p.default.assets;return t.dynamicAssetNames.includes(e)||t.staticAssetNames.includes(e)},t.prototype.canLoadAudioClip=function(e){return!p.default.isLowEndDevice||(!(e.includes("SFX")||e.includes("MUSIC")||e.includes("BG"))||this._lowEndBgSfxOrMusicNames.includes(e))},i([v({visible:!0,tooltip:"Optional property. Names of audio clips used in a sequence will attempt to be loaded from this folder, and then released afterward."})],t.prototype,"_audioAssetDir",void 0),i([v({tooltip:"Amount of time, in seconds, to ensure clips are loaded.",min:1,max:30,slide:!0})],t.prototype,"preloadDuration",void 0),i([v({type:cc.String,tooltip:"By default, BG, SFX or Music audio is not loaded on low end devices.\nThis property acts as a white list for exceptions to that rule on low end devices.",visible:!0})],t.prototype,"_lowEndBgSfxOrMusicNames",void 0),t=i([y,g(f.default),_("Scribbles And Ink/Framework/Event Relay Audio Loader")],t)}(cc.Component);n.default=P,cc._RF.pop()},{"./EventRelay":"EventRelay","./GameManager":"GameManager"}],EventRelay:[function(e,t,n){"use strict";cc._RF.push(t,"26d03TmBNdBfpusPjfSOlGK","EventRelay");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var d,p=u(e("./EventActor")),f=u(e("../Generic/CameraRig")),h=u(e("./GameManager")),y=e("../Util"),v=cc._decorator,_=v.ccclass,g=v.disallowMultiple,m=v.property,b=v.menu,w=cc.Animation.EventType;(function(e){e.PLAY_SEQUENCE="play-sequence",e.STOP_SEQUENCE="stop-sequence",e.FINISH_SEQUENCE="finish-sequence"})(d||(d={}));var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._cameraRig=null,t._animator=null,t.sequence=null,t.loop=!1,t._playOnLoad=!0,t._sequenceIsPlaying=!1,t.onSequenceComplete=function(){t.loop&&t.playSequence()},t}var n;return r(t,e),n=t,Object.defineProperty(t,"actors",{get:function(){return p.default.every},enumerable:!0,configurable:!0}),Object.defineProperty(t,"enabledActors",{get:function(){return p.default.every.filter(function(e){return cc.isValid(e,!0)&&e.enabled&&e.enabledInHierarchy})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraRig",{get:function(){return this._cameraRig&&cc.isValid(this._cameraRig,!0)||(this._cameraRig=y.getComponentInScene(f.default)),this._cameraRig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator||(this._animator=this.getComponent(cc.Animation)||this.addComponent(cc.Animation),this._animator.on(w.FINISHED,this.onSequenceComplete),this._animator.playOnLoad=!1),this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sequenceIsPlaying",{get:function(){return this._sequenceIsPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sequenceIsPaused",{get:function(){if(!this.sequence)return!1;var e=this.animator.getAnimationState(this.sequence.name);return!!e&&e.isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sequenceProgress",{get:function(){var e=this.sequence&&this.animator.getAnimationState(this.sequence.name);return e?cc.misc.clamp01(e.time/(this.sequence?this.sequence.duration:0)):0},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){this.sequence&&this._playOnLoad&&this.playSequence()},t.prototype.playSequence=function(e){return void 0===e&&(e=this.sequence),i(this,void 0,Promise,function(){var t,n,r=this;return a(this,function(o){switch(o.label){case 0:if(!e)throw new Error("No sequence provided or set on EventRelay.");return this.ensureSequenceAsClip(e),this._sequenceIsPlaying=!0,this.animator.play(e.name),this.node.emit(d.PLAY_SEQUENCE,e),t=new Promise(function(e){return r.animator.once(w.FINISHED,e)}).then(function(){return r.node.emit(d.FINISH_SEQUENCE,e)}),n=new Promise(function(e){return r.animator.once(w.STOP,e)}).then(function(){return r.node.emit(d.STOP_SEQUENCE,e)}),[4,Promise.race([t,n])];case 1:return o.sent(),this._sequenceIsPlaying=!1,[2]}})})},t.prototype.pauseSequence=function(){this.sequence&&cc.log("EventRelay@"+this.node.name.replace(/ /g,""),"paused sequence:",this.sequence.name),this.sequence&&this.animator.pause(this.sequence.name)},t.prototype.resumeSequence=function(){this.sequence&&cc.log("EventRelay@"+this.node.name.replace(/ /g,""),"resumed sequence:",this.sequence.name),this.sequence&&this.animator.resume(this.sequence.name)},t.prototype.stopSequence=function(){this.animator.stop()},Object.defineProperty(t.prototype,"sequenceTime",{get:function(){var e=this.sequence?this.animator.getAnimationState(this.sequence.name):null;return e?e.time:0},enumerable:!0,configurable:!0}),t.prototype.ensureSequenceAsClip=function(e){var t=this.animator.getClips();this.sequence=e,e&&-1===t.indexOf(e)&&this.animator.addClip(e)},t.prototype.actorPlaySpineClip=function(e,t,r,o){var i,a;try{for(var c=s(n.enabledActors),l=c.next();!l.done;l=c.next()){l.value.playSpineClip(e,t,r,o)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}},t.prototype.actorAddSpineMotion=function(e,t,r,o){var i,a,c=y.getDescendentByName(r);if(c)try{for(var l=s(n.enabledActors),u=l.next();!u.done;u=l.next()){var d=u.value;if(e&&d.skeleton&&d.skeleton.findAnimation(e)){var p=d.addComponent(o);if(!p)continue;p._target=c,p.track=t,p.motionAnimation=e}}}catch(e){i={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}},t.prototype.actorResetSpineTrack=function(e,t){var r,o;try{for(var i=s(n.enabledActors),a=i.next();!a.done;a=i.next()){a.value.resetSpineTrack(e,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},t.prototype.actorPlayAnimation=function(e){var t,r;try{for(var o=s(n.enabledActors),i=o.next();!i.done;i=o.next()){i.value.playAnimation(e)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.actorSetActive=function(e,t){var r,o;if(e)try{for(var i=s(n.actors),a=i.next();!a.done;a=i.next()){var c=a.value;c.node.name===e&&(c.node.active=t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},t.prototype.actorSetParent=function(e,t,r){var o,i;if(void 0===r&&(r=-1),e){var a=y.getDescendentByName(t);try{for(var c=s(n.enabledActors),l=c.next();!l.done;l=c.next()){var u=l.value;if(u.node.name===e){var d=a||u.node.parent&&u.node.parent&&u.node.parent.parent,p=u.node.convertToWorldSpaceAR(cc.Vec2.ZERO);u.node.setParent(d);var f=r>=0?r:Math.abs(u.node.parent.children.length+r);u.node.setSiblingIndex(f);var h=d.convertToNodeSpaceAR(p);u.node.setPosition(h)}}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}},t.prototype.actorSetAxis=function(e,t,r){var o,i;if(void 0===t&&(t="x"),e){var a="x"===t?"scaleX":"scaleY";try{for(var c=s(n.enabledActors),l=c.next();!l.done;l=c.next()){var u=l.value;u.node.name===e&&(u.node[a]=Math.abs(u.node[a])*r)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}},t.prototype.actorDestroy=function(e){var t,r;if(e)try{for(var o=s(n.enabledActors),i=o.next();!i.done;i=o.next()){var a=i.value;a.node.name===e&&a.node.destroy()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.actorComponentMethod=function(e,t,r){for(var o,i,a=[],c=3;c<arguments.length;c++)a[c-3]=arguments[c];if(!t)throw new Error("componentName required");try{for(var u=s(n.enabledActors),d=u.next();!d.done;d=u.next()){var p=d.value;if(!e||p.node.name===e){var f=p.getComponent(t);f&&"function"==typeof f[r]?f[r].apply(f,l(a)):f&&"setEnabled"===r&&(f.enabled=!!a[0])}}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}},t.prototype.actorAddTransformMotion=function(e,t,r,o,i){var a,c;if(e){t&&cc.warn("actorAddTransformMotion no longer uses componentName");var l=y.getDescendentByName(r);if(l)try{for(var u=s(n.enabledActors),d=u.next();!d.done;d=u.next()){var p=d.value;p.node.name===e&&y.transformToTarget(p.node,l,o,i)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}}},t.prototype.mainCameraMove=function(e,t,n){if(!this.cameraRig)return cc.warn("mainCameraMove failed, no CameraRig in scene.");var r=y.getDescendentByName(e);if(!r)return cc.warn('mainCameraMove failed, could not find Node named: "'+e+'"');this.cameraRig.matchTarget(r,t,n)},t.prototype.playAudioClip=function(e,t,n){h.default.audio.play({name:e,volume:t,loop:n})},t.prototype.stopAudioClip=function(e){h.default.audio.stop({name:e})},t.EventTypes=d,o([m({type:cc.AnimationClip,visible:!0})],t.prototype,"sequence",void 0),o([m()],t.prototype,"loop",void 0),o([m({visible:!0})],t.prototype,"_playOnLoad",void 0),t=n=o([_,g,b("Scribbles And Ink/Framework/Event Relay")],t)}(cc.Component);n.default=S,cc._RF.pop()},{"../Generic/CameraRig":"CameraRig","../Util":"index","./EventActor":"EventActor","./GameManager":"GameManager"}],EventSequencer:[function(e,t,n){"use strict";cc._RF.push(t,"e190126DZRLibbAEMJSsICd","EventSequencer");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c,l,u,d,p=s(e("./EventRelay")),f=s(e("./GameManager")),h=e("../Util"),y=e("../constants"),v=cc._decorator,_=v.ccclass,g=v.menu,m=v.property;function b(){return this.playStrategy!==c.Infinite}function w(){return this.inputStrategy!==d.Anytime}function S(){return this.playStrategy!==c.Once&&this._sequences.length>1}function O(){return this.inputStrategy===d.WhileDrawing}(function(e){e[e.Once=1]="Once",e[e.Each=2]="Each",e[e.Infinite=3]="Infinite"})(c||(c={})),function(e){e[e.Sequential=0]="Sequential",e[e.Random=1]="Random"}(l||(l={})),function(e){e[e.Instance=0]="Instance",e[e.Session=1]="Session"}(u||(u={})),function(e){e[e.Anytime=0]="Anytime",e[e.WhileIdle=1]="WhileIdle",e[e.WhileDrawing=2]="WhileDrawing"}(d||(d={}));var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._sequences=[],t._playStrategy=c.Infinite,t._playReset=u.Instance,t._playOrder=l.Random,t._inputStrategy=d.Anytime,t._waitUntilStrokeFinished=!1,t.interruptSequence=null,t._delayIntervalMin=2,t._delayIntervalMax=2,t._eventRelay=null,t._timeBuffer=0,t._lastPlayedSequenceIndex=-1,t._lastCameraPosition=cc.Vec2.ZERO,t._lastUIInteraction=Date.now(),t._interrupting=!1,t._playing=!1,t}return r(t,e),Object.defineProperty(t.prototype,"playStrategy",{get:function(){return this._playStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playReset",{get:function(){return this._playReset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playOrder",{get:function(){return this._playStrategy===c.Once&&this._playOrder===l.Sequential&&(this._playOrder=l.Random),this._playOrder},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputStrategy",{get:function(){return this._inputStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventRelay",{get:function(){return cc.isValid(this._eventRelay,!0)||(this._eventRelay=this.getComponent(p.default)||this.addComponent(p.default)),this._eventRelay},set:function(e){this._eventRelay=e},enumerable:!0,configurable:!0}),t.prototype.onEnable=function(){this.resetTimeBuffer()},t.prototype.update=function(e){this.updateTimeBuffer(e),this._timeBuffer>0||this.inputStrategy===d.WhileDrawing&&this._waitUntilStrokeFinished&&this.isDrawing()||this.sendSequence()},t.prototype.sendSequence=function(){return i(this,void 0,Promise,function(){var e,t;return a(this,function(n){switch(n.label){case 0:return this._playing?[2]:(this.removeUnplayableSequences(),e=this.getNextSequenceIndex(),(t=this._sequences[e])?(this._lastPlayedSequenceIndex=e,this.removeLastPlayedSequence(),this._playing=!0,[4,this.eventRelay.playSequence(t)]):[2]);case 1:return n.sent(),this._playing=!1,this.resetTimeBuffer(),[2]}})})},t.prototype.wouldSendSequence=function(){return!this.eventRelay.sequenceIsPlaying&&(this.inputStrategy===d.WhileIdle?this.isIdle():this.inputStrategy!==d.WhileDrawing||this.isDrawing())},t.prototype.handleInterrupt=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return this.eventRelay.sequenceIsPlaying&&this.eventRelay.stopSequence(),this.interruptSequence?(this._interrupting=!0,[4,this.eventRelay.playSequence(this.interruptSequence)]):[3,2];case 1:e.sent(),this._interrupting=!1,e.label=2;case 2:return[2]}})})},t.prototype.getSequenceKey=function(e){return("sequence-played-"+this.node.name+"-"+h.nameOfComponent(this)+"-"+e.name).toLowerCase()},t.prototype.removeUnplayableSequences=function(){if(this.playStrategy!==c.Infinite&&this.playReset===u.Session)for(var e=f.default.storage,t=this._sequences.length-1;t>=0;t--){var n=this._sequences[t],r=this.getSequenceKey(n);e.getMem(y.UI_STORE_KEY,r)&&this._sequences.splice(t,1)}},t.prototype.removeLastPlayedSequence=function(){if(this.playStrategy!==c.Infinite){for(var e=this._sequences.length-1;e>=0;e--){if(this.playStrategy===c.Once||this._lastPlayedSequenceIndex===e){if(this.playReset===u.Session){var t=this._sequences[e],n=this.getSequenceKey(t);f.default.storage.setMem(y.UI_STORE_KEY,n,!0)}this._sequences.splice(e,1)}}this.playOrder===l.Sequential&&(this._lastPlayedSequenceIndex=-1)}},t.prototype.getNextSequenceIndex=function(){var e,t=this._lastPlayedSequenceIndex;if(this.playOrder===l.Sequential)e=t+1>=this._sequences.length?0:t+1;else do{e=h.Random.index(this._sequences)}while(this._sequences.length>2&&t===e);return e},t.prototype.resetTimeBuffer=function(){this._timeBuffer=Math.abs(h.Random.float(this._delayIntervalMin,this._delayIntervalMax))},t.prototype.updateTimeBuffer=function(e){if(!(this._interrupting||(this.eventRelay.sequenceIsPlaying||this.eventRelay.sequenceIsPaused)&&!this._playing)){var t=this.inputStrategy===d.WhileIdle&&!this.isIdle()||this.inputStrategy===d.WhileDrawing&&f.default.initialized&&f.default.drawingUI.hidden;this._playing&&t&&this.handleInterrupt(),t?this.resetTimeBuffer():(this.inputStrategy!==d.WhileDrawing||this.isDrawing())&&(this._timeBuffer-=e)}},t.prototype.isIdle=function(){var e=!0;if(!f.default.initialized)return e;var t=f.default.drawingUI,n=f.default.mainCamera;t.currentTool&&t.currentTool.isStroking&&(e=!1),n.node.position.equals(this._lastCameraPosition)||(this._lastCameraPosition=n.node.position,e=!1);var r=f.default.analytics;return this._lastUIInteraction!==r.lastUITimestamp&&(this._lastUIInteraction=r.lastUITimestamp,e=!1),e},t.prototype.isDrawing=function(){if(!f.default.initialized)return!1;var e=f.default.drawingUI.currentTool;return!!e&&e.isStroking},t.PlayStrategy=c,t.PlayOrder=l,t.PlayReset=u,o([m({type:cc.AnimationClip,visible:!0})],t.prototype,"_sequences",void 0),o([m({tooltip:"Once: Only one sequence will be played\n\n        Each: Each sequence will be played once \n\n        Infinite: Sequences will be played indefinetly",type:cc.Enum(c),visible:!0})],t.prototype,"_playStrategy",void 0),o([m({type:cc.Enum(u),visible:b,tooltip:"Instance: Sequences can be replayed when the Event \n        Sequencer is re-instantiated (such as when a scene is reloaded)\n\n        Session: Sequences can only be played once per session."})],t.prototype,"_playReset",void 0),o([m({type:cc.Enum(l),visible:S})],t.prototype,"_playOrder",void 0),o([m({type:cc.Enum(d),visible:!0,tooltip:"Anytime: Can send an event sequence at any time.\n    \n        WhileIdle: Will send a sequence when the UI is not being used\n        and the main camera isn't moving. If a sequence is playing, and the game is no longer idle, that sequence will be stopped.\n    \n        WhileDrawing: Will send a sequence when the DrawingUI is open. If a sequence is playing\n        and the DrawingUI is hidden, it will be interrupted.\n        "})],t.prototype,"_inputStrategy",void 0),o([m({visible:O,tooltip:"If a draw reaction is to be triggered, it will wait until the current stroke is finished."})],t.prototype,"_waitUntilStrokeFinished",void 0),o([m({type:cc.AnimationClip,visible:w,tooltip:"When no longer idle, this sequence will be played when the currently playing sequence is interrupted."})],t.prototype,"interruptSequence",void 0),o([m({visible:!0,tooltip:"Minimum delay for the sequence to be sent. If input strategy is set to WhileDrawing, the delay while only accumulate while a drawing tool is actively stroking.",min:0})],t.prototype,"_delayIntervalMin",void 0),o([m({visible:!0,min:0,tooltip:"Maximum delay for the sequence to be sent. If input strategy is set to WhileDrawing, the delay while only accumulate while a drawing tool is actively stroking."})],t.prototype,"_delayIntervalMax",void 0),o([m({tooltip:"Event Relay to send sequences to. If no Event Relay is given it will look for one on the same node, or add one onto the same node.",visible:!0,type:p.default})],t.prototype,"_eventRelay",void 0),t=o([_,g("Scribbles And Ink/Framework/Event Sequencer")],t)}(cc.Component);n.default=P,cc._RF.pop()},{"../Util":"index","../constants":"constants","./EventRelay":"EventRelay","./GameManager":"GameManager"}],FakePerspective:[function(e,t,n){"use strict";cc._RF.push(t,"f63a3qFtdpOJY6G59k9FrRO","FakePerspective");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Generic/ConstrainScaleToPosition")),s=cc._decorator,c=s.ccclass,l=s.disallowMultiple,u=s.executeInEditMode,d=s.property;function p(){return!this.getComponent(a.default)}var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parallax=null,t.xFactor=0,t.fullWidth=!1,t._perspectiveFactor=0,t._backgroundAnimation=null,t}return r(t,e),Object.defineProperty(t.prototype,"parallaxWidth",{get:function(){return this.parallax?this.parallax.getContentSize().width:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backgroundAnimation",{get:function(){if(this.parallax&&!this._backgroundAnimation){var e=this.parallax.getComponent(cc.Animation);this._backgroundAnimation=e&&e.defaultClip}return this._backgroundAnimation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startX",{get:function(){var e=this.backgroundAnimation;if(!e)return 0;var t=(e.curveData.props.x||[])[0];return t?t.value:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endX",{get:function(){var e=this.backgroundAnimation;if(!e)return 0;var t=e.curveData.props.x||[],n=t[t.length-1];return n?n.value:0},enumerable:!0,configurable:!0}),t.prototype.update=function(){var e=this,t=e.fullWidth,n=e.parallaxWidth,r=e.node,o=e.parallax,i=e.startX,s=e.endX;if(o){var c=Math.abs(s-i),l=o.x,u=this.getComponent(a.default),d=5*(u?u.scaleFactor:this._perspectiveFactor)*c;t&&r.setContentSize((d+n)/this.node.scaleX,r.getContentSize().height);var p=(l-i)/c,f=this.xFactor/100,h=l+f*d+f*n,y=p*d;this.node.x=h+y}},o([d({type:cc.Node})],t.prototype,"parallax",void 0),o([d({min:0,max:100,step:1,slide:!0})],t.prototype,"xFactor",void 0),o([d()],t.prototype,"fullWidth",void 0),o([d({min:0,max:1,visible:p})],t.prototype,"_perspectiveFactor",void 0),t=o([c,l,u],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../Generic/ConstrainScaleToPosition":"ConstrainScaleToPosition"}],FlubberChaser:[function(e,t,n){"use strict";cc._RF.push(t,"dfbb0tlJ1tDUI4sLDToOSpZ","FlubberChaser");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("../../Character/UseRootMotion")),c=a(e("./FlubberDynamicSplat")),l=e("../../Util"),u=a(e("../../Generic/Temporary")),d=cc._decorator,p=d.ccclass,f=d.disallowMultiple,h=d.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.motionAnimation="",t.track=6,t.delay=1,t.offset=20,t.flubber=null,t._timeBuffer=t.delay,t._walker=null,t._rigidbody=null,t._collider=null,t}var n;return r(t,e),n=t,t.prototype.start=function(){this._timeBuffer=this.delay},t.prototype.update=function(e){if(this._timeBuffer>0)this._timeBuffer-=e;else{cc.isValid(this.flubber)||(this.flubber=this.findFlubber());var t=cc.isValid(this.flubber)&&cc.isValid(this.flubber.node);!t&&cc.isValid(this._walker)&&this._walker.cancel(),t?t&&!cc.isValid(this._walker)&&this.addWalker():this._timeBuffer=this.delay}},t.prototype.onDestroy=function(){var e,t;try{for(var n=i([this._walker,this._rigidbody,this._collider]),r=n.next();!r.done;r=n.next()){var o=r.value;cc.isValid(o)&&(o===this._walker&&o.cancel(),o.destroy())}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.onBeginContact=function(e,t,n){var r=n.node.getComponent(u.default);r&&(r.delay-=2)},t.prototype.addWalker=function(){this._rigidbody=this.getComponent(cc.RigidBody)||this.addComponent(cc.RigidBody),this._rigidbody.type=cc.RigidBodyType.Animated,this._rigidbody.enabledContactListener=!0,this._collider=this.getComponent(cc.PhysicsCircleCollider)||this.addComponent(cc.PhysicsCircleCollider),this._collider.radius=40,this._walker=this.getComponent(s.default)||this.addComponent(s.default),this._walker.track=this.track,this._walker.motionAnimation=this.motionAnimation,this._walker.target=this.flubber&&this.flubber.node},t.prototype.findFlubber=function(){var e=this,t=l.getComponentsInScene(n).find(function(t){return t!==e})||null,r=l.getComponentsInScene(c.default).filter(function(e){return cc.isValid(e,!0)}).filter(function(e){return!t||e!==t.flubber}),o=l.Random.item(r)||null;return o||(o=t&&t.flubber),o},o([h()],t.prototype,"motionAnimation",void 0),o([h({step:1,min:0})],t.prototype,"track",void 0),o([h({tooltip:"Delay before Character start running around.",min:0,step:.25})],t.prototype,"delay",void 0),o([h({tooltip:"Offset from the edge of the planet to react to flubber"})],t.prototype,"offset",void 0),o([h(c.default)],t.prototype,"flubber",void 0),t=n=o([p,f],t)}(cc.Component);n.default=y,cc._RF.pop()},{"../../Character/UseRootMotion":"UseRootMotion","../../Generic/Temporary":"Temporary","../../Util":"index","./FlubberDynamicSplat":"FlubberDynamicSplat"}],FlubberDynamicSplat:[function(e,t,n){"use strict";cc._RF.push(t,"4e840yVeudFVbfuVmL3mBnz","FlubberDynamicSplat");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../Util"),s=i(e("./SpaceStoryManager")),c=i(e("../../Drawing/TimedDynamicSplat")),l=cc._decorator,u=l.ccclass,d=l.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._speed=2,t._velocity=cc.Vec2.ZERO,t._spin=0,t._isUsingPhysics=!1,t._rigidbody=null,t._storyManager=null,t}return r(t,e),Object.defineProperty(t.prototype,"storyManager",{get:function(){if(this._storyManager||(this._storyManager=a.getComponentInScene(s.default)),!this._storyManager)throw new Error("Story Manager could not be found");return this._storyManager},enumerable:!0,configurable:!0}),t.prototype.start=function(){this._velocity=a.Random.v2(this._speed),this._spin=a.Random.float(1*-this._speed,1*this._speed),this._isUsingPhysics=cc.director.getPhysicsManager().enabled,this._isUsingPhysics&&this.initializePhysicsVelocities()},t.prototype.update=function(e){this._isUsingPhysics||this.updateNonPhysicsVelocities(e),this.snapToPlanet()},t.prototype.initializePhysicsVelocities=function(){var e=this.getComponent(cc.RigidBody);if(!e)throw new Error("Rigidbody required on Flubber if the scene is using physics.");e.linearVelocity=this._velocity,e.angularVelocity=this._spin},t.prototype.updateNonPhysicsVelocities=function(e){this.node.position=this.node.position.add(this._velocity.mul(e)),this.node.angle+=this._spin*e},t.prototype.snapToPlanet=function(){var e=this.storyManager.planet,t=.5*Math.max(this.node.width,this.node.height),n=.5*e.node.getBoundingBox().width,r=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),o=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),i=r.sub(o);if(!(i.mag()<n-t)){var a=i.normalize().mulSelf(n-t).addSelf(o),s=this.node.parent.convertToNodeSpaceAR(a);this.node.setPosition(s)}},o([d({visible:!0})],t.prototype,"_speed",void 0),t=o([u],t)}(c.default);n.default=p,cc._RF.pop()},{"../../Drawing/TimedDynamicSplat":"TimedDynamicSplat","../../Util":"index","./SpaceStoryManager":"SpaceStoryManager"}],GalleryFilledActivator:[function(e,t,n){"use strict";cc._RF.push(t,"f65b0OXsGlLSbb/RC+XltyM","GalleryFilledActivator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("../../Util/getComponentsInScene")),c=a(e("./GalleryFrame")),l=a(e("../../Generic/Activator")),u=e("../../constants"),d=cc._decorator,p=d.ccclass,f=d.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._comparer=u.Comparer.AtMost,t._targetFramesFilled=0,t}return r(t,e),t.prototype.determineActive=function(){var e=s.default(c.default);if(!e.every(function(e){return e.loaded}))return!1;var t=this.getNumberOfFramesFilled(e);return this._comparer===u.Comparer.AtLeast?this._targetFramesFilled<=t:this._targetFramesFilled>=t},t.prototype.getNumberOfFramesFilled=function(e){var t,n,r=0;try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value.drawingSpot.drawing;s&&!s.isEmpty&&r++}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},o([f({type:cc.Enum(u.Comparer),visible:!0})],t.prototype,"_comparer",void 0),o([f({min:0,step:1,visible:!0,displayName:"Number of Frames Filled"})],t.prototype,"_targetFramesFilled",void 0),t=o([p],t)}(l.default);n.default=h,cc._RF.pop()},{"../../Generic/Activator":"Activator","../../Util/getComponentsInScene":"getComponentsInScene","../../constants":"constants","./GalleryFrame":"GalleryFrame"}],GalleryFrame:[function(e,t,n){"use strict";cc._RF.push(t,"c0459Pks+pCJ74e3zUn83N1","GalleryFrame");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../../Framework/GameComponent")),l=s(e("../../Drawing/DrawingSpot")),u=s(e("../../Framework/GameManager")),d=e("../../Util"),p=s(e("./Room")),f=s(e("../../Generic/Hider")),h=e("../../constants"),y=s(e("../../UI/ScreenWidget")),v=s(e("../../UI/Button")),_=cc._decorator,g=_.ccclass,m=_.property,b=cc.size(960,640);function w(){return!d.getComponentInParents(this.node,p.default)}var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._autoLoad=!0,t._showcaseDuration=0,t._showcaseSound="GalleryFrameZoom",t._showcaseScaleNode=null,t._frameAngleNerfFactor=0,t._drawingSpot=null,t._loadingArrowHider=null,t._loading=!1,t._loaded=!1,t._showcased=!1,t._fullScreenCloseFrameArea=null,t._fullScreenCloseHint=null,t._originalPosition=cc.Vec2.ZERO,t._originalSize=cc.Size.ZERO,t._originalAngle=0,t._originalParent=null,t.refreshDrawing=t.loadDrawing,t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"drawingSpot",{get:function(){if(this._drawingSpot||(this._drawingSpot=this.getComponentInChildren(l.default)),!this._drawingSpot)throw new Error("GalleryFrame must have a drawing spot nested inside");return this._drawingSpot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingArrowHider",{get:function(){if(!this._loadingArrowHider){var e=u.default.assets.getSingleAsset("Common/Prefabs/SpinningArrow"),t=cc.instantiate(e);t.setParent(this.node),this._loadingArrowHider=t.getComponent(f.default)}if(!this._loadingArrowHider)throw new Error("Could not get loading arrow hider for GalleryFrame "+this.node.name);return this._loadingArrowHider},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),t.prototype.onGameStart=function(){this._autoLoad?this.loadDrawing():this.loadingArrowHider.enabled=!0,this._originalPosition=this.node.position,this._originalSize=this.node.getContentSize(),this._originalAngle=this.node.angle,this._originalParent=this.node.parent},t.prototype.loadDrawing=function(){this._loading=!0,this._loaded=this.loadingArrowHider.enabled=!1,this.drawingSpot.refreshDrawing(),this._loading=!1,this._loaded=this.loadingArrowHider.enabled=!0},t.prototype.toggleShowcase=function(){return this._showcased?this.disableShowcase():this.enableShowcase()},t.prototype.enableShowcase=function(){var e=this;if(!this._showcased)return this._showcased=!0,u.default.audio.play({name:this._showcaseSound}),u.default.analytics.send(o({},h.ANALYTICS.ShowcaseFrame,{label:this.drawingSpot.storageKey})),this.disableOtherShowcasedFrames(),this.node.stopAllActions(),this.node.runAction(cc.sequence(this.moveUpAction(),this.createCloseFrameHint(),this.moveToShowcaseAction(),this.createFullScreenCloseFrameArea())),new Promise(function(t){return e.scheduleOnce(t,e._showcaseDuration)})},t.prototype.disableShowcase=function(){var e=this;if(this._showcased)return this._showcased=!1,this.node.stopAllActions(),this.node.runAction(cc.sequence(this.destroyFullScreenCloseFrameArea(),this.moveUpAction(),this.destroyCloseFrameHint(),this.moveToOriginalAction())),new Promise(function(t){return e.scheduleOnce(t,e._showcaseDuration)})},t.prototype.createCloseFrameHint=function(){var e=this;return cc.callFunc(function(){cc.isValid(e._fullScreenCloseHint)&&e._fullScreenCloseHint.destroy();var t=u.default.assets.getSingleAsset("Common/Prefabs/CloseIcon"),n=e._fullScreenCloseHint=cc.instantiate(t),r=e.getComponentInChildren(cc.Mask);n.setParent(r?r.node:e.node),n.setContentSize(50,50);var o=n.addComponent(cc.Widget);o.isAlignTop=o.isAlignRight=!0,o.top=o.right=20,o.updateAlignment(),o.destroy()})},t.prototype.destroyCloseFrameHint=function(){var e=this;return cc.callFunc(function(){cc.isValid(e._fullScreenCloseHint)&&e._fullScreenCloseHint.destroy(),e._fullScreenCloseHint=null})},t.prototype.createFullScreenCloseFrameArea=function(){var e=this;return cc.callFunc(function(){cc.isValid(e._fullScreenCloseFrameArea)&&e._fullScreenCloseFrameArea.destroy();var t=e._fullScreenCloseFrameArea=new cc.Node(e.node.name+" Closer");t.setParent(u.default.uiCamera.node);var n=t.addComponent(y.default);n.alignToScreenX=!0,n.alignToScreenY=!0,n.resizeToScreen=!0,n.camera=u.default.uiCamera,n.apply();var r=t.addComponent(v.default);d.ensureEventHandler(r.clickEvents,{target:e.node,component:d.nameOfComponent(e),handler:"disableShowcase"})})},t.prototype.destroyFullScreenCloseFrameArea=function(){var e=this;return cc.callFunc(function(){cc.isValid(e._fullScreenCloseFrameArea)&&e._fullScreenCloseFrameArea.destroy(),e._fullScreenCloseFrameArea=null})},t.prototype.disableOtherShowcasedFrames=function(){var e,t,r=this,o=d.getComponentsInScene(n).filter(function(e){return e!==r});try{for(var i=a(o),s=i.next();!s.done;s=i.next()){s.value.disableShowcase()}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype.moveUpAction=function(){var e=this,t=.5*this._showcaseDuration,n=cc.view.getFrameSize(),r=this.node.getContentSize();return cc.sequence(cc.callFunc(function(){e.node.setSiblingIndex(e.node.parent.childrenCount-1)}),cc.moveBy(t,0,n.height+.5*r.height))},t.prototype.moveToOriginalAction=function(){var e=this,t=.5*this._showcaseDuration,n=this.canvasSize;return cc.sequence(cc.callFunc(function(){if(!cc.isValid(e._originalParent,!0))return e.node.destroy();e._showcaseScaleNode&&(e._showcaseScaleNode.scale/=n.width/e._originalSize.width),e.node.setParent(e._originalParent),e.node.x=e._originalPosition.x,e.node.angle=e._originalAngle,e.setSize(e._originalSize.width,e._originalSize.height)}),cc.moveTo(t,this._originalPosition.x,this._originalPosition.y))},Object.defineProperty(t.prototype,"canvasSize",{get:function(){var e=d.getComponentInParents(this.node,cc.Canvas);return e?e.designResolution:b},enumerable:!0,configurable:!0}),t.prototype.moveToShowcaseAction=function(){var e=this,t=cc.view.getFrameSize(),n=this.node.getContentSize(),r=this.canvasSize,o=.5*this._showcaseDuration;return cc.sequence(cc.callFunc(function(){if(!cc.isValid(e._originalParent,!0))return e.node.destroy();e.node.setParent(cc.Camera.main.node),e.node.setPosition(0,t.height+n.height),e.node.angle=e.node.angle*(1-e._frameAngleNerfFactor),e._showcaseScaleNode&&(e._showcaseScaleNode.scale*=r.width/e._originalSize.width),e.setSize(r.width-20,r.height-20)}),cc.moveTo(o,0,0))},t.prototype.setSize=function(e,t){var n,r;this.node.width=e,this.node.height=t;try{for(var o=a(this.node.getComponentsInChildren(cc.Widget)),i=o.next();!i.done;i=o.next()){i.value.updateAlignment()}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}var s=this.node.getComponentInChildren(l.default);s&&s.fitDrawing()},i([m({visible:w})],t.prototype,"_autoLoad",void 0),i([m({visible:!0,min:0,max:5,slide:!0})],t.prototype,"_showcaseDuration",void 0),i([m({visible:!0,tooltip:"Sound that will be played when zooming in."})],t.prototype,"_showcaseSound",void 0),i([m({type:cc.Node,visible:!0,tooltip:"Scale a node according to the heigh/width difference when switching to showcase mode.\n\nUseful if a nested Drawing spot is not using a content size, "})],t.prototype,"_showcaseScaleNode",void 0),i([m({visible:!0,tooltip:"Amount by which the angle of a frame is red",slide:!0,min:0,max:1})],t.prototype,"_frameAngleNerfFactor",void 0),t=n=i([g],t)}(c.default);n.default=S,cc._RF.pop()},{"../../Drawing/DrawingSpot":"DrawingSpot","../../Framework/GameComponent":"GameComponent","../../Framework/GameManager":"GameManager","../../Generic/Hider":"Hider","../../UI/Button":"Button","../../UI/ScreenWidget":"ScreenWidget","../../Util":"index","../../constants":"constants","./Room":"Room"}],GameComponent:[function(e,t,n){"use strict";cc._RF.push(t,"9fff33TS3lIw4BgkmNqp+Xp","GameComponent");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator.ccclass;n.$$gameManagerRef=Symbol("game-manager-ref-assigned-inside-GameManager.ts-to-prevent-circular-dependency-error");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return r(t,e),a=t,t.prototype.onRegisterStores=function(){},t.prototype.onGameLoad=function(e){},t.prototype.onGameStart=function(){},t.prototype.onSceneEnd=function(e){},t.prototype.onScenePreLoad=function(e){},t.prototype.onSceneStart=function(e){},t.prototype.__preload=function(){var e=this,t=a[n.$$gameManagerRef];if(t){var r=function(){e.node&&e.onGameStart()};t.initialized?r():t.untilInitialized.then(r)}},t[n.$$gameManagerRef]=null,t=a=o([i],t)}(cc.Component);n.default=a,cc._RF.pop()},{}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"7728bRu8vhMRbvKNj8RN+bI","GameManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},u=this;Object.defineProperty(n,"__esModule",{value:!0});var d=e("../Util"),p=c(e("../Drawing/DrawingUI")),f=l(e("./GameComponent")),h=c(e("./Storage")),y=c(e("../Drawing/DrawingStorage")),v=c(e("./AssetLoader")),_=c(e("./Audio")),g=c(e("./Analytics")),m=c(e("./Captions")),b=c(e("./LoadingScreen")),w=e("../constants");var S=cc._decorator,O=S.menu,P=S.ccclass,C=S.property,x=S.disallowMultiple,R=S.executeInEditMode,k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._forceLowEndDeviceMode=!1,t._fakeLowFrameRate=!1,t._uiCamera=null,t._mainCamera=null,t._drawingUI=null,t._storage=null,t._drawingStorage=null,t._assets=null,t._audio=null,t._analytics=null,t._captions=null,t._loadingScreen=null,t._isLowEndDevice=!1,t._currentSceneName="Start",t._manualPause=!1,t._autoPause=!1,t._initialized=!1,t.onSpringRollPause=function(e){t._manualPause=e,t.updatePause()},t}var n;return r(t,e),n=t,Object.defineProperty(t,"instance",{get:function(){if(!this._instance)throw new Error("Do not call GameManager methods or properties until the Game Manager has been initialized. Use the onGameInitialized GameComponent lifecycle method.");return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t,"uiCamera",{get:function(){if(this.instance._uiCamera||(this.instance._uiCamera=this.instance.getComponentInChildren(cc.Camera)),!cc.isValid(this.instance._uiCamera))throw new Error("The UI Camera is not accessible from the GameManager. Check to ensure the GameManager prefab has not beed corrupted.");return this.instance._uiCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mainCamera",{get:function(){return this.instance._mainCamera&&cc.isValid(this.instance._mainCamera)||(this.instance._mainCamera=cc.Camera.main),this.instance._mainCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t,"drawingUI",{get:function(){if(!this.instance._drawingUI||!cc.isValid(this.instance._drawingUI))throw new Error("The DrawingUI is not accessible from the GameManager. It should be instanced by the GameManager during initialization, and placed under the ui camera.");return this.instance._drawingUI},enumerable:!0,configurable:!0}),Object.defineProperty(t,"storage",{get:function(){return this.instance._storage&&cc.isValid(this.instance._storage)||(this.instance._storage=this.instance.getComponentInChildren(h.default)),this.instance._storage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"drawingStorage",{get:function(){return this.instance._drawingStorage&&cc.isValid(this.instance._drawingStorage)||(this.instance._drawingStorage=this.instance.getComponentInChildren(y.default)),this.instance._drawingStorage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"assets",{get:function(){return this.instance._assets&&cc.isValid(this.instance._assets)||(this.instance._assets=this.instance.getComponentInChildren(v.default)),this.instance._assets},enumerable:!0,configurable:!0}),Object.defineProperty(t,"audio",{get:function(){return this.instance._audio&&cc.isValid(this.instance._audio)||(this.instance._audio=this.instance.getComponentInChildren(_.default)),this.instance._audio},enumerable:!0,configurable:!0}),Object.defineProperty(t,"analytics",{get:function(){return this.instance._analytics&&cc.isValid(this.instance._analytics)||(this.instance._analytics=this.instance.getComponentInChildren(g.default)),this.instance._analytics},enumerable:!0,configurable:!0}),Object.defineProperty(t,"captions",{get:function(){return cc.isValid(this.instance._captions)||(this.instance._captions=this.instance.getComponentInChildren(m.default)),this.instance._captions},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loadingScreen",{get:function(){return cc.isValid(this.instance._loadingScreen)||(this.instance._loadingScreen=this.instance.getComponent(b.default)),this.instance._loadingScreen},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isLowEndDevice",{get:function(){return this.instance._isLowEndDevice},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isPaused",{get:function(){return cc.director.isPaused()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentSceneName",{get:function(){return this.instance._currentSceneName},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentStoryName",{get:function(){return this.currentSceneName.includes("_")?this.currentSceneName.split("_")[0]:""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"initialized",{get:function(){return!!this._instance&&this._instance._initialized},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return cc.game.addPersistRootNode(this.node),this.determineLowEndDevice(),[4,this.setupStorage()];case 1:return e.sent(),[4,this.setupGameComponents()];case 2:return e.sent(),this.ensureDrawingUI(),this.handleSpringRollPause(),this.handleWindowFocus(),this._initialized=!0,[2]}})})},t.prototype.handleSpringRollPause=function(){cc.springRoll&&(cc.springRoll.pause.subscribe(this.onSpringRollPause),this.onSpringRollPause(cc.springRoll.pause.value))},t.prototype.handleWindowFocus=function(){var e=this;try{window.addEventListener("blur",function(){e._autoPause=!0,e.updatePause()}),window.addEventListener("focus",function(){e._autoPause=!1,e.updatePause()})}catch(e){}},t.prototype.determineLowEndDevice=function(){this._isLowEndDevice=d.PlatformDetect.isLowSpecMobileDevice(),this._isLowEndDevice&&cc.log("initialized as a low end device")},t.prototype.ensureDrawingUI=function(){if(this._drawingUI=d.getComponentInScene(p.default),!this._drawingUI){var e=n.assets.getSingleAsset("Drawing/DrawingUI");this._drawingUI=cc.instantiate(e).getComponent(p.default)}this._drawingUI.node.setParent(n.uiCamera.node),this._drawingUI.node.setPosition(cc.Vec2.ZERO),this._drawingUI.node.group=w.UI_NODE_GROUP},t.prototype.setupStorage=function(){return i(this,void 0,Promise,function(){var e,t,r,o,i,c,l;return a(this,function(a){switch(a.label){case 0:return r="onRegisterStores",[4,Promise.all(d.getComponentsInScene(f.default).map(function(e){return e[r]()}))];case 1:(o=a.sent()).push([w.UI_STORE_KEY]);try{for(i=s(o),c=i.next();!c.done;c=i.next())(l=c.value)&&n.storage.registerStores(l)}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return[4,n.storage.initializeStores()];case 2:return a.sent(),[2]}})})},t.prototype.setupGameComponents=function(){return i(this,void 0,Promise,function(){var e,t=this;return a(this,function(n){switch(n.label){case 0:return e="onGameLoad",[4,Promise.all(d.getComponentsInScene(f.default).map(function(n){return n[e](t._isLowEndDevice)}))];case 1:return n.sent(),[2]}})})},t.prototype.onLoad=function(){var e=cc.director.getScene();e&&(this._currentSceneName=e.name),this.node.parent instanceof cc.Scene==!1&&(this.node.setParent(cc.director.getScene()),cc.warn(d.nameOfComponent(this)+" should only ever be a root-level component")),this===(n._instance||d.getComponentsInScene(n)[0])||(this.node.destroy(),cc.error("Only one instance of the "+d.nameOfComponent(this)+" should ever exist.")),this.startingSceneLifeCycleHook()},t.prototype.update=function(e){},t.prototype.preloadScene=function(e,t){return i(this,void 0,Promise,function(){var n,r;return a(this,function(o){switch(o.label){case 0:if(!(n=e instanceof cc.Event.EventTouch?t:e))throw new Error("requires a scene name.");return[4,new Promise(function(e,t){return cc.director.preloadScene(n,function(){},function(n,r){return n?t(n):e(r)})})];case 1:return r=o.sent().scene,[4,this.sceneLifeCycleHook("onScenePreLoad",r.getComponentsInChildren(f.default),r)];case 2:return o.sent(),[2,r]}})})},t.preloadScene=function(e){return this.instance.preloadScene(e)},t.prototype.loadScene=function(e,t){return i(this,void 0,Promise,function(){var n,r=this;return a(this,function(o){switch(o.label){case 0:if(!(n=e instanceof cc.Event.EventTouch?t:e))throw new Error("Name of scene required.");return[4,this.sceneLifeCycleHook("onSceneEnd")];case 1:return o.sent(),[4,new Promise(function(e){return cc.director.loadScene(n,function(){r._currentSceneName=n,r.sceneLifeCycleHook("onSceneStart").then(e)})})];case 2:return o.sent(),[2]}})})},t.loadScene=function(e){return this.instance.loadScene(e)},t.prototype.updatePause=function(){var e=this._autoPause||this._manualPause;e?(cc.audioEngine.pauseAll(),cc.director.pause()):(cc.director.resume(),cc.audioEngine.resumeAll())},t.prototype.startingSceneLifeCycleHook=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,n.untilInitialized];case 1:return e.sent(),[4,d.asyncSchedule(this,w.ONE_FRAME)];case 2:return e.sent(),[2,this.sceneLifeCycleHook("onSceneStart")]}})})},t.prototype.sceneLifeCycleHook=function(e,t,n){return void 0===t&&(t=d.getComponentsInScene(f.default)),void 0===n&&(n=cc.director.getScene()),i(this,void 0,Promise,function(){var r,o,i,c,l,u,d;return a(this,function(a){switch(a.label){case 0:i=[];try{for(c=s(t),l=c.next();!l.done;l=c.next())u=l.value,(d=u[e](n))instanceof Promise&&i.push(d)}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}return[4,Promise.all(i)];case 1:return a.sent(),[2]}})})},t.untilInitialized=i(u,void 0,void 0,function(){var e,t,r;return a(this,function(o){switch(o.label){case 0:return[4,new Promise(function(e){return cc.director.once(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,e)})];case 1:return o.sent(),(e=d.getComponentInScene(n))?[3,3]:[4,new Promise(function(e){return cc.loader.loadRes("GameManager",cc.Prefab,function(t,n){return e(n)})})];case 2:t=o.sent(),(r=cc.instantiate(t)).setParent(cc.director.getScene()),e=r.getComponent(n),o.label=3;case 3:return n._instance=e,[4,e.initialize()];case 4:return o.sent(),[2,!0]}})}),o([C({tooltip:"Forces game to use low end device assets. Only for testing in development. Will be ignored in the build.",visible:!0})],t.prototype,"_forceLowEndDeviceMode",void 0),o([C({tooltip:"Fakes a low framerate. Only for testing in development. Will be ignored in the build.",visible:!0})],t.prototype,"_fakeLowFrameRate",void 0),t=n=o([P,R,x,O("Scribbles And Ink/Framework/Game Manager")],t)}(cc.Component);f.default[f.$$gameManagerRef]=k,n.default=k,cc._RF.pop()},{"../Drawing/DrawingStorage":"DrawingStorage","../Drawing/DrawingUI":"DrawingUI","../Util":"index","../constants":"constants","./Analytics":"Analytics","./AssetLoader":"AssetLoader","./Audio":"Audio","./Captions":"Captions","./GameComponent":"GameComponent","./LoadingScreen":"LoadingScreen","./Storage":"Storage"}],Hider:[function(e,t,n){"use strict";cc._RF.push(t,"e8fe57NSdJHMqafR+i9dM8V","Hider");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./Transfomer")),c=cc._decorator,l=c.menu,u=c.ccclass,d=c.property,p=c.disallowMultiple,f=c.executeInEditMode,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.showTransformer=null,t.hideTransformer=null,t}return r(t,e),t.prototype.setEnabledImmediate=function(e){var t=i(this.getTransformers(),2),n=t[0],r=t[1],o=e?r:n;this.enabled=e,o.apply(1)},t.prototype.onEnable=function(){this.setTransformersEnabled()},t.prototype.onDisable=function(){this.setTransformersEnabled()},t.prototype.setTransformersEnabled=function(){var e=i(this.getTransformers(),2),t=e[0],n=e[1];t.enabled=!this.enabled,n.enabled=this.enabled},t.prototype.getTransformers=function(){var e=this;if(!this.showTransformer||!this.hideTransformer){var t=this.getComponents(s.default).filter(function(t){return t!==e.showTransformer&&t!==e.hideTransformer});this.showTransformer=this.showTransformer||t.shift()||this.addTransformer(!1),this.hideTransformer=this.hideTransformer||t.shift()||this.addTransformer(!0)}return[this.showTransformer,this.hideTransformer]},t.prototype.addTransformer=function(e){var t=this.addComponent(s.default);return t.transformStrategy=s.default.Strategy.Values,t.applyAngle=t.applyColor=t.applyOpacity=t.applyPosition=!1,t.applyScale=!0,t.scale=e?0:this.node.scale,t},o([d({type:s.default,tooltip:"Transformation to use when the hider is disabled.Will create a scale-up transformer if empty."})],t.prototype,"showTransformer",void 0),o([d({type:s.default,tooltip:"Transformation to use when the hider is enabled.Will create a scale-down transformer if empty."})],t.prototype,"hideTransformer",void 0),t=o([u,p,f,l("Scribbles And Ink/Generic/Hider")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"./Transfomer":"Transfomer"}],HomeStoryManager:[function(e,t,n){"use strict";cc._RF.push(t,"0b8c4hG5g5M441Ghk2rp9TG","HomeStoryManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../../Framework/StoryManager")),l=s(e("../../Framework/GameManager")),u=s(e("./Costume")),d=s(e("./RaceCar")),p=e("../../Util"),f=cc._decorator,h=f.ccclass,y=f.property;function v(e,t){return Math.abs(e-t)<1e-7}var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boxColor=cc.Color.WHITE,t}return r(t,e),t.prototype.prepareCostumeDrawing=function(){var e=l.default.drawingUI,t=l.default.mainCamera,n=e.currentDrawing;n&&(n.node.scale*=Math.sqrt(t.zoomRatio),n.node.color=this.boxColor)},t.prototype.saveCostumeDrawing=function(e,t){return i(this,void 0,Promise,function(){var n,r;return a(this,function(o){switch(o.label){case 0:if(!(n="string"==typeof e?e:t))throw new Error("Character name required");if(l.default.drawingUI,!(r=p.getComponentsInScene(u.default).find(function(e){return e.character&&e.character.node.name===n})))throw new Error("Could not find costume for '"+n+"'");return[4,this.attachDrawingAndCompleteBlock(r.drawingSpot)];case 1:return o.sent(),[2]}})})},t.prototype.saveRaceCarDrawing=function(){return i(this,void 0,Promise,function(){var e;return a(this,function(t){switch(t.label){case 0:if(!(e=p.getComponentInScene(d.default)))throw new Error("RaceCar could not be found in Scene");return l.default.drawingUI,[4,this.attachDrawingAndCompleteBlock(e.drawingSpot)];case 1:return t.sent(),[2]}})})},t.prototype.attachDrawingAndCompleteBlock=function(e){return i(this,void 0,Promise,function(){var t,n;return a(this,function(r){switch(r.label){case 0:if(t=l.default.drawingUI,!(n=t.currentDrawing))throw new Error("Can't save, drawingUI does not have a drawing.");return n.node.setParent(e.node),[4,t.saveDrawing()];case 1:return r.sent(),t.currentDrawing=null,this.currentStoryBlock&&this.currentStoryBlock.completeAndAdanvce(),[2]}})})},t.prototype.checkDrawingSpotCoordinates=function(e,t){e.node.setParent(l.default.mainCamera.node);var n=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),r=t.node.parent.convertToNodeSpaceAR(n),o=t.node,i=t.node.parent,a=1/l.default.mainCamera.zoomRatio,s=a*(i.scaleX>0?-1:1),c=a*(i.scaleY>0?-1:1),u=p.lerpAngle(-i.angle,360-i.angle),d=p.lerpAngle(o.angle,o.angle+360),f=[];v(o.scaleX,s)||f.push("scaleX "+o.scaleX+" should be "+s),v(o.scaleY,c)||f.push("scaleY "+o.scaleY+" should be "+c),v(d,u)||f.push("angle "+d+" should be "+u),v(o.position.x,r.x)||f.push("positionX "+o.position.x+" should be "+r.x),v(o.position.y,r.y)||f.push("positionY "+o.position.y+" should be "+r.y),f.length>0&&cc.warn("Drawing Anchor for Drawing Spot "+i.name+" is incorrect. Costume drawing will not match it's camera drawn coordinates:\n"+f.join("\n"))},o([y(cc.Color)],t.prototype,"boxColor",void 0),t=o([h],t)}(c.default);n.default=_,cc._RF.pop()},{"../../Framework/GameManager":"GameManager","../../Framework/StoryManager":"StoryManager","../../Util":"index","./Costume":"Costume","./RaceCar":"RaceCar"}],LevelOfDetailSprites:[function(e,t,n){"use strict";cc._RF.push(t,"27153BQBWZDl4YITwdBxo0F","LevelOfDetailSprites");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.disallowMultiple,c=i.property,l=i.menu,u=i.executeInEditMode,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spriteFrameList=[],t}return r(t,e),t.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite)||this.addComponent(cc.Sprite),this.sprite.spriteFrame||(this.sprite.spriteFrame=this.spriteFrameList[0])},t.prototype.switchLevel=function(e){var t=this.spriteFrameList.length-1,n=e>t?t:e;this.sprite.spriteFrame=this.spriteFrameList[n]},o([c({type:[cc.SpriteFrame],tooltip:"List of spriteframes to be switched between."})],t.prototype,"spriteFrameList",void 0),t=o([a,s,u,l("Scribbles And Ink/Generic/Level Of Detail Sprite")],t)}(cc.Component);n.default=d,cc._RF.pop()},{}],LevelOfDetail:[function(e,t,n){"use strict";cc._RF.push(t,"cd4b3OrvR9Bz7on+4ZXRpJS","LevelOfDetail");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./LevelOfDetailSprites")),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.menu,p=c.property,f=c.executeInEditMode,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scales=[],t._lastLevel=0,t._levelOfDetailSprites=null,t._callbacks=[],t}return r(t,e),Object.defineProperty(t.prototype,"levelOfDetailSprites",{get:function(){return this._levelOfDetailSprites||(this._levelOfDetailSprites=this.getComponentsInChildren(s.default)),this._levelOfDetailSprites},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.switchOnScaleChanged()},t.prototype.subscribe=function(e){this._callbacks.push(e)},t.prototype.unsubscribe=function(e){this._callbacks=this._callbacks.filter(function(t){return t!==e})},t.prototype.switchLevel=function(e){var t,n,r,o;try{for(var a=i(this.levelOfDetailSprites),s=a.next();!s.done;s=a.next()){s.value.switchLevel(e)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}try{for(var c=i(this._callbacks),l=c.next();!l.done;l=c.next()){(0,l.value)(e,this.scales[e])}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}},t.prototype.switchOnScaleChanged=function(){var e=this,t=this.node.scale;t>=this.scales[this.scales.length-1]?this._lastLevel!==this.scales.length&&(this.switchLevel(this.scales.length),this._lastLevel=this.scales.length):this.scales.forEach(function(n,r){var o=!e.scales[r-1]||t>e.scales[r-1];t<=n&&o&&e._lastLevel!==r&&(e.switchLevel(r),e._lastLevel=r)})},o([p({type:[cc.Float],tooltip:"An array of scales that coresponds to array of spirite frames in LevelOfDetailSprites components."})],t.prototype,"scales",void 0),t=o([l,u,f,d("Scribbles And Ink/Generic/Level Of Detail")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"./LevelOfDetailSprites":"LevelOfDetailSprites"}],LoadingScreen:[function(e,t,n){"use strict";cc._RF.push(t,"b0d4c6VbTdL1bX8kPdKkV2y","LoadingScreen");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});i(e("./GameManager"));var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._framesDelay=5,t._frameDelayBuffer=0,t}return r(t,e),t.prototype.onEnable=function(){this._frameDelayBuffer=0},t.prototype.onDisable=function(){cc.game.setLoadingScreenVisible(!1)},t.prototype.update=function(){this._frameDelayBuffer<this._framesDelay?this._frameDelayBuffer++:cc.game.isLoadingScreenVisible()||cc.game.setLoadingScreenVisible(!0)},o([c({visible:!0})],t.prototype,"_framesDelay",void 0),t=o([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{"./GameManager":"GameManager"}],MessEraser:[function(e,t,n){"use strict";cc._RF.push(t,"d1f57FjCydDwaG6COXBQZGh","MessEraser");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../../Drawing/DrawingHandler")),l=s(e("../../Framework/GameManager")),u=e("../../Util"),d=cc._decorator.ccclass,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._collider=null,t.erasedNodes=new Map,t}return r(t,e),Object.defineProperty(t.prototype,"collider",{get:function(){return this._collider||(this._collider=this.getComponent(cc.CircleCollider)||this.addComponent(cc.CircleCollider)),this._collider},enumerable:!0,configurable:!0}),t.prototype.onCollisionEnter=function(e){var t=e.node;this.erasedNodes.has(t)||(this.erasedNodes.set(t,[t.scaleX,t.scaleY]),t.runAction(cc.scaleTo(.25,0,0)))},t.prototype.onStrokeMove=function(e){var t=l.default.drawingUI.currentTool;if(t&&"Eraser"===t.node.name){var n=this.node.parent.convertToNodeSpaceAR(e);this.node.setPosition(n),this.collider.radius=t.getInheritedSplatSize()}},t.prototype.eraseNodes=function(){var e,t,n=this,r=u.getComponentsInScene(cc.Collider).filter(function(e){return e!==n.collider});try{for(var o=i(r),a=o.next();!a.done;a=o.next()){var s=a.value;this.onCollisionEnter(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype.uneraseNodes=function(){var e,t;this.node.x=NaN,this.node.y=NaN;try{for(var n=i(this.erasedNodes),r=n.next();!r.done;r=n.next()){var o=a(r.value,2),s=o[0],c=o[1];s.scaleX=c[0],s.scaleY=c[1]}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.erasedNodes.clear()},t=o([d],t)}(c.default);n.default=p,cc._RF.pop()},{"../../Drawing/DrawingHandler":"DrawingHandler","../../Framework/GameManager":"GameManager","../../Util":"index"}],MoveEmittedInstances:[function(e,t,n){"use strict";cc._RF.push(t,"4f19cP141tEQ7Qchuo+c+FO","MoveEmittedInstances");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a,s=i(e("./PrefabEmitter")),c=e("../Util"),l=cc._decorator,u=l.ccclass,d=l.property,p=l.menu,f=l.requireComponent,h=cc.size(960,640);function y(){var e=cc.view.getFrameSize(),t=e.width,n=e.height,r=cc.view.getScaleX(),o=cc.view.getScaleY();return cc.size(t/r,n/o)}function v(e){var t=y(),n=e.clone(),r=c.getComponentInScene(cc.Canvas),o=r?r.designResolution:h;return n.x*=Math.max(t.width,o.width)/o.width,n.y*=Math.max(t.height,o.height)/o.height,n}(function(e){e[e.Once=0]="Once",e[e.Repeat=1]="Repeat",e[e.PingPong=2]="PingPong",e[e.Destroy=3]="Destroy"})(a||(a={}));var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.velocity=cc.Vec2.ZERO,t.multiplyVelocityByScreenSize=!1,t.moveStrategy=a.Repeat,t.durationMin=0,t.durationMax=1,t.lerpDurationByScale=!1,t}return r(t,e),t.prototype.start=function(){this.node.on(s.default.EventType.Emit,this.moveEmittedInstance,this)},t.prototype.onDestroy=function(){this.node.off(s.default.EventType.Emit,this.moveEmittedInstance,this)},t.prototype.moveEmittedInstance=function(e){if(this.enabled&&this.enabledInHierarchy){var t=this.lerpDurationByScale?cc.misc.lerp(this.durationMin,this.durationMax,1-e.scale):c.Random.float(this.durationMin,this.durationMax),n=this.multiplyVelocityByScreenSize?v(this.velocity):this.velocity;e.runAction(this.getMoveAction(t,n,e))}},t.prototype.getMoveAction=function(e,t,n){var r=cc.moveBy(e,t);if(this.moveStrategy===a.Once)return r;if(this.moveStrategy===a.Destroy)return cc.sequence(r,cc.callFunc(n.destroy,n));var o=this.moveStrategy===a.PingPong?e:0;return cc.sequence(r,cc.moveTo(o,n.position.clone())).repeatForever()},o([d()],t.prototype,"velocity",void 0),o([d()],t.prototype,"multiplyVelocityByScreenSize",void 0),o([d({type:cc.Enum(a)})],t.prototype,"moveStrategy",void 0),o([d()],t.prototype,"durationMin",void 0),o([d()],t.prototype,"durationMax",void 0),o([d()],t.prototype,"lerpDurationByScale",void 0),t=o([u,f(s.default),p("Scribbles And Ink/Generic/Move Emitted Instances")],t)}(cc.Component);n.default=_,cc._RF.pop()},{"../Util":"index","./PrefabEmitter":"PrefabEmitter"}],NavigationButton:[function(e,t,n){"use strict";cc._RF.push(t,"48bf6NjAF5Ag7WEDw93u3AR","NavigationButton");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../Framework/GameManager")),l=cc._decorator,u=l.ccclass,d=l.menu,p=l.disallowMultiple,f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.goToScene=function(e,t){return i(this,void 0,Promise,function(){var n;return a(this,function(r){switch(r.label){case 0:if(!(n=e instanceof cc.Event.EventTouch?t:e))throw new Error("Scene Name is required.");return[4,c.default.preloadScene(n)];case 1:return r.sent(),[4,c.default.loadScene(n)];case 2:return r.sent(),[2]}})})},t=o([u,p,d("Scribbles And Ink/UI/Navigation Button")],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Framework/GameManager":"GameManager"}],Note:[function(e,t,n){"use strict";cc._RF.push(t,"ec6c03lAIhOcacvsrDXzuS/","Note");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.menu,c=i.property,l=i.executeInEditMode,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.note="",t.placeInLabel=!1,t}return r(t,e),t.prototype.update=function(){var e=this.node.getChildByName(this.node.name+"-Label");e?e.destroy():e&&((e.getComponent(cc.Label)||e.addComponent(cc.Label)).string=this.note)},o([c({multiline:!0,editorOnly:!0,tooltip:"This component doesn't do anything. It is just for placing notes for developers to understand how/why nodes are configured."})],t.prototype,"note",void 0),o([c({editorOnly:!0,tooltip:"Automatically place this note into a label in the editor."})],t.prototype,"placeInLabel",void 0),t=o([a,l,s("Scribbles And Ink/Development/Note")],t)}(cc.Component);n.default=u,cc._RF.pop()},{}],Override2DRenderMaterial:[function(e,t,n){"use strict";cc._RF.push(t,"a2a1dVmFh5As7nxEw5cEg1f","Override2DRenderMaterial");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=a.executionOrder,u=a.menu,d=a.disallowMultiple,p=["_USE_MODEL","USE_ALPHA_TEST","USE_TEXTURE"],f=["texture","alphaThreshold"];function h(){return!!this.getComponent(cc.Sprite)}var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.material=null,t._overrideSpriteBlend=!0,t._renderer=null,t._materialInstance=null,t._materialOriginal=null,t}return r(t,e),t.prototype.onLoad=function(){var e=this.getComponent(cc.RenderComponent);if(e){if(!(e instanceof cc.Sprite||e instanceof cc.Graphics||e instanceof cc.Label))throw new Error(e.name+" is not a 2D render component");this._renderer=e}},t.prototype.onEnable=function(){this._renderer&&(this._renderer instanceof cc.Sprite&&this.setSpriteMaterialBlendingOverridden(!0),this.setRenderMaterialOverridden(!0))},t.prototype.onDisable=function(){this._renderer&&(this._renderer instanceof cc.Sprite&&this.setSpriteMaterialBlendingOverridden(!1),this.setRenderMaterialOverridden(!1))},t.prototype.setSpriteMaterialBlendingOverridden=function(e){this._renderer&&this._overrideSpriteBlend&&(this._renderer.setMaterial=e?cc.RenderComponent.prototype.setMaterial:cc.Sprite.prototype.setMaterial)},t.prototype.setRenderMaterialOverridden=function(e){this._renderer&&(this._materialOriginal||(this._materialOriginal=this._renderer._materials[0]),this._materialOriginal&&(this._materialInstance||(this._materialInstance=this.createInstanceMaterial()),this._renderer.setMaterial(0,e?this._materialInstance:this._materialOriginal)))},t.prototype.createInstanceMaterial=function(){var e,t,n,r;if(!this.material||!this._materialOriginal||!this._renderer)throw new Error("createInstanceMaterial internal state error.");var o=cc.Material.getInstantiatedMaterial(this.material,this._renderer);try{for(var a=i(p),s=a.next();!s.done;s=a.next()){var c=s.value;void 0!==(d="_USE_MODEL"===c?this._renderer instanceof cc.Graphics:this._materialOriginal.getDefine(c))&&o.define(c,d)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}try{for(var l=i(f),u=l.next();!u.done;u=l.next()){var d,h=u.value;void 0!==(d=this._materialOriginal.getProperty(h))&&o.setProperty(h,d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return o},o([c(cc.Material)],t.prototype,"material",void 0),o([c({tooltip:"cc.Sprite is always expected to use a specific material with specific blending. If a sprite material is being overridden sprite blending may want to be over-ridden as well.",visible:h})],t.prototype,"_overrideSpriteBlend",void 0),t=o([s,d,l(10),u("Scribbles And Ink/Generic/Override 2D Render Material")],t)}(cc.Component);n.default=y,cc._RF.pop()},{}],PartyGuestMover:[function(e,t,n){"use strict";cc._RF.push(t,"eda6aYO+Y9H+LjMGXo24mvG","PartyGuestMover");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../Util"),a=cc._decorator,s=a.ccclass,c=a.property,l=a.executeInEditMode,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skew=1.6,t.shrink=.9,t.rotate=10,t.distance=24,t.moveDuration=.8,t.jumpAroundMinRadius=0,t.jumpAroundMaxRadius=20,t.jumpAroundMaxDistanceMoved=70,t.jumpAroundTime=.7,t.scaleTo=1,t.initialLift=0,t.jumpedAroundDistance=0,t}return r(t,e),t.prototype.startMoving=function(e){void 0===e&&(e=!0);var t=cc.spawn(cc.moveBy(this.moveDuration/3,cc.v2(0,this.distance)),cc.scaleTo(this.moveDuration/2,this.scaleTo)),n=cc.spawn(cc.moveBy(this.moveDuration/3,cc.v2(0,-this.distance)),cc.scaleTo(this.moveDuration/2,this.shrink*this.scaleTo),cc.skewTo(this.moveDuration/2,0,0));this.node.runAction(cc.moveBy(.5,cc.v2(0,this.initialLift))),this.node.runAction(cc.repeatForever(cc.sequence(cc.spawn(t.clone(),cc.rotateTo(this.moveDuration/2,this.rotate),cc.skewTo(this.moveDuration/2,this.skew,0)),n.clone(),cc.spawn(t.clone(),cc.rotateTo(this.moveDuration/2,-this.rotate),cc.skewTo(this.moveDuration/2,-this.skew,0)),n.clone()))),e&&this.schedule(this.randomlyMoveAround,this.jumpAroundTime+.3)},t.prototype.stopMoving=function(){this.node.stopAllActions(),this.unschedule(this.randomlyMoveAround)},t.prototype.randomlyMoveAround=function(){var e=Math.random()>.5?1:-1,t=i.Random.float(this.jumpAroundMinRadius,this.jumpAroundMaxRadius)*e;Math.abs(this.jumpedAroundDistance+t)>this.jumpAroundMaxDistanceMoved&&(t*=-1),this.node.runAction(cc.moveBy(this.jumpAroundTime,cc.v2(t,0))),this.jumpedAroundDistance+=t},o([c({tooltip:"Sets the x skew of the node while in the top position jumping motion.",min:0,max:40,slide:!0})],t.prototype,"skew",void 0),o([c({tooltip:"Sets how much the node shrinks while in the bootom position of jumping motion",min:0,max:1,slide:!0})],t.prototype,"shrink",void 0),o([c({tooltip:"Sets how much the node rotates while jumping",min:0,max:45,slide:!0})],t.prototype,"rotate",void 0),o([c({tooltip:'Sets how high the node "jumps"',min:0,max:300,slide:!0})],t.prototype,"distance",void 0),o([c({tooltip:"Sets how long the jumping motion takes",min:.1,max:3,slide:!0})],t.prototype,"moveDuration",void 0),o([c({tooltip:"Minimum distance of one random move",min:20,max:200,slide:!0})],t.prototype,"jumpAroundMinRadius",void 0),o([c({tooltip:"Maximum distance of one random move",min:20,max:200,slide:!0})],t.prototype,"jumpAroundMaxRadius",void 0),o([c({tooltip:"Sets the maximum distance that the node is allowed to move away from it's initial position",min:0,max:500,slide:!0})],t.prototype,"jumpAroundMaxDistanceMoved",void 0),o([c({tooltip:"Time of one move of randomly moving around",min:0,max:2,slide:!0})],t.prototype,"jumpAroundTime",void 0),o([c()],t.prototype,"scaleTo",void 0),o([c()],t.prototype,"initialLift",void 0),t=o([s,l],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../../Util":"index"}],PartyGuest:[function(e,t,n){"use strict";cc._RF.push(t,"54df7ROPC5P0adFWCPv2ary","PartyGuest");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Drawing/DrawingSpot")),s=i(e("./PartyGuestMover")),c=e("../../Generic/ZOrderManager"),l=cc._decorator,u=l.ccclass,d=l.disallowMultiple,p=l.requireComponent,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._drawingSpot=void 0,t._zIndexNode=null,t}return r(t,e),Object.defineProperty(t.prototype,"drawingSpot",{get:function(){if(cc.isValid(this._drawingSpot)||(this._drawingSpot=this.getComponent(a.default)||void 0),!this._drawingSpot)throw new Error("PartyGuest requires a drawing spot");return this._drawingSpot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndexNode",{get:function(){return this._zIndexNode||(this._zIndexNode=this.node.getChildByName(c.Z_INDEX_NODE_NAME)),this._zIndexNode||(this._zIndexNode=new cc.Node(c.Z_INDEX_NODE_NAME),this._zIndexNode.setParent(this.node)),this._zIndexNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleMover",{get:function(){return this.getComponents(s.default)[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"danceMover",{get:function(){var e=this.getComponents(s.default);return e.length>1?e[1]:null},enumerable:!0,configurable:!0}),t.prototype.startIdle=function(){var e=this.idleMover;e&&(this.stopDanceAndIdle(),e.startMoving())},t.prototype.startDancing=function(){var e=this.danceMover;e&&(this.stopDanceAndIdle(),e.startMoving(!0))},t.prototype.stopDanceAndIdle=function(){var e=this.danceMover,t=this.idleMover;e&&e.stopMoving(),t&&t.stopMoving()},t=o([u,d,p(a.default)],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../Drawing/DrawingSpot":"DrawingSpot","../../Generic/ZOrderManager":"ZOrderManager","./PartyGuestMover":"PartyGuestMover"}],PartyStoryManager:[function(e,t,n){"use strict";cc._RF.push(t,"70eb0gbqDlKdoCZNjC42V5Q","PartyStoryManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("../../Framework/StoryManager")),u=c(e("../../Framework/GameManager")),d=c(e("./PartyGuest")),p=e("../../Util"),f=c(e("../../Drawing/DrawingSpot")),h=c(e("../../Character/PauseSkeletonOnDraw")),y=cc._decorator,v=y.ccclass,_=y.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fitDuration=1,t._partyGuest=null,t._snoogleDorf=null,t._partyFoodDrawingSpot=null,t}return r(t,e),Object.defineProperty(t.prototype,"partyGuest",{get:function(){if(!this._partyGuest)throw new Error("PartyGuest is not set in the inspector");return this._partyGuest},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snoogleDorf",{get:function(){if(!this._snoogleDorf)throw new Error("SnoogleDorf is not set in the inspector");return this._snoogleDorf},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partyFoodDrawingSpot",{get:function(){if(!this._partyFoodDrawingSpot)throw new Error("PartyFood is not set in the inspector");return this._partyFoodDrawingSpot},enumerable:!0,configurable:!0}),t.prototype.onSceneEnd=function(){u.default.drawingUI.confirmButton.enabled=!0,this.enableAllTools()},t.prototype.attachDrawingToPartyGuest=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.attachDrawingToSpotAndSave(this.partyGuest.drawingSpot)];case 1:return e.sent(),this.moveZIndexNode(this.partyGuest),[2]}})})},t.prototype.attachDrawingToSnoogleDorf=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.attachDrawingToSpotAndSave(this.snoogleDorf.drawingSpot)];case 1:return e.sent(),this.moveZIndexNode(this.snoogleDorf),[2]}})})},t.prototype.attachDrawingToPartyFood=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.attachDrawingToSpotAndSave(this.partyFoodDrawingSpot)];case 1:return e.sent(),[2]}})})},t.prototype.ensurePartyGuestDrawings=function(){var e,t;try{for(var n=s(p.getComponentsInScene(d.default)),r=n.next();!r.done;r=n.next()){var o=r.value;o!==this.snoogleDorf&&o!==this.partyGuest&&(o.drawingSpot.refreshDrawing(),this.moveZIndexNode(o))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.prepareEraseFoodDrawing=function(){var e,t,n=u.default.drawingUI;try{for(var r=s(n.tools),o=r.next();!o.done;o=r.next()){var i=o.value;"Eraser"!==i.node.name?i.node.active=!1:n.setCurrentTool(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.removeSkeletonDrawDisablersInLowEndDevices=function(){var e,t;if(u.default.isLowEndDevice)try{for(var n=s(this.getScribblesAndInk()),r=n.next();!r.done;r=n.next()){var o=r.value,i=o.skeleton&&o.skeleton.getComponent(h.default);i&&i.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.setDrawingConfirmable=function(e){u.default.drawingUI.confirmButton.enabled=e},t.prototype.ensureSkeletonDrawDisablersInLowEndDevices=function(){var e,t;if(u.default.isLowEndDevice)try{for(var n=s(this.getScribblesAndInk()),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.skeleton)o.skeleton.getComponent(h.default)||o.skeleton.addComponent(h.default)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.completeEraseFoodDrawing=function(){this.enableAllTools(),this.currentStoryBlock&&this.currentStoryBlock.completeAndAdanvce()},t.prototype.enableAllTools=function(){var e,t,n=u.default.drawingUI;try{for(var r=s(n.tools),o=r.next();!o.done;o=r.next()){o.value.node.active=!0}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.attachDrawingToSpotAndSave=function(e){return i(this,void 0,Promise,function(){var t,n,r;return a(this,function(o){switch(o.label){case 0:if(t=u.default.drawingUI,n=t.currentDrawing,r=t.storageKey,!n)throw new Error("No current drawing");if(e.storageKey!==r)throw new Error("Wrong storage key: "+e.storageKey+" should be "+r);return e.node.opacity=255,e.fitDrawing(n,this._fitDuration),[4,t.saveDrawing()];case 1:return o.sent(),t.currentDrawing=null,this.currentStoryBlock&&this.currentStoryBlock.completeAndAdanvce(),[2]}})})},t.prototype.moveZIndexNode=function(e){var t=e.zIndexNode,n=e.drawingSpot.drawing;t.x=0,t.y=n?n.node.scaleY*(.5*n.size.height)*-1:0},o([_({visible:!0})],t.prototype,"_fitDuration",void 0),o([_({visible:!0,type:d.default})],t.prototype,"_partyGuest",void 0),o([_({visible:!0,type:d.default})],t.prototype,"_snoogleDorf",void 0),o([_({visible:!0,type:f.default})],t.prototype,"_partyFoodDrawingSpot",void 0),t=o([v],t)}(l.default);n.default=g,cc._RF.pop()},{"../../Character/PauseSkeletonOnDraw":"PauseSkeletonOnDraw","../../Drawing/DrawingSpot":"DrawingSpot","../../Framework/GameManager":"GameManager","../../Framework/StoryManager":"StoryManager","../../Util":"index","./PartyGuest":"PartyGuest"}],PauseSkeletonOnDraw:[function(e,t,n){"use strict";cc._RF.push(t,"d8e61GPyXJA6IMyTDE7tfDs","PauseSkeletonOnDraw");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Drawing/DrawingHandler")),s=cc._decorator,c=s.ccclass,l=s.requireComponent,u=s.disallowMultiple,d=s.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._skeleton=null,t}return r(t,e),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._skeleton||(this._skeleton=this.getComponent(sp.Skeleton)),this._skeleton},enumerable:!0,configurable:!0}),t.prototype.onStrokeStart=function(){this.setPaused(!0)},t.prototype.onStrokeEnd=function(){this.setPaused(!1)},t.prototype.onDrawDisabled=function(){this.setPaused(!1)},t.prototype.setPaused=function(e){var t=this.skeleton;t&&(t.paused=e)},t=o([c,l(sp.Skeleton),u,d("Scribbles And Ink/Character/Pause Skeleton On Draw")],t)}(a.default);n.default=p,cc._RF.pop()},{"../Drawing/DrawingHandler":"DrawingHandler"}],PeriodicAnimator:[function(e,t,n){"use strict";cc._RF.push(t,"cb026mtAKFMNLOxj0a0lngy","PeriodicAnimator");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../Util"),l=cc._decorator,u=l.ccclass,d=l.disallowMultiple,p=l.property,f=l.menu,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.secondsMin=0,t.secondsMax=10,t._animators=null,t._timeBuffer=0,t}return r(t,e),Object.defineProperty(t.prototype,"animators",{get:function(){return this._animators||(this._animators=a([this.getComponent(cc.Animation)],this.getComponentsInChildren(cc.Animation)).filter(function(e){return null!=e})),this._animators},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.resetTimeBuffer()},t.prototype.update=function(e){this._timeBuffer-=e,this._timeBuffer>0||this.play()},t.prototype.play=function(){var e,t;this.resetTimeBuffer();try{for(var n=s(this.animators),r=n.next();!r.done;r=n.next()){r.value.play()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.setEnabled=function(e){this.enabled=!!e},t.prototype.toggleEnabled=function(){this.setEnabled(!this.enabled)},t.prototype.resetTimeBuffer=function(){this._timeBuffer=c.Random.float(this.secondsMin,this.secondsMax)},o([p({min:0})],t.prototype,"secondsMin",void 0),o([p({min:0})],t.prototype,"secondsMax",void 0),t=o([u,d,f("Scribbles And Ink/Generic/Periodic Animator")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../Util":"index"}],PlanetEdge:[function(e,t,n){"use strict";cc._RF.push(t,"9b871sk5/tICpeLeJk2OcJn","PlanetEdge");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Generic/LevelOfDetail")),s=i(e("../../Generic/LevelOfDetailSprites")),c=e("../../Util"),l=cc._decorator,u=l.ccclass,d=l.disallowMultiple,p=l.property,f=l.executionOrder,h=l.executeInEditMode,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.numberOfSegments=10,t.edgeHeight=10,t.edgePrefabList=[],t}return r(t,e),Object.defineProperty(t.prototype,"segmentLength",{get:function(){var e=Math.min(this.node.height,this.node.width),t=Math.PI/this.numberOfSegments;return e*Math.sin(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angleStep",{get:function(){return 2*Math.PI/this.numberOfSegments},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){this.ensureEdges();var e=this.getComponent(a.default);e&&e.subscribe(this.switchLevel.bind(this))},t.prototype.update=function(){0},t.prototype.switchLevel=function(e,t){var n=this,r=this.node.getChildByName("Edges");r&&r.children.forEach(function(r){var o=r.getComponent(s.default);if(o){if(o.switchLevel(e),t){var i=1-(t<.4?t:1);r.height=n.edgeHeight+1*i*n.edgeHeight}else r.height=n.edgeHeight;r.scaleX=n.segmentLength/r.width}})},t.prototype.getPositionByStep=function(e){var t=Math.min(this.node.height,this.node.width)/2,n=e*this.angleStep,r=t-Math.sqrt(Math.pow(t,2)-Math.pow(this.segmentLength/2,2)),o=(t-r)*Math.cos(n),i=(t-r)*Math.sin(n);return cc.v2(o,i)},t.prototype.ensureEdges=function(){var e=0,t=this.node.getChildByName("Edges");if(!t||t.children.length!==this.numberOfSegments||t.children[0].height!==this.edgeHeight){var n=this.getComponentInChildren(cc.Mask);n&&(n.segements=this.numberOfSegments,n.node.setContentSize(this.node.getContentSize())),t&&(t.setParent(null),t.destroy(),t=null),t||((t=new cc.Node("Edges")).setParent(this.node),t.setSiblingIndex(1));for(var r=1;r<=this.numberOfSegments;r++){++e>=this.edgePrefabList.length&&(e=0);var o=this.getPositionByStep(r),i=this.edgePrefabList[e],a=cc.instantiate(i);a.name=i.name+"-"+r;var s=this.segmentLength/a.width;a.scaleX=s,a.setParent(t),a.setPosition(o),a.height=this.edgeHeight;var l=Math.PI/2+2*Math.PI/this.numberOfSegments*r,u=Math.floor(l/Math.PI);l-=Math.PI*u;var d=c.angleToQuat(l);a.setRotation(d)}}},o([p({min:16,max:256,step:1})],t.prototype,"numberOfSegments",void 0),o([p],t.prototype,"edgeHeight",void 0),o([p({type:[cc.Prefab],tooltip:"List of prefabs that are to be placed as chords of a circle.\nThey will be placed continuously from the first to the last and then back to the first again."})],t.prototype,"edgePrefabList",void 0),t=o([u,d,h,f(100)],t)}(cc.Component);n.default=y,cc._RF.pop()},{"../../Generic/LevelOfDetail":"LevelOfDetail","../../Generic/LevelOfDetailSprites":"LevelOfDetailSprites","../../Util":"index"}],PlatformDetect:[function(e,t,n){"use strict";var r;cc._RF.push(t,"dbfe6SG3bJMzpelT2dCCnpo","PlatformDetect"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.Not_Apple=0]="Not_Apple",e[e.iPad2_or_older=1]="iPad2_or_older",e[e.iPadPro97_or_older=2]="iPadPro97_or_older",e[e.iPadPro105_or_newer=3]="iPadPro105_or_newer",e[e.iPhone4_or_older=4]="iPhone4_or_older",e[e.iPhone8_or_older=5]="iPhone8_or_older",e[e.iPhoneX_or_newer=6]="iPhoneX_or_newer"}(r=n.AppleDevice||(n.AppleDevice={}));var o=function(){function e(){}return e.isLowSpecMobileDevice=function(){if(!cc.sys.isMobile)return!1;var t=e.tryGetDeviceMemoryByCordovaDeviceExtension();return t>0?t<=e.LOWSPEC_MOBILE_MEMORY_MAX:e.tryGetAppleDeviceId()!==r.Not_Apple?e.isLowSpecIos():e.isLowSpecNonIos()},e.isIPhoneX=function(){return cc.sys.isMobile&&e.tryGetAppleDeviceId()===r.iPhoneX_or_newer},e.isLowSpecNonIos=function(){return e.getDeviceLongAndShortResolution().long<=e.LOWSPEC_ANDROID_LONG_AXIS_MAX},e.isLowSpecIos=function(){switch(e.tryGetAppleDeviceId()){case e.AppleDevice.iPad2_or_older:case e.AppleDevice.iPhone4_or_older:return!0}return!1},e.tryGetDeviceMemoryByCordovaDeviceExtension=function(){var t=e.getTopOrCurrentWindow().device;if(null==t)return-1;var n=t.memory;return null==n?-1:n},e.tryGetAppleDeviceId=function(){var t=e.getDeviceLongAndShortResolution(),n=t.short,r=t.long,o=window.devicePixelRatio,i=r/n;return navigator.userAgent.indexOf("iPad;")>=0?i===1024/768?1===o?e.AppleDevice.iPad2_or_older:e.AppleDevice.iPadPro97_or_older:e.AppleDevice.iPadPro105_or_newer:navigator.userAgent.indexOf("iPhone;")>=0?3===o&&i===736/414||i===667/375?e.AppleDevice.iPhone8_or_older:1.775===i&&2===o?e.AppleDevice.iPhone8_or_older:1.5===i&&o<=2?e.AppleDevice.iPhone4_or_older:1===o?e.AppleDevice.iPhone4_or_older:e.AppleDevice.iPhoneX_or_newer:e.AppleDevice.Not_Apple},e.getDeviceLongAndShortResolution=function(){var e=this.getTopOrCurrentWindow(),t=e.screen,n=e.devicePixelRatio,r=t.width*n,o=t.height*n,i=Math.min(r,o),a=Math.max(r,o);return cc.log({short:i,long:a,devicePixelRatio:n}),{short:i,long:a}},e.getTopOrCurrentWindow=function(){try{if(window.top.devicePixelRatio>=0)return window.top}catch(e){}return window},e.AppleDevice=r,e.LOWSPEC_MOBILE_MEMORY_MAX=1024,e.LOWSPEC_ANDROID_LONG_AXIS_MAX=2e3,e}();n.default=o,cc._RF.pop()},{}],PrefabEmitter:[function(e,t,n){"use strict";cc._RF.push(t,"75907D6LotFc7zrDaJoJHoH","PrefabEmitter");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i,a=e("../Util"),s=cc._decorator,c=s.ccclass,l=s.disallowMultiple,u=s.property,d=s.menu,p=function(e){return cc.isValid(e)};(function(e){e.Emit="emit"})(i||(i={}));var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.secondsMin=0,t.secondsMax=10,t.rotationMin=0,t.rotationMax=0,t.scaleMin=1,t.scaleMax=1,t.prefabs=[],t.maxInstances=-1,t._instances=[],t._timeBuffer=0,t}return r(t,e),Object.defineProperty(t.prototype,"instances",{get:function(){return this._instances.filter(p)},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.resetTimeBuffer()},t.prototype.update=function(e){this._timeBuffer-=e,this._timeBuffer>0||(this.resetTimeBuffer(),this.instances.length>=this.maxInstances&&this.maxInstances>=0||this.createInstance())},t.prototype.onDestroy=function(){this._instances.length=0},t.prototype.createInstance=function(){var e=a.Random.item(this.prefabs);if(e){var t=cc.instantiate(e);t.setParent(this.node.parent),t.setSiblingIndex(this.node.getSiblingIndex());var n=a.Random.float(this.rotationMin,this.rotationMax);t.angle+=n;var r=a.Random.float(this.scaleMin,this.scaleMax);t.scaleX*=r,t.scaleY*=r;var o=this.getRandomPosition();t.setPosition(o),this._instances.push(t),this.node.emit(i.Emit,t,e)}},t.prototype.setEnabled=function(e){this.enabled=e},t.prototype.getRandomPosition=function(){var e=this.node.getContentSize(),t=e.width,n=void 0===t?0:t,r=e.height,o=void 0===r?0:r,i=cc.v2(a.Random.float(n*-this.node.anchorX,n*(1-this.node.anchorX)),a.Random.float(o*-this.node.anchorY,o*(1-this.node.anchorY))),s=this.node.convertToWorldSpaceAR(i);return this.node.parent.convertToNodeSpaceAR(s)},t.prototype.resetTimeBuffer=function(){this._timeBuffer=a.Random.float(this.secondsMin,this.secondsMax)},t.EventType=i,o([u({min:0})],t.prototype,"secondsMin",void 0),o([u({min:0})],t.prototype,"secondsMax",void 0),o([u()],t.prototype,"rotationMin",void 0),o([u()],t.prototype,"rotationMax",void 0),o([u()],t.prototype,"scaleMin",void 0),o([u()],t.prototype,"scaleMax",void 0),o([u({type:[cc.Prefab]})],t.prototype,"prefabs",void 0),o([u({tooltip:"-1 is no limit.",min:-1,step:1})],t.prototype,"maxInstances",void 0),t=o([c,l,d("Scribbles And Ink/Generic/Prefab Emitter")],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Util":"index"}],PuddleSensor:[function(e,t,n){"use strict";cc._RF.push(t,"7ac52ZM8MpHuYrKiW7rt98e","PuddleSensor");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../Util"),s=i(e("./DynamicRainDrop")),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.executeInEditMode,p=c.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rainThreshold=1,t.variation=a.Random.integer(1,3),t.jumpTarget=!1,t._collider=null,t._skeleton=null,t._rainCollected=0,t}return r(t,e),Object.defineProperty(t.prototype,"collider",{get:function(){return cc.isValid(this._collider)||(this._collider=this.getComponent(cc.BoxCollider)),this._collider},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return cc.isValid(this._skeleton)||(this._skeleton=this.getComponent(sp.Skeleton)),this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._rainCollected>=this.rainThreshold},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){cc.director.getPhysicsManager().enabled=!0;var e=cc.director.getCollisionManager();e.enabled||(e.enabled=!0)},t.prototype.start=function(){this.checkVisibility(!0)},t.prototype.update=function(){this.checkVisibility(!1)},t.prototype.onCollisionEnter=function(e){e.getComponent(s.default)&&this._rainCollected++},t.prototype.show=function(){this._rainCollected=this.rainThreshold},t.prototype.clear=function(){var e=this.isVisible;this._rainCollected=0,this.enabled||(this.enabled=!0),e&&this.skeleton.setAnimation(0,this.getVariation("Puddle_0#_Disappear"),!1)},t.prototype.getVariation=function(e){var t=Math.floor(cc.misc.clampf(this.variation,1,3));return e.replace("#",""+t)},t.prototype.checkVisibility=function(e){if(this.isVisible){var t=e?this.getVariation("Puddle_0#_Idle"):this.getVariation("Puddle_0#_Appear");this.skeleton.setAnimation(0,t,!1),this.enabled=!1}},o([p({tooltip:"Number of Rain drops this collider needs to collect before enabling the puddle sprite.\nSet to 0 if puddle should be visible by default."})],t.prototype,"rainThreshold",void 0),o([p({tooltip:"Puddle variation to use.",min:1,max:3,step:1})],t.prototype,"variation",void 0),o([p({tooltip:"Flag that indicates Scribbles and Ink will jump on this puddle."})],t.prototype,"jumpTarget",void 0),t=o([l,u,d],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../Util":"index","./DynamicRainDrop":"DynamicRainDrop"}],RaceCar:[function(e,t,n){"use strict";cc._RF.push(t,"d8dceQVcedN8J3LCcNvof2I","RaceCar");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../../Drawing/DrawingSpot")),s=i(e("../../Framework/EventRelay")),c=i(e("./Costume")),l=e("../../Util"),u=cc._decorator,d=u.ccclass,p=u.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._inkSeat=void 0,t._scribblesSeat=void 0,t._drawingSpot=void 0,t}return r(t,e),Object.defineProperty(t.prototype,"inkSeat",{get:function(){if(!this._inkSeat)throw new Error("Ink Seat node was not set in inspector");return this._inkSeat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scribblesSeat",{get:function(){if(!this._scribblesSeat)throw new Error("Scribbles Seat node was not set in inspector");return this._scribblesSeat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawingSpot",{get:function(){if(!this._drawingSpot)throw new Error("Drawing Spot was not set in inspector");return this._drawingSpot},enumerable:!0,configurable:!0}),t.prototype.pickupScribblesAndInk=function(){var e=s.default.actors.find(function(e){return"Ink"===e.node.name}),t=s.default.actors.find(function(e){return"Scribbles"===e.node.name});if(!e||!t)throw new Error("Scribbles and Ink must be in the scene.");var n=l.getComponentsInScene(c.default);e.node.setParent(this.inkSeat),e.node.setPosition(0,0),e.node.angle=0;var r=n.find(function(t){return t.character===e});r&&r.node.setParent(this.inkSeat),t.node.setParent(this.scribblesSeat),t.node.setPosition(0,0),t.node.angle=0;var o=n.find(function(e){return e.character===t});o&&o.node.setParent(this.scribblesSeat)},o([p({type:cc.Node,visible:!0})],t.prototype,"_inkSeat",void 0),o([p({type:cc.Node,visible:!0})],t.prototype,"_scribblesSeat",void 0),o([p({type:a.default,visible:!0})],t.prototype,"_drawingSpot",void 0),t=o([d],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../../Drawing/DrawingSpot":"DrawingSpot","../../Framework/EventRelay":"EventRelay","../../Util":"index","./Costume":"Costume"}],RainOutsideStoryManager:[function(e,t,n){"use strict";cc._RF.push(t,"01f8fdyDLxBKrEg69i5i9+6","RainOutsideStoryManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("../../Framework/StoryManager")),u=e("../../Util"),d=c(e("./PuddleSensor")),p=c(e("../../Framework/ContentLoader")),f=c(e("../../Generic/PrefabEmitter")),h=c(e("./SidewalkSensor")),y=cc._decorator,v=y.ccclass,_=y.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.exteriorLoader=null,t.rainEmitterLoader=null,t.rainFillRequiredPuddlesDuration=3,t.rainFillRequiredPuddlesShowInterval=.25,t.cloudFormDropCountThreshold=10,t.cloudFormSequence=null,t._cloudFormDropCount=0,t._cloudFormSequencePlayed=!1,t._sidewalk=null,t}return r(t,e),Object.defineProperty(t.prototype,"sidewalk",{get:function(){if(!this._sidewalk){var e=this.exteriorLoader&&this.exteriorLoader.instances[0];this._sidewalk=e&&e.getComponentInChildren(h.default)}if(!this._sidewalk)throw new Error("Exterior Content Loader must be correctly configured in inspector");return this._sidewalk},enumerable:!0,configurable:!0}),t.prototype.incrementCloudFormDropCount=function(){this._cloudFormDropCount++,this._cloudFormDropCount>=this.cloudFormDropCountThreshold&&this.ensureCloudFormSequencePlayed()},t.prototype.clearPuddles=function(){u.getComponentsInScene(d.default).forEach(function(e){e.clear()})},t.prototype.finishDrawingPuddles=function(){return i(this,void 0,Promise,function(){var e,t,n,r=this;return a(this,function(o){switch(o.label){case 0:return e=this.freezeUI(),this._cloudFormDropCount<this.cloudFormDropCountThreshold&&this.ensureCloudFormSequencePlayed(),(t=u.getComponentsInScene(d.default)).filter(function(e){return!r.isOnVisibleSidewalk(e)}).filter(function(e){return!e.isVisible}).forEach(function(e){return e.show()}),[4,u.asyncSchedule(this,.5)];case 1:return o.sent(),(n=t.filter(function(e){return e.jumpTarget}).filter(function(e){return!e.isVisible})).length>0?[4,this.fakeDropRainOnPuddles(n)]:[3,3];case 2:o.sent(),o.label=3;case 3:return this.unfreezeUI(e),this.currentStoryBlock&&this.currentStoryBlock.completeAndAdanvce(),[2]}})})},t.prototype.fakeDropRainOnPuddles=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i,c,l,d,p;return a(this,function(a){switch(a.label){case 0:return r=null,this.rainEmitterLoader&&(o=this.rainEmitterLoader.instances[0],r=o&&(o.getComponent(f.default)||o.getComponentInChildren(f.default))),r&&(r.node.active=!0),(i=this.rainFillRequiredPuddlesDuration-e.length*this.rainFillRequiredPuddlesShowInterval)>0?[4,u.asyncSchedule(this,i)]:[3,2];case 1:a.sent(),a.label=2;case 2:e.sort(u.Random.sort),a.label=3;case 3:a.trys.push([3,8,9,10]),c=s(e),l=c.next(),a.label=4;case 4:return l.done?[3,7]:(d=l.value,[4,u.asyncSchedule(this,this.rainFillRequiredPuddlesShowInterval)]);case 5:a.sent(),d.show(),a.label=6;case 6:return l=c.next(),[3,4];case 7:return[3,10];case 8:return p=a.sent(),t={error:p},[3,10];case 9:try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}return[7];case 10:return r&&(r.node.active=!1),[4,u.asyncSchedule(this,.5)];case 11:return a.sent(),[2]}})})},t.prototype.isOnVisibleSidewalk=function(e){var t=e.collider.world.points,n=this.sidewalk.collider.world.points;return cc.Intersection.polygonPolygon(t,n)},t.prototype.ensureCloudFormSequencePlayed=function(){this._cloudFormSequencePlayed||(this._cloudFormSequencePlayed=!0,this.cloudFormSequence&&this.eventRelay.playSequence(this.cloudFormSequence))},o([_({type:p.default})],t.prototype,"exteriorLoader",void 0),o([_({type:p.default})],t.prototype,"rainEmitterLoader",void 0),o([_({tooltip:"If insufficient puddles have been drawn by the user, we will drop static rain as a visual effect and fill them in manually."})],t.prototype,"rainFillRequiredPuddlesDuration",void 0),o([_({tooltip:"Amount of time between puddles being filled in the auto fill sequence."})],t.prototype,"rainFillRequiredPuddlesShowInterval",void 0),o([_({tooltip:"Number of drops that must fall for the clouds to be cleared.",formerlySerializedAs:"cloudClearDropCountThreshold"})],t.prototype,"cloudFormDropCountThreshold",void 0),o([_({type:cc.AnimationClip,tooltip:"Sequence that will play when enough rain drops have been dropped to remove clouds.",formerlySerializedAs:"cloudClearSequence"})],t.prototype,"cloudFormSequence",void 0),t=o([v],t)}(l.default);n.default=g,cc._RF.pop()},{"../../Framework/ContentLoader":"ContentLoader","../../Framework/StoryManager":"StoryManager","../../Generic/PrefabEmitter":"PrefabEmitter","../../Util":"index","./PuddleSensor":"PuddleSensor","./SidewalkSensor":"SidewalkSensor"}],RainUnderwaterStoryManager:[function(e,t,n){"use strict";cc._RF.push(t,"2ff7baB2eFKnLTY33bTYi5C","RainUnderwaterStoryManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../../Framework/StoryManager")),l=s(e("../../Framework/GameManager")),u=s(e("../../Generic/Velocity")),d=s(e("../../Generic/Temporary")),p=cc._decorator,f=p.ccclass,h=p.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._puddleCreatureVariations=5,t._puddleCreatureVelocity=cc.v2(-500,0),t._puddleCreatureLife=10,t}return r(t,e),t.prototype.finishDrawingPuddleCreature=function(){return i(this,void 0,Promise,function(){var e,t,n;return a(this,function(r){switch(r.label){case 0:return[4,this.setPuddleCreatureVariations()];case 1:return r.sent(),e=l.default.drawingUI,!(t=e.currentDrawing)||t.isEmpty?[3,3]:((n=t.addComponent(u.default)).velocity=this._puddleCreatureVelocity,n.torque=0,[4,e.saveDrawing()]);case 2:r.sent(),t.addComponent(d.default).reset(this._puddleCreatureLife,this._puddleCreatureLife),r.label=3;case 3:return e.currentDrawing=null,this.currentStoryBlock&&this.currentStoryBlock.completeAndAdanvce(),[2]}})})},t.prototype.setPuddleCreatureVariations=function(){return i(this,void 0,Promise,function(){var e,t,n;return a(this,function(r){switch(r.label){case 0:return e=l.default.isLowEndDevice,t=l.default.drawingUI,n=l.default.drawingStorage,e?[2]:[4,n.setNumMaxVariations(t.storageKey,this._puddleCreatureVariations)];case 1:return r.sent(),[2]}})})},o([h({visible:!0})],t.prototype,"_puddleCreatureVariations",void 0),o([h({visible:!0})],t.prototype,"_puddleCreatureVelocity",void 0),o([h({visible:!0})],t.prototype,"_puddleCreatureLife",void 0),t=o([f],t)}(c.default);n.default=y,cc._RF.pop()},{"../../Framework/GameManager":"GameManager","../../Framework/StoryManager":"StoryManager","../../Generic/Temporary":"Temporary","../../Generic/Velocity":"Velocity"}],RoomManager:[function(e,t,n){"use strict";cc._RF.push(t,"9a8266Qj4NDLYDLT7N3okAF","RoomManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var p=d(e("../../Framework/SceneManager")),f=d(e("../../Drawing/DrawingUIOverride")),h=d(e("../../Generic/CameraRig")),y=d(e("../../Framework/GameManager")),v=e("../../Drawing/DrawingStorage"),_=e("../../Util"),g=d(e("./Room")),m=d(e("./GalleryFrame")),b=e("../../constants"),w=d(e("./StudioManager")),S=d(e("../../Framework/EventSequencer")),O=cc._decorator,P=O.ccclass,C=O.property,x=O.requireComponent,R=5*b.ONE_FRAME,k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._roomsAssetPathPrefix="",t._roomNames=[],t._backgroundNode=null,t._foregroundNode=null,t._roomTransitionDuration=2,t._drawingUIOverride=null,t._cameraRig=null,t._currentRoomLink=null,t}return r(t,e),Object.defineProperty(t.prototype,"backgroundNode",{get:function(){if(!this._backgroundNode)throw new Error("Rooms Background Node not assigned in inspector.");return this._backgroundNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"foregroundNode",{get:function(){if(!this._foregroundNode)throw new Error("Rooms Foreground Node not assigned in inspector.");return this._foregroundNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawingUIOverride",{get:function(){if(this._drawingUIOverride||(this._drawingUIOverride=this.getComponent(f.default)||this.getComponentInChildren(f.default)),!this._drawingUIOverride)throw new Error("Studio Manager requires a DrawingUIOverride");return this._drawingUIOverride},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraRig",{get:function(){if(this._cameraRig&&cc.isValid(this._cameraRig,!0)||(this._cameraRig=_.getComponentInScene(h.default)),!this._cameraRig)throw new Error("CameraRig could not be found.");return this._cameraRig},enumerable:!0,configurable:!0}),t.prototype.onScenePreLoad=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return this.ensureRoomLinks(),[4,this.ensureMaxStudioVariations()];case 1:return e.sent(),[4,this.restoreStudioState()];case 2:return e.sent(),[4,this.preloadRoomPrefabs()];case 3:return e.sent(),[4,this.preloadFirstRoomDrawing()];case 4:return e.sent(),[2]}})})},t.prototype.onSceneStart=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.onScenePreLoad()];case 1:return e.sent(),[4,this.createFirstRoom()];case 2:return e.sent(),[2]}})})},t.prototype.untilAdjacentRoomPrefabLoaded=function(e){return a(this,void 0,Promise,function(){var t,n,r,o;return s(this,function(i){switch(i.label){case 0:t=2,n=this.currentRoomLink,r=n[e],o=_.chunker.uniqueKey(),_.chunker.start(o),i.label=1;case 1:return r.prefab?[3,3]:[4,_.asyncSchedule(this,R)];case 2:return i.sent(),_.chunker.check(o,t)?(cc.warn(r.name+" prefab did not load after "+t+" seconds."),[3,3]):[3,1];case 3:return _.chunker.end(o,!1),[2]}})})},t.prototype.transitionToAdjacentRoom=function(e){return a(this,void 0,Promise,function(){var t,n,r,i;return s(this,function(a){switch(a.label){case 0:return t=this.currentRoomLink,[4,this.cacheDrawingIfPossibleAndDisableLastRoom(t)];case 1:return n=a.sent(),[4,this.createAdjacentRoom(t,e)];case 2:return r=a.sent(),(i=_.getComponentInScene(w.default))&&i.moveScribblesAndInkToRelativeStartPositions(),[4,y.default.analytics.send(o({},b.ANALYTICS.EnterRoom,{label:r.name}))];case 3:return a.sent(),this.ensureRoomPrefabs(r),y.default.audio.stopAll(),[4,this.moveCameraToNextRoom(r)];case 4:return a.sent(),[4,this.destroyLastRoomAndSaveCachedDrawing(t,n)];case 5:return a.sent(),[4,_.asyncSchedule(this,1.5)];case 6:return a.sent(),r.room.playStoryButtonIndicatorAnimation(),[2]}})})},t.prototype.disableCurrentRoomButtons=function(){this.setCurrentRoomButtonsEnabled(!1)},t.prototype.enableCurrentRoomButtons=function(){this.setCurrentRoomButtonsEnabled(!0)},t.prototype.sendDrawingToGallery=function(){return a(this,void 0,Promise,function(){var e,t,n,r=this;return s(this,function(o){switch(o.label){case 0:if(e=this.currentRoomLink,!(t=e.room).useDrawingUI)throw new Error("Only rooms that are using the DrawingUI can send drawings to the gallery");return n=y.default.drawingUI,n.currentDrawing?[4,Promise.all([this.moveDrawing(),this.saveDrawing().then(function(){return r.incrementAndSaveRoomLinkStudioVariation(e)}).catch(function(e){return cc.warn("Could not save "+t.name+" drawing:",e)})])]:[2];case 1:return o.sent(),[4,this.createNewRoomDrawing()];case 2:return o.sent(),[2]}})})},t.prototype.ensureMaxStudioVariations=function(){return a(this,void 0,Promise,function(){var e,t,n,r,o;return s(this,function(i){switch(i.label){case 0:return e=y.default.drawingStorage,t=this.drawingUIOverride.storageKey,e.getNumMaxVariations(t)>1?[2]:(n=this.findRoomLink(function(e){return e.name.includes("Gallery")}))?n.prefab?[3,2]:(r=n,[4,this.loadRoomPrefab(n)]):[2,cc.warn("Gallery room could not be found, maximum number of studio drawings could not be set to match the number of frames in the gallery.")];case 1:r.prefab=i.sent(),i.label=2;case 2:return o=n.prefab.data.getComponentsInChildren(m.default).length,e.setNumMaxVariations(t,o),[2]}})})},t.prototype.preloadRoomPrefabs=function(){return a(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=this._currentRoomLink,[4,this.ensureRoomPrefabs(e)];case 1:return t.sent(),[2]}})})},t.prototype.preloadFirstRoomDrawing=function(){return a(this,void 0,Promise,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return e=this._currentRoomLink,[4,y.default.drawingStorage.getStoredDrawing({storageKey:e.name,variationStrategy:v.GetVariation.Latest,deserialize:!0})];case 1:return t=n.sent(),cc.log(e.name+" "+(t?"drawing loaded":"had no drawing")),[2]}})})},t.prototype.createFirstRoom=function(){return a(this,void 0,Promise,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return[4,this.untilAutoLoadContentLoaded()];case 1:return n.sent(),e=this._currentRoomLink,(t=this.createRoomInstance(e)).placeContent(this.getScribblesAndInk()),[4,y.default.analytics.send(o({},b.ANALYTICS.EnterRoom,{label:e.name}))];case 2:return n.sent(),t.useDrawingUI?(this.initializeRoomDrawingUITool(),[4,this.loadDrawingForRoom(e)]):[3,5];case 3:return n.sent(),[4,this.allowDrawUIForRoom(e)];case 4:n.sent(),this.validateRoomLinkStudioVariation(e),n.label=5;case 5:return[2]}})})},t.prototype.initializeRoomDrawingUITool=function(){var e=y.default.drawingUI,t=y.default.storage;t.getMem(b.UI_STORE_KEY,"draw-tools-randomized-on-first-studio-visit")||(t.setMem(b.UI_STORE_KEY,"draw-tools-randomized-on-first-studio-visit",!0),e.setRandomTool())},t.prototype.restoreStudioState=function(){return a(this,void 0,Promise,function(){var e,t,n,r,o,i,a,l,u;return s(this,function(s){switch(s.label){case 0:return n=y.default.storage,(r=n.getMem(b.UI_STORE_KEY,"studio-room-start"))&&(o=this.findRoomLink(function(e){return e.name===r}),this._currentRoomLink=o||this._currentRoomLink),[4,n.get(b.UI_STORE_KEY,"studio-room-variations")];case 1:if(i=s.sent())try{for(a=c(this.eachRoomLink()),l=a.next();!l.done;l=a.next())(u=l.value).name in i&&(u.studioVariation=i[u.name])}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return[2]}})})},Object.defineProperty(t.prototype,"currentRoomLink",{get:function(){if(!this._currentRoomLink)throw new Error("Room links have not been set up.");return this._currentRoomLink},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentRoom",{get:function(){return this.currentRoomLink.room},enumerable:!0,configurable:!0}),t.prototype.ensureRoomLinks=function(){var e=this;if(!this._currentRoomLink){var t=this._roomNames.map(function(t){return{name:t,path:e._roomsAssetPathPrefix+"/"+t,prefab:null,room:null,studioVariation:NaN}}).map(function(e,t,n){var r=n.length-1,o=e;return o.left=t>0?n[t-1]:n[r],o.right=t<r?n[t+1]:n[0],o});this._currentRoomLink=t[0]}},t.prototype.incrementAndSaveRoomLinkStudioVariation=function(e){return a(this,void 0,Promise,function(){var t,n,r,o,i,a;return s(this,function(s){switch(s.label){case 0:if(!e.room||!e.room.useDrawingUI)throw new Error("Can only increment studio variation on instanced rooms that are configured to use the DrawingUI");e.studioVariation=(e.studioVariation||0)+1,this.validateRoomLinkStudioVariation(e),r={};try{for(o=c(this.eachRoomLink()),i=o.next();!i.done;i=o.next())a=i.value,r[a.name]=a.studioVariation}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return[4,y.default.storage.set(b.UI_STORE_KEY,"studio-room-variations",r)];case 1:return s.sent(),[2]}})})},t.prototype.validateRoomLinkStudioVariation=function(e){var t=y.default.drawingStorage.getNumMaxVariations(this.drawingUIOverride.storageKey);e.studioVariation=e.studioVariation||0,e.studioVariation>=t&&(e.studioVariation=0);var n=new Set(u(this.eachRoomLink()).filter(function(t){return t!==e}).filter(function(e){return!Number.isNaN(e.studioVariation)}).map(function(e){return e.studioVariation}));if(n.size>=t)cc.warn("The number of rooms with drawing UI's ("+n.size+") exceeds the max number of variations ("+t+")");else for(;n.has(e.studioVariation);)e.studioVariation++,e.studioVariation>=t&&(e.studioVariation=0)},t.prototype.loadRoomPrefab=function(e){return a(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,y.default.assets.loadDynamicAssets(e.path)];case 1:return t=n.sent(),e.prefab=t[e.path],[2,e.prefab]}})})},t.prototype.ensureRoomPrefabs=function(e){return a(this,void 0,Promise,function(){var t,n,r,o,i,a,l,u,d,p;return s(this,function(s){switch(s.label){case 0:r=y.default.assets,o=[e.left,e,e.right],s.label=1;case 1:s.trys.push([1,7,8,9]),i=c(this.eachRoomLink(e)),a=i.next(),s.label=2;case 2:return a.done?[3,6]:(l=a.value,!(u=o.includes(l))||l.prefab?[3,4]:(d=l,[4,this.loadRoomPrefab(l)]));case 3:return d.prefab=s.sent(),[3,5];case 4:!u&&l.prefab&&(l.prefab=null,r.disposeDynamicAssets(l.path)),s.label=5;case 5:return a=i.next(),[3,2];case 6:return[3,9];case 7:return p=s.sent(),t={error:p},[3,9];case 8:try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}return[7];case 9:return[2]}})})},t.prototype.createRoomInstance=function(e){var t,n;if(!e.prefab)throw new Error(e.name+" is missing it's prefab. Ensure prefabs are preloaded before instancing rooms.");var r=cc.instantiate(e.prefab).getComponent(g.default);if(!r)throw new Error(e.name+" prefab does not have a Room component");r.node.setParent(this.backgroundNode),r.node.setPosition(0,0),r.node.name=e.name,e.room=r;var o=_.getComponentInScene(w.default),i=r.node.getComponentsInChildren(S.default);if(o)try{for(var a=c(i),s=a.next();!s.done;s=a.next()){s.value.eventRelay=o.dialogRelay}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r.foregroundNode&&r.foregroundNode.setParent(this.foregroundNode),_.PlatformDetect.isIPhoneX()&&this.moveNavButtonsToAccountForIPhoneXTab(r),r},t.prototype.loadDrawingForRoom=function(e){return a(this,void 0,Promise,function(){var t,n,r;return s(this,function(o){switch(o.label){case 0:if(!e.room)throw new Error("Instantiate room before loading room drawing");if(!e.room.useDrawingUI)throw new Error("Cannot load drawings for rooms that do not use the DrawingUI");return t=y.default.drawingUI,n=y.default.drawingStorage,(r=n.copyStoredDrawing({variationStrategy:v.GetVariation.Latest,storageKey:e.name,deserialize:!0}))instanceof Promise?[4,r]:[3,2];case 1:r=o.sent(),o.label=2;case 2:return r||(r=t.createNewDrawing()),t.currentDrawing=r,r.node.setParent(e.room.node),r.node.setPosition(0,0),r.node.setSiblingIndex(e.room.contentNode.getSiblingIndex()),[2]}})})},t.prototype.allowDrawUIForRoom=function(e){return a(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:if(!e.room)throw new Error("Instantiate room before allowing DrawUI");return this.refreshDrawingUIOverride(e),[4,this.allowDrawUI()];case 1:return t.sent(),[2]}})})},t.prototype.eachRoomLink=function(e){var t;return void 0===e&&(e=this.currentRoomLink),s(this,function(n){switch(n.label){case 0:t=e,n.label=1;case 1:return[4,t];case 2:n.sent(),t=t.right,n.label=3;case 3:if(t!==e)return[3,1];n.label=4;case 4:return[2]}})},t.prototype.findRoomLink=function(e){var t,n;try{for(var r=c(this.eachRoomLink()),o=r.next();!o.done;o=r.next()){var i=o.value;if(e(i))return i}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null},t.prototype.setCurrentRoomButtonsEnabled=function(e){var t=y.default.drawingUI,n=this.currentRoomLink.room;n.setButtonsEnabled(e),n.useDrawingUI&&(t.enabled=e)},t.prototype.moveDrawing=function(){var e=y.default.drawingUI.currentDrawing,t=cc.view.getFrameSize(),n=t.width,r=t.height;return new Promise(function(t){e.node.runAction(cc.sequence(cc.scaleTo(.25,.2,.2),cc.moveBy(.25,0,.25*r),cc.moveBy(.5,-1*n,0),cc.callFunc(e.node.destroy,e.node),cc.callFunc(t)))})},t.prototype.saveDrawing=function(){return a(this,void 0,Promise,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=y.default.drawingUI,this.refreshDrawingUIOverride(this.currentRoomLink),[4,e.saveDrawing()];case 1:return t.sent(),e.currentDrawing=null,[2]}})})},t.prototype.refreshDrawingUIOverride=function(e){var t=e.room;this.drawingUIOverride.reset(),this.drawingUIOverride.touchSurface=t.contentNode,this.drawingUIOverride.variation=e.studioVariation,this.drawingUIOverride.override()},t.prototype.createNewRoomDrawing=function(){return a(this,void 0,Promise,function(){var e,t,n,r;return s(this,function(o){switch(o.label){case 0:return e=this.currentRoomLink,t=e.room,n=y.default.drawingUI,[4,y.default.drawingStorage.deleteStoredDrawing({storageKey:t.node.name,variationStrategy:v.DeleteVariation.Every,serialize:!0})];case 1:return o.sent(),(r=n.createNewDrawing()).node.setParent(t.node),r.node.setSiblingIndex(t.contentNode.getSiblingIndex()-1),[2]}})})},t.prototype.cacheDrawingIfPossibleAndDisableLastRoom=function(e){return a(this,void 0,Promise,function(){var t,n,r,o,i;return s(this,function(a){switch(a.label){case 0:return(t=e.room).setButtonsEnabled(!1),n=y.default.drawingStorage,r=y.default.drawingUI,t.useDrawingUI&&r.unsavedChanges&&r.currentDrawing?[4,n.storeDrawing({variationStrategy:v.SaveVariation.Latest,storageKey:e.name,drawing:r.currentDrawing.copy(),serialize:!1})]:[3,2];case 1:return i=a.sent(),[3,3];case 2:i=-1,a.label=3;case 3:return o=i,[4,this.disallowDrawUI()];case 4:return a.sent(),[2,o]}})})},t.prototype.createAdjacentRoom=function(e,t){return a(this,void 0,Promise,function(){var n,r,o,i,a,c,l;return s(this,function(s){switch(s.label){case 0:return n=e.room,r=e[t],o=this.createRoomInstance(r),i="left"===t?-1:1,a=.5*o.getWidth()+.5*n.getWidth(),c=n.node.position.add(cc.v2(a*i,0)),o.node.setPosition(c),(l=o.foregroundNode)&&(l.setParent(this.foregroundNode),l.setPosition(c)),o.placeContent(u(n.contentNode.children)),o.useDrawingUI?[4,this.loadDrawingForRoom(r)]:[3,2];case 1:s.sent(),s.label=2;case 2:return this._currentRoomLink=r,y.default.storage.setMem(b.UI_STORE_KEY,"studio-room-start",r.name),[2,r]}})})},t.prototype.moveCameraToNextRoom=function(e){return a(this,void 0,Promise,function(){var t;return s(this,function(n){switch(n.label){case 0:return(t=e.room).setButtonsEnabled(!1),[4,this.cameraRig.matchTarget(t.node,this._roomTransitionDuration,"QuadraticActionInOut")];case 1:return n.sent(),t.setButtonsEnabled(!0),t.useDrawingUI?[4,this.allowDrawUIForRoom(e)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.destroyLastRoomAndSaveCachedDrawing=function(e,t){return a(this,void 0,Promise,function(){var n,r;return s(this,function(o){switch(o.label){case 0:return e.room.node.destroy(),t>-1?[4,(n=y.default.drawingStorage).copyStoredDrawing({variation:t,variationStrategy:v.GetVariation.Specific,storageKey:e.name,deserialize:!1})]:[3,3];case 1:return(r=o.sent())?[4,n.storeDrawing({storageKey:e.name,variationStrategy:v.SaveVariation.Specific,variation:t,drawing:r,serialize:!0})]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})},t.prototype.moveNavButtonsToAccountForIPhoneXTab=function(e){var t,n;if(e.foregroundNode){try{for(var r=c(["left","right"]),o=r.next();!o.done;o=r.next()){var i=o.value,a=i.charAt(0).toUpperCase()+i.slice(1),s=e.foregroundNode.getChildByName("Nav "+a),l=e.foregroundNode.getChildByName("Nav "+a+" Shown");if(!s||!l)return;var u=l.getComponent(cc.Widget);if(!u)return;u[i]=100,u.updateAlignment(),s.setPosition(l.position)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},i([C({visible:!0})],t.prototype,"_roomsAssetPathPrefix",void 0),i([C({type:cc.String,visible:!0})],t.prototype,"_roomNames",void 0),i([C({type:cc.Node,visible:!0,displayName:"Room Background Node"})],t.prototype,"_backgroundNode",void 0),i([C({type:cc.Node,visible:!0,displayName:"Room Foreground Node"})],t.prototype,"_foregroundNode",void 0),i([C({visible:!0,displayName:"Transition Duration",tooltip:"Amount of time it takes for a transitionfrom one room to another to complete."})],t.prototype,"_roomTransitionDuration",void 0),t=i([P,x(f.default)],t)}(p.default);n.default=k,cc._RF.pop()},{"../../Drawing/DrawingStorage":"DrawingStorage","../../Drawing/DrawingUIOverride":"DrawingUIOverride","../../Framework/EventSequencer":"EventSequencer","../../Framework/GameManager":"GameManager","../../Framework/SceneManager":"SceneManager","../../Generic/CameraRig":"CameraRig","../../Util":"index","../../constants":"constants","./GalleryFrame":"GalleryFrame","./Room":"Room","./StudioManager":"StudioManager"}],Room:[function(e,t,n){"use strict";cc._RF.push(t,"2310clrH7dHB7ZZ2p1nmP+b","Room");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var d=u(e("../../Framework/GameComponent")),p=u(e("../../Framework/GameManager")),f=u(e("../../UI/Button")),h=u(e("../../UI/ScreenWidget")),y=u(e("./RoomManager")),v=u(e("./GalleryFrame")),_=u(e("./StudioManager")),g=e("../../Util"),m=u(e("../../Generic/Velocity")),b=u(e("../../Generic/PeriodicAnimator")),w=cc._decorator,S=w.ccclass,O=w.property,P=w.disallowMultiple,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._floorNode=null,t._contentNode=null,t.foregroundNode=null,t.useDrawingUI=!1,t}return r(t,e),Object.defineProperty(t.prototype,"floorNode",{get:function(){if(!this._floorNode)throw new Error(this.node.name+" is missing it's floor node.");return this._floorNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentNode",{get:function(){if(!this._contentNode)throw new Error(this.node.name+" is missing it's content node.");return this._contentNode},enumerable:!0,configurable:!0}),t.prototype.transitionToAdjacentRoom=function(e,t){return i(this,void 0,Promise,function(){var n,r;return a(this,function(o){switch(o.label){case 0:if("left"!==(n=e instanceof cc.Event.EventTouch?t:e)&&"right"!==n)throw new Error("direction must be left or right");if(!(r=g.getComponentInScene(y.default)))throw new Error("RoomManager could not be found.");return[4,r.untilAdjacentRoomPrefabLoaded(n)];case 1:return o.sent(),r.transitionToAdjacentRoom(n),[2]}})})},t.prototype.startStory=function(e,t){var n=e instanceof cc.Event.EventTouch?t:e;if(!n)throw new Error("Story name required.");var r=g.getComponentInScene(_.default);if(!r)throw new Error("StudioManager could not be found.");return r.startStory(n)},t.prototype.onDestroy=function(){cc.isValid(this.foregroundNode,!0)&&this.foregroundNode.destroy()},t.prototype.start=function(){this.loadGalleryFrames()},t.prototype.playStoryButtonIndicatorAnimation=function(){var e=this.getComponentsInChildren(b.default).find(function(e){return e.node.name.includes("Indicator")});e&&e.play()},t.prototype.placeContent=function(e){var t,n;try{for(var r=s(e),o=r.next();!o.done;o=r.next()){var i=o.value,a=i instanceof cc.Component?i.node:i,c=g.getLocalPosition(a,this.contentNode);a.setParent(this.contentNode),a.setPosition(c)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},t.prototype.setButtonsEnabled=function(e){var t,n,r=p.default.drawingUI.node.getComponentsInChildren(f.default),o=l(this.getComponentsInChildren(f.default),this.foregroundNode?this.foregroundNode.getComponentsInChildren(f.default):[]);try{for(var i=s(o),a=i.next();!a.done;a=i.next()){var c=a.value;r.includes(c)||(c.enabled=e)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},t.prototype.getWidth=function(){var e,t,n=this.getComponent(h.default);n?n.apply():cc.warn("Room "+this.node.name+" does not have a screen widget.");var r=this.node.getComponentsInChildren(cc.Widget);try{for(var o=s(r),i=o.next();!i.done;i=o.next()){i.value.updateAlignment()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return this.floorNode.getBoundingBox().width},t.prototype.loadGalleryFrames=function(){var e,t,n,r,o=this.getComponentsInChildren(v.default);try{for(var i=s(o),a=i.next();!a.done;a=i.next()){(u=a.value).loadingArrowHider.enabled=!1,(d=u.loadingArrowHider.getComponent(m.default))&&(d.torque*=.5)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}try{for(var c=s(o),l=c.next();!l.done;l=c.next()){var u,d;if((d=(u=l.value).loadingArrowHider.getComponent(m.default))&&(d.torque/=.5),u.loadDrawing(),!cc.isValid(this.node,!0))break}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}},o([O({visible:!0,type:cc.Node,tooltip:"The node where the floor sprite is placed.\nThe width of the floor determins the length of the room."})],t.prototype,"_floorNode",void 0),o([O({visible:!0,type:cc.Node,tooltip:"The node where content will be placed when entering the room.\n\nThis node is required."})],t.prototype,"_contentNode",void 0),o([O({type:cc.Node,tooltip:"The node where foreground elements will be placed when entering the room."})],t.prototype,"foregroundNode",void 0),o([O()],t.prototype,"useDrawingUI",void 0),t=o([S,P],t)}(d.default);n.default=C,cc._RF.pop()},{"../../Framework/GameComponent":"GameComponent","../../Framework/GameManager":"GameManager","../../Generic/PeriodicAnimator":"PeriodicAnimator","../../Generic/Velocity":"Velocity","../../UI/Button":"Button","../../UI/ScreenWidget":"ScreenWidget","../../Util":"index","./GalleryFrame":"GalleryFrame","./RoomManager":"RoomManager","./StudioManager":"StudioManager"}],SceneManager:[function(e,t,n){"use strict";cc._RF.push(t,"d8b03mTiy5IgIi8GaT3KNc0","SceneManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("./GameManager")),u=c(e("./ContentLoader")),d=c(e("./EventRelay")),p=c(e("../Drawing/DrawingHandler")),f=e("../constants"),h=e("../Util"),y=c(e("../UI/Button")),v=cc._decorator.ccclass,_=5*f.ONE_FRAME,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._eventRelay=null,t._canvas=null,t._scribbles=null,t._ink=null,t}return r(t,e),Object.defineProperty(t.prototype,"eventRelay",{get:function(){return this._eventRelay||(this._eventRelay=this.getComponent(d.default)),this._eventRelay},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){if(this._canvas||(this._canvas=h.getComponentInScene(cc.Canvas)),!this._canvas)throw new Error("No canvas in scene.");return this._canvas},enumerable:!0,configurable:!0}),t.prototype.untilAutoLoadContentLoaded=function(){return i(this,void 0,Promise,function(){var e,t,n,r,o,i;return a(this,function(a){switch(a.label){case 0:a.trys.push([0,6,7,8]),n=s(h.getComponentsInScene(u.default)),r=n.next(),a.label=1;case 1:if(r.done)return[3,5];if(!((o=r.value).autoLoad&&o.node&&o.node.active&&o.node.activeInHierarchy))return[3,4];a.label=2;case 2:return o.loaded?[3,4]:[4,h.asyncSchedule(this,_)];case 3:return a.sent(),[3,2];case 4:return r=n.next(),[3,1];case 5:return[3,8];case 6:return i=a.sent(),e={error:i},[3,8];case 7:try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}return[7];case 8:return[2]}})})},t.prototype.loadContent=function(){return Promise.all(h.getComponentsInScene(u.default).map(function(e){return e.loaded?e.contents:e.loadContent()}))},t.prototype.isContentLoaded=function(){return h.getComponentsInScene(u.default).every(function(e){return e.loaded})},t.prototype.isAutoLoadContentLoaded=function(){return h.getComponentsInScene(u.default).every(function(e){return!e.autoLoad||e.loaded||!e.node.active})},t.prototype.allowDrawUI=function(){var e=l.default.drawingUI;return e.enabled=!0,e.show()},t.prototype.createNewDrawing=function(){return l.default.drawingUI.createNewDrawing()},t.prototype.disallowDrawUI=function(){var e=l.default.drawingUI;return e.enabled=!1,e.hide()},t.prototype.getCharacter=function(e){return d.default.actors.find(function(t){return t.skeleton&&t.node.name===e})||null},t.prototype.getScribbles=function(){if(cc.isValid(this._scribbles,!0)||(this._scribbles=this.getCharacter("Scribbles")),!this._scribbles)throw new Error("Scribbles could not be found.");return this._scribbles},t.prototype.getInk=function(){if(cc.isValid(this._ink,!0)||(this._ink=this.getCharacter("Ink")),!this._ink)throw new Error("Ink could not be found.");return this._ink},t.prototype.getScribblesAndInk=function(){return[this.getScribbles(),this.getInk()]},t.prototype.freezeUI=function(){var e,t,n=h.getComponentsInScene(y.default),r=new Map;try{for(var o=s(n),i=o.next();!i.done;i=o.next()){var a=i.value;r.set(a,a.enabled),a.enabled=!1}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return r},t.prototype.unfreezeUI=function(e){var t,n,r=h.getComponentsInScene(y.default);try{for(var o=s(r),i=o.next();!i.done;i=o.next()){var a=i.value,c=e.get(a);"boolean"==typeof c&&(a.enabled=c)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t=o([v],t)}(p.default);n.default=g,cc._RF.pop()},{"../Drawing/DrawingHandler":"DrawingHandler","../UI/Button":"Button","../Util":"index","../constants":"constants","./ContentLoader":"ContentLoader","./EventRelay":"EventRelay","./GameManager":"GameManager"}],ScreenWidget:[function(e,t,n){"use strict";cc._RF.push(t,"7a97f6MTfNHFod5H6b7v2dK","ScreenWidget");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});e("../Util");var i=cc._decorator,a=i.ccclass,s=i.executeInEditMode,c=i.menu,l=i.property;function u(e){cc.sys.isMobile?window.addEventListener("resize",e):cc.view.on("canvas-resize",e)}function d(e){cc.sys.isMobile?window.removeEventListener("resize",e):cc.view.off("canvas-resize",e)}function p(){return!!this.alignToScreenX}function f(){return!!this.alignToScreenY}cc.size(960,640),cc.size(0,0);var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resizeToScreen=!1,t.alignToScreenX=!0,t.alignToScreenY=!0,t.screenX=.5,t.screenY=.5,t.applyMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,t._camera=null,t.align=function(){var e=cc.misc.lerp(-1,1,t.screenX),n=cc.misc.lerp(1,-1,t.screenY),r=null,o=t.getScreenDimensions(),i=o.width,a=o.height;if(t.camera&&(r=t.camera.node.convertToWorldSpaceAR(cc.v2(e*i,n*a)))){var s=t.node.parent.convertToNodeSpaceAR(r);t.alignToScreenX&&(t.node.x=s.x),t.alignToScreenY&&(t.node.y=s.y)}},t.resize=function(){var e=t.getScreenDimensions(!1),n=e.width,r=e.height;if(t.camera){var o=t.camera.node.convertToWorldSpaceAR(cc.v2(-n,-r)),i=t.camera.node.convertToWorldSpaceAR(cc.v2(n,r)),a=Math.abs(o.x-i.x),s=Math.abs(o.y-i.y);t.node.setContentSize(a,s)}},t}return r(t,e),Object.defineProperty(t.prototype,"alignToScreen",{get:function(){return this.alignToScreenX||this.alignToScreenY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){if(!this._camera||!cc.isValid(this._camera,!0)){var e=cc.Camera.main;this._camera=cc.isValid(e)?e:null}return this._camera},set:function(e){this._camera=e},enumerable:!0,configurable:!0}),t.prototype.apply=function(){this.alignToScreen&&this.align(),this.resizeToScreen&&this.resize()},t.prototype.start=function(){var e=this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE;this.apply(),this.alignToScreen&&e&&u(this.align),this.resizeToScreen&&e&&u(this.resize)},t.prototype.update=function(){this.applyMode===cc.Widget.AlignMode.ALWAYS&&this.apply()},t.prototype.onDestroy=function(){var e=this.applyMode===cc.Widget.AlignMode.ON_WINDOW_RESIZE;this.alignToScreen&&e&&d(this.align),this.resizeToScreen&&e&&d(this.resize)},t.prototype.getScreenDimensions=function(e){void 0===e&&(e=!0);var t=cc.view.getFrameSize(),n=t.width,r=t.height,o=e&&this.camera?this.camera.zoomRatio:1,i=cc.view.getScaleX(),a=cc.view.getScaleY(),s=.5*cc.view.getDevicePixelRatio();return cc.size(n*s/i*o,r*s/a*o)},o([l()],t.prototype,"resizeToScreen",void 0),o([l()],t.prototype,"alignToScreenX",void 0),o([l()],t.prototype,"alignToScreenY",void 0),o([l({min:0,max:1,visible:p})],t.prototype,"screenX",void 0),o([l({min:0,max:1,visible:f})],t.prototype,"screenY",void 0),o([l({type:cc.Widget.AlignMode})],t.prototype,"applyMode",void 0),o([l({type:cc.Camera,visible:!0})],t.prototype,"_camera",void 0),t=o([a,s,c("Scribbles And Ink/UI/Screen Widget")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../Util":"index"}],SidewalkSensor:[function(e,t,n){"use strict";cc._RF.push(t,"66682njsIFAAr0uezL+8pEt","SidewalkSensor");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.executeInEditMode,c=i.requireComponent,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._collider=null,t}return r(t,e),Object.defineProperty(t.prototype,"collider",{get:function(){return this._collider||(this._collider=this.getComponent(cc.BoxCollider)),this._collider},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.collider.size.width=this.node.width,this.collider.size.height=this.node.height},t=o([a,s,c(cc.BoxCollider)],t)}(cc.Component);n.default=l,cc._RF.pop()},{}],SnapBoneToNode:[function(e,t,n){"use strict";cc._RF.push(t,"927b04roo1Pm6W6fHxAYof9","SnapBoneToNode");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Framework/EventActor")),s=cc._decorator,c=s.ccclass,l=s.disallowMultiple,u=s.property,d=s.requireComponent,p=s.menu,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t.boneName="",t._actor=null,t}return r(t,e),Object.defineProperty(t.prototype,"actor",{get:function(){if(this._actor||(this._actor=this.getComponent(a.default)),!this._actor)throw new Error("Missing EventActor");return this._actor},enumerable:!0,configurable:!0}),t.prototype.lateUpdate=function(){var e=this.target,t=this.actor,n=this.boneName;if(e&&t&&t.skeleton&&n){var r=t.skeleton.findBone(n);if(r){var o=e.convertToWorldSpaceAR(cc.Vec2.ZERO),i=t.skeleton.node.convertToNodeSpaceAR(o),a=(r.parent||r).worldToLocal(i);Number.isNaN(a.x)||(r.x=a.x),Number.isNaN(a.y)||(r.y=a.y)}}},o([u({type:cc.Node,tooltip:"Node to snap to.",visible:!0})],t.prototype,"target",void 0),o([u({tooltip:"Name of the bone on the spine rig to move."})],t.prototype,"boneName",void 0),t=o([c,l,p("Scribbles And Ink/Character/Snap Bone to Node"),d(a.default)],t)}(cc.Component);n.default=f,cc._RF.pop()},{"../Framework/EventActor":"EventActor"}],SnapNodeToBone:[function(e,t,n){"use strict";cc._RF.push(t,"0c888L3DAVKTJd4M7gAQaXz","SnapNodeToBone");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Framework/EventActor")),s=cc._decorator,c=s.ccclass,l=s.disallowMultiple,u=s.property,d=s.executeInEditMode,p=s.executionOrder,f=s.menu;function h(){return this.useJumpIgnore}var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=null,t.inheritAngle=!1,t.boneName="",t.useJumpIgnore=!1,t.distanceThreshold=50,t._lastPosition=null,t}return r(t,e),t.prototype.lateUpdate=function(){var e=this.target,t=this.boneName;if(e){var n=e.skeleton;if(n&&t){var r=n.findBone(t);if(r){var o=cc.v2(r.worldX,r.worldY),i=n.node.convertToWorldSpaceAR(o),a=this.node.parent?this.node.parent.convertToNodeSpaceAR(i):i;if(this.inheritAngle){var s=e.node.scaleX>0?1:-1;this.node.angle=r.getWorldRotationX()*s+e.node.angle,this.node.scaleX=Math.abs(this.node.scaleX)*s}!(this.useJumpIgnore&&this._lastPosition&&this._lastPosition.sub(a).mag()>this.distanceThreshold)&&this._lastPosition&&this.node.setPosition(a),this._lastPosition=a}}}},o([u({type:a.default,tooltip:"Actor with skeleton to snap to."})],t.prototype,"target",void 0),o([u({tooltip:"Copy the angle of the bone as well."})],t.prototype,"inheritAngle",void 0),o([u({tooltip:"Name of the bone on the spine rig to snap to."})],t.prototype,"boneName",void 0),o([u({tooltip:"To prevent bone jumping errors, ignore bone jump distances beyond a certain threshold."})],t.prototype,"useJumpIgnore",void 0),o([u({visible:h,slide:!0,min:0,max:200})],t.prototype,"distanceThreshold",void 0),t=o([c,l,d,p(-10),f("Scribbles And Ink/Character/Snap Node to Bone")],t)}(cc.Component);n.default=y,cc._RF.pop()},{"../Framework/EventActor":"EventActor"}],SpaceDrift:[function(e,t,n){"use strict";cc._RF.push(t,"206c6Wh+slJNJuStsyqOUvD","SpaceDrift");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./StarBackground")),s=e("../../Util"),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.magnitude=120,t.frequency=90,t.anchor=null,t.autoAnchor=!0,t._minTumble=0,t._maxTumble=0,t._direction=cc.Vec2.ZERO,t._delay=0,t._velocity=cc.Vec2.ZERO,t._angularVelocity=0,t._space=null,t}return r(t,e),Object.defineProperty(t.prototype,"worldSpeed",{get:function(){return this._space||(this._space=cc.director.getScene().getComponentInChildren(a.default)),this._space&&this._space.fakeVelocity?this._space.fakeVelocity.mag():0},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.refreshDirection(),this._angularVelocity=s.Random.float(this._minTumble,this._maxTumble)*(Math.random()>.5?1:-1)},t.prototype.update=function(e){this._delay-=e,this._delay<0&&this.refreshDirection(),this.updateAngle(e),this.updateVelocity(e),this.stickToAnchor(),this.autoAnchor&&this.updateAutoAnchor()},t.prototype.refreshDirection=function(){this._direction=s.Random.v2(this.magnitude);var e=.5*this.frequency,t=60/Math.max(e+Math.random()*e,1);this._delay=t},t.prototype.updateVelocity=function(e){var t=Math.min(this.worldSpeed/500,1);this._velocity.lerp(this._direction.mul(t),1.25*e,this._velocity);var n=this._velocity.mul(e);this.node.setPosition(this.node.position.add(n))},t.prototype.updateAngle=function(e){this.node.angle+=this._angularVelocity*e},t.prototype.stickToAnchor=function(){if(cc.isValid(this.anchor)){var e=this.anchor.position.sub(this.node.position);e.mag()<this.magnitude||(this._direction=e.normalize().mulSelf(this.magnitude))}},t.prototype.updateAutoAnchor=function(){var e=this.node.getNumberOfRunningActions(),t=cc.isValid(this.anchor)?this.anchor:null;t&&e>0?(t.destroy(),this.anchor=null):t||0!==e||(this.anchor=new cc.Node(this.node.name+" Target Anchor"),this.anchor.setParent(this.node.parent),this.anchor.setPosition(this.node.position))},t.prototype.setEnabled=function(e){this.enabled=e},o([d({tooltip:"Higher values mean father drift. Pixels per second.",step:1,min:0})],t.prototype,"magnitude",void 0),o([d({tooltip:"Drift direction changes per minute.",min:1,step:1})],t.prototype,"frequency",void 0),o([d({type:cc.Node,tooltip:"If set, the drift will correct itself to prevent getting too far away from the anchor."})],t.prototype,"anchor",void 0),o([d({tooltip:"If true, anchor will automatically be created moved when an action affects the movement of this node.",formerlySerializedAs:"autoUpdateAnchor"})],t.prototype,"autoAnchor",void 0),o([d({min:0,visible:!0})],t.prototype,"_minTumble",void 0),o([d({min:0,visible:!0})],t.prototype,"_maxTumble",void 0),t=o([l,u],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../Util":"index","./StarBackground":"StarBackground"}],SpaceStoryManager:[function(e,t,n){"use strict";cc._RF.push(t,"890b9DyF5xP9oUS3RSrRvBb","SpaceStoryManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("../../Framework/StoryManager")),u=c(e("../../Generic/PrefabEmitter")),d=c(e("../../Framework/GameManager")),p=c(e("./StickToStarBackground")),f=c(e("../../Generic/Temporary")),h=c(e("../../Framework/EventRelay")),y=e("../../Drawing/DrawingStorage"),v=e("../../Util"),_=c(e("../../Drawing/Drawing")),g=c(e("./FlubberChaser")),m=c(e("./FlubberDynamicSplat")),b=cc._decorator,w=b.ccclass,S=b.property,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._spaceJunkPrefab=null,t._spaceJunkMaxVariations=3,t._spaceJunkStorageKey="Space:Junk",t._planetNodeName="Planet",t._rocketNodeName="Rocket",t._rocketReplayTargetNode=null,t._rocketReplayDuration=1,t._rocketSmokeNodeName="RocketSmoke",t._drawingParentNodeName="Drawing Parent",t.inkFlubberChaseAnimation="I_Mo_Run_Stars",t.inkFlubberChaseAnimationTrack=0,t.scribblesFlubberChaseAnimation="S_Mo_Run_Stars",t.ScribblesFlubberChaseAnimationTrack=0,t._asteroidEmitter=null,t}return r(t,e),Object.defineProperty(t.prototype,"planet",{get:function(){var e=this,t=h.default.actors.find(function(t){return t.node.name===e._planetNodeName});if(!t)throw new Error("Could not find Planet");return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asteriodEmitter",{get:function(){if(this._asteroidEmitter||(this._asteroidEmitter=v.getComponentsInScene(u.default).find(function(e){return"Asteroid Emitter"===e.node.name})||null),!this._asteroidEmitter)throw new Error("Asteroid Emitter could not be found.");return this._asteroidEmitter},enumerable:!0,configurable:!0}),t.prototype.handleJunkDrawingConfirm=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:if(d.default.drawingUI.storageKey!==this._spaceJunkStorageKey)throw new Error("Only use the saveSpaceJunkDrawing function for saving the "+this._spaceJunkPrefab+" drawing.");return[4,this.clearJunkDrawing()];case 1:return e.sent(),this.currentStoryBlock&&this.currentStoryBlock.completeAndAdanvce(),this.ensureAsteroidEmitterEmittingJunkDrawing(),[2]}})})},t.prototype.moveCurrentDrawingToPlanet=function(){var e=d.default.drawingUI;if(!e.currentDrawing)throw new Error("No current drawing");var t=v.getDescendentByName(this._drawingParentNodeName,this.planet.node);if(!t)throw new Error("Could not find Drawing Parent");e.currentDrawing.node.setParent(t)},t.prototype.clearPlanetDrawing=function(){var e=v.getDescendentByName(this._drawingParentNodeName,this.planet.node);if(!e)throw new Error("Could not find Drawing Parent");var t=e.getComponentInChildren(_.default);t&&t.node.destroy()},t.prototype.stopScribblesAndInkFromChasingFlubber=function(){var e,t;try{for(var n=s(v.getComponentsInScene(g.default)),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.ensureScribblesAndInkAreChasingFlubber=function(){var e,t;if(!d.default.isLowEndDevice)try{for(var n=s(this.getScribblesAndInk()),r=n.next();!r.done;r=n.next()){var o=r.value,i=o.getComponent(g.default)||o.addComponent(g.default);i.motionAnimation=o===this.getScribbles()?this.scribblesFlubberChaseAnimation:this.inkFlubberChaseAnimation,i.track=o===this.getScribbles()?this.ScribblesFlubberChaseAnimationTrack:this.inkFlubberChaseAnimationTrack}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.makeRemainingFlubberUnsavable=function(){var e,t,n=v.getComponentsInScene(m.default);try{for(var r=s(n),o=r.next();!o.done;o=r.next()){var i=o.value.getComponent(f.default);i&&(i.shrinkTime=.25)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.killRocketSmoke=function(){var e=this,t=h.default.actors.find(function(t){return t.node.name===e._rocketSmokeNodeName})||null,n=t&&t.getComponent(cc.Animation);n&&(n.setCurrentTime(0),n.stop())},t.prototype.sendRocketOffScreen=function(){var e=this,t=h.default.actors.find(function(t){return t.node.name===e._rocketNodeName});if(t&&this._rocketReplayTargetNode)return v.transformToTarget(t.node,this._rocketReplayTargetNode,this._rocketReplayDuration)},t.prototype.onGameStart=function(){return i(this,void 0,Promise,function(){var e;return a(this,function(t){switch(t.label){case 0:return e=d.default.drawingStorage,d.default.isLowEndDevice?[2]:(e.setNumMaxVariations(this._spaceJunkStorageKey,this._spaceJunkMaxVariations),[4,e.deleteStoredDrawing({variationStrategy:y.DeleteVariation.Every,storageKey:this._spaceJunkStorageKey,serialize:!0})]);case 1:return t.sent(),[2]}})})},t.prototype.clearJunkDrawing=function(){return i(this,void 0,Promise,function(){var e,t,n,r;return a(this,function(o){switch(o.label){case 0:return e=d.default.drawingUI,!(t=e.currentDrawing)||t.isEmpty?[3,2]:[4,e.saveDrawing()];case 1:return o.sent(),(n=t.node.addComponent(p.default)).stickiness=0,r=20,n.schedule(function(){n.stickiness+=.6/r},1/r,r),t.node.addComponent(f.default).reset(5,6),[3,3];case 2:t&&t.isEmpty&&t.node.destroy(),o.label=3;case 3:return e.currentDrawing=null,[2,t]}})})},t.prototype.ensureAsteroidEmitterEmittingJunkDrawing=function(){this._spaceJunkPrefab&&!this.asteriodEmitter.prefabs.includes(this._spaceJunkPrefab)&&(this.asteriodEmitter.prefabs=[this._spaceJunkPrefab],this.asteriodEmitter.node.active=!0)},o([S({type:cc.Prefab,visible:!0})],t.prototype,"_spaceJunkPrefab",void 0),o([S({step:1,min:0,visible:!0})],t.prototype,"_spaceJunkMaxVariations",void 0),o([S({visible:!0})],t.prototype,"_spaceJunkStorageKey",void 0),o([S({visible:!0})],t.prototype,"_planetNodeName",void 0),o([S({visible:!0})],t.prototype,"_rocketNodeName",void 0),o([S({type:cc.Node,visible:!0})],t.prototype,"_rocketReplayTargetNode",void 0),o([S({visible:!0})],t.prototype,"_rocketReplayDuration",void 0),o([S({visible:!0})],t.prototype,"_rocketSmokeNodeName",void 0),o([S({visible:!0})],t.prototype,"_drawingParentNodeName",void 0),o([S()],t.prototype,"inkFlubberChaseAnimation",void 0),o([S()],t.prototype,"inkFlubberChaseAnimationTrack",void 0),o([S()],t.prototype,"scribblesFlubberChaseAnimation",void 0),o([S()],t.prototype,"ScribblesFlubberChaseAnimationTrack",void 0),t=o([w],t)}(l.default);n.default=O,cc._RF.pop()},{"../../Drawing/Drawing":"Drawing","../../Drawing/DrawingStorage":"DrawingStorage","../../Framework/EventRelay":"EventRelay","../../Framework/GameManager":"GameManager","../../Framework/StoryManager":"StoryManager","../../Generic/PrefabEmitter":"PrefabEmitter","../../Generic/Temporary":"Temporary","../../Util":"index","./FlubberChaser":"FlubberChaser","./FlubberDynamicSplat":"FlubberDynamicSplat","./StickToStarBackground":"StickToStarBackground"}],SpringRollTestUI:[function(e,t,n){"use strict";cc._RF.push(t,"6fa5aDgJGtCLYbThfO+ov7r","SpringRollTestUI");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("../Drawing/DrawingHandler")),c=cc._decorator.ccclass,l={disabledOpacity:125,enabledOpacity:255},u={disabledOpacity:255,enabledOpacity:125},d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){var e,t;this.node.destroy();try{for(var n=i(this.node.children),r=n.next();!r.done;r=n.next()){r.value.active=!1}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.onDrawEnabled=function(){this.moveToFront()},t.prototype.toggleSpringRollOption=function(e,t){if(!cc.springRoll)throw new Error("springRoll state is missing");if("pause"!==t&&"captionsMuted"!==t&&"voVolume"!==t&&"musicVolume"!==t&&"sfxVolume"!==t&&"soundVolume"!==t)throw new Error(t+" is not a valid springRoll substate");var n=cc.springRoll[t];n.value="boolean"==typeof n.value?!n.value:0===n.value?1:0;var r=t.includes("caption")?u:l,o=r.enabledOpacity,i=r.disabledOpacity;e.target.opacity=n.value?o:i},t.prototype.moveToFront=function(){this.node.setSiblingIndex(this.node.parent.childrenCount-1)},t=o([c],t)}(s.default);n.default=d,cc._RF.pop()},{"../Drawing/DrawingHandler":"DrawingHandler"}],StarBackground:[function(e,t,n){"use strict";cc._RF.push(t,"e65d63VBG1M24JKnk71CEwM","StarBackground");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./StickToStarBackground")),c=e("../../Util"),l=cc._decorator,u=l.ccclass,d=l.disallowMultiple,p=l.executeInEditMode,f=l.property;function h(e,t){var n=2*t;return e<-t&&(e=e%n+n),e>t&&(e=e%n-n),e}var y=.5,v=1.5,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._minStars=50,t._starSprites=[],t.targetFakeVelocity=cc.Vec2.ZERO,t.fakeVelocity=cc.Vec2.ZERO,t._camera=null,t}return r(t,e),Object.defineProperty(t.prototype,"camera",{get:function(){return cc.isValid(this._camera)||(this._camera=cc.Camera.main),this._camera},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.getComponent(s.default)||this.addComponent(s.default)},t.prototype.update=function(e){var t,n;this.fakeVelocity.lerp(this.targetFakeVelocity,e,this.fakeVelocity);try{for(var r=i(this.node.children),o=r.next();!o.done;o=r.next()){var a=o.value;a.active&&this.tileStarInView(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},t.prototype.setTargetVelocity=function(e,t){var n="number"==typeof e;n&&"number"!=typeof t&&(t=e),n&&(e=cc.v2(e,t)),this.targetFakeVelocity.set(e)},t.prototype.tileStarInView=function(e){var t=this.node,n=this.camera;if(n){var r=t.convertToWorldSpaceAR(e.position),o=n.node.convertToNodeSpaceAR(r),i=n.node.getContentSize(),a=cc.v2(h(o.x,i.width),h(o.y,i.height));if(!a.equals(o)){var s=n.node.convertToWorldSpaceAR(a),c=t.convertToNodeSpaceAR(s);e.x=c.x,e.y=c.y}}},t.prototype.ensureStars=function(){for(var e=this.camera?this.camera.node:this.node,t=e.width,n=e.height;this.node.children.length<this._minStars;){var r=new cc.Node("Star");r.setParent(this.node),r.setPosition(cc.v2(Math.random()*t*2-n,Math.random()*n*2-n)),r.scaleX=r.scaleY=c.Random.float(y,v),r.angle=c.Random.float(0,360),r.addComponent(cc.Sprite).spriteFrame=c.Random.item(this._starSprites)}},o([f({visible:!0})],t.prototype,"_minStars",void 0),o([f({type:cc.SpriteFrame,visible:!0})],t.prototype,"_starSprites",void 0),o([f({tooltip:"Speed at which the background appears to be moving."})],t.prototype,"targetFakeVelocity",void 0),t=o([u,d,p],t)}(cc.Component);n.default=_,cc._RF.pop()},{"../../Util":"index","./StickToStarBackground":"StickToStarBackground"}],StartSceneManager:[function(e,t,n){"use strict";cc._RF.push(t,"66639xYrXRE8JOSDEqTuCEu","StartSceneManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=l(e("../../Framework/SceneManager")),d=l(e("../../UI/Button")),p=l(e("../../Framework/EventActor")),f=l(e("../../Framework/ContentLoader")),h=l(e("../../Framework/GameManager")),y=e("../../Util"),v=l(e("../../Generic/PeriodicAnimator")),_=cc._decorator,g=_.ccclass,m=_.executeInEditMode,b=_.property,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._startButton=null,t._startAnimations=[],t._scribblesAndInkContentLoaders=[],t._indicatorContentLoader=null,t._gameScene="Studio",t}return r(t,e),t.prototype.onLoad=function(){cc.Camera.main.enabled=!1},t.prototype.onFocusInEditor=function(){this.ensureStartButtonHandlers()},t.prototype.onSceneStart=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.untilAutoLoadContentLoaded()];case 1:return e.sent(),[4,h.default.preloadScene(this._gameScene)];case 2:return e.sent(),this.ensureStartButtonHandlers(),h.default.loadingScreen.enabled=!1,h.default.isLowEndDevice?this.showStartButtonIdle():this.showStartButtonSequence(),[2]}})})},t.prototype.startGame=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.playStartAnimations()];case 1:return e.sent(),[4,h.default.loadScene(this._gameScene)];case 2:return e.sent(),[2]}})})},t.prototype.playStartAnimations=function(){return i(this,void 0,Promise,function(){var e,t,n,r,o,i,c;return a(this,function(a){switch(a.label){case 0:n=[],r=function(e){e.play(),n.push(new Promise(function(t){e.once(cc.Animation.EventType.FINISHED,t)}))};try{for(o=s(this._startAnimations),i=o.next();!i.done;i=o.next())c=i.value,r(c)}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return[4,Promise.all(n)];case 1:return a.sent(),[2]}})})},t.prototype.ensureStartButtonHandlers=function(){if(!this._startButton)throw new Error("No start button is assigned to StartSceneManager");y.ensureEventHandler(this._startButton.clickEvents,{target:this.node,handler:"startGame",component:y.nameOfComponent(this)})},t.prototype.showStartButtonIdle=function(){if(this._startButton){var e=this._startButton.getComponent(cc.Widget);e&&(e.enabled=!0,e.updateAlignment());var t=this._startButton.getComponentInChildren(p.default);if(t&&t.skeleton&&t.playSpineClip("Button_Iddle",0,0,!1),t&&this._indicatorContentLoader){var n=c(this._indicatorContentLoader.createInstances(),1)[0],r=n&&n.getComponent(v.default);r&&e&&(r.node.setParent(t.node.parent),r.node.setPosition(t.node.position)),r&&r.play()}}},t.prototype.showStartButtonSequence=function(){var e,t;if(this.eventRelay){try{for(var n=s(this._scribblesAndInkContentLoaders),r=n.next();!r.done;r=n.next()){r.value.createInstances()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.eventRelay.playSequence()}},o([b({type:d.default,visible:!0})],t.prototype,"_startButton",void 0),o([b({type:cc.Animation,visible:!0,displayName:"Transition Animations"})],t.prototype,"_startAnimations",void 0),o([b({type:f.default,visible:!0})],t.prototype,"_scribblesAndInkContentLoaders",void 0),o([b({type:f.default,visible:!0})],t.prototype,"_indicatorContentLoader",void 0),o([b({visible:!0,displayName:"Name of the scene where the gameplay actually begins."})],t.prototype,"_gameScene",void 0),t=o([g,m],t)}(u.default);n.default=w,cc._RF.pop()},{"../../Framework/ContentLoader":"ContentLoader","../../Framework/EventActor":"EventActor","../../Framework/GameManager":"GameManager","../../Framework/SceneManager":"SceneManager","../../Generic/PeriodicAnimator":"PeriodicAnimator","../../UI/Button":"Button","../../Util":"index"}],StaticRainDrop:[function(e,t,n){"use strict";cc._RF.push(t,"b10ceGW5zlKhb0IlnB7tNRq","StaticRainDrop");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../Util"),a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._minRepetitions=3,t._maxRepetitions=6,t._repetitions=0,t._lastY=0,t}return r(t,e),t.prototype.start=function(){this._repetitions=i.Random.integer(this._minRepetitions,this._maxRepetitions),this._lastY=this.node.y},t.prototype.update=function(){this.node.y>=this._lastY&&this._repetitions--,this._lastY=this.node.y,this._repetitions<=0&&this.node.destroy()},o([c({min:1,step:1,visible:!0})],t.prototype,"_minRepetitions",void 0),o([c({min:1,step:1,visible:!0})],t.prototype,"_maxRepetitions",void 0),t=o([s],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../../Util":"index"}],StickToStarBackground:[function(e,t,n){"use strict";cc._RF.push(t,"007fbz6ov1IO6DM/kCtxMyz","StickToStarBackground");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./StarBackground")),s=e("../../Util"),c=cc._decorator,l=c.ccclass,u=c.disallowMultiple,d=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stickiness=1,t._stars=null,t}return r(t,e),Object.defineProperty(t.prototype,"stars",{get:function(){return this._stars||(this._stars=s.getComponentInScene(a.default)),this._stars},enumerable:!0,configurable:!0}),t.prototype.update=function(e){var t=this.stars;if(t){var n=t.fakeVelocity.mul(e*this.stickiness),r=this.node.position.sub(n);this.node.setPosition(r)}},t.prototype.setEnabled=function(e){this.enabled=e},o([d({tooltip:"How much this node moves with respect to the background speed.",min:0,max:1,slide:!0})],t.prototype,"stickiness",void 0),t=o([l,u],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../Util":"index","./StarBackground":"StarBackground"}],Storage:[function(e,t,n){"use strict";cc._RF.push(t,"cf7bfjEHJlN7YEdcCCRPZB5","Storage");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var d=u(e("../Vendor/pako")),p=e("../Vendor/idb/idb"),f=e("../constants"),h=e("../Util"),y=cc._decorator,v=y.ccclass,_=y.property,g=y.menu,m=y.disallowMultiple,b=2*f.ONE_FRAME,w=["debug"];function S(e){return"object"==typeof e&&null!==e}function O(e,t){if(void 0===t)return!0;if(S(e)&&S(t)){for(var n in t)if(t[n]!==e[n])return!1;return!0}return e===t}var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._databaseName="",t._databaseVersion=0,t._idbTimeout=3,t._forceLocalStorage=!1,t._indexDB=null,t._storeNames=new Set,t._storesInitialized=!1,t._memory={},t}return r(t,e),Object.defineProperty(t.prototype,"databaseName",{get:function(){return this._databaseName+"@release"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"databaseVersion",{get:function(){return this._databaseVersion},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usingLocalStorage",{get:function(){return!this._indexDB},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usingIndexDB",{get:function(){return!!this._indexDB},enumerable:!0,configurable:!0}),t.prototype.registerStores=function(e){var t,n;if(this._storesInitialized)throw new Error("Stores must be registered before initialized.");try{for(var r=s(e),o=r.next();!o.done;o=r.next()){var i=o.value;this._storeNames.add(i)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},t.prototype.initializeStores=function(){return i(this,void 0,Promise,function(){var e,t,n=this;return a(this,function(r){switch(r.label){case 0:if(this._storesInitialized)throw new Error("Storage already initialized.");if(this._storesInitialized=!0,!(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Promise.race([p.openDB(this.databaseName,this.databaseVersion,{upgrade:function(e){var t,r,o,i;try{for(var a=s(Array.from(e.objectStoreNames)),c=a.next();!c.done;c=a.next()){var l=c.value;e.deleteObjectStore(l)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}try{for(var u=s(n._storeNames),d=u.next();!d.done;d=u.next()){var p=d.value;e.createObjectStore(p)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}}),h.asyncSchedule(this,this._idbTimeout)])];case 2:if(!(e=r.sent()))throw new Error("IndexDB timed out.");return this._indexDB=e,[3,4];case 3:return t=r.sent(),cc.error("Could not initialize IndexDB",t.name+" : "+t.message),[3,4];case 4:return this.usingIndexDB||this.clearLocalStorageVersionMismatchKeys(),cc.log("storage initialized with "+(this.usingIndexDB?"indexDB":"localStorage")),[2]}})})},t.prototype.setMem=function(e,t,n){this.checkStoreName(e);var r=this._memory[e];r||(r=this._memory[e]={}),r[t]=n},t.prototype.hasMem=function(e,t){this.checkStoreName(e);var n=this._memory[e];return!!n&&!!n[t]},t.prototype.getMem=function(e,t){this.checkStoreName(e);var n=this._memory[e],r=n&&n[t];return null==r?null:r},t.prototype.findMem=function(e,t){this.checkStoreName(e);var n=new Map,r=this._memory[e];if(r)for(var o in r){var i=r[o];O(i,t)&&n.set(o,i)}return n},t.prototype.deleteMem=function(e,t){this.checkStoreName(e);var n=this._memory[e];n&&delete n[t]},t.prototype.set=function(e,t,n){return this.checkStoreName(e),this.usingIndexDB?this.setInIndexDB(e,t,n):this.setInLocalStorage(e,t,n)},t.prototype.has=function(e,t){return this.checkStoreName(e),this.usingIndexDB?this.hasInIndexDB(e,t):this.hasInLocalStorage(e,t)},t.prototype.get=function(e,t){return this.checkStoreName(e),this.usingIndexDB?this.getInIndexDB(e,t):this.getInLocalStorage(e,t)},t.prototype.delete=function(e,t){return this.checkStoreName(e),this.usingIndexDB?this.deleteInIndexDB(e,t):this.deleteInLocalStorage(e,t)},t.prototype.find=function(e,t){return this.checkStoreName(e),this.usingIndexDB?this.findInIndexDB(e,t):this.findInLocalStorage(e,t)},t.prototype.checkStoreName=function(e){if(!this._storesInitialized)throw new Error("Stores must be registered before using the storage API.");if(!this._storeNames.has(e))throw new Error(e+" is not a recognized storeName. must be one of: "+l(this._storeNames))},t.prototype.setInIndexDB=function(e,t,n){return i(this,void 0,Promise,function(){var r,o;return a(this,function(i){switch(i.label){case 0:return r=this._indexDB,o=r.transaction(e,"readwrite"),[4,o.objectStore(e).put(n,t)];case 1:return i.sent(),[2]}})})},t.prototype.hasInIndexDB=function(e,t){return i(this,void 0,Promise,function(){return a(this,function(n){switch(n.label){case 0:return[4,this.getInIndexDB(e,t)];case 1:return[2,null!=n.sent()]}})})},t.prototype.getInIndexDB=function(e,t){return i(this,void 0,Promise,function(){var n,r;return a(this,function(o){switch(o.label){case 0:return n=this._indexDB,r=n.transaction(e,"readonly"),[4,r.objectStore(e).get(t)];case 1:return[2,o.sent()]}})})},t.prototype.deleteInIndexDB=function(e,t){return i(this,void 0,Promise,function(){var n,r;return a(this,function(o){switch(o.label){case 0:return n=this._indexDB,r=n.transaction(e,"readwrite"),[4,r.objectStore(e).delete(t)];case 1:return o.sent(),[2]}})})},t.prototype.findInIndexDB=function(e,t){return i(this,void 0,Promise,function(){var n,r,o,i,s;return a(this,function(a){switch(a.label){case 0:return n=this._indexDB,r=n.transaction(e,"readonly"),o=r.objectStore(e),i=new Map,[4,o.openCursor()];case 1:s=a.sent(),a.label=2;case 2:return s?(O(s.value,t)&&i.set(s.primaryKey.toString(),s.value),[4,s.continue()]):[3,4];case 3:return s=a.sent(),[3,2];case 4:return[2,i]}})})},t.prototype.setInLocalStorage=function(e,t,n){var r=this.getLocalStorageStore(e),o=d.default.deflate(JSON.stringify(n),{to:"string"});r[t]=o;var i=this.getLocalStorageStoreKey(e),a=JSON.stringify(r);return Promise.resolve(cc.sys.localStorage.setItem(i,a))},t.prototype.hasInLocalStorage=function(e,t){var n=t in this.getLocalStorageStore(e);return Promise.resolve(n)},t.prototype.deleteInLocalStorage=function(e,t){var n=this.getLocalStorageStore(e);delete n[t];var r=this.getLocalStorageStoreKey(e),o=JSON.stringify(n);return Promise.resolve(cc.sys.localStorage.setItem(r,o))},t.prototype.getInLocalStorage=function(e,t){var n=this.getLocalStorageStore(e)[t];null!=n&&(n=d.default.inflate(n,{to:"string"}));var r=n?JSON.parse(n):null;return Promise.resolve(r)},t.prototype.findInLocalStorage=function(e,t){return i(this,void 0,Promise,function(){var n,r,o,i,s,c,l,u,p;return a(this,function(a){switch(a.label){case 0:for(s in n=this.getLocalStorageStore(e),r=new Map,o=h.chunker.uniqueKey(),h.chunker.start(o),i=[],n)i.push(s);c=0,a.label=1;case 1:return c<i.length?(l=i[c],null!=(u=n[l])&&(u=d.default.inflate(u,{to:"string"})),O(p=u?JSON.parse(u):null,t)&&r.set(l,p),h.chunker.check(o,b)?[4,h.asyncSchedule(this,f.ONE_FRAME)]:[3,3]):[3,4];case 2:a.sent(),a.label=3;case 3:return c++,[3,1];case 4:return[2,r]}})})},t.prototype.getLocalStorageStoreKey=function(e){return this.databaseName+"-"+this.databaseVersion+"-"+e},t.prototype.getLocalStorageStore=function(e){var t=this.getLocalStorageStoreKey(e),n=cc.sys.localStorage.getItem(t);return n?JSON.parse(n):{}},t.prototype.clearLocalStorageVersionMismatchKeys=function(){for(var e=0;e<cc.sys.localStorage.length;e++){var t=cc.sys.localStorage.key(e);this.keepLocalStorageKey(t)||cc.sys.localStorage.removeItem(t)}},t.prototype.keepLocalStorageKey=function(e){var t,n;if(w.includes(e))return!0;var r=!1;try{for(var o=s(this._storeNames),i=o.next();!i.done;i=o.next()){var a=i.value;e===this.getLocalStorageStoreKey(a)&&(r=!0)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r||cc.log(e,"is being removed."),r},o([_({tooltip:"The name of the database to be initialized inside of IndexDB.\nIf IndexDB does not exist, this key will prefix all localStorage keys.",visible:!0})],t.prototype,"_databaseName",void 0),o([_({tooltip:"The database version. Increment to provide an easy way to invalidate data from previous builds.",visible:!0,step:1,min:0})],t.prototype,"_databaseVersion",void 0),o([_({tooltip:"Amount of time before IndexDB database open times out.",min:1,visible:!0})],t.prototype,"_idbTimeout",void 0),o([_({tooltip:"Force local-storage instead of indexDB.\n\nOnly works in development.",visible:!0})],t.prototype,"_forceLocalStorage",void 0),t=o([v,m,g("Scribbles And Ink/Framework/Storage")],t)}(cc.Component);n.default=P,cc._RF.pop()},{"../Util":"index","../Vendor/idb/idb":"idb","../Vendor/pako":"pako","../constants":"constants"}],StoryBlockReplayOptions:[function(e,t,n){"use strict";cc._RF.push(t,"06318v1flJFzo/OMui6j9cj","StoryBlockReplayOptions");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../constants"),s=cc._decorator,c=s.ccclass,l=s.property,u=Object.keys(a.ANALYTICS).reduce(function(e,t,n){return e[t]=n,e},{}),d=Object.values(a.ANALYTICS),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onReplay=[],t.onNext=[],t.replayBlockIndex=0,t.replayScene="",t._analyticOption=Object.values(u)[0],t.replayAnalyticLabel="",t.nextAnalyticLabel="",t}return r(t,e),Object.defineProperty(t.prototype,"replayAnalytic",{get:function(){return o({},d[this._analyticOption],{label:this.replayAnalyticLabel})},set:function(e){this.setAnalyticOption(e),this.replayAnalyticLabel=e.label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextAnalytic",{get:function(){return o({},d[this._analyticOption],{label:this.replayAnalyticLabel})},set:function(e){this.setAnalyticOption(e),this.nextAnalyticLabel=e.label},enumerable:!0,configurable:!0}),t.prototype.setAnalyticOption=function(e){this._analyticOption=d.reduce(function(t,n,r){return n.action===e.action?r:t},-1)},i([l({type:cc.Component.EventHandler})],t.prototype,"onReplay",void 0),i([l({type:cc.Component.EventHandler})],t.prototype,"onNext",void 0),i([l()],t.prototype,"replayBlockIndex",void 0),i([l()],t.prototype,"replayScene",void 0),i([l({type:cc.Enum(u),visible:!0,displayName:"Analytic",formerlySerializedAs:"_replayAnalyticOption"})],t.prototype,"_analyticOption",void 0),i([l()],t.prototype,"replayAnalyticLabel",void 0),i([l()],t.prototype,"nextAnalyticLabel",void 0),t=i([c],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../constants":"constants"}],StoryBlockReplayOverride:[function(e,t,n){"use strict";cc._RF.push(t,"bde41100lFKFr9Fk9s390gS","StoryBlockReplayOverride");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var c=s(e("../UI/StoryBlockReplayOptions")),l=s(e("./StoryManager")),u=e("../Util"),d=cc._decorator,p=d.ccclass,f=d.menu,h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.override=function(){var e=u.getComponentInParents(this.node,l.default);if(!e)throw new Error("Should be on a storyblock node parented to a story manager");var t=e.ensureStoryBlockReplay();t.nextAnalytic=this.nextAnalytic,t.replayAnalyticLabel=this.replayScene,t.replayBlockIndex=this.replayBlockIndex,t.replayScene=this.replayScene,t.onReplay=a(this.onReplay),t.onNext=a(this.onNext)},t=o([p,f("Scribbles And Ink/Framework/Story Block Replay Override")],t)}(c.default);n.default=h,cc._RF.pop()},{"../UI/StoryBlockReplayOptions":"StoryBlockReplayOptions","../Util":"index","./StoryManager":"StoryManager"}],StoryBlockReplay:[function(e,t,n){"use strict";cc._RF.push(t,"04637yEx+ZHvIGK81VABzJo","StoryBlockReplay");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=l(e("./StoryBlockReplayOptions")),d=l(e("../Framework/StoryManager")),p=l(e("../Framework/GameManager")),f=l(e("./Button")),h=l(e("../Generic/Hider")),y=e("../Util"),v=cc._decorator,_=v.ccclass,g=v.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._hider=null,t._storyManager=null,t._destroyWhenHidden=!1,t}return r(t,e),Object.defineProperty(t.prototype,"hider",{get:function(){if(!this._hider)throw new Error("Replay Button must be set in the inspector.");return this._hider},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyManager",{get:function(){if(cc.isValid(this._storyManager,!0)||(this._storyManager=y.getComponentInScene(d.default)),!this._storyManager)throw new Error("StoryBlockReplay must be in a scene with a story manager.");return this._storyManager},set:function(e){this._storyManager=e},enumerable:!0,configurable:!0}),t.prototype.replayBlock=function(){return a(this,void 0,Promise,function(){var e,t,n,r,i,a,l=this;return s(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),n=c(this.onReplay),r=n.next(),s.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,y.executeEventHandler(i,null)]);case 2:s.sent(),s.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=s.sent(),e={error:a},[3,7];case 6:try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}return[7];case 7:return this.replayAnalytic?[4,p.default.analytics.send(o({},this.replayAnalytic))]:[3,9];case 8:s.sent(),s.label=9;case 9:return this.storyManager.enabled=!1,this.storyManager.currentStoryBlock&&this.storyManager.currentStoryBlock.complete(),!this.replayScene||p.default.currentSceneName===this.replayScene?(this.storyManager.startBlockAtIndex(this.replayBlockIndex),this.storyManager.enabled=!0,[3,12]):[3,10];case 10:return[4,this.storyManager.goToScene(this.replayScene,!0,function(e){var t=e.getComponentInChildren(d.default);t&&t.setFirstBlockIndex(l.replayBlockIndex)})];case 11:s.sent(),s.label=12;case 12:return this.hideAndDestroy(),p.default.audio.stopAll(),[2]}})})},t.prototype.nextBlock=function(){return a(this,void 0,Promise,function(){var e,t,n,r,i,a;return s(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),n=c(this.onNext),r=n.next(),s.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,y.executeEventHandler(i,null)]);case 2:s.sent(),s.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=s.sent(),e={error:a},[3,7];case 6:try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}return[7];case 7:return this.nextAnalytic?[4,p.default.analytics.send(o({},this.nextAnalytic))]:[3,9];case 8:s.sent(),s.label=9;case 9:return this.hideAndDestroy(),this.storyManager.currentStoryBlock&&this.storyManager.currentStoryBlock.completeAndAdanvce(),[2]}})})},t.prototype.show=function(){var e,t;this.hider.enabled=!1;var n=this.getComponentsInChildren(f.default);try{for(var r=c(n),o=r.next();!o.done;o=r.next()){o.value.enabled=!0}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.hide=function(){var e,t;this.hider.enabled=!0;var n=this.getComponentsInChildren(f.default);try{for(var r=c(n),o=r.next();!o.done;o=r.next()){o.value.enabled=!1}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.hideAndDestroy=function(){this.hide(),this._destroyWhenHidden=!0},t.prototype.update=function(){cc.isValid(this.node)&&(this._destroyWhenHidden||p.default.currentStoryName||this.hideAndDestroy(),this._destroyWhenHidden&&this.hider.hideTransformer&&this.hider.hideTransformer.isApplied&&this.destroy())},t.prototype.onDestroy=function(){this.node.destroy()},i([g({type:h.default,visible:!0})],t.prototype,"_hider",void 0),t=i([_],t)}(u.default);n.default=m,cc._RF.pop()},{"../Framework/GameManager":"GameManager","../Framework/StoryManager":"StoryManager","../Generic/Hider":"Hider","../Util":"index","./Button":"Button","./StoryBlockReplayOptions":"StoryBlockReplayOptions"}],StoryBlock:[function(e,t,n){"use strict";cc._RF.push(t,"adfde5trptJH7dXciPPsQNJ","StoryBlock");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var l=c(e("./EventRelay")),u=c(e("../Drawing/DrawingUIOverride")),d=c(e("./GameManager")),p=e("../Util"),f=c(e("./EventSequencer")),h=c(e("./StoryManager")),y=c(e("./StoryBlockReplayOverride")),v=cc._decorator,_=v.ccclass,g=v.property,m=v.menu,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sequence=null,t.loop=!1,t.autoComplete=!0,t.usePhysics=!1,t.useCollisions=!1,t.applySkeletonResetFlag=!0,t.onExecuteEvents=[],t._drawingUIOverride=null,t._drawReactions=null,t._eventRelay=null,t._complete=!1,t.autoCompleteHandler=function(e){e===t.sequence&&cc.isValid(t)&&t.completeAndAdanvce()},t}return r(t,e),Object.defineProperty(t.prototype,"drawingUIOverride",{get:function(){return cc.isValid(this._drawingUIOverride,!0)||(this._drawingUIOverride=this.getComponent(u.default)),this._drawingUIOverride},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawReactions",{get:function(){return this._drawReactions||(this._drawReactions=this.getComponent(f.default)),this._drawReactions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDrawingBlock",{get:function(){return!!this.drawingUIOverride},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventRelay",{get:function(){return this._eventRelay},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this._eventRelay?this._eventRelay.sequenceProgress:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._complete&&(!this._eventRelay||!this._eventRelay.sequenceIsPlaying)},enumerable:!0,configurable:!0}),t.prototype.execute=function(e){var t=this;cc.log("executing block",this.node.name),this._complete=!1,this.prepareDrawing(),this.preparePhysics(),this.prepareBlockReplay();var n=this.executeComponentEvents();n instanceof Promise?n.then(function(){return t.executeEventRelaySequence(e)}):this.executeEventRelaySequence(e)},t.prototype.completeAndAdanvce=function(){this.complete();var e=p.getComponentInParents(this.node,h.default);cc.isValid(e,!0)&&e.enabled&&e.advanceToNextBlock()},t.prototype.complete=function(){cc.log("completing block",this.node.name),this._complete=!0,!this.loop&&this.autoComplete&&this.removeAutoCompleteHandler(),this._eventRelay&&this._eventRelay.sequenceIsPlaying&&this._eventRelay.sequence===this.sequence&&this._eventRelay.stopSequence(),this.drawReactions&&(this.drawReactions.enabled=!1),this.drawingUIOverride&&this.drawingUIOverride.overridden&&this.drawingUIOverride.reset()},t.prototype.saveDrawing=function(){return i(this,void 0,Promise,function(){var e;return a(this,function(t){switch(t.label){case 0:if(!this.isDrawingBlock)throw new Error(this.node.name+" is not a drawing block.");return e=d.default.drawingUI,[4,Promise.all([e.saveDrawing(),p.asyncSchedule(this,1)])];case 1:return t.sent(),this.isComplete||this.completeAndAdanvce(),[2]}})})},t.prototype.onDestroy=function(){this.removeAutoCompleteHandler()},t.prototype.addAutoCompleteHandler=function(){this._eventRelay&&cc.isValid(this._eventRelay.node)&&this._eventRelay.node.on(l.default.EventTypes.FINISH_SEQUENCE,this.autoCompleteHandler)},t.prototype.removeAutoCompleteHandler=function(){this._eventRelay&&cc.isValid(this._eventRelay.node)&&this._eventRelay.node.off(l.default.EventTypes.FINISH_SEQUENCE,this.autoCompleteHandler)},t.prototype.executeEventRelaySequence=function(e){this._eventRelay=e,this._eventRelay.loop=this.loop,this.resetActors(),this.sequence&&this._eventRelay.playSequence(this.sequence),!this.loop&&this.autoComplete&&this.addAutoCompleteHandler()},t.prototype.resetActors=function(){var e,t;if(this.applySkeletonResetFlag)try{for(var n=s(l.default.enabledActors),r=n.next();!r.done;r=n.next()){var o=r.value;o.skeleton&&(o.skeletonResetHackFlag=!0)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.executeComponentEvents=function(){var e,t,n=[];try{for(var r=s(this.onExecuteEvents),o=r.next();!o.done;o=r.next()){var i=o.value,a=p.executeEventHandler(i,null);a instanceof Promise&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}if(n.length>0)return Promise.all(n).then(function(){})},t.prototype.prepareDrawing=function(){var e=d.default.drawingUI,t=d.default.isLowEndDevice;e.setRandomTool(!1),this.drawReactions&&(this.drawReactions.enabled=!t&&this.isDrawingBlock),this.drawingUIOverride&&!this.drawingUIOverride.overridden&&this.drawingUIOverride.override(),this.isDrawingBlock?(e.createNewDrawing(),e.show(),e.enabled=!0):(e.hide(),e.enabled=!1)},t.prototype.preparePhysics=function(){var e=cc.director.getPhysicsManager(),t=cc.director.getCollisionManager();e.enabled=this.usePhysics&&!d.default.isLowEndDevice,t.enabled=this.useCollisions},t.prototype.prepareBlockReplay=function(){var e=this.getComponent(y.default);e&&e.override()},o([g({type:cc.AnimationClip,tooltip:"Event Sequence for this block."})],t.prototype,"sequence",void 0),o([g({tooltip:"Event Sequence should be looped."})],t.prototype,"loop",void 0),o([g({tooltip:"Complete as soon as the Block's sequence is done",visible:function(){return!this.loop}})],t.prototype,"autoComplete",void 0),o([g()],t.prototype,"usePhysics",void 0),o([g()],t.prototype,"useCollisions",void 0),o([g()],t.prototype,"applySkeletonResetFlag",void 0),o([g({type:cc.Component.EventHandler})],t.prototype,"onExecuteEvents",void 0),t=o([_,m("Scribbles And Ink/Framework/Story Block")],t)}(cc.Component);n.default=b,cc._RF.pop()},{"../Drawing/DrawingUIOverride":"DrawingUIOverride","../Util":"index","./EventRelay":"EventRelay","./EventSequencer":"EventSequencer","./GameManager":"GameManager","./StoryBlockReplayOverride":"StoryBlockReplayOverride","./StoryManager":"StoryManager"}],StoryManager:[function(e,t,n){"use strict";cc._RF.push(t,"ce913li45lOSJYIsaYyvtSH","StoryManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},c=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var d=u(e("./SceneManager")),p=u(e("./EventRelay")),f=u(e("./GameManager")),h=u(e("./StoryBlock")),y=u(e("./EventRelayAudioLoader")),v=u(e("../UI/Button")),_=u(e("../UI/StoryBlockReplay")),g=u(e("./EventActor")),m=e("../Util"),b=u(e("../Generic/Hider")),w=u(e("../UI/ScreenWidget")),S=u(e("./ContentLoader")),O=u(e("../Scene/Studio/StudioManager")),P=e("../Drawing/DrawingStorage"),C=cc._decorator,x=C.ccclass,R=C.menu,k=C.property,D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._nextScene="",t._eventRelayAudioLoader=null,t._storyBlocks=null,t._currentStoryBlockIndex=0,t._studioButton=null,t._storyBlockReplay=null,t._firstStoryBlockSetAtRuntime=void 0,t._preloadScene=null,t._preloadSceneName="",t._enableStudioCameraTransition=!1,t}return r(t,e),Object.defineProperty(t.prototype,"eventRelay",{get:function(){if(this._eventRelay||(this._eventRelay=this.getComponent(p.default)),!this._eventRelay)throw new Error("StoryManager should have an EventRelay");return this._eventRelay},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventRelayAudioLoader",{get:function(){if(this._eventRelayAudioLoader||(this._eventRelayAudioLoader=this.getComponent(y.default)),!this._eventRelayAudioLoader)throw new Error("StoryManager should have an EventRelayAudioLoader");return this._eventRelayAudioLoader},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyBlocks",{get:function(){return this._storyBlocks||(this._storyBlocks=this.getComponentsInChildren(h.default)),this._storyBlocks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentStoryBlock",{get:function(){return this.storyBlocks[this._currentStoryBlockIndex]||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"studioButton",{get:function(){if(!this._studioButton||!cc.isValid(this._studioButton))throw new Error("The Studio Button is not accessible from the Story ManagerIt should be instanced by the Story Manager onSceneStart, and placed under the ui camera.");return this._studioButton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyBlockReplay",{get:function(){return this.ensureStoryBlockReplay()},enumerable:!0,configurable:!0}),t.prototype.goToStudio=function(){var e=this,t=f.default.audio,n=f.default.isLowEndDevice;return t.stopAll(),this.goToScene("Studio",n,function(n){if(t.stopAll(),e._enableStudioCameraTransition){var r=n.getComponentInChildren(O.default);r&&(r.transitionFromUnderneathAtStart=!0)}})},t.prototype.goToScene=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=null),i(this,void 0,Promise,function(){var r,o;return a(this,function(i){switch(i.label){case 0:return(r=f.default.drawingUI).enabled=!1,[4,r.hide()];case 1:return i.sent(),r.currentDrawing&&cc.isValid(r.currentDrawing.node,!0)&&m.getComponentInParents(r.currentDrawing.node,cc.Camera)===f.default.uiCamera&&(r.currentDrawing&&r.currentDrawing.node.destroy(),r.currentDrawing=null),t&&(f.default.loadingScreen.enabled=!0),[4,this._preloadScene&&this._preloadSceneName===e?this._preloadScene:f.default.preloadScene(e)];case 2:return o=i.sent(),n?[4,n(o)]:[3,4];case 3:i.sent(),i.label=4;case 4:return[4,f.default.loadScene(e)];case 5:return i.sent(),f.default.loadingScreen.enabled=!1,[2]}})})},t.prototype.setFirstBlockIndex=function(e){this._firstStoryBlockSetAtRuntime=e},t.prototype.startBlockAtIndex=function(e){this._currentStoryBlockIndex=e-1,this.startNextBlock()},t.prototype.advanceToNextBlock=function(){this.startNextBlock()},t.prototype.setCurrentDrawTool=function(e,t){f.default.drawingUI.setCurrentTool(e,t)},t.prototype.clearDrawingStorageKey=function(e,t){var n="string"==typeof e?e:t;if(!n)throw new Error("storageKey required");f.default.drawingStorage.deleteStoredDrawing({storageKey:n,variationStrategy:P.DeleteVariation.Every,serialize:!0})},t.prototype.onSceneStart=function(){var e=this;this.ensureStudioButton(),this.isAutoLoadContentLoaded()?this.startFirstBlock():this.untilAutoLoadContentLoaded().then(function(){return e.startFirstBlock()})},t.prototype.onScenePreLoad=function(e){return i(this,void 0,Promise,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.tryPreloadFirstBlockAudio(e)];case 1:return t.sent(),[2]}})})},t.prototype.update=function(){this.tryPreloadNextScene(),this.tryPreloadNextBlockAudio()},t.prototype.startFirstBlock=function(){this._currentStoryBlockIndex=void 0!==this._firstStoryBlockSetAtRuntime?this._firstStoryBlockSetAtRuntime:0,this._currentStoryBlockIndex--,this.startNextBlock()},t.prototype.getIndexOfNextBlock=function(){for(var e=this._currentStoryBlockIndex+1;e<this.storyBlocks.length;e++){var t=this.storyBlocks[e];if(t.enabled&&t.enabledInHierarchy)return e}return-1},t.prototype.startNextBlock=function(){var e=this._currentStoryBlockIndex=this.getIndexOfNextBlock(),t=this.storyBlocks[e];t?t.execute(this.eventRelay):this._nextScene?this.goToScene(this._nextScene):(this._enableStudioCameraTransition=!f.default.isLowEndDevice,this.goToStudio())},t.prototype.tryPreloadNextScene=function(){if(f.default.initialized&&!f.default.isLowEndDevice&&!this._preloadScene)return this._preloadSceneName=this._nextScene||"Studio",this._preloadScene=f.default.preloadScene(this._preloadSceneName),this._preloadScene},t.prototype.tryPreloadNextBlockAudio=function(){var e=this.currentStoryBlock;if(e&&e.sequence&&e.eventRelay){var t=e.sequence.duration-e.eventRelay.sequenceTime,n=this.eventRelayAudioLoader.preloadDuration-t;if(!(n<0)){var r=this.getIndexOfNextBlock(),o=this.storyBlocks[r];o&&o.sequence&&this.eventRelayAudioLoader.loadSequenceAudio(o.sequence,c(p.default.actors),0,n)}}},t.prototype.tryPreloadFirstBlockAudio=function(e){return i(this,void 0,Promise,function(){var t,n,r,o,i,s;return a(this,function(a){switch(a.label){case 0:return(t=this.eventRelay.getComponent(y.default))&&(n=this.storyBlocks[0])?(r=n.sequence,o=e.getComponentsInChildren(S.default),[4,Promise.all(o.map(function(e){return e.loadContent()}))]):[2];case 1:return i=a.sent(),s=i.reduce(function(e,t){var n,r;try{for(var o=l(Object.values(t)),i=o.next();!i.done;i=o.next()){var a=i.value;if(a instanceof cc.Prefab){var s=a.data&&a.data.getComponent(g.default);s&&s.skeleton&&e.push(s)}}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return e},[]),r?[4,t.loadSequenceAudio(r,s)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})},t.prototype.ensureStudioButton=function(){if(this._studioButton=f.default.uiCamera.getComponentsInChildren(v.default).find(function(e){return"StudioButton"===e.node.name})||null,!this._studioButton){var e=f.default.assets.getSingleAsset("Common/Prefabs/StudioButton"),t=cc.instantiate(e);t.setParent(f.default.uiCamera.node);var n=t.getComponent(cc.Widget);n&&n.updateAlignment(),this._studioButton=t.getComponentInChildren(v.default),t.x=-1e3}var r=new cc.Component.EventHandler;r.target=this.node,r.component=m.nameOfComponent(this),r.handler="goToStudio",this.studioButton.clickEvents=[r]},t.prototype.restoreScribblesAndInkToSetupPose=function(){var e,t;try{for(var n=l(this.getScribblesAndInk()),r=n.next();!r.done;r=n.next()){var o=r.value;o.node.scaleX=Math.abs(o.node.scaleX),o.skeleton&&(o.skeleton.clearTracks(),o.skeleton.setToSetupPose())}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.ensureStoryBlockReplay=function(){return cc.isValid(this._storyBlockReplay)||(this._storyBlockReplay=f.default.uiCamera.getComponentInChildren(_.default)),this._storyBlockReplay||(this._storyBlockReplay=this.createStoryBlockReplay()),this._storyBlockReplay},t.prototype.createStoryBlockReplay=function(){var e,t,n=f.default.assets.getSingleAsset("Common/Prefabs/StoryBlockReplayUI"),r=cc.instantiate(n);r.setParent(f.default.uiCamera.node);var o=r.getComponent(_.default);if(!o)throw new Error("StoryBlockReplay could not be instanced");var i=o.getComponentsInChildren(w.default);try{for(var a=l(i),s=a.next();!s.done;s=a.next()){s.value.apply()}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}var c=o.getComponentInChildren(b.default);return c&&c.setEnabledImmediate(!0),o},o([k({tooltip:"Scene to load once the Story Blocks are complete.",visible:!0})],t.prototype,"_nextScene",void 0),o([k({visible:!0,step:1,min:0,displayName:"Starting Block Index",tooltip:"During the build, the first block will always be 0."})],t.prototype,"_currentStoryBlockIndex",void 0),t=o([x,R("Scribbles And Ink/Framework/Story Manager")],t)}(d.default);n.default=D,cc._RF.pop()},{"../Drawing/DrawingStorage":"DrawingStorage","../Generic/Hider":"Hider","../Scene/Studio/StudioManager":"StudioManager","../UI/Button":"Button","../UI/ScreenWidget":"ScreenWidget","../UI/StoryBlockReplay":"StoryBlockReplay","../Util":"index","./ContentLoader":"ContentLoader","./EventActor":"EventActor","./EventRelay":"EventRelay","./EventRelayAudioLoader":"EventRelayAudioLoader","./GameManager":"GameManager","./SceneManager":"SceneManager","./StoryBlock":"StoryBlock"}],StudioManager:[function(e,t,n){"use strict";cc._RF.push(t,"cc467t5oN9BUoFd2c7RMET/","StudioManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var u=l(e("../../Framework/SceneManager")),d=l(e("../../Framework/GameManager")),p=l(e("../../Util/asyncSchedule")),f=l(e("../../Framework/EventRelay")),h=l(e("../../Framework/EventSequencer")),y=l(e("./RoomManager")),v=e("../../Util"),_=e("../../constants"),g=l(e("../../Character/UseRootMotion")),m=cc._decorator,b=m.ccclass,w=m.property,S=10*_.ONE_FRAME,O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._inkRootMotionAnimation="I_Mo_Run",t._scribblesRootMotionAnimation="S_Mo_Run",t._transitionAnimationTrack=3,t._welcomeSequencer=null,t._navigationHintSequencer=null,t._storyStartLoadingSequence=null,t._storyFinishLoadingSequence=null,t._dialogRelay=null,t._cameraTransitionToStoryNode=null,t.transitionFromUnderneathAtStart=!1,t}return r(t,e),Object.defineProperty(t.prototype,"welcomeSequencer",{get:function(){if(!this._welcomeSequencer)throw new Error("Welcome Sequencer needs to be set in the inspector.");return this._welcomeSequencer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigationHintSequencer",{get:function(){if(!this._navigationHintSequencer)throw new Error("Navigation Sequencer needs to be set in the inspector.");return this._navigationHintSequencer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyStartLoadingSequence",{get:function(){if(!this._storyStartLoadingSequence)throw new Error("Transition story sequence needs to be set in the inspector.");return this._storyStartLoadingSequence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyFinishLoadingSequence",{get:function(){if(!this._storyFinishLoadingSequence)throw new Error("Transition story sequence needs to be set in the inspector.");return this._storyFinishLoadingSequence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dialogRelay",{get:function(){if(!this._dialogRelay)throw new Error("Dialog Relay needs to be set in the inspector.");return this._dialogRelay},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraTransitionToStoryNode",{get:function(){if(!this._cameraTransitionToStoryNode)throw new Error("Camera Transition To Story Node sequence needs to be set in the inspector.");return this._cameraTransitionToStoryNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRelay",{get:function(){if(!this.eventRelay)throw new Error("Studio Manager requires an attached Event Relay with an Idle Sequence");return this.eventRelay},enumerable:!0,configurable:!0}),t.prototype.onSceneStart=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.loadContent()];case 1:return e.sent(),this.unloadDanglingStoryContent(),this.transitionFromUnderneathAtStart&&this.moveCameraFromStoryTransitionTarget(),this.playIdle(),[4,this.playWelcomeIfFirstSessionEntrance()];case 2:return e.sent(),[4,p.default(this,3)];case 3:return e.sent(),[4,this.playFreeDrawIdleReactionIfFirstSessionEntrance()];case 4:return e.sent(),this.enableNavigationHint(),[2]}})})},t.prototype.onStrokeStart=function(){d.default.isLowEndDevice&&!this.idleRelay.sequenceIsPaused&&this.idleRelay.pauseSequence()},t.prototype.onStrokeEnd=function(){d.default.isLowEndDevice&&this.idleRelay.sequenceIsPaused&&this.idleRelay.resumeSequence()},t.prototype.update=function(){this.isContentLoaded()&&this.idleRelay.enabled&&(this.dialogRelay.sequenceIsPlaying&&!this.idleRelay.sequenceIsPaused?this.idleRelay.pauseSequence():!this.dialogRelay.sequenceIsPlaying&&this.idleRelay.sequenceIsPaused&&this.idleRelay.resumeSequence())},t.prototype.startStory=function(e){return a(this,void 0,Promise,function(){var t,n;return s(this,function(r){switch(r.label){case 0:return this.disallowDrawUI(),(t=v.getComponentInScene(y.default))&&t.currentRoom&&t.currentRoom.setButtonsEnabled(!1),this.idleRelay.stopSequence(),this.idleRelay.enabled=!1,this.destroyAllEventSequencers(),[4,d.default.analytics.send(o({},_.ANALYTICS.EnterStory,{label:e}))];case 1:if(r.sent(),d.default.isLowEndDevice)return[3,6];this.moveCameraToStoryTransitionTarget(),r.label=2;case 2:return this.dialogRelay.sequenceIsPlaying?(this.dialogRelay.stopSequence(),this.dialogRelay.enabled=!1,[4,p.default(this,.1)]):[3,4];case 3:return r.sent(),[3,2];case 4:return d.default.audio.stopAll(),[4,this.dialogRelay.playSequence(this.storyStartLoadingSequence)];case 5:return r.sent(),[3,7];case 6:d.default.drawingStorage.clearCachedDrawings(),d.default.loadingScreen.enabled=!0,d.default.audio.stopAll(),r.label=7;case 7:return n=e+"_1",[4,d.default.preloadScene(n)];case 8:return r.sent(),d.default.isLowEndDevice?[3,10]:[4,this.dialogRelay.playSequence(this.storyFinishLoadingSequence)];case 9:r.sent(),r.label=10;case 10:return[4,d.default.loadScene(n)];case 11:return r.sent(),d.default.isLowEndDevice&&(d.default.loadingScreen.enabled=!1),[2]}})})},t.prototype.jumpScribblesAndInkOffScreen=function(){return a(this,void 0,Promise,function(){var e,t,n,r,o,i,a,l;return s(this,function(s){switch(s.label){case 0:n=cc.Camera.main;try{for(r=c(this.getScribblesAndInk()),o=r.next();!o.done;o=r.next())i=o.value,a=v.getLocalPosition(n.node,i.node),i.node.setParent(n.node),i.node.setPosition(a.add(i.node.position))}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return l=.75,n.node.runAction(cc.moveBy(l,cc.v2(0,-cc.view.getFrameSize().height)).easing(cc.easeQuarticActionIn())),[4,p.default(this,l)];case 1:return s.sent(),[2]}})})},t.prototype.moveScribblesAndInkToRelativeStartPositions=function(){return a(this,void 0,Promise,function(){var e,t,n,r,o,i,a,c,l,u;return s(this,function(s){switch(s.label){case 0:for(this.idleRelay.stopSequence(),this.dialogRelay.stopSequence(),e=this.getScribblesAndInk(),t=[this._scribblesRootMotionAnimation,this._inkRootMotionAnimation],n=0;n<t.length;n++){for(r=e[n],o=t[n],i=r.node.name,a=0;a<10;a++)a!==this._transitionAnimationTrack&&r.resetSpineTrack(a,0);if(!(c=this.canvas.node.getChildByName(i+" Start")))throw new Error(i+" start node is mssing.");(l=r.node.parent.getChildByName(i+" Target"))||(l=new cc.Node(i+" Target")).setParent(r.node.parent),l.setPosition(c.position),(u=r.getComponent(g.default)||r.addComponent(g.default)).track=this._transitionAnimationTrack,u.motionAnimation=o,u.target=l}s.label=1;case 1:return this.scribblesAndInkAreMoving()?[4,p.default(this,S)]:[3,3];case 2:return s.sent(),[3,1];case 3:return this.idleRelay.playSequence(),[2]}})})},t.prototype.scribblesAndInkAreMoving=function(){var e,t;try{for(var n=c(this.getScribblesAndInk()),r=n.next();!r.done;r=n.next()){if(r.value.getComponent(g.default))return!0}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return!1},t.prototype.playIdle=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.idleRelay.playSequence()];case 1:return e.sent(),[2]}})})},t.prototype.playWelcomeIfFirstSessionEntrance=function(){return a(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.welcomeSequencer.sendSequence()];case 1:return e.sent(),[2]}})})},t.prototype.playFreeDrawIdleReactionIfFirstSessionEntrance=function(){return a(this,void 0,Promise,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return(e=v.getComponentInScene(y.default))&&e.currentRoom?"FreeDrawRoom"!==e.currentRoom.node.name?[2]:((t=e.currentRoom.getComponentInChildren(h.default))&&(t.enabled=!0),t&&t.wouldSendSequence()?(t.eventRelay=this.dialogRelay,[4,t.sendSequence()]):[3,2]):[2];case 1:n.sent(),t.enabled=!1,n.label=2;case 2:return[2]}})})},t.prototype.enableNavigationHint=function(){try{cc.log("enabling navigation hint"),this.navigationHintSequencer.enabled=!0}catch(e){}},t.prototype.moveCameraToStoryTransitionTarget=function(){var e=this.getUnderneathMainCameraPosition();this.cameraTransitionToStoryNode.setPosition(e)},t.prototype.moveCameraFromStoryTransitionTarget=function(){var e=cc.Camera.main,t=this.getUnderneathMainCameraPosition(),n=e.node.position;e.node.setPosition(t),this.cameraTransitionToStoryNode.setPosition(n),v.transformToTarget(e.node,this.cameraTransitionToStoryNode,.2,"QuadraticActionInOut")},t.prototype.getUnderneathMainCameraPosition=function(){return cc.Camera.main.node.position.add(cc.v2(0,2*-this.cameraTransitionToStoryNode.height))},t.prototype.destroyAllEventSequencers=function(){var e,t;try{for(var n=c(v.getComponentsInScene(h.default)),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.unloadDanglingStoryContent=function(){var e,t,n=d.default.assets;try{for(var r=c(n.dynamicAssetPaths),o=r.next();!o.done;o=r.next()){var i=o.value;i.includes("Story")&&!i.includes("Room")&&n.disposeDynamicAssets(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},i([w({visible:!0,displayName:"Ink Run Animation"})],t.prototype,"_inkRootMotionAnimation",void 0),i([w({visible:!0,displayName:"Scribbles Run Animation"})],t.prototype,"_scribblesRootMotionAnimation",void 0),i([w({visible:!0,displayName:"Animation Track",tooltip:"The Animation Track that will be used when Scribbles and Ink are instructed to move somewhere."})],t.prototype,"_transitionAnimationTrack",void 0),i([w({visible:!0,type:h.default,tooltip:"The EventSequencer that holds the Welcome Sequences"})],t.prototype,"_welcomeSequencer",void 0),i([w({visible:!0,type:h.default,tooltip:"The EventSequencer that holds the Navigation Hint Sequences"})],t.prototype,"_navigationHintSequencer",void 0),i([w({visible:!0,type:cc.AnimationClip,tooltip:"Sequence that transitions into the story loading screen"})],t.prototype,"_storyStartLoadingSequence",void 0),i([w({visible:!0,type:cc.AnimationClip,tooltip:"Sequence that transitions into the story loading screen"})],t.prototype,"_storyFinishLoadingSequence",void 0),i([w({visible:!0,type:f.default})],t.prototype,"_dialogRelay",void 0),i([w({visible:!0,type:cc.Node,tooltip:"Node that represents where the camera should transition to when clicking on a story."})],t.prototype,"_cameraTransitionToStoryNode",void 0),t=i([b],t)}(u.default);n.default=O,cc._RF.pop()},{"../../Character/UseRootMotion":"UseRootMotion","../../Framework/EventRelay":"EventRelay","../../Framework/EventSequencer":"EventSequencer","../../Framework/GameManager":"GameManager","../../Framework/SceneManager":"SceneManager","../../Util":"index","../../Util/asyncSchedule":"asyncSchedule","../../constants":"constants","./RoomManager":"RoomManager"}],Table:[function(e,t,n){"use strict";cc._RF.push(t,"dcc73HpuO1J2783zM92O0AA","Table");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("../../Framework/EventActor")),c=e("../../Util"),l=a(e("./MessEraser")),u=cc._decorator,d=u.ccclass,p=u.property,f=u.requireComponent,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tidy=[],t.messy=[],t.cleared=[],t}return r(t,e),t.prototype.start=function(){this.clearTable()},t.prototype.drawOnTableCloth=function(){cc.warn("drawOnTableCloth not yet implemented")},t.prototype.clearTable=function(){this.showNodes(this.cleared)},t.prototype.tidyTable=function(){this.showNodes(this.tidy)},t.prototype.messyTable=function(){this.showNodes(this.messy)},t.prototype.showNodes=function(e){var t,n,r=c.getComponentInScene(l.default);r&&r.uneraseNodes();try{for(var o=i(this.node.children),a=o.next();!a.done;a=o.next()){var s=a.value;s.active=e.includes(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},o([p({type:cc.Node,tooltip:"Nodes to show when the table is set."})],t.prototype,"tidy",void 0),o([p({type:cc.Node,tooltip:"Nodes to show when the table is messy."})],t.prototype,"messy",void 0),o([p({type:cc.Node,tooltip:"Nodes to show when the table is cleared."})],t.prototype,"cleared",void 0),t=o([d,f(s.default)],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../../Framework/EventActor":"EventActor","../../Util":"index","./MessEraser":"MessEraser"}],Temporary:[function(e,t,n){"use strict";cc._RF.push(t,"30e2brwoxlOAYPf9o37Qf+A","Temporary");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../Util"),a=cc._decorator,s=a.ccclass,c=a.disallowMultiple,l=a.property,u=a.menu,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.secondsMin=0,t.secondsMax=10,t.shrinkTime=.25,t.scaleUpOnStart=!1,t.delay=NaN,t._spriteWasEnabledWhileScalingOnStart=!1,t}return r(t,e),t.prototype.reset=function(e,t){void 0===e&&(e=this.secondsMin),void 0===t&&(t=this.secondsMax),this.secondsMin=e,this.secondsMax=t,this.delay=i.Random.float(this.secondsMin,this.secondsMax)},t.prototype.onLoad=function(){if(this.reset(),this.scaleUpOnStart){var e=this.getComponent(cc.Sprite);e&&(this._spriteWasEnabledWhileScalingOnStart=e.enabled,e.enabled=!1)}},t.prototype.start=function(){if(this.scaleUpOnStart){var e=this.node,t=e.scaleX,n=e.scaleY;this.node.scale=0,this.node.runAction(cc.scaleTo(this.shrinkTime,t,n))}if(this.scaleUpOnStart&&this._spriteWasEnabledWhileScalingOnStart){var r=this.getComponent(cc.Sprite);r&&(r.enabled=!0)}},t.prototype.update=function(e){this.delay-=e,this.delay>0||this.kill()},t.prototype.kill=function(){if(this.shrinkTime>0){var e=cc.sequence(cc.scaleTo(this.shrinkTime,0,0),cc.callFunc(this.node.destroy,this.node));this.node.runAction(e)}else this.node.destroy();this.enabled=!1,this.destroy()},o([l({min:0})],t.prototype,"secondsMin",void 0),o([l({min:0})],t.prototype,"secondsMax",void 0),o([l({min:0,max:1})],t.prototype,"shrinkTime",void 0),o([l()],t.prototype,"scaleUpOnStart",void 0),t=o([s,c,u("Scribbles And Ink/Generic/Temporary")],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../Util":"index"}],TimedDynamicSplat:[function(e,t,n){"use strict";cc._RF.push(t,"10058A7cHRHV6q1g1+xXYgQ","TimedDynamicSplat");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("./DynamicSplat")),s=i(e("../Generic/Temporary")),c=cc._decorator,l=c.ccclass,u=c.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.secondsMin=1,t.secondsMax=1,t.splatPrefab=null,t}return r(t,e),t.prototype.onEmit=function(){var e=this.getComponentInChildren(s.default)||this.addComponent(s.default);e.secondsMin=this.secondsMin,e.secondsMax=this.secondsMax,e.shrinkTime=0},t.prototype.onDestroy=function(){this.splatPrefab&&this.addSplat(this.splatPrefab)},o([u({min:0,formerlySerializedAs:"minSeconds"})],t.prototype,"secondsMin",void 0),o([u({min:0,formerlySerializedAs:"maxSeconds"})],t.prototype,"secondsMax",void 0),o([u({type:cc.Prefab,tooltip:"Splat that will be added to Drawing when time is up."})],t.prototype,"splatPrefab",void 0),t=o([l],t)}(a.default);n.default=d,cc._RF.pop()},{"../Generic/Temporary":"Temporary","./DynamicSplat":"DynamicSplat"}],Transfomer:[function(e,t,n){"use strict";cc._RF.push(t,"0689anZdJRDGammYm0AkHOs","Transfomer");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i,a=e("../Util"),s=cc._decorator,c=s.ccclass,l=s.menu,u=s.property;(function(e){e[e.Values=0]="Values",e[e.Node=1]="Node"})(i||(i={}));function d(){return this.transformStrategy===i.Node}function p(e){return function(){return this[e]&&this.transformStrategy===i.Values}}function f(e,t,n){return void 0===n&&(n=Number.EPSILON),"number"==typeof e?"number"==typeof t&&Math.abs(e-t)<n:e instanceof cc.Color?t instanceof cc.Color&&(f(e.getR(),t.getR(),n)&&f(e.getB(),t.getB(),n)&&f(e.getG(),t.getG(),n)):(t instanceof cc.Vec2||t instanceof cc.Vec3)&&(f(e.x,t.x,n)&&f(e.y,t.y,n))}var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.applyPosition=!1,t.applyScale=!0,t.applyAngle=!1,t.applyOpacity=!1,t.applyColor=!1,t.transformStrategy=i.Values,t.target=null,t.position=cc.Vec2.ZERO,t.scale=1,t.angle=0,t.opacity=255,t.color=cc.Color.WHITE,t.speed=20,t}return r(t,e),t.prototype.apply=function(e){void 0===e&&(e=1);var t=this.transformStrategy===i.Node?this.target:this;if(t){var n=this.node;if(this.applyPosition&&(n.position=n.position.lerp(t.position,e)),this.applyAngle&&(n.angle=a.lerpAngle(n.angle,t.angle,e)),this.applyScale&&(n.scale=cc.misc.lerp(n.scale,t.scale,e)),this.applyOpacity&&(n.opacity=cc.misc.lerp(n.opacity,t.opacity,e)),this.applyColor){var r=n.color,o=t.color;n.color=cc.color(cc.misc.lerp(r.getR(),o.getR(),e),cc.misc.lerp(r.getG(),o.getG(),e),cc.misc.lerp(r.getB(),o.getB(),e))}}},Object.defineProperty(t.prototype,"isApplied",{get:function(){var e=this.transformStrategy===i.Node?this.target:this;return!e||!(this.applyPosition&&!f(this.node.position,e.position,1))&&(!(this.applyAngle&&!f(this.node.angle,e.angle,1))&&(!(this.applyScale&&!f(this.node.scale,e.scale,.01))&&(!(this.applyOpacity&&!f(this.node.opacity,e.opacity,1))&&!(this.applyColor&&!f(this.node.color,e.color,1)))))},enumerable:!0,configurable:!0}),t.prototype.update=function(e){var t=cc.misc.clamp01(e*this.speed);this.apply(t)},t.Strategy=i,o([u()],t.prototype,"applyPosition",void 0),o([u()],t.prototype,"applyScale",void 0),o([u()],t.prototype,"applyAngle",void 0),o([u()],t.prototype,"applyOpacity",void 0),o([u()],t.prototype,"applyColor",void 0),o([u({type:cc.Enum(i)})],t.prototype,"transformStrategy",void 0),o([u({type:cc.Node,visible:d})],t.prototype,"target",void 0),o([u({visible:p("applyPosition")})],t.prototype,"position",void 0),o([u({visible:p("applyScale")})],t.prototype,"scale",void 0),o([u({visible:p("applyAngle")})],t.prototype,"angle",void 0),o([u({visible:p("applyOpacity"),min:0,max:255,step:1,slide:!0})],t.prototype,"opacity",void 0),o([u({visible:p("applyColor")})],t.prototype,"color",void 0),o([u({min:1,max:40,slide:!0})],t.prototype,"speed",void 0),t=o([c,l("Scribbles And Ink/Generic/Transformer")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../Util":"index"}],UseMotion:[function(e,t,n){"use strict";cc._RF.push(t,"aa00fE3Gb5DroIL2j9HcjuK","UseMotion");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../Framework/EventActor")),s=cc._decorator,c=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._target=null,t.motionAnimation="",t.track=0,t.mix=0,t._actor=null,t}return r(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actor",{get:function(){if(cc.isValid(this._actor)||(this._actor=this.getComponent(a.default)),!this._actor)throw new Error("UseRootMotion component requires an actor.");return this._actor},enumerable:!0,configurable:!0}),o([l({type:cc.Node,visible:!0,tooltip:"Once an Actor has reached this target, this component will be destroyed."})],t.prototype,"_target",void 0),o([l({tooltip:"Spine Animation Actor will use to move horizontally around the scene, such as a walk or a run. It should have root motion on the skeleton the the Actor can use to update it's x coordinate.",visible:!0})],t.prototype,"motionAnimation",void 0),o([l({tooltip:"Spine animation track to use for the animation.",min:0,step:1})],t.prototype,"track",void 0),o([l({tooltip:"Spine animation mix to use for the animation.",min:0})],t.prototype,"mix",void 0),t=o([c],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../Framework/EventActor":"EventActor"}],UseProceduralMotion:[function(e,t,n){"use strict";cc._RF.push(t,"99976z9SrVDlY9VEFJjLMT9","UseProceduralMotion");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("../Framework/EventActor")),c=a(e("./UseMotion")),l=e("../Util"),u=cc._decorator,d=u.ccclass,p=u.requireComponent,f=u.menu,h="Procedural_Motion_Start",y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duration=0,t.waitForMotionStart=function(e,n){n.data.name===h&&t.applyProceduralMotion()},t}return r(t,e),t.prototype.start=function(){if(!this.target||!this.actor.skeleton)throw new Error("UseProceduralMotion requirs a target and an actor skeleton");this.analyzeProceduralMotion(),this.actor.skeleton.clearTrack(this.track),this.actor.playSpineClip(this.motionAnimation,this.track,this.mix,!1)},t.prototype.onDestroy=function(){cc.isValid(this.actor.skeleton)&&this.actor.offSkeletonEvent(this.waitForMotionStart),cc.isValid(this.target)&&this.node.setPosition(l.getLocalPosition(this.target,this.node))},t.prototype.analyzeProceduralMotion=function(){var e,t,n=this.actor.skeleton.skeletonData;if(!n)throw this.destroy(),new Error("UseProceduralMotion component placed on "+this.node.name+" withan actor that did have any skeletonData.");var r=n.skeletonJson.animations[this.motionAnimation];if(!r)throw this.destroy(),new Error("UseProceduralMotion component placed on "+this.node.name+" withan actor this missing a skeletal animation named: "+this.motionAnimation+".");var o=r.events,a=void 0===o?[]:o,s=0,c=a[a.length-1]?a[a.length-1].time:0;try{for(var l=i(a),u=l.next();!u.done;u=l.next()){var d=u.value;d.name===h?s=d.time:"Procedural_Motion_End"===d.name&&(c=d.time)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}c<s&&(c=s),this._duration=c-s,0===s?this.applyProceduralMotion():this.actor.onSkeletonEvent(this.waitForMotionStart)},t.prototype.applyProceduralMotion=function(){var e=this.target,t=l.getLocalPosition(e,this.node);this.node.runAction(cc.sequence(cc.moveTo(this._duration,t).easing(cc.easeQuadraticActionOut()),cc.callFunc(this.destroy,this)))},t=o([d,p(s.default),f("Scribbles And Ink/Character/Use Procedural Motion")],t)}(c.default);n.default=y,cc._RF.pop()},{"../Framework/EventActor":"EventActor","../Util":"index","./UseMotion":"UseMotion"}],UseRootMotion:[function(e,t,n){"use strict";cc._RF.push(t,"c53b6+NTENMf4H/MvgqfV9b","UseRootMotion");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("./UseMotion")),c=a(e("../Character/ApplySkeletonRootMotion")),l=cc._decorator,u=l.ccclass,d=l.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fromPos=cc.Vec2.ZERO,t._toPos=cc.Vec2.ZERO,t._cancelled=!1,t._delta=null,t.interrupt=function(e){t&&cc.isValid(t)&&e.trackIndex===t.track&&t.destroy()},t}return r(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e,this.reset()},enumerable:!0,configurable:!0}),t.prototype.cancel=function(){this._cancelled=!0,this.destroy()},t.prototype.start=function(){if(!this.target||!this.actor.skeleton)throw this.destroy(),new Error("UseRootMotion requires a target and an actor skeleton");this.reset(),this.beginMovement(),this.actor.skeleton.setInterruptListener(this.interrupt)},t.prototype.update=function(e){if(cc.isValid(this.target)){!this.getTargetLocalPosition().equals(this._toPos)&&this.reset(),this.applyYMovement(e);var t=this.reachedTarget("x");t&&(this.node.x=this._toPos.x);var n=this.reachedTarget("y");n&&(this.node.y=this._toPos.y),t&&n&&this.finishMovement()}else this.cancel()},t.prototype.onDestroy=function(){this.actor.skeleton&&this.actor.resetSpineTrack(this.track,this.mix),!this._cancelled&&cc.isValid(this.target)&&this.node.setPosition(this._toPos)},t.prototype.reset=function(){this._fromPos=this.node.position.clone(),this._toPos=this.getTargetLocalPosition();var e=this._toPos.sub(this._fromPos);this._delta=this.getAnimationDelta();var t=this._delta.position>0,n=e.x>0,r=Math.abs(this.node.scaleX);this.node.scaleX=n===t?r:-r},t.prototype.beginMovement=function(){if(!this.actor||!this.actor.skeleton)throw new Error("UseRootMotion requires an Actor with a Skeleton");this.actor.playSpineClip(this.motionAnimation,this.track,this.mix,!0)},t.prototype.finishMovement=function(){if(!this.actor||!this.actor.skeleton)throw new Error("UseRootMotion requires an Actor with a Skeleton");this.destroy()},t.prototype.getTargetLocalPosition=function(){if(!cc.isValid(this.target))return this.node.position;var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO);return this.node.parent.convertToNodeSpaceAR(e)},t.prototype.getAnimation=function(){if(!this.actor.skeleton)throw new Error("UseRootMotion requires an actor with a skeleton.");if(!this.actor.skeleton.getComponent(c.default))throw new Error("UseRootMotion requires an actor with a skeleton that also has an ApplyRootMotionComponent");if(!this.actor.skeleton.skeletonData)throw new Error("UseRootMotion attached actor skeleton does not have any skeleton data.");var e=this.actor.skeleton.skeletonData.skeletonJson.animations[this.motionAnimation];if(!e)throw new Error("No animation named "+this.motionAnimation+" could be found.");if(!(e&&e.bones&&e.bones.root&&e.bones.root.translate))throw new Error("Animation named "+this.motionAnimation+" does not have any root motion");var t=this.actor.skeleton.node.scale;return e.bones.root.translate.map(function(e){return o({},e,{x:e.x*t,y:e.y*t})})},t.prototype.reachedTarget=function(e){var t=this._fromPos[e]<this._toPos[e],n=this.node[e]-this._toPos[e];return t?n>=0:n<=0},t.prototype.applyYMovement=function(e){if(this._delta){var t=e/this._delta.time,n=Math.abs(this._delta.position*t)*(this._fromPos.y<this._toPos.y?1:-1);this.node.y+=n}},t.prototype.getAnimationDelta=function(){if(!(this.actor.skeleton&&this.actor.skeleton.node))throw new Error("Actor does not have skeleton.");var e=this.getAnimation(),t=e[0],n=e[e.length-1];return{position:n.x-t.x,time:n.time}},t=i([u,d("Scribbles And Ink/Character/Use Root Motion")],t)}(s.default);n.default=p,cc._RF.pop()},{"../Character/ApplySkeletonRootMotion":"ApplySkeletonRootMotion","./UseMotion":"UseMotion"}],Velocity:[function(e,t,n){"use strict";cc._RF.push(t,"70c078SA3BEI5/tTrZjVgpV","Velocity");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../Util"),a=cc._decorator,s=a.ccclass,c=a.property,l=a.menu,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.torque=1,t.velocity=cc.Vec2.ZERO,t}return r(t,e),t.prototype.update=function(e){var t=this.node,n=this.torque;t.angle-=360*n*this.torque*e,t.angle=i.lerpAngle(t.angle),t.setPosition(t.position.add(this.velocity.mul(e)))},o([c({displayName:"Rotations/Second",formerlySerializedAs:"rate"})],t.prototype,"torque",void 0),o([c({displayName:"Pixels/Second"})],t.prototype,"velocity",void 0),t=o([s,l("Scribbles And Ink/Generic/Velocity")],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../Util":"index"}],VisualizeDrawingData:[function(e,t,n){"use strict";cc._RF.push(t,"56d34/BkoVG6aeSygSRIteI","VisualizeDrawingData");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=(this&&this.__values,this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}),a=(this&&this.__spread,this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}});Object.defineProperty(n,"__esModule",{value:!0});var s=a(e("../../../Code/Framework/GameManager")),c=a(e("../../../Code/Framework/GameComponent")),l=e("../../../Code/Util"),u=a(e("../../../Code/Drawing/DrawingUI")),d=e("../../../Code/Drawing/DrawingStorage"),p=a(e("../../../Code/Framework/GameManager")),f=cc._decorator,h=f.ccclass,y=f.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textureVisualzer=null,t.sizeVisualizer=null,t.centerVisualizer=null,t.centerOfOpacityVisualizer=null,t}return r(t,e),t.prototype.onGameStart=function(){var e=this;cc.game.setLoadingScreenVisible(!1);var t=s.default.drawingStorage.copyStoredDrawing({storageKey:s.default.drawingUI.storageKey,variationStrategy:d.GetVariation.Latest,deserialize:!0}),n=l.getComponentInScene(u.default),r=function(t){t?n.currentDrawing=t:t=n.createNewDrawing(),t.node.setParent(cc.Camera.main.node.parent),t.node.setSiblingIndex(cc.Camera.main.node.getSiblingIndex()),t.node.setPosition(0,0),e.node.setParent(cc.Camera.main.node.parent),e.node.setPosition(t.node.position),e.node.scale=t.node.scale,e.scheduleOnce(function(){n.show(),n.enabled=!0},.5),e.scheduleOnce(function(){n.enabled=!0},1)};t instanceof Promise?t.then(r):r(t)},t.prototype.update=function(){if(p.default.initialized)p.default.drawingUI.currentDrawing},t.prototype.addVisualization=function(e){var t=cc.instantiate(this.textureVisualzer);t.setParent(this.node),t.setPosition(e.position),t.name=e.name,t.children[0].getComponent(cc.Label).string=e.name;var n=e.getContentSize();t.setContentSize(n.width,n.height)},o([y(cc.Node)],t.prototype,"textureVisualzer",void 0),o([y(cc.Node)],t.prototype,"sizeVisualizer",void 0),o([y(cc.Node)],t.prototype,"centerVisualizer",void 0),o([y(cc.Node)],t.prototype,"centerOfOpacityVisualizer",void 0),t=o([h],t)}(c.default);n.default=v,cc._RF.pop()},{"../../../Code/Drawing/DrawingStorage":"DrawingStorage","../../../Code/Drawing/DrawingUI":"DrawingUI","../../../Code/Framework/GameComponent":"GameComponent","../../../Code/Framework/GameManager":"GameManager","../../../Code/Util":"index"}],ZOrderManager:[function(e,t,n){"use strict";cc._RF.push(t,"1e6dd9BMhBCO79Kw3qCm+si","ZOrderManager");var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.disallowMultiple,c=i.executeInEditMode,l=i.menu,u=i.property;function d(e){var t=e.getChildByName(n.Z_INDEX_NODE_NAME);return t?e.convertToWorldSpaceAR(t.position).y:e.getBoundingBoxToWorld().y}n.Z_INDEX_NODE_NAME="Z-Index";var p=.125,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.interval=p,t.ignoreChangeThreshold=30,t._delay=0,t.byYPositionWithThreshold=function(e,n){var r=t.ignoreChangeThreshold,o=d(e),i=d(n);return Math.abs(o-i)<r?0:o>i?-1:o<i?1:0},t}return r(t,e),t.prototype.update=function(e){this._delay-=e,this._delay>0||(this._delay=this.interval,this.node.children.sort(this.byYPositionWithThreshold))},t.prototype.setEnabled=function(e){this.enabled=e},o([u({tooltip:"Minimum frequency ZOrder will be allowed to change, in seconds. 0 means no limit.",min:0})],t.prototype,"interval",void 0),o([u({tooltip:"Positional difference by which two children are considered to be on an equal plane.",formerlySerializedAs:"ignoreChangeTreshold"})],t.prototype,"ignoreChangeThreshold",void 0),t=o([a,s,c,l("Scribbles And Ink/Generic/Z Order Manager")],t)}(cc.Component);n.default=f,cc._RF.pop()},{}],angleOfVector:[function(e,t,n){"use strict";cc._RF.push(t,"099a6zhJgRBgaGRHaYGDE03","angleOfVector"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return(180*Math.atan2(e.y,e.x)/Math.PI-90+360)%360},cc._RF.pop()},{}],angleToQuat:[function(e,t,n){"use strict";cc._RF.push(t,"73484PpzBpCPbfaXqJbDYIz","angleToQuat"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0);var r=Math.cos(.5*e),o=Math.sin(.5*e),i=Math.cos(.5*n),a=Math.sin(.5*n),s=Math.cos(.5*t),c=Math.sin(.5*t),l=r*i*s+o*a*c,u=r*i*c-o*a*s,d=o*i*c+r*a*s,p=o*i*s-r*a*c;return new cc.Quat(u,d,p,l)},cc._RF.pop()},{}],asyncChunker:[function(e,t,n){"use strict";cc._RF.push(t,"55065bNzC9ExaBK5KNZvt6O","asyncChunker"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("../constants"),o=6,i={},a=0,s=function(){if("peformance"in window&&"now"in window.performance)return performance.now;var e=Date.now();return function(){return Date.now()-e}}();n.uniqueKey=function(){for(var e=""+a++;e.length<o;)e="0"+e;return e},n.start=function(e){var t=s();i[e]={last:t,start:t}},n.check=function(e,t){void 0===t&&(t=r.ONE_FRAME);var n=s(),o=n-i[e].last>=1e3*t;return o&&(i[e].last=n),o},n.end=function(e,t){if(void 0===t&&(t=!1),t&&e in i){var n=(s()-i[e].start)/1e3;cc.log(e+" complete: "+n+"s")}delete i[e]},cc._RF.pop()},{"../constants":"constants"}],asyncSchedule:[function(e,t,n){"use strict";cc._RF.push(t,"92348Gz4LpKobwNC9I/q94w","asyncSchedule"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("../constants");n.default=function(e,t){void 0===t&&(t=r.ONE_FRAME);var n="number"==typeof t,o=n?t:r.ONE_FRAME;if(!cc.isValid(e,!0))throw new Error("Cannot call asyncSchedule on a destroyed component.");if(!cc.isValid(e.node,!0))throw new Error("Cannot call async schedule on a component with a destroyed node.");return new Promise(function(r){return e.scheduleOnce(function(){var e;n||(e=t()),e instanceof Promise?e.then(r):r(e)},o)})},cc._RF.pop()},{"../constants":"constants"}],chunk:[function(e,t,n){"use strict";cc._RF.push(t,"896b5TffBlFfLhkmmae4DzN","chunk"),Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){return t.some(function(t){return e instanceof t})},o=void 0,i=void 0;var a=new WeakMap,s=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap;function d(e){var t=new Promise(function(t,n){var r=function(){e.removeEventListener("success",o),e.removeEventListener("error",i)},o=function(){t(v(e.result)),r()},i=function(){n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)});return t.then(function(t){t instanceof IDBCursor&&a.set(t,e)}).catch(function(){}),u.set(t,e),t}function p(e){if(!s.has(e)){var t=new Promise(function(t,n){var r=function(){e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=function(){t(),r()},i=function(){n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});s.set(e,t)}}var f={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(e[t])},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function h(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(_(this),n),v(a.get(this))}:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return v(e.apply(_(this),n))}:function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=e.call.apply(e,[_(this),t].concat(r));return c.set(i,t.sort?t.sort():[t]),v(i)}}function y(e){return"function"==typeof e?h(e):(e instanceof IDBTransaction&&p(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,f):e)}function v(e){if(e instanceof IDBRequest)return d(e);if(l.has(e))return l.get(e);var t=y(e);return t!==e&&(l.set(e,t),u.set(t,e)),t}var _=function(e){return u.get(e)};n.a=v,n.b=function(e){f=e(f)},n.c=r,n.d=u,n.e=_,cc._RF.pop()},{}],constants:[function(e,t,n){"use strict";cc._RF.push(t,"047cdRzJrpN/L1GYEAXE4Dt","constants");var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("./Util/PlatformDetect"));n.ONE_FRAME=o.default.isLowSpecMobileDevice()?1/30:1/60,n.UI_STORE_KEY="ui",n.UI_NODE_GROUP="ui";n.ANALYTICS={ClearDrawing:{category:"Scribbles and Ink",action:"Clear Drawing"},SaveDrawing:{category:"Scribbles and Ink",action:"Saved Drawings",gtag:!0},ShowcaseFrame:{category:"Scribbles and Ink",action:"Showcased Frames"},EnterRoom:{category:"Scribbles and Ink",action:"Entered Rooms"},EnterStory:{category:"Scribbles and Ink",action:"Entered Story"},UseTool:{category:"Scribbles and Ink",action:"Tool Usage",gtag:!1},UseToolInScene:{category:"Scribbles and Ink",action:"Tool + Story",gtag:!1},SpaceStory:{category:"Scribbles and Ink",action:"Outer Space",gtag:!0},RainStory:{category:"Scribbles and Ink",action:"Rainy Day",gtag:!0},PartyStory:{category:"Scribbles and Ink",action:"Party",gtag:!0},HomeStory:{category:"Scribbles and Ink",action:"Home Adventures",gtag:!0}},function(e){e[e.AtLeast=0]="AtLeast",e[e.AtMost=1]="AtMost"}(n.Comparer||(n.Comparer={})),cc._RF.pop()},{"./Util/PlatformDetect":"PlatformDetect"}],convertTexture:[function(e,t,n){"use strict";cc._RF.push(t,"fa1deGzUFpGBLGjIzgNlgrV","convertTexture");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var i="image/png",a=function(){return function(e){var t=document.createElement("canvas");t.width=e,t.height=e,this.canvas=t,this.ctx=t.getContext("2d")}}(),s=null;function c(e){return new Promise(function(t){var n=new Image;n.src=e,n.onload=function(){return t(n)}})}n.rgbaToDataUrl=function(e,t){s||(s=new a(t));for(var n=4*t,r=t-1;r>=0;r--){for(var o=r*n,c=s.ctx.createImageData(t,1),l=0;l<n;l++){var u=o+l;c.data[l]=e[u]}s.ctx.putImageData(c,0,r)}return s.canvas.toDataURL(i)},n.dataUrlToHtmlImage=c,n.dataUrlToRgba=function(e,t){return r(this,void 0,Promise,function(){var n;return o(this,function(r){switch(r.label){case 0:return[4,c(e)];case 1:return n=r.sent(),s||(s=new a(t)),s.ctx.drawImage(n,0,0),[2,s.ctx.getImageData(0,0,t,t).data]}})})},cc._RF.pop()},{}],ensureEventHandler:[function(e,t,n){"use strict";cc._RF.push(t,"13f95jbQbdLcLrXHOO3M3+N","ensureEventHandler");var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};function o(e,t){var n=e.reduce(function(e,n,r){return(!cc.isValid(n.target)||n.target===t.target&&n.handler===t.handler)&&(e=r),e},-1);n>-1&&(e.splice(n,1),o(e,t))}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n,i;if(e instanceof cc.Component){var a=Object.keys(e);try{for(var s=r(a),c=s.next();!c.done;c=s.next()){var l=c.value,u=e[l];/events$/i.test(l)&&u instanceof Array&&(e=u)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}if(!(e instanceof cc.Component)){if(t instanceof cc.Component.EventHandler==0){var d=t.handler,p=t.target,f=t.customEventData,h=t.component;(t=new cc.Component.EventHandler).target=p,t.handler=d,t.component=h,t.customEventData=f}var y=t;o(e,y),e.push(y)}},cc._RF.pop()},{}],executeEventHandler:[function(e,t,n){"use strict";cc._RF.push(t,"bba6f/jpfZIR40zKVQ3kE9A","executeEventHandler"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=e.handler,r=e.target,o=e.component||e._componentName;if(cc.isValid(r,!0)&&o){var i=r.getComponent(o);if(i&&"function"==typeof i[n])return i[n](t,e.customEventData)}},cc._RF.pop()},{}],getComponentInParents:[function(e,t,n){"use strict";cc._RF.push(t,"c8845xmWNdLT7dvOEiSVr8q","getComponentInParents"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){for(var n=e instanceof cc.Component?e.node:e,r=null;!r&&n.parent&&n.parent instanceof cc.Scene==0;)r=(n=n.parent).getComponent(t);return r},cc._RF.pop()},{}],getComponentInScene:[function(e,t,n){"use strict";cc._RF.push(t,"1d2e67zkiZPN5/hTFaDj2Yx","getComponentInScene"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return cc.director.getScene().getComponentInChildren(e)},cc._RF.pop()},{}],getComponentsInScene:[function(e,t,n){"use strict";cc._RF.push(t,"28b92RSQktF+YkNbWEfsUnT","getComponentsInScene"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return cc.director.getScene().getComponentsInChildren(e)},cc._RF.pop()},{}],getDescendentByName:[function(e,t,n){"use strict";cc._RF.push(t,"eded3fj9vtBkr5Zu5ox2L75","getDescendentByName");var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(n,"__esModule",{value:!0}),n.default=function e(t,n){var o,i;void 0===n&&(n=cc.director.getScene());var a=null;try{for(var s=r(n.children),c=s.next();!c.done;c=s.next()){var l=c.value;if(l.name===t&&(a=l),a||(a=e(t,l)),a)break}}catch(e){o={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return a},cc._RF.pop()},{}],getLocalPosition:[function(e,t,n){"use strict";cc._RF.push(t,"9b397U0PipG0bpZMnXs7XHN","getLocalPosition"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=e.convertToWorldSpaceAR(cc.Vec2.ZERO);return t.parent.convertToNodeSpaceAR(n)},cc._RF.pop()},{}],idb:[function(e,t,n){"use strict";cc._RF.push(t,"67129uKWoxMv62K8uv7Kbq2","idb"),Object.defineProperty(n,"__esModule",{value:!0}),n.deleteDB=n.openDB=n.wrap=n.unwrap=void 0;var r=e("./chunk.js");function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var a=t[o](i),s=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}Object.defineProperty(n,"unwrap",{enumerable:!0,get:function(){return r.e}}),Object.defineProperty(n,"wrap",{enumerable:!0,get:function(){return r.a}});var a=["get","getKey","getAll","getAllKeys","count"],s=["put","add","delete","clear"],c=new Map;function l(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(c.get(t))return c.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,l=s.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(l||a.includes(n))){var u=function(){var e=i(regeneratorRuntime.mark(function e(t){for(var i,a,s,c,u=arguments.length,d=Array(u>1?u-1:0),p=1;p<u;p++)d[p-1]=arguments[p];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.transaction(t,l?"readwrite":"readonly"),s=a.store,r&&(s=s.index(d.shift())),c=(i=s)[n].apply(i,o(d)),!l){e.next=7;break}return e.next=7,a.done;case 7:return e.abrupt("return",c);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();return c.set(t,u),u}}}(0,r.b)(function(e){return{get:function(t,n,r){return l(t,n)||e.get(t,n,r)},has:function(t,n){return!!l(t,n)||e.has(t,n)}}}),n.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.blocked,i=n.upgrade,a=n.blocking,s=indexedDB.open(e,t),c=(0,r.a)(s);return i&&s.addEventListener("upgradeneeded",function(e){i((0,r.a)(s.result),e.oldVersion,e.newVersion,(0,r.a)(s.transaction))}),o&&s.addEventListener("blocked",function(){return o()}),a&&c.then(function(e){return e.addEventListener("versionchange",a)}).catch(function(){}),c},n.deleteDB=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",function(){return t()}),(0,r.a)(n).then(function(){})},cc._RF.pop()},{"./chunk.js":"chunk"}],index:[function(e,t,n){"use strict";cc._RF.push(t,"c8bdf753qND55JERGNJk4yH","index");var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("./ensureEventHandler"));n.ensureEventHandler=i.default;var a=r(e("./executeEventHandler"));n.executeEventHandler=a.default;var s=r(e("./nameOfComponent"));n.nameOfComponent=s.default;var c=r(e("./angleOfVector"));n.angleOfVector=c.default;var l=r(e("./angleToQuat"));n.angleToQuat=l.default;var u=r(e("./lerpAngle"));n.lerpAngle=u.default;var d=r(e("./getLocalPosition"));n.getLocalPosition=d.default;var p=r(e("./transformToTarget"));n.transformToTarget=p.default;var f=r(e("./getComponentInScene"));n.getComponentInScene=f.default;var h=r(e("./getComponentsInScene"));n.getComponentsInScene=h.default;var y=r(e("./getComponentInParents"));n.getComponentInParents=y.default;var v=r(e("./getDescendentByName"));n.getDescendentByName=v.default;var _=r(e("./asyncSchedule"));n.asyncSchedule=_.default;var g=o(e("./asyncChunker"));n.asyncChunker=g,n.chunker=g;var m=o(e("./random"));n.Random=m;var b=r(e("./isUnsetOrInPrefabMode"));n.isUnsetOrInPrefabMode=b.default;var w=r(e("./PlatformDetect"));n.PlatformDetect=w.default;var S=e("./convertTexture");n.dataUrlToRgba=S.dataUrlToRgba,n.dataUrlToHtmlImage=S.dataUrlToHtmlImage,n.rgbaToDataUrl=S.rgbaToDataUrl,cc._RF.pop()},{"./PlatformDetect":"PlatformDetect","./angleOfVector":"angleOfVector","./angleToQuat":"angleToQuat","./asyncChunker":"asyncChunker","./asyncSchedule":"asyncSchedule","./convertTexture":"convertTexture","./ensureEventHandler":"ensureEventHandler","./executeEventHandler":"executeEventHandler","./getComponentInParents":"getComponentInParents","./getComponentInScene":"getComponentInScene","./getComponentsInScene":"getComponentsInScene","./getDescendentByName":"getDescendentByName","./getLocalPosition":"getLocalPosition","./isUnsetOrInPrefabMode":"isUnsetOrInPrefabMode","./lerpAngle":"lerpAngle","./nameOfComponent":"nameOfComponent","./random":"random","./transformToTarget":"transformToTarget"}],isUnsetOrInPrefabMode:[function(e,t,n){"use strict";function r(e){return null==e}cc._RF.push(t,"876570i1EpBSaIsVshMWoqa","isUnsetOrInPrefabMode"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return void 0===t&&(t=r),function(){return"New Node"===cc.director.getScene().name||t(this[e])}},cc._RF.pop()},{}],lerpAngle:[function(e,t,n){"use strict";cc._RF.push(t,"bda93euuApBVqXWvAgNdkfx","lerpAngle"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){for(void 0===t&&(t=e),void 0===n&&(n=1);e>t+180;)t+=360;for(;t>e+180;)t-=360;return cc.misc.lerp(e,t,n)},cc._RF.pop()},{}],nameOfComponent:[function(e,t,n){"use strict";cc._RF.push(t,"05fc9u/a+9NsYdy6otMyw98","nameOfComponent"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return e.name.replace(e.node.name,"").replace(/<|>/g,"")},cc._RF.pop()},{}],pako:[function(e,t,n){(function(r){"use strict";cc._RF.push(t,"0538fvNR+9Ei6JvDTWcCeGW","pako");var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e){if("object"===(void 0===n?"undefined":o(n))&&void 0!==t)t.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:this).pako=e()}})(function(){return function(){return function t(n,r,o){function i(s,c){if(!r[s]){if(!n[s]){var l="function"==typeof e&&e;if(!c&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[s]={exports:{}};n[s][0].call(d.exports,function(e){return i(n[s][1][e]||e)},d,d.exports,t,n,r,o)}return r[s].exports}for(var a="function"==typeof e&&e,s=0;s<o.length;s++)i(o[s]);return i}}()({1:[function(e,t,n){var r=e("./zlib/deflate"),o=e("./utils/common"),i=e("./utils/strings"),a=e("./zlib/messages"),s=e("./zlib/zstream"),c=Object.prototype.toString,l=0,u=-1,d=0,p=8;function f(e){if(!(this instanceof f))return new f(e);this.options=o.assign({level:u,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(a[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var h;if(h="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=r.deflateSetDictionary(this.strm,h))!==l)throw new Error(a[n]);this._dict_set=!0}}function h(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}f.prototype.push=function(e,t){var n,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=i.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(u),s.next_out=0,s.avail_out=u),1!==(n=r.deflate(s,a))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(i.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==a||(this.onEnd(l),s.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=f,n.deflate=h,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,h(e,t)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,n){var r=e("./zlib/inflate"),o=e("./utils/common"),i=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),c=e("./zlib/zstream"),l=e("./zlib/gzheader"),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[n])}function p(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,c,l,d,p=this.strm,f=this.options.chunkSize,h=this.options.dictionary,y=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?p.input=i.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new o.Buf8(f),p.next_out=0,p.avail_out=f),(n=r.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&h&&(n=r.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===y&&(n=a.Z_OK,y=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=i.utf8border(p.output,p.next_out),l=p.next_out-c,d=i.buf2string(p.output,c),p.next_out=l,p.avail_out=f-l,l&&o.arraySet(p.output,p.output,c,l,0),this.onData(d)):this.onData(o.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(y=!0)}while((p.avail_in>0||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=d,n.inflate=p,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},n.ungzip=p},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,n){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==(void 0===n?"undefined":o(n)))throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,o){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),o);else for(var i=0;i<r;i++)e[o+i]=t[n+i]},flattenChunks:function(e){var t,n,r,o,i,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),o=0,t=0,n=e.length;t<n;t++)i=e[t],a.set(i,o),o+=i.length;return a}},s={arraySet:function(e,t,n,r,o){for(var i=0;i<r;i++)e[o+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],4:[function(e,t,n){var r=e("./common"),o=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&i||!e.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,o,i,a,s=e.length,c=0;for(i=0;i<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(o=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(o-56320),i++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(c),a=0,i=0;a<c;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(o=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(o-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return c(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,o=t.length;n<o;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,o,i,s=t||e.length,l=new Array(2*s);for(r=0,n=0;n<s;)if((o=e[n++])<128)l[r++]=o;else if((i=a[o])>4)l[r++]=65533,n+=i-1;else{for(o&=2===i?31:3===i?15:7;i>1&&n<s;)o=o<<6|63&e[n++],i--;i>1?l[r++]=65533:o<65536?l[r++]=o:(o-=65536,l[r++]=55296|o>>10&1023,l[r++]=56320|1023&o)}return c(l,r)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}},{"./common":3}],5:[function(e,t,n){t.exports=function(e,t,n,r){for(var o=65535&e|0,i=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{i=i+(o=o+t[r++]|0)|0}while(--a);o%=65521,i%=65521}return o|i<<16|0}},{}],6:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,n){var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,o){var i=r,a=o+n;e^=-1;for(var s=o;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}},{}],8:[function(e,t,n){var r,o=e("../utils/common"),i=e("./trees"),a=e("./adler32"),s=e("./crc32"),c=e("./messages"),l=0,u=1,d=3,p=4,f=5,h=0,y=1,v=-2,_=-3,g=-5,m=-1,b=1,w=2,S=3,O=4,P=0,C=2,x=8,R=9,k=15,D=8,A=286,E=30,I=19,M=2*A+1,T=15,j=3,F=258,N=F+j+1,B=32,U=42,L=69,z=73,V=91,G=103,q=113,H=666,W=1,K=2,Z=3,Y=4,X=3;function J(e,t){return e.msg=c[t],t}function Q(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(o.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function oe(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,o.arraySet(t,e.input,e.next_in,i,n),1===e.state.wrap?e.adler=a(e.adler,t,i,n):2===e.state.wrap&&(e.adler=s(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)}function ie(e,t){var n,r,o=e.max_chain_length,i=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-N?e.strstart-(e.w_size-N):0,l=e.window,u=e.w_mask,d=e.prev,p=e.strstart+F,f=l[i+a-1],h=l[i+a];e.prev_length>=e.good_match&&(o>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+a]===h&&l[n+a-1]===f&&l[n]===l[i]&&l[++n]===l[i+1]){i+=2,n++;do{}while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<p);if(r=F-(p-i),i=p-F,r>a){if(e.match_start=t,a=r,r>=s)break;f=l[i+a-1],h=l[i+a]}}}while((t=d[t&u])>c&&0!=--o);return a<=e.lookahead?a:e.lookahead}function ae(e){var t,n,r,i,a,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-N)){o.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=s?r-s:0}while(--n);t=n=s;do{r=e.prev[--t],e.prev[t]=r>=s?r-s:0}while(--n);i+=s}if(0===e.strm.avail_in)break;if(n=oe(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=j)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+j-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<j)););}while(e.lookahead<N&&0!==e.strm.avail_in)}function se(e,t){for(var n,r;;){if(e.lookahead<N){if(ae(e),e.lookahead<N&&t===l)return W;if(0===e.lookahead)break}if(n=0,e.lookahead>=j&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+j-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-N&&(e.match_length=ie(e,n)),e.match_length>=j)if(r=i._tr_tally(e,e.strstart-e.match_start,e.match_length-j),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=j){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+j-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=e.strstart<j-1?e.strstart:j-1,t===p?(te(e,!0),0===e.strm.avail_out?Z:Y):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:K}function ce(e,t){for(var n,r,o;;){if(e.lookahead<N){if(ae(e),e.lookahead<N&&t===l)return W;if(0===e.lookahead)break}if(n=0,e.lookahead>=j&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+j-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=j-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-N&&(e.match_length=ie(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===j&&e.strstart-e.match_start>4096)&&(e.match_length=j-1)),e.prev_length>=j&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-j,r=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-j),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+j-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=j-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return W}else if(e.match_available){if((r=i._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return W}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<j-1?e.strstart:j-1,t===p?(te(e,!0),0===e.strm.avail_out?Z:Y):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:K}function le(e,t){for(var n,r,o,a,s=e.window;;){if(e.lookahead<=F){if(ae(e),e.lookahead<=F&&t===l)return W;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=j&&e.strstart>0&&(r=s[o=e.strstart-1])===s[++o]&&r===s[++o]&&r===s[++o]){a=e.strstart+F;do{}while(r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&o<a);e.match_length=F-(a-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=j?(n=i._tr_tally(e,1,e.match_length-j),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===p?(te(e,!0),0===e.strm.avail_out?Z:Y):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:K}function ue(e,t){for(var n;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===l)return W;break}if(e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===p?(te(e,!0),0===e.strm.avail_out?Z:Y):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?W:K}function de(e,t,n,r,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=o}function pe(e){e.window_size=2*e.w_size,$(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=j-1,e.match_available=0,e.ins_h=0}function fe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*M),this.dyn_dtree=new o.Buf16(2*(2*E+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(T+1),this.heap=new o.Buf16(2*A+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function he(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=C,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?U:q,e.adler=2===t.wrap?0:1,t.last_flush=l,i._tr_init(t),h):J(e,v)}function ye(e){var t=he(e);return t===h&&pe(e.state),t}function ve(e,t,n,r,i,a){if(!e)return v;var s=1;if(t===m&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>R||n!==x||r<8||r>15||t<0||t>9||a<0||a>O)return J(e,v);8===r&&(r=9);var c=new fe;return e.state=c,c.strm=e,c.wrap=s,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+j-1)/j),c.window=new o.Buf8(2*c.w_size),c.head=new o.Buf16(c.hash_size),c.prev=new o.Buf16(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new o.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=n,ye(e)}r=[new de(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===l)return W;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return W;if(e.strstart-e.block_start>=e.w_size-N&&(te(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===p?(te(e,!0),0===e.strm.avail_out?Z:Y):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),W)}),new de(4,4,8,4,se),new de(4,5,16,8,se),new de(4,6,32,32,se),new de(4,4,16,16,ce),new de(8,16,32,32,ce),new de(8,16,128,128,ce),new de(8,32,128,256,ce),new de(32,128,258,1024,ce),new de(32,258,258,4096,ce)],n.deflateInit=function(e,t){return ve(e,t,x,k,D,P)},n.deflateInit2=ve,n.deflateReset=ye,n.deflateResetKeep=he,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?v:(e.state.gzhead=t,h):v},n.deflate=function(e,t){var n,o,a,c;if(!e||!e.state||t>f||t<0)return e?J(e,v):v;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===H&&t!==p)return J(e,0===e.avail_out?g:v);if(o.strm=e,n=o.last_flush,o.last_flush=t,o.status===U)if(2===o.wrap)e.adler=0,ne(o,31),ne(o,139),ne(o,8),o.gzhead?(ne(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),ne(o,255&o.gzhead.time),ne(o,o.gzhead.time>>8&255),ne(o,o.gzhead.time>>16&255),ne(o,o.gzhead.time>>24&255),ne(o,9===o.level?2:o.strategy>=w||o.level<2?4:0),ne(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(ne(o,255&o.gzhead.extra.length),ne(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=s(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=L):(ne(o,0),ne(o,0),ne(o,0),ne(o,0),ne(o,0),ne(o,9===o.level?2:o.strategy>=w||o.level<2?4:0),ne(o,X),o.status=q);else{var _=x+(o.w_bits-8<<4)<<8;_|=(o.strategy>=w||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(_|=B),_+=31-_%31,o.status=q,re(o,_),0!==o.strstart&&(re(o,e.adler>>>16),re(o,65535&e.adler)),e.adler=1}if(o.status===L)if(o.gzhead.extra){for(a=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),ee(e),a=o.pending,o.pending!==o.pending_buf_size));)ne(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=z)}else o.status=z;if(o.status===z)if(o.gzhead.name){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),ee(e),a=o.pending,o.pending===o.pending_buf_size)){c=1;break}c=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,ne(o,c)}while(0!==c);o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),0===c&&(o.gzindex=0,o.status=V)}else o.status=V;if(o.status===V)if(o.gzhead.comment){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),ee(e),a=o.pending,o.pending===o.pending_buf_size)){c=1;break}c=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,ne(o,c)}while(0!==c);o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),0===c&&(o.status=G)}else o.status=G;if(o.status===G&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&ee(e),o.pending+2<=o.pending_buf_size&&(ne(o,255&e.adler),ne(o,e.adler>>8&255),e.adler=0,o.status=q)):o.status=q),0!==o.pending){if(ee(e),0===e.avail_out)return o.last_flush=-1,h}else if(0===e.avail_in&&Q(t)<=Q(n)&&t!==p)return J(e,g);if(o.status===H&&0!==e.avail_in)return J(e,g);if(0!==e.avail_in||0!==o.lookahead||t!==l&&o.status!==H){var m=o.strategy===w?ue(o,t):o.strategy===S?le(o,t):r[o.level].func(o,t);if(m!==Z&&m!==Y||(o.status=H),m===W||m===Z)return 0===e.avail_out&&(o.last_flush=-1),h;if(m===K&&(t===u?i._tr_align(o):t!==f&&(i._tr_stored_block(o,0,0,!1),t===d&&($(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),ee(e),0===e.avail_out))return o.last_flush=-1,h}return t!==p?h:o.wrap<=0?y:(2===o.wrap?(ne(o,255&e.adler),ne(o,e.adler>>8&255),ne(o,e.adler>>16&255),ne(o,e.adler>>24&255),ne(o,255&e.total_in),ne(o,e.total_in>>8&255),ne(o,e.total_in>>16&255),ne(o,e.total_in>>24&255)):(re(o,e.adler>>>16),re(o,65535&e.adler)),ee(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?h:y)},n.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==U&&t!==L&&t!==z&&t!==V&&t!==G&&t!==q&&t!==H?J(e,v):(e.state=null,t===q?J(e,_):h):v},n.deflateSetDictionary=function(e,t){var n,r,i,s,c,l,u,d,p=t.length;if(!e||!e.state)return v;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==U||n.lookahead)return v;for(1===s&&(e.adler=a(e.adler,t,p,0)),n.wrap=0,p>=n.w_size&&(0===s&&($(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new o.Buf8(n.w_size),o.arraySet(d,t,p-n.w_size,n.w_size,0),t=d,p=n.w_size),c=e.avail_in,l=e.next_in,u=e.input,e.avail_in=p,e.next_in=0,e.input=t,ae(n);n.lookahead>=j;){r=n.strstart,i=n.lookahead-(j-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+j-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=j-1,ae(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=j-1,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,n.wrap=s,h},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,n){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(e,t,n){t.exports=function(e,t){var n,r,o,i,a,s,c,l,u,d,p,f,h,y,v,_,g,m,b,w,S,O,P,C,x;n=e.state,r=e.next_in,C=e.input,o=r+(e.avail_in-5),i=e.next_out,x=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,d=n.wnext,p=n.window,f=n.hold,h=n.bits,y=n.lencode,v=n.distcode,_=(1<<n.lenbits)-1,g=(1<<n.distbits)-1;e:do{h<15&&(f+=C[r++]<<h,h+=8,f+=C[r++]<<h,h+=8),m=y[f&_];t:for(;;){if(f>>>=b=m>>>24,h-=b,0===(b=m>>>16&255))x[i++]=65535&m;else{if(!(16&b)){if(0==(64&b)){m=y[(65535&m)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&m,(b&=15)&&(h<b&&(f+=C[r++]<<h,h+=8),w+=f&(1<<b)-1,f>>>=b,h-=b),h<15&&(f+=C[r++]<<h,h+=8,f+=C[r++]<<h,h+=8),m=v[f&g];n:for(;;){if(f>>>=b=m>>>24,h-=b,!(16&(b=m>>>16&255))){if(0==(64&b)){m=v[(65535&m)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&m,h<(b&=15)&&(f+=C[r++]<<h,(h+=8)<b&&(f+=C[r++]<<h,h+=8)),(S+=f&(1<<b)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,h-=b,S>(b=i-a)){if((b=S-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(O=0,P=p,0===d){if(O+=l-b,b<w){w-=b;do{x[i++]=p[O++]}while(--b);O=i-S,P=x}}else if(d<b){if(O+=l+d-b,(b-=d)<w){w-=b;do{x[i++]=p[O++]}while(--b);if(O=0,d<w){w-=b=d;do{x[i++]=p[O++]}while(--b);O=i-S,P=x}}}else if(O+=d-b,b<w){w-=b;do{x[i++]=p[O++]}while(--b);O=i-S,P=x}for(;w>2;)x[i++]=P[O++],x[i++]=P[O++],x[i++]=P[O++],w-=3;w&&(x[i++]=P[O++],w>1&&(x[i++]=P[O++]))}else{O=i-S;do{x[i++]=x[O++],x[i++]=x[O++],x[i++]=x[O++],w-=3}while(w>2);w&&(x[i++]=x[O++],w>1&&(x[i++]=x[O++]))}break}}break}}while(r<o&&i<s);r-=w=h>>3,f&=(1<<(h-=w<<3))-1,e.next_in=r,e.next_out=i,e.avail_in=r<o?o-r+5:5-(r-o),e.avail_out=i<s?s-i+257:257-(i-s),n.hold=f,n.bits=h}},{}],11:[function(e,t,n){var r=e("../utils/common"),o=e("./adler32"),i=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),c=0,l=1,u=2,d=4,p=5,f=6,h=0,y=1,v=2,_=-2,g=-3,m=-4,b=-5,w=8,S=1,O=2,P=3,C=4,x=5,R=6,k=7,D=8,A=9,E=10,I=11,M=12,T=13,j=14,F=15,N=16,B=17,U=18,L=19,z=20,V=21,G=22,q=23,H=24,W=25,K=26,Z=27,Y=28,X=29,J=30,Q=31,$=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function oe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ie(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,h):_}function ae(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ie(e)):_}function se(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ae(e))):_}function ce(e,t){var n,r;return e?(r=new oe,e.state=r,r.window=null,(n=se(e,t))!==h&&(e.state=null),n):_}var le,ue,de=!0;function pe(e){if(de){var t;for(le=new r.Buf32(512),ue=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,ue,0,e.work,{bits:5}),de=!1}e.lencode=le,e.lenbits=9,e.distcode=ue,e.distbits=5}function fe(e,t,n,o){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),o>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>o&&(i=o),r.arraySet(a.window,t,n-o,i,a.wnext),(o-=i)?(r.arraySet(a.window,t,n-o,o,0),a.wnext=o,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}n.inflateReset=ae,n.inflateReset2=se,n.inflateResetKeep=ie,n.inflateInit=function(e){return ce(e,ne)},n.inflateInit2=ce,n.inflate=function(e,t){var n,ee,te,ne,oe,ie,ae,se,ce,le,ue,de,he,ye,ve,_e,ge,me,be,we,Se,Oe,Pe,Ce,xe=0,Re=new r.Buf8(4),ke=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _;(n=e.state).mode===M&&(n.mode=T),oe=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,ie=e.avail_in,se=n.hold,ce=n.bits,le=ie,ue=ae,Oe=h;e:for(;;)switch(n.mode){case S:if(0===n.wrap){n.mode=T;break}for(;ce<16;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(2&n.wrap&&35615===se){n.check=0,Re[0]=255&se,Re[1]=se>>>8&255,n.check=i(n.check,Re,2,0),se=0,ce=0,n.mode=O;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",n.mode=J;break}if((15&se)!==w){e.msg="unknown compression method",n.mode=J;break}if(ce-=4,Se=8+(15&(se>>>=4)),0===n.wbits)n.wbits=Se;else if(Se>n.wbits){e.msg="invalid window size",n.mode=J;break}n.dmax=1<<Se,e.adler=n.check=1,n.mode=512&se?E:M,se=0,ce=0;break;case O:for(;ce<16;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(n.flags=se,(255&n.flags)!==w){e.msg="unknown compression method",n.mode=J;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=J;break}n.head&&(n.head.text=se>>8&1),512&n.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,n.check=i(n.check,Re,2,0)),se=0,ce=0,n.mode=P;case P:for(;ce<32;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.time=se),512&n.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,Re[2]=se>>>16&255,Re[3]=se>>>24&255,n.check=i(n.check,Re,4,0)),se=0,ce=0,n.mode=C;case C:for(;ce<16;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.xflags=255&se,n.head.os=se>>8),512&n.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,n.check=i(n.check,Re,2,0)),se=0,ce=0,n.mode=x;case x:if(1024&n.flags){for(;ce<16;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}n.length=se,n.head&&(n.head.extra_len=se),512&n.flags&&(Re[0]=255&se,Re[1]=se>>>8&255,n.check=i(n.check,Re,2,0)),se=0,ce=0}else n.head&&(n.head.extra=null);n.mode=R;case R:if(1024&n.flags&&((de=n.length)>ie&&(de=ie),de&&(n.head&&(Se=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,de,Se)),512&n.flags&&(n.check=i(n.check,ee,de,ne)),ie-=de,ne+=de,n.length-=de),n.length))break e;n.length=0,n.mode=k;case k:if(2048&n.flags){if(0===ie)break e;de=0;do{Se=ee[ne+de++],n.head&&Se&&n.length<65536&&(n.head.name+=String.fromCharCode(Se))}while(Se&&de<ie);if(512&n.flags&&(n.check=i(n.check,ee,de,ne)),ie-=de,ne+=de,Se)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=D;case D:if(4096&n.flags){if(0===ie)break e;de=0;do{Se=ee[ne+de++],n.head&&Se&&n.length<65536&&(n.head.comment+=String.fromCharCode(Se))}while(Se&&de<ie);if(512&n.flags&&(n.check=i(n.check,ee,de,ne)),ie-=de,ne+=de,Se)break e}else n.head&&(n.head.comment=null);n.mode=A;case A:if(512&n.flags){for(;ce<16;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(se!==(65535&n.check)){e.msg="header crc mismatch",n.mode=J;break}se=0,ce=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=M;break;case E:for(;ce<32;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}e.adler=n.check=re(se),se=0,ce=0,n.mode=I;case I:if(0===n.havedict)return e.next_out=oe,e.avail_out=ae,e.next_in=ne,e.avail_in=ie,n.hold=se,n.bits=ce,v;e.adler=n.check=1,n.mode=M;case M:if(t===p||t===f)break e;case T:if(n.last){se>>>=7&ce,ce-=7&ce,n.mode=Z;break}for(;ce<3;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}switch(n.last=1&se,ce-=1,3&(se>>>=1)){case 0:n.mode=j;break;case 1:if(pe(n),n.mode=z,t===f){se>>>=2,ce-=2;break e}break;case 2:n.mode=B;break;case 3:e.msg="invalid block type",n.mode=J}se>>>=2,ce-=2;break;case j:for(se>>>=7&ce,ce-=7&ce;ce<32;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",n.mode=J;break}if(n.length=65535&se,se=0,ce=0,n.mode=F,t===f)break e;case F:n.mode=N;case N:if(de=n.length){if(de>ie&&(de=ie),de>ae&&(de=ae),0===de)break e;r.arraySet(te,ee,ne,de,oe),ie-=de,ne+=de,ae-=de,oe+=de,n.length-=de;break}n.mode=M;break;case B:for(;ce<14;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(n.nlen=257+(31&se),se>>>=5,ce-=5,n.ndist=1+(31&se),se>>>=5,ce-=5,n.ncode=4+(15&se),se>>>=4,ce-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=J;break}n.have=0,n.mode=U;case U:for(;n.have<n.ncode;){for(;ce<3;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}n.lens[ke[n.have++]]=7&se,se>>>=3,ce-=3}for(;n.have<19;)n.lens[ke[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Pe={bits:n.lenbits},Oe=s(c,n.lens,0,19,n.lencode,0,n.work,Pe),n.lenbits=Pe.bits,Oe){e.msg="invalid code lengths set",n.mode=J;break}n.have=0,n.mode=L;case L:for(;n.have<n.nlen+n.ndist;){for(;_e=(xe=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ge=65535&xe,!((ve=xe>>>24)<=ce);){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(ge<16)se>>>=ve,ce-=ve,n.lens[n.have++]=ge;else{if(16===ge){for(Ce=ve+2;ce<Ce;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(se>>>=ve,ce-=ve,0===n.have){e.msg="invalid bit length repeat",n.mode=J;break}Se=n.lens[n.have-1],de=3+(3&se),se>>>=2,ce-=2}else if(17===ge){for(Ce=ve+3;ce<Ce;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}ce-=ve,Se=0,de=3+(7&(se>>>=ve)),se>>>=3,ce-=3}else{for(Ce=ve+7;ce<Ce;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}ce-=ve,Se=0,de=11+(127&(se>>>=ve)),se>>>=7,ce-=7}if(n.have+de>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=J;break}for(;de--;)n.lens[n.have++]=Se}}if(n.mode===J)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=J;break}if(n.lenbits=9,Pe={bits:n.lenbits},Oe=s(l,n.lens,0,n.nlen,n.lencode,0,n.work,Pe),n.lenbits=Pe.bits,Oe){e.msg="invalid literal/lengths set",n.mode=J;break}if(n.distbits=6,n.distcode=n.distdyn,Pe={bits:n.distbits},Oe=s(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Pe),n.distbits=Pe.bits,Oe){e.msg="invalid distances set",n.mode=J;break}if(n.mode=z,t===f)break e;case z:n.mode=V;case V:if(ie>=6&&ae>=258){e.next_out=oe,e.avail_out=ae,e.next_in=ne,e.avail_in=ie,n.hold=se,n.bits=ce,a(e,ue),oe=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,ie=e.avail_in,se=n.hold,ce=n.bits,n.mode===M&&(n.back=-1);break}for(n.back=0;_e=(xe=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ge=65535&xe,!((ve=xe>>>24)<=ce);){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(_e&&0==(240&_e)){for(me=ve,be=_e,we=ge;_e=(xe=n.lencode[we+((se&(1<<me+be)-1)>>me)])>>>16&255,ge=65535&xe,!(me+(ve=xe>>>24)<=ce);){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}se>>>=me,ce-=me,n.back+=me}if(se>>>=ve,ce-=ve,n.back+=ve,n.length=ge,0===_e){n.mode=K;break}if(32&_e){n.back=-1,n.mode=M;break}if(64&_e){e.msg="invalid literal/length code",n.mode=J;break}n.extra=15&_e,n.mode=G;case G:if(n.extra){for(Ce=n.extra;ce<Ce;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}n.length+=se&(1<<n.extra)-1,se>>>=n.extra,ce-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=q;case q:for(;_e=(xe=n.distcode[se&(1<<n.distbits)-1])>>>16&255,ge=65535&xe,!((ve=xe>>>24)<=ce);){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(0==(240&_e)){for(me=ve,be=_e,we=ge;_e=(xe=n.distcode[we+((se&(1<<me+be)-1)>>me)])>>>16&255,ge=65535&xe,!(me+(ve=xe>>>24)<=ce);){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}se>>>=me,ce-=me,n.back+=me}if(se>>>=ve,ce-=ve,n.back+=ve,64&_e){e.msg="invalid distance code",n.mode=J;break}n.offset=ge,n.extra=15&_e,n.mode=H;case H:if(n.extra){for(Ce=n.extra;ce<Ce;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}n.offset+=se&(1<<n.extra)-1,se>>>=n.extra,ce-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=J;break}n.mode=W;case W:if(0===ae)break e;if(de=ue-ae,n.offset>de){if((de=n.offset-de)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=J;break}de>n.wnext?(de-=n.wnext,he=n.wsize-de):he=n.wnext-de,de>n.length&&(de=n.length),ye=n.window}else ye=te,he=oe-n.offset,de=n.length;de>ae&&(de=ae),ae-=de,n.length-=de;do{te[oe++]=ye[he++]}while(--de);0===n.length&&(n.mode=V);break;case K:if(0===ae)break e;te[oe++]=n.length,ae--,n.mode=V;break;case Z:if(n.wrap){for(;ce<32;){if(0===ie)break e;ie--,se|=ee[ne++]<<ce,ce+=8}if(ue-=ae,e.total_out+=ue,n.total+=ue,ue&&(e.adler=n.check=n.flags?i(n.check,te,ue,oe-ue):o(n.check,te,ue,oe-ue)),ue=ae,(n.flags?se:re(se))!==n.check){e.msg="incorrect data check",n.mode=J;break}se=0,ce=0}n.mode=Y;case Y:if(n.wrap&&n.flags){for(;ce<32;){if(0===ie)break e;ie--,se+=ee[ne++]<<ce,ce+=8}if(se!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=J;break}se=0,ce=0}n.mode=X;case X:Oe=y;break e;case J:Oe=g;break e;case Q:return m;case $:default:return _}return e.next_out=oe,e.avail_out=ae,e.next_in=ne,e.avail_in=ie,n.hold=se,n.bits=ce,(n.wsize||ue!==e.avail_out&&n.mode<J&&(n.mode<Z||t!==d))&&fe(e,e.output,e.next_out,ue-e.avail_out)?(n.mode=Q,m):(le-=e.avail_in,ue-=e.avail_out,e.total_in+=le,e.total_out+=ue,n.total+=ue,n.wrap&&ue&&(e.adler=n.check=n.flags?i(n.check,te,ue,e.next_out-ue):o(n.check,te,ue,e.next_out-ue)),e.data_type=n.bits+(n.last?64:0)+(n.mode===M?128:0)+(n.mode===z||n.mode===F?256:0),(0===le&&0===ue||t===d)&&Oe===h&&(Oe=b),Oe)},n.inflateEnd=function(e){if(!e||!e.state)return _;var t=e.state;return t.window&&(t.window=null),e.state=null,h},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?_:(n.head=t,t.done=!1,h):_},n.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==I?_:n.mode===I&&o(1,t,r,0)!==n.check?g:fe(e,t,r,r)?(n.mode=Q,m):(n.havedict=1,h):_},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,n){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,c,l,u,d,p){var f,h,y,v,_,g,m,b,w,S=p.bits,O=0,P=0,C=0,x=0,R=0,k=0,D=0,A=0,E=0,I=0,M=null,T=0,j=new r.Buf16(16),F=new r.Buf16(16),N=null,B=0;for(O=0;O<=15;O++)j[O]=0;for(P=0;P<c;P++)j[t[n+P]]++;for(R=S,x=15;x>=1&&0===j[x];x--);if(R>x&&(R=x),0===x)return l[u++]=20971520,l[u++]=20971520,p.bits=1,0;for(C=1;C<x&&0===j[C];C++);for(R<C&&(R=C),A=1,O=1;O<=15;O++)if(A<<=1,(A-=j[O])<0)return-1;if(A>0&&(0===e||1!==x))return-1;for(F[1]=0,O=1;O<15;O++)F[O+1]=F[O]+j[O];for(P=0;P<c;P++)0!==t[n+P]&&(d[F[t[n+P]]++]=P);if(0===e?(M=N=d,g=19):1===e?(M=o,T-=257,N=i,B-=257,g=256):(M=a,N=s,g=-1),I=0,P=0,O=C,_=u,k=R,D=0,y=-1,v=(E=1<<R)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){m=O-D,d[P]<g?(b=0,w=d[P]):d[P]>g?(b=N[B+d[P]],w=M[T+d[P]]):(b=96,w=0),f=1<<O-D,C=h=1<<k;do{l[_+(I>>D)+(h-=f)]=m<<24|b<<16|w|0}while(0!==h);for(f=1<<O-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,P++,0==--j[O]){if(O===x)break;O=t[n+d[P]]}if(O>R&&(I&v)!==y){for(0===D&&(D=R),_+=C,A=1<<(k=O-D);k+D<x&&!((A-=j[k+D])<=0);)k++,A<<=1;if(E+=1<<k,1===e&&E>852||2===e&&E>592)return 1;l[y=I&v]=R<<24|k<<16|_-u|0}}return 0!==I&&(l[_+I]=O-D<<24|64<<16|0),p.bits=R,0}},{"../utils/common":3}],13:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){var r=e("../utils/common"),o=4,i=0,a=1,s=2;function c(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,u=1,d=2,p=29,f=256,h=f+1+p,y=30,v=19,_=2*h+1,g=15,m=16,b=7,w=256,S=16,O=17,P=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=new Array(2*(h+2));c(D);var A=new Array(2*y);c(A);var E=new Array(512);c(E);var I=new Array(256);c(I);var M=new Array(p);c(M);var T,j,F,N=new Array(y);function B(e,t,n,r,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=e&&e.length}function U(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function L(e){return e<256?E[e]:E[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,n){e.bi_valid>m-n?(e.bi_buf|=t<<e.bi_valid&65535,z(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=n-m):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function G(e,t,n){V(e,n[2*t],n[2*t+1])}function q(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function H(e){16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function W(e,t){var n,r,o,i,a,s,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,h=t.stat_desc.max_length,y=0;for(i=0;i<=g;i++)e.bl_count[i]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<_;n++)(i=c[2*c[2*(r=e.heap[n])+1]+1]+1)>h&&(i=h,y++),c[2*r+1]=i,r>l||(e.bl_count[i]++,a=0,r>=f&&(a=p[r-f]),s=c[2*r],e.opt_len+=s*(i+a),d&&(e.static_len+=s*(u[2*r+1]+a)));if(0!==y){do{for(i=h-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[h]--,y-=2}while(y>0);for(i=h;0!==i;i--)for(r=e.bl_count[i];0!==r;)(o=e.heap[--n])>l||(c[2*o+1]!==i&&(e.opt_len+=(i-c[2*o+1])*c[2*o],c[2*o+1]=i),r--)}}function K(e,t,n){var r,o,i=new Array(g+1),a=0;for(r=1;r<=g;r++)i[r]=a=a+n[r-1]<<1;for(o=0;o<=t;o++){var s=e[2*o+1];0!==s&&(e[2*o]=q(i[s]++,s))}}function Z(){var e,t,n,r,o,i=new Array(g+1);for(n=0,r=0;r<p-1;r++)for(M[r]=n,e=0;e<1<<C[r];e++)I[n++]=r;for(I[n-1]=r,o=0,r=0;r<16;r++)for(N[r]=o,e=0;e<1<<x[r];e++)E[o++]=r;for(o>>=7;r<y;r++)for(N[r]=o<<7,e=0;e<1<<x[r]-7;e++)E[256+o++]=r;for(t=0;t<=g;t++)i[t]=0;for(e=0;e<=143;)D[2*e+1]=8,e++,i[8]++;for(;e<=255;)D[2*e+1]=9,e++,i[9]++;for(;e<=279;)D[2*e+1]=7,e++,i[7]++;for(;e<=287;)D[2*e+1]=8,e++,i[8]++;for(K(D,h+1,i),e=0;e<y;e++)A[2*e+1]=5,A[2*e]=q(e,5);T=new B(D,C,f+1,h,g),j=new B(A,x,0,y,g),F=new B(new Array(0),R,0,v,b)}function Y(e){var t;for(t=0;t<h;t++)e.dyn_ltree[2*t]=0;for(t=0;t<y;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function X(e){e.bi_valid>8?z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function J(e,t,n,o){X(e),o&&(z(e,n),z(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function Q(e,t,n,r){var o=2*t,i=2*n;return e[o]<e[i]||e[o]===e[i]&&r[t]<=r[n]}function $(e,t,n){for(var r=e.heap[n],o=n<<1;o<=e.heap_len&&(o<e.heap_len&&Q(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!Q(t,r,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=r}function ee(e,t,n){var r,o,i,a,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],o=e.pending_buf[e.l_buf+s],s++,0===r?G(e,o,t):(G(e,(i=I[o])+f+1,t),0!==(a=C[i])&&V(e,o-=M[i],a),G(e,i=L(--r),n),0!==(a=x[i])&&V(e,r-=N[i],a))}while(s<e.last_lit);G(e,w,t)}function te(e,t){var n,r,o,i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=_,n=0;n<c;n++)0!==i[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(o=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[o]=0,e.opt_len--,s&&(e.static_len-=a[2*o+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)$(e,i,n);o=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],$(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,i[2*o]=i[2*n]+i[2*r],e.depth[o]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,i[2*n+1]=i[2*r+1]=o,e.heap[1]=o++,$(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],W(e,t),K(i,l,e.bl_count)}function ne(e,t,n){var r,o,i=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)o=a,a=t[2*(r+1)+1],++s<c&&o===a||(s<l?e.bl_tree[2*o]+=s:0!==o?(o!==i&&e.bl_tree[2*o]++,e.bl_tree[2*S]++):s<=10?e.bl_tree[2*O]++:e.bl_tree[2*P]++,s=0,i=o,0===a?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4))}function re(e,t,n){var r,o,i=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),r=0;r<=n;r++)if(o=a,a=t[2*(r+1)+1],!(++s<c&&o===a)){if(s<l)do{G(e,o,e.bl_tree)}while(0!=--s);else 0!==o?(o!==i&&(G(e,o,e.bl_tree),s--),G(e,S,e.bl_tree),V(e,s-3,2)):s<=10?(G(e,O,e.bl_tree),V(e,s-3,3)):(G(e,P,e.bl_tree),V(e,s-11,7));s=0,i=o,0===a?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4)}}function oe(e){var t;for(ne(e,e.dyn_ltree,e.l_desc.max_code),ne(e,e.dyn_dtree,e.d_desc.max_code),te(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*k[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function ie(e,t,n,r){var o;for(V(e,t-257,5),V(e,n-1,5),V(e,r-4,4),o=0;o<r;o++)V(e,e.bl_tree[2*k[o]+1],3);re(e,e.dyn_ltree,t-1),re(e,e.dyn_dtree,n-1)}function ae(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return a;return i}c(N);var se=!1;function ce(e,t,n,r){V(e,(l<<1)+(r?1:0),3),J(e,t,n,!0)}n._tr_init=function(e){se||(Z(),se=!0),e.l_desc=new U(e.dyn_ltree,T),e.d_desc=new U(e.dyn_dtree,j),e.bl_desc=new U(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,Y(e)},n._tr_stored_block=ce,n._tr_flush_block=function(e,t,n,r){var i,a,c=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=ae(e)),te(e,e.l_desc),te(e,e.d_desc),c=oe(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?ce(e,t,n,r):e.strategy===o||a===i?(V(e,(u<<1)+(r?1:0),3),ee(e,D,A)):(V(e,(d<<1)+(r?1:0),3),ie(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),ee(e,e.dyn_ltree,e.dyn_dtree)),Y(e),r&&X(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(I[n]+f+1)]++,e.dyn_dtree[2*L(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){V(e,u<<1,3),G(e,w,D),H(e)}},{"../utils/common":3}],15:[function(e,t,n){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(e,t,n){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}),cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/common":void 0,"./adler32":void 0,"./common":void 0,"./crc32":void 0,"./inffast":void 0,"./inftrees":void 0,"./lib/deflate":void 0,"./lib/inflate":void 0,"./lib/utils/common":void 0,"./lib/zlib/constants":void 0,"./messages":void 0,"./trees":void 0,"./utils/common":void 0,"./utils/strings":void 0,"./zlib/constants":void 0,"./zlib/deflate":void 0,"./zlib/gzheader":void 0,"./zlib/inflate":void 0,"./zlib/messages":void 0,"./zlib/zstream":void 0}],random:[function(e,t,n){"use strict";function r(e,t){return void 0===e&&(e=1),void 0===t&&(t=e,e=0),Math.random()*(t-e)+e}function o(e,t){void 0===e&&(e=1);var n=r(e,t);return Math.floor(n)}function i(e){return o(0,e.length)}cc._RF.push(t,"9c08bJuHJpE6pHekTUWAGq2","random"),Object.defineProperty(n,"__esModule",{value:!0}),n.float=r,n.integer=o,n.v2=function(e,t){void 0===e&&(e=1);var n=r(e,t),o=r(0,2*Math.PI);return new cc.Vec2(Math.cos(o)*n,Math.sin(o)*n)},n.index=i,n.item=function(e){return e[i(e)]},n.sort=function(){return o(-1,1)},cc._RF.pop()},{}],transformToTarget:[function(e,t,n){"use strict";cc._RF.push(t,"bf52a6aKhVAbI2D3phIDDBE","transformToTarget");var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("./getLocalPosition"));function i(e){var t=cc["ease"+e];return"function"==typeof t&&0===t.length?t():null}n.default=function(e,t,n,r){void 0===r&&(r="linear");var a=o.default(t,e),s=t.angle,c=t.scaleX,l=t.scaleY;if(n>0){var u=cc.moveTo(n,a.x,a.y),d=cc.rotateTo(n,s),p=cc.scaleTo(n,c,l),f=i(r);return f&&(u.easing(f),d.easing(f),p.easing(f)),new Promise(function(t){e.runAction(cc.sequence(cc.spawn(u,d,p),cc.callFunc(t)))})}e.scaleX=c,e.scaleY=l,e.angle=s,e.position=a},cc._RF.pop()},{"./getLocalPosition":"getLocalPosition"}]},{},["ApplySkeletonRootMotion","PauseSkeletonOnDraw","SnapBoneToNode","SnapNodeToBone","UseMotion","UseProceduralMotion","UseRootMotion","Drawing","DrawingConditionalDestroy","DrawingConditionalSpineClip","DrawingHandler","DrawingSelectSplatPrefabsButton","DrawingSpot","DrawingStorage","DrawingTool","DrawingToolAudio","DrawingToolButton","DrawingUI","DrawingUIConfig","DrawingUIHiddenActivator","DrawingUIOverride","DynamicSplat","TimedDynamicSplat","Analytics","AssetLoader","Audio","Captions","ContentLoader","EventActor","EventRelay","EventRelayAudioLoader","EventSequencer","GameComponent","GameManager","LoadingScreen","SceneManager","Storage","StoryBlock","StoryBlockReplayOverride","StoryManager","Activator","ApplyAnimationsToEmittedInstances","CameraRig","ChangeHiderShowTransformerOnCaptionHidden","ComponentExistsActivator","ConstrainScaleToPosition","CurrentSceneActivator","Hider","LevelOfDetail","LevelOfDetailSprites","MoveEmittedInstances","Note","Override2DRenderMaterial","PeriodicAnimator","PrefabEmitter","Temporary","Transfomer","Velocity","ZOrderManager","AreaSpawner","Costume","FakePerspective","HomeStoryManager","RaceCar","Door","MessEraser","PartyGuest","PartyGuestMover","PartyStoryManager","Table","DynamicRainDrop","PuddleSensor","RainOutsideStoryManager","RainUnderwaterStoryManager","SidewalkSensor","StaticRainDrop","DrawRocketManager","FlubberChaser","FlubberDynamicSplat","PlanetEdge","SpaceDrift","SpaceStoryManager","StarBackground","StickToStarBackground","StartSceneManager","AnalyticValueActivator","GalleryFilledActivator","GalleryFrame","Room","RoomManager","StudioManager","Button","ButtonAction","ButtonResolvingActivator","NavigationButton","ScreenWidget","SpringRollTestUI","StoryBlockReplay","StoryBlockReplayOptions","PlatformDetect","angleOfVector","angleToQuat","asyncChunker","asyncSchedule","convertTexture","ensureEventHandler","executeEventHandler","getComponentInParents","getComponentInScene","getComponentsInScene","getDescendentByName","getLocalPosition","index","isUnsetOrInPrefabMode","lerpAngle","nameOfComponent","random","transformToTarget","chunk","idb","pako","constants","DrawToolExampleStrokes","VisualizeDrawingData"]);