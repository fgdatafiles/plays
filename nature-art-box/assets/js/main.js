function shuffle(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}fabric.Sprite=fabric.util.createClass(fabric.Image,{type:"sprite",spriteIndex:0,moveX:0,initialize:function(a,b){this.options=b||{},this.spriteWidth=b.width,this.spriteHeight=b.height,this.callSuper("initialize",a,b),this.createTmpCanvas(),this.createSpriteImages()},onMove:function(a){a.target==this&&this.options.move&&this.init()},createTmpCanvas:function(){this.tmpCanvasEl=fabric.util.createCanvasElement(),this.tmpCanvasEl.width=this.spriteWidth||this.width,this.tmpCanvasEl.height=this.spriteHeight||this.height},createSpriteImages:function(){this.spriteImages=[];for(var a=this._element.width/this.spriteWidth,b=this._element.height/this.spriteHeight,c=0;b>c;c++)for(i=0;i<a;i++)this.createSpriteImage(i,c)},createSpriteImage:function(a,b){var c=this.tmpCanvasEl.getContext("2d");c.clearRect(0,0,this.tmpCanvasEl.width,this.tmpCanvasEl.height),c.drawImage(this._element,-a*this.spriteWidth,-b*this.spriteHeight);var d=this.tmpCanvasEl.toDataURL("image/png"),e=fabric.util.createImage();e.src=d,this.spriteImages.push(e)},_render:function(a){a.drawImage(this.spriteImages[this.spriteIndex],-this.width/2,-this.height/2)},glow:function(){this.spriteIndex=1},rest:function(){this.spriteIndex=0},play:function(){return this.options.flash?void createjs.Tween.get(this,{loop:!0,override:!0}).call(this.rest.bind(this)).wait(1e3).call(this.glow.bind(this)).wait(200).call(this.rest.bind(this)).wait(100).call(this.glow.bind(this)).wait(200).call(this.rest.bind(this)):(this.canvas.on("object:moving",this.onMove.bind(this)),this.options.move&&(this.init(),180==this.angle?this.incX=-this.maxSpeed:this.incX=this.maxSpeed),void(this.animInterval=setInterval(this.update.bind(this),100)))},init:function(){this.initTop=this.top,this.prevX=this.left,this.prevY=this.top,this.number=0,this.maxSpeed=.4+Math.randomFloat(.2),this.maxWave=20+Math.randomFloat(20),Math.randomFloat(1)>=.5&&(this.maxWave*=-1),this.multiplier=0,fabric.Image.fromURL(location.toString().replace("index.html","").split("?")[0]+"assets/images/spider/spider-body.png",this.addTrace.bind(this))},addTrace:function(a){this.trace=new fabric.Trace(a,{}),this.trace.set({left:0,top:0,originX:"center",originY:"center"}),this.addTracePoint(),this.canvas.add(this.trace),this.canvas.add(this)},addTracePoint:function(){var a=40*Math.min(1,this.canvas.app.scaling.scale/window.devicePixelRatio),b=this.prevX-Math.cos(this.angle*Math.PI/180)*a,c=this.prevY-Math.sin(this.angle*Math.PI/180)*a;this.trace.addPoint(new fabric.Point(b,c))},update:function(){if(!this.canvas.app.gamePaused&&(this.spriteIndex++,this.spriteIndex===this.spriteImages.length&&(this.spriteIndex=0),this.options.move)){this.set({originX:"center",originY:"center"}),this.number+=this.multiplier;var a=this.left+this.incX,b=this.initTop+Math.sin(this.number*Math.PI/180)*this.maxWave,c=a-this.prevX,d=b-this.prevY,e=Math.atan2(d,c);this.set({left:a,top:b,angle:180*e/Math.PI}),this.left+.5*this.spriteWidth<=0?(this.incX=this.maxSpeed,this.set({scaleY:-this.scaleY})):this.left-.5*this.spriteWidth>=this.canvas.width&&(this.incX=-this.maxSpeed,this.set({scaleY:-this.scaleY})),this.setCoords(),this.multiplier+=.005,this.multiplier>=.5&&(this.multiplier=.5),this.prevX=a,this.prevY=b,this.addTracePoint()}},stop:function(){this.spriteIndex=0,createjs.Tween.removeTweens(this),clearInterval(this.animInterval)}}),fabric.Sprite.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b(new fabric.Sprite(a,c))})},fabric.Sprite.async=!0,fabric.Trace=fabric.util.createClass(fabric.Image,{type:"trace",initialize:function(a,b){this.options=b||{},this.callSuper("initialize",a,b),this._points=[]},reset:function(a){this._points=[]},addPoint:function(a){this._points.push(a)},_render:function(a){if(!(this._points.length<=0)){var b=this.canvas.viewportTransform,c=this._points[0],d=this._points[1];a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),a.lineCap="round",a.beginPath(),2===this._points.length&&c.x===d.x&&c.y===d.y&&(c.x-=.5,d.x+=.5),a.moveTo(c.x,c.y);for(var e=1,f=this._points.length;f>e;e++){var g=c.midPointFrom(d);a.quadraticCurveTo(c.x,c.y,g.x,g.y),c=this._points[e],d=this._points[e+1]}a.lineTo(c.x,c.y),a.strokeStyle="rgba(255, 255, 255, 0.24)",a.lineWidth=10*Math.min(1,this.canvas.app.scaling.scale/window.devicePixelRatio),a.stroke(),a.restore()}}}),fabric.Sprite.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b(new fabric.Sprite(a,c))})},fabric.Sprite.async=!0;var Constants={SecondsToMilliSeconds:1e3,Host:null,Spider:"spider",ArtBox:"art-box",StampsPath:"assets/images/stamps/",BrushesPath:"assets/images/brushes/",StickersPath:"assets/images/stickers/",CanvasesPath:"assets/images/canvases/",Direction:{Left:"left",Right:"right"},Tools:{Save:"Save",Reset:"Reset",Wand:"Wand",Eraser:"eraser",Mud:"mud",Berries:"berries",Mica:"mica",Stamp:"stamp",Brushes:"Brushes",Splats:"Splats",Stickers:"Stickers",AnimatedStickers:"animated-stickers",Canvases:"Canvases"},Colors:{Brown:"#8d5530",Green:"#588830",Blue:"#5A95C8",Yellow:"#F3DE78",LightBrown:"#e07d32",Red:"#FF0000",White:"#F2F2F2",Grey:"#666666",Black:"#1A1A1A",Color1:"#8B4511",Color2:"#A0522C",Color3:"#D0691E",Color4:"#D9A41F",Color5:"#DEB785",Color6:"#666664",Color7:"#333333",Color8:"#000000"},MudColors:[{name:"Color1",icon:"color1"},{name:"Color2",icon:"color2"},{name:"Color3",icon:"color3"},{name:"Color4",icon:"color4"},{name:"Color5",icon:"color5"},{name:"Color6",icon:"color6"},{name:"Color7",icon:"color7"},{name:"Color8",icon:"color8"}],ColorIcons:[{name:"Brown",icon:"color-brown"},{name:"Green",icon:"color-green"},{name:"Blue",icon:"color-blue"},{name:"Yellow",icon:"color-yellow"},{name:"LightBrown",icon:"color-brown-light"},{name:"Red",icon:"color-red"},{name:"Grey",icon:"color-grey"},{name:"White",icon:"color-white"},{name:"Black",icon:"color-black"}],Brushes:[{name:"crayon",image:"crayon",icon:"crayon-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_Crayon_Hal",ename:"crayon"},{name:"nature",image:"lilac",icon:"lilac-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_Lilac_Hal",ename:"lilac"},{name:"nature",image:"feathers",icon:"feathers-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_Feather_Hal",ename:"feathers"},{name:"nature",image:"fiddle-ferns",anchorY:.33,icon:"fiddle-ferns-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_FiddleheadFern_Hal",ename:"fiddle ferns"},{name:"nature",image:"grass",icon:"grass-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_Grass_Hal",ename:"grass"},{name:"nature",image:"leaves",anchorY:.45,icon:"leaves-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_Leaf_Hal",ename:"leaves"},{name:"nature",image:"dandelion",icon:"dandelion-icon",vo:"NAB_Toolbar_Brush_Crayon_Rollover_Dandelion_Hal",ename:"dandelion"}],Splats:[{name:"mud",icon:"mud-icon",vo:"NAB_Toolbar_Mud_Berries_Rollover_Mud_Hal",ename:"mud"},{name:"berries",icon:"berries-icon",vo:"NAB_Toolbar_Mud_Berries_Rollover_Berries_Hal",ename:"berries"},{name:"stamp",icon:"Icon-AppleSeed",images:["AppleSeed01","AppleSeed02","AppleSeed03","AppleSeed04","AppleSeed05"],spreadDistance:100,vo:"NAB_Toolbar_Mud_Berries_Rollover_Seeds_Hal",ename:"apple seeds"},{name:"stamp",icon:"Icon-Milkweed",images:["Milkweed01","Milkweed02","Milkweed03","Milkweed04"],spreadDistance:120,vo:"NAB_Toolbar_Mud_Berries_Rollover_Seeds_Hal",ename:"milkweed seeds",sfx:["Feather_And_Dandelion_Pods_A","Feather_And_Dandelion_Pods_B","Feather_And_Dandelion_Pods_C","Feather_And_Dandelion_Pods_D"]},{name:"stamp",icon:"Icon-Seeds",images:["Seed01","Seed02","Seed03","Seed04","Seed05","Seed06","Seed07","Seed08","Seed09"],spreadDistance:100,vo:"NAB_Toolbar_Mud_Berries_Rollover_Seeds_Hal",ename:"seeds"},{name:"stamp",icon:"Icon-MesquiteSeeds",images:["Mesquite01","Mesquite02","Mesquite03","Mesquite04"],spreadDistance:100,vo:"NAB_Toolbar_Mud_Berries_Rollover_Seeds_Hal",ename:"mesquite seeds"},{name:"stamp",icon:"Icon-MapleSeeds",images:["MapleSeed01","MapleSeed02","MapleSeed03","MapleSeed04"],spreadDistance:100,vo:"NAB_Toolbar_Mud_Berries_Rollover_Seeds_Hal",ename:"maple seeds"},{name:"stamp",icon:"Icon-BluePetals",images:["BluePetal01","BluePetal02","BluePetal03","BluePetal04"],spreadDistance:100,ename:"blue petals",vo:"NAB_Toolbar_Mud_Berries_Rollover_Flower",sfx:["Feather_Flower_1","Feather_Flower_2","Feather_Flower_3","Feather_Flower_4","Feather_Flower_5"]},{name:"stamp",icon:"Icon-YellowPetals",images:["YellowPetal01","YellowPetal02","YellowPetal03","YellowPetal04","YellowPetal05"],spreadDistance:100,ename:"yellow petals",vo:"NAB_Toolbar_Mud_Berries_Rollover_Flower",sfx:["Feather_Flower_1","Feather_Flower_2","Feather_Flower_3","Feather_Flower_4","Feather_Flower_5"]},{name:"stamp",icon:"Icon-PinkPetals",images:["PinkPetal01","PinkPetal02","PinkPetal03","PinkPetal04","PinkPetal05"],spreadDistance:80,ename:"pink petals",vo:"NAB_Toolbar_Mud_Berries_Rollover_Flower",sfx:["Feather_Flower_1","Feather_Flower_2","Feather_Flower_3","Feather_Flower_4","Feather_Flower_5"]},{name:"stamp",minToss:2,maxToss:4,tossTime:.1,spreadDistance:200,icon:"Icon-Feathers",vo:"NAB_Toolbar_Mud_Berries_Rollover_Feathers_Hal",images:["Feather01","Feather02","Feather03","Feather04"],ename:"feather",sfx:["Feather_Flower_1","Feather_Flower_2","Feather_Flower_3","Feather_Flower_4","Feather_Flower_5"]},{name:"stamp",minToss:3,maxToss:6,tossTime:.1,spreadDistance:150,icon:"Icon-Leaves",images:["Leaf01","Leaf02","Leaf03","Leaf04","Leaf05","Leaf06"],vo:"NAB_Toolbar_Mud_Berries_Rollover_Leaves_Hal",ename:"leaf"},{name:"stamp",icon:"Icon-Kelp",images:["Kelp01","Kelp02","Kelp03","Kelp04","Kelp05"],spreadDistance:100,ename:"kelp"}],Stickers:[{name:"001-NatureCat"},{name:"002-Hal"},{name:"004-Daisy"},{name:"005-Squeeks"},{name:"006-LadybugWhisperer"},{name:"007-ZeWormWhisperer"},{name:"008-Ronald"},{name:"009-Houston"},{name:"010-Vole"},{name:"011-Squirrel"},{name:"012-WoolyBear"},{name:"013-Worm"},{name:"014-PineConePerson1"},{name:"015-PineConePerson2"},{name:"016-PineConePerson3"},{name:"017-PineConePerson4"},{name:"018-Bone"},{name:"019-MrChewinski"},{name:"020-MrsChewinski"},{name:"021-Cheese"},{name:"022-Carrot"},{name:"023-Duck"},{name:"024-Flamingo"},{name:"025-Blackbird"},{name:"026-Warbler"},{name:"027-Woodpecker"},{name:"028-Oriole"},{name:"029-Chickadee"},{name:"030-Frog1"},{name:"031-Frog2"},{name:"032-Frog4"},{name:"033-Frog3"},{name:"034-Frog5"},{name:"035-Frog6"},{name:"036-LadyBug"},{name:"037-Cicada"},{name:"038-Spider1"},{name:"039-Spider2"},{name:"040-Sun"},{name:"041-Acorn"},{name:"042-Pinecone"},{name:"043-Fern"},{name:"044-Flower1"},{name:"045-Flower3"},{name:"046-Flower4"},{name:"047-Flower2"},{name:"048-Flower5"},{name:"049-Flower6"},{name:"050-Tree1"},{name:"051-Tree2"},{name:"052-Tree3"},{name:"053-Tree4"},{name:"054-Tree5"},{name:"055-Mushroom1"},{name:"056-Mushroom2"},{name:"057-Mushroom3"},{name:"058-Mushroom4"},{name:"059-Stick1"},{name:"060-Stick2"},{name:"061-Stick3"}],Canvases:[{name:"grass",icon:"grass",vo:"NAB_Toolbar_Backgrounds_Grass_NC",ename:"grass"},{name:"bark",icon:"bark",ename:"bark",vo:"NAB_Toolbar_Backgrounds_Light_Tree_bark_NC"},{name:"dark-bark",icon:"dark-bark",ename:"dark bark",vo:"NAB_Toolbar_Backgrounds_Moss_NC"},{name:"paper",icon:"paper",vo:"NAB_Toolbar_Backgrounds_Paper_NC",ename:"paper"},{name:"sand",icon:"sand",vo:"NAB_Toolbar_Backgrounds_Sand_NC",ename:"sand"},{name:"rock",icon:"rock",vo:"NAB_Toolbar_Backgrounds_Slate_NC",ename:"rock"},{name:"birch-bark",icon:"birch-bark",ename:"birch bark",vo:"NAB_Toolbar_Backgrounds_Birch_bark_NC"},{name:"weed",icon:"weed",vo:"NAB_Toolbar_Backgrounds_Wood_NC",ename:"weed"}],Wand:[{name:"spider",ename:"spider",icon:"spider-icon"},{name:"mica",icon:"Mica_Icon",ename:"mica",images:["MicaFlake-1","MicaFlake-2","MicaFlake-3","MicaFlake-4","MicaFlake-5","MicaFlake-6","MicaFlake-7","MicaFlake-8","MicaFlake-9","MicaFlake-10","MicaFlake-11","MicaFlake-12"],spreadDistance:120},{name:"animated-stickers",icon:"Butterfly-01-icon",spriteSheet:"butterfly-01",ename:"butterfly 01",width:530,height:290,scale:1},{name:"animated-stickers",icon:"Butterfly-02-icon",spriteSheet:"butterfly-02",ename:"butterfly 02",width:400,height:290},{name:"animated-stickers",icon:"LightningBug-icon",spriteSheet:"lightning-bug",ename:"lightning bug",width:218,height:323,flash:!0},{name:"animated-stickers",icon:"Snail-icon",spriteSheet:"snail",ename:"snail",width:250,height:120,move:!0}],tutorialVOs:["NAB_Tutorial_1_NC","NAB_Pop_In_Toolbar_Backgrounds_Intro_NC","NAB_Art_Box_Cover_1_NC","NAB_Pop_In_Animation_Stickers_Squeeks","NAB_Pop_In_Animation_Options_Tool_Bar_Daisy","NAB_Pop_In_Animation_Toolbar_Mud_Betters_Hal","NAB_Tutorial_Options_Tool_Bar_2_Daisy"]};namespace("nature_art_box").Constants=Constants;var BerriesSplat=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a,b){this.canvas=a,this.aspectRatio=1;var c=b.images;this.imageElements=[];var d=location.toString().replace("index.html","").split("?")[0];c=[d+"assets/images/berries/splat1.png",d+"assets/images/berries/splat2.png",d+"assets/images/berries/splat3.png",d+"assets/images/berries/splat4.png",d+"assets/images/berries/splat5.png"];for(var e=0;e<c.length;e++)this.loadImage(c[e])},loadImage:function(a){var b=new Image;b.onload=this.onLoadImage.bind(this,b),b.src=a},onLoadImage:function(a){this.imageElements.push(a)},stampBerries:function(a){var b=new fabric.Image.filters.Tint({color:this.color,opacity:.7}),c=.1,d=new fabric.Image(this.imageElements.random(),{angle:Math.randomFloat(360),originX:"center",originY:"center",left:a.x,top:a.y,scaleX:c,scaleY:c});d.filters.push(b),d.applyFilters(this.canvas.renderAll.bind(this.canvas)),this.canvas.add(d),this.canvas.renderAll.bind(this.canvas),this.animate(d),this.canvas.app.sound.play("Berries_"+["A","B","C","D"].shuffle()[0])},animate:function(a){a.set({opacity:0}),a.scale(.1),this.canvas.add(a);var b=Math.max(.5,.01*this.width)*Math.min(1,this.canvas.app.scaling.scale/fabric.devicePixelRatio);a.animate({scaleX:b,scaleY:b,opacity:1},{onChange:this.canvas.renderAll.bind(this.canvas),duration:100,easing:fabric.util.ease.easeOutQuad,onComplete:this.onComplete.bind(this)})},onComplete:function(){this.canvas.trigger("draw:complete")},onMouseDown:function(a){this.stampBerries(a)},onMouseMove:function(a){},onMouseUp:function(){}}),CrayonBrush=fabric.util.createClass(fabric.PencilBrush,{initialize:function(a){this.callSuper("initialize",a)},onMouseDown:function(a){a.x=a.x,a.y=a.y,this.callSuper("onMouseDown",a)},onMouseMove:function(a){a.x=a.x,a.y=a.y,this.callSuper("onMouseMove",a)},onMouseUp:function(){this.callSuper("onMouseUp"),this.canvas.trigger("draw:complete")}}),Mica=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a,b){this.sparkles=[],this.minScale=.8,this.onTap=!1,this.tossTime=.05,this.maxTossTime=1,this.totalElaspedTime=0,this.elaspedTime=0,this.distance=b.spreadDistance,this.handleTick=this.handleTick.bind(this),this.pointer=null,this.canvas=a,this.aspectRatio=1;var c=b.images;this.imageElements=[],this.shuffle(c);for(var d=0;d<c.length;d++)this.loadImage(c[d]);this.loadSparkleImage()},shuffle:function(a){var b,c,d;for(d=a.length;d;d--)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},loadImage:function(a){var b=new Image;b.onload=this.onLoadImage.bind(this,b),b.src=a},onLoadImage:function(a){this.imageElements.push(a)},tossSeeds:function(a,b){for(var c=Math.min(1,this.canvas.app.scaling.scale/window.devicePixelRatio),d=this.distance*c,e=.5*d,f=a.x,g=a.y,h=0;b>h;h++){var i=this.imageElements.random();this.aspectRatio=i.width/i.height;var j=f+e-Math.random()*d,k=g+e-Math.random()*d;width=Math.min(i.width*c,i.width),height=Math.min(i.height*c,i.height);var l=Math.randomFloat(2*Math.PI);this.canvas.contextTop.translate(j,k),this.canvas.contextTop.rotate(l),this.canvas.contextTop.drawImage(i,-width/2,-height/2,width,height),this.canvas.contextTop.rotate(-l),this.canvas.contextTop.translate(-j,-k)}this.canvas.app.sound.play("Mica_"+["A","B","C","D"].shuffle()[0]),this.addSparkles(f,g,e,d)},handleTick:function(a){if(this.onTap){var b=.001*a.delta;return this.elaspedTime+=b,this.totalElaspedTime+=b,this.totalElaspedTime>=this.maxTossTime?(this.elaspedTime=0,this.totalElaspedTime=0,void this.onMouseUp()):void(this.elaspedTime>=this.tossTime&&(this.elaspedTime=0,this.tossSeeds(this.pointer,12)))}},onMouseDown:function(a){this.pointer=a,this.onTap=!0,this.elaspedTime=0,this.totalElaspedTime=0,this.tossSeeds(a,18),createjs.Ticker.addEventListener("tick",this.handleTick)},onMouseMove:function(a){this.pointer=a},onMouseUp:function(){this.onTap&&(this.onTap=!1,createjs.Ticker.removeEventListener("tick",this.handleTick),this.canvas.trigger("draw:complete"))},loadSparkleImage:function(){var a=location.toString().replace("index.html","").split("?")[0]+"assets/images/sparkle.png",b=new Image;b.onload=function(a){this.sparkleElement=a}.bind(this,b),b.src=a},addFlattenSparkles:function(a,b){for(var c=Math.min(1,this.canvas.app.scaling.scale/window.devicePixelRatio),d=this.distance*c,e=.5*d,f=0;b>f;f++){var g=this.sparkleElement;this.aspectRatio=g.width/g.height;var h=a.x+e-Math.random()*d,i=a.y+e-Math.random()*d;width=Math.min(g.width*c,g.width),height=Math.min(g.height*c,g.height);var j=Math.randomFloat(2*Math.PI);this.canvas.contextTop.translate(h,i),this.canvas.contextTop.rotate(j),this.canvas.contextTop.drawImage(g,-width/2,-height/2,width,height),this.canvas.contextTop.rotate(-j),this.canvas.contextTop.translate(-h,-i)}},addSparkles:function(a,b,c,d){for(var e=0;2>e;e++){var f=new fabric.Image(this.sparkleElement,{originX:"center",originY:"center",top:b+c-Math.random()*d,left:a+c-Math.random()*d});this.canvas.add(f),f.angMult=2-4*Math.random(),f.alphaMult=.05*Math.random(),f.name="sparkle",this.canvas.renderAll.bind(this.canvas)}},bringToFront:function(){for(var a=this.sparkles.length-1;a>=0;a--){var b=this.sparkles[a];b.bringToFront(),this.sparkles.splice(a,1)}}}),MudBrush=fabric.util.createClass(fabric.BaseBrush,{imageElements:[],initialize:function(a,b){if(this.canvas=a,this.aspectRatio=1,!(this.imageElements.length>0)){var c=b.images,d=location.toString().replace("index.html","").split("?")[0];c=[d+"assets/images/splatters/splat1.png",d+"assets/images/splatters/splat2.png",d+"assets/images/splatters/splat3.png",d+"assets/images/splatters/splat4.png",d+"assets/images/splatters/splat5.png",d+"assets/images/splatters/splat6.png",d+"assets/images/splatters/splat7.png",d+"assets/images/splatters/splat8.png",d+"assets/images/splatters/splat9.png",d+"assets/images/splatters/splat10.png",d+"assets/images/splatters/splat11.png",d+"assets/images/splatters/splat12.png",d+"assets/images/splatters/splat13.png",d+"assets/images/splatters/splat14.png"];for(var e=0;e<c.length;e++)this.loadImage(c[e])}},onLoadImage:function(a){this.imageElements.push(a)},loadImage:function(a){var b=new Image;b.onload=this.onLoadImage.bind(this,b),b.src=a},createRandomBitmap:function(a){this.tempCanvas&&this.context.clearRect(0,0,this.tempCanvas.width,this.tempCanvas.height);for(var b=0;a>b;b++)this.createBitmap();var c=this.getRgbColor(this.color),d=this.context.getImageData(0,0,this.tempCanvas.width,this.tempCanvas.height);for(b=0;b<d.data.length;b+=4)d.data[b]=c[0],d.data[b+1]=c[1],d.data[b+2]=c[2];this.context.clearRect(0,0,this.tempCanvas.width,this.tempCanvas.height),this.context.putImageData(d,0,0),this.bitmap=this.tempCanvas,this.aspectRatio=this.tempCanvas.width/this.tempCanvas.height},createBitmap:function(){var a=this.imageElements.random();this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCanvas.width=a.width,this.tempCanvas.height=a.height,this.context=this.tempCanvas.getContext("2d"));var b=this.tempCanvas.width/2,c=this.tempCanvas.height/2,d=this.tempCanvas.width,e=this.tempCanvas.height,f=Math.randomFloat(2*Math.PI);this.context.translate(b,c),this.context.rotate(f),this.context.drawImage(a,-d/2,-e/2,d,e),this.context.rotate(-f),this.context.translate(-b,-c)},getRgbColor:function(a){if(!this.colorContext){var b=document.createElement("canvas");b.width=1,b.height=1,this.colorContext=b.getContext("2d")}return this.colorContext.fillStyle=a,this.colorContext.fillRect(0,0,1,1),this.colorContext.getImageData(0,0,1,1).data},stampImage:function(a){if(this.bitmap){var b=new fabric.Image(this.bitmap),c=.8*Math.min(.01*this.width,Math.min(1,this.canvas.app.scaling.scale/window.devicePixelRatio));b.set({selectable:!1,originX:"center",originY:"center",top:a.y,left:a.x,angle:Math.randomFloat(360),scaleX:c,scaleY:c,maxScale:c}),this.canvas.add(b),this.animate(b),this.canvas.app.sound.play("Mud_"+["A","B","C","D"].shuffle()[0])}},onMouseDown:function(a){this.canvas.contextTop.fillStyle=this.color,this.createRandomBitmap(10),this.stampImage(a)},onMouseMove:function(a){},onMouseUp:function(){},animate:function(a){a.set({opacity:0}),a.scale(.1),this.canvas.add(a),a.animate({scaleX:a.maxScale,scaleY:a.maxScale,opacity:1},{onChange:this.canvas.renderAll.bind(this.canvas),duration:100,easing:fabric.util.ease.easeOutQuad,onComplete:this.onComplete.bind(this)})},onComplete:function(){this.canvas.trigger("draw:complete")},applyFilter:function(a){var b=new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]});a.filters.push(b),a.applyFilters(this.canvas.renderAll.bind(this.canvas)),this.canvas.add(a)}}),NatureBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a,b){this.canvas=a,this.aspectRatio=1,this.lastMousePoint=new fabric.Point(0,0),this.nextMousePoint=new fabric.Point(0,0),this.loadImage(b.image)},loadImage:function(a){var b=new Image;b.onload=this.createBitmap.bind(this,b),b.src=a},createBitmap:function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);for(var d=this.getRgbColor(this.color),e=c.getImageData(0,0,a.width,a.height),f=0;f<e.data.length;f+=4)e.data[f]=d[0],e.data[f+1]=d[1],e.data[f+2]=d[2];c.clearRect(0,0,a.width,a.height),c.putImageData(e,0,0),this.bitmap=b,this.aspectRatio=a.width/a.height,a.removeAttribute("src"),a=null},getRgbColor:function(a){var b=document.createElement("canvas");b.width=1,b.height=1;var c=b.getContext("2d");return c.fillStyle=a,c.fillRect(0,0,1,1),c.getImageData(0,0,1,1).data},stampImage:function(a){if(this.bitmap){var b=this.width*Math.min(1,this.canvas.app.scaling.scale/window.devicePixelRatio),c=2*b,d=b/this.aspectRatio*2,e=a.x-c/2,f=a.y-d/2;this.canvas.contextTop.drawImage(this.bitmap,e,f,c,d)}},drawPoints:function(a){for(var b=0;b<a.length;b++)this.stampImage(a[b])},onMouseDown:function(a){this.canvas.contextTop.fillStyle=this.color,this.lastMousePoint.x=a.x,this.lastMousePoint.y=a.y,this.drawPoints([this.lastMousePoint])},onMouseMove:function(a){this.nextMousePoint.x=a.x,this.nextMousePoint.y=a.y,this.drawPoints(this.getLine(this.lastMousePoint.x,this.lastMousePoint.y,this.nextMousePoint.x,this.nextMousePoint.y)),this.lastMousePoint.x=this.nextMousePoint.x,this.lastMousePoint.y=this.nextMousePoint.y},onMouseUp:function(){this.canvas.trigger("draw:complete")},getLine:function(a,b,c,d){var e,f,g,h,i,j=[];if(e=c-a,f=d-b,g=e>0?1:-1,h=f>0?1:-1,e=Math.abs(e),f=Math.abs(f),e>=f)for(f<<=1,i=f-e,e<<=1;g>0?c>=a:a>=c;)j.push(new fabric.Point(a,b)),i>=0&&(b+=h,i-=e),i+=f,a+=g;else for(e<<=1,i=e-f,f<<=1;h>0?d>=b:b>=d;)j.push(new fabric.Point(a,b)),i>=0&&(a+=g,i-=f),i+=e,b+=h;return j.push(new fabric.Point(a,b)),j}}),Stamp=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a,b){this.onTap=!1,this.minScale=.8,this.tossTime=b.config.tossTime||.05,this.maxTossTime=b.config.maxTossTime||1,this.minToss=b.config.minToss||3,this.maxToss=b.config.maxToss||10,this.totalElaspedTime=0,this.elaspedTime=0,this.distance=b.spreadDistance,this.handleTick=this.handleTick.bind(this),this.pointer=null,this.canvas=a,this.aspectRatio=1,this.options=b;var c=b.images;if(this.imageElements=[],this.shuffle(c),this.imageElements.length<=0)for(var d=0;d<c.length;d++)this.loadImage(c[d])},shuffle:function(a){var b,c,d;for(d=a.length;d;d--)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},loadImage:function(a){var b=new Image;b.onload=this.onLoadImage.bind(this,b),b.src=a},onLoadImage:function(a){this.imageElements.push(a)},tossSeeds:function(a,b){if(this.imageElements&&!(this.imageElements.length<=0)){for(var c=a.x,d=a.y,e=Math.min(1,this.canvas.app.scaling.scale/fabric.devicePixelRatio),f=0;b>f;f++){var g=this.imageElements.random();this.aspectRatio=g.width/g.height;var h=this.distance*e,i=.5*h,j=c+i-Math.random()*h,k=d+i-Math.random()*h;width=Math.min(g.width*e,g.width),height=Math.min(g.height*e,g.height);var l=Math.randomFloat(2*Math.PI);this.canvas.contextTop.translate(j,k),this.canvas.contextTop.rotate(l),this.canvas.contextTop.drawImage(g,-width/2,-height/2,width,height),this.canvas.contextTop.rotate(-l),this.canvas.contextTop.translate(-j,-k)}this.options.config.sfx?this.canvas.app.sound.play(this.options.config.sfx.shuffle()[0]):this.canvas.app.sound.play("Seeds_"+["A","B","C","D","E"].shuffle()[0])}},handleTick:function(a){var b=.001*a.delta;return this.elaspedTime+=b,this.totalElaspedTime+=b,this.totalElaspedTime>=this.maxTossTime?(this.elaspedTime=0,this.totalElaspedTime=0,void this.onMouseUp()):void(this.elaspedTime>=this.tossTime&&(this.elaspedTime=0,this.tossSeeds(this.pointer,this.minToss)))},onMouseDown:function(a){this.onTap=!0,this.elaspedTime=0,this.totalElaspedTime=0,this.tossSeeds(a,this.maxToss),createjs.Ticker.addEventListener("tick",this.handleTick),this.pointer=a},onMouseMove:function(a){this.pointer=a},onMouseUp:function(){this.onTap&&(createjs.Ticker.removeEventListener("tick",this.handleTick),this.onTap=!1,this.canvas.trigger("draw:complete"))}});!function(){var a=include("PIXI.Sprite"),b=function(b){this.panel=b,this.app=b.app,a.call(this,this.app.getCache("arrow")),this.anchor.set(1,1),this.scale.set(-1,1)},c=extend(b,a);c.show=function(a,b,c,d,e,f){this.clear(),f=f||250,c=c||0,d=d||0,e=e||0,this.x=a,this.y=b,this.rotation=e*Math.PI/180,createjs.Tween.get(this,{loop:!0,override:!0}).to({x:a+c,y:b+d},f,createjs.Ease.linear).to({x:a,y:b},f,createjs.Ease.linear)},c.clear=function(){createjs.Tween.removeTweens(this)},namespace("nature_art_box").Arrow=b}(),function(){var a=include("springroll.pixi.Button"),b=function(b,c,d,e){a.call(this,c,d,e),this.app=b,this.on("buttonOver",this.onOver),this.on("buttonOut",this.buttonOut),this.on("buttonPress",this.onPress)},c=a.prototype,d=extend(b,a);d.onOver=function(){this.app.sound.isPlaying("ButtonRollover")||this.app.sound.play("ButtonRollover")},d.onPress=function(){this.app.sound.play("ButtonClick")},d.buttonOut=function(){this.rotation=0},d.destroy=function(){this.off("buttonOver",this.onOver),this.off("buttonOut",this.buttonOut),this.off("buttonPress",this.onPress),c.destroy.call(this),this.app=null},namespace("nature_art_box").CustomButton=b}(),function(){var a=include("PIXI.Container"),b=function(b){this.app=b,a.call(this),this.init()},c=extend(b,a);c.init=function(){},namespace("nature_art_box").Scroller=b}(),function(){var a=include("PIXI.Container"),b=include("nature_art_box.Constants"),c=function(b){this.app=b,a.call(this),this.signal=new springroll.EventDispatcher,this.onDown=this.onDown.bind(this),this.onOver=this.onOver.bind(this),this.onUp=this.onUp.bind(this),this.onMove=this.onMove.bind(this),this.maxMove=100,this.startSize=30,this.init()},d=extend(c,a);c.ON_BRUSH_SIZE_CHANGE="brush-size-change",c.ON_OVER="over",d.init=function(){this.atlas=this.app.getCache("ui-atlas"),this.bg=new PIXI.Sprite(this.atlas.getFrame("slider-bg")),this.bg.anchor.set(.5,0),this.bg.y=-156,this.addChild(this.bg),this.colorIcons=new PIXI.Sprite(this.atlas.getFrame("slider-color-icons")),this.colorIcons.anchor.set(.5,0),this.colorIcons.y=-156,this.addChild(this.colorIcons),this.colorChange(b.Colors.Black),this.handle=new PIXI.Sprite(this.atlas.getFrame("slider-handle")),this.handle.anchor.set(.5),this.handle.x=2,this.handle.y=-this.startSize,this.addChild(this.handle),this.handle.interactive=!0,this.handle.buttonMode=!0,this.handle.hitArea=new PIXI.Rectangle(-50,-50,100,100),this.interactive=!0,this.on("mouseover",this.onOver),this.on("mousedown",this.onDown),this.on("touchstart",this.onDown),this.on("mouseup",this.onUp),this.on("touchend",this.onUp),this.on("mouseupoutside",this.onUp),this.on("touchendoutside",this.onUp)},d.colorChange=function(a){this.colorIcons.tint=a.replace("#","0x")},d.onOver=function(a){this.signal.trigger("onCallBack",{type:c.ON_OVER})},d.onDown=function(a){this.onMove(a),this.on("mousemove",this.onMove),this.on("touchmove",this.onMove),this.app.sizeDrawn&&(this.app.sizeDrawn=!1,this.app.trackEvent("Tool","Size Slider"))},d.onMove=function(a){this.input=this.toLocal(a.data.global);var b=this.input.y;this.input.y>0?b=0:this.input.y<-this.maxMove&&(b=-this.maxMove),this.handle.y=b,this.app.sound.isPlaying("UI_Slider_Move")||this.app.sound.play("UI_Slider_Move")},d.onUp=function(){this.off("mousemove",this.onMove),this.off("touchmove",this.onMove);var a=this.handle.y;a=10*Math.floor(.1*-a),this.signal.trigger("onCallBack",{type:c.ON_BRUSH_SIZE_CHANGE,size:0>=a?1:a})},namespace("nature_art_box").Slider=c}(),function(){var a=include("PIXI.Container"),b=function(b,c){a.call(this),this.app=b,this.styles=c,this._init(),this.update=this.update.bind(this),this.resize=this.resize.bind(this),this.signal=new springroll.EventDispatcher,this.setup()},c=extend(b,a);c._init=function(){var a=document.getElementById("content");this.element=document.createElement("canvas"),this.element.style||(this.element.style={}),fabric.util.setStyle(this.element,{position:"absolute",width:this.styles.width+"px",height:this.styles.height+"px","z-index":this.styles["z-index"]}),fabric.util.addClass(this.element,this.styles["class"]),a.appendChild(this.element),this.renderer=PIXI.autoDetectRenderer(this.styles.width,this.styles.height,{view:this.element,ratio:1,clearView:!0,transparent:!0,antiAlias:!0})},c.setup=function(){this.addEventListeners(),this.resize(this.app.realWidth,this.app.realHeight)},c.addEventListeners=function(){this.app.on("update",this.update),this.app.on("resize",this.resize)},c.removeEventListeners=function(){this.app.off("update",this.update),this.app.off("resize",this.resize)},c.resize=function(a,b){},c.clear=function(){this.removeEventListeners(),this.renderer.destroy(),this.renderer=null;var a=document.getElementById("content");a.removeChild(this.element),this.element=null},c.update=function(){this.renderer&&this.renderer.render(this)},namespace("nature_art_box").PIXICanvasElement=b}(),function(){var a=include("nature_art_box.PIXICanvasElement"),b=include("nature_art_box.Constants"),c=include("nature_art_box.Slider"),d=include("springroll.pixi.Button"),e=function(b,c){this.onColorSelect=this.onColorSelect.bind(this),this.onItemOver=this.onItemOver.bind(this),this.onToggleSlide=this.onToggleSlide.bind(this),a.call(this,b,c),this.mode=null},f=extend(e,a),g=a.prototype;e.Mode={EMBOSS_ICONS:"emboss_icons",FLAT_ICONS:"flat_icons"},e.ON_COLOR_CHANGE="color-change",e.ON_OVER="over",f.setup=function(){this.styles.right=-12,this.styles.top=60,this.styles.translateX=70,this.atlas=this.app.getCache("ui-atlas"),this.bg=new PIXI.Sprite(this.atlas.getFrame("color-picker-bg")),this.addChild(this.bg),this.slider=new c(this.app),this.slider.x=48,this.slider.y=595,this.addChild(this.slider),this.addEmbossIcons(),this.addFlatIcons(),this.switchMode(e.Mode.EMBOSS_ICONS),g.setup.call(this),this.slideIn=!1,this.element.style.setProperty("transform","translate("+this.styles.newTranslateX+"px)")},f.onItemOver=function(){this.signal.trigger("onCallBack",{type:e.ON_OVER})},f.addFlatIcons=function(){this.flatIcons=new PIXI.Container,this.flatIcons.x=-24,this.addChild(this.flatIcons);for(var a=6,c=26,d=0;d<b.MudColors.length;d++){var e=b.MudColors[d],f=this.getIconButton(e.name,e.icon,70,0);f.index=d+1,f.y=a+c,a=f.y+c,f.on("buttonPress",this.onColorSelect),f.on("buttonOver",this.onItemOver),this.flatIcons.addChild(f)}},f.addEmbossIcons=function(){
this.embossIcons=new PIXI.Container,this.embossIcons.x=-24,this.addChild(this.embossIcons);for(var a=6,c=24,d=0;d<b.ColorIcons.length;d++){var e=b.ColorIcons[d],f=this.getIconButton(e.name,e.icon,70,0);f.index=d+1,f.y=a+c,a=f.y+c,f.on("buttonPress",this.onColorSelect),f.on("buttonOver",this.onItemOver),this.embossIcons.addChild(f)}},f.takeSnap=function(){this.snap={colors:this.colorsEnabled,slider:this.silderEnabled}},f.applySnap=function(){this.snap&&(this.snap.colors?this.enableColors():this.disableColors(),this.snap.slider?this.enableSlider():this.disableSlider())},f.enableColors=function(){this.colorsEnabled=!0,this.toggle(this.embossIcons,!0,1),this.toggle(this.flatIcons,!0,1)},f.disableColors=function(){this.colorsEnabled=!1,this.toggle(this.embossIcons,!1,.25),this.toggle(this.flatIcons,!1,.25)},f.toggle=function(a,b,c){a.alpha=c,a.interactive=b,a.interactiveChildren=b},f.disableSlider=function(){this.silderEnabled=!1,this.toggle(this.slider,!1,.25)},f.enableSlider=function(){this.silderEnabled=!0,this.toggle(this.slider,!0,1)},f.switchMode=function(a){this.mode!=a&&(a==e.Mode.EMBOSS_ICONS?(this.flatIcons.visible=!1,this.flatIcons.interactiveChildren=!1,this.embossIcons.visible=!0,this.embossIcons.interactiveChildren=!0,this.checkColorMode(b.ColorIcons)||(this.onColorSelect({name:"Brown"}),this.highlightButton(this.embossIcons.getChildAt(0)))):a==e.Mode.FLAT_ICONS&&(this.flatIcons.visible=!0,this.flatIcons.interactiveChildren=!0,this.embossIcons.visible=!1,this.embossIcons.interactiveChildren=!1,this.checkColorMode(b.MudColors)||(this.onColorSelect({name:"Color1"}),this.highlightButton(this.flatIcons.getChildAt(0)))),this.mode=a)},f.checkColorMode=function(a){var b=0,c=a.length;for(b=0;c>b;b++)if(a[b].name==this.colorSelected)return!0;return!1},f.getIconButton=function(a,b,c,e){var f=this.atlas.getFrame(b),g=this.atlas.getFrame(b+"-highlight"),h=new d({up:f,down:g,over:g,highlighted:g,priority:["highlighted","disabled","down","over","selected","up"]});return h.name=a,h.hHeight=.5*f.height,h.pivot=new PIXI.Point(.5*f.width,h.hHeight),h.x=c,h.y=e,h},f.addEventListeners=function(){g.addEventListeners.call(this)},f.removeEventListeners=function(){g.removeEventListeners.call(this)},f.highlightButton=function(a){this.prevHighlightedButton&&(this.prevHighlightedButton.highlighted=!1),a.highlighted=!0,this.prevHighlightedButton=a},f.onColorSelect=function(a){a instanceof d&&this.highlightButton(a),a.name||(a=a.target),a.index>-1&&this.app.sound.play("UI_Color_Choice_"+a.index);var c=b.Colors[a.name];this.signal.trigger("onCallBack",{type:e.ON_COLOR_CHANGE,color:c}),this.colorSelected=a.name,this.slider.colorChange(c)},f.onToggleSlide=function(){this.toggleSlide(!this.slideIn)},f.toggleSlide=function(a){if(!this.sliding&&this.slideIn!=a&&a){this.sliding=!0,this.slideIn=a;var b={x:0,newX:this.styles.newTranslateX};this.slideIn&&(b={x:this.styles.newTranslateX,newX:0});var c=createjs.Tween.get(b,{loop:!1}).to({x:b.newX},350,createjs.Ease.quadOut).call(this.sildeComplete.bind(this));c.addEventListener("change",this.slideUpdate.bind(this)),this.slideIn?this.app.sound.play("UI_Side_Drawer_Open_1"):this.app.sound.play("UI_Side_Drawer_Close_1")}},f.slideUpdate=function(a){this.element.style.setProperty("transform","translate("+a.target.target.x+"px)")},f.sildeComplete=function(){this.sliding=!1},f.applyStyles=function(a,b,c,d,e){fabric.util.setStyle(this.element,{width:a+"px",height:b+"px",top:c+"px",right:d+"px",transform:"translate("+e+"px)"})},f.resize=function(a,b){a=this.app.realWidth,b=this.app.realHeight;var c=this.app.scaling.size.width/this.app.scaling.size.height,d=a/b,e=d>c?b/this.app.scaling.size.height:a/this.app.scaling.size.width,f=this.styles.width*e,g=this.styles.height*e,h=this.styles.top*e,i=this.styles.right*e,j=this.styles.translateX*e;this.styles.newTranslateX=j,this.applyStyles(f,g,h,i,0)},namespace("nature_art_box").ColorPicker=e}(),function(){var a=include("nature_art_box.PIXICanvasElement"),b=include("springroll.pixi.Button"),c=function(b,c){this.onReset=this.onReset.bind(this),this.onSave=this.onSave.bind(this),this.onToggleSlide=this.onToggleSlide.bind(this),this.onBrushesSelect=this.onBrushesSelect.bind(this),this.onBrushSelect=this.onBrushSelect.bind(this),this.onItemOver=this.onItemOver.bind(this),a.call(this,b,c)},d=extend(c,a),e=a.prototype;c.ON_BRUSHES_SELECT="brushes-select",c.ON_BRUSH_SELECT="brush-select",c.ON_SAVE="save",c.ON_RESET="reset",c.ON_OVER="over",d.setup=function(){this.styles.bottom=-2,this.styles.translateY=0,this.atlas=this.app.getCache("ui-atlas"),this.bg=new PIXI.Sprite(this.atlas.getFrame("main-tools-bg")),this.bg.interactive=!0,this.bg.buttonMode=!0,this.addChild(this.bg),this.buttons=[],this.saveButton=this.getButton(Constants.Tools.Save,"save-button-normal","save-button-over",1027,78,"save-button-down","save"),this.buttons.push(this.saveButton),this.brushesButton=this.getButton(Constants.Tools.Brushes,"brushes-button","brushes-button-highlight",280,74,null,"brushes"),this.buttons.push(this.brushesButton),this.eraserButton=this.getButton(Constants.Tools.Eraser,"eraser-button","eraser-button-highlight",385,74,null,"eraser"),this.buttons.push(this.eraserButton),this.splatsButton=this.getButton(Constants.Tools.Splats,"splats-button","splats-button-highlight",496,74,null,"mud & berries"),this.buttons.push(this.splatsButton),this.stickersButton=this.getButton(Constants.Tools.Stickers,"stickers-button","stickers-button-highlight",606,74,null,"stickers"),this.buttons.push(this.stickersButton),this.wandsButton=this.getButton(Constants.Tools.Wand,"sfx-button","sfx-button-highlight",730,74,null,"sfx"),this.buttons.push(this.wandsButton),this.canvasesButton=this.getButton(Constants.Tools.Canvases,"canvases-button","canvases-button-highlight",850,74,null,"backgrounds"),this.buttons.push(this.canvasesButton),e.setup.call(this)},d.getButton=function(a,c,d,e,f,g,h){var i=this.atlas.getFrame(c),j=this.atlas.getFrame(d);g=g?this.atlas.getFrame(g):j;var k=new b({up:i,down:g,over:j,highlighted:j,priority:["highlighted","disabled","down","over","selected","up"]});return k.name=a,k.ename=h,k.pivot=new PIXI.Point(.5*j.width,.5*j.height),k.x=e,k.y=f,this.addChild(k),k},d.onToggleSlide=function(){this.toggleSlide(!0),this.signal.trigger("onCallBack",{type:c.ON_OVER})},d.addEventListeners=function(){e.addEventListeners.call(this),this.bg.on("mouseover",this.onToggleSlide),this.bg.on("touchstart",this.onToggleSlide),this.saveButton.on("buttonPress",this.onSave),this.eraserButton.on("buttonPress",this.onBrushSelect),this.saveButton.on("buttonOver",this.onItemOver),this.eraserButton.on("buttonOver",this.onItemOver),this.wandsButton.on("buttonPress",this.onBrushesSelect),this.wandsButton.on("buttonOver",this.onItemOver),this.brushesButton.on("buttonPress",this.onBrushesSelect),this.brushesButton.on("buttonOver",this.onItemOver),this.splatsButton.on("buttonPress",this.onBrushesSelect),this.splatsButton.on("buttonOver",this.onItemOver),this.stickersButton.on("buttonPress",this.onBrushesSelect),this.stickersButton.on("buttonOver",this.onItemOver),this.canvasesButton.on("buttonPress",this.onBrushesSelect),this.canvasesButton.on("buttonOver",this.onItemOver)},d.onItemOver=function(a){a.name==Constants.Tools.Eraser?this.playVO("NAB_Toolbar_Main_Rollover_Eraser_NC"):a.name==Constants.Tools.Save?this.playVO("NAB_Toolbar_Main_Rollover_Save_NC"):a.name==Constants.Tools.Brushes?this.playVO("NAB_Toolbar_Main_Rollover_Brush_Crayon_NC"):a.name==Constants.Tools.Splats&&this.app.popInHalAnim?this.playVO("NAB_Toolbar_Main_Rollover_Nature Tools_NC"):a.name==Constants.Tools.Stickers&&this.app.popInSqueaksAnim?this.playVO("NAB_Toolbar_Main_Rollover_Stickers_NC"):a.name==Constants.Tools.Canvases&&this.app.popInNCBgsAnim?this.playVO("NAB_Toolbar_Main_Rollover_Backgrounds_NC"):a.name==Constants.Tools.Wand&&this.playVO("NAB_Toolbar_Main_Rollover_Special_Effects_NC")},d.playVO=function(a){this.app.voPlayer.currentVO==a||this.app.isTutorialPlaying||this.app.isTutorialOn||this.app.voPlayer.play(a)},d.removeEventListeners=function(){e.removeEventListeners.call(this),this.bg.off("mouseover",this.onToggleSlide),this.bg.off("touchstart",this.onToggleSlide),this.saveButton.off("buttonPress",this.onSave),this.saveButton.off("buttonOver",this.onItemOver),this.eraserButton.off("buttonPress",this.onBrushSelect),this.eraserButton.off("buttonOver",this.onItemOver),this.wandsButton.off("buttonPress",this.onBrushesSelect),this.wandsButton.off("buttonOver",this.onItemOver),this.brushesButton.off("buttonPress",this.onBrushesSelect),this.brushesButton.off("buttonOver",this.onItemOver),this.splatsButton.off("buttonPress",this.onBrushesSelect),this.splatsButton.off("buttonOver",this.onItemOver),this.stickersButton.off("buttonPress",this.onBrushesSelect),this.stickersButton.off("buttonOver",this.onItemOver),this.canvasesButton.off("buttonPress",this.onBrushesSelect),this.canvasesButton.off("buttonOver",this.onItemOver)},d.onBrushSelect=function(a){this.highlightButton(a),this.signal.trigger("onCallBack",{type:c.ON_BRUSH_SELECT,name:a.name}),this.playRandomBrushSound(),this.app.trackEvent("Tool Category",a.ename)},d.highlightButton=function(a){this.prevHighlightedButton&&(this.prevHighlightedButton.highlighted=!1),a.highlighted=!0,this.prevHighlightedButton=a},d.disable=function(a,b){this.buttons.map(function(c){a&&(c.interactive=!1),c.name==b&&(c.interactive=!1)})},d.enable=function(a,b,c){this.buttons.map(function(d){d.name==b?(d.interactive=!0,c&&this.highlightButton(d)):d.interactive=!1,a&&(d.interactive=!0)}.bind(this))},d.onBrushesSelect=function(a){this.highlightButton(a),this.signal.trigger("onCallBack",{type:c.ON_BRUSHES_SELECT,name:a.name}),this.playRandomBrushSound(),this.app.trackEvent("Tool Category",a.ename)},d.playRandomBrushSound=function(){this.app.sound.play("UI_Brush_Choose_"+["A","B","C"].shuffle()[0])},d.onReset=function(){return this.slideIn?(this.signal.trigger("onCallBack",{type:c.ON_RESET}),void this.app.sound.play("UI_Canvas_Clear")):void this.toggleSlide(!0)},d.onSave=function(){return this.slideIn?(this.signal.trigger("onCallBack",{type:c.ON_SAVE}),void this.app.sound.play("UI_Button_Tapped")):void this.toggleSlide(!0)},d.toggleSlide=function(a){if(!this.sliding&&this.slideIn!=a&&a){this.sliding=!0,this.slideIn=a;var b={y:0,newY:this.styles.newTranslateY};this.slideIn&&(b={y:this.styles.newTranslateY,newY:0});var c=createjs.Tween.get(b,{loop:!1}).to({y:b.newY},500,createjs.Ease.quadOut).call(this.sildeComplete.bind(this));c.addEventListener("change",this.slideUpdate.bind(this)),this.slideIn?this.app.sound.play("UI_Bottom_Drawer_Main_Open_1"):this.app.sound.play("UI_Bottom_Drawer_Main_Close_1")}},d.slideUpdate=function(a){this.element.style.setProperty("transform","translateY("+a.target.target.y+"px)")},d.sildeComplete=function(){this.sliding=!1},d.applyStyles=function(a,b,c,d,e){fabric.util.setStyle(this.element,{width:a+"px",height:b+"px",left:c+"px",bottom:d+"px",transform:"translateY("+e+"px)"})},d.resize=function(a,b){a=this.app.realWidth,b=this.app.realHeight;var c=this.app.scaling.size.width/this.app.scaling.size.height,d=a/b,e=d>c?b/this.app.scaling.size.height:a/this.app.scaling.size.width,f=this.styles.width*e,g=this.styles.height*e,h=.5*(a-f),i=this.styles.bottom*e,j=this.styles.translateY*e;this.styles.newTranslateY=j,this.applyStyles(f,g,h,i,j)},namespace("nature_art_box").MainTools=c}(),function(){var a=include("nature_art_box.PIXICanvasElement"),b=include("springroll.pixi.Button"),c=function(b,c){this.onItemSelect=this.onItemSelect.bind(this),this.onItemOver=this.onItemOver.bind(this),this.onRight=this.onRight.bind(this),this.onLeft=this.onLeft.bind(this),a.call(this,b,c)},d=extend(c,a),e=a.prototype;c.ON_BRUSH_SELECT="brush-select",c.ON_STICKER_SELECT="sticker-select",c.ON_CANVAS_SELECT="canvas-select",c.ON_SPIDER_SELECT="spider-select",c.ON_ANIMATED_STICKER_SELECT="animated-sticker-select",c.ON_OVER="over",d.setup=function(){this.sfx={},this.spiderAdded=!1,this.styles.left=12,this.styles.bottom=100,this.styles.translateY=195,this.atlas=this.app.getCache("ui-atlas"),this.bg=new PIXI.Sprite(this.atlas.getFrame("secondary-tools-bg")),this.addChild(this.bg),this.list=[],this.scrollerWidth=744,this.itemsWidth=0,this.itemsType=null,this.scroller=new PIXI.Container,this.scroller.x=60,this.scroller.y=76,this.addChild(this.scroller),this.items=new PIXI.Container,this.scroller.addChild(this.items),this.masker=new PIXI.Graphics,this.masker.beginFill(16711680),this.masker.drawRect(0,-50,this.scrollerWidth,100),this.scroller.addChild(this.masker),this.scroller.mask=this.masker,this.leftButton=this.getButton("left","right-button",50,71),this.rightButton=this.getButton("left","right-button",814,74),this.leftButton.scale.set(-1,1),e.setup.call(this),this.slideIn=!1,this.interactiveChildren=!1},d.onRight=function(){this.scrolling||this.itemsWidth+this.items.x<this.scrollerWidth||this.scroll(this.items.x-this.scrollerWidth)},d.onLeft=function(){this.scrolling||this.items.x>=0||this.scroll(this.items.x+this.scrollerWidth)},d.scroll=function(a){this.scrolling=!0,createjs.Tween.get(this.items,{loop:!1}).to({x:a},250,createjs.Ease.quadOut).call(this.scrollComplete.bind(this)),0>a?this.toggleScrollButton(this.leftButton,!0):this.toggleScrollButton(this.leftButton,!1),this.itemsWidth+a<this.scrollerWidth?this.toggleScrollButton(this.rightButton,!1):this.toggleScrollButton(this.rightButton,!0)},d.scrollComplete=function(){this.scrolling=!1},d.toggleScrollButton=function(a,b){a.visible=a.enabled=b},d.setItems=function(a){this.itemsType=a;var b=Constants[a],c=9,d=18,e=null,f=null;this.app.selectedImageIndex==Constants.ArtBox&&a==Constants.Tools.Canvases&&(b=[{name:"art-box",icon:"art-box-icon"}]);for(var g=0;g<b.length;g++){var h=b[g],i=h.icon?h.icon:h.name,j=this.app.getCache(i);j||(j=this.atlas.getFrame(i)),this.list[g]?(f=this.list[g],f.visible=!0,f.interactive=!0,f.alpha=1,f.texture=j):(f=new PIXI.Sprite(j),f.anchor.set(0,.5),f.interactive=!0,f.buttonMode=!0,f.on("mousedown",this.onItemSelect),f.on("mouseover",this.onItemOver),f.on("touchstart",this.onItemSelect),this.items.addChild(f),this.list.push(f)),a==Constants.Tools.Stickers?f.scale.set(.65):f.scale.set(1),f.index=g,f.options=h,f.name=h.name,f.enabled=!0,f.x=e?e.x+e.width+d:c;var k=f.x%this.scrollerWidth;k<=this.scrollerWidth&&k+f.width>=this.scrollerWidth&&(f.x=this.scrollerWidth*Math.round(f.x/this.scrollerWidth)+d),this.itemsWidth=f.x+f.width,e=f,f.worldTransform.tx=0|f.worldTransform.tx,f.worldTransform.ty=0|f.worldTransform.ty}this.items.x=0,this.resetItems(g),this.toggleScrollButton(this.leftButton,!1),this.itemsWidth>this.scrollerWidth?this.toggleScrollButton(this.rightButton,!0):this.toggleScrollButton(this.rightButton,!1),this.itemsType==Constants.Tools.Wand&&(this.app.isLowEndDevice&&this.limitsfx?this.disableIcons(!0):this.disableIcons(!1))},d.reset=function(){var a=this.getIconByName();a&&(a.texture=this.atlas.getFrame(a.options.icon)),this.spiderAdded=!1,this.spiderEdit=!1},d.resetItems=function(a){for(var b=a;b<this.list.length;b++)this.list[b].enabled=!1,this.list[b].visible=!1},d.getButton=function(a,c,d,e){var f=this.atlas.getFrame(c),g=new b({up:f,down:f});return g.name=a,g.pivot=new PIXI.Point(.5*f.width,.5*f.height),g.x=d,g.y=e,this.addChild(g),g},d.addEventListeners=function(){e.addEventListeners.call(this),this.rightButton.on("buttonPress",this.onRight),this.leftButton.on("buttonPress",this.onLeft)},d.removeEventListeners=function(){e.removeEventListeners.call(this),this.rightButton.off("buttonPress",this.onRight),this.leftButton.off("buttonPress",this.onLeft)},d.playRandomBrushSound=function(){this.app.sound.play("UI_Brush_Choose_"+["A","B","C"].shuffle()[0])},d.onItemOver=function(a){this.signal.trigger("onCallBack",{type:c.ON_OVER}),a.target.options.vo&&this.app.voPlayer.currentVO!=a.target.options.vo&&!this.app.isTutorialPlaying&&this.app.voPlayer.play(a.target.options.vo)},d.onItemSelect=function(a){var b=a.target.x+this.items.x;if(!(0>b||b>this.scrollerWidth)){var d=a.target.options.ename;if(!a.target.options.ename){var e=a.target.options.name.split("-");e.length>1&&(d=e[1].toLowerCase())}d&&this.app.trackEvent("Tool",d),this.itemsType==Constants.Tools.Brushes||this.itemsType==Constants.Tools.Splats?(this.signal.trigger("onCallBack",{type:c.ON_BRUSH_SELECT,name:a.target.name,options:a.target.options}),this.playRandomBrushSound()):this.itemsType==Constants.Tools.Stickers?(this.app.sound.play("UI_Sticker_Choose_"+["A","B"].shuffle()[0]),this.signal.trigger("onCallBack",{type:c.ON_STICKER_SELECT,name:a.target.name})):this.itemsType==Constants.Tools.Canvases?(this.signal.trigger("onCallBack",{type:c.ON_CANVAS_SELECT,name:a.target.name,vo:a.target.options.vo}),this.playRandomBrushSound()):this.itemsType==Constants.Tools.Wand&&(a.target.name==Constants.Tools.AnimatedStickers?this.signal.trigger("onCallBack",{type:c.ON_ANIMATED_STICKER_SELECT,options:a.target.options}):a.target.name==Constants.Spider?(this.spiderAdded?this.spiderEdit=!this.spiderEdit:(this.spiderAdded=!0,this.spiderEdit=!0),this.signal.trigger("onCallBack",{type:c.ON_SPIDER_SELECT,name:a.target.name,edit:this.spiderEdit}),this.restrictSpecialEffects(a.target.options.ename)):this.signal.trigger("onCallBack",{type:c.ON_BRUSH_SELECT,name:a.target.name,options:a.target.options}),this.playRandomBrushSound())}},d.restrictSpecialEffects=function(a){this.app.isLowEndDevice?(this.limitsfx=!0,this.disableIcons(!0)):(this.sfx[a]=!0,this.disableIcons(!1))},d.disableIcons=function(a){for(var b=0;b<this.list.length;b++)this.list[b].visible&&(a||this.sfx[this.list[b].options.ename])&&(this.list[b].alpha=.25,this.list[b].interactive=!1)},d.getIconByName=function(){for(var a=0;a<this.list.length;a++)if(this.list[a].name==Constants.Spider)return this.list[a];return null},d.toggleSpiderIcon=function(a){if(!a){var b=this.getIconByName();if(!b)return;a=b}this.spiderEdit?a.texture=this.atlas.getFrame("spider-icon-done"):a.texture=this.atlas.getFrame("spider-icon-edit")},d.toggleSlide=function(a){if(!this.sliding&&this.slideIn!=a){this.sliding=!0,this.slideIn=a;var b={y:0,newY:this.styles.newTranslateY};this.slideIn&&(b={y:this.styles.newTranslateY,newY:0});var c=createjs.Tween.get(b,{loop:!1}).to({y:b.newY},500,createjs.Ease.quadOut).call(this.sildeComplete.bind(this));c.addEventListener("change",this.slideUpdate.bind(this)),this.slideIn?this.app.sound.play("UI_Bottom_Drawer_Secondary_Open_1"):this.app.sound.play("UI_Bottom_Drawer_Secondary_Close_1")}},d.slideUpdate=function(a){this.element.style.setProperty("transform","translateY("+a.target.target.y+"px)")},d.sildeComplete=function(){this.sliding=!1,this.interactiveChildren=this.slideIn,this.slideIn&&this.playVO()},d.playVO=function(){this.app.voPlayer.playing||this.app.isTutorialPlaying||this.app.isTutorialOn||this.app.voPlayer.play(["NAB_Toolbar_Mud_Berries_D_NC","NAB_Toolbar_Mud_Berries_E_Daisy","NAB_Toolbar_Mud_Berries_F_Squeeks","NAB_Toolbar_Mud_Berries_G_7_Daisy","NAB_Toolbar_Mud_Berries_A_Hal","NAB_Toolbar_Mud_Berries_B_Daisy","NAB_Toolbar_Mud_Berries_C_Squeeks"].shuffle()[0])},d.applyStyles=function(a,b,c,d,e){fabric.util.setStyle(this.element,{width:a+"px",height:b+"px",left:c+"px",bottom:d+"px",transform:"translateY("+e+"px)"})},d.resize=function(a,b){a=this.app.realWidth,b=this.app.realHeight;var c=this.app.scaling.size.width/this.app.scaling.size.height,d=a/b,e=d>c?b/this.app.scaling.size.height:a/this.app.scaling.size.width,f=this.styles.width*e,g=this.styles.height*e,h=.5*(a-f)-this.styles.left*e,i=this.styles.bottom*e,j=this.styles.translateY*e;this.styles.newTranslateY=j,this.applyStyles(f,g,h,i,j)},namespace("nature_art_box").SecondaryTools=c}(),VerletJS.prototype.spider=function(a,b){b=b||1;var c,d=.99,e=.99,f=.99,g=.99,h=1,i=.4,j=.9,k=1,l=1,m=new this.Composite;for(m.legs=[],m.thorax=new Particle(a),m.head=new Particle(a.add(new Vec2(0,-5*b))),m.abdomen=new Particle(a.add(new Vec2(0,10*b))),m.particles.push(m.thorax),m.particles.push(m.head),m.particles.push(m.abdomen),m.constraints.push(new DistanceConstraint(m.head,m.thorax,k)),m.constraints.push(new DistanceConstraint(m.abdomen,m.thorax,k)),m.constraints.push(new AngleConstraint(m.abdomen,m.thorax,m.head,.4)),c=0;4>c;++c){m.particles.push(new Particle(m.particles[0].pos.add(new Vec2(3*b,(c-1.5*b)*(3*b))))),m.particles.push(new Particle(m.particles[0].pos.add(new Vec2(-3*b,(c-1.5*b)*(3*b)))));var n=m.particles.length;m.constraints.push(new DistanceConstraint(m.particles[n-2],m.thorax,d)),m.constraints.push(new DistanceConstraint(m.particles[n-1],m.thorax,d));var o=1*b;1==c||2==c?o=.7*b:3==c&&(o=.9*b),m.particles.push(new Particle(m.particles[n-2].pos.add(new Vec2(20*b,(c-1.5*b)*(30*b)).normal().mutableScale(20*b*o)))),m.particles.push(new Particle(m.particles[n-1].pos.add(new Vec2(-20*b,(c-1.5*b)*(30*b)).normal().mutableScale(20*b*o)))),n=m.particles.length,m.constraints.push(new DistanceConstraint(m.particles[n-4],m.particles[n-2],e)),m.constraints.push(new DistanceConstraint(m.particles[n-3],m.particles[n-1],e)),m.particles.push(new Particle(m.particles[n-2].pos.add(new Vec2(20*b,(c-1.5*b)*(50*b)).normal().mutableScale(20*b*o)))),m.particles.push(new Particle(m.particles[n-1].pos.add(new Vec2(-20*b,(c-1.5*b)*(50*b)).normal().mutableScale(20*b*o)))),n=m.particles.length,m.constraints.push(new DistanceConstraint(m.particles[n-4],m.particles[n-2],f)),m.constraints.push(new DistanceConstraint(m.particles[n-3],m.particles[n-1],f));var p=new Particle(m.particles[n-2].pos.add(new Vec2(20*b,(c-1.5*b)*(100*b)).normal().mutableScale(12*b*o))),q=new Particle(m.particles[n-1].pos.add(new Vec2(-20*b,(c-1.5*b)*(100*b)).normal().mutableScale(12*b*o)));m.particles.push(p),m.particles.push(q),m.legs.push(p),m.legs.push(q),n=m.particles.length,m.constraints.push(new DistanceConstraint(m.particles[n-4],m.particles[n-2],g)),m.constraints.push(new DistanceConstraint(m.particles[n-3],m.particles[n-1],g)),m.constraints.push(new AngleConstraint(m.particles[n-6],m.particles[n-4],m.particles[n-2],j)),m.constraints.push(new AngleConstraint(m.particles[n-6+1],m.particles[n-4+1],m.particles[n-2+1],j)),m.constraints.push(new AngleConstraint(m.particles[n-8],m.particles[n-6],m.particles[n-4],i)),m.constraints.push(new AngleConstraint(m.particles[n-8+1],m.particles[n-6+1],m.particles[n-4+1],i)),m.constraints.push(new AngleConstraint(m.particles[0],m.particles[n-8],m.particles[n-6],h)),m.constraints.push(new AngleConstraint(m.particles[0],m.particles[n-8+1],m.particles[n-6+1],h)),m.constraints.push(new AngleConstraint(m.particles[1],m.particles[0],m.particles[n-8],l)),m.constraints.push(new AngleConstraint(m.particles[1],m.particles[0],m.particles[n-8+1],l))}return this.composites.push(m),m},VerletJS.prototype.spiderweb=function(a,b,c,d){var e,f,g=.6,h=.3,i=2*Math.PI/c,j=c*d,k=b/j,l=new this.Composite;for(e=0;j>e;++e){var m=e*i+.05*Math.cos(.4*e)+.2*Math.cos(.05*e),n=b-k*e+20*Math.cos(.1*e),o=Math.cos(2.1*m)*(b/d)*.2;l.particles.push(new Particle(new Vec2(a.x+Math.cos(m)*n,a.y+Math.sin(m)*n+o)))}for(e=0;c>e;e+=4)l.pin(e);for(e=0;j-1>e;++e){l.constraints.push(new DistanceConstraint(l.particles[e],l.particles[e+1],g));var p=e+c;j-1>p?l.constraints.push(new DistanceConstraint(l.particles[e],l.particles[p],g)):l.constraints.push(new DistanceConstraint(l.particles[e],l.particles[j-1],g))}l.constraints.push(new DistanceConstraint(l.particles[0],l.particles[c-1],g));for(f in l.constraints)l.constraints[f].distance*=h;return this.composites.push(l),l},VerletJS.prototype.crawl=function(a,b){var c,d=100*b,e=35*b,f=this.composites[0],g=this.composites[1],h=g.particles[0].pos.angle2(g.particles[0].pos.add(new Vec2(1,0)),g.particles[1].pos),i=new Vec2(Math.cos(h),Math.sin(h)),j=new Vec2(Math.cos(h+Math.PI/2),Math.sin(h+Math.PI/2)),k=4>a?1:-1,l=a%2===0?1:0,m=[];for(c in f.particles)if(f.particles[c].pos.sub(g.particles[0].pos).dot(i)*k>=0&&f.particles[c].pos.sub(g.particles[0].pos).dot(j)*l>=0){var n=f.particles[c].pos.dist2(g.particles[0].pos);if(!(n>=e*e&&d*d>=n))continue;var o,p=!1;for(o in g.constraints){var q;for(q=0;8>q;++q)g.constraints[o]instanceof DistanceConstraint&&g.constraints[o].a==g.legs[q]&&g.constraints[o].b==f.particles[c]&&(p=!0)}p||m.push(f.particles[c])}for(c in g.constraints)if(g.constraints[c]instanceof DistanceConstraint&&g.constraints[c].a==g.legs[a]){g.constraints.splice(c,1);break}m.length>0&&(shuffle(m),g.constraints.push(new DistanceConstraint(g.legs[a],m[0],1,0)))},function(){var a=function(a){this.app=a,this.legIndex=0,this.enable=!0,this.update=this.update.bind(this),this.spiderwebDrawParticles=this.spiderwebDrawParticles.bind(this),this.spiderwebDrawConstraints=this.spiderwebDrawConstraints.bind(this),this.spiderDrawConstraints=this.spiderDrawConstraints.bind(this),this.preventScroll=this.preventScroll.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.resize=this.resize.bind(this),this.signal=new springroll.EventDispatcher,this.init()},b=a.prototype;b.resize=function(a,b){a=parseInt(this.stage.style.width),b=parseInt(this.stage.style.height),fabric.util.setStyle(this.canvas,{width:a+"px",height:b+"px"});var c=window.devicePixelRatio||1;this.canvas.width=a*c,this.canvas.height=b*c,this.canvas.getContext("2d").scale(c,c),this.sim.width=a,this.sim.height=b},b.init=function(){this.app.on("resize",this.resize),this.stage=document.getElementById("stage");var a=parseInt(this.stage.style.width),b=parseInt(this.stage.style.height),c=document.getElementById("content");this.canvas=document.createElement("canvas"),this.canvas.style||(this.canvas.style={}),fabric.util.setStyle(this.canvas,{position:"absolute",width:a+"px",height:b+"px",top:0,"pointer-events":"auto","z-index":5}),fabric.util.addClass(this.canvas,"spider-canvas"),c.appendChild(this.canvas);var d=window.devicePixelRatio||1;this.canvas.width=a*d,this.canvas.height=b*d,this.canvas.getContext("2d").scale(d,d);var e=this.app.realWidth,f=this.app.realHeight,g=this.app.scaling.size.width/this.app.scaling.size.height,h=e/f,i=h>g?f/this.app.scaling.size.height:e/this.app.scaling.size.width;i=Math.min(1,i),this.scaleFactor=i,this.sim=new VerletJS(a,b,this.canvas);var j=285*i,k=285*i,l=325*i,m=0;this.spiderweb=this.sim.spiderweb(new Vec2(j,k),l,20,4),this.spider=this.sim.spider(new Vec2(j,m),i),this.spiderweb.drawParticles=this.spiderwebDrawParticles,this.spiderweb.drawConstraints=this.spiderwebDrawConstraints,this.spider.drawParticles=this.spiderDrawParticles,this.spider.drawConstraints=this.spiderDrawConstraints,this.app.on("update",this.update),this.canvas.addEventListener("touchstart",this.onTouchStart),this.canvas.addEventListener("touchmove",this.onTouchMove),this.canvas.addEventListener("touchend",this.onTouchEnd),this.canvas.onmousedown=this.onMouseDown,this.canvas.onmousemove=this.onMouseMove,this.canvas.onmouseup=this.onMouseUp,document.body.addEventListener("touchstart",this.preventScroll,!1),document.body.addEventListener("touchmove",this.preventScroll,!1),document.body.addEventListener("touchend",this.preventScroll,!1),this.headImage=new Image,this.headImage.src=location.toString().replace("index.html","").split("?")[0]+"assets/images/spider/spider-head.png",this.bodyImage=new Image,this.bodyImage.src=location.toString().replace("index.html","").split("?")[0]+"assets/images/spider/spider-body.png"},b.onMouseDown=function(a){var b=this.canvas.getBoundingClientRect();this.sim.mouse.x=a.clientX-b.left,this.sim.mouse.y=a.clientY-b.top,this.sim.mouseDown=!0,this.sim.prevMouse||(this.sim.prevMouse={}),this.sim.prevMouse.x=this.sim.mouse.x,this.sim.prevMouse.y=this.sim.mouse.y;var c=this.sim.nearestEntity();c&&(this.sim.draggedEntity=c)},b.onMouseMove=function(a){var b=this.canvas.getBoundingClientRect();this.sim.mouse.x=a.clientX-b.left,this.sim.mouse.y=a.clientY-b.top,this.sim.mouseDown&&(this.moveWeb(this.sim.mouse.x-this.sim.prevMouse.x,this.sim.mouse.y-this.sim.prevMouse.y),this.sim.prevMouse.x=this.sim.mouse.x,this.sim.prevMouse.y=this.sim.mouse.y)},b.moveWeb=function(a,b){for(i=0;i<this.spiderweb.constraints.length;++i){var c=this.spiderweb.constraints[i];this.enable&&c instanceof window.PinConstraint&&this.sim.draggedEntity&&this.sim.mouseDown&&c.pos.mutableSet({x:c.pos.x+a,y:c.pos.y+b})}},b.onTouchStart=function(a){var b=a.touches[0];this.canvas.onmousedown(b)},b.onTouchMove=function(a){var b=a.touches[0];this.canvas.onmousemove(b)},b.onTouchEnd=function(a){this.canvas.onmouseup()},b.onMouseUp=function(a){this.sim.draggedEntity||(this.toggleEdit(),this.signal.trigger("onCallBack")),this.sim.mouseDown=!1,this.sim.draggedEntity=null},b.preventScroll=function(a){a.target==this.canvas&&a.preventDefault()},b.spiderwebDrawParticles=function(a,b){var c;for(c in b.particles){var d=b.particles[c];a.beginPath(),a.arc(d.pos.x,d.pos.y,1.3,0,2*Math.PI),a.fillStyle="#2dad8f",a.fill()}},b.spiderwebDrawConstraints=function(a,b){for(i=0;i<b.constraints.length;++i){var c=b.constraints[i];c.draw(a),this.enable&&c instanceof window.PinConstraint&&(a.beginPath(),a.rect(c.pos.x-10,c.pos.y-10,20,20),a.fillStyle="rgba(0,0,0,0.5)",a.fill())}},b.spiderDrawParticles=function(a,b){},b.spiderDrawConstraints=function(a,b){var c;for(c=3;c<b.constraints.length;++c){var d=b.constraints[c];d instanceof DistanceConstraint&&(a.beginPath(),a.moveTo(d.a.pos.x,d.a.pos.y),a.lineTo(d.b.pos.x,d.b.pos.y),c>=2&&4>=c||c>=19&&20>=c||c>=35&&36>=c||c>=51&&52>=c?(a.save(),d.draw(a),a.strokeStyle="#000",a.lineWidth=3*this.scaleFactor,a.stroke(),a.restore()):c>=4&&6>=c||c>=21&&22>=c||c>=37&&38>=c||c>=53&&54>=c?(a.save(),d.draw(a),a.strokeStyle="#000",a.lineWidth=2*this.scaleFactor,a.stroke(),a.restore()):c>=6&&8>=c||c>=23&&24>=c||c>=39&&40>=c||c>=55&&56>=c?(a.save(),a.strokeStyle="#000",a.lineWidth=1.5*this.scaleFactor,a.stroke(),a.restore()):(a.strokeStyle="#000",a.stroke()))}var e,f,g=this.spider.thorax.pos.x-this.spider.abdomen.pos.x,h=this.spider.thorax.pos.y-this.spider.abdomen.pos.y,i=Math.atan2(h,g);this.headImage&&(e=this.headImage.width*this.scaleFactor,f=this.headImage.height*this.scaleFactor,a.translate(this.spider.thorax.pos.x,this.spider.thorax.pos.y),a.rotate(i),a.drawImage(this.headImage,0,.5*-f,e,f),a.rotate(-i),a.translate(-this.spider.thorax.pos.x,-this.spider.thorax.pos.y)),this.bodyImage&&(e=this.bodyImage.width*this.scaleFactor,f=this.bodyImage.height*this.scaleFactor,a.translate(this.spider.abdomen.pos.x,this.spider.abdomen.pos.y),a.rotate(i),a.drawImage(this.bodyImage,.5*-e,.5*-f,e,f),a.rotate(-i),a.translate(-this.spider.abdomen.pos.x,-this.spider.abdomen.pos.y))},b.toggleEdit=function(){this.enable=!this.enable;var a="auto";this.enable||(a="none"),fabric.util.setStyle(this.canvas,{"pointer-events":a})},b.update=function(){0===Math.floor(4*Math.random())&&this.sim.crawl(3*this.legIndex++%8,this.scaleFactor),this.sim.frame(16),this.sim.draw()},b.clear=function(){this.app.off("update",this.update),this.app.off("resize",this.resize);var a=document.getElementById("content");a.removeChild(this.canvas),this.canvas=null},namespace("nature_art_box").Spider=a}(),function(){var a=include("PIXI.Container"),b=function(b){a.call(this),this.signal=new springroll.EventDispatcher,this.app=b.app,this.panel=b},c=extend(b,a);c.show=function(a){this.addEventListeners(),a.addChild(this),this.app.sound.play("Pop_Up_Display"),this.display()},c.display=function(){this.scale.set(.8),createjs.Tween.get(this.scale,{loop:!1,override:!0}).to({x:1,y:1},500,createjs.Ease.elasticOut).call(this.onDisplay.bind(this))},c.hide=function(a,b){this.removeEventListeners(),this.scale.set(1),createjs.Tween.get(this.scale,{loop:!1,override:!0}).to({x:.8,y:.8},500,createjs.Ease.elasticIn).call(this.remove.bind(this,a,b))},c.remove=function(a,b){this.parent.removeChild(this),this.app.sound.play("Pop_Up_Remove"),this.signal.trigger(a,b)},c.addEventListeners=function(){},
c.removeEventListeners=function(){},c.onDisplay=function(){},c.clear=function(){this.app=null,this.panel=null},namespace("nature_art_box").BasePopup=b}(),function(){var a=include("nature_art_box.BasePopup"),b=include("nature_art_box.CustomButton"),c=function(b){a.call(this,b),this.onSave=this.onSave.bind(this),this.onClose=this.onClose.bind(this),this.MaxImageWidth=350,this.init()},d=extend(c,a),e=a.prototype;c.ON_CALLBACK="callback",c.ON_SAVE="save",c.ON_CLOSE="close",d.show=function(a,b){e.show.call(this,a);var c=this.MaxImageWidth/b.width;this.image.texture=b,this.image.scale.set(c),this.selectedImageIndex=this.app.selectedImageIndex,this.app.selectedImageIndex<0?(this.showGallery(),this.hideImage()):(this.hideGallery(),this.showImage())},d.init=function(){var a=this.app.getCache("ui-atlas");this.bg=new PIXI.Sprite(a.getFrame("twig-popup-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.container=new PIXI.Container,this.addChild(this.container),this.image=new PIXI.Sprite,this.image.y=-55,this.image.anchor.set(.5),this.container.addChild(this.image),this.okBtn=this.getButton(a,"popup-save-button"),this.okBtn.x=150,this.okBtn.y=145,this.container.addChild(this.okBtn),this.closeBtn=this.getButton(a,"popup-cancel-button"),this.closeBtn.x=-150,this.closeBtn.y=145,this.container.addChild(this.closeBtn),this.gallery=new PIXI.Sprite(a.getFrame("twig-popup-gallery-bg")),this.gallery.y=50,this.gallery.anchor.set(.5),this.addChild(this.gallery),this.title=new PIXI.Sprite(a.getFrame("twig-popup-gallery-text")),this.title.y=-180,this.title.anchor.set(.5),this.gallery.addChild(this.title),this.galleryButtons=[];for(var b=150,c=100,d=-182,e=-60,f=180,g=123,h=0;6>h;h++){var i=(new PIXI.Graphics).beginFill(16777215);i.drawRect(.5*-b,.5*-c,b,c),f=h%3==2?182:180,i.interactive=!0,i.buttonMode=!0,i.x=d+f*(h%3),i.y=e+g*Math.floor(h/3),this.gallery.addChild(i),this.galleryButtons.push(i)}},d.getButton=function(a,c){var d=new b(this.app,{up:a.getFrame(c+"-normal"),over:a.getFrame(c+"-over"),down:a.getFrame(c+"-over")}),e=a.getFrame(c+"-normal");return d.pivot=new PIXI.Point(.5*e.width,.5*e.height),d},d.onSave=function(){this.app.selectedImageIndex=this.selectedImageIndex,this.hide(c.ON_CALLBACK,c.ON_SAVE)},d.onClose=function(){this.hide(c.ON_CALLBACK,c.ON_CLOSE)},d.toggleEventListeners=function(a){for(var b=this.galleryButtons.length,c=0;b>c;c++){var d=this.galleryButtons[c];a?(d.index=c,d.interactive=!0,d.buttonMode=!0,d.on("mouseover",this.onOver.bind(this)),d.on("mousedown",this.onImageClick.bind(this)),d.on("touchstart",this.onImageClick.bind(this))):(d.interactive=!1,d.buttonMode=!1,d.off("mouseover",this.onOver),d.off("mousedown",this.onImageClick),d.off("touchstart",this.onImageClick))}},d.onOver=function(){this.app.sound.isPlaying("ButtonRollover")||this.app.sound.play("ButtonRollover")},d.showImage=function(){this.container.visible=!0,this.container.interactiveChildren=!0},d.hideImage=function(){this.container.visible=!1,this.container.interactiveChildren=!1},d.showGallery=function(){this.gallery.visible=!0,this.gallery.interactiveChildren=!0},d.hideGallery=function(){this.gallery.visible=!1,this.gallery.interactiveChildren=!1},d.onImageClick=function(a){this.app.sound.play("ButtonClick"),this.selectedImageIndex=a.target.index,this.hideGallery(),this.showImage()},d.addEventListeners=function(){this.okBtn.enabled=!0,this.closeBtn.enabled=!0,this.okBtn.on("buttonPress",this.onSave),this.closeBtn.on("buttonPress",this.onClose),this.toggleEventListeners(!0)},d.removeEventListeners=function(){this.okBtn.enabled=!1,this.closeBtn.enabled=!1,this.okBtn.off("buttonPress",this.onSave),this.closeBtn.off("buttonPress",this.onClose),this.toggleEventListeners(!1)},d.clear=function(){this.removeEventListeners(),this.removeChild(this.bg),this.okBtn.destroy(),this.removeChild(this.okBtn),this.closeBtn.destroy(),this.removeChild(this.closeBtn),this.bg=null,this.okBtn=null,this.closeBtn=null,e.clear.call(this)},namespace("nature_art_box").SavePopup=c}(),function(){var a,b=include("PIXI.Container"),c=function(){a||(a=include("springroll.Application")),b.call(this),this.app=a.instance,this.config=this.app.config},d=extend(c,b);d.setup=function(){},d.teardown=function(){},d.cleanupChildren=function(a){var b,c,d=arguments.length;for(c=0;d>c;c++)b=arguments[c],b&&(Array.isArray(b)&&b.length>0?this.cleanupChildren.apply(this,b):(this.app.animator&&this.app.animator.stop(b,!0),b.stop&&b.stop(),b.destroy&&b.destroy(),b.children&&b.removeChildren()))},d.destroy=function(){this.app=null,this.config=null,this.children&&this.removeChildren()},namespace("springroll.pixi").BasePanel=c}(),function(){var a=include("springroll.pixi.BasePanel"),b=include("nature_art_box.CustomButton"),c=function(){a.call(this),this.background=null,this.onTextureUpdate=this.onTextureUpdate.bind(this),this.onResize=this.onResize.bind(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.background=new PIXI.Sprite(this.app.getCache("cover-bg")),this.addChild(this.background),this.coverImage=new PIXI.Sprite,this.coverImage.anchor.set(.5),this.addChild(this.coverImage);var a=this.app.getCache("cover-open-button");this.openButton=new b(this.app,{up:a,down:a,over:a}),this.addChild(this.openButton),this.container=new PIXI.Container,this.addChild(this.container),this.addSparkles();var c="NAB_DRAWING_art-box",d=this.app.db.getCollection("gallery"),e=d.findOne({name:c});if(e){var f=JSON.parse(e.dataUrl);a=new PIXI.Texture(PIXI.BaseTexture.fromImage(f)),a.width>0?this.onTextureUpdate(a):a.on("update",this.onTextureUpdate),this.app.on("resize",this.onResize)}},e.addSparkles=function(a,b){this.sparklesContainer=new PIXI.Container,this.sparklesContainer.x=510,this.sparklesContainer.y=685,this.container.addChild(this.sparklesContainer),this.sparkles=[];for(var c=50,d=0,e=0;36>e;e++){var f=new PIXI.Sprite(this.app.getCache("sparkle"));f.anchor.set(.5),this.sparklesContainer.addChild(f),f.x=(c+20*Math.random())*Math.cos(d),f.y=(c+20*Math.random())*Math.sin(d),d+=Math.PI/18,f.angMult=2-4*Math.random(),f.alphaMult=.05*Math.random(),this.sparkles.push(f)}},e.onResize=function(){this.onTextureUpdate(this.coverImage.texture)},e.onTextureUpdate=function(a){var b=a;if(!(b.width<=0)){this.coverImage.texture=b;var c=this.app.display.width/b.width;this.coverImage.scale.set(c)}},e.teardown=function(){d.teardown.call(this),this.removeChild(this.background),this.removeChild(this.openButton),this.app.off("resize",this.onResize),this.sparkles=null,this.sparklesContainer.parent.removeChild(this.sparklesContainer),this.sparklesContainer=null,this.removeChild(this.container),this.container=null,this.openButton=null,this.background=null},namespace("nature_art_box").CoverPanel=c}(),function(){var a=include("springroll.pixi.BasePanel"),b=include("nature_art_box.CustomButton"),c=function(){a.call(this),this.images=null,this.onUpdate=this.onUpdate.bind(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.background=new PIXI.Sprite(this.app.getCache("gallery-bg")),this.addChild(this.background);var a=this.app.getCache("plus-button");this.plusButton=new b(this.app,{up:a,down:a}),this.addChild(this.plusButton),a=this.app.getCache("art-box-button"),this.artBoxButton=new b(this.app,{up:a,down:a}),this.addChild(this.artBoxButton),this.container=new PIXI.Container,this.addChild(this.container),this.images=[],this.addImages()},e.addImages=function(){for(var a,b=this.app.config.data.gallery,c=6,d=302,e=212,f=210,g=255,h=null,i=null,j=this.app.getCache("gallery-atlas"),k=0;c>k;k++)a="NAB_DRAWING_"+k,h=this.app.saveData[a]&&this.app.saveData[a].imageName?j.getFrame(this.app.saveData[a].imageName):j.getFrame(b[k].name),i=new PIXI.Sprite(h),i.anchor.set(.5),i.x=f+d*(k%3),i.y=g+e*Math.floor(k/3),this.container.addChild(i),i.interactive=!0,i.buttonMode=!0,this.images.push(i),this.hasImage(a,k)},e.hasImage=function(a,b){var c=this.app.db.getCollection("gallery"),d=c.findOne({name:a});if(d){var e=JSON.parse(d.dataUrl),f=new PIXI.Texture(PIXI.BaseTexture.fromImage(e));f.index=b,f.width>0?this.onUpdate(f):f.on("update",this.onUpdate)}},e.onUpdate=function(a){var b=a,c=a.index;if(!(b.width<=0)){var d=this.images[c],e=d.width/b.width,f=new PIXI.Sprite(b);f.anchor.set(.5),f.scale.set(e),d.addChild(f)}},e.clear=function(a){if(a instanceof Array){for(var b=a.length,c=b-1;c>=0;c--)this.clear(a[c]),a.splice(c,1);a=null}else a.parent.removeChild(a),a=null},e.teardown=function(){d.teardown.call(this),this.clear(this.images),this.removeChild(this.background),this.removeChild(this.plusButton),this.removeChild(this.artBoxButton),this.removeChild(this.titleText),this.titleText=null,this.plusButton=null,this.artBoxButton=null,this.background=null},namespace("nature_art_box").GalleryPanel=c}(),function(){var a=include("springroll.pixi.BasePanel"),b=function(){a.call(this),this.gameLayer=null},c=a.prototype,d=extend(b,a);d.setup=function(){this.cursorContainer=new PIXI.Container,this.addChild(this.cursorContainer),this.leftLayer=new PIXI.Container,this.addChild(this.leftLayer),this.gameLayer=new PIXI.Container,this.addChild(this.gameLayer),this.container=new PIXI.Container,this.addChild(this.container),this.scrim=new PIXI.Graphics,this.scrim.beginFill(0),this.scrim.drawRect(-683,-450,1366,900),this.scrim.x=512,this.scrim.y=384,this.scrim.alpha=.4},d.addScrim=function(){this.container.addChild(this.scrim)},d.removeScrim=function(){this.container.removeChild(this.scrim)},d.teardown=function(){c.teardown.call(this)},namespace("nature_art_box").GamePanel=b}(),function(){var a=include("springroll.pixi.BasePanel"),b=include("springroll.pixi.AdvancedMovieClip"),c=include("nature_art_box.CustomButton"),d=function(){a.call(this),this.background=null},e=a.prototype,f=extend(d,a);f.setup=function(){var a=this.app.getCache("intro-atlas");this.background=new PIXI.Sprite(a.getFrame("Intro-bg")),this.addChild(this.background),this.container=new PIXI.Container,this.addChild(this.container),this.board=new PIXI.Sprite(a.getFrame("board")),this.board.anchor.set(.5,1),this.board.x=145,this.board.y=-96,this.container.addChild(this.board),this.daisy=new b(this.app.getCache("daisy-intro-anim")),this.daisy.anchor.set(.5,1),this.daisy.x=-195,this.daisy.y=-115,this.container.addChild(this.daisy),this.squeaks=new b(this.app.getCache("squeaks-intro-anim")),this.squeaks.x=-65,this.squeaks.y=-130,this.squeaks.anchor.set(.5,1),this.container.addChild(this.squeaks),this.hal=new b(this.app.getCache("hal-intro-anim")),this.hal.anchor.set(.5,1),this.hal.x=-90,this.hal.y=10,this.container.addChild(this.hal),this.nc=new b(this.app.getCache("nc-intro-anim")),this.nc.anchor.set(.5,1),this.nc.x=375,this.nc.y=-138,this.container.addChild(this.nc);var d=a.getFrame("skip-button-normal");this.skipButton=new c(this.app,{up:d,down:a.getFrame("skip-button-down"),over:a.getFrame("skip-button-over")}),this.addChild(this.skipButton),this.skipButton.pivot=new PIXI.Point(.5*d.width,.5*d.height)},f.addMudNC=function(){this.nc=new b(this.app.getCache("nc-intro-mud-anim")),this.nc.anchor.set(.5,1),this.nc.x=200,this.container.addChildAt(this.nc,0)},f.teardown=function(){e.teardown.call(this),this.removeChild(this.background),this.removeChild(this.skipButton),this.container.removeChildren(),this.removeChild(this.container),this.container=null,this.skipButton=null,this.background=null},namespace("nature_art_box").IntroPanel=d}(),function(){var a=include("springroll.pixi.BasePanel"),b=include("nature_art_box.CustomButton"),c=function(){a.call(this),this.background=null},d=a.prototype,e=extend(c,a);e.setup=function(){this.background=new PIXI.Sprite(this.app.getCache("splash-bg")),this.addChild(this.background);var a=this.app.getCache("button-atlas"),c=a.getFrame("play-button-normal");this.playButton=new b(this.app,{up:c,down:a.getFrame("play-button-down"),over:a.getFrame("play-button-over")}),this.addChild(this.playButton),this.playButton.pivot=new PIXI.Point(.5*c.width,.5*c.height)},e.teardown=function(){d.teardown.call(this),this.removeChild(this.background),this.removeChild(this.playButton),this.removeChild(this.titleText),this.titleText=null,this.playButton=null,this.background=null},namespace("nature_art_box").TitlePanel=c}(),function(a){var b,c,d=include("springroll.State"),e=function(a,e){if(c||(c=include("springroll.pixi.BasePanel"),b=include("springroll.Debug",!1)),!(a instanceof c))throw"springroll.State requires the panel be a springroll.pixi.BasePanel";e=e||{},e.manifest&&(e.preload=e.manifest),d.call(this,a,e);var f=100;this.on("loading",function(a){},f).on("loaded",function(a){this.panel.setup()},f).on("exit",function(){this.panel.teardown()},f)},f=d.prototype,g=d.extend(e);g.enterState=function(){},g.destroy=function(){this.panel.destroy(),f.destroy.call(this)},namespace("springroll.pixi").BaseState=e}(),function(){var a=include("springroll.pixi.BaseState"),b=include("nature_art_box.Arrow"),c=include("nature_art_box.CoverPanel"),d=function(b){a.call(this,new c,b),this.onOpenClick=this.onOpenClick.bind(this)},e=a.prototype,f=extend(d,a);f.enterState=function(){this.app.music="Music_Box_And_Open_Box_Loop",this.onUpdate=this.onUpdate.bind(this),this.panel.openButton.on("buttonPress",this.onOpenClick),new springroll.DelayedCall(this.playVO.bind(this),500),this.startInactivity(),this.app.on("update",this.onUpdate)},f.onUpdate=function(){for(var a=0;a<this.panel.sparkles.length;a++){var b=this.panel.sparkles[a];b.rotation+=b.angMult*Math.PI/180,b.alpha-=b.alphaMult,b.alpha<=0?(b.alpha=0,b.alphaMult=-b.alphaMult):b.alpha>=1&&(b.alpha=1,b.alphaMult=-b.alphaMult)}},f.removeArrow=function(){this.panel.arrow&&(this.panel.arrow.clear(),this.panel.arrow.parent.removeChild(this.panel.arrow),this.panel.arrow=null)},f.pointArrow=function(a,c,d,e,f,g,h){this.panel.arrow||(this.panel.arrow=new b(this.panel)),g.addChild(this.panel.arrow),this.panel.arrow.show(a,c,d,e,f,h)},f.playVO=function(){this.app.voPlayer.play("NAB_Box_Cover_Closed_NC"),this.pointArrow(420,643,-20,0,180,this.panel.container)},f.startInactivity=function(){this.inActivityInterval=new springroll.DelayedCall(this.handleInactivity.bind(this),this.app.config.data.inActivityTime*Constants.SecondsToMilliSeconds)},f.handleInactivity=function(){this.app.voPlayer.playing?this.startInactivity():this.app.voPlayer.play("NAB_Box_Cover_Inactivity_Squeeks",this.startInactivity.bind(this))},f.onOpenClick=function(){this.nextState()},f.exitStart=function(){this.inActivityInterval&&(this.inActivityInterval.stop(),this.inActivityInterval.destroy(),this.inActivityInterval=null),this.app.voPlayer.stop(),this.panel.openButton.off("buttonPress",this.onOpenClick),this.app.off("update",this.onUpdate),this.panel.openButton.enabled=!1,this.panel.openButton.interactive=!1},f.exit=function(){this.removeArrow(),this.panel.openButton.off("buttonPress",this.onOpenClick),this.app.off("update",this.onUpdate),this.panel.openButton.enabled=!1,this.panel.openButton.interactive=!1},f.destroy=function(){this.panel.destroy(),e.destroy.call(this)},namespace("nature_art_box").CoverState=d}(),function(){var a=include("springroll.pixi.BaseState"),b=include("nature_art_box.Constants"),c=include("nature_art_box.Arrow"),d=include("nature_art_box.GalleryPanel"),e=function(b){a.call(this,new d,b),this.onPlusClick=this.onPlusClick.bind(this),this.onArtBoxClick=this.onArtBoxClick.bind(this)},f=a.prototype,g=extend(e,a);e.TUTORIAL={NC:"nc",SQUEAKS:"squeaks",DAISY:"daisy",HAL:"hal"},g.enterState=function(){this.app.music="Music_Box_And_Open_Box_Loop",this.addEventListeners(),this.app.isTutorialShown||(this.currentTutorialIndex=0,this.tutorial=[{type:e.TUTORIAL.NC,vo:"NAB_Gallery_1_NC"},{type:e.TUTORIAL.DAISY,vo:"NAB_Gallery_3_Daisy"},{type:e.TUTORIAL.SQUEAKS,vo:"NAB_Gallery_2_Squeeks"},{type:e.TUTORIAL.HAL,vo:"NAB_Gallery_4_Hal"}],this.arrows=[],this.startTutorial()),this.startInactivity()},g.startTutorial=function(){createjs.Tween.get(this).wait(500).call(this.onTutorial.bind(this))},g.onTutorial=function(){var a=this.tutorial[this.currentTutorialIndex];this.app.voPlayer.play(a.vo,this.nextTutorial.bind(this)),a.type==e.TUTORIAL.SQUEAKS?this.pointArrow(350,612,-20,0,180,this.panel.container):a.type==e.TUTORIAL.DAISY?(this.pointArrow(120,430,-20,0,180,this.panel.container),this.pointArrow(120,215,-20,0,180,this.panel.container),this.pointArrow(420,430,-20,0,180,this.panel.container),this.pointArrow(420,215,-20,0,180,this.panel.container),this.pointArrow(720,430,-20,0,180,this.panel.container),this.pointArrow(720,215,-20,0,180,this.panel.container)):a.type==e.TUTORIAL.HAL&&this.pointArrow(590,612,-20,0,180,this.panel.container)},g.nextTutorial=function(){this.clearArrows(),++this.currentTutorialIndex,this.currentTutorialIndex<this.tutorial.length&&this.onTutorial()},g.startInactivity=function(){this.inActivityInterval=new springroll.DelayedCall(this.handleInactivity.bind(this),this.app.config.data.inActivityTime*b.SecondsToMilliSeconds)},g.handleInactivity=function(){this.app.voPlayer.playing?this.startInactivity():this.app.voPlayer.play("NAB_Gallery_Inactivity",this.startInactivity.bind(this))},g.pointArrow=function(a,b,d,e,f,g){var h=new c(this.panel),i=.8;h.scale.set(h.scale.x*i,h.scale.y*i),g.addChild(h),h.show(a,b,d,e,f),this.arrows.push(h)},g.addEventListeners=function(){this.panel.plusButton.on("buttonPress",this.onPlusClick),this.panel.artBoxButton.on("buttonPress",this.onArtBoxClick),this.toggleEventListeners(!0)},g.toggleEventListeners=function(a){for(var b=this.panel.images.length,c=0;b>c;c++){var d=this.panel.images[c];a?(d.index=c,d.on("mousedown",this.onImageClick.bind(this)),d.on("touchstart",this.onImageClick.bind(this))):(d.interactive=!1,d.enabled=!1,d.off("mousedown",this.onImageClick),d.off("touchstart",this.onImageClick))}},g.removeEventListeners=function(){this.panel.plusButton.enabled=!1,this.panel.plusButton.interactive=!1,this.panel.plusButton.off("buttonPress",this.onPlusClick),this.panel.artBoxButton.off("buttonPress",this.onArtBoxClick),this.toggleEventListeners(!1)},g.onImageClick=function(a){createjs.Tween.get(this).wait(100).call(this.start.bind(this,a.target.index))},g.start=function(a){this.removeEventListeners(),this.app.selectedImageIndex=a,this.nextState(),this.app.sound.play("UI_Box_Canvas_Choice_After_"+["A","B"].shuffle()[0]),this.app.trackEvent("Canvas","Start")},g.onArtBoxClick=function(){this.app.selectedImageIndex="art-box",this.nextState(),this.app.sound.play("UI_Box_Canvas_Choice_After_"+["A","B"].shuffle()[0])},g.onPlusClick=function(){this.app.selectedImageIndex=-1,this.nextState(),this.app.sound.play("UI_Box_Canvas_Choice_After_"+["A","B"].shuffle()[0])},g.exitStart=function(){this.inActivityInterval&&(this.inActivityInterval.stop(),this.inActivityInterval.destroy(),this.inActivityInterval=null),this.app.voPlayer.stop(),this.removeEventListeners(),createjs.Tween.removeAllTweens()},g.exit=function(){this.clearArrows(),this.removeEventListeners()},g.destroy=function(){this.panel.destroy(),f.destroy.call(this)},g.clearArrows=function(){if(this.arrows&&this.arrows.length>0)for(var a=this.arrows.length-1;a>=0;a--)this.arrows[a]&&(this.arrows[a].clear(),this.arrows[a].parent.removeChild(this.arrows[a]),this.arrows[a]=null);this.arrows.splice(0,this.arrows.length)},namespace("nature_art_box").GalleryState=e}(),function(){var a=include("springroll.pixi.BaseState"),b=include("nature_art_box.Arrow"),c=include("nature_art_box.Slider"),d=include("nature_art_box.Spider"),e=include("nature_art_box.Constants"),f=include("nature_art_box.SavePopup"),g=include("nature_art_box.GamePanel"),h=include("nature_art_box.MainTools"),i=include("nature_art_box.ColorPicker"),j=include("nature_art_box.SecondaryTools"),k=include("springroll.pixi.AdvancedMovieClip"),l=function(b){a.call(this,new g,b),this.onBack=this.onBack.bind(this),this.update=this.update.bind(this),this.onResize=this.onResize.bind(this),this.onLoading=this.onLoading.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onDrawComplete=this.onDrawComplete.bind(this),this.onToolsCallback=this.onToolsCallback.bind(this),this.onStickerRemove=this.onStickerRemove.bind(this),this.onStickerModify=this.onStickerModify.bind(this),this.onPopupCallback=this.onPopupCallback.bind(this),this.onTextureUpdate=this.onTextureUpdate.bind(this),this.onSpiderCallback=this.onSpiderCallback.bind(this),this.tutorial=[{type:l.TUTORIAL.MainTools},{type:l.TUTORIAL.SecondaryTools},{type:l.TUTORIAL.Colors},{type:l.TUTORIAL.Slider,vo:"NAB_Tutorial_Options_Tool_Bar_2_Daisy"}],this.sparkles=[],this.on("loading",this.onLoading)},m=a.prototype,n=extend(l,a);l.TUTORIAL={MainTools:"main-tools",SecondaryTools:"secondary-tools",Colors:"colors",Slider:"slider"},n.onLoading=function(a){var b=this.app.getCache("game-json");this.gameAssets=[],b.Stickers&&this.addPreloadImages(b.Stickers,"assets/images/stickers/",this.gameAssets),b.Canvases&&this.addPreloadImages(b.Canvases,"assets/images/canvases/",this.gameAssets),this.app.popInNCAnim||this.app.disableAnims||(this.gameAssets=this.gameAssets.concat(this.app.config.data.popins.ncMain)),this.app.popInNCBgsAnim||this.app.disableAnims||(this.gameAssets=this.gameAssets.concat(this.app.config.data.popins.ncBgs)),this.app.popInNCCoverAnim||this.app.disableAnims||(this.gameAssets=this.gameAssets.concat(this.app.config.data.popins.ncCover)),this.app.popInDaisyAnim||this.app.disableAnims||(this.gameAssets=this.gameAssets.concat(this.app.config.data.popins.daisy)),this.app.popInHalAnim||this.app.disableAnims||(this.gameAssets=this.gameAssets.concat(this.app.config.data.popins.hal)),this.app.popInSqueaksAnim||this.app.disableAnims||(this.gameAssets=this.gameAssets.concat(this.app.config.data.popins.squeaks)),this.gameAssets.map(function(b){a.push(b)}.bind(this))},n.addPreloadImages=function(a,b,c){a.map(function(a){var d={id:a.icon,image:b+a.icon+".png",type:"pixi"};c.push(d)})},n.enterState=function(){this.app.music=["Music_Canvas_Loop_A","Music_Canvas_Loop_B"].shuffle()[0],this.backButton=document.getElementById("back"),this.backButtonStyle={width:77,height:72},this.onResize(this.app.realWidth,this.app.realHeight),this.disableSpringroll(),this.createTools(),this.app.isTutorialShown?(this.app.selectedImageIndex!=e.ArtBox||this.app.popInNCCoverAnim||createjs.Tween.get(this).wait(1e3).call(this.popInNCCoverAnim.bind(this)),this.colorPicker.toggleSlide(!0)):(this.currentTutorialIndex=0,this.app.isTutorialShown=!0,this.togglePointerEvents(document.getElementById("stickerbook-container"),"none"),this.updateAssets(),this.mainTools.disable(!0),this.startTutorial()),this.initStickerBook(),this.elapsedTime=0,this.playedSaveVO=!1,this.totalElapsedTime=0,this.minFPS=15,this.maxDropSecs=1,this.fpsDropSecs=0,this.frameCount=0,this.framerateTimer=0,this.app.on("update",this.update),this.app.on("resize",this.onResize),this.backButton.addEventListener("click",this.onBack),this.app.sizeDrawn=!0},n.updateAssets=function(){var a=this.app.getCache("game-json");a.Stickers&&(e.Stickers=a.Stickers.concat(e.Stickers)),a.Canvases&&(e.Canvases=a.Canvases.concat(e.Canvases))},n.startTutorial=function(){this.app.isTutorialOn=!0,createjs.Tween.get(this).wait(1250).call(this.onTutorial.bind(this))},n.nextTutorial=function(a){this.app.isTutorialOn&&(this.currentTutorialIndex=a,this.currentTutorialIndex<this.tutorial.length?this.onTutorial():(this.mainTools.enable(!0),this.removeArrow(),this.isFirstTutorialFinish=!0,this.app.isTutorialOn=!1,this.app.isTutorialPlaying=!1,this.togglePointerEvents(document.getElementById("stickerbook-container"),"auto"),this.removeDaisyAnim(),this.elapsedTime=0))},n.onTutorial=function(){var a=this.tutorial[this.currentTutorialIndex];this.app.isTutorialPlaying=!0,this.app.voPlayer.stop(),a.type==l.TUTORIAL.MainTools?(this.app.selectedImageIndex==e.ArtBox?this.popInNCCoverAnim():this.popInNCAnim(),this.mainTools.enable(!1,e.Tools.Brushes,!0),this.pointArrow(142,660,0,-20,-90,this.panel.container)):a.type==l.TUTORIAL.SecondaryTools?(this.pointArrow(345,546,0,-20,-90,this.panel.container),this.secondaryTools.toggleSlide(!0),this.removeNCAnim(),this.app.isTutorialPlaying=!1):a.type==l.TUTORIAL.Colors?(this.pointArrow(925,200,-20,0,-180,this.panel.gameLayer),this.colorPicker.toggleSlide(!0),this.colorPicker.disableSlider(),this.popInDaisyAnim()):a.type==l.TUTORIAL.Slider&&(this.pointArrow(925,590,0,-80,-180,this.panel.gameLayer,600),this.removeDaisyAnim(),this.colorPicker.toggleSlide(!0),this.app.voPlayer.play(a.vo),this.colorPicker.enableSlider())},n.removeHalAnim=function(){this.halPopInAnim&&(this.app.animator.stop(this.halPopInAnim),createjs.Tween.get(this.halPopInAnim,{loop:!1}).to({x:this.halPopInAnim.x+this.halPopInAnim.width},250,createjs.Ease.quadOut).call(this.removeHal.bind(this))),this.onAnimCancelled()},n.removeHal=function(){this.halPopInAnim&&this.halPopInAnim.parent&&this.halPopInAnim.parent.removeChild(this.halPopInAnim),this.halPopInAnim=null,this.app.popInHalAnim&&this.app.unload(this.app.config.data.popins.hal)},n.removeNCAnim=function(){this.ncPopInAnim&&(this.app.animator.stop(this.ncPopInAnim),createjs.Tween.get(this.ncPopInAnim,{loop:!1}).to({x:this.ncPopInAnim.x-this.ncPopInAnim.width},250,createjs.Ease.quadOut).call(this.removeNC.bind(this))),this.onAnimCancelled()},n.removeNC=function(a){this.ncPopInAnim&&this.ncPopInAnim.parent&&this.ncPopInAnim.parent.removeChild(this.ncPopInAnim),this.ncPopInAnim=null,this.app.popInNCAnim&&this.app.unload(this.app.config.data.popins.ncMain),this.app.popInNCBgsAnim&&this.app.unload(this.app.config.data.popins.ncBgs),this.app.popInNCCoverAnim&&this.app.unload(this.app.config.data.popins.ncCover)},n.removeSqueaksAnim=function(){this.squeaksPopInAnim&&(this.app.animator.stop(this.squeaksPopInAnim),createjs.Tween.get(this.squeaksPopInAnim,{loop:!1}).to({y:this.squeaksPopInAnim.y-this.squeaksPopInAnim.height},250,createjs.Ease.quadOut).call(this.removeSqueaks.bind(this))),this.onAnimCancelled()},n.removeSqueaks=function(){this.squeaksPopInAnim&&this.squeaksPopInAnim.parent&&this.squeaksPopInAnim.parent.removeChild(this.squeaksPopInAnim),this.squeaksPopInAnim=null,this.app.popInSqueaksAnim&&this.app.unload(this.app.config.data.popins.squeaks)},n.removeDaisyAnim=function(){this.daisyPopInAnim&&(this.app.animator.stop(this.daisyPopInAnim),createjs.Tween.get(this.daisyPopInAnim,{loop:!1}).to({y:this.daisyPopInAnim.y+this.daisyPopInAnim.height},250,createjs.Ease.quadOut).call(this.removeDaisy.bind(this))),this.onAnimCancelled()},n.removeDaisy=function(a){this.daisyPopInAnim&&this.daisyPopInAnim.parent&&(this.daisyPopInAnim.parent.removeChild(this.daisyPopInAnim),this.app.voPlayer.play("NAB_Tutorial_Options_Tool_Bar_1_Daisy")),this.daisyPopInAnim=null,this.app.popInDaisyAnim&&this.app.unload(this.app.config.data.popins.daisy)},n.popInHalAnim=function(){this.app.popInHalAnim||(this.app.popInHalAnim=!0,this.app.disableAnims?this.delayedCall(500,"NAB_Pop_In_Animation_Toolbar_Mud_Betters_Hal"):(this.halPopInAnim=new k(this.app.getCache("hal-mud-anim")),this.panel.gameLayer.addChild(this.halPopInAnim),this.app.animator.play(this.halPopInAnim,{anim:"pop",audio:{alias:"NAB_Pop_In_Animation_Toolbar_Mud_Betters_Hal",start:100}},this.removeHalAnim.bind(this),this.removeHalAnim.bind(this)),this.halPopInAnim.anchor.set(1,0),this.halPopInAnim.x=1024),this.app.isTutorialPlaying=!0,this.app.voPlayer.stop())},n.onAnimComplete=function(){this.removeNCAnim(),this.app.voPlayer.play(["NAB_Art_Box_Cover_2_Daisy","NAB_Art_Box_Cover_3_Squeeks","NAB_Art_Box_Cover_4_Hal"]),this.app.isTutorialPlaying=!1},n.popInDaisyAnim=function(){this.app.popInDaisyAnim||(this.app.popInDaisyAnim=!0,this.app.disableAnims?this.delayedCall(500,"NAB_Pop_In_Animation_Options_Tool_Bar_Daisy"):(this.daisyPopInAnim=new k(this.app.getCache("daisy-color-anim")),this.panel.container.addChild(this.daisyPopInAnim),this.app.animator.play(this.daisyPopInAnim,{anim:"pop",audio:{alias:"NAB_Pop_In_Animation_Options_Tool_Bar_Daisy",start:600}},this.removeDaisyAnim.bind(this),this.removeDaisyAnim.bind(this)),this.daisyPopInAnim.anchor.set(.5,1),this.daisyPopInAnim.x=512,this.daisyPopInAnim.y=768),this.app.isTutorialPlaying=!0,this.app.voPlayer.stop())},n.popInSqueaksAnim=function(){this.app.popInSqueaksAnim||(this.app.popInSqueaksAnim=!0,this.app.disableAnims?this.delayedCall(500,"NAB_Pop_In_Animation_Stickers_Squeeks"):(this.squeaksPopInAnim=new k(this.app.getCache("squeaks-stickers-anim")),this.panel.container.addChild(this.squeaksPopInAnim),this.app.animator.play(this.squeaksPopInAnim,{anim:"pop",audio:{alias:"NAB_Pop_In_Animation_Stickers_Squeeks",start:1300}},this.removeSqueaksAnim.bind(this),this.removeSqueaksAnim.bind(this)),this.squeaksPopInAnim.anchor.set(.5,0),this.squeaksPopInAnim.x=512),this.app.isTutorialPlaying=!0,this.app.voPlayer.stop())},n.popInNCAnim=function(){this.app.popInNCAnim||(this.app.popInNCAnim=!0,this.app.disableAnims?this.delayedCall(500,"NAB_Tutorial_1_NC"):(this.ncPopInAnim=new k(this.app.getCache("nc-main-anim")),this.panel.leftLayer.addChild(this.ncPopInAnim),this.app.animator.play(this.ncPopInAnim,{anim:"pop",audio:{alias:"NAB_Tutorial_1_NC",start:500}},this.removeNCAnim.bind(this),this.removeNCAnim.bind(this))),this.app.isTutorialPlaying=!0)},n.delayedCall=function(a,b){createjs.Tween.get(this).wait(a).call(this.playVO.bind(this,b))},n.playVO=function(a){this.app.voPlayer.play(a,this.onAnimCancelled.bind(this),this.onAnimCancelled.bind(this))},n.onAnimCancelled=function(){this.app.voPlayer.stop(),this.app.captions.stop(),this.app.isTutorialPlaying=!1},n.popInNCBgsAnim=function(){this.app.popInNCBgsAnim||(this.app.disableAnims?this.delayedCall(500,"NAB_Pop_In_Toolbar_Backgrounds_Intro_NC"):(this.app.popInNCBgsAnim=!0,this.ncPopInAnim=new k(this.app.getCache("nc-bgs-anim")),this.panel.leftLayer.addChild(this.ncPopInAnim),this.app.animator.play(this.ncPopInAnim,{anim:"pop",audio:{alias:"NAB_Pop_In_Toolbar_Backgrounds_Intro_NC",start:200}},this.removeNCAnim.bind(this),this.removeNCAnim.bind(this))),this.app.isTutorialPlaying=!0,this.app.voPlayer.stop())},n.popInNCCoverAnim=function(){this.app.popInNCCoverAnim||(this.app.popInNCCoverAnim=!0,this.app.disableAnims?this.app.voPlayer.play("NAB_Art_Box_Cover_1_NC",this.onAnimComplete.bind(this),this.onAnimCancelled.bind(this)):(this.ncPopInAnim=new k(this.app.getCache("nc-cover-anim")),this.panel.leftLayer.addChild(this.ncPopInAnim),this.app.animator.play(this.ncPopInAnim,{anim:"pop",audio:{alias:"NAB_Art_Box_Cover_1_NC",start:700}},this.onAnimComplete.bind(this),this.onAnimCancelled.bind(this))),this.app.isTutorialPlaying=!0)},n.createTools=function(){this.mainTools=new h(this.app,{width:1366,height:133,"class":"main-tools-canvas","z-index":20}),this.mainTools.signal.on("onCallBack",this.onToolsCallback),this.secondaryTools=new j(this.app,{width:854,height:164,"class":"secondary-tools-canvas","z-index":10}),this.secondaryTools.signal.on("onCallBack",this.onToolsCallback),this.colorPicker=new i(this.app,{width:96,height:642,"class":"color-picker-canvas","z-index":30}),this.colorPicker.signal.on("onCallBack",this.onToolsCallback),this.colorPicker.slider.signal.on("onCallBack",this.onToolsCallback)},n.onToolsCallback=function(a){if(this.stickerbook){switch(a.type){case h.ON_BRUSH_SELECT:case j.ON_BRUSH_SELECT:var b={};if(a.options){if(a.options.image)b.image=e.Host+e.BrushesPath+a.options.image+".png";else if(a.options.images){var d=[];a.options.images.map(function(a){d.push(e.Host+e.StampsPath+a+".png")}),b.images=d,b.spreadDistance=a.options.spreadDistance}b.config=a.options}a.name==e.Tools.Mud?this.colorPicker.switchMode(i.Mode.FLAT_ICONS):this.colorPicker.switchMode(i.Mode.EMBOSS_ICONS),this.stickerbook.setBrush(a.name.toLowerCase(),b),a.name==e.Tools.Mica||a.name==e.Tools.Stamp?(this.colorPicker.toggleSlide(!1),this.colorPicker.disableColors(),this.colorPicker.disableSlider()):a.name==e.Tools.Mud||a.name==e.Tools.Berries?(this.colorPicker.enableColors(),this.colorPicker.enableSlider()):(this.colorPicker.toggleSlide(!0),
a.name==e.Tools.Eraser?this.colorPicker.disableColors():this.colorPicker.enableColors(),this.colorPicker.enableSlider()),this.secondaryTools.toggleSlide(!1),this.removeHalAnim(),this.removeSqueaksAnim(),this.nextTutorial(2),new springroll.DelayedCall(this.playEncouragementVO.bind(this),500);break;case h.ON_BRUSHES_SELECT:if(!this.secondaryTools)return;this.removeNCAnim(),this.secondaryTools.setItems(a.name),this.secondaryTools.toggleSlide(!0),this.nextTutorial(1),a.name==e.Tools.Stickers?this.app.popInSqueaksAnim?this.app.voPlayer.play("NAB_Toolbar_Stickers_Displayed_Daisy"):this.popInSqueaksAnim():a.name==e.Tools.Splats?this.popInHalAnim():a.name==e.Tools.Canvases&&this.popInNCBgsAnim(),this.app.isTutorialOn||this.removeArrow();break;case c.ON_BRUSH_SIZE_CHANGE:this.stickerbook.setBrushWidth(a.size),this.nextTutorial(4);break;case j.ON_STICKER_SELECT:this.stickerbook._config.stickers.defaults||(this.stickerbook._config.stickers.defaults={});var f=Math.min(.5,.5*(this.app.scaling.scale/window.devicePixelRatio));this.stickerbook._config.stickers.defaults.xScale=f,this.stickerbook._config.stickers.defaults.yScale=f,this.stickerbook.setSticker(e.Host+e.StickersPath+a.name+".png"),this.colorPicker.toggleSlide(!1),this.colorPicker.disableColors(),this.colorPicker.disableSlider(),this.secondaryTools.toggleSlide(!1),this.removeSqueaksAnim();break;case j.ON_CANVAS_SELECT:this.imageName=a.name,this.stickerbook.setBackground(e.Host+e.CanvasesPath+a.name+".png"),this.colorPicker.toggleSlide(!1),this.secondaryTools.toggleSlide(!1),this.removeNCAnim(),a.vo&&this.app.voPlayer.play(a.vo),this.justNowSaved=!1;break;case i.ON_COLOR_CHANGE:this.stickerbook.setColor(a.color),this.nextTutorial(3);break;case h.ON_SAVE:this.removeArrow(),this.saveCanvas(),this.app.selectedImageIndex==e.ArtBox?this.app.voPlayer.play("NAB_Save_Cover_Popup_NC"):this.app.voPlayer.play("NAB_Save_Pop_Up_Daisy");break;case h.ON_RESET:this.stickerbook.clear(),this.removeSpider(),this.secondaryTools.reset();break;case j.ON_SPIDER_SELECT:this.addSpider(),a.edit?(this.colorPicker.takeSnap(),this.colorPicker.disableColors(),this.colorPicker.disableSlider()):this.colorPicker.applySnap();break;case j.ON_ANIMATED_STICKER_SELECT:this.stickerbook._config.stickers.defaults||(this.stickerbook._config.stickers.defaults={}),a.options.scale||(a.options.scale=.5),f=Math.min(a.options.scale,a.options.scale*(this.app.scaling.scale/window.devicePixelRatio)),this.stickerbook._config.stickers.defaults.xScale=f,this.stickerbook._config.stickers.defaults.yScale=f,this.setAnimatedSticker(a.options),this.colorPicker.disableColors(),this.colorPicker.disableSlider(),this.colorPicker.toggleSlide(!1),this.secondaryTools.toggleSlide(!1);break;case h.ON_OVER:this.cursorSpirte&&this.cursorSpirte.visible&&(this.cursorSpirte.visible=!1)}this.elapsedTime=0}},n.setAnimatedSticker=function(a){var b=this.stickerbook;return new Promise(function(c){fabric.Sprite.fromURL(e.Host+"assets/images/animated-stickers/"+a.spriteSheet+".png",function(a){b._setState({sticker:a,drawing:!1,_stickerAdded:!1}),c(b)},{width:a.width,height:a.height,move:a.move,flash:a.flash,ename:a.ename})})},n.saveCanvas=function(){this.stickerbook.deselectAll();var a=document.createElement("canvas");a.width=this.stickerbook._canvas.lowerCanvasEl.width,a.height=this.stickerbook._canvas.lowerCanvasEl.height;var b=a.getContext("2d");b.drawImage(this.stickerbook._canvas.lowerCanvasEl,0,0),this.spider&&b.drawImage(this.spider.canvas,0,0),this.dataUrl=a.toDataURL(),b.drawImage(this.stickerbook.backgroundManager._canvas,0,0),b.drawImage(this.stickerbook._canvas.lowerCanvasEl,0,0),this.spider&&b.drawImage(this.spider.canvas,0,0);var c=new PIXI.Texture(PIXI.BaseTexture.fromImage(a.toDataURL()));c.width>0?this.onTextureUpdate(c):c.on("update",this.onTextureUpdate),this.enableSpringrollPointerEvents()},n.onTextureUpdate=function(a){var b=a;b.width<=0||this.showSavePopup(b)},n.savePNG=function(a){var b="nature-art-box.png";a.toBlobHD(function(a){saveAs(a,b)},"image/png")},n.addSpider=function(){return this.spider?void this.spider.toggleEdit():(this.spider=new d(this.app),void this.spider.signal.on("onCallBack",this.onSpiderCallback))},n.removeSpider=function(){this.spider&&(this.spider.signal.off("onCallBack",this.onSpiderCallback),this.spider.clear(),this.spider=null)},n.onSpiderCallback=function(){this.secondaryTools&&(this.secondaryTools.spiderEdit=!1,this.colorPicker.applySnap())},n.togglePointerEvents=function(a,b){fabric.util.setStyle(a,{"pointer-events":b})},n.enableSpringrollPointerEvents=function(){this.togglePointerEvents(document.getElementById("stage"),"auto")},n.disableSpringrollPointerEvents=function(){this.togglePointerEvents(document.getElementById("stage"),"none")},n.enableSpringroll=function(){var a=document.getElementById("stage");fabric.util.setStyle(a,{"pointer-events":"auto",position:"relative","z-index":40}),document.getElementById("stickerbook-container").classList.add("hidden")},n.disableSpringroll=function(){var a=document.getElementById("stage");fabric.util.setStyle(a,{"pointer-events":"none",position:"absolute","z-index":40}),document.getElementById("stickerbook-container").classList.remove("hidden")},n.getCanvases=function(){var a=[];return e.Canvases.map(function(b){var c=e.Host+e.CanvasesPath+b.name+".png";a.push(c)}.bind(this)),a.push(e.Host+e.CanvasesPath+"art-box.png"),a.push(e.Host+e.CanvasesPath+"white.png"),a},n.getStickers=function(){var a=[];return e.Stickers.map(function(b){var c=e.Host+e.StickersPath+b.name+".png";a.push(c)}.bind(this)),a},n.initStickerBook=function(){var a=window.Stickerbook;e.Host=location.toString().replace("index.html","").split("?")[0].split("?")[0];var b={container:document.getElementById("stickerbook-canvas-container"),stickers:{enabled:this.getStickers(),controls:{cornerColor:"rgba(0,0,0,0.5)",cornerSize:20,hasBorders:!0}},brush:{widths:[1,10,20,30,40,50,60,70,80,90,100],enabled:["eraser","bitmap","bitmap-eraser","fill","marker","pattern","pencil","spray","mud","berries","crayon","nature","stamp","mica"],colors:[e.Colors.Green,e.Colors.Blue,e.Colors.Brown,e.Colors.Grey,e.Colors.Yellow,e.Colors.Red,e.Colors.LightBrown,e.Colors.White,e.Colors.Grey,e.Colors.Black,e.Colors.Color1,e.Colors.Color2,e.Colors.Color3,e.Colors.Color4,e.Colors.Color5,e.Colors.Color6,e.Colors.Color7,e.Colors.Color8],custom:{mud:MudBrush,berries:BerriesSplat,crayon:CrayonBrush,nature:NatureBrush,stamp:Stamp,mica:Mica}},mobileEnabled:!0,useDefaultEventHandlers:!0},c=this.app.selectedImageIndex;b.background={enabled:this.getCanvases()};var d="NAB_DRAWING_"+this.app.selectedImageIndex,f=null;this.app.saveData[d]&&(f=this.app.saveData[d]),this.imageName=null,f&&f.imageName?(this.imageName=f.imageName,b.background["default"]=e.Host+e.CanvasesPath+f.imageName+".png"):(c>=0?c=this.app.config.data.gallery[c].name:-1==c&&(this.imageName=c="white"),b.background["default"]=e.Host+e.CanvasesPath+c+".png"),this.stickerbook=new a(b),this.stickerbook.availableBrushes.mud=MudBrush,this.stickerbook.availableBrushes.crayon=CrayonBrush,this.stickerbook.availableBrushes.nature=NatureBrush,this.stickerbook.availableBrushes.stamp=Stamp,this.stickerbook.availableBrushes.berries=BerriesSplat,this.stickerbook.availableBrushes.mica=Mica,this.stickerbook.backgroundManager.setPositioning("fit-height"),this.stickerbook.setColor(e.Colors.Brown),this.stickerbook.setBrushWidth(30),this.stickerbook.setBrush("crayon"),this.stickerbook.on("mouse:down",this.onMouseDown),this.stickerbook.on("mouse:up",this.onMouseUp),this.stickerbook.on("mouse:move",this.onMouseMove),this.stickerbook.on("object:moving",this.onStickerRemove),this.stickerbook.on("object:modified",this.onStickerModify),this.stickerbook.on("draw:complete",this.onDrawComplete),this.stickerbook._canvas.app=this.app;var g=this.app.db.getCollection("gallery"),h=g.findOne({name:d});if(h){var i=JSON.parse(h.dataUrl);fabric.Image.fromURL(i,function(a){a.set({selectable:!1}),this.stickerbook._canvas.add(a),this.stickerbook._canvas.renderAll()}.bind(this))}},n.setCursor=function(a){if(!this.app.hasTouch)if(this.stickerbook.state.drawing&&this.stickerbook.state.brushConfig&&this.stickerbook.state.brushConfig.config&&this.stickerbook.state.brushConfig.config.image&&"crayon"!=this.stickerbook.state.brushConfig.config.image){this.stickerbook._canvas.upperCanvasEl.style.cursor="none";var b=this.stickerbook._canvas.getPointer(),c=this.panel.cursorContainer.toLocal(b);this.cursorSpirte||(this.cursorAtlas=this.app.getCache("cursor-atlas"),this.cursorSpirte=new PIXI.Sprite,this.cursorSpirte.anchor.set(.5,.4),this.panel.cursorContainer.addChild(this.cursorSpirte)),this.stickerbook.state.brushConfig.config.anchorY?this.cursorSpirte.anchor.set(.5,this.stickerbook.state.brushConfig.config.anchorY):this.cursorSpirte.anchor.set(.5,.4);var d=window.devicePixelRatio||1;this.cursorSpirte.x=c.x*d,this.cursorSpirte.y=c.y*d,this.cursorSpirte.texture=this.cursorAtlas.getFrame(this.stickerbook.state.brushConfig.config.image),this.cursorSpirte.visible||(this.cursorSpirte.visible=!0),this.cursorSpirte.scale.set(.01*this.stickerbook.state.brushWidth)}else this.stickerbook._canvas.upperCanvasEl.style.cursor=a,this.cursorSpirte&&this.cursorSpirte.visible&&(this.cursorSpirte.visible=!1)},n.onJSONDataLoad=function(){this.stickerbook._canvas.renderAll()},n.onMouseMove=function(){this.stickerbook._canvas.isDrawingMode&&this.setCursor(this.stickerbook._canvas.freeDrawingCursor),this.app.sound.isPlaying("Eraser_Loop")||(this.drawing&&this.stickerbook.state.drawing&&this.stickerbook.state.brush==e.Tools.Eraser&&this.app.sound.play("Eraser_Loop"),this.elapsedTime=0)},n.onMouseUp=function(){this.drawing=!1,this.app.sound.stop("Eraser_Loop"),this.elapsedTime=0,this.justNowSaved=!1,this.isFirstTutorialFinish&&(this.isFirstTutorialFinish=!1,this.app.voPlayer.play("NAB_Toolbar_Main_Rollover_Special_Effects_NC"),this.pointArrow(142,650,580,0,-90,this.panel.container,3100),createjs.Tween.get(this,{override:!0}).wait(3100).call(this.removeArrow.bind(this)).call(this.addArrow.bind(this,1))),this.app.sizeDrawn=!0,this.stickerbook.state.brush!=e.Tools.Eraser||this.stickerbook._canvas.getActiveObject()||this.makeAFabricObject(!1)},n.onDrawComplete=function(){this.stickerbook.state.drawing&&this.makeAFabricObject(!1)},n.deselectAll=function(){for(var a=this.stickerbook._canvas.getObjects(),b=a.length,c=0;b>c;c++)a[c].set("active",!1);this.stickerbook._canvas.renderAll()},n.makeAFabricObject=function(a){var b,c,d=0,e=this.stickerbook._canvas.getObjects("sprite");for(b=e.length,d=0;b>d;d++)a?e[d].stop():this.stickerbook._canvas.remove(e[d]);for(d=0;d<this.sparkles.length;d++)c=this.sparkles[d],"sparkle"==c.name&&this.stickerbook._canvas.remove(c);this.deselectAll(),this.tmpCanvasEl||(this.tmpCanvasEl=fabric.util.createCanvasElement(),this.tmpCtx=this.tmpCanvasEl.getContext("2d")),this.tmpCanvasEl.width=this.stickerbook._canvas.lowerCanvasEl.width,this.tmpCanvasEl.height=this.stickerbook._canvas.lowerCanvasEl.height,this.tmpCtx.clearRect(0,0,this.tmpCanvasEl.width,this.tmpCanvasEl.height),this.tmpCtx.drawImage(this.stickerbook._canvas.lowerCanvasEl,0,0),this.tmpCtx.drawImage(this.stickerbook._canvas.upperCanvasEl,0,0);var f=new fabric.Image(this.tmpCanvasEl);if(f.set({selectable:!1}),this.stickerbook.clear(),this.stickerbook._canvas.add(f),this.stickerbook._canvas.renderAll(),!a){for(d=0;d<this.sparkles.length;d++)c=this.sparkles[d],"sparkle"==c.name&&this.stickerbook._canvas.add(c);for(d=0;b>d;d++){var g=e[d];g.trace&&(g.trace.reset(),this.stickerbook._canvas.add(g.trace))}for(d=0;b>d;d++)this.stickerbook._canvas.add(e[d])}},n.onStickerModify=function(a){var b=a.target;b.modified&&(b.modified=!1),this.elapsedTime=0},n.onStickerRemove=function(a){var b=a.target;b.modified||(b.modified=!0,this.app.sound.play("Sticker_Remove_1")),this.elapsedTime=0},n.onMouseDown=function(a){this.drawing=!0,this.elapsedTime=0,this.app.isTutorialOn||(this.mainTools.toggleSlide(!1),this.secondaryTools.toggleSlide(!1),this.colorPicker.toggleSlide(!1)),this.stickerbook.state.brush==e.Tools.Mica&&this.secondaryTools.restrictSpecialEffects(e.Tools.Mica);var b=this.stickerbook.getTopSticker(),c=this.stickerbook._canvas.getActiveObject();if(c||this.stickerbook.state.drawing||this.stickerbook.state.sticker.clone(this.onStickerClone.bind(this,this.stickerbook._canvas.getPointer(a.e))),b&&(!b||b.active)){if(!b.isSoundPlayed&&(this.app.sound.play("Sticker_Place_"+["A","B"].shuffle()[0]),b.isSoundPlayed=!0,b.name="sticker",b.set({left:b.left,top:b.top}),b instanceof fabric.Sprite)){if(b.move){var d=Math.randomFloat(10)>4?e.Direction.Left:e.Direction.Right;this.dirCount||(this.dirCount=0),this.prevDir&&this.prevDir==d&&this.dirCount++,this.dirCount>=2&&(d==e.Direction.Left?d=e.Direction.Right:d==e.Direction.Right&&(d=e.Direction.Left),this.dirCount=0),this.prevDir=d,b.set({originX:"center",originY:"center",scaleY:d==e.Direction.Left?-b.scaleY:b.scaleY,angle:d==e.Direction.Left?180:0}),b.setControlVisible("mtr",!1)}b.setControlVisible("tl",!1),b.setControlVisible("bl",!1),b.setControlVisible("br",!1),b.setControlVisible("tr",!1),b.lockScalingX=b.lockScalingY=!0,b.play(),this.secondaryTools.restrictSpecialEffects(b.options.ename)}b.setControlVisible("ml",!1),b.setControlVisible("mt",!1),b.setControlVisible("mb",!1),b.setControlVisible("mr",!1)}},n.onStickerClone=function(a,b){b.set({left:a.x,top:a.y,transparentCorners:!1,cornerSize:20,cornerColor:"rgba(0,0,0,0.5)",hasBorders:!0}),b.setControlVisible("ml",!1),b.setControlVisible("mt",!1),b.setControlVisible("mb",!1),b.setControlVisible("mr",!1),this.stickerbook._canvas.add(b),this.stickerbook._canvas.setActiveObject(b),this.app.sound.play("Sticker_Place_"+["A","B"].shuffle()[0]),b.isSoundPlayed=!0},n.playEncouragementVO=function(){this.app.voPlayer.playing||this.app.isTutorialOn||this.app.voPlayer.play(["NAB_Random_Encourage_A_NC","NAB_Random_Encourage_B_Squeeks","NAB_Random_Encourage_C_Daisy","NAB_Random_Encourage_D_Hal","NAB_Random_Encourage_E_NC","NAB_Random_Encourage_F_Squeeks","NAB_Random_Encourage_G_Daisy","NAB_Random_Encourage_H_Hal"].shuffle()[0])},n.playInActivityVO=function(){if(!this.app.voPlayer.playing){var a="NAB_Save_Pop_Up_Inactivity_Daisy";if(!this.savePopup||!this.savePopup.parent){var b=[{vo:"NAB_Random_Inactivity_A_NC",time:3e3},{vo:"NAB_Random_Inactivity_B_Squeeks",time:3e3},{vo:"NAB_Random_Inactivity_C_Daisy",time:4e3},{vo:"NAB_Random_Inactivity_E_NC",time:3e3},{vo:"NAB_Random_Inactivity_F_Squeeks",time:1e3},{vo:"NAB_Random_Inactivity_G_Daisy",time:2e3},{vo:"NAB_Random_Inactivity_H_Hal",time:3e3}].shuffle()[0];createjs.Tween.get(this,{override:!0}).wait(b.time).call(this.addArrow.bind(this,-1)).wait(3100).call(this.removeArrow.bind(this)),a=[b.vo,"NAB_Random_Inactivity_D_Hal"]}this.playingInActivityVO=!0,this.app.voPlayer.play(a,this.onInActivityVOComplete.bind(this))}},n.addArrow=function(a){var b=[142,362,480,590,710];b=0>a?b.shuffle()[0]:b[a],this.pointArrow(b,660,0,-20,-90,this.panel.container)},n.onInActivityVOComplete=function(){this.playingInActivityVO=!1,this.removeArrow()},n.update=function(a){if(this.frameCount++,this.framerateTimer+=a,this.framerateTimer>=1e3){var b=1e3/this.framerateTimer*this.frameCount;b.toFixed(3)<this.minFPS?(this.fpsDropSecs+=1,this.fpsDropSecs>=this.maxDropSecs&&this.makeAFabricObject(!0)):this.fpsDropSecs=0,this.framerateTimer=0,this.frameCount=0}var c=a/1e3;this.totalElapsedTime+=c,this.playingInActivityVO||this.app.isTutorialOn||(this.elapsedTime+=c),this.elapsedTime>this.app.config.data.inActivityTime&&(this.elapsedTime=0,this.playInActivityVO()),this.totalElapsedTime>=this.app.config.data.saveVOTime&&!this.playedSaveVO&&(this.playedSaveVO=!0,this.pointArrow(895,660,0,-20,-90,this.panel.container),this.app.voPlayer.play("NAB_Toolbar_Main_Rollover_Save_NC",this.removeArrow.bind(this))),this.animateGlitter()},n.animateGlitter=function(){if(this.stickerbook){this.sparkles=this.stickerbook._canvas.getObjects("image");for(var a=0;a<this.sparkles.length;a++){var b=this.sparkles[a];if("sparkle"==b.name){var c=b.get("angle");c+=b.angMult;var d=b.get("opacity");d-=b.alphaMult,0>=d?(d=0,b.alphaMult=-b.alphaMult):d>=1&&(d=1,b.alphaMult=-b.alphaMult),b.set({angle:c,opacity:d})}}this.stickerbook._canvas.renderAll()}},n.onResize=function(a,b){var c=document.getElementById("stickerbook-canvas-container");a=this.app.realWidth,b=this.app.realHeight,fabric.util.setStyle(c,{width:this.app.realWidth+"px",height:this.app.realHeight+"px"});var d=this.app.scaling.size.width/this.app.scaling.size.height,e=a/b,f=e>d?b/this.app.scaling.size.height:a/this.app.scaling.size.width,g=this.backButtonStyle.width*f,h=this.backButtonStyle.height*f;fabric.util.setStyle(this.backButton,{width:g+"px",height:h+"px"})},n.resize=function(a,b){var c=a/b,d=100/c|0,e=document.getElementById("stickerbook-canvas-container");e.style.width="100vw",e.style.height=d+"vw"},n.onBack=function(){this.app.sound.play("UI_Button_Tapped"),this.justNowSaved?this.previousState():(this.app.backPressed=!0,this.saveCanvas())},n.exitStart=function(){this.app.animator.stop(),this.app.voPlayer.stop()},n.exit=function(){this.app.animator.stop(),this.app.voPlayer.stop(),this.app.off("update",this.update),this.removeArrow(),this.removeSpider(),this.mainTools.signal.off("onCallBack",this.onToolsCallback),this.secondaryTools.signal.off("onCallBack",this.onToolsCallback),this.colorPicker.signal.off("onCallBack",this.onToolsCallback),this.colorPicker.slider.signal.off("onCallBack",this.onToolsCallback);for(var a=this.stickerbook._canvas.getObjects("sprite"),b=0;b<a.length;b++)a[b].stop(),a[b]=null;this.stickerbook.off("mouse:down",this.onMouseDown),this.stickerbook.off("object:moving",this.onStickerRemove),this.stickerbook.off("object:modified",this.onStickerModify),this.stickerbook._canvas.app=null,this.stickerbook.destroy(),delete this.stickerbook,this.colorPicker.clear(),this.colorPicker.destroy(),delete this.colorPicker,this.secondaryTools.clear(),this.secondaryTools.destroy(),delete this.secondaryTools,this.mainTools.clear(),this.mainTools.destroy(),delete this.mainTools,this.savePopup&&(this.savePopup.signal.off(f.ON_CALLBACK,this.onPopupCallback),this.savePopup.clear(),delete this.savePopup),this.cursorSpirte&&(this.cursorSpirte.parent.removeChild(this.cursorSpirte),this.cursorSpirte=null),this.backButton&&this.backButton.removeEventListener("click",this.onBack),this.enableSpringroll()},n.showSavePopup=function(a){this.savePopup||(this.savePopup=new f(this.panel),this.savePopup.x=512,this.savePopup.y=300,this.savePopup.signal.on(f.ON_CALLBACK,this.onPopupCallback)),this.panel.addScrim(),this.app.voPlayer.stop(),this.mainTools.interactiveChildren=!1,this.secondaryTools.interactiveChildren=!1,this.colorPicker.interactiveChildren=!1,this.savePopup.show(this.panel.container,a)},n.onPopupCallback=function(a){if(this.disableSpringrollPointerEvents(),this.panel.removeScrim(),this.mainTools.interactiveChildren=!0,this.secondaryTools.interactiveChildren=!0,this.colorPicker.interactiveChildren=!0,a==f.ON_SAVE){var b=JSON.stringify(this.dataUrl),c="NAB_DRAWING_"+this.app.selectedImageIndex;this.app.saveData[c]||(this.app.saveData[c]={}),this.app.saveData[c].imageName=this.imageName,this.app.save(),this.app.voPlayer.play("NAB_Save_Pop_Up_Saved_Daisy"),this.justNowSaved=!0;var d=this.app.db.getCollection("gallery"),e=d.findOne({name:c});e?(e.dataUrl=b,this.app.db.saveDatabase()):d.insert({name:c,dataUrl:b}),this.app.trackEvent("Canvas","Save"),this.app.trackEvent("Time",Math.floor(this.totalElapsedTime))}this.app.backPressed&&(this.previousState(),this.app.backPressed=!1)},n.removeArrow=function(){this.panel.arrow&&this.panel.arrow.parent&&(this.panel.arrow.clear(),this.panel.arrow.parent.removeChild(this.panel.arrow))},n.pointArrow=function(a,c,d,e,f,g,h){this.panel.arrow||(this.panel.arrow=new b(this.panel)),g.addChild(this.panel.arrow),this.panel.arrow.show(a,c,d,e,f,h)},n.destroy=function(){this.panel.destroy(),m.destroy.call(this)},namespace("nature_art_box").GameState=l}(),function(){var a=include("springroll.pixi.BaseState"),b=include("nature_art_box.IntroPanel"),c=function(c){a.call(this,new b,c),this.onPlay=this.onPlay.bind(this),this.buttonOver=this.buttonOver.bind(this),this.buttonOut=this.buttonOut.bind(this),this.onResize=this.onResize.bind(this),this.origScale=null},d=a.prototype,e=extend(c,a);e.enterState=function(){this.app.music="Music_Intro_And_Loading_Animation_Loop",this.panel.skipButton.on("buttonPress",this.onPlay),this.panel.skipButton.on("buttonOver",this.buttonOver),this.panel.skipButton.on("buttonOut",this.buttonOut),this.app.on("resize",this.onResize),this.introInterval=new springroll.DelayedCall(this.startIntroAnim.bind(this),1100)},e.startIntroAnim=function(){this.app.animator.play(this.panel.nc,{anim:"pop",audio:{alias:"NAB_Intro_Animation_1_NC",start:200}}),this.app.animator.play(this.panel.daisy,{anim:"pop",audio:{alias:"NAB_Intro_Animation_2_Daisy",start:4500}}),this.app.animator.play(this.panel.squeaks,{anim:"pop",audio:{alias:"NAB_Intro_Animation_3_Squeeks",start:11300}}),this.app.animator.play(this.panel.hal,{anim:"pop",audio:{alias:"NAB_Intro_Animation_4_Hal",start:15300}},this.onAnimComplete.bind(this)),this.mudSplatInterval=new springroll.DelayedCall(this.playMudPlatSFX.bind(this),19700),this.mudSplatInterval=new springroll.DelayedCall(this.playMudPlatSFX.bind(this),18400)},e.playMudPlatSFX=function(){this.app.sound.play("Mud_D")},e.onAnimComplete=function(){var a=this.app.getCache("intro-atlas");this.panel.background.texture=a.getFrame("Intro-bg1"),this.panel.container.removeChildren(),this.panel.addMudNC(),this.app.animator.play(this.panel.nc,{anim:"pop",audio:{alias:"NAB_Intro_Animation_5_NC",start:600}}),this.introInterval=new springroll.DelayedCall(this.onPlay.bind(this),2800)},e.onResize=function(){this.panel.skipButton.scale.set(this.app.scaling.scale)},e.buttonOver=function(){this.app.sound.play("Button_Rollover"),createjs.Tween.removeTweens(this.panel.skipButton);var a=50,b=2*(Math.PI/180);createjs.Tween.get(this.panel.skipButton,{loop:!0,override:!0}).to({rotation:b},a,createjs.Ease.linear).to({rotation:0},a,createjs.Ease.linear).to({rotation:-b},a,createjs.Ease.linear).to({rotation:0},a,createjs.Ease.linear)},e.buttonOut=function(){createjs.Tween.removeTweens(this.panel.skipButton),this.panel.skipButton.rotation=0},e.exitStart=function(){this.introInterval&&(this.introInterval.stop(),this.introInterval.destroy()),this.mudSplatInterval&&(this.mudSplatInterval.stop(),this.mudSplatInterval.destroy()),this.app.animator.stopAll(),this.app.voPlayer.stop(),createjs.Tween.removeTweens(this.panel.skipButton),createjs.Tween.removeTweens(this.panel.skipButton.scale),this.panel.skipButton.off("buttonPress",this.onPlay),this.panel.skipButton.off("buttonOver",this.buttonOver),this.panel.skipButton.off("buttonOut",this.buttonOut),this.app.off("resize",this.onResize),this.panel.skipButton.enabled=!1,this.panel.skipButton.interactive=!1},e.onPlay=function(){this.nextState()},e.exit=function(){this.app.animator.stopAll(),this.app.voPlayer.stop(),createjs.Tween.removeTweens(this.panel.skipButton),createjs.Tween.removeTweens(this.panel.skipButton.scale),this.panel.skipButton.off("buttonPress",this.onPlay),this.panel.skipButton.off("buttonOver",this.buttonOver),this.panel.skipButton.off("buttonOut",this.buttonOut),this.app.off("resize",this.onResize),this.panel.skipButton.enabled=!1,this.panel.skipButton.interactive=!1},e.destroy=function(){this.panel.destroy(),d.destroy.call(this)},namespace("nature_art_box").IntroState=c}(),function(){var a=include("springroll.pixi.BaseState"),b=include("nature_art_box.TitlePanel"),c=function(c){a.call(this,new b,c),this.onPlay=this.onPlay.bind(this),this.buttonOver=this.buttonOver.bind(this),this.buttonOut=this.buttonOut.bind(this),this.onResize=this.onResize.bind(this),this.origScale=null},d=a.prototype,e=extend(c,a);e.enterDone=function(){this.app.music="Music_Splash_Loop",this.app.sound.play("Ambient_bird_loop_1",{loop:-1}),this.panel.playButton.on("buttonPress",this.onPlay),this.panel.playButton.on("buttonOver",this.buttonOver),this.panel.playButton.on("buttonOut",this.buttonOut),this.app.on("resize",this.onResize),this.pulsate()},e.onResize=function(){this.stopPulsate(),this.panel.playButton.scale.set(this.app.scaling.scale),this.pulsate()},e.buttonOver=function(){this.app.sound.play("Button_Rollover"),this.stopPulsate(),createjs.Tween.removeTweens(this.panel.playButton);var a=50,b=2*(Math.PI/180);createjs.Tween.get(this.panel.playButton,{loop:!0,override:!0}).to({rotation:b},a,createjs.Ease.linear).to({rotation:0},a,createjs.Ease.linear).to({rotation:-b},a,createjs.Ease.linear).to({rotation:0},a,createjs.Ease.linear)},e.pulsate=function(){if(this.panel.playButton){this.origScale=this.panel.playButton.scale.x;var a=1.05*this.origScale,b=250;createjs.Tween.get(this.panel.playButton.scale,{loop:!0,override:!0}).wait(1500).to({x:a,y:a},b,createjs.Ease.sineIn).to({x:this.origScale,y:this.origScale},b,createjs.Ease.sineOut).to({x:a,y:a},b,createjs.Ease.sineIn).to({x:this.origScale,y:this.origScale},b,createjs.Ease.sineOut)}},e.stopPulsate=function(){this.panel.playButton&&(createjs.Tween.removeTweens(this.panel.playButton.scale),this.origScale&&this.panel.playButton.scale.set(this.origScale))},e.buttonOut=function(){createjs.Tween.removeTweens(this.panel.playButton),this.panel.playButton.rotation=0,this.pulsate()},e.exitStart=function(){createjs.Tween.removeTweens(this.panel.playButton),createjs.Tween.removeTweens(this.panel.playButton.scale),this.panel.playButton.off("buttonPress",this.onPlay),this.panel.playButton.off("buttonOver",this.buttonOver),this.panel.playButton.off("buttonOut",this.buttonOut),this.app.off("resize",this.onResize),this.panel.playButton.enabled=!1,this.panel.playButton.interactive=!1},e.onPlay=function(){this.app.isLowEndDevice=this.isLowEndDevice(),this.app.isLowEndDevice||this.app.isAndroid?(this.app.disableAnims=!0,this.previousState()):this.nextState()},e.isLowEndDevice=function(){var a=window.navigator.userAgent.toLowerCase();return this.app.isIOS&&parseInt(this.getiOSVersion(a),10)<11?!0:this.app.isAndroid&&parseFloat(this.getAndroidVersion())<=4.4?!0:!1},e.getiOSVersion=function(a){if(a=(a||navigator.userAgent).toLowerCase(),/(iPhone|iPod|iPad)/i.test(a)){var b=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return b?b[1]:0}return[0]},e.getAndroidVersion=function(a){a=(a||navigator.userAgent).toLowerCase();var b=a.match(/android\s([0-9\.]*)/);return b?b[1]:0},e.exit=function(){createjs.Tween.removeTweens(this.panel.playButton),createjs.Tween.removeTweens(this.panel.playButton.scale),this.panel.playButton.off("buttonPress",this.onPlay),this.panel.playButton.off("buttonOver",this.buttonOver),this.panel.playButton.off("buttonOut",this.buttonOut),this.app.off("resize",this.onResize),this.panel.playButton.enabled=!1,this.panel.playButton.interactive=!1},e.destroy=function(){this.panel.destroy(),d.destroy.call(this)},namespace("nature_art_box").TitleState=c}(),function(){var a=include("nature_art_box.TitleState"),b=include("nature_art_box.IntroState"),c=include("nature_art_box.CoverState"),d=include("nature_art_box.GameState"),e=include("nature_art_box.GalleryState"),f=include("springroll.Application"),g=include("springroll.PixiDisplay"),h="Game_Progress",i=new f({fps:60,name:"Nature Art Box",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",display:g,displayOptions:{clearView:!0,transparent:!0,antiAlias:!0},enableHiDPI:!0,preload:[{id:"saveData",cache:!1,async:function(a){i.userData.read(h,function(b){i.saveData=b,a()}.bind(this))}},{id:"loading-atlas",image:"assets/images/loading-atlas.png",atlas:"assets/images/loading-atlas.json",type:"pixi"},{id:"game-json",src:"assets/config/game.json"}]});i.save=function(){this.userData.write(h,this.saveData)},i.trackEvent=function(a,b){ga("send",{hitType:"event",eventCategory:"NAB",eventAction:a,eventLabel:b})},i.on("init",function(){this.saveData||(this.saveData={});var f=this.config.assets,g=this.config.scaling;this.manifests;this.states={title:new a({next:"intro",previous:"cover",preload:f.title,scaling:g.title}),intro:new b({next:"cover",previous:"title",preload:f.intro,scaling:g.intro}),cover:new c({next:"gallery",previous:"intro",preload:f.cover,scaling:g.cover}),gallery:new e({next:"game",previous:"cover",preload:f.gallery,scaling:g.gallery}),game:new d({previous:"gallery",preload:f.game,scaling:g.game})},this.sound.setContextVolume("music",this.config.data.musicVolume),this.sound.setContextVolume("sfx",this.config.data.sfxVolume),this.sound.setContextVolume("vo",this.config.data.voVolume),this.sound.addContext(this.config.sounds.birds),this.sound.setContextVolume("birds",this.config.data.birdCallsVolume),this.loadingAtlas=this.getCache("loading-atlas"),this.background=new PIXI.Sprite(this.loadingAtlas.getFrame("loading-bg")),this.background.anchor.set(.5),this.maxLetters=7,this.maxFrames=2,this.background.letters=this.config.data.letters;for(var h=0;h<this.maxLetters;h++){var i=this.background.letters[h],j=new PIXI.Sprite(this.loadingAtlas.getFrame(i.name+"-0"));j.name=i.name,j.anchor.set(.5),j.x=i.x,j.y=i.y,j.visible=!1,this.background.addChild(j),this.background.letters[h]=j}this.manager.on("onLoadingStart",this.onLoadingStart.bind(this)),this.db=new loki("nature_art_box.db",{autoload:!0,autoloadCallback:this.databaseInitialize.bind(this),autosave:!0,autosaveInterval:1e3})}),i.databaseInitialize=function(){var a=this.db.getCollection("gallery");null===a&&(a=this.db.addCollection("gallery"))},i.onLoadingStart=function(){this.resetLetters(),this.showLoading(),this.animateLoading(-1,-1)},i.resetLetters=function(){for(var a=0;a<this.maxLetters;a++){var b=this.background.letters[a];b.texture=this.loadingAtlas.getFrame(b.name+"-0"),b.visible=!1}},i.animateLoading=function(a,b){if(a>=0){if(this.background.letters[a].visible=!0,b>0){var c=this.background.letters[a];c.texture=this.loadingAtlas.getFrame(c.name+"-1")}this.sound.play("Mud_"+["A","B","C","D"].shuffle()[0])}createjs.Tween.removeTweens(this.background),createjs.Tween.get(this.background,{loop:!1,override:!0}).wait(0>=b?100+Math.randomFloat(200):350).call(this.fillComplete.bind(this,a,b))},i.fillComplete=function(a,b){return!this.manager.isLoading&&this.manager.currentState.enabled&&a>=this.maxLetters-1&&b>=this.maxFrames-1?(this.hideLoading(),void this.manager.currentState.enterState()):(b++,b>=this.maxFrames&&(b=0,a++,a>=this.maxLetters&&(a=0,this.resetLetters())),void this.animateLoading(a,b))},i.showLoading=function(){this.background&&this.display.stage.addChild(this.background)},i.hideLoading=function(){this.background&&this.background.parent&&this.display.stage.removeChild(this.background)},i.on("paused",function(){this.gamePaused=!0}),i.on("resumed",function(){this.gamePaused=!1}),window.app=i}();