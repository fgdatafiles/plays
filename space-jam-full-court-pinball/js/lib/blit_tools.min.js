var oTOUCHES=[];
function BlitInputs(wrapper_id){var me=this;var wrapper=document.getElementById(wrapper_id)||document.documentElement;me.has_tilt=false;me.using_tilt=false;me.still_frames=0;me.beta=0;me.lastbeta=0;me.alpha=0;me.lastalpha=0;me.tilt_x=0;me.tilt_y=0;me.allow_key_defaults=false;me.has_touch=false;me.touching=false;me.mouse_is_down=false;me.mouse_start_x=0;me.mouse_start_y=0;me.start_x=0;me.start_y=0;me.mouse_x=0;me.mouse_y=0;me.frames_down=0;me.using_keyboard=false;me.right=false;me.left=false;me.up=
false;me.dn=false;me.z=false;me.x=false;me.c=false;me.v=false;me.b=false;me.space=false;me.keys_down=[];me.propagation_prevention=1;this.doSetPropagationPrevention=function(new_level){me.propagation_prevention=new_level};this.doGetTouches=function(){return oTOUCHES};var doKeyDown=function(e){var key=e.which||e.keyCode||e.key;if(!me.allow_key_defaults)e.preventDefault();if(me.keys_down.indexOf(key)>=0)return;me.keys_down.push(key);me.using_keyboard=true;switch(key){case 39:me.right=true;me.right_pending=
true;break;case 37:me.left=true;me.left_pending=true;break;case 32:me.space=true;me.space_pending=true;break;case 38:me.up=true;me.up_pending=true;break;case 40:me.dn=true;me.dn_pending=true;break;case 90:me.z=true;me.z_pending=true;break;case 88:me.x=true;me.x_pending=true;break;case 67:me.c=true;me.c_pending=true;break;case 86:me.v=true;me.v_pending=true;break;case 66:me.b=true;me.b_pending=true;break}};var doKeyUp=function(e){var key=e.which||e.keyCode||e.key;if(!me.allow_key_defaults)e.preventDefault();
var i=me.keys_down.indexOf(key);if(i>=0)me.keys_down.splice(i,1);switch(key){case 39:me.right=false;break;case 37:me.left=false;break;case 32:me.space=false;me.space_rel_pending=true;break;case 38:me.up=false;break;case 40:me.dn=false;break;case 90:me.z=false;break;case 88:me.x=false;break;case 67:me.c=false;break;case 86:me.v=false;break;case 66:me.b=false;break}if(!me.allow_key_defaults)e.preventDefault()};var doMouseDown=function(e){if(!me.mouse_is_down){me.frames_down=0;me.mouse_is_down=true;
me.click_pending=true;me.mouse_x=(e.clientX-wrapper.offsetLeft)*oSTAGE.scale_inv|0;me.mouse_y=(e.clientY-wrapper.offsetTop)*oSTAGE.scale_inv|0;me.mouse_start_x=me.mouse_x;me.mouse_start_y=me.mouse_y;me.start_x=me.mouse_x;me.start_y=me.mouse_y;me.speed_x=0;me.speed_y=0;me.client_mouse_x=(e.clientX-wrapper.offsetLeft)*oSTAGE.scale_inv|0;me.client_mouse_y=(e.clientY-wrapper.offsetTop)*oSTAGE.scale_inv|0;me.client_mouse_start_x=me.client_mouse_x;me.client_mouse_start_y=me.client_mouse_y}};var doMouseMove=
function(e){me.client_mouse_x=(e.clientX-wrapper.offsetLeft)*oSTAGE.scale_inv|0;me.client_mouse_y=(e.clientY-wrapper.offsetTop)*oSTAGE.scale_inv|0;me.speed_x=me.client_mouse_x-me.mouse_x;me.speed_y=me.client_mouse_y-me.mouse_y;me.mouse_x=(e.clientX-wrapper.offsetLeft)*oSTAGE.scale_inv|0;me.mouse_y=(e.clientY-wrapper.offsetTop)*oSTAGE.scale_inv|0};var doMouseUp=function(e){me.mouse_is_down=false;me.release_pending=true;me.frames_down=0};function doHandleOrientation(event){var canHandleEvent=event;
if(!canHandleEvent)window.removeEventListener("deviceorientation",doHandleOrientation);else{var x=event.beta;var y=event.gamma;orient=window.orientation||window.mozOrientation||window.msOrientation;if(orient)if(orient===0)x=x;else if(orient===-90){x=-x;y=-y}else if(orient===90)x=x;else{if(orient===180){x=-x;y=-y}}else{orient=screen.orientation||screen.mozOrientation||screen.msOrientation;if(orient)switch(orient){case "portrait-primary":x=x;break;case "landscape-primary":x=x;break;case "landscape-secondary":x=
-x;y=-y;break;case "portrait-secondary":x=-x;y=-y;break}}if(x>90&&x<180)x=(x-180)*2;if(x<-90&&x>-180)x=(180+x)*2;me.tilt_x=x;me.tilt_y=y}}var doHandleMotion=function(event){trace("doHandleMotion");var canHandleEvent=event;if(!canHandleEvent)window.removeEventListener("devicemotion",doHandleMotion);else if(window.innerWidth>window.innerHeight)doTilt(-event.accelerationIncludingGravity.y*4,-event.accelerationIncludingGravity.z*4);else doTilt(event.accelerationIncludingGravity.x*4,-event.accelerationIncludingGravity.z*
4)};var doTilt=function(x,y){var orient;if(true){if(platform.isAndroid)x=-x;if(x>90)x=90;if(x<-90)x=-90;orient=window.orientation||window.mozOrientation||window.msOrientation;if(orient)if(orient===0)x=x;else if(orient===-90)x=-x;else if(orient===90)x=x;else{if(orient===180)x=-x}else{orient=screen.orientation||screen.mozOrientation||screen.msOrientation;if(orient)switch(orient){case "portrait-primary":x=x;break;case "landscape-primary":x=x;break;case "landscape-secondary":x=-x;break;case "portrait-secondary":x=
-x;break}}me.alpha=y;me.beta=x;return true}};var firstTouchId=-1;var findCurrentTouchIndex=function(id){for(var i=0;i<oTOUCHES.length;i++)if(oTOUCHES[i].id===id)return i;return-1};var doTouchStart=function(event){var touches=event.touches;if(event.touches)touches=event.touches;else if(event.targetTouches)touches=event.targetTouches;else if(event.pageX)touches=[event];for(var i=0;i<touches.length;i++){var touch=touches[i];var touch_id=touch.identifier;var touch_index=findCurrentTouchIndex(touch_id);
var touch_x=(touch.clientX-wrapper.offsetLeft)*oSTAGE.scale_inv;var touch_y=(touch.clientY-wrapper.offsetTop)*oSTAGE.scale_inv;if(touch_index==-1){oTOUCHES.push({id:touch.identifier,frames_down:0,mouse_is_down:true,click_pending:true,release_pending:false,my_x:touch_x,my_y:touch_y,speed_x:0,speed_y:0,start_x:touch_x,start_y:touch_y});if(oTOUCHES.length==1){firstTouchId=touch.identifier;me.touching=true;me.frames_down=0;me.mouse_is_down=true;me.click_pending=true;me.release_pending=false;me.mouse_x=
touch_x;me.mouse_y=touch_y;me.speed_x=0;me.speed_y=0;me.mouse_start_x=touch_x;me.mouse_start_y=touch_y}}}if(touch.target.prohibit_touch)event.preventDefault();var el=touch.target;while(el&&el!==document){if(el.id)if(el.id.indexOf("_evidon")!=-1||el.id.indexOf("_evh")!=-1){touch.target.allow_touch=true;break}el=el.parentNode}if(platform.isTouchDevice&&!touch.target.allow_touch&&me.propagation_prevention>=2)event.preventDefault()};var doTouchMove=function(event){var touches;if(event.changedTouches)touches=
event.changedTouches;else if(event.targetTouches)touches=event.targetTouches;else if(event.pageX)touches=[event];for(var i=0;i<touches.length;i++){var touch=touches[i];var touch_id=touch.identifier;var touch_index=findCurrentTouchIndex(touch_id);var touch_x=(touch.clientX-wrapper.offsetLeft)*oSTAGE.scale_inv;var touch_y=(touch.clientY-wrapper.offsetTop)*oSTAGE.scale_inv;var speed_x=touch_x-oTOUCHES[touch_index].my_x;var speed_y=touch_y-oTOUCHES[touch_index].my_y;oTOUCHES[touch_index].speed_x=speed_x;
oTOUCHES[touch_index].speed_y=speed_y;oTOUCHES[touch_index].my_x=touch_x;oTOUCHES[touch_index].my_y=touch_y;if(touch_id==firstTouchId){me.mouse_x=touch_x;me.mouse_y=touch_y;me.speed_x=speed_x;me.speed_y=speed_y}}var el=touch.target;while(el&&el!==document){if(el.id)if(el.id.indexOf("_evidon")!=-1||el.id.indexOf("_evh")!=-1){touch.target.allow_touch=true;break}el=el.parentNode}if(touch.target.prohibit_touch_scroll&&Math.abs(oTOUCHES[0].speed_x)>Math.abs(oTOUCHES[0].speed_y))event.preventDefault();
if(touch.target.prohibit_touch)event.preventDefault();if(touch.target.prohibit_touchmove||platform.isTouchDevice&&!touch.target.allow_touch&&me.propagation_prevention>=1)event.preventDefault()};var doTouchEnd=function(event){switch(event.type){case "touchend":case "touchcancel":case "MSPointerUp":var touches;if(event.changedTouches)touches=event.changedTouches;else if(event.targetTouches)touches=event.targetTouches;else if(event.pageX)touches=[event];for(var i=0;i<touches.length;i++){var touch=touches[i];
var touch_id=touch.identifier;var touch_index=findCurrentTouchIndex(touch_id);if(touch_id==firstTouchId)if(me.mouse_is_down){me.mouse_is_down=false;me.release_pending=true;me.frames_down=0;me.touching=false}if(touch_index!=-1)oTOUCHES.splice(touch_index,1)}}};window.onkeydown=doKeyDown;window.onkeyup=doKeyUp;wrapper.onmousedown=doMouseDown;wrapper.onmousemove=doMouseMove;window.onmouseup=document.onblur=doMouseUp;if(platform.isTouchDevice)if(window.navigator.msPointerEnabled){window.addEventListener("MSPointerDown",
doTouchStart,{passive:false,capture:false});window.addEventListener("MSPointerUp",doTouchEnd,{passive:false,capture:false})}else{window.addEventListener("touchstart",doTouchStart,{passive:false,capture:false});window.addEventListener("touchend",doTouchEnd,{passive:false,capture:false});window.addEventListener("touchmove",doTouchMove,{passive:false,capture:false})}};this.myNameSpace=this.myNameSpace||{};
(function(){var oSNDS={};function BlitSounds(){}BlitSounds.prototype={initialized:false,snd_queue:{},snd_counter:0,init:function(callback){if(this.initialized==false){this.initialized=true;this.mute=oUSER.is_mute;if(this.mute==0)createjs.Sound.muted=false;else createjs.Sound.muted=true;window.addEventListener("mousedown",__snds.enableSounds);return createjs.Sound.initializeDefaultPlugins()}},enableSounds:function(){if(createjs.Sound.activePlugin.context)if(createjs.Sound.activePlugin.context.state!="running")createjs.Sound.activePlugin.context.resume();
try{window.removeEventListener("mousedown",__snds.enableSounds)}catch(e){}},nextSound:function(e){var channel=e.target.channel;if(__snds.snd_queue[channel].length>0){var o=__snds.snd_queue[channel].shift();__snds.playSound(o.id,channel,o.loop,o.volume)}},stopSound:function(channel){if(oSNDS[channel]){oSNDS[channel].stop();delete oSNDS[channel]}},setPause:function(channel,paused){if(oSNDS[channel])oSNDS[channel].paused=paused},queueSound:function(id,channel,loop,volume){if(!channel){channel="general_"+
this.snd_counter;this.snd_counter++;if(this.snd_counter>5)this.snd_counter=0}var o=new Object;o.id=id;o.loop=loop;o.volume=volume;o.channel=channel;__snds.snd_queue[channel].push(o)},getNowPlaying:function(channel){if(oSNDS[channel])return oSNDS[channel].clip_id;return null},playSound:function(id,channel,loop,volume){if(createjs.Sound.activePlugin.context)if(createjs.Sound.activePlugin.context.state!="running")createjs.Sound.activePlugin.context.resume();if(this.initialized==false)this.init();if(!channel){channel=
"general_"+this.snd_counter;this.snd_counter++;if(this.snd_counter>5)this.snd_counter=0}else if(oSNDS[channel])oSNDS[channel].stop();__snds.snd_queue[channel]=new Array;var args=new Object;args.interrupt=createjs.Sound.INTERRUPT_EARLY;if(volume)args.volume=volume;if(loop)args.loop=loop;if(!(typeof id==="string"))id=id[__utils.getRandomInt(0,id.length-1)];var instance=createjs.Sound.play(id,args);instance.channel=channel;instance.clip_id=id;instance.addEventListener("complete",__snds.nextSound);oSNDS[channel]=
instance;return instance},toggleMute:function(){if(this.mute==0){this.mute=1;createjs.Sound.muted=true}else{this.mute=0;createjs.Sound.muted=false}oUSER.is_mute=this.mute;__localsaver.doSaveData("user",oUSER);trace("createjs.Sound.muted = "+createjs.Sound.muted);return this.mute},forceMute:function(){createjs.Sound.muted=true},isMute:function(){return this.mute},unforceMute:function(){if(this.mute==0)createjs.Sound.muted=false},mute:0};myNameSpace.BlitSounds=BlitSounds})();function ButtonHelper(my_stage,target,normLabel,overLabel,downLabel,play,hitArea,hitLabel){if(!target.addEventListener)return;this.target=target;this.snds={};this.my_stage=my_stage;this.normLabel=normLabel==null?"norm":normLabel;this.overLabel=overLabel==null?"over":overLabel;this.downLabel=downLabel==null?"over":downLabel;this.play=play;this._isPressed=false;this._isOver=false;this._enabled=false;target.mouseChildren=false;this.enabled=true;if(hitArea){if(hitLabel){hitArea.actionsEnabled=false;hitArea.gotoAndStop&&
hitArea.gotoAndStop(hitLabel)}target.hitArea=hitArea}}var p=ButtonHelper.prototype;p.setParams=function(o){for(var s in o)this[s]=o[s]};p.setSounds=function(o){for(var s in o)this.snds[s]=o[s]};
p.setEnabled=function(value){if(value==this._enabled)return;var o=this.target;this._enabled=value;if(value){o.cursor="pointer";o.addEventListener("rollover",this);o.addEventListener("rollout",this);o.addEventListener("mousedown",this);o.addEventListener("pressup",this)}else{o.cursor=null;o.removeEventListener("rollover",this);o.removeEventListener("rollout",this);o.removeEventListener("mousedown",this);o.removeEventListener("pressup",this)}this._isPressed=false;this._isOver=false};p.getEnabled=function(){return this._enabled};
try{Object.defineProperties(p,{enabled:{get:p.getEnabled,set:p.setEnabled}})}catch(e){}p.toString=function(){return"[ButtonHelper]"};
p.handleEvent=function(evt){var label,t=this.target,type=evt.type;if(!this._enabled)return;if(type=="mousedown"){this._isPressed=true;label=this.downLabel;if(this.snds.mousedown)__snds.playSound(this.snds.mousedown,"interface")}else if(type=="pressup"){this._isPressed=false;label=this._isOver?this.overLabel:this.normLabel}else if(type=="rollover"){this._isOver=true;label=this._isPressed?this.downLabel:this.overLabel;if(this.snds.rollover)__snds.playSound(this.snds.rollover,"interface")}else{this._isOver=
false;label=this._isPressed?this.overLabel:this.normLabel}if(this.play)t.gotoAndPlay&&t.gotoAndPlay(label);else t.gotoAndStop&&t.gotoAndStop(label);if(t.cacheID&&!this.ignore_cache)__utils.doCache(t,oSTAGE.cache_scale);if(this.my_stage)this.my_stage.needUpdate=true};
var BlitTools=function(){var me=this;me.firefox_font_shift=.1;this.doInitResizer=function(callback){var resizer=document.createElement("div");resizer.id="resizer";resizer.w=null;resizer.h=null;resizer.scroll=null;resizer.keep=true;resizer.doUpdate=function(){if(this.w!=window.innerWidth||this.h!=window.innerHeight||this.scroll!=document.documentElement.scrollTop){this.w=window.innerWidth;this.h=window.innerHeight;this.scroll=document.documentElement.scrollTop;window.scrollTo(0,0);callback();if(platform.isMobile)setTimeout(function(){window.scrollTo(0,
0);callback()},250)}};actives.push(resizer);window.addEventListener("orientationchange",function(){resizer.w=0;resizer.h=0})};this.doInitFocusManager=function(callback_lose_focus,callback_get_focus){var document_blurred=false;var doBlur=function(){if(document_blurred)return;if(callback_lose_focus)callback_lose_focus();document_blurred=true};var doFocus=function(){if(!document_blurred)return;if(callback_get_focus)callback_get_focus();document_blurred=false};var visProp=me.doGetHiddenProp();if(visProp){var evtname=
visProp.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(evtname,function(evt){if(document[visProp])doBlur();else doFocus()})}window.addEventListener("blur",doBlur);window.addEventListener("focus",doFocus)};this.doGetHiddenProp=function(){var prefixes=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var i=0;i<prefixes.length;i++)if(prefixes[i]+"Hidden"in document)return prefixes[i]+"Hidden";return null};this.ButtonHelper=ButtonHelper;this.doUpdateCreateJsStage=
function(my_stage,event){if(my_stage.needUpdate||my_stage.activeTweens.length>0||my_stage.actives.length>0){for(var i=my_stage.actives.length-1;i>=0;i--){var o=my_stage.actives[i];if(o.me&&(!my_stage.contains(o.me)||o.need_destroy)){try{o.me.parent.removeChild(o.me)}catch(e$0){}o=null;my_stage.actives.splice(i,1);continue}else if(o.need_purged){o=null;my_stage.actives.splice(i,1);continue}if(o.update_function)o.update_function(o);else if(o.doUpdate)o.doUpdate()}for(var i=my_stage.activeTweens.length-
1;i>=0;i--)if(!createjs.Tween.hasActiveTweens(my_stage.activeTweens[i])){my_stage.activeTweens.splice(i,1);continue}if(event)my_stage.update(event);else my_stage.update();my_stage.needUpdate=false}};this.createCORSRequest=function(method,url){var xhr=new XMLHttpRequest;if("withCredentials"in xhr)xhr.open(method,url,true);else if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest;xhr.open(method,url)}else xhr=null;return xhr};this.doLoad3dAssets=function(obj,lib){var models_load_queue=obj.manifest;
var my_loader;var manager=new THREE.LoadingManager;manager.onLoad=function(){manager.doCheckLoading()};manager.onError=function(){trace("load error")};manager.onProgress=function(url,itemsLoaded,itemsTotal){obj.progress=Math.max(obj.progress,itemsLoaded/itemsTotal);for(var mdl=0;mdl<models_load_queue.length;mdl++){var mdl_obj=models_load_queue[mdl];if(mdl_obj.src==url){models_load_queue.splice(mdl,1);break}}if(itemsLoaded==itemsTotal)manager.doCheckLoading()};manager.doCheckLoading=function(){if(!obj.loaded&&
manager.items_to_process==0&&models_load_queue.length==0){obj.progress=1;obj.loaded=true}};manager.items_to_process=models_load_queue.length;for(var mdl=0;mdl<models_load_queue.length;mdl++){var mdl_obj=models_load_queue[mdl];switch(mdl_obj.type){case "json":var url=mdl_obj.src;var xhr=me.createCORSRequest("GET",url);if(!xhr)return;xhr.onload=function(){var res=JSON.parse(xhr.responseText);lib[this.name]=res}.bind({name:mdl_obj.name});xhr.onerror=function(){trace("error loading data")};xhr.send();
break;case "static_fbx":my_loader=new THREE.FBXLoader(manager);my_loader.load(mdl_obj.src,function(json){var my_data=this.data;for(var i=0;i<json.children.length;i++){var group=json.children[i];if(group.name){group.traverse(function(node){if(node instanceof THREE.Mesh&&node.material.map){node.material.map.wrapS=THREE.RepeatWrapping;node.material.map.wrapT=THREE.RepeatWrapping;node.material.map.encoding=THREE.LinearEncoding;if(my_data.pixelated){node.material.map.minFilter=THREE.NearestFilter;node.material.map.magFilter=
THREE.NearestFilter}else if(platform.isMobile){node.material.map.minFilter=THREE.NearestMipMapNearestFilter;node.material.map.magFilter=THREE.NearestFilter}else{node.material.map.minFilter=THREE.LinearMipMapNearestFilter;node.material.map.magFilter=THREE.LinearFilter}if(my_data.flat_shading)node.material=new THREE.MeshBasicMaterial({map:node.material.map,blending:THREE.NoBlending,fog:false,side:THREE.FrontSide});node.material.needsUpdate=true}});lib[group.name]=group}}manager.items_to_process--;manager.doCheckLoading()}.bind({data:mdl_obj}));
break;case "static":my_loader=new THREE.ObjectLoader(manager);my_loader.load(mdl_obj.src,function(json){var my_data=this.data;for(var i=0;i<json.children.length;i++){var group=json.children[i];if(group.name)if(group.name.includes(".DAE")||group.name.includes("ROOT"))for(var ii=0;ii<group.children.length;ii++){var child=group.children[ii];lib[child.name]=child}else{group.traverse(function(node){if(node instanceof THREE.Mesh&&node.material.map){node.material.map.wrapS=THREE.RepeatWrapping;node.material.map.wrapT=
THREE.RepeatWrapping;if(true){node.material.map.minFilter=THREE.NearestFilter;node.material.map.magFilter=THREE.NearestFilter}else if(platform.isMobile){node.material.map.minFilter=THREE.NearestMipMapNearestFilter;node.material.map.magFilter=THREE.NearestFilter}else{node.material.map.minFilter=THREE.LinearMipMapNearestFilter;node.material.map.magFilter=THREE.LinearFilter}}});lib[group.name]=group}}manager.items_to_process--;manager.doCheckLoading()}.bind({name:mdl_obj.name}));break;case "animated_json":if(THREE.REVISION<
100){my_loader=new THREE.JSONLoader(manager);my_loader.load(mdl_obj.src,function(geometry,materials){if(my_data.pixelated){materials[0].map.minFilter=THREE.NearestFilter;materials[0].map.magFilter=THREE.NearestFilter}else if(platform.isMobile){materials[0].map.minFilter=THREE.NearestMipMapNearestFilter;materials[0].map.magFilter=THREE.NearestFilter}else{materials[0].map.minFilter=THREE.NearestMipMapNearestFilter;materials[0].map.minFilter=THREE.LinearFilter}materials[0].map.wrapS=THREE.ClampToEdgeWrapping;
materials[0].map.wrapT=THREE.ClampToEdgeWrapping;var mat=new THREE.MeshBasicMaterial({map:materials[0].map});mat.skinning=true;lib[this.name]=new THREE.SkinnedMesh(geometry,mat);manager.items_to_process--;manager.doCheckLoading()}.bind({name:mdl_obj.name}))}else{my_loader=new THREE.LegacyJSONLoader(manager);my_loader.load(mdl_obj.src,function(geometry,materials){if(my_data.pixelated){materials[0].map.minFilter=THREE.NearestFilter;materials[0].map.magFilter=THREE.NearestFilter}else if(platform.isMobile){materials[0].map.minFilter=
THREE.NearestMipMapNearestFilter;materials[0].map.magFilter=THREE.NearestFilter}else{materials[0].map.minFilter=THREE.NearestMipMapNearestFilter;materials[0].map.minFilter=THREE.LinearFilter}materials[0].map.wrapS=THREE.ClampToEdgeWrapping;materials[0].map.wrapT=THREE.ClampToEdgeWrapping;var mat=new THREE.MeshBasicMaterial({map:materials[0].map});mat.skinning=true;var buffer_geom=(new THREE.BufferGeometry).fromGeometry(geometry);lib[this.name]=new THREE.SkinnedMesh(buffer_geom,mat);manager.items_to_process--;
manager.doCheckLoading()}.bind({name:mdl_obj.name}))}break;case "font":my_loader=new THREE.FontLoader(manager);my_loader.load(mdl_obj.src,function(font){lib[this.name]=font;manager.items_to_process--;manager.doCheckLoading()}.bind({name:mdl_obj.name}));break;case "sprite":my_loader=new THREE.TextureLoader(manager);my_loader.load(mdl_obj.src,function(map){var mat=new THREE.SpriteMaterial({map:map,color:16777215,transparent:true});var sprite=new THREE.Sprite(mat);lib[this.name]=sprite;manager.items_to_process--;
manager.doCheckLoading()}.bind({name:mdl_obj.name}));break;case "texture":my_loader=new THREE.TextureLoader(manager);my_loader.load(mdl_obj.src,function(map){var my_data=this.data;if(my_data.wrapping){map.wrapS=THREE.RepeatWrapping;map.wrapT=THREE.RepeatWrapping}lib[my_data.name]=map;manager.items_to_process--;manager.doCheckLoading()}.bind({data:mdl_obj}));break;case "skybox":my_loader=new THREE.CubeTextureLoader(manager);my_loader.setPath("media/models/skyboxes/"+mdl_obj.name+"/");my_loader.load(["right.jpg",
"left.jpg","up.jpg","down.jpg","front.jpg","back.jpg"],function(map){if(platform.isMobile){map.magFilter=THREE.NearestFilter;map.minFilter=THREE.NearestMipMapNearestFilter}else map.minFilter=THREE.LinearFilter;lib[this.name]=map;manager.items_to_process--;manager.doCheckLoading()}.bind({name:mdl_obj.name}));break}}};this.doLoadAssets=function(obj){var me=this;images=images||{};var loader_dummy=document.documentElement.appendChild(document.createElement("div"));loader_dummy.className="loader_dummy";
loader_dummy.id="loader_dummy";var loader=new createjs.LoadQueue(false);loader.installPlugin(createjs.Sound);loader.removeEventListener("fileload",me.onFileLoad);loader.removeEventListener("progress",me.onProgress);loader.removeEventListener("complete",me.onComplete);loader.removeEventListener("error",me.onError);this.onFileLoad=function(event){if(event.item.type=="javascript"){var script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",event.item.src);
document.getElementsByTagName("head")[0].appendChild(script)}else if(event.item.type=="image"||event.item.type=="svg")images[event.item.id]=event.result;else if(event.item.type=="text"){var txt=loader_dummy.appendChild(document.createElement("div"));txt.className="general_absolute";txt.style.fontFamily=event.item.id;txt.style.color="white";txt.style.visibility="hidden";txt.innerHTML="-"}};this.onError=function(event){trace(event.title+": "+event.data.src);try{assets_retry.manifest.push({src:event.data.src,
id:event.data.id})}catch(e$1){}};this.onProgress=function(event){obj.progress=event.loaded};this.onComplete=function(event){obj.progress=1;obj.loaded=true;obj.loadTime=window.performance.now();loader.removeEventListener("fileload",me.onFileLoad);loader.removeEventListener("progress",me.onProgress);loader.removeEventListener("complete",me.onComplete);loader.removeEventListener("error",me.onError);__utils.doDestroyElement(document.getElementById("loader_dummy"))};loader.addEventListener("fileload",
me.onFileLoad);loader.addEventListener("progress",me.onProgress);loader.addEventListener("complete",me.onComplete);loader.addEventListener("error",me.onError);loader.loadManifest(obj.manifest)};this.OLD_doInitFocusManager=function(callback_lose_focus,callback_get_focus){var visProp=me.doGetHiddenProp();if(visProp){var evtname=visProp.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(evtname,function(evt){if(document[visProp]){__snds.forceMute();if(callback_lose_focus)callback_lose_focus()}else{__snds.unforceMute();
if(callback_get_focus)callback_get_focus()}})}};this.doFade=function(elem,to,seconds,callback){var fader=elem;fader.my_opacity=Number(fader.style.opacity);fader.to_opacity=to;fader.step=(to-fader.my_opacity)/(seconds*60);fader.forget=false;fader.doUpdate=function(){if(this.step>0)this.my_opacity=Math.min(this.to_opacity,this.my_opacity+this.step);else this.my_opacity=Math.max(this.to_opacity,this.my_opacity+this.step);this.style.opacity=this.my_opacity;if(this.my_opacity==this.to_opacity){this.forget=
true;if(callback)callback()}};actives.push(fader)};this.doFadeTo=function(elem,callback){var fader=elem;fader.style.display="block";fader.style.opacity=0;fader.mode=1;fader.my_opacity=0;fader.doUpdate=function(){switch(this.mode){case 1:this.my_opacity+=.05;this.style.opacity=Math.min(1,Math.max(0,this.my_opacity));if(this.my_opacity>=1){this.mode=2;if(callback)callback()}break;case 2:this.my_opacity-=.05;this.style.opacity=Math.max(0,Math.min(1,this.my_opacity));if(this.my_opacity<=0){this.purge=
true;this.style.display="none"}break}};actives.push(fader)};this.NewPulse=function(pulse_speed,o){var me=this;var o=o||{};var pulse=o.seed||0;var ease=o.ease||1;var ease_speed=o.ease_speed||1;me.value=0;me.value_normal=0;this.reset=function(o){var pulse=o.seed||0;var ease=o.ease||1;var ease_speed=o.ease_speed||1;var pulse_speed=o.pulse_speed||pulse_speed;me.value=Math.sin(__utils.radFromDeg(pulse));me.value_normal=.5+me.value*.5};this.update=function(){pulse+=pulse_speed;if(pulse>=360)pulse-=360;
me.value=Math.sin(__utils.radFromDeg(pulse))*ease;me.value_normal=.5+me.value*.5*ease;ease=Math.min(1,ease+ease_speed)}};this.dataURItoBlob=function(dataURI){var byteString,mimestring;if(dataURI.split(",")[0].indexOf("base64")!==-1)byteString=atob(dataURI.split(",")[1]);else byteString=decodeURI(dataURI.split(",")[1]);mimestring=dataURI.split(",")[0].split(":")[1].split(";")[0];var content=new Array;for(var i=0;i<byteString.length;i++)content[i]=byteString.charCodeAt(i);return new Blob([new Uint8Array(content)],
{type:mimestring})};this.ordinal_suffix_of=function(i){var j=i%10,k=i%100;if(j==1&&k!=11)return"st";if(j==2&&k!=12)return"nd";if(j==3&&k!=13)return"rd";return"th"};this.doFader=function(){fader.style.display="inline-block";fader.style.opacity=1;var upd=new Object;upd.keep=true;upd.opacity=1.5;upd.update_function=function(){this.opacity-=.1;fader.style.opacity=Math.max(0,Math.min(1,this.opacity));if(this.opacity<=0){this.keep=false;fader.style.display="none"}};updateQueue.push(upd)};this.doGetBrowser=
function(){var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return"IE "+(tem[1]||"")}if(M[1]==="Chrome"){tem=ua.match(/\bOPR\/(\d+)/);if(tem!=null)return"Opera "+tem[1]}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null)M.splice(1,1,tem[1]);return M.join(" ")};this.getCSSPPI=function(){var div=document.createElement("div");
div.style.width="1in";var body=document.getElementsByTagName("body")[0];body.appendChild(div);var ppi=div.offsetWidth;body.removeChild(div);return parseFloat(ppi)};this.getPPI=function(){var div=document.createElement("div");div.style.width="1in";var body=document.getElementsByTagName("body")[0];body.appendChild(div);var devicePixelRatio=window.devicePixelRatio||1;var ppi=div.offsetWidth*devicePixelRatio;body.removeChild(div);return parseFloat(ppi)};this.getPixelRatio=function(){var ctx=document.createElement("canvas").getContext("2d"),
dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;return dpr/bsr};this.doGetLanguage=function(){var lang;if(navigator&&navigator.userAgent&&(lang=navigator.userAgent.match(/android.*\W(\w\w)-(\w\w)\W/i)))lang=lang[1];if(!lang&&navigator){if(navigator.language)lang=navigator.language;else if(navigator.browserLanguage)lang=navigator.browserLanguage;else if(navigator.systemLanguage)lang=
navigator.systemLanguage;else if(navigator.userLanguage)lang=navigator.userLanguage;lang=lang.substr(0,2)}return lang};this.getQueryString=function(){var query_string={};var query=window.location.search.substring(1);if(query.length<1)if(window.location.toString().split("%3F")[1]!=null)query=window.location.toString().split("%3F")[1];var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(typeof query_string[pair[0]]==="undefined")query_string[pair[0]]=pair[1];else if(typeof query_string[pair[0]]===
"string"){var arr=[query_string[pair[0]],pair[1]];query_string[pair[0]]=arr}else query_string[pair[0]].push(pair[1])}return query_string};this.s4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};this.guid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()};this.formatDate=function(date,format,utc){var MMMM=["\x00","January","February","March","April","May","June","July","August","September","October","November",
"December"];var MMM=["\u0001","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dddd=["\u0002","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var ddd=["\u0003","Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function ii(i,len){var s=i+"";len=len||2;while(s.length<len)s="0"+s;return s}var y=utc?date.getUTCFullYear():date.getFullYear();format=format.replace(/(^|[^\\])yyyy+/g,"$1"+y);format=format.replace(/(^|[^\\])yy/g,"$1"+y.toString().substr(2,2));format=
format.replace(/(^|[^\\])y/g,"$1"+y);var M=(utc?date.getUTCMonth():date.getMonth())+1;format=format.replace(/(^|[^\\])MMMM+/g,"$1"+MMMM[0]);format=format.replace(/(^|[^\\])MMM/g,"$1"+MMM[0]);format=format.replace(/(^|[^\\])MM/g,"$1"+ii(M));format=format.replace(/(^|[^\\])M/g,"$1"+M);var d=utc?date.getUTCDate():date.getDate();format=format.replace(/(^|[^\\])dddd+/g,"$1"+dddd[0]);format=format.replace(/(^|[^\\])ddd/g,"$1"+ddd[0]);format=format.replace(/(^|[^\\])dd/g,"$1"+ii(d));format=format.replace(/(^|[^\\])d/g,
"$1"+d);var H=utc?date.getUTCHours():date.getHours();format=format.replace(/(^|[^\\])HH+/g,"$1"+ii(H));format=format.replace(/(^|[^\\])H/g,"$1"+H);var h=H>12?H-12:H==0?12:H;format=format.replace(/(^|[^\\])hh+/g,"$1"+ii(h));format=format.replace(/(^|[^\\])h/g,"$1"+h);var m=utc?date.getUTCMinutes():date.getMinutes();format=format.replace(/(^|[^\\])mm+/g,"$1"+ii(m));format=format.replace(/(^|[^\\])m/g,"$1"+m);var s=utc?date.getUTCSeconds():date.getSeconds();format=format.replace(/(^|[^\\])ss+/g,"$1"+
ii(s));format=format.replace(/(^|[^\\])s/g,"$1"+s);var f=utc?date.getUTCMilliseconds():date.getMilliseconds();format=format.replace(/(^|[^\\])fff+/g,"$1"+ii(f,3));f=Math.round(f/10);format=format.replace(/(^|[^\\])ff/g,"$1"+ii(f));f=Math.round(f/10);format=format.replace(/(^|[^\\])f/g,"$1"+f);var T=H<12?"AM":"PM";format=format.replace(/(^|[^\\])TT+/g,"$1"+T);format=format.replace(/(^|[^\\])T/g,"$1"+T.charAt(0));var t=T.toLowerCase();format=format.replace(/(^|[^\\])tt+/g,"$1"+t);format=format.replace(/(^|[^\\])t/g,
"$1"+t.charAt(0));var tz=-date.getTimezoneOffset();var K=utc||!tz?"Z":tz>0?"+":"-";if(!utc){tz=Math.abs(tz);var tzHrs=Math.floor(tz/60);var tzMin=tz%60;K+=ii(tzHrs)+":"+ii(tzMin)}format=format.replace(/(^|[^\\])K/g,"$1"+K);var day=(utc?date.getUTCDay():date.getDay())+1;format=format.replace(new RegExp(dddd[0],"g"),dddd[day]);format=format.replace(new RegExp(ddd[0],"g"),ddd[day]);format=format.replace(new RegExp(MMMM[0],"g"),MMMM[M]);format=format.replace(new RegExp(MMM[0],"g"),MMM[M]);format=format.replace(/\\(.)/g,
"$1");return format};this.getDayNumber=function(){var minutes=1E3*60;var hours=minutes*60;var days=hours*24;var years=days*365;var base=new Date(2014,0,1);var now=new Date;var t=now.getTime()-base.getTime();var daynum=Math.ceil(t/days);return daynum};this.doGoFullScreen=function(){var el=document.documentElement,rfs=el.requestFullScreen||el.webkitRequestFullScreen||el.mozRequestFullScreen;rfs.call(el)};this.doCheckFullScreen=function(){trace("doCheckFullScreen");var isInFullScreen=document.fullscreenEnabled||
document.mozFullscreenEnabled||document.webkitIsFullScreen?true:false;return isInFullScreen};this.doFullScreenOn=function(){var elem=document.documentElement;if(elem.requestFullscreen)elem.requestFullscreen();else if(elem.msRequestFullscreen)elem.msRequestFullscreen();else if(elem.mozRequestFullScreen)elem.mozRequestFullScreen();else if(elem.webkitRequestFullscreen)elem.webkitRequestFullscreen();oSTAGE.is_fullscreen=true};this.doFullScreenOff=function(){if(document.exitFullscreen)document.exitFullscreen();
else if(document.cancelFullScreen)document.cancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();oSTAGE.is_fullscreen=false};this.doFadeandDestroy=function(e){var me=e.currentTarget;me.alpha-=.1;if(me.alpha<=0)me.parent.removeChild(me)};this.doGetPOT=function(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))};this.doCache=function(obj,
stage_scale){if(!stage_scale)stage_scale=oSTAGE.cache_scale||oSTAGE.scale;obj.regX=obj.regX|0;obj.regY=obj.regY|0;obj.x=obj.x|0;obj.y=obj.y|0;obj.uncache();var bounds=obj.getBounds();var nom_bounds=obj.nominalBounds;var new_bounds={};if(obj.force_bounds){new_bounds.x=obj.force_bounds.x;new_bounds.y=obj.force_bounds.y;new_bounds.width=obj.force_bounds.width;new_bounds.height=obj.force_bounds.height}else if(!obj.force_bounds&&bounds&&nom_bounds){new_bounds.x=Math.min(nom_bounds.x,bounds.x);new_bounds.y=
Math.min(nom_bounds.y,bounds.y);new_bounds.width=Math.max(nom_bounds.width,bounds.width);new_bounds.height=Math.max(nom_bounds.height,bounds.height)}else if(bounds)new_bounds=bounds;else if(nom_bounds)new_bounds=nom_bounds;else return;var need_POT=false;if(obj.stage)if(obj.stage._webGLContext)need_POT=true;if(need_POT)obj.cache(new_bounds.x,new_bounds.y,__utils.doGetPOT(new_bounds.width),__utils.doGetPOT(new_bounds.height),stage_scale);else obj.cache(new_bounds.x,new_bounds.y,Math.ceil(new_bounds.width),
Math.ceil(new_bounds.height),stage_scale)};this.doLerp=function(a,b,c){return a+c*(b-a)};this.doRound=function(value,decimals){return Number(Math.round(value+"e"+decimals)+"e-"+decimals)};this.doGetIntersect=function(x1,y1,x2,y2,x3,y3,x4,y4){if(x1===x2&&y1===y2||x3===x4&&y3===y4)return false;var denominator=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);if(denominator===0)return false;var ua=((x4-x3)*(y1-y3)-(y4-y3)*(x1-x3))/denominator;var ub=((x2-x1)*(y1-y3)-(y2-y1)*(x1-x3))/denominator;if(ua<0||ua>1||ub<0||ub>
1)return false;var x=x1+ua*(x2-x1);var y=y1+ua*(y2-y1);return{x:x,y:y}};this.doGetDistance=function(x1,y1,x2,y2){var x=x1-x2;var y=y1-y2;return Math.sqrt(x*x+y*y)};this.doGetAngle=function(cx,cy,ex,ey){var dy=ey-cy;var dx=ex-cx;var theta=Math.atan2(dy,dx);theta*=180/Math.PI;return theta};this.degFromRad=function(p_radInput){var degOutput=180/Math.PI*p_radInput;return degOutput};this.radFromDeg=function(p_degInput){var radOutput=Math.PI/180*p_degInput;return radOutput};this.getRandomArbitrary=function(min,
max){return Math.random()*(max-min)+min};this.getRandomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};this.doLerp=function(start,end,amt){return(1-amt)*start+amt*end};this.doRandomizeArray=function(theArray){var arrayLength=theArray.length;var oldArray=theArray.slice();var newArray=new Array;while(oldArray.length>0){var tId=Math.floor(Math.random()*oldArray.length);var tItem=oldArray[tId];oldArray.splice(tId,1);newArray.push(tItem)}return newArray};this.doClearTimeouts=function(){for(var i=
0;i<timeouts.length;i++)clearTimeout(timeouts[i]);timeouts=[]};this.getPointInBetweenByPerc=function(pointA,pointB,percentage){var dir=pointB.clone().sub(pointA);var len=dir.length();dir=dir.normalize().multiplyScalar(len*percentage);return pointA.clone().add(dir)};this.doText=function(obj,o,params){params=params||{};if(obj.my_origin){obj.x=obj.my_origin.x;obj.y=obj.my_origin.y}else{var bounds=obj.getBounds()||{height:0};obj.my_origin={x:obj.x,y:obj.y,h:bounds.height,lineHeight:obj.lineHeight,center:obj.y+
bounds.height*.5}}if(typeof o!=="object"||o===null)var o={value:o};var msg=o.value||o.txt;for(var s in o)if(s!="value")obj[s]=o[s];if(!msg&&msg!=0&&msg!=""){msg="MISSING TEXT";obj.color="#FF0000"}var font=obj.font;var family_start=font.indexOf("'");var family_end=font.lastIndexOf("'");if(!obj.original_font_family)obj.original_font_family=font.slice(family_start+1,family_end);var font_family=obj.original_font_family;var size_start=0;var size_end=font.indexOf("px");for(var i=size_end;i>=0;i--)if(font[i]==
" "){size_start=i;break}if(!obj.original_font_size)obj.original_font_size=Number(font.slice(size_start,size_end));var font_size=obj.original_font_size;var t_font_weight=font.substring(0,size_start)+font.substring(size_end+2,family_start)+font.substring(family_end,font.length-1);t_font_weight=t_font_weight.split(" ").join("");if(!obj.original_font_weight)obj.original_font_weight=t_font_weight;var font_weight=obj.original_font_weight;if(obj.fontFamily)font_family=obj.fontFamily;if(obj.fontWeight)font_weight=
obj.fontWeight;if(o.fontSize)if(o.fontSize.indexOf("px")!=-1)font_size=o.fontSize.split("px")[0];else if(o.fontSize.indexOf("%")!=-1){var font_percentage=o.fontSize.split("%")[0]*.01;font_size*=font_percentage;obj.lineHeight=obj.my_origin.lineHeight*font_percentage}if(o.lineHeight)if(String(o.lineHeight).indexOf("%")!=-1){var lineheight_percentage=Number(String(o.lineHeight).split("%")[0]*.01);obj.lineHeight=obj.my_origin.lineHeight*lineheight_percentage}else obj.lineHeight=Number(o.lineHeight);obj.font_size=
font_size;if(obj.original_font_size!=obj.font_size)if(params.verticalAlign=="middle")obj.y+=obj.my_origin.lineHeight*.5-obj.lineHeight*.5;else if(params.verticalAlign=="baseline")obj.y+=obj.my_origin.lineHeight-obj.lineHeight;if(font_weight.length>=1)obj.font=font_weight+" "+font_size+"px "+"'"+font_family+"'";else obj.font=font_size+"px "+"'"+font_family+"'";msg=String(msg);var patt=/\<br>/g;msg=msg.replace(patt,"\n");var patt=/\{\*br\*\}/g;msg=msg.replace(patt,"\n");var patt=/\{\*p\*\}/g;msg=msg.replace(patt,
"\n\n");var patt=/\<p>/g;msg=msg.replace(patt,"\n\n");obj.text=msg;var pixel_ratio=__utils.getPixelRatio();var pixel_ratio_inv=1/oSTAGE.pixel_ratio;var metrics=obj.getMetrics();var number_of_lines=metrics.lines.length;var block_height=obj.lineHeight*number_of_lines;var line_offset=font_size-obj.lineHeight;if(!params.verticalAlign||params.verticalAlign=="middle"){obj.textBaseline="middle";obj.y+=font_size-Math.max(0,number_of_lines-1)*metrics.lineHeight*.5;if(font_family!="Poppins"&&font_family.indexOf("Oswald")==
-1)obj.y+=obj.getMetrics().vOffset*.5;if(font_family.indexOf("Century Gothic")!=-1)if(platform.isFirefox&&platform.isWindows)obj.y-=metrics.lineHeight*.075}else if(params.verticalAlign=="baseline"){obj.textBaseline="baseline";obj.y+=font_size-Math.max(0,number_of_lines-1)*metrics.lineHeight}else if(params.verticalAlign=="bottom"){obj.textBaseline="middle";obj.y+=font_size-Math.max(0,number_of_lines-1)*metrics.lineHeight}obj.x=obj.x|0;obj.y=obj.y|0};this.doSubText=function(str,change_from,change_to){var msg=
String(str);var regex=new RegExp(change_from,"g");msg=msg.replace(regex,change_to);return msg};this.doSubValue=function(msg,value){msg=String(msg);var patt=/\{\*var\*\}/g;msg=msg.replace(patt,value);return msg};this.doSubValue2=function(msg,value){msg=String(msg);var patt=/\{\*var2\*\}/g;msg=msg.replace(patt,value);return msg};this.doHTMLText=function(element,o,append){if(typeof o==="object"&&o!==null);else var o={value:o};var msg=o.value;var computed_style=element.my_computed_style||window.getComputedStyle(element,
null)||element.style;var style_fontsize=computed_style["font-size"]||computed_style["fontSize"];element.my_fontsize=parseFloat(style_fontsize);for(var s in o)if(s!="value")if(s=="fontSize")if(o[s].indexOf("%")!=-1)element.style.fontSize=o[s];else element.style.fontSize=o[s];else element.style[s]=o[s];if(!msg&&msg!=0){msg="MISSING TEXT";element.style.color="#FF0000"}var icon_snippet="";if(o.icon)icon_snippet+='<i class="'+o.icon+'"></i> ';if(append)element.innerHTML+=icon_snippet+msg;else element.innerHTML=
icon_snippet+msg};this.doFormatCurrency=function(myNumber){var comma=oLANG.comma.value;var currency=oLANG.currency.value;myNumber=__utils.doRound(myNumber,2);var number_parts=String(myNumber).split(".");var myStr1=number_parts[0];var myStr2="";var count=0;for(var i=myStr1.length-1;i>=0;i--){myStr2=myStr1.charAt(i)+myStr2;count++;if(count==3){count=0;myStr2=comma+myStr2}}if(myStr2.charAt(0)==comma)myStr2=myStr2.substring(1,myStr2.length);myStr2=currency+myStr2;if(number_parts.length>1)myStr2+="."+
number_parts[1];return myStr2};this.doFormatNumber=function(myNumber,comma){comma=typeof comma!=="undefined"?comma:oLANG.comma;myNumber=Math.floor(myNumber);var myStr1=String(myNumber);var myStr2="";var count=0;for(var i=myStr1.length-1;i>=0;i--){myStr2=myStr1.charAt(i)+myStr2;count++;if(count==3){count=0;myStr2=comma+myStr2}}if(myStr2.charAt(0)==comma)myStr2=myStr2.substring(1,myStr2.length);myStr2=""+myStr2;return myStr2};this.doFormatTime=function(ms){var s=Math.floor(ms*.001);var m=Math.floor(s/
60);var h=Math.floor((ms-s*1E3)*.1);s=s-m*60;return{m:m,s:s,h:h}};this.doCreateTextArea=function(elementId,parentDiv,x,y,width,height,style,scrollable,selectable,relative,text){var area=document.createElement("div");area.setAttribute("id",elementId);if(parentDiv!=null&&parentDiv!="body")document.getElementById(parentDiv).appendChild(area);else document.body.appendChild(area);if(!selectable)style+=";-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;cursor:default;";
area.setAttribute("style",style);area.style.position="absolute";area.style.zIndex="99999";if(relative){var setLayout=function(){area.style.width=width*window.innerWidth+"px";area.style.height=height*window.innerHeight+"px";area.style.left=x*window.innerWidth+"px";area.style.top=y*window.innerHeight+"px"};setLayout();window.addEventListener("resize",setLayout)}else{area.style.width=width+"px";area.style.height=height+"px";area.style.left=x+"px";area.style.top=y+"px"}if(scrollable)area.style.overflowY=
"auto";else area.style.overflowY="hidden";area.innerHTML=text;return area};this.doChangeElement=function(elementObject,elementId,x,y,width,height){var element=null;if(elementObject!=null)element=elementObject;else element=document.getElementById(elementId);element.style.width=width+"px";element.style.height=height+"px";element.style.marginLeft=x+"px";element.style.marginTop=y+"px"};this.doDestroyElement=function(element){if(typeof element=="string")element=document.getElementById(element);if(element){this.doDestroyAllChildren(element);
element.parentNode.removeChild(element)}};this.doDestroyAllChildren=function(element){if(element)while(element.childNodes.length>0)element.removeChild(element.childNodes[0])};this.addDomObject=function(obj,x,y,w,h,font_size){var pos=doWrappertoScreen(x,y);obj.style.left=pos.x+"px";obj.style.top=pos.y+"px";if(w!=0)obj.style.width=w*oSTAGE.scale+"px";if(h!=0)obj.style.height=h*oSTAGE.scale+"px";var o=new Object;o.obj=obj;o.x=x;o.y=y;o.w=w;o.h=h;o.font_size=font_size;dom_objects.push(o)};this.doClearEventListeners=
function(arr){for(var i=0;i<arr.length;i++)arr[i].removeAllEventListeners()};this.addSourceToVideo=function(element,src,type){var source=document.createElement("source");source.src=src;source.type=type;element.appendChild(source)};this.canPlayVideoInline=function(){return navigator.userAgent.match(/(iPhone|iPod)/g)?"playsInline"in document.createElement("video"):true}};function BlitSaver(){window.localStorageAlias=window.localStorage;this.useCookies=false;if(!window.localStorage||window.localStorage=="undefined"){window.localStorageAlias={};window.localStorageAlias.removeItem=function(){}}this.doSaveData=function(key,data){try{key=oCONFIG.game_id+"_"+key;window.localStorageAlias[key]=JSON.stringify(data)}catch(e$2){}};this.doGetData=function(key){try{key=oCONFIG.game_id+"_"+key;var string_data=window.localStorageAlias[key];if(string_data)if(string_data!="")return JSON.parse(string_data);
else return null;else return null}catch(e$3){}};this.doClearData=function(key){key=oCONFIG.game_id+"_"+key;window.localStorageAlias.removeItem(key)}};function MuteMenu(target,options){var me=this;options=options||{};var canvas=document.getElementById(target);var stage=canvas.my_stage||new createjs.Stage(canvas);stage.enableMouseOver(0);stage.tickChildren=false;stage.tickEnabled=false;stage.needUpdate=false;stage.snapToPixelsEnabled=true;stage.actives=[];stage.activeTweens=[];stage.enableDOMEvents(false);stage.forget=false;if(platform.isMobile){createjs.Touch.enable(stage);stage.enableDOMEvents(false)}else{stage.enableDOMEvents(true);stage.enableMouseOver(20)}canvas.my_stage=
stage;me.mouse_is_over=false;me.my_scale=1;canvas.onmouseover=function(){me.mouse_is_over=true};canvas.onmouseout=function(){me.mouse_is_over=false};stage.removeAllChildren();var frame=stage.addChild(new lib.scene_mute_panel);var elem=document.documentElement;var fullScreen_capable=elem.requestFullscreen||elem.msRequestFullscreen||elem.mozRequestFullScreen||elem.webkitRequestFullscreen?true:false;if(options.hide_fullscreen)fullScreen_capable=false;if(fullScreen_capable){frame.b_fullscreen.visible=
true;frame.b_fullscreen.helper=new __utils.ButtonHelper(stage,frame.b_fullscreen,"norm","over");frame.b_fullscreen.helper.setSounds({mousedown:"snd_click",rollover:"snd_rollover"});frame.b_fullscreen.addEventListener("click",function(e){if(oSTAGE.is_fullscreen){__window.doFullScreenOff();frame.b_fullscreen.mc_on.visible=false;frame.b_fullscreen.mc_off.visible=true;stage.needUpdate=true}else{__window.doFullScreenOn();frame.b_fullscreen.mc_on.visible=true;frame.b_fullscreen.mc_off.visible=false;stage.needUpdate=
true}},false);if(oSTAGE.is_fullscreen){frame.b_fullscreen.mc_on.visible=true;frame.b_fullscreen.mc_off.visible=false}else{frame.b_fullscreen.mc_on.visible=false;frame.b_fullscreen.mc_off.visible=true}}else frame.b_fullscreen.visible=false;if(__snds.isMute()==0)frame.b_mute.mc_mutelines.visible=true;else frame.b_mute.mc_mutelines.visible=false;frame.b_mute.helper=new __utils.ButtonHelper(stage,frame.b_mute,"norm","over");frame.b_mute.helper.setSounds({mousedown:"snd_click",rollover:"snd_rollover"});
frame.b_mute.addEventListener("click",function(e){if(__snds.toggleMute()==0){frame.b_mute.mc_mutelines.visible=true;stage.needUpdate=true;oUSER.is_mute=false}else{frame.b_mute.mc_mutelines.visible=false;stage.needUpdate=true;oUSER.is_mute=true}__localsaver.doSaveData("user",oUSER)},false);frame.b_pause.helper=new __utils.ButtonHelper(stage,frame.b_pause,"norm","over");frame.b_pause.helper.setSounds({mousedown:"snd_click",rollover:"snd_rollover"});frame.b_pause.addEventListener("click",function(e){if(!e.currentTarget.helper.enabled)return;
if(GAME.is_paused)GAME.doResume();else GAME.doPause();stage.needUpdate=true});var myx=7.5;var myy=6.5;var myyspace=60;frame.b_fullscreen.x=myx;frame.b_mute.x=myx;frame.b_pause.x=myx;if(fullScreen_capable){frame.b_fullscreen.y=myy;frame.b_mute.y=myy+myyspace;frame.b_pause.y=myy+myyspace+myyspace}else{frame.b_mute.y=myy;frame.b_pause.y=myy+myyspace}frame.b_pause.alpha=0;stage.needUpdate=true;this.doUpdateMute=function(){if(__snds.isMute()==0)frame.b_mute.mc_mutelines.visible=true;else frame.b_mute.mc_mutelines.visible=
false;stage.needUpdate=true};this.doUpdateFullScreen=function(){trace("doUpdateFullScreen()");if(__window.doCheckFullScreen()){frame.b_fullscreen.mc_on.visible=true;frame.b_fullscreen.mc_off.visible=false}else{frame.b_fullscreen.mc_on.visible=false;frame.b_fullscreen.mc_off.visible=true}stage.needUpdate=true};this.doResizeUpdate=function(){var scale=oSTAGE.scale;canvas.style.top=0*scale+"px";canvas.style.width=64*scale+"px";canvas.style.height=180*scale+"px";canvas.width=64*scale*__utils.getPixelRatio();
canvas.height=180*scale*__utils.getPixelRatio();frame.my_scale=scale;me.my_scale=scale;stage.scale=scale*__utils.getPixelRatio();stage.needUpdate=true};this.doShowPause=function(){frame.b_pause.helper.setEnabled(true);frame.b_pause.visible=true;if(platform.isMobile){frame.b_pause.alpha=1;stage.needUpdate=true}else{createjs.Tween.get(frame.b_pause).to({alpha:1},250);stage.activeTweens.push(frame.b_pause)}};this.doHidePause=function(){frame.b_pause.helper.setEnabled(false);if(platform.isMobile){frame.b_pause.visible=
false;stage.needUpdate=true}else{createjs.Tween.get(frame.b_pause).to({alpha:0},250);stage.activeTweens.push(frame.b_pause)}};me.doResizeUpdate();var resize_updater={doResizeUpdate:me.doResizeUpdate};update_queue.push(resize_updater);active_stages.push(stage);canvas.style.display="block"};var Screens=function(target,options){var me=this;options=options||{};var canvas=document.getElementById(target);var stage;if(canvas.my_stage)stage=canvas.my_stage;else if(options.webgl)stage=new createjs.StageGL(canvas,{transparent:true,antialias:true});else if(options.webgl2)stage=new createjs.StageGL(canvas,{transparent:false,antialias:true});else stage=new createjs.Stage(canvas);stage.enableMouseOver(0);stage.tickChildren=false;stage.tickEnabled=false;stage.needUpdate=false;stage.snapToPixelsEnabled=
true;stage.actives=[];stage.activeTweens=[];stage.enableDOMEvents(false);stage.forget=false;if(platform.isMobile)createjs.Touch.enable(stage);else stage.enableDOMEvents(true);me.stage=canvas.my_stage=stage;me.my_canvas=canvas;stage.removeAllChildren();this.doResizeUpdate=function(){canvas.style.left="0px";canvas.style.top="0px";canvas.style.width=oSTAGE.wrapper_width+"px";canvas.style.height=oSTAGE.wrapper_height+"px";canvas.width=oSTAGE.wrapper_width*oSTAGE.pixel_ratio;canvas.height=oSTAGE.wrapper_height*
oSTAGE.pixel_ratio;stage.scale=oSTAGE.scale*oSTAGE.pixel_ratio;if(options.webgl||options.webgl2)stage.updateViewport(canvas.width,canvas.height);stage.needUpdate=true};this.doShow=function(){canvas.style.display="block"};this.doHide=function(){canvas.style.display="none"};this.doDestroy=function(){resize_updater.forget=true;stage.forget=true;stage.enableMouseOver(0);stage.removeAllChildren();stage.needUpdate=true;canvas.style.display="none"};me.doResizeUpdate();var resize_updater={doResizeUpdate:me.doResizeUpdate};
update_queue.push(resize_updater);active_stages.push(stage);canvas.style.display="block"};function FontLoader(){var me=this;var canvas=document.body.appendChild(document.createElement("canvas"));canvas.style.width="100px";canvas.style.height="100px";canvas.style.position="absolute";canvas.style.display="none";var stage=new createjs.Stage(canvas);stage.enableMouseOver(0);stage.tickChildren=true;stage.tickEnabled=true;stage.needUpdate=false;stage.enableDOMEvents(false);stage.forget=false;var font_loader=stage.addChild(new lib.font_loader);this.doDestroy=function(){stage.update();stage.removeAllChildren();
__utils.doDestroyElement(canvas)};this.doAddFont=function(fontFamily,fontWeight){if(fontWeight!="")fontWeight=fontWeight+" ";var text=font_loader.addChild(new createjs.Text("Hello World",fontWeight+"20px "+fontFamily,"#ff7700"))};stage.update()};
