pc.script.attribute("text","string"),pc.script.attribute("maxTextLength","number",256),pc.script.attribute("fontAtlas","asset",[],{type:"texture",max:1}),pc.script.attribute("fontJson","asset",[],{type:"json",max:1}),pc.script.attribute("x","number"),pc.script.attribute("y","number"),pc.script.attribute("depth","number",1),pc.script.attribute("lineSpacinng","number",1),pc.script.attribute("anchor","enumeration",0,{enumerations:[{name:"topLeft",value:0},{name:"top",value:1},{name:"topRight",value:2},{name:"left",value:3},{name:"center",value:4},{name:"right",value:5},{name:"bottomLeft",value:6},{name:"bottom",value:7},{name:"bottomRight",value:8}]}),pc.script.attribute("pivot","enumeration",0,{enumerations:[{name:"topLeft",value:0},{name:"top",value:1},{name:"topRight",value:2},{name:"left",value:3},{name:"center",value:4},{name:"right",value:5},{name:"bottomLeft",value:6},{name:"bottom",value:7},{name:"bottomRight",value:8}]}),pc.script.attribute("tint","rgba",[1,1,1,1]),pc.script.attribute("maxResHeight","number",560),pc.script.attribute("scaleX","number",1),pc.script.attribute("scaleY","number",1),pc.script.create("font_renderer",function(a){var b=null,c=null,d=new pc.Vec2,e=function(a){this.entity=a};return e.prototype={initialize:function(){this.localize();var e=document.getElementById("application-canvas");this.scaleAdjustment=.42,this.userOffset=new pc.Vec2,this.offset=new pc.Vec2,this.scaling=new pc.Vec2,this.anchorOffset=new pc.Vec2,this.pivotOffset=new pc.Vec2,this.width=0,this.height=0,this.textRealLength=0,this.myScaling=new pc.Vec2,this.myScaling.set(this.scaleX*this.scaleAdjustment,this.scaleY*this.scaleAdjustment);var f=a.graphicsDevice;if(!b){var g={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:["attribute vec2 aPosition;","attribute vec2 aUv0;","varying vec2 vUv0;","uniform vec2 uResolution;","uniform vec2 uOffset;","uniform vec2 uScale;","uniform vec2 mScale;","uniform vec2 uPivot;","uniform vec2 uAnchorPoint;","","void main(void)","{","    vec2 scaledPosition = aPosition;","    gl_Position = vec4(2.0 * ((uScale * scaledPosition.xy + uOffset)  / uResolution ) - 1.0, -0.9, 1.0);","    vUv0 = aUv0;","}"].join("\n"),fshader:["precision "+f.precision+" float;","","varying vec2 vUv0;","","uniform vec4 vTint;","","uniform sampler2D uColorMap;","","void main(void)","{","    vec4 color = texture2D(uColorMap, vUv0);","    gl_FragColor = vec4(color.rgb * vTint.rgb, color.a * vTint.a);","}"].join("\n")};b=new pc.Shader(f,g)}c||(c=new pc.VertexFormat(f,[{semantic:pc.SEMANTIC_POSITION,components:2,type:pc.ELEMENTTYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.ELEMENTTYPE_FLOAT32}]));for(var h=function(){this.atlas=i[0].resource,this.font=i[1].resource,this.vertexBuffer=new pc.VertexBuffer(f,c,6*this.maxTextLength,pc.BUFFER_DYNAMIC),this.updateText(this.text);var g=new pc.Command(pc.LAYER_HUD,pc.BLEND_NORMAL,function(){if(this.entity.enabled){f.setShader(b);var a=f.getBlending(),c=f.getDepthTest(),g=f.getDepthWrite();f.setBlending(!0),f.setDepthTest(!1),f.setDepthWrite(!1),f.setBlendFunction(pc.BLENDMODE_SRC_ALPHA,pc.BLENDMODE_ONE_MINUS_SRC_ALPHA),d.set(e.offsetWidth,e.offsetHeight),this.myScaling.set(this.scaleX*this.scaleAdjustment,this.scaleY*this.scaleAdjustment),f.scope.resolve("uResolution").setValue(d.data),f.scope.resolve("uScale").setValue(this.calculateScaling().data),f.scope.resolve("mScale").setValue(this.myScaling.data),f.scope.resolve("uPivot").setValue(this.calculatePivotOffset().data),f.scope.resolve("uAnchorPoint").setValue(this.calculateAnchorOffset().data),f.scope.resolve("uOffset").setValue(this.calculateOffset().data),f.scope.resolve("uColorMap").setValue(this.atlas),f.scope.resolve("vTint").setValue(this.tint.data),f.setVertexBuffer(this.vertexBuffer,0),f.draw({type:pc.PRIMITIVE_TRIANGLES,base:0,count:6*this.textRealLength,indexed:!1}),f.setBlending(a),f.setDepthTest(c),f.setDepthWrite(g)}}.bind(this));this.command=g,g.key=this.depth,a.scene.drawCalls.push(g),this.on("set",this.onAttributeChanged,this)}.bind(this),i=[a.assets.get(this.fontAtlas),a.assets.get(this.fontJson)],j=0,k=0;k<i.length;k++)i[k].ready(function(a){j++,j===i.length&&h()}),a.assets.load(i[k]);a.mouse.on("mousedown",this.onMouseDown,this),a.touch&&a.touch.on("touchstart",this.onTouchDown,this)},onMouseDown:function(a){this.eventsEnabled&&this.onClick(a)},onTouchDown:function(a){this.eventsEnabled&&this.onClick(a.changedTouches[0])},onClick:function(b){var c,e,f,g,h,i,j=a.graphicsDevice.canvas,k=this.scaling,l=this.offset,m=this.width,n=this.height;c=2*(0*k.x+l.x)/d.x-1,e=2*(0*k.y+l.y)/d.y-1,f=2*(k.x*m+l.x)/d.x-1,g=2*(k.y*-n+l.y)/d.y-1,h=2*b.x/j.offsetWidth-1,i=2*(j.offsetHeight-b.y)/j.offsetHeight-1,h>=c&&f>=h&&e>=i&&i>=g&&this.fire("click")},onAttributeChanged:function(a,b,c){this.eventsEnabled=!1,"text"===a?b!==c&&this.updateText():"depth"===a&&(this.command.key=c)},getTotalOffset:function(a){return a.copy(this.userOffset).add(this.alignOffset),a},updateText:function(){this.vertexBuffer.lock();var a,b,c,d,e,f=0,g=0,h=f,i=g,j=0,k=this.text,l=k.length;this.width=0,this.height=0;var m=new pc.VertexIterator(this.vertexBuffer);for(this.textRealLength=l,e=0;l>e;e++){var n=k.charCodeAt(e),o=this.font.chars[n];a=o.x/this.font.common.scaleW,b=1-(o.y+o.height)/this.font.common.scaleH,c=(o.x+o.width)/this.font.common.scaleW,d=1-o.y/this.font.common.scaleH;var p=o.width,q=o.height,r=o.xoffset,s=o.yoffset;h=f+r,i=-s+g,this.width=Math.max(this.width,h+p),this.height=Math.max(this.height,i+q),m.element[pc.SEMANTIC_POSITION].set(h,i-q),m.element[pc.SEMANTIC_TEXCOORD0].set(a,b),m.next(),m.element[pc.SEMANTIC_POSITION].set(h+p,i-q),m.element[pc.SEMANTIC_TEXCOORD0].set(c,b),m.next(),m.element[pc.SEMANTIC_POSITION].set(h,i),m.element[pc.SEMANTIC_TEXCOORD0].set(a,d),m.next(),m.element[pc.SEMANTIC_POSITION].set(h+p,i-q),m.element[pc.SEMANTIC_TEXCOORD0].set(c,b),m.next(),m.element[pc.SEMANTIC_POSITION].set(h+p,i),m.element[pc.SEMANTIC_TEXCOORD0].set(c,d),m.next(),m.element[pc.SEMANTIC_POSITION].set(h,i),m.element[pc.SEMANTIC_TEXCOORD0].set(a,d);var t=!1;if("\\"===k[e+1]&&"n"===k[e+2]&&(e+=2,t=!0,this.textRealLength-=2),e==l-1)m.end();else if(m.next(),t)f=0,g-=q*(this.lineSpacinng+1);else{var u=k.charCodeAt(e+1);j=this.font.kernings[n]&&this.font.kernings[n][u]?this.font.kernings[n][u]:0,f+=o.xadvance+j}}this.vertexBuffer.unlock()},calculateOffset:function(){var b=a.graphicsDevice.canvas;return this.calculateAnchorOffset(),this.calculatePivotOffset(),this.offset.set(this.x*this.scaling.x/(this.scaleX*this.scaleAdjustment),this.y*this.scaling.y/(this.scaleY*this.scaleAdjustment)).add(this.userOffset).add(this.anchorOffset).add(this.pivotOffset),this.offset.y+=b.offsetHeight,this.offset},calculateScaling:function(){var b=a.graphicsDevice.canvas,c=b.offsetHeight/this.maxResHeight;return this.scaling.set(c*this.scaleX*this.scaleAdjustment,c*this.scaleY*this.scaleAdjustment),this.scaling},calculateAnchorOffset:function(){var b=a.graphicsDevice.canvas,c=b.offsetWidth,d=b.offsetHeight;switch(this.anchor){case 0:this.anchorOffset.set(0,0);break;case 1:this.anchorOffset.set(.5*c,0);break;case 2:this.anchorOffset.set(c,0);break;case 3:this.anchorOffset.set(0,.5*-d);break;case 4:this.anchorOffset.set(.5*c,.5*-d);break;case 5:this.anchorOffset.set(c,.5*-d);break;case 6:this.anchorOffset.set(0,-d);break;case 7:this.anchorOffset.set(c/2,-d);break;case 8:this.anchorOffset.set(c,-d);break;default:console.error("Wrong anchor: "+this.anchor)}return this.anchorOffset},calculatePivotOffset:function(){var a=this.width*this.scaling.x,b=this.height*this.scaling.y;switch(this.pivot){case 0:this.pivotOffset.set(0,0);break;case 1:this.pivotOffset.set(.5*-a,0);break;case 2:this.pivotOffset.set(-a,0);break;case 3:this.pivotOffset.set(0,.5*b);break;case 4:this.pivotOffset.set(.5*-a,.5*b);break;case 5:this.pivotOffset.set(-a,.5*b);break;case 6:this.pivotOffset.set(0,b);break;case 7:this.pivotOffset.set(-a/2,b);break;case 8:this.pivotOffset.set(-a,b);break;default:console.error("Wrong pivot: "+this.pivot)}return this.pivotOffset},onEnable:function(){this.eventsEnabled=!1},onDisable:function(){this.eventsEnabled=!1},update:function(a){this.eventsEnabled=!0},destroy:function(){if(this.command){var b=a.scene.drawCalls.indexOf(this.command);b>=0&&a.scene.drawCalls.splice(b,1)}},localize:function(){var a=this.entity.getName(),b=this.text,c=this.scaleX,d=this.x,e=this.y;switch(a){case"Mission_Complete":var f=textDic.Mission.Complete;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"+1Mutagen":var f=textDic.Mission.Mutagen;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"UpgradeTurotial_Content":var f=textDic.Upgrade.Tutorial;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Reset_Button":var f=textDic.Upgrade.Reset;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Go_Button":var f=textDic.Upgrade.GO;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Map_Go_Button":var f=textDic.Map.Go_Button;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"OK_Tutorial":var f=textDic.Upgrade.OK_Tutorial;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Chinatown_Text":var f=textDic.Map.NewLevel_ChinaTown;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Midtown_Text":var f=textDic.Map.NewLevel_Midtown;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Title_Mission":var f=textDic.Mission.General.Title;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"TextSpeed":var f=textDic.Upgrade.Upgrade_Speed;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"TextHandling":var f=textDic.Upgrade.Upgrade_Handling;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"TextDash":var f=textDic.Upgrade.Upgrade_Dash;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Upgrade_Mutagen":var f=textDic.Upgrade.Upgrade_Mutagen;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Cong_Complete":var f=textDic.Congrats.Complete;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Start_Over":var f=textDic.Congrats.Start_Over;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"Keep_Flying":var f=textDic.Congrats.Keep_Flying;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY;break;case"HighlightText":var f=textDic.Help.Spotlights;b=f.value,c=f.size,d=f.offsetX,e=f.offsetY}this.text=b,this.scaleX=this.scaleY=c,this.x=d,this.y=e}},e});