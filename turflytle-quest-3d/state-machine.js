var StateMachine={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var c="string"==typeof a.initial?{state:a.initial}:a.initial,d=a.terminal||a["final"],e=b||a.target||{},f=a.events||[],g=a.callbacks||{},h={},i={},j=function(a){var b=a.from instanceof Array?a.from:a.from?[a.from]:[StateMachine.WILDCARD];h[a.name]=h[a.name]||{};for(var c=0;c<b.length;c++)i[b[c]]=i[b[c]]||[],i[b[c]].push(a.name),h[a.name][b[c]]=a.to||b[c]};c&&(c.event=c.event||"startup",j({name:c.event,from:"none",to:c.state}));for(var k=0;k<f.length;k++)j(f[k]);for(var l in h)h.hasOwnProperty(l)&&(e[l]=StateMachine.buildEvent(l,h[l]));for(var l in g)g.hasOwnProperty(l)&&(e[l]=g[l]);return e.current="none",e.is=function(a){return a instanceof Array?a.indexOf(this.current)>=0:this.current===a},e.can=function(a){return!this.transition&&(h[a].hasOwnProperty(this.current)||h[a].hasOwnProperty(StateMachine.WILDCARD))},e.cannot=function(a){return!this.can(a)},e.transitions=function(){return i[this.current]},e.isFinished=function(){return this.is(d)},e.error=a.error||function(a,b,c,d,e,f,g){throw g||f},c&&!c.defer&&e[c.event](),e},doCallback:function(a,b,c,d,e,f){if(b)try{return b.apply(a,[c,d,e].concat(f))}catch(g){return a.error(c,d,e,f,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",g)}},beforeAnyEvent:function(a,b,c,d,e){return StateMachine.doCallback(a,a.onbeforeevent,b,c,d,e)},afterAnyEvent:function(a,b,c,d,e){return StateMachine.doCallback(a,a.onafterevent||a.onevent,b,c,d,e)},leaveAnyState:function(a,b,c,d,e){return StateMachine.doCallback(a,a.onleavestate,b,c,d,e)},enterAnyState:function(a,b,c,d,e){return StateMachine.doCallback(a,a.onenterstate||a.onstate,b,c,d,e)},changeState:function(a,b,c,d,e){return StateMachine.doCallback(a,a.onchangestate,b,c,d,e)},beforeThisEvent:function(a,b,c,d,e){return StateMachine.doCallback(a,a["onbefore"+b],b,c,d,e)},afterThisEvent:function(a,b,c,d,e){return StateMachine.doCallback(a,a["onafter"+b]||a["on"+b],b,c,d,e)},leaveThisState:function(a,b,c,d,e){return StateMachine.doCallback(a,a["onleave"+c],b,c,d,e)},enterThisState:function(a,b,c,d,e){return StateMachine.doCallback(a,a["onenter"+d]||a["on"+d],b,c,d,e)},beforeEvent:function(a,b,c,d,e){return!1===StateMachine.beforeThisEvent(a,b,c,d,e)||!1===StateMachine.beforeAnyEvent(a,b,c,d,e)?!1:void 0},afterEvent:function(a,b,c,d,e){StateMachine.afterThisEvent(a,b,c,d,e),StateMachine.afterAnyEvent(a,b,c,d,e)},leaveState:function(a,b,c,d,e){var f=StateMachine.leaveThisState(a,b,c,d,e),g=StateMachine.leaveAnyState(a,b,c,d,e);return!1===f||!1===g?!1:StateMachine.ASYNC===f||StateMachine.ASYNC===g?StateMachine.ASYNC:void 0},enterState:function(a,b,c,d,e){StateMachine.enterThisState(a,b,c,d,e),StateMachine.enterAnyState(a,b,c,d,e)},buildEvent:function(a,b){return function(){var c=this.current,d=b[c]||b[StateMachine.WILDCARD]||c,e=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,c,d,e,StateMachine.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,c,d,e,StateMachine.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===StateMachine.beforeEvent(this,a,c,d,e))return StateMachine.Result.CANCELLED;if(c===d)return StateMachine.afterEvent(this,a,c,d,e),StateMachine.Result.NOTRANSITION;var f=this;this.transition=function(){return f.transition=null,f.current=d,StateMachine.enterState(f,a,c,d,e),StateMachine.changeState(f,a,c,d,e),StateMachine.afterEvent(f,a,c,d,e),StateMachine.Result.SUCCEEDED},this.transition.cancel=function(){f.transition=null,StateMachine.afterEvent(f,a,c,d,e)};var g=StateMachine.leaveState(this,a,c,d,e);return!1===g?(this.transition=null,StateMachine.Result.CANCELLED):StateMachine.ASYNC===g?StateMachine.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=StateMachine),exports.StateMachine=StateMachine):"function"==typeof define&&define.amd?define(function(a){return StateMachine}):"undefined"!=typeof window?window.StateMachine=StateMachine:"undefined"!=typeof self&&(self.StateMachine=StateMachine);