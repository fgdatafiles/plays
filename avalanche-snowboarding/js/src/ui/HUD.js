AvalancheSnowboarding.HUD=function(game,parent){Phaser.Group.call(this,game,parent);this.horizontalPadding=15;this.verticalPadding=15;this.hearts=[];for(var i=0;i<AvalancheSnowboarding.Model.totalHearts;i++){var heart=this.game.add.image(0,0,'heart');heart.x=this.horizontalPadding+i*heart.width;heart.y=this.verticalPadding;this.hearts.push(heart);}
this.scoreBackground=this.game.add.image(0,0,'scoreBackground');this.scoreText=this.game.add.text(this.scoreBackground.width/2,this.scoreBackground.height*0.575," 0 ",{font:"16px Arial",fill:"#FFFFFF",align:"center"});this.scoreText.anchor.setTo(0.5,0.5);this.scoreContainer=this.game.add.group();this.scoreContainer.add(this.scoreBackground);this.scoreContainer.add(this.scoreText);this.scoreContainer.x=this.game.world.width-this.scoreContainer.width-this.horizontalPadding;this.scoreContainer.y=this.verticalPadding;this.locatorContainer=this.game.add.group();this.add(this.locatorContainer);this.locatorBackground=this.game.add.image(3,0,'locatorBackground');this.locatorFrame=this.game.add.image(0,0,'locatorFrame');this.locatorPointer=this.game.add.image(0,0,'locatorPointer');this.locatorPointer.x=3;this.locatorPointer.y=(this.locatorFrame.height-this.locatorPointer.height)*0.5;this.locatorContainer.add(this.locatorBackground);this.locatorContainer.add(this.locatorPointer);this.locatorContainer.add(this.locatorFrame);this.locatorContainer.x=this.horizontalPadding;this.locatorContainer.y=this.game.world.height-this.locatorContainer.height-this.verticalPadding/2;this.locatorPointerStartX=this.locatorPointer.x;this.locatorPointerEndX=this.locatorFrame.x+this.locatorFrame.width*0.9;this.countdown=this.game.add.sprite(this.game.world.centerX,50,'countdown');this.countdown.anchor.set(0.5,0);this.countdownAnimation=this.countdown.animations.add('main',Phaser.Animation.generateFrameNames('M_CountDown',1,126,'.png',4),30,false);this.countdownAnimation.enableUpdate=true;this.countdownAnimation.onUpdate.add(function(anim,frame){if(frame.index>=90){this.countdownAnimation.onUpdate.removeAll();this.countdownAnimation.enableUpdate=false;this.onCountdownComplete();}},this);this.countdownAnimation.onComplete.add(function(){this.onCountdownComplete();this.countdownAnimation.destroy();this.countdownAnimation=null;this.countdown.destroy();this.countdown=null;},this);this.scoreTweenData={width:this.scoreContainer.width,height:this.scoreContainer.height,x:this.scoreContainer.x+this.scoreContainer.width/2,y:this.scoreContainer.y+this.scoreContainer.height/2,};this.scoreTween=this.game.add.tween(this.scoreContainer).to({width:this.scoreTweenData.width*1.25,height:this.scoreTweenData.height*1.25,},150,"Quad.easeOut").to({width:this.scoreTweenData.width,height:this.scoreTweenData.height,},150,"Quad.easeOut");this.scoreTween.onComplete.add(function(){if(this.scoreTweenLoop>0){this.scoreTweenLoop--;this.scoreTween.start();}},this);this.scoreTween.onUpdateCallback(function(){this.scoreContainer.x=this.scoreTweenData.x-this.scoreContainer.width/2;this.scoreContainer.y=this.scoreTweenData.y-this.scoreContainer.height/2;},this);this.scoreTweenLoop=0;this.audioCountdown=this.game.add.audio("countdown");};AvalancheSnowboarding.HUD.prototype=Object.create(Phaser.Group.prototype);AvalancheSnowboarding.HUD.constructor=AvalancheSnowboarding.HUD;AvalancheSnowboarding.HUD.prototype.updateLives=function(numLives){for(i=0;i<this.hearts.length;i++){this.hearts[i].visible=i<numLives;}};AvalancheSnowboarding.HUD.prototype.addScore=function(score,x,y){AvalancheSnowboarding.Model.score+=score;if(!this.scoreTween.isRunning){this.scoreTween.start();}else{this.scoreTweenLoop++;}
this.scoreText.text=" "+AvalancheSnowboarding.Model.score+" ";if(x!=null&&y!=null){var score=this.game.add.text(0,0,'+'+score,{font:"56px Arial",fill:"#FF6633",align:"center",fontWeight:"bolder"});score.anchor.setTo(0,1);score.stroke='#000000';score.strokeThickness=5;score.x=x;score.y=y;var tween=this.game.add.tween(score).to({alpha:0,y:score.y-100,},1000).start();}};AvalancheSnowboarding.HUD.prototype.updateLocator=function(distance,distanceTotal){var ratio=distance/distanceTotal;ratio=Math.min(ratio,1);this.locatorPointer.x=this.locatorPointerStartX+(this.locatorPointerEndX-this.locatorPointerStartX)*ratio;};AvalancheSnowboarding.HUD.prototype.startCountdown=function(callback,callbackContext){this.countdownCompleteCallback=callback;this.countdownCompleteCallbackContext=callbackContext;this.countdown.play('main');if(!this.game.sound.mute)
this.audioCountdown.play();};AvalancheSnowboarding.HUD.prototype.onCountdownComplete=function(){if(this.countdownCompleteCallback!=null&&this.countdownCompleteCallbackContext!=null){this.countdownCompleteCallback.apply(this.countdownCompleteCallbackContext);this.countdownCompleteCallback=null;this.countdownCompleteCallbackContext=null;}}
AvalancheSnowboarding.HUD.prototype.useHeart=function(){var isHeartUsed=false;if(AvalancheSnowboarding.Model.numHearts>1){AvalancheSnowboarding.Model.numHearts--;var heart=this.hearts[AvalancheSnowboarding.Model.numHearts];heart.visible=false;isHeartUsed=true;}
return isHeartUsed;};AvalancheSnowboarding.HUD.prototype.update=function(){}
AvalancheSnowboarding.HUD.prototype.destroy=function(){if(this.countdownAnimation){this.countdownAnimation.stop();this.countdownAnimation=null;}
if(this.scoreTween){this.scoreTween.onComplete.removeAll();this.scoreTween=null;}
if(this.audioCountdown!=null){this.audioCountdown.stop();this.audioCountdown=null;}};