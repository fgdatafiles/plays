(function(B){function m(a,b){function d(){}d.prototype=a;var c=new d,g;for(g in b)c[g]=b[g];b.toString!==Object.prototype.toString&&(c.toString=b.toString);return c}function l(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=F++);var d;null==a.hx__closures__?a.hx__closures__={}:d=a.hx__closures__[b.__id__];null==d&&(d=function(){return d.method.apply(d.scope,arguments)},d.scope=a,d.method=b,a.hx__closures__[b.__id__]=d);return d}var C=function(a,b){b=b.split("u").join("");this.r=RegExp(a,b)};C.__name__=!0;C.prototype={replace:function(a,b){return a.replace(this.r,b)},__class__:C};var t=function(){};t.__name__=!0;t.cca=function(a,b){var d=a.charCodeAt(b);return d!=d?void 0:d};t.substr=function(a,b,d){if(null!=b&&0!=b&&null!=d&&0>d)return"";null==d&&(d=a.length);0>b?(b=a.length+b,0>b&&(b=0)):0>d&&(d=a.length+d-b);return a.substr(b,d)};t.indexOf=function(a,b,d){var c=a.length;0>d&&(d+=c,0>d&&(d=0));for(;d<c;){if(a[d]===b)return d;d++}return-1};t.remove=function(a,b){var d=t.indexOf(a,b,0);if(-1==d)return!1;a.splice(d,1);return!0};var k=function(){};k.__name__=!0;k.main=function(){};k.validateBrowser=function(){var a=document.createElement("canvas");if(null==a.getContext||null==a.getContext("2d").fillText)return!1;a=window.audioContextInstance;return b.GameManager.isMobile()&&null==a?!1:!0};k.validateCookies=function(){return null!=w.Browser.getLocalStorage()&&null!=w.Browser.getSessionStorage()&&null!=navigator.cookieEnabled&&navigator.cookieEnabled};k.init=B.runGame=function(a){if(k.validateBrowser())if(k.validateCookies()){var e=k.getDocument();k.container=e.createElement("div");window.tabindex="0";k.container.style.position="absolute";k.container.className="container";k.container.style.marginTop="0px";k.container.style.width=k.CANVAS_WIDTH_LANDSCAPE+"px";k.container.style.height=k.CANVAS_HEIGHT_LANDSCAPE+"px";a.appendChild(k.container);k.dataBaseUrl=k.getContainer().parentElement.getAttribute("data-base-url");k.dataWidth=q.parseFloat(k.getContainer().parentElement.getAttribute("data-width"));k.dataHeight=q.parseFloat(k.getContainer().parentElement.getAttribute("data-height"));a=k.getQueryStringValue(k.getWindow().location.href,"locale");""==a&&(a="en-us");k.dataLocale=a;k._prevDataWidth=k.dataWidth;k._prevDataHeight=k.dataHeight;b.managers.SoundManager.init();k.gameManager=new b.GameManager("CHANGE_ME_game_id",new c.boot.BootState);k.gameManager.init();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(k.update,1E3/(b.GameManager.isMobile()?k.TARGET_FPS_MOBILE:k.TARGET_FPS))}}();k.update()}else window.location.href="cookies.html";else window.location.href="unsupported.html"};k.getQueryStringValue=function(a,b){var d=a.split("?");if(2>d.length)return"";for(var d=d[1].split("&"),c=d.length,g=0;g<c;){var h=g++;if(x.startsWith(d[h],b)&&(h=d[h].split("="),!(2>h.length)))return h[1]}return""};k.update=function(){k.gameManager.update();k.gameManager.render();k.gameManager.postUpdate();"1"==b.GameConfig.getProperty("debugDraw")&&k.gameManager.debugRender();k.dataWidth=q.parseFloat(k.getContainer().parentElement.getAttribute("data-width"));k.dataHeight=q.parseFloat(k.getContainer().parentElement.getAttribute("data-height"));if(k.dataWidth!=k._prevDataWidth||k.dataHeight!=k._prevDataHeight)k.gameManager.onResizeWindow(),k._prevDataWidth=k.dataWidth,k._prevDataHeight=k.dataHeight;window.requestAnimFrame(k.update)};k.getDocument=function(){return window.document};k.getWindow=function(){return window};k.getCanvas=function(){return k.canvas};k.getContainer=function(){return k.container};k.getBasePath=function(){for(var a=k.getWindow().location.href.split("/"),b="",d=0,c=a.length-1;d<c;)var g=d++,b=b+(a[g]+"/");return b};B=function(){};B.__name__=!0;Math.__name__=!0;var v=function(){};v.__name__=!0;v.field=function(a,b){try{return a[b]}catch(d){return null}};v.setProperty=function(a,b,d){var c;if(a.__properties__&&(c=a.__properties__["set_"+b]))a[c](d);else a[b]=d};v.isFunction=function(a){return"function"==typeof a&&!(a.__name__||a.__ename__)};v.compareMethods=function(a,b){return a==b?!0:v.isFunction(a)&&v.isFunction(b)?a.scope==b.scope&&a.method==b.method&&null!=a.method:!1};var q=function(){};q.__name__=!0;q.string=function(a){return w.Boot.__string_rec(a,"")};q.parseInt=function(a){var b=parseInt(a,10);0!=b||120!=t.cca(a,1)&&88!=t.cca(a,1)||(b=parseInt(a));return isNaN(b)?null:b};q.parseFloat=function(a){return parseFloat(a)};var A=function(){this.b=""};A.__name__=!0;A.prototype={add:function(a){this.b+=q.string(a)},addSub:function(a,b,d){this.b=null==d?this.b+t.substr(a,b,null):this.b+t.substr(a,b,d)},__class__:A};var x=function(){};x.__name__=!0;x.startsWith=function(a,b){return a.length>=b.length&&t.substr(a,0,b.length)==b};x.replace=function(a,b,d){return a.split(b).join(d)};x.fastCodeAt=function(a,b){return a.charCodeAt(b)};var y=function(){};y.__name__=!0;y.getClass=function(a){return null==a?null:a instanceof Array&&null==a.__enum__?Array:a.__class__};y.getSuperClass=function(a){return a.__super__};y.createEnum=function(a,b,d){var c=v.field(a,b);if(null==c)throw"No such constructor "+
b;if(v.isFunction(c)){if(null==d)throw"Constructor "+b+" need parameters";return c.apply(a,d)}if(null!=d&&0!=d.length)throw"Constructor "+b+" does not need parameters";return c};var s=function(){};s.__name__=!0;s.parse=function(a){return u.xml.Parser.parse(a)};s.createElement=function(a){var b=new s;b.nodeType=s.Element;b._children=[];b._attributes=new u.ds.StringMap;b.set_nodeName(a);return b};s.createPCData=function(a){var b=new s;b.nodeType=s.PCData;b.set_nodeValue(a);return b};s.createCData=function(a){var b=new s;b.nodeType=s.CData;b.set_nodeValue(a);return b};s.createComment=function(a){var b=new s;b.nodeType=s.Comment;b.set_nodeValue(a);return b};s.createDocType=function(a){var b=new s;b.nodeType=s.DocType;b.set_nodeValue(a);return b};s.createProcessingInstruction=function(a){var b=new s;b.nodeType=s.ProcessingInstruction;b.set_nodeValue(a);return b};s.createDocument=function(){var a=new s;a.nodeType=s.Document;a._children=[];return a};s.prototype={get_nodeName:function(){if(this.nodeType!=s.Element)throw"bad nodeType";return this._nodeName},set_nodeName:function(a){if(this.nodeType!=s.Element)throw"bad nodeType";return this._nodeName=a},get_nodeValue:function(){if(this.nodeType==s.Element||this.nodeType==s.Document)throw"bad nodeType";return this._nodeValue},set_nodeValue:function(a){if(this.nodeType==s.Element||this.nodeType==s.Document)throw"bad nodeType";return this._nodeValue=a},get:function(a){if(this.nodeType!=s.Element)throw"bad nodeType";return this._attributes.get(a)},set:function(a,b){if(this.nodeType!=s.Element)throw"bad nodeType";this._attributes.set(a,b)},exists:function(a){if(this.nodeType!=s.Element)throw"bad nodeType";return this._attributes.exists(a)},elementsNamed:function(a){if(null==this._children)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){for(var b=this.cur,d=this.x.length;b<d;){var c=this.x[b];if(c.nodeType==s.Element&&c._nodeName==a)break;b++}this.cur=b;return b<d},next:function(){for(var b=this.cur,d=this.x.length;b<d;){var c=this.x[b];b++;if(c.nodeType==s.Element&&c._nodeName==a)return this.cur=b,c}return null}}},firstChild:function(){if(null==this._children)throw"bad nodetype";return this._children[0]},addChild:function(a){if(null==this._children)throw"bad nodetype";null!=a._parent&&t.remove(a._parent._children,a);a._parent=this;this._children.push(a)},__class__:s,__properties__:{set_nodeValue:"set_nodeValue",get_nodeValue:"get_nodeValue",set_nodeName:"set_nodeName",get_nodeName:"get_nodeName"}};var b={AssetType:{__ename__:!0,__constructs__:["Image","Audio","Other","Javascript","Css"]}};b.AssetType.Image=["Image",0];b.AssetType.Image.__enum__=b.AssetType;b.AssetType.Audio=["Audio",1];b.AssetType.Audio.__enum__=b.AssetType;b.AssetType.Other=["Other",2];b.AssetType.Other.__enum__=b.AssetType;b.AssetType.Javascript=["Javascript",3];b.AssetType.Javascript.__enum__=b.AssetType;b.AssetType.Css=["Css",4];b.AssetType.Css.__enum__=b.AssetType;b.AssetLoadingInfo=function(a,b,d,c){null==c&&(c=!1);this.isAbsolute=!1;this.asset=null;this.name=a;this.type=d;this.source=b;this.isAbsolute=c};b.AssetLoadingInfo.__name__=!0;b.AssetLoadingInfo.prototype={__class__:b.AssetLoadingInfo};b.events={};b.events.EventDispatcher=function(){this._eventListeners=[]};b.events.EventDispatcher.__name__=!0;b.events.EventDispatcher.prototype={addEventListener:function(a,e){this.hasEventListener(a,e)||this._eventListeners.push(new b.events.EventListener(a,e))},hasEventListener:function(a,b){for(var d=this._eventListeners.length-1;0<=d;){if(this._eventListeners[d].eventName==a&&v.compareMethods(this._eventListeners[d].action,b))return!0;d--}return!1},dispatchEvent:function(a){a.target=this;for(var b=[],d=this._eventListeners.length,c=0;c<d;){var g=c++;b.push(this._eventListeners[g])}for(d=b.length-1;0<=d;)c=b[d],c.eventName==a.getName()&&c.action(a),d--},removeAllEventListeners:function(){this._eventListeners=[]},removeEventListener:function(a,b){if(this.hasEventListener(a,b))for(var d=this._eventListeners.length-1;0<=d;){var c=this._eventListeners[d];if(c.eventName==a&&v.compareMethods(c.action,b)){this._eventListeners.splice(d,1);break}d--}},__class__:b.events.EventDispatcher};b.GameObject=function(){this._instanceId=0;this._isActive=this._isUpdating=!0;this._isInitialized=this._isMarkedForDeletion=!1;b.events.EventDispatcher.call(this);this._instanceId=b.GameObject._currentInstanceId++;this._properties=new u.ds.StringMap;this._tags=[]};b.GameObject.__name__=!0;b.GameObject.__super__=b.events.EventDispatcher;b.GameObject.prototype=m(b.events.EventDispatcher.prototype,{init:function(){this._isInitialized=!0;this.dispatchEvent(new b.events.GameObjectEvent("initialize"))},update:function(){this._isInitialized&&this._isActive||(this.init(),this._isActive&&this.activate())},postUpdate:function(){},render:function(){},activate:function(){this._isActive=!0;this.onActivated()},deactivate:function(){this._isActive=!1;this.onDeactivated()},onActivated:function(){this.dispatchEvent(new b.events.GameObjectEvent("activate"))},onDeactivated:function(){this.dispatchEvent(new b.events.GameObjectEvent("deactivate"))},debugRender:function(){},handleMessage:function(a,b){},setProperty:function(a,b){this._properties.set(a,b)},getProperty:function(a){return this._properties.get(a)},hasProperty:function(a){return this._properties.exists(a)},getIsMarkedForDeletion:function(){return this._isMarkedForDeletion},addTag:function(a){this._tags.push(a)},removeTag:function(a){for(var b=this._tags.length,d=0;d<b;){var c=d++;this._tags[c]==a&&this._tags.splice(c,1)}},hasTag:function(a){for(var b=this._tags.length,d=0;d<b;){var c=d++;if(this._tags[c]==a)return!0}return!1},getTags:function(){return this._tags},getName:function(){return this._name},setName:function(a){this._name=a},getInstanceId:function(){return this._instanceId},getIsActive:function(){return this._isActive},setIsActive:function(a){this._isInitialized||this.init();!this._isActive&&a&&this.activate();this._isActive&&!a&&this.deactivate();this._isActive=a},setIsUpdating:function(a){this._isUpdating=a},getIsUpdating:function(){return this._isUpdating},destroy:function(){this.setIsActive(!1);this._isMarkedForDeletion=!0},onDestroyed:function(){this.dispatchEvent(new b.events.GameObjectEvent("destroy"))},__class__:b.GameObject});b.Component=function(a,e){b.GameObject.call(this);a.addComponent(this);this.setName(e)};b.Component.__name__=!0;b.Component.__super__=b.GameObject;b.Component.prototype=m(b.GameObject.prototype,{getEntity:function(){return this._entity},setEntity:function(a){this._entity=a},getSiblingComponent:function(a){return this.getEntity().getComponent(a)},getGameState:function(){return this.getEntity().getGameState()},destroy:function(){b.GameObject.prototype.destroy.call(this)},onDestroyed:function(){b.GameObject.prototype.onDestroyed.call(this)},__class__:b.Component});b.Entity=function(a){this._isZSorted=!1;this._isVisible=!0;this._parent=null;b.GameObject.call(this);this._position=new b.Vector3D;this._rotation=new b.Vector3D;this._scale=new b.Vector3D(1,1,1);this._components=[];this._children=[]};b.Entity.__name__=!0;b.Entity.__super__=b.GameObject;b.Entity.prototype=m(b.GameObject.prototype,{init:function(){b.GameObject.prototype.init.call(this);for(var a=this._components.length,e=0;e<a;){var d=e++,d=this._components[d];d.getIsActive()&&d.init()}},getIsZSorted:function(){return this._isZSorted},setIsZSorted:function(a){this._isZSorted=a},getGameState:function(){return this._gameState},setGameState:function(a){this._gameState=a},hasChild:function(a){for(var b=this._children.length,d=0;d<b;){var c=d++;if(this._children[c]==a)return!0}return!1},removeChild:function(a){for(var b=this._children.length,d=0;d<b;){var c=d++,g=this._children[c];if(g==a){g.setParent(null);this._children.splice(c,1);break}}},addChild:function(a){a==this&&b.utilities.Debug.log("Cannot parent an Entity to itself.");null!=a.getParent()&&a.getParent().removeChild(a);this._children.push(a);a.setParent(this)},insertChild:function(a,e){a==this&&b.utilities.Debug.log("Cannot parent an Entity to itself.");null!=a.getParent()&&a.getParent().removeChild(a);this._children.splice(e,0,a);a.setParent(this)},destroyAllChildren:function(){for(var a=this._children.length,b=0;b<a;){var d=b++;this._children[d].destroy()}this._children=[]},getParent:function(){return this._parent},getRootEntity:function(){return null!=this.getParent()?this.getParent():this},setParent:function(a){this._parent=a;null!=this.getParent()?this.dispatchEvent(new b.events.EntityEvent("addedToParent",{parent:this.getParent()})):this.dispatchEvent(new b.events.EntityEvent("removedFromParent"));this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getPosition:function(){var a=this._position.getClone();if(null!=this._parent){var b=this._parent.getPosition(),d=this._parent.getScale(),c=this._parent.getRotation(),g=Math.sin(c.z),c=Math.cos(c.z),h=a.x*g+a.y*c;a.x=(a.x*c-a.y*g)*d.x+b.x;a.y=h*d.y+b.y;a.z+=b.z}return a},setIsActive:function(a){b.GameObject.prototype.setIsActive.call(this,a);for(var e=this._children.length,d=0;d<e;){var c=d++;this._children[c].setIsActive(a)}},getIsActive:function(){return this._isActive},getChildren:function(){return this._children},findChildByName:function(a){for(var b=this._children.length,d=0;d<b;){var c=d++,c=this._children[c];if(c.getName()==a)return c;c=c.findChildByName(a);if(null!=c)return c}return null},getIsVisible:function(){return null!=this._parent?this._parent.getIsVisible()&&this._isVisible:this._isVisible},activate:function(){b.GameObject.prototype.activate.call(this);for(var a=this._children.length,e=0;e<a;){var d=e++;this._children[d].activate()}this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},deactivate:function(){b.GameObject.prototype.deactivate.call(this);for(var a=this._children.length,e=0;e<a;){var d=e++;this._children[d].deactivate()}this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},setIsVisible:function(a){(this._isVisible=a)?this.dispatchEvent(new b.events.EntityEvent("visibilityOn")):this.dispatchEvent(new b.events.EntityEvent("visibilityOff"));this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getLocalPosition:function(){return this._position.getClone()},getPositionRef:function(){return this._position},setPosition:function(a,e,d){null==d&&(d=0);null==e&&(e=0);null==a&&(a=0);this._position=new b.Vector3D(a,e,d);this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},translate:function(a,e,d){null==d&&(d=0);null==e&&(e=0);null==a&&(a=0);this._position.x+=a;this._position.y+=e;this._position.z+=d;this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getRotationRef:function(){return this._rotation},getLocalRotation:function(){return this._rotation.getClone()},getRotation:function(){var a=this._rotation.getClone();if(null!=this._parent){var b=this._parent.getRotation();a.x+=b.x;a.y+=b.y;a.z+=b.z}return a},setRotation:function(a,e,d){null==d&&(d=0);null==e&&(e=0);null==a&&(a=0);this._rotation=new b.Vector3D(a,e,d);this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getScaleRef:function(){return this._scale},getScale:function(){var a=this._scale.getClone();if(null!=this._parent){var b=this._parent.getScale();a.x*=b.x;a.y*=b.y;a.z*=b.z}return a},setScale:function(a,e,d){null==d&&(d=1);null==e&&(e=1);null==a&&(a=1);this._scale=new b.Vector3D(a,e,d);this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},update:function(){b.GameObject.prototype.update.call(this);for(var a=this._components.length;0<a--;){var e=this._components[a];e.getIsMarkedForDeletion()&&(e.onDestroyed(),this._components.splice(a,1))}a=this._components.length;for(e=0;e<a;){var d=e++,d=this._components[d];d.getIsActive()&&d.getIsUpdating()&&d.update()}},render:function(){b.GameObject.prototype.render.call(this);for(var a=this._components.length,e=0;e<a;){var d=e++;this._components[d].render()}},postUpdate:function(){b.GameObject.prototype.postUpdate.call(this);for(var a=this._components.length,e=0;e<a;){var d=e++,d=this._components[d];d.getIsActive()&&d.getIsUpdating()&&d.postUpdate()}},debugRender:function(){b.GameObject.prototype.debugRender.call(this);for(var a=this._components.length,e=0;e<a;){var d=e++,d=this._components[d];d.getIsActive()&&d.debugRender()}a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();null!=b.components.Camera.getDebugCamera()&&(e=b.components.Camera.getDebugCamera().getEntity(),d=b.components.Camera.getDebugCamera().getZoomScale(),a.translate(-e.getPosition().x*d,-e.getPosition().y*d),a.scale(d,d));a.beginPath();a.globalAlpha=0.65;a.lineWidth=1;a.strokeStyle="#44FF44";a.moveTo(this.getPosition().x,this.getPosition().y-10);a.lineTo(this.getPosition().x,this.getPosition().y+10);a.moveTo(this.getPosition().x-10,this.getPosition().y);a.lineTo(this.getPosition().x+10,this.getPosition().y);a.moveTo(this.getPosition().x-10,this.getPosition().y-10);a.lineTo(this.getPosition().x+10,this.getPosition().y+10);a.moveTo(this.getPosition().x+10,this.getPosition().y-10);a.lineTo(this.getPosition().x-10,this.getPosition().y+10);a.stroke();a.restore();b.GameManager.instance.getLayerByName("debug").setWholeCanvasDirty(!0)},addComponent:function(a){for(var b=this._components.length,d=0;d<b;){var c=d++;if(this._components[c]==a)return null}this._components.push(a);a.setEntity(this);return a},getComponentByName:function(a){for(var b=this._components.length,d=0;d<b;){var c=d++;if(this._components[c].getName()==a)return this._components[c]}return null},getComponent:function(a){for(var b=this._components.length,d=0;d<b;){var c=d++;if(y.getClass(this._components[c])==a)return this._components[c]}return null},getComponentWithSuperClass:function(a){for(var b=this._components.length,d=0;d<b;){var c=d++;if(y.getSuperClass(y.getClass(this._components[c]))==a)return this._components[c]}return null},getComponentsInChildren:function(a){var b=[],d=this.getComponents(a);null!=d&&(b=b.concat(d));for(var d=this._children.length,c=0;c<d;){var g=c++,g=this._children[g].getComponentsInChildren(a);null!=g&&(b=b.concat(g))}return b},getComponents:function(a){for(var b=[],d=this._components.length,c=0;c<d;){var g=c++;y.getClass(this._components[g])==a?b.push(this._components[g]):y.getSuperClass(y.getClass(this._components[g]))==a&&b.push(this._components[g])}return 0<b.length?b:null},handleMessage:function(a,b){for(var d=this._components.length-
1;0<=d;){var c=this._components[d];c.getIsActive()&&c.handleMessage(a,b);d--}},getIsUpdating:function(){return null!=this._parent?this._isUpdating&&this._parent.getIsUpdating():this._isUpdating},destroy:function(){b.GameObject.prototype.destroy.call(this);null!=this._gameState&&this._gameState.scheduleEntityForDeletion(this);null!=this.getParent()&&this.getParent().removeChild(this);for(var a=this._components.length;0<a--;){var e=this._components[a];e.destroy();e.onDestroyed()}for(a=this._children.length;0<a--;)e=this._children[a],e.destroy(),e.onDestroyed()},onDestroyed:function(){b.GameObject.prototype.onDestroyed.call(this);this._gameState=null},__class__:b.Entity});b.GameConfig=function(){};b.GameConfig.__name__=!0;b.GameConfig.getProperty=function(a){return b.GameConfig._properties.get(a)};b.GameConfig.setProperty=function(a,e){var d=q.string(e);b.GameConfig._properties.set(a,d)};b.GameConfig.parseGameConfig=function(a){for(a=s.parse(a).elementsNamed("gameConfig").next().elementsNamed("property");a.hasNext();){var e=a.next(),d=e.get("name"),e=e.get("value");b.GameConfig._properties.set(d,e)}};b.GameConfig.prototype={__class__:b.GameConfig};b.GameEntity=function(a){null==a&&(a=!1);this._gameImage=this._flashAnimation=this._gameSprite=this._textField=this._deferredActionComponent=this._button=this._collider=this._tweener=this._simpleMovement=this._positionTweens=this._soundChannel=null;b.Entity.call(this,a)};b.GameEntity.__name__=!0;b.GameEntity.instantiate=function(a){return a.addEntity(new b.GameEntity)};b.GameEntity.__super__=b.Entity;b.GameEntity.prototype=m(b.Entity.prototype,{getVelocity:function(){var a=this.getSimpleMovement();null==a&&(this._simpleMovement=new b.components.SimpleMovement(this));return a.getVelocity()},setVelocity:function(a,e,d){var c=this.getSimpleMovement();null==c&&(this._simpleMovement=new b.components.SimpleMovement(this));return c.setVelocity(a,e,d)},getAngularVelocity2d:function(){var a=this.getSimpleMovement();null==a&&(this._simpleMovement=new b.components.SimpleMovement(this));return a.getAngularVelocity().z},setAngularVelocity2d:function(a){var e=this.getSimpleMovement();null==e&&(this._simpleMovement=new b.components.SimpleMovement(this));return e.setAngularVelocity(new b.Vector3D(0,0,a))},getGameImage:function(){return null!=this._gameImage?this._gameImage:this._gameImage=this.getComponent(b.components.GameImage)},getGameSprite:function(){return null!=this._gameSprite?this._gameSprite:this._gameSprite=this.getComponent(b.components.GameSprite)},getFlashAnimation:function(){return null!=this._flashAnimation?this._flashAnimation:this._flashAnimation=this.getComponent(b.flashAnimation.FlashAnimation)},getTextField:function(){return null!=this._textField?this._textField:this._textField=this.getComponent(b.components.TextField)},getDeferredActionComponent:function(){return null!=this._deferredActionComponent?this._deferredActionComponent:this._deferredActionComponent=this.getComponent(b.components.DeferredActionComponent)},getButton:function(){return null!=this._button?this._button:this._button=this.getComponent(b.components.Button)},getCollider:function(){return null!=this._collider?this._collider:this._collider=this.getComponent(b.components.Collider)},getTweener:function(){return null!=this._tweener?this._tweener:this._tweener=this.getComponent(b.components.Tweener)},getSimpleMovement:function(){return null!=this._simpleMovement?this._simpleMovement:this._simpleMovement=this.getComponent(b.components.SimpleMovement)},tweenToPosition:function(a,e,d,c,g,h){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"x",this.getPositionRef().x,a,d,g,c,h));this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"y",this.getPositionRef().y,e,d,g,c))},tweenToRotation:function(a,e,d,c,g){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getRotationRef(),"z",this.getRotationRef().z,b.utilities.Math2.degToRad(a),e,c,d))},tweenToPositionAndRotation:function(a,e,d,c,g,h,p){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"x",this.getPositionRef().x,a,c,h,g,p));this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"y",this.getPositionRef().y,e,c,h,g));this._positionTweens.push(this._tweener.addTween(this.getRotationRef(),"z",this.getRotationRef().z,b.utilities.Math2.degToRad(d),c,h,g))},tweenToScale:function(a,e,d,c,g,h){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getScaleRef(),"x",this.getScaleRef().x,a,d,g,c,h));this._positionTweens.push(this._tweener.addTween(this.getScaleRef(),"y",this.getScaleRef().y,e,d,g,c))},cancelPositionTweens:function(){if(null!=this._positionTweens){for(var a=this._positionTweens.length,b=0;b<a;){var d=b++;this._tweener.destroyTween(this._positionTweens[d])}this._positionTweens=null}},skipPositionTweens:function(){if(null!=this._positionTweens){for(var a=this._positionTweens.length,b=0;b<a;){var d=b++;this._positionTweens[d].skip()}this._positionTweens=null}},playSound:function(a,e){null==e&&(e=!1);this.stopSound();this._soundChannel=b.managers.SoundManager.playSoundByName(a,!1,e)},stopSound:function(){null!=this._soundChannel&&this._soundChannel.stop();this._soundChannel=null},destroy:function(){b.Entity.prototype.destroy.call(this);null!=this._soundChannel&&(this._soundChannel.stop(),this._soundChannel=null)},__class__:b.GameEntity});b.GameManager=function(a,e){this._prevWidth=this._prevHeight=0;this._isUpdating=!0;this._hasFocus=!1;this._screenScale=null;this._isOrientationScreenShowing=!1;this._currentOrientation=0;this._isDeferredActionsPaused=!1;this._gameStates=this._managers=this._layers=this._deferredActions=null;this._gameId=a;this._screenScale=new b.Vector2D(1,1);this._gameStates=[];b.GameManager.instance=this;this._layers=[];this._managers=[];this._deferredActions=[];this._initialState=e};b.GameManager.__name__=!0;b.GameManager.getTimeScale=function(){return b.GameManager._timeScale};b.GameManager.setTimeScale=function(a){b.GameManager._timeScale=a};b.GameManager.getElapsedTime=function(){return Math.min(2,b.GameManager._elapsedTime-b.GameManager._prevElapsedTime)*b.GameManager.getTimeScale()};b.GameManager.getPrevElapsedTime=function(){return b.GameManager._prevElapsedTime};b.GameManager.getRealElapsedTime=function(){return b.GameManager._elapsedTime-b.GameManager._prevElapsedTime};b.GameManager.isAppMode=function(){return window.isStandalone};b.GameManager.isIOS=function(){k.getWindow();var a=k.getWindow().navigator.platform;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")?!0:!1};b.GameManager.isMobile=function(){k.getWindow();var a=k.getWindow().navigator.platform;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")||-1!=a.indexOf("android")||-1!=a.indexOf("Linux")?!0:!1};b.GameManager.isInternetExplorer=function(){return-1!=navigator.userAgent.toLowerCase().indexOf("msie")};b.GameManager.isFirefox=function(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")};b.GameManager.isSafari=function(){return-1<navigator.userAgent.toLowerCase().indexOf("safari/")};b.GameManager.getDevicePixelRatio=function(){return 1};b.GameManager.prototype={getLayers:function(){return this._layers},getGameId:function(){return this._gameId},init:function(){b.GameManager._prevElapsedTime=u.Timer.stamp();b.GameManager._elapsedTime=u.Timer.stamp();this.addGameState(this._initialState);this._initialState.init();k.getContainer().focus();this._prevWidth=k.getWindow().innerWidth;this._prevHeight=k.getWindow().innerHeight;k.getWindow().addEventListener("pageshow",l(this,this.onOrientationChanged),!1);k.getWindow().addEventListener("resize",l(this,this.onResizeWindow),!1);window.onfocus=l(this,this.onFocusGained);window.onblur=l(this,this.onFocusLost);k.getDocument().addEventListener("webkitvisibilitychange",l(this,this.onWebkitVisibilityChange),!1);k.getWindow().addEventListener("pagehide",l(this,this.onFocusLost),!1);if(b.GameManager.isMobile())this.onOrientationChanged();else this.setScreenScale(1,1)},onAssetsLoaded:function(){},update:function(){b.GameManager._elapsedTime=u.Timer.stamp();if(!this._hasFocus)this.onFocusGained();if(this._isUpdating){for(var a=0,a=this._managers.length;0<a--;){var e=this._managers[a];e.getIsMarkedForDeletion()&&(e.onDestroyed(),this._managers.splice(a,1))}a=this._managers.length;for(e=0;e<a;){var d=e++,d=this._managers[d];d.getIsActive()&&d.update()}b.managers.SoundManager.update();for(a=this._gameStates.length;0<a--;)e=this._gameStates[a],e.getIsMarkedForDeletion()&&(e.onDestroyed(),this._gameStates.splice(a,1));a=this._gameStates.length;for(e=0;e<a;)d=e++,this._gameStates[d].getIsActive()&&this._gameStates[d].update();for(a=this._layers.length;0<a--;)e=this._layers[a],e.getIsMarkedForDeletion()&&(e.onDestroyed(),t.remove(this._layers,e));a=this._layers.length;for(e=0;e<a;)d=e++,this._layers[d].update()}if(!this._isDeferredActionsPaused)for(a=this._deferredActions.length;0<a--;)e=this._deferredActions[a],null!=e&&(e.timeUntilExecute-=b.GameManager.getElapsedTime(),0>=e.timeUntilExecute&&(e.params?e.actionToExecute(e.params):e.actionToExecute(),this._deferredActions.splice(a,1)));if(this._prevWidth!=k.getWindow().innerWidth||this._prevHeight!=k.getWindow().innerHeight)this.onOrientationChanged(),this._prevWidth=k.getWindow().innerWidth,this._prevHeight=k.getWindow().innerHeight;b.GameManager._prevElapsedTime=b.GameManager._elapsedTime},postUpdate:function(){for(var a=this._managers.length,b=0;b<a;){var d=b++,d=this._managers[d];d.getIsActive()&&d.postUpdate()}a=this._gameStates.length;for(b=0;b<a;)d=b++,this._gameStates[d].getIsActive()&&this._gameStates[d].postUpdate()},updateDivClass:function(){var a="container";1==this._currentOrientation&&(a+=" portrait");k.getContainer().className=a},render:function(){for(var a=this._layers.length,b=0;b<a;){var d=b++,d=this._layers[d];d.getAutoClear()&&d.getWholeCanvasDirty()&&d.clear()}a=this._gameStates.length;for(b=0;b<a;)d=b++,this._gameStates[d].render();a=this._managers.length;for(b=0;b<a;)d=b++,this._managers[d].render();a=this._layers.length;for(b=0;b<a;)d=b++,d=this._layers[d],"debug"!=d.getName()&&d.render()},debugRender:function(){for(var a=this._gameStates.length,b=0;b<a;){var d=b++;this._gameStates[d].debugRender()}a=this._managers.length;for(b=0;b<a;)d=b++,this._managers[d].debugRender();a=this._layers.length;for(b=0;b<a;)d=b++,d=this._layers[d],"debug"==d.getName()&&d.render(),d.debugRender()},getGameStates:function(){return this._gameStates},addGameState:function(a){for(var b=this._gameStates.length,d=0;d<b;){var c=d++;if(a==this._gameStates[c])return a}this._gameStates.push(a);return a},removeGameState:function(a,b){null==b&&(b=!0);b&&(a.destroy(),a.onDestroyed());for(var d=this._gameStates.length,c=0;c<d;){var g=c++;if(a==this._gameStates[g]){this._gameStates.splice(g,1);break}}},addManager:function(a){this._managers.push(a);a.init()},removeManager:function(a){for(var b=this._managers.length,d=0;d<b;){var c=d++;if(this._managers[c]==a){this._managers.splice(c,1);a.destroy();break}}},getManager:function(a){for(var b=this._managers.length,d=0;d<b;){var c=d++;if(y.getClass(this._managers[c])==a)return this._managers[c]}return null},setIsDeferredActionsPaused:function(a){this._isDeferredActionsPaused=a},destroyAllDeferredActions:function(){this._deferredActions=[]},switchToGameState:function(a,b,d){null==d&&(d=!0);null!=a&&this.removeGameState(a,d);null!=b&&this.addGameState(b)},addLayer:function(a,b){null==b&&(b=!1);b?this._layers.splice(0,0,a):this._layers.push(a)},insertLayerAfter:function(a,b){var d=t.indexOf(this._layers,b,0)+1;this._layers.splice(d,0,a)},removeLayer:function(a){a.destroy();t.remove(this._layers,a)},getLayerByName:function(a){for(var b=this._layers.length,d=0;d<b;){var c=d++,c=this._layers[c];if(c.getName()==a)return c}return null},sendGlobalMessage:function(a,b){for(var d=this._managers.length-1;0<=d;)this._managers[d].handleMessage(a,b),d--;for(d=this._gameStates.length-1;0<=d;)this._gameStates[d].handleMessage(a,b),d--},invokeAsyncDeferredAction:function(a,e,d){a=new b.components.DeferredAction(a,e,d);this._deferredActions.push(a);return a},destroyDeferredAction:function(a){t.remove(this._deferredActions,a)},onOrientationChanged:function(){var a=this;this.invokeAsyncDeferredAction(1,function(){var e=!1,e=b.GameManager.isMobile()?k.getWindow().innerWidth>k.getWindow().innerHeight:!0;"HORIZONTAL"==b.GameConfig.getProperty("forceOrientation")?(a._currentOrientation=0,e=!0):"VERTICAL"==b.GameConfig.getProperty("forceOrientation")?(a._currentOrientation=1,e=!1):a._currentOrientation=e?0:1;a.onResizeWindow();a.sendGlobalMessage("onOrientationChanged",{isHorizontal:e})})},setScreenScale:function(a,b){this.updateDivClass();this._screenScale.x=a;this._screenScale.y=b;this.onScreenScaleUpdated()},getScreenScale:function(){return b.GameManager.isAppMode()?new b.Vector2D(0.91*this._screenScale.x,0.91*this._screenScale.y):this._screenScale},getScreenSize:function(){return 0==this.getCurrentOrientation()?new b.Vector2D(k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE):new b.Vector2D(k.CANVAS_WIDTH_PORTRAIT,k.CANVAS_HEIGHT_PORTRAIT)},getScreenOffset:function(){var a=k.getWindow().innerWidth,e=k.getWindow().innerHeight;return 0==this._currentOrientation?new b.Vector2D(a/2-k.CANVAS_WIDTH_LANDSCAPE*this.getScreenScale().x/2,e/2-k.CANVAS_HEIGHT_LANDSCAPE*this.getScreenScale().y/2):new b.Vector2D(a/2-k.CANVAS_WIDTH_PORTRAIT*this.getScreenScale().x/2,e/2-k.CANVAS_HEIGHT_PORTRAIT*this.getScreenScale().y/2)},getCurrentOrientation:function(){return this._currentOrientation},onWebkitVisibilityChange:function(){if(k.getDocument().webkitHidden)this.onFocusLost();else this.onFocusGained()},onFocusGained:function(){if(!this._hasFocus){b.managers.InputManager.getInstance().disablePageKeyPresses();b.managers.SoundManager.resumeAllSounds();this._isUpdating=this._hasFocus=!0;var a=this.getLayerByName("master").getCanvas();if(null!=a){var e=a.width;a.width=0;a.width=e}this.sendGlobalMessage("onFocusGained")}},onFocusLost:function(){b.managers.SoundManager.pauseAllSounds();this._hasFocus&&(b.managers.InputManager.getInstance().enablePageKeyPresses(),this._isUpdating=this._hasFocus=!1,this.sendGlobalMessage("onFocusLost"))},onResizeWindow:function(){var a=1,e=a;b.GameManager.isMobile()||"1"==b.GameConfig.getProperty("scaleToScreenOnDesktop")?e=a=0==this._currentOrientation?Math.min(k.getWindow().innerHeight/k.CANVAS_HEIGHT_LANDSCAPE,k.getWindow().innerWidth/k.CANVAS_WIDTH_LANDSCAPE):Math.min(k.getWindow().innerHeight/k.CANVAS_HEIGHT_PORTRAIT,k.getWindow().innerWidth/k.CANVAS_WIDTH_PORTRAIT):(e=k.dataWidth/k.CANVAS_WIDTH_LANDSCAPE,a=k.dataHeight/k.CANVAS_HEIGHT_LANDSCAPE);this.sendGlobalMessage("onResizedWindow");this.setScreenScale(e,a)},onScreenScaleUpdated:function(){var a,e;a=k.getWindow().innerWidth;e=k.getWindow().innerHeight;b.GameManager.isMobile()&&this.hideAddressBar();0==this._currentOrientation?(k.getContainer().style.width=k.CANVAS_WIDTH_LANDSCAPE+"px",k.getContainer().style.height=k.CANVAS_HEIGHT_LANDSCAPE+"px"):(k.getContainer().style.width=k.CANVAS_WIDTH_PORTRAIT+"px",k.getContainer().style.height=k.CANVAS_HEIGHT_PORTRAIT+"px");for(var d=this._layers.length,c=0;c<d;){var g=c++,g=this._layers[g],h,p;0==this._currentOrientation?(g.getCanvas().style.width=k.CANVAS_WIDTH_LANDSCAPE*this.getScreenScale().x*b.GameManager.getDevicePixelRatio()+"px",g.getCanvas().style.height=k.CANVAS_HEIGHT_LANDSCAPE*this.getScreenScale().y*b.GameManager.getDevicePixelRatio()+"px",g.setSize(k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE),h=k.CANVAS_WIDTH_LANDSCAPE*this.getScreenScale().x,p=k.CANVAS_HEIGHT_LANDSCAPE*this.getScreenScale().y):(g.getCanvas().style.width=k.CANVAS_WIDTH_PORTRAIT*this.getScreenScale().x*b.GameManager.getDevicePixelRatio()+"px",g.getCanvas().style.height=k.CANVAS_HEIGHT_PORTRAIT*this.getScreenScale().y*b.GameManager.getDevicePixelRatio()+"px",g.setSize(k.CANVAS_WIDTH_PORTRAIT,k.CANVAS_HEIGHT_PORTRAIT),h=k.CANVAS_WIDTH_PORTRAIT*this.getScreenScale().x,p=k.CANVAS_HEIGHT_PORTRAIT*this.getScreenScale().y);g.getContainer().style.width=h+"px";g.getContainer().style.height=p+"px";g.getContainer().style.left=a/2-h/2+"px";g.getContainer().style.top=e/2-p/2+"px"}this.sendGlobalMessage("onScreenScaleUpdated")},stopUpdates:function(){this._isUpdating=!1},resumeUpdates:function(){this._isUpdating=!0},hideAddressBar:function(){this.isPhone()&&!window.location.hash&&(document.height<window.outerHeight&&(document.body.style.height=window.outerHeight+50+"px"),setTimeout(function(){window.scrollTo(0,1)},50))},isPhone:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("android")||-1!=navigator.userAgent.toLowerCase().indexOf("Linux")?!0:!1},__class__:b.GameManager};b.GameState=function(){this._activeEntities=this._entitiesToDelete=null;this._isPaused=!1;this._elapsedTime=0;this._hasInitialized=!1;b.GameObject.call(this);this._entities=[];this._activeEntities=[];this._entitiesToDelete=[]};b.GameState.__name__=!0;b.GameState.__super__=b.GameObject;b.GameState.prototype=m(b.GameObject.prototype,{getPaused:function(){return this._isPaused},init:function(){b.GameObject.prototype.init.call(this)},onButtonClicked:function(){},update:function(){b.GameObject.prototype.update.call(this);for(var a=this._entitiesToDelete.length,e=0;e<a;){var d=e++,d=this._entitiesToDelete[d];d.onDestroyed();t.remove(this._entities,d)}b.utilities.ArrayUtils.clear(this._entitiesToDelete);e=0;if(!this._isPaused){b.utilities.ArrayUtils.clear(this._activeEntities);a=this._entities.length;for(d=0;d<a;){var c=d++,c=this._entities[c];null!=c&&c.getIsActive()&&(this._activeEntities.push(c),e++,c.getIsUpdating()&&c.update())}this._elapsedTime+=b.GameManager.getElapsedTime()}"1"==b.GameConfig.getProperty("debugCheats")&&b.managers.InputManager.getInstance().isKeyPressed(105)&&(b.utilities.Debug.log(this._entities),b.utilities.Debug.log(this._activeEntities),b.managers.AssetManager.outputAssets(),b.utilities.Debug.log("Active entities: "+e))},postUpdate:function(){b.GameObject.prototype.postUpdate.call(this);if(!this._isPaused)for(var a=this._activeEntities.length,e=0;e<a;){var d=e++,d=this._activeEntities[d];d.getIsUpdating()&&d.postUpdate()}},render:function(){b.GameObject.prototype.render.call(this);for(var a=this._activeEntities.length,e=0;e<a;){var d=e++,d=this._activeEntities[d];d.getIsVisible()&&d.getIsActive()&&d.render()}},debugRender:function(){b.GameObject.prototype.debugRender.call(this);for(var a=this._entities.length,e=0;e<a;){var d=e++,d=this._entities[d];d.getIsActive()&&d.getIsVisible()&&d.debugRender()}},addEntity:function(a){null==a&&(a=new b.Entity);a.setGameState(this);this._entities.push(a);return a},removeEntity:function(a){t.remove(this._entities,a)},getHasEntity:function(a){return-1!=b.utilities.ArrayUtils.indexOf(this._entities,a)},getEntities:function(){return this._entities},findEntityByName:function(a){for(var b=this._entities.length,d=0;d<b;){var c=d++,c=this._entities[c];if(c.getName()==a)return c}return null},getEntitiesByTag:function(a,b){null==b&&(b=!0);for(var d=[],c=this._entities.length,g=0;g<c;){var h=g++,h=this._entities[h];(!b||h.getIsActive())&&h.hasTag(a)&&d.push(h)}return d},getClosestEntityToPointByTag:function(a,e,d){null==d&&(d=!0);e=this.getEntitiesByTag(e);for(var c=-1,g=null,h=e.length,p=0;p<h;){var n=p++,n=e[n];if(!d||n.getIsActive()){var z=n.getPosition(),z=(new b.Vector3D(z.x-a.x,z.y-a.y,z.z-a.z)).getLength();if(-1==c||z<c)c=z,g=n}}return g},sortEntitiesByZ:function(){this._entities.sort(function(a,b){var d=a.getPosition(),c=b.getPosition();return d.z==c.z?a.getInstanceId()>b.getInstanceId()?1:-1:d.z<c.z?1:-1})},handleMessage:function(a,e){b.GameObject.prototype.handleMessage.call(this,a,e);if(!this._isPaused)for(var d=this._activeEntities.length-1;0<=d;)this._activeEntities[d].getIsActive()&&this._activeEntities[d].handleMessage(a,e),d--},pause:function(){this._isPaused=!0},resume:function(){this._isPaused=!1},bringEntityToFront:function(a,b){null==b&&(b=!1);t.remove(this._entities,a)&&this._entities.push(a);if(b)for(var d=a.getChildren(),c=d.length,g=0;g<c;){var h=g++;this.bringEntityToFront(d[h],!0)}},sendEntityToBack:function(a,b){null==b&&(b=!1);t.remove(this._entities,a)&&this._entities.splice(0,0,a);if(b)for(var d=a.getChildren(),c=d.length,g=0;g<c;){var h=g++;this.sendEntityToBack(d[h],!0)}},insertEntityAfter:function(a,e){if(t.remove(this._entities,a)){var d=b.utilities.ArrayUtils.indexOf(this._entities,e)+1;this._entities.splice(d,0,a)}},scheduleEntityForDeletion:function(a){this._entitiesToDelete.push(a)},destroy:function(){b.GameObject.prototype.destroy.call(this);for(var a=this._entities.length-1;0<=a;)this._entities[a].destroy(),this._entities[a].onDestroyed(),a--;this._isMarkedForDeletion=!0},__class__:b.GameState});b.Layer=function(a,e,d,c,g){null==g&&(g=!1);this._context2d=null;this._wholeCanvasDirty=this._renderedThisFrame=!1;this._canvasWidth=this._canvasHeight=0;this._autoClear=!0;this._backgroundColor="#000000";b.GameObject.call(this);this.setName(a);this._container=k.getContainer();this._canvas=k.getDocument().createElement("canvas");this._canvas.width=e;this._canvas.height=d;this._canvasWidth=e;this._canvasHeight=d;this._canvas.setAttribute("webkitTransform","translate3d(0px, 0px, 0px);");this._canvas.style.position="absolute";this._context2d=this._canvas.getContext("2d");g?(b.Layer._masterLayer=this,this._container.appendChild(this._canvas)):this._canvas.style.visibility="hidden"};b.Layer.__name__=!0;b.Layer.getMasterLayer=function(){return b.Layer._masterLayer};b.Layer.__super__=b.GameObject;b.Layer.prototype=m(b.GameObject.prototype,{getBackgroundColor:function(){return this._backgroundColor},setBackgroundColor:function(a){this._backgroundColor=a},getClearBounds:function(){return this._clearBounds},setClearBounds:function(a){this._clearBounds=a},getContext:function(){return this._context2d},getWholeCanvasDirty:function(){return this._wholeCanvasDirty},setWholeCanvasDirty:function(a){this._wholeCanvasDirty=a;this._renderedThisFrame=!0},clear:function(a){null==a&&(a=!1);if(b.Layer._masterLayer!=this||a)a=this._canvas.getContext("2d"),null==this._clearBounds?a.clearRect(0,0,this._canvas.width,this._canvas.height):a.clearRect(this._clearBounds.ul.x,this._clearBounds.ul.y,this._clearBounds.wh.x,this._clearBounds.wh.y),this._wholeCanvasDirty=!1},render:function(){b.GameObject.prototype.render.call(this);this._wholeCanvasDirty&&b.Layer._masterLayer!=this&&(null!=this._maskFunction&&(b.Layer._masterLayer.getContext().save(),this._maskFunction(b.Layer._masterLayer.getContext()),b.Layer._masterLayer.getContext().clip()),b.Layer._masterLayer.getContext().drawImage(this._canvas,0,0,this._canvasWidth,this._canvasHeight),null!=this._maskFunction&&b.Layer._masterLayer.getContext().restore())},copyToCanvas:function(a){null!=this._maskFunction&&(a.getContext("2d").save(),this._maskFunction(a.getContext("2d")),a.getContext("2d").clip());a.getContext("2d").drawImage(this._canvas,0,0,this._canvasWidth,this._canvasHeight);null!=this._maskFunction&&a.getContext("2d").restore()},getSize:function(){return new b.Vector2D(this._canvasWidth,this._canvasHeight)},setSize:function(a,b){this._canvasWidth=a;this._canvasHeight=b;this._canvas.width=a;this._canvas.height=b},update:function(){b.GameObject.prototype.update.call(this);this._renderedThisFrame=!1},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},getContainer:function(){return this._container},getCanvas:function(){return this._canvas},getAutoClear:function(){return this._autoClear},setAutoClear:function(a){this._autoClear=a},destroy:function(){b.GameObject.prototype.destroy.call(this);null!=this.getCanvas().parentNode&&this.getCanvas().parentNode.removeChild(this.getCanvas())},__class__:b.Layer});b.LoadBatch=function(a){null==a&&(a=!1);this._minLoadTimeElapsed=!1;this._currentAssetToLoad=0;this._loadCompleted=!1;this._assetsToLoad=0;this._onCompleteCallback=null;this._assetLoadingInfo=[];a&&(this._minLoadTimeElapsed=!0)};b.LoadBatch.__name__=!0;b.LoadBatch.prototype={addAsset:function(a,e,d){this._assetLoadingInfo.push(new b.AssetLoadingInfo(a,e,d))},getAssetLoadingInfoByAssetName:function(a){for(var b=this._assetLoadingInfo.length,d=0;d<b;){var c=d++,c=this._assetLoadingInfo[c];if(c.name==a)return c}return null},numAssets:function(){return this._assetsToLoad},onAssetLoaded:function(a){this._assetsToLoad--;this.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:this._assetLoadingInfo.length-this._assetsToLoad,total:this._assetLoadingInfo.length});this.loadNext()},onXmlHttpRequestLoaded:function(a){},checkAssetsLoaded:function(){b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:this._assetLoadingInfo.length-
this._assetsToLoad,total:this._assetLoadingInfo.length});!this._minLoadTimeElapsed||(this._loadCompleted||0<this._assetsToLoad)||(this._loadCompleted=!0,this._onCompleteCallback())},load:function(a){this._onCompleteCallback=a;this._assetsToLoad=this._assetLoadingInfo.length;this._loadCompleted=!1;this._currentAssetToLoad=0;0==this._assetLoadingInfo.length?(a(),this._loadCompleted=!0):(this.loadNext(),b.GameManager.instance.setIsDeferredActionsPaused(!1),b.GameManager.instance.invokeAsyncDeferredAction(3,l(this,this.onMinLoadElapsed)))},unload:function(){for(var a=this._assetLoadingInfo.length,e=0;e<a;){var d=e++;b.managers.AssetManager.unloadAsset(this._assetLoadingInfo[d].name)}},loadNext:function(){if(!(0>=this._assetsToLoad&&this._minLoadTimeElapsed)){for(var a=null;null==a&&0<this._assetsToLoad;)if(a=this._assetLoadingInfo[this._currentAssetToLoad++],null==a)this._assetsToLoad--,this.checkAssetsLoaded();else break;if(!(0>=this._assetsToLoad))switch(a.source=x.replace(a.source,"${locale}",k.dataLocale),a.type[1]){case 4:var e;e=k.getDocument().createElement("link");e.rel="stylesheet";e.type="text/css";e.href=a.source;e.id=a.name;k.getDocument().head.appendChild(e);this.checkAssetsLoaded();this.loadNext();break;case 1:if(!b.GameManager.isMobile()||b.managers.SoundManager.getIsWebkitEnabled()){e=null;var d=this;if(b.managers.AssetManager.assetExists(a.name)){d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext();break}e=t.substr(a.source,a.source.length-3,3);var c=-1<navigator.userAgent.toLowerCase().indexOf("firefox");"mp3"==e&&(c&&!b.managers.SoundManager.getUseFlashSound())&&(a.source=x.replace(a.source,"mp3","ogg"));if(!b.managers.SoundManager.getIsWebkitEnabled()||c)b.managers.SoundManager.getUseFlashSound()?(e=soundManager.createSound({id:a.name,url:a.source,autoLoad:!0,onload:function(){d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()}}),b.managers.AssetManager.registerAsset(a.name,e)):(e=document.createElement("audio"),e.src=a.source,e.preload=!0,e.autoplay=!1,e.id=a.name,e.addEventListener("canplay",function(){d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()},!1),e.addEventListener("onerror",function(){d._assetsToLoad--;console.log("File not found: "+a.source);d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()}),e.addEventListener("stalled",function(){d._assetsToLoad--;console.log("File not found: "+a.source);d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()}),e.addEventListener("emptied",function(){d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()}),e.addEventListener("canplaythrough",function(){d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()}),e.addEventListener("suspend",function(){d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()}),b.managers.AssetManager.registerAsset(a.name,e),e.load());else{var g=new XMLHttpRequest;g.open("GET",a.source,!0);g.responseType="arraybuffer";b.managers.AssetManager.registerAsset(a.name+"_src",a.source);g.onload=function(){b.managers.SoundManager.getAudioContextInstance().decodeAudioData(g.response,function(e){b.managers.AssetManager.registerAsset(a.name,e);d._assetsToLoad--;d.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:d._assetLoadingInfo.length-d._assetsToLoad,total:d._assetLoadingInfo.length});d.loadNext()})};g.send()}}else b.managers.AssetManager.registerAsset(a.name,a.source),this._assetsToLoad--,this.checkAssetsLoaded(),this.loadNext();break;case 0:e=k.getDocument().createElement("img");b.managers.AssetManager.registerAsset(a.name,e);var h=this;e.addEventListener("load",l(this,this.onAssetLoaded));e.addEventListener("onerror",function(){h._assetsToLoad--;alert("file not found: "+a.source);h.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:h._assetLoadingInfo.length-h._assetsToLoad,total:h._assetLoadingInfo.length});h.loadNext()});e.id=a.name;e.src=a.source;break;case 2:var p;p=new XMLHttpRequest;var n=this;p.onload=function(){b.managers.AssetManager.registerAsset(a.name,p.responseText);n._assetsToLoad--;n.checkAssetsLoaded();b.GameManager.instance.sendGlobalMessage("onFileLoaded",{progress:n._assetLoadingInfo.length-n._assetsToLoad,total:n._assetLoadingInfo.length});n.loadNext()};p.onerror=function(){n._assetsToLoad--;alert("File not found: "+a.source);n.checkAssetsLoaded();n.loadNext()};p.open("GET",a.source,!0);p.send();break;case 3:e=k.getDocument().createElement("script"),e.type="text/javascript",e.src=a.source,e.id=a.name,k.getDocument().body.appendChild(e),this.checkAssetsLoaded(),this.loadNext()}}},onMinLoadElapsed:function(){this._minLoadTimeElapsed=!0;this.checkAssetsLoaded()},concatLoadBatch:function(a){for(var b=a._assetLoadingInfo.length,d=0;d<b;){var c=d++;this._assetLoadingInfo.push(a._assetLoadingInfo[c])}},__class__:b.LoadBatch};b.Localizer=function(){};b.Localizer.__name__=!0;b.Localizer.initStrings=function(){var a=b.managers.AssetManager.getAsset("strings");b.Localizer.stringsXml=s.parse(a).elementsNamed("strings").next()};b.Localizer.getString=function(a){try{return b.Localizer.stringsXml.elementsNamed(a).next().firstChild().get_nodeValue()}catch(e){return"*"+
a+"*"}};b.Localizer.prototype={__class__:b.Localizer};b.Manager=function(){b.GameObject.call(this)};b.Manager.__name__=!0;b.Manager.__super__=b.GameObject;b.Manager.prototype=m(b.GameObject.prototype,{__class__:b.Manager});b.RaycastInfo=function(){this.normal=null;this.distance=-1;this.collisionPoint=this.collider=null;this.normal=new b.Vector2D};b.RaycastInfo.__name__=!0;b.RaycastInfo.prototype={__class__:b.RaycastInfo};b.Rect2D=function(a,e,d,c){null==c&&(c=0);null==d&&(d=0);null==e&&(e=0);null==a&&(a=0);this.ul=new b.Vector2D(a,e);this.wh=new b.Vector2D(d,c)};b.Rect2D.__name__=!0;b.Rect2D.prototype={getClone:function(){return new b.Rect2D(this.ul.x,this.ul.y,this.wh.x,this.wh.y)},getIntersect:function(a){return!(this.ul.x>a.ul.x+a.wh.x||this.ul.x+this.wh.x<a.ul.x||this.ul.y>a.ul.y+a.wh.y||this.ul.y+this.wh.y<a.ul.y)},containsPoint:function(a){return a.x>this.ul.x&&a.y>this.ul.y&&a.x<this.ul.x+this.wh.x&&a.y<this.ul.y+this.wh.y},__class__:b.Rect2D};b.SaveData=function(){this._data={};this.load()};b.SaveData.__name__=!0;b.SaveData.prototype={setItem:function(a,b){this._data[a]=b;this.save()},getItem:function(a,b){if(Object.prototype.hasOwnProperty.call(this._data,a))return v.field(this._data,a);this.setItem(a,b);return b},save:function(){var a=b.GameManager.instance.getGameId()+"Data";if(null!=w.Browser.getSessionStorage())try{w.Browser.getSessionStorage().setItem(a,JSON.stringify(this._data))}catch(e){b.utilities.Debug.log("Error saving to session storage")}if(null!=w.Browser.getLocalStorage())try{w.Browser.getLocalStorage().setItem(a,JSON.stringify(this._data))}catch(d){b.utilities.Debug.log("Error saving to local storage")}},load:function(){var a=b.GameManager.instance.getGameId()+"Data";if(null!=w.Browser.getSessionStorage()||null!=w.Browser.getLocalStorage()){var e=null;try{e=w.Browser.getSessionStorage().getItem(a)}catch(d){b.utilities.Debug.log("Failed to get item from session storage")}if(null==e)try{e=w.Browser.getLocalStorage().getItem(a)}catch(c){b.utilities.Debug.log("Failed to get item from session storage")}null!=e&&(this._data=JSON.parse(e))}},deleteAllSaveData:function(){this._data={};this.save()},__class__:b.SaveData};b.Vector2D=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=this.y=0;this.x=a;this.y=b};b.Vector2D.__name__=!0;b.Vector2D.prototype={getClone:function(){return new b.Vector2D(this.x,this.y)},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},scaleBy:function(a,b){this.x*=a;this.y*=b},dotProduct:function(a){return this.x*a.x+this.y*a.y},getNormalized:function(){var a=this.getLength();return new b.Vector2D(this.x/a,this.y/a)},__class__:b.Vector2D};b.Vector3D=function(a,b,d){null==d&&(d=0);null==b&&(b=0);null==a&&(a=0);this.x=this.y=this.z=0;this.x=a;this.y=b;this.z=d};b.Vector3D.__name__=!0;b.Vector3D.prototype={add:function(a){return new b.Vector3D(this.x+a.x,this.y+a.y,this.z+a.z)},subtract:function(a){return new b.Vector3D(this.x-a.x,this.y-a.y,this.z-a.z)},scaleBy:function(a){this.x*=a;this.y*=a;this.z*=a},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},getClone:function(){return new b.Vector3D(this.x,this.y,this.z)},getNormalized:function(){var a=this.getLength();return new b.Vector3D(this.x/a,this.y/a,this.z/a)},__class__:b.Vector3D};b.audio={};b.audio.SoundData=function(a,b,d){this._currentTime=-1;this._isInitialized=!1;this._soundName=a;this._volume=b;this._loop=d;this.init()};b.audio.SoundData.__name__=!0;b.audio.SoundData.prototype={init:function(){this._isInitialized=!0},play:function(a){},resume:function(){},update:function(){this._currentTime+=b.GameManager.getRealElapsedTime()},pause:function(){},stop:function(){b.managers.SoundManager.removeSoundFromPlayingSounds(this)},getVolume:function(){return this._volume},setVolume:function(a){this._volume=a},getLoop:function(){return this._loop},setLoop:function(a){this._loop=a},getSoundLength:function(){return 1},getCurrentTime:function(){return this._currentTime},__class__:b.audio.SoundData};b.audio.FlashSoundData=function(a,e,d){b.audio.SoundData.call(this,a,e,d)};b.audio.FlashSoundData.__name__=!0;b.audio.FlashSoundData.__super__=b.audio.SoundData;b.audio.FlashSoundData.prototype=m(b.audio.SoundData.prototype,{init:function(){b.audio.SoundData.prototype.init.call(this);this._audio=soundManager.createSound({id:this._soundName});this._audio.setVolume(100*this._volume)},play:function(a){null==a&&(a=0);b.audio.SoundData.prototype.play.call(this,a);b.utilities.Debug.log("FlashSoundData::play()");var e=this;this._audio.play({onfinish:function(){e._loop&&e.play(0);b.managers.SoundManager.removeSoundFromPlayingSounds(e)},onstop:function(){b.managers.SoundManager.removeSoundFromPlayingSounds(e)}})},pause:function(){b.audio.SoundData.prototype.pause.call(this);b.utilities.Debug.log("FlashSoundData::pause()");this._audio.pause()},stop:function(){b.audio.SoundData.prototype.stop.call(this);b.utilities.Debug.log("FlashSoundData::stop()");this._audio.stop()},resume:function(){b.audio.SoundData.prototype.resume.call(this);this._audio.resume()},setVolume:function(a){b.audio.SoundData.prototype.setVolume.call(this,a);b.utilities.Debug.log("FlashSoundData::setVolume()");this._audio.setVolume(100*a)},__class__:b.audio.FlashSoundData});b.audio.Html5SoundData=function(a,e,d){b.audio.SoundData.call(this,a,e,d)};b.audio.Html5SoundData.__name__=!0;b.audio.Html5SoundData.__super__=b.audio.SoundData;b.audio.Html5SoundData.prototype=m(b.audio.SoundData.prototype,{init:function(){b.audio.SoundData.prototype.init.call(this)},play:function(a){null==a&&(a=0);b.audio.SoundData.prototype.play.call(this,a);this._audio=b.managers.AssetManager.getAsset(this._soundName);this._audio.play();this._audio.addEventListener("ended",l(this,this.onSoundComplete),!1);this._audio.loop=this._loop;this._audio.volume=this._volume},resume:function(){b.audio.SoundData.prototype.resume.call(this);this._audio.play()},pause:function(){b.audio.SoundData.prototype.pause.call(this);this._audio.pause()},stop:function(){b.audio.SoundData.prototype.stop.call(this);this._audio.pause()},onSoundComplete:function(a){b.managers.SoundManager.removeSoundFromPlayingSounds(this)},setVolume:function(a){b.audio.SoundData.prototype.setVolume.call(this,a);this._audio.volume=a},__class__:b.audio.Html5SoundData});b.audio.WebkitSoundData=function(a,e,d){null==d&&(d=!1);null==e&&(e=1);this._audio=null;b.audio.SoundData.call(this,a,e,d)};b.audio.WebkitSoundData.__name__=!0;b.audio.WebkitSoundData.__super__=b.audio.SoundData;b.audio.WebkitSoundData.prototype=m(b.audio.SoundData.prototype,{init:function(){b.audio.SoundData.prototype.init.call(this);b.utilities.Debug.log("WebkitSoundData::init()");this._audioContext=b.managers.SoundManager.getAudioContextInstance();this._audio=this._audioContext.createBufferSource();this._audio.buffer=b.managers.AssetManager.getAsset(this._soundName);this._gainNode=null!=this._audioContext.createGain?this._audioContext.createGain():this._audioContext.createGainNode();this._audio.connect(this._gainNode);this._gainNode.connect(this._audioContext.destination,0);this._audio.loop=this._loop;this._audio.id=this._soundName;this.setVolume(this._volume)},play:function(a){null==a&&(a=0);b.audio.SoundData.prototype.play.call(this,a);b.utilities.Debug.log("WebkitSoundData::play()");this._currentTime=a;try{null!=this._audio.start?this._audio.start(a):0==a?this._audio.noteOn():this._audio.noteGrainOn(a)}catch(e){this._audio.noteOn(0)}},pause:function(){b.audio.SoundData.prototype.pause.call(this);null!=this._audio&&(b.utilities.Debug.log("WebkitSoundData::pause()"),null!=this._audio.stop?this._audio.stop(0):this._audio.noteOff(0),this._audio=null,b.managers.SoundManager.removeSoundFromPlayingSounds(this))},resume:function(){b.audio.SoundData.prototype.resume.call(this);b.utilities.Debug.log("WebkitSoundData::resume()");this.stop();this.init();this.play(this._currentTime)},stop:function(){b.audio.SoundData.prototype.stop.call(this);null!=this._audio&&(b.utilities.Debug.log("WebkitSoundData::stop()"),null!=this._audio.stop?this._audio.stop(0):this._audio.noteOff(0),this._audio=null,b.managers.SoundManager.removeSoundFromPlayingSounds(this))},getSoundLength:function(){return this._audio.buffer.duration},update:function(){b.audio.SoundData.prototype.update.call(this);this.getCurrentTime()>this.getSoundLength()&&!this.getLoop()&&b.managers.SoundManager.removeSoundFromPlayingSounds(this)},onSoundComplete:function(){b.utilities.Debug.log("onSoundComplete()")},setVolume:function(a){b.audio.SoundData.prototype.setVolume.call(this,a);if(null!=this._audio&&null!=this._audio.gain||null!=this._gainNode)this._gainNode.gain.value=a},__class__:b.audio.WebkitSoundData});b.collision={};b.collision.Collision=function(){this.layers=[];this.ul=new b.Vector2D;this.wh=new b.Vector2D};b.collision.Collision.__name__=!0;b.collision.Collision.prototype={hasLayer:function(a){for(var b=this.layers.length,d=0;d<b;){var c=d++;if(this.layers[c]==a)return!0}return!1},getClone:function(){var a=new b.collision.Collision;a.ul=this.ul.getClone();a.wh=this.wh.getClone();for(var e=this.layers.length,d=0;d<e;){var c=d++;a.layers.push(this.layers[c])}return a},checkPointIntersect:function(a){return!1},getRaycastPoint:function(a,b,d,c,g){return-1},__class__:b.collision.Collision};b.collision.BoxCollision=function(){b.collision.Collision.call(this)};b.collision.BoxCollision.__name__=!0;b.collision.BoxCollision.__super__=b.collision.Collision;b.collision.BoxCollision.prototype=m(b.collision.Collision.prototype,{checkPointIntersect:function(a){b.collision.Collision.prototype.checkPointIntersect.call(this,a);return a.x>=this.ul.x&&a.y>=this.ul.y&&a.x<=this.ul.x+this.wh.x&&a.y<=this.ul.y+this.wh.y},checkBoxIntersect:function(a){return!0},getRaycastPoint:function(a,e,d,c,g){null==c&&(c=!1);g=new b.Vector2D;for(var h=[new b.Vector2D(this.ul.x,this.ul.y),new b.Vector2D(this.ul.x+this.wh.x,this.ul.y),new b.Vector2D(this.ul.x+this.wh.x,this.ul.y+this.wh.y),new b.Vector2D(this.ul.x,this.ul.y+this.wh.y)],p=-1,n=0,z=h.length-1;n<z;){var k=n++,k=b.utilities.Math2.lineIntersect2D(a,e,h[k],h[k+1],g);if(0<k)if(c){if(-1==p||k<p)d.x=g.x,d.y=g.y,p=k}else return d.x=g.x,d.y=g.y,k}a=b.utilities.Math2.lineIntersect2D(a,e,h[0],h[h.length-1],g);if(0<a)if(c){if(-1==p||a<p)d.x=g.x,d.y=g.y,p=a}else return d.x=g.x,d.y=g.y,a;return p},getClone:function(){return null},__class__:b.collision.BoxCollision});b.collision.PolygonCollision=function(){this._lowestPoint=this._highestPoint=null;b.collision.Collision.call(this);this._lowestPoint=new b.Vector2D(999999,999999);this._highestPoint=new b.Vector2D(-999999,-999999);this._points=[]};b.collision.PolygonCollision.__name__=!0;b.collision.PolygonCollision.__super__=b.collision.Collision;b.collision.PolygonCollision.prototype=m(b.collision.Collision.prototype,{getSize:function(){return new b.Vector2D(this._highestPoint.x-this._lowestPoint.x,this._highestPoint.y-
this._lowestPoint.y)},addPoint:function(a,e){this._points.push(new b.Vector2D(a,e));a<this._lowestPoint.x&&(this._lowestPoint.x=a);e<this._lowestPoint.y&&(this._lowestPoint.y=e);a>this._highestPoint.x&&(this._highestPoint.x=a);e>this._highestPoint.y&&(this._highestPoint.y=e)},getPoints:function(){return this._points},checkPointIntersect:function(a){for(var b=this._points.length,d=0,c=!1,g=null,h=null;d<b;){g=this._points[d].getClone();h=this._points[(d+1)%b].getClone();g.x+=this.ul.x;g.y+=this.ul.y;h.x+=this.ul.x;h.y+=this.ul.y;if(0==d)c=0<(a.y-g.y)*(h.x-g.x)-(a.x-g.x)*(h.y-g.y);else if(c&&0>(a.y-g.y)*(h.x-g.x)-(a.x-g.x)*(h.y-g.y)||!c&&0<(a.y-g.y)*(h.x-g.x)-(a.x-g.x)*(h.y-g.y))return!1;d++}return!0},getRaycastPoint:function(a,e,d,c,g){null==c&&(c=!1);var h=new b.Rect2D;h.ul=this._lowestPoint.getClone();h.wh=new b.Vector2D(this._highestPoint.x-this._lowestPoint.x,this._highestPoint.y-this._lowestPoint.y);h.ul.x+=this.ul.x;h.ul.y+=this.ul.y;var p=Math.abs(e.x-a.x),n=Math.abs(e.y-a.y),p=new b.Rect2D(a.x<e.x?a.x:e.x,a.y<e.y?a.y:e.y,p,n);if(!h.getIntersect(p))return-1;for(var h=new b.Vector2D,n=this._points,p=-1,k=0,l=n.length-1;k<l;){var r=k++,m=n[r].getClone();m.x+=this.ul.x;m.y+=this.ul.y;var q=n[r+1].getClone();q.x+=this.ul.x;q.y+=this.ul.y;r=b.utilities.Math2.lineIntersect2D(a,e,m,q,h);if(0<r)if(c){if(-1==p||r<p)d.x=h.x,d.y=h.y,null!=g&&(p=(new b.Vector2D(q.y-m.y,m.x-q.x)).getNormalized(),g.x=p.x,g.y=p.y,0<(new b.Vector2D(e.x-a.x,e.y-a.y)).dotProduct(g)&&(g.x*=-1,g.y*=-1)),p=r}else return d.x=h.x,d.y=h.y,null!=g&&(d=(new b.Vector2D(q.y-m.y,m.x-q.x)).getNormalized(),g.x=d.x,g.y=d.y,0<(new b.Vector2D(e.x-a.x,e.y-a.y)).dotProduct(g)&&(g.x*=-1,g.y*=-1)),r}k=n[0].getClone();k.x+=this.ul.x;k.y+=this.ul.y;l=n[n.length-1].getClone();l.x+=this.ul.x;l.y+=this.ul.y;n=b.utilities.Math2.lineIntersect2D(a,e,k,l,h);if(0<n)if(c){if(-1==p||n<p)d.x=h.x,d.y=h.y,null!=g&&(d=(new b.Vector2D(l.y-k.y,k.x-l.x)).getNormalized(),g.x=d.x,g.y=d.y,0<(new b.Vector2D(e.x-a.x,e.y-a.y)).dotProduct(g)&&(g.x*=-1,g.y*=-1)),p=n}else return d.x=h.x,d.y=h.y,null!=g&&(d=(new b.Vector2D(l.y-k.y,k.x-l.x)).getNormalized(),g.x=d.x,g.y=d.y,0<(new b.Vector2D(e.x-a.x,e.y-a.y)).dotProduct(g)&&(g.x*=-1,g.y*=-1)),n;return p},getClone:function(){return null},__class__:b.collision.PolygonCollision});b.components={};b.components.Animation=function(a,e,d){this._fps=30;this._loop=!0;this._length=0;this._name=a;this._animationKeyframes=[];null!=e&&(this._length=e);this._offset=new b.Vector2D};b.components.Animation.__name__=!0;b.components.Animation.parseFromXmlString=function(a,e){for(var d=s.parse(e),c=d.elementsNamed("animation").next().get("name"),c=new b.components.Animation(c,d.elementsNamed("animation").next().get("length")),d=d.elementsNamed("animation").next().elementsNamed("keyframe");d.hasNext();){var g=d.next(),g=new b.components.flashAnimation.AnimationKeyframe(g.get("index"),g.get("spriteIndex"),a);c.addKeyframe(g)}b.managers.AnimationManager.getInstance().registerAnimation(c);return c};b.components.Animation.makeLinearAnimationFromSheet=function(a,e,d,c,g){null==g&&(g=0);null==c&&(c=-1);var h=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(e);-1==c&&(c=h.getNumSprites());a=new b.components.Animation(a,c*d);for(h=0;h<c;){var p=h++,p=new b.components.flashAnimation.AnimationKeyframe(g,p,e);a.addKeyframe(p);g+=d}b.managers.AnimationManager.getInstance().registerAnimation(a);return a};b.components.Animation.makeLinearAnimationFromSheetBySpriteName=function(a,e,d,c,g,h,p){null==p&&(p=0);null==h&&(h=-1);null==g&&(g=!1);var n=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(e),k=n.getNumSprites();-1==h&&(h=k);for(var l=0,r=0;r<h;){var m=r++;x.startsWith(n.getSpriteInfoByIndex(m).getName(),d)&&l++}a=new b.components.Animation(a,l*c);for(r=l=0;r<k&&!(m=r++,x.startsWith(n.getSpriteInfoByIndex(m).getName(),d)&&(m=new b.components.flashAnimation.AnimationKeyframe(p,m,e),a.addKeyframe(m),p+=c,l++,l>=h)););a.setLoop(g);b.managers.AnimationManager.getInstance().registerAnimation(a);return a};b.components.Animation.prototype={getAnimationKeyframes:function(){return this._animationKeyframes},getFps:function(){return this._fps},getKeyframeLength:function(){return this._length},getLength:function(){return this._length/this._fps},getName:function(){return this._name},getLoop:function(){return this._loop},setLoop:function(a){this._loop=a},getOffset:function(){return this._offset},setOffset:function(a,b){this._offset.x=a;this._offset.y=b},addKeyframe:function(a){this._animationKeyframes.push(a);var b=a.getPosition();this._length=Math.max(this._length,a.getPosition());b>this._length&&(this._length=b)},getSpriteIndexAtPosition:function(a){for(var b=this._animationKeyframes.length,d=this._animationKeyframes[0].getSpriteIndex(),c=0;c<b;){var g=c++;if(a>=this._animationKeyframes[g].getPosition()/this._fps)d=this._animationKeyframes[g].getSpriteIndex();else break}return d},getSpriteSheetNameAtPosition:function(a){for(var b=this._animationKeyframes.length,d=this._animationKeyframes[0].getSpriteSheetName(),c=0;c<b;){var g=c++;if(a>=this._animationKeyframes[g].getPosition()/this._fps)d=this._animationKeyframes[g].getSpriteSheetName();else break}return d},__class__:b.components.Animation};b.components.Button=function(a,e,d,c,g){this._isMouseOver=this._killMessageOnMouseDown=this._inactiveOneFrame=!1;this._handPointer=!0;this._onClicked=this._onMouseDown=this._onMouseUp=this._onMouseMoved=this._onMouseOver=this._onMouseOut=null;b.Component.call(this,a,"Button");this._boxCollision=new b.collision.BoxCollision;this._collisionSize=e;this._collisionOffset=d;this._camera=g;this.setOnMouseDown(c)};b.components.Button.__name__=!0;b.components.Button.getMouseOverThisFrame=function(){return b.components.Button._mouseOverThisFrame};b.components.Button.setMouseOverThisFrame=function(a){b.components.Button._mouseOverThisFrame=a};b.components.Button.createFromHTMLElement=function(a){return new b.components.Button(a.getEntity(),a.getSize(),new b.Vector2D(0,0))};b.components.Button.createFromHTMLElementID=function(a,e,d){null==d&&(d=0);e=k.getDocument().getElementById(e);var c=e.clientWidth+d,g=e.clientHeight+d;return new b.components.Button(a,new b.Vector2D(c,g),new b.Vector2D(e.offsetLeft-a.getPosition().x-d/2+c/2,e.offsetTop-a.getPosition().y-d/2+g/2))};b.components.Button.createFromEdgeHTMLElementID=function(a,e,d,c){null==c&&(c=0);var g=k.getDocument().getElementById(e);e=q.parseInt(g.style.width)+c;var h=q.parseInt(g.style.height)+c,p=b.components.HtmlElements.getStylePositionOfDomElement(g).y-c/2;c=b.components.HtmlElements.getStylePositionOfDomElement(g).x-
c/2;return new b.components.Button(a,new b.Vector2D(e,h),new b.Vector2D(c-a.getPosition().x+e/2,p-a.getPosition().y+h/2),d)};b.components.Button.createFromGameImage=function(a){return new b.components.Button(a.getEntity(),a.getSize(),null)};b.components.Button.__super__=b.Component;b.components.Button.prototype=m(b.Component.prototype,{setOnClicked:function(a){this._onClicked=a},setOnMouseDown:function(a){this._onMouseDown=a},setOnMouseMoved:function(a){this._onMouseMoved=a},setOnMouseUp:function(a){this._onMouseUp=a},setOnMouseOut:function(a){this._onMouseOut=a},getKillMessageOnMouseDown:function(){return this._killMessageOnMouseDown},setKillMessageOnMouseDown:function(a){this._killMessageOnMouseDown=a},getData:function(){return this._data},getCollisionSize:function(){return this._collisionSize},setData:function(a){this._data=a},init:function(){b.Component.prototype.init.call(this);this._prevPosition=new b.Vector2D(this.getEntity().getLocalPosition().x,this.getEntity().getPosition().y);this.updateCollision()},update:function(){b.Component.prototype.update.call(this);this._inactiveOneFrame=!1;!1==this.getEntity().getIsVisible()&&(this._inactiveOneFrame=!0);this.updateCollision()},setOffset:function(a,e){this._collisionOffset=new b.Vector2D(a,e)},getOffset:function(){return this._collisionOffset},updateCollision:function(){var a=this.getEntity().getPosition();this._boxCollision.ul.x=a.x-this._collisionSize.x/2*this.getEntity().getScale().x;this._boxCollision.ul.y=a.y-this._collisionSize.y/2*this.getEntity().getScale().y;this._boxCollision.wh.x=this._collisionSize.x*this.getEntity().getScale().x;this._boxCollision.wh.y=this._collisionSize.y*this.getEntity().getScale().y;null!=this._collisionOffset&&(this._boxCollision.ul.x+=this._collisionOffset.x,this._boxCollision.ul.y+=this._collisionOffset.y)},onMouseClick:function(a){a=a.getClone();a.x>b.GameManager.instance.getScreenSize().x||(0>a.x||a.y>b.GameManager.instance.getScreenSize().y||0>a.y)||(null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale())),this._boxCollision.checkPointIntersect(a)&&(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseClick",{button:this,entity:this.getEntity()})),null!=this._onClicked&&this._onClicked(this)))},onMouseDown:function(a){a=a.getClone();if(a.x>b.GameManager.instance.getScreenSize().x||0>a.x||a.y>b.GameManager.instance.getScreenSize().y||0>a.y)return!1;null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));return this._boxCollision.checkPointIntersect(a)?(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseDown",{button:this,entity:this.getEntity()})),null!=this._onMouseDown&&this._onMouseDown(this),b.GameManager.isMobile()&&(this._isMouseOver=!0),!0):!1},onMouseMoved:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));if(this._boxCollision.checkPointIntersect(a)){this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOver",{button:this,entity:this.getEntity()}));if(!this._isMouseOver)this.onMouseOver(a);this._isMouseOver=!0;this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseMove",{button:this,entity:this.getEntity()}));null!=this._onMouseMoved&&this._onMouseMoved(this)}else this._isMouseOver&&!b.GameManager.isMobile()&&(this.onMouseOut(a),this._isMouseOver=!1)},onMouseUp:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));this._boxCollision.checkPointIntersect(a)&&(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseUp",{button:this,entity:this.getEntity()})),null!=this._onMouseUp&&this._onMouseUp(this))},onMouseOver:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));this._handPointer&&(b.components.Button._mouseOverThisFrame=!0,k.getDocument().body.style.cursor="pointer");this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOver",{button:this,entity:this.getEntity()}));null!=this._onMouseOver&&this._onMouseOver(this);this._isMouseOver=!0},onMouseOut:function(a){null!=a&&(a=a.getClone(),null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale())),this._handPointer&&!b.components.Button._mouseOverThisFrame&&(k.getDocument().body.style.cursor="default"),this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOut",{button:this,entity:this.getEntity()})),null!=this._onMouseOut&&this._onMouseOut(this),this._isMouseOver=!1)},verifyTouches:function(a){var e=!1;if(null!=a&&null!=a.touches){for(var d=a.touches.length,c=0;c<d;){var g=c++,h=a.touches[g],p=b.GameManager.instance.getScreenOffset(),g=(h.pageX-p.x)/b.GameManager.instance.getScreenScale().x,h=(h.pageY-p.y)/b.GameManager.instance.getScreenScale().y;this._boxCollision.checkPointIntersect(new b.Vector2D(g,h))&&(e=!0)}if(!e&&this._isMouseOver)this.onMouseOut(null);else if(e&&!this._isMouseOver)this.onMouseOver(null)}},setCollisionProperties:function(a,b){this._collisionSize=a;this._collisionOffset=b},handleMessage:function(a,e){b.Component.prototype.handleMessage.call(this,a,e);if((!e||!e.isDisabled)&&(this.getEntity().getIsVisible()&&this.getIsActive())&&!this._inactiveOneFrame)switch(a){case "mouseClick":this.onMouseClick(e);break;case "mouseDown":this.onMouseDown(e)&&this._killMessageOnMouseDown&&(e.isDisabled=!0);break;case "mouseUp":this.onMouseUp(e);break;case "mouseMove":this.onMouseMoved(e);break;case "verifyTouches":this.verifyTouches(e)}},activate:function(){b.Component.prototype.activate.call(this);this._inactiveOneFrame=!0},deactivate:function(){b.Component.prototype.deactivate.call(this);this._isMouseOver&&this._handPointer&&(k.getDocument().body.style.cursor="default")},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var e=b.components.Camera.getDebugCamera().getEntity();a.translate(-e.getPosition().x,-e.getPosition().y)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(this._boxCollision.ul.x,this._boxCollision.ul.y);a.lineTo(this._boxCollision.ul.x+
this._boxCollision.wh.x,this._boxCollision.ul.y);a.lineTo(this._boxCollision.ul.x+this._boxCollision.wh.x,this._boxCollision.ul.y+this._boxCollision.wh.y);a.lineTo(this._boxCollision.ul.x,this._boxCollision.ul.y+this._boxCollision.wh.y);a.lineTo(this._boxCollision.ul.x,this._boxCollision.ul.y);a.stroke();a.restore()},destroy:function(){b.Component.prototype.destroy.call(this);if(this._isMouseOver)this.onMouseOut(null)},__class__:b.components.Button});b.components.Camera=function(a){this._offset=null;this._zoomScale=1;this._target=this._cameraBounds=this._slackMovement=null;b.Component.call(this,a,"Camera");this._offset=new b.Vector2D;this._lensWidth=b.GameManager.instance.getScreenSize().x;this._lensHeight=b.GameManager.instance.getScreenSize().y;null==b.components.Camera._debugCamera&&(b.components.Camera._debugCamera=this)};b.components.Camera.__name__=!0;b.components.Camera.getDebugCamera=function(){return b.components.Camera._debugCamera};b.components.Camera.__super__=b.Component;b.components.Camera.prototype=m(b.Component.prototype,{getTarget:function(){return this._target},setTarget:function(a){null!=this._target&&this._target.removeEventListener("destroy",l(this,this.onTargetDestroy));this._target=a;null!=this._target&&this._target.addEventListener("destroy",l(this,this.onTargetDestroy))},setOffset:function(a){this._offset=a},getOffset:function(){return this._offset},getZoomScale:function(){return this._zoomScale},setZoomScale:function(a){this._zoomScale=a},getLensSize:function(){return new b.Vector2D(this._lensWidth,this._lensHeight)},setLensSize:function(a,b){this._lensWidth=a;this._lensHeight=b},init:function(){b.Component.prototype.init.call(this);this._slackMovement=this.getSiblingComponent(b.components.SlackMovement)},getSlackMovement:function(){return this._slackMovement},jumpToTarget:function(){null!=this._target&&this.getEntity().setPosition(this._target.getPosition().x-this._lensWidth/this._zoomScale/2+this._offset.x/this._zoomScale,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+this._offset.y/this._zoomScale,this.getEntity().getPosition().z)},getCenter:function(){var a=this.getEntity().getPosition();return new b.Vector3D(a.x-this._lensWidth/this._zoomScale/2,a.y-this._lensHeight/this._zoomScale/2,a.z)},update:function(){b.Component.prototype.update.call(this);null!=this._target&&(null==this._slackMovement?this.getEntity().setPosition(this._target.getPosition().x-this._lensWidth/this._zoomScale/2+this._offset.x/this._zoomScale,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+this._offset.y/this._zoomScale,this.getEntity().getPosition().z):this._slackMovement.setTarget(this._target.getPosition().x-this._lensWidth/this._zoomScale/2+this._offset.x/this._zoomScale,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+this._offset.y/this._zoomScale,this.getEntity().getPosition().z));this.updateCameraBounds()},updateCameraBounds:function(){if(null!=this._cameraBounds){var a=this.getEntity().getPosition().getClone(),e=this._lensWidth/2/this._zoomScale,d=this._lensHeight/2/this._zoomScale,c=new b.Vector2D(a.x+e,a.y+d),g=!1;c.x-e<this._cameraBounds.ul.x&&(c.x=this._cameraBounds.ul.x+e,g=!0);c.y-d<this._cameraBounds.ul.y&&(c.y=this._cameraBounds.ul.y+d,g=!0);c.x+e>this._cameraBounds.ul.x+this._cameraBounds.wh.x&&(c.x=this._cameraBounds.ul.x+this._cameraBounds.wh.x-e,g=!0);c.y+d>this._cameraBounds.ul.y+this._cameraBounds.wh.y&&(c.y=this._cameraBounds.ul.y+this._cameraBounds.wh.y-d,g=!0);a.x=c.x-e;a.y=c.y-d;g&&this.getEntity().setPosition(a.x,a.y,a.z)}},getPointConstrainedToCameraBounds:function(a,e){if(null!=this._cameraBounds){var d=new b.Vector3D(a,e),c=this._lensWidth/2/this._zoomScale,g=this._lensHeight/2/this._zoomScale,h=new b.Vector2D(a,e);h.x-c<this._cameraBounds.ul.x&&(h.x=this._cameraBounds.ul.x+c);h.y-g<this._cameraBounds.ul.y&&(h.y=this._cameraBounds.ul.y+g);h.x+c>this._cameraBounds.ul.x+this._cameraBounds.wh.x&&(h.x=this._cameraBounds.ul.x+this._cameraBounds.wh.x-c);d.y+g>this._cameraBounds.ul.y+this._cameraBounds.wh.y&&(h.y=this._cameraBounds.ul.y+this._cameraBounds.wh.y-g);a=h.x;e=h.y}return new b.Vector2D(a,e)},getBounds:function(){return this._cameraBounds},setBounds:function(a,e,d,c){this._cameraBounds=new b.Rect2D(a,e,d-a,c-e)},getViewBounds:function(){var a=this.getEntity().getPosition();return new b.Rect2D(a.x,a.y,2*(this._lensWidth/2/this._zoomScale),2*(this._lensHeight/2/this._zoomScale))},destroyBounds:function(){this._cameraBounds=null},destroy:function(){b.Component.prototype.destroy.call(this);b.components.Camera._debugCamera==this&&(b.components.Camera._debugCamera=null)},onTargetDestroy:function(){this.setTarget(null)},__class__:b.components.Camera});b.components.Collider=function(a,e){this._offset=this._onEnter=this._onInside=this._onExit=null;b.Component.call(this,a,"Collider");this._offset=e};b.components.Collider.__name__=!0;b.components.Collider.__super__=b.Component;b.components.Collider.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);b.managers.PhysicsManager.getInstance().registerCollider(this)},getCollision:function(){return null},checkPointIntersect:function(a){return!1},update:function(){b.Component.prototype.update.call(this)},getRaycastPoint:function(a,e,d,c,g){b.managers.PhysicsManager.getInstance().dispatchEvent(new b.events.RaycastCheckEvent("raycastCheck",a,e));return-1},debugRender:function(){b.Component.prototype.debugRender.call(this)},setOnEnter:function(a){this._onEnter=a},setOnExit:function(a){this._onExit=a},setOnInside:function(a){this._onInside=a},onEnter:function(a){this._isActive&&null!=this._onEnter&&this._onEnter(a,this)},onInside:function(a){this._isActive&&null!=this._onInside&&this._onInside(a,this)},onExit:function(a){this._isActive&&null!=this._onExit&&this._onExit(a,this)},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);b.managers.PhysicsManager.getInstance().removeCollider(this)},__class__:b.components.Collider});b.components.DeferredAction=function(a,b,d,c){null==c&&(c=!1);this.isPaused=this.repeating=!1;this.timeUntilExecute=a;this.actionToExecute=b;this.params=d;this.repeating=c;this.duration=a};b.components.DeferredAction.__name__=!0;b.components.DeferredAction.prototype={update:function(){this.isPaused||(this.timeUntilExecute-=b.GameManager.getElapsedTime())},__class__:b.components.DeferredAction};b.components.DeferredActionComponent=function(a){b.Component.call(this,a,"DeferredActionComponent");this._deferredActions=[]};b.components.DeferredActionComponent.__name__=!0;b.components.DeferredActionComponent.__super__=b.Component;b.components.DeferredActionComponent.prototype=m(b.Component.prototype,{update:function(){b.Component.prototype.update.call(this);for(var a=this._deferredActions.length-1;0<=a;){var e=this._deferredActions[a];e.update();0>=e.timeUntilExecute&&(e.actionToExecute(e.params),e.repeating?e.timeUntilExecute=e.duration:t.remove(this._deferredActions,e));a--}},addDeferredAction:function(a,e,d){a=new b.components.DeferredAction(a,e,d);this._deferredActions.push(a);return a},removeDeferredAction:function(a){t.remove(this._deferredActions,a)},destroyAllDeferredActions:function(){this._deferredActions=[]},__class__:b.components.DeferredActionComponent});b.components.Draggable=function(a,e,d,c,g){this._inactiveOneFrame=this._ignoreScale=!1;this._returnOnDrop=!0;this._isDragging=!1;b.Component.call(this,a,"Draggable");this._collisionSize=e;this._boxCollision=new b.collision.BoxCollision;this._collisionOffset=null!=d?d:new b.Vector2D;this._camera=c;this._collider=g};b.components.Draggable.__name__=!0;b.components.Draggable.setReleaseDraggablesNextFrame=function(a){b.components.Draggable._releaseDraggablesNextFrame=a};b.components.Draggable.releaseDraggables=function(){b.components.Draggable._releaseDraggablesNextFrame=!0};b.components.Draggable.__super__=b.Component;b.components.Draggable.prototype=m(b.Component.prototype,{getIgnoreScale:function(){return this._ignoreScale},setIgnoreScale:function(a){this._ignoreScale=a},init:function(){b.Component.prototype.init.call(this);this.updateCollision()},update:function(){b.Component.prototype.update.call(this);this._inactiveOneFrame=!1;!1==this.getEntity().getIsVisible()&&(this._inactiveOneFrame=!0);if(b.components.Draggable._releaseDraggablesNextFrame)this.onMouseUp(new b.Vector2D(this.getEntity().getPosition().x,this.getEntity().getPosition().y))},postUpdate:function(){b.Component.prototype.postUpdate.call(this)},activate:function(){b.Component.prototype.activate.call(this);this._inactiveOneFrame=!0},updateCollision:function(){this._ignoreScale?(this._boxCollision.ul.x=this.getEntity().getPosition().x-this._collisionSize.x/2,this._boxCollision.ul.y=this.getEntity().getPosition().y-
this._collisionSize.y/2,this._boxCollision.wh.x=Math.max(150,this._collisionSize.x),this._boxCollision.wh.y=Math.max(150,this._collisionSize.y)):(this._boxCollision.ul.x=this.getEntity().getPosition().x-this._collisionSize.x*this.getEntity().getScale().x/2,this._boxCollision.ul.y=this.getEntity().getPosition().y-this._collisionSize.y*this.getEntity().getScale().y/2,this._boxCollision.wh.x=Math.max(150,this._collisionSize.x*this.getEntity().getScale().x),this._boxCollision.wh.y=Math.max(150,this._collisionSize.y*this.getEntity().getScale().y));null!=this._collisionOffset&&(this._boxCollision.ul.x+=this._collisionOffset.x,this._boxCollision.ul.y+=this._collisionOffset.y)},setReturnOnDrop:function(a){this._returnOnDrop=a},getReturnOnDrop:function(){return this._returnOnDrop},setCollisionOffset:function(a){this._collisionOffset=a.getClone();this.updateCollision()},startDragging:function(a,e){null==e&&(e=0);null==a&&(a=0);this.getEntity().getPosition();this._grabOffset=new b.Vector3D(a,e);this._isDragging=!0;this._originalPosition=this.getEntity().getPosition().getClone();this.dispatchEvent(new b.components.DraggableEvent("startDragging"))},onMouseDown:function(a){a.getClone();a=b.managers.InputManager.getInstance().getMousePosition();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x,a.y+=this._camera.getEntity().getPosition().y);return this._boxCollision.checkPointIntersect(a)?(this._isDragging=!0,this._originalPosition=this.getEntity().getPosition().getClone(),this._grabOffset=new b.Vector3D(this.getEntity().getPosition().x-
a.x,this.getEntity().getPosition().y-a.y),this.dispatchEvent(new b.components.DraggableEvent("startDragging")),!0):!1},onMouseUp:function(a){a=a.getClone();this._isDragging&&(null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x,a.y+=this._camera.getEntity().getPosition().y),b.GameManager.instance.sendGlobalMessage("droppedDraggable",{draggable:this,position:a}),this._isDragging=!1,this._returnOnDrop&&this.getEntity().setPosition(this._originalPosition.x,this._originalPosition.y,this._originalPosition.z),this.dispatchEvent(new b.components.DraggableEvent("stopDragging")));this.updateCollision()},onMouseMoved:function(a){a=a.getClone();if(this._isDragging){var e=new b.Vector3D;null!=this.getEntity().getParent()&&(e=this.getEntity().getParent().getPosition());this.getEntity().getLocalPosition();if(null!=this._camera){var d=new b.Vector2D(this._camera.getEntity().getPosition().x,this._camera.getEntity().getPosition().y);a.x+=d.x;a.y+=d.y}null!=this.getEntity().getParent()?(d=this.getEntity().getParent().getScale(),this.getEntity().setPosition((a.x+this._grabOffset.x-e.x)/d.x,(a.y+this._grabOffset.y-e.y)/d.y,this.getEntity().getPosition().z)):this.getEntity().setPosition(a.x+this._grabOffset.x-e.x,a.y+this._grabOffset.y-e.y,this.getEntity().getPosition().z)}this.updateCollision()},onMouseLeave:function(){if(this._isDragging)this.onMouseUp(null)},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var e=b.components.Camera.getDebugCamera().getEntity();a.translate(-e.getPosition().x,-e.getPosition().y)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FFFF00";a.moveTo(this._boxCollision.ul.x,this._boxCollision.ul.y);a.lineTo(this._boxCollision.ul.x+this._boxCollision.wh.x,this._boxCollision.ul.y);a.lineTo(this._boxCollision.ul.x+this._boxCollision.wh.x,this._boxCollision.ul.y+this._boxCollision.wh.y);a.lineTo(this._boxCollision.ul.x,this._boxCollision.ul.y+this._boxCollision.wh.y);a.lineTo(this._boxCollision.ul.x,this._boxCollision.ul.y);a.stroke();a.restore()},getDragging:function(){return this._isDragging},handleMessage:function(a,e){b.Component.prototype.handleMessage.call(this,a,e);if((!e||!e.isDisabled)&&(this.getEntity().getIsVisible()&&this.getIsActive())&&!this._inactiveOneFrame)switch(a){case "mouseDown":this.onMouseDown(e)&&(e.isDisabled=!0);break;case "mouseUp":this.onMouseUp(e);break;case "mouseMove":this.onMouseMoved(e);break;case "mouseLeave":this.onMouseLeave()}},__class__:b.components.Draggable});b.events.Event=function(a){this._name=a};b.events.Event.__name__=!0;b.events.Event.prototype={getName:function(){return this._name},__class__:b.events.Event};b.components.DraggableEvent=function(a){b.events.Event.call(this,a)};b.components.DraggableEvent.__name__=!0;b.components.DraggableEvent.__super__=b.events.Event;b.components.DraggableEvent.prototype=m(b.events.Event.prototype,{__class__:b.components.DraggableEvent});b.components.FollowEntity=function(a,e,d){this._followX=this._followY=!0;this._offset=this._target=null;b.Component.call(this,a,"FollowEntity");this.setTarget(e);this._offset=null!=d?d:new b.Vector3D;this.updatePosition()};b.components.FollowEntity.__name__=!0;b.components.FollowEntity.__super__=b.Component;b.components.FollowEntity.prototype=m(b.Component.prototype,{getOffset:function(){return this._offset},setOffset:function(a){this._offset=a},getTarget:function(){return this._target},setTarget:function(a){null!=this._target&&this._target.removeEventListener("destroy",l(this,this.onTargetDestroy));this._target=a;this._target.addEventListener("destroy",l(this,this.onTargetDestroy))},getFollowX:function(){return this._followX},setFollowX:function(a){this._followX=a},getFollowY:function(){return this._followY},setFollowY:function(a){this._followY=a},update:function(){b.Component.prototype.update.call(this);this.updatePosition()},updatePosition:function(){var a=this._target.getPosition();this._followX||(a.x=this.getEntity().getPosition().x);this._followY||(a.y=this.getEntity().getPosition().y);this.getEntity().setPosition(a.x+this._offset.x,a.y+this._offset.y,a.z+this._offset.z)},onTargetDestroy:function(){},__class__:b.components.FollowEntity});b.components.GameImage=function(a,e,d,c){this._context=this._image=this._cachedSize=this._clipRect=null;this._forceRenderRequired=!1;this._skew=this._rotation=this._spriteInfo=this._coords=null;this._alpha=1;this._maskFunction=null;this._imageName="";this.IsLargeImage=!1;b.Component.call(this,a,"GameImage");this._imageName=e;this._layer=d;this._cameraPositionScale=new b.Vector2D(1,1);this._pivotPoint=new b.Vector2D;this._camera=c;this._offset=new b.Vector2D;this._scale=new b.Vector3D(1,1,1);this._skew=new b.Vector2D;this._rotation=new b.Vector3D(0,0,0);this._clipRect=null};b.components.GameImage.__name__=!0;b.components.GameImage.__super__=b.Component;b.components.GameImage.prototype=m(b.Component.prototype,{getClipRect:function(){return this._clipRect},setClipRect:function(a){1>a.wh.x&&(a.wh.x=1);1>a.wh.y&&(a.wh.y=1);this._clipRect=a},getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},getCoords:function(){return this._coords},setCoords:function(a){this._coords=a},getRotation:function(){return this._rotation},setRotation:function(a){this._rotation=a},setSpriteInfo:function(a){this._spriteInfo=a},setImage:function(a){b.managers.AssetManager.assetExists(a)&&""!=a&&(this._imageName=a,this._image=this.getImageAsset(),this._cachedSize=null)},getImageAsset:function(){return b.managers.AssetManager.getAsset(this._imageName)},getSkew:function(){return this._skew},setSkew:function(a,e){this._skew=new b.Vector2D(a,e)},setSource:function(a){this._imageName=a},getOffset:function(){return this._offset},setOffset:function(a,e){this._offset=new b.Vector2D(a,e)},centerOffsetOnEntity:function(){""!=this._imageName&&(this.getSize(),this.setOffset(-this._image.width/2,-this._image.height/2))},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a},getPivotPoint:function(){return this._pivotPoint},setPivotPoint:function(a,e){this._pivotPoint=new b.Vector2D(a,e)},getLayer:function(){return this._layer},setLayer:function(a){this._layer=a;this._context=null},getImageName:function(){return this._imageName},getSize:function(){if(null!=this._cachedSize)return this._cachedSize;null==this._image&&(this._image=this.getImageAsset());var a=this.getEntity().getScale();return null!=this._spriteInfo?this._cachedSize=new b.Vector2D(this._spriteInfo.getCoords().wh.x*Math.abs(a.x*this._scale.x),this._spriteInfo.getCoords().wh.y*Math.abs(a.y*this._scale.y)):""==this._imageName?new b.Vector2D(0,0):this._cachedSize=new b.Vector2D(this._image.width*Math.abs(a.x*this._scale.x),this._image.height*Math.abs(a.y*this._scale.y))},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},setScale:function(a,e,d){null==d&&(d=1);null==e&&(e=1);null==a&&(a=1);this._scale=new b.Vector3D(a,e,d)},getScale:function(){return this._scale},getCameraPositionScale:function(){return this._cameraPositionScale},setCameraPositionScale:function(a){this._cameraPositionScale=a},renderToCanvas:function(a){if(0!=this._alpha&&(""!=this._imageName||null!=this._spriteInfo)){var e=this.getEntity(),d=e.getPosition(),c=1,g=new b.Vector2D(0,0),h=new b.Vector2D(1,1);null!=this._camera&&(g=this._camera.getEntity(),c=this._camera.getZoomScale(),g=g.getPosition(),g=new b.Vector2D(-(g.x/this._cameraPositionScale.x)*h.x,-(g.y/this._cameraPositionScale.y)*h.y),g.scaleBy(c,c));this._context=a.getContext("2d");this._context.save();null!=this._maskFunction&&(this._context.scale(b.GameManager.getDevicePixelRatio(),b.GameManager.getDevicePixelRatio()),this._context.translate(g.x/h.x*c,g.y/h.y*c),this._maskFunction(this._context,this),this._context.clip(),this._context.scale(1/(b.GameManager.instance.getScreenScale().x*b.GameManager.getDevicePixelRatio()),1/(b.GameManager.instance.getScreenScale().y*b.GameManager.getDevicePixelRatio())),this._context.translate(-g.x*h.x*c,-g.y*h.y*c));a=e.getScale().getClone();a.x*=this._scale.x;a.y*=this._scale.y;this._context.setTransform(1,this._skew.x/a.x,this._skew.y/a.y,1,Math.floor(d.x*h.x*c+g.x)*b.GameManager.getDevicePixelRatio(),Math.floor(d.y*h.y*c+g.y)*b.GameManager.getDevicePixelRatio());0!=e.getRotation().z+this._rotation.z&&this._context.rotate(e.getRotation().z+this._rotation.z);this._context.scale(a.x*c,a.y*c);e=this._offset.getClone();null!=this._spriteInfo&&(e.x+=this._spriteInfo.getOffset().x,e.y+=this._spriteInfo.getOffset().y);this._context.translate(Math.floor(e.x*h.x)*b.GameManager.getDevicePixelRatio(),Math.floor(e.y*h.y)*b.GameManager.getDevicePixelRatio());this._context.globalAlpha=this._alpha;this._context.scale(h.x*b.GameManager.getDevicePixelRatio(),h.y*b.GameManager.getDevicePixelRatio());if(null==this._spriteInfo&&null==this._coords)if(null==this._image&&(this._image=this.getImageAsset()),null==this._clipRect)if(b.GameManager.isFirefox())try{this._context.drawImage(this._image,0,0)}catch(p){b.utilities.Debug.log("Error: Failed to draw "+this._imageName)}else this._context.drawImage(this._image,0,0);else this._clipRect.ul.x=Math.max(0,this._clipRect.ul.x),this._clipRect.ul.y=Math.max(0,this._clipRect.ul.y),this._clipRect.wh.x=Math.min(this._clipRect.wh.x,this._image.width),this._clipRect.wh.y=Math.min(this._clipRect.wh.y,this._image.height),this._context.drawImage(this._image,this._clipRect.ul.x,this._clipRect.ul.y,this._clipRect.wh.x,this._clipRect.wh.y,0,0,this._clipRect.wh.x,this._clipRect.wh.y);else null==this._spriteInfo&&null!=this._coords?(null==this._image&&(this._image=b.managers.AssetManager.getAsset(this._imageName)),this._context.drawImage(this._image,this._coords.ul.x,this._coords.ul.y,this._coords.wh.x,this._coords.wh.y,0,0,this._coords.wh.x,this._coords.wh.y)):(h=this._spriteInfo.getCoords(),e=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(this._spriteInfo.getSpriteSheetName()),this._context.drawImage(e.getImage(),h.ul.x,h.ul.y,h.wh.x,h.wh.y,0,0,h.wh.x,h.wh.y));this._layer.setWholeCanvasDirty(!0);this._context.restore()}},render:function(){b.Component.prototype.render.call(this);this.renderToCanvas(this._layer.getCanvas())},quickRender:function(){b.Component.prototype.render.call(this);new b.Vector2D(1,1);this._context=this._layer.getCanvas().getContext("2d");null!=this._maskFunction&&(this._maskFunction(this._context,this),this._context.clip());this._context.scale(this._scale.x,this._scale.y);this._context.rotate(this._rotation.z);if(null==this._spriteInfo&&null==this._coords)null==this._image&&(this._image=b.managers.AssetManager.getAsset(this._imageName));else if(null==this._spriteInfo&&null!=this._coords)null==this._image&&(this._image=b.managers.AssetManager.getAsset(this._imageName)),this._context.drawImage(this._image,Math.floor(this._coords.ul.x),Math.floor(this._coords.ul.y),Math.floor(this._coords.wh.x),Math.floor(this._coords.wh.y),this._offset.x,this._offset.y,Math.floor(this._coords.wh.x)+2,Math.floor(this._coords.wh.y)+2);else{var a=this._spriteInfo.getCoords(),e=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(this._spriteInfo.getSpriteSheetName());null==this._image&&(this._image=b.managers.AssetManager.getAsset(e.getImageName()));this._context.drawImage(this._image,a.ul.x,a.ul.y,a.wh.x,a.wh.y,this._offset.x,this._offset.y,a.wh.x,a.wh.y)}this._context.rotate(-this._rotation.z);this._context.scale(1/this._scale.x,this._scale.y);this._layer.setWholeCanvasDirty(!0)},destroy:function(){b.Component.prototype.destroy.call(this)},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);this._camera=null},__class__:b.components.GameImage});b.components.GameSprite=function(a,e,d,c){this._skew=this._rotation=this._context=null;this._alpha=1;this._onAnimationComplete=null;this._isPlaying=!0;this._maskFunction=null;this._updateScale=1;this._position=0;b.Component.call(this,a,"GameSprite");this._currentAnimationName=e;this._cameraPositionScale=new b.Vector2D(1,1);this._layer=d;this._pivotPoint=new b.Vector2D;this._offset=new b.Vector2D;this._camera=c;this._scale=new b.Vector3D(1,1,1);this._skew=new b.Vector2D;this._rotation=new b.Vector3D(0,0,0)};b.components.GameSprite.__name__=!0;b.components.GameSprite.__super__=b.Component;b.components.GameSprite.prototype=m(b.Component.prototype,{getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},setPivotPoint:function(a){this._pivotPoint=a},getPivotPoint:function(){return this._pivotPoint},getOffset:function(){return this._offset},setOffset:function(a,b){this._offset.x=a;this._offset.y=b},getUpdateScale:function(){return this._updateScale},setUpdateScale:function(a){this._updateScale=a},getLayer:function(){return this._layer},setLayer:function(a){this._layer=a},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},update:function(){b.Component.prototype.update.call(this);if(this._isPlaying){var a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);this._position+=b.GameManager.getElapsedTime()*this.getUpdateScale();this._position>=a.getLength()&&(a.getLoop()?this._position-=a.getLength():(this._position=a.getLength(),this.stop()),null!=this._onAnimationComplete&&(a=this._onAnimationComplete,this._onAnimationComplete=null,a(this.getEntity())))}},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a},setPosition:function(a){this._position=a},getPosition:function(){return this._position},setAnimation:function(a,b,d){null==d&&(d=!1);if(this._currentAnimationName!=a||d)this._position=0;this._currentAnimationName=a;this._onAnimationComplete=b;this._isPlaying=!0},getAnimation:function(){return this._currentAnimationName},getAnimationFps:function(){var a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);return null==a?0:a.getFps()},getAnimationKeyFrameLength:function(){var a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);return null==a?0:a.getKeyframeLength()},play:function(){this._isPlaying=!0},stop:function(){this._isPlaying=!1},playing:function(){return this._isPlaying},setOnAnimationComplete:function(a){this._onAnimationComplete=a},getOnAnimationComplete:function(){return this._onAnimationComplete},render:function(){b.Component.prototype.render.call(this);var a=this.getEntity(),e=a.getPosition(),d=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);if(null!=d){var c=d.getSpriteIndexAtPosition(this._position),g=d.getSpriteSheetNameAtPosition(this._position),c=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(g).getSpriteInfoByIndex(c);c.getCoords();var h=1,p=new b.Vector2D(0,0),g=new b.Vector2D(1,1);this._layer.getCanvas().getContext("2d");this.getEntity().getRotation();this.getEntity().getScale();null!=this._camera&&(p=this._camera.getEntity(),h=this._camera.getZoomScale(),p=p.getPosition(),p=new b.Vector2D(-(p.x/this._cameraPositionScale.x)*g.x,-(p.y/this._cameraPositionScale.y)*g.y),p.scaleBy(h,h));null==this._context&&(this._context=this._layer.getCanvas().getContext("2d"));var n=a.getScale().getClone();n.x*=this._scale.x;n.y*=this._scale.y;this._context.save();null!=this._maskFunction&&(this._context.translate(p.x/g.x*h,p.y/g.y*h),this._maskFunction(this._context,this),this._context.clip(),this._context.translate(-p.x*g.x*h,-p.y*g.y*h));this._context.setTransform(1,this._skew.x/n.x,this._skew.y/n.y,1,Math.floor(e.x*g.x*h+p.x)*b.GameManager.getDevicePixelRatio(),Math.floor(e.y*g.y*h+p.y)*b.GameManager.getDevicePixelRatio());this._context.rotate(a.getRotation().z+this._rotation.z);this._context.scale(n.x*h,n.y*h);a=this._offset.getClone();null!=c&&(a.x+=c.getOffset().x+d.getOffset().x,a.y+=c.getOffset().y+d.getOffset().y);this._context.translate(Math.floor(a.x*g.x)*b.GameManager.getDevicePixelRatio(),Math.floor(a.y*g.y)*b.GameManager.getDevicePixelRatio());this._context.globalAlpha=this._alpha;this._context.scale(g.x*b.GameManager.getDevicePixelRatio(),g.y*b.GameManager.getDevicePixelRatio());d=c.getCoords();a=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(c.getSpriteSheetName());this._context.drawImage(a.getImage(),d.ul.x,d.ul.y,d.wh.x,d.wh.y,0,0,d.wh.x,d.wh.y);this._layer.setWholeCanvasDirty(!0);this._context.restore()}},__class__:b.components.GameSprite});b.components.HtmlElements=function(a,e,d,c){null==c&&(c="");null==d&&(d="");this._alwaysUpdatePosition=!1;this._className="";this._div=null;this._isDirty=!0;b.Component.call(this,a,"HtmlElements");this._html=d;this._className=c;this._layer=e;this.updateHtml()};b.components.HtmlElements.__name__=!0;b.components.HtmlElements.showElementById=function(a,e){null==e&&(e=!0);var d=b.components.HtmlElements.getChildDivById(k.getContainer(),a);null!=d?d.style.display=e?"block":"none":b.utilities.Debug.log("Could not find element with id of "+a+" to "+(e?"show":"hide"))};b.components.HtmlElements.getStylePositionOfDomElement=function(a){for(var e=q.parseInt(a.style.top),d=q.parseInt(a.style.left);;)if(null!=a.parentNode&&Object.prototype.hasOwnProperty.call(a.parentNode,"style")&&"layer"!=a.parentElement.className)e+=q.parseInt(a.parentElement.style.top),d+=q.parseInt(a.parentElement.style.left),a=a.parentElement;else break;return new b.Vector2D(d,e)};b.components.HtmlElements.setElementTextById=function(a,e){var d=k.getDocument().getElementById(a);null==d?b.utilities.Debug.log("Could not find '"+a+"' on the page!"):d.innerHTML=e};b.components.HtmlElements.getChildDivById=function(a,e){for(var d=a.children.length,c=0;c<d;){var g=c++,g=a.children[g];if(g.id==e||g.hasChildNodes()&&(g=b.components.HtmlElements.getChildDivById(g,e),null!=g))return g}return null};b.components.HtmlElements.__super__=b.Component;b.components.HtmlElements.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.getEntity().addEventListener("displayUpdate",l(this,this.onDisplayUpdated))},getChildElementById:function(a){return k.getDocument().getElementById(a)},setChildElementTextById:function(a,e){var d=b.components.HtmlElements.getChildDivById(this.getDiv(),a);null!=d&&(d.innerHTML=e);this._html=this.getDiv().innerHTML},getDiv:function(){null==this._div&&this._isDirty&&this.updateHtml();return this._div},update:function(){b.Component.prototype.update.call(this);null!=this._div&&this._isDirty&&this.updateHtml();null!=this._div&&this._alwaysUpdatePosition&&this.updatePosition();this.getEntity().getIsVisible()?this._div.style.display="block":this._div.style.display="none"},updateHtml:function(){b.utilities.Debug.log("updateHtml");null!=this._div&&null!=this._div.parentNode&&this._div.parentNode.removeChild(this._div);this._isDirty=!1;this._div=k.getDocument().createElement("div");this._div.className=this._className;this._div.innerHTML=this._html;this._div.style.position="absolute";this._div.style.webkitTransform="translate(0, 0px) scale("+this.getEntity().getScale().x*b.GameManager.instance.getScreenScale().x+","+this.getEntity().getScale().y*b.GameManager.instance.getScreenScale().y+")";this._div.style.transform="translate(0, 0px) scale("+this.getEntity().getScale().x*b.GameManager.instance.getScreenScale().x+","+this.getEntity().getScale().y*b.GameManager.instance.getScreenScale().y+")";this._layer.getContainer().appendChild(this._div);this.updatePosition()},updatePosition:function(){this._div.style.left=this.getEntity().getPosition().x*b.GameManager.instance.getScreenScale().x-(this._center?this._div.clientWidth/2:0)+"px";this._div.style.top=this.getEntity().getPosition().y*b.GameManager.instance.getScreenScale().y-(this._center?this._div.clientHeight/2:0)+"px"},setId:function(a){null==this._div&&this._isDirty&&this.updateHtml();this._id=a;this._div.id=a},getId:function(){return this._id},getHtml:function(){return this._html},setHtml:function(a){this._html=a},setClassName:function(a){this._className=a},getClassName:function(){return this._className},addClassName:function(a){this._className=0<this._className.length?this._className+(" "+a):a},removeClassName:function(a){this._className=x.replace(this._className,a,"")},forceUpdateNextFrame:function(){this._html=this._div.innerHTML},centerOnEntity:function(a){null==a&&(a=!0);this._center=a;this.updatePosition()},getSize:function(){return new b.Vector2D(this._div.clientWidth*b.GameManager.instance.getScreenScale().y,this._div.clientHeight*b.GameManager.instance.getScreenScale().y)},destroy:function(){b.Component.prototype.destroy.call(this);null!=this._div.parentNode&&this._layer.getContainer().removeChild(this._div)},handleMessage:function(a,e){b.Component.prototype.handleMessage.call(this,a,e)},onDisplayUpdated:function(){},alwaysUpdatePosition:function(a){null==a&&(a=!0);this._alwaysUpdatePosition=a},__class__:b.components.HtmlElements});b.components.PropertySineWave=function(a,e,d,c,g,h,p,n,k){null==k&&(k=0);null==n&&(n=0);null==p&&(p=!1);this._strength=1;this._magnitudeDecayRate=0;this._half=!1;this._propertyName="";this._target=null;this._theta=this._rate=this._base=this._magnitude=0;b.Component.call(this,a,"PropertySineWave");this._base=c;this._magnitude=g;this._rate=h;this._propertyName=d;this._target=e;this._half=p;this._theta=n;this._magnitudeDecayRate=k};b.components.PropertySineWave.__name__=!0;b.components.PropertySineWave.__super__=b.Component;b.components.PropertySineWave.prototype=m(b.Component.prototype,{getStrength:function(){return this._strength},setStrength:function(a){this._strength=a},getMagnitude:function(){return this._magnitude},setMagnitude:function(a){this._magnitude=a},getMagnitudeDecayRate:function(){return this._magnitudeDecayRate},setMagnitudeDecayRate:function(a){this._magnitudeDecayRate=a},getBase:function(){return this._base},setBase:function(a){this._base=a},update:function(){b.Component.prototype.update.call(this);if(0<this._magnitude){this._magnitude-=this._magnitudeDecayRate*b.GameManager.getElapsedTime();0>this._magnitude&&(this._magnitude=0);this._theta+=this._rate*b.GameManager.getElapsedTime();this._theta>=(this._half?Math.PI:2*Math.PI)&&(this._theta=this._half?this._theta-Math.PI:this._theta-2*Math.PI);var a=this._base+Math.sin(this._theta)*this._magnitude*this._strength;v.setProperty(this._target,this._propertyName,a)}},__class__:b.components.PropertySineWave});b.components.SimpleMovement=function(a,e){this._velocity=this._angularVelocity=this._gravity=null;b.Component.call(this,a,"SimpleMovement");this._velocity=new b.Vector3D;this._angularVelocity=new b.Vector3D;null!=e&&(this._gravity=e.getClone())};b.components.SimpleMovement.__name__=!0;b.components.SimpleMovement.__super__=b.Component;b.components.SimpleMovement.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},update:function(){b.Component.prototype.update.call(this);null!=this._gravity&&(this._velocity.x+=this._gravity.x*b.GameManager.getElapsedTime(),this._velocity.y+=this._gravity.y*b.GameManager.getElapsedTime(),this._velocity.z+=this._gravity.z*b.GameManager.getElapsedTime());var a=this._velocity.getClone();a.scaleBy(b.GameManager.getElapsedTime());var e=this._angularVelocity.getClone();e.scaleBy(b.GameManager.getElapsedTime());var d=this.getEntity().getLocalPosition(),c=this.getEntity().getLocalRotation();this.getEntity().setPosition(d.x+a.x,d.y+a.y,d.z+a.z);this.getEntity().setRotation(c.x+e.x,c.y+e.y,c.z+e.z)},getXyAngleFromVector:function(a){return b.utilities.Math2.getAngleInDegreesBetween2dVectors(a,new b.Vector2D(this._velocity.x,this._velocity.y))},deactivate:function(){b.Component.prototype.deactivate.call(this);this._velocity.x=0;this._velocity.y=0;this._velocity.z=0},getGravity:function(){return this._gravity.getClone()},setGravity:function(a){this._gravity=new b.Vector3D(a.x,a.y,a.z)},getVelocity:function(){return this._velocity},addVelocity:function(a,e,d){null==d&&(d=0);null==e&&(e=0);null==a&&(a=0);this._velocity=this._velocity.add(new b.Vector3D(a,e,d))},setVelocity:function(a,e,d){null==d&&(d=0);null==e&&(e=0);null==a&&(a=0);this._velocity=new b.Vector3D(a,e,d)},setVelocityX:function(a){this._velocity.x=a},setVelocityY:function(a){this._velocity.y=a},setVelocityZ:function(a){this._velocity.z=a},getVelocityX:function(){return this._velocity.x},getVelocityY:function(){return this._velocity.y},getVelocityZ:function(){return this._velocity.z},getAngularVelocity:function(){return this._angularVelocity},setAngularVelocity:function(a){this._angularVelocity=a},__class__:b.components.SimpleMovement});b.components.SlackMovement=function(a,e){null==e&&(e=0.5);this._slack=1;this._targetPosition=null;b.Component.call(this,a,"SlackMovement");this._slack=e};b.components.SlackMovement.__name__=!0;b.components.SlackMovement.__super__=b.Component;b.components.SlackMovement.prototype=m(b.Component.prototype,{getSlack:function(){return this._slack},setSlack:function(a){this._slack=a},update:function(){b.Component.prototype.update.call(this);if(null!=this._targetPosition){var a=this._targetPosition.subtract(this.getEntity().getPosition()),e=a.getLength();0!=e&&(a=a.getNormalized(),a.scaleBy(e*this._slack),5E-5>a.x&&-5E-5<a.x&&(a.x=0),5E-5>a.y&&-5E-5<a.y&&(a.y=0),5E-5>a.z&&-5E-5<a.z&&(a.z=0),e=this.getEntity().getPosition().getClone(),this.getEntity().setPosition(e.x+a.x,e.y+a.y,e.z+a.z))}},getTarget:function(){return this._targetPosition},setTarget:function(a,e,d){this._targetPosition=new b.Vector3D(a,e,d)},__class__:b.components.SlackMovement});b.components.TextField=function(a,e,d){this._spanElement=this._computedStyle=null;this._htmlText="";this._textFieldHeight=0;this._maskFunction=null;this._alpha=1;this._wrapWidth=-1;this._lineSpacing=8;this._maxWidth=1024;this._textBaseline="middle";this._textAlign="center";this._fillStyle="white";this._fontFamily="agencyfbregular";this._fontSize="16pt";this._text="";b.Component.call(this,a,"TextField");this._layer=e;this._pivotPoint=new b.Vector2D;this._camera=d;null==b.components.TextField._defaultComputedStyle&&(b.components.TextField._defaultComputedStyle=k.getWindow().getComputedStyle(k.getDocument().body));this._skew=new b.Vector2D(0,0)};b.components.TextField.__name__=!0;b.components.TextField.__super__=b.Component;b.components.TextField.prototype=m(b.Component.prototype,{getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a},getSkew:function(){return this._skew},setSkew:function(a){this._skew=a},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},getFont:function(){return this._fontSize+" "+this._fontFamily},getFontFamily:function(){return this._fontFamily},setFontFamily:function(a){this._fontFamily=a},getFontSize:function(){return this._fontSize},setFontSize:function(a){this._fontSize=a;this.stripAndApplyRelevantHtml()},getLineSpacing:function(){return this._lineSpacing},setLineSpacing:function(a){this._lineSpacing=a},getFillStyle:function(){return this._fillStyle},setFillStyle:function(a){this._fillStyle=a},getMaxWidth:function(){return this._maxWidth},setMaxWidth:function(a){this._maxWidth=a},getWrapWidth:function(){return this._wrapWidth},setWrapWidth:function(a){this._wrapWidth=a},getText:function(){return this._text},setText:function(a){this._htmlText=this._text=a;this.stripAndApplyRelevantHtml()},getTextBaseline:function(){return this._textBaseline},setTextBaseline:function(a){this._textBaseline=a},setTextAlign:function(a){this._textAlign=a},getTextAlign:function(){return this._textAlign},getTextFieldHeight:function(){var a=this._layer.getCanvas().getContext("2d");a.font=this.getFont();a.fillStyle=this._fillStyle;a.textAlign=this._textAlign;a.textBaseline=this._textBaseline;a.globalAlpha=this._alpha;for(var b=this._text.split("\n"),d=b.length,c=0,g=0;g<d;){for(var h=g++,p="",h=b[h].split(" "),n=this._fontSize.substring(0,this._fontSize.length-2),k=0,l=h.length;k<l;){var m=k++,p=p+h[m]+" ";a.measureText(p).width>this._maxWidth&&(p=h[m]+" ",c+=parseFloat(n)+parseFloat(this._lineSpacing))}c+=parseFloat(n)+parseFloat(this._lineSpacing)}return c},wrapText:function(a,b,d){for(var c=this._text.split("\\n"),g=c.length,h=0;h<g;){for(var p=h++,n="",p=c[p].split(" "),k=this._fontSize.substring(0,this._fontSize.length-
2),l=0,m=p.length;l<m;){var q=l++,t=n+p[q]+" ";d.measureText(t).width>this._maxWidth?(d.fillText(n,a,b),n=p[q]+" ",b+=parseFloat(k)+parseFloat(this._lineSpacing)):n=t}d.fillText(n,a,b);b+=parseFloat(k)+parseFloat(this._lineSpacing)}},render:function(){b.Component.prototype.render.call(this);var a=this._layer.getCanvas().getContext("2d"),e=this.getEntity().getPosition().getClone(),d=this.getEntity().getRotation().z,c=this.getEntity().getScale();a.save();null!=this._maskFunction&&(a.scale(b.GameManager.getDevicePixelRatio(),b.GameManager.getDevicePixelRatio()),this._maskFunction(a,this),a.clip(),a.scale(1/b.GameManager.getDevicePixelRatio(),1/b.GameManager.getDevicePixelRatio()));if(null!=this._camera){var g=this._camera.getEntity();a.translate(-g.getPosition().x*b.GameManager.getDevicePixelRatio(),-g.getPosition().y*b.GameManager.getDevicePixelRatio())}a.setTransform(1,b.utilities.Math2.degToRad(this._skew.x),b.utilities.Math2.degToRad(this._skew.y),1,(e.x+this._pivotPoint.x)*b.GameManager.getDevicePixelRatio(),(e.y+
this._pivotPoint.y)*b.GameManager.getDevicePixelRatio());a.rotate(d);a.translate(-((e.x+this._pivotPoint.x)*c.x*b.GameManager.getDevicePixelRatio()),-((e.y+this._pivotPoint.y)*c.y)*b.GameManager.getDevicePixelRatio());a.scale(c.x*b.GameManager.getDevicePixelRatio(),c.y*b.GameManager.getDevicePixelRatio());a.imageSmoothingEnabled=!0;a.font=this.getFont();a.fillStyle=this._fillStyle;a.textAlign=this._textAlign;a.textBaseline=this._textBaseline;a.globalAlpha=this._alpha;this.wrapText(e.x,e.y,a);this._layer.setWholeCanvasDirty(!0);a.restore()},stripAndApplyRelevantHtml:function(){var a;a=k.getDocument().createElement("div");a.innerHTML=this._htmlText;var e=s.parse(a.outerHTML);if(e.elementsNamed("div").hasNext()){e=e.elementsNamed("div").next();if(e.elementsNamed("font").hasNext()){var c=e.elementsNamed("font").next();c.exists("size")&&(-1!=c.get("size").indexOf("px")?this._fontSize=q.parseInt(c.get("size"))+"px":this._fontSize=q.parseInt(c.get("size"))+"pt")}e.elementsNamed("span").hasNext()&&(e=e.elementsNamed("span").next(),e.exists("class")||e.exists("id")||e.exists("style"))&&(null==this._spanElement&&(this._spanElement=k.getDocument().createElement("span"),this._spanElement.style.display="none",e.exists("id")&&(this._spanElement.id=e.get("id")),e.exists("class")&&(this._spanElement.className=e.get("class")),e.exists("style")&&(this._spanElement.style.cssText=e.get("style")),this._computedStyle=k.getWindow().getComputedStyle(this._spanElement),k.getContainer().appendChild(this._spanElement)),this._computedStyle.fontSize!=b.components.TextField._defaultComputedStyle.fontSize&&(this._fontSize=this._computedStyle.fontSize))}b.GameManager.isFirefox()?this._text=a.textContent:this._text=a.innerText},__class__:b.components.TextField});b.components.Tweener=function(a){this._tweens=null;b.Component.call(this,a,"Tweener");this._tweens=[]};b.components.Tweener.__name__=!0;b.components.Tweener.__super__=b.Component;b.components.Tweener.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},getTweenByProperty:function(a){for(var b=this._tweens.length,c=0;c<b;){var f=c++,f=this._tweens[f];if(f._propertyName==a)return f}return null},addTween:function(a,e,c,f,g,h,p,n,k,l){null==l&&(l=!1);null==p&&(p=0);a=new b.components.tween.Tween(a,e,c,f,g,h,p,n,k,l);this._tweens.push(a);return a},skipAll:function(){for(var a=this._tweens.length,b=0;b<a;){var c=b++;this._tweens[c].skip()}},destroyTween:function(a){t.remove(this._tweens,a)},destroyAllTweens:function(){this._tweens=[]},update:function(){b.Component.prototype.update.call(this);for(var a=this._tweens.length-1;0<=a;){var e=this._tweens[a];e.update(b.GameManager.getElapsedTime());e._isCompleted&&this._tweens.splice(a,1);a--}},__class__:b.components.Tweener});b.components.buttons={};b.components.buttons.ButtonActionDelay=function(a,e,c,f){this._lockDelayButtonNextFrame=!1;this._inputEnabled=!0;this._action=this._instantAction=this._deferredAction=null;this._delayTime=0;b.Component.call(this,a,"ButtonActionDelay");this._delayTime=c;this._action=e;this._instantAction=f};b.components.buttons.ButtonActionDelay.__name__=!0;b.components.buttons.ButtonActionDelay.getDelayButtonLock=function(){return b.components.buttons.ButtonActionDelay._delayButtonLock};b.components.buttons.ButtonActionDelay.__super__=b.Component;b.components.buttons.ButtonActionDelay.prototype=m(b.Component.prototype,{getInstantAction:function(){return this._instantAction},setInstantAction:function(a){this._instantAction=a},getOnAction:function(){return this._action},setOnAction:function(a){this._action=a},init:function(){b.Component.prototype.init.call(this);this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());this.getEntity().addEventListener("mouseUp",l(this,this.onMouseDown))},onMouseDown:function(){this._inputEnabled&&!b.components.buttons.ButtonActionDelay._delayButtonLock&&(this._inputEnabled=!1,this._lockDelayButtonNextFrame=!0,null!=this._instantAction&&this._instantAction(),this._deferredAction.addDeferredAction(this._delayTime,l(this,this.onMouseDownDelayElapse)))},postUpdate:function(){b.Component.prototype.update.call(this);this._lockDelayButtonNextFrame&&(b.components.buttons.ButtonActionDelay._delayButtonLock=!0);this._lockDelayButtonNextFrame=!1},onMouseDownDelayElapse:function(){this._lockDelayButtonNextFrame=b.components.buttons.ButtonActionDelay._delayButtonLock=!1;null!=this._action&&this._action();this._inputEnabled=!0},destroy:function(){b.Component.prototype.destroy.call(this);0<=this._delayTime&&(b.components.buttons.ButtonActionDelay._delayButtonLock=!1)},__class__:b.components.buttons.ButtonActionDelay});b.components.buttons.ButtonMouseDownPulse=function(a,e,c,f,g){null==g&&(g=!0);this._allowOnce=!0;this._buttonMouseOverScale=this._tweener=null;this._isPulseActive=!1;b.Component.call(this,a,"ButtonMouseDownPulse");this._pulseFromScale=e;this._pulseToScale=c;this._pulseDuration=f;this._allowOnce=g;this.getEntity().addEventListener("mouseDown",l(this,this.onMouseDown))};b.components.buttons.ButtonMouseDownPulse.__name__=!0;b.components.buttons.ButtonMouseDownPulse.__super__=b.Component;b.components.buttons.ButtonMouseDownPulse.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._buttonMouseOverScale=this.getSiblingComponent(b.components.buttons.ButtonMouseOverScale);this._tweener=new b.components.Tweener(this.getEntity())},disableButton:function(){this.getEntity().removeEventListener("mouseDown",l(this,this.onMouseDown))},enableButton:function(){this.getEntity().addEventListener("mouseDown",l(this,this.onMouseDown))},onMouseDown:function(){if(!this._isPulseActive&&!b.components.buttons.ButtonActionDelay.getDelayButtonLock()){var a=this.getEntity().getComponent(b.ui.UiElement);this._isPulseActive=!0;null!=this._buttonMouseOverScale&&this._buttonMouseOverScale.setIsActive(!1);null!=a?(this._tweener.addTween(a.getScaleRef(),"x",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,0,l(this,this.onPulseComplete)),this._tweener.addTween(a.getScaleRef(),"y",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,0)):(this._tweener.addTween(this.getEntity().getScaleRef(),"x",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,0,l(this,this.onPulseComplete)),this._tweener.addTween(this.getEntity().getScaleRef(),"y",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,0))}},onPulseComplete:function(){this._allowOnce||(this._isPulseActive=!1,null!=this._buttonMouseOverScale&&this._buttonMouseOverScale.setIsActive(!0))},__class__:b.components.buttons.ButtonMouseDownPulse});b.components.buttons.ButtonMouseOverImage=function(a,e,c){this._gameImage=null;b.Component.call(this,a,"ButtonMouseOverImage");this._defaultImageName=e;this._mouseOverImageName=c;this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",l(this,this.onMouseOut))};b.components.buttons.ButtonMouseOverImage.__name__=!0;b.components.buttons.ButtonMouseOverImage.__super__=b.Component;b.components.buttons.ButtonMouseOverImage.prototype=m(b.Component.prototype,{getImageName:function(){return this._gameImage.getImageName()},setDefaultImage:function(a){this._defaultImageName=a;this.updateImage(this._defaultImageName)},setMouseOverImage:function(a){this._mouseOverImageName=a;this.updateImage(this._mouseOverImageName)},init:function(){b.Component.prototype.init.call(this);this._gameImage=this.getSiblingComponent(b.components.GameImage);this._gameImage.setImage(this._defaultImageName);this._gameImage.centerOffsetOnEntity()},disableButton:function(){this.getEntity().removeEventListener("mouseOver",l(this,this.onMouseOver));this.getEntity().removeEventListener("mouseOut",l(this,this.onMouseOut))},enableButton:function(){this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",l(this,this.onMouseOut))},onMouseOver:function(a){this.updateImage(this._mouseOverImageName)},onMouseOut:function(a){this.updateImage(this._defaultImageName)},updateImage:function(a){if(null==this._gameImage&&(this._gameImage=this.getSiblingComponent(b.components.GameImage),null==this._gameImage))return;this._gameImage.getImageName()!=a&&(this._gameImage.setIsActive(!0),this._gameImage.setImage(a),this._gameImage.centerOffsetOnEntity())},__class__:b.components.buttons.ButtonMouseOverImage});b.components.buttons.ButtonMouseOverScale=function(a,e,c,f,g){null==c&&(c=0.35);null==e&&(e=1.25);this._baseScaleX=this._baseScaleY=1;this._button=this._tweener=null;b.Component.call(this,a,"ButtonMouseOverScale");this._scaleSize=e;this._scaleDuration=c;this._mouseOverEasingFunction=f;this._mouseOutEasingFunction=g;null==this._mouseOverEasingFunction&&(this._mouseOverEasingFunction=b.components.tween.EasingFunctions.linear);null==this._mouseOutEasingFunction&&(this._mouseOutEasingFunction=b.components.tween.EasingFunctions.linear);this._baseScaleX=this.getEntity().getScaleRef().x;this._baseScaleY=this.getEntity().getScaleRef().y;this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",l(this,this.onMouseOut))};b.components.buttons.ButtonMouseOverScale.__name__=!0;b.components.buttons.ButtonMouseOverScale.__super__=b.Component;b.components.buttons.ButtonMouseOverScale.prototype=m(b.Component.prototype,{onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._tweener.setIsActive(!1)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._tweener.setIsActive(!0)},init:function(){b.Component.prototype.init.call(this);this._tweener=new b.components.Tweener(this.getEntity());var a=this.getEntity().getComponent(b.ui.UiElement);null!=a&&(this._baseScaleX=a.getScaleRef().x,this._baseScaleY=a.getScaleRef().y)},disableButton:function(){this.onMouseOut(null);this.getEntity().removeEventListener("mouseOver",l(this,this.onMouseOver))},enableButton:function(){this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver))},onMouseOver:function(a){if(!b.GameManager.isMobile()&&(a=this.getEntity().getComponent(b.ui.UiElement),!b.components.buttons.ButtonActionDelay.getDelayButtonLock()))if(this._tweener.destroyAllTweens(),null!=a){var e=a.getScaleRef().x,c=a.getScaleRef().y;this._tweener.addTween(a.getScaleRef(),"x",e,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction);this._tweener.addTween(a.getScaleRef(),"y",c,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction)}else a=this.getEntity().getScaleRef().x,e=this.getEntity().getScaleRef().y,this._tweener.addTween(this.getEntity().getScaleRef(),"x",a,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction),this._tweener.addTween(this.getEntity().getScaleRef(),"y",e,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction)},onMouseOut:function(a){if(!b.GameManager.isMobile()&&null!=this._tweener)if(a=this.getEntity().getComponent(b.ui.UiElement),this._tweener.destroyAllTweens(),null!=a){var e=a.getScaleRef().x,c=a.getScaleRef().y;this._tweener.addTween(a.getScaleRef(),"x",e,this._baseScaleX,this._scaleDuration,this._mouseOutEasingFunction);this._tweener.addTween(a.getScaleRef(),"y",c,this._baseScaleY,this._scaleDuration,this._mouseOutEasingFunction)}else a=this.getEntity().getScaleRef().x,e=this.getEntity().getScaleRef().y,this._tweener.addTween(this.getEntity().getScaleRef(),"x",a,this._baseScaleX,this._scaleDuration,this._mouseOutEasingFunction),this._tweener.addTween(this.getEntity().getScaleRef(),"y",e,this._baseScaleY,this._scaleDuration,this._mouseOutEasingFunction)},__class__:b.components.buttons.ButtonMouseOverScale});b.components.buttons.ButtonSoundPlay=function(a,e,c){b.Component.call(this,a,"ButtonSoundPlay");this._soundName=e;this._overSoundName=c};b.components.buttons.ButtonSoundPlay.__name__=!0;b.components.buttons.ButtonSoundPlay.__super__=b.Component;b.components.buttons.ButtonSoundPlay.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.getEntity().addEventListener("mouseUp",l(this,this.onMouseDown));this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver))},onMouseDown:function(){""!=this._soundName&&b.managers.SoundManager.playSoundByName(this._soundName)},onMouseOver:function(){""!=this._soundName&&b.managers.SoundManager.playSoundByName(this._overSoundName)},destroy:function(){b.Component.prototype.destroy.call(this);this.getEntity().removeEventListener("mouseDown",l(this,this.onMouseDown))},__class__:b.components.buttons.ButtonSoundPlay});b.components.colliders={};b.components.colliders.BoxCollider=function(a,e,c){b.components.Collider.call(this,a,c);this._collision=e};b.components.colliders.BoxCollider.__name__=!0;b.components.colliders.BoxCollider.__super__=b.components.Collider;b.components.colliders.BoxCollider.prototype=m(b.components.Collider.prototype,{update:function(){b.components.Collider.prototype.update.call(this);var a=this.getEntity().getPosition().getClone(),e;e=null!=this._offset?this._offset:new b.Vector3D;this._collision.ul.x=a.x-this._collision.wh.x/2+e.x*this.getEntity().getScale().x;this._collision.ul.y=a.y-this._collision.wh.y/2+e.y*this.getEntity().getScale().y},checkPointIntersect:function(a){return this._collision.checkPointIntersect(a)},getRaycastPoint:function(a,b,c,f,g){null==f&&(f=!1);return this._collision.getRaycastPoint(a,b,c,f,g)},debugRender:function(){b.components.Collider.prototype.debugRender.call(this);var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var e=b.components.Camera.getDebugCamera().getEntity(),c=b.components.Camera.getDebugCamera().getZoomScale();a.translate(-e.getPosition().x*c,-e.getPosition().y*c);a.scale(c,c)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(this._collision.ul.x,this._collision.ul.y);a.lineTo(this._collision.ul.x+this._collision.wh.x,this._collision.ul.y);a.lineTo(this._collision.ul.x+this._collision.wh.x,this._collision.ul.y+this._collision.wh.y);a.lineTo(this._collision.ul.x,this._collision.ul.y+this._collision.wh.y);a.lineTo(this._collision.ul.x,this._collision.ul.y);a.stroke();a.restore()},getCollision:function(){return this._collision},__class__:b.components.colliders.BoxCollider});b.components.colliders.PolygonCollider=function(a,e,c){b.components.Collider.call(this,a,c);this._collision=e};b.components.colliders.PolygonCollider.__name__=!0;b.components.colliders.PolygonCollider.__super__=b.components.Collider;b.components.colliders.PolygonCollider.prototype=m(b.components.Collider.prototype,{update:function(){b.components.Collider.prototype.update.call(this);var a=this.getEntity().getPosition().getClone(),e;e=null!=this._offset?this._offset:new b.Vector3D;this._collision.ul.x=a.x-this._collision.wh.x/2+e.x*this.getEntity().getScale().x;this._collision.ul.y=a.y-this._collision.wh.y/2+e.y*this.getEntity().getScale().y},checkPointIntersect:function(a){return this._collision.checkPointIntersect(a)},getRaycastPoint:function(a,b,c,f,g){null==f&&(f=!1);return this._collision.getRaycastPoint(a,b,c,f,g)},debugRender:function(){b.components.Collider.prototype.debugRender.call(this);var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var e=b.components.Camera.getDebugCamera().getEntity(),c=b.components.Camera.getDebugCamera().getZoomScale();a.translate(-e.getPosition().x*c,-e.getPosition().y*c);a.scale(c,c)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";e=this._collision.getPoints().length;for(c=0;c<e;){var f=c++;0==f?a.moveTo(this._collision.ul.x+this._collision.getPoints()[f].x,this._collision.ul.y+this._collision.getPoints()[f].y):a.lineTo(this._collision.ul.x+this._collision.getPoints()[f].x,this._collision.ul.y+this._collision.getPoints()[f].y)}a.lineTo(this._collision.ul.x+
this._collision.getPoints()[0].x,this._collision.ul.y+this._collision.getPoints()[0].y);a.stroke();a.restore()},getCollision:function(){return this._collision},__class__:b.components.colliders.PolygonCollider});b.components.flashAnimation={};b.components.flashAnimation.AnimationKeyframe=function(a,b,c){this._position=this._spriteIndex=0;this._position=a;this._spriteIndex=b;this._spriteSheetName=c};b.components.flashAnimation.AnimationKeyframe.__name__=!0;b.components.flashAnimation.AnimationKeyframe.prototype={getSpriteSheetName:function(){return this._spriteSheetName},getPosition:function(){return this._position},getSpriteIndex:function(){return this._spriteIndex},__class__:b.components.flashAnimation.AnimationKeyframe};b.components.tween={};b.components.tween.EasingFunctions=function(){};b.components.tween.EasingFunctions.__name__=!0;b.components.tween.EasingFunctions.linear=function(a,b,c,f){return b+c*(a/f)};b.components.tween.EasingFunctions.easeInCubic=function(a,b,c,f){a/=f;return c*a*a*a+b};b.components.tween.EasingFunctions.easeOutCubic=function(a,b,c,f){a/=f;a--;return c*(a*a*a+1)+b};b.components.tween.EasingFunctions.easeInQuad=function(a,b,c,f){a/=f;return c*a*a+b};b.components.tween.EasingFunctions.easeOutQuad=function(a,b,c,f){a/=f;return-c*a*(a-2)+b};b.components.tween.EasingFunctions.easeInQuint=function(a,b,c,f){a/=f;return c*a*a*a*a*a+b};b.components.tween.EasingFunctions.easeOutQuint=function(a,b,c,f){a/=f;a--;return c*(a*a*a*a*a+1)+b};b.components.tween.EasingFunctions.easeOutBounce=function(a,b,c,f){a/=f;return 0.36363636363636365>a?c*7.5625*a*a+b:0.7272727272727273>a?c*(7.5625*(a-=0.5454545454545454)*a+0.75)+b:0.9090909090909091>a?c*(7.5625*(a-=0.8181818181818182)*a+0.9375)+b:c*(7.5625*(a-=0.9545454545454546)*a+0.984375)+b};b.components.tween.EasingFunctions.easeInBack=function(a,b,c,f){return c*(a/=f)*a*(2.70158*a-1.70158)+b};b.components.tween.EasingFunctions.easeOutBack=function(a,b,c,f){return c*((a=a/f-1)*a*(3.70158*a+2.70158)+1)+b};b.components.tween.GroupFader=function(a){b.Component.call(this,a,"GroupFader");this._tweener=new b.components.Tweener(this.getEntity())};b.components.tween.GroupFader.__name__=!0;b.components.tween.GroupFader.__super__=b.Component;b.components.tween.GroupFader.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},fadeTo:function(a,e,c,f,g,h){null==h&&(h=0);this._tweener.skipAll();null==g&&(g=b.components.tween.EasingFunctions.linear);for(var p=this.getEntity().getComponentsInChildren(b.components.GameImage),n=p.length,k=0;k<n;){var l=k++;this._tweener.addTween(p[l],"_alpha",a,e,c,g,h,f)}p=this.getEntity().getComponentsInChildren(b.components.TextField);n=p.length;for(k=0;k<n;)l=k++,this._tweener.addTween(p[l],"_alpha",a,e,c,g,h,f)},__class__:b.components.tween.GroupFader});b.components.tween.Tween=function(a,b,c,f,g,h,p,n,k,l){null==l&&(l=!1);this._loop=!1;this._elapsedTime=0;this._isCompleted=!1;this._action=this._params=null;this._change=this._delay=0;this._target=this._easingFunction=null;this._propertyName="";this._begin=this._end=this._duration=0;this._target=a;this._propertyName=b;this._begin=c;this._end=f;this._duration=g;this._easingFunction=h;this._delay=p;this._action=n;this._params=k;this._loop=l};b.components.tween.Tween.__name__=!0;b.components.tween.Tween.prototype={update:function(a){this._change=this._end-this._begin;this._elapsedTime+=a;this._elapsedTime<this._delay||(!this._isCompleted&&this.getTransitionTimeElapsed()>=this._duration&&(this._loop?this._elapsedTime-=this._duration:(this._isCompleted=!0,this._elapsedTime=this._duration+this._delay),null!=this._action&&(a=this._action,this._action=null,a(this._params))),a=0,a=this._easingFunction(this.getTransitionTimeElapsed(),this._begin,this._change,this._duration),v.setProperty(this._target,this._propertyName,a))},skip:function(){v.setProperty(this._target,this._propertyName,this._end);this._isCompleted=!0;this._elapsedTime=this._duration},getTransitionTimeElapsed:function(){return Math.max(0,this._elapsedTime-this._delay)},__class__:b.components.tween.Tween};b.debugFps={};b.debugFps.DebugFpsManager=function(a){this._numFramesCounted=0;this._timeUntilCalculateFrame=1;b.Manager.call(this);this._layer=a};b.debugFps.DebugFpsManager.__name__=!0;b.debugFps.DebugFpsManager.__super__=b.Manager;b.debugFps.DebugFpsManager.prototype=m(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this);this._debugFpsState=new b.debugFps.DebugFpsState(this._layer);b.GameManager.instance.addGameState(this._debugFpsState)},update:function(){b.Manager.prototype.update.call(this);this._numFramesCounted++;this._timeUntilCalculateFrame-=b.GameManager.getRealElapsedTime();0>=this._timeUntilCalculateFrame&&(this._debugFpsState.setFps(this._numFramesCounted),this._numFramesCounted=0,this._timeUntilCalculateFrame+=1)},__class__:b.debugFps.DebugFpsManager});b.debugFps.DebugFpsState=function(a){b.GameState.call(this);b.debugFps.DebugFpsState._instance=this;this._layer=a};b.debugFps.DebugFpsState.__name__=!0;b.debugFps.DebugFpsState.getInstance=function(){return b.debugFps.DebugFpsState._instance};b.debugFps.DebugFpsState.__super__=b.GameState;b.debugFps.DebugFpsState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=this.addEntity();a.setPosition(50,50);this._label=new b.components.TextField(a,this._layer);this._label.setText("");this._label.setFillStyle("#FF5555");this._label.setFontSize("30pt");this._label.setTextAlign("left");a=this.addEntity();a.setPosition(50,100);this._label2=new b.components.TextField(a,this._layer);this._label2.setText("");this._label2.setFillStyle("#FF5555");this._label2.setFontSize("30pt");this._label2.setTextAlign("left")},setFps:function(a){this._label.setText(a+" FPS")},setField:function(a){this._label2.setText(a)},__class__:b.debugFps.DebugFpsState});b.events.EntityEvent=function(a,e){this.data=null;b.events.Event.call(this,a);this.data=e};b.events.EntityEvent.__name__=!0;b.events.EntityEvent.__super__=b.events.Event;b.events.EntityEvent.prototype=m(b.events.Event.prototype,{__class__:b.events.EntityEvent});b.events.EventListener=function(a,b){this.eventName=a;this.action=b};b.events.EventListener.__name__=!0;b.events.EventListener.prototype={__class__:b.events.EventListener};b.events.GameObjectEvent=function(a){b.events.Event.call(this,a)};b.events.GameObjectEvent.__name__=!0;b.events.GameObjectEvent.__super__=b.events.Event;b.events.GameObjectEvent.prototype=m(b.events.Event.prototype,{__class__:b.events.GameObjectEvent});b.events.RaycastCheckEvent=function(a,e,c){this.start=this.end=null;b.events.Event.call(this,a);this.start=e;this.end=c};b.events.RaycastCheckEvent.__name__=!0;b.events.RaycastCheckEvent.__super__=b.events.Event;b.events.RaycastCheckEvent.prototype=m(b.events.Event.prototype,{__class__:b.events.RaycastCheckEvent});b.flashAnimation={};b.flashAnimation.FlashAnimation=function(a,e,c,f,g,h){this._prevFrame=0;this._onAnimationComplete=this._parts=this._partInstances=this._camera=null;this._alpha=1;this._spriteSheet=null;this._currentAnimationName="";this._frameChildren=null;this._isLooping=this._isPlaying=!0;this._framerate=0;this._speedScale=1;this._position=0;this._animation=null;b.Component.call(this,a,"FlashAnimation");this._animation=JSON.parse(b.managers.AssetManager.getAsset(e));this._currentAnimationName=f;this._frameChildren=[];this._parts=this._animation.parts;this._partInstances=this._animation.part_instances;this._layer=g;this._camera=h;this._spriteSheet=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(c)};b.flashAnimation.FlashAnimation.__name__=!0;b.flashAnimation.FlashAnimation.__super__=b.Component;b.flashAnimation.FlashAnimation.prototype=m(b.Component.prototype,{getOnAnimationComplete:function(){return this._onAnimationComplete},setOnAnimationComplete:function(a){this._onAnimationComplete=a},getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},init:function(){b.Component.prototype.init.call(this);this._framerate=this._animation.framerate;this.generateEntitiesForFrame(this._currentAnimationName,0)},getAnimationCompletionPercent:function(){return this.hasAnimation(this._currentAnimationName)?this._position/(this.getAnimationLength()-1):0},setAnimationCompletionPercent:function(a){this._position=(this.getAnimationLength()-1)*a},getAnimationLength:function(){return this.hasAnimation(this._currentAnimationName)?this._animation.animations[this._currentAnimationName].frames.length:0},hasAnimation:function(a){return null!=this._animation.animations[a]&&void 0!=this._animation.animations[a]},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a;this.generateEntitiesForFrame(this._currentAnimationName,Math.floor(this._position))},setLooping:function(a){this._isLooping=a},getLooping:function(){return this._isLooping},getCurrentAnimationName:function(){return this._currentAnimationName},setAnimation:function(a,b,c){null==c&&(c=!1);null==b&&(b=!0);if(this._currentAnimationName!=a||c)this._isLooping=b,this._currentAnimationName=a,this._position=0,this._isPlaying=!0,this.generateEntitiesForFrame(this._currentAnimationName,0)},update:function(){b.Component.prototype.update.call(this);if(""==this.getEntity().getName())throw"Please name all entities (uniquely by entity 'type') that use the FlashAnimation component!";if(this._isPlaying){this._position+=b.GameManager.getElapsedTime()*this._framerate*this._speedScale;var a=this.getAnimationLength()-1;if(this._position>a)if(this._isLooping)this._position-=a,null!=this._onAnimationComplete&&this._onAnimationComplete();else{this._position=a-1;this._isPlaying=!1;null!=this._onAnimationComplete&&(a=this._onAnimationComplete,this._onAnimationComplete=null,a());if(this._destroyEntityOnComplete){this.getEntity().destroy();return}if(this._destroyOnComplete){this.destroy();return}}if(null!=this._camera){var a=this.getEntity().getPosition(),e=this._camera.getEntity().getPosition();e.x+=b.GameManager.instance.getScreenSize().x/2;e.y+=b.GameManager.instance.getScreenSize().y/2;if(1500<(new b.Vector3D(e.x-a.x,e.y-a.y)).getLength())return}this.generateEntitiesForFrame(this._currentAnimationName,Math.floor(this._position))}},destroyFrameChildren:function(a){null==a&&(a=!1);if(null!=this._frameChildren){for(var e=this._frameChildren.length,c=0;c<e;){var f=c++;a&&this._frameChildren[f].destroy()}b.utilities.ArrayUtils.clear(this._frameChildren)}},getPartInfoById:function(a){return this._parts[this.getPartInstanceById(a)]},getPartInstanceById:function(a){return this._partInstances[a]},forceRegeneration:function(){this.generateEntitiesForFrame(this._currentAnimationName,Math.floor(this._position))},generateEntitiesForFrame:function(a,e){if(this.hasAnimation(a)){var c=this._animation.animations[a].frames[e];if(null!=c){var f=this.getEntity(),g=this.getEntity().getName()+"_"+a+"_"+e;if(!b.flashAnimation.FlashAnimation._cachedFrames.exists(g)){this.destroyFrameChildren();for(var h=[],p=c.instances.length,n=0;n<p;){var k=n++,l=c.instances[k],k=l.i,m=this.getPartInfoById(k),q=this.getPartInstanceById(k),t;t=null!=l.x?l.x:0;var s;s=null!=l.y?l.y:0;var u;u=null!=l.a?l.a:1;var k=null!=l.b?l.b:0,w;w=null!=l.c?l.c:0;var x;x=null!=l.d?l.d:1;var l=null!=l.o?l.o:1,G=m.regx,m=m.regy,v=new b.Entity;v.setGameState(null);v.setPosition(t,s,0);v.setScale(u,x);v.setIsUpdating(!1);t=this._spriteSheet.getSpriteInfoByName(q+".png");q=new b.components.GameImage(v,"",this._layer,this._camera);q.setSpriteInfo(t);t=t.getCoords();q.setOffset(t.wh.x*-G,t.wh.y*-m);f.getScale();v.setProperty("sX",k);v.setProperty("sY",w);v.setProperty("alpha",l);q.setSkew(w,k);q.setAlpha(l*this._alpha);f.addChild(v);this._frameChildren.push(v);h.push(v)}b.flashAnimation.FlashAnimation._cachedFrames.set(g,h)}}}},renderPieces:function(){b.Component.prototype.render.call(this);var a=this.getEntity().getName()+"_"+this._currentAnimationName+"_"+Math.floor(this._position);if(null!=this._frameChildren){if(null!=this._camera){var e=this.getEntity().getPosition(),c=this._camera.getEntity().getPosition();c.x+=b.GameManager.instance.getScreenSize().x/2;c.y+=b.GameManager.instance.getScreenSize().y/2;if(1500<(new b.Vector3D(c.x-e.x,c.y-e.y)).getLength())return}if(b.flashAnimation.FlashAnimation._cachedFrames.exists(a)){if(Math.floor(this._position)!=this._prevFrame)for(this.destroyFrameChildren(),a=b.flashAnimation.FlashAnimation._cachedFrames.get(a),e=a.length,c=0;c<e;){var f=c++,f=a[f];f.setGameState(null);this._frameChildren.push(f)}a=this._frameChildren.length;for(e=0;e<a;){c=e++;c=this._frameChildren[c];this.getEntity().addChild(c);var f=c.getComponent(b.components.GameImage),g=c.getProperty("sX"),h=c.getProperty("sY"),p=c.getProperty("alpha"),n=this.getEntity().getScale();c.setGameState(this.getGameState());f.setAlpha(this._alpha*p);f.setSkew(g*n.y,h*n.x);f.setEntity(c);f.setCamera(this._camera);c.render();f.setEntity(null);f.setCamera(null);c.setGameState(null);c.getParent().removeChild(c)}}}},postUpdate:function(){b.Component.prototype.postUpdate.call(this);this._prevFrame=Math.floor(this._position)},setDestroyOnComplete:function(a){this._destroyOnComplete=a},setDestroyEntityOnComplete:function(a){this._destroyEntityOnComplete=a},render:function(){b.Component.prototype.render.call(this);this.renderPieces()},destroy:function(){b.Component.prototype.destroy.call(this);this.destroyFrameChildren(!1);this._frameChildren=null},__class__:b.flashAnimation.FlashAnimation});b.font={};b.font.Font=function(a,e,c){this._fontInfo=this._fontCommon=this._chars=this._kernings=null;this._name=a;this._imageName=c;a=s.parse(b.managers.AssetManager.getAsset(e));this._chars=[];this._kernings=[];this.parseFromXml(a)};b.font.Font.__name__=!0;b.font.Font.prototype={getName:function(){return this._name},setName:function(a){this._name=a},getImageName:function(){return this._imageName},getFontInfo:function(){return this._fontInfo},getFontCommon:function(){return this._fontCommon},getChars:function(){return this._chars},getKernings:function(){return this._kernings},parseFromXml:function(a){var e=a.elementsNamed("font").next().elementsNamed("info").next(),c=new b.font.FontInfo;c.aa="1"==e.get("aa");c.bold="1"==e.get("bold");c.charset=e.get("charset");c.face=e.get("face");c.italic="1"==e.get("italic");c.outline="1"==e.get("outline");var f=e.get("padding").split(",");c.paddingBottom=parseInt(f[0]);c.paddingLeft=parseInt(f[1]);c.paddingRight=parseInt(f[2]);c.paddingTop=parseInt(f[3]);c.size=parseInt(e.get("size"));c.smooth="1"==e.get("smooth");f=e.get("spacing").split(",");c.spacingH=parseInt(f[0]);c.spacingV=parseInt(f[1]);c.stretchH=parseInt(e.get("stretchH"));c.unicode="1"==e.get("unicode");this._fontInfo=c;e=a.elementsNamed("font").next().elementsNamed("common").next();c=new b.font.FontCommon;c.alphaChnl=parseFloat(e.get("alphaChnl"));c.base=parseInt(e.get("base"));c.redChnl=parseFloat(e.get("redChnl"));c.greenChnl=parseFloat(e.get("greenChnl"));c.blueChnl=parseFloat(e.get("blueChnl"));c.lineHeight=parseFloat(e.get("lineHeight"));c.packed="1"==e.get("packed");c.pages=1;c.scaleH=parseFloat(e.get("scaleH"));c.scaleW=parseFloat(e.get("scaleW"));this._fontCommon=c;for(e=a.elementsNamed("font").next().elementsNamed("chars").next().elementsNamed("char");e.hasNext();)c=e.next(),f=new b.font.FontChar,f.id=parseInt(c.get("id")),f.x=parseInt(c.get("x")),f.y=parseInt(c.get("y")),f.width=parseInt(c.get("width")),f.height=parseInt(c.get("height")),f.xOffset=parseInt(c.get("xoffset")),f.yOffset=parseInt(c.get("yoffset")),f.xAdvance=parseInt(c.get("xadvance")),this._chars.push(f);if(a.elementsNamed("font").next().elementsNamed("kernings").hasNext())for(a=a.elementsNamed("font").next().elementsNamed("kernings").next().elementsNamed("kerning");a.hasNext();)e=a.next(),c=new b.font.FontKerning,c.first=parseInt(e.get("first")),c.second=parseInt(e.get("second")),c.amount=parseInt(e.get("amount")),this._kernings.push(c)},getCharById:function(a){for(var b=this._chars.length,c=0;c<b;){var f=c++,f=this._chars[f];if(f.id==a)return f}return null},getKerningSpace:function(a,b){for(var c=this._kernings.length,f=0;f<c;){var g=f++,g=this._kernings[g];if(g.first==a&&g.second==b)return g.amount}return 0},__class__:b.font.Font};b.font.FontChar=function(){this.id=this.x=this.y=this.width=this.height=this.xOffset=this.yOffset=this.xAdvance=this.chnl=0};b.font.FontChar.__name__=!0;b.font.FontChar.prototype={__class__:b.font.FontChar};b.font.FontCommon=function(){this.redChnl=this.greenChnl=this.blueChnl=0;this.alphaChnl=1;this.packed=0;this.pages=1;this.scaleW=this.scaleH=1024;this.base=25;this.lineHeight=32};b.font.FontCommon.__name__=!0;b.font.FontCommon.prototype={__class__:b.font.FontCommon};b.font.FontFactory=function(){};b.font.FontFactory.__name__=!0;b.font.FontFactory.createFont=function(a,e,c,f){e=new b.font.Font(e,c,f);a.registerFont(e);return e};b.font.FontFactory.createFontRender=function(a,e,c,f){a=a.addEntity();new b.font.FontRender(a,b.managers.FontManager.getInstance().getFontByName(e),c,f);return a};b.font.FontFactory.createFontRenderElementSwap=function(a,e,c,f){if("0"==b.GameConfig.getProperty("spriteFontReplace"))return null;a=a.addEntity();(new b.font.FontRender(a,b.managers.FontManager.getInstance().getFontByName(e),null,f)).replaceHtmlTextElementById(c);return a};b.font.FontFactory.prototype={__class__:b.font.FontFactory};b.font.FontInfo=function(){this.paddingTop=this.paddingLeft=this.paddingRight=this.paddingBottom=this.spacingV=this.spacingH=this.outline=1;this.smooth=this.aa=!0;this.stretchH=100;this.unicode=!0;this.charset="";this.bold=this.italic=!1};b.font.FontInfo.__name__=!0;b.font.FontInfo.prototype={__class__:b.font.FontInfo};b.font.FontKerning=function(){};b.font.FontKerning.__name__=!0;b.font.FontKerning.prototype={__class__:b.font.FontKerning};b.font.FontRender=function(a,e,c,f){this._prevHookLeft=this._prevHookTop="";this._forceReinstantiation=!1;this._textAlign="center";this._letters=this._isHookedToElement=this._prevTextValue=null;this._maxWidth=375;this._font=null;b.Component.call(this,a,"FontRender");this._font=e;this._text="";this._layer=c;this._camera=f;this._letters=[]};b.font.FontRender.__name__=!0;b.font.FontRender.__super__=b.Component;b.font.FontRender.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.instantiateLetters()},update:function(){b.Component.prototype.update.call(this);if(null!=this._isHookedToElement&&(this.setText(this._isHookedToElement.innerHTML),"none"==this._isHookedToElement.parentElement.style.display&&this.removeLetters(),this._isHookedToElement.style.left!=this._prevHookLeft||this._isHookedToElement.style.top!=this._prevHookTop))this.onDisplayUpdated();if(this._prevTextValue!=this._text)this.onDisplayUpdated();this._forceReinstantiation&&(this._forceReinstantiation=!1,this.removeLetters(),this.instantiateLetters())},getText:function(){return this._text},setText:function(a){this._text=a;this._text=x.replace(this._text,"&amp;","&");this._forceReinstantiation=!0},setNonHTMLText:function(a){this._prevTextValue=this._text=a;this._forceReinstantiation=!0},instantiateLetters:function(){this.removeLetters();for(var a=this._text.length,e=new b.Vector2D(0,this._font.getFontCommon().base),c=[],f=0,g=!1,h=0;h<a;){var p=t.cca(this._text,h),n=t.cca(this._text,h+1);if("<br>"==this._text.substring(h,h+4)||"<br/>"==this._text.substring(h,h+5))e.x=0,e.y+=this._font.getFontCommon().lineHeight,h+=4,"center"==this._textAlign?this.centerLetters(c,f):"right"==this._textAlign&&this.rightAlignLetters(c,f),f=0,c=[];else{g&&(e.x+this.getWordLength(this.getWordAtIndex(h)+15)>this._maxWidth&&(e.x=0,e.y+=this._font.getFontCommon().lineHeight+this._font.getFontInfo().spacingV,"center"==this._textAlign?this.centerLetters(c,f):"right"==this._textAlign&&this.rightAlignLetters(c,f),f=0,c=[]),g=!1);var k=this.getEntity().getGameState().addEntity();k.setIsUpdating(!1);this.getEntity().addChild(k);k.setPosition(Math.ceil(e.x),Math.ceil(e.y));var l=this._font.getCharById(p);if(null!=l){var m=new b.components.GameImage(k,this._font.getImageName(),this._layer,this._camera);m.setOffset(l.xOffset,Math.ceil(l.yOffset-this._font.getFontCommon().base));m.setCoords(new b.Rect2D(l.x,l.y,l.width,l.height));e.x+=Math.ceil(l.xAdvance+this._font.getFontInfo().spacingH);f+=Math.ceil(l.xAdvance+this._font.getFontInfo().spacingH);c.push(k);h<a-1&&(e.x+=this._font.getKerningSpace(p,t.cca(this._text,h+1))+this._font.getFontInfo().spacingH,f+=this._font.getKerningSpace(p,t.cca(this._text,h+1))+this._font.getFontInfo().spacingH);32!=n&&e.x+15>this._maxWidth&&(e.x=0,e.y+=this._font.getFontCommon().lineHeight+this._font.getFontInfo().spacingV,"center"==this._textAlign?this.centerLetters(c,f):"right"==this._textAlign&&this.rightAlignLetters(c,f),f=0,c=[]);32==p&&(g=!0)}this._letters.push(k);h++}}"center"==this._textAlign?this.centerLetters(c,f):"right"==this._textAlign&&this.rightAlignLetters(c,f);this._prevTextValue=this._text},centerLetters:function(a,b){for(var c=this._maxWidth/2,f=a.length,g=0;g<f;){var h=g++,h=a[h];h.setPosition(c-b/2+h.getLocalPosition().x,h.getLocalPosition().y,h.getLocalPosition().z)}},rightAlignLetters:function(a,b){for(var c=this._maxWidth,f=a.length,g=0;g<f;){var h=g++,h=a[h];h.setPosition(c-b+h.getLocalPosition().x,h.getLocalPosition().y,h.getLocalPosition().z)}},getWordAtIndex:function(a){for(var b=this._text.split(" "),c=0,f=0,g=0;g<a;)g++,c++,c>b[f].length&&(c=0,f++);return b[f]},getWordLength:function(a){for(var b=0,c=a.length,f=0;f<c;){var g=f++,h=t.cca(a,g),p=this._font.getCharById(h);null!=p&&(b+=p.xAdvance+this._font.getFontInfo().spacingH,g<c-1&&(g=t.cca(a,g+1),b+=this._font.getKerningSpace(h,g)+this._font.getFontInfo().spacingH))}return b},removeLetters:function(){for(var a=this._letters.length,b=0;b<a;){var c=b++;this._letters[c].destroy()}this._letters=[]},render:function(){b.Component.prototype.render.call(this)},replaceHtmlTextElementById:function(a,c){null==c&&(c=!0);if(b.managers.FontManager.getInstance().getElementHookExists(a))c&&this.getEntity().destroy();else{null!=this._layer&&b.GameManager.instance.removeLayer(this._layer);var d=k.getDocument().getElementById(a);if(null==d)b.utilities.Debug.log("Could not find '"+a+"' on the page!");else{this._isHookedToElement=d;b.managers.FontManager.getInstance().registerElementHook(this._isHookedToElement.id,this);this._text=d.innerHTML;d.style.display="none";var f=new b.Layer("temp",q.parseInt(d.style.width),q.parseInt(d.style.height)+q.parseInt(d.style.top),d.parentElement);this._layer=f;this._layer.getContainer().style.zIndex=d.style.zIndex;b.GameManager.instance.addLayer(f);this._textAlign=d.style.textAlign;this.onDisplayUpdated()}}},onDisplayUpdated:function(){if(null!=this._isHookedToElement){this._layer.getContainer().style.left=Math.ceil(q.parseInt(this._isHookedToElement.style.left))+"px";this._layer.getContainer().style.top=Math.ceil(q.parseInt(this._isHookedToElement.style.top))+"px";null!=this._isHookedToElement.style.webkitTransform?this._layer.getContainer().style.webkitTransform=this._isHookedToElement.style.webkitTransform:null!=this._isHookedToElement.style.transform&&(this._layer.getContainer().style.transform=this._isHookedToElement.style.transform);this._layer.getContainer().style.width=q.parseInt(this._isHookedToElement.style.width)+
"px";this._layer.getContainer().style.height=q.parseInt(this._isHookedToElement.style.height)+q.parseInt(this._isHookedToElement.style.top)+"px";this._layer.getCanvas().style.width=q.parseInt(this._isHookedToElement.style.width)+"px";this._layer.getCanvas().style.height=q.parseInt(this._isHookedToElement.style.height)+q.parseInt(this._isHookedToElement.style.top)+"px";if("none"!=this._isHookedToElement.style.transform&&null!=this._isHookedToElement.style.transform&&("none"==this._layer.getContainer().style.webkitTransform||null==this._layer.getContainer().style.webkitTransform)){var a=this._isHookedToElement.style.transform.split(" ")[0].split(","),c=(new C("^\\D+","g")).replace(a[0],""),c=parseInt(c),a=parseInt(a[1]);this._layer.getContainer().style.left=c+"px";this._layer.getContainer().style.top=a+"px"}this._layer.getCanvas().width=parseInt(this._layer.getCanvas().style.width);this._layer.getCanvas().height=parseInt(this._layer.getCanvas().style.height);this.getEntity().setScale(1/b.GameManager.instance.getScreenScale().x,1/b.GameManager.instance.getScreenScale().y);Math.ceil(q.parseInt(this._isHookedToElement.style.marginLeft));this._maxWidth=Math.ceil(q.parseInt(this._isHookedToElement.style.width));this._forceReinstantiation=!0;this._prevHookLeft=this._isHookedToElement.style.left;this._prevHookTop=this._isHookedToElement.style.top}},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);switch(a){case "onScreenScaleUpdated":this.onDisplayUpdated()}},destroy:function(){b.Component.prototype.destroy.call(this);null!=this._layer&&null!=this._isHookedToElement&&b.GameManager.instance.removeLayer(this._layer);null!=this._isHookedToElement&&b.managers.FontManager.getInstance().unregisterElementHook(this._isHookedToElement.id)},setMaxWidth:function(a){this._maxWidth=a},getMaxWidth:function(){return this._maxWidth},__class__:b.font.FontRender});b.gameStates={};b.gameStates.OrientationState=function(){this._orientationEntity=null;b.GameState.call(this)};b.gameStates.OrientationState.__name__=!0;b.gameStates.OrientationState.__super__=b.GameState;b.gameStates.OrientationState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this)},onOrientationChanged:function(a){b.GameManager.isMobile()&&!b.GameManager.instance.isPhone()?a&&0==b.GameConfig.getProperty("isLandscapeAllowedIPad")?this.showOrientationScreen(1):a||0!=b.GameConfig.getProperty("isPortraitAllowedIPad")?this.hideOrientationScreen():this.showOrientationScreen(0):b.GameManager.isMobile()&&(a&&0==b.GameConfig.getProperty("isLandscapeAllowedIPhone")?this.showOrientationScreen(1):a||0!=b.GameConfig.getProperty("isPortraitAllowedIPhone")?this.hideOrientationScreen():this.showOrientationScreen(0))},showOrientationScreen:function(a){b.utilities.Debug.log("showOrientationScreen()");this.hideOrientationScreen(!1);b.GameManager.instance.stopUpdates();b.managers.InputManager.getInstance().setInputDisabled(!0);b.managers.SoundManager.pauseAllSounds();switch(a){case 0:this._orientationEntity=this.addEntity();b.GameManager.instance.isPhone()?new b.components.HtmlElements(this._orientationEntity,b.GameManager.instance.getLayerByName("orientation"),b.managers.AssetManager.getAsset("iphoneLandscapeHtml")):new b.components.HtmlElements(this._orientationEntity,b.GameManager.instance.getLayerByName("orientation"),b.managers.AssetManager.getAsset("ipadLandscapeHtml"));break;case 1:this._orientationEntity=this.addEntity(),b.GameManager.instance.isPhone()?new b.components.HtmlElements(this._orientationEntity,b.GameManager.instance.getLayerByName("orientation"),b.managers.AssetManager.getAsset("iphonePortraitHtml")):new b.components.HtmlElements(this._orientationEntity,b.GameManager.instance.getLayerByName("orientation"),b.managers.AssetManager.getAsset("ipadPortraitHtml"))}},hideOrientationScreen:function(a){null==a&&(a=!0);b.utilities.Debug.log("hideOrientationScreen()");null!=this._orientationEntity&&(this._orientationEntity.destroy(),this._orientationEntity=null);a&&(b.GameManager.instance.resumeUpdates(),b.managers.InputManager.getInstance().setInputDisabled(!1),b.managers.SoundManager.resumeAllSounds())},handleMessage:function(a,c){b.GameState.prototype.handleMessage.call(this,a,c);switch(a){case "onOrientationChanged":this.onOrientationChanged(c.isHorizontal)}},__class__:b.gameStates.OrientationState});b.managers={};b.managers.AccelerometerManager=function(){b.Manager.call(this);b.managers.AccelerometerManager._instance=this};b.managers.AccelerometerManager.__name__=!0;b.managers.AccelerometerManager.getInstance=function(){return b.managers.AccelerometerManager._instance};b.managers.AccelerometerManager.__super__=b.Manager;b.managers.AccelerometerManager.prototype=m(b.Manager.prototype,{getLeftToRight:function(){return this._leftToRight},getTopToBottom:function(){return this._topToBottom},getRotationDegrees:function(){return this._rotationDegrees},init:function(){var a=this;b.Manager.prototype.init.call(this);k.getWindow().addEventListener("deviceorientation",function(b){a.onDeviceOrientationChange(b.alpha,b.gamma,b.beta)})},onDeviceOrientationChange:function(a,b,c){this._leftToRight=b;this._topToBottom=c;this._rotationDegrees=a},__class__:b.managers.AccelerometerManager});b.managers.AnimationManager=function(){this._animations=new u.ds.StringMap};b.managers.AnimationManager.__name__=!0;b.managers.AnimationManager.getInstance=function(){null==b.managers.AnimationManager._instance&&(b.managers.AnimationManager._instance=new b.managers.AnimationManager);return b.managers.AnimationManager._instance};b.managers.AnimationManager.prototype={getAnimationByName:function(a){return this._animations.get(a)},registerAnimation:function(a){var b=a.getName();this._animations.set(b,a)},__class__:b.managers.AnimationManager};b.managers.AssetManager=function(){};b.managers.AssetManager.__name__=!0;b.managers.AssetManager.outputAssets=function(){b.utilities.Debug.log(b.managers.AssetManager.assetList)};b.managers.AssetManager.getAsset=function(a){return b.managers.AssetManager.assetList.exists(a)?b.managers.AssetManager.assetList.get(a):(b.utilities.Debug.log(a+" does not exist in asset list!"),null)};b.managers.AssetManager.assetExists=function(a){return b.managers.AssetManager.assetList.exists(a)};b.managers.AssetManager.unloadAsset=function(a){b.managers.AssetManager.assetList.set(a,null);b.managers.AssetManager.assetList.remove(a)};b.managers.AssetManager.unloadLoadBatch=function(a){b.managers.AssetManager.getAsset(a).unload()};b.managers.AssetManager.registerAsset=function(a,c,d){null==d&&(d=!0);b.managers.AssetManager.assetList.exists(a)&&!d||b.managers.AssetManager.assetList.set(a,c)};b.managers.AssetManager.prototype={__class__:b.managers.AssetManager};b.managers.DebugManager=function(){b.Manager.call(this);b.managers.DebugManager._instance=this};b.managers.DebugManager.__name__=!0;b.managers.DebugManager.getInstance=function(){return b.managers.DebugManager._instance};b.managers.DebugManager.__super__=b.Manager;b.managers.DebugManager.prototype=m(b.Manager.prototype,{update:function(){b.Manager.prototype.update.call(this);"1"==b.GameConfig.getProperty("debugCheats")&&(b.managers.InputManager.getInstance().isKeyPressed(104)&&b.GameConfig.setProperty("debugDraw","1"==b.GameConfig.getProperty("debugDraw")?"0":"1"),b.managers.InputManager.getInstance().isKeyPressed(101)&&this.dispatchEvent(new b.managers.DebugManagerEvent("beatLevel")),b.managers.InputManager.getInstance().isKeyPressed(102)&&this.dispatchEvent(new b.managers.DebugManagerEvent("failLevel")),b.managers.InputManager.getInstance().isKeyPressed(100)&&c.GameTracker.getInstance().getSaveData().setItem("tutorialComplete",!1))},destroy:function(){b.Manager.prototype.destroy.call(this);b.managers.DebugManager._instance=null},__class__:b.managers.DebugManager});b.managers.DebugManagerEvent=function(a){b.events.Event.call(this,a)};b.managers.DebugManagerEvent.__name__=!0;b.managers.DebugManagerEvent.__super__=b.events.Event;b.managers.DebugManagerEvent.prototype=m(b.events.Event.prototype,{__class__:b.managers.DebugManagerEvent});b.managers.FontManager=function(){this._fonts=null;b.Manager.call(this);this._fonts=[];b.managers.FontManager._instance=this};b.managers.FontManager.__name__=!0;b.managers.FontManager.getInstance=function(){return b.managers.FontManager._instance};b.managers.FontManager.__super__=b.Manager;b.managers.FontManager.prototype=m(b.Manager.prototype,{registerFont:function(a){this.getHasFont(a)||this._fonts.push(a)},unregisterFont:function(a){t.remove(this._fonts,a)},getHasFont:function(a){for(var b=this._fonts.length,c=0;c<b;){var f=c++;if(a==this._fonts[f])return!0}return!1},registerElementHook:function(a,c){b.managers.FontManager._elementHookMap.set(a,c)},getFontRenderByHookElementId:function(a){return b.managers.FontManager._elementHookMap.get(a)},getElementHookExists:function(a){return b.managers.FontManager._elementHookMap.exists(a)},unregisterElementHook:function(a){b.managers.FontManager._elementHookMap.remove(a)},getFontByName:function(a){for(var b=this._fonts.length,c=0;c<b;){var f=c++,f=this._fonts[f];if(f.getName()==a)return f}return null},__class__:b.managers.FontManager});b.managers.InputManager=function(){this._keysDown=this._keysPressedThisFrame=null;this._isInputDisabled=this._isLeftMouseDown=!1;this._mousePosition=null;b.Manager.call(this);b.managers.InputManager._instance=this;this._mousePosition=new b.Vector2D(0,0);this._keysDown=[];this._keysPressedThisFrame=[];for(var a=0;255>a;)a++,this._keysDown.push(!1),this._keysPressedThisFrame.push(!1)};b.managers.InputManager.__name__=!0;b.managers.InputManager.getInstance=function(){return b.managers.InputManager._instance};b.managers.InputManager.__super__=b.Manager;b.managers.InputManager.prototype=m(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this);k.getWindow().addEventListener("mousemove",l(this,this.onMouseMoved));k.getWindow().addEventListener("mousedown",l(this,this.onMouseDown));k.getWindow().addEventListener("mouseup",l(this,this.onMouseUp));k.getWindow().addEventListener("mouseleave",l(this,this.onMouseLeave));k.getWindow().addEventListener("mouseout",l(this,this.onMouseOut));k.getDocument().addEventListener("keydown",l(this,this.onKeyDown));k.getDocument().addEventListener("keyup",l(this,this.onKeyUp));k.getDocument().addEventListener("keypress",l(this,this.onKeyPressed));k.getWindow().addEventListener("click",l(this,this.onMouseClick));document.addEventListener("touchstart",l(this,this.onMouseDown));document.addEventListener("touchend",l(this,this.onMouseUp));document.addEventListener("touchmove",l(this,this.onMouseMoved))},update:function(){b.Manager.prototype.update.call(this)},postUpdate:function(){b.Manager.prototype.postUpdate.call(this);for(var a=this._keysPressedThisFrame.length,c=0;c<a;){var d=c++;this._keysPressedThisFrame[d]=!1}b.components.Button.setMouseOverThisFrame(!1);b.components.Draggable.setReleaseDraggablesNextFrame(!1)},getMousePosition:function(){var a=b.GameManager.instance.getScreenOffset();return new b.Vector2D((this._mousePosition.x-a.x)/b.GameManager.instance.getScreenScale().x,(this._mousePosition.y-a.y)/b.GameManager.instance.getScreenScale().y)},onMouseMoved:function(a){if(!this._isInputDisabled)if(b.GameManager.isMobile()){for(var c=a.changedTouches,d=c.length,f=0;f<d;){var g=f++,h=c[g],g=h.pageX-k.getContainer().offsetParent.offsetLeft,h=h.pageY-k.getContainer().offsetParent.offsetTop;this._mousePosition.x=g;this._mousePosition.y=h;b.GameManager.instance.sendGlobalMessage("mouseMove",this.getMousePosition())}b.GameManager.instance.sendGlobalMessage("verifyTouches",a)}else c=a.pageX-k.getContainer().offsetParent.offsetLeft,a=a.pageY-k.getContainer().offsetParent.offsetTop,this._mousePosition.x=c,this._mousePosition.y=a,b.GameManager.instance.sendGlobalMessage("mouseMove",this.getMousePosition())},onMouseDown:function(a){b.GameManager.instance.hideAddressBar();if(!this._isInputDisabled)if(b.GameManager.isMobile()){this._isLeftMouseDown=!0;var c=a.changedTouches;a=c.length;for(var d=0;d<a;){var f=d++,g=c[f],f=g.pageX-k.getContainer().offsetParent.offsetLeft,g=g.pageY-k.getContainer().offsetParent.offsetTop;this._mousePosition.x=f;this._mousePosition.y=g;b.GameManager.instance.sendGlobalMessage("mouseDown",this.getMousePosition())}}else this._isLeftMouseDown=!0,c=a.pageX-k.getContainer().offsetParent.offsetLeft,a=a.pageY-k.getContainer().offsetParent.offsetTop,this._mousePosition.x=c,this._mousePosition.y=a,b.GameManager.instance.sendGlobalMessage("mouseDown",this.getMousePosition())},onMouseUp:function(a){if(!this._isInputDisabled){if(b.GameManager.isMobile())0==a.touches.length&&(this._isLeftMouseDown=!1);else{this._isLeftMouseDown=!1;var c;c=a.pageX-k.getContainer().offsetParent.offsetLeft;a=a.pageY-k.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a}b.GameManager.instance.sendGlobalMessage("mouseUp",this.getMousePosition())}},onMouseClick:function(a){if(!this._isInputDisabled){var c=a.pageX-k.getContainer().offsetParent.offsetLeft;a=a.pageY-k.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a;b.GameManager.instance.sendGlobalMessage("mouseClick",this.getMousePosition())}},onMouseLeave:function(a){if(!this._isInputDisabled){var c=a.pageX-k.getContainer().offsetParent.offsetLeft;a=a.pageY-k.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a;b.GameManager.instance.sendGlobalMessage("mouseLeave",this.getMousePosition())}},onMouseOut:function(a){if(!this._isInputDisabled){var c=a.pageX-k.getContainer().offsetParent.offsetLeft;a=a.pageY-k.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a;b.GameManager.instance.sendGlobalMessage("mouseOut",this.getMousePosition())}},onKeyDown:function(a){a.stopPropagation();this._isInputDisabled||this._keysDown[a.keyCode]||(this._keysDown[a.keyCode]=!0,this._keysPressedThisFrame[a.keyCode]=!0,b.GameManager.instance.sendGlobalMessage("keyDown",a.keyCode))},onKeyUp:function(a){this._isInputDisabled||(this._keysDown[a.keyCode]=!1,b.GameManager.instance.sendGlobalMessage("keyUp",a.keyCode))},onKeyPressed:function(a){a.stopPropagation();this._isInputDisabled||b.GameManager.instance.sendGlobalMessage("keyPressed",a.keyCode)},disablePageKeyPresses:function(){document.onkeydown=function(a){a.preventDefault();return!1}},enablePageKeyPresses:function(){document.onkeydown=null},getInputDisabled:function(){return this._isInputDisabled},setInputDisabled:function(a){this._isInputDisabled=a},isKeyDown:function(a){return this._keysDown[a]},isKeyPressed:function(a){return this._keysPressedThisFrame[a]},isLeftMouseDown:function(){return this._isLeftMouseDown},__class__:b.managers.InputManager});b.managers.PhysicsEvent=function(){};b.managers.PhysicsEvent.__name__=!0;b.managers.PhysicsEvent.prototype={__class__:b.managers.PhysicsEvent};b.managers.PhysicsManager=function(){this._colliders=this._raycastsThisFrame=null;b.Manager.call(this);b.managers.PhysicsManager._instance=this;this._raycastsThisFrame=[];this._colliders=[];this.addEventListener("raycastCheck",l(this,this.onRaycastCheck))};b.managers.PhysicsManager.__name__=!0;b.managers.PhysicsManager.getInstance=function(){return b.managers.PhysicsManager._instance};b.managers.PhysicsManager.createBoxColliderEntity=function(a,c,d,f,g,h,p,n){null==n&&(n=!0);h=h.addEntity();h.setPosition(a,c,d);d=new b.collision.BoxCollision;d.ul=new b.Vector2D(a,c);d.wh=new b.Vector2D(f,g);a=new b.components.colliders.BoxCollider(h,d,n?new b.Vector3D:new b.Vector3D(0.5*d.wh.x,0.5*d.wh.y));if(null!=p)for(c=p.length,f=0;f<c;)g=f++,a.addTag(p[g]);return h};b.managers.PhysicsManager.createBoxCollider=function(a,c,d,f,g,h,p){null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);var n=new b.collision.BoxCollision;n.wh=new b.Vector2D(c,d);a=new b.components.colliders.BoxCollider(a,n,new b.Vector3D(f,g,h));if(null!=p)for(c=p.length,d=0;d<c;)f=d++,a.addTag(p[f]);return a};b.managers.PhysicsManager.__super__=b.Manager;b.managers.PhysicsManager.prototype=m(b.Manager.prototype,{update:function(){b.Manager.prototype.update.call(this)},registerCollider:function(a){for(var b=this._colliders.length,c=0;c<b;){var f=c++;if(this._colliders[f]==a)return}this._colliders.push(a)},removeCollider:function(a){for(var b=this._colliders.length,c=0;c<b;){var f=c++;if(this._colliders[f]==a){this._colliders.splice(f,1);break}}},getColliders:function(){return this._colliders},getRaycastPoint:function(a,c,d,f,g){null==f&&(f=!0);for(var h=-1,p=null,n=null,k=0,l=0,m=this._colliders.length,q=0;q<m;){var s=q++;l++;s=this._colliders[s];if(!1!=s.getIsActive()){if(null!=g){for(var u=!1,w=g.length,v=0;v<w;){var x=v++;if(s.hasTag(g[x])){u=!0;break}}if(!u)continue}k++;u=new b.Vector2D;if(f){if(w=new b.Vector2D,v=s.getRaycastPoint(a,c,u,f,w),-1==h&&0<v||0<v&&v<h)d.distance=v,d.collider=s,d.collisionPoint=u,n=d.normal=w,p=u,h=v,t.remove(this._colliders,s),this._colliders.unshift(s)}else if(w=new b.Vector2D,v=s.getRaycastPoint(a,c,u,f,w),0<v){d.distance=v;d.collider=s;d.collisionPoint=u;n=d.normal=w;p=u;h=v;t.remove(this._colliders,s);this._colliders.unshift(s);break}}}this._raycastsThisFrame.push({start:a,end:c,hitPoint:p,normal:n});return h},debugRender:function(){b.Manager.prototype.debugRender.call(this);for(var a=this._raycastsThisFrame.length,c=0;c<a;){var d=c++,f=this._raycastsThisFrame[d],g=f.start,h=f.end,d=f.hitPoint,p=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");p.save();if(null!=b.components.Camera.getDebugCamera()){var n=b.components.Camera.getDebugCamera().getEntity(),k=b.components.Camera.getDebugCamera().getZoomScale();p.translate(-n.getPosition().x*k,-n.getPosition().y*k);p.scale(k,k)}null==d?(p.beginPath(),p.globalAlpha=1,p.lineWidth=1,p.strokeStyle="#AAAAFF",p.moveTo(g.x,g.y),p.lineTo(h.x,h.y),p.stroke()):(p.beginPath(),p.globalAlpha=1,p.lineWidth=1,p.strokeStyle="#AAAAFF",p.moveTo(g.x,g.y),p.lineTo(d.x,d.y),p.stroke(),p.beginPath(),p.globalAlpha=1,p.lineWidth=1,p.strokeStyle="#FFFF00",p.moveTo(d.x,d.y),p.lineTo(h.x,h.y),p.stroke(),null!=f.normal&&(g=(new b.Vector2D(h.x-d.x,h.y-d.y)).getLength(),f=new b.Vector2D(d.x+f.normal.x*g,d.y+f.normal.y*g),p.beginPath(),p.globalAlpha=1,p.lineWidth=1,p.strokeStyle="#FF00FF",p.moveTo(d.x,d.y),p.lineTo(f.x,f.y),p.stroke()));p.restore()}this._raycastsThisFrame=[]},destroyAllColliders:function(){for(var a=this._colliders.length-1;0<=a;)this.removeCollider(this._colliders[a]),a--;this._colliders=[]},onRaycastCheck:function(a){this._raycastsThisFrame.push({start:a.start,end:a.end})},__class__:b.managers.PhysicsManager});b.managers.SoundManager=function(){};b.managers.SoundManager.__name__=!0;b.managers.SoundManager.init=function(){if(b.GameManager.isMobile())b.managers.SoundManager._audioContext=window.audioContextInstance,b.managers.SoundManager._isWebkitEnabled=null!=window.audioContextInstance;else try{b.GameManager.isSafari()?b.managers.SoundManager._useFlashSound=!1:soundManager.setup({url:"soundmanager2_flash9.swf",flashVersion:9,onready:b.managers.SoundManager.onSoundManagerReady,ontimeout:b.managers.SoundManager.onSoundManagerTimeout,useHighPerformance:!0})}catch(a){if(w.Boot.__instanceof(a,String))b.managers.SoundManager._useFlashSound=!1;else throw a;}b.managers.SoundManager._musicTrack=new b.utilities.WatchableValue(null)};b.managers.SoundManager.onSoundManagerReady=function(){b.managers.SoundManager._useFlashSound=!1};b.managers.SoundManager.onSoundManagerTimeout=function(){b.managers.SoundManager._useFlashSound=!1};b.managers.SoundManager.onSwfLoaded=function(a){b.utilities.Debug.log("onSwfLoaded()")};b.managers.SoundManager.getAudioContextInstance=function(){return b.managers.SoundManager._audioContext};b.managers.SoundManager.getIsWebkitEnabled=function(){return b.managers.SoundManager._isWebkitEnabled&&!b.managers.SoundManager._useFlashSound};b.managers.SoundManager.setIsWebkitEnabled=function(a){b.managers.SoundManager._isWebkitEnabled=a};b.managers.SoundManager.getMusicMuted=function(){return b.managers.SoundManager._musicMuted};b.managers.SoundManager.setMusicMuted=function(a){b.managers.SoundManager._musicMuted=a;b.managers.SoundManager.setMusicVolume(b.managers.SoundManager._musicVolume);b.managers.SoundManager.getIsWebkitEnabled()||(b.GameManager.isMobile()&&a?b.managers.SoundManager._musicTrack.get().pause():b.GameManager.isMobile()&&!a&&b.managers.SoundManager._musicTrack.get().play())};b.managers.SoundManager.getSoundMuted=function(){return b.managers.SoundManager._soundMuted};b.managers.SoundManager.setSoundMuted=function(a){b.managers.SoundManager._soundMuted=a;b.managers.SoundManager.setSoundVolume(b.managers.SoundManager._soundVolume)};b.managers.SoundManager.getMasterVolume=function(){return b.managers.SoundManager._masterVolume};b.managers.SoundManager.setMasterVolume=function(a){b.managers.SoundManager._masterVolume=a;b.managers.SoundManager.setMusicVolume(b.managers.SoundManager._musicVolume);b.managers.SoundManager.setSoundVolume(b.managers.SoundManager._soundVolume)};b.managers.SoundManager.getMusicVolume=function(){return b.managers.SoundManager.getMusicMuted()?0:b.managers.SoundManager._musicVolume};b.managers.SoundManager.setMusicVolume=function(a){b.managers.SoundManager._musicVolume=a;null!=b.managers.SoundManager._musicTrack&&null!=b.managers.SoundManager._musicTrack.get()&&b.managers.SoundManager._musicTrack.get().setVolume(b.managers.SoundManager._musicMuted?0:b.managers.SoundManager.getMusicVolume()*b.managers.SoundManager.getMasterVolume())};b.managers.SoundManager.getSoundVolume=function(){return b.managers.SoundManager.getSoundMuted()?0:b.managers.SoundManager._soundVolume};b.managers.SoundManager.setSoundVolume=function(a){b.managers.SoundManager._soundVolume=a;a=b.managers.SoundManager._soundsPlaying.length;for(var c=0;c<a;){var d=c++;b.managers.SoundManager._soundsPlaying[d].setVolume(b.managers.SoundManager._soundMuted?0:b.managers.SoundManager.getSoundVolume()*b.managers.SoundManager.getMasterVolume())}};b.managers.SoundManager.playSoundByName=function(a,c,d){null==d&&(d=!1);null==c&&(c=!1);if(!b.managers.SoundManager.getIsWebkitEnabled()&&b.GameManager.isMobile()&&!c||!b.managers.AssetManager.assetExists(a))return null;a=b.managers.SoundManager.getIsWebkitEnabled()?new b.audio.WebkitSoundData(a,b.managers.SoundManager.getSoundVolume()*b.managers.SoundManager.getMasterVolume(),d):b.managers.SoundManager.getUseFlashSound()?new b.audio.FlashSoundData(a,b.managers.SoundManager.getMasterVolume()*b.managers.SoundManager.getSoundVolume(),d):new b.audio.Html5SoundData(a,b.managers.SoundManager.getMasterVolume()*b.managers.SoundManager.getSoundVolume(),d);a.play();b.managers.SoundManager._soundsPlaying.push(a);return a};b.managers.SoundManager.update=function(){for(var a=b.managers.SoundManager._soundsPlaying.length,c=0;c<a;){var d=c++,d=b.managers.SoundManager._soundsPlaying[d];null!=d&&d.update()}};b.managers.SoundManager.onSoundComplete=function(a){b.managers.SoundManager.removeSoundFromPlayingSounds(a.currentTarget)};b.managers.SoundManager.removeSoundFromPlayingSounds=function(a){t.remove(b.managers.SoundManager._soundsPlaying,a)};b.managers.SoundManager.pauseAllSounds=function(){null!=b.managers.SoundManager._musicTrack.get()&&b.managers.SoundManager._musicTrack.get().pause();for(var a=b.managers.SoundManager._soundsPlaying.length,c=0;c<a;){var d=c++;b.managers.SoundManager._soundsPlaying[d].pause()}};b.managers.SoundManager.resumeAllSounds=function(){for(var a=b.managers.SoundManager._soundsPlaying.length,c=[].concat(b.managers.SoundManager._soundsPlaying),d=0;d<a;){var f=d++;c[f].resume()}null!=b.managers.SoundManager._musicTrack.get()&&b.managers.SoundManager._musicTrack.get().resume()};b.managers.SoundManager.playMusicByNameOnMobileOnly=function(a){return b.GameManager.isMobile()?b.managers.SoundManager.playMusicByName(a,!0):null};b.managers.SoundManager.playMusicByName=function(a,c){null==c&&(c=!0);if(b.GameManager.isMobile()&&!c)return null;if(!b.managers.AssetManager.assetExists(a))return b.utilities.Debug.log(a+" doesn't exist!"),null;null!=b.managers.SoundManager._musicTrack&&null!=b.managers.SoundManager._musicTrack.get()&&b.managers.SoundManager._musicTrack.get().stop();var d;b.managers.SoundManager.getIsWebkitEnabled()?(d=new b.audio.WebkitSoundData(a,b.managers.SoundManager.getMasterVolume()*b.managers.SoundManager.getMusicVolume(),!0),d.play(0),b.managers.SoundManager._musicTrack.set(d)):b.managers.SoundManager._useFlashSound?(d=new b.audio.FlashSoundData(a,b.managers.SoundManager.getMusicVolume()*b.managers.SoundManager.getMasterVolume(),!0),d.play(),b.managers.SoundManager._musicTrack.set(d)):(b.managers.SoundManager._musicTrack.set(new b.audio.Html5SoundData(a,b.managers.SoundManager.getMasterVolume()*b.managers.SoundManager.getMusicVolume(),!0)),b.managers.SoundManager._musicTrack.get().play(),d=b.managers.SoundManager._musicTrack);b.managers.SoundManager.setMusicVolume(b.managers.SoundManager._musicVolume);return d};b.managers.SoundManager.stopMusic=function(){null!=b.managers.SoundManager._musicTrack&&null!=b.managers.SoundManager._musicTrack.get()&&b.managers.SoundManager._musicTrack.get().stop()};b.managers.SoundManager.stopAllSounds=function(){for(var a=b.managers.SoundManager._soundsPlaying.length-1;0<=a;){var c=b.managers.SoundManager._soundsPlaying[a];c.stop();b.managers.SoundManager.removeSoundFromPlayingSounds(c);a--}b.managers.SoundManager._soundsPlaying=[]};b.managers.SoundManager.getUseFlashSound=function(){return b.managers.SoundManager._useFlashSound};b.managers.SoundManager.getFlashObject=function(){return b.managers.SoundManager._flashObject};b.managers.SoundManager.prototype={__class__:b.managers.SoundManager};b.managers.VoManager=function(){this._isCurrentVoLocked=!1;this._voTrack=null;b.Manager.call(this);b.managers.VoManager._instance=this};b.managers.VoManager.__name__=!0;b.managers.VoManager.getInstance=function(){return b.managers.VoManager._instance};b.managers.VoManager.__super__=b.Manager;b.managers.VoManager.prototype=m(b.Manager.prototype,{playVo:function(a,c,d,f){null==f&&(f=!1);null==d&&(d=!1);null==c&&(c=!1);if(!this._isCurrentVoLocked||c)this.stopVo(),this._voTrack=b.managers.SoundManager.playSoundByName(a,d,f),c&&(b.GameManager.instance.invokeAsyncDeferredAction(this._voTrack.getSoundLength(),l(this,this.onHighPrioritySoundElapse)),this._isCurrentVoLocked=!0)},onHighPrioritySoundElapse:function(){this._isCurrentVoLocked=!1},stopVo:function(){null!=this._voTrack&&(this._voTrack.stop(),this._voTrack=null)},__class__:b.managers.VoManager});b.screenTransition={};b.screenTransition.TransitionScreen=function(a,c,d){null==d&&(d=!0);b.GameState.call(this);this._from=a;this._to=c;this._destroyFrom=d};b.screenTransition.TransitionScreen.__name__=!0;b.screenTransition.TransitionScreen.__super__=b.GameState;b.screenTransition.TransitionScreen.prototype=m(b.GameState.prototype,{onTransitionMidpoint:function(){this._destroyFrom&&this._from.destroy();b.GameManager.instance.addGameState(this._to);this.dispatchEvent(new b.screenTransition.TransitionScreenEvent("midpoint"))},onTransitionComplete:function(){this.destroy();this.dispatchEvent(new b.screenTransition.TransitionScreenEvent("complete"))},__class__:b.screenTransition.TransitionScreen});b.screenTransition.TransitionScreenEvent=function(a){b.events.Event.call(this,a)};b.screenTransition.TransitionScreenEvent.__name__=!0;b.screenTransition.TransitionScreenEvent.__super__=b.events.Event;b.screenTransition.TransitionScreenEvent.prototype=m(b.events.Event.prototype,{__class__:b.screenTransition.TransitionScreenEvent});b.speechManager={};b.speechManager.Dialogue=function(a){this.soundName=a;this.subtitles=[]};b.speechManager.Dialogue.__name__=!0;b.speechManager.Dialogue.prototype={__class__:b.speechManager.Dialogue};b.speechManager.SpeechManager=function(a,c){null==c&&(c=!0);null==a&&(a=!0);this._voTrack=this._speechMap=this._currentDeferredActions=null;b.Manager.call(this);this._speechMap=new b.speechManager.SpeechMap;this._voiceOversEnabled=a;this._subtitlesEnabled=c;this._currentDeferredActions=[];b.speechManager.SpeechManager._instance=this};b.speechManager.SpeechManager.__name__=!0;b.speechManager.SpeechManager.getInstance=function(){return b.speechManager.SpeechManager._instance};b.speechManager.SpeechManager.__super__=b.Manager;b.speechManager.SpeechManager.prototype=m(b.Manager.prototype,{getVoiceOversEnabled:function(){return this._voiceOversEnabled},setVoiceOversEnabled:function(a){this._voiceOversEnabled=a},getSubtitlesEnabled:function(){return this._subtitlesEnabled},setSubtitlesEnabled:function(a){this._subtitlesEnabled=a},init:function(){b.Manager.prototype.init.call(this)},setup:function(){this.parseSpeechMap()},parseSpeechMap:function(){for(var a=s.parse(b.managers.AssetManager.getAsset("speechMap")).elementsNamed("speech_map").next().elementsNamed("dialogue");a.hasNext();){for(var c=a.next(),d=new b.speechManager.Dialogue(c.get("soundName")),c=c.elementsNamed("subtitle");c.hasNext();){var f=c.next(),g=new b.speechManager.Subtitle(f.get("stringId"),q.parseFloat(f.get("time")),q.parseFloat(f.get("duration")));b.utilities.Debug.log(q.parseFloat(f.get("duration")));d.subtitles.push(g)}this._speechMap.dialogue.push(d)}},stopVo:function(){null!=this._voTrack&&(this._voTrack.stop(),this._voTrack=null)},playVo:function(a){var c=this;null!=this._voTrack&&this.stopVo();if("0"==b.GameConfig.getProperty("speechMode")||"2"==b.GameConfig.getProperty("speechMode"))this._voTrack=b.managers.SoundManager.playSoundByName(a);if("1"==b.GameConfig.getProperty("speechMode")||"2"==b.GameConfig.getProperty("speechMode")){var d=this._speechMap.getDialogueBySoundName(a);if(null!=d){for(;0<this._currentDeferredActions.length;)a=this._currentDeferredActions.pop(),b.GameManager.instance.destroyDeferredAction(a);a=d.subtitles.length;for(var f=0;f<a;){var g=f++,g=[d.subtitles[g]];this._currentDeferredActions.push(b.GameManager.instance.invokeAsyncDeferredAction(g[0].time,function(a){return function(){c.dispatchSubtitle(a[0])}}(g)))}}else b.utilities.Debug.log("WARNING: '"+
a+"' has no subtitles.")}return this._voTrack},dispatchSubtitle:function(a){b.utilities.Debug.log(b.Localizer.getString(a.stringId));this.dispatchEvent(new b.speechManager.SubtitleEvent("showSubtitle",a.duration,b.Localizer.getString(a.stringId)))},__class__:b.speechManager.SpeechManager});b.speechManager.SpeechMap=function(){this.dialogue=[]};b.speechManager.SpeechMap.__name__=!0;b.speechManager.SpeechMap.prototype={getDialogueBySoundName:function(a){for(var b=this.dialogue.length,c=0;c<b;){var f=c++;if(this.dialogue[f].soundName==a)return this.dialogue[f]}return null},__class__:b.speechManager.SpeechMap};b.speechManager.Subtitle=function(a,b,c){this.stringId=a;this.time=b;this.duration=c};b.speechManager.Subtitle.__name__=!0;b.speechManager.Subtitle.prototype={__class__:b.speechManager.Subtitle};b.speechManager.SubtitleEvent=function(a,c,d){this._duration=0;b.events.Event.call(this,a);this._duration=c;this._subtitleText=d};b.speechManager.SubtitleEvent.__name__=!0;b.speechManager.SubtitleEvent.__super__=b.events.Event;b.speechManager.SubtitleEvent.prototype=m(b.events.Event.prototype,{getDuration:function(){return this._duration},getSubtitleText:function(){return this._subtitleText},__class__:b.speechManager.SubtitleEvent});b.spriteSheets={};b.spriteSheets.SpriteInfo=function(a,c,d,f){this._name=a;this._coords=c.getClone();this._spriteSheetName=d;null==f||Math.isNaN(f.x)&&Math.isNaN(f.y)?this._offset=new b.Vector2D:this._offset=new b.Vector2D(f.x,f.y)};b.spriteSheets.SpriteInfo.__name__=!0;b.spriteSheets.SpriteInfo.prototype={getCoords:function(){return this._coords},setOffset:function(a,b){this._offset.x=a;this._offset.y=b},getOffset:function(){return this._offset},getSpriteSheetName:function(){return this._spriteSheetName},getName:function(){return this._name},__class__:b.spriteSheets.SpriteInfo};b.spriteSheets.SpriteSheet=function(a,c){this._image=null;this._spriteInfo=[];this._spriteInfoHashTable=new u.ds.StringMap;this._name=a;null==c?this._imageName=a:(this._imageName=c,this._image=b.managers.AssetManager.getAsset(this._imageName))};b.spriteSheets.SpriteSheet.__name__=!0;b.spriteSheets.SpriteSheet.parseFromXmlString=function(a,c,d){d=s.parse(d);c=new b.spriteSheets.SpriteSheet(a,c);for(d=d.elementsNamed("TextureAtlas").next().elementsNamed("sprite");d.hasNext();){var f=d.next(),f=new b.spriteSheets.SpriteInfo(f.get("n"),new b.Rect2D(f.get("x"),f.get("y"),f.get("w"),f.get("h")),a,new b.Vector2D(q.parseFloat(f.get("oX")),q.parseFloat(f.get("oY"))));c.addSpriteInfo(f)}b.spriteSheets.SpriteSheetManager.getInstance().registerSpriteSheet(c);return c};b.spriteSheets.SpriteSheet.prototype={getNumSprites:function(){return this._spriteInfo.length},getName:function(){return this._name},getImage:function(){return this._image},getImageName:function(){return this._imageName},addSpriteInfo:function(a){this._spriteInfo.push(a);var b=a.getName();this._spriteInfoHashTable.set(b,a)},getSpriteInfoByIndex:function(a){return this._spriteInfo[a]},getSpriteInfoByName:function(a){return this._spriteInfoHashTable.get(a)},addToAllOffsets:function(a,b){for(var c=this._spriteInfo.length,f=0;f<c;){var g=f++,g=this._spriteInfo[g];g.setOffset(g.getOffset().x+a,g.getOffset().y+b)}},__class__:b.spriteSheets.SpriteSheet};b.spriteSheets.SpriteSheetManager=function(){this._spriteSheets=new u.ds.StringMap};b.spriteSheets.SpriteSheetManager.__name__=!0;b.spriteSheets.SpriteSheetManager.getInstance=function(){null==b.spriteSheets.SpriteSheetManager._instance&&(b.spriteSheets.SpriteSheetManager._instance=new b.spriteSheets.SpriteSheetManager);return b.spriteSheets.SpriteSheetManager._instance};b.spriteSheets.SpriteSheetManager.createSpriteSheetFromGrid=function(a,c,d,f,g){var h=b.managers.AssetManager.getAsset(a),p=Math.floor(h.width/d),h=Math.floor(h.height/f);c=new b.spriteSheets.SpriteSheet(a,c);for(var n=0;n<h;)for(var k=n++,l=0;l<p;){var m=l++,m=new b.spriteSheets.SpriteInfo(a+m+"-"+k,new b.Rect2D(m*d,k*f,d,f),a,g);c.addSpriteInfo(m)}b.spriteSheets.SpriteSheetManager.getInstance().registerSpriteSheet(c)};b.spriteSheets.SpriteSheetManager.prototype={addToAllSpriteSheetOffsets:function(a,b,c){this.getSpriteSheetByName(a).addToAllOffsets(b,c)},getSpriteSheetByName:function(a){return this._spriteSheets.get(a)},registerSpriteSheet:function(a){var b=a.getName();this._spriteSheets.set(b,a)},__class__:b.spriteSheets.SpriteSheetManager};b.tmx={};b.tmx.LevelEvents=function(){};b.tmx.LevelEvents.__name__=!0;b.tmx.LevelEvents.prototype={__class__:b.tmx.LevelEvents};b.ui={};b.ui.UiElementHorizontalAlignment={__ename__:!0,__constructs__:["Left","Center","Right"]};b.ui.UiElementHorizontalAlignment.Left=["Left",0];b.ui.UiElementHorizontalAlignment.Left.__enum__=b.ui.UiElementHorizontalAlignment;b.ui.UiElementHorizontalAlignment.Center=["Center",1];b.ui.UiElementHorizontalAlignment.Center.__enum__=b.ui.UiElementHorizontalAlignment;b.ui.UiElementHorizontalAlignment.Right=["Right",2];b.ui.UiElementHorizontalAlignment.Right.__enum__=b.ui.UiElementHorizontalAlignment;b.ui.UiElementVerticalAlignment={__ename__:!0,__constructs__:["Top","Center","Bottom"]};b.ui.UiElementVerticalAlignment.Top=["Top",0];b.ui.UiElementVerticalAlignment.Top.__enum__=b.ui.UiElementVerticalAlignment;b.ui.UiElementVerticalAlignment.Center=["Center",1];b.ui.UiElementVerticalAlignment.Center.__enum__=b.ui.UiElementVerticalAlignment;b.ui.UiElementVerticalAlignment.Bottom=["Bottom",2];b.ui.UiElementVerticalAlignment.Bottom.__enum__=b.ui.UiElementVerticalAlignment;b.ui.UiElement=function(a,c){this._updateEveryFrame=!0;this._positionDirty=this._pixelPerfect=!1;this._uiPanel=this._coords=this._size=this._scale=null;b.Component.call(this,a,"UiElement");this.setUiPanel(c);this._coords=new b.Vector2D(0,0);this._scale=new b.Vector2D(1,1);this._size=new b.Vector2D(0,0);this._horizontalAlignment=b.ui.UiElementHorizontalAlignment.Center;this._verticalAlignment=b.ui.UiElementVerticalAlignment.Center};b.ui.UiElement.__name__=!0;b.ui.UiElement.__super__=b.Component;b.ui.UiElement.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);if(null==this._size){var a=this.getSiblingComponent(b.components.GameImage);null!=a?this.setSize(a.getSize()):this.setSize(new b.Vector2D(0,0))}this.updateDisplay()},getScaleRef:function(){return this._scale},getSize:function(){return this._size},getPixelPerfect:function(){return this._pixelPerfect},setPixelPerfect:function(a){this._pixelPerfect=a},setSize:function(a){null==this._size&&(this._size=new b.Vector2D);this._size.x=a.x;this._size.y=a.y},getUiPanel:function(){return this._uiPanel},setScale:function(a,c){null==c&&(c=1);null==a&&(a=1);this._scale=new b.Vector2D(a,c)},setUiPanel:function(a){null!=this._uiPanel&&this._uiPanel.removeEventListener("updateDisplay",l(this,this.onUiPanelUpdateDisplay));this._uiPanel=a;this._uiPanel.addEventListener("updateDisplay",l(this,this.onUiPanelUpdateDisplay));this._uiPanel.getEntity().addChild(this.getEntity())},getHorizontalAlignment:function(){return this._horizontalAlignment},setHorizontalAlignment:function(a){this._horizontalAlignment=a;this._positionDirty=!0},getVerticalAlignment:function(){return this._verticalAlignment},setVerticalAlignment:function(a){this._verticalAlignment=a;this._positionDirty=!0},getCoords:function(){return this._coords},getCoordsRef:function(){return this._coords},setCoords:function(a){this._coords=a},setAlignment:function(a,b){this.setHorizontalAlignment(a);this.setVerticalAlignment(b)},update:function(){b.Component.prototype.update.call(this)},postUpdate:function(){b.Component.prototype.postUpdate.call(this);(this._positionDirty||this._updateEveryFrame)&&this.updateDisplay()},onUiPanelUpdateDisplay:function(){this._positionDirty=!0},updateDisplay:function(){k.getWindow();this._uiPanel.getSize();b.GameManager.instance.getScreenSize();this._uiPanel.getSize();b.GameManager.instance.getScreenSize();var a=this._uiPanel.getSize().x/2*this._coords.x,c=this._uiPanel.getSize().y/2*this._coords.y;this._pixelPerfect?this.getEntity().setScale(this._scale.x,this._scale.y):this.getEntity().setScale(this._scale.x/this._uiPanel.getEntity().getScale().x,this._scale.y/this._uiPanel.getEntity().getScale().y);var d=this._size.getClone();switch(this._horizontalAlignment[1]){case 0:a+=d.x/2/this._uiPanel.getEntity().getScale().x;break;case 2:a-=d.x/2/this._uiPanel.getEntity().getScale().x}switch(this._verticalAlignment[1]){case 0:c+=d.y/2/this._uiPanel.getEntity().getScale().y;break;case 2:c-=d.y/2/this._uiPanel.getEntity().getScale().y}this.getEntity().setPosition(a,c);this._positionDirty=!1},debugRender:function(){b.Component.prototype.debugRender.call(this);if(null!=this._size){var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();var c=this.getEntity().getPosition();a.beginPath();a.lineWidth=1;a.strokeStyle="#0000FF";a.moveTo(c.x-this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y-this._size.y/2);a.stroke();a.restore()}},__class__:b.ui.UiElement});b.ui.UiPanel=function(a,c){b.Component.call(this,a,"UiPanel");this._size=c;this._window=k.getWindow()};b.ui.UiPanel.__name__=!0;b.ui.UiPanel.__super__=b.Component;b.ui.UiPanel.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.setSize(this._size)},getSize:function(){return this._size},setSize:function(a){this._size=a;this.updateDisplay()},getScreenSize:function(){var a=this._size.getClone();a.x*=this._window.innerWidth/this._size.x;a.y*=this._window.innerHeight/this._size.y;return a},updateDisplay:function(){this.dispatchEvent(new b.ui.UiPanelEvent("updateDisplay"));this.getEntity().setScale(1/b.GameManager.instance.getScreenScale().x,1/b.GameManager.instance.getScreenScale().y)},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d");a.save();var c=this.getEntity().getPosition();a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(c.x-this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y-this._size.y/2);a.stroke();a.restore()},__class__:b.ui.UiPanel});b.ui.UiPanelEvent=function(a){b.events.Event.call(this,a)};b.ui.UiPanelEvent.__name__=!0;b.ui.UiPanelEvent.__super__=b.events.Event;b.ui.UiPanelEvent.prototype=m(b.events.Event.prototype,{__class__:b.ui.UiPanelEvent});b.utilities={};b.utilities.ArrayUtils=function(){};b.utilities.ArrayUtils.__name__=!0;b.utilities.ArrayUtils.indexOf=function(a,b){for(var c=a.length,f=0;f<c;){var g=f++;if(a[g]==b)return g}return-1};b.utilities.ArrayUtils.clear=function(a){a.length=0};b.utilities.ArrayUtils.prototype={__class__:b.utilities.ArrayUtils};b.utilities.Debug=function(){};b.utilities.Debug.__name__=!0;b.utilities.Debug.log=function(a){};b.utilities.Debug.alert=function(a){};b.utilities.Math2=function(){};b.utilities.Math2.__name__=!0;b.utilities.Math2.degToRad=function(a){return 0.0174532925*a};b.utilities.Math2.radToDeg=function(a){return 57.2957795*a};b.utilities.Math2.randomFloat=function(a,b){return a+Math.random()*(b-a)};b.utilities.Math2.randomInt=function(a,c){return Math.floor(b.utilities.Math2.randomFloat(a,c))};b.utilities.Math2.getClosestPointOnSegment=function(a,c,d){c=new b.Vector2D(c.x-a.x,c.y-a.y);d=(new b.Vector2D(d.x-a.x,d.y-a.y)).dotProduct(c)/c.dotProduct(c);0>d&&(d=0);1<d&&(d=1);d=new b.Vector2D(c.x*d,c.y*d);return new b.Vector2D(a.x+d.x,a.y+d.y)};b.utilities.Math2.lineIntersect2D=function(a,c,d,f,g){var h=(c.x-a.x)*(f.y-d.y)-(c.y-a.y)*(f.x-d.x),p=(c.x-a.x)*(f.y-d.y)-(c.y-a.y)*(f.x-d.x);if(0==h||0==p)return-2;f=((a.y-d.y)*(f.x-d.x)-(a.x-d.x)*(f.y-d.y))/h;d=((a.y-d.y)*(c.x-a.x)-(a.x-d.x)*(c.y-a.y))/p;return 0<f&&1>f&&0<d&&1>d?(d=(new b.Vector2D(a.x-c.x,a.y-c.y)).getLength()*f,c=new b.Vector2D(c.x-a.x,c.y-a.y),c.scaleBy(f,f),c=new b.Vector2D(a.x+c.x,a.y+c.y),g.x=c.x,g.y=c.y,d):-1};b.utilities.Math2.clamp=function(a,b,c){return a<b?b:a>c?c:a};b.utilities.Math2.getRotated2dVector=function(a,c){var d=b.utilities.Math2.degToRad(c),f=Math.cos(d),d=Math.sin(d),g=new b.Vector2D(a.x,a.y);g.x=g.x*f-g.y*d;g.y=g.x*d+g.y*f;return g};b.utilities.Math2.getAngleInDegreesBetween2dVectors=function(a,c){return b.utilities.Math2.radToDeg(Math.atan2(a.x*c.y-a.y*c.x,a.dotProduct(c)))};b.utilities.Profiler=function(){};b.utilities.Profiler.__name__=!0;b.utilities.Profiler.startTimer=function(a){var c=u.Timer.stamp();b.utilities.Profiler._profiles.set(a,c)};b.utilities.Profiler.stopTimer=function(a){return u.Timer.stamp()-b.utilities.Profiler._profiles.get(a)};b.utilities.Profiler.prototype={__class__:b.utilities.Profiler};b.utilities.StringTools2=function(){};b.utilities.StringTools2.__name__=!0;b.utilities.StringTools2.convertFloatToTime=function(a){var c=b.Localizer.getString("GAMEPLAY_SCREEN_TIMER"),c=x.replace(c,"%N",Math.floor(a/60));a=q.string(Math.floor(a%60));2>a.length&&(a="0"+a);return c=x.replace(c,"%M",a)};b.utilities.StringTools2.prototype={__class__:b.utilities.StringTools2};b.utilities.WatchableValue=function(a){this._value=null;b.events.EventDispatcher.call(this);this._value=a};b.utilities.WatchableValue.__name__=!0;b.utilities.WatchableValue.__super__=b.events.EventDispatcher;b.utilities.WatchableValue.prototype=m(b.events.EventDispatcher.prototype,{set:function(a){var c=this._value;this._value=a;this._value!=c&&this.dispatchEvent(new b.utilities.WatchableValueEvent("change",this._value,c))},get:function(){return this._value},__class__:b.utilities.WatchableValue});b.utilities.WatchableValueEvent=function(a,c,d){b.events.Event.call(this,a);this.value=c;this.oldValue=d};b.utilities.WatchableValueEvent.__name__=!0;b.utilities.WatchableValueEvent.__super__=b.events.Event;b.utilities.WatchableValueEvent.prototype=m(b.events.Event.prototype,{__class__:b.utilities.WatchableValueEvent});var c={BarbieTransition:function(a,c){b.screenTransition.TransitionScreen.call(this,a,c)}};c.BarbieTransition.__name__=!0;c.BarbieTransition.doTransition=function(a,e){var d=new c.BarbieTransition(a,e);b.GameManager.instance.addGameState(d)};c.BarbieTransition.__super__=b.screenTransition.TransitionScreen;c.BarbieTransition.prototype=m(b.screenTransition.TransitionScreen.prototype,{init:function(){var a=this;b.screenTransition.TransitionScreen.prototype.init.call(this);b.managers.InputManager.getInstance().setInputDisabled(!0);var e=this.addEntity();e.setPosition(512,384);var d=new b.components.GameImage(e,"blackSquare",c.Layers.getUiFront());d.centerOffsetOnEntity();d.setScale(200,200);this._tweener=new b.components.Tweener(e);this._tweener.addTween(d,"_alpha",0,1,0.2,b.components.tween.EasingFunctions.linear,0,function(){a.onTransitionMidpoint()});this._tweener.addTween(d,"_alpha",1,0,0.2,b.components.tween.EasingFunctions.linear,0.2,function(){a.onTransitionComplete()})},onTransitionMidpoint:function(){b.screenTransition.TransitionScreen.prototype.onTransitionMidpoint.call(this);b.managers.InputManager.getInstance().setInputDisabled(!1)},__class__:c.BarbieTransition});c.ChooseBarbieScene=function(a,c){this._inputEnabled=!0;this._buttons=[];this._currentPage=0;this._buttonPositions=[new b.Vector2D(-0.65,-0.125),new b.Vector2D(-0.215,-0.125),new b.Vector2D(0.215,-0.125),new b.Vector2D(0.65,-0.125),new b.Vector2D(-0.65,0.45),new b.Vector2D(-0.215,0.45),new b.Vector2D(0.215,0.45),new b.Vector2D(0.65,0.45)];b.GameState.call(this);this._onNext=a;this._onClose=c};c.ChooseBarbieScene.__name__=!0;c.ChooseBarbieScene.show=function(a,e){var d=new c.ChooseBarbieScene(a,e);b.GameManager.instance.addGameState(d)};c.ChooseBarbieScene.__super__=b.GameState;c.ChooseBarbieScene.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);b.GameManager.instance.getLayerByName("uiFront");this._groupFader=new b.components.tween.GroupFader(this._uiPanel.getEntity());var a=this._uiPanel.getEntity();this._nextButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.1,0.85,"nextButton","nextButton",null,c.Layers.getUiFront(),"ui_click_1",null,!1,0.15,l(this,this.onNextButtonClick));this._prevButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.1,0.85,"prevButton","prevButton",null,c.Layers.getUiFront(),"ui_click_1",null,!1,0.15,l(this,this.onPrevButtonClick));this._screenFraming=new c.ScreenFraming(a,l(this,this.onBackBtn));var e=this.addEntity();new c.HeadingText(e,b.Localizer.getString("CHOOSE_BARBIE_SCREEN_HEADER"),c.Layers.getUiFront());(new b.ui.UiElement(e,this._uiPanel)).setCoords(new b.Vector2D(0,-0.55));this._groupFader.fadeTo(0,1,0.35,null,b.components.tween.EasingFunctions.linear,0);e=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.9,-0.48,"backButton2","backButton2",l(this,this.onBackBtn),c.Layers.getUiFront(),"ui_click_1",null,!1,0.15,null);a.addChild(e);this.generatePhotoButtons()},clearButtons:function(){for(var a=this._buttons.length,b=0;b<a;){var c=b++;this._buttons[c].destroy()}},generatePhotoButtons:function(){var a=this;this.clearButtons();for(var e=this._uiPanel.getEntity(),d=0;8>d;){var f=d++,g=[c.ChooseBarbieScene.ADJUSTED_PHOTO_ORDER[8*this._currentPage+f]];if(b.managers.AssetManager.assetExists("choosePhoto"+
(g[0]+1)+"Thumb")){var h="choosePhoto"+(g[0]+1)+"Thumb",f=c.UiFactory.createPulseButtonQuick(this._uiPanel,this._buttonPositions[f].x,this._buttonPositions[f].y,h,h,function(c){return function(){a._inputEnabled&&(a.onSelectPhoto(c[0]),b.managers.SoundManager.playSoundByName("ui_click_1"),a._inputEnabled=!0)}}(g),c.Layers.getUiFront(),""),g=f.getComponent(b.components.Button);g.getCollisionSize().x=165;g.getCollisionSize().y=165;g=b.utilities.Math2.randomFloat(-3,3);f.setRotation(0,0,b.utilities.Math2.degToRad(g));e.addChild(f);this._buttons.push(f)}}e=this._nextButton.getComponent(b.components.buttons.ButtonMouseOverImage);e.setDefaultImage("nextButton");e.setMouseOverImage("nextButton");e=this._prevButton.getComponent(b.components.buttons.ButtonMouseOverImage);e.setDefaultImage("prevButton");e.setMouseOverImage("prevButton");5<=this._currentPage?(e=this._nextButton.getComponent(b.components.buttons.ButtonMouseOverImage),e.setDefaultImage("nextButtonGrey"),e.setMouseOverImage("nextButtonGrey")):0==this._currentPage&&(e=this._prevButton.getComponent(b.components.buttons.ButtonMouseOverImage),e.setDefaultImage("prevButtonGrey"),e.setMouseOverImage("prevButtonGrey"))},onNextButtonClick:function(){this._currentPage++;5<this._currentPage?this._currentPage=5:this.generatePhotoButtons()},onPrevButtonClick:function(){this._currentPage--;0>this._currentPage?this._currentPage=0:this.generatePhotoButtons()},onSelectPhoto:function(a){var e;e=window.document.createElement("img");e.src=b.managers.AssetManager.getAsset("photo"+
q.string(a+1)).src;c.comicCreator.PhotoManager.getInstance().registerPhotoImageElement(e);this.dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("nextClick"));null!=this._onNext&&this._onNext();c.utag.UtagManager.getInstance().link2("games","choose photo","choose canned barbie image","[Game Title]");this.dismiss()},onBackBtn:function(){this._inputEnabled&&(this._inputEnabled=!1,null!=this._onClose&&this._onClose(),this.dismiss())},dismiss:function(){var a=this;this._groupFader.fadeTo(1,0,0.35,function(){a.destroy()},b.components.tween.EasingFunctions.linear,0)},__class__:c.ChooseBarbieScene});c.ComicRecapScreen=function(){this._inputEnabled=!0;this._sharingEnabled=!1;this._framesPerGifFrame=6;this._numGifFrames=20;b.GameState.call(this);c.ComicRecapScreen._instance=this;this._sharingEnabled="1"==b.GameConfig.getProperty("emailSharingEnabled")};c.ComicRecapScreen.__name__=!0;c.ComicRecapScreen.getInstance=function(){return c.ComicRecapScreen._instance};c.ComicRecapScreen.onComicPreviewClose=function(a){a.target.destroy();b.GameManager.instance.addGameState(new c.ComicRecapScreen)};c.ComicRecapScreen.__super__=b.GameState;c.ComicRecapScreen.prototype=m(b.GameState.prototype,{getBlockerBackground:function(){return this._blockerBackground},init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this);a.getEntity();var e=b.GameManager.instance.getLayerByName("ui"),d=this.addEntity();d.setPosition(950,60);this.addEntity();var f=this.addEntity();(new b.components.GameImage(f,"comicCompleteFrame",e)).centerOffsetOnEntity();d.addChild(f);a=new b.ui.UiElement(f,a);a.setCoords(new b.Vector2D(-1,1));a.setAlignment(b.ui.UiElementHorizontalAlignment.Left,b.ui.UiElementVerticalAlignment.Bottom);c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getWidth();c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getHeight();a=c.UiFactory.createPulseButtonQuickAbsolute(this,0,0,"editIcon","editIcon",l(this,this.onEditButtonClick),c.Layers.getUi(),"ui_click_1");d.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this,0,65,"printButton","printButton",null,c.Layers.getUi(),"ui_click_1","",!1,0.35,l(this,this.onPrintButtonClick));d.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this,0,130,"downloadButton","downloadButton",null,c.Layers.getUi(),"ui_click_1","",!1,0.35,l(this,this.onSaveButtonClick));d.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this,0,195,"comicCreatorFinishButton","comicCreatorFinishButton",l(this,this.onHomeButtonClick),c.Layers.getUi(),"ui_click_1",null,!1);d.addChild(a);b.GameManager.isMobile();this._scrollBarBg=this.addEntity();this._comicRoot=this.addEntity();c.levels.LevelManager.getInstance().getCurrentLevelIndex();d=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition();a=new c.comicCreator.Comic(this._comicRoot,c.Layers.getUi(),d,null);a.generateFromComposition(c.GameTracker.getInstance().getCurrentComicComposition());a.disableEditing();this._comicRoot.setPosition(512-
d.getWidth()/2,0);this._blockerBackground=this.addEntity();this._blockerBackground.setIsVisible(!1)},onHomeButtonClick:function(){b.GameManager.instance.addGameState(new c.PopUpScreen(this,b.Localizer.getString("GAMEPLAY_SCREEN_QUIT_CONFIRM_TEXT"),l(this,this.onConfirmHome)));this.pause()},onConfirmHome:function(){c.PhotoSnapTransition.doTransition(this,new c.TitleScreen)},onStartNextLevelClick:function(){c.levels.LevelManager.getInstance().setCurrentLevelIndex(c.levels.LevelManager.getInstance().getCurrentLevelIndex()+
1);c.PhotoSnapTransition.doTransition(this,new c.comicCreator.ComicCreatorState)},update:function(){b.GameState.prototype.update.call(this)},onViewButtonClick:function(){var a=new c.comicCreator.ComicPreviewState;a.addEventListener("closeClick",c.ComicRecapScreen.onComicPreviewClose);b.GameManager.instance.switchToGameState(this,a);b.managers.SoundManager.playSoundByName("ui_click_1")},onNewButtonClick:function(){this._inputEnabled&&(this._loadingScreen=new c.LoadingScreen,c.PhotoSnapTransition.doTransition(this,this._loadingScreen),b.managers.AssetManager.getAsset("menusLoadBatch").load(l(this,this.onLoadBatchComplete)))},onLoadBatchComplete:function(){this._loadingScreen.destroy();b.GameManager.instance.switchToGameState(this,new c.TitleScreen)},onPrintButtonClick:function(){this._inputEnabled&&b.GameManager.instance.addGameState(new c.comicCreator.PrintingState)},onShareButtonClick:function(){},onShareScreenDestroy:function(a){this._inputEnabled&&(this.resume(),this._scrollBarBg.setIsVisible(!0),this._blogDiv.style.display="block",this._blockerBackground.setIsVisible(!1))},onEditButtonClick:function(){this._inputEnabled&&c.PhotoSnapTransition.doTransition(this,new c.comicCreator.ComicCreatorState)},onDownloadButtonClick:function(){},destroy:function(){b.GameState.prototype.destroy.call(this);null!=this._blogDiv&&(k.getContainer().removeChild(this._blogDiv),this._blogDiv=null);c.ComicRecapScreen._instance=null},onSaveButtonClick:function(){var a=this;if(this._inputEnabled){this._inputEnabled=!1;this._gifProcessing=new c.PopUpScreenNoInput(b.Localizer.getString("GIF_PROCESSING"));b.GameManager.instance.addGameState(this._gifProcessing);var e=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getWidth(),d=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getHeight(),f=new b.Layer("temp",e,d);this._saveCanvas=k.getDocument().createElement("canvas");this._saveCanvas.width=792;this._saveCanvas.height=612;this._saveCanvas.setAttribute("webkitTransform","translate3d(0px, 0px, 0px);");this._saveCanvas.style.position="absolute";var g=this.addEntity();g.setPosition(512-0.5*c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getWidth(),40);g.setScale(0.7,0.7);var h=new c.comicCreator.Comic(g,f,c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition());h.disableEditing();h.generateFromComposition(c.GameTracker.getInstance().getCurrentComicComposition());b.GameManager.instance.invokeAsyncDeferredAction(0.4,function(){a._saveCanvas.getContext("2d").drawImage(b.managers.AssetManager.getAsset("printableBg"),0,0);h.renderToCanvas(a._saveCanvas);var e=new GIFEncoder;e.setRepeat(0);e.setQuality(20);e.setDelay(100);e.start();for(var d=0,k=a._numGifFrames;d<k;){d++;for(var l=0,m=a._framesPerGifFrame;l<m;)l++,h.getGameState().update();e.addFrame(a._saveCanvas.getContext("2d"));h.renderToCanvas(a._saveCanvas)}e.finish();var e=e.stream().getData(),s="data:image/gif;base64,"+q.string(window.encode64(e));g.destroy();f.destroy();a._gifProcessing.destroy();var t=new c.PopUpScreen(a,b.Localizer.getString("GIF_PROCESSING_COMPLETE"),function(){window.open().document.write('<img src="'+s+'"/>');t.destroy()});t.setInstantYes(!0);b.GameManager.instance.addGameState(t);b.GameManager.instance.invokeAsyncDeferredAction(0.1,function(){a._inputEnabled=!0})})}},__class__:c.ComicRecapScreen});c.ComicStartSelectState=function(){b.GameState.call(this)};c.ComicStartSelectState.__name__=!0;c.ComicStartSelectState.__super__=b.GameState;c.ComicStartSelectState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);var a=b.GameManager.instance.getLayerByName("ui"),e=this.addEntity(),e=new b.components.GameImage(e,"blackSquare",a);e.setScale(100,100);e.centerOffsetOnEntity();e.setAlpha(0.8);e=c.UiFactory.createUiElementEntity(this,this._uiPanel,0,0);(new b.components.GameImage(e,"popupContainer",a)).centerOffsetOnEntity();var d=this.addEntity();(new b.components.GameImage(d,"logo",c.Layers.getUiFront())).centerOffsetOnEntity();d.setPosition(0,-176);e.addChild(d);e=this.addEntity();(new b.ui.UiElement(e,this._uiPanel)).setCoords(new b.Vector2D(0,-0.25));e=new b.components.TextField(e,a);e.setText(b.Localizer.getString("COMIC_START_SELECT_HEADING"));e.setFontSize("62px");e.setFontFamily("agencyfbregular");c.UiFactory.createTextButton(0,0.05,"TEMPLATE_SELECT_STARTER","comicCreatorFinishButton",this._uiPanel,a,l(this,this.onStarterButtonClick),"ui_click_1");c.UiFactory.createTextButton(0,0.35,"TEMPLATE_SELECT_BLANK","comicCreatorFinishButton",this._uiPanel,a,l(this,this.onBlankButtonClick),"ui_click_1")},onStarterButtonClick:function(){this.dispatchEvent(new c.ComicStartSelectStateEvent("selectStarter"))},onBlankButtonClick:function(){this.dispatchEvent(new c.ComicStartSelectStateEvent("selectBlank"))},__class__:c.ComicStartSelectState});c.ComicStartSelectStateEvent=function(a){b.events.Event.call(this,a)};c.ComicStartSelectStateEvent.__name__=!0;c.ComicStartSelectStateEvent.__super__=b.events.Event;c.ComicStartSelectStateEvent.prototype=m(b.events.Event.prototype,{__class__:c.ComicStartSelectStateEvent});c.ComicStarterSelectScreen=function(){this._levelButtons=[];this._templateIndexOrder=[0,1,2,3,4,5,6,7,8,9,10,11];this._scrollIndex=0;this._buttonScrollRoot=this._buttonScrollRootTweener=null;this._buttonPositions=[new b.Vector2D(-0.5,-0.175),new b.Vector2D(-0,-0.175),new b.Vector2D(0.5,-0.175),new b.Vector2D(-0.5,0.5),new b.Vector2D(-0,0.5),new b.Vector2D(0.5,0.5)];this._isInputEnabled=!0;this._loadingScreen=null;b.GameState.call(this);c.ComicStarterSelectScreen._instance=this;this._pageRoots=[];this._numPages=Math.floor(c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates().length/this._buttonPositions.length)};c.ComicStarterSelectScreen.__name__=!0;c.ComicStarterSelectScreen.getInstance=function(){return c.ComicStarterSelectScreen._instance};c.ComicStarterSelectScreen.__super__=b.GameState;c.ComicStarterSelectScreen.prototype=m(b.GameState.prototype,{postUpdate:function(){b.GameState.prototype.postUpdate.call(this)},init:function(){b.GameState.prototype.init.call(this);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);var a=b.GameManager.instance.getLayerByName("ui");this._root=this._uiPanel.getEntity();this._deferredAction=new b.components.DeferredActionComponent(this._root);this._buttonScrollRoot=this.addEntity();this._uiPanel.getEntity().addChild(this._buttonScrollRoot);this._buttonScrollRootTweener=new b.components.Tweener(this._buttonScrollRoot);var e=this.addEntity();(new b.components.GameImage(e,"templateSelectBackground",a)).centerOffsetOnEntity();new b.ui.UiElement(e,this._uiPanel);this.generateButtons();e=this.addEntity();new c.HeadingText(e,b.Localizer.getString("STARTER_SELECT_HEADING"),a);(new b.ui.UiElement(e,this._uiPanel)).setCoords(new b.Vector2D(0,-0.8));c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.85,-0.81,"backButtonLarge","backButtonLarge",l(this,this.onTitleScreen),a,"ui_click_1","",!1,0.05);b.managers.SoundManager.playSoundByName("ui_swish_1")},generateButtons:function(a){null==a&&(a=0);for(var e=this,d=this._levelButtons.length,f=0;f<d;){var g=f++;this._levelButtons[g].destroy()}d=b.GameManager.instance.getLayerByName("ui");f=c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates().length;Math.ceil(f/2);f=0;for(g=this._buttonPositions.length;f<g;){var h=f++,p=[this._templateIndexOrder[a*this._buttonPositions.length+h]];if(null!=c.challenges.ChallengeManager.getInstance().getChallenges()[p[0]]){var n=this._buttonPositions[h],k=c.UiFactory.createPulseButtonQuick(this._uiPanel,n.x,n.y,"frameLayoutThumbnail"+
(p[0]+1),"frameLayoutThumbnail"+(p[0]+1),function(a){return function(a){return function(){e.onLevelClick(e._templateIndexOrder[a[0]])}}(p)}(this),d,"ui_click_1","",!1);console.log("frameLayoutThumbnail"+(p[0]+1));n=k.getComponent(b.ui.UiElement);this._levelButtons.push(k);k.setName("levelButton"+(h+1));k.getComponent(b.components.GameImage).setAlpha(0);this._buttonScrollRoot.addChild(k);(new b.components.tween.GroupFader(k)).fadeTo(0,1,0.35,null,b.components.tween.EasingFunctions.linear,0.15+0.05*h);k=new b.components.Tweener(k);k.addTween(n.getScaleRef(),"x",1.45,1,0.5,b.components.tween.EasingFunctions.easeOutBack,0.15+0.05*h);k.addTween(n.getScaleRef(),"y",1.45,1,0.5,b.components.tween.EasingFunctions.easeOutBack,0.15+0.05*h)}}},updateScrollBtn:function(a,c,d,f){if(null!=a){var g=a.getComponent(b.components.buttons.ButtonMouseOverImage),h=a.getComponent(b.components.buttons.ButtonMouseOverScale);a=a.getComponent(b.components.buttons.ButtonMouseDownPulse);this._scrollIndex==f?(g.setDefaultImage(c),g.setMouseOverImage(c),h.disableButton(),a.disableButton()):(g.setDefaultImage(d),g.setMouseOverImage(d),h.enableButton(),a.enableButton())}},onScrollLeftClicked:function(){this._isInputEnabled&&0!=this._scrollIndex&&(this._scrollIndex--,this.updateScrollBtn(this._leftScrollEntity,"templateSelectPrevButton","templateSelectPrevButton",0),this.updateScrollBtn(this._rightScrollEnity,"templateSelectNextButton","templateSelectNextButton",this._numPages),this.generateButtons(this._scrollIndex))},onScrollRightClicked:function(){this._isInputEnabled&&this._scrollIndex!=this._numPages-1&&(this._scrollIndex++,this.updateScrollBtn(this._rightScrollEnity,"templateSelectNextButton","templateSelectNextButton",this._numPages),this.updateScrollBtn(this._leftScrollEntity,"templateSelectPrevButton","templateSelectPrevButton",0),this.generateButtons(this._scrollIndex))},onLevelClick:function(a){if(this._isInputEnabled){var e=this._levelButtons[0];new b.components.Tweener(e);e.getComponent(b.ui.UiElement);e.getComponent(b.components.Button).destroy();c.levels.LevelManager.getInstance().setCurrentLevelIndex(a);c.GameTracker.getInstance().setCurrentLevelNumber(a+1);a=c.challenges.ChallengeManager.getInstance().getChallenges()[a];a=c.comicCreator.comicCompositions.ComicCompositionManager.getInstance().getCompositionById(a.getCompositionId());c.GameTracker.getInstance().setCurrentComicComposition(a);this.gotoPhotoSelect();this._isInputEnabled=!1}},gotoPhotoSelect:function(){var a=new c.comicCreator.ComicCreatorState;c.PhotoSnapTransition.doTransition(this,a);c.comicCreator.FilterUndoManager.getInstance().reset()},gotoComicCreator:function(){this._loadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(this,this._loadingScreen);b.managers.AssetManager.getAsset("comicCreatorAssets").load(l(this,this.onComicCreatorAssetsLoad))},onComicCreatorAssetsLoad:function(){var a=this;this._loadingScreen.addDelay(1,function(){c.PhotoSnapTransition.doTransition(a._loadingScreen,new c.comicCreator.ComicCreatorState)})},onTitleScreen:function(){this._isInputEnabled&&(c.PhotoSnapTransition.doTransition(this,new c.TitleScreen),this._isInputEnabled=!1)},enableLevelButtonByIndex:function(a){this._levelButtons[a].getComponent(b.components.Button).setIsActive(!0);this._levelButtons[a].getComponent(b.components.Tweener).getTweenByProperty("_alpha")._end=1},disableLevelButtonByIndex:function(a){this._levelButtons[a].getComponent(b.components.Button).setIsActive(!1);this._levelButtons[a].getComponent(b.components.Tweener).getTweenByProperty("_alpha")._end=0.35},templateListMaskFunction:function(a){a.beginPath();var c=new b.Vector3D(512,384);a.moveTo(c.x-460,c.y-255);a.lineTo(c.x+458,c.y-255);a.lineTo(c.x+458,c.y+329);a.lineTo(c.x-460,c.y+329);a.closePath()},challengeBurstMaskFunction:function(a){a.beginPath();var c=new b.Vector3D(512,384);a.moveTo(c.x-460,c.y-255);a.lineTo(c.x+458,c.y-255);a.lineTo(c.x+458,c.y+330);a.lineTo(c.x-460,c.y+330);a.closePath()},destroy:function(){b.GameState.prototype.destroy.call(this);c.ComicStarterSelectScreen._instance==this&&(c.ComicStarterSelectScreen._instance=null)},__class__:c.ComicStarterSelectScreen});c.ConfirmQuitState=function(a){b.GameState.call(this);this._parentState=a};c.ConfirmQuitState.__name__=!0;c.ConfirmQuitState.__super__=b.GameState;c.ConfirmQuitState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this),e=b.GameManager.instance.getLayerByName("uiFront"),d=this.addEntity(),d=new b.components.GameImage(d,"blackSquare",e);d.setScale(100,100);d.centerOffsetOnEntity();d.setAlpha(0.8);d=c.UiFactory.createUiElementEntity(this,a,0,0);(new b.components.GameImage(d,"dialogBg",e)).centerOffsetOnEntity();var f=this.addEntity();f.setPosition(25,-60);var g=new b.components.TextField(f,e);g.setText(b.Localizer.getString("GAMEPLAY_SCREEN_QUIT_CONFIRM_TEXT"));g.setFontSize("24px");g.setFontFamily("agencyfbregular");g.setFillStyle("#000000");g.setMaxWidth(450);d.addChild(f);d=this.addEntity();(new b.ui.UiElement(d,a)).setCoords(new b.Vector2D(0.05,-0.55));a=new b.components.TextField(d,e);a.setText(b.Localizer.getString("GAMEPLAY_SCREEN_QUIT_CONFIRM"));a.setFontSize("36px");a.setFontFamily("agencyfbregular");c.UiFactory.createPulseButtonQuickAbsolute(this,100,77,"doneUi","doneUi",l(this,this.onYesClicked),e,"ui_click_1");c.UiFactory.createPulseButtonQuickAbsolute(this,-100,77,"doneUi","doneUi",l(this,this.onNoClicked),e,"ui_click_1")},onYesClicked:function(){this._loadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(this,this._loadingScreen);b.managers.AssetManager.getAsset("menusLoadBatch").load(l(this,this.onLoadTitlesComplete));this._parentState.destroy()},onLoadTitlesComplete:function(){c.PhotoSnapTransition.doTransition(this._loadingScreen,new c.TitleScreen)},onNoClicked:function(){this._parentState.resume();b.GameManager.instance.removeGameState(this)},__class__:c.ConfirmQuitState});c.EntityFactory=function(){};c.EntityFactory.__name__=!0;c.EntityFactory.createCamera=function(a,c,d,f){f=f.addEntity();f.setPosition(a,c,d);a=new b.components.Camera(f);new b.components.SlackMovement(f,0.2);a.setZoomScale(1);a.setOffset(new b.Vector2D(0,0));new b.components.Tweener(f);return a};c.EntityFactory.createAnimation=function(a,c,d,f,g){null==g&&(g=!0);null==f&&(f=2);b.spriteSheets.SpriteSheet.parseFromXmlString(a,a,b.managers.AssetManager.getAsset(c));b.components.Animation.makeLinearAnimationFromSheetBySpriteName(a,a,"",f,g).setOffset(d.x,d.y)};c.EntityFactory.createSmallCameraFlash=function(a,e,d){var f=d.addEntity();f.setPosition(a,e);a=d.addEntity();f.addChild(a);e=new b.components.GameImage(a,"cameraFlash2",c.Layers.getDefault());e.centerOffsetOnEntity();var g=new b.components.Tweener(a);g.addTween(a.getScaleRef(),"x",0,1,0.15,b.components.tween.EasingFunctions.easeOutQuint,0);g.addTween(a.getScaleRef(),"y",0,1,0.15,b.components.tween.EasingFunctions.easeOutQuint,0);g.addTween(e,"_alpha",1,0,0.15,b.components.tween.EasingFunctions.linear,0.15);a=d.addEntity();f.addChild(a);e=new b.components.GameImage(a,"cameraFlash3",c.Layers.getDefault());e.centerOffsetOnEntity();g=new b.components.Tweener(a);g.addTween(a.getScaleRef(),"x",0,1.75,0.15,b.components.tween.EasingFunctions.easeOutQuint,0);g.addTween(a.getScaleRef(),"y",0,1.75,0.15,b.components.tween.EasingFunctions.easeOutQuint,0);g.addTween(e,"_alpha",1,0,0.15,b.components.tween.EasingFunctions.linear,0.15);d=d.addEntity();f.addChild(d);a=new b.components.GameImage(d,"cameraFlashCircle",c.Layers.getDefault());a.centerOffsetOnEntity();e=new b.components.Tweener(d);e.addTween(d.getScaleRef(),"x",0,0.5,0.15*1.5,b.components.tween.EasingFunctions.easeOutQuint,0);e.addTween(d.getScaleRef(),"y",0,0.5,0.15*1.5,b.components.tween.EasingFunctions.easeOutQuint,0);a.setAlpha(0.5);e.addTween(a,"_alpha",0.5,0,0.3,b.components.tween.EasingFunctions.linear,0.15,function(){f.destroy()});b.managers.SoundManager.playSoundByName("ui_camera_1");return f};c.EntityFactory.prototype={__class__:c.EntityFactory};c.FontFamilies=function(){};c.FontFamilies.__name__=!0;c.GameTracker=function(){this._currentAvatarCreatorCategory="";this._currentLevelNumber=1;b.events.EventDispatcher.call(this);c.GameTracker._instance=this;this._userData=new c.UserData;this._saveData=new b.SaveData};c.GameTracker.__name__=!0;c.GameTracker.getInstance=function(){null==c.GameTracker._instance&&(c.GameTracker._instance=new c.GameTracker);return c.GameTracker._instance};c.GameTracker.getScoreSaveKeyForLevel=function(a){return"levelScore"+(null==a?"null":""+a)};c.GameTracker.getGameTitle=function(){return"barbie-photobooth"};c.GameTracker.__super__=b.events.EventDispatcher;c.GameTracker.prototype=m(b.events.EventDispatcher.prototype,{getSaveData:function(){return this._saveData},getUserData:function(){return this._userData},setUserData:function(a){this._userData=a},getNumLevels:function(){return q.parseInt(b.GameConfig.getProperty("numLevels"))},getNumLevelsUnlocked:function(){return this.getSaveData().getItem("numLevelsUnlocked",1)},setNumLevelsUnlocked:function(a){this.getSaveData().setItem("numLevelsUnlocked",Math.min(this.getNumLevels(),Math.max(a,this.getNumLevelsUnlocked())))},setScoreForLevel:function(a,b){a>this.getScoreForLevel(b)&&this.getSaveData().setItem(c.GameTracker.getScoreSaveKeyForLevel(b),a)},getScoreForLevel:function(a){return this.getSaveData().getItem(c.GameTracker.getScoreSaveKeyForLevel(a),0)},setScoreForCurrentLevel:function(a){this.setScoreForLevel(a,this._currentLevelNumber)},setCurrentLevelNumber:function(a){this._currentLevelNumber=a},getCurrentLevelNumber:function(){return this._currentLevelNumber},getHasBeatenGame:function(){return this.getSaveData().getItem("hasBeatenGame",!1)},setHasBeatenGame:function(a){this.getSaveData().setItem("hasBeatenGame",a)},getHasStartedGame:function(){return this.getSaveData().getItem("hasStartedGame",!1)},setHasStartedGame:function(a){this.getSaveData().setItem("hasStartedGame",a)},getCurrentComicComposition:function(){return this._currentComicComposition},setCurrentComicComposition:function(a){this._currentComicComposition=a},getCurrentAvatarCreatorCategory:function(){return this._currentAvatarCreatorCategory},setCurrentAvatarCreatorCategory:function(a){this._currentAvatarCreatorCategory=a},__class__:c.GameTracker});c.HeadingText=function(a,c,d){b.Component.call(this,a,"HeadingText");this._text=c;this._layer=d};c.HeadingText.__name__=!0;c.HeadingText.__super__=b.Component;c.HeadingText.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);var a=this.getGameState().addEntity();a.setPosition(0,5);this.getEntity().addChild(a);a=this.getGameState().addEntity();a.setPosition(0,4);var c=new b.components.TextField(a,this._layer);c.setText(this._text);c.setFontSize("64px");this.getEntity().addChild(a)},__class__:c.HeadingText});c.ImageFunctions=function(){};c.ImageFunctions.__name__=!0;c.ImageFunctions.multiplyImages=function(a,b,c){null==c&&(c=1);var f;f=k.getDocument().createElement("canvas");f.width=b.width;f.height=b.height;var g;g=k.getDocument().createElement("canvas");g.width=f.width;g.height=f.height;var h;h=k.getDocument().createElement("canvas");h.width=b.width;h.height=b.height;var p=g.getContext("2d"),n=h.getContext("2d"),l=f.getContext("2d");p.drawImage(a,0,0,f.width,f.height);n.drawImage(b,0,0,f.width,f.height);a=p.getImageData(0,0,g.width,g.height);h=n.getImageData(0,0,h.width,h.height);n=l.getImageData(0,0,f.width,f.height);b=h.data.length;for(g=0;g<b;)n.data[g]=h.data[g]*(a.data[g]*c+h.data[g]*(1-c))/255,n.data[g+1]=h.data[g+1]*(a.data[g+1]*c+h.data[g]*(1-c))/255,n.data[g+2]=h.data[g+2]*(a.data[g+2]*c+h.data[g]*(1-c))/255,n.data[g+3]=h.data[g+3]*a.data[g+3]/255,g+=4;l.putImageData(n,0,0);c=k.getDocument().createElement("img");c.width=f.width;c.height=f.height;c.src=f.toDataURL("image/png");return c};c.ImageFunctions.prototype={__class__:c.ImageFunctions};c.Layers=function(){};c.Layers.__name__=!0;c.Layers.getForeground=function(){null==c.Layers._foregroundLayer&&(c.Layers._foregroundLayer=b.GameManager.instance.getLayerByName("defaultFront"));return c.Layers._foregroundLayer};c.Layers.getDefault=function(){null==c.Layers._defaultLayer&&(c.Layers._defaultLayer=b.GameManager.instance.getLayerByName("default"));return c.Layers._defaultLayer};c.Layers.getBackground=function(){null==c.Layers._backgroundLayer&&(c.Layers._backgroundLayer=b.GameManager.instance.getLayerByName("defaultBg"));return c.Layers._backgroundLayer};c.Layers.getUi=function(){null==c.Layers._uiLayer&&(c.Layers._uiLayer=b.GameManager.instance.getLayerByName("ui"));return c.Layers._uiLayer};c.Layers.getUiFront=function(){null==c.Layers._uiFrontLayer&&(c.Layers._uiFrontLayer=b.GameManager.instance.getLayerByName("uiFront"));return c.Layers._uiFrontLayer};c.Layers.getOrientation=function(){null==c.Layers._orientationLayer&&(c.Layers._orientationLayer=b.GameManager.instance.getLayerByName("orientation"));return c.Layers._orientationLayer};c.Layers.prototype={__class__:c.Layers};c.LoadingScreen=function(){this._barPercentage=this._targetBarPercentage=0;b.GameState.call(this)};c.LoadingScreen.__name__=!0;c.LoadingScreen.__super__=b.GameState;c.LoadingScreen.prototype=m(b.GameState.prototype,{addDelay:function(a,c){null==this._deferredAction&&(this._deferredAction=new b.components.DeferredActionComponent(this.addEntity()));this._deferredAction.addDeferredAction(a,c)},init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this),e=b.GameManager.instance.getLayerByName("ui");this._root=this.addEntity();var d=this.addEntity();new c.effects.ScrollingBackground(d,"loadingBg",e);new b.ui.UiElement(d,a);e=this.addEntity();a=new b.ui.UiElement(e,a);a.setCoords(new b.Vector2D(0,0));d=this.addEntity();d.setPosition(0,0);e.addChild(d);(new b.components.GameImage(d,"loadingBackground",c.Layers.getUi())).centerOffsetOnEntity();var f=this.addEntity();f.setPosition(28,182);this._meterImage=new b.components.GameImage(f,"loadingMeter",c.Layers.getUi());this._meterImage.centerOffsetOnEntity();d.addChild(f);this._tweener=new b.components.Tweener(e);a.setScale(0,0);this._tweener.addTween(a.getScaleRef(),"x",0.5,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0.3);this._tweener.addTween(a.getScaleRef(),"y",0.5,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0.3);this.updateLoadingMeter(0)},update:function(){b.GameState.prototype.update.call(this);if(null!=this._meterImage){var a=this._targetBarPercentage-this._barPercentage;this._barPercentage=0.01<a?this._barPercentage+0.05*a:this._targetBarPercentage;this._meterImage.setClipRect(new b.Rect2D(0,0,274*this._barPercentage,this._meterImage.getSize().y))}},onFileLoaded:function(a,b){this.updateLoadingMeter(a/b)},updateLoadingMeter:function(a){this._targetBarPercentage=a},handleMessage:function(a,c){b.GameState.prototype.handleMessage.call(this,a,c);switch(a){case "onFileLoaded":this.onFileLoaded(c.progress,c.total)}},destroy:function(){b.GameState.prototype.destroy.call(this)},__class__:c.LoadingScreen});c.OffscreenImageHide=function(a,c,d){null==d&&(d=568);null==c&&(c=111);b.Component.call(this,a,"OffscreenImageHide");this._minY=c;this._maxY=d};c.OffscreenImageHide.__name__=!0;c.OffscreenImageHide.__super__=b.Component;c.OffscreenImageHide.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._image=this.getEntity().getComponent(b.components.GameImage)},update:function(){b.Component.prototype.update.call(this);var a=this.getEntity().getPosition();if(a.y>this._maxY||a.y<this._minY)this.getEntity().setIsVisible(!1);else{this.getEntity().setIsVisible(!0);for(var a=Math.min(Math.abs(a.y-this._minY),Math.abs(a.y-this._maxY)),c=this.getEntity().getComponents(b.components.GameImage),d=c.length,f=0;f<d;){var g=f++,g=c[g];if(50>a){var h=a/50;g.setAlpha(h);g.setScale(h,h)}else g.setAlpha(1),g.setScale(1,1)}}},__class__:c.OffscreenImageHide});c.PauseMenuState=function(a){b.GameState.call(this);this._parentState=a};c.PauseMenuState.__name__=!0;c.PauseMenuState.show=function(a){a=new c.PauseMenuState(a);b.GameManager.instance.addGameState(a);return a};c.PauseMenuState.__super__=b.GameState;c.PauseMenuState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this),e=c.Layers.getUiFront(),d=c.UiFactory.createUiElementEntityImage(this,a,0,0,"blackSquare","uiFront");d.getComponent(b.components.GameImage).setAlpha(0.5);d.getComponent(b.ui.UiElement).setScale(1E3,1E3);d=c.UiFactory.createUiElementEntityImage(this,a,0,0,"popupContainer","uiFront");(new b.components.GameImage(d,"popupContainer",c.Layers.getUiFront())).centerOffsetOnEntity();var f=this.addEntity();(new b.components.GameImage(f,"logo",c.Layers.getUiFront())).centerOffsetOnEntity();f.setPosition(0,-178);d.addChild(f);d=c.UiFactory.createUiElementEntity(this,a,0,-0.2);d=new b.components.TextField(d,e);d.setText(b.Localizer.getString("GAMEPLAY_SCREEN_PAUSE"));d.setFontSize("64px");d.setFontFamily("agencyfbregular");c.UiFactory.createPulseButtonQuick(a,-0,0.7,"playButton","playButton",l(this,this.onResumeClicked),e,"ui_click_1");this._soundButton=c.UiFactory.createPulseButtonQuick(a,0.25,0.15,"soundButtonLarge","soundOffButtonLarge",null,e,"ui_click_1","",!1);new c.SoundButton(this._soundButton,"soundButtonLarge","soundOffButtonLarge");c.UiFactory.createPulseButtonQuick(a,0,0.15,"helpButton","helpButton",l(this,this.onHelpClicked),e,"ui_click_1");c.UiFactory.createPulseButtonQuick(a,-0.25,0.15,"backButtonLarge","backButtonLarge",l(this,this.onQuitClicked),e,"ui_click_1")},onResumeClicked:function(){this._parentState.resume();b.GameManager.instance.removeGameState(this)},onHelpClicked:function(){},onQuitClicked:function(){b.GameManager.instance.removeGameState(this);b.GameManager.instance.addGameState(new c.PopUpScreen(this._parentState,b.Localizer.getString("GAMEPLAY_SCREEN_QUIT_CONFIRM_TEXT"),l(this,this.onConfirmQuit)))},onConfirmQuit:function(){c.PhotoSnapTransition.doTransition(this._parentState,new c.TitleScreen)},__class__:c.PauseMenuState});c.PhotoSnapTransition=function(a,c){b.screenTransition.TransitionScreen.call(this,a,c);var d;d=window.document.createElement("img");d.src=b.Layer.getMasterLayer().getCanvas().toDataURL("image/png");b.managers.AssetManager.registerAsset("screenSnap",d,!0)};c.PhotoSnapTransition.__name__=!0;c.PhotoSnapTransition.doTransition=function(a,e){var d=(b.GameManager.isMobile(),new c.BarbieTransition(a,e));b.GameManager.instance.addGameState(d)};c.PhotoSnapTransition.__super__=b.screenTransition.TransitionScreen;c.PhotoSnapTransition.prototype=m(b.screenTransition.TransitionScreen.prototype,{init:function(){var a=this;b.screenTransition.TransitionScreen.prototype.init.call(this);b.managers.InputManager.getInstance().setInputDisabled(!0);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);this._tweener=new b.components.Tweener(this._uiPanel.getEntity());this._photo=this.addEntity();this._photoUiElement=new b.ui.UiElement(this._photo,this._uiPanel);var e=this.addEntity(),d=this.addEntity();this._photo.addChild(d);this._photo.addChild(e);(new b.components.GameImage(e,"whiteBg",c.Layers.getOrientation())).centerOffsetOnEntity();this._photoImage=new b.components.GameImage(d,"screenSnap",c.Layers.getOrientation());this._photoImage.centerOffsetOnEntity();var d=b.GameManager.instance.getScreenSize().x+40,f=b.GameManager.instance.getScreenSize().y+40;e.setScale(d/10,f/10);b.managers.SoundManager.playSoundByName("ui_camera_1");this._deferredAction=new b.components.DeferredActionComponent(this._photo);this._deferredAction.addDeferredAction(0.6,function(){a.onTransitionMidpoint()});this._cameraFlash=this.addEntity();e=new b.components.GameImage(this._cameraFlash,"whiteBg",c.Layers.getOrientation());e.centerOffsetOnEntity();this._tweener.addTween(e,"_alpha",0,1,0.2,b.components.tween.EasingFunctions.linear,0);this._tweener.addTween(e,"_alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.2,function(){a._cameraFlash.destroy()});(new b.ui.UiElement(this._cameraFlash,this._uiPanel)).setScale(200,200)},onTransitionMidpoint:function(){var a=this;b.screenTransition.TransitionScreen.prototype.onTransitionMidpoint.call(this);switch(c.PhotoSnapTransition._currentTransitionType){case 0:this._tweener.addTween(this._photoUiElement.getScaleRef(),"x",1,1.5,0.65,b.components.tween.EasingFunctions.linear,0);this._tweener.addTween(this._photoUiElement.getScaleRef(),"y",1,1.5,0.65,b.components.tween.EasingFunctions.linear,0);this._tweener.addTween(this._photoUiElement.getCoordsRef(),"x",0,2.5,0.65,b.components.tween.EasingFunctions.easeInQuad,0);this._tweener.addTween(this._photoUiElement.getEntity().getRotationRef(),"z",0,b.utilities.Math2.degToRad(90),0.65,b.components.tween.EasingFunctions.easeInQuad,0,function(){a.onTransitionComplete()});break;case 1:this._tweener.addTween(this._photoUiElement.getScaleRef(),"x",1,1.5,0.65,b.components.tween.EasingFunctions.linear,0);this._tweener.addTween(this._photoUiElement.getScaleRef(),"y",1,1.5,0.65,b.components.tween.EasingFunctions.linear,0);this._tweener.addTween(this._photoUiElement.getCoordsRef(),"x",0,-2.5,0.65,b.components.tween.EasingFunctions.easeInQuad,0);this._tweener.addTween(this._photoUiElement.getEntity().getRotationRef(),"z",0,b.utilities.Math2.degToRad(-90),0.65,b.components.tween.EasingFunctions.easeInQuad,0,function(){a.onTransitionComplete()});break;case 2:this._tweener.addTween(this._photoUiElement.getScaleRef(),"x",1,0,0.65,b.components.tween.EasingFunctions.easeInQuad,0);this._tweener.addTween(this._photoUiElement.getScaleRef(),"y",1,0,0.65,b.components.tween.EasingFunctions.easeInQuad,0);this._tweener.addTween(this._photoUiElement.getEntity().getRotationRef(),"z",0,b.utilities.Math2.degToRad(45),0.65,b.components.tween.EasingFunctions.easeInQuad,0,function(){a.onTransitionComplete()});break;case 3:for(var e=1/3,d=0;3>d;)for(var f=d++,g=0;3>g;){var h=g++,p=this.addEntity(),n=new b.components.GameImage(p,"screenSnap",c.Layers.getOrientation());n.centerOffsetOnEntity();p.setPosition(h*n.getSize().x-2*n.getSize().x/2,f*n.getSize().y-2*n.getSize().y/2);p.setScale(1.01,1.01,1.01);this._photo.addChild(p)}(new b.components.tween.GroupFader(this._photo)).fadeTo(1,0,0.3,null,b.components.tween.EasingFunctions.linear,0.63);this._tweener.addTween(this._photoUiElement.getScaleRef(),"x",1,e,0.3,b.components.tween.EasingFunctions.easeOutCubic,0.33);this._tweener.addTween(this._photoUiElement.getScaleRef(),"y",1,e,0.3,b.components.tween.EasingFunctions.easeOutCubic,0.33);this._tweener.addTween(this._photoUiElement.getEntity().getRotationRef(),"z",0,b.utilities.Math2.degToRad(0),0.3,b.components.tween.EasingFunctions.easeInQuad,0.63,function(){a.onTransitionComplete()})}c.PhotoSnapTransition._currentTransitionType++;1<c.PhotoSnapTransition._currentTransitionType&&(c.PhotoSnapTransition._currentTransitionType=0);b.managers.InputManager.getInstance().setInputDisabled(!1)},postUpdate:function(){b.screenTransition.TransitionScreen.prototype.postUpdate.call(this);null!=this._photoImage&&this._photoImage.centerOffsetOnEntity();this.bringEntityToFront(this._cameraFlash)},__class__:c.PhotoSnapTransition});c.PopUpScreen=function(a,e,d){this._instantYes=!1;b.GameState.call(this);this._pausedState=a;this._bodyText=e;this._onYes=d;d=c.UiFactory.createFullscreenUiPanel(this);e=b.GameManager.instance.getLayerByName("uiFront");a=c.UiFactory.createUiElementEntity(this,d,0,0);this._tweener=new b.components.Tweener(a);var f=this.addEntity();this._overlayImage=new b.components.GameImage(f,"blackSquare",e);this._overlayImage.centerOffsetOnEntity();this._overlayImage.setAlpha(1);(new b.ui.UiElement(f,d)).setScale(150,150);this._tweener.addTween(this._overlayImage,"_alpha",0,0.65,0.35,b.components.tween.EasingFunctions.linear);this.bringEntityToFront(a);(new b.components.GameImage(a,"popupContainer",e)).centerOffsetOnEntity();d=this.addEntity();d.setPosition(0,-45);f=new b.components.TextField(d,e);f.setText(this._bodyText);f.setFontSize("62px");f.setFillStyle("#FFFFFF");f.setFontFamily("agencyfbregular");f.setMaxWidth(500);a.addChild(d);f=this.addEntity();(new b.components.GameImage(f,"logo",c.Layers.getUiFront())).centerOffsetOnEntity();f.setPosition(0,-132);d.addChild(f);d=c.UiFactory.createPulseButtonQuickAbsolute(this,-100,55,"buttonYes","buttonYes",l(this,this.onYesClicked),e,"ui_click_1");this._yesButton=d.getComponent(b.components.Button);e=c.UiFactory.createPulseButtonQuickAbsolute(this,100,55,"buttonNo","buttonNo",l(this,this.onNoClicked),e,"ui_click_1");this._groupFader=new b.components.tween.GroupFader(a);a.addChild(d);a.addChild(e);this._groupFader.fadeTo(0,1,0.35);this._uiElement=a.getComponent(b.ui.UiElement);this._tweener.addTween(this._uiElement.getCoordsRef(),"y",-1,0,0.5,b.components.tween.EasingFunctions.easeOutQuad)};c.PopUpScreen.__name__=!0;c.PopUpScreen.__super__=b.GameState;c.PopUpScreen.prototype=m(b.GameState.prototype,{getInstantYes:function(){return this._instantYes},setInstantYes:function(a){this._instantYes=a;a=this._yesButton.getSiblingComponent(b.components.buttons.ButtonActionDelay);this._instantYes?(this._yesButton.setOnMouseDown(this._onYes),a.setIsActive(!1)):(this._yesButton.setOnMouseDown(null),a.setIsActive(!0))},setYesText:function(a){this._yesText.setText(a)},setNoText:function(a){this._noText.setText(a)},makeYesButtonInstant:function(){var a=this._yesText.getEntity().getParent().getComponent(b.components.buttons.ButtonActionDelay);a.setInstantAction(a.getOnAction());a.setOnAction(null)},init:function(){b.GameState.prototype.init.call(this);b.managers.SoundManager.playSoundByName("ui_swish_1")},onYesClicked:function(){var a=this;this._pausedState.resume();null!=this._onYes&&this._onYes();this._groupFader.fadeTo(1,0,0.35,function(){a.destroy()});this._tweener.addTween(this._uiElement.getCoordsRef(),"y",0,1,0.5,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this._uiElement.getScaleRef(),"x",1,0.5,0.5,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this._uiElement.getScaleRef(),"y",1,0.5,0.5,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this._overlayImage,"_alpha",0.65,0,0.35,b.components.tween.EasingFunctions.linear);b.managers.SoundManager.playSoundByName("ui_swish_2")},onNoClicked:function(){var a=this;this._pausedState.resume();this._groupFader.fadeTo(1,0,0.35,function(){a.destroy()});this._tweener.addTween(this._uiElement.getCoordsRef(),"y",0,1,0.5,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this._uiElement.getScaleRef(),"x",1,0.5,0.5,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this._uiElement.getScaleRef(),"y",1,0.5,0.5,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this._overlayImage,"_alpha",0.65,0,0.35,b.components.tween.EasingFunctions.linear);b.managers.SoundManager.playSoundByName("ui_swish_2")},__class__:c.PopUpScreen});c.PopUpScreenNoInput=function(a){b.GameState.call(this);this._bodyText=a;var e=c.UiFactory.createFullscreenUiPanel(this),d=b.GameManager.instance.getLayerByName("uiFront");a=c.UiFactory.createUiElementEntity(this,e,0,0);this._tweener=new b.components.Tweener(a);var f=this.addEntity();this._overlayImage=new b.components.GameImage(f,"blackSquare",d);this._overlayImage.centerOffsetOnEntity();this._overlayImage.setAlpha(1);(new b.ui.UiElement(f,e)).setScale(150,150);this._tweener.addTween(this._overlayImage,"_alpha",0,0.65,0.35,b.components.tween.EasingFunctions.linear);this.bringEntityToFront(a);(new b.components.GameImage(a,"popupContainer",d)).centerOffsetOnEntity();e=this.addEntity();e.setPosition(0,0);d=new b.components.TextField(e,d);d.setText(this._bodyText);d.setFontSize("62px");d.setFillStyle("#FFFFFF");d.setFontFamily("agencyfbregular");d.setMaxWidth(500);a.addChild(e);d=this.addEntity();(new b.components.GameImage(d,"logo",c.Layers.getUiFront())).centerOffsetOnEntity();d.setPosition(0,-178);e.addChild(d);this._groupFader=new b.components.tween.GroupFader(a);this._groupFader.fadeTo(0,1,0.35);this._uiElement=a.getComponent(b.ui.UiElement);this._tweener.addTween(this._uiElement.getCoordsRef(),"y",-1,0,0.5,b.components.tween.EasingFunctions.easeOutQuad)};c.PopUpScreenNoInput.__name__=!0;c.PopUpScreenNoInput.__super__=b.GameState;c.PopUpScreenNoInput.prototype=m(b.GameState.prototype,{setYesText:function(a){this._yesText.setText(a)},setNoText:function(a){this._noText.setText(a)},makeYesButtonInstant:function(){var a=this._yesText.getEntity().getParent().getComponent(b.components.buttons.ButtonActionDelay);a.setInstantAction(a.getOnAction());a.setOnAction(null)},init:function(){b.GameState.prototype.init.call(this);b.managers.SoundManager.playSoundByName("ui_swish_1")},__class__:c.PopUpScreenNoInput});c.ScreenFraming=function(a,e){var d=this;b.Component.call(this,a,"ScreenFraming");this._uiPanel=a.getComponent(b.ui.UiPanel);this._tweener=new b.components.Tweener(this.getEntity());this._upperFrame=this.getGameState().addEntity();(new b.components.GameImage(this._upperFrame,"uiHeaderBg",c.Layers.getUiFront())).centerOffsetOnEntity();var f=new b.ui.UiElement(this._upperFrame,this._uiPanel);f.setCoords(new b.Vector2D(0,-1));f.setAlignment(b.ui.UiElementHorizontalAlignment.Center,b.ui.UiElementVerticalAlignment.Top);f=this.getGameState().addEntity();(new b.components.GameImage(f,"uiHeaderLogo",c.Layers.getUiFront())).centerOffsetOnEntity();this._upperFrame.addChild(f);f.setPosition(-160,25);this._onHomeButtonClick=e;null==this._onHomeButtonClick&&(this._onHomeButtonClick=function(){c.PhotoSnapTransition.doTransition(d.getGameState(),new c.TitleScreen)});var f=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),368,-15,"homeButton","homeButton",this._onHomeButtonClick,c.Layers.getUiFront(),"ui_click_1",null,!1),g=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),438,-15,"homeButton","homeButton",null,c.Layers.getUiFront(),"ui_click_1",null,!1);this._upperFrame.addChild(f);this._upperFrame.addChild(g);new c.SoundButton(g,"soundButton","soundOffButton")};c.ScreenFraming.__name__=!0;c.ScreenFraming.__super__=b.Component;c.ScreenFraming.prototype=m(b.Component.prototype,{getUpperFrame:function(){return this._upperFrame},getLowerFrame:function(){return this._lowerFrame},getBackground:function(){return this._background},init:function(){b.Component.prototype.init.call(this)},__class__:c.ScreenFraming});c.ScrollBar=function(a,c,d,f,g){null==g&&(g=!0);this._percentage=0;this._isVertical=!0;b.Component.call(this,a,"ScrollBar");this._imageName=c;this._layer=f;this._extents=d;this._isVertical=g;this._gameImage=new b.components.GameImage(this.getEntity(),this._imageName,this._layer);this._gameImage.centerOffsetOnEntity();this._button=new b.components.Button(this.getEntity(),new b.Vector2D(40,125),new b.Vector2D(5,0));this._button.setKillMessageOnMouseDown(!0);this._button.setOnMouseDown(l(this,this.onMouseDown))};c.ScrollBar.__name__=!0;c.ScrollBar.__super__=b.Component;c.ScrollBar.prototype=m(b.Component.prototype,{getPercentage:function(){return this._percentage},setPercentage:function(a){this._percentage=a;this._isVertical?this.getEntity().setPosition(this.getEntity().getLocalPosition().x,this._extents.ul.y+this._extents.wh.y*a):this.getEntity().setPosition(this._extents.ul.x+this._extents.wh.x*a,this.getEntity().getLocalPosition().y)},init:function(){b.Component.prototype.init.call(this)},onMouseDown:function(){this._mouseDownPosition=b.managers.InputManager.getInstance().getMousePosition();this._anchorPosition=this.getEntity().getLocalPosition();b.components.Draggable.releaseDraggables()},onMouseUp:function(){null!=this._mouseDownPosition&&(this._mouseDownPosition=null)},onMouseMove:function(){if(null!=this._mouseDownPosition){b.components.Draggable.releaseDraggables();var a=b.managers.InputManager.getInstance().getMousePosition(),e=a.x-this._mouseDownPosition.x,a=a.y-this._mouseDownPosition.y,d=null;this._isVertical?(d=new b.Vector2D(this.getEntity().getLocalPosition().x,this._anchorPosition.y+a),d.y<this._extents.ul.y&&(d.y=this._extents.ul.y),d.y>this._extents.ul.y+this._extents.wh.y&&(d.y=this._extents.ul.y+this._extents.wh.y)):(d=new b.Vector2D(this._anchorPosition.x+e,this.getEntity().getLocalPosition().y),d.x<this._extents.ul.x&&(d.x=this._extents.ul.x),d.x>this._extents.ul.x+this._extents.wh.x&&(d.x=this._extents.ul.x+this._extents.wh.x));this.getEntity().setPosition(d.x,d.y);this._percentage=(d.y-this._extents.ul.y)/this._extents.wh.y;0>this._percentage&&(this._percentage=0);1<this._percentage&&(this._percentage=1);this.dispatchEvent(new c.ScrollBarUpdateEvent("update",this._percentage))}},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);switch(a){case "mouseUp":this.onMouseUp();break;case "mouseMove":this.onMouseMove()}},__class__:c.ScrollBar});c.ScrollBarUpdateEvent=function(a,c){b.events.Event.call(this,a);this._value=c};c.ScrollBarUpdateEvent.__name__=!0;c.ScrollBarUpdateEvent.__super__=b.events.Event;c.ScrollBarUpdateEvent.prototype=m(b.events.Event.prototype,{getValue:function(){return this._value},__class__:c.ScrollBarUpdateEvent});c.SoundButton=function(a,c,d){b.Component.call(this,a,"SoundButton");this._soundOnImage=c;this._soundOffImage=d};c.SoundButton.__name__=!0;c.SoundButton.__super__=b.Component;c.SoundButton.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._button=this.getEntity().getComponent(b.components.Button);this._buttonActionDelay=this.getEntity().getComponent(b.components.buttons.ButtonActionDelay);this._buttonMouseOverImage=this.getEntity().getComponent(b.components.buttons.ButtonMouseOverImage);this._buttonActionDelay.setInstantAction(l(this,this.onClick))},update:function(){b.Component.prototype.update.call(this);this._buttonMouseOverImage.setDefaultImage(b.managers.SoundManager.getMusicMuted()?this._soundOffImage:this._soundOnImage);this._buttonMouseOverImage.setMouseOverImage(b.managers.SoundManager.getMusicMuted()?this._soundOffImage:this._soundOnImage)},onClick:function(){b.managers.SoundManager.setMusicMuted(!b.managers.SoundManager.getMusicMuted());b.managers.SoundManager.setSoundMuted(b.managers.SoundManager.getMusicMuted())},__class__:c.SoundButton});c.StreamingGameImage=function(a,c,d,f,g){this._isStreaming=this._hasLoaded=!1;b.components.GameImage.call(this,a,c,d,f);this._sourceLoadBatch=g;if(b.managers.AssetManager.assetExists(c))this.onLoadComplete()};c.StreamingGameImage.__name__=!0;c.StreamingGameImage.__super__=b.components.GameImage;c.StreamingGameImage.prototype=m(b.components.GameImage.prototype,{getStreaming:function(){return this._isStreaming},getLoaded:function(){return this._hasLoaded},getImageAsset:function(){if(this._isStreaming)return k.getDocument().createElement("img");if(!b.managers.AssetManager.assetExists(this._imageName)||this._isStreaming){this._isStreaming=!0;this._loadBatch=new b.LoadBatch(!0);var a=this._sourceLoadBatch.getAssetLoadingInfoByAssetName(this._imageName);null==a&&b.utilities.Debug.log("No info found for "+this._imageName);this._loadBatch.addAsset(a.name,a.source,a.type);this._loadBatch.load(l(this,this.onLoadComplete));return k.getDocument().createElement("img")}return b.managers.AssetManager.getAsset(this._imageName)},onLoadComplete:function(){this._isStreaming=!1;this._image=this._cachedSize=null;this._hasLoaded=!0;this.getIsActive()&&!this.getEntity().getIsMarkedForDeletion()&&this.dispatchEvent(new c.StreamingGameImageEvent("loadComplete"))},update:function(){b.components.GameImage.prototype.update.call(this);if(!this._hasLoaded&&b.managers.AssetManager.assetExists(this._imageName))this.onLoadComplete()},render:function(){this._isStreaming||b.components.GameImage.prototype.render.call(this)},init:function(){b.components.GameImage.prototype.init.call(this)},__class__:c.StreamingGameImage});c.StreamingGameImageEvent=function(a){b.events.Event.call(this,a)};c.StreamingGameImageEvent.__name__=!0;c.StreamingGameImageEvent.__super__=b.events.Event;c.StreamingGameImageEvent.prototype=m(b.events.Event.prototype,{__class__:c.StreamingGameImageEvent});c.DisplayType={__ename__:!0,__constructs__:["ComicType","TemplateSelect","StarterSelect"]};c.DisplayType.ComicType=["ComicType",0];c.DisplayType.ComicType.__enum__=c.DisplayType;c.DisplayType.TemplateSelect=["TemplateSelect",1];c.DisplayType.TemplateSelect.__enum__=c.DisplayType;c.DisplayType.StarterSelect=["StarterSelect",2];c.DisplayType.StarterSelect.__enum__=c.DisplayType;c.TemplateSelectScreen=function(){this._levelButtons=[];this._templateIndexOrder=[0,1,2,3,4,5,6,7,8,9,10,11];this._scrollIndex=0;this._buttonScrollRoot=this._buttonScrollRootTweener=null;this._buttonPositions=[new b.Vector2D(-0.5,-0.16),new b.Vector2D(-0,-0.16),new b.Vector2D(0.5,-0.16),new b.Vector2D(-0.5,0.55),new b.Vector2D(-0,0.55),new b.Vector2D(0.5,0.55)];this._isInputEnabled=!0;this._loadingScreen=null;b.GameState.call(this);c.TemplateSelectScreen._instance=this;this._pageRoots=[];this._numPages=Math.floor(c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates().length/this._buttonPositions.length)};c.TemplateSelectScreen.__name__=!0;c.TemplateSelectScreen.getInstance=function(){return c.TemplateSelectScreen._instance};c.TemplateSelectScreen.__super__=b.GameState;c.TemplateSelectScreen.prototype=m(b.GameState.prototype,{postUpdate:function(){b.GameState.prototype.postUpdate.call(this)},showStartSelect:function(){this.clearButtons();this._displayType=c.DisplayType.ComicType;var a=this.addEntity();(new b.ui.UiElement(a,this._uiPanel)).setCoords(new b.Vector2D(-0.5,0));var e=this.addEntity();a.addChild(e);(new b.components.GameImage(e,"templateBlankIcon",c.Layers.getUi())).centerOffsetOnEntity();e=this.addEntity();(new b.ui.UiElement(e,this._uiPanel)).setCoords(new b.Vector2D(-0.5,0.8));var d=new b.components.TextField(e,c.Layers.getUi());d.setText(b.Localizer.getString("COMIC_START_SELECT_BLANK"));d.setFontSize("38px");var d=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.5,0.45,"playButton","playButton",l(this,this.onBlankButtonClick),c.Layers.getUi(),"ui_click_1","",!1,0.05),f=this.addEntity();(new b.ui.UiElement(f,this._uiPanel)).setCoords(new b.Vector2D(0.5,0.1));var g=this.addEntity();f.addChild(g);(new b.components.GameImage(g,"templateStarterIcon",c.Layers.getUi())).centerOffsetOnEntity();var g=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.5,0.45,"playButton","playButton",l(this,this.onStarterButtonClick),c.Layers.getUi(),"ui_click_1","",!1,0.05),h=this.addEntity();(new b.ui.UiElement(h,this._uiPanel)).setCoords(new b.Vector2D(0.5,0.8));var p=new b.components.TextField(h,c.Layers.getUi());p.setText(b.Localizer.getString("COMIC_START_SELECT_STARTER"));p.setFontSize("38px");this._levelButtons.push(a);this._levelButtons.push(f);this._levelButtons.push(d);this._levelButtons.push(g);this._levelButtons.push(e);this._levelButtons.push(h)},onBlankButtonClick:function(){this.showTemplateSelect()},onStarterButtonClick:function(){this.showChallengeSelect()},showTemplateSelect:function(){this._displayType=c.DisplayType.TemplateSelect;this.clearButtons();this.generateTemplateSelectButtons();this._leftScrollEntity.setIsVisible(!0);this._rightScrollEnity.setIsVisible(!0)},showChallengeSelect:function(){this._displayType=c.DisplayType.StarterSelect;this.clearButtons();this.generateStarterSelectButtons()},clearButtons:function(){this._leftScrollEntity.setIsVisible(!1);this._rightScrollEnity.setIsVisible(!1);this._scrollIndex=0;if(null!=this._levelButtons)for(var a=this._levelButtons.length,b=0;b<a;){var c=b++;this._levelButtons[c].destroy()}this._levelButtons=[]},init:function(){b.GameState.prototype.init.call(this);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);var a=b.GameManager.instance.getLayerByName("ui");this._root=this._uiPanel.getEntity();this._deferredAction=new b.components.DeferredActionComponent(this._root);this._buttonScrollRoot=this.addEntity();this._uiPanel.getEntity().addChild(this._buttonScrollRoot);this._buttonScrollRootTweener=new b.components.Tweener(this._buttonScrollRoot);var e=this.addEntity();(new b.components.GameImage(e,"templateSelectBackground",a)).centerOffsetOnEntity();new b.ui.UiElement(e,this._uiPanel);e=this.addEntity();new c.HeadingText(e,b.Localizer.getString("TEMPLATE_SELECT_HEADING"),a);(new b.ui.UiElement(e,this._uiPanel)).setCoords(new b.Vector2D(0,-0.8));c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.85,-0.81,"backButtonLarge","backButtonLarge",l(this,this.onBackButtonClick),a,"ui_click_1","",!1,0.05);this._leftScrollEntity=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.85,0.15,"templateSelectPrevButton","templateSelectPrevButton",l(this,this.onScrollLeftClicked),a,"ui_click_1","",!1,0.05);this._leftScrollEntity.getButton().setKillMessageOnMouseDown(!0);var e=this._leftScrollEntity.getComponent(b.components.buttons.ButtonMouseDownPulse),d=this._leftScrollEntity.getComponent(b.components.buttons.ButtonMouseOverScale);e.disableButton();d.disableButton();this._leftScrollEntity.setIsVisible(!1);this._rightScrollEnity=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.85,0.15,"templateSelectNextButton","templateSelectNextButton",l(this,this.onScrollRightClicked),a,"ui_click_1","",!1,0.05);this._rightScrollEnity.getButton().setKillMessageOnMouseDown(!0);this._rightScrollEnity.setIsVisible(!1);b.managers.SoundManager.playSoundByName("ui_swish_1");this.showStartSelect()},generateTemplateSelectButtons:function(a){null==a&&(a=0);for(var e=this,d=this._levelButtons.length,f=0;f<d;){var g=f++;this._levelButtons[g].destroy()}d=b.GameManager.instance.getLayerByName("ui");f=c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates().length;Math.ceil(f/2);f=0;for(g=this._buttonPositions.length;f<g;){var h=f++,p=[this._templateIndexOrder[a*this._buttonPositions.length+h]];if(null!=c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates()[p[0]]){var n=this._buttonPositions[h],k=c.UiFactory.createPulseButtonQuick(this._uiPanel,n.x,n.y,"frameLayoutThumbnail"+(p[0]+1),"frameLayoutThumbnail"+(p[0]+1),function(a){return function(a){return function(){e.onLevelClick(e._templateIndexOrder[a[0]])}}(p)}(this),d,"ui_click_1","",!1),n=k.getComponent(b.ui.UiElement);this._levelButtons.push(k);k.setName("levelButton"+(h+1));k.getComponent(b.components.GameImage).setAlpha(0);this._buttonScrollRoot.addChild(k);(new b.components.tween.GroupFader(k)).fadeTo(0,1,0.35,null,b.components.tween.EasingFunctions.linear,0.15+0.05*h);k=new b.components.Tweener(k);k.addTween(n.getScaleRef(),"x",1.45,1,0.5,b.components.tween.EasingFunctions.easeOutBack,0.15+0.05*h);k.addTween(n.getScaleRef(),"y",1.45,1,0.5,b.components.tween.EasingFunctions.easeOutBack,0.15+0.05*h)}}},generateStarterSelectButtons:function(a){null==a&&(a=0);for(var e=this,d=this._levelButtons.length,f=0;f<d;){var g=f++;this._levelButtons[g].destroy()}d=b.GameManager.instance.getLayerByName("ui");f=c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates().length;Math.ceil(f/2);f=0;for(g=this._buttonPositions.length;f<g;){var h=f++,p=[this._templateIndexOrder[a*this._buttonPositions.length+h]],n=c.challenges.ChallengeManager.getInstance().getChallenges()[p[0]];if(null!=n){var k=this._buttonPositions[h],k=c.UiFactory.createPulseButtonQuick(this._uiPanel,k.x,k.y,n.getThumbnail(),n.getThumbnail(),function(a){return function(a){return function(){e.onStarterClick(e._templateIndexOrder[a[0]])}}(p)}(this),d,"ui_click_1","",!1),n=k.getComponent(b.ui.UiElement);this._levelButtons.push(k);k.setName("levelButton"+(h+1));k.getComponent(b.components.GameImage).setAlpha(0);this._buttonScrollRoot.addChild(k);(new b.components.tween.GroupFader(k)).fadeTo(0,1,0.35,null,b.components.tween.EasingFunctions.linear,0.15+0.05*h);k=new b.components.Tweener(k);k.addTween(n.getScaleRef(),"x",1.45,1,0.5,b.components.tween.EasingFunctions.easeOutBack,0.15+0.05*h);k.addTween(n.getScaleRef(),"y",1.45,1,0.5,b.components.tween.EasingFunctions.easeOutBack,0.15+0.05*h)}}},updateScrollBtn:function(a,c,d,f){if(null!=a){var g=a.getComponent(b.components.buttons.ButtonMouseOverImage),h=a.getComponent(b.components.buttons.ButtonMouseOverScale);a=a.getComponent(b.components.buttons.ButtonMouseDownPulse);this._scrollIndex==f?(g.setDefaultImage(c),g.setMouseOverImage(c),h.disableButton(),a.disableButton()):(g.setDefaultImage(d),g.setMouseOverImage(d),h.enableButton(),a.enableButton())}},onScrollLeftClicked:function(){this._isInputEnabled&&0!=this._scrollIndex&&(this._scrollIndex--,this.updateScrollBtn(this._leftScrollEntity,"templateSelectPrevButton","templateSelectPrevButton",0),this.updateScrollBtn(this._rightScrollEnity,"templateSelectNextButton","templateSelectNextButton",this._numPages),this.generateTemplateSelectButtons(this._scrollIndex))},onScrollRightClicked:function(){this._isInputEnabled&&this._scrollIndex!=this._numPages-1&&(this._scrollIndex++,this.updateScrollBtn(this._rightScrollEnity,"templateSelectNextButton","templateSelectNextButton",this._numPages),this.updateScrollBtn(this._leftScrollEntity,"templateSelectPrevButton","templateSelectPrevButton",0),this.generateTemplateSelectButtons(this._scrollIndex))},onLevelClick:function(a){if(this._isInputEnabled){var e=this._levelButtons[0];new b.components.Tweener(e);e.getComponent(b.ui.UiElement);e.getComponent(b.components.Button).destroy();c.levels.LevelManager.getInstance().setCurrentLevelIndex(a);c.GameTracker.getInstance().setCurrentLevelNumber(a+1);a=c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplates()[a];c.GameTracker.getInstance().setCurrentComicComposition(new c.comicCreator.comicCompositions.ComicComposition("",a.getId()));this.gotoPhotoSelect();this._isInputEnabled=!1}},onStarterClick:function(a){if(this._isInputEnabled){var e=this._levelButtons[0];new b.components.Tweener(e);e.getComponent(b.ui.UiElement);e.getComponent(b.components.Button).destroy();c.levels.LevelManager.getInstance().setCurrentLevelIndex(a);c.GameTracker.getInstance().setCurrentLevelNumber(a+1);a=c.challenges.ChallengeManager.getInstance().getChallenges()[a];a=c.comicCreator.comicCompositions.ComicCompositionManager.getInstance().getCompositionById(a.getCompositionId());c.GameTracker.getInstance().setCurrentComicComposition(a);this.gotoPhotoSelect();this._isInputEnabled=!1}},gotoPhotoSelect:function(){var a=new c.comicCreator.ComicCreatorState;c.PhotoSnapTransition.doTransition(this,a);c.comicCreator.FilterUndoManager.getInstance().reset()},gotoComicCreator:function(){this._loadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(this,this._loadingScreen);b.managers.AssetManager.getAsset("comicCreatorAssets").load(l(this,this.onComicCreatorAssetsLoad))},onComicCreatorAssetsLoad:function(){var a=this;this._loadingScreen.addDelay(1,function(){c.PhotoSnapTransition.doTransition(a._loadingScreen,new c.comicCreator.ComicCreatorState)})},onBackButtonClick:function(){this._isInputEnabled&&(this._displayType==c.DisplayType.ComicType?(c.PhotoSnapTransition.doTransition(this,new c.TitleScreen),this._isInputEnabled=!1):this.showStartSelect())},enableLevelButtonByIndex:function(a){this._levelButtons[a].getComponent(b.components.Button).setIsActive(!0);this._levelButtons[a].getComponent(b.components.Tweener).getTweenByProperty("_alpha")._end=1},disableLevelButtonByIndex:function(a){this._levelButtons[a].getComponent(b.components.Button).setIsActive(!1);this._levelButtons[a].getComponent(b.components.Tweener).getTweenByProperty("_alpha")._end=0.35},templateListMaskFunction:function(a){a.beginPath();var c=new b.Vector3D(512,384);a.moveTo(c.x-460,c.y-255);a.lineTo(c.x+458,c.y-255);a.lineTo(c.x+458,c.y+329);a.lineTo(c.x-460,c.y+329);a.closePath()},challengeBurstMaskFunction:function(a){a.beginPath();var c=new b.Vector3D(512,384);a.moveTo(c.x-460,c.y-255);a.lineTo(c.x+458,c.y-255);a.lineTo(c.x+458,c.y+330);a.lineTo(c.x-460,c.y+330);a.closePath()},destroy:function(){b.GameState.prototype.destroy.call(this);c.TemplateSelectScreen._instance==this&&(c.TemplateSelectScreen._instance=null)},__class__:c.TemplateSelectScreen});c.TitleScreen=function(){this._inputEnabled=!0;b.GameState.call(this)};c.TitleScreen.__name__=!0;c.TitleScreen.__super__=b.GameState;c.TitleScreen.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);this._root=this.addEntity();b.managers.AssetManager.unloadLoadBatch("comicCreatorAssets");b.managers.AssetManager.unloadLoadBatch("streamingAssets");this._newestChallenge=c.challenges.ChallengeManager.getInstance().getLatestChallenge();this.createMenuScreen();b.managers.SoundManager.playMusicByName("music_decisions")},onValueChange:function(a){},createMenuScreen:function(){var a=c.UiFactory.createFullscreenUiPanel(this),e=b.GameManager.instance.getLayerByName("ui"),d=this.addEntity();(new b.components.GameImage(d,"splashImage",e)).centerOffsetOnEntity();(new b.ui.UiElement(d,a)).setCoords(new b.Vector2D(-0.35,0.15));d=this.addEntity();(new b.components.GameImage(d,"splashFrame",e)).centerOffsetOnEntity();(new b.ui.UiElement(d,a)).setCoords(new b.Vector2D(0,0));c.UiFactory.createPulseButtonQuick(a,0.81,0.71,"splashPlayButton","splashPlayButton",null,c.Layers.getUi(),"ui_click_1","",!1,0.1,l(this,this.onPlayButtonClicked));a=c.UiFactory.createPulseButtonQuick(a,0.61,0.81,"soundButton","soundButton",null,c.Layers.getUi(),"ui_click_1",null,!1);new c.SoundButton(a,"soundButton","soundOffButton")},onPlayButtonClicked:function(){this._inputEnabled&&(this.gotoLevelSelect(),this._inputEnabled=!1,c.utag.UtagManager.getInstance().link2("games","play","[Game Title]","[Game Title]"))},gotoComicTypeSelect:function(){this._comicStartSelectState=new c.ComicStartSelectState;b.GameManager.instance.addGameState(this._comicStartSelectState);this._comicStartSelectState.addEventListener("selectBlank",l(this,this.onBlankSelect));this._comicStartSelectState.addEventListener("selectStarter",l(this,this.onStarterSelect))},gotoComicStarterSelect:function(){this._loadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(this,this._loadingScreen);b.managers.AssetManager.getAsset("comicCreatorAssets").load(l(this,this.onComicStarterSelectAssetsLoad))},gotoLevelSelect:function(){this._loadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(this,this._loadingScreen);b.managers.AssetManager.getAsset("comicCreatorAssets").load(l(this,this.onLevelSelectAssetsLoad))},onLevelSelectAssetsLoad:function(){var a=this;this._loadingScreen.addDelay(1,function(b){return function(){c.PhotoSnapTransition.doTransition(a._loadingScreen,new c.TemplateSelectScreen)}}(this))},onComicStarterSelectAssetsLoad:function(){var a=this;this._loadingScreen.addDelay(1,function(b){return function(){c.PhotoSnapTransition.doTransition(a._loadingScreen,new c.ComicStarterSelectScreen)}}(this))},onSoundButtonClick:function(){this._inputEnabled&&(b.managers.SoundManager.setMusicMuted(!b.managers.SoundManager.getMusicMuted()),b.managers.SoundManager.setSoundMuted(b.managers.SoundManager.getMusicMuted()),this.updateSoundIcon())},gotoComic:function(){c.GameTracker.getInstance().setCurrentComicComposition(c.comicCreator.comicCompositions.ComicCompositionManager.getInstance().getCompositionById(this._newestChallenge.getCompositionId()));this._loadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(this,this._loadingScreen);b.managers.AssetManager.getAsset("comicCreatorAssets").load(l(this,this.onComicCreatorAssetsLoad))},onComicCreatorAssetsLoad:function(){var a=this;this._loadingScreen.addDelay(1,function(b){return function(){c.PhotoSnapTransition.doTransition(a._loadingScreen,new c.comicCreator.ComicCreatorState)}}(this))},update:function(){b.GameState.prototype.update.call(this)},onBlankSelect:function(a){this._comicStartSelectState.destroy();this._inputEnabled=!0;this.gotoLevelSelect()},onStarterSelect:function(a){this._comicStartSelectState.destroy();this._inputEnabled=!0;this.gotoComicStarterSelect()},gotoTemplateSelect:function(){c.PhotoSnapTransition.doTransition(this,new c.TemplateSelectScreen)},updateSoundIcon:function(){var a=this._soundButton.getComponent(b.components.buttons.ButtonMouseOverImage);a.setDefaultImage(b.managers.SoundManager.getMusicMuted()?"splashSoundButtonOff":"splashSoundButtonOn");a.setMouseOverImage(b.managers.SoundManager.getMusicMuted()?"splashSoundButtonOff":"splashSoundButtonOn")},windowMaskNoCamera:function(a){a.beginPath();var c=this._challengeWindow.getPosition(),d=new b.Vector3D(0,0,0);c.x+=d.x;c.y+=d.y;a.moveTo(c.x,c.y+40);a.lineTo(c.x+499,c.y+7);a.lineTo(c.x+466,c.y+309);a.lineTo(c.x,c.y+309);a.fill();a.closePath()},restartMusic:function(){"splashSoundButtonOn"==this._soundButton.getComponent(b.components.buttons.ButtonMouseOverImage).getImageName()?b.managers.SoundManager.setMusicMuted(!1):b.managers.SoundManager.setMusicMuted(!0)},__class__:c.TitleScreen});c.UiFactory=function(){};c.UiFactory.__name__=!0;c.UiFactory.createFullscreenUiPanel=function(a){var c=b.GameManager.instance.getScreenSize(),d=c.getClone();c.x*=b.GameManager.instance.getScreenScale().x;c.y*=b.GameManager.instance.getScreenScale().y;a=a.addEntity();c=new b.ui.UiPanel(a,c);a.setPosition(d.x/2,d.y/2);return c};c.UiFactory.createPulseButton=function(a,c,d,f,g,h,p,k,l,m,r,q,s,t,u,w,v){var x=b.GameEntity.instantiate(a.getGameState());(new b.ui.UiElement(x,a)).setCoords(new b.Vector2D(c,d));a=new b.components.GameImage(x,l,v);b.components.Button.createFromGameImage(a);new b.components.buttons.ButtonMouseDownPulse(x,f,g,h,t);new b.components.buttons.ButtonMouseOverScale(x,p,k,b.components.tween.EasingFunctions.easeOutQuint,b.components.tween.EasingFunctions.easeOutQuint);new b.components.buttons.ButtonActionDelay(x,r,q,s);new b.components.buttons.ButtonMouseOverImage(x,l,m);new b.components.buttons.ButtonSoundPlay(x,u,w);return x};c.UiFactory.createPulseButtonQuick=function(a,b,d,f,g,h,p,k,l,m,r,q){null==r&&(r=0.35);null==m&&(m=!0);null==l&&(l="");null==k&&(k="");return c.UiFactory.createPulseButton(a,b,d,0.25,1,0.15,1.15,0.25,f,g,h,r,q,m,k,l,p)};c.UiFactory.createPulseButtonAbsolute=function(a,c,d,f,g,h,k,n,l,m,r,q,s,t,u,w,v){a=b.GameEntity.instantiate(a);a.setPosition(c,d);c=new b.components.GameImage(a,l,v);b.components.Button.createFromGameImage(c);new b.components.buttons.ButtonMouseDownPulse(a,f,g,h,t);new b.components.buttons.ButtonMouseOverScale(a,k,n,b.components.tween.EasingFunctions.easeOutQuint,b.components.tween.EasingFunctions.easeOutQuint);new b.components.buttons.ButtonActionDelay(a,r,q,s);new b.components.buttons.ButtonMouseOverImage(a,l,m);new b.components.buttons.ButtonSoundPlay(a,u,w);return a};c.UiFactory.createPulseButtonQuickAbsolute=function(a,b,d,f,g,h,k,n,l,m,r,q){null==r&&(r=0.35);null==m&&(m=!0);null==l&&(l="");null==n&&(n="");return c.UiFactory.createPulseButtonAbsolute(a,b,d,0.25,1,0.15,1.15,0.25,f,g,h,r,q,m,n,l,k)};c.UiFactory.createTextButton=function(a,e,d,f,g,h,k,n,l,m,r){null==m&&(m=!0);null==l&&(l="");null==n&&(n="");var q=g.getGameState();a=c.UiFactory.createPulseButtonQuick(g,a,e,f,f,k,h,n,l,m,0.25,r);q=q.addEntity();q.setPosition(0,-5);h=new b.components.TextField(q,h);h.setText(b.Localizer.getString(d));h.setFontFamily("agencyfbregular");h.setFillStyle("#FFFFFF");h.setFontSize("36px");a.addChild(q);return a.getComponent(b.ui.UiElement)};c.UiFactory.createUiElementEntity=function(a,c,d,f){a=a.addEntity();(new b.ui.UiElement(a,c)).setCoords(new b.Vector2D(d,f));return a};c.UiFactory.createUiElementEntityImage=function(a,e,d,f,g,h,k){null==k&&(k=!0);null==h&&(h="default");a=c.UiFactory.createUiElementEntity(a,e,d,f);""!=g&&(g=new b.components.GameImage(a,g,b.GameManager.instance.getLayerByName(h)),k&&g.centerOffsetOnEntity());return a};c.UiFactory.prototype={__class__:c.UiFactory};c.UserData=function(){this._compositionThumbnails=[];this._compositions=[];this._compositions=[]};c.UserData.__name__=!0;c.UserData.prototype={getCompositionThumbnails:function(){return this._compositionThumbnails},getCompositionThumbnailByindex:function(a){return this._compositionThumbnails[a].src},setCompositionThumbnailByIndex:function(a,e){this._compositionThumbnails[a]=e;b.managers.AssetManager.registerAsset("comicCompositionThumbnail"+a+"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex(),e)},getCompositions:function(){return this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()]},getCompositionByIndex:function(a){null==this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()]&&(this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()]=[]);return this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()][a]},setCompositionByIndex:function(a,b){null==this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()]&&(this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()]=[]);this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()][a]=b},getCurrentCompositionIndex:function(){return this._currentCompositionIndex},setCurrentCompositionIndex:function(a){this._currentCompositionIndex=a},allTemplatesEdited:function(){for(var a=c.levels.LevelManager.getInstance().getCurrentLevel().getTemplates().length,b=0;b<a;){var d=b++;if(null==this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()])return null==this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()],!1;if(null==this._compositions[c.levels.LevelManager.getInstance().getCurrentLevelIndex()][d])return!1}return!0},resetCompositions:function(){this._compositions=[];if(null!=this._compositionThumbnails)for(var a=this._compositionThumbnails.length,e=0;e<a;){var d=e++;b.managers.AssetManager.unloadAsset("comicCompositionThumbnail"+d+"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex())}this._compositionThumbnails=[]},__class__:c.UserData};c.boot={};c.boot.BootState=function(){b.GameState.call(this)};c.boot.BootState.__name__=!0;c.boot.BootState.__super__=b.GameState;c.boot.BootState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);this._gameManager=b.GameManager.instance;var a=new b.managers.PhysicsManager;this._gameManager.addManager(a);a=new b.managers.InputManager;this._gameManager.addManager(a);var c=new b.managers.FontManager;this._gameManager.addManager(c);c=new b.managers.DebugManager;this._gameManager.addManager(c);c=new b.managers.VoManager;this._gameManager.addManager(c);c=new b.speechManager.SpeechManager;this._gameManager.addManager(c);c=new b.managers.AccelerometerManager;this._gameManager.addManager(c);a.disablePageKeyPresses();this.initLayers();this.getAssetsList()},getAssetsList:function(){var a=new b.LoadBatch;a.addAsset("assetList",k.dataBaseUrl+"asset_list.xml",b.AssetType.Other);a.addAsset("strings",k.dataBaseUrl+"./locale/"+k.dataLocale+"/strings.xml",b.AssetType.Other);a.addAsset("gameConfig",k.dataBaseUrl+"game_config.xml",b.AssetType.Other);a.addAsset("styleSheet",k.dataBaseUrl+"./locale/"+k.dataLocale+"/css/style.css",b.AssetType.Css);a.addAsset("styleSheet",k.dataBaseUrl+"./locale/"+k.dataLocale+"/css/game.css",b.AssetType.Css);a.addAsset("fonts",k.dataBaseUrl+"./locale/"+k.dataLocale+"/css/stylesheet.css",b.AssetType.Css);a.addAsset("speechMap",k.dataBaseUrl+"./media/xml/speech_map.xml",b.AssetType.Other);a.addAsset("soundManager",k.dataBaseUrl+"./js/soundmanager2-nodebug-jsmin.js",b.AssetType.Javascript);a.addAsset("ipadLandscapeHtml",k.dataBaseUrl+"./media/html/ipad_landscape.html",b.AssetType.Other);a.addAsset("iphoneLandscapeHtml",k.dataBaseUrl+
"./media/html/iphone_landscape.html",b.AssetType.Other);a.load(l(this,this.onAssetListLoaded))},onAssetListLoaded:function(){b.GameConfig.parseGameConfig(b.managers.AssetManager.getAsset("gameConfig"));b.Localizer.initStrings();b.speechManager.SpeechManager.getInstance().setup();if(b.GameManager.isMobile()||"NONE"!=b.GameConfig.getProperty("forceOrientation")){var a=new b.gameStates.OrientationState;this._gameManager.addGameState(a);b.GameManager.instance.onOrientationChanged()}a=b.managers.AssetManager.getAsset("assetList");for(a=s.parse(a).elementsNamed("loadBatches").next().elementsNamed("loadBatch");a.hasNext();){for(var c=new b.LoadBatch,d=a.next(),f=k.dataBaseUrl+d.get("basePath"),g=d.elementsNamed("asset");g.hasNext();){var h=g.next();c.addAsset(h.get("name"),f+h.get("path"),y.createEnum(b.AssetType,h.get("type")))}b.managers.AssetManager.registerAsset(d.get("name"),c)}b.managers.AssetManager.getAsset("loadScreenBatchPreload").load(l(this,this.onLoadScreenPreloadComplete))},onLoadScreenPreloadComplete:function(){this._loadingScreen=new c.LoadingScreen;this._gameManager.addGameState(this._loadingScreen);this._gameManager.onResizeWindow();var a=new c.comicTemplates.ComicTemplateManager;this._gameManager.addManager(a);a=new c.comicCreator.comicAssets.ComicAssetManager;this._gameManager.addManager(a);a=new c.comicCreator.comicCompositions.ComicCompositionManager;this._gameManager.addManager(a);a=new c.challenges.ChallengeManager;this._gameManager.addManager(a);a=new c.utag.UtagManager;this._gameManager.addManager(a);a=b.managers.AssetManager.getAsset("loadBatchPreload");a.concatLoadBatch(b.managers.AssetManager.getAsset("menusLoadBatch"));a.load(l(this,this.onPreloadComplete))},onPreloadComplete:function(){this.destroy();b.GameManager.instance.addManager(new c.comicCreator.PhotoManager);c.PhotoSnapTransition.doTransition(this._loadingScreen,new c.TitleScreen)},initLayers:function(){this._gameManager.addLayer(new b.Layer("master",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE,null,!0));this._gameManager.addLayer(new b.Layer("defaultBg",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE));this._gameManager.addLayer(new b.Layer("default",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE));this._gameManager.addLayer(new b.Layer("ui",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE));this._gameManager.addLayer(new b.Layer("uiFront",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE));this._gameManager.addLayer(new b.Layer("orientation",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE));this._gameManager.addLayer(new b.Layer("debug",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE))},__class__:c.boot.BootState});c.challenges={};c.challenges.Challenge=function(a,b,c,f,g,h,k,n){this._id=a;this._title=b;this._compositionId=c;this._youtubeId=f;this._thumbnail=g;this._printable=h;this._printableThumbnail=k;this._available=n};c.challenges.Challenge.__name__=!0;c.challenges.Challenge.getFromXmlNode=function(a){var b=a.get("id"),d=a.get("title"),f=a.get("compositionId"),g=a.get("youtubeId"),h=a.get("thumbnail"),k=a.get("printable"),n=a.get("printableThumbnail");a="TRUE"==a.get("available").toUpperCase()?!0:!1;return new c.challenges.Challenge(b,d,f,g,h,k,n,a)};c.challenges.Challenge.prototype={getId:function(){return this._id},getTitle:function(){return this._title},getCompositionId:function(){return this._compositionId},getYoutubeId:function(){return this._youtubeId},getThumbnail:function(){return this._thumbnail},getPrintable:function(){return this._printable},getPrintableThumbnail:function(){return this._printableThumbnail},getAvailable:function(){return this._available},__class__:c.challenges.Challenge};c.challenges.ChallengeManager=function(){b.Manager.call(this);c.challenges.ChallengeManager._instance=this;this._challenges=[];for(var a=s.parse(b.managers.AssetManager.getAsset("comicChallenges")).firstChild().elementsNamed("challenge");a.hasNext();){var e=a.next(),e=c.challenges.Challenge.getFromXmlNode(e);this._challenges.push(e)}};c.challenges.ChallengeManager.__name__=!0;c.challenges.ChallengeManager.getInstance=function(){return c.challenges.ChallengeManager._instance};c.challenges.ChallengeManager.__super__=b.Manager;c.challenges.ChallengeManager.prototype=m(b.Manager.prototype,{getChallenges:function(){return this._challenges},isChallengeAvailable:function(a){for(var b=this.getAvailableChallenges(),c=b.length,f=0;f<c;){var g=f++;if(b[g].getId()==a)return!0}return!1},getAvailableChallenges:function(){for(var a=[],b=this._challenges.length,c=0;c<b;){var f=c++;this._challenges[f].getAvailable()&&a.push(this._challenges[f])}return a},getUnavailableChallenges:function(){for(var a=[],b=this._challenges.length,c=0;c<b;){var f=c++;this._challenges[f].getAvailable()||a.push(this._challenges[f])}return a},getLatestChallenge:function(){var a=this.getAvailableChallenges();return a[a.length-1]},getChallengeByCompositionId:function(a){for(var b=this._challenges.length,c=0;c<b;){var f=c++,f=this._challenges[f];if(f.getCompositionId()==a)return f}return null},__class__:c.challenges.ChallengeManager});c.comicCreator={};c.comicCreator.Comic=function(a,c,d,f,g,h){this._allowPanelSwitching=!0;this._paneClickRect=null;this._selectedPanel=-1;b.Component.call(this,a,"Comic");this._paneLayer=c;this._comicPanes=[];this._camera=f;this._maskingFunction=g;this._maskingFunctionLocal=h;this.generateTemplate(d)};c.comicCreator.Comic.__name__=!0;c.comicCreator.Comic.__super__=b.Component;c.comicCreator.Comic.prototype=m(b.Component.prototype,{getCamera:function(){return this._camera},getComicTemplate:function(){return this._template},getPaneClickRect:function(){return this._paneClickRect},setPaneClickRect:function(a){this._paneClickRect=a},getPaneLayer:function(){return this._paneLayer},getPanes:function(){return this._comicPanes},getCurrentComicPane:function(){return-1==this._selectedPanel?null:this._comicPanes[this._selectedPanel]},generateTemplate:function(a){this._template=a;var b=this.getGameState().addEntity(),d=new c.StreamingGameImage(b,"greyBg",this.getPaneLayer(),this._camera,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch());d.setMaskFunction(this._maskingFunction);d.setOffset(a.getBackgroundOffsetX(),a.getBackgroundOffsetY());b.setScale(1/d.getSize().x*a.getWidth(),1/d.getSize().y*a.getHeight());this.getEntity().addChild(b);b=a.getComicPanels().length;for(d=0;d<b;){var f=d++,g=a.getComicPanels()[f],f=c.comicCreator.ComicCreatorFactory.createComicPane(this.getGameState(),this.getPaneLayer(),g,f,this._camera,this._maskingFunctionLocal);this.getEntity().addChild(f.getEntity());f.addEventListener("click",l(this,this.onComicPaneClick));f.addEventListener("sceneEntitySelected",l(this,this.onComicPaneSceneEntitySelected));f.addEventListener("sceneEntityDeselected",l(this,this.onComicPaneSceneEntityDeselected));this._comicPanes.push(f)}},onComicPaneSceneEntityDeselected:function(a){if(null!=this.getGameState()){a=this.getCurrentComicPane();for(var b=this._comicPanes.length,c=0;c<b;){var f=c++,f=this._comicPanes[f];a!=f&&this.getGameState().bringEntityToFront(f.getEntity(),!0)}}},enableEditing:function(){for(var a=this._comicPanes.length,b=0;b<a;){var c=b++;this._comicPanes[c].setEditable(!0)}},disableEditing:function(){for(var a=this._comicPanes.length,b=0;b<a;){var c=b++;this._comicPanes[c].setEditable(!1)}},stopAnimations:function(){for(var a=this._comicPanes.length,b=0;b<a;){var c=b++;this._comicPanes[c].stopAnimations(!0)}},resumeAnimations:function(){for(var a=this._comicPanes.length,b=0;b<a;){var c=b++;this._comicPanes[c].resumeAnimations()}},onComicPaneClick:function(a){var c=b.managers.InputManager.getInstance().getMousePosition();(null==this._paneClickRect||this._paneClickRect.containsPoint(c))&&this.selectPaneByIndex(a.target.getIndex())},onComicPaneSceneEntitySelected:function(a){var b=this.getCurrentComicPane();a=a.getSceneEntitySelected();null!=b&&null!=a&&this._allowPanelSwitching&&b.getIndex()!=a.getPaneIndex()&&this.selectPaneByIndex(a.getPaneIndex())},prevPane:function(){this.selectPaneByIndex(this._selectedPanel-1);this._comicPanes[this._selectedPanel].unlockPaneForEditing()},nextPane:function(){this.selectPaneByIndex(this._selectedPanel+1);this._comicPanes[this._selectedPanel].unlockPaneForEditing()},selectPaneByIndex:function(a){0>a||a>this._comicPanes.length-1||this._selectedPanel==a||(-1!=this._selectedPanel&&this._comicPanes[this._selectedPanel].deselect(),this._selectedPanel=a,this._comicPanes[this._selectedPanel].select(),this.dispatchEvent(new c.comicCreator.ComicPanelSelectEvent("paneSelect",this._comicPanes[a],a)))},getComposition:function(){for(var a=new c.comicCreator.comicCompositions.ComicComposition(c.GameTracker.getInstance().getCurrentComicComposition().getId(),c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getId()),b=this._comicPanes.length,d=0;d<b;){for(var f=d++,g=this._comicPanes[f],h=g.getPlacements(),k=h.length,n=0;n<k;){var l=n++;a.addPlacement(h[l])}h=g.getContentRoot().getLocalPosition();g=g.getContentRoot().getScaleRef();g=new c.comicCreator.comicCompositions.ComicPanelOffset(h.x,h.y,g.x,g.y);a.getComicPanelOffsets()[f]=g}return a},showAllPanes:function(){for(var a=this._comicPanes.length,b=0;b<a;){var c=b++;this._comicPanes[c].unlockPaneForEditing(!0)}},renderToCanvas:function(a){var c=this.getEntity().getPosition();b.GameManager.instance.render();a.getContext("2d").fillStyle="#231f20";a.getContext("2d").fillRect(this.getEntity().getPosition().x,this.getEntity().getPosition().y,this._template.getWidth()*this.getEntity().getScale().x,this._template.getHeight()*this.getEntity().getScale().y);for(var d=this._comicPanes.length,f=0;f<d;){var g=f++;this._comicPanes[g].getTargetLayer().copyToCanvas(a)}this.getEntity().setPosition(c.x,c.y)},imageElementCapture:function(a){var e=new c.comicCreator.ComicCaptureState(this);b.GameManager.instance.addGameState(e);e.addEventListener("capture",a)},onCapture:function(a){},generateFromComposition:function(a){for(var b=a.getPlacements().length,d=0;d<b;){var f=d++,f=a.getPlacements()[f],g=this._comicPanes[f.getPaneIndex()],h=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getAssetDefinitionByName(f.getAssetName());null!=h&&(h=g.addSceneEntity(h,f.getX(),f.getY(),this._paneLayer,!1),h.getEntity().setRotation(0,0,f.getRotation()),h.getEntity().setScale(f.getScaleX(),f.getScaleY()),g.unlockPaneForEditing(!0),g.fadeOutBlackOverlay())}b=a.getComicPanelOffsets().length;for(d=0;d<b;)f=d++,g=this._comicPanes[f],h=a.getComicPanelOffsets()[f],g.getContentRoot().setPosition(h.x,h.y),g.getContentRoot().setScale(h.scaleX,h.scaleY),new c.comicCreator.ContentDraggablePanel(g.getEntity(),this,f)},renderToLayer:function(a){a.clear();a.getCanvas().getContext("2d").fillStyle="#231f20";a.getCanvas().getContext("2d").fillRect(0,0,this._template.getWidth(),this._template.getHeight());for(var b=this._comicPanes.length,c=0;c<b;){var f=c++;this._comicPanes[f].getTargetLayer().copyToCanvas(a.getCanvas())}k.getWindow().open(a.getCanvas().toDataURL("image/png"),"_blank","")},__class__:c.comicCreator.Comic});c.comicCreator.ComicCaptureEvent=function(a,c){this._data="";b.events.Event.call(this,a);this._data=c};c.comicCreator.ComicCaptureEvent.__name__=!0;c.comicCreator.ComicCaptureEvent.__super__=b.events.Event;c.comicCreator.ComicCaptureEvent.prototype=m(b.events.Event.prototype,{getData:function(){return this._data},__class__:c.comicCreator.ComicCaptureEvent});c.comicCreator.ComicCaptureState=function(a){this._waitFrames=3;b.GameState.call(this);var e=this.addEntity();this._comicWidth=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getWidth();this._comicHeight=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getHeight();this._tempLayer=new b.Layer("temp",this._comicWidth,this._comicHeight);b.GameManager.instance.addLayer(this._tempLayer,!0);this._comic=new c.comicCreator.Comic(e,this._tempLayer,a.getComposition().getComicTemplateDefinition());this._comic.generateFromComposition(a.getComposition());this._comic.showAllPanes();this._canvas=k.getDocument().createElement("canvas");this._canvas.width=this._comicWidth;this._canvas.height=this._comicHeight;this._canvas.setAttribute("webkitTransform","translate3d(0px, 0px, 0px);");this._canvas.style.position="absolute";this.init();for(a=0;100>a;)a++,this.update()};c.comicCreator.ComicCaptureState.__name__=!0;c.comicCreator.ComicCaptureState.__super__=b.GameState;c.comicCreator.ComicCaptureState.prototype=m(b.GameState.prototype,{render:function(){b.GameState.prototype.render.call(this);this._waitFrames--;if(0==this._waitFrames){this._comic.renderToCanvas(this._canvas);var a=this._canvas.toDataURL("image/jpeg");this._tempLayer.destroy();this.dispatchEvent(new c.comicCreator.ComicCaptureEvent("capture",a));this.destroy()}},__class__:c.comicCreator.ComicCaptureState});c.comicCreator.ComicCreator=function(a){this._isDragging=this._isManipulatingEntity=this._canDragCamera=!1;b.Component.call(this,a,"ComicCreator")};c.comicCreator.ComicCreator.__name__=!0;c.comicCreator.ComicCreator.returnToComicCreatorState=function(a){c.comicCreator.ComicCreator._staticLoadingScreen=new c.LoadingScreen;c.PhotoSnapTransition.doTransition(a,c.comicCreator.ComicCreator._staticLoadingScreen);b.managers.AssetManager.getAsset("comicCreatorAssets").load(c.comicCreator.ComicCreator.onComicCreatorLoad)};c.comicCreator.ComicCreator.onComicCreatorLoad=function(){b.managers.AssetManager.unloadLoadBatch("streamingAssets");c.comicCreator.ComicCreator._staticLoadingScreen.addDelay(1,function(){c.PhotoSnapTransition.doTransition(c.comicCreator.ComicCreator._staticLoadingScreen,new c.comicCreator.ComicCreatorState)})};c.comicCreator.ComicCreator.onComicPreviewClose=function(a){a.target.destroy();b.GameManager.instance.addGameState(new c.comicCreator.ComicCreatorState)};c.comicCreator.ComicCreator.__super__=b.Component;c.comicCreator.ComicCreator.prototype=m(b.Component.prototype,{getDefaultLayer:function(){return this._defaultLayer},getUiLayer:function(){return this._uiLayer},init:function(){b.Component.prototype.init.call(this);null!=c.comicCreator.ComicCreator._staticLoadingScreen&&(c.comicCreator.ComicCreator._staticLoadingScreen=null);b.managers.AssetManager.unloadLoadBatch("menusLoadBatch");this._bgLayer=b.GameManager.instance.getLayerByName("defaultBg");this._defaultLayer=b.GameManager.instance.getLayerByName("default");this._uiLayer=b.GameManager.instance.getLayerByName("ui");this._uiFrontLayer=b.GameManager.instance.getLayerByName("uiFront");this.initCamera();c.UiFactory.createFullscreenUiPanel(this.getGameState());this._background=this.getGameState().addEntity();this._background.setScale(1,1);var a=this.getGameState().addEntity();a.setPosition(304,2);this._comic=new c.comicCreator.Comic(a,this._defaultLayer,c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition(),this._comicCamera,null,null);c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition();this._comicCamera.setOffset(new b.Vector2D(-304,-2));null!=c.GameTracker.getInstance().getCurrentComicComposition()&&this._comic.generateFromComposition(c.GameTracker.getInstance().getCurrentComicComposition());this._comic.addEventListener("paneSelect",l(this,this.onComicPaneSelect));this._comic.setPaneClickRect(new b.Rect2D(304,2,706,560));a=this.getGameState().addEntity();this._hud=new c.comicCreator.hud.Hud(a,this._uiLayer,this._bgLayer,this._uiFrontLayer);this._hud.addEventListener("backButtonClick",l(this,this.onHudBackClick));this._hud.addEventListener("finishClick",l(this,this.onHudFinishClick));this._hud.addEventListener("previousPanelClick",l(this,this.onHudPrevPanelClick));this._hud.addEventListener("nextPanelClick",l(this,this.onHudNextPanelClick));this._hud.addEventListener("previewClick",l(this,this.onHudPreviewClick));this._hud.addEventListener("resetClick",l(this,this.onResetClick));this._hud.addEventListener("soundButtonClick",l(this,this.onSoundClick));this._hud.addEventListener("helpClick",l(this,this.onHelpClick));this._hud.addEventListener("homeButtonClick",l(this,this.onHomeClick));this._hud.addEventListener("itemDockClick",l(this,this.onHudItemDockClick));b.managers.DebugManager.getInstance().addEventListener("comicSnapshot",l(this,this.onComicSnapshot));a=this.getGameState().addEntity();a.setPosition(b.GameManager.instance.getScreenSize().x/2,b.GameManager.instance.getScreenSize().y/2);this._dragButton=new b.components.Button(a,new b.Vector2D(1024,768));this._dragButton.setOnMouseDown(l(this,this.onComicMouseDown));this._hud.addEventListener("dropAsset",l(this,this.onHudDropAsset));c.comicCreator.EntityManipulator.getEventDispatcher().addEventListener("startManipulation",l(this,this.onStartManipulation));c.comicCreator.EntityManipulator.getEventDispatcher().addEventListener("stopManipulation",l(this,this.onStopManipulation));c.comicCreator.EntityManipulator.getEventDispatcher().addEventListener("doneClick",l(this,this.onEntityDoneClick));var e="comicCompositionThumbnail"+c.GameTracker.getInstance().getUserData().getCurrentCompositionIndex()+
"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex(),a=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getAssetDefinitionByName(e+"_Background");if(null==a){var a=new c.comicCreator.comicAssets.ComicAssetDefinition(e+"_Background","","","","",1),d=b.managers.AssetManager.getAsset(e+"_Background");if(null!=d){var f=this._comic.getComicTemplate().getWidth()/d.width,g=this._comic.getComicTemplate().getHeight()/d.height,f=Math.max(f,g),e=new c.comicCreator.comicAssets.BackgroundDefinition(e+
"_Background",-d.width/2,-d.height/2,1);e.setScale(f,f);a.addBackgroundDefinition(e);e=new c.comicCreator.comicCompositions.ComicAssetPlacement(650,250,0,f,f,0,c.comicCreator.PhotoManager.getLastPhotoName());c.GameTracker.getInstance().getCurrentComicComposition().addPlacement(e);a.setBackgroundComicAssetPlacement(e);a.setCategory("background");c.comicCreator.comicAssets.ComicAssetManager.getInstance().addComicAssetDefinition(a);this.dropAssetAt(650,250,a)}}a=this._comic.getPanes().length;for(e=0;e<a&&(d=e++,null==this._comic.getPanes()[d].getBackground()););this._deferredActionComponent=new b.components.DeferredActionComponent(this.getEntity())},onPhotoSelectClose:function(){var a=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getAssetDefinitionByName(c.comicCreator.PhotoManager.getLastPhotoName());null==a&&(a=new c.comicCreator.comicAssets.ComicAssetDefinition(c.comicCreator.PhotoManager.getLastPhotoName(),"","","","",1));a.addImageDefinition(new c.comicCreator.comicAssets.ImageDefinition(c.comicCreator.PhotoManager.getLastPhotoName(),1,1));var b=c.comicCreator.PhotoManager.getLastPhoto(),d=new c.comicCreator.comicAssets.BackgroundDefinition(c.comicCreator.PhotoManager.getLastPhotoName(),-b.width/2,-b.height/2,1),b=Math.max(706/b.width,560/b.height);d.setScale(b,b);a.addBackgroundDefinition(d);d=new c.comicCreator.comicCompositions.ComicAssetPlacement(650,250,0,b,b,0,c.comicCreator.PhotoManager.getLastPhotoName());c.GameTracker.getInstance().getCurrentComicComposition().addPlacement(d);a.setBackgroundComicAssetPlacement(d);c.comicCreator.comicAssets.ComicAssetManager.getInstance().addComicAssetDefinition(a);this.dropAssetAt(650,250,a)},initCamera:function(){c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition();this._comicCamera=c.EntityFactory.createCamera(0,0,0,this.getGameState());this._comicCamera.setLensSize(706,560);this._cameraTarget=this.getGameState().addEntity()},onStartManipulation:function(a){this._isManipulatingEntity=!0},onStopManipulation:function(a){this._isManipulatingEntity=!1},onEntityDoneClick:function(a){null!=this._comic.getCurrentComicPane()&&this._comic.getCurrentComicPane().deselectAllSceneEntities()},onComicMouseDown:function(){this._canDragCamera&&(this._mouseDownPosition=b.managers.InputManager.getInstance().getMousePosition(),this._cameraMouseDownPosition=this._comicCamera.getEntity().getPosition(),this._isDragging=!0)},onComicMouseUp:function(){this._canDragCamera&&(this._isDragging=!1)},update:function(){b.Component.prototype.update.call(this);if(this._isDragging&&!this._isManipulatingEntity){var a=b.managers.InputManager.getInstance().getMousePosition(),a=new b.Vector2D(this._mouseDownPosition.x-
a.x,this._mouseDownPosition.y-a.y);this._comicCamera.getEntity().setPosition(this._cameraMouseDownPosition.x+a.x,this._cameraMouseDownPosition.y+a.y)}},onHudDropAsset:function(a){this.dropAssetAt(a.getPosition().x,a.getPosition().y,a.getComicAssetDefinition())},moveCameraToPane:function(a){a=a.getCenter();a=this._comicCamera.getPointConstrainedToCameraBounds(a.x,a.y);this._cameraTarget.setPosition(a.x,a.y)},dropAssetAt:function(a,c,d,f){null==f&&(f=!0);for(var g=this._comic.getPanes().length,h=0;h<g;){var k=h++,k=this._comic.getPanes()[k];if(k.isPointInBounds(a,c,!0)){a=new b.Vector2D(a,c);a.x-=k.getEntity().getPosition().x;a.y-=k.getEntity().getPosition().y;a.x+=this._comicCamera.getEntity().getPosition().x;a.y+=this._comicCamera.getEntity().getPosition().y;a.x-=k.getContentRoot().getLocalPosition().x;a.y-=k.getContentRoot().getLocalPosition().y;a.x/=k.getContentRoot().getScale().x;a.y/=k.getContentRoot().getScale().y;a=k.addSceneEntity(d,a.x,a.y,this._defaultLayer,!0);a.getEntity().setScale(a.getEntity().getScaleRef().x/k.getContentRoot().getScale().x,a.getEntity().getScaleRef().y/k.getContentRoot().getScale().y);f&&(this._comic.selectPaneByIndex(k.getIndex()),this.moveCameraToPane(k));""!=d.getCategory()&&("frames"!=d.getCategory()&&"filters"!=d.getCategory())&&k.removeBackgroundManipulation();b.managers.SoundManager.playSoundByName("ui_place_1");break}}},onComicPaneSelect:function(a){a=a.getComicPane();this.moveCameraToPane(a);b.managers.SoundManager.playSoundByName("panel_change_1")},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);switch(a){case "mouseUp":this.onComicMouseUp()}},destroy:function(){b.Component.prototype.destroy.call(this);c.comicCreator.EntityManipulator.getEventDispatcher().removeEventListener("startManipulation",l(this,this.onStartManipulation));c.comicCreator.EntityManipulator.getEventDispatcher().removeEventListener("stopManipulation",l(this,this.onStopManipulation))},onHudBackClick:function(){b.GameManager.instance.switchToGameState(this.getGameState(),new c.TitleScreen)},onHudPrevPanelClick:function(){this._comic.prevPane();this.moveCameraToPane(this._comic.getCurrentComicPane())},onHudNextPanelClick:function(){this._comic.nextPane();this.moveCameraToPane(this._comic.getCurrentComicPane())},onHudFinishClick:function(){this._deferredActionComponent.destroyAllDeferredActions();c.GameTracker.getInstance().setCurrentComicComposition(this._comic.getComposition());c.PhotoSnapTransition.doTransition(this.getGameState(),new c.ComicRecapScreen);this.onComicSnapshot(null)},onPhotoSelect:function(){c.PhotoSnapTransition.doTransition(this.getGameState(),new c.comicCreator.ComicCreatorState)},onHudPreviewClick:function(){c.GameTracker.getInstance().setCurrentComicComposition(this._comic.getComposition());var a=new c.comicCreator.ComicPreviewState;a.addEventListener("closeClick",c.comicCreator.ComicCreator.onComicPreviewClose);b.GameManager.instance.switchToGameState(this.getGameState(),a)},onComicSnapshot:function(a){console.log(c.comicCreator.comicCompositions.ComicComposition.encode(this._comic.getComposition()))},onResetClick:function(){b.GameManager.instance.addGameState(new c.PopUpScreen(this.getGameState(),b.Localizer.getString("CLEAR_COMIC_BODY"),l(this,this.onResetComic)));this.getGameState().pause()},onResetComic:function(){this._comic.getEntity().destroy();var a=this.getGameState().addEntity();a.setPosition(304,2);this._comic=new c.comicCreator.Comic(a,this._defaultLayer,c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition(),this._comicCamera,null,null);a=c.GameTracker.getInstance().getCurrentComicComposition();if(null!=a){var e=a.getComicTemplateDefinition().getId(),a=c.comicCreator.comicCompositions.ComicCompositionManager.getInstance().getCompositionById(a.getId());null==a&&(a=new c.comicCreator.comicCompositions.ComicComposition("",e));c.GameTracker.getInstance().setCurrentComicComposition(a);var e=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getComicPanels()[0].getCenter().x,d=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getComicPanels()[0].getCenter().y;a.addPlacement(new c.comicCreator.comicCompositions.ComicAssetPlacement(e,d,0,1,1,0,this._comic.getComicTemplate().getBaseBackgroundAsset()));this._comic.generateFromComposition(a)}this._comic.addEventListener("paneSelect",l(this,this.onComicPaneSelect));this._comic.setPaneClickRect(new b.Rect2D(304,2,706,560));this._comic.selectPaneByIndex(0)},onSoundClick:function(){b.managers.SoundManager.setMusicMuted(!b.managers.SoundManager.getMusicMuted());b.managers.SoundManager.setSoundMuted(b.managers.SoundManager.getMusicMuted())},onHelpClick:function(){},onHomeClick:function(){this.getGameState().pause();c.PauseMenuState.show(this.getGameState())},onConfirmQuit:function(){c.PhotoSnapTransition.doTransition(this.getGameState(),new c.TemplateSelectScreen)},onHudItemDockClick:function(){var a=this._comic.getCurrentComicPane();null!=a&&a.deselectAllSceneEntities()},windowMask:function(a){},windowMaskLocal:function(a,b){a.beginPath();var c=this._window.getPosition(),f=this._comicCamera.getEntity().getPosition();c.x+=f.x;c.y+=f.y;a.moveTo(c.x-349.5,c.y-317.5);a.lineTo(c.x+349.5,c.y-317.5);a.lineTo(c.x+349.5,c.y+317.5);a.lineTo(c.x-349.5,c.y+317.5);a.closePath()},windowMaskNoCamera:function(a){a.beginPath();var c=this._window.getPosition(),d=new b.Vector3D(0,0,0);c.x+=d.x;c.y+=d.y;a.moveTo(c.x-349.5,c.y-317.5);a.lineTo(c.x+349.5,c.y-317.5);a.lineTo(c.x+349.5,c.y+317.5);a.lineTo(c.x-349.5,c.y+317.5);a.closePath()},__class__:c.comicCreator.ComicCreator});c.comicCreator.ComicCreatorFactory=function(){};c.comicCreator.ComicCreatorFactory.__name__=!0;c.comicCreator.ComicCreatorFactory.createComicPane=function(a,b,d,f,g,h){a=a.addEntity();a.setPosition(d.getX(),d.getY());return new c.comicCreator.ComicPanel(a,f,d,b,g,h)};c.comicCreator.ComicCreatorFactory.prototype={__class__:c.comicCreator.ComicCreatorFactory};c.comicCreator.ComicCreatorState=function(){b.GameState.call(this)};c.comicCreator.ComicCreatorState.__name__=!0;c.comicCreator.ComicCreatorState.__super__=b.GameState;c.comicCreator.ComicCreatorState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=this.addEntity();this._comicCreator=new c.comicCreator.ComicCreator(a)},__class__:c.comicCreator.ComicCreatorState});c.comicCreator.ComicPanel=function(a,c,d,f,g,h){this._canFade=!1;this._isEditable=!0;this._isUnlockedForEditing=this._isSelected=!1;b.Component.call(this,a,"ComicPane");this._contentRoot=this.getGameState().addEntity();this.getEntity().addChild(this._contentRoot);this._index=c;this._targetLayer=new b.Layer("comicPane"+this._index,k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE);this._targetLayer.setBackgroundColor("#FFFFFF");this._targetLayer.setMaskFunction(l(this,this.maskPane));this._targetLayer.setAutoClear(!1);b.GameManager.instance.insertLayerAfter(this._targetLayer,f);this._maskFunction=h;this._comicPanelDefinition=d;this._sceneEntities=[];this._camera=g;this._maxNumObjectsPerPanel=b.GameConfig.getProperty("maxNumObjectsPerPane");this._layer=this._targetLayer;this._maskFunction=h;this._points=this._comicPanelDefinition.getPolygonPoints();a=new b.collision.PolygonCollision;c=this._comicPanelDefinition.getPolygonPoints().length;for(d=0;d<c;)f=d++,f=this._comicPanelDefinition.getPolygonPoints()[f],a.addPoint(f.x,f.y);a.addPoint(this._comicPanelDefinition.getPolygonPoints()[0].x,this._comicPanelDefinition.getPolygonPoints()[0].y);this._collider=new b.components.colliders.PolygonCollider(this.getEntity(),a);this._whiteBackground=this.getGameState().addEntity();this._whiteBackground.setPosition(this.getCenter().x/2,this.getCenter().y/2);(new b.components.GameImage(this._whiteBackground,"overlayBlack",this._targetLayer,this._camera)).centerOffsetOnEntity();this._whiteBackground.setScale(100,100);this.getEntity().addChild(this._whiteBackground);a=this.getGameState().addEntity();this.getEntity().addChild(a);this._blackOverlay=new b.components.GameImage(a,"overlay",this._targetLayer,this._camera);this._blackOverlay.centerOffsetOnEntity();this._blackOverlay.setScale(150,150);this._blackOverlay.setAlpha(0);this._tweener=new b.components.Tweener(this.getEntity());this._editImage=this.getGameState().addEntity();this.getEntity().addChild(this._editImage);a=new b.collision.PolygonCollision;c=this._comicPanelDefinition.getPolygonPoints().length;for(d=0;d<c;)f=d++,f=this._comicPanelDefinition.getPolygonPoints()[f],a.addPoint(f.x,f.y);a.addPoint(this._comicPanelDefinition.getPolygonPoints()[0].x,this._comicPanelDefinition.getPolygonPoints()[0].y);this._collider=new b.components.colliders.PolygonCollider(this.getEntity(),a);this._deferredActionComponent=new b.components.DeferredActionComponent(this.getEntity())};c.comicCreator.ComicPanel.__name__=!0;c.comicCreator.ComicPanel.__super__=b.Component;c.comicCreator.ComicPanel.prototype=m(b.Component.prototype,{getContentRoot:function(){return this._contentRoot},getEditable:function(){return this._isEditable},setEditable:function(a){this._isEditable=a;a=this._sceneEntities.length;for(var b=0;b<a;){var c=b++;this._sceneEntities[c].setIsActive(this._isEditable)}},getSize:function(){return this._collider.getCollision().getSize()},getIndex:function(){return this._index},init:function(){b.Component.prototype.init.call(this);this._gameImage=this.getEntity().getComponent(b.components.GameImage);null!=c.comicCreator.hud.Hud.getInstance()&&c.comicCreator.hud.Hud.getInstance().addEventListener("clearFiltersClick",l(this,this.onClearFiltersClick))},onClearFiltersClick:function(a){this._index==a.getPanelIndex()&&this.clearFilters()},clearFilters:function(){for(var a=this._sceneEntities.length,b=0;b<a;){var c=b++,c=this._sceneEntities[c];0<c.getComicAssetDefinition().getFilterDefinitions().length?(c.destroy(),t.remove(this._sceneEntities,c)):0<c.getComicAssetDefinition().getFrameDefinitions().length&&(c.destroy(),t.remove(this._sceneEntities,c))}null!=this._filter&&this._filter.destroy();null!=this._frame&&this._frame.destroy();this.setFilter(null);this.setFrame(null)},update:function(){b.Component.prototype.update.call(this);this.getGameState().insertEntityAfter(this._whiteBackground,this.getEntity());null!=this._frame&&this.getGameState().bringEntityToFront(this._frame,!0)},unlockPaneForEditing:function(a){this._isUnlockedForEditing||(this._isUnlockedForEditing=!0)},lockPaneForEditing:function(a){null==a&&(a=!1);if(this._isUnlockedForEditing){for(var c=this._editImage.getComponentsInChildren(b.components.GameImage),d=c.length,f=0;f<d;){var g=f++,g=c[g];a&&g.setAlpha(1)}this._isUnlockedForEditing=!1}},getCenter:function(){var a=this.getEntity().getPosition();a.x+=this._comicPanelDefinition.getCenter().x;a.y+=this._comicPanelDefinition.getCenter().y;return a},getLocalCenter:function(){return this._comicPanelDefinition.getCenter().getClone()},onClick:function(){},addSceneEntity:function(a,e,d,f,g){null==g&&(g=!1);var h=this,k=0<a.getBackgroundDefinitions().length,n=0<a.getFrameDefinitions().length,m=0<a.getFilterDefinitions().length;if(this._sceneEntities.length>=this._maxNumObjectsPerPanel&&!k&&!n)return null;var q=c.comicCreator.comicAssets.ComicAssetDefinition.generateEntityFromComicAssetDefinition(this.getGameState(),a,f,this._camera);q.setPosition(e,d);q.addEventListener("destroy",l(this,this.onSceneEntityDestroy));q.setScale(a.getDragScale(),a.getDragScale(),a.getDragScale());this.getSiblingComponent(c.comicCreator.hud.Hud);var r=new c.comicCreator.SceneEntity(q,this._camera,a,this._collider);r.setPaneIndex(this._index);if(k||m||n){r.getEntity().setPosition(this._comicPanelDefinition.getCenter().x,this._comicPanelDefinition.getCenter().y);a=this._sceneEntities.length;for(e=0;e<a;)d=e++,d=this._sceneEntities[d],k&&d.hasBackground()?d.getEntity().destroy():n&&d.hasFrame()?d.getEntity().destroy():m&&d.hasFilter()&&d.getEntity().destroy();a=this._sceneEntities.length;for(e=0;e<a;)if(d=e++,d=this._sceneEntities[d],k&&d.hasBackground()){d.getEntity().destroy();t.remove(this._sceneEntities,d);break}else if(n&&d.hasFrame()){d.getEntity().destroy();t.remove(this._sceneEntities,d);break}else if(m&&d.hasFilter()){d.getEntity().destroy();t.remove(this._sceneEntities,d);break}r.setCanManipulate(!1);if(m)q.getComponentsInChildren(b.components.GameImage)[0].getEntity().destroy();else for(k=q.getComponentsInChildren(b.components.GameImage),n=k.length,m=0;m<n;)a=m++,k[a].getEntity().destroy()}else{k=q.getComponentsInChildren(c.StreamingGameImage);if(null!=k)for(n=k.length,m=0;m<n;)a=m++,a=k[a],a.setCamera(this._camera),a.setLayer(this._targetLayer);k=q.getComponentsInChildren(b.components.GameSprite);if(null!=k)for(n=k.length,m=0;m<n;)a=m++,a=k[a],a.setCamera(this._camera),a.setLayer(this._targetLayer);k=q.getComponentsInChildren(c.comicCreator.Spawner);if(null!=k)for(n=k.length,m=0;m<n;)a=m++,a=k[a],a.setCamera(this._camera),a.setLayer(this._targetLayer)}this._contentRoot.addChild(q);r.addEventListener("select",l(this,this.onSceneEntitySelect));this._sceneEntities.push(r);r.select();g?(g=r.showManipulator(),null!=g&&g.getComponent(c.comicCreator.EntityManipulator).setGizmoOffset(new b.Vector2D(this._contentRoot.getPosition().x,this._contentRoot.getPosition().y))):r.hideManipulator();g=r.getComicAssetDefinition().getBackgroundDefinitions().length;for(q=0;q<g;)k=q++,k=r.getComicAssetDefinition().getBackgroundDefinitions()[k],n=k.createEntity(this.getGameState(),this._camera,this._targetLayer),n.setScale(k.getScale().x,k.getScale().y),this._lastBackgroundDefinition=k,this.setBackground(n),t.remove(this._sceneEntities,r),this._sceneEntities.splice(0,0,r);g=r.getComicAssetDefinition().getFrameDefinitions().length;if(0<g){q=this.getGameState().addEntity();for(k=0;k<g;)n=k++,m=r.getComicAssetDefinition().getFrameDefinitions()[n],"frameClear"==m.getAssetName()?null!=this._frame&&(this._frame.destroy(),this._frame=null):(n=m.createEntity(this.getGameState(),this._camera,f),n.setScale(m.getScale().x,m.getScale().y),a=n.getComponent(b.components.GameImage),"right"==m.getAnchorHorizontal()?(n.translate(this.getSize().x,0),a.setOffset(-a.getSize().x,a.getOffset().y)):"left"!=m.getAnchorHorizontal()&&"center"==m.getAnchorHorizontal()&&(n.translate(0.5*this.getSize().x,0),a.setOffset(0.5*-a.getSize().x,a.getOffset().y)),"top"!=m.getAnchorVertical()&&"bottom"==m.getAnchorVertical()&&(n.translate(0,this.getSize().y),a.setOffset(a.getOffset().x,-a.getSize().y)),0<m.getWidth()&&0<m.getHeight()&&(a=this.getSize().x/m.getWidth(),m=this.getSize().y/m.getHeight(),n.setScale(a,m)),q.addChild(n));this.setFrame(q)}g=r.getComicAssetDefinition().getFilterDefinitions().length;for(q=0;q<g;){var k=q++,s=[r.getComicAssetDefinition().getFilterDefinitions()[k]];if("filterClear"==s[0].getAssetName()){var u=[this.getGameState().addEntity()];u[0].setPosition(this.getLocalCenter().x,this.getLocalCenter().y);this.getEntity().addChild(u[0]);(new b.components.GameImage(u[0],"filterLoadingBg",this._targetLayer,this._camera)).centerOffsetOnEntity();var w=[this.getBackground().getComponent(c.StreamingGameImage)];this._deferredActionComponent.addDeferredAction(0.05,function(a){return function(a,c){return function(){b.managers.AssetManager.assetExists(a[0].getImageName()+"original")&&(a[0].getImageAsset().src=b.managers.AssetManager.getAsset(a[0].getImageName()+"original").src);c[0].destroy()}}(w,u)}(this))}else{var v=[s[0].createEntity(this.getGameState(),this._camera,f)];v[0].setScale(s[0].getScale().x,s[0].getScale().y);this.setFilter(v[0]);var x=[this.getGameState().addEntity()];this.getEntity().addChild(x[0]);(new b.components.GameImage(x[0],"filterLoadingBg",this._targetLayer,this._camera)).centerOffsetOnEntity();x[0].setPosition(this.getLocalCenter().x,this.getLocalCenter().y);null!=this.getBackground()&&this._deferredActionComponent.addDeferredAction(0.05,function(a){return function(a,d,e){return function(){var f=h.getBackground().getComponent(c.StreamingGameImage);if(!b.managers.AssetManager.assetExists(f.getImageName()+"original")){var g=b.managers.AssetManager.getAsset(f.getImageName());b.managers.AssetManager.registerAsset(f.getImageName()+"original",g)}g=c.ImageFunctions.multiplyImages(b.managers.AssetManager.getAsset(e[0].getAssetName()),b.managers.AssetManager.getAsset(f.getImageName()+"original"),0.75);f.getImageAsset().src=g.src;a[0].destroy();h.setFilter(null);d[0].destroy();r.destroy();t.remove(h._sceneEntities,r)}}(x,v,s)}(this))}}return r},getBackground:function(){return this._background},setBackground:function(a){if(null!=this._background){var e=new b.components.Tweener(this._background),d=this._background.getComponentsInChildren(b.components.GameImage)[0];e.addTween(d,"_alpha",1,0,0.35,b.components.tween.EasingFunctions.linear,0,function(){d.destroy()})}this._background=a;this._editImage.setIsVisible(null==this._background);if(null!=a){this._contentRoot.addChild(this._background);this._background.setPosition(this._comicPanelDefinition.getCenter().x-this.getSize().x/2,this._comicPanelDefinition.getCenter().y-this.getSize().y/2);this._background.getComponent(b.components.GameImage);e=this._background.getComponentsInChildren(b.components.GameImage);if(null!=e)for(var f=e.length,g=0;g<f;){var h=g++,h=e[h];h.setCamera(this._camera);h.setLayer(this._targetLayer)}a=a.getComponentsInChildren(b.components.GameSprite);if(null!=a)for(e=a.length,f=0;f<e;)g=f++,g=a[g],g.setCamera(this._camera),g.setLayer(this._targetLayer);a=new c.comicCreator.SceneEntity(this._background,this._camera,null,null);a.setCanManipulate(!1);this._background.setProperty("SceneEntity",a);c.comicCreator.PhotoManager.setPhotoHasBeenManipulated(!0);this.getGameState().insertEntityAfter(this._background,this._whiteBackground)}},onBackgroundDoneClick:function(){this.removeBackgroundManipulation()},removeBackgroundManipulation:function(){if(null!=this._background){var a=this._background.getProperty("SceneEntity");null!=a&&a.destroy()}c.comicCreator.PhotoManager.setPhotoHasBeenManipulated(!0)},setFrame:function(a){null!=this._frame&&this._frame.destroy();this._frame=a;null!=a?c.comicCreator.FilterUndoManager.getInstance().addComicPanelToQueue(this._index):c.comicCreator.FilterUndoManager.getInstance().removeComicPanelFromQueue(this._index);if(null!=this._frame){this.getEntity().addChild(this._frame);a=this._frame.getComponentsInChildren(b.components.GameImage);for(var e=a.length,d=0;d<e;){var f=d++,f=a[f];f.setLayer(this._layer);f.setCamera(this._camera)}}},setFilter:function(a){null!=this._filter&&this._filter.destroy();this._filter=a;null!=a?c.comicCreator.FilterUndoManager.getInstance().addComicPanelToQueue(this._index):c.comicCreator.FilterUndoManager.getInstance().removeComicPanelFromQueue(this._index);null!=this._filter&&(this._contentRoot.addChild(this._filter),this._filter.setPosition(this._comicPanelDefinition.getCenter().x,this._comicPanelDefinition.getCenter().y),a=this._filter.getComponent(b.components.GameImage),null!=a&&a.setMaskFunction(l(this,this.maskPane)))},onSceneEntitySelect:function(a){if(this._isEditable){null!=this._selectedSceneEntity&&this._selectedSceneEntity.hideManipulator();a=a.target;var e=0!=a.getComicAssetDefinition().getBackgroundDefinitions().length,d=0!=a.getComicAssetDefinition().getFrameDefinitions().length,f=0!=a.getComicAssetDefinition().getFilterDefinitions().length;this._selectedSceneEntity=a;var g=a.showManipulator();null!=g&&g.getComponent(c.comicCreator.EntityManipulator).setGizmoOffset(new b.Vector2D(this._contentRoot.getPosition().x,this._contentRoot.getPosition().y));this.getGameState().bringEntityToFront(this._blackOverlay.getEntity());this.getGameState().bringEntityToFront(a.getEntity(),!0);!this._isEditable||(e||d||f)||this.fadeInBlackOverlay();this.dispatchEvent(new c.comicCreator.ComicPanelEvent("sceneEntitySelected",this._selectedSceneEntity))}},onSceneEntityDestroy:function(a){a=a.target;this._selectedSceneEntity==a.getComponent(c.comicCreator.SceneEntity)&&this.deselectAllSceneEntities();a=a.getComponent(c.comicCreator.SceneEntity);t.remove(this._sceneEntities,a)},select:function(){if(this._isEditable&&!this._isSelected){for(var a=this._sceneEntities.length,b=0;b<a;){var c=b++;this._sceneEntities[c].setIsActive(!0)}this.unlockPaneForEditing(0==this._index);this._isSelected=!0}},deselect:function(){this.fadeOutBlackOverlay();if(this._isEditable&&this._isSelected){for(var a=this._sceneEntities.length,b=0;b<a;){var c=b++;this._sceneEntities[c].setIsActive(!1)}0==a&&this.lockPaneForEditing();null!=this._selectedSceneEntity&&this._selectedSceneEntity.hideManipulator();this._selectedSceneEntity=null;this._isSelected=!1}},maskPane:function(a){null!=this._maskFunction&&(this._maskFunction(a),a.clip());a.beginPath();var c;c=null!=this._camera?this._camera.getEntity().getPosition():new b.Vector3D(0,0,0);var d=this.getEntity().getPosition();d.x=Math.round(d.x)-c.x;d.y=Math.round(d.y)-c.y;null!=this._camera&&(d.x*=this._camera.getZoomScale(),d.y*=this._camera.getZoomScale());c=this._points[0].getClone();c.scaleBy(this.getEntity().getScale().x,this.getEntity().getScale().y);c.x+=d.x;c.y+=d.y;a.moveTo(c.x,c.y);for(var f=this._points.length,g=1;g<f;){var h=g++,h=this._points[h].getClone();h.scaleBy(this.getEntity().getScale().x,this.getEntity().getScale().y);h.x+=d.x;h.y+=d.y;a.lineTo(h.x,h.y)}a.lineWidth=0;a.strokeStyle="#000000";a.lineTo(c.x,c.y);a.closePath();a.stroke()},onMouseDown:function(a){if(this._isEditable&&(a=a.getClone(),this.isPointInBounds(a.x,a.y)))this.onClickCollider()},isPointInBounds:function(a,c,d){null==d&&(d=!0);null!=this._camera&&d&&(a+=this._camera.getEntity().getPosition().x,c+=this._camera.getEntity().getPosition().y);return this._collider.checkPointIntersect(new b.Vector2D(a,c))?!0:!1},onClickCollider:function(){this._isEditable&&(this.deselectAllSceneEntities(),this.fireClickEvent())},fireClickEvent:function(){this.dispatchEvent(new c.comicCreator.ComicPanelEvent("click"))},deselectAllSceneEntities:function(){this.fadeOutBlackOverlay();for(var a=this._sceneEntities.length,b=0;b<a;){var d=b++;this._sceneEntities[d].hideManipulator()}this.dispatchEvent(new c.comicCreator.ComicPanelEvent("sceneEntityDeselected"))},getPlacements:function(){for(var a=[],b=this._sceneEntities.length,d=0;d<b;){var f=d++,f=this._sceneEntities[f],f=new c.comicCreator.comicCompositions.ComicAssetPlacement(f.getEntity().getLocalPosition().x,f.getEntity().getLocalPosition().y,f.getEntity().getRotation().z,f.getEntity().getScaleRef().x,f.getEntity().getScaleRef().y,this._index,f.getComicAssetDefinition().getName());a.push(f)}return a},getBackgroundPlacements:function(){for(var a=[],b=this._sceneEntities.length,d=0;d<b;){var f=d++,f=this._sceneEntities[f],g=new c.comicCreator.comicCompositions.ComicAssetPlacement(f.getEntity().getLocalPosition().x,f.getEntity().getLocalPosition().y,f.getEntity().getRotation().z,f.getEntity().getScaleRef().x,f.getEntity().getScaleRef().y,this._index,f.getComicAssetDefinition().getName());0<f.getComicAssetDefinition().getBackgroundDefinitions().length&&a.push(g)}return a},getNonBackgroundRelatedPlacements:function(){for(var a=[],b=this._sceneEntities.length,d=0;d<b;){var f=d++,f=this._sceneEntities[f],g=new c.comicCreator.comicCompositions.ComicAssetPlacement(f.getEntity().getLocalPosition().x,f.getEntity().getLocalPosition().y,f.getEntity().getRotation().z,f.getEntity().getScaleRef().x,f.getEntity().getScaleRef().y,this._index,f.getComicAssetDefinition().getName());0==f.getComicAssetDefinition().getBackgroundDefinitions().length&&(0==f.getComicAssetDefinition().getFilterDefinitions().length&&0==f.getComicAssetDefinition().getFrameDefinitions().length)&&a.push(g)}return a},stopAnimations:function(a){null==a&&(a=!1);for(var b=this._sceneEntities.length,c=0;c<b;){var f=c++;this._sceneEntities[f].stopAnimations(a)}},resumeAnimations:function(){for(var a=this._sceneEntities.length,b=0;b<a;){var c=b++;this._sceneEntities[c].resumeAnimations()}},fadeInBlackOverlay:function(){},fadeOutBlackOverlay:function(){},getTargetLayer:function(){return this._targetLayer},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);if(!c||!c.isDisabled)switch(a){case "mouseDown":this.onMouseDown(c)}},clear:function(){this._sceneEntities=[]},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);this._layer.destroy()},__class__:c.comicCreator.ComicPanel});c.comicCreator.ComicPanelEvent=function(a,c){b.events.Event.call(this,a);this._sceneEntitySelected=c};c.comicCreator.ComicPanelEvent.__name__=!0;c.comicCreator.ComicPanelEvent.__super__=b.events.Event;c.comicCreator.ComicPanelEvent.prototype=m(b.events.Event.prototype,{getSceneEntitySelected:function(){return this._sceneEntitySelected},__class__:c.comicCreator.ComicPanelEvent});c.comicCreator.ComicPanelSelectEvent=function(a,c,d){b.events.Event.call(this,a);this._comicPanel=c;this._index=d};c.comicCreator.ComicPanelSelectEvent.__name__=!0;c.comicCreator.ComicPanelSelectEvent.__super__=b.events.Event;c.comicCreator.ComicPanelSelectEvent.prototype=m(b.events.Event.prototype,{getIndex:function(){return this._index},getComicPane:function(){return this._comicPanel},__class__:c.comicCreator.ComicPanelSelectEvent});c.comicCreator.ComicPreviewEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.ComicPreviewEvent.__name__=!0;c.comicCreator.ComicPreviewEvent.__super__=b.events.Event;c.comicCreator.ComicPreviewEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.ComicPreviewEvent});c.comicCreator.ComicPreviewState=function(){b.GameState.call(this)};c.comicCreator.ComicPreviewState.__name__=!0;c.comicCreator.ComicPreviewState.__super__=b.GameState;c.comicCreator.ComicPreviewState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=b.GameManager.instance.getLayerByName("ui");this._root=this.addEntity();this._comicRoot=this.addEntity();this._root.addChild(this._comicRoot);this._root.setPosition(b.GameManager.instance.getScreenSize().x/2,b.GameManager.instance.getScreenSize().y/2);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);this._camera=c.EntityFactory.createCamera(0,0,0,this);var e=c.UiFactory.createUiElementEntityImage(this,this._uiPanel,-0.0048828125,-0.8502604166666666,"","ui"),d=this.addEntity();d.setPosition(0,-3,0);e.addChild(d);e=new b.components.TextField(d,a);e.setText(b.Localizer.getString("COMIC_PREVIEW"));e.setFontSize("36px");e.setFontFamily("agencyfbregular");e=this.addEntity();this._root.addChild(e);this._comic=new c.comicCreator.Comic(e,b.GameManager.instance.getLayerByName("ui"),c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition(),this._camera);this._comic.generateFromComposition(c.GameTracker.getInstance().getCurrentComicComposition());this._comic.showAllPanes();this._comic.disableEditing();b.GameManager.instance.getScreenSize();var d=new b.Vector2D(c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getWidth(),c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getHeight()),f;f=d.x>d.y?750/d.x:600/d.y;f=Math.min(f,1);this._comicRoot=this.addEntity();this._comicRoot.setScale(f,f);this._comicRoot.setPosition(b.GameManager.instance.getScreenSize().x/2-d.x/2*f+0,b.GameManager.instance.getScreenSize().y/2-d.y/2*f+35);this._comicRoot.addChild(e);c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.86328125,-0.8619791666666666,"backButton","backButton",l(this,this.onCloseButtonClick),a,"ui_click_1")},onCloseButtonClick:function(){this.dispatchEvent(new c.comicCreator.ComicPreviewEvent("closeClick"))},__class__:c.comicCreator.ComicPreviewState});c.comicCreator.ContentDraggablePanel=function(a,c,d){this._comicPanel=this._manipulator=this._camera=null;b.Component.call(this,a,"ContentDraggablePanel");this._comic=c;this._paneIndex=d;this._camera=c.getCamera()};c.comicCreator.ContentDraggablePanel.__name__=!0;c.comicCreator.ContentDraggablePanel.__super__=b.Component;c.comicCreator.ContentDraggablePanel.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._comicPanel=this.getEntity().getComponent(c.comicCreator.ComicPanel);this._collider=this.getEntity().getComponent(b.components.colliders.PolygonCollider);this._comicPanel.addEventListener("sceneEntitySelected",l(this,this.onSceneEntitySelect))},onSceneEntitySelect:function(a){this.hideManipulator()},onMouseDown:function(a){if(!this._comicPanel.getEditable())return!1;a=a.getClone();return this.isPointInBounds(a.x,a.y)?this.onClickCollider():!1},onClickCollider:function(){null==this._comicPanel&&(this._comicPanel=this.getEntity().getComponent(c.comicCreator.ComicPanel));if(this.getGameState().getPaused()||0<this._comicPanel.getNonBackgroundRelatedPlacements().length)return!1;null!=this._comicPanel.getBackground()&&this.showManipulator(this._comicPanel.getContentRoot());return!0},showManipulator:function(a){var e=this;if(null!=this._manipulator&&c.comicCreator.ContentDraggablePanel._lastManipulator==this._manipulator)return this._manipulator;this.hideManipulator();this._manipulator=this.getGameState().addEntity();c.comicCreator.ContentDraggablePanel._lastManipulator=this._manipulator;this.getEntity().addChild(this._manipulator);q.parseFloat(a.getProperty("baseScale"));a.getComponentsInChildren(b.components.GameImage)[0].getImageAsset();var d=new c.comicCreator.ScaleGizmo(this._manipulator,c.Layers.getUiFront(),85,85,this._camera,a.getScaleRef().x,1.05,2),f=a.getScale().x;a.setScale(1,1);0<a.getComponentsInChildren(b.components.FollowEntity).length&&a.getComponentsInChildren(b.components.FollowEntity)[0].destroy();var g=new b.components.Draggable(a,new b.Vector2D(250,250),null,this._camera,a.getComponent(b.components.colliders.PolygonCollider));g.setReturnOnDrop(!1);g.setIgnoreScale(!0);this.getGameState().bringEntityToFront(this._manipulator);a.setScale(f,f);f=a.getPosition();this._manipulator.setPosition(f.x,f.y);null!=this._entityManipulator&&(this._entityManipulator.getEntity().destroy(),this._entityManipulator=null);this._entityManipulator=new c.comicCreator.EntityManipulator(this._manipulator,a,g,null,d,this._camera,c.Layers.getUiFront());this._entityManipulator.setDeleteBoundsActive(!1);this._entityManipulator.overrideOnDeleteButtonClick(function(){e.hideManipulator();e._comicPanel.setFrame(null);e._comicPanel.setFilter(null);e._comicPanel.setBackground(null);e._comicPanel.clear();c.GameTracker.getInstance().setCurrentComicComposition(e._comic.getComposition())});this._comicPanel.getSize();this._comicPanel.getSize();d=a.getComponentsInChildren(c.StreamingGameImage)[0];d.getSize();a.getScale();d.getSize();a.getScale();this._entityManipulator.addEventListener("doneClick",function(){e.hideManipulator()});this._entityManipulator.addEventListener("deleteClick",function(){for(var a=e._comic.getComposition().getPlacements(),b=a.length,d=0;d<b;){var f=d++,f=a[f],g=e._comic.getComposition().getPlacements();t.remove(g,f)}e._comicPanel.setBackground(null);c.GameTracker.getInstance().setCurrentComicComposition(e._comic.getComposition());e.hideManipulator()});return this._manipulator},startEditingTemplate:function(){c.GameTracker.getInstance().getUserData();var a=c.levels.LevelManager.getInstance().getCurrentLevelIndex(),b=c.GameTracker.getInstance().getUserData();b.setCompositionByIndex(a,null);b.setCurrentCompositionIndex(a);c.GameTracker.getInstance().setCurrentComicComposition(this._comic.getComposition());c.PhotoSnapTransition.doTransition(this.getGameState(),new c.comicCreator.ComicCreatorState)},isPointInBounds:function(a,c,d){null==d&&(d=!0);null!=this._camera&&d&&(a+=this._camera.getEntity().getPosition().x,c+=this._camera.getEntity().getPosition().y);return this._collider.checkPointIntersect(new b.Vector2D(a,c))?!0:!1},hideManipulator:function(){null!=this._manipulator&&(this._manipulator.destroy(),this._entityManipulator=this._manipulator=null);null!=c.comicCreator.ContentDraggablePanel._lastManipulator&&(c.comicCreator.ContentDraggablePanel._lastManipulator.destroy(),c.comicCreator.ContentDraggablePanel._lastManipulator=null)},update:function(){b.Component.prototype.update.call(this);if(null!=this._entityManipulator){var a=this._comicPanel.getSize().x,e=this._comicPanel.getSize().y,d=this._entityManipulator.getTarget().getComponentsInChildren(c.StreamingGameImage)[0],f=d.getSize().x*this._entityManipulator.getTarget().getScale().x,d=d.getSize().y*this._entityManipulator.getTarget().getScale().y;this._entityManipulator.setDragBounds(new b.Rect2D(this._comicPanel.getLocalCenter().x-(f-a)/2,this._comicPanel.getLocalCenter().y-(d-e)/2,Math.max(0,f-a),Math.max(0,d-e)));this._comicPanel.getLocalCenter();a=this._entityManipulator.getTarget().getLocalPosition();this._entityManipulator.setGizmoOffset(new b.Vector2D(this._comicPanel.getLocalCenter().x-a.x,this._comicPanel.getLocalCenter().y-a.y));this._entityManipulator.getDraggable().setCollisionOffset(new b.Vector2D(this._comicPanel.getLocalCenter().x-
a.x,this._comicPanel.getLocalCenter().y-a.y))}},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);if(!c||!c.isDisabled)switch(a){case "mouseDown":this.onMouseDown(c)&&(c.isDisabled=!0)}},destroy:function(){b.Component.prototype.destroy.call(this);c.comicCreator.ContentDraggablePanel._lastManipulator==this._manipulator&&(c.comicCreator.ContentDraggablePanel._lastManipulator=null)},__class__:c.comicCreator.ContentDraggablePanel});c.comicCreator.EntityManipulator=function(a,c,d,f,g,h,k){this._onDeleteButtonClickOverride=null;this._gizmoOffset=new b.Vector2D(0,0);this._dragBounds=null;this._deleteBoundsActive=this._deleteActionEnabled=!0;b.Component.call(this,a,"EntityManipulator");this._draggable=d;this._rotationGizmo=f;this._scaleGizmo=g;this._target=c;this._camera=h;this._layer=k;null!=this._scaleGizmo&&this._scaleGizmo.addEventListener("scaleUpdate",l(this,this.onScaleUpdate));null!=this._rotationGizmo&&this._rotationGizmo.addEventListener("rotationUpdate",l(this,this.onRotationUpdate));this._draggable.addEventListener("startDragging",l(this,this.onDraggableStartDrag));this._draggable.addEventListener("stopDragging",l(this,this.onDraggableStopDrag));null!=this._scaleGizmo&&(this._scaleGizmo.addEventListener("startDrag",l(this,this.onScaleStartDrag)),this._scaleGizmo.addEventListener("stopDrag",l(this,this.onScaleStopDrag)));null!=this._rotationGizmo&&(this._rotationGizmo.addEventListener("startDragging",l(this,this.onRotationStartDrag)),this._rotationGizmo.addEventListener("stopDragging",l(this,this.onRotationStopDrag)));this._deleteButton=this.getGameState().addEntity();this._doneButton=this.getGameState().addEntity()};c.comicCreator.EntityManipulator.__name__=!0;c.comicCreator.EntityManipulator.getEventDispatcher=function(){null==c.comicCreator.EntityManipulator._eventDispatcher&&(c.comicCreator.EntityManipulator._eventDispatcher=new b.events.EventDispatcher);return c.comicCreator.EntityManipulator._eventDispatcher};c.comicCreator.EntityManipulator.__super__=b.Component;c.comicCreator.EntityManipulator.prototype=m(b.Component.prototype,{getDraggable:function(){return this._draggable},getTarget:function(){return this._target},getScaleGizmo:function(){return this._scaleGizmo},getGizmoOffset:function(){return this._gizmoOffset},setGizmoOffset:function(a){this._gizmoOffset=a},getDragBounds:function(){return this._dragBounds},setDragBounds:function(a){this._dragBounds=a},getDeleteActionEnabled:function(){return this._deleteActionEnabled},setDeleteActionEnabled:function(a){this._deleteActionEnabled=a},getDeleteBoundsActive:function(){return this._deleteBoundsActive},setDeleteBoundsActive:function(a){this._deleteBoundsActive=a},init:function(){b.Component.prototype.init.call(this);this._select=this.getGameState().addEntity();this.getEntity().addChild(this._select);(new b.components.GameImage(this._select,"selectUi",this._layer,this._camera)).centerOffsetOnEntity();if(null!=this._deleteButton){this._deleteButton.setPosition(90,-90);this.getEntity().addChild(this._deleteButton);var a=new b.components.Button(this._deleteButton,new b.Vector2D(85,85),null,null,this._camera);a.setKillMessageOnMouseDown(!0);null==this._onDeleteButtonClickOverride?a.setOnMouseDown(l(this,this.onDeleteButtonClick)):a.setOnMouseDown(this._onDeleteButtonClickOverride);(new b.components.GameImage(this._deleteButton,"trashUi",this._layer,this._camera)).centerOffsetOnEntity()}this._doneButton.setPosition(-90,90);this.getEntity().addChild(this._doneButton);a=new b.components.Button(this._doneButton,new b.Vector2D(50,50),null,null,this._camera);a.setKillMessageOnMouseDown(!0);a.setOnMouseDown(l(this,this.onDoneButtonClick));(new b.components.GameImage(this._doneButton,"doneUi",this._layer,this._camera)).centerOffsetOnEntity();a=new b.components.Tweener(this.getEntity());a.addTween(this.getEntity().getScaleRef(),"x",0.1,1,0.35,b.components.tween.EasingFunctions.easeOutBack);a.addTween(this.getEntity().getScaleRef(),"y",0.1,1,0.35,b.components.tween.EasingFunctions.easeOutBack)},update:function(){b.Component.prototype.update.call(this);var a=this._target.getLocalPosition();this._draggable.updateCollision();null!=this._dragBounds&&(a.x>this._dragBounds.ul.x+this._dragBounds.wh.x&&(a.x=this._dragBounds.ul.x+this._dragBounds.wh.x),a.y>this._dragBounds.ul.y+this._dragBounds.wh.y&&(a.y=this._dragBounds.ul.y+this._dragBounds.wh.y),a.y<this._dragBounds.ul.y&&(a.y=this._dragBounds.ul.y),a.x<this._dragBounds.ul.x&&(a.x=this._dragBounds.ul.x),this._target.setPosition(a.x,a.y));var c=this._target.getParent().getScale();this.getEntity().setPosition(a.x*c.x+this._gizmoOffset.x,a.y*c.y+this._gizmoOffset.y)},postUpdate:function(){b.Component.prototype.postUpdate.call(this);null!=this._rotationGizmo&&this.getGameState().bringEntityToFront(this._rotationGizmo.getEntity());this.getGameState().bringEntityToFront(this.getEntity());null!=this._scaleGizmo&&this.getGameState().bringEntityToFront(this._scaleGizmo.getEntity().getChildren()[0]);this.getGameState().bringEntityToFront(this._doneButton);null!=this._deleteButton&&this.getGameState().bringEntityToFront(this._deleteButton)},overrideOnDeleteButtonClick:function(a){var c=this._deleteButton.getComponent(b.components.Button);null!=c&&c.setOnMouseDown(a);this._onDeleteButtonClickOverride=a},onDeleteButtonClick:function(){var a=this;this.dispatchEvent(new c.comicCreator.EntityManipulatorEvent("deleteClick",this));if(this._deleteActionEnabled){this.getEntity().destroy();(new b.components.tween.GroupFader(this._target)).fadeTo(1,0.5,0.35,function(){a._target.destroy()});var e=new b.components.Tweener(this._target);e.addTween(this._target.getScaleRef(),"x",this._target.getScaleRef().x,0,0.35,b.components.tween.EasingFunctions.easeInQuint);e.addTween(this._target.getScaleRef(),"y",this._target.getScaleRef().y,0,0.35,b.components.tween.EasingFunctions.easeInQuint);b.managers.SoundManager.playSoundByName("ui_trash_1")}},onDoneButtonClick:function(){c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("doneClick",this));this.dispatchEvent(new c.comicCreator.EntityManipulatorEvent("doneClick",this));b.managers.SoundManager.playSoundByName("ui_click_1")},onActivated:function(){b.Component.prototype.onActivated.call(this);null!=this._scaleGizmo&&this._scaleGizmo.setIsActive(!0);null!=this._rotationGizmo&&this._rotationGizmo.setIsActive(!0);this._draggable.setIsActive(!0)},onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);null!=this._scaleGizmo&&this._scaleGizmo.setIsActive(!1);null!=this._rotationGizmo&&this._rotationGizmo.setIsActive(!1);this._draggable.setIsActive(!1)},onScaleStartDrag:function(a){null!=this._rotationGizmo&&this._rotationGizmo.setIsActive(!1);this._draggable.setIsActive(!1);null!=this._deleteButton&&this._deleteButton.setIsActive(!1);this._doneButton.setIsActive(!1);this._select.setIsActive(!1);c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("startManipulation",this))},onScaleStopDrag:function(a){null!=this._rotationGizmo&&this._rotationGizmo.setIsActive(!0);this._draggable.setIsActive(!0);null!=this._deleteButton&&this._deleteButton.setIsActive(!0);this._doneButton.setIsActive(!0);this._select.setIsActive(!0);c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("stopManipulation",this));b.managers.SoundManager.playSoundByName("ui_place_1")},onRotationStartDrag:function(a){null!=this._scaleGizmo&&this._scaleGizmo.setIsActive(!1);this._draggable.setIsActive(!1);null!=this._deleteButton&&this._deleteButton.setIsActive(!1);this._doneButton.setIsActive(!1);this._select.setIsActive(!1);c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("startManipulation",this))},onRotationStopDrag:function(a){null!=this._scaleGizmo&&this._scaleGizmo.setIsActive(!0);this._draggable.setIsActive(!0);null!=this._deleteButton&&this._deleteButton.setIsActive(!0);this._doneButton.setIsActive(!0);this._select.setIsActive(!0);c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("stopManipulation",this));b.managers.SoundManager.playSoundByName("ui_place_1")},onDraggableStartDrag:function(a){null!=this._scaleGizmo&&this._scaleGizmo.setIsActive(!1);null!=this._rotationGizmo&&this._rotationGizmo.setIsActive(!1);null!=this._deleteButton&&this._deleteButton.setIsActive(!1);this._doneButton.setIsActive(!1);this._select.setIsActive(!1);c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("startManipulation",this));b.managers.SoundManager.playSoundByName("ui_place_1")},onDraggableStopDrag:function(a){null!=this._scaleGizmo&&this._scaleGizmo.setIsActive(!0);null!=this._rotationGizmo&&this._rotationGizmo.setIsActive(!0);null!=this._deleteButton&&this._deleteButton.setIsActive(!0);this._doneButton.setIsActive(!0);this._select.setIsActive(!0);c.comicCreator.EntityManipulator.getEventDispatcher().dispatchEvent(new c.comicCreator.EntityManipulatorEvent("stopManipulation",this));this.getEntity().getLocalPosition();b.managers.SoundManager.playSoundByName("ui_place_1")},onScaleUpdate:function(a){a=a.getScale();null!=this._target.getParent()&&(a/=this._target.getParent().getScaleRef().x);this._target.setScale(a,a)},onRotationUpdate:function(a){this._target.setRotation(0,0,b.utilities.Math2.degToRad(a.getRotationDeg()))},destroyDeleteButton:function(){this._deleteButton.destroy();this._deleteButton=null},destroy:function(){b.Component.prototype.destroy.call(this)},__class__:c.comicCreator.EntityManipulator});c.comicCreator.EntityManipulatorEvent=function(a,c){b.events.Event.call(this,a);this._entityManipulator=c};c.comicCreator.EntityManipulatorEvent.__name__=!0;c.comicCreator.EntityManipulatorEvent.__super__=b.events.Event;c.comicCreator.EntityManipulatorEvent.prototype=m(b.events.Event.prototype,{getEntityManipulator:function(){return this._entityManipulator},__class__:c.comicCreator.EntityManipulatorEvent});c.comicCreator.FilterUndoManager=function(){c.comicCreator.FilterUndoManager._instance=this;this._comicPanelIndexQueue=[]};c.comicCreator.FilterUndoManager.__name__=!0;c.comicCreator.FilterUndoManager.getInstance=function(){null==c.comicCreator.FilterUndoManager._instance&&(c.comicCreator.FilterUndoManager._instance=new c.comicCreator.FilterUndoManager);return c.comicCreator.FilterUndoManager._instance};c.comicCreator.FilterUndoManager.prototype={getComicPanelIndexQueue:function(){return this._comicPanelIndexQueue},addComicPanelToQueue:function(a){this.removeComicPanelFromQueue(a);this._comicPanelIndexQueue.push(a)},removeComicPanelFromQueue:function(a){t.remove(this._comicPanelIndexQueue,a)},getLastComicPanelAdded:function(){return this._comicPanelIndexQueue[this._comicPanelIndexQueue.length-1]},reset:function(){this._comicPanelIndexQueue=[]},__class__:c.comicCreator.FilterUndoManager};c.comicCreator.PhotoFrameSelectionList=function(a){b.Component.call(this,a,"PhotoFrameSelectionList")};c.comicCreator.PhotoFrameSelectionList.__name__=!0;c.comicCreator.PhotoFrameSelectionList.__super__=b.Component;c.comicCreator.PhotoFrameSelectionList.prototype=m(b.Component.prototype,{init:function(){var a=this;b.Component.prototype.init.call(this);this._frameButtons=[];for(var e=c.levels.LevelManager.getInstance().getCurrentLevel().getTemplates().length,d=0;d<e;){var f=[d++],g=this.getGameState().addEntity();g.setPosition(-(125*(e-
1)/2)+125*f[0],0*f[0]);this.getEntity().addChild(g);(new b.components.GameImage(g,"",c.Layers.getUiFront(),null)).centerOffsetOnEntity();this._frameButtons.push(g);new b.components.Button(g,new b.Vector2D(100,100),null,function(b){return function(){a.dispatchEvent(new c.comicCreator.PhotoFrameSelectionListSelectEvent("select",b[0]))}}(f));this.updateFrameImage(f[0])}},updateFrameImage:function(a,e){null==e&&(e="");var d;d=b.managers.AssetManager.assetExists("comicCompositionThumbnail"+a+"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex())?"comicCompositionThumbnail"+a+"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex():b.managers.AssetManager.assetExists("comicCompositionThumbnail"+a+"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex()+"_Background")?"comicCompositionThumbnail"+a+"_"+c.levels.LevelManager.getInstance().getCurrentLevelIndex()+"_Background":"frameSelectionTemp";""!=e&&(d=e);var f=this._frameButtons[a].getComponent(b.components.GameImage);f.setImage(d);f.centerOffsetOnEntity();var g=d=1;if(100<f.getSize().x||100<f.getSize().y)d=100/f.getSize().x,g=100/f.getSize().y;f=this._frameButtons[a].getComponent(b.components.Button);f.getCollisionSize().x/=d;f.getCollisionSize().y/=g;this._frameButtons[a].setScale(d,g)},__class__:c.comicCreator.PhotoFrameSelectionList});c.comicCreator.PhotoFrameSelectionListSelectEvent=function(a,c){b.events.Event.call(this,a);this._selectedIndex=c};c.comicCreator.PhotoFrameSelectionListSelectEvent.__name__=!0;c.comicCreator.PhotoFrameSelectionListSelectEvent.__super__=b.events.Event;c.comicCreator.PhotoFrameSelectionListSelectEvent.prototype=m(b.events.Event.prototype,{getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(a){this._selectedIndex=a},__class__:c.comicCreator.PhotoFrameSelectionListSelectEvent});c.comicCreator.PhotoManager=function(){b.Manager.call(this);c.comicCreator.PhotoManager._instance=this};c.comicCreator.PhotoManager.__name__=!0;c.comicCreator.PhotoManager.getPhotoHasBeenManipulated=function(){return c.comicCreator.PhotoManager._photoHasBeenManipulated};c.comicCreator.PhotoManager.setPhotoHasBeenManipulated=function(a){c.comicCreator.PhotoManager._photoHasBeenManipulated=a};c.comicCreator.PhotoManager.getNextPhotoId=function(){return++c.comicCreator.PhotoManager._currentPhotoId};c.comicCreator.PhotoManager.getCurrentPhotoId=function(){return c.comicCreator.PhotoManager._currentPhotoId};c.comicCreator.PhotoManager.resetCurrentPhotoId=function(){c.comicCreator.PhotoManager._currentPhotoId=-1};c.comicCreator.PhotoManager.getInstance=function(){return c.comicCreator.PhotoManager._instance};c.comicCreator.PhotoManager.getLastPhoto=function(){return b.managers.AssetManager.assetExists(c.comicCreator.PhotoManager.getLastPhotoName())?b.managers.AssetManager.getAsset(c.comicCreator.PhotoManager.getLastPhotoName()):null};c.comicCreator.PhotoManager.clearLastPhoto=function(){c.comicCreator.PhotoManager._currentPhotoId=-1};c.comicCreator.PhotoManager.getLastPhotoOriginal=function(){return b.managers.AssetManager.assetExists(c.comicCreator.PhotoManager.getLastPhotoName()+"original")?b.managers.AssetManager.getAsset(c.comicCreator.PhotoManager.getLastPhotoName()+
"original"):null};c.comicCreator.PhotoManager.getLastPhotoName=function(){return"rPhoto"+c.comicCreator.PhotoManager.getCurrentPhotoId()};c.comicCreator.PhotoManager.__super__=b.Manager;c.comicCreator.PhotoManager.prototype=m(b.Manager.prototype,{registerPhoto:function(a){var e;e=k.getDocument().createElement("img");try{e.src=a;var d=q.string(c.comicCreator.PhotoManager.getNextPhotoId());b.managers.AssetManager.registerAsset("rPhoto"+d,e);e=k.getDocument().createElement("img");e.src=a;b.managers.AssetManager.registerAsset("rPhoto"+
d+"original",e)}catch(f){}},registerPhotoImageElement:function(a){var e=q.string(c.comicCreator.PhotoManager.getNextPhotoId());b.managers.AssetManager.registerAsset("rPhoto"+e,a);var d;d=k.getDocument().createElement("img");d.src=a.src;b.managers.AssetManager.registerAsset("rPhoto"+e+"original",d)},registerPhotoByGameImage:function(a,e){c.comicCreator.PhotoManager._currentPhotoId=e;var d;d=k.getDocument().createElement("img");d.src=a.getImageAsset().src;b.managers.AssetManager.registerAsset("rPhoto"+
c.comicCreator.PhotoManager._currentPhotoId+"original",d)},__class__:c.comicCreator.PhotoManager});c.comicCreator.PrintingState=function(){this._waitFrames=3;b.GameState.call(this);var a=this.addEntity(),e=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getWidth(),d=c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition().getHeight();this._renderLayer=new b.Layer("temp",e,d);this._comic=new c.comicCreator.Comic(a,this._renderLayer,c.GameTracker.getInstance().getCurrentComicComposition().getComicTemplateDefinition());this._comic.disableEditing();this._comic.generateFromComposition(c.GameTracker.getInstance().getCurrentComicComposition());this._comic.stopAnimations();b.GameManager.instance.invokeAsyncDeferredAction(0.35,l(this,this.onCaptureSave));this._canvas=k.getDocument().createElement("canvas");this._canvas.width=792;this._canvas.height=612;this._canvas.setAttribute("webkitTransform","translate3d(0px, 0px, 0px);");this._canvas.style.position="absolute"};c.comicCreator.PrintingState.__name__=!0;c.comicCreator.PrintingState.__super__=b.GameState;c.comicCreator.PrintingState.prototype=m(b.GameState.prototype,{onCaptureSave:function(){var a=this;this._canvas.style.width="100%";this._canvas.style.height="100%";this._canvas.getContext("2d").drawImage(b.managers.AssetManager.getAsset("printableBg"),0,0);this._canvas.getContext("2d").fillStyle="#FFFFFF";this._comic.getEntity().setPosition(512-0.5*this._comic.getComicTemplate().getWidth(),40);this._comic.getEntity().setScale(0.7,0.7);this._comic.renderToCanvas(this._canvas);var c=this._canvas.toDataURL("image/jpeg"),d=k.getDocument().getElementById("PrintingStateIFrame");null!=d&&null!=d&&d.parentNode.removeChild(d);this._frame=d=k.getDocument().createElement("iframe");d.id="PrintingStateIFrame";d.style.position="fixed";d.style.right="0";d.style.bottom="0";d.style.width="100%";d.style.height="90%";d.style.visibility="hidden";k.getDocument().body.appendChild(d);if(null==d.contentWindow.document.body)d.onload=function(){d.contentWindow.document.body.style.width="100%";d.contentWindow.document.body.style.height="90%";d.contentWindow.document.body.style.display="table";var b=d.contentWindow.document.createElement("div");b.style.height="100%";b.style.width="100%";b.style.display="table-cell";b.style.verticalAlign="middle";d.contentWindow.document.body.appendChild(b);var f=d.contentWindow.document.createElement("img");b.appendChild(f);f.style.margin="auto";f.style.display="block";f.style.position="relative";f.src=c;f.onload=function(b){d.contentWindow.focus();d.contentWindow.print();a.destroy()};null!=a._canvas.parentNode&&a._canvas.parentNode.removeChild(a._canvas)};else{d.contentWindow.document.body.style.width="100%";d.contentWindow.document.body.style.height="90%";d.contentWindow.document.body.style.display="table";var f=d.contentWindow.document.createElement("div");f.style.height="100%";f.style.width="100%";f.style.display="table-cell";f.style.verticalAlign="middle";d.contentWindow.document.body.appendChild(f);var g=d.contentWindow.document.createElement("img");f.appendChild(g);g.style.margin="auto";g.style.display="block";g.style.position="relative";g.src=c;g.onload=function(b){d.contentWindow.focus();d.contentWindow.print();a.destroy()};null!=this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}},destroy:function(){b.GameState.prototype.destroy.call(this);this._frame.parentElement.removeChild(this._frame)},__class__:c.comicCreator.PrintingState});c.comicCreator.RotationGizmo=function(a,c,d,f){this._currentRotation=this._mouseUpRotation=0;this._grabVector=this._tweener=null;this._grabBaseAngle=0;this._isMouseOver=this._isRotating=!1;this.RADIUS_OFFSET=-15;b.Component.call(this,a,"RotationGizmo");this._radius=c;this._grabSize=d;this._camera=f};c.comicCreator.RotationGizmo.__name__=!0;c.comicCreator.RotationGizmo.isGrabbingHandleGlobally=function(){return c.comicCreator.RotationGizmo._isGrabbingHandleGlobally};c.comicCreator.RotationGizmo.__super__=b.Component;c.comicCreator.RotationGizmo.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._tweener=new b.components.Tweener(this.getEntity());this._gameImage=new b.components.GameImage(this.getEntity(),"rotateUi",b.GameManager.instance.getLayerByName("ui"),this._camera);this._gameImage.centerOffsetOnEntity();var a=this._gameImage.getOffset();a.x-=(new b.Vector2D(this._radius,this._radius)).getLength()/2;a.y-=(new b.Vector2D(this._radius,this._radius)).getLength()/2},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.GameManager.instance.getLayerByName("debug").getCanvas().getContext("2d"),c=this.getEntity().getPosition();null!=this._camera&&(c.x-=this._camera.getEntity().getPosition().x,c.y-=this._camera.getEntity().getPosition().y);a.save();a.strokeStyle="#FF0000";a.lineWidth=1;a.beginPath();a.arc(c.x,c.y,this._radius-this._grabSize/2,0,2*Math.PI,!1);a.stroke();a.beginPath();a.arc(c.x,c.y,this._radius+this._grabSize/2,0,2*Math.PI,!1);a.stroke();a.restore()},update:function(){b.Component.prototype.update.call(this)},getRotating:function(){return this._isRotating},onMouseDown:function(a){var e=this.getEntity().getPosition();a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x,a.y+=this._camera.getEntity().getPosition().y);return this.isPositionWithinHandles(a.x,a.y)?(this._grabVector=new b.Vector2D(a.x-e.x,a.y-e.y),this._grabVector=this._grabVector.getNormalized(),this._isRotating=!0,this.dispatchEvent(new c.comicCreator.RotationGizmoEvent("startDragging")),c.comicCreator.RotationGizmo._isGrabbingHandleGlobally=!0):!1},onMouseUp:function(a){this._isRotating&&(this._isRotating=c.comicCreator.RotationGizmo._isGrabbingHandleGlobally=!1,this._grabBaseAngle=this._currentRotation,this.dispatchEvent(new c.comicCreator.RotationGizmoEvent("stopDragging")),this._mouseUpRotation+=this._gameImage.getRotation().z,this._tweener.addTween(this._gameImage.getRotation(),"z",this._gameImage.getRotation().z,0,0.35,b.components.tween.EasingFunctions.easeOutQuint))},onMouseMove:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x,a.y+=this._camera.getEntity().getPosition().y);if(this._isRotating){var e=this.getEntity().getPosition();a=new b.Vector2D(a.x-e.x,a.y-e.y);a=a.getNormalized();a=b.utilities.Math2.getAngleInDegreesBetween2dVectors(this._grabVector,a);0==Math.floor(a)%7&&b.managers.SoundManager.playSoundByName("ui_rotate_1");this._currentRotation=a=this._grabBaseAngle+b.utilities.Math2.degToRad(a);this.dispatchEvent(new c.comicCreator.RotationGizmoRotateEvent("rotationUpdate",b.utilities.Math2.radToDeg(this._currentRotation)));this._gameImage.setRotation(new b.Vector3D(0,0,a-this._mouseUpRotation))}else this.isPositionWithinHandles(a.x,a.y)?(this._isMouseOver||(k.getDocument().body.style.cursor="pointer"),this._isMouseOver=!0):(this._isMouseOver&&(k.getDocument().body.style.cursor="default"),this._isMouseOver=!1)},isPositionWithinHandles:function(a,c){var d=new b.Vector2D(a,c),f=this.getEntity().getPosition(),d=(new b.Vector2D(d.x-f.x,d.y-f.y)).getLength();return d<this._radius+
this.RADIUS_OFFSET+this._grabSize/2&&d>this._radius+this.RADIUS_OFFSET-this._grabSize/2},isPositionWithinBounds:function(a,c){var d=new b.Vector2D(a,c),f=this.getEntity().getPosition();return(new b.Vector2D(d.x-f.x,d.y-f.y)).getLength()<this._radius+this.RADIUS_OFFSET+this._grabSize/2},onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._gameImage.setAlpha(0)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._gameImage.setAlpha(1)},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);if(null==c||!c.isDisabled)switch(a){case "mouseDown":this.onMouseDown(c)&&(c.stopRotationHandleMessage=!0,c.isDisabled=!0);break;case "mouseMove":this.onMouseMove(c);break;case "mouseUp":this.onMouseUp(c)}},destroy:function(){b.Component.prototype.destroy.call(this)},__class__:c.comicCreator.RotationGizmo});c.comicCreator.RotationGizmoEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.RotationGizmoEvent.__name__=!0;c.comicCreator.RotationGizmoEvent.__super__=b.events.Event;c.comicCreator.RotationGizmoEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.RotationGizmoEvent});c.comicCreator.RotationGizmoRotateEvent=function(a,c){b.events.Event.call(this,a);this._rotationDeg=c};c.comicCreator.RotationGizmoRotateEvent.__name__=!0;c.comicCreator.RotationGizmoRotateEvent.__super__=b.events.Event;c.comicCreator.RotationGizmoRotateEvent.prototype=m(b.events.Event.prototype,{getRotationDeg:function(){return this._rotationDeg},__class__:c.comicCreator.RotationGizmoRotateEvent});c.comicCreator.ScaleGizmo=function(a,c,d,f,g,h,k,n){null==n&&(n=1);null==k&&(k=0.08);null==h&&(h=1);null==f&&(f=50);null==d&&(d=50);this._maxScale=1;this._minScale=0.35;this._mouseDownScale=this._currentScale=1;this._isDragging=!1;b.Component.call(this,a,"ScaleGizmo");this._handlePosition=new b.Vector2D(d,f);this._camera=g;this._currentScale=this._mouseDownScale=h;this._minScale=k;this._maxScale=n;this._layer=c};c.comicCreator.ScaleGizmo.__name__=!0;c.comicCreator.ScaleGizmo.__super__=b.Component;c.comicCreator.ScaleGizmo.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._tweener=new b.components.Tweener(this.getEntity());this._scaleHandle=this.getGameState().addEntity();this.getEntity().addChild(this._scaleHandle);this._scaleHandle.setPosition(this._handlePosition.x,this._handlePosition.y);this._button=new b.components.Button(this._scaleHandle,new b.Vector2D(80,80),null,null,this._camera);this._button.setOnMouseDown(l(this,this.onStartDragging));this._button.setKillMessageOnMouseDown(!0);this._gameImage=new b.components.GameImage(this._scaleHandle,"scaleUi",this._layer,this._camera);this._gameImage.centerOffsetOnEntity()},update:function(){b.Component.prototype.update.call(this);if(this._isDragging){var a=b.managers.InputManager.getInstance().getMousePosition();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x,a.y+=this._camera.getEntity().getPosition().y);var a=(new b.Vector2D(this.getEntity().getPosition().x-a.x,this.getEntity().getPosition().y-
a.y)).getLength(),e=a-this._mouseDownDistance;0==Math.floor(a)%7&&b.managers.SoundManager.playSoundByName("ui_scale_1");this._currentScale=b.utilities.Math2.clamp(this._mouseDownScale+0.01*e,this._minScale,this._maxScale);this.dispatchEvent(new c.comicCreator.ScaleGizmoScaleEvent("scaleUpdate",this._currentScale));this._scaleHandle.setPosition(this._handlePosition.x+e,this._handlePosition.y+e)}},onStartDragging:function(){this._isDragging=!0;this._mouseDownPosition=b.managers.InputManager.getInstance().getMousePosition();this._tweener.destroyAllTweens();null!=this._camera&&(this._mouseDownPosition.x+=this._camera.getEntity().getPosition().x,this._mouseDownPosition.y+=this._camera.getEntity().getPosition().y);this._mouseDownDistance=(new b.Vector2D(this.getEntity().getPosition().x-this._mouseDownPosition.x,this.getEntity().getPosition().y-this._mouseDownPosition.y)).getLength();this.dispatchEvent(new c.comicCreator.ScaleGizmoEvent("startDrag"))},onMouseUp:function(){this._mouseDownScale=this._currentScale;this._isDragging=!1;this.dispatchEvent(new c.comicCreator.ScaleGizmoEvent("stopDrag"));this._tweener.addTween(this._scaleHandle.getPositionRef(),"x",this._scaleHandle.getLocalPosition().x,this._handlePosition.x,0.35,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(this._scaleHandle.getPositionRef(),"y",this._scaleHandle.getLocalPosition().y,this._handlePosition.y,0.35,b.components.tween.EasingFunctions.easeOutQuint)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._gameImage.setIsActive(!0);this._gameImage.setAlpha(1)},onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._gameImage.setIsActive(!1);this._gameImage.setAlpha(0)},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);switch(a){case "mouseUp":this.onMouseUp()}},destroy:function(){b.Component.prototype.destroy.call(this);this._scaleHandle.destroy()},__class__:c.comicCreator.ScaleGizmo});c.comicCreator.ScaleGizmoEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.ScaleGizmoEvent.__name__=!0;c.comicCreator.ScaleGizmoEvent.__super__=b.events.Event;c.comicCreator.ScaleGizmoEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.ScaleGizmoEvent});c.comicCreator.ScaleGizmoScaleEvent=function(a,c){b.events.Event.call(this,a);this._scale=c};c.comicCreator.ScaleGizmoScaleEvent.__name__=!0;c.comicCreator.ScaleGizmoScaleEvent.__super__=b.events.Event;c.comicCreator.ScaleGizmoScaleEvent.prototype=m(b.events.Event.prototype,{getScale:function(){return this._scale},__class__:c.comicCreator.ScaleGizmoScaleEvent});c.comicCreator.SceneEntity=function(a,c,d,f){this._canManipulate=!0;b.Component.call(this,a,"SceneEntity");this._camera=c;this._comicAssetDefinition=d;this._collider=f;this._button=new b.components.Button(this.getEntity(),new b.Vector2D(250,250),null,l(this,this.onMouseDown),this._camera);this._button.setKillMessageOnMouseDown(!0);this._canManipulate||this._button.setIsActive(!1)};c.comicCreator.SceneEntity.__name__=!0;c.comicCreator.SceneEntity.__super__=b.Component;c.comicCreator.SceneEntity.prototype=m(b.Component.prototype,{hasFilter:function(){return 0<this._comicAssetDefinition.getFilterDefinitions().length},hasFrame:function(){return 0<this._comicAssetDefinition.getFrameDefinitions().length},hasBackground:function(){return 0<this._comicAssetDefinition.getBackgroundDefinitions().length},getCanManipulate:function(){return this._canManipulate},setCanManipulate:function(a){this._canManipulate=a;null!=this._button&&this._button.setIsActive(a)},getComicAssetDefinition:function(){return this._comicAssetDefinition},getPaneIndex:function(){return this._paneIndex},setPaneIndex:function(a){this._paneIndex=a},init:function(){b.Component.prototype.init.call(this)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._button.setIsActive(!0)},onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._button.setIsActive(!1);this.hideManipulator()},stopAnimations:function(a){null==a&&(a=!1);for(var c=this._comicAssetDefinition.getAnimationDefinitions(),d=c.length,f=0;f<d;)for(var g=f++,h=c[g].getAssetName(),k=this.getEntity().getComponentsInChildren(b.components.GameSprite),n=k.length,l=0;l<n;){var m=l++;k[m].getAnimation()==h&&(a&&k[m].setPosition(c[g].getDefaultFrame()/k[m].getAnimationFps()),k[m].stop())}},resumeAnimations:function(){for(var a=this._comicAssetDefinition.getAnimationDefinitions(),c=a.length,d=0;d<c;)for(var f=d++,f=a[f].getAssetName(),g=this.getEntity().getComponentsInChildren(b.components.GameSprite),h=g.length,k=0;k<h;){var n=k++;g[n].getAnimation()==f&&g[n].play()}},showManipulator:function(){if(null!=this._manipulator||!this._canManipulate)return null;this.updateManipulator();return this._manipulator},updateManipulator:function(){null!=this._manipulator&&this.hideManipulator();this._manipulator=this.getGameState().addEntity();var a=new c.comicCreator.RotationGizmo(this._manipulator,125,54,this._camera),e=new c.comicCreator.ScaleGizmo(this._manipulator,c.Layers.getUi(),85,85,this._camera,this.getEntity().getParent().getScale().x*this.getEntity().getScaleRef().x,0.25,1);e.addEventListener("scaleUpdate",l(this,this.onScaleGizmoUpdate));var d=this.getEntity().getScaleRef().x;this.getEntity().setScale(1,1);this._draggableSize=new b.Vector2D(250,250);this._draggable=new b.components.Draggable(this.getEntity(),this._draggableSize,null,this._camera,this._collider);this._draggable.setReturnOnDrop(!1);this._draggable.setIgnoreScale(!0);this.getGameState().bringEntityToFront(this._manipulator);this.getEntity().setScale(d,d);d=this.getEntity().getPosition();this._manipulator.setPosition(d.x,d.y);a=new c.comicCreator.EntityManipulator(this._manipulator,this.getEntity(),this._draggable,a,e,this._camera,c.Layers.getUi());e=this.getEntity().getParent().getParent().getComponent(c.comicCreator.ComicPanel);if(null!=e){var d=e.getContentRoot().getScale(),f=e.getContentRoot().getLocalPosition(),g=new b.Vector3D(e.getLocalCenter().x,e.getLocalCenter().y),f=new b.Vector3D(g.x-f.x,g.y-f.y);f.x/=d.x;f.y/=d.y;a.setDragBounds(new b.Rect2D(-e.getSize().x/2+f.x,-e.getSize().y/2+f.y,e.getSize().x,e.getSize().y))}this.getGameState().bringEntityToFront(this.getEntity(),!0)},hideManipulator:function(){null!=this._manipulator&&(this._manipulator.destroy(),this._manipulator=null)},onScaleGizmoUpdate:function(a){null!=this._button&&(a=this._draggableSize.getClone(),a.scaleBy(1,1),a.x=b.utilities.Math2.clamp(a.x,0.08,600),a.y=b.utilities.Math2.clamp(a.y,0.08,600),this._button.setCollisionProperties(a,null))},onMouseDown:function(){null==this._manipulator&&(this._canManipulate&&this.showManipulator().getComponent(c.comicCreator.EntityManipulator).setGizmoOffset(new b.Vector2D(this.getEntity().getParent().getPosition().x,this.getEntity().getParent().getPosition().y)),this.select())},select:function(){this.dispatchEvent(new c.comicCreator.SceneEntityEvent("select"))},__class__:c.comicCreator.SceneEntity});c.comicCreator.SceneEntityEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.SceneEntityEvent.__name__=!0;c.comicCreator.SceneEntityEvent.__super__=b.events.Event;c.comicCreator.SceneEntityEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.SceneEntityEvent});c.comicCreator.SeasonSelector=function(a){this._seasonNames=[];this._selectedSeasonIndex=0;var e=this;b.Component.call(this,a,"SeasonSelector");var d=this.getGameState().addEntity();new b.components.Button(d,new b.Vector2D(300,40),null,l(this,this.onSeasonSelectorClick));this._dropdownContainer=this.getGameState().addEntity();(new b.components.GameImage(this._dropdownContainer,"seasonSelectorDropDown",c.Layers.getUiFront())).centerOffsetOnEntity();a.addChild(this._dropdownContainer);this._dropdownContainer.setPosition(-1,130);a.addChild(d);(new b.components.GameImage(d,"seasonSelector",c.Layers.getUiFront())).centerOffsetOnEntity();a=this.getGameState().addEntity();(new b.components.Button(a,new b.Vector2D(350,350),null,null,null)).setKillMessageOnMouseDown(!0);this._dropdownContainer.addChild(a);for(a=0;null!=b.GameConfig.getProperty("seasonCategory"+a);){var d=b.GameConfig.getProperty("seasonCategory"+a),f=this.getGameState().addEntity();f.setPosition(0,-65+60*a);var g=this.getGameState().addEntity();g.setPosition(0,0);var h=new b.components.TextField(g,c.Layers.getUiFront());h.setFontFamily("agencyfbregular");h.setText(b.Localizer.getString("SEASON_"+b.GameConfig.getProperty("seasonCategory"+a).toUpperCase()));h.setTextAlign("center");h.setFontSize("28px");h.setFillStyle("#FFFFFF");f.addChild(g);(new b.components.GameImage(f,"seasonSelectorDropDownEntry",c.Layers.getUiFront(),null)).centerOffsetOnEntity();g=[a];(new b.components.Button(f,new b.Vector2D(250,45),null,function(a){return function(){e.setSelectedSeason(a[0]);e._dropdownContainer.setIsVisible(!1)}}(g))).setKillMessageOnMouseDown(!0);this._seasonNames.push(d);a++;this._dropdownContainer.addChild(f)}a=this.getGameState().addEntity();a.setPosition(-120,0);this.getEntity().addChild(a);this._textField=new b.components.TextField(a,c.Layers.getUiFront());this._textField.setTextAlign("left");this._textField.setFontSize("24px");this._dropdownContainer.setIsVisible(!1);this.getGameState().bringEntityToFront(this.getEntity(),!0);this.setSelectedSeason(0)};c.comicCreator.SeasonSelector.__name__=!0;c.comicCreator.SeasonSelector.__super__=b.Component;c.comicCreator.SeasonSelector.prototype=m(b.Component.prototype,{setSelectedSeason:function(a){this._selectedSeasonIndex=a;this._textField.setText(b.Localizer.getString("SEASON_"+this._seasonNames[this._selectedSeasonIndex].toUpperCase()));this.dispatchEvent(new c.comicCreator.SeasonSelectorEvent("seasonSelect",this._seasonNames[this._selectedSeasonIndex]))},onSeasonSelectorClick:function(){this._dropdownContainer.getIsVisible()?this._dropdownContainer.setIsVisible(!1):this._dropdownContainer.setIsVisible(!0);this.getGameState().bringEntityToFront(this.getEntity(),!0)},__class__:c.comicCreator.SeasonSelector});c.comicCreator.SeasonSelectorEvent=function(a,c){b.events.Event.call(this,a);this._season=c};c.comicCreator.SeasonSelectorEvent.__name__=!0;c.comicCreator.SeasonSelectorEvent.__super__=b.events.Event;c.comicCreator.SeasonSelectorEvent.prototype=m(b.events.Event.prototype,{getSeason:function(){return this._season},__class__:c.comicCreator.SeasonSelectorEvent});c.comicCreator.Spawner=function(a,c,d){b.Component.call(this,a,"Spawner");this._layer=c;this._camera=d};c.comicCreator.Spawner.__name__=!0;c.comicCreator.Spawner.__super__=b.Component;c.comicCreator.Spawner.prototype=m(b.Component.prototype,{getLayer:function(){return this._layer},setLayer:function(a){this._layer=a},getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},__class__:c.comicCreator.Spawner});c.comicCreator.comicAssets={};c.comicCreator.comicAssets.AnimationDefinition=function(a,b,c,f,g,h){this._assetName=a;this._xml=b;this._xOffset=c;this._yOffset=f;this._speed=g;this._defaultFrame=h};c.comicCreator.comicAssets.AnimationDefinition.__name__=!0;c.comicCreator.comicAssets.AnimationDefinition.getFromXmlNode=function(a){var b=a.get("assetName"),d=a.get("xml"),f=q.parseFloat(a.get("xOffset")),g=q.parseFloat(a.get("yOffset")),h=q.parseFloat(a.get("speed"));a=q.parseFloat(a.get("defaultFrame"));return new c.comicCreator.comicAssets.AnimationDefinition(b,d,f,g,h,a)};c.comicCreator.comicAssets.AnimationDefinition.prototype={getAssetName:function(){return this._assetName},getXml:function(){return this._xml},getSpeed:function(){return this._speed},getOffset:function(){return new b.Vector2D(this._xOffset,this._yOffset)},getDefaultFrame:function(){return this._defaultFrame},__class__:c.comicCreator.comicAssets.AnimationDefinition};c.comicCreator.comicAssets.BackgroundDefinition=function(a,c,d,f){this._parallax=1;this._scale=new b.Vector2D(1.05,1.05);this._assetName=a;this._xOffset=c;this._yOffset=d;this._parallax=f};c.comicCreator.comicAssets.BackgroundDefinition.__name__=!0;c.comicCreator.comicAssets.BackgroundDefinition.getFromXmlNode=function(a){var b=a.get("assetName"),d=q.parseFloat(a.get("xOffset")),f=q.parseFloat(a.get("yOffset"));a=q.parseFloat(a.get("parallax"));return new c.comicCreator.comicAssets.BackgroundDefinition(b,d,f,a)};c.comicCreator.comicAssets.BackgroundDefinition.prototype={getScale:function(){return this._scale},setScale:function(a,c){this._scale=new b.Vector2D(a,c)},getAssetName:function(){return this._assetName},getOffset:function(){return new b.Vector2D(this._xOffset,this._yOffset)},getParallax:function(){return this._parallax},createEntity:function(a,b,d){a=a.addEntity();(new c.StreamingGameImage(a,this.getAssetName(),d,b,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).setOffset(this.getOffset().x,this.getOffset().y);return a},__class__:c.comicCreator.comicAssets.BackgroundDefinition};c.comicCreator.comicAssets.ComicAssetDefinition=function(a,b,c,f,g,h){null==g&&(g="");null==f&&(f="");this._index=-1;this._name=a;this._thumbnail=b;this._category=c;this._sound=f;this._soundDrop=g;this._dragScale=h;this._imageDefinitions=[];this._backgroundDefinitions=[];this._animationDefinitions=[];this._glamFactoryFunctionDefinitions=[];this._frameDefinitions=[];this._filterDefinitions=[]};c.comicCreator.comicAssets.ComicAssetDefinition.__name__=!0;c.comicCreator.comicAssets.ComicAssetDefinition.getFromXmlNode=function(a){var b=a.get("name"),d;d=a.exists("thumbnail")?a.get("thumbnail"):b+"-thumb";var f=a.get("category"),g=a.get("sound"),h=a.get("soundDrop"),k;k=a.exists("dragScale")?q.parseFloat(a.get("dragScale")):0.5;var n;n=a.exists("exclusiveToLocales")?a.get("exclusiveToLocales").split(","):null;var l;l=a.exists("filter")?a.get("filter"):"";b=new c.comicCreator.comicAssets.ComicAssetDefinition(b,d,f,g,h,k);b.setFilter(l);b.setExclusiveToLocales(n);for(n=a.elementsNamed("image");n.hasNext();)l=n.next(),b.addImageDefinition(c.comicCreator.comicAssets.ImageDefinition.getFromXmlNode(l));for(n=a.elementsNamed("background");n.hasNext();)l=n.next(),b.addBackgroundDefinition(c.comicCreator.comicAssets.BackgroundDefinition.getFromXmlNode(l));for(n=a.elementsNamed("animation");n.hasNext();)l=n.next(),b.addAnimationDefinition(c.comicCreator.comicAssets.AnimationDefinition.getFromXmlNode(l));for(n=a.elementsNamed("glamFactoryFunction");n.hasNext();)l=n.next(),b.addGlamFactoryFunctionDefinition(c.comicCreator.comicAssets.GlamFactoryFunctionDefinition.getFromXmlNode(l));for(n=a.elementsNamed("frame");n.hasNext();)l=n.next(),b.addFrameDefinition(c.comicCreator.comicAssets.FrameDefinition.getFromXmlNode(l));for(a=a.elementsNamed("filter");a.hasNext();)n=a.next(),b.addFilterDefinition(c.comicCreator.comicAssets.FilterDefinition.getFromXmlNode(n));return b};c.comicCreator.comicAssets.ComicAssetDefinition.generateEntityFromComicAssetDefinition=function(a,e,d,f){for(var g=a.addEntity(),h=e.getImageDefinitions().length,k=0;k<h;){var n=k++,n=[e.getImageDefinitions()[n]],l=[a.addEntity()];l[0].setPosition(n[0].getOffset().x,n[0].getOffset().y);var m=new c.StreamingGameImage(l[0],n[0].getAssetName(),d,f,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch());n[0].getUseAnchor()&&!b.managers.AssetManager.assetExists(n[0].getAssetName())?m.addEventListener("loadComplete",function(a,c){return function(){var d=b.managers.AssetManager.getAsset(c[0].getAssetName());a[0].setPosition(-d.width*c[0].getAnchor().x,-d.height*c[0].getAnchor().y)}}(l,n)):n[0].getUseAnchor()&&(m=b.managers.AssetManager.getAsset(n[0].getAssetName()),l[0].setPosition(-m.width*n[0].getAnchor().x,-m.height*n[0].getAnchor().y));g.addChild(l[0])}h=e.getAnimationDefinitions().length;for(k=0;k<h;)n=k++,n=e.getAnimationDefinitions()[n],l=a.addEntity(),c.EntityFactory.createAnimation(n.getAssetName(),n.getXml(),n.getOffset(),n.getSpeed(),!0),(new b.components.GameSprite(l,n.getAssetName(),d,f)).setPosition(n.getDefaultFrame()),g.addChild(l);h=e.getGlamFactoryFunctionDefinitions().length;for(k=0;k<h;)n=k++,n=e.getGlamFactoryFunctionDefinitions()[n],n=c.glam.GlamFactory.createByName(n.functionName,a,d,f),g.addChild(n);return g};c.comicCreator.comicAssets.ComicAssetDefinition.generateThumbnailEntityFromComicAssetDefinition=function(a,b,d,f){a=a.addEntity();(new c.StreamingGameImage(a,b.getThumbnail(),d,f,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).centerOffsetOnEntity();return a};c.comicCreator.comicAssets.ComicAssetDefinition.prototype={setIndex:function(a){this._index=a},getIndex:function(){return this._index},setName:function(a){this._name=a},getName:function(){return this._name},getThumbnail:function(){return this._thumbnail},getCategory:function(){return this._category},setCategory:function(a){this._category=a},getSound:function(){return this._sound},getSoundDrop:function(){return this._soundDrop},getImageDefinitions:function(){return this._imageDefinitions},getBackgroundDefinitions:function(){return this._backgroundDefinitions},getAnimationDefinitions:function(){return this._animationDefinitions},getGlamFactoryFunctionDefinitions:function(){return this._glamFactoryFunctionDefinitions},getFrameDefinitions:function(){return this._frameDefinitions},getFilterDefinitions:function(){return this._filterDefinitions},getDragScale:function(){return this._dragScale},setFilter:function(a){this._filter=a},getFilter:function(){return this._filter},getExclusiveToLocales:function(){return this._exclusiveToLocales},setExclusiveToLocales:function(a){this._exclusiveToLocales=a},matchesFilter:function(a){a=a.split(",");for(var b=a.length,c=a.length,f=0;f<c;){f++;for(var g=this._filter.split(","),h=g.length,k=0;k<h;){var n=k++;if(0<=t.indexOf(a,g[n],0)){b--;break}}}return 0==b},addImageDefinition:function(a){this._imageDefinitions.push(a)},addBackgroundDefinition:function(a){this._backgroundDefinitions.push(a)},addAnimationDefinition:function(a){this._animationDefinitions.push(a)},addFrameDefinition:function(a){this._frameDefinitions.push(a)},addFilterDefinition:function(a){this._filterDefinitions.push(a)},addGlamFactoryFunctionDefinition:function(a){this._glamFactoryFunctionDefinitions.push(a)},setBackgroundComicAssetPlacement:function(a){this._backgroundComicPlacement=a},getBackgroundComicAssetPlacement:function(){return this._backgroundComicPlacement},__class__:c.comicCreator.comicAssets.ComicAssetDefinition};c.comicCreator.comicAssets.ComicAssetManager=function(){this._streamingLoadBatch=null;b.Manager.call(this);c.comicCreator.comicAssets.ComicAssetManager._instance=this;this._comicAssetDefinitions=[]};c.comicCreator.comicAssets.ComicAssetManager.__name__=!0;c.comicCreator.comicAssets.ComicAssetManager.getInstance=function(){return c.comicCreator.comicAssets.ComicAssetManager._instance};c.comicCreator.comicAssets.ComicAssetManager.__super__=b.Manager;c.comicCreator.comicAssets.ComicAssetManager.prototype=m(b.Manager.prototype,{getStreamingLoadBatch:function(){null==this._streamingLoadBatch&&(this._streamingLoadBatch=b.managers.AssetManager.getAsset("streamingAssets"));return this._streamingLoadBatch},getCategories:function(){return this._categories},init:function(){b.Manager.prototype.init.call(this);this.setup()},addComicAssetDefinition:function(a,b){null==b&&(b=!1);b?this._comicAssetDefinitions.splice(0,0,a):this._comicAssetDefinitions.push(a)},getAssetDefinitionByName:function(a){for(var b=this._comicAssetDefinitions.length,c=0;c<b;){var f=c++,f=this._comicAssetDefinitions[f];if(f.getName()==a)return f}return null},getAssetDefinitionsByCategory:function(a){for(var b=[],c=this._comicAssetDefinitions.length,f=0;f<c;){var g=f++,g=this._comicAssetDefinitions[g];g.getCategory()==a&&b.push(g)}return b},setup:function(){for(var a=s.parse(b.managers.AssetManager.getAsset("comicAssetDefinitions")).firstChild().elementsNamed("asset");a.hasNext();){var e=a.next(),e=c.comicCreator.comicAssets.ComicAssetDefinition.getFromXmlNode(e);this._comicAssetDefinitions.push(e)}this._categories=[];for(a=0;null!=b.GameConfig.getProperty("category"+a);)this._categories.push(b.GameConfig.getProperty("category"+a)),a++},__class__:c.comicCreator.comicAssets.ComicAssetManager});c.comicCreator.comicAssets.FilterDefinition=function(a,c,d){this._scale=new b.Vector2D(1,1);this._assetName=a;this._xOffset=c;this._yOffset=d};c.comicCreator.comicAssets.FilterDefinition.__name__=!0;c.comicCreator.comicAssets.FilterDefinition.getFromXmlNode=function(a){var b=a.get("assetName"),d=q.parseFloat(a.get("xOffset")),f=q.parseFloat(a.get("yOffset"));q.parseFloat(a.get("parallax"));return new c.comicCreator.comicAssets.FilterDefinition(b,d,f)};c.comicCreator.comicAssets.FilterDefinition.prototype={getScale:function(){return this._scale},setScale:function(a,c){this._scale=new b.Vector2D(a,c)},getAssetName:function(){return this._assetName},getOffset:function(){return new b.Vector2D(this._xOffset,this._yOffset)},createEntity:function(a,b,c){return a.addEntity()},__class__:c.comicCreator.comicAssets.FilterDefinition};c.comicCreator.comicAssets.FrameDefinition=function(a,c,d,f,g){this._anchorHorizontal=this._anchorVertical="";this._width=this._height=0;this._scale=new b.Vector2D(1,1);this._assetName=a;this._xOffset=c;this._yOffset=d;this._anchorHorizontal=f;this._anchorVertical=g};c.comicCreator.comicAssets.FrameDefinition.__name__=!0;c.comicCreator.comicAssets.FrameDefinition.getFromXmlNode=function(a){var b=a.get("assetName"),d=q.parseFloat(a.get("xOffset")),f=q.parseFloat(a.get("yOffset"));q.parseFloat(a.get("parallax"));var g;g=a.exists("anchorHorizontal")?a.get("anchorHorizontal"):"";var h;h=a.exists("anchorVertical")?a.get("anchorVertical"):"";var k;k=a.exists("width")?q.parseFloat(a.get("width")):0;var n;n=a.exists("height")?q.parseFloat(a.get("height")):0;var l;l=a.exists("scaleX")?q.parseFloat(a.get("scaleX")):1;a=a.exists("scaleY")?q.parseFloat(a.get("scaleY")):1;b=new c.comicCreator.comicAssets.FrameDefinition(b,d,f,g,h);b.setWidth(k);b.setHeight(n);b.setScale(l,a);return b};c.comicCreator.comicAssets.FrameDefinition.prototype={getWidth:function(){return this._width},setWidth:function(a){this._width=a},getHeight:function(){return this._height},setHeight:function(a){this._height=a},getAnchorHorizontal:function(){return this._anchorHorizontal},setAnchorHorizontal:function(a){this._anchorHorizontal=a},getAnchorVertical:function(){return this._anchorVertical},setAnchorVertical:function(a){this._anchorVertical=a},getScale:function(){return this._scale},setScale:function(a,c){this._scale=new b.Vector2D(a,c)},getAssetName:function(){return this._assetName},getOffset:function(){return new b.Vector2D(this._xOffset,this._yOffset)},createEntity:function(a,c,d){a=a.addEntity();(new b.components.GameImage(a,this.getAssetName(),d,c)).setOffset(this.getOffset().x,this.getOffset().y);return a},__class__:c.comicCreator.comicAssets.FrameDefinition};c.comicCreator.comicAssets.GlamFactoryFunctionDefinition=function(a){this.functionName=a};c.comicCreator.comicAssets.GlamFactoryFunctionDefinition.__name__=!0;c.comicCreator.comicAssets.GlamFactoryFunctionDefinition.getFromXmlNode=function(a){a=a.get("functionName");return new c.comicCreator.comicAssets.GlamFactoryFunctionDefinition(a)};c.comicCreator.comicAssets.GlamFactoryFunctionDefinition.prototype={__class__:c.comicCreator.comicAssets.GlamFactoryFunctionDefinition};c.comicCreator.comicAssets.ImageDefinition=function(a,b,c){this._useAnchor=!1;this._anchorX=this._anchorY=0.5;this._assetName=a;this._xOffset=b;this._yOffset=c};c.comicCreator.comicAssets.ImageDefinition.__name__=!0;c.comicCreator.comicAssets.ImageDefinition.getFromXmlNode=function(a){var b=a.get("assetName"),d=0,f=0;a.exists("xOffset")&&(d=q.parseFloat(a.get("xOffset")));a.exists("yOffset")&&(f=q.parseFloat(a.get("yOffset")));b=new c.comicCreator.comicAssets.ImageDefinition(b,d,f);a.exists("xOffset")||a.exists("yOffset")||b.setUseAnchor(!0);return b};c.comicCreator.comicAssets.ImageDefinition.prototype={getAnchor:function(){return new b.Vector2D(this._anchorX,this._anchorY)},setAnchor:function(a,b){this._anchorX=a;this._anchorY=b},getUseAnchor:function(){return this._useAnchor},setUseAnchor:function(a){this._useAnchor=a},getAssetName:function(){return this._assetName},getOffset:function(){return new b.Vector2D(this._xOffset,this._yOffset)},setOffset:function(a,b){this._xOffset=a;this._yOffset=b},__class__:c.comicCreator.comicAssets.ImageDefinition};c.comicCreator.comicCompositions={};c.comicCreator.comicCompositions.ComicAssetPlacement=function(a,b,c,f,g,h,k){this._x=a;this._y=b;this._rotation=c;this._scaleX=f;this._scaleY=g;this._paneIndex=h;this._assetName=k};c.comicCreator.comicCompositions.ComicAssetPlacement.__name__=!0;c.comicCreator.comicCompositions.ComicAssetPlacement.prototype={getX:function(){return this._x},getY:function(){return this._y},getRotation:function(){return this._rotation},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getPaneIndex:function(){return this._paneIndex},getAssetName:function(){return this._assetName},__class__:c.comicCreator.comicCompositions.ComicAssetPlacement};c.comicCreator.comicCompositions.ComicComposition=function(a,b){this._id=a;this._placements=[];this._comicPanelOffsets=[];this._comicTemplateName=b;for(var d=this.getComicTemplateDefinition().getComicPanels().length,f=0;f<d;){var g=f++,g=this.getComicTemplateDefinition().getComicPanels()[g];this._comicPanelOffsets.push(new c.comicCreator.comicCompositions.ComicPanelOffset(g.getCenter().x,g.getCenter().y,1,1))}};c.comicCreator.comicCompositions.ComicComposition.__name__=!0;c.comicCreator.comicCompositions.ComicComposition.getFromXml=function(a){a=a.get("data");return c.comicCreator.comicCompositions.ComicComposition.decode(a)};c.comicCreator.comicCompositions.ComicComposition.encode=function(a){return JSON.stringify(a)};c.comicCreator.comicCompositions.ComicComposition.decode=function(a){var b=JSON.parse(a);a=new c.comicCreator.comicCompositions.ComicComposition(b._id,b._comicTemplateName);for(var d=b._placements,f=d.length,g=0;g<f;){var h=g++,h=d[h],k=q.parseFloat(h._x),n=q.parseFloat(h._y),l=q.parseFloat(h._rotation),m=q.parseFloat(h._scaleX),r=q.parseFloat(h._scaleY),h=new c.comicCreator.comicCompositions.ComicAssetPlacement(k,n,l,m,r,h._paneIndex,h._assetName);a.addPlacement(h)}b=b._comicPanelOffsets;d=b.length;for(f=0;f<d;)g=f++,l=b[g],h=q.parseFloat(l.x),k=q.parseFloat(l.y),n=q.parseFloat(l.scaleX),l=q.parseFloat(l.scaleY),h=new c.comicCreator.comicCompositions.ComicPanelOffset(h,k,n,l),a.getComicPanelOffsets()[g]=h;return a};c.comicCreator.comicCompositions.ComicComposition.prototype={getComicPanelOffsets:function(){return this._comicPanelOffsets},getComicTemplateDefinition:function(){return c.comicTemplates.ComicTemplateManager.getInstance().getComicTemplateDefinitionById(this._comicTemplateName)},getComicTemplateName:function(){return this._comicTemplateName},getId:function(){return this._id},addPlacement:function(a){this._placements.push(a)},getPlacements:function(){return this._placements},__class__:c.comicCreator.comicCompositions.ComicComposition};c.comicCreator.comicCompositions.ComicCompositionManager=function(){b.Manager.call(this);c.comicCreator.comicCompositions.ComicCompositionManager._instance=this;this._comicCompositions=[]};c.comicCreator.comicCompositions.ComicCompositionManager.__name__=!0;c.comicCreator.comicCompositions.ComicCompositionManager.getInstance=function(){return c.comicCreator.comicCompositions.ComicCompositionManager._instance};c.comicCreator.comicCompositions.ComicCompositionManager.__super__=b.Manager;c.comicCreator.comicCompositions.ComicCompositionManager.prototype=m(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this);this.setup()},setup:function(){for(var a=s.parse(b.managers.AssetManager.getAsset("comicCompositions")).firstChild().elementsNamed("composition");a.hasNext();){var e=a.next(),e=c.comicCreator.comicCompositions.ComicComposition.getFromXml(e);this._comicCompositions.push(e)}},getCompositionById:function(a){for(var b=this._comicCompositions.length,c=0;c<b;){var f=c++,f=this._comicCompositions[f];if(f.getId()==a)return f}return null},__class__:c.comicCreator.comicCompositions.ComicCompositionManager});c.comicCreator.comicCompositions.ComicPanelOffset=function(a,b,c,f){this.scaleX=this.scaleY=1;this.x=this.y=0;this.x=a;this.y=b;this.scaleX=c;this.scaleY=f};c.comicCreator.comicCompositions.ComicPanelOffset.__name__=!0;c.comicCreator.comicCompositions.ComicPanelOffset.prototype={__class__:c.comicCreator.comicCompositions.ComicPanelOffset};c.comicCreator.hud={};c.comicCreator.hud.ComicCreatorEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.hud.ComicCreatorEvent.__name__=!0;c.comicCreator.hud.ComicCreatorEvent.__super__=b.events.Event;c.comicCreator.hud.ComicCreatorEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.hud.ComicCreatorEvent});c.comicCreator.hud.Hud=function(a,e,d,f){this._comicCreatorTabs=[];this._currentSeasonSelected="";this._characterTabs="superman batman wonderWoman aquaman flash greenLantern villains".split(" ");b.Component.call(this,a,"Hud");c.comicCreator.hud.Hud._instance=this;this._layer=e;this._bgLayer=d;this._uiLayer=f;this.construct()};c.comicCreator.hud.Hud.__name__=!0;c.comicCreator.hud.Hud.getInstance=function(){return c.comicCreator.hud.Hud._instance};c.comicCreator.hud.Hud.__super__=b.Component;c.comicCreator.hud.Hud.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.updateSoundIcon()},construct:function(){this._uiPanel=c.UiFactory.createFullscreenUiPanel(this.getGameState());var a=new b.components.Tweener(this.getEntity()),e=this.getGameState().addEntity();new b.components.GameImage(e,"hudFrame",this._layer);var e=this.getGameState().addEntity(),d=new b.ui.UiElement(e,this._uiPanel);d.setAlignment(b.ui.UiElementHorizontalAlignment.Left,b.ui.UiElementVerticalAlignment.Top);d.setCoords(new b.Vector2D(-1,-1));(new b.components.DeferredActionComponent(this.getGameState().addEntity())).addDeferredAction(0.4,function(){b.managers.SoundManager.playSoundByName("ui_swish_2")});this._itemDockRoot=this.getGameState().addEntity();this._itemDockRoot.setPosition(200,-10);d=this.getGameState().addEntity();d.setPosition(100,98);d=new b.components.TextField(d,this._layer);d.setTextAlign("right");d.setFontSize("22px");d.setText(b.Localizer.getString("COMIC_CREATOR_CATEGORIES"));d=this.getGameState().addEntity();d.setPosition(115,96);(new b.components.GameImage(d,"tabArrow",this._layer)).centerOffsetOnEntity();d=this.getGameState().addEntity();d.setPosition(130,98);this._categoryText=new b.components.TextField(d,this._layer);this._categoryText.setTextAlign("left");this._categoryText.setFontSize("22px");this._categoryText.setText(b.Localizer.getString("COMIC_CREATOR_CATEGORIES"));e.addChild(this._itemDockRoot);e=this.getGameState().addEntity();this._itemDockRoot.addChild(e);e.setPosition(0,0);this._itemList=new c.comicCreator.hud.itemDock.ItemList(e,this._layer,-18,185,!1,l(this,this.listMaskFunction));d=this.getGameState().addEntity();d.setPosition(80,150);this._scrollBar=new c.ScrollBar(d,"scrollBar",new b.Rect2D(0,150,0,402),this._layer);e.addChild(d);d=this.getGameState().addEntity();this._itemDockRoot.addChild(d);d.setPosition(0,0);this._categoryList=new c.comicCreator.hud.itemDock.ItemList(e,this._layer,0,185,!1,l(this,this.listMaskFunction));this._seasonItemDockRoot=this.getGameState().addEntity();this._seasonItemDockRoot.setPosition(335,625);for(var e=-20,d=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getCategories().length,f=0;f<d;){var g=f++,h=this.getGameState().addEntity();h.setName("tab"+g);this._categoryList.addItem(h,!0);this._comicCreatorTabs.push(h);var k=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getCategories()[g];h.setScale(0,0);a.addTween(h.getScaleRef(),"x",0.65,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0.15+0.15*g);a.addTween(h.getScaleRef(),"y",0.65,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0.15+0.15*g);g=new c.comicCreator.hud.itemDock.CategoryTab(h,k,100,100,"category_"+k,1,this._layer);g.setDefaultImageName("comicCreatorCategoryButton");k==b.GameConfig.getProperty("defaultCategory")&&(this._currentCategorySelected=g);h.addEventListener("mouseDown",l(this,this.onTabMouseDown));h.setPosition(-132,e);e+=82;g.setButtonSelected(k==b.GameConfig.getProperty("defaultCategory"))}this._homeButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),71,42,"homeButton","homeButton",l(this,this.onHomeButtonClick),this._layer,"ui_click_1","",!1,0.05);this._undoButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),155,42,"undoButton","undoButton",l(this,this.onUndoButtonClick),this._layer,"ui_click_1","",!1,0.05);this._finishButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),236,42,"comicCreatorFinishButton","comicCreatorFinishButton",l(this,this.onFinishClick),this._layer,"ui_click_1","",!1);this.setItemListCategory(b.GameConfig.getProperty("defaultCategory"),this._currentSeasonSelected)},onSeasonSelect:function(a){this._currentSeasonSelected=a.getSeason();this.setItemListCategory(this._currentCategorySelected.getCategory(),a.getSeason())},onScrollUpClick:function(){this._itemList.scroll(-420)},onScrollDownClick:function(){this._itemList.scroll(420)},onCategoryScrollUpClick:function(){this._categoryList.scroll(-105)},onCategoryScrollDownClick:function(){this._categoryList.scroll(105)},enableHomeButton:function(){this._homeButton.getComponent(b.components.Button).setIsActive(!0);this._homeButton.getComponent(b.components.GameImage).setAlpha(1)},disableHomeButton:function(){this._homeButton.getComponent(b.components.Button).setIsActive(!1);this._homeButton.getComponent(b.components.GameImage).setAlpha(0.5)},enableFinishButton:function(){this._finishButton.getComponent(b.components.Button).setIsActive(!0);this._finishButton.getComponent(b.components.GameImage).setAlpha(1)},disableFinishButton:function(){this._finishButton.getComponent(b.components.Button).setIsActive(!1);this._finishButton.getComponent(b.components.GameImage).setAlpha(0.5)},enableResetButton:function(){this._resetButton.getComponent(b.components.Button).setIsActive(!0);this._resetButton.getComponent(b.components.GameImage).setAlpha(1)},disableResetButton:function(){this._resetButton.getComponent(b.components.Button).setIsActive(!1);this._resetButton.getComponent(b.components.GameImage).setAlpha(0.5)},enableTabButtons:function(){for(var a=this._comicCreatorTabs.length,c=0;c<a;){var d=c++;this._comicCreatorTabs[d].getComponent(b.components.Button).setIsActive(!0);this._comicCreatorTabs[d].getComponent(b.components.GameImage).setAlpha(1)}},disableTabButtons:function(){for(var a=this._comicCreatorTabs.length,c=0;c<a;){var d=c++;this._comicCreatorTabs[d].getComponent(b.components.Button).setIsActive(!1);this._comicCreatorTabs[d].getComponent(b.components.GameImage).setAlpha(0.5)}},update:function(){b.Component.prototype.update.call(this);null!=this._currentDraggableListItem&&this.getGameState().bringEntityToFront(this._currentDraggableListItem,!0);null!=this._scrollBar&&this.getGameState().bringEntityToFront(this._scrollBar.getEntity());this._itemList.scrollTo(this._scrollBar.getPercentage())},onHelpButtonClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("helpClick"))},onHomeButtonClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("homeButtonClick"))},onResetButtonClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("resetClick"))},onSoundButtonClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("soundButtonClick"));this.updateSoundIcon()},setItemListCategory:function(a,e){this._itemList.clearList();var d=c.challenges.ChallengeManager.getInstance().getChallengeByCompositionId(c.GameTracker.getInstance().getCurrentComicComposition().getId());null!=d&&d.getId();d=0;if("characters"==a)for(var f=this._characterTabs.length,g=0;g<f;){var h=g++,m=this.getGameState().addEntity();(new b.components.GameImage(m,this._characterTabs[h]+
"Tab",this._uiLayer)).centerOffsetOnEntity();var n=new c.comicCreator.hud.itemDock.CharacterFilterButton(m,this._characterTabs[h]);0<=e.indexOf(this._characterTabs[h])&&n.open();n.addEventListener("open",l(this,this.onCharacterTabOpen));n.addEventListener("close",l(this,this.onCharacterTabClose));var q=new c.comicCreator.hud.itemDock.ItemListSizeOverride(m);q.maxWidth=250;q.maxHeight=80;n.getOpen()?q.height=75:q.height=50;this._itemList.addItem(m);if(e==this._characterTabs[h])for(h=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getAssetDefinitionsByCategory(a),m=h.length,n=0;n<m;){var q=n++,s=h[q];null!=s.getExclusiveToLocales()&&0>function(a){a=s.getExclusiveToLocales();return t.indexOf(a,k.dataLocale,0)}(this)||!s.matchesFilter(e+",general")||(q=c.comicCreator.comicAssets.ComicAssetDefinition.generateThumbnailEntityFromComicAssetDefinition(this.getGameState(),s,this._uiLayer,null),this._itemList.addItem(q),d++,(new c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail(q,s)).addEventListener("mouseDown",l(this,this.onDraggableItemThumbnailMouseDown)),new c.effects.ButtonMouseOverFloat(q,0.1))}}else for(d=c.comicCreator.comicAssets.ComicAssetManager.getInstance().getAssetDefinitionsByCategory(a),f=d.length,h=g=0;h<f;){var m=h++,r=d[m];null!=r.getExclusiveToLocales()&&0>function(a){a=r.getExclusiveToLocales();return t.indexOf(a,k.dataLocale,0)}(this)||!r.matchesFilter(e+",general")||(m=c.comicCreator.comicAssets.ComicAssetDefinition.generateThumbnailEntityFromComicAssetDefinition(this.getGameState(),r,this._uiLayer,null),this._itemList.addItem(m),g++,(new c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail(m,r)).addEventListener("mouseDown",l(this,this.onDraggableItemThumbnailMouseDown)),new c.effects.ButtonMouseOverFloat(m,0.1))}this._itemList.updateListButtons();this._categoryText.setText(b.Localizer.getString("CATEGORY_"+a.toUpperCase()));this.getGameState().bringEntityToFront(this._scrollUpButton);this.getGameState().bringEntityToFront(this._scrollDownButton)},onCharacterTabOpen:function(a){a=a.getCharacterFilterButton().getFilterName();this.setItemListCategory("characters",a)},onCharacterTabClose:function(a){this.setItemListCategory("characters","")},onDraggableItemThumbnailMouseDown:function(a){if("frameClear"==a.getComicAssetDefinition().getName())this.dispatchEvent(new c.comicCreator.hud.HudClearFilterEvent("clearFiltersClick",c.comicCreator.FilterUndoManager.getInstance().getLastComicPanelAdded()));else{var e=a.target.getEntity();a=a.getComicAssetDefinition();a.getIndex();var d=c.comicCreator.comicAssets.ComicAssetDefinition.generateEntityFromComicAssetDefinition(this.getGameState(),a,this._uiLayer);d.setPosition(e.getPosition().x,e.getPosition().y);a.getCategory();d.setScale(a.getDragScale(),a.getDragScale(),a.getDragScale());e=new b.components.Tweener(d);e.addTween(d.getScaleRef(),"x",0,d.getScale().x,0.35,b.components.tween.EasingFunctions.easeOutBack);e.addTween(d.getScaleRef(),"y",0,d.getScale().y,0.35,b.components.tween.EasingFunctions.easeOutBack);e=new b.components.Draggable(d,new b.Vector2D(100,100));e.addEventListener("stopDragging",l(this,this.onStopDraggingDraggableAsset));e.startDragging(0,0);e.setReturnOnDrop(!1);e.setProperty("asset",a);this._currentDraggableListItem=d;b.managers.SoundManager.playSoundByName(a.getSound());this.dispatchEvent(new c.comicCreator.hud.HudEvent("itemDockClick"))}},onStopDraggingDraggableAsset:function(a){a=a.target;var e=a.getProperty("asset");b.managers.SoundManager.playSoundByName(e.getSoundDrop());a.getEntity().destroy();this.dispatchEvent(new c.comicCreator.hud.HudDropComicAssetEvent("dropAsset",b.managers.InputManager.getInstance().getMousePosition().x,b.managers.InputManager.getInstance().getMousePosition().y,e));this._currentDraggableListItem=null},onTabMouseDown:function(a){a=a.target.getComponent(c.comicCreator.hud.itemDock.CategoryTab);null!=this._currentCategorySelected&&this._currentCategorySelected!=a&&this._currentCategorySelected.setButtonSelected(!1);this._itemList.clearList();this.setItemListCategory(a.getCategory(),this._currentSeasonSelected);this._currentCategorySelected=a;this._currentCategorySelected.setButtonSelected(!0);c.utag.UtagManager.getInstance().link2("games","select category","select sticker category "+a.getCategory(),"[Game Title]");this.dispatchEvent(new c.comicCreator.hud.HudEvent("itemDockClick"))},onBackButtonClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("backButtonClick"))},onPreviousPanelClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("previousPanelClick"))},onNextPanelClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("nextPanelClick"))},onPreviewClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("previewClick"))},onFinishClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("finishClick"))},onAvatarCreatorClick:function(){this.dispatchEvent(new c.comicCreator.hud.HudEvent("avatarCreatorClick"))},onUndoButtonClick:function(){this.onResetButtonClick()},listMaskFunction:function(a){a.beginPath();var b=this._itemDockRoot.getPosition();a.moveTo(b.x-80,b.y+112);a.lineTo(b.x+271,b.y+112);a.lineTo(b.x+271,b.y+567);a.lineTo(b.x-80,b.y+567);a.closePath()},updateSoundIcon:function(){var a=this._undoButton.getComponent(b.components.buttons.ButtonMouseOverImage);a.setDefaultImage(b.managers.SoundManager.getMusicMuted()?"comicCreatorSoundOff":"comicCreatorSoundOn");a.setMouseOverImage(b.managers.SoundManager.getMusicMuted()?"comicCreatorSoundOff":"comicCreatorSoundOn")},destroy:function(){b.Component.prototype.destroy.call(this);c.comicCreator.hud.Hud._instance==this&&(c.comicCreator.hud.Hud._instance=null)},__class__:c.comicCreator.hud.Hud});c.comicCreator.hud.HudClearFilterEvent=function(a,c){b.events.Event.call(this,a);this._panelIndex=c};c.comicCreator.hud.HudClearFilterEvent.__name__=!0;c.comicCreator.hud.HudClearFilterEvent.__super__=b.events.Event;c.comicCreator.hud.HudClearFilterEvent.prototype=m(b.events.Event.prototype,{getPanelIndex:function(){return this._panelIndex},__class__:c.comicCreator.hud.HudClearFilterEvent});c.comicCreator.hud.HudDropComicAssetEvent=function(a,c,d,f){b.events.Event.call(this,a);this._x=c;this._y=d;this._comicAssetDefinition=f};c.comicCreator.hud.HudDropComicAssetEvent.__name__=!0;c.comicCreator.hud.HudDropComicAssetEvent.__super__=b.events.Event;c.comicCreator.hud.HudDropComicAssetEvent.prototype=m(b.events.Event.prototype,{getComicAssetDefinition:function(){return this._comicAssetDefinition},getPosition:function(){return new b.Vector2D(this._x,this._y)},__class__:c.comicCreator.hud.HudDropComicAssetEvent});c.comicCreator.hud.HudEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.hud.HudEvent.__name__=!0;c.comicCreator.hud.HudEvent.__super__=b.events.Event;c.comicCreator.hud.HudEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.hud.HudEvent});c.comicCreator.hud.itemDock={};c.comicCreator.hud.itemDock.CategoryTab=function(a,c,d,f,g,h,k){b.Component.call(this,a,"CategoryTab");this._category=c;this._iconName=g;this._iconScale=h;this._layer=k;this._buttonWidth=d;this._buttonHeight=f;b.managers.AssetManager.assetExists(this._iconName)?(this._iconGameImage=new b.components.GameImage(this.getEntity(),this._iconName,this._layer),this._iconGameImage.setScale(this._iconScale,this._iconScale),this._iconGameImage.centerOffsetOnEntity(),this._iconGameImage.setOffset(this._iconGameImage.getOffset().x,this._iconGameImage.getOffset().y)):(a=new b.components.TextField(this.getEntity(),this._layer),a.setText(this._category),a.setFontSize("16px"),a.setFillStyle("#000000"));this._button=new b.components.Button(this.getEntity(),new b.Vector2D(this._buttonWidth,this._buttonHeight));this._button.setKillMessageOnMouseDown(!0);this._button.setOnMouseDown(function(){b.managers.SoundManager.playSoundByName("ui_click_1")});this._gameImage=this.getEntity().getComponent(b.components.GameImage);this._tweener=new b.components.Tweener(this.getEntity())};c.comicCreator.hud.itemDock.CategoryTab.__name__=!0;c.comicCreator.hud.itemDock.CategoryTab.__super__=b.Component;c.comicCreator.hud.itemDock.CategoryTab.prototype=m(b.Component.prototype,{getCategory:function(){return this._category},setDefaultImageName:function(a){this._defaultImageName=a},init:function(){b.Component.prototype.init.call(this)},update:function(){b.Component.prototype.update.call(this);if(null!=this._pointer){var a=this.getEntity().getComponent(b.components.GameImage);this._pointer.getComponent(b.components.GameImage).setScale(a.getScale().x,a.getScale().y);null!=this._pointer&&this._pointer.setScale(this.getEntity().getScale().x,this.getEntity().getScale().y)}},setButtonSelected:function(a){null==this._pointer&&a?(this._pointer=this.getGameState().addEntity(),this._pointer.setPosition(0,0),(new b.components.GameImage(this._pointer,"comicCreatorCategoryButtonSelectedPointer",this._layer)).centerOffsetOnEntity(),this.getEntity().addChild(this._pointer),this._tweener.addTween(this.getEntity().getScaleRef(),"x",0.5,1,0.15,b.components.tween.EasingFunctions.easeOutBack),this._tweener.addTween(this.getEntity().getScaleRef(),"y",0.5,1,0.15,b.components.tween.EasingFunctions.easeOutBack)):null==this._pointer||a||(this._pointer.destroy(),this._pointer=null)},__class__:c.comicCreator.hud.itemDock.CategoryTab});c.comicCreator.hud.itemDock.CharacterFilterButton=function(a,e){this._isOpen=!1;b.Component.call(this,a,"CharacterFilterButton");this._arrow=this.getGameState().addEntity();this.getEntity().addChild(this._arrow);(new b.components.GameImage(this._arrow,"tabArrow",c.Layers.getUiFront())).centerOffsetOnEntity();this._arrow.setPosition(50,0);this._filterName=e};c.comicCreator.hud.itemDock.CharacterFilterButton.__name__=!0;c.comicCreator.hud.itemDock.CharacterFilterButton.__super__=b.Component;c.comicCreator.hud.itemDock.CharacterFilterButton.prototype=m(b.Component.prototype,{getOpen:function(){return this._isOpen},getFilterName:function(){return this._filterName},init:function(){b.Component.prototype.init.call(this);this._button=new b.components.Button(this.getEntity(),new b.Vector2D(136,51),null,l(this,this.onClick))},onClick:function(){this._isOpen?this.close():this.open();b.managers.SoundManager.playSoundByName("ui_click_2")},open:function(){this._isOpen=!0;this._arrow.setRotation(0,0,b.utilities.Math2.degToRad(90));this.dispatchEvent(new c.comicCreator.hud.itemDock.CharacterFilterButtonEvent("open",this))},close:function(){this._isOpen=!1;this._arrow.setRotation(0,0,b.utilities.Math2.degToRad(0));this.dispatchEvent(new c.comicCreator.hud.itemDock.CharacterFilterButtonEvent("close",this))},__class__:c.comicCreator.hud.itemDock.CharacterFilterButton});c.comicCreator.hud.itemDock.CharacterFilterButtonEvent=function(a,c){b.events.Event.call(this,a);this._characterFilterButton=c};c.comicCreator.hud.itemDock.CharacterFilterButtonEvent.__name__=!0;c.comicCreator.hud.itemDock.CharacterFilterButtonEvent.__super__=b.events.Event;c.comicCreator.hud.itemDock.CharacterFilterButtonEvent.prototype=m(b.events.Event.prototype,{getCharacterFilterButton:function(){return this._characterFilterButton},__class__:c.comicCreator.hud.itemDock.CharacterFilterButtonEvent});c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail=function(a,c){b.Component.call(this,a,"DraggableItemThumbnail");this._comicAssetDefinition=c};c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail.__name__=!0;c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail.__super__=b.Component;c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);var a=new b.components.Button(this.getEntity(),new b.Vector2D(150,150));a.setKillMessageOnMouseDown(!0);a.setOnMouseDown(l(this,this.onMouseDown));a.setOnMouseUp(l(this,this.onMouseUp))},onMouseDown:function(){this.dispatchEvent(new c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent("mouseDown",this._comicAssetDefinition));b.managers.SoundManager.playSoundByName("ui_click_1")},onMouseUp:function(){this.dispatchEvent(new c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent("mouseUp",this._comicAssetDefinition))},__class__:c.comicCreator.hud.itemDock.DraggableComicAssetThumbnail});c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent=function(a,c){this._comicAssetDefinition=null;b.events.Event.call(this,a);this._comicAssetDefinition=c};c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent.__name__=!0;c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent.__super__=b.events.Event;c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent.prototype=m(b.events.Event.prototype,{getComicAssetDefinition:function(){return this._comicAssetDefinition},__class__:c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent});c.comicCreator.hud.itemDock.ItemList=function(a,c,d,f,g,h){null==g&&(g=!1);this._desiredY=this._accumulatedX=this._accumulatedY=0;this._numItemsTillScroll=4;this._xSpacing=0;this._ySpacing=105;this._startY=155;this._startX=5;this._canCreateDivider=!1;this._offsetX=20;b.Component.call(this,a,"ItemList");this._layer=c;this._canCreateDivider=g;this._listItems=[];this._dotDividers=[];this._scrollRoot=this.getGameState().addEntity();this._tweener=new b.components.Tweener(this.getEntity());this._startX=d;this._startY=f;this._scrollRoot.setPosition(this._startX,this._startY);this._maskingFunction=h;this._targetLayer=new b.Layer("itemListLayer",k.CANVAS_WIDTH_LANDSCAPE,k.CANVAS_HEIGHT_LANDSCAPE,null);this._targetLayer.setClearBounds(new b.Rect2D(0,0,350,this._targetLayer.getCanvas().height));b.GameManager.instance.insertLayerAfter(this._targetLayer,c);this._targetLayer.setMaskFunction(h)};c.comicCreator.hud.itemDock.ItemList.__name__=!0;c.comicCreator.hud.itemDock.ItemList.__super__=b.Component;c.comicCreator.hud.itemDock.ItemList.prototype=m(b.Component.prototype,{getXSpacing:function(){return this._xSpacing},setXSpacing:function(a){this._xSpacing=a},getYSpacing:function(){return this._ySpacing},setYSpacing:function(a){this._ySpacing=a},getNumItems:function(){return this._listItems.length},getListItems:function(){return this._listItems},init:function(){b.Component.prototype.init.call(this);this.getEntity().addChild(this._scrollRoot);this.updateListButtons()},addItem:function(a,e){null==e&&(e=!0);var d=this;a.setPosition(this._offsetX+this._accumulatedX,this._accumulatedY);var f=a.getComponent(c.comicCreator.hud.itemDock.ItemListSizeOverride),g=93.75,h=93.75;null==f?(this._accumulatedX+=this._xSpacing,this._accumulatedY+=this._ySpacing):(this._accumulatedX=0<f.width?this._accumulatedX+f.width:this._accumulatedX+this._xSpacing,this._accumulatedY=0<f.height?this._accumulatedY+f.height:this._accumulatedY+this._ySpacing,g=0<f.maxWidth?f.maxWidth:93.75,h=0<f.maxHeight?f.maxHeight:93.75);var k=0,n=0;console.log(this._accumulatedY);e&&new c.OffscreenImageHide(a);(function(){if(null!=d._maskingFunction){var e=a.getComponentsInChildren(b.components.GameImage);if(null!=e)for(var f=e.length,l=0;l<f;){var m=l++,m=e[m];m.setLayer(d._targetLayer);m.setScale(1,1);k<m.getSize().x&&(k=m.getSize().x);n<m.getSize().y&&(n=m.getSize().y);m.getEntity()!=a&&1==f&&m.getEntity().setPosition(0,0);1==f&&m.centerOffsetOnEntity();if(y.getClass(m)==c.StreamingGameImage){var q=m;null==q||(q.getLoaded()||null!=a.getProperty("loadingImage"))||(q=d.getGameState().addEntity(),(new b.components.GameImage(q,"loadingArrow",d._targetLayer)).centerOffsetOnEntity(),a.setProperty("loadingImage",q),new b.components.FollowEntity(q,a),(new b.components.SimpleMovement(q)).setAngularVelocity(new b.Vector3D(0,0,b.utilities.Math2.degToRad(360))))}m.addEventListener("loadComplete",function(a){return function(){d.refresh()}}(this))}e=a.getComponentsInChildren(b.components.GameSprite);if(null!=e)for(f=e.length,l=0;l<f;)m=l++,e[m].stop(),n=k=100}k>n?k>g&&a.setScale(g/k,g/k):n>h&&a.setScale(h/n,h/n)})();0<this._listItems.length&&this._canCreateDivider&&this.createDotDivider(this.getNumItems()*this._xSpacing,this.getNumItems()*this._ySpacing-this._ySpacing/2);this._listItems.push(a);this._scrollRoot.addChild(a)},refresh:function(){console.log("refresh()");for(var a=this._listItems.length,e=0;e<a;){var d=e++,f=0,g=0,d=this._listItems[d],h=93.75,k=93.75,n=d.getComponent(c.comicCreator.hud.itemDock.ItemListSizeOverride);null!=n&&(h=0<n.maxWidth?n.maxWidth:93.75,k=0<n.maxHeight?n.maxHeight:93.75);if(null!=this._maskingFunction){n=d.getComponentsInChildren(b.components.GameImage);if(null!=n)for(var l=n.length,m=0;m<l;){var q=m++,q=n[q];q.setScale(1,1);f<q.getSize().x&&(f=q.getSize().x);g<q.getSize().y&&(g=q.getSize().y);q.getEntity()!=d&&1==l&&q.getEntity().setPosition(0,0);1==l&&q.centerOffsetOnEntity();y.getClass(q)==c.StreamingGameImage&&(null!=q&&q.getLoaded()&&null!=d.getProperty("loadingImage"))&&(d.getProperty("loadingImage").destroy(),d.setProperty("loadingImage",null))}n=d.getComponentsInChildren(b.components.GameSprite);if(null!=n)for(l=n.length,m=0;m<l;)f=m++,n[f].stop(),g=f=100}f>g?f>h&&d.setScale(h/f,h/f):g>k&&d.setScale(k/g,k/g);f=d.getComponent(c.effects.ButtonMouseOverFloat);null!=f&&(f.setBaseScaleX(d.getScaleRef().x),f.setBaseScaleY(d.getScaleRef().y))}},clearList:function(){this._desiredY=this._accumulatedY=this._accumulatedX=0;for(var a=this.getNumItems(),b=0;b<a;){var c=b++;this._listItems[c].destroy()}this._listItems=[];a=this._dotDividers.length;for(b=0;b<a;)c=b++,this._dotDividers[c].destroy();this._dotDividers=[];this._scrollRoot.setPosition(this._startX,this._startY)},scrollTo:function(a,c){null==c&&(c=1);var d=-(this.getNumItems()*this._ySpacing);this._desiredY=(d+420)*a;0<this._desiredY&&(this._desiredY=0);this._desiredY<d&&(this._desiredY=d);this.disableListButtonsForYPosition(this._desiredY);this._tweener.destroyAllTweens();0<c?this._tweener.addTween(this._scrollRoot.getPositionRef(),"y",this._scrollRoot.getLocalPosition().y,this._startY+this._desiredY,c,b.components.tween.EasingFunctions.easeOutQuint,0):this._scrollRoot.setPosition(this._scrollRoot.getLocalPosition().x,this._startY+this._desiredY)},canScrollUp:function(){return 0!=this._desiredY&&this.getNumItems()>this._numItemsTillScroll},canScrollDown:function(){var a=-(this.getNumItems()*this._ySpacing);return this._desiredY>a+420&&this.getNumItems()>this._numItemsTillScroll},scroll:function(a,c){null==c&&(c=1);this._desiredY-=a;0<this._desiredY&&(this._desiredY=0);var d=-(this.getNumItems()*this._ySpacing);this._desiredY<d+420&&(this._desiredY=d+420);this.disableListButtonsForYPosition(this._desiredY);this._tweener.destroyAllTweens();this._tweener.addTween(this._scrollRoot.getPositionRef(),"y",this._scrollRoot.getLocalPosition().y,this._startY+this._desiredY,c,b.components.tween.EasingFunctions.easeOutQuint,0)},updateListButtons:function(){this.disableListButtonsForYPosition(this._scrollRoot.getLocalPosition().y-
this._startY)},disableListButtonsForYPosition:function(a){var c=-a-this._ySpacing-165;a=420-a+165;for(var d=0,f=this.getNumItems();d<f;){var g=d++,h=this._listItems[g],g=h.getLocalPosition().y>=c&&h.getLocalPosition().y<=a,h=h.getComponentsInChildren(b.components.Button);null!=h&&0<h.length&&h[0].setIsActive(g)}},createDotDivider:function(a,e){var d=this.getGameState().addEntity();d.setPosition(7+a,e);(new b.components.GameImage(d,"dotDividersWhite",this._targetLayer)).centerOffsetOnEntity();new c.OffscreenImageHide(d);this._dotDividers.push(d);this._scrollRoot.addChild(d)},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);this._targetLayer.destroy()},__class__:c.comicCreator.hud.itemDock.ItemList});c.comicCreator.hud.itemDock.ItemListSizeOverride=function(a){this.height=this.width=this.maxHeight=this.maxWidth=0;b.Component.call(this,a,"ItemListSizeOverride")};c.comicCreator.hud.itemDock.ItemListSizeOverride.__name__=!0;c.comicCreator.hud.itemDock.ItemListSizeOverride.__super__=b.Component;c.comicCreator.hud.itemDock.ItemListSizeOverride.prototype=m(b.Component.prototype,{__class__:c.comicCreator.hud.itemDock.ItemListSizeOverride});c.comicCreator.photoSelect={};c.comicCreator.photoSelect.Countdown=function(a){this._timeLeft=3;b.Component.call(this,a,"Countdown");var e=this.getGameState().addEntity();this._textField=new b.components.TextField(e,c.Layers.getUiFront());this._textField.setFontFamily("agencyfbregular");this._textField.setFontSize("128px");this._textField.setText("0");a.addChild(e)};c.comicCreator.photoSelect.Countdown.__name__=!0;c.comicCreator.photoSelect.Countdown.__super__=b.Component;c.comicCreator.photoSelect.Countdown.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},update:function(){b.Component.prototype.update.call(this);this._timeLeft-=b.GameManager.getElapsedTime();var a=Math.ceil(this._timeLeft);this._textField.setText(null==a?"null":""+a);0>=a&&this.getEntity().destroy()},__class__:c.comicCreator.photoSelect.Countdown});c.comicCreator.photoSelect.PhotoSelectDialog=function(a,c){this._allowBrowse=!1;this._inputEnabled=!0;b.Component.call(this,a,"PhotoSelectDialog");this._layer=c;this._tweener=new b.components.Tweener(this.getEntity());this._allowBrowse="1"==b.GameConfig.getProperty("browsePhotosButtonAllowed")};c.comicCreator.photoSelect.PhotoSelectDialog.__name__=!0;c.comicCreator.photoSelect.PhotoSelectDialog.__super__=b.Component;c.comicCreator.photoSelect.PhotoSelectDialog.prototype=m(b.Component.prototype,{init:function(){var a=this;b.Component.prototype.init.call(this);(new b.components.DeferredActionComponent(this.getEntity())).addDeferredAction(0.35,function(){a.onChooseDefaultPhoto()})},initDisplay:function(){this._uiPanel=c.UiFactory.createFullscreenUiPanel(this.getGameState());this._webcamUiPanel=c.UiFactory.createFullscreenUiPanel(this.getGameState());this._photoSelectRoot=this.getGameState().addEntity();this._webcamRoot=this.getGameState().addEntity();this.getEntity().addChild(this._photoSelectRoot);this.getEntity().addChild(this._webcamRoot);this._webcamRoot.setIsVisible(!1);this._webcamUiPanel.getEntity().setIsVisible(!1);var a=c.UiFactory.createUiElementEntityImage(this.getGameState(),this._uiPanel,0,0,"overlayBlack",this._layer.getName());(new b.ui.UiElement(a,this._uiPanel)).setScale(200,200);this._overlayImage=a.getComponent(b.components.GameImage);this._overlayImage.centerOffsetOnEntity();this._overlayImage.setAlpha(0.6);b.components.Button.createFromGameImage(a.getComponent(b.components.GameImage)).setKillMessageOnMouseDown(!0);this._uiPanel.getEntity().addChild(a);a=this.getGameState().addEntity();a.setPosition(9,-12);(new b.components.GameImage(a,"dialogBg",this._layer)).centerOffsetOnEntity();this._photoSelectRoot.addChild(a);a=this.getGameState().addEntity();a.setPosition(0,-250);var e=new b.components.TextField(a,this._layer);e.setFontFamily("agencyfbregular");e.setFontSize("54px");e.setFillStyle("#ffffff");e.setText(b.Localizer.getString("PHOTO_SELECT_HEADING"));this._photoSelectRoot.addChild(a);this._closeButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),310,-260,"closeButton","closeButton",l(this,this.onCloseButtonClick),this._layer,"ui_click_1");this._photoSelectRoot.addChild(this._closeButton);this._allowBrowse&&(this._photoSelectButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),0,-50,"browseButton","browseButton",null,this._layer,"ui_click_1",null,!1,0.15,null),a=this.getGameState().addEntity(),a.setPosition(37,4),this._photoSelectButton.addChild(a),a=new b.components.TextField(a,this._layer),a.setFontFamily("agencyfbregular"),a.setFillStyle("#FFFFFF"),a.setFontSize("32px"),a.setTextAlign("center"),a.setText(b.Localizer.getString("PHOTO_SELECT_FILE")),b.GameManager.isInternetExplorer()?this._photoSelectButton.getButton().setOnMouseDown(l(this,this.onPhotoSelectButtonClick)):(b.GameManager.isMobile(),this._photoSelectButton.getButton().setOnMouseUp(l(this,this.onPhotoSelectButtonClick))),this._photoSelectRoot.addChild(this._photoSelectButton));this._chooseBarbieButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),0,65,"chooseBarbieButton","chooseBarbieButton",l(this,this.onChooseDefaultPhoto),this._layer,"ui_click_1",null,!1,0.35,null);a=this.getGameState().addEntity();a.setPosition(37,4);this._chooseBarbieButton.addChild(a);a=new b.components.TextField(a,this._layer);a.setFontFamily("agencyfbregular");a.setFillStyle("#FFFFFF");a.setFontSize("32px");a.setTextAlign("center");a.setText(b.Localizer.getString("PHOTO_SELECT_CHOOSE"));this._allowBrowse||this._chooseBarbieButton.translate(0,-60);this._photoSelectRoot.addChild(this._chooseBarbieButton);a=this.getGameState().addEntity();this._photo=new b.components.GameImage(a,"",this._layer);this._photo.centerOffsetOnEntity();a.setPosition(6.5,-7);this._photoSelectRoot.addChild(a);a=this.getGameState().addEntity();a.setPosition(0,135);this.getEntity().addChild(a);a=c.UiFactory.createUiElementEntityImage(this.getGameState(),this._webcamUiPanel,0,0,"overlayBlack",this._layer.getName());(new b.ui.UiElement(a,this._webcamUiPanel)).setScale(200,200);this._overlayImage=a.getComponent(b.components.GameImage);this._overlayImage.centerOffsetOnEntity();this._overlayImage.setAlpha(0.6);b.components.Button.createFromGameImage(a.getComponent(b.components.GameImage)).setKillMessageOnMouseDown(!0);this._webcamUiPanel.getEntity().addChild(a);a=this.getGameState().addEntity();a.setPosition(9,-12);(new b.components.GameImage(a,"dialogBg",this._layer)).centerOffsetOnEntity();this._webcamRoot.addChild(a);a=this.getGameState().addEntity();a.setPosition(0,-250);e=new b.components.TextField(a,this._layer);e.setFontFamily("agencyfbregular");e.setFontSize("54px");e.setFillStyle("#ffffff");e.setText(b.Localizer.getString("PHOTO_SELECT_WEBCAM_PHOTO"));this._webcamRoot.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),310,-260,"closeButton","closeButton",l(this,this.onCloseTakePhotoButtonClick),this._layer,"ui_click_1","",!1);this._webcamRoot.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),0,180,"webcamButton","webcamButton",null,this._layer,"ui_click_1",null,!1,0.15,l(this,this.onTakePhotoButtonClick));e=this.getGameState().addEntity();e.setPosition(0,4);a.addChild(e);e=new b.components.TextField(e,this._layer);e.setFontFamily("agencyfbregular");e.setFillStyle("#FFFFFF");e.setFontSize("32px");e.setText(b.Localizer.getString("PHOTO_SELECT_TAKE_PHOTO"));this._webcamRoot.addChild(a)},onCloseTakePhotoButtonClick:function(){null!=this._countdown&&(this._countdown.getEntity().removeEventListener("destroy",l(this,this.onCountdownDestroy)),this._countdown.getEntity().destroy(),this._countdown=null);this._inputEnabled=!0;this.hideWebcamUi()},onWebcamButtonClick:function(){this.showWebcamUi()},showWebcamUi:function(){b.utilities.Debug.log("showWebcamUi()");this._uiPanel.getEntity().setIsVisible(!1);this._webcamUiPanel.getEntity().setIsVisible(!0);this._photoSelectRoot.setIsVisible(!1);this._webcamRoot.setIsVisible(!0)},hideWebcamUi:function(){b.utilities.Debug.log("hideWebcamUi()");this._uiPanel.getEntity().setIsVisible(!0);this._webcamUiPanel.getEntity().setIsVisible(!1);this._photoSelectRoot.setIsVisible(!0);this._webcamRoot.setIsVisible(!1)},onCloseButtonClick:function(){c.comicCreator.PhotoManager.clearLastPhoto();this.dismiss()},onPhotoFrameSelect:function(a){c.GameTracker.getInstance().getUserData().setCurrentCompositionIndex(a.getSelectedIndex())},onChooseDefaultPhoto:function(){c.ChooseBarbieScene.show(l(this,this.onChooseBarbieNextClick),l(this,this.onChooseBarbiePhotoDestroyed));this.dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("showGhostScreen"));this.getGameState().pause()},onChooseBarbieNextClick:function(){this.getGameState().dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("nextClick"));this.dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("dismissGhostScreen"));this.dismiss();this.onChooseBarbiePhotoDestroyed()},onChooseBarbiePhotoDestroyed:function(){this.dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("cancel"))},dismiss:function(){this.dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("close"))},onWebcamDisplay:function(a){this._webcamText.setText("");this._webcamButton.setIsVisible(!0);this._webcamBg.setIsVisible(!0)},onWebcamFail:function(a){b.GameManager.isMobile()||null!=this.getGameState()&&this._webcamText.setText(b.Localizer.getString("PHOTO_SELECT_NO_WEBCAM"))},onPhotoSelectButtonClick:function(){this._inputEnabled&&(b.GameManager.isInternetExplorer()&&(this._inputElement.style.visibility="inherit",this._inputElement.style.opacity="0.0"),this._inputElement.click(),b.GameManager.isInternetExplorer()&&(this._inputElement.style.visibility="hidden"))},onTakePhotoButtonClick:function(){if(this._inputEnabled){this._inputEnabled=!1;var a=this.getGameState().addEntity();a.setPosition(15,-30);this.getEntity().addChild(a);this._countdown=new c.comicCreator.photoSelect.Countdown(a);a.addEventListener("destroy",l(this,this.onCountdownDestroy))}},onCountdownDestroy:function(a){a.target.removeEventListener("destroy",l(this,this.onCountdownDestroy));a=this._webcamDisplay.toImage();c.comicCreator.PhotoManager.getInstance().registerPhotoImageElement(a);this.getGameState().dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("nextClick"));c.utag.UtagManager.getInstance().link2("games","choose photo","take own photo","[Game Title]");this.dismiss()},onInputElementChange:function(a){if(null==a.target.files)this._inputEnabled=!0;else{a=a.target.files[0];var b=new FileReader;b.addEventListener("load",l(this,this.onPhotoLoad),!1);b.readAsDataURL(a)}},onPhotoLoad:function(a){a=a.target.result;c.comicCreator.PhotoManager.getInstance().registerPhoto(a);a=c.comicCreator.PhotoManager.getLastPhoto();null!=a&&a.addEventListener("load",l(this,this.onImageElementLoad),!1)},centerPhoto:function(){},onImageElementLoad:function(){c.comicCreator.PhotoManager.getLastPhoto().removeEventListener("load",l(this,this.onImageElementLoad),!1);null!=this._photo&&null!=this._photo.getImageAsset()&&this._photo.getImageAsset().removeEventListener("load",l(this,this.onImageElementLoad),!1);c.utag.UtagManager.getInstance().link2("games","choose photo","choose from library","[Game Title]");null!=this.getGameState()&&(this.getGameState().dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("nextClick")),this.dismiss())},onNextClick:function(){this.getGameState().dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("nextClick"));this.dismiss()},destroy:function(){b.Component.prototype.destroy.call(this);null!=this._inputElement&&(this._inputElement.parentNode.removeChild(this._inputElement),this._inputElement=null)},__class__:c.comicCreator.photoSelect.PhotoSelectDialog});c.comicCreator.photoSelect.PhotoSelectDialogEvent=function(a){b.events.Event.call(this,a)};c.comicCreator.photoSelect.PhotoSelectDialogEvent.__name__=!0;c.comicCreator.photoSelect.PhotoSelectDialogEvent.__super__=b.events.Event;c.comicCreator.photoSelect.PhotoSelectDialogEvent.prototype=m(b.events.Event.prototype,{__class__:c.comicCreator.photoSelect.PhotoSelectDialogEvent});c.comicCreator.photoSelect.PhotoSelectScreen=function(a,e){b.GameState.call(this);this._root=this.addEntity();this._root.setPosition(b.GameManager.instance.getScreenSize().x/2,b.GameManager.instance.getScreenSize().y/2);var d=new c.comicCreator.photoSelect.PhotoSelectDialog(this._root,c.Layers.getUiFront());this.addEventListener("nextClick",l(this,this.onResume));d.addEventListener("showGhostScreen",l(this,this.onPause));d.addEventListener("dismissGhostScreen",l(this,this.onResume));d.addEventListener("close",l(this,this.onCloseButton));d.addEventListener("cancel",e);this._onClose=a;this._onCancel=e};c.comicCreator.photoSelect.PhotoSelectScreen.__name__=!0;c.comicCreator.photoSelect.PhotoSelectScreen.show=function(a,e){var d=new c.comicCreator.photoSelect.PhotoSelectScreen(a,e);b.GameManager.instance.addGameState(d);return d};c.comicCreator.photoSelect.PhotoSelectScreen.__super__=b.GameState;c.comicCreator.photoSelect.PhotoSelectScreen.prototype=m(b.GameState.prototype,{onPause:function(a){a.target.removeEventListener("showGhostScreen",l(this,this.onPause));this.dispatchEvent(new c.comicCreator.photoSelect.PhotoSelectDialogEvent("showGhostScreen"))},onResume:function(a){this.removeEventListener("nextClick",l(this,this.onResume));a.target.removeEventListener("dismissGhostScreen",l(this,this.onResume));null!=this._onClose&&(this._onClose(),this._onClose=null)},onCloseButton:function(a){this.destroy();null!=this._onClose&&this._onClose()},onCancel:function(){this.destroy();null!=this._onCancel&&this._onCancel()},__class__:c.comicCreator.photoSelect.PhotoSelectScreen});c.comicTemplates={};c.comicTemplates.ComicPanelDefinition=function(a,b,c){this._parallax=0.05;this._x=a;this._y=b;this._image=c;this._polygonPoints=[]};c.comicTemplates.ComicPanelDefinition.__name__=!0;c.comicTemplates.ComicPanelDefinition.getFromXmlNode=function(a){var e=q.parseFloat(a.get("x")),d=q.parseFloat(a.get("y")),f=a.get("image"),g=q.parseFloat(a.get("sceneEntityScale"));a.exists("parallax")&&q.parseFloat(a.get("parallax"));e=new c.comicTemplates.ComicPanelDefinition(e,d,f);e.setSceneEntityScale(g);var h=!0,k=f=d=g=0;for(a=a.elementsNamed("polygon").next().elementsNamed("point");a.hasNext();){var n=a.next(),l=q.parseFloat(n.get("x")),n=q.parseFloat(n.get("y")),m=new b.Vector2D(l,n);e.getPolygonPoints().push(m);if(h||l<g)g=l;if(h||n<d)d=n;if(h||l>f)f=l;if(h||n>k)k=n;h=!1}e.setX(e.getX()+g);e.setY(e.getY()+d);h=e.getPolygonPoints().length;for(a=0;a<h;)l=a++,l=e.getPolygonPoints()[l],l.x-=g,l.y-=d;f-=g;k-=d;e.setCenter((0+f)/2,(0+k)/2);return e};c.comicTemplates.ComicPanelDefinition.prototype={getX:function(){return this._x},setX:function(a){this._x=a},getY:function(){return this._y},setY:function(a){this._y=a},getImage:function(){return this._image},setImage:function(a){this._image=a},getParallax:function(){return this._parallax},setParallax:function(a){this._parallax=a},getPolygonPoints:function(){return this._polygonPoints},getCenter:function(){return new b.Vector2D(this._centerX,this._centerY)},setCenter:function(a,b){this._centerX=a;this._centerY=b},getSceneEntityScale:function(){return this._sceneEntityScale},setSceneEntityScale:function(a){this._sceneEntityScale=a},__class__:c.comicTemplates.ComicPanelDefinition};c.comicTemplates.ComicTemplateDefinition=function(a,b,c,f,g,h,k,l,m){this._id=a;this._thumbnailName=b;this._comicPanels=[];this._width=c;this._height=f;this._baseBackgroundAsset=g;this._backgroundName=h;this._backgroundOffsetX=k;this._backgroundOffsetY=l;this._level=m};c.comicTemplates.ComicTemplateDefinition.__name__=!0;c.comicTemplates.ComicTemplateDefinition.getFromXmlNode=function(a){var b=a.get("id"),d=a.get("thumbnailName"),f=q.parseFloat(a.get("width")),g=q.parseFloat(a.get("height")),h=a.get("baseBackgroundAsset"),k=a.get("backgroundName"),l=q.parseFloat(a.get("backgroundOffsetX")),m=q.parseFloat(a.get("backgroundOffsetY")),s=q.parseInt(a.get("level")),b=new c.comicTemplates.ComicTemplateDefinition(b,d,f,g,h,k,l,m,s);for(a=a.elementsNamed("panel");a.hasNext();)d=a.next(),d=c.comicTemplates.ComicPanelDefinition.getFromXmlNode(d),b.addPanelDefinition(d);return b};c.comicTemplates.ComicTemplateDefinition.prototype={getId:function(){return this._id},setId:function(a){this._id=a},getThumbnailName:function(){return this._thumbnailName},setThumbnailName:function(a){this._thumbnailName=a},getWidth:function(){return this._width},getHeight:function(){return this._height},getComicPanels:function(){return this._comicPanels},getBackgroundName:function(){return this._backgroundName},getBaseBackgroundAsset:function(){return this._baseBackgroundAsset},getBackgroundOffsetX:function(){return this._backgroundOffsetX},getBackgroundOffsetY:function(){return this._backgroundOffsetY},getLevel:function(){return this._level},addPanelDefinition:function(a){this._comicPanels.push(a)},__class__:c.comicTemplates.ComicTemplateDefinition};c.comicTemplates.ComicTemplateManager=function(){b.Manager.call(this);c.comicTemplates.ComicTemplateManager._instance=this;this._comicTemplates=[]};c.comicTemplates.ComicTemplateManager.__name__=!0;c.comicTemplates.ComicTemplateManager.getInstance=function(){return c.comicTemplates.ComicTemplateManager._instance};c.comicTemplates.ComicTemplateManager.__super__=b.Manager;c.comicTemplates.ComicTemplateManager.prototype=m(b.Manager.prototype,{getComicTemplates:function(){return this._comicTemplates},init:function(){b.Manager.prototype.init.call(this);this.setup()},setup:function(){for(var a=s.parse(b.managers.AssetManager.getAsset("comicTemplateDefinitions")).firstChild().elementsNamed("template");a.hasNext();){var e=a.next(),e=c.comicTemplates.ComicTemplateDefinition.getFromXmlNode(e);this._comicTemplates.push(e);c.levels.LevelManager.getInstance().registerComicTemplate(e)}},getComicTemplateDefinitionById:function(a){for(var b=this._comicTemplates.length,c=0;c<b;){var f=c++,f=this._comicTemplates[f];if(f.getId()==a)return f}return null},__class__:c.comicTemplates.ComicTemplateManager});c.effects={};c.effects.ButtonMouseOverFloat=function(a,c,d,f,g,h,k){null==k&&(k=2);null==h&&(h=8);null==g&&(g=4);null==f&&(f=3);null==d&&(d=0.15);null==c&&(c=1.25);this._floatStrength=0;this._rotationRate=this._baseScaleX=this._baseScaleY=1;this._rotationDegMagnitude=20;this._button=this._tweener=null;b.Component.call(this,a,"ButtonMouseOverScale");this._scaleUp=c;this._scaleDuration=d;this._rotationDegMagnitude=f;this._rotationRate=g;this._floatTranslation=h;this._floatTranslationRate=k;this._baseScaleX=this.getEntity().getScaleRef().x;this._baseScaleY=this.getEntity().getScaleRef().y;this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",l(this,this.onMouseOut));this._rotationPropertySineWave=new b.components.PropertySineWave(this.getEntity(),this.getEntity().getRotationRef(),"z",0,b.utilities.Math2.degToRad(this._rotationDegMagnitude),this._rotationRate,!1,0,0);this._positionXPropertySineWave=new b.components.PropertySineWave(this.getEntity(),this.getEntity().getPositionRef(),"x",this.getEntity().getLocalPosition().x,this._floatTranslation,this._floatTranslationRate+0.2*this._floatTranslationRate,!1,0,0);this._positionYPropertySineWave=new b.components.PropertySineWave(this.getEntity(),this.getEntity().getPositionRef(),"y",this.getEntity().getLocalPosition().y,this._floatTranslation,this._floatTranslationRate-0.2*this._floatTranslationRate,!1,Math.PI,0);this._floatStrengthTween=new b.components.Tweener(this.getEntity())};c.effects.ButtonMouseOverFloat.__name__=!0;c.effects.ButtonMouseOverFloat.__super__=b.Component;c.effects.ButtonMouseOverFloat.prototype=m(b.Component.prototype,{getBaseScaleX:function(){return this._baseScaleX},setBaseScaleX:function(a){this._baseScaleX=a},getBaseScaleY:function(){return this._baseScaleY},setBaseScaleY:function(a){this._baseScaleY=a},onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._tweener.setIsActive(!1)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._tweener.setIsActive(!0)},init:function(){b.Component.prototype.init.call(this);this._tweener=new b.components.Tweener(this.getEntity());var a=this.getEntity().getComponent(b.ui.UiElement);null!=a&&(this._baseScaleX=a.getScaleRef().x,this._baseScaleY=a.getScaleRef().y)},disableButton:function(){this.onMouseOut(null);this.getEntity().removeEventListener("mouseOver",l(this,this.onMouseOver))},enableButton:function(){this.getEntity().addEventListener("mouseOver",l(this,this.onMouseOver))},update:function(){b.Component.prototype.update.call(this);this._rotationPropertySineWave.setStrength(this._floatStrength);this._positionXPropertySineWave.setStrength(this._floatStrength);this._positionYPropertySineWave.setStrength(this._floatStrength)},onMouseOver:function(a){if(!b.GameManager.isMobile()&&(a=this.getEntity().getComponent(b.ui.UiElement),!b.components.buttons.ButtonActionDelay.getDelayButtonLock())){this._tweener.destroyAllTweens();if(null!=a){var c=a.getScaleRef().x,d=a.getScaleRef().y;this._tweener.addTween(a.getScaleRef(),"x",c,this._baseScaleX+this._scaleUp,this._scaleDuration,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(a.getScaleRef(),"y",d,this._baseScaleY+this._scaleUp,this._scaleDuration,b.components.tween.EasingFunctions.easeOutQuint)}else a=this.getEntity().getScaleRef().x,c=this.getEntity().getScaleRef().y,this._tweener.addTween(this.getEntity().getScaleRef(),"x",a,this._baseScaleX+this._scaleUp,this._scaleDuration,b.components.tween.EasingFunctions.easeOutQuint),this._tweener.addTween(this.getEntity().getScaleRef(),"y",c,this._baseScaleY+this._scaleUp,this._scaleDuration,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(this,"_floatStrength",this._floatStrength,1,this._scaleDuration,b.components.tween.EasingFunctions.easeOutQuint)}},onMouseOut:function(a){if(!b.GameManager.isMobile()&&null!=this._tweener){a=this.getEntity().getComponent(b.ui.UiElement);this._tweener.destroyAllTweens();if(null!=a){var c=a.getScaleRef().x,d=a.getScaleRef().y;this._tweener.addTween(a.getScaleRef(),"x",c,this._baseScaleX,this._scaleDuration,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(a.getScaleRef(),"y",d,this._baseScaleY,this._scaleDuration,b.components.tween.EasingFunctions.easeInQuad)}else a=this.getEntity().getScaleRef().x,c=this.getEntity().getScaleRef().y,this._tweener.addTween(this.getEntity().getScaleRef(),"x",a,this._baseScaleX,this._scaleDuration,b.components.tween.EasingFunctions.easeInQuad),this._tweener.addTween(this.getEntity().getScaleRef(),"y",c,this._baseScaleY,this._scaleDuration,b.components.tween.EasingFunctions.easeInQuad);this._tweener.addTween(this,"_floatStrength",this._floatStrength,0,this._scaleDuration,b.components.tween.EasingFunctions.easeOutQuint)}},__class__:c.effects.ButtonMouseOverFloat});c.effects.ScrollingBackground=function(a,c,d){this._scrollSpeed=0;this._distanceToScroll=1024;b.Component.call(this,a,"ScrollingBackground");this._root=this.getGameState().addEntity();this.getEntity().addChild(this._root);this._backgroundA=this.getGameState().addEntity();(new b.components.GameImage(this._backgroundA,c,d)).centerOffsetOnEntity();this._backgroundB=this.getGameState().addEntity();a=new b.components.GameImage(this._backgroundB,c,d);this._backgroundB.setPosition(a.getSize().x,0);a.centerOffsetOnEntity();this._backgroundC=this.getGameState().addEntity();c=new b.components.GameImage(this._backgroundC,c,d);this._backgroundC.setPosition(2*c.getSize().x,0);c.centerOffsetOnEntity();this._root.addChild(this._backgroundA);this._root.addChild(this._backgroundB);this._root.addChild(this._backgroundC)};c.effects.ScrollingBackground.__name__=!0;c.effects.ScrollingBackground.__super__=b.Component;c.effects.ScrollingBackground.prototype=m(b.Component.prototype,{update:function(){b.Component.prototype.update.call(this);this._root.translate(this._scrollSpeed*b.GameManager.getElapsedTime(),0);this._root.getPosition().x<-this._distanceToScroll&&this._root.translate(this._distanceToScroll)},__class__:c.effects.ScrollingBackground});c.glam={};c.glam.GlamFactory=function(){};c.glam.GlamFactory.__name__=!0;c.glam.GlamFactory.createByName=function(a,b,d,f){switch(a){case "actionBurst":return c.glam.GlamFactory.createActionBurst(b,d,f);case "actionBurstAlt":return c.glam.GlamFactory.createActionBurstAlt(b,d,f);case "actionBurstBlue":return c.glam.GlamFactory.createActionBurstBlue(b,d,f);case "actionBurstGreen":return c.glam.GlamFactory.createActionBurstGreen(b,d,f);case "actionBurstOrange":return c.glam.GlamFactory.createActionBurstOrange(b,d,f);case "glamParticles02":return c.glam.GlamFactory.createGlamParticles02(b,d,f);case "glamParticles03":return c.glam.GlamFactory.createGlamParticles03(b,d,f);case "glamSpiral01":return c.glam.GlamFactory.createGlamParticlesSpiral01(b,d,f);case "glamSpiral02":return c.glam.GlamFactory.createGlamParticlesSpiral02(b,d,f);case "glamBarbieEmblem":return c.glam.GlamFactory.createGlamBarbieEmblem(b,d,f);case "glamBarbieLetters":return c.glam.GlamFactory.createGlamBarbieLetters(b,d,f)}return null};c.glam.GlamFactory.createActionBurst=function(a,e,d){var f=a.addEntity();a=a.addEntity();f.addChild(a);(new c.StreamingGameImage(a,"action_burst",e,d,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).centerOffsetOnEntity();(new b.components.SimpleMovement(a)).setAngularVelocity(new b.Vector3D(0,0,b.utilities.Math2.degToRad(180)));return f};c.glam.GlamFactory.createActionBurstAlt=function(a,e,d){var f=a.addEntity();a=a.addEntity();f.addChild(a);(new c.StreamingGameImage(a,"action_burstAlt",e,d,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).centerOffsetOnEntity();(new b.components.SimpleMovement(a)).setAngularVelocity(new b.Vector3D(0,0,b.utilities.Math2.degToRad(180)));return f};c.glam.GlamFactory.createActionBurstBlue=function(a,e,d){var f=a.addEntity();a=a.addEntity();f.addChild(a);(new c.StreamingGameImage(a,"action_burstBlue",e,d,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).centerOffsetOnEntity();(new b.components.SimpleMovement(a)).setAngularVelocity(new b.Vector3D(0,0,b.utilities.Math2.degToRad(180)));return f};c.glam.GlamFactory.createActionBurstGreen=function(a,e,d){var f=a.addEntity();a=a.addEntity();f.addChild(a);(new c.StreamingGameImage(a,"action_burstGreen",e,d,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).centerOffsetOnEntity();(new b.components.SimpleMovement(a)).setAngularVelocity(new b.Vector3D(0,0,b.utilities.Math2.degToRad(180)));return f};c.glam.GlamFactory.createActionBurstOrange=function(a,e,d){var f=a.addEntity();a=a.addEntity();f.addChild(a);(new c.StreamingGameImage(a,"action_burstOrange",e,d,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch())).centerOffsetOnEntity();(new b.components.SimpleMovement(a)).setAngularVelocity(new b.Vector3D(0,0,b.utilities.Math2.degToRad(180)));return f};c.glam.GlamFactory.createGlamParticles01=function(a,b,d){a=a.addEntity();new c.glam.RisingParticleSpawner(a,["glamSparkle01","glamSparkle01","glamSparkle04Squish"],b,d);return a};c.glam.GlamFactory.createGlamParticles02=function(a,b,d){a=a.addEntity();new c.glam.RisingParticleSpawner(a,["glamSparkle02","glamSparkle02","glamSparkle04Squish"],b,d);return a};c.glam.GlamFactory.createGlamParticles03=function(a,b,d){a=a.addEntity();new c.glam.RisingParticleSpawner(a,["glamSparkle03","glamSparkle03","glamSparkle04Squish"],b,d);return a};c.glam.GlamFactory.createGlamParticlesSpiral01=function(a,b,d){a=a.addEntity();new c.glam.SpiralSpawner(a,["glamSparkle01","glamSparkle02","glamSparkle03"],b,d);return a};c.glam.GlamFactory.createGlamParticlesSpiral02=function(a,b,d){a=a.addEntity();new c.glam.SpiralSpawner(a,["glamCircle01","glamCircle02","glamCircle03"],b,d);return a};c.glam.GlamFactory.createGlamBarbieEmblem=function(a,c,d){a=a.addEntity();new b.components.GameSprite(a,"glam_barbie_emblem",c,d);return a};c.glam.GlamFactory.createGlamBarbieLetters=function(a,c,d){a=a.addEntity();new b.components.GameSprite(a,"glam_barbie_letters",c,d);return a};c.glam.GlamFactory.prototype={__class__:c.glam.GlamFactory};c.glam.RisingParticleSpawner=function(a,b,d,f){this._timeUntilNextParticle=0;this.MAX_ROTATION_SPEED=720;this.MIN_ROTATION_SPEED=360;this.SPAWN_Y_SCATTER=100;this.SPAWN_X_SCATTER=125;this.MAX_PARTICLE_SCALE=1;this.MIN_PARTICLE_SCALE=0.5;this.MAX_PARTICLE_SPEED=200;this.MIN_PARTICLE_SPEED=50;this.MAX_PARTICLE_LIFETIME=1;this.MIN_PARTICLE_LIFETIME=0.5;this.TIME_PER_PARTICLE=0.2;c.comicCreator.Spawner.call(this,a,d,f);this._images=b;this._timeUntilNextParticle=this.TIME_PER_PARTICLE};c.glam.RisingParticleSpawner.__name__=!0;c.glam.RisingParticleSpawner.__super__=c.comicCreator.Spawner;c.glam.RisingParticleSpawner.prototype=m(c.comicCreator.Spawner.prototype,{init:function(){c.comicCreator.Spawner.prototype.init.call(this);this._root=this.getGameState().addEntity();this.getEntity().addChild(this._root)},update:function(){c.comicCreator.Spawner.prototype.update.call(this);0<this._root.getChildren().length&&(this._layer=this._root.getChildren()[0].getComponent(c.StreamingGameImage).getLayer());this._timeUntilNextParticle-=b.GameManager.getElapsedTime();if(0>=this._timeUntilNextParticle)this.onNextParticleTimeElapse()},onNextParticleTimeElapse:function(){var a=this.getGameState().addEntity();this._root.addChild(a);var e=b.utilities.Math2.randomFloat(-this.SPAWN_X_SCATTER/2,this.SPAWN_X_SCATTER/2),d=b.utilities.Math2.randomFloat(-this.SPAWN_Y_SCATTER/2,this.SPAWN_Y_SCATTER/2),f=b.utilities.Math2.randomFloat(this.MIN_PARTICLE_SCALE,this.MAX_PARTICLE_SCALE),g=this._images[b.utilities.Math2.randomInt(0,this._images.length)],h=b.utilities.Math2.degToRad(b.utilities.Math2.randomFloat(this.MIN_ROTATION_SPEED,this.MAX_ROTATION_SPEED)),k=b.utilities.Math2.randomFloat(this.MIN_PARTICLE_LIFETIME,this.MAX_PARTICLE_LIFETIME);0.5<b.utilities.Math2.randomFloat(0,1)||(h=-h);g=new c.StreamingGameImage(a,g,this._layer,this._camera,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch());g.centerOffsetOnEntity();g.setAlpha(0);a.setPosition(e,d);a.setScale(0,0,0);e=new b.components.SimpleMovement(a);e.setVelocityY(-b.utilities.Math2.randomFloat(this.MIN_PARTICLE_SPEED,this.MAX_PARTICLE_SPEED));e.setAngularVelocity(new b.Vector3D(0,0,h));h=new b.components.Tweener(a);h.addTween(g,"_alpha",0,1,0.3*k,b.components.tween.EasingFunctions.linear,0);h.addTween(g,"_alpha",1,0,0.3*k,b.components.tween.EasingFunctions.linear,0.7*k,function(){a.destroy()});h.addTween(a.getScaleRef(),"x",0,f,0.35,b.components.tween.EasingFunctions.easeOutBack);h.addTween(a.getScaleRef(),"y",0,f,0.35,b.components.tween.EasingFunctions.easeOutBack);this._timeUntilNextParticle=this.TIME_PER_PARTICLE},__class__:c.glam.RisingParticleSpawner});c.glam.SpiralFromCenter=function(a,c,d,f){this._currentAngle=this._currentScale=this._currentRadius=0;this._radiusIncreaseSpeed=50;this._turnSpeed=360;b.Component.call(this,a,"SpiralFromCenter");this._turnSpeed=c;this._radiusIncreaseSpeed=d;this._scaleSpeed=f};c.glam.SpiralFromCenter.__name__=!0;c.glam.SpiralFromCenter.__super__=b.Component;c.glam.SpiralFromCenter.prototype=m(b.Component.prototype,{update:function(){b.Component.prototype.update.call(this);this._currentAngle-=this._turnSpeed*b.GameManager.getElapsedTime();this._currentRadius+=this._radiusIncreaseSpeed*b.GameManager.getElapsedTime();var a=Math.sin(b.utilities.Math2.degToRad(this._currentAngle))*this._currentRadius,c=Math.cos(b.utilities.Math2.degToRad(this._currentAngle))*this._currentRadius;this._currentScale+=this._scaleSpeed*b.GameManager.getElapsedTime();this.getEntity().setRotation(0,0,0.5*-b.utilities.Math2.degToRad(this._currentAngle));this.getEntity().setPosition(a,c);this.getEntity().setScale(this._currentScale,this._currentScale)},__class__:c.glam.SpiralFromCenter});c.glam.SpiralSpawner=function(a,b,d,f){this.SPAWN_X_SCATTER=this.SPAWN_Y_SCATTER=this._timeUntilNextParticle=this._currentImage=0;this.MIN_PARTICLE_LIFETIME=this.MAX_PARTICLE_LIFETIME=2.25;this.TIME_PER_PARTICLE=0.25;c.comicCreator.Spawner.call(this,a,d,f);this._images=b;this._timeUntilNextParticle=this.TIME_PER_PARTICLE};c.glam.SpiralSpawner.__name__=!0;c.glam.SpiralSpawner.__super__=c.comicCreator.Spawner;c.glam.SpiralSpawner.prototype=m(c.comicCreator.Spawner.prototype,{init:function(){c.comicCreator.Spawner.prototype.init.call(this);this._root=this.getGameState().addEntity();this.getEntity().addChild(this._root)},update:function(){c.comicCreator.Spawner.prototype.update.call(this);this._timeUntilNextParticle-=b.GameManager.getElapsedTime();if(0>=this._timeUntilNextParticle)this.onNextParticleTimeElapse()},onNextParticleTimeElapse:function(){var a=this.getGameState().addEntity();this._root.addChild(a);var e=b.utilities.Math2.randomFloat(-this.SPAWN_X_SCATTER/2,this.SPAWN_X_SCATTER/2),d=b.utilities.Math2.randomFloat(-this.SPAWN_Y_SCATTER/2,this.SPAWN_Y_SCATTER/2),f=this._images[this._currentImage],g=b.utilities.Math2.randomFloat(this.MIN_PARTICLE_LIFETIME,this.MAX_PARTICLE_LIFETIME);this._currentImage++;this._currentImage>=this._images.length&&(this._currentImage=0);f=new c.StreamingGameImage(a,f,this._layer,this._camera,c.comicCreator.comicAssets.ComicAssetManager.getInstance().getStreamingLoadBatch());f.centerOffsetOnEntity();f.setAlpha(0);a.setPosition(e,d);a.setScale(0,0,0);new c.glam.SpiralFromCenter(a,360,45,1);e=new b.components.Tweener(a);e.addTween(f,"_alpha",0,1,0.3*g,b.components.tween.EasingFunctions.linear,0);e.addTween(f,"_alpha",1,0,0.3*g,b.components.tween.EasingFunctions.linear,0.7*g,function(){a.destroy()});this._timeUntilNextParticle=this.TIME_PER_PARTICLE},__class__:c.glam.SpiralSpawner});c.levels={};c.levels.Level=function(a){this._templates=[];this._index=a};c.levels.Level.__name__=!0;c.levels.Level.prototype={getIndex:function(){return this._index},addTemplate:function(a){this._templates.push(a)},getTemplates:function(){return this._templates},getName:function(){return b.Localizer.getString("LEVEL_"+(this._index+1)+"_NAME")},__class__:c.levels.Level};c.levels.LevelManager=function(){this._currentLevelIndex=0;b.Manager.call(this);this._levels=[]};c.levels.LevelManager.__name__=!0;c.levels.LevelManager.getInstance=function(){null==c.levels.LevelManager._instance&&(c.levels.LevelManager._instance=new c.levels.LevelManager,b.GameManager.instance.addManager(c.levels.LevelManager._instance));return c.levels.LevelManager._instance};c.levels.LevelManager.__super__=b.Manager;c.levels.LevelManager.prototype=m(b.Manager.prototype,{getSandboxMode:function(){return 5<=this._currentLevelIndex},registerComicTemplate:function(a){if(!(0>a.getLevel())){var b=this.getLevelByIndex(a.getLevel()-1);null==b&&(b=new c.levels.Level(a.getLevel()-1),this._levels[a.getLevel()-1]=b);b.addTemplate(a)}},getLevelByIndex:function(a){return this._levels[a]},getLevels:function(){return this._levels},getLevelNameByIndex:function(a){return b.Localizer.getString("LEVEL_"+(a+1)+"_NAME")},getNumLevelsUnlocked:function(){return c.GameTracker.getInstance().getSaveData().getItem("numLevelsUnlocked",1)},setNumlevelsUnlocked:function(a){a<=this.getNumLevelsUnlocked()||c.GameTracker.getInstance().getSaveData().setItem("numLevelsUnlocked",a)},getCurrentLevelIndex:function(){return this._currentLevelIndex},setCurrentLevelIndex:function(a){this._currentLevelIndex=a},getCurrentLevel:function(){return this._levels[this._currentLevelIndex]},__class__:c.levels.LevelManager});c.subtitles={};c.subtitles.SubtitleDisplay=function(a,c){this._textField=this._textFieldDropShadow=this._layer=this._deferredAction=null;b.Component.call(this,a,"SubtitleDisplay");this._layer=c};c.subtitles.SubtitleDisplay.__name__=!0;c.subtitles.SubtitleDisplay.__super__=b.Component;c.subtitles.SubtitleDisplay.prototype=m(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._headerImage=this.getGameState().addEntity();this._headerImage.setScale(1.2666666666666666,1.2666666666666666);this._headerImage.setPosition(0,-10);this._footerImage=this.getGameState().addEntity();this._footerImage.setScale(1.2666666666666666,1.2666666666666666);this._footerImage.setPosition(0,548);var a=this.getGameState().addEntity();a.setIsVisible(!1);a.setPosition(378,453);this._textFieldDropShadow=new b.components.TextField(a,this._layer);this._textFieldDropShadow.setFontFamily("Arial Black, Arial");this._textFieldDropShadow.setFillStyle("#000000");this._textFieldDropShadow.setMaxWidth(650);a=this.getGameState().addEntity();a.setIsVisible(!1);a.setPosition(375,450);this._textField=new b.components.TextField(a,this._layer);this._textField.setFontFamily("Arial Black, Arial");this._textField.setMaxWidth(650);this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());b.speechManager.SpeechManager.getInstance().addEventListener("showSubtitle",l(this,this.onSubtitleShow))},increasedTextFieldSize:function(){this._textField.setMaxWidth(950);this._textFieldDropShadow.setMaxWidth(950)},resetTextFieldSize:function(){this._textField.setMaxWidth(650);this._textFieldDropShadow.setMaxWidth(650)},onSubtitleShow:function(a){this._deferredAction.destroyAllDeferredActions();var b=a.getSubtitleText();this._textField.setText(b);this._textField.getEntity().setIsVisible(!0);this._textFieldDropShadow.setText(b);this._textFieldDropShadow.getEntity().setIsVisible(!0);this._deferredAction.addDeferredAction(a.getDuration(),l(this,this.onSubtitleExpire))},onSubtitleExpire:function(){this._textField.getEntity().setIsVisible(!1);this._textFieldDropShadow.getEntity().setIsVisible(!1)},__class__:c.subtitles.SubtitleDisplay});c.subtitles.SubtitleState=function(){this._subtitleDisplay=null;b.GameState.call(this);c.subtitles.SubtitleState._instance=this};c.subtitles.SubtitleState.__name__=!0;c.subtitles.SubtitleState.getInstance=function(){return c.subtitles.SubtitleState._instance};c.subtitles.SubtitleState.__super__=b.GameState;c.subtitles.SubtitleState.prototype=m(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=this.addEntity();this._subtitleDisplay=new c.subtitles.SubtitleDisplay(a,b.GameManager.instance.getLayerByName("subtitles"))},getSubtitleDisplay:function(){return this._subtitleDisplay},__class__:c.subtitles.SubtitleState});c.utag={};c.utag.UtagManager=function(){this._gameTitle="YCBA Photo Booth";b.Manager.call(this);c.utag.UtagManager._instance=this;this._utag=window.utag};c.utag.UtagManager.__name__=!0;c.utag.UtagManager.getInstance=function(){return c.utag.UtagManager._instance};c.utag.UtagManager.__super__=b.Manager;c.utag.UtagManager.prototype=m(b.Manager.prototype,{link:function(a,b){var c={};c.event_id=x.replace(a,"[Game Title]",this._gameTitle);c.event_category_id=b;null!=this._utag&&this._utag.link(c)},link2:function(a,b,c,f,g){null==g&&(g="");var h={};a=x.replace(a,"[Game Title]",this._gameTitle);b=x.replace(b,"[Game Title]",this._gameTitle);c=x.replace(c,"[Game Title]",this._gameTitle);f=x.replace(f,"[Game Title]",this._gameTitle);h.eve_cat=a;h.eve_act=b;h.eve_lab=c;h.eve_des=f;h.eve_pos=g;console.log(JSON.stringify(h));null!=this._utag&&this._utag.link(h)},view:function(a){var b={};a=x.replace(a,"[Game Title]",this._gameTitle);a=x.replace(a,"[locale]",k.dataLocale);b.page_id=a;null!=this._utag&&null!=this._utag.view&&this._utag.view(b)},__class__:c.utag.UtagManager});c.webcam={};c.webcam.WebcamDisplay=function(a,c,d){this._height=480;this._width=640;b.Component.call(this,a,"WebcamDisplay");this._layer=c};c.webcam.WebcamDisplay.__name__=!0;c.webcam.WebcamDisplay.__super__=b.Component;c.webcam.WebcamDisplay.prototype=m(b.Component.prototype,{getSize:function(){return new b.Vector2D(this._width,this._height)},setSize:function(a,b){this._width=a;this._height=b},init:function(){var a=this;b.Component.prototype.init.call(this);b.GameManager.isMobile()||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,null==c.webcam.WebcamDisplay._video?null!=navigator.getUserMedia?navigator.getUserMedia({audio:!1,video:!0},function(b){if(a.getIsMarkedForDeletion())b.getVideoTracks()[0].stop();else{if(null==c.webcam.WebcamDisplay._video){var d=k.getDocument();c.webcam.WebcamDisplay._video=d.createElement("video");c.webcam.WebcamDisplay._video.autoplay=!0;c.webcam.WebcamDisplay._video.src=URL.createObjectURL(b)}c.webcam.WebcamDisplay._mediaStream=b;a.dispatchEvent(new c.webcam.WebcamDisplayEvent("display"))}},function(b){return function(){a.dispatchEvent(new c.webcam.WebcamDisplayEvent("fail"))}}(this)):this.dispatchEvent(new c.webcam.WebcamDisplayEvent("fail")):(this.dispatchEvent(new c.webcam.WebcamDisplayEvent("display")),c.webcam.WebcamDisplay._mediaStream.getVideoTracks()[0].enabled=!0,c.webcam.WebcamDisplay._video.play()))},render:function(){b.Component.prototype.render.call(this);if(this.getEntity().getIsVisible()&&null!=c.webcam.WebcamDisplay._video){0==this._width&&(this._width=c.webcam.WebcamDisplay._video.videoWidth);0==this._height&&(this._height=c.webcam.WebcamDisplay._video.videoHeight);this._offsetX=-this._width/2;this._offsetY=-this._height/2;null==this._context&&(this._context=this._layer.getCanvas().getContext("2d"));var a=this.getEntity(),e=this.getEntity().getPosition(),d=this.getEntity().getScale();this._context.save();this._context.setTransform(1,0/d.x,0/d.y,1,Math.floor(e.x)*b.GameManager.getDevicePixelRatio(),Math.floor(e.y)*b.GameManager.getDevicePixelRatio());this._context.rotate(a.getRotation().z);this._context.translate(Math.floor(this._offsetX)*b.GameManager.getDevicePixelRatio(),Math.floor(this._offsetY)*b.GameManager.getDevicePixelRatio());this._context.globalAlpha=1;this._context.scale(d.x,d.y);if(b.GameManager.isFirefox())try{this._context.drawImage(c.webcam.WebcamDisplay._video,0,0,this._width,this._height)}catch(f){}else this._context.drawImage(c.webcam.WebcamDisplay._video,0,0,this._width,this._height);this._layer.setWholeCanvasDirty(!0);this._context.restore()}},toImage:function(){var a;a=k.getDocument().createElement("canvas");a.width=this._width;a.height=this._height;a.getContext("2d").drawImage(c.webcam.WebcamDisplay._video,0,0,c.webcam.WebcamDisplay._video.videoWidth,c.webcam.WebcamDisplay._video.videoHeight,0,0,this._width,this._height);var b;b=k.getDocument().createElement("img");b.src=a.toDataURL();b.width=this._width;b.height=this._height;return b},destroy:function(){b.Component.prototype.destroy.call(this);null!=c.webcam.WebcamDisplay._video&&c.webcam.WebcamDisplay._video.pause();null!=c.webcam.WebcamDisplay._mediaStream&&(c.webcam.WebcamDisplay._mediaStream.getVideoTracks()[0].enabled=!1)},__class__:c.webcam.WebcamDisplay});c.webcam.WebcamDisplayEvent=function(a){b.events.Event.call(this,a)};c.webcam.WebcamDisplayEvent.__name__=!0;c.webcam.WebcamDisplayEvent.__super__=b.events.Event;c.webcam.WebcamDisplayEvent.prototype=m(b.events.Event.prototype,{__class__:c.webcam.WebcamDisplayEvent});var u={Timer:function(){}};u.Timer.__name__=!0;u.Timer.stamp=function(){return(new Date).getTime()/1E3};u.ds={};u.ds.StringMap=function(){this.h={}};u.ds.StringMap.__name__=!0;u.ds.StringMap.__interfaces__=[B];u.ds.StringMap.prototype={set:function(a,b){this.h["$"+a]=b},get:function(a){return this.h["$"+a]},exists:function(a){return this.h.hasOwnProperty("$"+
a)},remove:function(a){a="$"+a;if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},__class__:u.ds.StringMap};u.io={};u.io.Eof=function(){};u.io.Eof.__name__=!0;u.io.Eof.prototype={toString:function(){return"Eof"},__class__:u.io.Eof};u.xml={};u.xml.Parser=function(){};u.xml.Parser.__name__=!0;u.xml.Parser.parse=function(a){var b=s.createDocument();u.xml.Parser.doParse(a,0,b);return b};u.xml.Parser.doParse=function(a,b,c){null==b&&(b=0);for(var f=null,g=1,h=1,k=null,l=0,m=0,w=0,r=a.charCodeAt(b),v=new A;r==r;){switch(g){case 0:switch(r){case 10:case 13:case 9:case 32:break;default:g=h;continue}break;case 1:switch(r){case 60:g=0;h=2;break;default:l=b;g=13;continue}break;case 13:60==r?(h=s.createPCData(v.b+t.substr(a,l,b-l)),v=new A,c.addChild(h),m++,g=0,h=2):38==r&&(v.addSub(a,l,b-l),g=18,h=13,l=b+1);break;case 17:93==r&&(93==a.charCodeAt(b+1)&&62==a.charCodeAt(b+2))&&(g=s.createCData(t.substr(a,l,b-l)),c.addChild(g),m++,b+=2,g=1);break;case 2:switch(r){case 33:if(91==a.charCodeAt(b+1)){b+=2;if("CDATA["!=t.substr(a,b,6).toUpperCase())throw"Expected <![CDATA[";b+=5;g=17}else if(68==a.charCodeAt(b+1)||100==a.charCodeAt(b+1)){if("OCTYPE"!=t.substr(a,b+2,6).toUpperCase())throw"Expected <!DOCTYPE";b+=8;g=16}else{if(45!=a.charCodeAt(b+1)||45!=a.charCodeAt(b+2))throw"Expected \x3c!--";b+=2;g=15}l=b+1;break;case 63:g=14;l=b;break;case 47:if(null==c)throw"Expected node name";l=b+1;g=0;h=10;break;default:g=3;l=b;continue}break;case 3:if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)){if(b==l)throw"Expected node name";f=s.createElement(t.substr(a,l,b-l));c.addChild(f);g=0;h=4;continue}break;case 4:switch(r){case 47:g=11;m++;break;case 62:g=9;m++;break;default:g=5;l=b;continue}break;case 5:if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)){if(l==b)throw"Expected attribute name";k=t.substr(a,l,b-l);if(f.exists(k))throw"Duplicate attribute";g=0;h=6;continue}break;case 6:switch(r){case 61:g=0;h=7;break;default:throw"Expected =";}break;case 7:switch(r){case 34:case 39:g=8;l=b;break;default:throw'Expected "';}break;case 8:r==a.charCodeAt(l)&&(h=t.substr(a,l+1,b-l-1),f.set(k,h),g=0,h=4);break;case 9:l=b=u.xml.Parser.doParse(a,b,f);g=1;break;case 11:switch(r){case 62:g=1;break;default:throw"Expected >";}break;case 12:switch(r){case 62:return 0==m&&c.addChild(s.createPCData("")),b;default:throw"Expected >";}case 10:if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)){if(l==b)throw"Expected node name";if(t.substr(a,l,b-l)!=c.get_nodeName())throw"Expected </"+
c.get_nodeName()+">";g=0;h=12;continue}break;case 15:45==r&&(45==a.charCodeAt(b+1)&&62==a.charCodeAt(b+2))&&(c.addChild(s.createComment(t.substr(a,l,b-l))),b+=2,g=1);break;case 16:91==r?w++:93==r?w--:62==r&&0==w&&(c.addChild(s.createDocType(t.substr(a,l,b-l))),g=1);break;case 14:63==r&&62==a.charCodeAt(b+1)&&(b++,g=t.substr(a,l+1,b-l-2),c.addChild(s.createProcessingInstruction(g)),g=1);break;case 18:59==r&&(l=t.substr(a,l,b-l),35==l.charCodeAt(0)?(l=120==l.charCodeAt(1)?q.parseInt("0"+t.substr(l,1,l.length-1)):q.parseInt(t.substr(l,1,l.length-1)),v.add(String.fromCharCode(l))):u.xml.Parser.escapes.exists(l)?v.add(u.xml.Parser.escapes.get(l)):v.b+=q.string("&"+l+";"),l=b+1,g=h)}r=x.fastCodeAt(a,++b)}1==g&&(l=b,g=13);if(13==g)return b==l&&0!=m||c.addChild(s.createPCData(v.b+t.substr(a,l,b-l))),b;throw"Unexpected end";};var w={Boot:function(){}};w.Boot.__name__=!0;w.Boot.getClass=function(a){return a instanceof Array&&null==a.__enum__?Array:a.__class__};w.Boot.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];c=a[0]+"(";b+="\t";for(var f=2,g=a.length;f<g;)var h=f++,c=2!=h?c+(","+w.Boot.__string_rec(a[h],b)):c+w.Boot.__string_rec(a[h],b);return c+")"}c=a.length;f="[";b+="\t";for(g=0;g<c;)h=g++,f+=(0<h?",":"")+w.Boot.__string_rec(a[h],b);return f+"]"}try{f=a.toString}catch(k){return"???"}if(null!=f&&f!=Object.toString&&(c=a.toString(),"[object Object]"!=c))return c;c=null;f="{\n";b+="\t";g=null!=a.hasOwnProperty;for(c in a)g&&!a.hasOwnProperty(c)||("prototype"==c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c)||(2!=f.length&&(f+=", \n"),f+=b+c+" : "+w.Boot.__string_rec(a[c],b));b=b.substring(1);return f+("\n"+b+"}");case "function":return"<function>";case "string":return a;default:return String(a)}};w.Boot.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var f=0,g=c.length;f<g;){var h=f++,h=c[h];if(h==b||w.Boot.__interfLoop(h,b))return!0}return w.Boot.__interfLoop(a.__super__,b)};w.Boot.__instanceof=function(a,b){if(null==b)return!1;switch(b){case H:return(a|0)===a;case D:return"number"==typeof a;case E:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.__enum__;case I:return!0;default:if(null!=a){if("function"==typeof b&&(a instanceof b||w.Boot.__interfLoop(w.Boot.getClass(a),b)))return!0}else return!1;return b==J&&null!=a.__name__||b==K&&null!=a.__ename__?!0:a.__enum__==b}};w.Browser=function(){};w.Browser.__name__=!0;w.Browser.getLocalStorage=function(){try{var a=window.localStorage;a.getItem("");return a}catch(b){return null}};w.Browser.getSessionStorage=function(){try{var a=window.sessionStorage;a.getItem("");return a}catch(b){return null}};var F=0;Array.prototype.indexOf&&(t.indexOf=function(a,b,c){return Array.prototype.indexOf.call(a,b,c)});Math.NaN=Number.NaN;Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;Math.isFinite=function(a){return isFinite(a)};Math.isNaN=function(a){return isNaN(a)};String.prototype.__class__=String;String.__name__=!0;Array.__name__=!0;Date.prototype.__class__=Date;Date.__name__=["Date"];var H={__name__:["Int"]},I={__name__:["Dynamic"]},D=Number;D.__name__=["Float"];var E=Boolean;E.__ename__=["Bool"];var J={__name__:["Class"]},K={};s.Element="element";s.PCData="pcdata";s.CData="cdata";s.Comment="comment";s.DocType="doctype";s.ProcessingInstruction="processingInstruction";s.Document="document";w.JQuery=window.jQuery;k.TARGET_FPS=60;k.TARGET_FPS_MOBILE=60;k.CANVAS_WIDTH_LANDSCAPE=1024;k.CANVAS_HEIGHT_LANDSCAPE=576;k.CANVAS_WIDTH_PORTRAIT=640;k.CANVAS_HEIGHT_PORTRAIT=960;k.BACKGROUND_COLOR="#000000";b.GameObject._currentInstanceId=0;b.GameConfig._properties=new u.ds.StringMap;b.GameManager.ORIENTATION_HORIZONTAL=0;b.GameManager.ORIENTATION_VERTICAL=1;b.GameManager.MAX_TIMESTEP=2;b.GameManager.PHYSICS_SCALE=30;b.GameManager._timeScale=1;b.GameManager._devicePixelRatio=-1;b.GameManager._prevElapsedTime=0;b.GameManager._elapsedTime=0;b.Layer._currentZIndex=0;b.LoadBatch.MIN_LOAD_TIME=3;b.components.Draggable._releaseDraggablesNextFrame=!1;b.components.DraggableEvent.START_DRAGGING="startDragging";b.components.DraggableEvent.STOP_DRAGGING="stopDragging";b.components.SlackMovement.EPSILON=5E-5;b.components.TextField.DEFAULT_FILL_STYLE="white";b.components.buttons.ButtonActionDelay._delayButtonLock=!1;b.events.EntityEvent.VISIBILITY_OFF="visibilityOff";b.events.EntityEvent.VISIBILITY_ON="visibilityOn";b.events.EntityEvent.DISPLAY_UPDATE="displayUpdate";b.events.EntityEvent.ADDED_TO_PARENT="addedToParent";b.events.EntityEvent.REMOVED_FROM_PARENT="removedFromParent";b.events.EntityEvent.MOUSE_DOWN="mouseDown";b.events.EntityEvent.MOUSE_UP="mouseUp";b.events.EntityEvent.MOUSE_MOVE="mouseMove";b.events.EntityEvent.MOUSE_OUT="mouseOut";b.events.EntityEvent.MOUSE_OVER="mouseOver";b.events.EntityEvent.MOUSE_CLICK="mouseClick";b.events.GameObjectEvent.DESTROY="destroy";b.events.GameObjectEvent.ACTIVATE="activate";b.events.GameObjectEvent.DEACTIVATE="deactivate";b.events.GameObjectEvent.INITIALIZE="initialize";b.events.RaycastCheckEvent.RAYCAST_CHECK="raycastCheck";b.flashAnimation.FlashAnimation._cachedFrames=new u.ds.StringMap;b.managers.AssetManager.assetList=new u.ds.StringMap;b.managers.DebugManagerEvent.BEAT_LEVEL="beatLevel";b.managers.DebugManagerEvent.FAIL_LEVEL="failLevel";b.managers.DebugManagerEvent.TURBO_START="turboStart";b.managers.DebugManagerEvent.TURBO_END="turboEnd";b.managers.DebugManagerEvent.COMIC_SNAPSHOT="comicSnapshot";b.managers.FontManager._elementHookMap=new u.ds.StringMap;b.managers.PhysicsEvent.RAYCAST_CHECK="raycastCheck";b.managers.SoundManager._masterVolume=1;b.managers.SoundManager._musicVolume=0.55;b.managers.SoundManager._soundVolume=1;b.managers.SoundManager._musicMuted=!1;b.managers.SoundManager._soundMuted=!1;b.managers.SoundManager._soundsPlaying=[];b.managers.SoundManager._isWebkitEnabled=!1;b.managers.SoundManager._useFlashSound=!1;b.managers.SoundManager._soundTimers=new u.ds.StringMap;b.screenTransition.TransitionScreenEvent.MIDPOINT="midpoint";b.screenTransition.TransitionScreenEvent.COMPLETE="complete";b.speechManager.SubtitleEvent.SHOW_SUBTITLE="showSubtitle";b.tmx.LevelEvents.INITIALIZED="initialized";b.ui.UiPanelEvent.UPDATE_DISPLAY="updateDisplay";b.utilities.Profiler._profiles=new u.ds.StringMap;b.utilities.WatchableValueEvent.CHANGE="change";c.BarbieTransition.TIME_SCALE=2;c.BarbieTransition.BARBIE_X=-1E3;c.BarbieTransition.BARBIE_Y=384;c.BarbieTransition.BARBIE_SPEED=3500;c.BarbieTransition.TRANSITION_TIME=0.325;c.BarbieTransition.FADE_TIME=7.3;c.BarbieTransition.FADE_DURATION=0;c.ChooseBarbieScene.NUM_PHOTOS=8;c.ChooseBarbieScene.NUM_PAGES=6;c.ChooseBarbieScene.ADJUSTED_PHOTO_ORDER=[42,43,44,45,38,39,40,41,24,25,26,27,28,29,30,31,32,33,34,35,36,37,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];c.ComicRecapScreen.COMIC_VIEWPORT_WIDTH=790;c.ComicRecapScreen.COMIC_VIEWPORT_HEIGHT=600;c.ComicRecapScreen.COMIC_OFFSET_X=0;c.ComicRecapScreen.COMIC_OFFSET_Y=0;c.ComicRecapScreen.MAX_SCALE=1;c.ComicRecapScreen.BLOG_SCALE=1;c.ComicRecapScreen.BLOG_CENTER_X=512;c.ComicRecapScreen.BLOG_TOP_Y=0;c.ComicStartSelectStateEvent.SELECT_STARTER="selectStarter";c.ComicStartSelectStateEvent.SELECT_BLANK="selectBlank";c.ComicStarterSelectScreen.BUTTON_ENTRY_DELAY=0.15;c.ComicStarterSelectScreen.BUTTON_ENTRY_DELAY_SPACING=0.05;c.ComicStarterSelectScreen.PANES_START_X=-0.4921875;c.ComicStarterSelectScreen.PANES_START_Y=-0.23046875;c.ComicStarterSelectScreen.PANES_SPACING_X=0.6;c.ComicStarterSelectScreen.PANES_SPACING_Y=0.65;c.ComicStarterSelectScreen.NUM_ROWS=2;c.FontFamilies.YANONEKAFFEESATZ_BOLD="agencyfbregular";c.FontFamilies.YANONEKAFFEESATZ_LIGHT="agencyfbbolditalic";c.GameTracker.NUM_LEVELS_UNLOCKED_KEY="numLevelsUnlocked";c.GameTracker.LEVEL_SCORE_SAVE_KEY="levelScore";c.GameTracker.HAS_BEATEN_GAME_KEY="hasBeatenGame";c.GameTracker.HAS_STARTED_GAME_KEY="hasStartedGame";c.OffscreenImageHide.EDGE_FADE_DISTANCE=50;c.PhotoSnapTransition.TIME_SCALE=2;c.PhotoSnapTransition.BARBIE_X=-1E3;c.PhotoSnapTransition.BARBIE_Y=384;c.PhotoSnapTransition.BARBIE_SPEED=3500;c.PhotoSnapTransition.TRANSITION_TIME=0.325;c.PhotoSnapTransition.FADE_TIME=7.3;c.PhotoSnapTransition.FADE_DURATION=0;c.PhotoSnapTransition.TRANSITION_OUT_DELAY=0.6;c.PhotoSnapTransition.PHOTO_BORDER_WIDTH=40;c.PhotoSnapTransition._currentTransitionType=0;c.ScrollBarUpdateEvent.UPDATE="update";c.StreamingGameImageEvent.LOAD_COMPLETE="loadComplete";c.TemplateSelectScreen.BUTTON_ENTRY_DELAY=0.15;c.TemplateSelectScreen.BUTTON_ENTRY_DELAY_SPACING=0.05;c.TemplateSelectScreen.PANES_START_X=-0.4921875;c.TemplateSelectScreen.PANES_START_Y=-0.23046875;c.TemplateSelectScreen.PANES_SPACING_X=0.6;c.TemplateSelectScreen.PANES_SPACING_Y=0.65;c.TemplateSelectScreen.NUM_ROWS=2;c.TitleScreen.SCROLLING_DOTS_SPEED=50;c.TitleScreen.SCROLLING_DOTS_RESET_X=64;c.comicCreator.ComicCaptureEvent.CAPTURE="capture";c.comicCreator.ComicCaptureState.PRINT_FRAME_ID="PrintingStateIFrame";c.comicCreator.ComicCreator.VIEWPORT_X=304;c.comicCreator.ComicCreator.VIEWPORT_Y=2;c.comicCreator.ComicCreator.VIEWPORT_WIDTH=706;c.comicCreator.ComicCreator.VIEWPORT_HEIGHT=560;c.comicCreator.ComicCreator.DRAG_BUTTON_WIDTH=1024;c.comicCreator.ComicCreator.DRAG_BUTTON_HEIGHT=768;c.comicCreator.ComicCreator.CAMERA_BOUNDS_BUFFER_X=100;c.comicCreator.ComicCreator.CAMERA_BOUNDS_BUFFER_Y=100;c.comicCreator.ComicCreator.WINDOW_X=690;c.comicCreator.ComicCreator.WINDOW_Y=373;c.comicCreator.ComicPanel.FILTER_STRENGTH=0.75;c.comicCreator.ComicPanel.FADE_DELAY=0.15;c.comicCreator.ComicPanel.FADE_DURATION=0.35;c.comicCreator.ComicPanel.BLACK_FADE_ALPHA=0.8;c.comicCreator.ComicPanelEvent.CLICK="click";c.comicCreator.ComicPanelEvent.SCENE_ENTITY_SELECTED="sceneEntitySelected";c.comicCreator.ComicPanelEvent.SCENE_ENTITY_DESELECTED="sceneEntityDeselected";c.comicCreator.ComicPanelSelectEvent.PANE_SELECT="paneSelect";c.comicCreator.ComicPreviewEvent.CLOSE_CLICK="closeClick";c.comicCreator.ComicPreviewState.COMIC_VIEWPORT_WIDTH=750;c.comicCreator.ComicPreviewState.COMIC_VIEWPORT_HEIGHT=600;c.comicCreator.ComicPreviewState.COMIC_OFFSET_X=0;c.comicCreator.ComicPreviewState.COMIC_OFFSET_Y=35;c.comicCreator.ComicPreviewState.MAX_SCALE=1;c.comicCreator.ContentDraggablePanel.DEFAULT_DRAGGABLE_SIZE=250;c.comicCreator.ContentDraggablePanel.MAX_DRAGGABLE_SIZE=600;c.comicCreator.EntityManipulator.DELETE_BUTTON_X=90;c.comicCreator.EntityManipulator.DELETE_BUTTON_Y=-90;c.comicCreator.EntityManipulator.DONE_BUTTON_X=-90;c.comicCreator.EntityManipulator.DONE_BUTTON_Y=90;c.comicCreator.EntityManipulatorEvent.START_MANIPULATION="startManipulation";c.comicCreator.EntityManipulatorEvent.STOP_MANIPULATION="stopManipulation";c.comicCreator.EntityManipulatorEvent.DONE_CLICK="doneClick";c.comicCreator.EntityManipulatorEvent.DELETE_CLICK="deleteClick";c.comicCreator.PhotoFrameSelectionList.TEMPLATE_SPACING_X=125;c.comicCreator.PhotoFrameSelectionList.TEMPLATE_SPACING_Y=0;c.comicCreator.PhotoFrameSelectionList.THUMBNAIL_SIZE_X=100;c.comicCreator.PhotoFrameSelectionList.THUMBNAIL_SIZE_Y=100;c.comicCreator.PhotoFrameSelectionListSelectEvent.SELECT="select";c.comicCreator.PhotoManager._currentPhotoId=25;c.comicCreator.PhotoManager._photoHasBeenManipulated=!1;c.comicCreator.PrintingState.PRINT_WIDTH=1850;c.comicCreator.PrintingState.PRINT_FRAME_ID="PrintingStateIFrame";c.comicCreator.RotationGizmo._isGrabbingHandleGlobally=!1;c.comicCreator.RotationGizmoEvent.START_DRAGGING="startDragging";c.comicCreator.RotationGizmoEvent.STOP_DRAGGING="stopDragging";c.comicCreator.RotationGizmoEvent.SELECT="select";c.comicCreator.RotationGizmoEvent.DESELECT="deselect";c.comicCreator.RotationGizmoRotateEvent.ROTATION_UPDATE="rotationUpdate";c.comicCreator.ScaleGizmo.TWEEN_BACK_DURATION=0.35;c.comicCreator.ScaleGizmo.SCALE_PER_PIXEL=0.01;c.comicCreator.ScaleGizmoEvent.START_DRAG="startDrag";c.comicCreator.ScaleGizmoEvent.STOP_DRAG="stopDrag";c.comicCreator.ScaleGizmoScaleEvent.SCALE_UPDATE="scaleUpdate";c.comicCreator.SceneEntity.DEFAULT_DRAGGABLE_SIZE=250;c.comicCreator.SceneEntity.MAX_DRAGGABLE_SIZE=600;c.comicCreator.SceneEntityEvent.SELECT="select";c.comicCreator.SeasonSelector.DROPDOWN_SPACING_Y=60;c.comicCreator.SeasonSelector.DROPDOWN_BUTTON_OFFSET_Y=-65;c.comicCreator.SeasonSelectorEvent.SEASON_SELECT="seasonSelect";c.comicCreator.hud.Hud.MIN_ASSETS_FOR_SCROLL_BAR=4;c.comicCreator.hud.Hud.AVATAR_DRAG_SCALE=1;c.comicCreator.hud.Hud.SCROLL_UP_X=72;c.comicCreator.hud.Hud.SCROLL_UP_Y=100;c.comicCreator.hud.Hud.SCROLL_DOWN_X=72;c.comicCreator.hud.Hud.SCROLL_DOWN_Y=500;c.comicCreator.hud.Hud.AVATAR_CREATOR_TEXT_Y=40;c.comicCreator.hud.Hud.ITEM_LIST_X=45;c.comicCreator.hud.Hud.ITEM_LIST_Y=0;c.comicCreator.hud.Hud.SEASONS_LIST_X=0;c.comicCreator.hud.Hud.SEASONS_LIST_Y=0;c.comicCreator.hud.Hud.CATEGORY_TABS_X=-132;c.comicCreator.hud.Hud.CATEGORY_TABS_Y=-20;c.comicCreator.hud.Hud.CATEGORY_TABS_SPACING_Y=82;c.comicCreator.hud.Hud.PREVIEW_BUTTON_Y=0;c.comicCreator.hud.Hud.PREVIEW_BUTTON_X=168;c.comicCreator.hud.Hud.HOME_BUTTON_X=71;c.comicCreator.hud.Hud.HOME_BUTTON_Y=42;c.comicCreator.hud.Hud.UNDO_BUTTON_X=155;c.comicCreator.hud.Hud.UNDO_BUTTON_Y=42;c.comicCreator.hud.Hud.DONE_BUTTON_X=236;c.comicCreator.hud.Hud.DONE_BUTTON_Y=42;c.comicCreator.hud.Hud.CORNER_BURST_X=1;c.comicCreator.hud.Hud.CORNER_BURST_Y=-1;c.comicCreator.hud.Hud.HEADER_X=0;c.comicCreator.hud.Hud.HEADER_Y=-1;c.comicCreator.hud.Hud.LIST_BACKGROUND_X=-1;c.comicCreator.hud.Hud.LIST_BACKGROUND_Y=-1;c.comicCreator.hud.Hud.LIST_SCROLL_AMOUNT=420;c.comicCreator.hud.Hud.CATEGORY_LIST_SCROLL_AMOUNT=105;c.comicCreator.hud.HudClearFilterEvent.CLEAR_FILTERS_CLICK="clearFiltersClick";c.comicCreator.hud.HudDropComicAssetEvent.DROP_ASSET="dropAsset";c.comicCreator.hud.HudEvent.BACK_BUTTON_CLICK="backButtonClick";c.comicCreator.hud.HudEvent.PREVIOUS_PANEL_CLICK="previousPanelClick";c.comicCreator.hud.HudEvent.NEXT_PANEL_CLICK="nextPanelClick";c.comicCreator.hud.HudEvent.PREVIEW_CLICK="previewClick";c.comicCreator.hud.HudEvent.FINISH_CLICK="finishClick";c.comicCreator.hud.HudEvent.AVATAR_CREATOR_CLICK="avatarCreatorClick";c.comicCreator.hud.HudEvent.RESET_CLICK="resetClick";c.comicCreator.hud.HudEvent.HELP_CLICK="helpClick";c.comicCreator.hud.HudEvent.SOUND_BUTTON_CLICK="soundButtonClick";c.comicCreator.hud.HudEvent.HOME_BUTTON_CLICK="homeButtonClick";c.comicCreator.hud.HudEvent.ITEM_DOCK_CLICK="itemDockClick";c.comicCreator.hud.HudEvent.CLEAR_FILTERS_CLICK="clearFiltersClick";c.comicCreator.hud.itemDock.CharacterFilterButtonEvent.OPEN="open";c.comicCreator.hud.itemDock.CharacterFilterButtonEvent.CLOSE="close";c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent.MOUSE_DOWN="mouseDown";c.comicCreator.hud.itemDock.DraggableComicAssetThumbnailEvent.MOUSE_UP="mouseUp";c.comicCreator.hud.itemDock.ItemList.ROTATING_ARROW_SPEED=360;c.comicCreator.hud.itemDock.ItemList.SCROLL_DURATION=1;c.comicCreator.hud.itemDock.ItemList.MAX_WIDTH=93.75;c.comicCreator.hud.itemDock.ItemList.MAX_HEIGHT=93.75;c.comicCreator.hud.itemDock.ItemList.DIVIDER_OFFSET_X=7;c.comicCreator.hud.itemDock.ItemList.LIST_WINDOW_HEIGHT=420;c.comicCreator.photoSelect.Countdown.TIME=3;c.comicCreator.photoSelect.PhotoSelectDialog.MAX_PHOTO_WIDTH=225;c.comicCreator.photoSelect.PhotoSelectDialog.MAX_PHOTO_HEIGHT=225;c.comicCreator.photoSelect.PhotoSelectDialogEvent.NEXT_CLICK="nextClick";c.comicCreator.photoSelect.PhotoSelectDialogEvent.SHOW_DIALOG="showDialog";c.comicCreator.photoSelect.PhotoSelectDialogEvent.SHOW_GHOST_SCREEN="showGhostScreen";c.comicCreator.photoSelect.PhotoSelectDialogEvent.DISMISS_GHOST_SCREEN="dismissGhostScreen";c.comicCreator.photoSelect.PhotoSelectDialogEvent.CLOSE="close";c.comicCreator.photoSelect.PhotoSelectDialogEvent.CANCEL="cancel";c.subtitles.SubtitleDisplay.HEADER_IMAGE_X=0;c.subtitles.SubtitleDisplay.HEADER_IMAGE_Y=-10;c.subtitles.SubtitleDisplay.FOOTER_IMAGE_X=0;c.subtitles.SubtitleDisplay.FOOTER_IMAGE_Y=548;c.subtitles.SubtitleDisplay.TEXT_FIELD_X=375;c.subtitles.SubtitleDisplay.TEXT_FIELD_Y=450;c.subtitles.SubtitleDisplay.TEXT_FIELD_DROP_OFFSET_X=3;c.subtitles.SubtitleDisplay.TEXT_FIELD_DROP_OFFSET_Y=3;c.webcam.WebcamDisplayEvent.DISPLAY="display";c.webcam.WebcamDisplayEvent.FAIL="fail";u.xml.Parser.escapes=function(a){a=new u.ds.StringMap;a.set("lt","<");a.set("gt",">");a.set("amp","&");a.set("quot",'"');a.set("apos","'");a.set("nbsp",String.fromCharCode(160));return a}(this);k.main()})("undefined"!=typeof window?window:exports);