ig.module('game.scenes.pinball').requires('cm.game','game.atlas.menu','game.atlas.font','game.atlas.living','game.atlas.jasmine','plugins.box2d','plugins.box2d-debug','plugins.shake','game.entities.menu.btn','game.entities.menu.font','game.entities.menu.bolt','game.entities.menu.object','game.entities.pinball.ball','game.entities.pinball.flipper','game.entities.pinball.plunger','game.entities.pinball.object','game.entities.pinball.teleport','game.entities.pinball.trigger','game.entities.pinball.instructions').defines(function()
{GamePinball=ig.Game.extend({clearColor:false,b2DebugDraw:0,controlBall:0,menuTextureAtlas:new ig.Image('media/images/scenes/menu/sprites.png'),fontTextureAtlas:new ig.Image('media/images/scenes/menu/font_sprites.png'),pinballTextureAtlas1:new ig.Image('media/images/scenes/pinball/living_room_sprites.png'),pinballTextureAtlas2:new ig.Image('media/images/scenes/pinball/jasmines_room_sprites.png'),bgImg1:new ig.Image('media/images/scenes/pinball/living_room.jpg'),bgImg2:new ig.Image('media/images/scenes/pinball/jasmines_room.jpg'),scoreBoxImg:new ig.Image('media/images/scenes/pinball/scorebox.jpg'),soundMultiplier:new ig.Sound('media/audio/sfx2/multiplier.*'),soundLoop:new ig.Sound('media/audio/music/finalGameplayLoop.*'),shakePos:{x:0,y:0},shakeIntensity:12,tableOffset:{x:450,y:0},ballCount:ig.Config.ballCount,pointsCurrent:0,pointsTotal:0,combo:0,comboTimeoutId:0,highestCombo:0,comboGroups:{},destructionPoints:0,destructionTotal:0,destructionCount:0,pointsTween:null,localized:ig.Strings[ig.Config.localized],init:function()
{var textureAtlas=new ig.TextureAtlas(this.menuTextureAtlas,new AtlasMenu().sprites);this.addTextureAtlas('menu_sprites',textureAtlas);var textureAtlas=new ig.TextureAtlas(this.fontTextureAtlas,new AtlasFont().sprites);this.addTextureAtlas('font_sprites',textureAtlas);if(ig.gameTank.data.room=='living_room')
{textureAtlas=new ig.TextureAtlas(this.pinballTextureAtlas1,new AtlasLiving().sprites);this.bgImg=this.bgImg1;}
else
{textureAtlas=new ig.TextureAtlas(this.pinballTextureAtlas2,new AtlasJasmine().sprites);this.bgImg=this.bgImg2;}
this.addTextureAtlas('pinball_sprites',textureAtlas);var boundingBox=new Box2D.Collision.b2AABB();boundingBox.lowerBound.Set(0,0);boundingBox.upperBound.Set(ig.system.realWidth,ig.system.realHeight);this.b2World=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(0,9.8),true);this.buildTable();this.setupListener();if(ig.Debug)
this.b2Debug=new Box2DDebug(this.b2World);if(ig.gameTank.data.instructions)
{this.spawnEntity(entPinballInstructions);this.spawnEntity(entMenuBtn,this.tableOffset.x+165,this.tableOffset.y+160,{name:'x'});this.instructions=this.spawnEntity(entMenuFont,this.tableOffset.x-35,this.tableOffset.y+225,{name:'black_18'});this.instructions.font.letterSpacing=-1.4;this.showInstructions(true);ig.input.on('mouseup',this.showInstructions.bind(this));}
this.spawnEntity(entMenuBtn,45,40,{name:'home2'});this.spawnEntity(entMenuBtn,110,40,{name:'sound'});this.textScore=this.spawnEntity(entMenuFont,-140,60,{name:'orange_48',align:ig.Font.ALIGN.RIGHT});this.textBall=this.spawnEntity(entMenuFont,58,418,{name:'brown_48',align:ig.Font.ALIGN.RIGHT});this.bolt=this.spawnEntity(entMenuBolt,77,ig.system.realHeight*0.5-90,{name:'bolt_wrapper'});this.comboText=this.spawnEntity(entMenuFont,this.tableOffset.x,10,{name:'white_48'});this.screen.y=-20;if(ig.Debug)
{setupEntities(this.entities);ig.input.bind(ig.KEY.UP_ARROW,'keyUp');ig.input.bind(ig.KEY.W,'keyW');ig.input.bind(ig.KEY.A,'keyA');ig.input.bind(ig.KEY.S,'keyS');ig.input.bind(ig.KEY.D,'keyD');ig.input.bind(ig.KEY.Q,'keyQ');ig.input.bind(ig.KEY.E,'keyE');ig.input.bind(ig.KEY.Z,'keyZ');ig.input.bind(ig.KEY.T,'keyT');ig.input.bind(ig.KEY.Y,'keyY');ig.input.bind(ig.KEY.G,'keyG');ig.input.bind(ig.KEY.H,'keyH');ig.input.bind(ig.KEY.DELETE,'keyDelete');}
ig.input.bind(ig.Config.shakeLeft,'keyX');ig.input.bind(ig.Config.shakeRight,'keyC');ig.input.bind(ig.Config.leftFlipper,'keyLeft');ig.input.bind(ig.Config.rightFlipper,'keyRight');ig.input.bind(ig.Config.plungerShoot,'keyDown');if(ig.ua.android&&!ig.gameTank.data.instructions)
ig.gameTank.soundJockey.playSound('gameloops','game',this.soundComplete.bind(this));},update:function()
{this.b2World.Step(ig.system.tick,6,6);this.b2World.ClearForces();var p=parseFloat(this.pointsCurrent);this.textScore.text=this.localized.formatScore?p.format():p;this.textBall.text=this.ballCount;this.parent();},draw:function()
{var ctx=ig.system.context;ctx.save();ctx.drawImage(this.bgImg.data,this.tableOffset.x-(this.bgImg.width*0.5)-this.shakePos.x,this.tableOffset.y-(this.bgImg.height*0.5)-this.screen.y-this.shakePos.y);ctx.drawImage(this.scoreBoxImg.data,0,0);ctx.restore();this.parent();if(ig.Debug&&this.b2DebugDraw)
this.b2Debug.draw();},start:function()
{if(!ig.gameTank.data.instructions)
{var ball=this.getEntityByName('ball');window.addEventListener('shake',ball.doShake.bind(ball),false);ig.music.add(this.soundLoop,'loop');ig.music.play('loop');ig.music.volume=0.4;ig.music.loop=true;}},stop:function()
{if(!ig.gameTank.data.instructions)
{var ball=this.getEntityByName('ball');window.removeEventListener('shake',ball.doShake.bind(ball),false);}},soundComplete:function()
{ig.gameTank.soundJockey.playSound('gameloops','game',this.soundComplete.bind(this))},showInstructions:function(e)
{if(e!=true&&ig.input.mouse.x<150)
return;this.getEntityByName('x').soundClick.play();if(ig.ua.android)
ig.gameTank.soundJockey.playSound('soundeffects','click');if(this.instructions.text=='')
{this.instructions.startPos.y-=40;this.instructions.text=this.localized.InstructionsOne;}
else if(this.instructions.text==this.localized.InstructionsOne)
{this.instructions.startPos.y+=40;this.spawnEntity(entMenuObject,this.tableOffset.x-70,this.tableOffset.y+160,{name:'left_arrow_button'});this.spawnEntity(entMenuObject,this.tableOffset.x,this.tableOffset.y+160,{name:'right_arrow_button'});this.instructions.text=this.localized.InstructionsTwo;}
else if(this.instructions.text==this.localized.InstructionsTwo)
{this.getEntityByName('left_arrow_button').kill();this.getEntityByName('right_arrow_button').kill();this.spawnEntity(entMenuObject,this.tableOffset.x-70,this.tableOffset.y+160,{name:'x_button'});this.spawnEntity(entMenuObject,this.tableOffset.x,this.tableOffset.y+160,{name:'c_button'});this.instructions.text=this.localized.InstructionsThree;}
else
{ig.gameTank.sceneManager.show('pinball',function()
{ig.gameTank.data.instructions=false})}},lostBall:function(ball)
{if(this.ballCount>1)
{this.ballCount--;ball.b2Body.SetPosition(new Box2D.Common.Math.b2Vec2(ball.startPos.x/Box2D.SCALE,ball.startPos.y/Box2D.SCALE));ball.b2Body.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(0,0));}
else
{ig.gameTank.sceneManager.show('menu',function()
{var nm=ig.gameTank.data.room+'_score';ig.gameTank.data.menu='score';ig.gameTank.data.score=this.pointsTotal;ig.gameTank.data.combo=this.highestCombo;ig.gameTank.data.destruction=this.destructionPoints;ig.gameTank.data.isHighscore=false;if(this.pointsTotal>parseFloat(ig.gameTank.cookie.get(nm)||0))
{ig.gameTank.cookie.set(nm,this.pointsTotal);ig.gameTank.data.isHighscore=true;}}.bind(this));}},addPoints:function(points,comboPoints)
{this.pointsTotal+=parseFloat(points);if(this.pointsTween)
this.pointsTween.kill();this.pointsTween=TweenMax.to(this,0.6,{pointsCurrent:this.pointsTotal,roundProps:'pointsCurrent',ease:Linear.easeNone});var name;if(points<=500)
name=['once_row','flash','row','side'].random();else if(points>500)
name=['quick_row','quick_flash','quick_side'].random();if(points>100&&!comboPoints)
this.destructionPoints+=points;this.bolt.doAnim(name);},comboEnd:function()
{if(this.combo<=1)
return;var comboPoints=(this.combo*this.combo)*ig.Config.points.combo;if(comboPoints>this.highestCombo)
this.highestCombo=comboPoints;this.addPoints(comboPoints,true);this.comboText.text=this.combo+this.localized.Combo;this.combo=0;this.soundMultiplier.volume=0.7;this.soundMultiplier.play();if(ig.ua.android)
ig.gameTank.soundJockey.playSound('soundeffects','multiplier');clearTimeout(this.comboTimeoutId);this.comboTimeoutId=setTimeout(function()
{this.comboText.text=''}.bind(this),2000);},addComboGroup:function(obj)
{if(!this.comboGroups[obj.comboGroup])
this.comboGroups[obj.comboGroup]=[];this.comboGroups[obj.comboGroup].push(obj);},checkComboGroup:function(obj)
{if(!this.comboGroups[obj.comboGroup])
return;if(this.comboGroups[obj.comboGroup].indexOf(obj)>-1)
this.comboGroups[obj.comboGroup].erase(obj);if(this.comboGroups[obj.comboGroup].length==0)
{this.addPoints(ig.Config.points.comboGroup);this.comboGroups[obj.comboGroup]=null;}},destructionCheck:function(obj)
{if(!obj.destruction)
return;obj.destruction=false;this.destructionCount++;if(this.destructionCount>=this.destructionTotal)
this.addPoints(ig.Config.points.destruction);},shake:function(time)
{TweenMax.to(this.shakePos,0.1,{repeat:5,x:this.shakePos.x+Math.rand(-this.shakeIntensity,this.shakeIntensity),delay:0.1,ease:Expo.easeInOut})
TweenMax.to(this.shakePos,0.1,{x:0,delay:0.6,ease:Expo.easeInOut})},setupListener:function()
{var listener=new Box2D.Dynamics.b2ContactListener;listener.BeginContact=function(contact)
{var bodyA=contact.GetFixtureA().GetBody(),bodyB=contact.GetFixtureB().GetBody(),obA=bodyA.GetUserData()||{},obB=bodyB.GetUserData()||{};if(obA&&typeof obA.beginContact=='function')
obA.beginContact(bodyB,obB);if(obB&&typeof obB.beginContact=='function')
obB.beginContact(bodyA,obA);if(bodyA.GetType()==2&&bodyB.GetType()==2){}
else
{if((obA.canCombo||obB.canCombo)&&(obA.name=='ball'||obB.name=='ball')&&(obA.name!='flipper'||obB.name!='flipper'))
ig.game.combo++;else if((!obA.skipCombo||!obB.skipCombo)||(obA.name=='flipper'||obB.name=='flipper'))
ig.game.comboEnd();}}
listener.EndContact=function(contact)
{var bodyA=contact.GetFixtureA().GetBody(),bodyB=contact.GetFixtureB().GetBody(),obA=bodyA.GetUserData()||{},obB=bodyB.GetUserData()||{};if(obA&&obA.endContact)
obA.endContact(bodyB,obB);if(obB&&obB.endContact)
obB.endContact(bodyA,obA);}
this.b2World.SetContactListener(listener);},buildTable:function()
{this.spawnEntity(entPinballPlunger);if(ig.gameTank.data.room=='living_room')
{this._b2CreateBox(290.5,67.5,109,27,72);this._b2CreateBox(237.5,-85,27,151,0);this._b2CreateBox(264,19,97,24,53);this._b2CreateBox(-298,11,146,103,53);this._b2CreateBox(-42,-447.5,400,59,0);this._b2CreateBox(-257,-343,66,284,0);this._b2CreateBox(229,282,14,395,0);this._b2CreateBox(264,-177.5,84,21,-38);this._b2CreateBox(-136.5,464,121,30,15);this._b2CreateBox(77,464.5,116,31,-15);this._b2CreateBox(291.5,283,13,434,0);this._b2CreateBox(291,-345,14,300,0);this._b2CreateBox(0,-486,590,18,0);this._b2CreateBox(-290,0,14,994,0);this._b2CreateBox(262,430,62,126,0);this._b2CreateBox(-186.5,486,215,18,0);this._b2CreateBox(124,485,212,22,0);this._b2CreateCustom(-170.5,153.5,[0,-59,8,59,-42,58,-35,-34]);this.spawnEntity(entPinballObject,-31,-447,{name:'kitchen_sink',points:ig.Config.points.kitchensink,destruction:true});this.spawnEntity(entPinballObject,-30,240,{name:'red_frame_1',points:ig.Config.points.base,comboGroup:'frame',editable:true});this.spawnEntity(entPinballObject,-30,290,{name:'red_frame_2',points:ig.Config.points.base,comboGroup:'frame',editable:true});this.spawnEntity(entPinballObject,-30,265,{name:'yellow_frame_1',points:ig.Config.points.base,comboGroup:'frame',editable:true});this.spawnEntity(entPinballObject,-30,315,{name:'yellow_frame_2',points:ig.Config.points.base,comboGroup:'frame',editable:true});this.spawnEntity(entPinballObject,110,-412,{name:'dishwasher',points:ig.Config.points.dishwasher,destruction:true});this.spawnEntity(entPinballObject,-184,-413.5,{name:'crayon_drawer',points:ig.Config.points.crayondrawer,destruction:true});this.spawnEntity(entPinballObject,-85,-413.5,{name:'cabinet_1',points:ig.Config.points.base,canCombo:true,bounceAngle:135});this.spawnEntity(entPinballObject,38,-413.5,{name:'cabinet_2',points:ig.Config.points.base,canCombo:true,bounceAngle:30});this.spawnEntity(entPinballObject,-82,-320.5,{name:'cabinet_3',points:ig.Config.points.base,canCombo:true,bounceAngle:-30});this.spawnEntity(entPinballObject,-20,-320.5,{name:'cabinet_4',points:ig.Config.points.base,canCombo:true,bounceAngle:-150});this.spawnEntity(entPinballObject,44,-320.5,{name:'cabinet_5',points:ig.Config.points.base,canCombo:true,bounceAngle:-150});this.spawnEntity(entPinballObject,-218.5,-317,{name:'cabinet_6',angle:90,points:ig.Config.points.base,canCombo:true,bounceAngle:-60});this.spawnEntity(entPinballObject,-218.5,-256,{name:'cabinet_7',angle:90,points:ig.Config.points.base,canCombo:true,bounceAngle:-60});this.spawnEntity(entPinballObject,-169,-200,{name:'slippery_floor_1',angle:0,points:ig.Config.points.base,comboGroup:'slippery_floor',editable:true});this.spawnEntity(entPinballObject,113,-200,{name:'slippery_floor_2',angle:0,points:ig.Config.points.base,comboGroup:'slippery_floor',editable:true});this.spawnEntity(entPinballObject,184,-200,{name:'slippery_floor_3',angle:0,points:ig.Config.points.base,comboGroup:'slippery_floor',editable:true});this.spawnEntity(entPinballObject,-175,350,{name:'desk_1',points:ig.Config.points.base,angle:40,comboGroup:'desk',editable:true});this.spawnEntity(entPinballObject,112,342,{name:'desk_2',points:ig.Config.points.base,angle:-40,comboGroup:'desk',editable:true});this.spawnEntity(entPinballObject,196,98,{name:'trash_bin',points:ig.Config.points.base,angle:-120,comboGroup:'trash',editable:true});this.spawnEntity(entPinballObject,-211,321,{name:'trash_bin',points:ig.Config.points.base,angle:-138,comboGroup:'trash',editable:true});this.spawnEntity(entPinballObject,-249,400,{name:'speaker_1',points:ig.Config.points.base,angle:40,comboGroup:'speaker',editable:true});this.spawnEntity(entPinballObject,200,400,{name:'speaker_2',points:ig.Config.points.base,angle:-40,comboGroup:'speaker',editable:true});this.spawnEntity(entPinballObject,-218,440,{name:'plant_1',editable:true});this.spawnEntity(entPinballObject,160,440,{name:'plant_2',editable:true});this.spawnEntity(entPinballObject,130,144,{name:'couch_footstool',points:ig.Config.points.base,angle:12,canCombo:true});this.spawnEntity(entPinballObject,123,182,{name:'couch_footstool',points:ig.Config.points.base,angle:12,canCombo:true});this.spawnEntity(entPinballObject,115,220,{name:'couch_footstool',points:ig.Config.points.base,angle:12,canCombo:true});this.spawnEntity(entPinballObject,163,192,{name:'couch',points:ig.Config.points.base,angle:12,editable:true});this.spawnEntity(entPinballObject,-88,-215,{name:'bar_stool',points:ig.Config.points.base,editable:true});this.spawnEntity(entPinballObject,-20,-215,{name:'bar_stool',points:ig.Config.points.base,editable:true});this.spawnEntity(entPinballObject,48,-215,{name:'bar_stool',points:ig.Config.points.base,editable:true});this.spawnEntity(entPinballObject,265,-295,{name:'recycle_bin',points:ig.Config.points.base,comboGroup:'trash',editable:true});this.spawnEntity(entPinballObject,248,-217,{name:'trash_can',points:ig.Config.points.base,comboGroup:'trash',editable:true});this.spawnEntity(entPinballObject,-150,169,{name:'tv_table',points:ig.Config.points.base,editable:true});this.spawnEntity(entPinballObject,-131,171,{name:'tv',points:ig.Config.points.tv,destruction:true,editable:true});this.spawnEntity(entPinballObject,-145,98,{name:'lamp',points:ig.Config.points.base,canCombo:true,editable:true});this.spawnEntity(entPinballObject,-219,440,{name:'plant_1',editable:true});this.spawnEntity(entPinballObject,160,440,{name:'plant_2',editable:true});this.spawnEntity(entPinballObject,192,290,{name:'plant_3',editable:true});this.spawnEntity(entPinballObject,-18,-273,{name:'counter_island_fruit'});this.spawnEntity(entPinballObject,-254,214,{name:'door_1',skipCombo:true});this.spawnEntity(entPinballObject,-197,63,{name:'door_2',skipCombo:true,retractTime:1});this.spawnEntity(entPinballObject,-253,-193,{name:'door_3',skipCombo:true});this.spawnEntity(entPinballObject,45,125,{name:'roomba',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,-90,240,{name:'car',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballFlipper,this.tableOffset.x-230,-60,{side:'left',upperAngle:0.7,lowerAngle:-0.4});this.crashBall=this.spawnEntity(entPinballBall);this.spawnEntity(entPinballObject,-38,-13,{name:'round_table',skipCombo:true,editable:true})
this.spawnEntity(entPinballObject,208,-407,{name:'fridge',editable:true});this.spawnEntity(entPinballObject,243,-329,{name:'fridge_door'});this.spawnEntity(entPinballObject,-252,-228,{name:'counter_edge'});this.spawnEntity(entPinballTeleport,-252,-202,{name:'teleport_counter',size:{x:40,y:30},goto:'teleport_fridge',dirx:[-2,2],diry:[4,8]});this.spawnEntity(entPinballTeleport,232,-389,{name:'teleport_fridge',radius:30,goto:'teleport_counter',dirx:[-10,-4],diry:[0,1]});this.spawnEntity(entPinballTrigger,222,-83,{name:'pictures_top',size:{x:20,y:120},count:1,destruction:true,comboGroup:'picture',onCrash:function()
{ig.game.addPoints(ig.Config.points.teleport);ig.game.spawnEntity(entPinballObject,190,-77,{name:'glass',angle:0});}})}
else if(ig.gameTank.data.room=='jasmines_room')
{this._b2CreateBox(260.5,405.5,61,75,0);this._b2CreateBox(277.5,-310,39,360,0);this._b2CreateBox(311,-104.5,168,125,44);this._b2CreateBox(295,179.5,16,507,0);this._b2CreateBox(48,487.5,66,43,-3);this._b2CreateBox(-115.5,484.5,73,38,3);this._b2CreateBox(150,450,205,60,-29);this._b2CreateBox(-215.5,449,205,60,29);this._b2CreateBox(226.5,208.5,15,445,0);this._b2CreateBox(83,-247.5,110,15,44);this._b2CreateBox(39.5,-305,16,42,0);this._b2CreateBox(-123.5,-467.5,333,41,0);this._b2CreateBox(-294,13,20,1000,0);this._b2CreateBox(147,-481,238,24,0);this._b2CreateBox(313,-49,168,71,68);this.spawnEntity(entPinballObject,-78,120,{name:'paint_green',points:ig.Config.points.base,comboGroup:'paint',editable:true});this.spawnEntity(entPinballObject,-127,185,{name:'paint_yellow',points:ig.Config.points.base,comboGroup:'paint',editable:true});this.spawnEntity(entPinballObject,0,140,{name:'paint_orange',points:ig.Config.points.base,comboGroup:'paint',editable:true});this.spawnEntity(entPinballObject,-55,200,{name:'book_1',angle:0,points:ig.Config.points.base,skipCombo:true,editable:true});this.spawnEntity(entPinballObject,28,190,{name:'book_2',angle:0,points:ig.Config.points.base,skipCombo:true,editable:true});for(var i=0,crayons=['blue','brown','darkblue','darkgreen','lime','orange','pink','purple','red','yellow'],crayon;crayon=crayons[i++];)
this.spawnEntity(entPinballObject,Math.rand(-80,40),Math.rand(220,300),{name:'crayon_'+crayon,points:ig.Config.points.base});this.spawnEntity(entPinballObject,111,271,{name:'books',angle:15,points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,126,271,{name:'bookshelf',angle:15});this.spawnEntity(entPinballObject,-204,179,{name:'table_chair',points:ig.Config.points.base,editable:true})
this.spawnEntity(entPinballObject,-240,184,{name:'table',points:ig.Config.points.base,editable:true})
this.spawnEntity(entPinballObject,-238,117,{name:'table_end_top',points:ig.Config.points.base,editable:true})
this.spawnEntity(entPinballObject,-238,249,{name:'table_end_bottom',points:ig.Config.points.base,editable:true})
this.spawnEntity(entPinballObject,195,-15,{name:'trash_bin',points:ig.Config.points.base,canCombo:true,comboGroup:'trash'});this.spawnEntity(entPinballObject,10,-300,{name:'trash_bin',points:ig.Config.points.base,canCombo:true,comboGroup:'trash'});this.spawnEntity(entPinballObject,-77,41,{name:'ottoman',points:ig.Config.points.base,editable:true})
this.spawnEntity(entPinballObject,-220,-239,{name:'lamp',points:ig.Config.points.base,comboGroup:'lamp',editable:true})
this.spawnEntity(entPinballObject,-175,354,{name:'lamp',points:ig.Config.points.base,comboGroup:'lamp',editable:true})
this.spawnEntity(entPinballObject,125,19,{name:'couch_footstool',angle:220,points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,166,54,{name:'couch_1',angle:130,points:ig.Config.points.base,canCombo:true,editable:true});this.spawnEntity(entPinballObject,-91,-448,{name:'speaker',points:ig.Config.points.speaker,destruction:true});this.spawnEntity(entPinballObject,-35,-448,{name:'speaker',points:ig.Config.points.speaker,destruction:true});this.spawnEntity(entPinballObject,147,-455,{name:'shoe_shelf',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,244,-377,{name:'drawer'});this.spawnEntity(entPinballObject,133,-273,{name:'beanbag',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,35,-384,{name:'door_1',skipCombo:true,retractTime:1});this.spawnEntity(entPinballObject,168,-164,{name:'door_3',angle:-46,skipCombo:true,retractTime:1});this.spawnEntity(entPinballObject,244,-247,{name:'clothes',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,-216,-457,{name:'heart',points:ig.Config.points.heart,destruction:true});this.spawnEntity(entPinballObject,0,0,{name:'roomba',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballObject,-126,-112,{name:'car',points:ig.Config.points.base,canCombo:true});this.spawnEntity(entPinballFlipper,this.tableOffset.x-232,0,{side:'left',upperAngle:-0.2,lowerAngle:-1.5});this.crashBall=this.spawnEntity(entPinballBall);this.spawnEntity(entPinballObject,-132,-237,{name:'bed',angle:0,skipCombo:true,editable:true})
this.spawnEntity(entPinballObject,-132+-50,-237+-75,{name:'bed_leg',points:ig.Config.points.base,canCombo:true})
this.spawnEntity(entPinballObject,-132+50,-237+-75,{name:'bed_leg',points:ig.Config.points.base,canCombo:true})
this.spawnEntity(entPinballObject,-132+-50,-237+75,{name:'bed_leg',points:ig.Config.points.base,canCombo:true})
this.spawnEntity(entPinballObject,-132+50,-237+75,{name:'bed_leg',points:ig.Config.points.base,canCombo:true})
this.spawnEntity(entPinballTrigger,-267,-441.5,{name:'bear_bounce',size:{x:234,y:63},angle:-55,count:-1,onCrash:function(obj)
{var a=Math.rand(35,55).toRad();var v2=new Box2D.Common.Math.b2Vec2(Math.cos(a),Math.sin(a));v2.Multiply(14);obj.SetLinearVelocity(v2);}})
this.spawnEntity(entPinballTrigger,-280,-70,{name:'pictures_left',size:{x:20,y:140},count:1,destruction:true,comboGroup:'picture',onCrash:function()
{ig.game.addPoints(ig.Config.points.picture);ig.game.spawnEntity(entPinballObject,-260,-70,{name:'glass',angle:0});}})
this.spawnEntity(entPinballTrigger,218,124,{name:'pictures_right',size:{x:20,y:60},count:1,destruction:true,comboGroup:'picture',onCrash:function()
{ig.game.addPoints(ig.Config.points.picture);ig.game.spawnEntity(entPinballObject,185,124,{name:'glass',angle:0});}})
this.spawnEntity(entPinballTrigger,83,-254,{name:'pictures_corner',radius:30,count:1,destruction:true,comboGroup:'picture',onCrash:function()
{ig.game.addPoints(ig.Config.points.picture);ig.game.spawnEntity(entPinballObject,50,-220,{name:'glass',angle:-45});}})}
this.spawnEntity(entPinballFlipper,this.tableOffset.x-100,380,{side:'left',upperAngle:0.7,lowerAngle:-0.4});this.spawnEntity(entPinballFlipper,this.tableOffset.x+40,380,{side:'right',upperAngle:0.4,lowerAngle:-0.7});},_b2CreateCustom:function(x,y,points)
{var vert=[];var polyShape=new Box2D.Collision.Shapes.b2PolygonShape;for(var i=0;i<points.length/2;i++)
vert[i]=new Box2D.Common.Math.b2Vec2(points[i*2+0]/Box2D.SCALE,points[i*2+1]/Box2D.SCALE);polyShape.SetAsArray(vert,vert.length);var fixture=new Box2D.Dynamics.b2FixtureDef;fixture.shape=polyShape;fixture.density=1;fixture.friction=0.2;fixture.restitution=0.4;var bodyDef=new Box2D.Dynamics.b2BodyDef;bodyDef.position.Set((this.tableOffset.x+x)/Box2D.SCALE,(this.tableOffset.y+y)/Box2D.SCALE);var body=this.b2World.CreateBody(bodyDef);body.CreateFixture(fixture);return body},_b2CreateBox:function(x,y,w,h,angle)
{var fixture=new Box2D.Dynamics.b2FixtureDef;fixture.shape=new Box2D.Collision.Shapes.b2PolygonShape;fixture.shape.SetAsBox((w*0.5)/Box2D.SCALE,(h*0.5)/Box2D.SCALE);fixture.density=1;fixture.friction=0.2;fixture.restitution=0.4;var bodyDef=new Box2D.Dynamics.b2BodyDef;bodyDef.position.Set((this.tableOffset.x+x)/Box2D.SCALE,(this.tableOffset.y+y)/Box2D.SCALE);var body=this.b2World.CreateBody(bodyDef);body.CreateFixture(fixture);body.SetAngle((angle||0).toRad());return body},_b2CreateCircle:function(x,y,r)
{var fixture=new Box2D.Dynamics.b2FixtureDef;fixture.shape=new Box2D.Collision.Shapes.b2CircleShape(r/Box2D.SCALE);fixture.density=1;fixture.friction=0.2;fixture.restitution=0.4;var bodyDef=new Box2D.Dynamics.b2BodyDef;bodyDef.position.Set((this.tableOffset.x+x)/Box2D.SCALE,(this.tableOffset.y+y)/Box2D.SCALE);var body=this.b2World.CreateBody(bodyDef);body.CreateFixture(fixture);return body}})})