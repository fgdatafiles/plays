!function(t){function e(e){for(var i,o,r=e[0],l=e[1],h=e[2],d=0,p=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);for(c&&c(e);p.length;)p.shift()();return n.push.apply(n,h||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],i=!0,r=1;r<s.length;r++){var l=s[r];0!==a[l]&&(i=!1)}i&&(n.splice(e--,1),t=o(o.s=s[0]))}return t}var i={},a={0:0},n=[];function o(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=i,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var c=l;n.push([210,1,2,3]),s()}([,,function(t,e,s){s.r(e),s.d(e,"Levels",(function(){return i})),s.d(e,"BUILDING_KEY",(function(){return a})),s.d(e,"MODULE_SIZE_Z",(function(){return n})),s.d(e,"MODULE_OFFSET",(function(){return o})),s.d(e,"CollisionTypes",(function(){return r})),s.d(e,"COLLISION_BUFFER",(function(){return l})),s.d(e,"PigeonConfig",(function(){return h})),s.d(e,"getStarCountViaElapsedTime",(function(){return c})),s.d(e,"setLevelTime",(function(){return d})),s.d(e,"getLevelTime",(function(){return p})),s.d(e,"getStarCount",(function(){return u})),s.d(e,"setStarCount",(function(){return m})),s.d(e,"getTotalStarCount",(function(){return g})),s.d(e,"isLevelUnlocked",(function(){return f}));var i=[{level:[8,5,3],time:[38,35,33,29,28],unlockStarsCount:0},{level:[4,9,8],time:[40,37,34,30,28],unlockStarsCount:1},{level:[10,5,1],time:[42,38,34,29,27],unlockStarsCount:5},{level:[6,13,5,10],time:[51,46,42,37,34],unlockStarsCount:12},{level:[7,1,6,11],time:[52,47,43,37,34],unlockStarsCount:18},{level:[2,13,2,1],time:[54,49,44,38,34],unlockStarsCount:22},{level:[12,11,3,10],time:[56,50,45,38,34],unlockStarsCount:25},{level:[7,6,13,5,1],time:[65,58,52,45,40],unlockStarsCount:29},{level:[9,4,12,8,2],time:[60,56,52,47,44],unlockStarsCount:32},{level:[8,7,10,8,9],time:[59,54,49,43,40],unlockStarsCount:36},{level:[2,4,9,4,3],time:[66,60,54,47,42],unlockStarsCount:39},{level:[7,1,6,11,3,10],time:[72,65,59,51,46],unlockStarsCount:44},{level:[5,4,12,13,11,2],time:[73,67,61,54,49],unlockStarsCount:48},{level:[10,8,7,1,6,11],time:[71,64,58,51,46],unlockStarsCount:52},{level:[6,11,8,7,3,12,9],time:[83,75,68,60,54],unlockStarsCount:55}],a="base",n=50,o=0,r={UP:0,LEFT:1,RIGHT:2,FORWARD:3},l=1,h={PIGEON_COUNT:6,FLOCK_RADIUS:3,PIGEON_SPEED:10,TRIGGER_DISTANCE:12};function c(t,e){for(var s=0;s<i[t].time.length;s++)if(e>i[t].time[s])return s;return i[t].time.length}function d(t,e,s){t.setItem("time_".concat(e),s)}function p(t,e){return t.getItem("time_".concat(e),Number.MAX_SAFE_INTEGER)}function u(t,e){return t.getItem("stars_".concat(e),0)}function m(t,e,s){t.setItem("stars_".concat(e),s)}function g(t){for(var e=0,s=0;s<i.length;s++)e+=u(t,s);return e}function f(t,e){return i[t].unlockStarsCount<=e}},function(t,e,s){s.r(e),s.d(e,"ACCELERATION_Z",(function(){return a})),s.d(e,"DECELERATION_Z",(function(){return n})),s.d(e,"MAX_SPEED_Z",(function(){return o})),s.d(e,"AUTO_JUMP_FORCE",(function(){return r})),s.d(e,"WALL_RUN_JUMP_FORCE",(function(){return l})),s.d(e,"GRAVITY_DEFAULT",(function(){return h})),s.d(e,"GRAVITY_WALL_RUN",(function(){return c})),s.d(e,"MIN_FALL_SPEED",(function(){return d})),s.d(e,"ROLL_ANIM_AIR_TIME",(function(){return p})),s.d(e,"CLIMB_FORCE",(function(){return u})),s.d(e,"CLIMB_ACCELERATION",(function(){return m})),s.d(e,"CLIMB_SPEED",(function(){return g})),s.d(e,"STRAFE_ACCELERATION",(function(){return f})),s.d(e,"RUN_STRAFE_SPEED",(function(){return b})),s.d(e,"IN_AIR_STRAFE_SPEED",(function(){return y})),s.d(e,"CLIMB_STRAFE_SPEED",(function(){return x})),s.d(e,"WALL_RUN_STRAFE_SPEED",(function(){return _})),s.d(e,"LEAN_MAX",(function(){return v})),s.d(e,"MOBILE_INPUT_SENSITIVITY",(function(){return S})),s.d(e,"DEATH_POSITION_Y",(function(){return I})),s.d(e,"SLOW_MOTION_MULTIPLIER",(function(){return L})),s.d(e,"COMBO_DECAY_TIME",(function(){return E})),s.d(e,"InteractableObjects",(function(){return T}));var i=s(0),a=6,n=8,o=7,r=7,l=10,h=-25,c=-10,d=-50,p=1,u=5,m=2e3,g={max:50,min:2},f=7,b=7,y=6,x=2,_=6,v=Math.PI/10,S=2,I=0,L=.1,E=2,T={JUMP_OVER:0,SLIDE_UNDER:1,ZIP_LINE:2,BOOST_RUN:3,TRAMPOLINE:4,BOOST_WALL_RUN:5,TRAMPOLINE_SMALL:6,properties:{0:{key:"hedge",acceleration:10,maxSpeed:12,duration:2,triggerDistance:2},1:{key:"bar",acceleration:10,maxSpeed:12,duration:2,triggerDistance:1},2:{key:"zipline",startKey:"start",lineKey:"line",endKey:"end",speed:10,offset:new i.Ob(0,-.25,0),triggerDistance:1},3:{key:"arrowFloor",acceleration:20,maxSpeed:15,duration:2,triggerDistance:1},4:{key:"trampoline",forceY:25,acceleration:10,maxSpeed:10,duration:1,triggerDistance:1},5:{key:"arrowWall",forceY:6,acceleration:20,maxSpeed:10,duration:2,triggerDistance:2.5},6:{key:"trampoline_small",forceY:15,acceleration:10,maxSpeed:10,duration:1,triggerDistance:1}}}},function(t,e,s){s.r(e),s.d(e,"NEAR",(function(){return a})),s.d(e,"FAR",(function(){return n})),s.d(e,"Modes",(function(){return o}));var i=s(0),a=.1,n=200,o={DEFAULT:0,DEATH:1,WON:2,WALL_RUN_RIGHT:3,WALL_RUN_LEFT:4,CLIMB:5,SLIDE:6,RUN:7,RUN_BOOST:8,ZIP_LINE:9,FLY_OVER:10,FLY_OVER_TO_RUN:11,properties:{0:{fov:80,offset:new i.Ob(0,2.5,-6),lookAt:new i.Ob(0,1,0),followSpeed:15,transitionSpeed:.5},1:{fov:100,offset:new i.Ob(0,2.5,-3),lookAt:new i.Ob(0,1,0),followSpeed:1,transitionSpeed:5},2:{fov:100,offset:new i.Ob(0,0,3),lookAt:new i.Ob(0,0,0),followSpeed:10,transitionSpeed:5},3:{fov:100,offset:new i.Ob(2,2.5,-2),lookAt:new i.Ob(0,0,0),followSpeed:15,transitionSpeed:5},4:{fov:100,offset:new i.Ob(-2,2.5,-2),lookAt:new i.Ob(0,0,0),followSpeed:15,transitionSpeed:5},5:{fov:80,offset:new i.Ob(0,1,-5),lookAt:new i.Ob(0,1,0),followSpeed:10,transitionSpeed:.5},6:{fov:100,offset:new i.Ob(0,1.5,-2),lookAt:new i.Ob(0,1,0),followSpeed:15,transitionSpeed:3},7:{fov:90,offset:new i.Ob(0,2.5,-6),lookAt:new i.Ob(0,1,0),followSpeed:15,transitionSpeed:2},8:{fov:100,offset:new i.Ob(0,2.5,-3),lookAt:new i.Ob(0,1,0),followSpeed:15,transitionSpeed:10},9:{fov:110,offset:new i.Ob(0,3,-2),lookAt:new i.Ob(0,0,0),followSpeed:15,transitionSpeed:10},10:{fov:90,offset:new i.Ob(-90,110,60),lookAt:new i.Ob(1,-2,-2),followSpeed:.1,transitionSpeed:10},11:{fov:90,offset:new i.Ob(-0,2.5,-6),lookAt:new i.Ob(0,1,0),followSpeed:15,transitionSpeed:5,duration:2}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,s){var i={"./atlas/button":137,"./atlas/button.json":137,"./atlas/button.png":406,"./atlas/label":138,"./atlas/label.json":138,"./atlas/label.png":407,"./atlas/loading":139,"./atlas/loading.json":139,"./atlas/loading.png":408,"./data/basePack":140,"./data/basePack.json":140,"./data/config":141,"./data/config.json":141,"./data/config/cameraConfig":4,"./data/config/cameraConfig.js":4,"./data/config/levelConfig":2,"./data/config/levelConfig.js":2,"./data/config/playerConfig":3,"./data/config/playerConfig.js":3,"./data/gameOverPack":142,"./data/gameOverPack.json":142,"./data/gamePack":143,"./data/gamePack.json":143,"./data/levelSelectPack":144,"./data/levelSelectPack.json":144,"./data/menuPack":145,"./data/menuPack.json":145,"./font/Asap-Bold.css":409,"./font/Asap-Bold.woff":146,"./font/Kanit-Bold.css":410,"./font/Kanit-Bold.woff":147,"./font/Kanit-ExtraBoldItalic.css":411,"./font/Kanit-ExtraBoldItalic.woff":148,"./font/Kanit-SemiBold.css":412,"./font/Kanit-SemiBold.woff":149,"./font/Kanit-SemiBoldItalic.css":413,"./font/Kanit-SemiBoldItalic.woff":150,"./font/Knewave-Regular.css":414,"./font/Knewave-Regular.woff":151,"./font/Roboto-Regular.css":415,"./font/Roboto-Regular.woff":152,"./font/RobotoCondensed-BoldItalic.css":416,"./font/RobotoCondensed-BoldItalic.woff":153,"./fx/Leaves FX/leafParticle01.png":417,"./fx/Leaves FX/leafParticle02.png":418,"./fx/Leaves FX/leafParticle03.png":419,"./fx/Leaves FX/leafParticle04.png":420,"./fx/Leaves FX/leavesEffect":154,"./fx/Leaves FX/leavesEffect.json":154,"./fx/Leaves FX/leavesEmitter":155,"./fx/Leaves FX/leavesEmitter.json":155,"./fx/dust.png":421,"./fx/glow":156,"./fx/glow.json":156,"./fx/land":157,"./fx/land.json":157,"./fx/run":158,"./fx/run.json":158,"./fx/slide":159,"./fx/slide.json":159,"./fx/star.png":422,"./fx/win":160,"./fx/win.json":160,"./glb/BaseHeight_01.glb":423,"./glb/BaseHeight_02.glb":424,"./glb/BaseHeight_03.glb":425,"./glb/BaseHeight_04.glb":426,"./glb/baseBlocks.glb":427,"./glb/char.glb":428,"./glb/dropShadow.glb":429,"./glb/finishPlane.glb":430,"./glb/parkourElements.glb":431,"./glb/pigeon_01.glb":432,"./glb/trail.glb":433,"./image/base.jpg":434,"./image/base.webp":435,"./image/char_01.png":436,"./image/char_01.webp":437,"./image/default.png":438,"./image/default.webp":439,"./image/dropShadow.png":440,"./image/dropShadow.webp":441,"./image/greybox.jpg":442,"./image/greybox.webp":443,"./image/loading.png":444,"./image/loading.webp":445,"./image/loadingBG.png":446,"./image/loadingBG.webp":447,"./image/parkour_elements.png":448,"./image/parkour_elements.webp":449,"./image/pigeon_01.png":450,"./image/pigeon_01.webp":451,"./image/skybox_tex.png":452,"./image/skybox_tex.webp":453,"./image/start.jpg":454,"./image/start.webp":455,"./image/trail.png":456,"./image/trail.webp":457,"./layout/inGame":161,"./layout/inGame.json":161,"./layout/levelSelection":162,"./layout/levelSelection.json":162,"./layout/levelSelectionBG":163,"./layout/levelSelectionBG.json":163,"./layout/loading":164,"./layout/loading.json":164,"./layout/results":165,"./layout/results.json":165,"./layout/start":166,"./layout/start.json":166,"./layout/tutorial":167,"./layout/tutorial.json":167,"./locale/de-DE.csv":458,"./locale/en-US.csv":459,"./locale/es-ES.csv":460,"./locale/fr-FR.csv":461,"./locale/pt-BR.csv":462,"./material/char":168,"./material/char.json":168,"./material/dropShadow":169,"./material/dropShadow.json":169,"./material/finish":170,"./material/finish.json":170,"./material/greybox":171,"./material/greybox.json":171,"./material/parkourElements":172,"./material/parkourElements.json":172,"./material/pigeon":173,"./material/pigeon.json":173,"./material/skybox":174,"./material/skybox.json":174,"./material/trail":175,"./material/trail.json":175,"./scene/export":176,"./scene/export.json":176,"./scene/export_trail":177,"./scene/export_trail.json":177,"./scene/module_01":178,"./scene/module_01.json":178,"./scene/module_02":179,"./scene/module_02.json":179,"./scene/module_03":180,"./scene/module_03.json":180,"./scene/module_04":181,"./scene/module_04.json":181,"./scene/module_05":182,"./scene/module_05.json":182,"./scene/module_06":183,"./scene/module_06.json":183,"./scene/module_07":184,"./scene/module_07.json":184,"./scene/module_08":185,"./scene/module_08.json":185,"./scene/module_09":186,"./scene/module_09.json":186,"./scene/module_10":187,"./scene/module_10.json":187,"./scene/module_11":188,"./scene/module_11.json":188,"./scene/module_12":189,"./scene/module_12.json":189,"./scene/module_13":190,"./scene/module_13.json":190,"./scene/module_finish":191,"./scene/module_finish.json":191,"./scene/module_start":192,"./scene/module_start.json":192,"./shader/animatedSkinned.fragment.glsl":463,"./shader/animatedSkinned.vertex.glsl":464,"./shader/indicator_01.fragment.glsl":465,"./shader/indicator_01.vertex.glsl":466,"./shader/toonChar.fragment.glsl":467,"./shader/toonChar.vertex.glsl":468,"./shader/toonEnv.fragment.glsl":469,"./shader/toonEnv.vertex.glsl":470,"./shader/trail.fragment.glsl":471,"./shader/trail.vertex.glsl":472,"./shader/vv.fragment.glsl":473,"./shader/vv.vertex.glsl":474,"./snd/bigjump.m4a":475,"./snd/bigjump.ogg":476,"./snd/boost.m4a":477,"./snd/boost.ogg":478,"./snd/button.m4a":479,"./snd/button.ogg":480,"./snd/climb.m4a":481,"./snd/climb.ogg":482,"./snd/countdown.m4a":483,"./snd/countdown.ogg":484,"./snd/finish.m4a":485,"./snd/finish.ogg":486,"./snd/landing.m4a":487,"./snd/landing.ogg":488,"./snd/menumusic.m4a":489,"./snd/menumusic.ogg":490,"./snd/music.m4a":491,"./snd/music.ogg":492,"./snd/roll.m4a":493,"./snd/roll.ogg":494,"./snd/run.m4a":495,"./snd/run.ogg":496,"./snd/score.m4a":497,"./snd/score.ogg":498,"./snd/smalljump.m4a":499,"./snd/smalljump.ogg":500,"./snd/star.m4a":501,"./snd/star.ogg":502,"./snd/zipline.m4a":503,"./snd/zipline.ogg":504,"./texture/char_01":193,"./texture/char_01.json":193,"./texture/dropShadow":194,"./texture/dropShadow.json":194,"./texture/greybox":195,"./texture/greybox.json":195,"./texture/parkourElements":196,"./texture/parkourElements.json":196,"./texture/pigeon_01":197,"./texture/pigeon_01.json":197,"./texture/skybox_tex":198,"./texture/skybox_tex.json":198,"./texture/trail":199,"./texture/trail.json":199};function a(t){var e=n(t);return s(e)}function n(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}a.keys=function(){return Object.keys(i)},a.resolve=n,t.exports=a,a.id=136},function(t,e,s){t.exports=s.p+"assets/atlas/button_95b5bde8f33e486e08f49083782842c1.json"},function(t,e,s){t.exports=s.p+"assets/atlas/label_a2d1ed551ce17be1bdcd1315000838d0.json"},function(t,e,s){t.exports=s.p+"assets/atlas/loading_5e04158f1999809533ce5a0066130704.json"},function(t,e,s){t.exports=s.p+"assets/data/basePack_c524d888682247baff03c13598178139.json"},function(t,e,s){t.exports=s.p+"assets/data/config_1d55629c86b3c043339f69e66af6c57f.json"},function(t,e,s){t.exports=s.p+"assets/data/gameOverPack_e09696e3d3db0278b02b1bb7714621e2.json"},function(t,e,s){t.exports=s.p+"assets/data/gamePack_542eaad53d258e875da7a347378276ad.json"},function(t,e,s){t.exports=s.p+"assets/data/levelSelectPack_2c6d57aed94fa734d5681ec9c3bcdd6f.json"},function(t,e,s){t.exports=s.p+"assets/data/menuPack_9ce7ac7053d4e34720e9c34a5aee5158.json"},function(t,e){t.exports="../../assets/font/Asap-Bold_0abf645f5f8379f72f4710a334aa4825.woff"},function(t,e){t.exports="../../assets/font/Kanit-Bold_d3a6be680cf063e6d89217f116b7c1bf.woff"},function(t,e){t.exports="../../assets/font/Kanit-ExtraBoldItalic_baec4432365aaedf4b728e3b86cb4208.woff"},function(t,e){t.exports="../../assets/font/Kanit-SemiBold_8418b13528cd01e0994a78a58a6cfa0c.woff"},function(t,e){t.exports="../../assets/font/Kanit-SemiBoldItalic_cca2bd30c88fcc645f666b1182dbedff.woff"},function(t,e){t.exports="../../assets/font/Knewave-Regular_4e673f8fd868067600f8f8a5865e4f42.woff"},function(t,e){t.exports="../../assets/font/Roboto-Regular_9f0f74b9d7d1a3eb0d1cac5fbc025e47.woff"},function(t,e){t.exports="../../assets/font/RobotoCondensed-BoldItalic_e43d3ee19b7895e773d2826287b339c5.woff"},function(t,e,s){t.exports=s.p+"assets/fx/Leaves FX/leavesEffect_59232f88dd68dd6ac0f62760030120af.json"},function(t,e,s){t.exports=s.p+"assets/fx/Leaves FX/leavesEmitter_477914efd47969d555df01fcea91b34b.json"},function(t,e,s){t.exports=s.p+"assets/fx/glow_1df0d2101abacdd3ae68394e2b44a203.json"},function(t,e,s){t.exports=s.p+"assets/fx/land_42a7ae34efd38f5f0fe9a7d32997625e.json"},function(t,e,s){t.exports=s.p+"assets/fx/run_b99f772f0df881b55c029e1a74811ac4.json"},function(t,e,s){t.exports=s.p+"assets/fx/slide_3ab42d125a9b46fe9287c3c6ca465376.json"},function(t,e,s){t.exports=s.p+"assets/fx/win_f719a6080aa74a8a28130abd16b6654b.json"},function(t,e,s){t.exports=s.p+"assets/layout/inGame_18ca7cb6ef9d0f1e2aeffbd6ab759738.json"},function(t,e,s){t.exports=s.p+"assets/layout/levelSelection_39f3dd5e481c043f65e563154e75dac5.json"},function(t,e,s){t.exports=s.p+"assets/layout/levelSelectionBG_c69b8eb2fdd68c1df42c54ece42e38e9.json"},function(t,e,s){t.exports=s.p+"assets/layout/loading_54a6d0839932540a03ec06897ed5816f.json"},function(t,e,s){t.exports=s.p+"assets/layout/results_5631fd558829e255be68a9b1ef4f73a8.json"},function(t,e,s){t.exports=s.p+"assets/layout/start_495ced1ff530517f74514c0553738040.json"},function(t,e,s){t.exports=s.p+"assets/layout/tutorial_1af5eac827342fb0a09ccae47162c118.json"},function(t,e,s){t.exports=s.p+"assets/material/char_c96e9fe2f1a91124626b121359f1ae38.json"},function(t,e,s){t.exports=s.p+"assets/material/dropShadow_b35cb9c9c0f87189d4eebf6e116edf19.json"},function(t,e,s){t.exports=s.p+"assets/material/finish_f96e3c5f0fc31d5e79f178c1fb691a07.json"},function(t,e,s){t.exports=s.p+"assets/material/greybox_6a21bee78ff63daaa3309ab19389d279.json"},function(t,e,s){t.exports=s.p+"assets/material/parkourElements_ae771c27117e0db5f227274ecaabdf35.json"},function(t,e,s){t.exports=s.p+"assets/material/pigeon_94cda8f7796f794ef063ce7d209fe0c9.json"},function(t,e,s){t.exports=s.p+"assets/material/skybox_1c113643b9de72dc704728b19a9f2a1b.json"},function(t,e,s){t.exports=s.p+"assets/material/trail_70c016ff7cafc5a46f08e2395647bb82.json"},function(t,e,s){t.exports=s.p+"assets/scene/export_fc6bf6f73ce0ddc49b5143c85a4d2d5e.json"},function(t,e,s){t.exports=s.p+"assets/scene/export_trail_0950057b73dc58cce397f0777df43938.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_01_76f527fddb4b0905bed9024d3df6e318.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_02_5a475769f49fe45058726082c70908d5.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_03_34fe94ae08323744cd4028ea75f459d6.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_04_12a02496845c6eebe1cb080c3536ead3.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_05_a468715531441ee78f9a62422d15111f.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_06_31491a16c6d9a1fd831c00c55338a44d.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_07_62d0a0d2ab28b0a1bd33c217dc231f6f.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_08_cfb9af80cbef94ea9abc0348e2e78c23.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_09_1b510f3033c3f270cd1e1e469d16065f.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_10_0d19b730020c7c02d8f067c23ff6112f.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_11_b36583949afa7021201d78c249213c78.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_12_19b0e53f67d1a3003df3c8612dce9066.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_13_815ca573e63ba7ae6cd724344cd20955.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_finish_8dd37ae5bdc76a9de9ebc4a9f2807a31.json"},function(t,e,s){t.exports=s.p+"assets/scene/module_start_527216ddca966c92dcdbdc1a2fbe7a95.json"},function(t,e,s){t.exports=s.p+"assets/texture/char_01_0daa920d19c8436f9f3525be74c2c60c.json"},function(t,e,s){t.exports=s.p+"assets/texture/dropShadow_b3561f599d160c1829c00976880985b2.json"},function(t,e,s){t.exports=s.p+"assets/texture/greybox_9764cc473517df0d6ad11618b0939d44.json"},function(t,e,s){t.exports=s.p+"assets/texture/parkourElements_efb05d1e11bac1292fc9a11f8d084680.json"},function(t,e,s){t.exports=s.p+"assets/texture/pigeon_01_f5ad6c4999475b326e5c284c10ad37be.json"},function(t,e,s){t.exports=s.p+"assets/texture/skybox_tex_a2b7b2b7506114333a1c68e2a3d1da47.json"},function(t,e,s){t.exports=s.p+"assets/texture/trail_8d908707de36ea4d48928bca86cfd775.json"},,,,,,,,,,,function(t,e,s){s(211),s(397),s(399),s(401),s(404),t.exports=s(510)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,s){t.exports=s.p+"assets/atlas/button_34b85bddae46a92c05cf4a7103f128d1.png"},function(t,e,s){t.exports=s.p+"assets/atlas/label_c8593da83d07aaab926c64a291a97106.png"},function(t,e,s){t.exports=s.p+"assets/atlas/loading_47ebfed0a643fcffa79dfcdf4429ecb6.png"},function(t,e,s){t.exports=s.p+"assets/font/Asap-Bold_4c18a9ec8202f68dc67d8acf7a056238.css"},function(t,e,s){t.exports=s.p+"assets/font/Kanit-Bold_3ba632a2492a858a4ec88497a19aaab3.css"},function(t,e,s){t.exports=s.p+"assets/font/Kanit-ExtraBoldItalic_eec0e86c66d81dad21aabc7ea627770a.css"},function(t,e,s){t.exports=s.p+"assets/font/Kanit-SemiBold_1270d62ebff9eaf31b58ff2a5b620d90.css"},function(t,e,s){t.exports=s.p+"assets/font/Kanit-SemiBoldItalic_97e1903fb351dff13f946964739a8f93.css"},function(t,e,s){t.exports=s.p+"assets/font/Knewave-Regular_1e73a4ed053f7b0f60c3af5c0251cbc3.css"},function(t,e,s){t.exports=s.p+"assets/font/Roboto-Regular_3edf06c0c7f86e49238907eb56f157b2.css"},function(t,e,s){t.exports=s.p+"assets/font/RobotoCondensed-BoldItalic_e7eff458000e266571aa8fbdcedfcb66.css"},function(t,e,s){t.exports=s.p+"assets/fx/Leaves FX/leafParticle01_9f0270947373c732fc47e86dd4d95d4b.png"},function(t,e,s){t.exports=s.p+"assets/fx/Leaves FX/leafParticle02_9e5a4a8b9c9f4978e4b6895f1794288a.png"},function(t,e,s){t.exports=s.p+"assets/fx/Leaves FX/leafParticle03_4e7d2c205f066c468dfddf6a96d94b1e.png"},function(t,e,s){t.exports=s.p+"assets/fx/Leaves FX/leafParticle04_81c7a10df6c09e970b7a2646ad0000ba.png"},function(t,e,s){t.exports=s.p+"assets/fx/dust_78b915c5e0f50b3d2fcb2e688ae9aeb4.png"},function(t,e,s){t.exports=s.p+"assets/fx/star_c0aced9d0854cb2fd79255e2f94e3f7d.png"},function(t,e,s){t.exports=s.p+"assets/glb/BaseHeight_01_24316b9e457f68a36759a4c54c76c4a3.glb"},function(t,e,s){t.exports=s.p+"assets/glb/BaseHeight_02_6d5e47d94c09e8c9e1de01692f018c31.glb"},function(t,e,s){t.exports=s.p+"assets/glb/BaseHeight_03_ac5873a7e20be74fa7e73aabf657775a.glb"},function(t,e,s){t.exports=s.p+"assets/glb/BaseHeight_04_c995a9b2bd74aec968b8a3eefec71f4f.glb"},function(t,e,s){t.exports=s.p+"assets/glb/baseBlocks_22defdf301ea0b7c5c5c5c268648b808.glb"},function(t,e,s){t.exports=s.p+"assets/glb/char_53191a878058e3427414c836bd6e45f3.glb"},function(t,e,s){t.exports=s.p+"assets/glb/dropShadow_4e0c8f20b09d78447eb87776b1e33182.glb"},function(t,e,s){t.exports=s.p+"assets/glb/finishPlane_56a2032680cf06ed43682f2a77e232fc.glb"},function(t,e,s){t.exports=s.p+"assets/glb/parkourElements_4be8f44b5cbe1d7e726ee1ef2a7c61bb.glb"},function(t,e,s){t.exports=s.p+"assets/glb/pigeon_01_7092f3d144d2c34f0fbeaabddd7ce159.glb"},function(t,e,s){t.exports=s.p+"assets/glb/trail_96e394537721a2dc39bd743ed23ec61e.glb"},function(t,e,s){t.exports=s.p+"assets/image/base_984a015d574d7eb35a8bd53cf14e3851.jpg"},function(t,e,s){t.exports=s.p+"assets/image/base_c443e2af4181ed04ac799dec6c6f7e09.webp"},function(t,e,s){t.exports=s.p+"assets/image/char_01_ed6b5cf242188d41e535f428a130f743.png"},function(t,e,s){t.exports=s.p+"assets/image/char_01_5472bed53e06eecb309226d316d6d06e.webp"},function(t,e,s){t.exports=s.p+"assets/image/default_3342a90e9e4095f8c01600af221609b5.png"},function(t,e,s){t.exports=s.p+"assets/image/default_c1c4f83736fb6b16a2e77d23bd56a771.webp"},function(t,e,s){t.exports=s.p+"assets/image/dropShadow_9dc782ed6c387a3e202aa3da9a80cfe6.png"},function(t,e,s){t.exports=s.p+"assets/image/dropShadow_ca510488b648802b46fbc9cb5aec87f9.webp"},function(t,e,s){t.exports=s.p+"assets/image/greybox_816d381af9b9183eb33a52658b38996f.jpg"},function(t,e,s){t.exports=s.p+"assets/image/greybox_8217274737cc969c012ef4e902bde9e9.webp"},function(t,e,s){t.exports=s.p+"assets/image/loading_9b41793b97fc9e6701282a2be985b372.png"},function(t,e,s){t.exports=s.p+"assets/image/loading_5d6545180f298d52489e0de2671b58b4.webp"},function(t,e,s){t.exports=s.p+"assets/image/loadingBG_9b41793b97fc9e6701282a2be985b372.png"},function(t,e,s){t.exports=s.p+"assets/image/loadingBG_5d6545180f298d52489e0de2671b58b4.webp"},function(t,e,s){t.exports=s.p+"assets/image/parkour_elements_82537b46085d062473b0e42ebf05c28a.png"},function(t,e,s){t.exports=s.p+"assets/image/parkour_elements_bf37e04700937766732e4af8e019f3b6.webp"},function(t,e,s){t.exports=s.p+"assets/image/pigeon_01_37d78f420efe4eacd9d3459f39d11eaf.png"},function(t,e,s){t.exports=s.p+"assets/image/pigeon_01_148b107d3e75aa9250cdf27e4e6d5be8.webp"},function(t,e,s){t.exports=s.p+"assets/image/skybox_tex_e8f40ed6e9d4577937d3dc30eeb43728.png"},function(t,e,s){t.exports=s.p+"assets/image/skybox_tex_3d849ef4b357408bdddfd03111770c4b.webp"},function(t,e,s){t.exports=s.p+"assets/image/start_d72e0038712d2c5660d99221a35b8500.jpg"},function(t,e,s){t.exports=s.p+"assets/image/start_b8e85236d43897f9219c079b20776f9e.webp"},function(t,e,s){t.exports=s.p+"assets/image/trail_5afe76b388e95ebbf4e30c9792fda239.png"},function(t,e,s){t.exports=s.p+"assets/image/trail_6038567da0553d0054ab00878752ca11.webp"},function(t,e,s){t.exports=s.p+"assets/locale/de-DE_52fb685a6dfec0b0229fe6ff9b0cf5d2.csv"},function(t,e,s){t.exports=s.p+"assets/locale/en-US_a0e56b2183fab72c7441e865c32eb4d0.csv"},function(t,e,s){t.exports=s.p+"assets/locale/es-ES_e045773efc19909aed81aba9c28c5e73.csv"},function(t,e,s){t.exports=s.p+"assets/locale/fr-FR_52fb685a6dfec0b0229fe6ff9b0cf5d2.csv"},function(t,e,s){t.exports=s.p+"assets/locale/pt-BR_52fb685a6dfec0b0229fe6ff9b0cf5d2.csv"},function(t,e,s){t.exports=s.p+"assets/shader/animatedSkinned.fragment_bb6d1f1fead1de8c8e6256b10d778e82.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/animatedSkinned.vertex_d0128cc69f0858d6843971e01cb5b109.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/indicator_01.fragment_2758816db665e77ae1c8d9c4b56a75db.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/indicator_01.vertex_77ee6b7c607b5688988ed7cf5b771d43.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/toonChar.fragment_89eaf24c950cf777987421bdda0257e2.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/toonChar.vertex_21b1a5d21fd4e637e7a291505146fb91.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/toonEnv.fragment_fe1cdfbe768955d7918b5648b39b58e1.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/toonEnv.vertex_2a18b8761faaee9a2f41979316dc5327.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/trail.fragment_20fc597583048960e6e5e7e56b108b51.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/trail.vertex_785df10d6357b5eda24ba843e61c79d7.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/vv.fragment_a67e89b533219c2bfb315eef62d7a276.glsl"},function(t,e,s){t.exports=s.p+"assets/shader/vv.vertex_a4debdde674541008d4d9dac6bf46047.glsl"},function(t,e,s){t.exports=s.p+"assets/snd/bigjump_c57e8e4a99509ec534f2c2274c4e5325.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/bigjump_73d49e7c63022c2b94d2418e0461379c.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/boost_c23f1fadb6afc487cb8cc98ffdd32696.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/boost_0a42e8f818b72888c0a7172b5326f765.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/button_4a1a3c8be3e1088f310171d0d46b70cf.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/button_b7f0a62f1a27b4ca95261b5f91e69666.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/climb_a349f1fc7350cab618efb3e65ad62086.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/climb_12e97ac183d089c2220a85aac324db06.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/countdown_6e5047bafab06e34636f233d9ff9defa.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/countdown_0fcecb498fc1b97e8fd3639fbd6d0894.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/finish_4026f0bcf76e30cd3216b4553a847213.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/finish_27beca4f132df7d5364f370089b36def.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/landing_c6d09e80559873b5379eea0165de85d2.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/landing_06c34644afd1240461c875b213af5d6a.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/menumusic_271d168fe22fa02fa50567605dc74819.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/menumusic_a195b6404135f529aa93222dd486c9fd.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/music_c42fb7c605f82292d4352bdd21a93085.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/music_eb289a89800bc9abcd82178c7159d6ba.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/roll_7b8c5765ab9b7188635f8f4e57ba0837.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/roll_fa28d1f502df9fd7243a0464c8d44cc8.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/run_5ab36e785061c63a19154849ba87b741.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/run_321b48216cb7df5487334e5b9c4714f5.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/score_dcc7052874c74eca991142864423aca1.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/score_6ae2785bf1987548aa5baabe67865abb.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/smalljump_5a36ad2ec58271e23e6d12237221be1f.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/smalljump_a5dc25c115543cda0187a938025db835.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/star_d256409b079244baac1b3cd2ef7d5e7f.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/star_11f754cbb319aeaa68adc7410e5c6779.ogg"},function(t,e,s){t.exports=s.p+"assets/snd/zipline_1c844239d97ba09254d923841f128f2c.m4a"},function(t,e,s){t.exports=s.p+"assets/snd/zipline_11c4008a90c1aee87460df253fbc0755.ogg"},,,,function(t,e){var s={Project:"1.0.0",SheepCore:"2.1.13",SheepUi:"2.2.2",Lambda:"1.2.2"};"fsVersion"in window?Phaser.Utils.mixin(s,window.fsVersion):window.fsVersion=s},function(t,e){var s=()=>{console.error("Not implemented. Ask your friendly neighborhood developer to implement it.")};window.fsToggleMusic=s,window.fsToggleUI=s},function(t,e,s){s.r(e);var i=s(209),a=s(33),n=s(12),o=s(205),r=s(0);class l{constructor(t){this.game=t,this.materials=[],this._createMaterials()}getMaterial(t,e=!1){if(!this.materials[t])return console.error("missing material",t),null;if(e){var s=this.materials[t],i=s.clone();for(var a in s.uniforms)s.uniforms[a].value.image&&(i.uniforms[a].value=s.uniforms[a].value);return i}return this.materials[t]}addMaterial(t,e){this.materials[t.name]&&!e||(this.materials[t.name]=t)}isMaterialAvailable(t){return!!this.materials[t]}_createMaterials(){this.materials.boundingBox=new r.X({transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1})}}class h{constructor(t){this.game=t,this.BG_MUSIC_KEYS=["music_menu","music_game"],this.sfx=[],window.fsToggleMusic=()=>{for(var t=0;t<this.BG_MUSIC_KEYS.length;t++){var e=this.getSound(this.BG_MUSIC_KEYS[t]);e.isMuted?(e.isMuted=!1,e.mute=!1):(e.isMuted=!0,e.mute=!0)}}}getSound(t,e=1){return this.sfx[t]||(this.sfx[t]=this.game.add.audio(t,e),this.sfx[t].defaultVolume=e),this.sfx[t]}destroy(t){this.sfx[t]&&(this.sfx[t].destroy(),this.sfx[t]=null)}}class c extends a.a.State.Base{constructor(){super(),this.nextState=null,this.nextStateParams=[]}init(t,e,...s){super.init(...s),this.nextState=t,this.nextStateParams=e}create(){super.create();var t=this.game.cache.getJSON("config");this.game.toggoApi=new o.a(t.toggoKey,t.midRollFirstDelay,t.midRollInterval),this.game.materialCache=new l(this.game),this.game.soundManager=new h(this.game),this.game.onPause.add(()=>{this.game.lockRender=!0,this.game.sound.pauseAll()}),this.game.onResume.add(()=>{this.game.lockRender=!1,this.game.sound.resumeAll()}),this.game.cache.checkLayoutKey("layout_preload")&&(this.game.preloadLayout=new n.a.Layout(this.game,this.game.cache.getLayout("layout_preload"))),document.body.classList.remove("loading");var e=[this.nextState,!0,!1].concat(this.nextStateParams);this.game.state.start(...e)}}class d extends a.a.State.Base{preload(){super.preload(),this.txtProgress=this.game.preloadLayout.getElementById("varTextLoading"),this.lblLoadingSprite=this.game.preloadLayout.getElementById("labelLoadingElement"),this.game.localizer.initGroup(this.game.preloadLayout)}loadUpdate(...t){super.loadUpdate(...t),this.txtProgress.setText("".concat(this.game.load.progress,"%")),this.lblLoadingSprite.rotation+=50*this.game.time.physicsElapsed}}class p{static getRandomExistsFromGroup(t,e=!0){var s=t.getAll("exists",e,0,t.children.length);return s[this.getRndIntInRange(0,s.length-1)]}static getFirstExists(t,e){for(var s=0;s<t.length;s++)if(t[s].exists===e)return t[s];return null}static createOverlay(t,e=0,s=.5,i=!0){var a=t.add.graphics(0,0);return a.name="overlay_".concat(Date.now()),a.beginFill(e),a.drawRect(0,0,t.width,t.height),a.endFill(),a.alpha=s,a.inputEnabled=i,a}static getRndIntInRange(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static addIntroTweenShui(t,e,s,i,a=700,n=Phaser.Easing.Back.Out,o=0){e.defaultPosition=e.shui.position.clone();var r=i?-1:1;return s?e.shui.position.y+=r*e.height*3:s||(e.shui.position.x+=r*e.width*3),t.add.tween(e.shui.position).to({x:e.defaultPosition.x,y:e.defaultPosition.y},a,n,!0,o,0,!1)}static addIntroTween(t,e,s,i,a=500,n=Phaser.Easing.Back.Out,o=0){e.defaultPosition=e.position.clone();var r=i?-1:1;return s?e.position.y+=r*e.height*3:s||(e.position.x+=r*e.width*3),t.add.tween(e.position).to({x:e.defaultPosition.x,y:e.defaultPosition.y},a,n,!0,o,0,!1)}}var u=s(18),m=s(56),g=s(3);class f{constructor(t){this.game=t,this.routines=[]}update(t){for(var e=0;e<this.routines.length;e++)if(this.routines[e].time-=t,this.routines[e].time<=0){this.routines[e].f(),this.routines.splice(e,1);break}}executeAfterTime(t,e){this.routines.push({time:t,f:e})}}var b=s(2),y=s(4);class x{constructor(t,e,s,i,a,n,o,l){this.game=t,this.player=e,this.stateMachine=s,this.playerPhysics=i,this.playerInput=a,this.playerAnimation=n,this.cameraController=o,this.particleManager3d=l,this.States=this.stateMachine.States,this.Interactables=g.InteractableObjects,this.setState=this.stateMachine.setState.bind(this.stateMachine),this.playerObject3d=this.stateMachine.playerObject3d,this.collisionTypes=[],this.maxSpeed=new r.Ob(0,0,0),this.acceleration=new r.Ob(0,0,0),this.buildingFaces=new r.Pb}update(){this._updatePhysicsValues()}enter(){this._updatePhysicsValues()}exit(){}_updatePhysicsValues(){this.acceleration=this.stateMachine.acceleration,this.maxSpeed=this.stateMachine.maxSpeed,this.collisionTypes=this.stateMachine.collisionTypes,this.buildingFaces=this.stateMachine.buildingFaces}}class _ extends x{enter(){super.enter(),this.collisionTypes.includes(b.CollisionTypes.LEFT)?(this.playerPhysics.setPlayerPosition(this.buildingFaces.w,this.playerObject3d.position.y,this.playerObject3d.position.z),this.cameraController.setMode(y.Modes.WALL_RUN_LEFT),this.playerAnimation.play(this.playerAnimation.Animations.WALL_RUN_LEFT,.25)):this.collisionTypes.includes(b.CollisionTypes.RIGHT)&&(this.playerPhysics.setPlayerPosition(this.buildingFaces.x,this.playerObject3d.position.y,this.playerObject3d.position.z),this.cameraController.setMode(y.Modes.WALL_RUN_RIGHT),this.playerAnimation.play(this.playerAnimation.Animations.WALL_RUN_RIGHT,.25)),this.playerPhysics.resetForce(!1,!0,!1)}update(t){super.update(),this.playerPhysics.updateMovementZ(t,this.acceleration.z,this.maxSpeed.z,g.DECELERATION_Z),this.playerPhysics.updateMovementY(t,g.GRAVITY_WALL_RUN,g.MIN_FALL_SPEED,Number.MAX_VALUE),this.collisionTypes.includes(b.CollisionTypes.LEFT)&&this.playerInput.getInputVectorX()>0?(this.playerPhysics.jump(g.WALL_RUN_JUMP_FORCE),this.playerPhysics.updateMovementX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION,g.WALL_RUN_STRAFE_SPEED),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.FALL,transition:.25,timeScale:1,playOnce:!1}]),this.setState(this.States.FALL)):this.collisionTypes.includes(b.CollisionTypes.RIGHT)&&this.playerInput.getInputVectorX()<0&&(this.playerPhysics.jump(g.WALL_RUN_JUMP_FORCE),this.playerPhysics.updateMovementX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION,g.WALL_RUN_JUMP_FORCE),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.FALL,transition:.25,timeScale:1,playOnce:!1}]),this.setState(this.States.FALL)),this.collisionTypes.includes(b.CollisionTypes.LEFT)||this.collisionTypes.includes(b.CollisionTypes.RIGHT)?this.collisionTypes.includes(b.CollisionTypes.UP)&&this.setState(this.States.RUN):(this.playerPhysics.jump(g.WALL_RUN_JUMP_FORCE),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.FALL,transition:.25,timeScale:1,playOnce:!1}]),this.setState(this.States.FALL))}exit(){super.exit(),this.cameraController.setMode(y.Modes.DEFAULT)}}class v{static getIndexViaJson(t){for(var e=0;e<Object.keys(this.Effects.properties).length;e++)if(this.Effects.properties[e].json===t)return e;return null}}v.Effects={LAND:0,RUN:1,SLIDE:2,WIN:3,GLOW:4,LEAF_1:5,LEAF_2:6,LEAF_3:7,LEAF_4:8,properties:{0:{json:"fx_land",texture:"tex_dust",pool:1,ttl:3},1:{json:"fx_run",texture:"tex_dust",pool:1,ttl:-1},2:{json:"fx_slide",texture:"tex_dust",pool:1,ttl:-1},3:{json:"fx_win",texture:"tex_star",pool:1,ttl:-1},4:{json:"fx_glow",texture:"tex_dust",pool:50,ttl:-1},5:{json:"fx_leaf",texture:"tex_leaf_1",pool:1,ttl:-1},6:{json:"fx_leaf",texture:"tex_leaf_2",pool:1,ttl:-1},7:{json:"fx_leaf",texture:"tex_leaf_3",pool:1,ttl:-1},8:{json:"fx_leaf",texture:"tex_leaf_4",pool:1,ttl:-1}}};class S extends x{constructor(t,e,s,i,a,n,o,r){super(t,e,s,i,a,n,o,r),this.fxLand=this.particleManager3d.getParticleEffect(v.Effects.LAND),this.fxRun=this.particleManager3d.getParticleEffect(v.Effects.RUN),this.fxSlide=this.particleManager3d.getParticleEffect(v.Effects.SLIDE),this.sndLand=this.game.soundManager.getSound("land"),this.sndRun=this.game.soundManager.getSound("run"),this.sndRun.loop=!0,this.sndRoll=this.game.soundManager.getSound("roll")}enter(){super.enter(),this.cameraController.setMode(y.Modes.RUN),this.stateMachine.states[this.States.FALL].getAirTime()>=g.ROLL_ANIM_AIR_TIME?(this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.ROLL,transition:0,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.RUN,transition:.2,timeScale:1,playOnce:!1}]),this.sndRoll.play()):this.playerAnimation.play(this.playerAnimation.Animations.RUN,.25,this.computeRunAnimTimeScale()),this.player.shadow.visible=!0,this.fxLand.position.copy(this.playerObject3d.position),this.particleManager3d.playOnce(this.fxLand),this.particleManager3d.play(this.fxRun),this.sndLand.play(),this.sndRun.play()}update(t){if(super.update(),!this.collisionTypes.includes(b.CollisionTypes.UP))return this.playerPhysics.jump(g.AUTO_JUMP_FORCE),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.FALL,transition:.25,timeScale:1,playOnce:!1}]),void this.setState(this.States.FALL);this.playerPhysics.updateMovementZ(t,this.acceleration.z,this.maxSpeed.z,g.DECELERATION_Z);var e=this.playerInput.getInputVectorX();(!this.collisionTypes.includes(b.CollisionTypes.RIGHT)&&!this.collisionTypes.includes(b.CollisionTypes.LEFT)||e>0&&!this.collisionTypes.includes(b.CollisionTypes.RIGHT)||e<0&&!this.collisionTypes.includes(b.CollisionTypes.LEFT))&&this.playerPhysics.updateMovementX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION,g.RUN_STRAFE_SPEED),this.playerPhysics.setPlayerPosition(this.playerObject3d.position.x,this.buildingFaces.y,this.playerObject3d.position.z),this.playerPhysics.updateLeanX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION),this.collisionTypes.includes(b.CollisionTypes.FORWARD)&&this.setState(this.States.CLIMB),this.playerAnimation.setTimeScale(this.computeRunAnimTimeScale()),this.fxRun.position.copy(this.playerObject3d.position),this.fxSlide.position.copy(this.playerObject3d.position)}exit(){super.exit(),this.cameraController.setMode(y.Modes.DEFAULT),this.player.shadow.visible=!1,this.fxRun.visible=!1,this.sndRun.stop()}setSlideActive(t){this.stateMachine.currentState===this.States.RUN&&(t?(this.cameraController.setMode(y.Modes.SLIDE),this.fxRun.visible=!1,this.particleManager3d.play(this.fxSlide)):(this.cameraController.setMode(y.Modes.DEFAULT),this.fxSlide.visible=!1,this.particleManager3d.play(this.fxRun)))}setBoostActive(t){t?this.cameraController.setMode(y.Modes.RUN_BOOST):t||this.stateMachine.currentState!==this.States.RUN||this.cameraController.setMode(y.Modes.RUN)}computeRunAnimTimeScale(){return Math.max(.1,this.playerPhysics.currentSpeed.z/g.MAX_SPEED_Z)}}class I extends x{constructor(t,e,s,i,a,n,o,r){super(t,e,s,i,a,n,o,r),this.airTime=0}enter(){super.enter(),this.airTime=0}update(t){super.update(),this.playerPhysics.updateMovementZ(t,this.acceleration.z,this.maxSpeed.z,g.DECELERATION_Z),this.playerPhysics.updateMovementY(t,g.GRAVITY_DEFAULT,g.MIN_FALL_SPEED,Number.MAX_VALUE),this.playerPhysics.updateMovementX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION,g.IN_AIR_STRAFE_SPEED),this.collisionTypes.includes(b.CollisionTypes.UP)?this.setState(this.States.RUN):this.collisionTypes.includes(b.CollisionTypes.FORWARD)?this.setState(this.States.CLIMB):(this.collisionTypes.includes(b.CollisionTypes.LEFT)||this.collisionTypes.includes(b.CollisionTypes.RIGHT))&&this.setState(this.States.WALL_RUN),this.playerObject3d.position.y<g.DEATH_POSITION_Y&&this.setState(this.States.DEATH),this.airTime+=t}getAirTime(){return this.airTime}}class L extends x{constructor(t,e,s,i,a,n,o,r){super(t,e,s,i,a,n,o,r),this.sndClimb=this.game.soundManager.getSound("climb"),this.sndClimb.loop=!0,this.climbSpeed=0}enter(){super.enter(),this.playerPhysics.resetForce(!1,!0,!1),this.playerPhysics.setPlayerPosition(this.playerObject3d.position.x,this.playerObject3d.position.y,this.buildingFaces.z),this.climbSpeed=g.CLIMB_SPEED.max,this.cameraController.setMode(y.Modes.CLIMB),this.playerAnimation.play(this.playerAnimation.Animations.CLIMB,0),this.sndClimb.play()}update(t){super.update(),this.climbSpeed=r.S.lerp(this.climbSpeed,g.CLIMB_SPEED.min,t*g.CLIMB_ACCELERATION),this.playerPhysics.updateMovementY(t,g.CLIMB_FORCE,0,this.climbSpeed),this.playerPhysics.updateMovementX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION,g.CLIMB_STRAFE_SPEED),this.collisionTypes.includes(b.CollisionTypes.UP)?this.setState(this.States.RUN):this.collisionTypes.includes(b.CollisionTypes.FORWARD)||(this.setState(this.States.FALL),this.playerAnimation.play(this.playerAnimation.Animations.FALL,.5))}exit(){super.exit(),this.cameraController.setMode(y.Modes.DEFAULT),this.sndClimb.stop()}}class E{constructor(t,e,s,i,a){this.game=t,this.stateMachine=e,this.playerPhysics=s,this.playerAnimation=i,this.interactablesController=a,this.States=this.stateMachine.States,this.Interactables=g.InteractableObjects,this.playerObject3d=this.stateMachine.playerObject3d,this.setState=this.stateMachine.setState.bind(this.stateMachine),this._boostSpeedZForTime=this.stateMachine._boostSpeedZForTime.bind(this.stateMachine),this.observers=[],this.sndBoost=this.game.soundManager.getSound("boost"),this.sndTrampolineSmall=this.game.soundManager.getSound("trampoline_small"),this.sndTrampolineBig=this.game.soundManager.getSound("trampoline_big")}updateDetectionRoutine(){var t=this.interactablesController.isPointInTriggerDistance(this.playerObject3d.position);if(null===t)return null;var e=t.index,s=this.Interactables.properties[e];switch(e){case g.InteractableObjects.JUMP_OVER:this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP_OVER,transition:.25,timeScale:2,playOnce:!0},{animation:this.playerAnimation.Animations.RUN,transition:.25,timeScale:1,playOnce:!1}]),this._boostSpeedZForTime(s),this.sndBoost.play();break;case g.InteractableObjects.SLIDE_UNDER:this.stateMachine.states[this.States.RUN].setSlideActive(!0),this._boostSpeedZForTime(s),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.SLIDE,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.RUN,transition:.25,timeScale:1,playOnce:!1}]),this.stateMachine.coroutineUtil.executeAfterTime(this.playerAnimation.Animations.properties[this.playerAnimation.Animations.SLIDE].duration,()=>{this.stateMachine.states[this.States.RUN].setSlideActive(!1)}),this.sndBoost.play();break;case g.InteractableObjects.ZIP_LINE:t.getWorldPosition(this.playerObject3d.position),t.zipEndPosition=new r.Ob,t.endObj.getWorldPosition(t.zipEndPosition),this.playerObject3d.position.add(this.Interactables.properties[this.Interactables.ZIP_LINE].offset),t.triggerDistance=this.Interactables.properties[this.Interactables.ZIP_LINE].triggerDistance,this.stateMachine.interactable=t,this.setState(this.States.ZIP_LINE);break;case g.InteractableObjects.BOOST_RUN:this._boostSpeedZForTime(s),this.stateMachine.states[this.States.RUN].setBoostActive(!0),this.stateMachine.coroutineUtil.executeAfterTime(s.duration,()=>{this.stateMachine.states[this.States.RUN].setBoostActive(!1)}),this.sndBoost.play();break;case g.InteractableObjects.TRAMPOLINE:this.playerPhysics.jump(s.forceY),this._boostSpeedZForTime(s),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.SALTO,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.FALL,transition:.25,timeScale:1,playOnce:!1}]),this.setState(this.States.FALL),this.sndTrampolineBig.play();break;case g.InteractableObjects.TRAMPOLINE_SMALL:this.playerPhysics.jump(s.forceY),this._boostSpeedZForTime(s),this.playerAnimation.playChain([{animation:this.playerAnimation.Animations.JUMP,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.SALTO,transition:.25,timeScale:1,playOnce:!0},{animation:this.playerAnimation.Animations.FALL,transition:.25,timeScale:1,playOnce:!1}]),this.setState(this.States.FALL),this.sndTrampolineSmall.play();break;case g.InteractableObjects.BOOST_WALL_RUN:this.playerPhysics.jump(s.forceY),this._boostSpeedZForTime(s),this.sndBoost.play()}return this._fireObservers(t),t}addCollisionObserver(t,e){this.observers.push(t.bind(e))}_fireObservers(t){for(var e=0;e<this.observers.length;e++)this.observers[e](t)}}class T extends x{constructor(t,e,s,i,a,n,o,l){super(t,e,s,i,a,n,o,l),this.zipVector=new r.Ob,this.interactable=null,this.sndZipline=this.game.soundManager.getSound("zipline"),this.sndZipline.loop=!0}enter(){super.enter(),this.interactable=this.stateMachine.interactable,this.cameraController.setZipLineMode(this.interactable),this.playerAnimation.play(this.playerAnimation.Animations.ZIP_LINE,.5),this.sndZipline.play()}update(t){super.update(),this.interactable=this.stateMachine.interactable,this.zipVector.copy(this.interactable.direction),this.zipVector.multiplyScalar(t*this.Interactables.properties[this.Interactables.ZIP_LINE].speed),this.playerObject3d.position.add(this.zipVector),this.interactable.zipEndPosition.distanceTo(this.playerObject3d.position)<this.interactable.triggerDistance&&(this.interactable=null,this.setState(this.States.FALL),this.playerAnimation.play(this.playerAnimation.Animations.FALL,.25))}exit(){super.exit(),this.cameraController.setMode(y.Modes.DEFAULT),this.sndZipline.stop()}}class C extends x{enter(){super.enter(),this.playerAnimation.play(this.playerAnimation.Animations.IDLE),this.player.shadow.visible=!0}}class O extends x{enter(){super.enter(),this.cameraController.setMode(y.Modes.DEATH)}update(t){super.update(),this.playerPhysics.updateMovementY(t,g.GRAVITY_DEFAULT,g.MIN_FALL_SPEED,Number.MAX_VALUE)}}class A extends x{constructor(t,e,s,i,a,n,o,r){super(t,e,s,i,a,n,o,r),this.fxWin=this.particleManager3d.getParticleEffect(v.Effects.WIN)}enter(){super.enter(),this.player.setSlowMotionActive(!0),this.cameraController.setMode(y.Modes.WON),this.particleManager3d.play(this.fxWin)}update(t){super.update(),this.playerPhysics.updateMovementZ(t,this.acceleration.z,this.maxSpeed.z,g.DECELERATION_Z),this.fxWin.position.copy(this.playerObject3d.position)}}class M{constructor(t,e,s,i,a,n,o,l){this.game=t,this.player=e,this.playerPhysics=s,this.playerAnimation=i,this.playerInput=a,this.levelController=n,this.cameraController=o,this.particleManager3d=l,this.States={NULL:0,IDLE:1,RUN:2,FALL:3,CLIMB:4,WALL_RUN:5,ZIP_LINE:6,DEATH:7,WON:8,properties:{0:{Class:null},1:{Class:C},2:{Class:S},3:{Class:I},4:{Class:L},5:{Class:_},6:{Class:T},7:{Class:O},8:{Class:A}}},this.physicsController=this.levelController.physicsController,this.interactablesController=this.levelController.interactableObjectController,this.playerObject3d=this.player.playerObject3d,this.coroutineUtil=new f(this.game),this.interactableCollisionDetection=new E(this.game,this,this.playerPhysics,this.playerAnimation,this.interactablesController),this.maxSpeed=new r.Ob(0,0,g.MAX_SPEED_Z),this.acceleration=new r.Ob(0,0,g.ACCELERATION_Z),this.buildingFaces=new r.Pb,this.collisionTypes=[],this.states=[];for(var h=0;h<Object.keys(this.States.properties).length;h++)null!==this.States.properties[h].Class&&(this.states[h]=new this.States.properties[h].Class(this.game,this.player,this,this.playerPhysics,this.playerInput,this.playerAnimation,this.cameraController,this.particleManager3d));this.currentState=this.States.NULL,this.setState(this.States.IDLE)}launch(){this.setState(this.States.FALL)}update(t){this.coroutineUtil.update(t),this._updateRoutine(t)}isInDeathState(){return this.currentState===this.States.DEATH}isInWonState(){return this.currentState===this.States.WON}_updateRoutine(t){this.currentState!==this.States.WON&&this.playerObject3d.position.z>=this.player.levelEndPosition.z&&this.setState(this.States.WON);var e=this.interactableCollisionDetection.updateDetectionRoutine();null!==e&&(this.interactable=e);var s=this.physicsController.getCollidedBuildingFaces(this.playerObject3d.position),i=this.physicsController.getCollisionTypes(this.playerObject3d.position,s);this.collisionTypes=i.collisionTypes,this.buildingFaces.copy(i.collisionPositions),this.playerPhysics.updateLeanX(t,0,g.STRAFE_ACCELERATION),this.states[this.currentState].update(t)}_boostSpeedZForTime(t){this.maxSpeed.z=t.maxSpeed,this.acceleration.z=t.acceleration,this.coroutineUtil.executeAfterTime(t.duration,()=>{this.maxSpeed.z=g.MAX_SPEED_Z,this.acceleration.z=g.ACCELERATION_Z})}setState(t){null!==this.States.properties[this.currentState].Class&&this.states[this.currentState].exit(),this.currentState=t,null!==this.States.properties[this.currentState].Class&&this.states[this.currentState].enter()}}class w{constructor(t,e){this.game=t,this.player=e,this.playerObject3d=e.playerObject3d,this.currentSpeed=new r.Ob}setPlayerPosition(t,e,s){this.playerObject3d.position.set(t,e,s)}addForce(t,e,s){this.currentSpeed.x+=t,this.currentSpeed.y+=e,this.currentSpeed.z+=s}resetForce(t,e,s){t&&(this.currentSpeed.x=0),e&&(this.currentSpeed.y=0),s&&(this.currentSpeed.z=0)}updateLeanX(t,e,s){this.playerObject3d.rotation.y=r.S.lerp(this.playerObject3d.rotation.y,-e*g.LEAN_MAX,t*s),this.playerObject3d.rotation.z=r.S.lerp(this.playerObject3d.rotation.z,e*g.LEAN_MAX,t*s)}updateMovementX(t,e,s,i){this.addForce(s*t,0,0),this.currentSpeed.x>i&&this.addForce(-Math.abs(s*t),0,0),this.playerObject3d.position.x-=e*this.currentSpeed.x*t}updateMovementY(t,e,s,i){this.addForce(0,e*t,0),this.currentSpeed.y<s?this.addForce(0,Math.abs(e*t),0):this.currentSpeed>i&&this.addForce(0,-Math.abs(e*t),0),this.playerObject3d.position.y+=this.currentSpeed.y*t}updateMovementZ(t,e,s,i){this.currentSpeed.z<s?this.addForce(0,0,e*t):this.currentSpeed.z>s&&this.addForce(0,0,-i*t),this.playerObject3d.position.z+=this.currentSpeed.z*t}jump(t){this.resetForce(!1,!0,!1),this.addForce(0,t,0),this.playerObject3d.position.y+=.02}}class P{constructor(t,e){this.game=t,this.charMesh=e,this.Animations={REST:0,RUN:1,CLIMB:2,FALL:3,IDLE:4,JUMP_OVER:5,JUMP:6,SLIDE:7,WALL_RUN_LEFT:8,WALL_RUN_RIGHT:9,ZIP_LINE:10,ROLL:11,SALTO:12,properties:{0:{key:"rest",duration:0},1:{key:"run",duration:0},2:{key:"climb",duration:0},3:{key:"fall",duration:0},4:{key:"idle",duration:0},5:{key:"hedgeJump",duration:0},6:{key:"jumpUp",duration:0},7:{key:"slide",duration:0},8:{key:"wallRun_left",duration:0},9:{key:"wallRun_right",duration:0},10:{key:"zipLine",duration:0},11:{key:"roll",duration:0},12:{key:"salto",duration:0}}},this.animChainList=[],this.playNextAnimInChainSignature=this._playNextAnimInChain.bind(this),this.currentAnimation=this.Animations.REST,this.charMixer=e.mixer,this._getAnimationInfo()}update(t){this.charMixer.update(t)}setTimeScale(t){this.charMixer.timeScale=t}play(t,e=0,s=1,i=!1){this.animChainList=[],this.charMixer.removeEventListener("finished",this.playNextAnimInChainSignature),this._play(t,e,s,i)}_play(t,e=0,s=1,i=!1){if(t!==this.currentAnimation){this.charMixer.stopAllAction();var a,n=this.Animations.properties[t].key;if(this.charMixer.timeScale=s,null===this.currentAnimation||e<=0)(a=this.charMixer.clipAction(n)).reset().setEffectiveWeight(1).play();else{var o=this.Animations.properties[this.currentAnimation].key,l=this.charMixer.clipAction(o);(a=this.charMixer.clipAction(n)).reset().play(),l.crossFadeTo(a,e,!1)}i&&(a.clampWhenFinished=!0,a.loop=r.P),this.currentAnimation=t}}playChain(t){this.animChainList=t,this.charMixer.addEventListener("finished",this.playNextAnimInChainSignature),this._playNextAnimInChain()}_playNextAnimInChain(){var t=this.animChainList.shift();this._play(t.animation,t.transition,t.timeScale,t.playOnce),this.animChainList.length<=0&&this.charMixer.removeEventListener("finished",this.playNextAnimInChainSignature)}_getAnimationInfo(){for(var t=0;t<Object.keys(this.Animations.properties).length;t++)for(var e=0;e<this.charMesh.animations.length;e++){var s=this.charMesh.animations[e];if(s.name===this.Animations.properties[t].key){this.Animations.properties[t].duration=s.duration;break}}}}class R{constructor(t,e,s,i,a,n){this.game=t,this.playerInput=e,this.scene=s,this.levelController=i,this.cameraController=a,this.particleManager3d=n,this.previousPosition=new r.Ob,this._createMesh(),this.bSlowMotion=!1,this.slowMotionMultiplier=1,this.levelEndPosition=new r.Ob,this.levelController.getLevelEndPosition(this.levelEndPosition),this.playerAniamtion=new P(this.game,this.charMesh),this.playerPhysics=new w(this.game,this),this.stateMachine=new M(this.game,this,this.playerPhysics,this.playerAniamtion,this.playerInput,this.levelController,this.cameraController,this.particleManager3d);var o=new u.a.Scene(this.game,this.game.cache.getLambdaScene("trail_scene"));o.setup(),this.trailObj=o.getObjectByName("trail_01"),this.trailObj.rotation.set(0,Math.PI,0),this.trailObj.position.y+=.5,this.trailObj.scale.x=.5,this.charParent.add(this.trailObj),this.resetStartPosition(),this.cameraController.setPlayerPosition(this.playerObject3d.position),this.setVisible(!1)}launch(){this.stateMachine.launch()}lerp(t,e,s){return t*(1-s)+e*s}update(t){this.bSlowMotion&&(this.slowMotionMultiplier>g.SLOW_MOTION_MULTIPLIER&&(this.slowMotionMultiplier-=t),t*=this.slowMotionMultiplier),this.updateTrail(t),this.cameraController.setPlayerPosition(this.playerObject3d.position),this.playerAniamtion.update(t),this.stateMachine.update(t),this.shadow.position.copy(this.playerObject3d.position)}updateTrail(t){var e=this.trailObj.material.uniforms,s=this.playerObject3d.position.x-this.previousPosition.x,i=this.playerObject3d.position.y-this.previousPosition.y,a=this.playerObject3d.position.z-this.previousPosition.z;this.previousPosition.copy(this.playerObject3d.position),e.speed.value=r.S.lerp(e.speed.value,15*a,7*t),e.angle.value=r.S.lerp(e.angle.value,3*s,7*t),e.angleY.value=r.S.lerp(e.angleY.value,3*i,7*t)}destroy(){this.charMesh=null,this.charParent=null,this.scene.remove(this.playerObject3d),this.playerObject3d=null,this.shadow.geometry.dispose(),this.shadow.material.dispose(),this.scene.remove(this.shadow),this.shadow=null}resetStartPosition(){this.levelController.getPlayerStartPosition(this.playerObject3d.position)}updatePlayerTutorialStrafe(t){this.playerObject3d.position.x=r.S.clamp(this.playerObject3d.position.x,-2,2),Math.abs(this.playerObject3d.position.x)<=2&&(this.playerPhysics.updateMovementX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION,g.RUN_STRAFE_SPEED/2),this.playerPhysics.updateLeanX(t,this.playerInput.getInputVectorX(),g.STRAFE_ACCELERATION))}getPosition(t){return t?(t.copy(this.playerObject3d.position),t):this.playerObject3d.position.clone()}setSlowMotionActive(t){this.slowMotionMultiplier=1,this.bSlowMotion=t}setVisible(t){this.playerObject3d.visible=t,this.shadow.visible=t}isVisible(){return this.playerObject3d.visible}_createMesh(){this.playerObject3d=new r.fb;var t=this.game.cache.getThreeGltf("char"),e=this.game.cache.getThreeGltf("char").scene.children[0],s=m.a.clone(e);this.charParent=new r.fb,this.charMesh=new u.a.SkinnedMesh(s,this.game.materialCache.getMaterial("player"),t.animations),this.charMesh.name="player",this.charParent.add(this.charMesh),this.playerObject3d.add(this.charParent),this.scene.add(this.playerObject3d),this.shadow=this.game.cache.getThreeGltf("shadow").scene.getObjectByName("dropShadow").clone(),this.shadow.material=this.game.materialCache.getMaterial("shadow"),this.scene.add(this.shadow),this.shadow.visible=!1}}class N{constructor(t){this.game=t,this.keyboardKeys=[],this.bKeyDown=[],this.lastPointerPosition=new Phaser.Point,this.pointerPosition=new Phaser.Point,this.dragOffset=new Phaser.Point,this.bInputDown=!1}init(){this._addListeners()}update(t){this.lastPointerPosition.copyFrom(this.pointerPosition),this.isInputDown()&&this._onInputMove(this.game.input)}_addListeners(){this.game.input.onUp.add(this._onInputUp,this),this.game.input.onDown.add(this._onInputDown,this)}_onInputUp(){this.bInputDown=!1}_onInputDown(t){this.bInputDown=!0,this.pointerPosition.copyFrom(t.position)}_onInputMove(t){this.pointerPosition.copyFrom(t.position)}isInputDown(){return this.bInputDown}getDragOffset(){return this.dragOffset.set(this.lastPointerPosition.x-this.pointerPosition.x,this.lastPointerPosition.y-this.pointerPosition.y)}getInputPosition(){return this.pointerPosition}addKeyboardEventListener(t){(this.game.device.desktop||this.game.device.ie)&&(this.keyboardKeys[t]=this.game.input.keyboard.addKey(t),this.keyboardKeys[t].onDown.addOnce(this._onKeyboardKeyDown,this),this.keyboardKeys[t].onUp.addOnce(this._onKeyboardKeyUp,this),this.bKeyDown[t]=!1)}addKeyboardKeyUpEvent(t,e){this.keyboardKeys[t]||this.addKeyboardEventListener(t),this.keyboardKeys[t].onUp.add(e,this)}addKeyboardKeyUpEventOnce(t,e){this.keyboardKeys[t]||this.addKeyboardEventListener(t),this.keyboardKeys[t].onUp.addOnce(e,this)}removeKeyboardKeyUpEvent(t,e){this.keyboardKeys[t]&&this.keyboardKeys[t].onUp.remove(e)}addKeyboardKeyDownEvent(t,e){this.keyboardKeys[t]||this.addKeyboardEventListener(t),this.keyboardKeys[t].onDown.add(e,this)}_onKeyboardKeyDown(t){this.bKeyDown[t.keyCode]=!0}_onKeyboardKeyUp(t){this.bKeyDown[t.keyCode]=!1}isKeyboardKeyDown(t){return this.bKeyDown[t]}}class U{constructor(t,e){this.game=t,this.gameInput=e,this.Inputs={LEFT:0,RIGHT:1,FORWARD:2,properties:{0:{keys:[Phaser.KeyCode.LEFT,Phaser.KeyCode.A]},1:{keys:[Phaser.KeyCode.RIGHT,Phaser.KeyCode.D]},2:{keys:[Phaser.KeyCode.UP]}}},this.inputVectorX=0,this.bInput=[]}init(){if(this.game.device.desktop){for(var t=0;t<this.Inputs.properties[this.Inputs.LEFT].keys.length;t++)this.gameInput.addKeyboardKeyDownEvent(this.Inputs.properties[this.Inputs.LEFT].keys[t],this._onLeftKeyDown.bind(this)),this.gameInput.addKeyboardKeyUpEvent(this.Inputs.properties[this.Inputs.LEFT].keys[t],this._onLeftKeyUp.bind(this));this.bInput[this.Inputs.LEFT]=!1;for(var e=0;e<this.Inputs.properties[this.Inputs.RIGHT].keys.length;e++)this.gameInput.addKeyboardKeyDownEvent(this.Inputs.properties[this.Inputs.RIGHT].keys[e],this._onRightKeyDown.bind(this)),this.gameInput.addKeyboardKeyUpEvent(this.Inputs.properties[this.Inputs.RIGHT].keys[e],this._onRightKeyUp.bind(this));if(this.bInput[this.Inputs.RIGHT]=!1,this.game.config.enableDebug)for(var s=0;s<this.Inputs.properties[this.Inputs.FORWARD].keys.length;s++)this.gameInput.addKeyboardKeyDownEvent(this.Inputs.properties[this.Inputs.FORWARD].keys[s],()=>{this.bInput[this.Inputs.FORWARD]=!0}),this.gameInput.addKeyboardKeyUpEvent(this.Inputs.properties[this.Inputs.FORWARD].keys[s],()=>{this.bInput[this.Inputs.FORWARD]=!1})}}getInputVectorX(){return this.inputVectorX=0,this.game.device.desktop?this.bInput[this.Inputs.LEFT]?this.inputVectorX=-1:this.bInput[this.Inputs.RIGHT]&&(this.inputVectorX=1):this.game.device.desktop||this.gameInput.isInputDown()&&(this.inputVectorX=(this.gameInput.getInputPosition().x-this.game.width/2)/(this.game.width/2),this.inputVectorX*=g.MOBILE_INPUT_SENSITIVITY),this.inputVectorX}_onLeftKeyDown(){this.bInput[this.Inputs.LEFT]=!0}_onLeftKeyUp(){this.bInput[this.Inputs.LEFT]=!1}_onRightKeyDown(){this.bInput[this.Inputs.RIGHT]=!0}_onRightKeyUp(){this.bInput[this.Inputs.RIGHT]=!1}}var j=s(207);class D{constructor(t,e){this.game=t,this.gameInput=e,this.currentMode=-1,this.properties=null,this.currentOffset=new r.Ob,this.currentOffset.copy(y.Modes.properties[y.Modes.DEFAULT].offset),this.setMode(y.Modes.DEFAULT),this._createCamera(),this.activeCamera=this.threeCamera,this.distance=0,this.time=-1,this.delay=0,this.playerPosition=new r.Ob,this.startPosition=new r.Ob,this.endPosition=new r.Ob,this.cameraDummy=new r.hb,this.leafFxCount=4,this.game.config.enableDebug&&this._createDebugCamera()}init(t,e){this.startPosition.copy(t),this.endPosition.copy(e),this.setMode(y.Modes.FLY_OVER)}update(t){if(this.currentOffset.lerp(this.properties.offset,t*this.properties.transitionSpeed),this.threeCamera.fov=r.S.lerp(this.threeCamera.fov,this.properties.fov,t*this.properties.transitionSpeed),this.threeCamera.updateProjectionMatrix(),this._updateRoutine(t),this.fxLeaves)for(var e=0;e<this.leafFxCount;e++)this.fxLeaves[e].emitters[0].setPosition(this.threeCamera.position.x,this.threeCamera.position.y+2,this.threeCamera.position.z+5)}resize(){this.threeCamera&&(this.threeCamera.aspect=this.game.width/this.game.height,this.threeCamera.updateProjectionMatrix())}setPlayerPosition(t){this.playerPosition.copy(t)}getActiveCamera(){return this.activeCamera}getPosition(t){return t?(t.copy(this.threeCamera.position),t):this.threeCamera.position.clone()}getMode(){return this.currentMode}setMode(t){switch(this.currentMode=t,this.properties=y.Modes.properties[this.currentMode],t){case y.Modes.FLY_OVER:this.endPosition.add(this.properties.offset),this.threeCamera.position.copy(this.endPosition),this.cameraDummy.position.copy(this.endPosition);var e=(new r.Ob).copy(this.endPosition);e.add(this.properties.lookAt),this.threeCamera.lookAt(e);break;case y.Modes.FLY_OVER_TO_RUN:this.delay=this.properties.duration;break;case y.Modes.DEATH:this.cameraDummy.position.copy(this.threeCamera.position),this.cameraDummy.quaternion.copy(this.threeCamera.quaternion);break;case y.Modes.WON:this.distance=this.playerPosition.distanceTo(this.threeCamera.position)/2,this.time=-1.5}}setZipLineMode(t){this.currentMode=y.Modes.ZIP_LINE,this.properties=y.Modes.properties[this.currentMode],t.direction.x>0&&(this.properties.offset.x=-Math.abs(this.properties.offset.x))}_updateRoutine(t){switch(this.currentMode){case y.Modes.FLY_OVER:this.threeCamera.position.z=r.S.lerp(this.endPosition.z,this.startPosition.z,1-this.threeCamera.position.z/this.endPosition.z+this.properties.followSpeed*t),Math.abs(this.threeCamera.position.z-this.startPosition.z)<5&&this.setMode(y.Modes.FLY_OVER_TO_RUN);break;case y.Modes.FLY_OVER_TO_RUN:if(this.currentOffset.copy(this.properties.offset),this.cameraDummy.position.copy(this.threeCamera.position),this.cameraDummy.lookAt(this.playerPosition.add(this.properties.lookAt)),this.threeCamera.quaternion.slerp(this.cameraDummy.quaternion,t*this.properties.transitionSpeed),this.playerPosition.sub(this.properties.lookAt),this.playerPosition.add(this.currentOffset),this.threeCamera.position.lerp(this.playerPosition,t*this.properties.transitionSpeed),this.playerPosition.sub(this.currentOffset),this.delay-=t,this.delay<0||this.threeCamera.quaternion.equals(this.cameraDummy.quaternion)){this.setMode(y.Modes.RUN),this.currentOffset.copy(this.properties.offset);var e=(new r.Ob).copy(this.startPosition);e.add(this.currentOffset),this.threeCamera.position.copy(e),this.cameraDummy.position.copy(this.threeCamera.position),this.cameraDummy.lookAt(this.playerPosition.add(this.properties.lookAt)),this.threeCamera.quaternion.copy(this.cameraDummy.quaternion),this.playerPosition.sub(this.properties.lookAt)}break;case y.Modes.DEFAULT:case y.Modes.WALL_RUN_LEFT:case y.Modes.WALL_RUN_RIGHT:case y.Modes.CLIMB:case y.Modes.SLIDE:case y.Modes.RUN:case y.Modes.RUN_BOOST:case y.Modes.ZIP_LINE:this.cameraDummy.position.copy(this.threeCamera.position),this.cameraDummy.lookAt(this.playerPosition.add(this.properties.lookAt)),this.threeCamera.quaternion.slerp(this.cameraDummy.quaternion,t*this.properties.transitionSpeed),this.playerPosition.sub(this.properties.lookAt),this.playerPosition.add(this.currentOffset),this.threeCamera.position.lerp(this.playerPosition,t*this.properties.followSpeed);break;case y.Modes.DEATH:this.cameraDummy.position.copy(this.threeCamera.position),this.cameraDummy.lookAt(this.playerPosition),this.threeCamera.quaternion.slerp(this.cameraDummy.quaternion,t*this.properties.followSpeed);break;case y.Modes.WON:this.time-=t,this.threeCamera.position.lerp(new r.Ob(this.playerPosition.x+this.distance*Math.cos(this.time),this.playerPosition.y,this.playerPosition.z+this.distance*Math.sin(this.time)),t*this.properties.followSpeed),this.threeCamera.lookAt(this.playerPosition)}}_switchActiveCamera(){this.activeCamera===this.threeCamera?(this.debugCamera.position.copy(this.threeCamera.position),this.activeCamera=this.debugCamera,this.orbitControls.enabled=!0,this.game.state.states.game.setPaused(!0)):(this.activeCamera=this.threeCamera,this.orbitControls.enabled=!1,this.game.state.states.game.setPaused(!1))}_createCamera(){this.threeCamera=new r.hb(y.Modes.properties[y.Modes.DEFAULT].fov,this.game.width/this.game.height,y.NEAR,y.FAR)}_createDebugCamera(){!this.gameInput&&this.debugCamera||(this.debugCamera=new r.hb(80,this.game.width/this.game.height,1,1e3),this.debugCamera.position.set(0,5,0),this.debugCamera.lookAt(new r.Ob(0,0,0)),this.orbitControls=new j.a(this.debugCamera,this.game.renderer.view),this.orbitControls.enableKeys=!1,this.orbitControls.enabled=!1,this.game.device.desktop&&this.gameInput&&(this.gameInput.addKeyboardEventListener(Phaser.KeyCode.PAGE_DOWN),this.gameInput.addKeyboardKeyUpEvent(Phaser.KeyCode.PAGE_DOWN,this._switchActiveCamera.bind(this))))}attachLeavesFx(t){this.particleManager3d=t,this.fxLeaves=[];for(var e=0;e<this.leafFxCount;e++)this.fxLeaves[e]=t.getParticleEffect(v.Effects["LEAF_".concat(e+1)]),this.fxLeaves[e].frustumCulled=!1,t.play(this.fxLeaves[e])}}var k=s(21);class F{constructor(t,e){this.game=t,this.levelController=e,this.modules=this.levelController.getModuleList(),this.buildings=[],this.collisionPositions=new r.Pb,this._createBoundingBoxes()}isPointInBox(t){for(var e=[],s=0;s<this.buildings.length;s++)this.buildings[s].boundingBox.containsPoint(t)&&e.push(this.buildings[s]);return e}getCollidedBuildingFaces(t){var e=this.isPointInBox(t);if(0===e.length)return[];for(var s=[],i=new r.Ob,a=new r.Ob,n=0;n<e.length;n++)e[n].boundingBox.getSize(i),e[n].getWorldPosition(a),a.y+=i.y/2,s.push(new r.Pb(a.x+i.x/2,a.y+i.y/2,a.z-i.z/2,a.x-i.x/2));return s}getCollisionTypes(t,e){var s=[],i=[];this.collisionPositions.set(0,0,0,0);for(var a=0;a<e.length;a++)Math.abs(t.y-e[a].y)<b.COLLISION_BUFFER&&(s.push(b.CollisionTypes.UP),i.push(e[a]),this.collisionPositions.y=e[a].y),Math.abs(t.z-e[a].z)<b.COLLISION_BUFFER&&(s.push(b.CollisionTypes.FORWARD),i.push(e[a]),this.collisionPositions.z=e[a].z),Math.abs(t.x-e[a].x)<b.COLLISION_BUFFER?(s.push(b.CollisionTypes.RIGHT),i.push(e[a]),this.collisionPositions.x=e[a].x):Math.abs(t.x-e[a].w)<b.COLLISION_BUFFER&&(s.push(b.CollisionTypes.LEFT),i.push(e[a]),this.collisionPositions.w=e[a].w);var n=s.indexOf(b.CollisionTypes.UP),o=s.indexOf(b.CollisionTypes.RIGHT);return n>=0&&(o>=0&&i[o].y<=i[n].y&&s.splice(o,1),(o=s.indexOf(b.CollisionTypes.LEFT))>=0&&i[o].y<=i[n].y&&s.splice(o,1)),{collisionTypes:s,collisionPositions:this.collisionPositions}}_createBoundingBoxes(){new r.f;for(var t=new r.Ob,e=new r.Ob,s=0;s<this.modules.length;s++)for(var i=0;i<this.modules[s].children.length;i++)this.modules[s].children[i].name.includes(b.BUILDING_KEY)&&(this.modules[s].children[i].updateWorldMatrix(!0,!0),this.modules[s].children[i].getWorldPosition(e),(new r.f).setFromObject(this.modules[s].children[i]).getSize(t),e.y+=t.y/2,this.modules[s].children[i].boundingBox=(new r.f).setFromCenterAndSize(e,t),this.buildings.push(this.modules[s].children[i]),this.game.config.enableDebug&&(this.modules[s].children[i].boundingBoxHelper=new r.g(this.modules[s].children[i].boundingBox,16776960),this.levelController.scene.add(this.modules[s].children[i].boundingBoxHelper)))}}class B{constructor(t,e,s){this.game=t,this.levelController=e,this.particlesManager3d=s,this.Interactables=g.InteractableObjects,this.OBJECT_COUNT=Object.keys(g.InteractableObjects.properties).length,this.modules=this.levelController.getModuleList(),this.interactables=[],this.worldPosition=new r.Ob,this._enlistInteractables()}isPointInTriggerDistance(t){for(var e,s=0;s<this.interactables.length;s++)if(e=this.Interactables.properties[this.interactables[s].index],this.interactables[s].getWorldPosition(this.worldPosition),this.worldPosition.distanceTo(t)<e.triggerDistance){var i=this.interactables[s];return this.interactables.splice(s,1),i}return null}_enlistInteractables(){for(var t=0;t<this.modules.length;t++)for(var e=0;e<this.modules[t].children.length;e++)for(var s=0;s<this.OBJECT_COUNT;s++)if(this.modules[t].children[e].name.includes(this.Interactables.properties[s].key)){this.modules[t].children[e].updateWorldMatrix(!0,!0),this.modules[t].children[e].index=s,s===this.Interactables.ZIP_LINE?this._createZipLine(t,e):this.interactables.push(this.modules[t].children[e]);var i=this.particlesManager3d.getParticleEffect(this.particlesManager3d.Effects.GLOW);this.particlesManager3d.play(i),this.interactables[this.interactables.length-1].add(i)}}_createZipLine(t,e){var s=this.modules[t].children[e].getObjectByName(this.Interactables.properties[this.Interactables.ZIP_LINE].startKey);s.updateWorldMatrix(!0,!0);var i=this.modules[t].children[e].getObjectByName(this.Interactables.properties[this.Interactables.ZIP_LINE].lineKey),a=this.modules[t].children[e].getObjectByName(this.Interactables.properties[this.Interactables.ZIP_LINE].endKey);a.updateWorldMatrix(!0,!0),s.endObj=a,s.direction=(new r.Ob).copy(a.position).sub(s.position).normalize(),s.index=this.Interactables.ZIP_LINE,i.position.copy(s.position),i.position.y+=1.2;var n=s.position.distanceTo(a.position),o=s.position.distanceTo(new r.Ob(s.position.x,a.position.y,s.position.z)),l=n<22?.1:.01;i.rotateX(Math.asin(o/n)+l);var h=a.position.x-s.position.x>0?1:-1;o=s.position.distanceTo(new r.Ob(a.position.x,s.position.y,s.position.z)),i.rotateY(Math.asin(o/n)*h),i.scale.set(1,1,4.35*n),this.interactables.push(s)}}class K{constructor(t,e){this.game=t,this.scene=e,this._createMesh(),this.speed=b.PigeonConfig.PIGEON_SPEED,this.flying=!1}update(t){this.mesh.mixer.update(t),this.flying&&(this.parent.position.y+=this.speed*t)}destroy(){this.mesh=null,this.parent=null,this.scene.remove(this.parent)}getPosition(t){return t?(t.copy(this.parent.position),t):this.parent.position.clone()}setPosition(t){t&&this.parent.position.set(t.x,t.y,t.z)}setRotation(t){this.mesh.rotation.set(0,t,0)}setVisible(t){this.parent.visible=t}_createMesh(){var t=this.game.cache.getThreeGltf("pigeon"),e=m.a.clone(t.scene.children[0]),s=k.a.createFromConfig(this.game,this.game.cache.getLambdaMaterial("pigeon_mat"));this.mesh=new u.a.SkinnedMesh(e,s,t.animations),this.parent=new r.fb,this.mesh.name="pigeon",this.mesh.mixer.clipAction("idle_01").play(),this.parent.add(this.mesh),this.scene.add(this.parent)}fly(){this.flying=!0,this.mesh.mixer.clipAction("idle_01").stop(),this.mesh.mixer.clipAction("fly_01").play()}}class W{constructor(t,e,s){this.game=t,this.scene=e,this.position=s,this.pigeonCount=b.PigeonConfig.PIGEON_COUNT,this.radius=b.PigeonConfig.FLOCK_RADIUS,this.triggerDistance=b.PigeonConfig.TRIGGER_DISTANCE,this.playerPos=new r.Ob,this._init()}update(t,e){var s=!1;if(!s&&this.position.distanceTo(e.getPosition(this.playerPos))<this.triggerDistance){s=!0;for(var i=0;i<this.pigeons.length;i++)this.pigeons[i].fly()}for(var a=0;a<this.pigeons.length;a++)this.pigeons[a].update(t)}destroy(){}getPosition(t){return t?(t.copy(this.position),t):this.position.clone()}setVisible(t){}_init(){this.pigeons=[];for(var t=0;t<this.pigeonCount;t++){var e=new K(this.game,this.scene),s=2*Math.random()*Math.PI,i=this.radius*Math.sqrt(Math.random()),a=i*Math.cos(s),n=i*Math.sin(s),o=2*Math.random()*Math.PI;e.setPosition(new r.Ob(this.position.x+a,this.position.y,this.position.z+n)),e.setRotation(o),this.pigeons.push(e)}}}class z{constructor(t,e,s,i){this.game=t,this.scene=e,this.levelIndex=s,this.modules=[],this.playerStartPosition=new r.Ob,this.levelEndPosition=new r.Ob,this.startBoostPosition=new r.Ob,this._createModules(),this.physicsController=new F(this.game,this),this.interactableObjectController=new B(this.game,this,i)}destroy(){for(var t=0;t<this.modules.length;t++)this.scene.remove(this.modules[t]),this.modules[t]=null;this.modules=[]}getModuleList(){return this.modules}getPlayerStartPosition(t){return t?(t.copy(this.playerStartPosition),t):this.playerStartPosition.clone()}getLevelEndPosition(t){return t?(t.copy(this.levelEndPosition),t):this.levelEndPosition.clone()}_createModules(){var t=new u.a.Scene(this.game,this.game.cache.getLambdaScene("module_start"));t.setup(),this.scene.add(t),this.modules.push(t);var e=t.getObjectByName(g.InteractableObjects.properties[g.InteractableObjects.BOOST_RUN].key);e.updateWorldMatrix(!0,!0),e.getWorldPosition(this.startBoostPosition),this.pigeoPositionList=[];for(var s=b.MODULE_SIZE_Z,i=b.Levels[this.levelIndex].level,a=new r.Ob,n=0;n<i.length;n++){var o=new u.a.Scene(this.game,this.game.cache.getLambdaScene("module_".concat(i[n])));o.setup(),this.scene.add(o),o.position.z+=s+b.MODULE_OFFSET,this.modules.push(o);var l=o.getObjectByName("pigeon");l&&(l.updateWorldMatrix(!0,!0),l.getWorldPosition(a),this.pigeoPositionList.push(a)),s+=b.MODULE_SIZE_Z}var h=new u.a.Scene(this.game,this.game.cache.getLambdaScene("module_end"));h.setup(),this.scene.add(h),h.position.z+=s,this.modules.push(h);var c=h.getObjectByName("pigeon");if(c){c.updateWorldMatrix(!0,!0);var d=c.getWorldPosition(a).clone();this.pigeoPositionList.push(d)}this.playerStartPosition.copy(t.getObjectByName("start").position);var p=h.getObjectByName("finishPlane");p.updateWorldMatrix(!0,!0),p.getWorldPosition(this.levelEndPosition),this._spawnPigeonFlocks()}_spawnPigeonFlocks(){this.pigeonFlocks=[];for(var t=this.pigeoPositionList,e=0;e<t.length;e++){var s=new W(this.game,this.scene,t[e]);this.pigeonFlocks.push(s)}}}var V=s(208);class G{constructor(t,e){this.game=t,this.scene=e,this.Effects=v.Effects,this.EFFECTS_COUNT=Object.keys(this.Effects.properties).length,this.textures=[],this.fx=[],this.fxCountdown=[],this.sheepfx=new V.a;for(var s=0;s<this.EFFECTS_COUNT;s++){if(!this.textures[this.Effects.properties[s].texture]){var i=this.Effects.properties[s].texture,a=this.game.cache.getImage(i);this.textures[i]=new r.Db(a),this.textures[i].minFilter=r.bb,this.textures[i].minFilter=r.ab,this.textures[i].needsUpdate=!0}this.fx[s]=[];for(var n=0;n<this.Effects.properties[s].pool;n++){var o=this.Effects.properties[s].json;null!==o&&(this.fx[s][n]=this.sheepfx.effectFromJson(this.game.cache.getJSON(o),this.textures[this.Effects.properties[s].texture]),this.fx[s][n].material.fog=!1,this.fx[s][n].frustumCulled=!0,this.fx[s][n].index=s,this.fx[s][n].ttl=0,this.fx[s][n].visible=!1,this.fx[s][n].exists=!1,this.scene&&this.scene.add(this.fx[s][n]))}}}init(t){this.scene=t;for(var e=0;e<this.EFFECTS_COUNT;e++)for(var s=0;s<this.Effects.properties[e].pool;s++)this.scene.add(this.fx[e][s])}update(t){this.sheepfx.update(t);for(var e=this.fxCountdown.length,s=0;s<e;)this.fxCountdown[s].ttl-=t,this.fxCountdown[s].ttl<0&&(this.scene.add(this.fxCountdown[s]),this.fxCountdown[s].exists=!1,this.fxCountdown[s].visible=!1,this.fxCountdown.splice(s,1),e--),s++}destroy(){for(var t=0;t<this.fx.length;t++)for(var e=0;e<this.fx[t].length;e++)this.fx[t][e]=null;this.fx=[]}getParticleEffect(t){var e=p.getFirstExists(this.fx[t],!1);return null===e&&(e=this.fx[t][0]),e.exists=!0,e}play(t){t.reset(),t.visible=!0}pause(t){t.visible=!1}kill(t){t.visible=!1,t.exists=!1}isActive(t){return t.visible}playOnce(t){t.ttl=this.Effects.properties[t.index].ttl,this.fxCountdown.push(t),t.reset(),t.visible=!0}}class X{constructor(t,e){this.game=t,this.materialCache=this.game.materialCache,this.scene=null,this._createScene(),this.particleManager3D=new G(this.game,this.scene),this.levelController=new z(this.game,this.scene,e,this.particleManager3D),this._createMaterials()}update(t){this.envoMat.uniforms.time.value+=t,this.particleManager3D.update(t)}destroy(){this.levelController.destroy(),this.particleManager3D.destroy(),this.scene.dispose(),this.scene=null}_createScene(){this.scene=new r.tb}_createMaterials(){this.playerMat=k.a.createFromConfig(this.game,this.game.cache.getLambdaMaterial("char")),this.playerMat.name="player",this.materialCache.addMaterial(this.playerMat,!1),this.envoMat=null;for(var t=this.levelController.getModuleList()[0],e=0;e<t.children.length;e++)if(t.children[e].name.includes(b.BUILDING_KEY)){this.envoMat=t.children[e].material;break}var s=k.a.createFromConfig(this.game,this.game.cache.getLambdaMaterial("shadow"));s.opacity=.5,s.name="shadow",this.materialCache.addMaterial(s,!1)}}class Z{static lerp(t,e,s){return(1-s)*t+s*e}static lerp2D(t,e,s){return{x:(1-s)*t.x+s*e.x,y:(1-s)*t.y+s*e.y}}static getVector2Distance(t,e){return Math.sqrt((e.y-t.y)*(e.y-t.y)+(e.x-t.x)*(e.x-t.x))}static getRndInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static getRndFloat(t,e){return Math.random()*(e-t)+t}static mapNumberToRange(t,e,s,i,a){return i+(a-i)/(s-e)*(t-e)}static clamp(t,e,s){return t<e?e:s<t?s:t}static clampMax(t,e){return e<t?e:t}static clampMin(t,e){return t<e?e:t}static shuffleArray(t){for(var e,s,i=t.length,a=t;0!==i;)s=Math.floor(Math.random()*i),e=a[i-=1],a[i]=a[s],a[s]=e;return t}static getBubbleSortedArray(t){for(var e=t.length,s=0;s<e;s++)for(var i=0;i<e-s-1;i++)if(t[i]>t[i+1]){var a=t[i];t[i]=t[i+1],t[i+1]=a}return t}static sortMultipleArrays(t,e){for(var s=t.length,i=0;i<s;i++)for(var a=0;a<s-i-1;a++)if(t[a]>t[a+1]){var n=t[a];t[a]=t[a+1],t[a+1]=n;for(var o=0;o<e.length;o++){var r=e[o],l=r[a];r[a]=r[a+1],r[a+1]=l}}return{primary:t,secondaries:e}}static toDegrees(t){return t*(180/Math.PI)}static toRadians(t){return t*(Math.PI/180)}static isPointInCircle(t,e,s){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))<=s}static isEven(t){return t%2==0}static getEuclideanDistance2D(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}static getVector3Magnitude(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static get2dIndexVia1d(t,e){return{x:t/e,y:t%e}}static getMMSS(t){if(t<=0)return"00:00";var e=Math.floor(t/60),s=Math.floor(t-60*e);return e<10&&(e="0".concat(e)),s<10&&(s="0".concat(s)),"".concat(e,":").concat(s)}static getHHMMSS(t){var e=Math.floor(t/3600),s=Math.floor((t-3600*e)/60),i=Math.floor(t-3600*e-60*s);return e<10&&(e="0".concat(e)),s<10&&(s="0".concat(s)),i<10&&(i="0".concat(i)),"".concat(e,":").concat(s,":").concat(i)}static getTilePosition(t,e,s,i,a,n){return new r.Ob((t+.5)*(s/i)-a,0,(e+.5)*(s/i)-n)}}class H{static changeLocalizedMessage(t,e,s){e.shui.locale?(e.shui.locale.changeMessage(s),e.shui.locale.format()):t.localizer.initElement(e,s)}static setLocalizedVariable(t,e,s,i=!0){t.shui.locale.values[e]=s,i&&t.shui.locale.format()}static hasLocalizerText(t,e){return t.localizer._localeData.has(e)}static getLocalizedText(t,e){return t.localizer._localeData.get(e)}static setButtonText(t,e){for(var s=t.getStateNames(),i=0;i<s.length;i++)t.getState(s[i]).baseText&&t.getState(s[i]).baseText.setText(e),t.getState(s[i]).downText&&t.getState(s[i]).downText.setText(e),t.getState(s[i]).hoverText&&t.getState(s[i]).hoverText.setText(e)}static pad(t,e,s){return s=s||"0",(t+="").length>=e?t:new Array(e-t.length+1).join(s)+t}}class Y{constructor(t,e,s,i){this.game=t,this.state=e,this.tutorialManager=s,this.gameInput=i,this.SWIPE_TWEEN_DURATION=1e3,this.SWIPE_TWEEN_DELAY=2500,this.sndClick=this.game.soundManager.getSound("click",1),this.deviceKey=this.game.device.desktop?"desktop":"mobile",this._createUI(),this.setVisible(!1)}setVisible(t){if(this.layout.visible=t,t){var e="__tutorial_".concat(this.deviceKey,"_").concat(H.pad(this.tutorialManager.currentStep+1,2));switch(H.changeLocalizedMessage(this.game,this.txtMessage,e),this.tutorialManager.currentStep){case this.tutorialManager.Tutorials.STRAFE:this.layout.position.y=this.layout.defaultPosition.y+1.2*this.lblFrame.height,this._playStrafeTween(),this.btnContinue.visible=!1;var s=this.game.time.create(!0);s.add(3e3,()=>{this.btnContinue.visible=!0},this),s.start()}}else this.layout.position.x=this.layout.defaultPosition.x,this.btnContinue.visible=!0,this._disableControlGraphics()}isVisible(){return this.layout.visible}onDismissButtonDown(){this.tutorialManager.isTutorialActive()&&this.isVisible()&&(this.setVisible(!1),this.tutorialManager.incrementStep())}addOnDismissEvent(t,e){this.btnContinue.onInputUp.addOnce(t,e),this.game.device.desktop&&this.state.gameInput.addKeyboardKeyUpEventOnce(Phaser.KeyCode.SPACEBAR,t.bind(e))}_playStrafeTween(){if(this.game.device.desktop){for(var t=0;t<this.grpKeyboard.children.length;t++)this.grpKeyboard.children[t].visible=!0;this.timerKeyboardStrafe=this.game.time.create(!1),this.timerKeyboardStrafe.loop(500,()=>{this.lblKeyboardL.visible=!this.lblKeyboardL.visible,this.lblKeyboardR.visible=!this.lblKeyboardR.visible},this),this.timerKeyboardStrafe.start()}else this.lblTouch.visible=!0,this.lblTouch.shui.defaultPosition=this.lblTouch.shui.position.clone(),this.tweenStrafeLeft=this.game.add.tween(this.lblTouch.shui.position).to({x:this.lblTouch.shui.defaultPosition.x-300},this.SWIPE_TWEEN_DURATION,Phaser.Easing.Cubic.Out,!0,0,Number.MAX_SAFE_INTEGER,!1),this.tweenStrafeLeft.repeatDelay(this.SWIPE_TWEEN_DELAY),this.tweenStrafeLeft.onRepeat.add(()=>{this.lblTouch.shui.position.copyFrom(this.lblTouch.shui.defaultPosition)},this),this.tweenStrafeRight=this.game.add.tween(this.lblTouch.shui.position).to({x:this.lblTouch.shui.defaultPosition.x+300},this.SWIPE_TWEEN_DURATION,Phaser.Easing.Cubic.Out,!0,this.SWIPE_TWEEN_DELAY/2,Number.MAX_SAFE_INTEGER,!1),this.tweenStrafeRight.repeatDelay(this.SWIPE_TWEEN_DELAY),this.tweenStrafeRight.onRepeat.add(()=>{this.lblTouch.shui.position.copyFrom(this.lblTouch.shui.defaultPosition)},this)}_disableControlGraphics(){if(this.game.device.desktop){this.timerKeyboardStrafe&&this.timerKeyboardStrafe.stop();for(var t=0;t<this.grpKeyboard.children.length;t++)this.grpKeyboard.children[t].visible=!1}else this.tweenStrafeLeft&&this.tweenStrafeLeft.isRunning&&this.tweenStrafeLeft.stop(),this.tweenStrafeRight&&this.tweenStrafeRight.isRunning&&this.tweenStrafeRight.stop(),this.lblTouch.visible=!1;this.lblTouch.shui.defaultPosition&&this.lblTouch.shui.position.copyFrom(this.lblTouch.shui.defaultPosition)}_createUI(){this.layout=new n.a.Layout(this.game,this.game.cache.getLayout("layout_tutorial")),this.layout.setup(),this.game.world.add(this.layout),this.layout.defaultPosition=this.layout.position.clone(),this.txtMessage=this.layout.getElementById("varTextTutorial"),this.lblFrame=this.layout.getElementById("labelFrameTutorial"),this.btnContinue=this.layout.getElementById("buttonContinue"),this.btnContinue.onDownSound=this.sndClick,this.btnContinue.onInputUp.add(this.onDismissButtonDown,this),this.grpKeyboard=this.layout.getElementById("groupKeyboard"),this.lblKeyboardL=this.layout.getElementById("keyboardHighlightLUp"),this.lblKeyboardL.visible=!1,this.lblKeyboardR=this.layout.getElementById("keyboardHighlightRUp"),this.lblKeyboardR.visible=!1;for(var t=0;t<this.grpKeyboard.children.length;t++)this.grpKeyboard.children[t].visible=!1;this.lblTouch=this.layout.getElementById("labelTouch"),this.lblTouch.visible=!1,this.game.localizer.initGroup(this.layout)}}class J{constructor(t,e){this.game=t,this.state=e,this.sndClick=this.game.soundManager.getSound("click"),this._createUI(),this.tutorialUI=new Y(t,e,e.tutorialManager,e.gameInput),this.game.device.desktop&&this.state.gameInput.addKeyboardKeyUpEvent(Phaser.KeyCode.SPACEBAR,()=>{this.state.player.isVisible()?e.tutorialManager.isTutorialActive()&&this.tutorialUI.onDismissButtonDown():this.onIntroUp()}),window.fsToggleUI=()=>{this.setVisible(!this.layout.visible)},this.setCountdownTextVisible(!1),this.setIntroVisible(!1)}update(t){this.txtTimer.setText(Z.getMMSS(this.state.elapsedTime))}setIntroVisible(t){for(var e=0;e<this.grpLevelIntro.length;e++)this.grpLevelIntro[e].visible=t}updateCountdownText(t){t<=0?H.changeLocalizedMessage(this.game,this.txtCountdown,"__go"):this.txtCountdown.setText(t),this.txtCountdown.scale.set(0,0),this.game.add.tween(this.txtCountdown.scale).to({x:1,y:1},300,Phaser.Easing.Back.Out,!0,0,0,!1)}setCountdownTextVisible(t){this.txtCountdown.visible=t}showComboFx(t){this.txtCombo.shui.position.y=this.game.height/2,H.setLocalizedVariable(this.txtCombo,"numCombo",t),this.txtCombo.scale.set(0,0),this.txtCombo.visible=!0,this.game.add.tween(this.txtCombo.scale).to({x:1.2,y:1.2},800,Phaser.Easing.Back.Out,!0,0,0,!1).onComplete.add(()=>{this.game.add.tween(this.txtCombo.shui.position).to({y:this.txtCombo.shui.defaultPosition.y},500,Phaser.Easing.Back.In,!0,0,0,!1),this.game.add.tween(this.txtCombo.scale).to({x:1,y:1},500,Phaser.Easing.Linear.None,!0,0,0,!1)},this)}setComboTextVisible(t){this.txtCombo.visible=t}setVisible(t){this.layout.visible=t}_createUI(){this.layout=new n.a.Layout(this.game,this.game.cache.getLayout("layout_game")),this.layout.setup(),this.game.world.add(this.layout),this.game.localizer.initGroup(this.layout),this.txtTimer=this.layout.getElementById("varTextTimer"),this.txtTimer.setText(Z.getMMSS(0)),this.txtCombo=this.layout.getElementById("varTextCombo"),this.txtCombo.shui.defaultPosition=this.txtCombo.shui.position.clone(),this.txtCombo.visible=!1,this.txtCountdown=this.layout.getElementById("varTextCountdown"),this.grpLevelIntro=[],this.grpLevelIntro.push(this.layout.getElementById("textLevelStart_01")),this.grpLevelIntro.push(this.layout.getElementById("textLevelStart_02"));var t=this.layout.getElementById("varTextLevelName");this.grpLevelIntro.push(t),H.setLocalizedVariable(t,"numLevel",this.state.levelIndex+1);var e=this.layout.getElementById("buttonContinue");e.onDownSound=this.sndClick,this.grpLevelIntro.push(e),e.onInputUp.add(()=>{this.onIntroUp()},this);var s=this.layout.getElementById("buttonAudio");s.onDownSound=this.sndClick,this.game.sound.mute&&s.useState("muted"),s.onInputUp.add(()=>{"default"===s.getCurrentStateName()?(this.game.sound.mute=!0,s.useState("muted")):(this.game.sound.mute=!1,s.useState("default"))}),p.addIntroTweenShui(this.game,s,!0,!0)}onIntroUp(){this.state.player.setVisible(!0),this.setIntroVisible(!1),this.state.tutorialManager.isTutorialActive()?this.state.setState(this.state.States.TUTORIAL):this.state.setState(this.state.States.COUNT_DOWN)}}class q{constructor(t,e,s){this.game=t,this.interactableCollisionDetector=e,this.gameUI=s,this.interactableCollisionDetector.addCollisionObserver(this.incrementCombo,this),this.combo=0,this.comboDecay=0}update(t){this.comboDecay-=t,this.combo>0&&this.comboDecay<0&&(this.combo=0,this.gameUI.setComboTextVisible(!1))}incrementCombo(){this.combo++,this.gameUI.showComboFx(this.combo),this.comboDecay=g.COMBO_DECAY_TIME}}class Q{constructor(t,e){this.game=t,this.cameraController=e,this.POOL_COUNT=40,this.SPAWN_DELAY=.05,this.RADIUS=2,this.SPEED=10,this.SPAWN_OFFSET_Z=2,this.ACCELERATION_THRESHOLD=10,this.player=null,this.pool=[],this.bActive=!1,this.cameraPosition=new r.Ob,this.playerPosition=new r.Ob,this.lastPlayerPosition=new r.Ob,this.delay=0,this._create(),this.setActive(!0)}init(t,e){this.player=e;for(var s=0;s<this.pool.length;s++)this.pool[s].exists=!1,this.pool[s].visible=!1,t.add(this.pool[s])}update(t){this.cameraController.getPosition(this.cameraPosition),this.player.getPosition(this.playerPosition);for(var e=0;e<this.pool.length;e++)this.pool[e].exists&&(this.pool[e].position.x=this.pool[e].distribution.x+this.cameraPosition.x,this.pool[e].position.y=this.pool[e].distribution.y+this.cameraPosition.y,this.pool[e].position.z-=t*this.SPEED,this.pool[e].position.z<this.cameraPosition.z&&(this.pool[e].visible=!1,this.pool[e].exists=!1));if(this.bActive&&(this.playerPosition.z-this.lastPlayerPosition.z)/t>this.ACCELERATION_THRESHOLD&&(this.delay-=t,this.delay<0)){this.delay=this.SPAWN_DELAY;var s=p.getFirstExists(this.pool,!1);s&&(s.distribution.set(Math.random()-.5,Math.random()-.5),0===s.distribution.length()&&(s.distribution.x=0),s.distribution.normalize(),s.distribution.multiplyScalar(this.RADIUS),s.distribution.y-=this.cameraController.currentOffset.y/2,s.position.set(this.cameraPosition.x+s.distribution.x,this.cameraPosition.y+s.distribution.y,this.cameraPosition.z+this.SPAWN_OFFSET_Z),s.exists=!0,s.visible=!0)}this.player.getPosition(this.lastPlayerPosition)}setActive(t){this.bActive=t}_create(){for(var t=new r.n(0,.05,4,4,1,!0),e=new r.V({side:r.r,depthTest:!1,fog:!1}),s=0;s<this.POOL_COUNT;s++){var i=new r.U(t,e);i.rotation.x=.5*-Math.PI,i.exists=!1,i.visible=!1,i.distribution=new r.Nb,this.pool.push(i)}}}class ${constructor(t,e=!1){this.game=t,this.Tutorials={GOAL:0,STRAFE:1,INTERACTABLE_POINT:2},this.config=this.game.cache.getJSON("config"),this.storage=new a.a.Storage(this.config.toggoKey),e&&(this.currentStep=0,this.storage.setItem("tutorialStep",this.currentStep)),this.currentStep=this.storage.getItem("tutorialStep",this.Tutorials.GOAL)}isTutorialActive(){return this.currentStep<Object.keys(this.Tutorials).length}isStepActive(t){return this.storage.getItem("tutorialStep",this.Tutorials.GOAL)===t}getActiveStep(){return this.storage.getItem("tutorialStep",this.Tutorials.GOAL)}incrementStep(){this.currentStep++,this.storage.setItem("tutorialStep",this.currentStep)}restartTutorial(){this.currentStep=this.Tutorials.GOAL,this.storage.setItem("tutorialStep",this.currentStep)}}s(508),s(509);var tt=["de-DE","en-US","es-ES","fr-FR","pt-BR"],et=new i.a({width:720,height:1280,phaserParameters:{disableVisibilityChange:!1,roundPixels:!1},threeParameters:{powerPreference:"high-performance"},enableDebug:!1,locale:{locales:tt,fallbackLocale:"en-US",locale:navigator.language}});et.state.add("boot",new c),et.state.add("menu",new class extends d{init(...t){super.init({key:"menuState",url:"data/menuPack.json"},...t)}createOnce(){super.createOnce(),this.game.input.onDown.addOnce(t=>{this.game.device.desktop=t.isMouse}),this.sndClick=this.game.soundManager.getSound("click")}create(){super.create(),this.game.toggoApi.track("menue");var t=this.game.soundManager.getSound("music_menu",1);t.loop=!0,t.play(),this._createUI(),this.game.config.enableDebug}startLevelSelectState(){this.game.state.start("levelSelect")}_createUI(){this.layout=new n.a.Layout(this.game,this.game.cache.getLayout("layout_menu")),this.layout.setup(),this.game.world.add(this.layout);var t=this.layout.getElementById("labelLogo");t.scale.set(0,0),this.game.add.tween(t.scale).to({x:1,y:1},1e3,Phaser.Easing.Back.Out,!0,0,0,!1);var e=this.layout.getElementById("buttonPlay");e.onDownSound=this.sndClick,e.onInputUp.add(this.startLevelSelectState,this),this.game.add.tween(e.scale).to({x:1.2,y:1.2},700,Phaser.Easing.Linear.None,!0,0,Number.MAX_SAFE_INTEGER,!0),p.addIntroTweenShui(this.game,e,!0,!1);var s=this.layout.getElementById("buttonAudio");this.game.sound.mute&&s.useState("muted"),s.onInputUp.add(()=>{"default"===s.getCurrentStateName()?(this.game.sound.mute=!0,s.useState("muted")):(this.game.sound.mute=!1,s.useState("default"))}),this.layout.getElementById("buttonTutorial").onInputUp.add(()=>{this.game.state.start("game",!0,!1,0,!0)}),p.addIntroTweenShui(this.game,s,!0,!0),this.game.localizer.initGroup(this.layout)}}),et.state.add("levelSelect",new class extends d{init(t,...e){super.init({key:"levelSelectState",url:"data/levelSelectPack.json"},...e),this.levelIndex=void 0!==t?t:-1}createOnce(){super.createOnce(),this.config=this.game.cache.getJSON("config"),this.storage=new a.a.Storage(this.config.toggoKey),this.sndClick=this.game.soundManager.getSound("click")}create(){if(super.create(),this.game.toggoApi.track("level-auswahl"),this.levels=[],this.btnLevels=[],this.currentLevel=this.levelIndex,this.totalStarCount=b.getTotalStarCount(this.storage),this.scrollTween=null,this._createUI(),this.currentLevel<0){this.currentLevel=b.Levels.length-1;for(var t=0;t<b.Levels.length;t++)if(b.getLevelTime(this.storage,t)===Number.MAX_SAFE_INTEGER){this.currentLevel=t;break}}for(var e=0;e<this.levels.length;e++)this.levels[e].position.x-=this.currentLevel*this.game.width;this._updateLevel(this.currentLevel)}startGameState(t){this.game.state.start("game",!0,!1,t)}_updateLevel(t){if(null===this.scrollTween||!this.scrollTween.isRunning){var e=this.currentLevel;this.currentLevel=t,this.currentLevel=this.game.math.clamp(this.currentLevel,0,b.Levels.length-1),this.btnLeft.visible=!0,this.btnRight.visible=!0,0===this.currentLevel?this.btnLeft.visible=!1:this.currentLevel===b.Levels.length-1&&(this.btnRight.visible=!1);var s=Math.sign(this.currentLevel-e);if(0!==s)for(var i=0;i<this.levels.length;i++)this.scrollTween=this.game.add.tween(this.levels[i].position).to({x:this.levels[i].position.x-this.game.width*s},350,Phaser.Easing.Back.InOut,!0,0,0,!1)}}_createUI(){var t=this;this.layout=new n.a.Layout(this.game,this.game.cache.getLayout("layout_levelSelect")),this.layout.setup(),this.game.world.add(this.layout),this.game.localizer.initGroup(this.layout);for(var e=function(e){t.levels[e]=new n.a.Layout(t.game,t.game.cache.getLayout("layout_level")),t.levels[e].setup(),t.game.world.add(t.levels[e]),t.game.localizer.initGroup(t.levels[e]),t.levels[e].position.x=e*t.game.width;var s=b.getStarCount(t.storage,e),i=b.Levels[e].unlockStarsCount;t.btnLevels[e]=t.levels[e].getElementById("buttonPlay"),t.btnLevels[e].onDownSound=t.sndClick,t.btnLevels[e].onInputUp.add(()=>{t.startGameState(e)},t);var a=t.levels[e].getElementById("textTitleLevelSelection");H.setLocalizedVariable(a,"numLevel",e+1);var o=t.levels[e].getElementById("varTextStarAmount");H.setLocalizedVariable(o,"numStar",s),H.setLocalizedVariable(o,"maxNumberStarInLevel",b.Levels[e].time.length);for(var r=t.levels[e].getElementById("labelLevelselectLocked"),l=t.levels[e].getElementById("textLocked"),h=t.levels[e].getElementById("textYourRecord"),c=t.levels[e].getElementById("varTextUnlockAmount"),d=t.levels[e].getElementById("varTextTimer"),p=[],u=[],m=0;m<b.Levels[e].time.length;m++)p[m]=t.levels[e].getElementById("labelEmptyStar_0".concat(m+1)),t.totalStarCount<i&&(p[m].visible=!1),u[m]=t.levels[e].getElementById("labelStarFull_0".concat(m+1)),s<=m&&(u[m].visible=!1);if(t.totalStarCount>=i){r.visible=!1,l.visible=!1,c.visible=!1;var g=b.getLevelTime(t.storage,e);g=g===Number.MAX_SAFE_INTEGER?0:g,d.setText(Z.getMMSS(Math.round(g)))}else r.visible=!0,l.visible=!0,d.visible=!1,h.visible=!1,H.setLocalizedVariable(c,"numStarsNeeded",i-s),t.btnLevels[e].inputEnabled=!1},s=0;s<b.Levels.length;s++)e(s);this.btnLeft=this.layout.getElementById("buttonLeft"),this.btnLeft.onDownSound=this.sndClick,this.btnLeft.onInputUp.add(()=>{this._updateLevel(this.currentLevel-1)},this),p.addIntroTweenShui(this.game,this.btnLeft,!1,!0),this.btnRight=this.layout.getElementById("buttonRight"),this.btnRight.onDownSound=this.sndClick,this.btnRight.onInputUp.add(()=>{this._updateLevel(this.currentLevel+1)},this),p.addIntroTweenShui(this.game,this.btnRight,!1,!1),this.layout.getElementById("varTextTotalStars").setText(this.totalStarCount),this.layout.getElementById("textTotalStars02").setText("/".concat(b.Levels[0].time.length*b.Levels.length));var i=this.layout.getElementById("buttonAudio");this.game.sound.mute&&i.useState("muted"),i.onInputUp.add(()=>{"default"===i.getCurrentStateName()?(this.game.sound.mute=!0,i.useState("muted")):(this.game.sound.mute=!1,i.useState("default"))}),p.addIntroTweenShui(this.game,i,!0,!0)}}),et.state.add("game",new class extends d{init(t,e,...s){super.init({key:"gameState",url:"data/gamePack.json"},...s),this.levelIndex=t,this.forceTutorial=e}createOnce(){super.createOnce();var t=0;this.States={NULL:t++,FLY_OVER:t++,COUNT_DOWN:t++,CORE_LOOP:t++,DEATH:t++,WON:t++,TUTORIAL:t++},this.WON_DELAY=5,this.DEATH_DELAY=1,this.gameInput=new N(this.game),this.playerInput=new U(this.game,this.gameInput),this.cameraController=new D(this.game,this.gameInput),this.speedLines=new Q(this.game,this.cameraController),this.tutorialManager=new $(this.game,this.forceTutorial),this.game.tutorialManager=this.tutorialManager,this.sndCountdown=this.game.soundManager.getSound("countdown",.5),this.sndFinish=this.game.soundManager.getSound("finish")}create(){super.create(),this.game.toggoApi.track("level-".concat(this.levelIndex+1)),this.game.soundManager.getSound("music_menu").stop(),this.gameMusic=this.game.soundManager.getSound("music_game",.7),this.gameMusic.loop=!0,this.gameMusic.play(),this.environment=new X(this.game,this.levelIndex),this.player=new R(this.game,this.playerInput,this.environment.scene,this.environment.levelController,this.cameraController,this.environment.particleManager3D),this.gameUI=new J(this.game,this),this.scoreController=new q(this.game,this.player.stateMachine.interactableCollisionDetection,this.gameUI),this.gameInput.init(),this.playerInput.init(),this.cameraController.init(this.environment.levelController.getPlayerStartPosition(),this.environment.levelController.getLevelEndPosition()),this.speedLines.init(this.environment.scene,this.player),this.cameraController.attachLeavesFx(this.environment.particleManager3D),this.playerPosition=new r.Ob,this.second=1,this.countDown=3,this.gameUI.updateCountdownText(this.countDown),this.elapsedTime=0,this.delay=0,this.bPaused=!1,this.currentState=this.States.NULL,this.setState(this.States.FLY_OVER),this.game.three.show()}update(t){super.update(t);var e=this.game.time.elapsedMS/1e3;this.isPaused()||(this._updateRoutine(e),this.speedLines.update(e))}render(t){super.render(t),this.game.three.renderer.render(this.environment.scene,this.cameraController.getActiveCamera())}resize(){super.resize(),this.cameraController.resize()}shutdown(){super.shutdown(),this.game.three.hide(),this.game.soundManager.getSound("run").stop(),this.game.soundManager.getSound("climb").stop(),this.gameMusic.stop(),this.game.soundManager.getSound("music_menu").play(),this.player.destroy(),this.environment.destroy()}_updateRoutine(t){switch(this.currentState){case this.States.FLY_OVER:this.player.update(t),this.cameraController.update(t),this.cameraController.getMode()===y.Modes.FLY_OVER_TO_RUN?this.player.setVisible(!0):this.cameraController.getMode()===y.Modes.RUN&&(this.tutorialManager.isTutorialActive()?this.setState(this.States.TUTORIAL):this.setState(this.States.COUNT_DOWN));break;case this.States.TUTORIAL:switch(this.cameraController.update(t),this.player.update(t),this.tutorialManager.getActiveStep()){case this.tutorialManager.Tutorials.GOAL:this.gameUI.tutorialUI.isVisible()||this.gameUI.tutorialUI.setVisible(!0);break;case this.tutorialManager.Tutorials.STRAFE:this.gameUI.tutorialUI.isVisible()||(this.gameUI.tutorialUI.setVisible(!0),this.gameUI.tutorialUI.addOnDismissEvent(()=>{this.player.resetStartPosition()},this)),this.gameInput.update(t),this.player.updatePlayerTutorialStrafe(t);break;case this.tutorialManager.Tutorials.INTERACTABLE_POINT:this.gameUI.tutorialUI.isVisible()||(this.gameUI.tutorialUI.setVisible(!0),this.gameUI.tutorialUI.addOnDismissEvent(()=>{this.setState(this.States.COUNT_DOWN)},this))}break;case this.States.COUNT_DOWN:if(this.tutorialManager.isTutorialActive())return void this.setState(this.States.TUTORIAL);this.player.update(t),this.cameraController.update(t),this.second-=t,this.second<=0&&(this.countDown--,this.gameUI.updateCountdownText(this.countDown),this.second=1),this.countDown<=0&&(this.player.launch(),this.currentState=this.States.CORE_LOOP,this.game.time.events.add(Phaser.Timer.SECOND,()=>{this.gameUI.setCountdownTextVisible(!1)}));break;case this.States.CORE_LOOP:this.tutorialManager.isStepActive(this.tutorialManager.Tutorials.INTERACTABLE_POINT)||this.gameInput.update(t),this.environment.update(t),this.player.update(t),this.cameraController.update(t),this.scoreController.update(t),this.gameUI.update(t),this.elapsedTime+=t,this.player.stateMachine.isInDeathState()?this.setState(this.States.DEATH):this.player.stateMachine.isInWonState()&&this.setState(this.States.WON);break;case this.States.DEATH:this.environment.update(t),this.player.update(t),this.cameraController.update(t),this.delay-=t,this.delay<0&&(this.currentState=this.States.NULL,this.startGameOverState(!1));break;case this.States.WON:this.environment.update(t),this.player.update(t),this.cameraController.update(t),this.delay-=t,this.delay<0&&(this.currentState=this.States.NULL,this.startGameOverState(!0))}for(var e=0;e<this.environment.levelController.pigeonFlocks.length;e++)this.environment.levelController.pigeonFlocks[e].update(t,this.player)}setState(t){switch(this.currentState){case this.States.FLY_OVER:this.gameUI.setIntroVisible(!1)}switch(this.currentState=t,this.currentState){case this.States.TUTORIAL:this.cameraController.setMode(y.Modes.RUN),this.tutorialManager.restartTutorial(),this.gameUI.tutorialUI.setVisible(!0),this.game.soundManager.getSound("run").pause();break;case this.States.FLY_OVER:this.gameUI.setIntroVisible(!0);break;case this.States.COUNT_DOWN:this.cameraController.setMode(y.Modes.RUN),this.gameUI.setCountdownTextVisible(!0),this.sndCountdown.play();break;case this.States.WON:this.delay=this.WON_DELAY,this.sndFinish.play();break;case this.States.DEATH:this.delay=this.DEATH_DELAY}}startGameOverState(t){this.game.state.start("gameOver",!0,!1,this.levelIndex,t,Math.floor(this.elapsedTime))}setPaused(t){this.bPaused=t}isPaused(){return this.bPaused}}),et.state.add("gameOver",new class extends d{init(t,e,s,...i){super.init({key:"gameOverState",url:"data/gameOverPack.json"},...i),this.levelIndex=t,this.bWon=e,this.elapsedTime=s}createOnce(){super.createOnce(),this.config=this.game.cache.getJSON("config"),this.storage=new a.a.Storage(this.config.toggoKey),this.sndClick=this.game.soundManager.getSound("click"),this.sndScore=this.game.soundManager.getSound("score"),this.sndStar=this.game.soundManager.getSound("star")}create(){super.create(),this.totalStarCount=b.getTotalStarCount(this.storage),this.saveStatsToLocalStorage(),this._createUI(),this.game.toggoApi.showMidRoll(),this.game.add.tween(this.txtTitle.scale).to({x:1,y:1},1e3,Phaser.Easing.Back.Out,!0,0,0,!1),this.game.time.events.add(1,()=>{this.bWon&&this.elapsedTime<=b.Levels[this.levelIndex].time[0]?this.playStarAnimations():this.onTimeTweenDone()})}saveStatsToLocalStorage(){this.bWon&&(this.lastStarsEarned=b.getStarCount(this.storage,this.levelIndex),this.starsEarned=b.getStarCountViaElapsedTime(this.levelIndex,this.elapsedTime),this.starsEarned>this.lastStarsEarned&&b.setStarCount(this.storage,this.levelIndex,this.starsEarned),this.lastTimeElapsed=b.getLevelTime(this.storage,this.levelIndex),this.elapsedTime<this.lastTimeElapsed&&b.setLevelTime(this.storage,this.levelIndex,this.elapsedTime))}playStarAnimations(){for(var t=0,e=null,s=null,i=0;i<b.Levels[this.levelIndex].time.length;i++)if(0!==i){var a=e-(s=b.Levels[this.levelIndex].time[i]);t+=.2*((e-r.S.clamp(this.elapsedTime,s,e))/a),e=b.Levels[this.levelIndex].time[i]}else t+=.2,e=b.Levels[this.levelIndex].time[i];var n=0;this.starTween=null;var o=[.2,.4,.6,.8,1],l=this.game.add.tween(this.lblBar.scale).to({x:t},600*this.starsEarned,Phaser.Easing.Linear.None,!0,500);l.onUpdateCallback(()=>{o[n]&&this.lblBar.scale.x>=o[n]&&(this.startStarTween(n,o),n++)}),l.onComplete.add(()=>{o[n]&&!this.starTween.isRunning&&this.startStarTween(n,o),this.onBarAnimationDone()})}startStarTween(t,e){this.lblBar.scale.x>=e[t]&&(this.starTween=this.game.add.tween(this.lblStars[t].scale).to({x:1,y:1},400,Phaser.Easing.Back.Out,!0,0,0,!1),this.starTween.onStart.add(()=>{this.txtStarCount.setText(t+1),this.sndStar.play()}))}onBarAnimationDone(){var t={timeLerp:0},e=this.game.add.tween(t).to({timeLerp:this.elapsedTime},1e3,Phaser.Easing.Linear.None,!0,400);e.onStart.add(()=>{this.sndScore.play("",0,1,!0,!1)}),e.onUpdateCallback(()=>{this.txtTime.setText(Z.getMMSS(Math.round(t.timeLerp)))}),e.onComplete.add(()=>{this.txtTime.setText(Z.getMMSS(Math.round(t.timeLerp))),this.sndScore.stop(),this.onTimeTweenDone()})}onTimeTweenDone(){var t=!1,e=!1;this.tweenInButton(this.btnReplay,1e3,0,!1).onComplete.add(()=>{t&&this.pulsateButton(this.btnReplay,700,0,!0)}),this.tweenInButton(this.btnLevel,1e3,200,!1).onComplete.add(()=>{e&&this.pulsateButton(this.btnLevel,700,0,!0)}),this.checkNextLevel()?e=!0:t=!0}tweenInButton(t,e,s,i=!1){var a=t.scale.x,n=t.scale.y;t.scale.set(0,0),t.visible=!0;var o=i?-1:0;return this.game.add.tween(t.scale).to({x:a,y:n},e,Phaser.Easing.Back.Out,!0,s,o,!1)}pulsateButton(t,e,s,i=!1){t.scale.set(.7,.7),t.visible=!0;var a=i?-1:0,n=1.06*t.scale.x,o=1.06*t.scale.y;return this.game.add.tween(t.scale).to({x:n,y:o},e,Phaser.Easing.Linear.None,!0,s,a,!0)}_createUI(){this.layout=new n.a.Layout(this.game,this.game.cache.getLayout("layout_result")),this.layout.setup(),this.game.world.add(this.layout),this.txtTitle=this.layout.getElementById("textResultsTitle"),this.txtTitleLost=this.layout.getElementById("textResultsTitleLost"),this.txtTitle.scale.set(0,0),this.txtTitleLost.visible=!this.bWon,this.txtTitle.visible=this.bWon,this.btnReplay=this.layout.getElementById("buttonReplay"),this.btnReplay.onDownSound=this.sndClick,this.btnReplay.onInputUp.add(this.startCurrentLevel,this),this.btnReplay.visible=!1,this.btnLevel=this.layout.getElementById("buttonLevelSelection"),this.btnLevel.onDownSound=this.sndClick,this.btnLevel.visible=!1,this.checkNextLevel()&&this.isNextTheLastPlayableLevel()?(this.btnLevel.onInputUp.add(this.startNextLevel,this),H.setButtonText(this.btnLevel,H.getLocalizedText(this.game,"__nextLevel"))):(this.btnLevel.onInputUp.add(this.startLevelSelectState,this),H.setButtonText(this.btnLevel,H.getLocalizedText(this.game,"__levelSelect"))),this.txtStarCount=this.layout.getElementById("textStarAmount"),this.txtStarCount.setText(0),this.txtTime=this.layout.getElementById("varTextTime"),this.txtTime.setText(Z.getMMSS(0)),this.lblBar=this.layout.getElementById("labelTimebarFull"),this.lblBar.scale.set(0,1),this.lblStars=[];for(var t=0;t<b.Levels[this.levelIndex].time.length;t++)this.lblStars[t]=this.layout.getElementById("labelStarFull_0".concat(t+1)),this.lblStars[t].scale.set(0,0),this.layout.getElementById("varTextTimeToBeat_0".concat(t+1)).setText(Z.getMMSS(b.Levels[this.levelIndex].time[t]));var e=this.layout.getElementById("buttonAudio");this.game.sound.mute&&e.useState("muted"),e.onInputUp.add(()=>{"default"===e.getCurrentStateName()?(this.game.sound.mute=!0,e.useState("muted")):(this.game.sound.mute=!1,e.useState("default"))}),p.addIntroTweenShui(this.game,e,!0,!0),this.game.localizer.initGroup(this.layout)}resize(){super.resize()}startCurrentLevel(){this.game.state.start("game",!0,!1,this.levelIndex)}startNextLevel(){this.game.state.start("game",!0,!1,this.levelIndex+1)}startLevelSelectState(){this.game.state.start("levelSelect",!0,!1,this.levelIndex+1)}checkNextLevel(){return this.levelIndex<b.Levels.length-1&&b.getTotalStarCount(this.storage)>=b.Levels[this.levelIndex+1].unlockStarsCount}isNextTheLastPlayableLevel(){var t=this.levelIndex+1;return!(t<b.Levels.length-1&&this.totalStarCount>=b.Levels[t+1].unlockStarsCount)}}),et.state.start("boot",!0,!1,"menu",[],{key:"base",url:"data/basePack.json"})}]);