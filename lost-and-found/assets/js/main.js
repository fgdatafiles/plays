!function(){"use strict";var a="Game_Progress",b=include("springroll.Application"),c=include("springroll.pixi.PixiDisplay"),d=new b({name:"Cave Hunt",canvasId:"stage",configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",display:c,displayOptions:{clearView:!0,transparent:!0,antiAlias:!0,forceContext:"webgl"},enableHiDPI:!0,preload:[{id:"saveData",cache:!1,async:function(b){d.userData.read(a,function(a){d.saveData=a,b()}.bind(this))}},{id:"loading-atlas",image:"assets/images/loading-atlas.png",atlas:"assets/images/loading-atlas.json",type:"pixi"},{id:"popup-atlas",image:"assets/images/challenges/popup-atlas.png",atlas:"assets/images/challenges/popup-atlas.json",type:"pixi"},{id:"play-button-atlas",image:"assets/images/play-button-atlas.png",atlas:"assets/images/play-button-atlas.json",type:"pixi"}],responsive:!0,state:"splash-screen",uniformResize:!1,version:"0.0.1"});d.save=function(){this.userData.write(a,this.saveData)},d.trackEvent=function(a,b){a=a.replace("-challenge",""),a=a.replace("-"," "),ga("send",{hitType:"event",eventCategory:"CH",eventAction:a,eventLabel:b})},d.on("init",function(){this.saveData||(this.saveData={}),this.sound.setContextVolume("music",this.config.data.musicVolume),this.sound.setContextVolume("vo",this.config.data.voVolume),this.sound.setContextVolume("sfx",this.config.data.sfxVolume),TweenMax.ticker.useRAF(!0),TweenLite.ticker.useRAF(!0),this.states["intro-screen"].preload=this.config.assets.intro,this.states["map-screen"].preload=this.config.assets.map,this.states["dance-screen"].preload=this.config.assets.dance,this.states["vault-screen"].preload=this.config.assets.vault,this.states["flashlight-challenge"].preload=this.config.assets.flashlight,this.states["duster-challenge"].preload=this.config.assets.duster,this.states["compass-challenge"].preload=this.config.assets.compass,this.states["hidden-falls"].preload.union(this.config.assets.game),this.states["colossal-caves"].preload.union(this.config.assets.game),this.states["critter-cavern"].preload.union(this.config.assets.game),this.addLoadingScreen(),this.manager.on("onLoadingStart",this.onLoadingStart.bind(this))}),d.addLoadingScreen=function(){this.loadingAtlas=this.getCache("loading-atlas"),this.background=new PIXI.Sprite(this.loadingAtlas.getFrame("loading-bg")),this.background.anchor.set(.5),this.maxFrames=4,this.maxLetters=7,this.background.letters=this.config.data.letters;for(var a=0;a<this.maxLetters;a++){var b=this.background.letters[a],c=new PIXI.Sprite(this.loadingAtlas.getFrame(b.name+"-dim"));c.name=b.name,c.anchor.set(.5),c.x=b.x,c.y=b.y,this.background.addChild(c),this.background.letters[a]=c}this.resizeLoading()},d.on("resize",function(){this.resizeLoading()}),d.on("paused",function(){TweenMax.pauseAll()}),d.on("resumed",function(){TweenMax.resumeAll()}),d.resizeLoading=function(){if(this.background){var a=this.display.width,b=this.display.height,c=512,d=384,e={width:1024,height:768},f=e.width/e.height,g=a/b,h=g>f?b/e.height:a/e.width;this.background.scale.set(h),this.background.x=c*a/e.width,this.background.y=d*h}},d.onLoadingStart=function(){this.showLoading(),this.resetLetters(),this.animateLoading(0,1)},d.resetLetters=function(){for(var a=0;a<this.maxLetters;a++){var b=this.background.letters[a];b.texture=this.loadingAtlas.getFrame(b.name+"-dim")}},d.animateLoading=function(a,b){var c=this.background.letters[a],d=this.config.data.frames[b];c.texture=this.loadingAtlas.getFrame(c.name+"-"+d),TweenMax.delayedCall(.1,this.fillComplete.bind(this,a,b))},d.fillComplete=function(a,b){return!this.manager.isLoading&&this.manager.currentState.enabled&&a>=this.maxLetters-1&&b>=this.maxFrames-1?(this.manager.currentState.triggerOnChildren("enter-scene"),void this.hideLoading()):(a++,a>=this.maxLetters&&(a=0,b++,b>=this.maxFrames&&(b=1)),void this.animateLoading(a,b))},d.showLoading=function(){this.background&&!this.background.parent&&this.display.stage.addChild(this.background)},d.hideLoading=function(){this.background&&this.background.parent&&this.display.stage.removeChild(this.background)},window.app=d}(),function(){var a={Objects:{Helmet:"Helmet",FirstAid:"FirstAid",Backpack:"Backpack",Boot:"Boot",Notebook:"Notebook"},Directions:{East:"East",West:"West",North:"North",South:"South"},Tunnels:{HiddenFalls:"hidden-falls",CritterCavern:"critter-cavern",ColossalCaves:"colossal-caves"},keys:{flashlight:"flashlight-challenge",duster:"duster-challenge",compass:"compass-challenge"},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return a.isMobile.Android()||a.isMobile.BlackBerry()||a.isMobile.iOS()||a.isMobile.Opera()||a.isMobile.Windows()}}};namespace("cave_hunt").Constants=a}(),function(){var a=include("PIXI.Container"),b=function(b){a.call(this),this.owner=b},c=extend(b,a);c.show=function(a){a.addChild(this),this.addEventListeners(),this.display(),platypus.game.app.sound.play("Pop_Up_Display")},c.display=function(){this.scale.set(.8),TweenMax.to(this.scale,.5,{x:1,y:1,ease:Elastic.easeOut})},c.hide=function(a){this.removeEventListeners(),this.scale.set(1),TweenMax.to(this.scale,.5,{x:.8,y:.8,ease:Elastic.easeIn,onComplete:this.remove.bind(this,a)}),platypus.game.app.sound.play("Pop_Up_Remove")},c.remove=function(a){this.owner.triggerEvent("popup-close",a),this.parent.removeChild(this)},c.addEventListeners=function(){},c.removeEventListeners=function(){},namespace("cave_hunt").BasePopup=b}(),function(){var a=include("springroll.pixi.Button"),b=function(b,c,d){a.call(this,b,c,d),this.app=platypus.game.app,this.on("buttonOver",this.onOver),this.on("buttonOut",this.buttonOut),this.on("buttonPress",this.onPress)},c=a.prototype,d=extend(b,a);d.onOver=function(){if(this.app.sound.play("Button_Rollover"),!this.tl){var a=.05,b=2*(Math.PI/180);this.tl=new TimelineMax({repeat:-1}),this.tl.to(this,a,{rotation:b,ease:Linear.easeNone}).to(this,a,{rotation:0,ease:Linear.easeNone}).to(this,a,{rotation:-b,ease:Linear.easeNone}).to(this,a,{rotation:0,ease:Linear.easeNone})}this.tl.play()},d.onPress=function(){this.app.sound.play("Button_Tap")},d.buttonOut=function(){this.tl&&this.tl.stop(),this.rotation=0},d.destroy=function(){this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.off("buttonOver",this.onOver),this.off("buttonOut",this.buttonOut),this.off("buttonPress",this.onPress),this.parent&&this.parent.removeChild(this),c.destroy.call(this),this.app=null},namespace("cave_hunt").ChallengeButton=b}(),function(){var a=include("springroll.pixi.Button"),b=function(b,c,d){a.call(this,b,c,d),this.app=platypus.game.app,this.on("buttonOver",this.onOver),this.on("buttonOut",this.buttonOut),this.on("buttonPress",this.onPress)},c=a.prototype,d=extend(b,a);d.onOver=function(){this.app.sound.play("Button_Rollover")},d.onPress=function(){this.app.sound.play("Button_Tap")},d.buttonOut=function(){this.rotation=0},d.destroy=function(){this.off("buttonOver",this.onOver),this.off("buttonPress",this.onPress),c.destroy.call(this),this.app=null},namespace("cave_hunt").CustomButton=b}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.CustomButton"),c=function(b){a.call(this,b),this.onPlay=this.onPlay.bind(this),this.init()},d=extend(c,a),e=a.prototype;d.show=function(a,b,c){var d=null;d="magnifying-glass-water"==b?platypus.game.app.config.data.waterFunfacts[c]:platypus.game.app.config.data.funfacts[c],this.image.texture=this.popupAtlas.getFrame(d.image),this.title.text=d.name.toUpperCase(),e.show.call(this,a),platypus.game.app.voPlayer.play(d.vos.shuffle()[0])},d.init=function(){this.scrim=(new PIXI.Graphics).beginFill(0,.4),this.scrim.drawRect(-900,-500,1800,1e3),this.addChild(this.scrim),this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.title=new PIXI.extras.BitmapText("NAME",{font:"60px popupsFont",align:"center",tint:16777215}),this.title.y=-170,this.title.anchor.set(.5),this.addChild(this.title),this.image=new PIXI.Sprite,this.image.anchor.set(.5),this.image.y=-30,this.addChild(this.image),this.playButton=new b({up:this.popupAtlas.getFrame("popup-play-btn-big-normal"),over:this.popupAtlas.getFrame("popup-play-btn-big-over"),down:this.popupAtlas.getFrame("popup-play-btn-big-over")}),this.addChild(this.playButton);var a=this.popupAtlas.getFrame("popup-play-btn-big-normal");this.playButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.playButton.y=160},d.addEventListeners=function(){this.playButton.enabled=!0,this.playButton.on("buttonPress",this.onPlay)},d.removeEventListeners=function(){this.playButton.off("buttonPress",this.onPlay)},d.onPlay=function(){platypus.game.app.gamePaused||(this.playButton.enabled=!1,platypus.game.app.sound.play("Button_Tap"),platypus.game.app.voPlayer.stop(),this.hide("restart"))},namespace("cave_hunt").FunfactPopup=c}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.Constants"),c=include("cave_hunt.CustomButton"),d=function(b){a.call(this,b),this.onPlay=this.onPlay.bind(this),this.init()},e=extend(d,a),f=a.prototype;e.show=function(a){var c="popup-waterfall",d=this.owner.parent.id;d==b.Tunnels.ColossalCaves?(c="popup-obstacles",this.titleField.text="COLOSSAL CAVES",platypus.game.app.voPlayer.play("CH_Tunnel_ColossalC_Intro_Pop_1_NC"),this.image.y=20):d==b.Tunnels.HiddenFalls?(c="popup-waterfall",this.titleField.text="HIDDEN FALLS",platypus.game.app.voPlayer.play("CH_Tunnel_HF_Intro_Pop_1_NC"),this.image.y=20):d==b.Tunnels.CritterCavern&&(platypus.game.app.voPlayer.play("CH_Tunnel_CritterC_Intro_Pop_1_NC"),c="popup-find",this.titleField.text="CRITTER CAVERN",this.image.y=0),this.image.texture=this.popupAtlas.getFrame(c),f.show.call(this,a)},e.init=function(){this.scrim=(new PIXI.Graphics).beginFill(0,.4),this.scrim.drawRect(-900,-500,1800,1e3),this.addChild(this.scrim),this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.titleField=new PIXI.extras.BitmapText("",{font:"60px popupsFont",align:"center",tint:16777215}),this.titleField.anchor.set(.5),this.titleField.y=-180,this.addChild(this.titleField),this.image=new PIXI.Sprite,this.image.scale.set(.8),this.image.anchor.set(.5),this.addChild(this.image),this.playButton=new c({up:this.popupAtlas.getFrame("popup-play-btn-big-normal"),down:this.popupAtlas.getFrame("popup-play-btn-big-over"),over:this.popupAtlas.getFrame("popup-play-btn-big-over")}),this.addChild(this.playButton);var a=this.popupAtlas.getFrame("popup-play-btn-big-normal");this.playButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.playButton.y=175},e.addEventListeners=function(){this.playButton.on("buttonPress",this.onPlay)},e.removeEventListeners=function(){this.playButton.off("buttonPress",this.onPlay)},e.onPlay=function(){platypus.game.app.gamePaused||(platypus.game.currentScene.id==b.Tunnels.ColossalCaves?platypus.game.app.voPlayer.play(["CH_Tunnel_ColossalC_Start_1_Daisy","CH_Tunnel_ColossalC_Start_2_Daisy"]):platypus.game.currentScene.id==b.Tunnels.HiddenFalls?platypus.game.app.voPlayer.play(["CH_Tunnel_HF_Start_1_Hal","CH_Tunnel_HF_Start_2_Hal"]):platypus.game.currentScene.id==b.Tunnels.CritterCavern&&platypus.game.app.voPlayer.play(["CH_Tunnel_CritterC_Start_1_Squeeks","CH_Tunnel_CritterC_Start_2_Squeeks"]),this.playButton.enabled=!1,platypus.game.app.sound.play("Tunnel_Start",{delay:.5}),this.hide("start"))},namespace("cave_hunt").InstructionPopup=d}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.CustomButton"),c=function(b){a.call(this,b),this.init()},d=extend(c,a),e=a.prototype;d.show=function(a){e.show.call(this,a),platypus.game.app.sound.play("Pop_Up_Fail",{delay:.5})},d.init=function(){this.scrim=(new PIXI.Graphics).beginFill(0,.4),this.scrim.drawRect(-900,-500,1800,1e3),this.addChild(this.scrim),this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-lose-bg")),this.bg.anchor.set(.5),this.addChild(this.bg);var a=this.popupAtlas.getFrame("popup-home-btn-normal");this.homeButton=new b({up:this.popupAtlas.getFrame("popup-home-btn-normal"),down:this.popupAtlas.getFrame("popup-home-btn-over"),over:this.popupAtlas.getFrame("popup-home-btn-over")}),this.homeButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.homeButton),this.homeButton.x=125,this.homeButton.y=135,a=this.popupAtlas.getFrame("popup-replay-btn-normal"),this.replayButton=new b({up:this.popupAtlas.getFrame("popup-replay-btn-normal"),down:this.popupAtlas.getFrame("popup-replay-btn-over"),over:this.popupAtlas.getFrame("popup-replay-btn-over")}),this.replayButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.replayButton),this.replayButton.x=-125,this.replayButton.y=135},d.addEventListeners=function(){this.homeButton.on("buttonPress",this.onPointerDown.bind(this,"map")),this.replayButton.on("buttonPress",this.onPointerDown.bind(this,"replay"))},d.removeEventListeners=function(){this.homeButton.off("buttonPress",this.onPointerDown),this.replayButton.off("buttonPress",this.onPointerDown)},d.onPointerDown=function(a){platypus.game.app.gamePaused||(platypus.game.app.voPlayer.stop(),this.hide(a))},namespace("cave_hunt").LosePopup=c}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.CustomButton"),c=function(b){a.call(this,b),this.onPlay=this.onPlay.bind(this),this.init()},d=extend(c,a);a.prototype;d.init=function(){this.scrim=(new PIXI.Graphics).beginFill(0,.4),this.scrim.drawRect(-900,-500,1800,1e3),this.addChild(this.scrim),this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg);var a=this.popupAtlas.getFrame("popup-home-btn-over");this.homeButton=new b({up:this.popupAtlas.getFrame("popup-home-btn-normal"),down:this.popupAtlas.getFrame("popup-home-btn-over"),over:this.popupAtlas.getFrame("popup-home-btn-over")}),this.homeButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.homeButton.x=125,this.homeButton.y=125,this.addChild(this.homeButton),this.playButton=new b({up:this.popupAtlas.getFrame("popup-play-btn-large-normal"),down:this.popupAtlas.getFrame("popup-play-btn-large-over"),over:this.popupAtlas.getFrame("popup-play-btn-large-over")}),this.addChild(this.playButton),a=this.popupAtlas.getFrame("popup-play-btn-large-normal"),this.playButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.playButton.y=-90,this.replayButton=new b({up:this.popupAtlas.getFrame("popup-replay-btn-normal"),down:this.popupAtlas.getFrame("popup-replay-btn-over"),over:this.popupAtlas.getFrame("popup-replay-btn-over")}),a=this.popupAtlas.getFrame("popup-replay-btn-normal"),this.replayButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.replayButton.x=-125,this.replayButton.y=125,this.addChild(this.replayButton)},d.addEventListeners=function(){this.playButton.enabled=!0,this.replayButton.enabled=!0,this.homeButton.enabled=!0,this.playButton.on("buttonPress",this.onPlay.bind(this,"unpause")),this.replayButton.on("buttonPress",this.onPlay.bind(this,"replay")),this.homeButton.on("buttonPress",this.onPlay.bind(this,"map"))},d.removeEventListeners=function(){this.playButton.off("buttonPress",this.onPlay),this.replayButton.off("buttonPress",this.onPlay),this.homeButton.off("buttonPress",this.onPlay)},d.onPlay=function(a){this.playButton.enabled=!1,this.replayButton.enabled=!1,this.homeButton.enabled=!1,platypus.game.app.sound.play("Button_Tap"),this.hide(a)},namespace("cave_hunt").PausePopup=c}(),function(){var a=include("PIXI.Container"),b=function(b,c,d,e,f){a.call(this),this.x=c,this.y=d,this.stars=[],this.key=f,this.init(e),this.checkStars()},c=extend(b,a);c.init=function(a){this.atlas=platypus.game.app.getCache("popup-atlas");for(var b=this.getPrevStars(this.key),c=0;3>c;c++){var d=new PIXI.Sprite;d.x=-a+c*a,d.anchor.set(.5),this.addChild(d),this.stars.push(d),b>0&&b>c?d.texture=this.atlas.getFrame("small-star-fill"):d.texture=this.atlas.getFrame("small-star-empty")}},c.animate=function(a,b){for(var c=0,d=a;b>d;d++)TweenMax.delayedCall(1+.5*c,this.update.bind(this,d)),++c},c.update=function(a){var b=this.stars[a];b.texture=this.atlas.getFrame("small-star-fill"),TweenMax.to(b.scale,.2,{x:1.5,y:1.5,ease:Elastic.sineOut}),TweenMax.to(b.scale,.2,{x:1,y:1,ease:Elastic.sineIn,delay:.2}),platypus.game.app.sound.play("Star_Awarded")},c.checkStars=function(){var a=this.getPrevStars(this.key),b=this.getStars(this.key);0>=a&&(this.willAnimate=!0),b>a&&(this.animate(a,b),platypus.game.app.saveData[this.key].prevStars=b,platypus.game.app.save())},c.getPrevStars=function(a){return platypus.game.app.saveData[a]&&platypus.game.app.saveData[a].prevStars?platypus.game.app.saveData[a].prevStars:0},c.getStars=function(a){return platypus.game.app.saveData[a]?platypus.game.app.saveData[a].stars:0},c.clear=function(a){for(var b=0;3>b;b++)this.stars[b].parent.removeChild(this.stars[b]),this.stars[b]=null;this.stars=[],TweenMax.killAll()},namespace("cave_hunt").Stars=b}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.CustomButton"),c=function(b){a.call(this,b),this.onPointerDown=this.onPointerDown.bind(this),this.init()},d=extend(c,a),e=a.prototype;d.show=function(a){this.saveProgress(),this.updateStars(),e.show.call(this,a),platypus.game.app.voPlayer.play(["CH_Tunnel__ALL_Success_1_NC","CH_Tunnel__ALL_Success_2_NC"].shuffle()[0]),platypus.game.app.sound.play("Pop_Up_Win_Reveal",{delay:.5})},d.init=function(){this.scrim=(new PIXI.Graphics).beginFill(0,.4),this.scrim.drawRect(-900,-500,1800,1e3),this.addChild(this.scrim),this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-win-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.counterField=new PIXI.extras.BitmapText("YOU FOUND "+platypus.game.app.wormsCount.toString(),{font:"60px popupsFont",align:"center",tint:16777215}),this.counterField.anchor.set(.5),this.counterField.y=-50,this.addChild(this.counterField);var a=this.popupAtlas.getFrame("popup-play-btn-big-normal");this.playButton=new b({up:this.popupAtlas.getFrame("popup-play-btn-big-normal"),down:this.popupAtlas.getFrame("popup-play-btn-big-over"),over:this.popupAtlas.getFrame("popup-play-btn-big-over")}),this.playButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.playButton),this.playButton.x=125,this.playButton.y=200,this.glowWorm=new PIXI.Sprite(this.popupAtlas.getFrame("glow-worm")),this.glowWorm.anchor.set(0,.5),this.glowWorm.scale.set(.8),this.counterField.x=.56*-this.glowWorm.width,this.glowWorm.x=this.counterField.x+.56*this.counterField.width,this.glowWorm.y=this.counterField.y,this.addChild(this.glowWorm),a=this.popupAtlas.getFrame("popup-replay-btn-normal"),this.replayButton=new b({up:this.popupAtlas.getFrame("popup-replay-btn-normal"),down:this.popupAtlas.getFrame("popup-replay-btn-over"),over:this.popupAtlas.getFrame("popup-replay-btn-over")}),this.replayButton.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.replayButton),this.replayButton.x=-125,this.replayButton.y=200,this.stars=[],this.addStars()},d.addStars=function(){for(var a=-150,b=0;3>b;b++){var c=new PIXI.Sprite(this.popupAtlas.getFrame("star-empty"));c.anchor.set(.5),c.x=a+150*b,c.y=50,this.addChild(c),this.stars.push(c)}},d.saveProgress=function(){var a=this.owner.parent.id,b=this.calcStars(),c=0;platypus.game.app.saveData[a]&&platypus.game.app.saveData[a].stars?c=platypus.game.app.saveData[a].stars:platypus.game.app.saveData[a]={},b>c&&(c=b),platypus.game.app.saveData[a].stars=c,platypus.game.app.save(),b>=3&&platypus.game.app.trackEvent("Tunnel "+a,"Three stars")},d.calcStars=function(){var a=platypus.game.app.wormsCount,b=0;return 20>=a?b=1:a>=21&&33>=a?b=2:a>=34&&(b=3),b},d.updateStars=function(){for(var a=this.calcStars(),b=0;a>b;b++)TweenMax.delayedCall(1+.5*b,this.update.bind(this,b))},d.update=function(a){var b=this.stars[a];b.texture=this.popupAtlas.getFrame("star-fill"),TweenMax.to(b.scale,.2,{x:1.5,y:1.5,ease:Elastic.sineOut}),TweenMax.to(b.scale,.2,{x:1,y:1,ease:Elastic.sineIn,delay:.2}),platypus.game.app.sound.play("Star_Awarded")},d.addEventListeners=function(){this.playButton.on("buttonPress",this.onPointerDown.bind(this,"challenge")),this.replayButton.on("buttonPress",this.onPointerDown.bind(this,"replay"))},d.removeEventListeners=function(){this.playButton.off("buttonPress",this.onPointerDown),this.replayButton.off("buttonPress",this.onPointerDown)},d.onPointerDown=function(a){platypus.game.app.gamePaused||(platypus.game.app.voPlayer.stop(),this.hide(a))},namespace("cave_hunt").WinPopup=c}(),function(){var a=include("cave_hunt.BasePopup"),b=function(b){a.call(this,b),this.onPointerDown=this.onPointerDown.bind(this),this.states={intro:"intro",win:"win",lose:"lose"},this.init()},c=extend(b,a),d=a.prototype;c.show=function(a,b,c,e){b==this.states.intro?this.addCircle(16777215):b==this.states.win&&this.addCircle(3407769),this.addTitleText(c),this.addItem(e),this.state=b,d.show.call(this,a),this.display()},c.init=function(){this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("PopupBackground_Empty")),this.bg.anchor.set(.5),this.addChild(this.bg),this.text=new PIXI.Text("",{fontFamily:"Arial",fontSize:36,fill:0,align:"center"}),this.text.y=-150,this.text.anchor.set(.5),this.addChild(this.text),this.circle=new PIXI.Graphics,this.addChild(this.circle),this.item=new PIXI.Sprite,this.item.anchor.set(.5),this.addChild(this.item),this.button=new PIXI.Sprite(this.popupAtlas.getFrame("PlayButton_Normal")),this.button.anchor.set(.5),this.addChild(this.button),this.button.interactive=!0,this.button.buttonMode=!0,this.button.y=150},c.addItem=function(a){this.item.texture=this.popupAtlas.getFrame(a)},c.addTitleText=function(a){this.text.text=a},c.addCircle=function(a){this.circle.clear(),this.circle.lineStyle(2,0,1),this.circle.beginFill(a,1),this.circle.drawEllipse(0,0,100,100),this.circle.endFill()},c.addEventListeners=function(){this.button.on("pointerdown",this.onPointerDown)},c.removeEventListeners=function(){this.button.off("pointerdown",this.onPointerDown)},c.onPointerDown=function(){this.state==this.states.intro?this.hide("play"):this.state==this.states.win&&this.hide("home")},namespace("cave_hunt").Popup=b}(),function(){var a=include("PIXI.Container"),b=function(b){a.call(this),this.bg=null,this.object=null,this.name=b,this.init()},c=extend(b,a);c.init=function(){this.hudAtlas=platypus.game.app.getCache("hud-atlas"),this.bg=new PIXI.Sprite(this.hudAtlas.getFrame("ObjectHolderBox1")),this.bg.anchor.set(.5),this.addChild(this.bg),this.objectsAtlas=platypus.game.app.getCache("objects-atlas");var a=this.objectsAtlas.getFrame(this.name+"-Dulled");a||(a=this.objectsAtlas.getFrame(this.name+"-B_W")),this.object=new PIXI.Sprite(a),this.object.anchor.set(.5),this.addChild(this.object)},c.highlight=function(){this.object.texture=this.objectsAtlas.getFrame(this.name+"-B_W"),this.bg.texture=this.hudAtlas.getFrame("ObjectHolderBox1-BumpHighlight")},c.collected=function(){this.object.texture=this.objectsAtlas.getFrame(this.name+"-Color"),this.bg.texture=this.hudAtlas.getFrame("ObjectHolderBox1-Lit")},namespace("cave_hunt").TargetObject=b}(),function(){var a=include("PIXI.Container"),b=function(b,c){a.call(this),this.name=b,this.objectName=c,this.bg=null,this.object=null,this.init()},c=extend(b,a);c.init=function(){this.compassAtlas=platypus.game.app.getCache("compass-atlas"),this.bg=new PIXI.Sprite(this.compassAtlas.getFrame(this.name)),this.bg.anchor.set(.5),this.addChild(this.bg),this.objectName&&(this.object=new PIXI.Sprite(this.compassAtlas.getFrame(this.objectName+"-Dulled")),this.object.anchor.set(.5,.65),this.object.scale.set(.98),this.addChild(this.object))},c.highlight=function(){this.object.texture=this.compassAtlas.getFrame(this.objectName+"-B_W"),this.bg.texture=this.compassAtlas.getFrame(this.name+"-Highlight")},c.collected=function(){this.object.texture=this.compassAtlas.getFrame(this.objectName+"-Color"),this.bg.texture=this.compassAtlas.getFrame(this.name)},namespace("cave_hunt").PhotoSpot=b}(),function(){var a=include("PIXI.Container"),b=include("cave_hunt.Constants"),c=function(){a.call(this),this.state=null,this.prevValue=0,this.init(),this.unhighlight()},d=extend(c,a);d.init=function(){this.compassAtlas=platypus.game.app.getCache("compass-atlas"),this.bg=new PIXI.Sprite(this.compassAtlas.getFrame("CompassBack")),this.bg.anchor.set(.5),this.addChild(this.bg),this.highlightSprite=new PIXI.Sprite(this.compassAtlas.getFrame("CompassDirectionHighlight")),this.highlightSprite.anchor.set(.5),this.addChild(this.highlightSprite),this.directionSprite=new PIXI.Sprite(this.compassAtlas.getFrame("CompassDirections")),this.directionSprite.anchor.set(.5),this.addChild(this.directionSprite),this.needle=new PIXI.Sprite(this.compassAtlas.getFrame("CompassArrow")),this.needle.anchor.set(.48),this.addChild(this.needle)},d.unhighlight=function(){this.highlightSprite.visible=!1,this.highlightSprite.tint=16777215},d.highlight=function(a,c){var d=this.getPosition(a);if(this.highlightSprite.x=d.x,this.highlightSprite.y=d.y,this.highlightSprite.visible=!0,c&&(this.highlightSprite.tint=65280),a==b.Directions.West?this.needle.y=4:a==b.Directions.South?this.needle.x=4:this.needle.x=this.needle.y=0,this.state!=a){var e=this.getRotation(this.prevValue,d.value);TweenMax.to(this.needle,1.5,{rotation:this.needle.rotation+e,ease:Elastic.easeOut}),this.state=a,this.prevValue=d.value}},d.getRotation=function(a,b){var c=b-a;return 1==c||3==a&&0===b?.5*Math.PI:-1==c||0===a&&3==b?.5*-Math.PI:2==Math.abs(c)?Math.PI:0},d.getPosition=function(a){var c={};switch(a){case b.Directions.East:c.x=100,c.y=0,c.value=0;break;case b.Directions.West:c.x=-95,c.y=0,c.value=2;break;case b.Directions.North:c.x=5,c.y=-95,c.value=3;break;case b.Directions.South:c.x=3,c.y=95,c.value=1}return c},namespace("cave_hunt").Compass=c}(),function(){var a=include("PIXI.Container"),b=include("cave_hunt.Constants"),c=include("springroll.pixi.AdvancedMovieClip"),d=function(b){a.call(this),this.body=null,this.owner=b,this.tile=null,this.init()},e=extend(d,a);e.init=function(){platypus.game.app.getCache("compass-atlas");this.body=new c(platypus.game.app.getCache("DaisyAnim"),platypus.game.app.getCache("DaisyAtlas")),this.body.scale.set(.4),this.body.anchor.set(.5,.6),this.addChild(this.body),platypus.game.app.animator.play(this.body,"idle"),this.rotateTo(b.Directions.North)},e.rotateTo=function(a){var c=0;switch(a){case b.Directions.East:c=-90;break;case b.Directions.West:c=-270;break;case b.Directions.North:c=-180}c=c*Math.PI/180,TweenMax.to(this,.1,{rotation:c})},e.move=function(a,c,d){return this.rotateTo(d),platypus.game.app.animator.play(this.body,"jump"),c=c||!1,this.tile=a,c?(TweenMax.to(this,.7,{x:a.position.x,y:a.position.y,onComplete:this.jumpComplete.bind(this)}),void(d==b.Directions.North?platypus.game.app.sound.play("Challenge_Compass_Daisy_Hop_N"):d==b.Directions.South?platypus.game.app.sound.play("Challenge_Compass_Daisy_Hop_S"):(d==b.Directions.East||d==b.Directions.West)&&platypus.game.app.sound.play("Challenge_Compass_Daisy_Hop_E_W"))):void(this.position=a.position)},e.jumpComplete=function(){platypus.game.app.animator.play(this.body,"idle")},namespace("cave_hunt").Daisy=d}(),function(){var a=include("PIXI.Container"),b=function(b,c,d){a.call(this),this.name=b,this.bg=null,this.row=c,this.col=d,this.isWall=!1,this.hasCritter=!1,this.dir=null,this.init()},c=extend(b,a);c.init=function(){this.compassAtlas=platypus.game.app.getCache("compass-atlas"),this.bg=new PIXI.Sprite(this.compassAtlas.getFrame(this.name)),this.addChild(this.bg),this.dirText=new PIXI.Sprite,this.dirText.anchor.set(.5),this.addChild(this.dirText),this.setAnchor()},c.setAnchor=function(a,b){this.bg.anchor.set(a,b)},c.unhighlight=function(a){this.bg.texture=this.compassAtlas.getFrame(this.name),a=a||0,0===a&&(this.dirText.visible=!1)},c.displayText=function(){this.dir&&(this.dirText.visible=!0,this.dirText.texture=this.compassAtlas.getFrame(this.dir))},c.highlight=function(a){this.isWall||this.name.indexOf("Wall")>-1||(this.bg.texture=this.compassAtlas.getFrame(this.name+"-Highlight"),this.parent.addChild(this),this.displayText())},c.highlightRed=function(){this.isWall||(this.unhighlight(1),this.bg.tint=16711680,this.flash())},c.highlightGreen=function(a){!this.isWall&&this.compassAtlas&&this.bg&&(this.bg.texture=this.compassAtlas.getFrame(this.name+"-glow"),TweenMax.delayedCall(a,this.highlight.bind(this)))},c.unflash=function(){this.bg.tint=16777215},c.flash=function(a){a=a||.25,TweenMax.delayedCall(a,this.unflash.bind(this))},namespace("cave_hunt").Tile=b}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.Tile"),c=include("cave_hunt.Daisy"),d=include("cave_hunt.Constants"),e=include("cave_hunt.CustomButton"),f=include("cave_hunt.Compass"),g=function(b){a.call(this,b),this.onPointerDown=this.onPointerDown.bind(this),this.onTileDown=this.onTileDown.bind(this),this.states={intro:"intro",win:"win",lose:"lose"},this.init()},h=extend(g,a),i=a.prototype;h.show=function(a,b,c,e,f){this.state=b,this.text=c,this.itemName=e,"undefined"!=typeof f?(this.findObjectIndex=f,this.interactive=!0,this.addTitleText(this.text),this.addTiles(),this.correctPath.sort(this.compare),this.addCompass(),this.correctPathIndex=0,this.spaces=this.getAvailableSpaces(),this.highlightTiles(this.spaces),this.compass.highlight(d.Directions.West),this.addArrow(-10,135,20,0,0),platypus.game.app.voPlayer.play(["CH_Challenge_Compass_Intro_Pop_1_Daisy","CH_Challenge_Compass_Intro_Pop_2_Hal","CH_Challenge_Compass_Intro_Pop_3_Hal","CH_Challenge_Compass_Intro_Pop_4_Hal"])):(this.clear(),this.showUI(),TweenMax.delayedCall(3,this.playWinVO.bind(this)),platypus.game.app.sound.play("Challenge_Key_Awarded",{delay:.5})),i.show.call(this,a)},h.playWinVO=function(){platypus.game.app.voPlayer.play(["CH_Challenge_Compass_Complete_Key_Pop_1_Daisy","CH_Challenge_Compass_Complete_Key_Pop_2_Daisy"])},h.addArrowAtTile=function(){switch(this.correctPathIndex){case 1:this.addArrow(65,35,20,0,180);break;case 2:this.addArrow(155,35,20,0,180);break;case 3:this.addArrow(155,135,20,0,180)}},h.compare=function(a,b){return a.index<b.index?-1:a.index>b.index?1:0},h.addCompass=function(){this.compass=new f,this.compass.scale.set(.8),this.compass.x=-160,this.compass.y=35,this.compass.interactive=!0,this.compass.buttonMode=!0,this.compass.on("pointerdown",this.onCompassClick.bind(this)),this.addChild(this.compass)},h.onCompassClick=function(){if(!(this.correctPathIndex>=this.correctPath.length||platypus.game.app.gamePaused)){var a=this.correctPath[this.correctPathIndex],b=this.getDirection(a);b&&this.compass.highlight(b,!0)}},h.highlightTiles=function(a){a instanceof Array?a.map(function(a){a.highlight()}):a instanceof b&&a.highlight()},h.unhighlightTiles=function(a){a.map(function(a){a.unhighlight()})},h.addArrow=function(a,b,c,d,e){this.arrow||(this.arrow=new PIXI.Sprite(platypus.game.app.getCache("arrow"))),this.arrow.anchor.set(1,.5),this.arrow.x=a,this.arrow.y=b,this.arrow.rotation=e*Math.PI/180,this.addChild(this.arrow);var f=.2;this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.tl=new TimelineMax({repeat:-1}),this.tl.to(this.arrow,f,{x:a+c,y:b+d,ease:Linear.easeNone}).to(this.arrow,f,{x:a,y:b,ease:Linear.easeNone}),this.tl.play()},h.addDaisy=function(a){this.daisy||(this.daisy=new c(this.owner)),this.objectsLayer.addChild(this.daisy),this.daisy.move(a,!1,d.Directions.North)},h.addCritter=function(a){var b=platypus.game.app.getCache("compass-atlas");
this.critter=new PIXI.Sprite,this.critter.texture=b.getFrame("Beetle-Color"),this.critter.anchor.set(.5),this.critter.position=a.position,this.critter.visible=!1,this.objectsLayer.addChild(this.critter)},h.getAvailableSpaces=function(){var a=[],b=this.daisy.tile;if(b.row>0){var c=this.tiles[b.row-1][b.col];c&&!c.isWall&&(c.dir=d.Directions.North,a.push(c))}if(b.row+1<this.tiles.length){var e=this.tiles[b.row+1][b.col];e&&!e.isWall&&(e.dir=d.Directions.South,a.push(e))}if(b.col>0){var f=this.tiles[b.row][b.col-1];f&&!f.isWall&&(f.dir=d.Directions.West,a.push(f))}if(b.col+1<this.tiles[b.row].length){var g=this.tiles[b.row][b.col+1];g&&!g.isWall&&(g.dir=d.Directions.East,a.push(g))}return a},h.addTiles=function(){var a=[["s2h",0,"s1"],[2,3,"s2v"],[1,[31],0]];this.tiles=[],this.correctPath=[];for(var c=50,d=-80,e=0;3>e;e++){this.tiles[e]=[];for(var f=a[e],g=0;3>g;g++){var h=f[g];if(0!==h){var i="FloorTile2",j=.5,k=.5;"s2v"==h?(i="Wall-2space-vert",j=.5,k=.22):"s2h"==h?(i="Wall-2space-horiz",j=.25,k=.45):"s1"==h&&(i="Wall-1space",k=.45);var l=new b(i,e,g);l.setAnchor(j,k),l.x=c+g*l.width,l.y=d+e*l.width,this.tiles[e][g]=l,l.interactive=!0,l.buttonMode=!0,0>=h&&(l.isWall=!0),l.on("pointerdown",this.onTileDown),this.tilesLayer.addChild(l),31==h&&(this.addDaisy(l),this.addCritter(l)),h>0&&(l.index=h,this.correctPath.push(l))}}}this.tilesLayer.scale.set(.8)},h.moveCamera=function(){TweenMax.delayedCall(.7,this.moveCameraComplete.bind(this))},h.moveCameraComplete=function(){this.isMoving=!1},h.onTileDown=function(a){var b=a.currentTarget;if(this.spaces&&b!=this.daisy.tile&&!this.isMoving&&!platypus.game.app.gamePaused){var c=!1,d=this.correctPath[this.correctPathIndex],e=null;if(this.spaces.indexOf(b)>-1)if(d==b)if(this.isMoving=!0,this.moveCamera(),e=this.getDirection(d),platypus.game.app.voPlayer.play(["CH_Challenge_Compass_"+e+"_A_Hal","CH_Challenge_Compass_"+e+"_B_Hal","CH_Challenge_Compass_"+e+"_C_Hal"].shuffle()[0]),this.daisy.move(b,!0,e),this.unhighlightTiles(this.spaces),this.compass.unhighlight(),this.correctPathIndex++,this.correctPathIndex<this.correctPath.length)this.spaces=this.getAvailableSpaces(),this.highlightTiles(this.spaces),d=this.correctPath[this.correctPathIndex],this.addArrowAtTile(d);else{this.critter.visible=!0,this.tl&&this.tl.stop(),this.arrow&&(this.arrow.parent.removeChild(this.arrow),this.arrow=null);var f=2;TweenMax.to(this.critter.scale,1,{x:f,y:f,onComplete:this.onPointerDown.bind(this)})}else b.highlightRed(),c=!0;d&&(e=this.getDirection(d),e?this.compass.highlight(e,c):this.compass.unhighlight())}},h.getDirection=function(a){var b=this.daisy.tile,c=null;return a.row==b.row?a.col<b.col?c=d.Directions.West:a.col>b.col&&(c=d.Directions.East):a.col==b.col&&(a.row<b.row?c=d.Directions.North:a.row>b.row&&(c=d.Directions.South)),c},h.showUI=function(){this.addTitleText(this.text),this.addItem(this.itemName,-20),this.addButton()},h.init=function(){this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.titleText=new PIXI.extras.BitmapText("",{font:"60px popupsFont",align:"center",tint:16777215}),this.titleText.y=-175,this.titleText.anchor.set(.5),this.addChild(this.titleText),this.tilesLayer=new PIXI.Container,this.addChild(this.tilesLayer),this.objectsLayer=new PIXI.Container,this.objectsLayer.scale.set(.8),this.addChild(this.objectsLayer),this.circle=new PIXI.Graphics,this.addChild(this.circle),this.item=new PIXI.Sprite,this.item.anchor.set(.5),this.addChild(this.item)},h.addButton=function(){var a=this.popupAtlas.getFrame("popup-play-btn-normal");this.button=new e({up:this.popupAtlas.getFrame("popup-play-btn-normal"),down:this.popupAtlas.getFrame("popup-play-btn-over"),over:this.popupAtlas.getFrame("popup-play-btn-over")}),this.button.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.button),this.button.y=150,this.button.on("buttonPress",this.onPointerDown)},h.addItem=function(a,b){b=b||0;var c=platypus.game.app.getCache("vault-atlas");this.item.texture=c.getFrame(a),this.item.y=b,this.item.rotation=0},h.addTitleText=function(a){this.titleText.text=a.toUpperCase()},h.addCircle=function(a){this.circle.clear(),this.circle.lineStyle(2,0,1),this.circle.beginFill(a,1),this.circle.drawEllipse(0,0,100,100),this.circle.endFill()},h.onPointerDown=function(){platypus.game.app.gamePaused||(this.state==this.states.intro?this.hide("play"):this.state==this.states.win&&(this.hide("home"),platypus.game.app.voPlayer.stop()),this.button&&this.button.off("buttonPress",this.onPointerDown))},h.clearTiles=function(){if(this.tiles){for(var a=0;a<this.tiles.length;a++)for(var c=this.tiles[a],d=0;d<c.length;d++){var e=c[d];e&&e instanceof b&&(e.off("pointerdown",this.onTileDown),e.parent&&e.parent.removeChild(e)),e=null}this.tiles=null}},h.clear=function(){this.clearTiles(),this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.arrow&&(this.arrow.parent.removeChild(this.arrow),this.arrow=null),this.compass&&(this.compass.off("pointerdown",this.onCompassClick),this.compass.parent.removeChild(this.compass),this.compass=null),this.critter&&(this.critter.parent.removeChild(this.critter),this.critter=null),this.daisy&&(this.daisy.parent.removeChild(this.daisy),this.daisy=null)},namespace("cave_hunt").CompassPopup=g}(),function(){var a=include("PIXI.Container"),b=include("cave_hunt.Compass"),c=include("cave_hunt.TargetObject"),d=include("cave_hunt.PhotoSpot"),e=function(b){a.call(this),this.owner=b,this.bg=null,this.objects=[],this.init()},f=extend(e,a);f.init=function(){var a=platypus.game.app.getCache("hud-atlas");this.bg=new PIXI.Sprite(a.getFrame("HUD")),this.bg.anchor.set(.5,.5),this.addChild(this.bg)},f.onPointerDown=function(){this.owner&&this.owner.triggerEvent("back-pressed"),platypus.game.loadScene("map-screen")},f.addCompass=function(){var a=platypus.game.app.config.challenges.compass.board.objects;this.compass=new b,this.compass.x=-8,this.compass.y=235,this.addChild(this.compass),this.objects=[];for(var c=1;6>=c;c++){var e=c<=a.length?a[c-1].name:null,f=new d("Photo-Spot"+c,e);f.position=this.getPosition(c),this.addChild(f),this.objects.push(f)}},f.getPosition=function(a){var b=new PIXI.Point;switch(a){case 1:b.x=75,b.y=-30;break;case 2:b.x=-53,b.y=-16;break;case 3:b.x=56,b.y=125;break;case 4:b.x=-98,b.y=146;break;case 5:b.x=60,b.y=279;break;case 6:b.x=-96,b.y=298}return b.y-=275,b},f.addObjects=function(a){this.objects=[];for(var b=40,d=-245,e=113,f=0;f<a.length;f++){var g=a[f],h=new c(g.name);h.x=b,h.y=d+f*e,this.addChild(h),this.objects.push(h)}},f.getObjectPosition=function(a){var b=this.objects[a];return{x:this.x+b.x,y:this.y+b.y}},f.updateCollected=function(a){var b=this.objects[a];b.collected()},f.updateHighlight=function(a){var b=this.objects[a];this.addChild(b),b.highlight()},f.clear=function(){this.compass&&(this.compass.parent.removeChild(this.compass),this.compass=null)},namespace("cave_hunt").HUD=e}(),function(){var a=include("PIXI.Container"),b=include("springroll.pixi.AdvancedMovieClip"),c=function(b,c){a.call(this),this.body=null,this.arm=null,this.owner=b,this.showArm=c,this.armPosition={},this.armWidth=170,this.walkPosition=700,this.walkAwayTime=3.5,this.pupilRadius=4,this.init()},d=extend(c,a);d.init=function(){this.atlas=platypus.game.app.getCache("hal-atlas"),this.showArm&&(this.arm=new PIXI.Sprite(this.atlas.getFrame("HalArmFlashlight")),this.arm.anchor.set(0,.5),this.arm.y=-210,this.addChild(this.arm)),this.body=new b(platypus.game.app.getCache("HalAnim"),platypus.game.app.getCache("HalAtlas")),this.body.anchor.set(.5,1),this.addChild(this.body),platypus.game.app.animator.play(this.body,"idle"),this.leftPupil=(new PIXI.Graphics).beginFill(0,1),this.leftPupil.drawCircle(0,0,2.5),this.leftPupil.x=this.leftPupil.origX=-3,this.leftPupil.y=this.leftPupil.origY=-324,this.body.addChild(this.leftPupil),this.rightPupil=(new PIXI.Graphics).beginFill(0,1),this.rightPupil.drawCircle(0,0,2.5),this.rightPupil.x=this.rightPupil.origX=14,this.rightPupil.y=this.rightPupil.origY=-324,this.body.addChild(this.rightPupil)},d.getArmPosition=function(){return this.armPosition.x=this.x+this.arm.x,this.armPosition.y=this.y+this.arm.y,this.armPosition},d.resetArm=function(){this.rotateArmTo(1.25)},d.highlight=function(){this.arm.texture=this.atlas.getFrame("HalArmFlashlight"),TweenMax.delayedCall(2,this.unhighlight.bind(this))},d.unhighlight=function(){this.arm.texture=this.atlas.getFrame("HalArmFlashlight")},d.rotatePupils=function(a,b){var c=b*this.pupilRadius;a=b*a,this.leftPupil.x=this.leftPupil.origX+Math.cos(a)*c,this.leftPupil.y=this.leftPupil.origY+Math.sin(a)*c,this.rightPupil.x=this.rightPupil.origX+Math.cos(a)*c,this.rightPupil.y=this.rightPupil.origY+Math.sin(a)*c},d.rotateArmTo=function(a){var b=180*a/Math.PI;-90>b||b>90?(this.flip(-1),this.rotatePupils(a,-1)):(this.flip(1),this.rotatePupils(a,1)),this.arm.rotation=a},d.flip=function(a){this.body.scale.x!=a&&(this.body.scale.set(a,1),this.arm.scale.set(1,a))},d.walkAway=function(){this.resetArm(),TweenMax.to(this,this.walkAwayTime,{x:this.walkPosition,onComplete:this.walkAwayComplete.bind(this)})},d.walkIn=function(){this.wSound&&(this.wSound.stop(),this.wSound=null),this.wSound=platypus.game.app.sound.play("Challenge_Hal_Walking",{loop:-1}),platypus.game.app.animator.play(this.body,"walk"),this.resetArm(),this.arm.visible=this.leftPupil.visible=this.rightPupil.visible=!1,TweenMax.to(this,this.walkAwayTime,{x:0,ease:Linear.easeNone,onComplete:this.walkInComplete.bind(this)})},d.walkAwayComplete=function(){this.owner.triggerEvent("hal-walk-away"),this.x=-this.walkPosition,this.walkIn()},d.walkInComplete=function(){this.arm.visible=this.leftPupil.visible=this.rightPupil.visible=!0,platypus.game.app.animator.play(this.body,"idle"),this.wSound&&(this.wSound.stop(),this.wSound=null)},namespace("cave_hunt").Hal=c}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.CustomButton"),c=include("cave_hunt.Hal"),d=function(b){a.call(this,b),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onCircleDown=this.onCircleDown.bind(this),this.onUpdate=this.onUpdate.bind(this),this.states={intro:"intro",win:"win",lose:"lose"},this.circleRadius=platypus.game.app.config.challenges.flashlight.flashlightSize,this.objectFoundTime=1,this.circlePosition={},this.init()},e=extend(d,a),f=a.prototype;e.show=function(a,b,c,d,e){if(this.state=b,this.text=c,this.itemName=d,"undefined"!=typeof e){this.findObjectIndex=e,this.interactive=!0,this.addTitleText(this.text),this.addObject(e),this.addHal(),this.addItem(d,30,-80),this.item.rotation=90*Math.PI/180,this.item.scale.set(.6),this.draw(new PIXI.Point(0,0)),this.circle.interactive=!0,this.circle.buttonMode=!0,this.circle.on("pointerdown",this.onCircleDown),platypus.game.app.on("update",this.onUpdate),this.addArrow(220,0,20,0,180);var g=["CH_Challenge_Flashlight_Intro_Pop_1_Hal","CH_Challenge_Flashlight_Intro_Pop_2_Squeeks"];platypus.game.app.voPlayer.play(g)}else this.hal&&(this.hal.parent.removeChild(this.hal),this.hal=null),this.showUI(),TweenMax.delayedCall(2.5,this.playWinVO.bind(this));f.show.call(this,a)},e.playWinVO=function(){platypus.game.app.voPlayer.play(["CH_Challenge_Flashlight_Complete_Key_Pop_Hal_not_needed","CH_Challenge_Flashlight_Complete_Key_Pop_Squeeks"])},e.onCircleDown=function(){platypus.game.app.gamePaused||(this.on("pointermove",this.onPointerMove),this.addArrow(0,100,20,0,0))},e.addHal=function(){this.hal=new c(this.owner),this.hal.x=-180,this.hal.y=180,this.hal.scale.set(.8),this.addChild(this.hal)},e.showUI=function(){this.addTitleText(this.text),this.addItem(this.itemName),this.addButton(),platypus.game.app.sound.play("Challenge_Key_Awarded",{delay:.5})},e.init=function(){this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.titleText=new PIXI.extras.BitmapText("",{font:"60px popupsFont",align:"center",tint:16777215}),this.titleText.y=-170,this.titleText.anchor.set(.5),this.addChild(this.titleText),this.shape=new PIXI.Graphics,this.addChild(this.shape);var a=new PIXI.filters.BlurFilter;a.blur=5,this.shape.filters=[a],this.objectsLayer=new PIXI.Container,this.addChild(this.objectsLayer),this.maskBG=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.maskBG.anchor.set(.5),this.objectsLayer.addChild(this.maskBG),this.circle=new PIXI.Graphics,this.addChild(this.circle),this.masker=new PIXI.Graphics,this.addChild(this.masker),this.objectsLayer.mask=this.masker,this.item=new PIXI.Sprite,this.item.anchor.set(.5),this.addChild(this.item)},e.addObject=function(a){this.objectsData=platypus.game.app.config.challenges.flashlight.objects;var b=platypus.game.app.getCache("objects-atlas"),c=this.objectsData[a];this.object=new PIXI.Sprite(b.getFrame(c.name+"-Color")),this.object.anchor.set(.5,.5),this.objectsLayer.addChild(this.object),this.object.x=150,this.object.y=120;var d=new PIXI.Sprite(b.getFrame(c.name+"-Highlight"));d.anchor.set(.55,.5),d.visible=!1,this.object.objHighlight=d,this.object.addChild(d)},e.addArrow=function(a,b,c,d,e){this.arrow||(this.arrow=new PIXI.Sprite(platypus.game.app.getCache("arrow"))),this.arrow.anchor.set(.5),this.arrow.x=a,this.arrow.y=b,this.arrow.rotation=e*Math.PI/180,this.addChild(this.arrow);var f=.2;this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.tl=new TimelineMax({repeat:-1}),this.tl.to(this.arrow,f,{x:a+c,y:b+d,ease:Linear.easeNone}).to(this.arrow,f,{x:a,y:b,ease:Linear.easeNone}),this.tl.play()},e.addButton=function(){var a=this.popupAtlas.getFrame("popup-play-btn-normal");this.button=new b({up:this.popupAtlas.getFrame("popup-play-btn-normal"),down:this.popupAtlas.getFrame("popup-play-btn-over"),over:this.popupAtlas.getFrame("popup-play-btn-over")}),this.button.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.button),this.button.y=150,this.button.on("buttonPress",this.onPointerDown)},e.addItem=function(a,b,c){c=c||0,b=b||0;var d=platypus.game.app.getCache("vault-atlas");this.item.texture=d.getFrame(a),this.item.y=b,this.item.x=c,this.item.rotation=0},e.addTitleText=function(a){this.titleText.text=a.toUpperCase()},e.addCircle=function(a){this.circle.clear(),this.circle.lineStyle(2,0,1),this.circle.beginFill(a,1),this.circle.drawEllipse(0,0,100,100),this.circle.endFill()},e.removeEventListeners=function(){this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.arrow&&(this.arrow.parent.removeChild(this.arrow),this.arrow=null),this.off("pointermove",this.onPointerMove),platypus.game.app.off("update",this.onUpdate),this.circle&&this.circle.off("pointerdown",this.onCircleDown)},e.checkObject=function(a){this.isObjectInCircle(this.object)?(this.timer||(this.timer=this.objectFoundTime),this.timer-=a,this.timer<=0&&(this.timer=this.objectFoundTime,this.clear(),this.hide("play"),platypus.game.app.voPlayer.stop(),this.object.objHighlight.visible=!1),this.timer<=.5&&!this.object.bumped&&(this.object.objHighlight.visible=!0,this.object.bumped=!0)):(this.object.scale.set(1),this.object.objHighlight.visible=!1,this.timer=this.objectFoundTime,this.object.bumped=!1)},e.clear=function(){this.removeEventListeners(),this.shape.clear(),this.masker.clear(),this.circle.clear()},e.isObjectInCircle=function(a){return this.isPointInCircle(a.x,a.y)&&this.isPointInCircle(a.x-.5*a.width,a.y-.5*a.height)&&this.isPointInCircle(a.x+.5*a.width,a.y-.5*a.height)&&this.isPointInCircle(a.x-.5*a.width,a.y+.5*a.height)&&this.isPointInCircle(a.x+.5*a.width,a.y+.5*a.height)},e.isPointInCircle=function(a,b){return a>=this.circlePosition.x-this.circleRadius&&a<=this.circlePosition.x+this.circleRadius&&b>=this.circlePosition.y-this.circleRadius&&b<=this.circlePosition.y+this.circleRadius},e.onPointerMove=function(a){this.hal&&!platypus.game.app.gamePaused&&(this.input=this.toLocal(a.data.global),this.draw(this.input))},e.draw=function(a){this.input=a;var b=.5;this.input.x+2*this.circleRadius>this.bg.width*b?this.input.x=this.bg.width*b-2*this.circleRadius:this.input.x-2*this.circleRadius<-this.bg.width*b&&(this.input.x=-this.bg.width*b+2*this.circleRadius),this.input.y-2*this.circleRadius<-this.bg.height*b?this.input.y=-this.bg.height*b+2*this.circleRadius:this.input.y+2*this.circleRadius>this.bg.height*b&&(this.input.y=this.bg.height*b-2*this.circleRadius);var c=this.input.x-this.item.x,d=this.input.y-this.item.y,e=Math.atan2(d,c);Math.sqrt(c*c+d*d);this.item.rotation=e+.8*Math.PI,this.hal.rotatePupils(e,1),this.circle.rotation=e,this.masker.rotation=e,this.circle.clear(),this.circle.beginFill(16777215,.4),this.circle.drawEllipse(this.circleRadius,0,this.circleRadius,this.circleRadius),this.circle.endFill(),this.circle.x=this.input.x,this.circle.y=this.input.y,this.masker.clear(),this.masker.beginFill(16777215,.2),this.masker.drawEllipse(this.circleRadius,0,this.circleRadius,this.circleRadius),this.masker.endFill(),this.masker.x=this.input.x,this.masker.y=this.input.y;var f=15,g=this.item.x+50*Math.cos(e),h=this.item.y+50*Math.sin(e);this.circlePosition.x=this.input.x+Math.cos(e)*this.circleRadius,this.circlePosition.y=this.input.y+Math.sin(e)*this.circleRadius,this.shape.clear(),this.shape.beginFill(16777215,.4),this.shape.moveTo(g+Math.cos(e+Math.PI/2)*f,h+Math.sin(e+Math.PI/2)*f),this.shape.lineTo(this.circlePosition.x+Math.cos(e+Math.PI/2)*this.circleRadius,this.circlePosition.y+Math.sin(e+Math.PI/2)*this.circleRadius),this.shape.lineTo(this.circlePosition.x+Math.cos(e-Math.PI/2)*this.circleRadius,this.circlePosition.y+Math.sin(e-Math.PI/2)*this.circleRadius),this.shape.lineTo(g+Math.cos(e-Math.PI/2)*f,h+Math.sin(e-Math.PI/2)*f),this.shape.endFill()},e.onUpdate=function(a){var b=a/1e3;this.checkObject(b)},e.onPointerDown=function(){platypus.game.app.gamePaused||(this.state==this.states.intro?this.hide("play"):this.state==this.states.win&&this.hide("home"),this.button&&this.button.off("buttonPress",this.onPointerDown))},namespace("cave_hunt").FlashLightPopup=d}(),function(){var a=include("PIXI.Container"),b=include("springroll.pixi.AdvancedMovieClip"),c=function(b,c){a.call(this),this.body=null,this.owner=b,this.moveBody=c,this.walkAwayTime=5,this.init()},d=extend(c,a);d.init=function(){this.atlas=platypus.game.app.getCache("squeaks-atlas"),this.body=new b(platypus.game.app.getCache("SqueaksAnim"),platypus.game.app.getCache("SqueaksAtlas")),this.body.anchor.set(.44,.1),this.addChild(this.body),this.body.interactive=!0,platypus.game.app.animator.play(this.body,"idle"),this.interactive=!0,this.defineHitArea(57,107,20)},d.resetBrush=function(){this.x=-100,this.y=220},d.defineHitArea=function(a,b,c,d){if(this.emitterX=a,this.emitterY=b,this.hitArea=new PIXI.Circle(a,b,c),d){var e=(new PIXI.Graphics).beginFill(16711680);e.drawCircle(a,b,c),this.addChild(e)}},d.contains=function(a,b){var c={x:a,y:b};if(this.hitArea.contains(c.x-this.x,c.y-this.y))return!0;var d=5;return this.hitArea.contains(c.x-this.x+d,c.y-this.y)||this.hitArea.contains(c.x-this.x-d,c.y-this.y)||this.hitArea.contains(c.x-this.x,c.y-this.y+d)||this.hitArea.contains(c.x-this.x,c.y-this.y-d)},d.highlight=function(){},d.unhighlight=function(){},d.animate=function(){platypus.game.app.animator.play(this.body,"dust"),this.dSound&&(this.dSound.stop(),this.dSound=null),this.dSound=platypus.game.app.sound.play("Challenge_Duster_Dusting",{loop:-1})},d.stop=function(){platypus.game.app.animator.play(this.body,"idle"),this.dSound&&(this.dSound.stop(),this.dSound=null)},d.walkIn=function(){this.wSound&&(this.wSound.stop(),this.wSound=null),this.wSound=platypus.game.app.sound.play("Challenge_Squeeks_Running",{loop:-1}),platypus.game.app.animator.play(this.body,"walk"),TweenMax.to(this,this.walkAwayTime,{x:-100,ease:Linear.easeNone,onComplete:this.walkComplete.bind(this)})},d.walkComplete=function(){platypus.game.app.animator.play(this.body,"idle"),this.wSound&&(this.wSound.stop(),this.wSound=null)},namespace("cave_hunt").Squeaks=c}(),function(){var a=include("PIXI.Container"),b=function(b){a.call(this),this.bg=null,this.object=null,this.name=b,this.init()},c=extend(b,a);c.init=function(){this.objectsAtlas=platypus.game.app.getCache("objects-atlas"),this.object=new PIXI.Sprite(this.objectsAtlas.getFrame(this.name+"-Found")),this.object.anchor.set(.5),this.addChild(this.object),this.scale.set(.4),this.radius=.5*this.width},c.found=function(){this.scale.set(1),this.object.texture=this.objectsAtlas.getFrame(this.name+"-Found")},namespace("cave_hunt").HiddenObject=b}(),function(){var a=include("cave_hunt.BasePopup"),b=include("cave_hunt.CustomButton"),c=include("cave_hunt.Constants"),d=include("cave_hunt.Squeaks"),e=function(b,c){a.call(this,b),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onBrushDown=this.onBrushDown.bind(this),this.update=this.update.bind(this),this.component=c,this.states={intro:"intro",win:"win",lose:"lose"},this.init()},f=extend(e,a),g=a.prototype;f.show=function(a,b,c,d,e){this.state=b,this.text=c,this.itemName=d,"undefined"!=typeof e?(this.findObjectIndex=e,this.dustingSpeed=platypus.game.app.config.challenges.duster.dustingSpeed,this.interactive=!0,this.addTitleText(this.text),this.addSqueaks(),this.addHexes(),this.addObject(e),this.setCollidingHexes(),this.addArrow(-140,-75,0,20,90),platypus.game.app.voPlayer.play(["CH_Challenge_Duster_Intro_Pop_1_Squeeks","CH_Challenge_Duster_Intro_Pop_2_Daisy",["CH_Challenge_Duster_Inactivity_Daisy","CH_Challenge_Duster_Inactivity_Not_Dusting_A_Squeeks","CH_Challenge_Duster_Inactivity_Not_Dusting_B_Squeeks"].shuffle()[0]])):(this.clear(),this.showUI(),platypus.game.app.sound.play("Challenge_Key_Awarded",{delay:.5})),g.show.call(this,a)},f.addArrow=function(a,b,c,d,e){this.arrow||(this.arrow=new PIXI.Sprite(platypus.game.app.getCache("arrow"))),this.arrow.anchor.set(.5),this.arrow.x=a,this.arrow.y=b,this.arrow.rotation=e*Math.PI/180,this.addChild(this.arrow);var f=.2;this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.tl=new TimelineMax({repeat:-1}),this.tl.to(this.arrow,f,{x:a+c,y:b+d,ease:Linear.easeNone}).to(this.arrow,f,{x:a,y:b,ease:Linear.easeNone}),this.tl.play()},f.update=function(a){if(this.grid&&this.squeaks&&this.moveBrush&&!platypus.game.app.gamePaused){for(var b=0;b<this.rows;b++)for(var c=0;c<this.cols;c++){var d=this.grid[b][c];this.squeaks.contains(d.position.x,d.position.y)&&(d.alpha-=this.dustingSpeed)}this.collidingHexes&&this.checkWin()&&(this.squeaks.tapped=!1,this.onPointerUp(),this.hide("play"),platypus.game.app.voPlayer.stop())}},f.addSqueaks=function(){this.squeaks=new d(null,!0),this.squeaks.x=-150,this.squeaks.y=-15,this.addChild(this.squeaks)},f.addHexes=function(){this.grid=[],this.cols=10,this.rows=12,this.hexeStartX=50,this.hexeStartY=-100;var a=.5;this.hexesWidth=40;for(var b=46*a,c=41*a,d=platypus.game.app.getCache("objects-atlas"),e=0;e<this.rows;e++){this.grid[e]=[];for(var f=0;f<this.cols;f++){var g=new PIXI.Sprite(d.getFrame("DustHex-Full"));g.scale.set(a),g.x=(e%2===0?.5*-b:0)+this.hexeStartX+f*b,g.y=this.hexeStartY+e*c,g.radius=.5*c,g.anchor.set(.5),this.grid[e][f]=g,this.hexeLayer.addChild(g)}}},f.showUI=function(){this.addTitleText(this.text),this.addItem(this.itemName,-10),this.addButton()},f.init=function(){this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.bg=new PIXI.Sprite(this.popupAtlas.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.titleText=new PIXI.extras.BitmapText("",{font:"60px popupsFont",align:"center",tint:16777215}),this.titleText.y=-170,this.titleText.anchor.set(.5),this.addChild(this.titleText),this.objectsLayer=new PIXI.Container,this.addChild(this.objectsLayer),this.hexeLayer=new PIXI.Container,this.addChild(this.hexeLayer),this.circle=new PIXI.Graphics,this.addChild(this.circle),this.item=new PIXI.Sprite,this.item.anchor.set(.5),this.addChild(this.item)},f.addObject=function(a){this.objectsData=platypus.game.app.config.challenges.duster.objects;var b=platypus.game.app.getCache("objects-atlas"),c=this.objectsData[a];this.object=new PIXI.Sprite(b.getFrame(c.name+"-Color")),this.object.anchor.set(.5),this.objectsLayer.addChild(this.object),this.object.radius=.5*this.object.width,this.object.x=136,this.object.y=8},f.checkWin=function(){var a=this.collidingHexes.filter(function(a){return a.alpha>.1});return a.length<1},f.setCollidingHexes=function(){this.collidingHexes=[];for(var a=0;a<this.rows;a++)for(var b=0;b<this.cols;b++){var c=this.grid[a][b],d=this.object.x-c.x,e=this.object.y-c.y,f=Math.sqrt(d*d+e*e);f<this.object.radius+c.radius&&this.collidingHexes.push(c)}},f.addButton=function(){var a=this.popupAtlas.getFrame("popup-play-btn-normal");this.button=new b({up:this.popupAtlas.getFrame("popup-play-btn-normal"),down:this.popupAtlas.getFrame("popup-play-btn-over"),over:this.popupAtlas.getFrame("popup-play-btn-over")}),this.button.pivot=new PIXI.Point(.5*a.width,.5*a.height),this.addChild(this.button),this.button.y=150,this.button.on("buttonPress",this.onPointerDown)},f.addItem=function(a,b){b=b||0;var c=platypus.game.app.getCache("vault-atlas");this.item.texture=c.getFrame(a),this.item.y=b,this.item.rotation=0,this.item.scale.set(.8)},f.addTitleText=function(a){this.titleText.text=a.toUpperCase()},f.addCircle=function(a){this.circle.clear(),this.circle.lineStyle(2,0,1),this.circle.beginFill(a,1),this.circle.drawEllipse(0,0,100,100),this.circle.endFill()},f.addEventListeners=function(){this.squeaks&&(this.squeaks.body.on("pointerdown",this.onBrushDown),platypus.game.app.on("update",this.update),this.on("pointermove",this.onPointerMove),this.on("pointerup",this.onPointerUp))},f.clear=function(){this.removeEventListeners(),this.squeaks&&(this.squeaks.parent.removeChild(this.squeaks),this.squeaks=null),this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.arrow&&(this.arrow.parent.removeChild(this.arrow),this.arrow=null),this.objectsLayer&&(this.objectsLayer.parent.removeChild(this.objectsLayer),this.objectsLayer=null),this.hexeLayer&&(this.hexeLayer.parent.removeChild(this.hexeLayer),this.hexeLayer=null)},f.removeEventListeners=function(){this.squeaks&&(this.off("pointermove",this.onPointerMove),this.item.interactive=!1,this.squeaks.body.off("pointerdown",this.onBrushDown),this.off("pointerup",this.onPointerUp),platypus.game.app.off("update",this.update))},f.onBrushDown=function(a){platypus.game.app.gamePaused||(this.input=this.toLocal(a.data.global),this.squeaks.position=this.input,this.moveBrush=!0,this.squeaks.animate(),this.squeaks.tapped=!this.squeaks.tapped,this.addArrow(235,0,20,0,180),this.component.emitter&&(this.component.emitter.updateSpawnPos(this.squeaks.x+this.squeaks.emitterX,this.squeaks.y+this.squeaks.emitterY),this.component.emitter.emit=!0,this.component.emitter.parent=this.hexeLayer))},f.resetBrush=function(){this.item.x=0,this.item.y=185},f.onPointerUp=function(a){(!this.squeaks.tapped||c.isMobile.any())&&(this.squeaks.x=-150,this.squeaks.y=-15,this.squeaks.stop(),this.moveBrush=!1,this.component.emitter.emit=!1)},f.onPointerMove=function(a){if(this.moveBrush&&!platypus.game.app.gamePaused){this.input=this.toLocal(a.data.global);var b=.5;this.input.x+this.item.width>this.bg.width*b?this.input.x=this.bg.width*b-this.item.width:this.input.x-this.item.width*b<-this.bg.width*b&&(this.input.x=-this.bg.width*b+this.item.width*b),this.input.y-this.item.height<-this.bg.height*b?this.input.y=-this.bg.height*b+this.item.height:this.input.y+this.item.height*b>this.bg.height*b&&(this.input.y=this.bg.height*b-this.item.height*b),this.input=this.toLocal(a.data.global),this.squeaks.position=this.input,this.component.emitter&&this.component.emitter.updateSpawnPos(this.squeaks.x+this.squeaks.emitterX,this.squeaks.y+this.squeaks.emitterY)}},f.onPointerDown=function(){platypus.game.app.gamePaused||(this.state==this.states.intro?this.hide("play"):this.state==this.states.win&&this.hide("home"),this.button&&this.button.off("buttonPress",this.onPointerDown))},namespace("cave_hunt").DusterPopup=e}(),function(){var a=include("PIXI.Container"),b=include("cave_hunt.HiddenObject"),c=function(b){a.call(this),this.owner=b,this.object=null,this.init()},d=extend(c,a);d.init=function(){var a=platypus.game.app.getCache("popup-atlas");this.bg=new PIXI.Sprite(a.getFrame("popup-pause-bg")),this.bg.anchor.set(.5),this.addChild(this.bg),this.title=new PIXI.extras.BitmapText("NAME",{font:"60px popupsFont",align:"center",tint:16777215}),this.title.y=-150,this.title.anchor.set(.5),this.addChild(this.title)},d.add=function(a){this.object=a;var c="";c=a.display?a.display:a.name,this.title.text=c.toUpperCase(),a instanceof b?a.object.anchor.set(.5,.2):a.anchor.set(.5,.2),this.addChild(a)},d.show=function(){this.scale.set(.8),TweenMax.to(this.scale,.5,{x:1,y:1,ease:Elastic.easeOut}),platypus.game.app.sound.play("Pop_Up_Display")},d.hide=function(a){this.scale.set(1),TweenMax.to(this.scale,.5,{x:.8,y:.8,ease:Elastic.easeIn,onComplete:this.remove.bind(this)}),platypus.game.app.sound.play("Pop_Up_Remove")},d.remove=function(){this.owner.triggerEvent("popup-removed"),this.parent.removeChild(this)},namespace("cave_hunt").ObjectPopup=c}(),function(){var a=function(a){this.path=a,this.values=[{x:872,y:384.3},{x:872,y:488.23998991819417},{x:787.7399899181942,y:572.5},{x:683.8,y:572.5},{x:579.8600100818057,y:572.5},{x:495.59999999999997,y:488.23998991819417},{x:495.59999999999997,y:384.3},{x:495.59999999999997,y:280.36001008180585},{x:579.8600100818057,y:196.10000000000002},{x:683.8,y:196.10000000000002},{x:787.7399899181942,y:196.10000000000002},{x:872,y:280.36001008180585},{x:872,y:384.3}],this.values=[{x:651.1,y:293.8},{x:691.7666666666667,y:272.4},{x:732.4333333333334,y:251},{x:773.1,y:229.6},{x:765.3333333333334,y:274.9},{x:757.5666666666666,y:320.2},{x:749.8,y:365.5},{x:782.6999999999999,y:397.56666666666666},{x:815.6,y:429.6333333333333},{x:848.5,y:461.7},{x:803.0333333333333,y:468.3},{x:757.5666666666667,y:474.9},{x:712.1,y:481.5},{x:691.7666666666667,y:522.7},{x:671.4333333333334,y:563.9},{x:651.1,y:605.1},{x:630.7666666666667,y:563.9},{x:610.4333333333334,y:522.7},{x:590.1,y:481.5},{x:544.6333333333333,y:474.9},{x:499.1666666666667,y:468.3},{x:453.7,y:461.7},{x:486.59999999999997,y:429.6333333333333},{x:519.5,y:397.56666666666666},{x:552.4,y:365.5},{x:544.6333333333333,y:320.2},{x:536.8666666666667,y:274.9},{x:529.1,y:229.6},{x:569.7666666666667,y:251},{x:610.4333333333334,y:272.4},{x:651.1,y:293.8}],this.lines=[],this.speeds=[],this.steps=1e3,this.speed={now:1,min:.5,max:2.5,ratio:.5,step:.015},this.bezier={autoRotate:["x","y","rotation",Math.PI/2,!0],values:this.values,type:"cubic"},this.init()},b=a.prototype;b.init=function(){for(var a=this.speed,b=this.lines,c={x:0,y:0,rotation:0},d=TweenLite.to(c,1,{bezier:{values:this.values,autoRotate:!0,type:"cubic"},paused:!0,ease:Linear.easeNone}),e=0;2>e;e++){for(var f=0;f<=this.steps;f++){d.progress(.001*f);var g=c.rotation%90,h=0>g?-1:1,i=Math.abs(g/90),j=a.ratio+a.step*h*i||0;if(a.ratio=this.clamp(j,0,1),e){var k=this.lerpColor(a.ratio);b.push({color:k,x:c.x,y:c.y}),a.now=this.lerp(a.min,a.max,a.ratio),this.speeds.push(a.now)}}a.now=this.lerp(a.min,a.max,a.ratio)}this.plotSpeed()},b.plotSpeed=function(){for(var a=new PIXI.Graphics,b=this.lines.length,c=this.values[0],d=0;b>d;d++){var e=this.lines[d];a.beginFill(e.color),a.lineStyle(4,e.color),a.drawPolygon(c.x,c.y,e.x,e.y,c.x,c.y),a.endFill(),c=e}var f=a.getBounds();a.lineStyle(0),a.beginFill(0,0),a.drawRect(0,0,f.x+f.width,f.y+f.height),this.texture=a.generateTexture(),this.sprite=new PIXI.Sprite(this.texture),a.destroy()},b.lerpColor=function(a){a=a||0;for(var b=[255,0,0],c=[0,255,0],d=[],e=0;3>e;e++){var f=Math.pow(b[e],2),g=Math.pow(c[e],2);d[e]=Math.round(Math.sqrt(this.lerp(f,g,a)))}return(1<<24)+(d[0]<<16)+(d[1]<<8)+d[2]},b.lerp=function(a,b,c){return c=this.clamp(c,0,1),a+(b-a)*c},b.clamp=function(a,b,c){return b>a?b:a>c?c:a;
},namespace("cave_hunt").MotionPath=a}(),function(){var a=include("PIXI.Sprite"),b=function(b,c,d,e,f,g,h){a.call(this,platypus.game.app.getCache("GlowWorm")),this.bezier=c,this.speed=d,this.delay=e||0,this.anchor.set(.5),this.trailsCount=3,this.trailsDistance=5,this.trails=[],b.addChild(this),this.minHideTime=f||.25,this.maxHideTime=g||.45,h=h||.25,this.blinkTime=parseFloat(h),this.hideTime=Math.randomFloat(parseFloat(this.minHideTime),parseFloat(this.maxHideTime)),this.blinking=!1,this.blink=!1,this.elapsedTime=0,this.alpha=0},c=extend(b,a);c.addTrails=function(){for(var a=0;a<this.trailsCount;a++){var b=new PIXI.Sprite(platypus.game.app.getCache("GlowWorm"));b.anchor.set(.5),b.health=0,b.life=(a+1)*this.trailsDistance,b.alpha=.5,this.parent.addChild(b),b.visible=!1,this.trails.push(b)}},c.updateTrails=function(){if(this.trails)for(var a=0;a<this.trailsCount;a++){var b=this.trails[a];b.health-=.5,b.health<0&&(b.health=0),b.alpha=b.health/b.life,b.health<=0&&(b.health=b.life,b.x=this.x,b.y=this.y),0===b.x?b.visible&&(b.visible=!1):b.visible||(b.visible=!0)}},c.init=function(){this.bezierTween=TweenLite.to(this,5,{bezier:this.bezier,paused:!0,ease:Linear.easeNone}),this.progressTween=TweenMax.to(this.bezierTween,5,{progress:1,repeat:-1,ease:Linear.easeNone,onStart:this.start.bind(this),onUpdate:this.setSpeed.bind(this),delay:this.delay})},c.start=function(){this.setSpeed(),this.visible=!0,this.trails.map(function(a){a.visible=!0})},c.setSpeed=function(){TweenLite.to(this.progressTween,0,{timeScale:this.speed})},c.toggleFade=function(a){TweenMax.to(this,.2,{alpha:a,onComplete:this.fadeComplete.bind(this)})},c.fadeInOut=function(){TweenMax.to(this,.1,{alpha:1}),TweenMax.to(this,.1,{alpha:0,delay:this.blinkTime+.1,onComplete:this.fadeComplete.bind(this)})},c.fadeComplete=function(){this.hideTime=Math.randomFloat(parseFloat(this.minHideTime),parseFloat(this.maxHideTime)),this.blinking=!1,this.blink=!1},c.update=function(a){return this.blinking?void(this.blink||(this.blink=!0,this.fadeInOut())):(this.elapsedTime+=a,void(this.elapsedTime>=this.hideTime&&(this.elapsedTime=0,this.blinking=!0)))},c.stop=function(){this.progressTween&&this.progressTween.kill()},namespace("cave_hunt").GlowWorm=b}(),function(){"use strict";return platypus.createComponentClass({id:"Bat",properties:{},events:{load:function(){this.moveRight=this.moveRight.bind(this),this.moveLeft=this.moveLeft.bind(this),this.moveUp=this.moveUp.bind(this),this.moveDown=this.moveDown.bind(this),1==this.owner.flightPath?(this.fly(),this.moveRight()):2==this.owner.flightPath&&(this.fly(),this.moveUp())},clear:function(){TweenMax.killTweensOf(this.owner)}},methods:{fly:function(){this.owner.state.set("fly",!0)},face:function(a){"left"==a?this.owner.scaleX=1:this.owner.scaleX=-1},moveDown:function(){this.face("right"),TweenMax.to(this.owner,2,{y:this.owner.y+500,ease:Linear.none,onComplete:this.moveUp})},moveUp:function(){this.face("left"),TweenMax.to(this.owner,2,{y:this.owner.y-500,ease:Linear.none,onComplete:this.moveDown})},moveRight:function(){this.face("right"),TweenMax.to(this.owner,2,{x:this.owner.x+500,ease:Linear.none,onComplete:this.moveLeft})},moveLeft:function(){this.face("left"),TweenMax.to(this.owner,2,{x:this.owner.x-500,ease:Linear.none,onComplete:this.moveRight})},moveComplete:function(a){}}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("cave_hunt.Constants"),c=include("PIXI.Graphics"),d=include("cave_hunt.HUD"),e=include("cave_hunt.Daisy"),f=include("cave_hunt.Tile"),g=include("cave_hunt.PausePopup"),h=include("cave_hunt.CompassPopup"),i=include("cave_hunt.CustomButton"),j=include("cave_hunt.ObjectPopup");return platypus.createComponentClass({id:"CompassManager",properties:{gameLayer:null,objectsLayer:null,tilesLayer:null,uiLayer:null,popupLayer:null,objectsData:null,objects:null,scrim:null,width:2e3,height:800,left:-1e3,top:-400,color:16777215,alpha:.4,findObjectIndex:null,inActivityTime:10,elapsedTime:0},publicProperties:{gameStarted:!1},initialize:function(){this.update=this.update.bind(this),this.onTileDown=this.onTileDown.bind(this),this.onBackPress=this.onBackPress.bind(this),this.onCompassClick=this.onCompassClick.bind(this);var a=platypus.game.app.config.challenges.compass.board;this.objectsData=a.objects,this.findObjectIndex=0},events:{"enter-scene":function(){platypus.game.app.music="Music_Challenge",this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.mapSound=platypus.game.app.sound.play("Ambience_Cave_Tunnel_And_Challenge_Loop",{loop:-1,volume:.2}),this.addScrim(this.popupLayer),this.addPopup("intro","Compass Challenge","KeyCompass",0),platypus.game.app.on("update",this.update),platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume()},load:function(){this.gameLayer=new a,this.owner.worldContainer.addChild(this.gameLayer),this.bg=new PIXI.Sprite(platypus.game.app.getCache("compass-bg")),this.bg.anchor.set(.5),this.bg.tint=8947848,this.gameLayer.addChild(this.bg),this.uiLayer=new a,this.owner.worldContainer.addChild(this.uiLayer),this.popupLayer=new a,this.owner.worldContainer.addChild(this.popupLayer),this.tilesLayer=new a,this.tilesLayer.y=384,this.gameLayer.addChild(this.tilesLayer),this.objectsLayer=new a,this.objectsLayer.y=384,this.gameLayer.addChild(this.objectsLayer),this.hud=new d(this.owner),this.hud.addCompass(),this.hud.x=-320,this.uiLayer.addChild(this.hud),this.hud.compass.interactive=!0,this.hud.compass.buttonMode=!0,this.hud.compass.on("pointerdown",this.onCompassClick),this.objects=[],this.addTiles(),this.objects.sort(this.compare),this.correctPath.sort(this.compare),this.correctPathIndex=0,this.backButton=this.addBackButton(this.popupLayer)},"back-pressed":function(){platypus.game.app.voPlayer.stop(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null)},"popup-close":function(a){"play"==a?(this.removeScrim(),this.findObjectIndex=0,this.startGame()):"home"==a?(this.removeScrim(),TweenMax.killAll(!1,!1,!0,!1),platypus.game.app.voPlayer.stop(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),platypus.game.app.trackEvent("Challenge compass","Complete"),platypus.game.loadScene("vault-screen")):"unpause"==a?(this.backButton.enabled=!0,platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume(),platypus.game.app.voPlayer.resume(),platypus.game.app.sound.resumeAll(),TweenMax.resumeAll()):"map"==a?(TweenMax.killAll(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),platypus.game.app.voPlayer.stop(),this.clear(),platypus.game.loadScene("map-screen")):"replay"==a&&(TweenMax.killAll(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),platypus.game.app.voPlayer.stop(),this.clear(),platypus.game.loadScene(platypus.game.currentScene.id))},"popup-removed":function(){this.removeScrim(),this.moveObject()},"camera-update":function(a){this.hud.x=a.viewport.left+188,this.backButton.x=a.viewport.left+10,this.backButton.y=a.viewport.top+10},"scene-ended":function(){this.clear()}},methods:{clear:function(){platypus.game.app.off("update",this.update),this.hud&&this.hud.compass&&this.hud.compass.off("pointerdown",this.onCompassClick),this.clearTiles(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.hud.clear(),this.popup&&this.popup.clear(),this.gameLayer&&(this.gameLayer.parent.removeChild(this.gameLayer),this.gameLayer=null),this.uiLayer&&this.uiLayer.parent.removeChild(this.uiLayer),this.uiLayer=null,this.popupLayer&&this.popupLayer.parent.removeChild(this.popupLayer),this.popupLayer=null,this.objectsLayer&&this.objectsLayer.parent.removeChild(this.objectsLayer),this.objectsLayer=null},onCompassClick:function(){if(!(this.correctPathIndex>=this.correctPath.length||platypus.game.app.gamePaused)){var a=this.correctPath[this.correctPathIndex],b=this.getDirection(a);b&&this.hud.compass.highlight(b,!0)}},playInActivity:function(){if(!platypus.game.app.voPlayer.playing&&!platypus.game.app.gamePaused){var a=this.getAvailableSpaces();a.map(function(a){a.highlightGreen(3)}),platypus.game.app.voPlayer.play("CH_Challenge_Compass_Inactivity_Hal")}},update:function(a){var b=a/1e3;platypus.game.app.gamePaused||(this.gameStarted&&(this.elapsedTime+=b),this.elapsedTime>this.inActivityTime&&(this.elapsedTime=0,this.playInActivity()))},startGame:function(){this.gameStarted=!0,this.gameLayer.interactive=!0,this.daisy.visible=!0,this.objectsLayer.interactiveChildren=!0,this.tilesLayer.interactiveChildren=!0,this.elapsedTime=0;var a=this.correctPath[this.correctPathIndex],b=this.getDirection(a);b&&this.hud.compass.highlight(b),this.spaces=this.getAvailableSpaces(),this.highlightTiles(this.spaces),this.hud.updateHighlight(this.findObjectIndex),this.anounceObject(b)},anounceObject:function(a){var b=["CH_Challenge_Compass_Item_Intro_1_Looks_Like_You_Need_To_Find_A_Hal",this.objects[this.findObjectIndex].vo];0===this.correctPathIndex&&(b.push("CH_Challenge_Compass_Item_Intro_2_Just_Head_In_The_Direction_Hal"),b.push("CH_Challenge_Compass_Item_Intro_After_Tap_One_Of_The_Hal")),b.push(["CH_Challenge_Compass_Daisy_Go_A_Hal","CH_Challenge_Compass_Daisy_Go_B_Hal"].shuffle()[0]),b.push(["CH_Challenge_Compass_"+a+"_A_Hal","CH_Challenge_Compass_"+a+"_B_Hal","CH_Challenge_Compass_"+a+"_C_Hal"].shuffle()[0]),platypus.game.app.voPlayer.play(b)},compare:function(a,b){return a.index<b.index?-1:a.index>b.index?1:0},getAvailableSpaces:function(){var a=[],c=this.daisy.tile;if(c.row>0){var d=this.tiles[c.row-1][c.col];d&&!d.isWall&&(d.dir=b.Directions.North,a.push(d))}if(c.row+1<this.tiles.length){var e=this.tiles[c.row+1][c.col];e&&!e.isWall&&(e.dir=b.Directions.South,a.push(e))}if(c.col>0){var f=this.tiles[c.row][c.col-1];f&&!f.isWall&&(f.dir=b.Directions.West,a.push(f))}if(c.col+1<this.tiles[c.row].length){var g=this.tiles[c.row][c.col+1];g&&!g.isWall&&(g.dir=b.Directions.East,a.push(g))}return a},unhighlightTiles:function(a){a.map(function(a){a instanceof Array?this.unhighlightTiles(a):a.unhighlight()}.bind(this))},addTiles:function(){var a=platypus.game.app.config.challenges.compass.board,b=a.tilesMap,c=a.pathMap,d=128,e=-50,g=-b.length*d+.5*d;this.tiles=[];var h=null;this.correctPath=[];for(var i=0;i<b.length;i++){var j=b[i],k=c[i];this.tiles[i]=[];for(var l=0;l<j.length;l++){var m=j[l];if(0!==m){var n=this.getTilePropsByType(m);h=new f(n.name,i,l),h.setAnchor(n.x,n.y),h.x=e+124*l,h.y=g+i*d,this.tiles[i][l]=h,this.tilesLayer.addChild(h),m>0?(h.interactive=!0,h.buttonMode=!0,h.on("pointerdown",this.onTileDown)):h.isWall=!0;var o=k[l];o instanceof Array&&(this.addCritter(h,o[1]),o=o[0]),-1==o?this.addDaisy(h):o>0&&(h.index=o,this.correctPath.push(h))}}}},getTilePropsByType:function(a){var b={};switch(a){case"s1":b.name="Wall-1space",b.x=.5,b.y=.45;break;case"s2v":b.name="Wall-2space-vert",b.x=.5,b.y=.22;break;case"s2h":b.name="Wall-2space-horiz",b.x=.25,b.y=.45;break;case"s4h":b.name="Wall-4space-horiz",b.x=.125,b.y=.45;break;case"l":b.name="Wall-elbow",b.x=.25,b.y=.23;break;default:b.name="FloorTile"+a,b.x=.5,b.y=.5}return b},clearTiles:function(){if(this.tiles)for(var a=0;a<this.tiles.length;a++)for(var b=this.tiles[a],c=0;c<b.length;c++){var d=b[c];d&&d instanceof f&&(d.off("pointerdown",this.onTileDown),d.parent&&d.parent.removeChild(d)),d=null}},playDirVOWithGo:function(a){platypus.game.app.voPlayer.play([["CH_Challenge_Compass_Daisy_Go_A_Hal","CH_Challenge_Compass_Daisy_Go_B_Hal"].shuffle()[0],["CH_Challenge_Compass_"+a+"_A_Hal","CH_Challenge_Compass_"+a+"_B_Hal","CH_Challenge_Compass_"+a+"_C_Hal"].shuffle()[0]])},onTileDown:function(a){if(!platypus.game.app.gamePaused){this.elapsedTime=0;var b=a.currentTarget;if(this.spaces&&b!=this.daisy.tile&&!this.isMoving){var c=!1,d=this.correctPath[this.correctPathIndex],e=null;if(this.spaces.indexOf(b)>-1)if(d==b){if(e=this.getDirection(d),this.daisy.move(b,!0,e),this.moveCamera(b),this.unhighlightTiles(this.tiles),this.hud.compass.unhighlight(),this.correctPathIndex++,this.correctPathIndex<this.correctPath.length){this.spaces=this.getAvailableSpaces(),this.highlightTiles(this.spaces),d=this.correctPath[this.correctPathIndex];var f=this.getDirection(d);b.hasCritter||TweenMax.delayedCall(.7,this.playDirVOWithGo.bind(this,f))}}else b.highlightRed(),c=!0,platypus.game.app.voPlayer.play("CH_Challenge_Compass_Wrong_Direction_Whoopsie_Thats_The_Wrong_Direction_Hal"),platypus.game.app.sound.play("Challenge_Compass_Wrong_Square");else platypus.game.app.voPlayer.play("CH_Challenge_Compass_Wrong_Not_Lit_Square_Cant_Hop_There_Hal"),platypus.game.app.sound.play("Challenge_Compass_Wrong_Square");d&&(e=this.getDirection(d),e?this.hud.compass.highlight(e,c):this.hud.compass.unhighlight())}}},getDirection:function(a){var c=this.daisy.tile,d=null;return a.row==c.row?a.col<c.col?d=b.Directions.West:a.col>c.col&&(d=b.Directions.East):a.col==c.col&&(a.row<c.row?d=b.Directions.North:a.row>c.row&&(d=b.Directions.South)),d},highlightTiles:function(a){a instanceof Array?a.map(function(a){a.highlight()}):a instanceof f&&a.highlight()},moveDaisy:function(a,b){if(this.daisy){var c=null;c=a instanceof f?a:this.tiles[a][b],this.daisy.move(c,!0)}},moveCamera:function(a){this.isMoving=!0,a.hasCritter&&(this.objectsLayer.interactiveChildren=!1,this.tilesLayer.interactiveChildren=!1,this.gameStarted=!1,this.elapsedTime=0);var b=this.tilesLayer.y+a.y;if(0>b){var c=this.tilesLayer.y-2*b;TweenMax.to(this.tilesLayer,.7,{y:c,onComplete:this.moveCameraComplete.bind(this)}),TweenMax.to(this.objectsLayer,.7,{y:c})}else TweenMax.delayedCall(.7,this.moveCameraComplete.bind(this))},moveCameraComplete:function(){this.isMoving=!1;var a=this.daisy.tile;a.hasCritter&&(a.hasCritter.visible=!0,this.uiLayer.addChild(a.hasCritter),a.hasCritter.y=this.tilesLayer.y+a.hasCritter.y,platypus.game.app.sound.play("Challenge_Compass_Item_Reveal_Daisy_Photo_"),TweenMax.delayedCall(.5,this.makeBigger.bind(this,this.daisy.tile.hasCritter)))},flash:function(){var a=1800,b=900;this.flashGraphic=(new PIXI.Graphics).beginFill(16777215),this.flashGraphic.drawRect(.5*-a,.5*-b,a,b),this.popupLayer.addChild(this.flashGraphic),TweenMax.to(this.flashGraphic,1,{alpha:0,ease:Quad.easeOut,onComplete:this.flashComplete.bind(this)}),platypus.game.app.sound.play("Challenge_Compass_Item_Reveal_Daisy_Photo_")},flashComplete:function(){this.flashGraphic.parent.removeChild(this.flashGraphic),this.flashGraphic=null,this.makeBigger(this.daisy.tile.hasCritter)},addCritter:function(a,b){var c=this.objectsData[b].name;this.compassAtlas=platypus.game.app.getCache("compass-atlas");var d=new PIXI.Sprite(this.compassAtlas.getFrame(c+"-Color"));d.anchor.set(.5),d.position=a.position,d.name=c,d.display=this.objectsData[b].display,d.vo=this.objectsData[b].vo,d.visible=!1,d.index=b,a.hasCritter=d,this.objectsLayer.addChild(d),this.objects.push(d)},addDaisy:function(a){this.daisy||(this.daisy=new e(this.owner)),this.objectsLayer.addChild(this.daisy),this.daisy.visible=!1,this.daisy.move(a,!1,b.Directions.North)},makeBigger:function(a){var b=1;a.texture=this.compassAtlas.getFrame("Compass_Found-"+a.name),a.scale.set(.6),TweenMax.to(a.scale,1,{x:b,y:b,onComplete:this.biggerComplete.bind(this),onCompleteParams:[a]}),TweenMax.to(a,1,{x:0,y:0})},biggerComplete:function(a){this.addScrim(this.popupLayer),this.addObjectPopup(a)},delayComplete:function(){this.removeObjectPopup()},moveObject:function(){var a=this.objects[this.findObjectIndex];a.anchor.set(.5),a.scale.set(.6),this.uiLayer.addChild(a);var b=this.hud.getObjectPosition(this.findObjectIndex);TweenMax.to(a,1,{x:b.x,y:b.y,delay:.5,onComplete:this.moveComplete.bind(this),onCompleteParams:[this.findObjectIndex]})},moveComplete:function(a){var c=this.objects[this.findObjectIndex];c.parent&&(c.parent.removeChild(c),c=null),this.hud.updateCollected(a),this.findObjectIndex>=this.objectsData.length-1?(this.addScrim(this.popupLayer),this.saveProgress(b.keys.compass),this.addPopup("win","YOU GOT A KEY!!","KeyCompass")):(this.findObjectIndex++,this.startGame())},saveProgress:function(a){platypus.game.app.saveData[a]||(platypus.game.app.saveData[a]={}),platypus.game.app.saveData[a].gotKey=!0,platypus.game.app.save()},addPopup:function(a,b,c,d){this.popup||(this.popup=new h(this.owner)),this.popup.show(this.popupLayer,a,b,c,d)},addObjectPopup:function(a){this.objectPopup||(this.objectPopup=new j(this.owner)),a.scale.set(1),this.objectPopup.object=a,this.objectPopup.add(a),this.popupLayer.addChild(this.objectPopup),this.objectPopup.show();var b=["CH_Challenge_Compass_Success_A_1_Looks_Like_We_Found_A_Hal",a.vo],c=3.5;if(this.findObjectIndex<this.objects.length-1){var d=["CH_Challenge_Compass_Success_A_2_Lets_Photograph_Another_Critter_Hal","CH_Challenge_Compass_Success_B_Hey_We_Figured_Hal","CH_Challenge_Compass_Success_C_We_Got_Another_Great_Photo_Hal"].shuffle()[0];b.push(d),c="CH_Challenge_Compass_Success_B_Hey_We_Figured_Hal"==d?7:5}platypus.game.app.voPlayer.play(b),TweenMax.delayedCall(c,this.delayComplete.bind(this))},removeObjectPopup:function(){this.objectPopup&&this.objectPopup.hide()},removePopup:function(){this.popup&&this.popupLayer.removeChild(this.popup)},removeScrim:function(){this.scrim&&this.scrim.parent&&this.scrim.parent.removeChild(this.scrim)},addScrim:function(a){this.scrim||(this.scrim=(new c).beginFill(0,this.alpha),this.scrim.drawRect(this.left,this.top,this.width,this.height)),a.addChildAt(this.scrim,0)},onBackPress:function(){this.backButton.enabled=!1,platypus.game.app.gamePaused=!0,platypus.game.app.animator.pause(),platypus.game.app.voPlayer.pause(),platypus.game.app.sound.pauseAll(),TweenMax.pauseAll(),this.addPausePopup()},addPausePopup:function(){this.pausePopup||(this.pausePopup=new g(this.owner)),this.pausePopup.show(this.owner.worldContainer)},addBackButton:function(a){var b=platypus.game.app.getCache("popup-atlas"),c=new i({up:b.getFrame("Back_Btn_Normal"),over:b.getFrame("Back_Btn_Over"),down:b.getFrame("Back_Btn_Down"),disabled:b.getFrame("Back_Btn_Disabled")});return c.on("buttonPress",this.onBackPress),a.addChild(c),c}}})}(),function(){"use strict";return platypus.createComponentClass({id:"NameOfComponent",properties:{propertyName1:"property-value"},publicProperties:{propertyName2:"property-value"},initialize:function(){},events:{},methods:{},publicMethods:{}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("springroll.pixi.AdvancedMovieClip"),c=include("cave_hunt.CustomButton"),d=include("cave_hunt.GlowWorm"),e=include("cave_hunt.PausePopup"),f=include("cave_hunt.Constants");return platypus.createComponentClass({id:"DanceManager",properties:{bg:null,glowWorms:[],rotateWorms:!1,wormsAdded:0,key:"danced-stars"},events:{"enter-scene":function(){platypus.game.app.music="Music_Glow_Worm_Dance",this.totStars=this.getTotalStars(),this.worms=20;var a=this.getParameterByName("stars"),b=this.getParameterByName("worms");a&&(this.totStars=parseInt(a)),b&&(this.worms=b),platypus.game.app.trackEvent("Dance Stars "+this.totStars,"Dance"),this.move(this.bartShadow,1e3,.6,3.5,"bart"),TweenMax.delayedCall(1,this.playVos.bind(this)),this.bezier={autoRotate:["x","y","rotation",Math.PI/2,!0],values:this.getPathByStars(3),type:"cubic"},this.glowWorms=[],this.minStars=3,this.wormsAdded=0,platypus.game.app.on("update",this.update),platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume()},load:function(){this.update=this.update.bind(this),this.onBackPress=this.onBackPress.bind(this),this.container=new a,this.owner.worldContainer.addChild(this.container),this.bg=new PIXI.Sprite(platypus.game.app.getCache("dance-bg")),this.bg.anchor.set(.5),this.container.addChild(this.bg),this.bg.color=(new PIXI.Graphics).beginFill(0,.45),this.bg.color.drawRect(-900,-500,1800,1e3),this.bg.color.alpha=0,this.bg.addChild(this.bg.color),this.backButton=this.addBackButton(this.container);var c=700;this.hal=new b(platypus.game.app.getCache("HalDanceAnim"),platypus.game.app.getCache("Hal-Dance")),this.hal.anchor.set(.5,1),this.container.addChild(this.hal),this.hal.x=-150-c,this.hal.posX=-150,this.hal.y=325,platypus.game.app.animator.play(this.hal,"dance"),this.daisy=new b(platypus.game.app.getCache("DaisyDanceAnim"),platypus.game.app.getCache("Daisy-Dance")),this.daisy.anchor.set(.5,1),this.container.addChild(this.daisy),this.daisy.x=-50-c,this.daisy.posX=-50,this.daisy.y=325,platypus.game.app.animator.play(this.daisy,"dance"),this.squeaks=new b(platypus.game.app.getCache("SqueaksDanceAnim"),platypus.game.app.getCache("Squeaks-Dance")),this.squeaks.anchor.set(.5,1),this.container.addChild(this.squeaks),this.squeaks.x=50+c,this.squeaks.posX=50,this.squeaks.y=325,platypus.game.app.animator.play(this.squeaks,"dance"),this.nc=new b(platypus.game.app.getCache("NCDanceAnim"),platypus.game.app.getCache("NC-Dance")),this.nc.anchor.set(.5,1),this.container.addChild(this.nc),this.nc.x=150+c,this.nc.y=325,this.nc.posX=150,platypus.game.app.animator.play(this.nc,"dance"),this.bartShadow=new PIXI.Sprite(platypus.game.app.getCache("bart-shadow")),this.bartShadow.anchor.set(.5,.3),this.container.addChild(this.bartShadow),this.fg=new PIXI.Sprite(platypus.game.app.getCache("dance-toys")),this.fg.anchor.set(.5),this.container.addChild(this.fg)},"camera-update":function(a){this.backButton.x=a.viewport.left+10,this.backButton.y=a.viewport.top+10},"scene-ended":function(){this.clear()},"popup-close":function(a){"unpause"==a?(this.backButton.enabled=!0,platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume(),platypus.game.app.voPlayer.resume(),platypus.game.app.sound.resumeAll(),TweenMax.resumeAll()):"map"==a?(TweenMax.killAll(),platypus.game.app.voPlayer.stop(),platypus.game.app.off("update",this.update),this.clear(),platypus.game.loadScene("map-screen")):"replay"==a&&(TweenMax.killAll(),platypus.game.app.voPlayer.stop(),platypus.game.app.off("update",this.update),this.clear(),platypus.game.loadScene(platypus.game.currentScene.id))}},methods:{getDancedStars:function(a){return platypus.game.app.saveData[a]&&platypus.game.app.saveData[a].danceStars?platypus.game.app.saveData[a].danceStars:0},updateStars:function(a,b){for(var c=0,d=!1,e=a;b>e;e++)e==b-1&&(d=!0),TweenMax.delayedCall(1+.4*c,this.fillStar.bind(this,e,d)),++c},fillStar:function(a,b){var c=this.stars[a];c.texture=this.atlas.getFrame("star-fill"),TweenMax.to(c.scale,.2,{x:1.5*c.origScale,y:1.5*c.origScale,ease:Elastic.sineOut}),TweenMax.to(c.scale,.2,{x:c.origScale,y:c.origScale,ease:Elastic.sineIn,delay:.2}),platypus.game.app.sound.play("Star_Awarded"),b&&this.switchDance(this.minStars)},addStars:function(a){this.atlas=platypus.game.app.getCache("popup-atlas"),this.stars=[];for(var b=-391,c=-310,d=0;9>d;d++){var e=new PIXI.Sprite;a>0&&a>d?e.texture=this.atlas.getFrame("star-fill"):e.texture=this.atlas.getFrame("star-empty"),e.anchor.set(.5),e.x=b+99*d,e.y=c,e.origScale=.65,e.scale.set(e.origScale),this.container.addChild(e),this.stars.push(e)}},getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},getPathByStars:function(a){var b=null;switch(a){case 3:b=platypus.game.app.config.dance.triangle;break;case 4:b=platypus.game.app.config.dance.square;break;case 5:b=platypus.game.app.config.dance.circle;break;case 6:b=platypus.game.app.config.dance.star;break;case 7:b=platypus.game.app.config.dance.spiral;break;case 8:b=platypus.game.app.config.dance.infinity;break;case 9:b=platypus.game.app.config.dance.flower}return b},playVos:function(){platypus.game.app.voPlayer.play(["CH_Glow_Worm_Dance_1_NC","CH_Glow_Worm_Dance_2_Daisy","CH_Glow_Worm_Dance_3_Squeeks","CH_Glow_Worm_Dance_4_Hal","CH_Glow_Worm_Dance_5_Daisy","CH_Glow_Worm_Dance_5_HAl","CH_Glow_Worm_Dance_5_NC","CH_Glow_Worm_Dance_5_Squeeks"])},move:function(a,b,c,d,e){TweenMax.to(a,d,{delay:c,x:b,ease:Linear.easeNone,onComplete:this.moveComplete.bind(this),onCompleteParams:[e]})},fadeOut:function(){TweenMax.to(this.bg.color,.5,{alpha:1,ease:Quad.easeOut})},moveComplete:function(a){if("bart"==a){this.fadeOut();var b=this.getDancedStars(this.key);if(this.addStars(b),b<this.totStars){if(this.updateStars(b,this.totStars),this.startDance(),this.getParameterByName("debug"))return;platypus.game.app.saveData[this.key]||(platypus.game.app.saveData[this.key]={}),platypus.game.app.saveData[this.key].danceStars=this.totStars,platypus.game.app.save()}else this.switchDance(this.minStars),this.startDance()}},startDance:function(){this.move(this.nc,this.nc.posX,10,5,"nc"),this.move(this.hal,this.hal.posX,10,5,"nc"),this.move(this.daisy,this.daisy.posX,10,5,"nc"),this.move(this.squeaks,this.squeaks.posX,10,5,"nc")},switchDance:function(a){a>this.totStars&&(a=this.minStars),this.bezier.values=this.getPathByStars(a),this.createDance(this.worms),this.totStars>this.minStars&&TweenMax.delayedCall(5,this.switchDance.bind(this,a+1))},getStars:function(a){return platypus.game.app.saveData[a]?platypus.game.app.saveData[a].stars:0},getTotalStars:function(){return this.getStars(f.Tunnels.HiddenFalls)+this.getStars(f.Tunnels.ColossalCaves)+this.getStars(f.Tunnels.CritterCavern)},update:function(a){var b=a/1e3;if(this.glowWorms&&!platypus.game.app.gamePaused)for(var c=this.glowWorms.length,d=null,e=null,f=0;c>f;f++){d=this.glowWorms[f],this.rotateWorms&&(d.rotation+=.01);for(var g=0;g<d.gws.length;g++)e=d.gws[g],e.update(b);if(c-1>f&&(d.alpha-=.1,d.alpha<=0)){this.glowWorms.splice(f,1);break}}},createDance:function(a){this.wormsAdded=a;var b=new PIXI.Container;b.y=-70,b.gws=[];var c=0;a>1&&(c=5/a);for(var e=this.getParameterByName("minHideTime"),f=this.getParameterByName("maxHideTime"),g=this.getParameterByName("blinkTime"),h=1,i=this.bezier.values.length-h,j=0;i>=j;j+=h){var k=new d(b,this.bezier,1,j*c,e,f,g),l=this.bezier.values[j];k.x=l.x,k.y=l.y,b.gws.push(k)}this.container.addChild(b),this.glowWorms.push(b)},stopDance:function(a){a.map(function(a){a.stop()})},clear:function(){for(var a=this.glowWorms.length,b=0;a>b;b++){var c=this.glowWorms[b];this.stopDance(c.gws),c.parent&&c.parent.removeChild(c),c=null}if(this.stars)for(a=this.stars.length,b=0;a>b;b++)this.stars[b].parent.removeChild(this.stars[b]),this.stars[b]=null;this.stars=null,this.nc&&(this.nc.parent.removeChild(this.nc),this.nc=null),this.hal&&(this.hal.parent.removeChild(this.hal),this.hal=null),this.squeaks&&(this.squeaks.parent.removeChild(this.squeaks),this.squeaks=null),this.daisy&&(this.daisy.parent.removeChild(this.daisy),this.daisy=null),this.backButton&&(this.backButton.off("pointerdown",this.onBackPress),this.backButton.parent.removeChild(this.backButton),this.backButton=null),this.bg&&(this.bg.parent.removeChild(this.bg),this.bg=null),this.bartShadow&&(this.bartShadow.parent.removeChild(this.bartShadow),this.bartShadow=null),this.fg&&(this.fg.parent.removeChild(this.fg),this.fg=null),this.container&&(this.container.parent.removeChild(this.container),this.container=null)},onBackPress:function(){this.backButton.enabled=!1,platypus.game.app.gamePaused=!0,platypus.game.app.animator.pause(),platypus.game.app.voPlayer.pause(),platypus.game.app.sound.pauseAll(),TweenMax.pauseAll(),this.addPausePopup()},addPausePopup:function(){this.pausePopup||(this.pausePopup=new e(this.owner)),this.pausePopup.show(this.owner.worldContainer)},addBackButton:function(a){var b=platypus.game.app.getCache("popup-atlas"),d=new c({up:b.getFrame("Back_Btn_Normal"),over:b.getFrame("Back_Btn_Over"),down:b.getFrame("Back_Btn_Down"),disabled:b.getFrame("Back_Btn_Disabled")});return d.on("buttonPress",this.onBackPress),a.addChild(d),d}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Door",initialize:function(){this.opened=!1},events:{load:function(){},"open-door":function(a){!this.opened&&a.entity.state.get("grounded")&&(this.opened=!0,this.owner.state.set("open",!0),this.owner.trigger("open"),this.owner.paused=!0,a.entity.trigger("stop-game"),TweenMax.delayedCall(1,this.openChallenge.bind(this)))}},methods:{openChallenge:function(){this.owner.trigger("door-open")}}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("PIXI.Graphics"),c=include("cave_hunt.HUD"),d=include("cave_hunt.Squeaks"),e=include("cave_hunt.DusterPopup"),f=include("cave_hunt.PausePopup"),g=include("cave_hunt.Constants"),h=include("cave_hunt.ObjectPopup"),i=include("cave_hunt.CustomButton"),j=include("cave_hunt.HiddenObject");return platypus.createComponentClass({id:"DusterManager",properties:{gameLayer:null,objectsLayer:null,hexLayer:null,uiLayer:null,popupLayer:null,objectsData:null,objects:null,scrim:null,width:2e3,height:800,left:-1e3,top:-400,color:16777215,alpha:.4,findObjectIndex:null,rows:64,cols:40,inActivityTime:10,elapsedTime:0,squeaksStartX:650},publicProperties:{gameStarted:!1,moveBrush:!1},initialize:function(){this.objectsData=platypus.game.app.config.challenges.duster.objects,this.positions=platypus.game.app.config.challenges.duster.positions,this.dustingSpeed=platypus.game.app.config.challenges.duster.dustingSpeed,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.update=this.update.bind(this),this.onBackPress=this.onBackPress.bind(this)},events:{"enter-scene":function(){platypus.game.app.music="Music_Challenge",this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.mapSound=platypus.game.app.sound.play("Ambience_Cave_Tunnel_And_Challenge_Loop",{loop:-1,volume:.2}),this.addScrim(this.popupLayer),this.addPopup("intro","Dust Brush Challenge","KeyDuster",0),this.squeaks.body.on("pointerdown",this.onPointerDown),this.gameLayer.on("pointerup",this.onPointerUp),this.gameLayer.on("pointermove",this.onPointerMove),platypus.game.app.on("update",this.update),platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume()},load:function(){this.gameLayer=new a,this.owner.worldContainer.addChild(this.gameLayer),this.bg=new PIXI.extras.TilingSprite(platypus.game.app.getCache("flashlight-bg"),2048,768),this.bg.anchor.set(.5),this.bg.tint=8947848,this.gameLayer.addChild(this.bg),this.uiLayer=new a,this.owner.worldContainer.addChild(this.uiLayer),this.popupLayer=new a,this.owner.worldContainer.addChild(this.popupLayer),this.objectsLayer=new a,this.gameLayer.addChild(this.objectsLayer),this.hexLayer=new a,this.gameLayer.addChild(this.hexLayer),this.renderSprite=new PIXI.Sprite,this.overlayLayer=new a,this.gameLayer.addChild(this.overlayLayer),this.overlayBg=new PIXI.extras.TilingSprite(platypus.game.app.getCache("flashlight-bg"),2048,768),this.overlayBg.anchor.set(.5),this.overlayBg.tint=8947848,this.overlayBg.alpha=.5,this.overlayLayer.addChild(this.overlayBg),this.squeaks=new d(this.owner,!0),this.squeaks.x=-100,this.squeaks.y=220,this.squeaks.visible=!1,this.gameLayer.addChild(this.squeaks),this.hud=new c(this.owner),this.hud.addObjects(this.objectsData),this.uiLayer.addChild(this.hud),this.addObjects(),this.addHexes(),this.addEmitter(),this.backButton=this.addBackButton(this.popupLayer)},"popup-close":function(a){"play"==a?(this.removeScrim(),this.findObjectIndex=0,this.startGame(),TweenMax.delayedCall(4,this.playPickUpVO.bind(this))):"home"==a?(this.removeScrim(),TweenMax.killAll(!1,!1,!0,!1),platypus.game.app.voPlayer.stop(),platypus.game.app.sound.stop(),this.removeEventListeners(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),platypus.game.app.trackEvent("Challenge duster","Complete"),platypus.game.loadScene("vault-screen")):"unpause"==a?(this.backButton.enabled=!0,platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume(),platypus.game.app.voPlayer.resume(),platypus.game.app.sound.resumeAll(),TweenMax.resumeAll()):"map"==a?(TweenMax.killAll(),platypus.game.app.voPlayer.stop(),platypus.game.app.sound.stop(),this.removeEventListeners(),this.squeaks&&this.squeaks.stop(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.clear(),platypus.game.loadScene("map-screen")):"replay"==a&&(TweenMax.killAll(),platypus.game.app.voPlayer.stop(),platypus.game.app.sound.stop(),this.removeEventListeners(),this.squeaks&&this.squeaks.stop(),
this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.clear(),platypus.game.loadScene(platypus.game.currentScene.id))},"popup-removed":function(){this.moveObject()},"back-pressed":function(){platypus.game.app.voPlayer.stop(),platypus.game.app.sound.stop(),this.removeEventListeners(),this.squeaks&&this.squeaks.stop(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null)},"camera-update":function(a){this.hud.x=a.viewport.left+50,this.backButton.x=a.viewport.left+10,this.backButton.y=a.viewport.top+10},"scene-ended":function(){this.clear()}},methods:{clear:function(){this.removeEventListeners(),this.hud.clear(),this.squeaks&&(this.squeaks.stop(),this.squeaks.parent.addChild(this.squeaks),this.squeaks=null),this.popup&&this.popup.clear(),this.gameLayer&&this.gameLayer.parent.removeChild(this.gameLayer),this.gameLayer=null,this.uiLayer&&this.uiLayer.parent.removeChild(this.uiLayer),this.uiLayer=null,this.popupLayer&&this.popupLayer.parent.removeChild(this.popupLayer),this.popupLayer=null,this.objectsLayer&&this.objectsLayer.parent.removeChild(this.objectsLayer),this.objectsLayer=null},removeEventListeners:function(){this.squeaks&&this.squeaks.body.off("pointerdown",this.onPointerDown),this.gameLayer&&(this.gameLayer.off("pointerup",this.onPointerUp),this.gameLayer.off("pointermove",this.onPointerMove)),platypus.game.app.off("update",this.update)},startGame:function(){this.gameStarted=!0,this.squeaks.visible=!0,this.randomiseObjects(),this.setCollidingHexes(this.findObjectIndex),this.hud.updateHighlight(this.findObjectIndex),this.elapsedTime=0,this.anounceObject()},playPickUpVO:function(){platypus.game.app.voPlayer.playing||this.moveBrush||platypus.game.app.voPlayer.play(["CH_Challenge_Duster_Inactivity_Daisy","CH_Challenge_Duster_Inactivity_Not_Dusting_A_Squeeks","CH_Challenge_Duster_Inactivity_Not_Dusting_B_Squeeks"].shuffle()[0])},anounceObject:function(){platypus.game.app.voPlayer.play(["CH_Challenge_Duster_The _Next_Fossil_You_Need_To_Find_Is_Daisy",this.objects[this.findObjectIndex].vo])},playInActivity:function(){this.elapsedTime=0,this.squeaks.highlight(),this.playPickUpVO()},update:function(a){var b=a/1e3;if(!platypus.game.app.gamePaused&&(this.emitter&&this.emitter.update(b),this.gameStarted&&!this.moveBrush&&(this.elapsedTime+=b),this.elapsedTime>this.inActivityTime&&this.playInActivity(),this.grid&&this.squeaks&&this.moveBrush)){for(var c=0;c<this.cols;c++)for(var d=0;d<this.rows;d++){var e=this.grid[c][d];this.squeaks.contains(this.hexLayer.x+e.position.x,this.hexLayer.y+e.position.y)&&(e.alpha-=this.dustingSpeed)}this.collidingHexes&&(this.checkWin()&&this.foundObject(),this.updateEmitterPos())}},updateEmitterPos:function(){this.emitter&&this.emitter.updateSpawnPos(this.squeaks.x+this.squeaks.emitterX,this.squeaks.y+this.squeaks.emitterY)},foundObject:function(){this.squeaks.tapped=!1,this.onPointerUp(),this.gameLayer.interactive=!1,this.gameLayer.interactiveChildren=!1,this.gameStarted=!1,this.makeBigger(this.findObjectIndex),platypus.game.app.sound.play(["Challenge_Duster_Item_Reveal","Challenge_Duster_Item_Reveal_2"].shuffle()[0])},checkWin:function(){var a=this.collidingHexes.filter(function(a){return a.alpha>.1});return a.length<1},setCollidingHexes:function(a){this.collidingHexes=[];for(var b=this.objects[a],c=0;c<this.cols;c++)for(var d=0;d<this.rows;d++){var e=this.grid[c][d],f=b.x-(this.hexLayer.x+e.x),g=b.y-(this.hexLayer.y+e.y),h=Math.sqrt(f*f+g*g);h<b.radius+e.radius&&this.collidingHexes.push(e)}},addHexes:function(){this.grid=[];for(var a=-650,b=-420,c=.5,d=48*c,e=41*c,f=platypus.game.app.getCache("objects-atlas"),g=0;g<this.cols;g++){this.grid[g]=[];for(var h=0;h<this.rows;h++){var i=new PIXI.Sprite(f.getFrame("DustHex-Full"));i.x=(g%2===0?.5*-d:0)+h*d,i.y=g*e,i.radius=.5*e,i.anchor.set(.5),i.scale.set(c),i.oAlpha=1,i.alpha=i.oAlpha,this.grid[g][h]=i,this.hexLayer.addChild(i)}}this.hexLayer.x=this.hexLayer.startX=a,this.hexLayer.y=b},getAlpha:function(a,b){var c=5,d=a%(this.cols-c),e=b;d=a>d?c-d:d,e=b>e?c-e:e;var f=d,g=.25,h=f*g;return 1>=h?Math.random()*h:h=1},resetHexes:function(){for(var a=0;a<this.cols;a++)for(var b=0;b<this.rows;b++){var c=this.grid[a][b];c.alpha=c.oAlpha}this.hexLayer.visible=!0},makeAppear:function(a){a.visible=!0},addObjects:function(){this.objects=[];for(var a=0;a<this.objectsData.length;a++){var b=this.objectsData[a],c=new j(b.name);this.objectsLayer.addChild(c),c.interactive=!0,c.buttonMode=!0,c.name=b.name,c.display=b.display,c.vo=b.vo,c.visible=!1,this.objects.push(c)}},randomiseObjects:function(){var a=this.objects[this.findObjectIndex];a.x=-175+550*Math.random(),a.y=-150+460*Math.random(),a.visible=!0,this.gameLayer.interactive=!0,this.gameLayer.interactiveChildren=!0},makeBigger:function(a){var b=1,c=this.objects[a];this.uiLayer.addChild(c),TweenMax.to(c.scale,1,{x:b,y:b,onComplete:this.biggerComplete.bind(this),onCompleteParams:[a]}),TweenMax.to(c,1,{x:0,y:0})},biggerComplete:function(a){var b=this.objects[a];this.addObjectPopup(b),this.squeaks.x=-this.squeaksStartX,TweenMax.delayedCall(3,this.delayComplete.bind(this))},delayComplete:function(){this.removeObjectPopup()},moveObject:function(){var a=this.objects[this.findObjectIndex];a instanceof j?a.object.anchor.set(.5):a.anchor.set(.5),a.scale.set(.4),this.uiLayer.addChild(a);var b=this.hud.getObjectPosition(this.findObjectIndex);TweenMax.to(a,1,{x:b.x,y:b.y,delay:.5,onComplete:this.moveComplete.bind(this),onCompleteParams:[this.findObjectIndex]})},moveComplete:function(a){var b=this.objects[this.findObjectIndex];b.parent&&(b.parent.removeChild(b),b=null),this.hud.updateCollected(a),this.findObjectIndex>=this.objects.length-1?(this.addScrim(this.popupLayer),this.saveProgress(g.keys.duster),this.addPopup("win","YOU GOT A KEY!!","KeyDuster"),TweenMax.delayedCall(3,this.playWinVO.bind(this))):(this.squeaks.walkIn(),this.moveBackground())},playWinVO:function(){platypus.game.app.voPlayer.play("CH_Challenge_Duster_Complete_Key_Pop_Squeeks")},saveProgress:function(a){platypus.game.app.saveData[a]||(platypus.game.app.saveData[a]={}),platypus.game.app.saveData[a].gotKey=!0,platypus.game.app.save()},createClone:function(){this.rt&&this.rt.destroy(),this.rt=new PIXI.RenderTexture(platypus.game.app.display.renderer,this.hexLayer.width,this.hexLayer.height),this.rt.render(this.hexLayer),this.renderSprite.texture=this.rt,this.renderSprite.x=.98*-this.hexLayer.width,this.hexLayer.addChild(this.renderSprite)},moveBackground:function(){var a=this.hexLayer.startX+.98*this.hexLayer.width;this.createClone(),this.resetHexes(),this.hexLayer.x=a;var b=2*this.squeaksStartX;TweenMax.to(this.bg.tilePosition,5,{x:"-="+b,ease:Linear.easeNone,onComplete:this.moveBGComplete.bind(this)}),TweenMax.to(this.overlayBg.tilePosition,5,{ease:Linear.easeNone,x:"-="+b}),TweenMax.to(this.hexLayer,5,{ease:Linear.easeNone,x:this.hexLayer.startX})},moveBGComplete:function(){this.hexLayer.removeChild(this.renderSprite),this.findObjectIndex++,this.startGame()},addPopup:function(a,b,c,d){this.popup||(this.popup=new e(this.owner,this)),this.popup.show(this.popupLayer,a,b,c,d)},addObjectPopup:function(a){this.objectPopup||(this.objectPopup=new h(this.owner)),a.found(),this.objectPopup.add(a),this.popupLayer.addChild(this.objectPopup),this.objectPopup.show();var b=["CH_Challenge_Duster_Success_Sweet_Job_Looks_Like_You_Found_Daisy",a.vo];this.findObjectIndex<this.objects.length-1&&b.push(["CH_Challenge_Duster_Success_After_A_Daisy","CH_Challenge_Duster_Success_After_B_Daisy","CH_Challenge_Duster_Success_After_C_Daisy"].shuffle()[0]),platypus.game.app.voPlayer.play(b)},removeObjectPopup:function(){this.objectPopup&&this.objectPopup.hide()},removePopup:function(){this.popup&&this.popupLayer.removeChild(this.popup)},removeScrim:function(){this.scrim&&this.scrim.parent&&this.scrim.parent.removeChild(this.scrim)},addScrim:function(a){this.scrim||(this.scrim=(new b).beginFill(0,this.alpha),this.scrim.drawRect(this.left,this.top,this.width,this.height)),a.addChildAt(this.scrim,0)},onPointerMove:function(a){this.moveBrush&&this.gameStarted&&!platypus.game.app.gamePaused&&(this.input=this.gameLayer.toLocal(a.data.global),this.squeaks.position=this.input,this.elapsedTime=0)},onPointerDown:function(a){platypus.game.app.gamePaused||(this.input=this.gameLayer.toLocal(a.data.global),this.squeaks.position=this.input,this.moveBrush=!0,this.squeaks.animate(),this.squeaks.tapped=!this.squeaks.tapped,this.updateEmitterPos(),this.emitter.emit=!0,this.emitter.parent=this.overlayLayer,(this.squeaks.tapped||g.isMobile.any())&&platypus.game.app.voPlayer.play(["CH_Challenge_Duster_Picked_Up_A_Squeeks","CH_Challenge_Duster_Picked_Up_B_Squeeks","CH_Challenge_Duster_Picked_Up_C_Squeeks"].shuffle()[0]))},onPointerUp:function(a){this.squeaks.tapped&&!g.isMobile.any()||platypus.game.app.gamePaused||(this.squeaks.resetBrush(),this.squeaks.stop(),this.moveBrush=!1,this.emitter.emit=!1)},addEmitter:function(){this.emitter=new PIXI.particles.Emitter(this.overlayLayer,[platypus.game.app.getCache("particle")],{alpha:{start:1,end:0},scale:{start:.5,end:.09,minimumScaleMultiplier:1.24},color:{start:"#804d12",end:"#f7e2a8"},speed:{start:99,end:50,minimumSpeedMultiplier:1},acceleration:{x:0,y:0},maxSpeed:0,startRotation:{min:0,max:360},noRotation:!1,rotationSpeed:{min:0,max:0},lifetime:{min:1.661,max:1.06},blendMode:"normal",frequency:.004,emitterLifetime:-1,maxParticles:20,pos:{x:0,y:0},addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:0}}),this.emitter.emit=!1},onBackPress:function(){this.backButton.enabled=!1,platypus.game.app.gamePaused=!0,platypus.game.app.animator.pause(),platypus.game.app.voPlayer.pause(),platypus.game.app.sound.pauseAll(),TweenMax.pauseAll(),this.addPausePopup()},addPausePopup:function(){this.pausePopup||(this.pausePopup=new f(this.owner)),this.pausePopup.show(this.owner.worldContainer)},addBackButton:function(a){var b=platypus.game.app.getCache("popup-atlas"),c=new i({up:b.getFrame("Back_Btn_Normal"),over:b.getFrame("Back_Btn_Over"),down:b.getFrame("Back_Btn_Down"),disabled:b.getFrame("Back_Btn_Disabled")});return c.on("buttonPress",this.onBackPress),a.addChild(c),c}}})}(),function(){"use strict";var a=include("PIXI.Graphics"),b=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Flash",properties:{hal:null,spotLight:null,maskerRadius:80,ellipseWidth:80,flashRadius:76,maskerAlpha:.2,shape:null,color:16777215,alpha:.4,gameStarted:!1,moveFlash:!1,objectsEntity:null},publicProperties:{masker:null},events:{"peer-entity-added":function(a){"flashlight-hal"===a.type&&(this.hal=a),"flashlight-objects-helmet"===a.type&&(this.spotLight=a.spotLight,this.objectsEntity=a)},load:function(){this.owner.container||this.owner.addComponent(new b(this.owner,null)),this.shape=new a,this.owner.container.addChild(this.shape);var c=new PIXI.filters.BlurFilter;c.blur=5,this.shape.filters=[c],this.masker=new a,this.owner.container.addChild(this.masker),this.owner.container.interactive=!0,this.owner.container.buttonMode=!0,this.owner.container.on("pointermove",this.onMove.bind(this))},"start-game":function(){this.gameStarted=!0,this.moveFlash=!0},"finish-game":function(){this.gameStarted=!1,this.moveFlash=!1,this.shape.clear()},"handle-render":function(){if(this.moveFlash&&this.gameStarted&&this.hal&&!this.hal.move&&this.input&&this.spotLight){var a=this.hal.getArmPosition(),b=this.input.x-a.x,c=this.input.y-a.y,d=Math.atan2(c,b),e=Math.sqrt(b*b+c*c);this.hal.rotateArmTo(d),this.masker.rotation=d,this.spotLight.rotation=d;var f=320,g=0;e>f&&(g=.125*(e-f)),this.masker.clear(),this.masker.beginFill(this.color,this.maskerAlpha),this.masker.drawEllipse(0,0,this.maskerRadius+g,this.maskerRadius),this.masker.endFill(),this.spotLight.clear(),this.spotLight.beginFill(this.color,this.alpha),this.spotLight.drawEllipse(0,0,this.maskerRadius+g,this.maskerRadius),this.spotLight.endFill();var h=15,i=a.x+Math.cos(d)*this.hal.armWidth,j=a.y+Math.sin(d)*this.hal.armWidth;this.shape.clear(),this.shape.lineStyle(0,this.color,this.alpha),this.shape.beginFill(this.color,this.alpha),this.shape.moveTo(i+Math.cos(d+Math.PI/2)*h,j+Math.sin(d+Math.PI/2)*h),this.shape.lineTo(this.input.x+Math.cos(d+Math.PI/2)*this.flashRadius,this.input.y+Math.sin(d+Math.PI/2)*this.flashRadius),this.shape.lineTo(this.input.x+Math.cos(d-Math.PI/2)*this.flashRadius,this.input.y+Math.sin(d-Math.PI/2)*this.flashRadius),this.shape.lineTo(i+Math.cos(d-Math.PI/2)*h,j+Math.sin(d-Math.PI/2)*h),this.shape.endFill()}}},methods:{onMove:function(a){this.moveFlash&&(this.input=this.owner.container.toLocal(a.data.global),this.masker.x=this.input.x,this.masker.y=this.input.y,this.spotLight&&(this.spotLight.x=this.input.x,this.spotLight.y=this.input.y),this.objectsEntity&&this.objectsEntity.components.map(function(a){if("RenderSprite"==a.type){var b=this.input.x-a.offsetX,c=this.input.y-a.offsetY;Math.sqrt(b*b+c*c)}}.bind(this)))}}})}(),function(){"use strict";var a=include("PIXI.Graphics");return platypus.createComponentClass({id:"FlashLightObjects",properties:{masker:null},publicProperties:{spotLight:null},initialize:function(){},events:{"peer-entity-added":function(a){"flashlight-flash"===a.type&&(this.masker=a.masker)},load:function(){this.spotLight=new a,this.owner.container.addChild(this.spotLight)},"handle-render":function(){this.masker&&(this.owner.container.mask=this.masker)},"object-clicked":function(){var a=this.owner.parent.getEntitiesByType("flashlight-hal");if(a.length>0){var b=a[0];b.trigger("move-right",!0)}}}})}(),function(){"use strict";return platypus.createComponentClass({id:"FlashlightManager",properties:{armY:152},publicProperties:{gameStarted:!1},events:{"start-game":function(){this.owner.triggerOnChildren("start-game")},"object-clicked":function(a){this.owner.triggerOnChildren("finish-game")}}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("PIXI.Graphics"),c=include("cave_hunt.Hal"),d=include("cave_hunt.HUD"),e=include("cave_hunt.CustomButton"),f=include("cave_hunt.Constants"),g=include("cave_hunt.PausePopup"),h=include("cave_hunt.FlashLightPopup"),i=include("cave_hunt.ObjectPopup");return platypus.createComponentClass({id:"FlashlightManagerPixi",properties:{gameLayer:null,objectsLayer:null,uiLayer:null,popupLayer:null,hal:null,objectsData:null,objects:null,scrim:null,width:2e3,height:800,left:-1e3,top:-400,color:16777215,alpha:.4,masker:null,spotLight:null,maskerRadius:0,flashRadius:0,maskerAlpha:.2,findObjectIndex:0,circlePosition:{},objectFoundTime:1,inActivityTime:10,elapsedTime:0,findingTime:0,maxfindingTime:250,halStartX:650},publicProperties:{gameStarted:!1,moveFlash:!1},initialize:function(){this.onUpdate=this.onUpdate.bind(this),this.onBackPress=this.onBackPress.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.objectsData=platypus.game.app.config.challenges.flashlight.objects,this.positions=platypus.game.app.config.challenges.flashlight.positions,this.maskerRadius=platypus.game.app.config.challenges.flashlight.flashlightSize,this.flashRadius=this.maskerRadius-4},events:{"enter-scene":function(){platypus.game.app.music="Music_Challenge",this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.mapSound=platypus.game.app.sound.play("Ambience_Cave_Tunnel_And_Challenge_Loop",{loop:-1,volume:.2}),this.gameLayer.interactive=!0,this.gameLayer.on("pointermove",this.onPointerMove),platypus.game.app.on("update",this.onUpdate),platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume(),this.addScrim(this.popupLayer),this.addPopup("intro","Flashlight Challenge","KeyFlashlight",this.findObjectIndex)},load:function(){this.gameLayer=new a,this.owner.worldContainer.addChild(this.gameLayer),this.bg=new PIXI.extras.TilingSprite(platypus.game.app.getCache("flashlight-bg"),2048,768),this.bg.anchor.set(.5),this.bg.tint=8947848,this.gameLayer.addChild(this.bg),this.uiLayer=new a,this.owner.worldContainer.addChild(this.uiLayer),this.popupLayer=new a,this.owner.worldContainer.addChild(this.popupLayer),this.shape=new b,this.gameLayer.addChild(this.shape);var e=new PIXI.filters.BlurFilter;e.blur=5,this.shape.filters=[e],this.objectsLayer=new a,this.gameLayer.addChild(this.objectsLayer),this.masker=new b,this.gameLayer.addChild(this.masker),this.objectsLayer.mask=this.masker,this.spotLight=new b,this.gameLayer.addChild(this.spotLight),this.hal=new c(this.owner,!0),this.hal.y=380,this.hal.visible=!1,this.gameLayer.addChild(this.hal),this.hud=new d(this.owner),this.hud.addObjects(this.objectsData),this.hud.x=-462,this.uiLayer.addChild(this.hud),this.backButton=this.addBackButton(this.popupLayer),this.addObjects()},"back-pressed":function(){TweenMax.killAll(),platypus.game.app.voPlayer.stop(),this.removeEventListeners(),this.hal&&this.hal.walkInComplete(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null)},"popup-close":function(a){"play"==a?(this.removeScrim(),this.gameStarted=!0,this.moveFlash=!0,this.findObjectIndex=0,this.hal.visible=!0,this.randomiseObjects(this.findObjectIndex),this.hud.updateHighlight(this.findObjectIndex),this.anounceObject()):"home"==a?(this.removeScrim(),this.removeEventListeners(),TweenMax.killAll(!1,!1,!0,!1),platypus.game.app.voPlayer.stop(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),platypus.game.app.trackEvent("Challenge flashlight","Complete"),platypus.game.loadScene("vault-screen")):"unpause"==a?(this.backButton.enabled=!0,platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume(),platypus.game.app.voPlayer.resume(),platypus.game.app.sound.resumeAll(),TweenMax.resumeAll()):"map"==a?(TweenMax.killAll(),platypus.game.app.voPlayer.stop(),this.removeEventListeners(),this.hal&&this.hal.walkInComplete(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.clear(),platypus.game.loadScene("map-screen")):"replay"==a&&(TweenMax.killAll(),platypus.game.app.voPlayer.stop(),this.removeEventListeners(),this.hal&&this.hal.walkInComplete(),this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.clear(),platypus.game.loadScene(platypus.game.currentScene.id))},"hal-walk-away":function(){this.swapWall()},"popup-removed":function(){this.moveObject()},"camera-update":function(a){this.hud.x=a.viewport.left+50,this.backButton.x=a.viewport.left+10,this.backButton.y=a.viewport.top+10},"scene-ended":function(){this.clear()}},methods:{clear:function(){platypus.game.app.sound.stop(),platypus.game.app.voPlayer.stop(),this.removeEventListeners(),this.hud.clear(),this.hal&&this.hal.parent.removeChild(this.hal),this.hal=null,this.popup&&this.popup.clear(),this.gameLayer&&(this.gameLayer.parent.removeChild(this.gameLayer),this.gameLayer=null),this.uiLayer&&this.uiLayer.parent.removeChild(this.uiLayer),this.uiLayer=null,this.popupLayer&&this.popupLayer.parent.removeChild(this.popupLayer),this.popupLayer=null,this.objectsLayer&&this.objectsLayer.parent.removeChild(this.objectsLayer),this.objectsLayer=null},removeEventListeners:function(){this.gameLayer&&this.gameLayer.off("pointermove",this.onPointerMove),platypus.game.app.off("update",this.onUpdate)},swapWall:function(){var a=-1*this.bg.scale.y;this.bg.scale.set(1,a),this.maskBg.scale.set(1,a)},addObjects:function(){this.maskBg=new PIXI.extras.TilingSprite(platypus.game.app.getCache("flashlight-bg"),2048,768),this.maskBg.anchor.set(.5),this.objectsLayer.addChild(this.maskBg),this.objectAtlas=platypus.game.app.getCache("objects-atlas"),this.objects=[];for(var a=0;a<this.objectsData.length;a++){var b=this.objectsData[a],c=new PIXI.Sprite(this.objectAtlas.getFrame("Flashlight_Found-"+b.name));c.scale.set(.4),c.anchor.set(.5),this.objectsLayer.addChild(c),c.name=b.name,c.display=b.display,c.vo=b.vo,c.visible=!1,this.addHighlight(c),this.objects.push(c)}},randomiseObjects:function(a){var b=this.objects[a];b.visible=!0,b.position=this.positions.shuffle()[0]},checkObject:function(a){var b=this.objects[this.findObjectIndex];this.isObjectInCircle(b)?(this.timer||(this.timer=this.objectFoundTime),this.timer-=a,this.timer<=0&&(this.moveFlash=!1,this.makeBigger(this.findObjectIndex),this.timer=this.objectFoundTime,b.objHighlight.visible=!1),this.timer<=.5&&!b.bumped&&(b.bumped=!0,b.objHighlight.visible=!0)):(b.scale.set(.4),this.timer=this.objectFoundTime,b.bumped=!1,b.objHighlight.visible=!1)},addHighlight:function(a){var b=new PIXI.Sprite(this.objectAtlas.getFrame(a.name+"-Highlight"));b.scale.set(2.5),b.anchor.set(.5),(a.name==f.Objects.Helmet||a.name==f.Objects.Notebook)&&b.scale.set(2.65),a.name==f.Objects.FirstAid&&b.scale.set(2.95),a.name==f.Objects.Backpack&&b.scale.set(2.6),a.name==f.Objects.Boot&&b.scale.set(2.8),b.visible=!1,a.objHighlight=b,a.addChild(b)},isObjectInCircle:function(a){return this.isPointInCircle(a.x,a.y)&&this.isPointInCircle(a.x-.5*a.width,a.y-.5*a.height)&&this.isPointInCircle(a.x+.5*a.width,a.y-.5*a.height)&&this.isPointInCircle(a.x-.5*a.width,a.y+.5*a.height)&&this.isPointInCircle(a.x+.5*a.width,a.y+.5*a.height)},isPointInCircle:function(a,b){return a>=this.circlePosition.x-this.maskerRadius&&a<=this.circlePosition.x+this.maskerRadius&&b>=this.circlePosition.y-this.maskerRadius&&b<=this.circlePosition.y+this.maskerRadius},makeBigger:function(a){platypus.game.app.sound.play("Challenge_Flashlight_Item_Reveal");var b=1,c=this.objects[a];this.uiLayer.addChild(c),TweenMax.to(c.scale,1,{x:b,y:b,onComplete:this.biggerComplete.bind(this),onCompleteParams:[a]}),TweenMax.to(c,1,{x:0,y:0})},biggerComplete:function(a){var b=this.objects[a];this.addObjectPopup(b),this.clearGraphics(),this.hal.x=-this.halStartX},delayComplete:function(){this.removeObjectPopup()},moveObject:function(){var a=this.objects[this.findObjectIndex];a.anchor.set(.5),a.scale.set(.4),this.uiLayer.addChild(a);var b=this.hud.getObjectPosition(this.findObjectIndex);TweenMax.to(a,1,{x:b.x,y:b.y,delay:.5,onComplete:this.moveComplete.bind(this),onCompleteParams:[this.findObjectIndex]})},moveComplete:function(a){var b=this.objects[this.findObjectIndex];b.parent&&(b.parent.removeChild(b),b=null),this.hud.updateCollected(a),this.clearGraphics(),this.findObjectIndex>=this.objects.length-1?(this.gameStarted=!1,this.hal.resetArm(),this.showWin()):(this.hal.walkIn(),this.moveBackground())},showWin:function(){this.addScrim(this.popupLayer),this.addPopup("win","YOU GOT A KEY!!","KeyFlashlight"),this.saveProgress(f.keys.flashlight)},saveProgress:function(a){platypus.game.app.saveData[a]||(platypus.game.app.saveData[a]={}),platypus.game.app.saveData[a].gotKey=!0,platypus.game.app.save()},moveBackground:function(){var a=2*this.halStartX;TweenMax.to(this.bg.tilePosition,3.5,{x:"-="+a,ease:Linear.easeNone,onComplete:this.moveBGComplete.bind(this)}),this.maskBg.tilePosition.x-=a},moveBGComplete:function(){this.findObjectIndex++,this.randomiseObjects(this.findObjectIndex),this.hud.updateHighlight(this.findObjectIndex),this.elapsedTime=0,this.findingTime=0,this.circlePosition.x=0,this.circlePosition.y=0,this.moveFlash=!0,this.anounceObject()},anounceObject:function(){platypus.game.app.voPlayer.play([["CH_Challenge_Flashlight_Item_Intro_We_Need_To_Find_A_Squeeks","CH_Challenge_Flashlight_Item_Intro_We_Need_To_Find_B_Squeeks","CH_Challenge_Flashlight_Item_Intro_We_Need_To_Find_C_Squeeks"].shuffle()[0],this.objects[this.findObjectIndex].vo])},clearGraphics:function(){this.masker.clear(),this.spotLight.clear(),this.shape.clear()},addPopup:function(a,b,c,d){this.popup||(this.popup=new h(this.owner)),this.popup.show(this.popupLayer,a,b,c,d)},addObjectPopup:function(a){this.objectPopup||(this.objectPopup=new i(this.owner)),a.scale.set(1),a.texture=this.objectAtlas.getFrame("Flashlight_Found-"+a.name),this.objectPopup.add(a),this.popupLayer.addChild(this.objectPopup),this.objectPopup.show();var b=2,c=["CH_Challenge_Flashlight_Success_A_1_Looks_Like_We_Found_Squeeks",a.vo];if(this.findObjectIndex<this.objects.length-1){var d=["CH_Challenge_Flashlight_Success_A_2_Lets_Try_To_Find_Another_One_Squeeks","CH_Challenge_Flashlight_Success_B_Squeeks","CH_Challenge_Flashlight_Success_C_1_Squeeks","CH_Challenge_Flashlight_Success_C_2_Squeeks"].shuffle()[0];c.push(d),b="CH_Challenge_Flashlight_Success_B_Squeeks"==d?3.5:2.5}platypus.game.app.voPlayer.play(c),TweenMax.delayedCall(2,this.delayComplete.bind(this))},removeObjectPopup:function(){this.objectPopup&&this.objectPopup.hide()},removePopup:function(){this.popup&&this.popupLayer.removeChild(this.popup)},removeScrim:function(){this.scrim&&this.scrim.parent&&this.scrim.parent.removeChild(this.scrim)},addScrim:function(a){this.scrim||(this.scrim=(new b).beginFill(0,this.alpha),this.scrim.drawRect(this.left,this.top,this.width,this.height)),a.addChildAt(this.scrim,0)},onPointerMove:function(a){this.elapsedTime=0,this.moveFlash&&this.masker&&!platypus.game.app.gamePaused&&(this.findingTime++,this.findingTime>this.maxfindingTime&&(this.findingTime=0,platypus.game.app.voPlayer.play("CH_Challenge_Flashlight_Wrong_Area_Squeeks")),this.input=this.gameLayer.toLocal(a.data.global),this.masker.x=this.input.x,this.masker.y=this.input.y,this.spotLight&&(this.spotLight.x=this.input.x,this.spotLight.y=this.input.y),this.handleRender())},playInActivity:function(){this.hal.highlight(),platypus.game.app.voPlayer.play("CH_Challenge_Flashlight_Inacvitity_A_Squeeks")},onUpdate:function(a){var b=a/1e3;platypus.game.app.gamePaused||(!this.moveBrush&&this.gameStarted&&(this.elapsedTime+=b),this.elapsedTime>this.inActivityTime&&(this.elapsedTime=0,this.playInActivity()),this.moveFlash&&this.checkObject(b))},handleRender:function(){if(this.moveFlash&&this.gameStarted&&this.hal&&this.input&&this.spotLight){var a=this.hal.getArmPosition(),b=this.input.x-a.x,c=this.input.y-a.y,d=Math.atan2(c,b),e=Math.sqrt(b*b+c*c);this.hal.rotateArmTo(d),this.masker.rotation=d,this.spotLight.rotation=d;var f=320,g=0;e>f&&(g=.125*(e-f));var h=this.maskerRadius+g,i=h;this.masker.clear(),this.masker.beginFill(this.color,this.maskerAlpha),this.masker.drawEllipse(i,0,h,this.maskerRadius),this.masker.endFill(),this.spotLight.clear(),this.spotLight.beginFill(this.color,this.alpha),this.spotLight.drawEllipse(i,0,h,this.maskerRadius),this.spotLight.endFill();var j=15,k=a.x+Math.cos(d)*this.hal.armWidth,l=a.y+Math.sin(d)*this.hal.armWidth;this.circlePosition.x=this.input.x+Math.cos(d)*i,this.circlePosition.y=this.input.y+Math.sin(d)*i,this.shape.clear(),this.shape.lineStyle(0,this.color,this.alpha),this.shape.beginFill(this.color,this.alpha),this.shape.moveTo(k+Math.cos(d+Math.PI/2)*j,l+Math.sin(d+Math.PI/2)*j),this.shape.lineTo(this.circlePosition.x+Math.cos(d+Math.PI/2)*this.flashRadius,this.circlePosition.y+Math.sin(d+Math.PI/2)*this.flashRadius),this.shape.lineTo(this.circlePosition.x+Math.cos(d-Math.PI/2)*this.flashRadius,this.circlePosition.y+Math.sin(d-Math.PI/2)*this.flashRadius),this.shape.lineTo(k+Math.cos(d-Math.PI/2)*j,l+Math.sin(d-Math.PI/2)*j),this.shape.endFill()}},onBackPress:function(){this.backButton.enabled=!1,platypus.game.app.gamePaused=!0,platypus.game.app.animator.pause(),platypus.game.app.voPlayer.pause(),platypus.game.app.sound.pauseAll(),TweenMax.pauseAll(),this.addPausePopup()},addPausePopup:function(){this.pausePopup||(this.pausePopup=new g(this.owner)),this.pausePopup.show(this.owner.worldContainer)},addBackButton:function(a){var b=platypus.game.app.getCache("popup-atlas"),c=new e({up:b.getFrame("Back_Btn_Normal"),over:b.getFrame("Back_Btn_Over"),down:b.getFrame("Back_Btn_Down"),disabled:b.getFrame("Back_Btn_Disabled")});return c.on("buttonPress",this.onBackPress),a.addChild(c),c}}})}(),function(){"use strict";return platypus.createComponentClass({id:"GlowWorm",initialize:function(){this.collected=!1},events:{clicked:function(){if(!this.collected){this.collected=!0,this.owner.trigger("collect-worm"),this.owner.container.removeChildren(),this.owner.z=4250;var a=platypus.game.app.getCache("popup-atlas");this.pGW=new PIXI.Sprite(a.getFrame("plus1-glow-worm")),this.pGW.anchor.set(.5,1),this.pGW.y=-115,this.owner.container.addChild(this.pGW),TweenMax.to(this.pGW,1,{y:-200,ease:Expo.easeOut,onComplete:this.animComplete.bind(this)}),TweenMax.to(this.pGW,1,{alpha:0,delay:.25,ease:Expo.easeOut})}}},methods:{animComplete:function(){this.pGW.parent.removeChild(this.pGW),this.pGW=null,this.owner.trigger("destroy-me")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"HUD",events:{load:function(){var a=this.owner.getEntitiesByType("flashlight-hud-helmet");if(a.length>0){var b=a[0];b.trigger("highlight",!0)}},"object-clicked":function(a){var b=this.owner.getEntitiesByType("flashlight-hud-helmet");if(b.length>0){var c=b[0];c.trigger("collected",!0)}this.owner.addEntity("challenge-popup-win")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Hal",properties:{armY:152,armPosition:{},move:!1},publicProperties:{hal:null,arm:null,armWidth:152,armHeight:30},initialize:function(){},events:{load:function(){this.arm=this.owner.container.children[0],this.arm.y=this.armY},"move-right":function(){this.move=!0},"handle-render":function(){this.move&&(this.owner.x+=5)}},publicMethods:{getArmPosition:function(){return this.armPosition.x=this.owner.x+this.arm.x,this.armPosition.y=this.owner.y+this.arm.y,this.armPosition},rotateArmTo:function(a){this.arm.rotation=a}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Hero",properties:{startX:0,startY:0,hurted:!1,fallInWater:!1,spawnPoint:null,gameStarted:!1},initialize:function(){this.startX=this.owner.x,this.startY=this.owner.y},events:{adopted:function(){this.owner.parent.triggerEvent("follow",{mode:"locked",entity:this.owner})},"timer-complete":function(){this.stopHero()},"start-game":function(a){this.gameStarted=!0,this.owner.trigger("unpause-movement"),this.owner.state.set("grounded",!1),this.owner.paused=!1,this.show()},"pause-hero1":function(){this.owner.paused=!0,this.owner.trigger("stop")},"stop-game":function(){this.stopHero()},load:function(a){this.respawn=this.respawn.bind(this),platypus.game.app.wormsCount=0,this.hide(),this.stopHero()},"hit-obstacles":function(a){if("water-fall"!=a.shape.owner.type||a.shape.owner.isOpen){var b=1;this.hurted||("water-fall"==a.shape.owner.type||"water-pool"==a.shape.owner.type?(platypus.game.app.voPlayer.play(["CH_Tunnel_HF_Fail_Collision_A_NC","CH_Tunnel_HF_Fail_Collision_B_NC","CH_Tunnel_HF_Fail_Collision_C_NC"].shuffle()[0]),platypus.game.app.sound.play("Tunnel_Object_In_Water")):"obstacles"==a.type?(platypus.game.app.voPlayer.play(["CH_Tunnel_ColossalC_Fail_Collision_A_NC","CH_Tunnel_ColossalC_Fail_Collision_B_NC","CH_Tunnel_ColossalC_Fail_Collision_C_NC"].shuffle()[0]),platypus.game.app.sound.play(["Tunnel_Collision_1","Tunnel_Collision_2"].shuffle()[0])):"softobstacles"==a.type&&(platypus.game.app.voPlayer.play(["CH_Tunnel_ColossalC_Fail_Collision_B_NC","CH_Tunnel_CritterC_Fail_Collision_A_NC","CH_Tunnel_ColossalC_Fail_Collision_C_NC"].shuffle()[0]),this.owner.trigger("pause-movement")),this.owner.trigger("stop"),"water-pool"==a.shape.owner.type?(this.fallInWater=!0,this.owner.state.set("fall",!0),b=2):this.owner.state.set("hurted",!0),this.hurted=!0,this.owner.paused=!0,TweenMax.delayedCall(b,this.respawn),this.getLayerByType("interface-layer").triggerEventOnChildren("disable")),this.fallInWater||"water-pool"!=a.shape.owner.type||(this.owner.trigger("stop"),this.owner.state.set("hurted",!1),this.owner.state.set("fall",!0),this.fallInWater=!0,this.owner.paused=!0,this.getLayerByType("interface-layer").triggerEventOnChildren("disable"),TweenMax.killDelayedCallsTo(this.respawn),TweenMax.delayedCall(2,this.respawn),platypus.game.app.voPlayer.playing||platypus.game.app.voPlayer.play(["CH_Tunnel_HF_Fail_Collision_A_NC","CH_Tunnel_HF_Fail_Collision_B_NC","CH_Tunnel_HF_Fail_Collision_C_NC"].shuffle()[0]),platypus.game.app.sound.play("Tunnel_Object_In_Water"))}},"hit-spawn-point":function(a){this.startX=a.shape.owner.x,this.startY=a.shape.owner.y-.5*this.owner.height},"handle-render":function(){this.gameStarted&&(this.owner.state.get("grounded")&&this.owner.state.get("moving")&&!platypus.game.app.sound.isPlaying("Tunnel_NC_Run")?platypus.game.app.sound.play("Tunnel_NC_Run"):!platypus.game.app.sound.isPlaying("Tunnel_NC_Run")||this.owner.state.get("grounded")&&this.owner.state.get("moving")||platypus.game.app.sound.stop("Tunnel_NC_Run"),
this.owner.state.get("grounded")&&!this.groundAudioPlayed?(this.groundAudioPlayed=!0,platypus.game.app.sound.play("Tunnel_NC_Land_After_Jump")):!this.owner.state.get("grounded")&&this.groundAudioPlayed&&(this.groundAudioPlayed=!1))},"goo-right":function(){this.hurted||this.fallInWater||this.owner.triggerEvent("go-right")}},methods:{show:function(){1!=this.owner.container.alpha&&(this.owner.container.alpha=1)},hide:function(){this.owner.container.alpha=0},getLayerByType:function(a){return this.owner.parent.parent.layers.filter(function(b){return a==b.type})[0]},respawn:function(){if(this.hurted||this.fallInWater){this.owner.x=this.startX,this.owner.y=this.startY,this.owner.paused=!1,this.hurted=!1,this.fallInWater=!1,this.owner.state.set("hurted",!1),this.owner.state.set("fall",!1),this.owner.trigger("unpause-movement"),this.owner.triggerEvent("jump",{pressed:!1,released:!0,triggered:!1});var a=this.getLayerByType("interface-layer");a.triggerEventOnChildren("enable"),a.triggerEventOnChildren("pressup")}},stopHero:function(){this.owner.paused=!0,this.owner.trigger("stop"),this.owner.trigger("pause-movement"),this.owner.state.set("grounded",!0)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"HeroCamera",initialize:function(){this.target=null,this.myOrientation=0},events:{"peer-entity-added":function(a){"hero"===a.type&&(this.target=a)},"handle-logic":function(){this.target&&(this.target.orientation!=this.myOrientation&&(this.owner.rotation=this.owner.rotation-180,this.myOrientation=this.target.orientation),this.owner.x=this.target.x,this.owner.y=this.target.y-this.target.height)}}})}(),function(){"use strict";var a=include("cave_hunt.Constants");return platypus.createComponentClass({id:"Interface",events:{load:function(){if(this.owner.parent.id==a.Tunnels.CritterCavern){var b=this.owner.getEntitiesByType("worms-counter")[0],c=this.owner.getEntitiesByType("timer-bar")[0];c.x=-92,b.x=-477}else{var d=this.owner.getEntitiesByType("magnifying-glass-counter")[0];this.owner.removeEntity(d)}}}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("cave_hunt.CustomButton"),c=include("springroll.pixi.AdvancedMovieClip");return platypus.createComponentClass({id:"IntroManager",properties:{bg:null,introText:null},events:{"enter-scene":function(){platypus.game.app.music="Music_Intro",this.showMapScreen=this.showMapScreen.bind(this),this.buttonOver=this.buttonOver.bind(this),this.buttonOut=this.buttonOut.bind(this),this.container=new a,this.owner.worldContainer.addChild(this.container),this.bg=new PIXI.Sprite(platypus.game.app.getCache("intro-bg")),this.bg.anchor.set(.5),this.container.addChild(this.bg),this.daisy=new c(platypus.game.app.getCache("daisy-intro-anim")),this.daisy.anchor.set(.5,1),this.daisy.x=-390,this.daisy.y=325,this.container.addChild(this.daisy),this.squeaks=new c(platypus.game.app.getCache("squeaks-intro-anim")),this.squeaks.x=120,this.squeaks.y=320,this.squeaks.anchor.set(.5,1),this.container.addChild(this.squeaks),this.hal=new c(platypus.game.app.getCache("hal-intro-anim")),this.hal.x=300,this.hal.y=330,this.hal.anchor.set(.5,1),this.container.addChild(this.hal),this.nc=new c(platypus.game.app.getCache("nc-intro-anim")),this.nc.x=-130,this.nc.y=310,this.nc.anchor.set(.5,1),this.container.addChild(this.nc);var d=platypus.game.app.getCache("popup-atlas");this.playButton=new b({up:d.getFrame("button-skip-normal"),down:d.getFrame("button-skip-over"),over:d.getFrame("button-skip-over")});var e=d.getFrame("button-skip-normal");this.playButton.pivot=new PIXI.Point(.5*e.width,.5*e.height),this.playButton.x=405,this.playButton.y=330,this.container.addChild(this.playButton),this.playButton.on("buttonPress",this.showMapScreen),this.playButton.on("buttonOver",this.buttonOver),this.playButton.on("buttonOut",this.buttonOut),TweenMax.delayedCall(.5,this.startAnims.bind(this))}},methods:{buttonOver:function(){if(!this.tl){var a=.05,b=2*(Math.PI/180);this.tl=new TimelineMax({repeat:-1}),this.tl.to(this.playButton,a,{rotation:b,ease:Linear.easeNone}).to(this.playButton,a,{rotation:0,ease:Linear.easeNone}).to(this.playButton,a,{rotation:-b,ease:Linear.easeNone}).to(this.playButton,a,{rotation:0,ease:Linear.easeNone})}this.tl.play()},buttonOut:function(){this.tl&&this.tl.stop(),this.playButton.rotation=0},startAnims:function(){platypus.game.app.animator.play(this.nc,{anim:"ncidle",audio:{alias:"CH_Intro_Animation_1_NC",start:200}}),platypus.game.app.animator.play(this.daisy,{anim:"daisyidle",audio:{alias:"CH_Intro_Animation_2_Daisy",start:8700}}),platypus.game.app.animator.play(this.squeaks,{anim:"squeaksidle",audio:{alias:"CH_Intro_Animation_3_Squeeks",start:13600}}),platypus.game.app.animator.play(this.hal,{anim:"halidle",audio:{alias:"CH_Intro_Animation_4_Hal",start:15800}},this.onAnimComplete.bind(this)),TweenMax.delayedCall(19.4,this.playVO.bind(this))},playVO:function(){platypus.game.app.voPlayer.play("CH_Intro_Animation_5_Daisy"),platypus.game.app.sound.play("CH_Intro_Animation_5_NC"),platypus.game.app.sound.play("CH_Intro_Animation_5_Squeeks")},addMap:function(){this.map=new c(platypus.game.app.getCache("map-anim")),this.map.anchor.set(.5),this.container.addChild(this.map),platypus.game.app.animator.play(this.map,"mapidle")},onAnimComplete:function(){this.addMap(),TweenMax.delayedCall(2,this.showMapScreen.bind(this))},unload:function(){platypus.game.app.unload("nc-intro0","nc-intro1","nc-intro2","nc-intro3","nc-intro4","nc-intro5","nc-intro6","nc-intro7","nc-intro8","nc-intro9","nc-intro10","daisy-intro0","daisy-intro1","daisy-intro2","hal-intro0","hal-intro1","hal-intro2","hal-intro3","squeaks-intro0","nc-intro-anim","hal-intro-anim","daisy-intro-anim","squeaks-intro-anim","map0","map1","map2","map3","map-anim","intro-bg")},clear:function(){this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.playButton.parent.removeChild(this.playButton),this.playButton=null,this.nc.parent.removeChild(this.nc),this.nc=null,this.daisy.parent.removeChild(this.daisy),this.daisy=null,this.hal.parent.removeChild(this.hal),this.hal=null,this.squeaks.parent.removeChild(this.squeaks),this.squeaks=null,this.map&&(this.map.parent.removeChild(this.map),this.map=null),this.bg.parent.removeChild(this.bg),this.bg=null,this.container.parent.removeChild(this.container),this.container=null},showMapScreen:function(){this.playButton.off("buttonOver",this.buttonOver),this.playButton.off("buttonOut",this.buttonOut),this.playButton.off("buttonPress",this.showMapScreen),TweenMax.killAll(),platypus.game.app.animator.stopAll(),platypus.game.app.voPlayer.stop(),this.clear(),this.unload(),platypus.game.loadScene("map-screen")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"MagnifyingGlass",initialize:function(){this.collected=!1},events:{clicked:function(a){this.collected||(this.owner.trigger("pause"),this.collected=!0,this.owner.z=4250,TweenMax.to(this.owner,.2,{scaleX:.5,scaleY:.5,onComplete:this.addCritter.bind(this)}))}},methods:{addCritter:function(){this.owner.container.removeChildren(),this.owner.scaleX=this.owner.scaleY=1,this.id=this.owner.funfact;var a=null,b=0;this.id=-1;var c=-1;if("magnifying-glass-water"==this.owner.type){if(a=platypus.game.app.config.data.waterFunfacts,!platypus.game.app.wfunfacts)for(platypus.game.app.wfunfacts=[],b=0;b<a.length;b++)platypus.game.app.wfunfacts.push(b);c=Math.round(Math.random()*(platypus.game.app.wfunfacts.length-1)),this.id=platypus.game.app.wfunfacts[c],platypus.game.app.wfunfacts.splice(c,1)}else{if(a=platypus.game.app.config.data.funfacts,!platypus.game.app.funfacts)for(platypus.game.app.funfacts=[],b=0;b<a.length;b++)platypus.game.app.funfacts.push(b);c=Math.round(Math.random()*(platypus.game.app.funfacts.length-1)),this.id=platypus.game.app.funfacts[c],platypus.game.app.funfacts.splice(c,1)}var d=a[this.id];this.popupAtlas=platypus.game.app.getCache("popup-atlas"),this.image=new PIXI.Sprite(this.popupAtlas.getFrame(d.image)),this.image.anchor.set(.5),this.image.scale.set(.5),this.owner.container.addChild(this.image),TweenMax.to(this.image.scale,1,{x:1.25,y:1.25,onComplete:this.biggerComplete.bind(this)})},biggerComplete:function(){this.owner.trigger("show",this.owner.type,this.id),this.owner.trigger("destroy-me")}}})}(),function(){"use strict";var a=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"MagnifyingGlassCounter",properties:{counterField:null,counter:0},events:{load:function(){this.owner.container||this.owner.addComponent(new a(this.owner,null)),this.counterField=new PIXI.extras.BitmapText("0",{font:"60px birdsCountFont",align:"center",tint:16777215}),this.counterField.anchor.set(.5),this.counterField.x=55,this.counterField.y=24,this.owner.container.addChild(this.counterField)},"show-funfacts":function(a){++this.counter,this.update()},"start-game":function(){this.update()}},methods:{update:function(){this.counterField.text=this.counter+"/"+platypus.game.app.magnifyingGlassTotalCount,platypus.game.app.magnifyingGlassCount=this.counter}}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("cave_hunt.Stars"),c=include("cave_hunt.ChallengeButton"),d=include("cave_hunt.Constants");return platypus.createComponentClass({id:"MapManager",properties:{bg:null,introText:null,debug:!1,elapsedTime:0,inActivityTime:10,gameStarted:!0,arrows:[]},events:{"enter-scene":function(){this.onUpdate=this.onUpdate.bind(this),platypus.game.app.music="Music_Map",this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.mapSound=platypus.game.app.sound.play("Ambience_Map_Loop",{loop:-1,volume:.1}),this.container=new a,this.owner.worldContainer.addChild(this.container),this.map=new PIXI.Sprite(platypus.game.app.getCache("map")),this.map.anchor.set(.5),this.container.addChild(this.map);var e=platypus.game.app.getCache("vault-atlas");this.hiddenFallsGlow=new PIXI.Sprite(e.getFrame("hidden-glow")),this.hiddenFallsGlow.x=-310,this.hiddenFallsGlow.y=-167,this.hiddenFallsGlow.anchor.set(.5),this.hiddenFallsGlow.visible=!1,this.container.addChild(this.hiddenFallsGlow),this.hiddenFallsTitle=new PIXI.Sprite(e.getFrame("map-hiddenfalls-title")),this.hiddenFallsTitle.anchor.set(.5),this.hiddenFallsTitle.x=-307,this.hiddenFallsTitle.y=-257,this.container.addChild(this.hiddenFallsTitle),this.addBounce(this.hiddenFallsTitle),this.colossalGlow=new PIXI.Sprite(e.getFrame("colossal-glow")),this.colossalGlow.x=-210,this.colossalGlow.y=138,this.colossalGlow.anchor.set(.5),this.colossalGlow.visible=!1,this.container.addChild(this.colossalGlow),this.colossalTitle=new PIXI.Sprite(e.getFrame("map-colossalcaves-title")),this.colossalTitle.anchor.set(.5),this.colossalTitle.x=-209,this.colossalTitle.y=42,this.container.addChild(this.colossalTitle),this.addBounce(this.colossalTitle),this.critterGlow=new PIXI.Sprite(e.getFrame("critter-glow")),this.critterGlow.x=320,this.critterGlow.y=53,this.critterGlow.anchor.set(.5),this.critterGlow.visible=!1,this.container.addChild(this.critterGlow),this.critterTitle=new PIXI.Sprite(e.getFrame("map-crittercavern-title")),this.critterTitle.anchor.set(.5),this.critterTitle.x=308,this.critterTitle.y=-37,this.container.addChild(this.critterTitle),this.addBounce(this.critterTitle),this.vaultTitle=new PIXI.Sprite(e.getFrame("map-vault-title")),this.vaultTitle.anchor.set(.5),this.vaultTitle.x=10,this.vaultTitle.y=-153,this.container.addChild(this.vaultTitle),this.addBounce(this.vaultTitle),this.hitArea1=this.getHitArea(d.Tunnels.HiddenFalls,-325,-200),this.container.addChild(this.hitArea1),this.hitArea2=this.getHitArea(d.Tunnels.CritterCavern,320,20),this.container.addChild(this.hitArea2),this.hitArea3=this.getHitArea(d.Tunnels.ColossalCaves,-215,150),this.container.addChild(this.hitArea3),this.hitArea4=this.getHitArea("vault-screen",15,-20),this.container.addChild(this.hitArea4),this.hfStars=new b(this.owner,-304.2,-182,23.5,d.Tunnels.HiddenFalls),this.container.addChild(this.hfStars),this.ccStars=new b(this.owner,-210,126,25,d.Tunnels.ColossalCaves),this.container.addChild(this.ccStars),this.ctStars=new b(this.owner,311.86,41,25.5,d.Tunnels.CritterCavern),this.container.addChild(this.ctStars),platypus.game.app.isMapVOsPlayed||(platypus.game.app.voPlayer.play(["CH_Map_Intro_1_NC","CH_Map_Intro_2_Daisy","CH_Map_Intro_3_Squeeks","CH_Map_Intro_4_Hal","CH_Map_Intro_5_Squeeks","CH_Map_Intro_6_Squeeks"]),platypus.game.app.isMapVOsPlayed=!0,this.arrows=[],this.createArrows(),TweenMax.delayedCall(4.5,this.pointArrowsToCaves.bind(this)),TweenMax.delayedCall(8,this.toggleArrows.bind(this,!0)),TweenMax.delayedCall(8,this.highlight.bind(this,this.colossalGlow)),TweenMax.delayedCall(12,this.highlight.bind(this,this.hiddenFallsGlow)),TweenMax.delayedCall(14,this.highlight.bind(this,this.critterGlow))),this.flashlightButton=new c({up:e.getFrame("flashlight-button-enable"),disabled:e.getFrame("flashlight-button-disable")});var f=e.getFrame("flashlight-button-enable");this.flashlightButton.pivot=new PIXI.Point(47,85),this.flashlightButton.x=-350,this.flashlightButton.y=-107,this.container.addChild(this.flashlightButton),this.flashlightButton.enabled=!1,this.flashlightButton.on("buttonPress",this.onTunnelClick.bind(this,d.keys.flashlight)),this.gotKey(d.keys.flashlight)&&(this.hfStars.willAnimate?TweenMax.delayedCall(2.5,this.enableButton.bind(this,this.flashlightButton)):this.flashlightButton.enabled=!0),this.dusterButton=new c({up:e.getFrame("duster-button-enable"),disabled:e.getFrame("duster-button-disable")}),f=e.getFrame("duster-button-enable"),this.dusterButton.pivot=new PIXI.Point(44,86),this.dusterButton.x=-262,this.dusterButton.y=210,this.container.addChild(this.dusterButton),this.dusterButton.enabled=!1,this.dusterButton.on("buttonPress",this.onTunnelClick.bind(this,d.keys.duster)),this.gotKey(d.keys.duster)&&(this.ccStars.willAnimate?TweenMax.delayedCall(2.5,this.enableButton.bind(this,this.dusterButton)):this.dusterButton.enabled=!0),this.compassButton=new c({up:e.getFrame("compass-button-enable"),disabled:e.getFrame("compass-button-disable")}),f=e.getFrame("compass-button-enable"),this.compassButton.pivot=new PIXI.Point(13,86),this.compassButton.x=367,this.compassButton.y=118,this.container.addChild(this.compassButton),this.compassButton.enabled=!1,this.compassButton.on("buttonPress",this.onTunnelClick.bind(this,d.keys.compass)),this.gotKey(d.keys.compass)&&(this.ctStars.willAnimate?TweenMax.delayedCall(2.5,this.enableButton.bind(this,this.compassButton)):this.compassButton.enabled=!0),this.gameStarted=!0,platypus.game.app.on("update",this.onUpdate)},"scene-ended":function(){this.clear()}},methods:{enableButton:function(a){platypus.game.app.sound.play("CH_Map_Challenge_Unlocked"),a.enabled=!0},gotKey:function(a){return platypus.game.app.saveData[a]?platypus.game.app.saveData[a].gotKey:!1},highlight:function(a){a.visible=!0},toggleArrows:function(a,b){if(this.gameStarted)for(var c=0;3>c;c++){var d=this.arrows[c];b?d.tl&&(d.tl.stop(),d.parent.removeChild(d),d=null):a&&(d.visible=!1)}},pointArrowsToCaves:function(){this.gameStarted&&(this.addArrow(-306,-100,0,20,-90,0),this.addArrow(310,130,0,20,-90,1),this.addArrow(-210,215,0,20,-90,2))},createArrows:function(){for(var a=0;3>a;a++){var b=new PIXI.Sprite(platypus.game.app.getCache("arrow"));b.anchor.set(.5),this.container.addChild(b),b.visible=!1,this.arrows.push(b)}},addArrow:function(a,b,c,d,e,f){var g=this.arrows[f];g.x=a,g.y=b,g.rotation=e*Math.PI/180;var h=.2;g.visible=!0,g.tl&&(g.tl.stop(),g.tl.kill()),g.tl=new TimelineMax({repeat:-1}),g.tl.to(g,h,{x:a+c,y:b+d,ease:Linear.easeNone}).to(g,h,{x:a,y:b,ease:Linear.easeNone}),g.tl.play()},playInActivity:function(){platypus.game.app.voPlayer.playing||platypus.game.app.voPlayer.play(["CH_Intro_Animation_Inactivity_A_NC_not_needed","CH_Intro_Animation_Inactivity_B_NC_not_needed","CH_Intro_Animation_Inactivity_C_NC_not_needed"].shuffle()[0])},onUpdate:function(a){var b=a/1e3;this.gameStarted&&(this.elapsedTime+=b),this.elapsedTime>this.inActivityTime&&(this.elapsedTime=0,this.playInActivity())},getHitArea:function(a,b,c,d,e,f){e=e||100;var g=(new PIXI.Graphics).beginFill(16777215);if(g.drawCircle(0,0,e),g.alpha=d?1:0,g.x=b,g.y=c,g.buttonMode=!0,g.interactive=!0,g.on("pointerdown",this.onTunnelClick.bind(this,a)),g.on("pointerover",this.onCaveOver.bind(this,a)),g.on("pointerout",this.onCaveOut.bind(this,a)),d){var h=new PIXI.Text(d,{fontFamily:"Arial",fontSize:f,fill:4865892,align:"center"});h.anchor.set(.5),g.addChild(h)}return g},addBounce:function(a){var b=.2;a.tl=new TimelineMax({repeat:-1}),a.tl.to(a,b,{y:a.y-5,ease:Linear.easeNone}).to(a,b,{y:a.y,ease:Linear.easeNone}),a.tl.stop()},onCaveOver:function(a){a==d.Tunnels.HiddenFalls?this.hiddenFallsTitle.tl&&this.hiddenFallsTitle.tl.play():a==d.Tunnels.ColossalCaves?this.colossalTitle.tl&&this.colossalTitle.tl.play():a==d.Tunnels.CritterCavern?this.critterTitle.tl&&this.critterTitle.tl.play():"vault-screen"==a&&this.vaultTitle.tl&&this.vaultTitle.tl.play()},onCaveOut:function(a){a==d.Tunnels.HiddenFalls?this.hiddenFallsTitle.tl&&this.hiddenFallsTitle.tl.stop():a==d.Tunnels.ColossalCaves?this.colossalTitle.tl&&this.colossalTitle.tl.stop():a==d.Tunnels.CritterCavern?this.critterTitle.tl&&this.critterTitle.tl.stop():"vault-screen"==a&&this.vaultTitle.tl&&this.vaultTitle.tl.stop()},onTunnelClick:function(a){platypus.game.app.off("update",this.onUpdate),platypus.game.app.voPlayer.stop(),this.gameStarted=!1,this.toggleArrows(!0,!0);var b=this.getParameterByName("level");b?platypus.game.loadScene("level"+b):platypus.game.loadScene(a),platypus.game.app.sound.play(["Map_Option_Outro_1","Map_Option_Outro_2","Map_Option_Outro_3"].shuffle()[0]),this.mapSound&&(this.mapSound.stop(),this.mapSound=null)},getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},clear:function(){this.container&&(this.container.removeChild(this.map),this.map=null,this.container.removeChild(this.hiddenFallsGlow),this.hiddenFallsGlow=null,this.container.removeChild(this.colossalGlow),this.colossalGlow=null,this.container.removeChild(this.critterGlow),this.critterGlow=null,this.hfStars.clear(),this.container.removeChild(this.hfStars),this.hfStars=null,this.ccStars.clear(),this.container.removeChild(this.ccStars),this.ccStars=null,this.ctStars.clear(),this.critterTitle.tl&&(this.critterTitle.tl.stop(),this.critterTitle.tl=null),this.container.removeChild(this.critterTitle),this.critterTitle=null,this.hiddenFallsTitle.tl&&(this.hiddenFallsTitle.tl.stop(),this.hiddenFallsTitle.tl.kill(),this.hiddenFallsTitle.tl=null),this.container.removeChild(this.hiddenFallsTitle),this.hiddenFallsTitle=null,this.colossalTitle.tl&&(this.colossalTitle.tl.stop(),this.colossalTitle.tl.kill(),this.colossalTitle.tl=null),this.container.removeChild(this.colossalTitle),this.colossalTitle=null,this.vaultTitle.tl&&(this.vaultTitle.tl.stop(),this.vaultTitle.tl.kill(),this.vaultTitle.tl=null),this.container.removeChild(this.vaultTitle),this.vaultTitle=null,this.container.removeChild(this.ctStars),this.ctStars=null,this.hitArea1.off("pointerover",this.onCaveOver),this.hitArea2.off("pointerover",this.onCaveOver),this.hitArea3.off("pointerover",this.onCaveOver),this.hitArea4.off("pointerover",this.onCaveOver),this.hitArea1.off("pointerout",this.onCaveOut),this.hitArea2.off("pointerout",this.onCaveOut),this.hitArea3.off("pointerout",this.onCaveOut),this.hitArea4.off("pointerout",this.onCaveOut),this.hitArea1.off("pointerdown",this.onTunnelClick),this.hitArea2.off("pointerdown",this.onTunnelClick),this.hitArea3.off("pointerdown",this.onTunnelClick),this.hitArea4.off("pointerdown",this.onTunnelClick),this.container.removeChild(this.hitArea1),this.hitArea1=null,this.container.removeChild(this.hitArea2),this.hitArea2=null,this.container.removeChild(this.hitArea3),this.hitArea3=null,this.container.removeChild(this.hitArea4),this.hitArea4=null,this.flashlightButton.off("buttonPress",this.onTunnelClick),this.flashlightButton.destroy(),this.dusterButton.off("buttonPress",this.onTunnelClick),this.dusterButton.destroy(),this.compassButton.off("buttonPress",this.onTunnelClick),this.compassButton.destroy(),this.flashlightButton=null,this.dusterButton=null,this.compassButton=null,this.owner.worldContainer.removeChild(this.container),this.container=null)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Obstacle",initialize:function(){},events:{load:function(){this.owner.state.set(this.owner.index.toString(),!0)}}})}(),function(){"use strict";var a=include("PIXI.Graphics"),b=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Popup",events:{"remove-popup":function(){if(this.owner.entities.length>0){var a=this.owner.entities[0];this.owner.removeEntity(a)}},load:function(){this.owner.container||this.owner.addComponent(new b(this.owner,null)),this.scrim=(new a).beginFill(0,.4),this.scrim.drawRect(-512,-384,1024,768),this.owner.container.addChild(this.scrim),this.bg=new PIXI.Sprite(platypus.game.app.getCache("popup-bg")),this.bg.anchor.set(.5),this.owner.container.addChild(this.bg)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"PopupButton",properties:{key:"",played:!1},events:{pressed:function(){this.owner.state.set("highlight",!1),this.owner.parent[this.key]=!0,this.owner.parent.trigger("key-press",this.owner),this.pressed()},released:function(){this.owner.parent[this.key]=!1,this.owner.parent.trigger("key-release",this.owner),this.released()}},methods:{pressed:function(){this.owner.state.set("pressed",!0)},released:function(){this.owner.state.set("pressed",!1)}}})}(),function(){"use strict";var a=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"PopupText",properties:{text:"Avoid Salamanders and Bats",fontSize:60},events:{load:function(){this.owner.container||this.owner.addComponent(new a(this.owner,null)),this.timerField=new PIXI.extras.BitmapText(this.text.toUpperCase(),{font:"60px popupsFont",align:"center",tint:16777215}),this.timerField.anchor.set(.5),this.owner.container.addChild(this.timerField),this.owner.container.reorder=!0},"handle-render":function(){!this.owner.parent}}})}(),function(){"use strict";var a=1,b=2*a,c=include("platypus.AABB"),d=include("platypus.PIXIAnimation"),e=include("springroll.Application"),f=include("PIXI.CanvasRenderer"),g=include("PIXI.Container"),h=include("PIXI.Graphics"),i=g,j=include("PIXI.Rectangle"),k=include("PIXI.RenderTexture"),l=include("PIXI.Sprite"),m=function(a,b,c){var d=b.baseTexture,e=d._glRenderTargets[a.CONTEXT_UID];e&&e.clear(c)},n=function(){return null},o=c.setUp(),p=function(a,b){return a.z-b.z},q=function(a){for(var b=1;a>b;)b*=2;return b},r=function(a,b){var c=+a.substring(4),d=0;return 2147483648&c&&(b.scale.x=-1),1073741824&c&&(b.scale.y=-1),536870912&c&&(d=b.scale.x,b.scale.x=b.scale.y,b.scale.y=-d,b.rotation=Math.PI/2),268435455&c},s=function(a,b){this.id=b,this.instances=Array.setUp(a),this.index=0,a.template=this},t={getNext:n,destroy:n},u=s.prototype;return u.getNext=function(){var a=this.instances[this.index],b=null;return a||(b=this.instances[0],a=this.instances[this.index]=new l(b.texture),a.scale=b.scale,a.rotation=b.rotation,a.anchor=b.anchor),this.index+=1,a},u.clear=function(){this.index=0},u.destroy=function(){var a=0;for(a=0;a<this.instances.length;a++)this.instances[a].destroy();this.instances.recycle(),this.recycle()},recycle.add(s,!!springroll.Debug,"Template"),platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10,top:0,left:0},initialize:function(){var a=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=e.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=c.setUp(),this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=c.setUp(),this.cachePixels=c.setUp(),this.spriteSheet=d.formatSpriteSheet(this.spriteSheet),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof f?new g:new i(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new g,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=Array.setUp(this.createMap(a)),this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(q(this.layerWidth+b),this.maximumBuffer),this.cacheHeight=Math.min(q(this.layerHeight+b),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1),this.ready=!1},events:{"handle-render-load":function(a){var b=this.mapContainer,c=null,d=null,e=this.owner.z;a&&a.container&&(this.ready=!0,c=this.parentContainer=a.container,c&&!this.reorderedStage&&(c.reorder=!0,this.reorderedStage=!0),this.updateRegion(0),this.tileCache?(this.mapContainerWrapper=new g,this.mapContainerWrapper.addChild(b),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.render=this.renderCache,this.cacheTexture=k.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=d=new l(this.cacheTexture),d.scale.x=this.scaleX,d.scale.y=this.scaleY,d.z=e,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),c.addChild(d)):(this.render=this.renderCache,this.cacheAll=!1,this.cacheTexture=k.create(this.cacheWidth,this.cacheHeight),this.tilesSprite=new l(this.cacheTexture),this.tilesSprite.scale.x=this.scaleX,this.tilesSprite.scale.y=this.scaleY,this.tilesSprite.z=e,this.cacheTexture.alternate=k.create(this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new l(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,c.addChild(this.tilesSprite))):(this.render=n,b.scale.x=this.scaleX,b.scale.y=this.scaleY,b.x=this.left,b.y=this.top,b.z=e,c.addChild(b)))},"cache-sprite":function(a){this.cacheSprite(a)},"peer-entity-added":function(a){this.cacheSprite(a)},"add-tiles":function(a){var b=a.imageMap;b&&(this.imageMap.push(this.createMap(b)),this.updateCache=!0)},"change-tile":function(a,b,c,d){var e=this.imageMap;e&&(this.updateTile(a,e[d||0],b,c),this.updateCache=!0)},"camera-loaded":function(a){this.worldWidth=a.world.width,this.worldHeight=a.world.height,this.buffer&&!this.cacheAll&&this.updateBufferRegion(a.viewport)},"camera-update":function(a){this.ready&&this.updateCamera(a)},"handle-render":function(){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{cacheSprite:function(a){var b=0,c=0,d=a.cacheRender,e=null,f=0,g=0,h=0,i=0;if(this.entityCache&&d){for(this.doMap||(this.doMap=Array.setUp(),this.cachedDisplayObjects=Array.setUp(),this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(d),e=d.getBounds(d.transformMatrix),e.x-=this.left,e.y-=this.top,f=Math.max(0,Math.floor(e.y/this.tileHeight)),g=Math.min(this.tilesHeight,Math.ceil((e.y+e.height)/this.tileHeight)),i=Math.max(0,Math.floor(e.x/this.tileWidth)),h=Math.min(this.tilesWidth,Math.ceil((e.x+e.width)/this.tileWidth)),b=i;h>b;b++)for(this.doMap[b]||(this.doMap[b]=Array.setUp()),c=f;g>c;c++)this.doMap[b][c]||(this.doMap[b][c]=Array.setUp()),this.doMap[b][c].push(d);a.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(a){var b=this.worldWidth/this.scaleX,c=b-a.width,d=this.worldHeight/this.scaleY,e=d-a.height,f=this.laxCam;return b!==this.layerWidth&&c?f.moveX((a.left-this.left)*(this.layerWidth-a.width)/c+a.halfWidth+this.left):f.moveX(a.x),d!==this.layerHeight&&e?f.moveY((a.top-this.top)*(this.layerHeight-a.height)/e+a.halfHeight+this.top):f.moveY(a.y),(a.width!==f.width||a.height!==f.height)&&f.resize(a.width,a.height),f},createTile:function(a){var b=null,c="";return"tile-1"===a?t:(b=new d(this.spriteSheet),c="tile"+r(a,b),b.gotoAndStop(c),s.setUp(b,a))},createMap:function(a){var b=0,c=0,d="",e=null;if("string"!=typeof a[0][0])return a;for(e=Array.setUp(),b=0;b<a.length;b++)for(e[b]=Array.setUp(),c=0;c<a[b].length;c++)d=a[b][c],this.updateTile(d,e,b,c);return e},updateCamera:function(a){var b=0,c=0,d=!1,e=null,f=0,g=0,h=0,i=0,j=this.cache,k=this.cachePixels,l=a.viewport,m=this.buffer&&(l.width!==this.laxCam.width||l.height!==this.laxCam.height),n=o,p=this.convertCamera(l);if(!this.cacheAll&&(k.empty||!k.contains(p))&&this.imageMap.length>0&&(m&&this.updateBufferRegion(p),f=this.cacheTilesWidth-1,g=this.cacheTilesHeight-1,h=f/2,i=g/2,n.setAll(Math.round((p.x-this.left)/this.tileWidth-h)+h,Math.round((p.y-this.top)/this.tileHeight-i)+i,f,g),n.left<0?n.moveX(n.halfWidth):n.right>this.tilesWidth-1&&n.moveX(this.tilesWidth-1-n.halfWidth),n.top<0?n.moveY(n.halfHeight):n.bottom>this.tilesHeight-1&&n.moveY(this.tilesHeight-1-n.halfHeight),this.tileCache?(j.empty||!n.contains(j))&&(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,n,this.tilesSpriteCache,j)):this.update(null,n),k.setAll((j.x+.5)*this.tileWidth+this.left,(j.y+.5)*this.tileHeight+this.top,(j.width+1)*this.tileWidth,(j.height+1)*this.tileHeight)),this.cacheGrid)for(b=0;b<this.cacheGrid.length;b++)for(c=0;c<this.cacheGrid[b].length;c++)e=this.cacheGrid[b][c],k.setAll((b+.5)*this.cacheClipWidth+this.left,(c+.5)*this.cacheClipHeight+this.top,this.cacheClipWidth,this.cacheClipHeight),d=k.intersects(p),e.visible&&!d?e.visible=!1:!e.visible&&d&&(e.visible=!0),e.visible&&d&&(e.x=l.left-p.left+b*this.cacheClipWidth+this.left,e.y=l.top-p.top+c*this.cacheClipHeight+this.top);else this.tileCache&&(this.tilesSprite.x=l.left-p.left+j.left*this.tileWidth+this.left,this.tilesSprite.y=l.top-p.top+j.top*this.tileHeight+this.top)},updateTile:function(a,b,c,d){var e=null,f=this.tiles;a.id&&(a=a.id),e=f[a],e||null===e||(e=f[a]=this.createTile(a)),b[c][d]=e},createGrid:function(c){var d=this.cacheHeight,e=this.cacheWidth,f=this.cacheTilesHeight,g=this.cacheTilesWidth,h=0,i=0,m=b,n=a,o=null,p=this.scaleX,r=this.scaleY,s=this.tileHeight,t=this.tileWidth,u=this.tilesHeight,v=this.tilesWidth,w=0,x=0,y=this.owner.z,z=null,A=null,B=Array.setUp();for(w=0;v>w;w+=g)for(z=Array.setUp(),B.push(z),x=0;u>x;x+=f)i=Math.min(q((v-w)*t+m),e),h=Math.min(q((u-x)*s+m),d),o=k.create(i,h),o.frame=new j(n,n,((i-m)/t>>0)*t+n,((h-m)/s>>0)*s+n),A=new l(o),A.z=y,A.scale.x=p,A.scale.y=r,z.push(A),c.addChild(A),y-=1e-6;return B},updateRegion:function(a){var c=this.tileWidth*this.scaleX,d=this.tileHeight*this.scaleY,e=Math.min(this.tilesWidth,(this.cacheWidth-b)/c>>0),f=Math.min(this.tilesHeight,(this.cacheHeight-b)/d>>0);e||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+c+"px wide which is larger than "+(this.cacheWidth-b)+"px (maximum cache size of "+this.cacheWidth+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),f||platypus.debug.warn('"'+this.owner.type+'" RenderTiles: The tiles are '+d+"px high which is larger than "+(this.cacheHeight-b)+"px (maximum cache size of "+this.cacheHeight+"px minus a 2px edge bleed). Increase the maximum cache size or reduce tile size."),this.cacheTilesWidth=e,this.cacheTilesHeight=f,this.cacheClipWidth=e*c,this.cacheClipHeight=f*d,this.tileCache&&(this.mapContainer.mask=(new h).beginFill(0).drawRect(0,0,this.cacheClipWidth+a,this.cacheClipHeight+a).endFill())},updateBufferRegion:function(a){var b=this.tileWidth*this.scaleX,c=this.tileHeight*this.scaleY;this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((a.width+2*this.buffer)/b),this.cacheWidth/b>>0),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((a.height+2*this.buffer)/c),this.cacheHeight/c>>0),this.cacheClipWidth=this.cacheTilesWidth*b,
this.cacheClipHeight=this.cacheTilesHeight*c,this.mapContainer.mask=(new h).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(a,b,c,d){this.populate(b,d),this.render(b,a,this.mapContainer,this.mapContainerWrapper,c,d),d&&d.set(b)},populateTiles:function(a,b){var c=0,d=0,e=0,f=0,g=null,h=Array.setUp();for(this.tileContainer.removeChildren(),c=a.left;c<=a.right;c++)for(d=a.top;d<=a.bottom;d++)if(!b||b.empty||d>b.bottom||d<b.top||c>b.right||c<b.left)for(f=0;f<this.imageMap.length;f++)g=this.imageMap[f][c][d].getNext(),g&&(g.template&&h.push(g.template),g.x=(c+.5)*this.tileWidth,g.y=(d+.5)*this.tileHeight,this.tileContainer.addChild(g));for(e=0;e<h.length;e++)h[e].clear();h.recycle()},populateTilesAndEntities:function(a,b){var c=0,d=0,e=0,f=0,g=null,h=null,i=Array.setUp(),j=Array.setUp(),k=null;for(this.tileContainer.removeChildren(),c=a.left;c<=a.right;c++)for(d=a.top;d<=a.bottom;d++)if(!b||b.empty||d>b.bottom||d<b.top||c>b.right||c<b.left){for(f=0;f<this.imageMap.length;f++)g=this.imageMap[f][c][d].getNext(),g&&(g.template&&j.push(g.template),g.x=(c+.5)*this.tileWidth,g.y=(d+.5)*this.tileHeight,this.tileContainer.addChild(g));if(this.doMap[c]&&this.doMap[c][d])for(k=this.doMap[c][d],e=0;e<k.length;e++)k[e].drawn||(k[e].drawn=!0,i.push(k[e]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),i.length)for(i.sort(p),e=0;e<i.length;e++)h=i[e],delete h.drawn,this.mapContainer.addChild(h),h.mask&&this.mapContainer.addChild(h.mask);for(e=0;e<j.length;e++)j[e].clear();j.recycle(),i.recycle()},renderCache:function(a,b,c,d,e,f){var g=this.renderer;e&&!f.empty&&(e.x=f.left*this.tileWidth,e.y=f.top*this.tileHeight,c.addChild(e)),m(g,b),c.x=-a.left*this.tileWidth,c.y=-a.top*this.tileHeight,g.render(d,b),b.requiresUpdate=!0},renderCacheWithExtrusion:function(a,b,c,d){var e=1,f=new h,g=this.renderer;f.lineStyle(1,0),f.drawRect(.5,.5,this.cacheClipWidth+1,this.cacheClipHeight+1),m(g,b),d.mask=f,c.x=-a.left*this.tileWidth,c.y=-a.top*this.tileHeight+e,g.render(d,b),c.x=-a.left*this.tileWidth+e,c.y=-a.top*this.tileHeight,g.render(d,b),c.x=-a.left*this.tileWidth+2*e,c.y=-a.top*this.tileHeight+e,g.render(d,b),c.x=-a.left*this.tileWidth+e,c.y=-a.top*this.tileHeight+2*e,g.render(d,b),d.mask=null,c.x=-a.left*this.tileWidth+e,c.y=-a.top*this.tileHeight+e,g.render(d,b),b.requiresUpdate=!0},updateGrid:function(){var a=this.cache,b=this.cacheTilesHeight,c=this.cacheTilesWidth,d=this.tilesHeight-1,e=this.tilesWidth-1,f=0,g=0,h=this.cacheGrid;for(f=0;f<h.length;f++)for(g=0;g<h[f].length;g++)a.setBounds(f*c,g*b,Math.min((f+1)*c,e),Math.min((g+1)*b,d)),this.update(h[f][g].texture,a)},toJSON:function(){for(var a=this.imageMap[0],b=[],c=a.length,d=0;c--;)for(d=a[c].length,b[c]=[];d--;)b[c][d]=a[c][d].id;return{type:"RenderTiles",buffer:this.buffer,cacheAll:this.cacheAll,entityCache:this.entityCache,imageMap:b,maximumBuffer:this.maximumBuffer,scaleX:this.scaleX,scaleY:this.scaleY,spriteSheet:this.spriteSheet,tileCache:this.tileCache,tileHeight:this.tileHeight,tileWidth:this.tileWidth,top:this.top,left:this.left}},destroy:function(){var a=0,b=0,c="",d=this.cacheGrid,e=this.doMap,f=this.imageMap;if(d){for(a=0;a<d.length;a++)for(b=0;b<d[a].length;b++)d[a][b].texture.destroy(!0),this.parentContainer.removeChild(d[a][b]);d.recycle(2),delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.parentContainer.removeChild(this.tilesSprite)):this.parentContainer.removeChild(this.mapContainer);f.recycle(2);for(c in this.tiles)this.tiles.hasOwnProperty(c)&&this.tiles[c].destroy();if(this.tiles=null,this.parentContainer=null,this.tilesSprite=null,this.spriteSheet.recycleSpriteSheet(),e){for(a=0;a<this.cachedDisplayObjects.length;a++)this.cachedDisplayObjects[a].destroy();for(this.cachedDisplayObjects.recycle(),a=0;a<e.length;a++)if(e[a]){for(b=0;b<e.length;b++)e[a][b]&&e[a][b].recycle();e[a].recycle()}e.recycle()}this.laxCam.recycle(),this.cache.recycle(),this.cachePixels.recycle()}},getAssetList:function(){var a=function(b,c){if(b){if("string"==typeof b)return a(c[b],c);if(b.images)return b.images.greenSlice()}return Array.setUp()};return function(b,c,d){var e=null,f=0,g=null,h=platypus.game.settings.spriteSheets,i=b.spriteSheet||c.spriteSheet||d.spriteSheet;if(i){if("string"==typeof i&&"import"!==i)return a(i,h);if(Array.isArray(i)){for(f=i.length,g=Array.setUp();f--;)e=a(i[f],h),g.union(e),e.recycle();return g}if(i.images)return i.images.greenSlice()}return Array.setUp()}}()})}(),function(){"use strict";var a=include("PIXI.Graphics"),b=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Scrim",properties:{shape:null,width:1366,height:800,left:-683,top:-400,color:0,alpha:.6,masker:null},publicProperties:{},initialize:function(){},events:{"peer-entity-added":function(a){"flashlight-flash"===a.type&&(this.masker=a.masker)},load:function(){this.owner.container||this.owner.addComponent(new b(this.owner,null)),this.shape=(new a).beginFill(this.color,this.alpha),this.shape.drawRect(this.left,this.top,this.width,this.height),this.owner.container.addChild(this.shape)},"handle-render":function(){!this.shape||!this.masker}}})}(),function(){"use strict";return platypus.createComponentClass({id:"SignBoard",events:{load:function(){var a=this.getSign();this.owner.state.set(a.toString(),!0)}},methods:{getSign:function(){var a="right";return this.owner.water?a="water":this.owner.bats?a="bats":this.owner.left?a="left":this.owner.down?a="down":this.owner.magnify?a="magnify":this.owner.spikesup?a="spikes-up":this.owner.spikesdown&&(a="spikes-down"),a}}})}(),function(){"use strict";var a=include("cave_hunt.CustomButton");return platypus.createComponentClass({id:"SplashScreenManager",events:{load:function(){platypus.game.app.music="Music_Splash",this.buttonOver=this.buttonOver.bind(this),this.buttonOut=this.buttonOut.bind(this),this.showIntroScreen=this.showIntroScreen.bind(this);var b=platypus.game.app.getCache("play-button-atlas");this.playButton=new a({up:b.getFrame("play-btn-normal"),down:b.getFrame("play-btn-over"),over:b.getFrame("play-btn-over")});var c=b.getFrame("play-btn-normal");this.playButton.pivot=new PIXI.Point(.5*c.width,.5*c.height),this.playButton.x=372,this.playButton.y=320,this.owner.worldContainer.addChild(this.playButton),this.playButton.on("buttonPress",this.showIntroScreen),this.playButton.on("buttonOver",this.buttonOver),this.playButton.on("buttonOut",this.buttonOut)},"scene-ended":function(){this.clear()}},methods:{buttonOver:function(){if(!this.tl){var a=.05,b=2*(Math.PI/180);this.tl=new TimelineMax({repeat:-1}),this.tl.to(this.playButton,a,{rotation:b,ease:Linear.easeNone}).to(this.playButton,a,{rotation:0,ease:Linear.easeNone}).to(this.playButton,a,{rotation:-b,ease:Linear.easeNone}).to(this.playButton,a,{rotation:0,ease:Linear.easeNone})}this.tl.play()},buttonOut:function(){this.tl&&this.tl.stop(),this.playButton.rotation=0},showIntroScreen:function(){this.playButton.off("buttonOver",this.buttonOver),this.playButton.off("buttonOut",this.buttonOut),this.playButton.off("buttonPress",this.showIntroScreen),TweenMax.killAll(),platypus.game.app.voPlayer.stop();var a=this.getParameterByName("debug");a&&"dance"==a?platypus.game.loadScene("dance-screen"):platypus.game.loadScene("intro-screen")},clear:function(){this.tl&&(this.tl.stop(),this.tl.kill(),this.tl=null),this.playButton.parent.removeChild(this.playButton),this.playButton=null,platypus.game.app.unload("play-button-atlas")},getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null}}})}(),function(){"use strict";var a=include("PIXI.Graphics"),b=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Spotlight",properties:{masker:null,spotLightRadius:80,spotLightAlpha:.4,spotLight:null,color:16777215},publicProperties:{},initialize:function(){},events:{"peer-entity-added":function(a){"flashlight-flash"===a.type&&(this.masker=a.masker)},load:function(){this.owner.container||this.owner.addComponent(new b(this.owner,null)),this.spotLight=(new a).beginFill(this.color,this.spotLightAlpha),this.spotLight.drawCircle(0,0,this.spotLightRadius),this.owner.container.addChild(this.spotLight);var c=new PIXI.filters.BlurFilter;c.blur=5,this.spotLight.filters=[c]},"handle-render":function(){this.masker&&this.spotLight&&(this.spotLight.x=this.masker.x,this.spotLight.y=this.masker.y)}}})}(),function(){"use strict";var a=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Timer",properties:{timerField:null,currentTime:0,time:100,started:!1},initialize:function(){this.update=this.update.bind(this)},events:{load:function(){this.owner.container||this.owner.addComponent(new a(this.owner,null)),this.timerField=new PIXI.Text("00:00",{fontFamily:"Arial",fontSize:36,fill:16777215,align:"center"}),this.timerField.anchor.set(.5),this.timerField.x=130,this.timerField.y=58,this.owner.container.addChild(this.timerField),platypus.game.app.on("update",this.update),this.start()}},methods:{start:function(){this.currentTime=0,this.started=!0},complete:function(){this.started=!1},update:function(a){if(this.started){var b=a/1e3;this.currentTime+=b,this.currentTime>=this.time&&this.complete(),this.timerField.text=this.formatTime(this.currentTime)}},formatTime:function(a){var b="0"+Math.floor(a/60),c="0"+Math.floor(a-60*b);return b.substr(-2)+":"+c.substr(-2)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"TimerBar",properties:{bar:null,time:120},events:{load:function(){this.bar=this.owner.components[4].sprite,this.bar.tint=65280},"start-game":function(){var a=this.getLevelBySceneId().level,b=-1,c=platypus.game.settings.levels[a];c&&c.properties&&(b=c.properties.levelTime),b>-1&&(this.time=b),this.timerTween?this.resume():this.start()},"stop-game":function(){this.pause()},"complete-game":function(){this.stop()},"clear-timer":function(){this.stop()}},methods:{getLevelBySceneId:function(){var a=platypus.game.app.states[platypus.game.currentScene.id].layers;return a.filter(function(a){return"action-layer"==a.type})[0]},start:function(){this.bar&&(this.stop(),this.timerTween=TweenMax.to(this.bar.scale,this.time,{x:.03,ease:Linear.easeNone,onUpdate:this.onUpdate.bind(this),onComplete:this.onTimerComplete.bind(this)}))},pause:function(){this.timerTween&&this.timerTween.pause()},stop:function(){this.timerTween&&this.timerTween.kill()},resume:function(){this.timerTween&&this.timerTween.resume()},onUpdate:function(){!this.playedAudio&&this.time-this.timerTween.totalTime()<10&&(this.bar.tint=15348515,platypus.game.app.sound.play("Tunnel_Timer",{loop:1}),this.playedAudio=!0)},onTimerComplete:function(){this.owner.triggerEvent("timer-complete")}}})}(),function(){"use strict";var a=include("cave_hunt.Constants");return platypus.createComponentClass({id:"ToggleDisplay",properties:{mobile:!1},events:{"handle-render":function(){if(this.owner.parent){var b=a.isMobile.any();b||(this.owner.parent.removeEntity(this.owner),this.owner.container=null)}}}})}(),function(){"use strict";var a=include("cave_hunt.WinPopup"),b=include("cave_hunt.Constants"),c=include("cave_hunt.LosePopup"),d=include("cave_hunt.FunfactPopup"),e=include("cave_hunt.CustomButton"),f=include("cave_hunt.PausePopup"),g=include("cave_hunt.InstructionPopup"),h={RUN_RIGHT:"RUN RIGHT",RUN_LEFT:"RUN LEFT",JUMP:"JUMP",RUN_AND_JUMP:"RUN AND JUMP"};return platypus.createComponentClass({id:"TunnelPopup",properties:{keys:{left:"left",right:"right",space:"space"},remove:!1,inActivityTime:10,elapsedTime:0,gameStarted:!1,arrows:[],tutorials:[{title:h.RUN_RIGHT,keys:["popup-right-bar"],buttons:["popup-button-right"],arrowsPos:[235],arrowsDevice:[-150]},{title:h.RUN_LEFT,keys:["popup-left-bar"],buttons:["popup-button-left"],arrowsPos:[110],arrowsDevice:[-150]},{title:h.JUMP,keys:["popup-space-bar"],buttons:["popup-button-jump"],arrowsPos:[-120],arrowsDevice:[-150]},{title:h.RUN_AND_JUMP,keys:["popup-right-bar","popup-space-bar"],buttons:["popup-button-right","popup-button-jump"],arrowsPos:[235,-120],buttonsPos:[-100,150],arrowsDevice:[-230,30],obstacle:!0}],currentTutorialIndex:0,jumpTime:0,rightTime:0},publicProperties:{directionalPopupOn:!1,left:!1,right:!1,space:!1,up:!1},initialize:function(){this.onBackPress=this.onBackPress.bind(this),this.update=this.update.bind(this)},events:{load:function(){this.container=new PIXI.Container,this.owner.worldContainer.addChild(this.container),this.backButton=this.addBackButton(this.owner.worldContainer)},"scene-ended":function(){this.pausePopup&&(this.pausePopup=null),this.inspopup&&(this.inspopup=null),this.winpopup&&(this.winpopup=null),this.losepopup&&(this.losepopup=null)},"enter-scene":function(){platypus.game.app.music="Music_Tunnel",this.mapSound&&(this.mapSound.stop(),this.mapSound=null),this.mapSound=platypus.game.app.sound.play("Ambience_Cave_Tunnel_And_Challenge_Loop",{loop:-1,volume:.2}),this.isMobile=b.isMobile.any(),this.pauseGame(),this.hideElements(),this.gameStarted=!1,this.directionalPopupOn=!1,platypus.game.app.on("update",this.update),platypus.game.app.funfacts=null,platypus.game.app.wfunfacts=null,this.hero=this.owner.getEntitiesByType("hero-popup")[0];var a=this.owner.parent.id;platypus.game.app[a]?this.startGame():(platypus.game.app[a]=!0,TweenMax.delayedCall(.5,this.addInstructionsPopup.bind(this))),platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume()},"reset-inactity":function(){this.elapsedTime=0},"pause-game":function(){this.pauseGame()},"show-funfacts":function(a,b){this.ffpopup||(this.ffpopup=new d(this.owner)),this.ffpopup.show(this.container,a,b),this.pauseGame()},"complete-game":function(){this.addWinPopup(),platypus.game.app.trackEvent("Tunnel "+platypus.game.currentScene.id,"Pass")},"timer-complete":function(){this.addLosePopup(),platypus.game.app.trackEvent("Tunnel "+platypus.game.currentScene.id,"Fail")},"popup-close":function(a){"unpause"==a?(this.introCompleted&&this.startGame(),this.backButton.enabled=!0,platypus.game.app.gamePaused=!1,platypus.game.app.animator.resume(),platypus.game.app.voPlayer.resume(),platypus.game.app.sound.resumeAll(),TweenMax.resumeAll()):"map"==a?(this.clearGame(),platypus.game.loadScene("map-screen")):"replay"==a?(this.clearGame(),platypus.game.loadScene(platypus.game.currentScene.id)):"challenge"==a?(this.clearGame(),platypus.game.currentScene.id==b.Tunnels.ColossalCaves?platypus.game.loadScene("duster-challenge"):platypus.game.currentScene.id==b.Tunnels.HiddenFalls?platypus.game.loadScene("flashlight-challenge"):platypus.game.currentScene.id==b.Tunnels.CritterCavern&&platypus.game.loadScene("compass-challenge")):"start"==a?(this.toggleElements(["popup-screen","hero-popup"],1),this.directionalPopupOn=!0,this.tutorialOn=!0,this.currentTutorialIndex=0,this.currentTutorial=null,this.startTutorial()):"restart"==a&&this.startGame()},"key-release":function(a){platypus.game.app.gamePaused||(this.hero.trigger("stop"),(this.movingRight&&this.currentTutorial.title==h.RUN_RIGHT||this.movingLeft&&this.currentTutorial.title==h.RUN_LEFT)&&this.nextTutorial(),this.moveRight=!1,this.movingLeft=!1)},"key-press":function(a){if(this.tutorialOn&&!platypus.game.app.gamePaused){if(this.right&&!this.movingRight&&this.currentTutorial.title==h.RUN_RIGHT?(this.hero.trigger("stop"),this.hero.trigger("go-right"),this.movingRight=!0,this.unhighlight()):this.left&&!this.movingLeft&&this.currentTutorial.title==h.RUN_LEFT?(this.hero.trigger("stop"),this.hero.trigger("go-left"),this.movingLeft=!0,this.unhighlight()):!this.space&&!this.up||this.jumping||this.currentTutorial.title!=h.JUMP||(this.hero.trigger("stop"),this.hero.state.set("jump",!0),this.jumping=!0,this.grav=.98,this.jumpPow=-20,this.unhighlight()),this.right&&(this.space||this.up)&&this.currentTutorial.title==h.RUN_AND_JUMP){var b=springroll.TimeUtils.now();if(Math.abs(b-this.jumpTime)<2e3)return this.tutorialOn=!1,this.jumpHero(200,-150),void this.unhighlight();this.jumpTime=b}this.right&&this.currentTutorial.title==h.RUN_AND_JUMP&&(this.hero.trigger("stop"),this.hero.trigger("go-right"),this.moveRight=!0,this.unhighlight()),!this.space&&!this.up||this.jumping||this.currentTutorial.title!=h.RUN_AND_JUMP||(this.hero.trigger("stop"),this.hero.state.set("jump",!0),this.jumping=!0,this.grav=.98,this.jumpPow=-20,this.unhighlight())}},"camera-update":function(a){this.backButton.x=a.viewport.left+10,this.backButton.y=a.viewport.top+10}},methods:{onBackPress:function(){this.pauseGame(),this.backButton.enabled=!1,platypus.game.app.gamePaused=!0,platypus.game.app.animator.pause(),platypus.game.app.voPlayer.pause(),platypus.game.app.sound.pauseAll(),TweenMax.pauseAll(),this.addPausePopup()},addBackButton:function(a){var b=platypus.game.app.getCache("popup-atlas"),c=new e({up:b.getFrame("Back_Btn_Normal"),over:b.getFrame("Back_Btn_Over"),down:b.getFrame("Back_Btn_Down"),disabled:b.getFrame("Back_Btn_Disabled")});return c.on("buttonPress",this.onBackPress),a.addChild(c),c},addPausePopup:function(){this.pausePopup||(this.pausePopup=new f(this.owner)),this.pausePopup.show(this.owner.worldContainer)},onJump:function(){this.hero.state.set("jump",!1),this.hero.trigger("stop"),this.nextTutorial()},jumpHero:function(a,b){var c=.25,d=new TimelineMax({onComplete:this.onJump.bind(this)});d.to(this.hero,c,{y:this.hero.y+b,x:this.hero.x+.5*a,ease:Sine.easeOut}).to(this.hero,c,{y:20,x:this.hero.x+a,ease:Sine.easeIn}),d.play()},addObstacle:function(){this.obstacle=new PIXI.Sprite,this.obstacle.x=100,this.owner.parent.id==b.Tunnels.HiddenFalls?this.obstacle.y=28:this.obstacle.y=40,this.obstacle.scale.set(.8),this.obstacle.anchor.set(.5),this.isMobile?this.owner.worldContainer.addChildAt(this.obstacle,9):this.owner.worldContainer.addChildAt(this.obstacle,3),this.toggleHighlightObstacle(!1)},toggleHighlightObstacle:function(a){var c=platypus.game.app.getCache("popup-atlas"),d="";this.owner.parent.id==b.Tunnels.ColossalCaves?d="popup-stalagmites":this.owner.parent.id==b.Tunnels.HiddenFalls?d="popup-waterfalls":this.owner.parent.id==b.Tunnels.CritterCavern&&(d="popup-bat"),a&&(d+="-highlight"),this.obstacle.texture=c.getFrame(d)},showText:function(a){this.titleField||(this.titleField=new PIXI.extras.BitmapText("",{font:"60px popupsFont",align:"center",tint:16777215}),this.titleField.anchor.set(.5),this.titleField.y=-180,this.isMobile?this.owner.worldContainer.addChildAt(this.titleField,10):this.owner.worldContainer.addChildAt(this.titleField,2)),this.titleField.text=a},startTutorial:function(){this.currentTutorial&&this.isMobile&&this.toggleElements(this.currentTutorial.buttons,0,null,"reset"),this.hero.trigger("stop"),this.hero.state.set("jump",!1),this.currentTutorial=this.tutorials[this.currentTutorialIndex],this.isMobile?(this.toggleElements(this.currentTutorial.buttons,1,this.currentTutorial.buttonsPos,"reset"),this.addArrows(this.currentTutorial.arrowsDevice)):(this.toggleElements(["popup-left-bar","popup-right-bar","popup-space-bar","popup-up-bar","popup-down-bar"],1),this.highlightKeys(this.currentTutorial.keys),this.addArrows(this.currentTutorial.arrowsPos)),this.showText(this.currentTutorial.title),this.hero.speed=0,this.hero.trigger("face","right"),this.currentTutorial.obstacle&&this.addObstacle(),this.currentTutorial.title==h.RUN_RIGHT?platypus.game.app.voPlayer.play("CH_Tunnel_All_Move_Right_NC"):this.currentTutorial.title==h.RUN_LEFT?platypus.game.app.voPlayer.play("CH_Tunnel_All_Move_Left_NC"):this.currentTutorial.title==h.JUMP?platypus.game.app.voPlayer.play("CH_Tunnel_All_Jump_NC"):this.currentTutorial.title==h.RUN_AND_JUMP&&platypus.game.app.voPlayer.play("CH_Tunnel_All_Move_Right_And_Jump_NC")},addArrows:function(a){for(var b=0;b<a.length;b++){var c=a[b],d=75;this.isMobile?(d=165,this.addArrow(c,d,20,0,0)):this.addArrow(c,d,0,20,90)}},nextTutorial:function(){return++this.currentTutorialIndex,this.currentTutorialIndex>=this.tutorials.length?(TweenMax.delayedCall(.5,this.clear.bind(this)),this.owner.triggerEventOnChildren("disable"),platypus.game.app.voPlayer.stop(),void(this.tutorialOn=!1)):void this.startTutorial()},toggleElements:function(a,b,c,d){for(var e=a.length-1;e>=0;e--){var f=a[e],g=this.owner.getEntitiesByType(f);if(g.length>0){var h=g[0];h.container.alpha=b,1==b&&h.type.indexOf("button")>-1&&h.container.parent.addChildAt(h.container,h.container.parent.children.length-1),c&&(h.x=c[e])}}},hideElements:function(){for(var a=this.owner.entities.length,b=a-1;b>=0;b--){var c=this.owner.entities[b];c.container&&(c.container.alpha=0)}},highlightKeys:function(a){for(var b=a.length-1;b>=0;b--){var c=a[b],d=this.owner.getEntitiesByType(c);if(d.length>0){var e=d[0];e.state.set("highlight",!0)}}},applyTint:function(a,b,c){if(this.owner.getEntitiesByType){var d=this.owner.getEntitiesByType(a)[0];d&&(d.tint=b,d.scaleX=c,d.scaleY=c)}},clearGame:function(){this.mapSound&&(this.mapSound.stop(),this.mapSound=null),platypus.game.app.off("update",this.update);var a=this.getLayerByType("action-layer");a.triggerEventOnChildren("clear"),platypus.game.app.voPlayer.stop(),this.owner.trigger("stop-game"),this.owner.trigger("clear"),this.gameStarted=!1},playInActivity:function(){platypus.game.app.voPlayer.playing||(this.addArrow(125,-50,20,0,0),TweenMax.delayedCall(2,this.unhighlight.bind(this)),platypus.game.currentScene.id==b.Tunnels.ColossalCaves?platypus.game.app.voPlayer.play(["CH_Tunnel_ColossalC_Inactivity_A_Daisy","CH_Tunnel_ColossalC_Inactivity_B_Daisy","CH_Tunnel_ColossalC_Inactivity_C_Daisy"].shuffle()[0]):platypus.game.currentScene.id==b.Tunnels.HiddenFalls?platypus.game.app.voPlayer.play(["CH_Tunnel_HF_Inactivity_A_Hal","CH_Tunnel_HF_Inactivity_B_Hal","CH_Tunnel_HF_Inactivity_C_Hal"].shuffle()[0]):platypus.game.currentScene.id==b.Tunnels.CritterCavern&&platypus.game.app.voPlayer.play(["CH_Tunnel_CritterC_Inactivity_A_Squeeks","CH_Tunnel_CritterC_Inactivity_B_Squeeks","CH_Tunnel_CritterC_Inactivity_C_Squeeks","CH_Tunnel_CritterC_Inactivity_D_Squeeks"].shuffle()[0]))},unhighlight:function(){this.arrows.map(function(a){a&&a.tl&&a.tl.stop(),a.visible=!1})},getArrow:function(){return this.arrows.filter(function(a){return!a.visible}),null},addArrow:function(a,b,c,d,e){if(this.container){var f=this.getArrow();f||(f=new PIXI.Sprite(platypus.game.app.getCache("arrow")),this.arrows.push(f)),f.anchor.set(.5),f.x=a,f.y=b,f.visible=!0,f.rotation=e*Math.PI/180,this.container.addChild(f);var g=.2;f.tl&&f.tl.stop(),f.tl=new TimelineMax({repeat:-1}),f.tl.to(f,g,{x:a+c,y:b+d,ease:Linear.easeNone}).to(f,g,{x:a,y:b,ease:Linear.easeNone}),f.tl.play()}},update:function(a){var b=a/1e3;if(!platypus.game.app.gamePaused){if(this.tutorialOn&&(this.moveRight&&(this.hero.x+=5),this.jumping&&(this.hero.y+=this.jumpPow,this.jumpPow+=this.grav,this.hero.y>=20&&(this.jumping=!1,this.hero.state.set("jump",!1),this.hero.y=20,this.currentTutorial.title==h.JUMP&&this.nextTutorial())),this.obstacle)){if(this.hero.x>=this.obstacle.x&&!this.jumping)return this.tutorialOn=!1,this.hero.trigger("stop"),void this.nextTutorial();var c=this.hero.x-this.obstacle.x,d=this.hero.y-this.obstacle.y,e=Math.sqrt(c*c+d*d);50>=e&&(this.jumping=!1,this.moveRight=!1,this.hero.state.set("jump",!1),this.hero.trigger("stop"),this.hero.y=20,this.hero.x=-20,this.toggleHighlightObstacle(!0),TweenMax.delayedCall(.2,this.toggleHighlightObstacle.bind(this,!1)))}this.gameStarted&&(this.elapsedTime+=b),this.elapsedTime>this.inActivityTime&&(this.elapsedTime=0,this.playInActivity())}},getLayerByType:function(a){return this.owner.parent.layers.filter(function(b){return a==b.type})[0]},addWinPopup:function(){this.gameStarted=!1,this.winpopup||(this.winpopup=new a(this.owner)),this.winpopup.show(this.container)},addLosePopup:function(){this.gameStarted=!1,this.losepopup||(this.losepopup=new c(this.owner)),platypus.game.app.voPlayer.play("CH_Tunnel__ALL_Fail_Times_Up_NC"),this.losepopup.show(this.container)},addInstructionsPopup:function(){this.gameStarted=!1,this.inspopup||(this.inspopup=new g(this.owner)),this.inspopup.show(this.container)},remove:function(){TweenMax.to(this.container.scale,.5,{x:.8,y:.8,ease:Elastic.easeIn,onComplete:this.clear.bind(this)})},startGame:function(){var a=this.getLayerByType("interface-layer");a.triggerEventOnChildren("enable"),this.owner.trigger("start-game"),this.gameStarted=!0,this.introCompleted=!0},pauseGame:function(){var a=this.getLayerByType("interface-layer");a.triggerEventOnChildren("disable"),this.owner.trigger("stop-game"),this.gameStarted=!1},clear:function(){for(var a=this.owner.entities.length,b=a-1;b>=0;b--){var c=this.owner.entities[b];this.owner.removeEntity(c)}this.titleField&&(this.titleField.parent.removeChild(this.titleField),this.titleField=null),this.arrows.map(function(a){a.parent&&a.parent.removeChild(a),a.tl&&(a.tl.stop(),a.tl=null),a=null}),this.arrows=[],this.obstacle&&(this.obstacle.parent.removeChild(this.obstacle),this.obstacle=null),this.calculateMagnifyingGlasses(),this.startGame()},calculateMagnifyingGlasses:function(){var a=this.getLayerByType("action-layer");platypus.game.app.magnifyingGlassTotalCount=a.getEntitiesByType("magnifying-glass").length+a.getEntitiesByType("magnifying-glass-water").length}}})}(),function(){"use strict";var a=include("PIXI.Container"),b=include("cave_hunt.CustomButton"),c=include("cave_hunt.Constants");return platypus.createComponentClass({id:"VaultManager",properties:{bg:null,introText:null,holes:[]},events:{"enter-scene":function(){platypus.game.app.music="Music_Vault",this.interactiveFL=null,this.gotKey(c.keys.flashlight)&&!this.placedKey(c.keys.flashlight)&&(this.interactiveFL=this.getSprite("KeyFlashlight",0,300,.6,20,16777215,c.keys.flashlight),this.enableDrag(this.interactiveFL)),this.interactiveDuster=null,this.gotKey(c.keys.duster)&&!this.placedKey(c.keys.duster)&&(this.interactiveDuster=this.getSprite("KeyDuster",this.interactiveFL?-200:0,300,.6,-2,16777215,c.keys.duster),this.enableDrag(this.interactiveDuster)),this.interactiveCompass=null,this.gotKey(c.keys.compass)&&!this.placedKey(c.keys.compass)&&(this.interactiveCompass=this.getSprite("KeyCompass",this.interactiveDuster||this.interactiveFL?200:0,300,.68,0,16777215,c.keys.compass),this.enableDrag(this.interactiveCompass)),this.hasPlacedAllKeys()?this.enableDoor():this.interactiveFL||this.interactiveDuster||this.interactiveCompass?platypus.game.app.voPlayer.play("CH_Vault_Player_Earns_Key_Still_Needs_Daisy"):this.interactiveFL||this.interactiveDuster||this.interactiveCompass||!this.hasPlacedAnyKey()||platypus.game.app.voPlayer.play("CH_Vault_Player_Earns_Key_Already_Earned_Squeeks"),this.interactiveFL?this.highlightKey(this.interactiveFL):this.interactiveDuster?this.highlightKey(this.interactiveDuster):this.interactiveCompass&&this.highlightKey(this.interactiveCompass)},load:function(){this.onDragMove=this.onDragMove.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onVaultStart=this.onVaultStart.bind(this),this.onVaultStop=this.onVaultStop.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.container=new a,this.owner.worldContainer.addChild(this.container),this.bg=new PIXI.Sprite(platypus.game.app.getCache("vault-bg")),this.bg.anchor.set(.5),this.container.addChild(this.bg),this.vaultAtlas=platypus.game.app.getCache("vault-atlas"),this.vault=new PIXI.Sprite(this.vaultAtlas.getFrame("vault-handle")),this.vault.anchor.set(.5),this.vault.x=20,this.vault.y=-35,this.vault.buttonMode=!0,this.vault.interactive=!0,this.container.addChild(this.vault),this.vault.on("pointerdown",this.onVaultStart),this.vault.on("pointerup",this.onVaultStop),this.vault.on("pointerupoutside",this.onVaultStop);var b=this.placedKey(c.keys.flashlight),d=this.getSprite("KeyFlashlight",194.5,-32,.6,22,b?16777215:0,c.keys.flashlight,!0);d.hasKey=b,this.holes.push(d),b=this.placedKey(c.keys.duster);var e=this.getSprite("KeyDuster",143.78,109,.6,-2,b?16777215:0,c.keys.duster,!0);e.hasKey=b,this.holes.push(e),b=this.placedKey(c.keys.compass);var f=this.getSprite("KeyCompass",147,-201,.68,0,b?16777215:0,c.keys.compass,!0);f.hasKey=b,this.holes.push(f),this.backButton=this.addBackButton(this.container)},"popup-close":function(a){this.onBackPress()},"camera-update":function(a){this.backButton.x=a.viewport.left+10,this.backButton.y=a.viewport.top+10},"scene-ended":function(){this.clear()}},methods:{enableDoor:function(){platypus.game.app.voPlayer.play("CH_Vault_Player_FInal_Key_In_Place_NC"),this.arrow=new PIXI.Sprite,this.arrow.anchor.set(.5),this.container.addChild(this.arrow),c.isMobile.any()?(this.arrow.texture=this.vaultAtlas.getFrame("CurvedArrow_Vault"),this.arrow.x=100,this.arrow.y=-65,this.container.interactive=!0,this.container.on("pointermove",this.onPointerMove)):(this.arrow.texture=this.vaultAtlas.getFrame("arrow-stroke"),this.arrow.y=-50,this.arrow.x=-100)},onPointerMove:function(a){if(this.startPoint&&this.vault){var b=this.container.toLocal(a.data.global),c=b.x-this.startPoint.x,d=b.y-this.startPoint.y,e=Math.atan2(d,c);0===this.rotateTime&&(e-=this.vault.rotation),this.vault.rotation=e,platypus.game.app.sound.isPlaying("Vault_Handle_Turn")||platypus.game.app.sound.play("Vault_Handle_Turn"),++this.rotateTime,this.rotateTime>=100&&(this.container.off("pointermove",this.onPointerMove),this.checkPlacedAllKeys())}},getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},checkPlacedAllKeys:function(){this.hasPlacedAllKeys()&&(platypus.game.app.voPlayer.play("CH_Vault_As_Door_Opens_Open_Sesame_Hal"),TweenMax.delayedCall(3.5,this.delayComplete.bind(this)))},onVaultStop:function(){this.turnRight=!1,this.turnLeft=!1,this.startPoint=null,this.rotateTime=0},clear:function(){this.backButton.off("pointerdown",this.onBackPress),this.container.removeChild(this.backButton),this.backButton=null,this.vault&&(this.vault.off("pointerdown",this.onVaultStart),this.vault.off("pointerup",this.onVaultStop),this.vault.off("pointerupoutside",this.onVaultStop),this.container.removeChild(this.vault),this.vault=null),this.arrow&&(this.container.removeChild(this.arrow),this.arrow=null),this.container.removeChild(this.bg),this.bg=null,this.holes.map(function(a){a.parent&&a.parent.removeChild(a),a=null}),this.interactiveFL&&(this.disableDrag(this.interactiveFL),this.interactiveFL.parent.removeChild(this.interactiveFL),this.interactiveFL=null),this.interactiveDuster&&(this.disableDrag(this.interactiveDuster),this.interactiveDuster.parent.removeChild(this.interactiveDuster),this.interactiveDuster=null),this.interactiveCompass&&(this.disableDrag(this.interactiveCompass),this.interactiveCompass.parent.removeChild(this.interactiveCompass),this.interactiveCompass=null),this.container.off("pointermove",this.onPointerMove),this.owner.worldContainer.removeChild(this.container),this.container=null},highlightKey:function(a){a.texture=this.vaultAtlas.getFrame(a.key+"-highlight")},hasPlacedAnyKey:function(a){return this.placedKey(c.keys.flashlight)||this.placedKey(c.keys.duster)||this.placedKey(c.keys.compass)},hasPlacedAllKeys:function(a){return this.placedKey(c.keys.flashlight)&&this.placedKey(c.keys.duster)&&this.placedKey(c.keys.compass)},gotKey:function(a){return platypus.game.app.saveData[a]?platypus.game.app.saveData[a].gotKey:!1},placedKey:function(a){return platypus.game.app.saveData[a]?platypus.game.app.saveData[a].placedKey:!1},onVaultStart:function(a){this.turnRight=!1,this.turnLeft=!1,this.rotateTime=0,this.startPoint=this.container.toLocal(a.data.global),this.hasPlacedAllKeys()&&!c.isMobile.any()?(this.vault.off("pointerdown",this.onVaultStart),platypus.game.app.sound.play("Vault_Handle_Turn"),TweenMax.to(this.vault,4,{
rotation:2*-Math.PI,ease:Linear.easeNone,onComplete:this.checkPlacedAllKeys.bind(this)}),this.arrow&&(this.container.removeChild(this.arrow),this.arrow=null)):(this.highlightHoles(),TweenMax.delayedCall(1,this.unhighlight.bind(this)),platypus.game.app.sound.play("Vault__Lock_1"))},unhighlight:function(){this.unhighlightHoles()},highlightHoles:function(){this.holes.map(function(a){a.hasKey||(a.tint=65280)})},unhighlightHoles:function(){this.holes.map(function(a){a.hasKey||(a.tint=0)})},delayComplete:function(){platypus.game.loadScene("dance-screen")},getSprite:function(a,b,c,d,e,f,g,h){h=h||!1;var i=platypus.game.app.getCache("vault-atlas"),j=new PIXI.Sprite(i.getFrame(a));return j.x=b,j.y=c,j.key=a,j.anchor.set(.5),j.rotation=e*Math.PI/180,j.scale.set(d),j.tint=f,j.name=g,h&&(j.hitArea=new PIXI.Circle(b,c,30)),this.container.addChild(j),j},enableDrag:function(a){a.interactive=!0,a.buttonMode=!0,a.anchor.set(.5),a.on("pointerdown",this.onDragStart).on("pointerup",this.onDragEnd).on("pointerupoutside",this.onDragEnd).on("pointermove",this.onDragMove)},disableDrag:function(a){a.interactive=!1,a.buttonMode=!1,a.off("pointerdown",this.onDragStart).off("pointerup",this.onDragEnd).off("pointerupoutside",this.onDragEnd).off("pointermove",this.onDragMove)},onDragMove:function(a){if(this.dragging){var b=this.container.toLocal(a.data.global);this.dragging.x=b.x,this.dragging.y=b.y}},checkHole:function(){if(this.dragging){for(var a=this.holes.length,b=null,c=0;a>c;c++){var d=this.holes[c];if(!d.hasKey&&d.hitArea.contains(this.dragging.x,this.dragging.y)){b=d;break}}if(!b)return;this.dragging.name==b.name?(this.dragging.position=b.position,this.dragging.interactive=!1,this.saveProgress(b.name),this.hasPlacedAllKeys()?TweenMax.delayedCall(.5,this.enableDoor.bind(this)):(TweenMax.delayedCall(1,this.onBackPress.bind(this)),platypus.game.app.voPlayer.stop()),platypus.game.app.trackEvent("Vault "+this.dragging.name,"Complete"),platypus.game.app.sound.play("CH_Key_In_Correct_Keyhole")):b.tint=16711680}},saveProgress:function(a){platypus.game.app.saveData[a]||(platypus.game.app.saveData[a]={}),platypus.game.app.saveData[a].placedKey=!0,platypus.game.app.save()},onDragStart:function(a){this.dragging=a.currentTarget,this.unhighlightHoles()},onDragEnd:function(a){this.checkHole(),this.dragging=null},onBackPress:function(){platypus.game.app.voPlayer.stop(),platypus.game.loadScene("map-screen")},addBackButton:function(a){var c=platypus.game.app.getCache("popup-atlas"),d=new b({up:c.getFrame("Back_Btn_Normal"),over:c.getFrame("Back_Btn_Over"),down:c.getFrame("Back_Btn_Down"),disabled:c.getFrame("Back_Btn_Disabled")});return d.on("buttonPress",this.onBackPress),a.addChild(d),d}}})}(),function(){"use strict";var a=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Waterfall",events:{load:function(){this.open=this.open.bind(this),this.close=this.close.bind(this),this.showWarning=this.showWarning.bind(this),this.atlas=platypus.game.app.getCache("waterfall"),this.owner.container||this.owner.addComponent(new a(this.owner,null)),this.owner.waterStart=new PIXI.Sprite(this.atlas.getFrame("waterfall-start")),this.owner.waterStart.anchor.set(.5,1),this.owner.container.addChild(this.owner.waterStart),this.owner.waterStart.y=-this.owner.height+this.owner.waterStart.height,this.owner.water=new PIXI.Sprite(this.atlas.getFrame("waterfall-water")),this.owner.water.anchor.set(.5,0),this.owner.water.x=2,this.owner.water.y=this.owner.waterStart.y-.47*this.owner.waterStart.height,this.owner.water.height=this.owner.height-this.owner.waterStart.height,this.owner.container.addChild(this.owner.water),this.owner.waterWarning=new PIXI.Sprite,this.owner.waterWarning.anchor.set(.5,0),this.owner.waterWarning.x=2,this.owner.waterWarning.y=this.owner.water.y,this.owner.container.addChild(this.owner.waterWarning),this.owner.waterWarning.visible=!1,this.owner.waves=[],this.addWaves(),this.owner.bubbles=[],this.createBubble(0,-35,this.owner.container,this.owner.bubbles),this.createBubble(-20,-35,this.owner.container,this.owner.bubbles),this.createBubble(20,-35,this.owner.container,this.owner.bubbles),this.createBubble(-40,-45,this.owner.container,this.owner.bubbles),this.createBubble(40,-45,this.owner.container,this.owner.bubbles),this.createBubble(10,-55,this.owner.container,this.owner.bubbles),this.createBubble(-10,-55,this.owner.container,this.owner.bubbles),this.createBubble(30,-55,this.owner.container,this.owner.bubbles),this.createBubble(-30,-55,this.owner.container,this.owner.bubbles),this.owner.warningBubbles=[],this.createBubble(10,10,this.owner.waterWarning,this.owner.warningBubbles),this.createBubble(-10,10,this.owner.waterWarning,this.owner.warningBubbles),this.createBubble(30,10,this.owner.waterWarning,this.owner.warningBubbles),this.createBubble(-30,10,this.owner.waterWarning,this.owner.warningBubbles),this.open()},"start-game":function(){this.gamePause=!1},"stop-game":function(){this.gamePause=!0},"handle-logic":function(){if(this.owner.waterWarning.visible&&this.updateBubbles(this.owner.warningBubbles),this.owner.isOpen&&!this.gamePause){for(var a=this.owner.waves.length,b=0;a>b;b++){var c=this.owner.waves[b];c.y+=1,c.y>=1.5*-c.height&&(c.y=this.owner.water.y)}this.updateBubbles(this.owner.bubbles)}},clear:function(){TweenMax.killAll(!1,!1,!0,!1)},"scene-ended":function(){TweenMax.killAll(!1,!1,!0,!1),this.waterStart&&(this.waterStart.parent.removeChild(this.waterStart),this.waterStart=null),this.water&&(this.water.parent.removeChild(this.water),this.water=null),this.owner.waves.map(function(a){a.parent.removeChild(a),a=null}),this.owner.waves=null,this.owner.bubbles.map(function(a){a.parent.removeChild(a),a=null}),this.owner.bubbles=null}},methods:{updateBubbles:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=d.scale.x;e+=.001,e>=d.maxScale&&(e=.6+.4*Math.random(),d.maxScale=e+.2*Math.random()),d.scale.set(e)}},addWaves:function(){for(var a=40,b=0,c=41;b+c<this.owner.water.height;){var d=this.owner.water.y+b;this.createWave(-18,d),this.createWave(18,d),b=b+c+a}},createWave:function(a,b){var c=new PIXI.Sprite(this.atlas.getFrame("waterfall-wave"));c.anchor.set(.5,0),c.x=a,c.y=b,this.owner.container.addChild(c),this.owner.waves.push(c)},createBubble:function(a,b,c,d){var e=new PIXI.Sprite(this.atlas.getFrame("waterfall-bubble"));e.anchor.set(.5);var f=.6+.4*Math.random();e.scale.set(f),e.maxScale=f+.2*Math.random(),e.x=a,e.y=b,c.addChild(e),d.push(e)},close:function(){this.owner.isOpen=!1,this.owner.water.visible=!1,this.toggleDisplay(this.owner.waves,!1),this.toggleDisplay(this.owner.bubbles,!1),TweenMax.delayedCall(this.owner.openTime-1,this.showWarning),TweenMax.delayedCall(this.owner.openTime,this.open)},toggleDisplay:function(a,b){for(var c=a.length,d=0;c>d;d++)a[d].visible=b},showWarning:function(){this.owner.waterWarning.visible=!0},open:function(){this.owner.isOpen=!0,this.owner.water.visible=!0,this.owner.waterWarning.visible=!1,this.toggleDisplay(this.owner.waves,!0),this.toggleDisplay(this.owner.bubbles,!0),TweenMax.delayedCall(this.owner.closeTime,this.close)}}})}(),function(){"use strict";var a=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"Waterpool",properties:{waterEnd:null},events:{load:function(){this.owner.container||this.owner.addComponent(new a(this.owner,null));var b=platypus.game.app.getCache("waterfall");this.waterEnd=new PIXI.Sprite(b.getFrame("waterfall-end")),this.waterEnd.anchor.set(.5,1),this.owner.container.addChild(this.waterEnd),this.waterEnd.width=this.owner.width,this.waterEnd.height=this.owner.height},"scene-ended":function(){this.waterEnd&&(this.waterEnd.parent.removeChild(this.waterEnd),this.waterEnd=null)}}})}(),function(){"use strict";var a=include("platypus.components.RenderContainer");return platypus.createComponentClass({id:"WormsCounter",properties:{counterField:null,counter:0,voCounter:0},events:{load:function(){this.owner.container||this.owner.addComponent(new a(this.owner,null)),this.counterField=new PIXI.extras.BitmapText("0",{font:"60px birdsCountFont",align:"center",tint:16777215}),this.counterField.anchor.set(.5),this.counterField.x=45,this.counterField.y=59,this.owner.container.addChild(this.counterField),this.voCounter=3+Math.round(2*Math.random())},collected:function(){++this.counter,this.counterField.text=this.counter,platypus.game.app.wormsCount=this.counter,platypus.game.app.sound.play("CollectPowerup"),--this.voCounter,this.voCounter<=0&&(platypus.game.app.voPlayer.play(["CH_Tunnel_ALL_Collecting_Glowworms_A_NC","CH_Tunnel_ALL_Collecting_Glowworms_B_NC"].shuffle()[0]),this.voCounter=3+Math.round(2*Math.random()))}},methods:{start:function(){}}})}();