!function(){var a=include("PIXI.WebGLRenderer"),b=a.prototype;b.__initContext=b._initContext,b._initContext=function(){this.__initContext(),this._useFXAA=!1,this._FXAAFilter=null}}(),function(){function a(a,b){b*=f;var c=Math.sin(b),d=Math.cos(b),e=a.x*d-a.y*c,g=a.x*c+a.y*d;a.x=e,a.y=g}var b={},c=2147483648,d=1073741824,e=536870912;b.parse=function(b,f){var g,h,i,j,k,l,m,n={},o=b.tilewidth,p=b.tileheight,q=b.width,r=b.height;n.tileWidth=o,n.tileHeight=p;var s=[null],t=b.tilesets;for(g=0;g<t.length;++g){m=t[g];var u=m.firstgid;m.source&&(k=m.source,k=k.substring(k.indexOf("/")+1,k.lastIndexOf(".")),m=f[k]),k=m.name;for(j in m.tiles){l={tileset:k},s[u+parseInt(j)]=l;var v=m.tiles[j].image;l.image=v.substring(v.lastIndexOf("/")+1,v.lastIndexOf(".")),m.tileproperties&&m.tileproperties[j]?l.defaultProperties=m.tileproperties[j]:l.defaultProperties={}}}var w={},x=b.layers;for(n.layers=[],g=0;g<x.length;++g){var y=x[g],z={name:y.name,type:y.type};if(n.layers.push(z),"tilelayer"==y.type){z.grid=[];for(var A=y.data,B=0;q>B;++B){z.grid[B]=[];for(var C=0;r>C;++C)z.grid[B][C]=s[A[C*q+B]]}}else{var D=z.objects=[],E=y.objects;for(h=0,i=E.length;i>h;++h){var F=E[h],G={};D.push(G),G.name=F.name,G.type=F.type,G.id=F.id;var H;if(F.gid){var I=F.gid;G.flippedHorizontally=!!(I&c||I&e),G.flippedVertically=!!(I&d||I&e),I&=~(c|d|e),G.properties=Object.merge({},s[I].defaultProperties,F.properties),G.width=F.width,G.height=F.height,G.rotation=F.rotation;var J=0,K=-F.height;G.properties.anchorX&&(J+=F.width*G.properties.anchorX,K+=F.height*G.properties.anchorY),w.x=J,w.y=K,a(w,F.rotation),G.x=F.x+w.x,G.y=F.y+w.y}else if(F.polyline)for(G.properties=F.properties,G.polyline=[],H=0;H<F.polyline.length;++H)w.x=F.polyline[H].x,w.y=F.polyline[H].y,a(w,F.rotation),G.polyline.push({x:F.x+w.x,y:F.y+w.y});else if(F.ellipse)G.properties=F.properties,G.rotation=F.rotation,w.x=F.width/2,w.y=F.height/2,a(w,F.rotation),G.ellipse=new PIXI.Ellipse(F.x+w.x,F.y+w.y,F.width,F.height);else if(F.polygon)for(G.properties=F.properties,G.polygon=[],H=0;H<F.polyline.length;++H)w.x=F.polyline[H].x,w.y=F.polyline[H].y,a(w,F.rotation),G.polygon.push({x:F.x+w.x,y:F.y+w.y});else F.rect?(G.properties=F.properties,G.rotation=F.rotation,G.rect=new PIXI.Rectangle(F.x||F.rect.x,F.y||F.rect.y,F.width||F.rect.width,F.height||F.rect.height)):(G.properties=F.properties,G.rotation=F.rotation,G.rect=new PIXI.Rectangle(F.x,F.y,F.width,F.height))}}}return n};var f=Math.PI/180;namespace("springroll").TiledParser=b}(),function(){var a=include("collision.Polygon");a.prototype.setSeparateScale=function(a,b){var c,d,e,f,g,h=this.points,i=this.edges;for(c=0,d=h.length;d>c;++c){e=h[c];var j=e.x*a,k=e.y*b;e.x=j,e.y=k,f&&(g=i[c-1],g.x=j-f.x,g.y=k-f.y),f=e}e=h[0],g=i[c-1],g.x=e.x-f.x,g.y=e.y-f.y,this.aabbIsDirty=!0}}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("springroll.RandomList"),f=function(f){a.call(this);var g=0;this.canvasFallback=!1;var h=b.instance.display;h.isWebGL||(this.canvasFallback=!0,this.fallbackCanvas=document.createElement("canvas"),this.fallbackContext=this.fallbackCanvas.getContext("2d"),this.fallbackTex=d.fromCanvas(this.fallbackCanvas),this.fallbackTex.noFrame=!0,this.fallbackSprite=new c(this.fallbackTex),this.addChild(this.fallbackSprite));this.parallax=b.instance.config.camera.parallax,f*=this.parallax,f+=1280,this.tiles=[];for(var i,j,k,l,m,n,o,p,q=new e(b.instance.config.levelBG),r=0,s=0,t=0,u=0;f>r;){for(i=q.random(),j=i.images,k=0,o=0;o<j.length;++o){for(l=j[o],p=0;p<l.length;++p)m=d.fromFrame(l[p].id),n=new c(m),1>o&&(k+=m.width+g),1>p&&1>r&&(s+=m.height+g),n.tileLeft=n.x=t,n.tileTop=n.y=u,n.tileRight=n.tileLeft+m.width,n.tileBottom=n.tileTop+m.height,t+=m.width+g,this.tiles.push(n),this.canvasFallback||this.addChild(n);t=r,u+=m.height+g}r+=k,t=r,u=0}this.totalWidth=r,this.totalHeight=s,q.destroy()},g=extend(f,a),h=a.prototype;g.updateVisibility=function(a){var b,c,d=-this.position.x,e=-this.position.y,f=d+a.width,g=e+a.height,h=this.tiles;if(this.canvasFallback){var i=Math.floor(d),j=Math.floor(e),k=Math.ceil(f),l=Math.ceil(g),m=this.fallbackSprite.position;m.x=i,m.y=j;var n=k-i,o=l-j,p=this.fallbackCanvas;if(p.width!=n||p.height!=o){p.width=n,p.height=o;var q=this.fallbackTex;q.baseTexture.update(),q.width=q._frame.width,q.height=q._frame.height}var r=1/h[0].texture.baseTexture.resolution,s=this.fallbackContext;for(b=h.length-1;b>=0;--b)if(c=h[b],c.tileLeft<=k&&i<=c.tileRight&&c.tileTop<=l&&j<=c.tileBottom){var t=c.texture,u=t.crop,v=t.trim,w=v?v.x:0,x=v?v.y:0,y=t.baseTexture.source;s.drawImage(y,u.x,u.y,u.width,u.height,c.tileLeft-i+w*r-.5,c.tileTop-j+x*r-.5,u.width*r+1,u.height*r+1)}}else for(b=h.length-1;b>=0;--b)c=h[b],c.visible=c.tileLeft<=f&&d<=c.tileRight&&c.tileTop<=g&&e<=c.tileBottom},g.destroy=function(){h.destroy.call(this),this.fallbackCanvas&&(this.fallbackSprite.destroy(),this.fallbackTex.destroy(!0),this.fallbackTex=this.fallbackSprite=this.fallbackCanvas=this.fallbackContext=null);for(var a=this.tiles,b=a.length-1;b>=0;--b)a[b].destroy();this.tiles=null},namespace("nature").Background=f}(),function(){var a=include("PIXI.Container"),b=include("PIXI.Sprite"),c=include("PIXI.Texture"),d=function(d){a.call(this),this.fallbackCanvas=document.createElement("canvas"),this.fallbackContext=this.fallbackCanvas.getContext("2d"),this.fallbackTex=c.fromCanvas(this.fallbackCanvas),this.fallbackTex.noFrame=!0,this.fallbackSprite=new b(this.fallbackTex),this.addChild(this.fallbackSprite),this.tiles=[]},e=extend(d,a),f=a.prototype;e.updateVisibility=function(a){var b,c,d=a.x,e=a.y,f=d+a.width,g=e+a.height,h=this.tiles,i=Math.floor(d),j=Math.floor(e),k=Math.ceil(f),l=Math.ceil(g),m=this.fallbackSprite.position;m.x=i,m.y=j;var n=this.fallbackContext,o=k-i,p=l-j,q=this.fallbackCanvas;if(q.width!=o||q.height!=p){q.width=o,q.height=p;var r=this.fallbackTex;r.baseTexture.update(),r.width=r._frame.width,r.height=r._frame.height}else n.clearRect(0,0,o,p);var s=h[0].texture.baseTexture.source,t=1/h[0].texture.baseTexture.resolution;for(b=h.length-1;b>=0;--b)if(c=h[b],c.tileLeft<=k&&i<=c.tileRight&&c.tileTop<=l&&j<=c.tileBottom){var u=c.texture,v=u.crop,w=u.trim,x=w?w.x:0,y=w?w.y:0;n.drawImage(s,v.x,v.y,v.width,v.height,c.tileLeft-i+x*t,c.tileTop-j+y*t,v.width*t,v.height*t)}},e.destroy=function(){f.destroy.call(this),this.fallbackSprite.destroy(),this.fallbackTex.destroy(!0),this.fallbackTex=this.fallbackSprite=this.fallbackCanvas=this.fallbackContext=null;for(var a=this.tiles,b=a.length-1;b>=0;--b)a[b].destroy();this.tiles=null},namespace("nature").FallbackTileLayer=d}(),function(){function a(a){return new g(a,a.crop)}var b=include("PIXI.Container"),c=include("springroll.Application"),d=include("PIXI.Sprite"),e=include("collision.Polygon"),f=include("createjs.Tween"),g=include("PIXI.Texture"),h=include("springroll.TweenHelper"),i=function(f){b.call(this),this.app=c.instance;var g=this.app.config.objects[f.properties.id];this.type=f.properties.id;var i=this.app.getCache(g.atlasId);this.art=new d(a(i.getFrame(g.artId))),this.art.anchor.x=f.properties.anchorX,this.art.anchor.y=f.properties.anchorY,this.addChild(this.art),f.properties.shadowed&&(this.shadow=new d(a(i.getFrame(g.shadowId))),this.shadow.anchor.x=this.shadow.anchor.y=.5,this.shadow.position.x=g.shadowPos.x,this.shadow.position.y=g.shadowPos.y,this.addChildAt(this.shadow,0)),this.position.x=f.x,this.position.y=f.y,f.flippedVertically&&(this.scale.y=-1),f.flippedHorizontally&&(this.scale.x=-1);var j={x:0,y:0,r:g.collisionRadius};this.collision=e.fromCircle(j),this.collision.updateOrigin(this.position.x,this.position.y),g.floatTween&&(this.floatTween=h.build(this.art,g.floatTween),this.floatTween.loop=!0,this.floatTween.setPaused(!0)),this.onRespawnDone=this.onRespawnDone.bind(this)},j=extend(i,b),k=b.prototype;j.onCollision=function(a){a.collectItem(this),a.onGround?a.level.removeObject(this):(this.pause(),this.visible=!1,this._collision=this.collision,this.collision=null)},j.restore=function(){this.collision=this._collision,this.visible=!0,this.respawnTween=f.get(this).wait(200).to({visible:!1},200).to({visible:!0},200).to({visible:!1},200).to({visible:!0},200).to({visible:!1},200).to({visible:!0},200).call(this.onRespawnDone),this.unpause()},j.onRespawnDone=function(){this.respawnTween=null},j.start=function(){this.floatTween&&this.floatTween.setPaused(!1)},j.pause=function(){this.respawnTween&&this.respawnTween.setPaused(!0),this.floatTween&&this.floatTween.setPaused(!0)},j.unpause=function(){this.respawnTween&&this.respawnTween.setPaused(!1),this.floatTween&&this.floatTween.setPaused(!1)},j.destroy=function(){f.removeTweens(this),f.removeTweens(this.art),k.destroy.call(this),this.shadow&&this.shadow.destroy(!0),this.art.destroy(!0),this.collision=this.app=this.shadow=this.art=this._collision=this.respawnTween=this.floatTween=null},namespace("nature").Collectible=i}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("PIXI.Point"),f=function(f){this.app=b.instance;var g=this.app.config.objects.pulleyRope;a.call(this);var h=d.fromFrame(g.artId);this.left=new c(h),this.top=new c(h),this.right=new c(h),this.left.anchor.y=this.top.anchor.y=this.right.anchor.y=.5,this.addChild(this.left),this.addChild(this.top),this.addChild(this.right),this.origRopeLength=h.width;var i,j=1e7,k=1e7,l=f.polyline;for(i=0;i<l.length;++i)l[i].y<j&&(j=l[i].y),l[i].x<k&&(k=l[i].x);for(this.x=k,this.y=j,this.ropePoints=[],i=0;i<l.length;++i)this.ropePoints.push(new e(l[i].x-k,l[i].y-j));this.ropePoints[0].x>this.ropePoints[3].x&&this.ropePoints.reverse(),this.right.rotation=this.left.rotation=Math.PI/2,this.left.x=this.top.x=this.ropePoints[1].x,this.left.y=this.top.y=this.ropePoints[1].y,this.right.x=this.ropePoints[2].x,this.right.y=this.ropePoints[2].y,this.top.scale.x=(this.ropePoints[2].x-this.ropePoints[1].x)/this.origRopeLength,this.updateRope()},g=extend(f,a),h=a.prototype;g.updateEndPoints=function(a,b){a.x<b.x?(this.ropePoints[0].y=a.y-this.y,this.ropePoints[3].y=b.y-this.y):(this.ropePoints[0].y=b.y-this.y,this.ropePoints[3].y=a.y-this.y),this.updateRope()},g.updateRope=function(){this.left.scale.x=(this.ropePoints[0].y-this.ropePoints[1].y)/this.origRopeLength,this.right.scale.x=(this.ropePoints[3].y-this.ropePoints[2].y)/this.origRopeLength},g.destroy=function(){h.destroy.call(this),this.left.destroy(),this.top.destroy(),this.right.destroy(),this.app=this.left=this.top=this.right=this.ropePoints=null},namespace("nature").PulleyRope=f}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("createjs.Tween"),f=include("PIXI.Point"),g=function(e,g){a.call(this),this.level=e,this.app=b.instance;var h=this.objData=this.app.config.objects[g.properties.id];this.type="platform",g.properties.ropeId?(this.isPulley=!0,this.ropeObj=g.properties.ropeId,this.otherPlatform=g.properties.otherPlatformId,this.maxY=parseFloat(g.properties.sinkHeight)):(this.pathId=g.properties.pathId,this.distSq=h.triggerDist*h.triggerDist,this.turnWaitTime=h.turnWaitTime/1e3,this.waitTimer=0,this.splashScale=h.splashScale,this.splashOffset=h.splashOffset,this.onArriveAtPath=this.onArriveAtPath.bind(this),this.moveToPath=this.moveToPath.bind(this));var i=this.app.getCache(h.artId)||d.fromFrame(h.artId,!0);if(i instanceof d)this.art=new c(i),g.properties.anchorX&&(this.art.anchor.x=g.properties.anchorX),g.properties.anchorY&&(this.art.anchor.y=g.properties.anchorY),this.art.width=g.width,this.art.height=g.height;else{this.art=new pixiflash_lib[h.artId];var j=h.artScale;this.art.scale.x=this.art.scale.y=j,this.art.framerate=h.artFramerate,this.art.stop()}this.addChild(this.art),this.position.x=g.x||g.rect.x,this.position.y=g.y||g.rect.y,g.flippedVertically&&(this.scale.y=-1),g.flippedHorizontally&&(this.scale.x=-1),this.origFloor=h.floor,this.floor=[new f,new f],this.floor.type="platform",g.properties.type&&(this.floor.type+="-"+g.properties.type),this.floor.owner=this,h.walls&&(this.origWallLeft=h.walls.left,this.origWallRight=h.walls.right,this.wallLeft=[new f,new f],this.wallRight=[new f,new f],this.wallLeft.type="platform",this.wallLeft.owner=this,this.wallRight.type="platform",this.wallRight.owner=this),this.updateCollision(),this.ridingPlayer=null,this.ridingBlock=null,this.vineAudio=null},h=extend(g,a),i=a.prototype;h.init=function(){if(this.isPulley)this.minY=this.y,this.maxY+=this.y,this.ropeObj=this.level.objectsById[this.ropeObj],this.otherPlatform=this.level.objectsById[this.otherPlatform],this.mode="idle",this.enableCollision();else{var a=this.level.objectsById[this.pathId].polyline.slice();this.mode="waiting",this.movePath=[],this.movePath.unshift(a.pop()),this.movePath.unshift(a.pop()),a.push(this.movePath[0]),this.readyPath=a}},h.start=function(){this.isPulley||(this.animTimeline=this.app.animator.play(this.art,"idle"))},h.moveToPath=function(){this.animTimeline=this.app.animator.play(this.art,"walk"),moveSpeed=this.objData.moveToPathTweenSpeed;for(var a,b=e.get(this),c=!1,d=0;d<this.readyPath.length;++d){d&&Math.abs(a.y-this.readyPath[d].y)>10&&!c&&(c=!0,b=b.call(function(){this.animTimeline=this.app.animator.play(this.art,["jump","swim"])}.bind(this)));var f=Math.dist(this.readyPath[d],1>d?this.position:this.readyPath[d-1]);b=b.to({x:this.readyPath[d].x,y:this.readyPath[d].y},f/moveSpeed*1e3),a=this.readyPath[d]}b.call(this.onArriveAtPath),this.tween=b},h.onArriveAtPath=function(){this.tween=null,this.enableCollision(),this.mode="waitingForPlayer",this.movePath[1].x>this.movePath[0].x?(this.moveDir=1,this.maxX=this.movePath[1].x,this.minX=this.movePath[0].x):(this.moveDir=-1,this.maxX=this.movePath[0].x,this.minX=this.movePath[1].x,this.scale.x*=-1),this.level.createEffect("Splash",this.position.x+this.splashOffset.x*this.scale.x,this.position.y+this.splashOffset.y*this.scale.y,this.splashScale,this.splashScale),this.app.sound.play("WaterSplash")},h.enableCollision=function(){this.level.ground.push(this.floor)},h.enableWalls=function(){this.level.walls.indexOf(this.wallLeft)>-1||(this.level.walls.push(this.wallLeft),this.level.walls.push(this.wallRight))},h.disableWalls=function(){var a=this.level.walls.indexOf(this.wallLeft);a>-1&&this.level.walls.splice(a,1),a=this.level.walls.indexOf(this.wallRight),a>-1&&this.level.walls.splice(a,1)},h.onCollision=function(a){this.ridingPlayer=a,a.onPlatform=this,this.isPulley?this.otherPlatform.ridingBlock||(this.mode="sinking"):"waitingForPlayer"==this.mode&&(this.enableWalls(),this.mode="moving",this.waitTimer=.5)},h.addBlock=function(a){this.ridingBlock=a,this.isPulley&&(this.mode="sinking","sinking"==this.otherPlatform.mode&&(this.otherPlatform.mode="idle"))},h.onPlayerLeft=function(){this.ridingPlayer=null,this.isPulley?this.ridingBlock||this.otherPlatform.ridingBlock||(this.mode="rising"):(this.disableWalls(),"waitingForDismount"==this.mode&&(this.mode="waitingForPlayer"))},h.update=function(a){var b,c=0,d=0;if(this.isPulley)"idle"!=this.mode&&("sinking"==this.mode?(b=this.objData.sinkSpeed,this.ridingBlock&&(b*=this.ridingBlock.objData.platformMultiplier),this.otherPlatform.ridingPlayer&&(b-=this.objData.sinkSpeed)):"rising"==this.mode&&(b=-this.objData.riseSpeed),d=b*a,"sinking"==this.mode&&this.y+d>this.maxY?(d=this.maxY-this.y,this.mode="idle"):"rising"==this.mode&&this.y+d<this.minY&&(d=this.y-this.minY,this.mode="idle"),"idle"!=this.mode?this.vineAudio||(this.vineAudio=this.app.sound.play("VinesOnPully",{loop:!0})):this.vineAudio&&(this.vineAudio.stop(),this.vineAudio=null),this.otherPlatform&&(this.otherPlatform.y-=d));else{if("waiting"==this.mode)Math.distSq(this.level.player.position,this.position)<=this.distSq&&(this.mode="moveToPath",this.animTimeline=this.app.animator.play(this.art,"interaction",this.moveToPath));else if(!this.tween&&!this.ridingPlayer&&this.level.player.onGround){var e=this.level.player.position;e.x<this.minX?this.x-this.minX>3&&(1==this.moveDir&&(this.moveDir*=-1,this.scale.x*=-1),this.mode="moving"):e.x>this.maxX&&this.maxX-this.x>3&&(-1==this.moveDir&&(this.moveDir*=-1,this.scale.x*=-1),this.mode="moving")}this.waitTimer>0?this.waitTimer-=a:"moving"==this.mode&&(b=this.objData.pathSpeed,c=b*this.moveDir*a,this.x+c>this.maxX?(c=this.maxX-this.x,this.moveDir*=-1,this.scale.x*=-1,this.ridingPlayer?this.mode="waitingForDismount":this.mode="waitingForPlayer",this.disableWalls()):this.x+c<this.minX&&(c=this.minX-this.x,this.moveDir*=-1,this.scale.x*=-1,this.ridingPlayer?this.mode="waitingForDismount":this.mode="waitingForPlayer",this.disableWalls()))}this.ridingPlayer&&(this.ridingPlayer.x+=c,this.ridingPlayer.y+=d,this.ridingPlayer.collisionDirty=!0),this.ridingBlock&&(this.ridingBlock.x+=c,this.ridingBlock.y+=d,this.ridingBlock.updateCollision()),this.x+=c,this.y+=d,this.updateCollision(),"idle"!=this.mode&&this.ropeObj&&this.ropeObj.updateEndPoints(this,this.otherPlatform)},h.updateCollision=function(){var a=this.position,b=this.scale.x*this.art.scale.x,c=this.scale.y*this.art.scale.y,d=this.floor[0],e=this.origFloor[0];d.x=a.x+e.x*b,d.y=a.y+e.y*c,d=this.floor[1],e=this.origFloor[1],d.x=a.x+e.x*b,d.y=a.y+e.y*c,this.wallLeft&&(d=this.wallLeft[0],e=this.origWallLeft[0],d.x=a.x+e.x*b,d.y=a.y+e.y*c,d=this.wallLeft[1],e=this.origWallLeft[1],d.x=a.x+e.x*b,d.y=a.y+e.y*c,d=this.wallRight[0],e=this.origWallRight[0],d.x=a.x+e.x*b,d.y=a.y+e.y*c,d=this.wallRight[1],e=this.origWallRight[1],d.x=a.x+e.x*b,d.y=a.y+e.y*c)},h.pause=function(){this.animTimeline&&(this.animTimeline.paused=!0),this.tween&&this.tween.setPaused(!0)},h.unpause=function(){this.animTimeline&&(this.animTimeline.paused=!1),this.tween&&this.tween.setPaused(!1)},h.destroy=function(){this.animTimeline&&this.app.animator.stop(this.art),this.tween&&e.removeTweens(this),this.art.destroy(),this.collision=this.art=this.app=this.animTimeline=this.tween=this.floor=this.wallLeft=this.wallRight=this.origFloor=this.origWallLeft=this.origWallRight=this.ridingBlock=this.ridingPlayer=this.ropeObj=this.otherPlatform=null,i.destroy.call(this)},namespace("nature").Platform=g}(),function(){var a=include("springroll.Application"),b=include("PIXI.Sprite"),c=include("PIXI.Texture"),d=include("collision.Polygon"),e=function(e){this.app=a.instance;var f=this.app.config.objects[e.properties.id];this.type="thorn",b.call(this,this.app.getCache(f.artId)||c.fromImage(f.artId)),this.position.x=e.x,this.position.y=e.y,this.width=e.width,this.height=e.height,e.flippedVertically&&(this.scale.y*=-1,this.pivot.y=e.height),e.flippedHorizontally&&(this.scale.x*=-1,this.pivot.x=e.width),this.anchor.x=e.properties.anchorX||0,this.anchor.y=e.properties.anchorY||0,this.collision=d.fromRect(f.collision),this.collision.setSeparateScale(this.scale.x,this.scale.y),this.collision.updateOrigin(this.position.x-this.pivot.x,this.position.y-this.pivot.y)},f=extend(e,b),g=b.prototype;f.onCollision=function(a){var b=this.x+this.texture.width/2*this.scale.x,c=!1;a.x>b&&a.velocity.x<0?c=!0:a.x<b&&a.velocity.x>0&&(c=!0),c&&a.bounceFromThorns()},f.destroy=function(){this.collision=this.app=null,g.destroy.call(this)},namespace("nature").Thorns=e}(),function(){function a(a,b,c,d){return d||(d=new f),d.x=(b.x-a.x)*c+a.x,d.y=(b.y-a.y)*c+a.y,d}var b=include("PIXI.Container"),c=include("PIXI.mesh.Rope"),d=include("springroll.Application"),e=include("PIXI.Texture"),f=include("PIXI.Point"),g=include("PIXI.Graphics"),h=function(h,i){b.call(this),this.level=h,this.app=d.instance;var j=this.app.config.objects.swingRope;this.needsCut="true"==i.properties.needsCut;var k,l=e.fromFrame(j.artId),m=i.polyline,n=this.points=[],o=new f(0,0),p=new f(m[m.length-1].x-m[0].x,m[m.length-1].y-m[0].y);for(this.ropeLength=0,k=1;k<m.length;++k)this.ropeLength+=Math.dist(m[k-1],m[k]);var q=Math.floor(this.ropeLength/j.lengthPerPoint);for(k=0;q>k;++k){var r=a(o,p,k/(q-1));r.isAnchor=1>k,r.velX=r.velY=0,r.oldX=r.x,this.needsCut||(r.y*=j.ropeStretch),r.oldY=r.y,n.push(r)}if(this.isGraphics=!this.app.display.isWebGL,this.isGraphics?(this.fallbackColor=parseInt(j.fallbackColor,16),this.fallbackWidth=j.fallbackWidth,this.art=new g):this.art=new c(l,n),this.addChild(this.art),this.x=m[0].x,this.y=m[0].y,this.segmentLength=this.ropeLength/(q-1),this.gravityAccel=j.gravityAccel,this.dampening=j.dampening,this.minVel=j.minVel,this.maxVel=j.maxVel,this.minGrabPoint=j.minGrabPoint,this.ropeStretch=j.ropeStretch,this.maxDist=j.maxDist,this.maxDistSq=this.maxDist*this.maxDist,this.maxOrthDist=this.maxDist/Math.sqrt(2),this.vineCooldown=0,this.isAwake=!0,this.needsCut){var s=n[q-1];s.isGrabbed=!0;var t=s.y/(s.x*s.x);for(k=1;k<n.length-1;++k){var u=(n.length-k)/n.length*s.x;n[k].oldX=n[k].x=s.x-u,n[k].oldY=n[k].y=s.y-t*u*u}this.isAwake=!1}else this.needsCut=!1;if(this.isGraphics)for(this.art.clear(),this.art.lineStyle(this.fallbackWidth,this.fallbackColor),this.art.moveTo(n[0].x,n[0].y),this.art.currentPath.shape.closed=!1,k=0;k<n.length;++k)this.art.lineTo(n[k].x,n[k].y)},i=extend(h,b),j=b.prototype,k=.01,l=new f;i.update=function(a){if(this.vineCooldown>0&&(this.vineCooldown-=a),!(k>a)&&this.isAwake){var b,c,d,e=this.points,f=e.length,g=this.maxOrthDist;for(b=1;f>b;++b)c=e[b],c.isGrabbed||(c.velY+=this.gravityAccel*a,c.x+=c.velX*a,c.y+=c.velY*a,d=e[b-1],c.x-d.x>g?c.x=d.x+g:c.x-d.x<-g&&(c.x=d.x-g),c.y-d.y>g?c.y=d.y+g:c.y-d.y<-g&&(c.y=d.y-g));for(b=1;f>b;++b){d=e[b-1],c=e[b];var h=c.distance(d);h>0&&(l.x=c.x-d.x,l.y=c.y-d.y,l.scaleBy(this.segmentLength/h-1),d.isAnchor||d.isGrabbed?(c.x+=.8*l.x,c.y+=.8*l.y):c.isGrabbed?(d.x-=.8*l.x,d.y-=.8*l.y):(d.x-=.5*l.x,d.y-=.5*l.y,c.x+=.5*l.x,c.y+=.5*l.y))}var i=this.dampening,j=this.minVel,m=this.maxVel,n=!0;for(b=1;f>b;++b)c=e[b],c.velX=Math.clamp((c.x-c.oldX)/a*i,-m,m),c.velY=Math.clamp((c.y-c.oldY)/a*i,-m,m),c.oldX=c.x,c.oldY=c.y,(c.velX>j||c.velX<-j||c.velY>j||c.velY<-j)&&(n=!1);if(this.isAwake&&this.isGraphics)for(this.art.clear(),this.art.lineStyle(this.fallbackWidth,this.fallbackColor),this.art.moveTo(e[0].x,e[0].y),this.art.currentPath.shape.closed=!1,b=0;b<e.length;++b)this.art.lineTo(e[b].x,e[b].y);n&&(this.isAwake=!1)}},i.testCollision=function(a){if(this.needsCut)return!1;for(var b=this.points,c=this.position.x,d=this.position.y,e=b.length-1;e>0;--e)if(a.contains(c+b[e].x,d+b[e].y))return e<this.minGrabPoint?this.minGrabPoint:e;return!1},i.startSwing=function(a,b){var c=this.points[a];return c.isGrabbed=!0,this.swingIndex=a,this.isAwake=!0,b.x=c.x,b.y=c.y,a*this.segmentLength*this.ropeStretch},i.stopSwing=function(){this.points[this.swingIndex].isGrabbed=!1},i.cut=function(){this.needsCut=!1,this.isAwake=!0,this.points[this.points.length-1].isGrabbed=!1},i.destroy=function(){this.removeChild(this.art),this.art.destroy(),this.art=this.app=this.level=null,j.destroy.call(this)},namespace("nature").SwingingRope=h}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=function(c,d){a.call(this),this.emitEnd=this.emitEnd.bind(this),this.app=b.instance,this.anim=new(include(c.character)),this.anim.framerate=30,this.anim.stop(),"number"==typeof c.characterScale?this.anim.scale.x=this.anim.scale.y=c.characterScale:(this.anim.scale.x=c.characterScale.x,this.anim.scale.y=c.characterScale.y),this.addChild(this.anim),this.level=d,this.targetItem=c.object,this.targetCount=c.number,this.distSq=c.triggerDist*c.triggerDist,this.moreItemsAnim=c.moreItemsAnim,this.successAnim=c.successAnim},d=extend(c,a),e=a.prototype;d.start=function(){this.animTimeline=this.app.animator.play(this.anim,"idleGame"),this.playerInRange=!1,this.satisfied=!1},d.update=function(a){if(!this.satisfied&&"idleGame"==this.animTimeline.instance.currentName){var b=Math.distSq(this.level.player.position,this.position)<=this.distSq;if(!this.playerInRange&&b){var c=this.level.player.collectionPanel.itemsFound;c==this.targetCount?(this.animTimeline=this.app.animator.play(this.anim,this.successAnim,this.emitEnd),this.satisfied=!0,this.level.player.disableWhenSafe()):c>0&&(this.animTimeline=this.app.animator.play(this.anim,[this.moreItemsAnim,"idleGame"]))}this.playerInRange=b}},d.emitEnd=function(){this.emit("levelComplete")},d.stop=function(){this.app.animator.stop(this.anim),this.animTimeline=null},d.pause=function(){this.animTimeline.paused=!0},d.unpause=function(){this.animTimeline.paused=!1},d.destroy=function(){this.stop(),e.destroy.call(this),this.anim.destroy(),this.emitEnd=this.app=this.anim=this.level=null},namespace("nature").Character=c}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("PIXI.Point"),f=include("collision.CollisionUtils"),g=function(f,g){a.call(this),this.level=f,this.app=b.instance;var h=this.objData=this.app.config.objects[g.properties.id],i=this.app.getCache(h.artId)||d.fromFrame(h.artId,!0);this.art=new c(i),g.properties.anchorX&&(this.art.anchor.x=g.properties.anchorX),g.properties.anchorY&&(this.art.anchor.y=g.properties.anchorY),this.addChild(this.art),this.position.x=g.x||g.rect.x,this.position.y=g.y||g.rect.y,g.flippedVertically&&(this.scale.y=-1),g.flippedHorizontally&&(this.scale.x=-1),this.dropX=g.properties.dropX?parseInt(g.properties.dropX):null,this.splashScale=h.splashScale,this.splashOffset=h.splashOffset,this.velocity=new e,this.acceleration=new e,this.pushSpeed=h.maxPushSpeed,this.moveRotation=(h.rotationPerPx||0)*Math.PI/180,this.pushAudio=h.pushAudio,this.origFloor=h.floor,this.floor=[new e,new e],this.floor.type="block",this.floor.owner=this,this.origWallLeft=h.walls.left,this.origWallRight=h.walls.right,this.wallLeft=[new e,new e],this.wallRight=[new e,new e],this.wallLeft.type="block",this.wallLeft.owner=this,this.wallRight.type="block",this.wallRight.owner=this,this.onGround=!1,this.onPlatform=null,this.groundType=null,this.isDropping=!1},h=extend(g,a),j=a.prototype;h.init=function(){this.enableCollision(),this.updateCollision()},h.enableCollision=function(){this.level.ground.push(this.floor),this.level.walls.push(this.wallLeft),this.level.walls.push(this.wallRight)};var k=new e;h.update=function(a){var b,c,d,e,g,h,i,j,l,m,n,o=this.objData,p=this.acceleration,q=this.velocity,r=this.position;if(p.y=o.gravityAccel,this.onGround?p.y-=o.gravityAccel:this.isDropping&&this.dropX&&(r.x<this.dropX?(r.x+=this.objData.maxPushSpeed*a,r.x>this.dropX&&(r.x=this.dropX),this.updateCollision()):r.x>this.dropX&&(r.x-=this.objData.maxPushSpeed*a,r.x<this.dropX&&(r.x=this.dropX),this.updateCollision())),q.y+=p.y*a,q.y=Math.min(q.y,o.maxYVelocity),q.y>=0){b=this.wallLeft[0].x,c=this.wallRight[0].x,d=r.y+this.objData.collisionYStart,e=this.wallRight[1].y+(q.y>0?q.y*a:5);var s=this.level.ground;for(i=null,g=s.length-1;g>=0;--g)if(j=s[g],j!=this.floor)for(h=0;h<j.length-1;++h)if(l=j[h],m=j[h+1],f.getLineIntersection(b,d,b,e,l.x,l.y,m.x,m.y,k,this.isDropping)||f.getLineIntersection(c,d,c,e,l.x,l.y,m.x,m.y,k,this.isDropping))if("ground"==j.type||"platform-thorn"==j.type||"platform"==j.type){if(i=j,n=k.y,this.groundType||(this.groundType=i.type),0===q.y){g=-1;break}}else"water"==j.type&&(this.groundType="water");i?(r.y=n-this.origWallRight[1].y*this.scale.y,q.y>0&&(this.updateCollision(),q.y=0),("platform"==i.type||"platform-thorn"==i.type)&&(this.onPlatform=i.owner,i.owner.addBlock(this)),this.onGround=!0,this.isDropping&&(this.isDropping=!1,this.app.sound.play("water"==this.groundType?"WaterSplash":"BoulderLanding"),"water"==this.groundType&&this.level.createEffect("Splash",this.position.x+this.splashOffset.x*this.scale.x,this.position.y+this.splashOffset.y*this.scale.y,this.splashScale,this.splashScale))):(this.onGround&&(this.isDropping=!0,this.groundType=null),this.onPlatform&&(this.onPlatform.ridingBlock=null,this.onPlatform=null),this.onGround=!1,r.y+=q.y*a,this.updateCollision())}},h.updateCollision=function(){var a=this.position,b=this.scale,c=this.floor[0],d=this.origFloor[0];c.x=a.x+d.x*b.x,c.y=a.y+d.y*b.y,c=this.floor[1],d=this.origFloor[1],c.x=a.x+d.x*b.x,c.y=a.y+d.y*b.y,c=this.wallLeft[0],d=this.origWallLeft[0],c.x=a.x+d.x*b.x,c.y=a.y+d.y*b.y,c=this.wallLeft[1],d=this.origWallLeft[1],c.x=a.x+d.x*b.x,c.y=a.y+d.y*b.y,c=this.wallRight[0],d=this.origWallRight[0],c.x=a.x+d.x*b.x,c.y=a.y+d.y*b.y,c=this.wallRight[1],d=this.origWallRight[1],c.x=a.x+d.x*b.x,c.y=a.y+d.y*b.y},h.push=function(a){if(this.onPlatform)return 0;var b=this.position,c=b.x;if(0!==a){x=b.x,a>0?x2=b.x+a+this.origWallRight[0].x*this.scale.x:x2=b.x+a+this.origWallLeft[0].x*this.scale.x,y=this.wallLeft[1].y-3;var d=this.level.walls;for(found=!1,i=d.length-1;i>=0;--i)if(polyLine=d[i],polyLine!=this.wallLeft&&polyLine!=this.wallRight)for(h=0;h<polyLine.length-1;++h)if(point1=polyLine[h],point2=polyLine[h+1],f.getLineIntersection(x,y,x2,y,point1.x,point1.y,point2.x,point2.y,k)){found=polyLine,i=-1;break}found?a>0?b.x=k.x-this.origWallRight[0].x*this.scale.x:b.x=k.x-this.origWallLeft[0].x*this.scale.x:b.x+=a}var e=b.x-c;return e&&this.updateCollision(),this.rotation+=this.moveRotation*e,e},h.destroy=function(){this.art.destroy(),this.art=this.app=this.level=this.velocity=this.acceleration=this.origWallLeft=this.origFloor=this.origWallRight=this.onPlatform=this.floor=this.wallLeft=this.wallRight=null,j.destroy.call(this)},namespace("nature").MovingBlock=g}(),function(){var a=include("springroll.Application"),b=include("PIXI.Sprite"),c=include("PIXI.Texture"),d=include("PIXI.Point"),e=function(e,f){this.app=a.instance;var g=this.app.config.objects[f.properties.id];b.call(this,this.app.getCache(g.artId)||c.fromImage(g.artId)),this.position.x=f.x,this.position.y=f.y,f.flippedVertically&&(this.scale.y=-1),f.flippedHorizontally&&(this.scale.x=-1),this.anchor.x=f.properties.anchorX||0,this.anchor.y=f.properties.anchorY||0,this.origWallLeft=g.walls.left,this.origWallRight=g.walls.right,this.wallLeft=[new d,new d],this.wallRight=[new d,new d],this.wallLeft.type="noPlayer",this.wallLeft.owner=this,this.wallRight.type="noPlayer",this.wallRight.owner=this,this.updateCollision(),e.walls.push(this.wallLeft),e.walls.push(this.wallRight)},f=extend(e,b),g=b.prototype;f.updateCollision=function(){var a=this.position,b=this.scale;point=this.wallLeft[0],localPoint=this.origWallLeft[0],point.x=a.x+localPoint.x*b.x,point.y=a.y+localPoint.y*b.y,point=this.wallLeft[1],localPoint=this.origWallLeft[1],point.x=a.x+localPoint.x*b.x,point.y=a.y+localPoint.y*b.y,point=this.wallRight[0],localPoint=this.origWallRight[0],point.x=a.x+localPoint.x*b.x,point.y=a.y+localPoint.y*b.y,point=this.wallRight[1],localPoint=this.origWallRight[1],point.x=a.x+localPoint.x*b.x,point.y=a.y+localPoint.y*b.y},f.destroy=function(){this.wallLeft=this.wallRight=this.origWallLeft=this.origWallRight=null,g.destroy.call(this)},namespace("nature").PushBlocker=e}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("createjs.Tween"),d=function(c,d){a.call(this),this.level=c,this.app=b.instance;var e=this.objData=this.app.config.objects[d.properties.id||"bird"];this.vinesToCut=d.properties.vinesToCut.split(","),this.distSq=e.triggerDist*e.triggerDist,this.cutDistSq=e.cutDist*e.cutDist,this.onArriveAtPath=this.onArriveAtPath.bind(this),this.art=new pixiflash_lib[e.artId],this.art.gotoAndStop(0),this.addChild(this.art),this.art.scale.x=this.art.scale.y=e.artScale,this.art.framerate=e.artFramerate,this.art.stop(),this.path=d.polyline.slice();var f=this.path.shift();this.position.x=f.x,this.position.y=f.y,d.flippedVertically&&(this.scale.y=-1),d.flippedHorizontally&&(this.scale.x=-1),this.isFlying=!1},e=extend(d,a),f=a.prototype;e.init=function(){for(var a=0;a<this.vinesToCut.length;++a)this.vinesToCut[a]=this.level.objectsById[this.vinesToCut[a]]},e.start=function(){this.animTimeline=this.app.animator.play(this.art,"idle")},e.onArriveAtPath=function(){this.app.animator.stop(this.art),this.animTimeline=null,this.tween=null,this.level.removeObject(this)},e.update=function(a){var b,d=this.position;if(this.isFlying)for(b=0;b<this.vinesToCut.length;++b){
var e=this.vinesToCut[b];if(e.needsCut){var f=e.points.last();Math.distSq(d,e.x+f.x,e.y+f.y)<=this.cutDistSq&&(e.cut(),this.app.sound.isPlaying("VineCutSwinging")||this.app.sound.play("VineCutSwinging"))}}else if(Math.distSq(this.level.player.position,d)<=this.distSq){this.isFlying=!0,moveSpeed=this.objData.pathSpeed;var g=this.tween=c.get(this),h=this.path;for(b=0;b<h.length;++b){var i=Math.dist(h[b],1>b?d:h[b-1]);g=g.to({x:h[b].x,y:h[b].y},i/moveSpeed*1e3)}g.call(this.onArriveAtPath),this.animTimeline=this.app.animator.play(this.art,["interaction","fly"]),this.app.sound.play("CardinalChirp")}},e.pause=function(){this.animTimeline&&(this.animTimeline.paused=!0),this.tween&&this.tween.setPaused(!0)},e.unpause=function(){this.animTimeline&&(this.animTimeline.paused=!1),this.tween&&this.tween.setPaused(!1)},e.destroy=function(){this.animTimeline&&this.app.animator.stop(this.art),this.art.destroy(),this.vinesToCut=this.level=this.art=this.app=this.animTimeline=null,this.tween&&(c.removeTweens(this),this.tween=null),f.destroy.call(this)},namespace("nature").Bird=d}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Point"),d=include("collision.Polygon"),e=include("collision.CollisionUtils"),f=include("nature.SwingingRope"),g=include("PIXI.Rectangle"),h=function(e){a.call(this),this.onLeftDown=this.onLeftDown.bind(this),this.onLeftUp=this.onLeftUp.bind(this),this.onRightDown=this.onRightDown.bind(this),this.onRightUp=this.onRightUp.bind(this),this.onJumpDown=this.onJumpDown.bind(this),this.update=this.update.bind(this),this.delayRespawn=this.delayRespawn.bind(this),this.respawn=this.respawn.bind(this),this.endLanding=this.endLanding.bind(this),this.clearTimeline=this.clearTimeline.bind(this),this.onMobileJumpChanged=this.onMobileJumpChanged.bind(this),this.onMobileMoveChanged=this.onMobileMoveChanged.bind(this),this.app=b.instance,this.level=e;var f=this.config=this.app.config.player;this.groundCollisionAdjustment=f.groundCollisionAdjustment;var h={x:0,y:-f.height/2,w:f.width,h:f.height};this.collision=d.fromEllipse(h,8),this.vineCollision=new g(f.vineCollision.x,f.vineCollision.y,f.vineCollision.width,f.vineCollision.height),this.anim=new pixiflash_lib.NatureCat,this.anim.stop(),this.anim.framerate=30,this.addChild(this.anim),this.velocity=new c,this.acceleration=new c,this.isLeftDown=0,this.isRightDown=0,this.enabled=!1,this.halfWidth=this.config.width/2,this.onGround=!1,this.terrainType=null,this.onPlatform=null,this.onVine=null,this.pushAnimTrailer=0,this.edgePushStopTimer=0,this.hurtCooldown=0,this.pushingBlock=null,this.isLanding=!1,this.facing="_R",this.currentAnim=null,this.currentAnimFacing=null,this.pushAudio=null,this.swingAudio=null,this.swingStartDir=0,this.lastSafePoint=new c,this.collectionPanel=null,this.collectedItems={},this.unsafeItems=[]},i=extend(h,a),j=a.prototype;i.enable=function(){var a=this.app.keyboard;if(a.addKeyDown("arrow_left",this.onLeftDown),a.addKeyUp("arrow_left",this.onLeftUp),a.addKeyDown("arrow_right",this.onRightDown),a.addKeyUp("arrow_right",this.onRightUp),a.addKeyDown("arrow_up",this.onJumpDown),a.addKeyDown("spacebar",this.onJumpDown,!0),a.addKeyDown("a",this.onLeftDown),a.addKeyUp("a",this.onLeftUp),a.addKeyDown("d",this.onRightDown),a.addKeyUp("d",this.onRightUp),a.addKeyDown("w",this.onJumpDown),this.app.hasTouch){var b=this.app.states.game.panel;b.moveButton.on("stateChange",this.onMobileMoveChanged),b.jumpButton.on("stateChange",this.onMobileJumpChanged)}this.lastSafePoint.x=this.position.x,this.lastSafePoint.y=this.position.y,this.enabled=!0,this.stopOnLanding=!1,this.playAnim("idle")},i.disable=function(){this.enabled=!1,this.acceleration.x=this.acceleration.y=this.velocity.x=this.velocity.y=0;var a=this.app.keyboard;if(a){if(a.removeKeyDown("arrow_left",this.onLeftDown),a.removeKeyUp("arrow_left",this.onLeftUp),a.removeKeyDown("arrow_right",this.onRightDown),a.removeKeyUp("arrow_right",this.onRightUp),a.removeKeyDown("arrow_up",this.onJumpDown),a.removeKeyDown("spacebar",this.onJumpDown),a.removeKeyDown("a",this.onLeftDown),a.removeKeyUp("a",this.onLeftUp),a.removeKeyDown("d",this.onRightDown),a.removeKeyUp("d",this.onRightUp),a.removeKeyDown("w",this.onJumpDown),this.app.hasTouch){var b=this.app.states.game.panel;b.moveButton.off("stateChange",this.onMobileMoveChanged),b.jumpButton.off("stateChange",this.onMobileJumpChanged)}this.isLeftDown=this.isRightDown=0}},i.onLeftDown=function(){this.isLeftDown=1},i.onLeftUp=function(){this.isLeftDown=0},i.onRightDown=function(){this.isRightDown=1},i.onRightUp=function(){this.isRightDown=0},i.onMobileMoveChanged=function(a){"left"==a?(this.isLeftDown=1,this.isRightDown=0):"right"==a?(this.isRightDown=1,this.isLeftDown=0):this.isRightDown=this.isLeftDown=0},i.onMobileJumpChanged=function(a){"jump"==a&&this.jump()},i.onJumpDown=function(){this.paused||this.jump()},i.jump=function(){var a=this.config;if(this.onGround){var b=this.velocity;"leaves"!=this.terrainType&&(b.x<-a.dustTriggerVel||b.x>a.dustTriggerVel)&&this.level.createEffect("Dust",this.position.x,this.position.y,a.dustScale*(b.x>0?1:-1),a.dustScale),this.terrainType=null,b.y=a.jumpSpeed,this.onGround=!1,this.playAnim("jump"),this.onPlatform&&(this.onPlatform.onPlayerLeft(),this.onPlatform=null),this.edgePushStopTimer=0,Math.random()<a.jumpVOChance&&this.app.sound.play(a.jumpAudio.random())}else this.onVine&&(this.onVine.stopSwing(),this.onVine.vineCooldown=a.vineCooldown/1e3,this.onVine=null,this.swingAudio&&(this.swingAudio.stop(),this.swingAudio=null))};var k=new c;i.update=function(a){if(this.enabled||!(this.hurtCooldown<=0)){this.hurtCooldown>0&&(this.hurtCooldown-=a,this.hurtCooldown<=0&&this.enable()),this.pushAnimTrailer>0&&(this.pushAnimTrailer-=a),this.edgePushStopTimer>0&&(this.edgePushStopTimer-=a);var b,c,d,g,h,i,j,l,m,n,o,p,q,r=this.config,s=this.acceleration,t=this.velocity,u=this.position,v=!1;if(this.onVine){p=this.isRightDown-this.isLeftDown;var w=this.onVine.points[this.onVine.swingIndex],x=Math.atan2(w.y,w.x),y=r.gravityAccel*Math.cos(x)/this.swingRadius;y-=p*this.swingAccel,this.angularVelocity+=y*a,this.angularVelocity>this.maxSwingAngularVelocity?this.angularVelocity=this.maxSwingAngularVelocity:this.angularVelocity<-this.maxSwingAngularVelocity&&(this.angularVelocity=-this.maxSwingAngularVelocity),x+=this.angularVelocity*a;var z=Math.cos(x),A=Math.sin(x);w.x=z*this.swingRadius,w.y=A*this.swingRadius;var B=t.x<0?-1:t.x>0?1:0;t.x=-A*this.angularVelocity*this.swingRadius,t.y=z*this.angularVelocity*this.swingRadius,o=t.x<0?-1:t.x>0?1:0;var C="_R"==this.facing?1:-1;u.x=w.x+this.onVine.x-r.vineHoldPos.x*C,u.y=w.y+this.onVine.y-r.vineHoldPos.y,p=0,0!==o&&o!=B&&(this.swingAudio&&this.swingAudio.stop(),this.swingAudio=this.app.sound.play(o==this.swingStartDir?"SwingForward":"SwingBack"))}else{if(p=this.isRightDown-this.isLeftDown,s.x=p*r.moveAccel*r.groundFriction,s.y=r.gravityAccel,o=t.x<0?-1:t.x>0?1:0,!this.pushingBlock||this.onGround&&p==o||(this.pushingBlock=null),this.onGround){if(0===p){var D=-o*r.gravityAccel*r.groundFriction;s.x+=D;-o*r.moveAccel*r.groundFriction*r.brakingMoveMultiplier;s.x+=D}s.y-=r.gravityAccel}else s.x*=r.airMoveMultiplier;if(t.x+=s.x*a,t.y+=s.y*a,0>o&&t.x>0&&1!==p)t.x=0;else if(o>0&&t.x<0&&-1!=p)t.x=0;else{var E=this.pushingBlock?this.pushingBlock.pushSpeed:r.maxXVelocity;t.x=Math.clamp(t.x,-E,E)}t.y=Math.clamp(t.y,r.jumpSpeed,r.maxYVelocity);var F;if(t.y>=0){b=u.x,d=u.y-this.groundCollisionAdjustment,g=u.y+(t.y>0?t.y*a:5),F=this.level.ground,j=null;var G=1e5;for(h=F.length-1;h>=0;--h)for(l=F[h],i=0;i<l.length-1;++i)if(m=l[i],n=l[i+1],e.getLineIntersection(b,d,b,g,m.x,m.y,n.x,n.y,k)){k.y<G&&(j=l,G=k.y);break}if(j){if("leaves"==j.terrainType&&t.y>=r.leafTriggerVel&&this.level.createEffect("Leaves",u.x,u.y,r.leafScale,r.leafScale),u.y=k.y,t.y=0,"water"==j.type)return this.onPlatform&&(this.onPlatform.onPlayerLeft(),this.onPlatform=null),this.disable(),this.app.sound.play("FallInWater"),this.playAnim("water",!0,this.delayRespawn),void this.level.createEffect("Splash",u.x,u.y,r.waterScale.x,r.waterScale.y);if("thorn"==j.type||"platform-thorn"==j.type)return this.disable(),this.app.sound.play(r.logThornAudio.random()),void this.playAnim("hit_foot",!1,this.delayRespawn);"platform"==j.type?j.owner.onCollision(this):"block"==j.type?j.owner.onPlatform?j.owner.onPlatform.onCollision(this):j.owner.onGround&&(this.lastSafePoint.x=u.x,this.lastSafePoint.y=u.y):(this.lastSafePoint.x=u.x,this.lastSafePoint.y=u.y)}else u.y+=t.y*a;if(j&&!this.onGround){if(this.terrainType=j.terrainType,"leaves"==j.terrainType?this.app.sound.play("LandingOnLeaves"):this.app.sound.play("Landing"),this.unsafeItems.length&&(this.unsafeItems.length=0),this.stopOnLanding)return this.onGround=!0,void this.disableWhenSafe();0===p&&(this.isLanding=!0,this.playAnim("land",!1,this.endLanding))}this.onGround&&!j&&(this.terrainType=null,this.onPlatform&&(this.onPlatform.onPlayerLeft(),this.onPlatform=null)),this.onGround=!!j}else u.y+=t.y*a;if(q=t.x*a,0!==q){this.pushingBlock&&(q=this.pushingBlock.push(q),this.pushingBlock.onGround||(this.edgePushStopTimer=this.config.edgePushStop/1e3)),b=u.x-o,c=u.x+q+this.halfWidth*o,d=u.y-3;var H=this.level.walls;for(j=!1,h=H.length-1;h>=0;--h)if(l=H[h],"noPlayer"!=l.type){if("block"==l.type){if(0>q&&l==l.owner.wallLeft)continue;if(q>0&&l==l.owner.wallRight)continue}for(i=0;i<l.length-1;++i)if(m=l[i],n=l[i+1],e.getLineIntersection(b,d,c,d,m.x,m.y,n.x,n.y,k)){j=l,h=-1;break}}if(j){if(this.edgePushStopTimer<=0&&(u.x=k.x-this.halfWidth*o),"block"!=j.type&&(t.x=0),"trip"==j.type&&this.onGround)return this.disable(),this.playAnim("trip",!1,this.delayRespawn),void this.app.sound.play(r.tripAudio.random());"block"==j.type&&this.onGround&&p==o&&(v=!this.pushingBlock&&this.pushAnimTrailer<=0,this.pushingBlock=j.owner)}else this.pushingBlock&&(this.pushingBlock=null,this.pushAnimTrailer=this.config.pushAnimTrailer/1e3),this.edgePushStopTimer<=0&&(u.x+=q)}}var I=this.collision;(0!==o||0!==t.y||this.collisionDirty)&&(I.updateOrigin(u.x,u.y),this.vineCollision.x=u.x+r.vineCollision.x,this.vineCollision.y=u.y+r.vineCollision.y,this.collisionDirty=!1);var J=this.level.objects;for(h=J.length-1;h>=0;--h){var K=J[h];if(K instanceof f){if(this.onGround||this.onVine||K.vineCooldown>0)continue;var L=K.testCollision(this.vineCollision);L&&(this.onVine=K,this.swingRadius=K.startSwing(L,k),this.angularVelocity=(k.x*t.x-k.y*t.y)/(k.x*k.x+k.y*k.y),t.x<0&&(this.angularVelocity*=-1),this.maxSwingAngularVelocity=r.maxXVelocity*Math.sqrt(2)/this.swingRadius,this.swingAccel=r.moveAccel*r.swingMoveMultiplier/this.swingRadius,this.swingStartDir=o,o||(this.swingStartDir="_L"==this.facing?-1:1),this.swingAudio=this.app.sound.play("SwingForward"))}else K.collision&&e.checkPolygonCollision(I,K.collision)&&K.onCollision(this)}var M=this.level;(u.x<0||u.x>M.fullLevelWidth||u.y>M.fullLevelHeight)&&this.respawn(),0!==p&&(this.facing=-1==p?"_L":"_R");var N;this.onGround?0===p?"fall"==this.currentAnim||"jump"==this.currentAnim?N="land":this.isLanding||(N="idle"):(N=this.pushingBlock||this.pushAnimTrailer>0?"push":"run",this.isLanding=!1):N=this.onVine?o==this.swingStartDir?"swingForward":"swingBack":t.y>0?"fall":"jump",this.hurtCooldown>0&&(N=null),this.pushingBlock&&"push"==N&&0!=q?(v||this.app.sound.isPlaying(this.pushingBlock.pushAudio)||(this.pushAudio=this.app.sound.play(this.pushingBlock.pushAudio,{loop:!0})),v&&!this.app.sound.isPlaying(r.pushAudio)&&this.app.sound.play(r.pushAudio)):this.pushAudio&&(this.pushAudio.stop(),this.pushAudio=null),this.playAnim(N)}},i.delayRespawn=function(){new springroll.DelayedCall(this.respawn,this.config.timeBeforeReset)},i.respawn=function(){var a=this.position,b=this.config;a.x=this.lastSafePoint.x,a.y=this.lastSafePoint.y-b.respawnHeight;var c,d,f,g,h,j,l,m,n,o;c=a.x-b.respawnTestDist,d=a.x+b.respawnTestDist,f=this.lastSafePoint.y-this.groundCollisionAdjustment,g=this.lastSafePoint.y+5,h=this.level.ground;var p=!1,q=!1;for(l=h.length-1;l>=0;--l)if(m=h[l],"ground"==m.type||"block"==m.type&&m.owner.onGround){for(i=0;i<m.length-1;++i)n=m[i],o=m[i+1],!p&&e.getLineIntersection(c,f,c,g,n.x,n.y,o.x,o.y,k)&&(p=!0),!q&&e.getLineIntersection(d,f,d,g,n.x,n.y,o.x,o.y,k)&&(q=!0);if(p&&q)break}p?q||(a.x-=b.respawnTestDist):a.x+=b.respawnTestDist,c=a.x,d=a.x-this.halfWidth-b.respawnTestDist;var r=a.x+this.halfWidth+b.respawnTestDist;for(f=this.lastSafePoint.y-3,j=this.level.walls,l=j.length-1;l>=0;--l)if(m=j[l],"trip"==m.type)for(i=0;i<m.length-1;++i){if(n=m[i],o=m[i+1],e.getLineIntersection(c,f,d,f,n.x,n.y,o.x,o.y,k)){a.x+=b.respawnTestDist,l=-1;break}if(e.getLineIntersection(c,f,r,f,n.x,n.y,o.x,o.y,k)){a.x-=b.respawnTestDist,l=-1;break}}if(this.collisionDirty=!0,this.onGround=!1,this.enable(),this.unsafeItems.length){for(this.collectionPanel.loseItems(this.unsafeItems.length),l=0;l<this.unsafeItems.length;++l)this.unsafeItems[l].restore();this.unsafeItems.length=0}},i.bounceFromThorns=function(){if(!(this.hurtCooldown>0)){var a=this.velocity,b=a.x,c=a.y;this.hurtCooldown=this.config.thornsBounceTimer/1e3,this.disable(),this.onVine&&(this.onVine.stopSwing(),this.onVine.vineCooldown=this.config.vineCooldown/1e3,this.onVine=null,this.swingAudio&&(this.swingAudio.stop(),this.swingAudio=null));var d=this.config.thornsBounceSpeed;b>0?a.x=-d:a.x=d,c>-d&&(a.y=-d,this.onGround=!1,this.onPlatform&&(this.onPlatform.onPlayerLeft(),this.onPlatform=null)),this.playAnim("hit_body",!1,this.onThornsBounceDone),this.app.sound.play(this.config.wallThornAudio.random())}},i.onThornsBounceDone=function(){"hit_body"==this.currentAnim&&(this.onGround?this.playAnim("idle"):this.playAnim("fall"))},i.collectItem=function(a){var b=a.type;b==this.targetItem&&(this.app.sound.play("ItemCollected"),this.collectionPanel.findItem(),this.app.voPlayer.play("NCat_"+this.collectionPanel.itemsFound),this.onGround||this.unsafeItems.push(a))},i.playAnim=function(a,b,c){a&&(a!=this.currentAnim||this.facing!=this.currentAnimFacing)&&(this.currentAnim=a,b?this.currentAnimFacing="":this.currentAnimFacing=this.facing,this.animTimeline=this.app.animator.play(this.anim,this.currentAnim+this.currentAnimFacing,c),c||this.animTimeline.isLooping||(this.animTimeline.onComplete=this.clearTimeline))},i.clearTimeline=function(){this.animTimeline=null},i.endLanding=function(){this.animTimeline=null,this.isLanding=!1},i.disableWhenSafe=function(){this.onGround?(this.playAnim("idle"),this.disable()):this.stopOnLanding=!0},i.stop=function(){this.app.animator.stop(this.anim),this.disable(),this.animTimeline=null},i.pause=function(){this.paused=!0,this.animTimeline&&(this.animTimeline.paused=!0),this.pushAudio&&this.pushAudio.pause(),this.swingAudio&&this.swingAudio.pause()},i.unpause=function(){this.paused=!1,this.animTimeline&&(this.animTimeline.paused=!1),this.pushAudio&&this.pushAudio.resume(),this.swingAudio&&this.swingAudio.resume()},i.destroy=function(){this.stop(),j.destroy.call(this),this.anim.destroy(),this.anim=this.onPlatform=this.pushingBlock=this.lastSafePoint=this.unsafeItems=this.app=this.level=this.config=this.collision=this.vineCollision=this.velocity=this.acceleration=this.onVine=this.collectionPanel=this.onLeftDown=this.onLeftUp=this.onRightDown=this.onRightUp=this.onJumpDown=this.update=this.delayRespawn=this.respawn=this.endLanding=this.clearTimeline=this.onMobileJumpChanged=this.onMobileMoveChanged=null},namespace("nature").Player=h}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("nature.Collectible"),e=include("nature.Thorns"),f=include("nature.Platform"),g=include("PIXI.Point"),h=include("nature.Player"),i=include("PIXI.Texture"),j=include("nature.Character"),k=include("nature.MovingBlock"),l=include("nature.PushBlocker"),m=include("nature.PulleyRope"),n=include("nature.SwingingRope"),o=include("nature.Bird"),p=include("nature.Background"),q=include("nature.FallbackTileLayer"),r=function(c,d){a.call(this),this.app=b.instance,this.levelConfig=c,d&&this.setup(d)},s=extend(r,a),t=a.prototype;s.setup=function(b){this.objects=[],this.layers=[],this.staticSprites=[],this.ground=[],this.walls=[],this.characterLayer=null,this.objectsById={},this.effectPools={},this.activeEffects=[];var r={},t=b.tileWidth,u=b.tileHeight,v=0,w=0,x=1;this.cullTiles=!0,this.fallbackTileLayers=null,this.app.display.isWebGL||(this.fallbackTileLayers=[]);for(var y,z,A,B,C,D,E,F=0;F<b.layers.length;++F){var G=b.layers[F];if("collision"==G.name)for(D=G.objects,B=0;B<D.length;++B){E=D[B],A=[];var H=E.polyline;for(s=0;s<H.length;++s)A.push(new g(H[s].x*x,H[s].y*x));A.type=E.type,A.terrainType=E.properties.terrainType||null,"ground"==E.type?this.ground.push(A):"wall"==E.type?this.walls.push(A):"trip"==E.type?this.walls.push(A):"water"==E.type?this.ground.push(A):"thorn"==E.type&&this.ground.push(A)}else if("characterLayer"==G.name)for(this.characterLayer=new a,this.addChild(this.characterLayer),this.layers.push(this.characterLayer),D=G.objects,B=0;B<D.length;++B)E=D[B],"startPos"==E.name?y=E.ellipse?new g(E.ellipse.x*x,E.ellipse.y*x):E.rect?new g(E.rect.x*x,E.rect.y*x):new g(E.x*x,E.y*x):"goalPos"==E.name&&(z=E.ellipse?new g(E.ellipse.x*x,E.ellipse.y*x):E.rect?new g(E.rect.x*x,E.rect.y*x):new g(E.x*x,E.y*x));else{var I=new a;if(I.name=G.name,this.layers.push(I),this.addChild(I),G.grid){I.grid=[];var J=G.grid,K=J.length,L=J[0].length;v||(v=K*t,w=L*u);var M,N;this.fallbackTileLayers&&(M=new q,N=M.tiles,this.fallbackTileLayers.push(M),I.addChild(M));for(var O=0;K>O;++O){I.grid[O]=[];for(var P=0;L>P;++P){var Q=J[O][P];if(Q){r[Q.tileset]||(r[Q.tileset]=this.app.getCache(Q.tileset));var R=new c(r[Q.tileset].getFrame(Q.image));I.grid[O][P]=R,R.x=O*t,R.y=P*u,Q.flippedHorizontally&&(R.scale.x=-1),Q.flippedVertically&&(R.scale.y=-1),R.tileLeft=R.x,R.tileTop=R.y,R.tileRight=R.tileLeft+R.width,R.tileBottom=R.tileTop+R.height,N?N.push(R):(this.staticSprites.push(R),I.addChild(R))}else I.grid[O][P]=null}}}else if(G.objects)for(D=G.objects,B=0;B<D.length;++B){switch(E=D[B],C=null,E.properties.codeClass){case"Collectible":C=new d(E);break;case"Platform":C=new f(this,E);break;case"Bird":C=new o(this,E);break;case"MovingBlock":C=new k(this,E);break;case"PushBlocker":C=new l(this,E);break;case"Thorns":C=new e(E);break;case"PulleyRope":C=new m(E);break;case"SwingingRope":C=new n(this,E);break;case"Sprite":C=new c(i.fromImage(E.properties.art)),C.x=E.x,C.y=E.y,C.rotation=E.rotation*Math.PI/180,C.width=E.width,C.height=E.height,E.flippedHorizontally&&(C.scale.x*=-1,C.pivot.x=E.width),E.flippedVertically&&(C.scale.y*=-1,C.pivot.y=E.height),C.tileLeft=C.x*x,C.tileTop=C.y*x,C.tileRight=C.tileLeft+Math.abs(C.width),C.tileBottom=C.tileTop+Math.abs(C.height),this.staticSprites.push(C)}if(C)C.position.x*=x,C.position.y*=x,C.update||(C.update=!1),this.objects.push(C),I.addChild(C),this.objectsById[E.id]=C;else if(E.polyline||E.rect||E.ellipse||E.polygon){this.objectsById[E.id]=E;continue}}}}for(A=[],A.push(new g(0,-300)),A.push(new g(0,w)),this.walls.push(A),A=[],A.push(new g(v*x,-300)),A.push(new g(v*x,w*x)),this.walls.push(A),this.goalCharacter=new j(this.levelConfig.levelTarget,this),this.characterLayer.addChild(this.goalCharacter),this.goalCharacter.x=z.x,this.goalCharacter.y=z.y,this.player=new h(this),this.characterLayer.addChild(this.player),this.player.x=y.x,this.player.y=y.y,this.player.targetItem=this.levelConfig.levelTarget.object,this.fullLevelWidth=v,this.fullLevelHeight=w,this.background=new p(v),this.background.y=w-this.background.totalHeight,B=0;B<this.objects.length;++B)this.objects[B].init&&this.objects[B].init()},s.start=function(){this.player.enable(),this.goalCharacter.start();for(var a=this.objects,b=0,c=a.length;c>b;++b)a[b].start&&a[b].start()},s.update=function(a){this.player.update(a);for(var b=this.objects,c=0,d=b.length;d>c;++c){var e=b[c];e.update&&e.update(a)}this.goalCharacter.update(a)},s.updateVisibility=function(a){var b,c=a.x,d=a.y,e=c+a.width,f=d+a.height,g=this.staticSprites;for(b=g.length-1;b>=0;--b){var h=g[b];h.visible=h.tileLeft<=e&&c<=h.tileRight&&h.tileTop<=f&&d<=h.tileBottom}if(this.fallbackTileLayers)for(b=this.fallbackTileLayers.length-1;b>=0;--b)this.fallbackTileLayers[b].updateVisibility(a)},s.createEffect=function(a,b,c,d,e){var f,g=this.effectPools[a];g&&g.length?f=g.pop():(f=new(include("pixiflash_lib."+a)),f.effectType=a,f.removalCB=this.removeEffect.bind(this,f),f.framerate=30),"Splash"==a?this.characterLayer.addChild(f):this.addChild(f),f.position.x=b,f.position.y=c,f.scale.x=d,f.scale.y=e,this.app.animator.play(f,"*",f.removalCB)},s.removeEffect=function(a){a.parent&&a.parent.removeChild(a),this.effectPools[a.effectType]?this.effectPools[a.effectType].push(a):this.effectPools[a.effectType]=[a]},s.removeObject=function(a){var b=this.objects.indexOf(a);b>-1&&(this.objects.splice(b,1),a.parent.removeChild(a),a.destroy())},s.end=function(){this.player.stop(),this.goalCharacter.stop();for(var a=0;a<this.objects.length;++a){var b=this.objects[a];b.stop&&b.stop()}},s.pause=function(){this.player.pause(),this.goalCharacter.pause();for(var a=0;a<this.objects.length;++a){var b=this.objects[a];b.pause&&b.pause()}},s.unpause=function(){this.player.unpause(),this.goalCharacter.unpause();for(var a=0;a<this.objects.length;++a){var b=this.objects[a];b.unpause&&b.unpause()}},s.destroy=function(){this.goalCharacter.destroy(),this.player.destroy();var a,b;for(b=this.objects,a=b.length-1;a>=0;--a)b[a].destroy();for(b=this.layers,a=b.length-1;a>=0;--a)b[a].destroy();this.background.destroy(),this.goalCharacter=this.player=this.objects=this.objectsById=this.app=this.levelConfig=this.walls=this.ground=this.layers=this.characterLayer=this.background=this.staticSprites=null,t.destroy.call(this)},namespace("nature").Level=r}(),function(){var a=include("springroll.Application"),b=include("PIXI.Rectangle"),c=function(c,d){this.player=c.player,this.level=c,this.bgBaseY=c.background.y;var e=this.app=a.instance;this.config=e.config.camera,this.zoom=this.config.zoom;var f=this.viewport=new b,g=e.display,h=e.scaling;f.width=g.width/h.scale/this.zoom,f.height=g.height/h.scale/this.zoom;var i=this.targetRect=new b(0,this.config.centerRect.y,this.config.centerRect.width,this.config.centerRect.height);i.y+i.height>g.height/h.scale&&(i.height=g.height/h.scale-i.y),this.aspectOffset=(g.width/h.scale-e.config.scalingSize.width)/2,i.x=this.config.centerRect.x+this.aspectOffset,i.x/=this.zoom,i.y/=this.zoom,i.width/=this.zoom,i.height/=this.zoom,i.right=i.x+i.width,i.bottom=i.y+i.height,d.scale.x=d.scale.y=this.zoom,this.resize=this.resize.bind(this),e.on("resize",this.resize,-2),this.update()},d=c.prototype={};d.resize=function(a,b){var c=this.viewport,d=this.targetRect,e=(this.level,this.player.position,this.app),f=e.display,g=e.scaling;c.width=f.width/g.scale/this.zoom,c.height=f.height/g.scale/this.zoom,this.aspectOffset=(f.width/g.scale-e.config.scalingSize.width)/2,d.x=this.config.centerRect.x+this.aspectOffset,d.x/=this.zoom,d.right=d.x+d.width,this.update(!0)},d.update=function(a){var b,c,d=this.viewport,e=this.targetRect,f=this.level,g=this.player.position;if(b=Math.clamp(d.x,g.x-e.right,g.x-e.x),c=Math.clamp(d.y,g.y-e.bottom,g.y-e.y),b=Math.clamp(b,0,f.fullLevelWidth-d.width),c=f.fullLevelHeight<=d.height?0:Math.clamp(c,0,f.fullLevelHeight-d.height),a||b!=d.x||c!=d.y){d.x=b,d.y=c;d.x+d.width/2;f.x=-b,f.y=-c;var h=f.background;h.x=h.parallax*-b,h.y=this.bgBaseY+-c,h.updateVisibility(d),f.cullTiles&&f.updateVisibility(d)}},d.destroy=function(){this.app.off("resize",this.resize),this.player=this.level=this.app=this.viewport=this.config=this.resize=this.targetRect=null},namespace("nature").Camera=c}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("springroll.pixi.Slice3Textures"),f=include("springroll.pixi.Slice3Sprite"),g=include("createjs.Tween"),h=function(){a.call(this);var c=this.config=b.instance.config.collectibleCounter;this.texture=new e(d.fromImage(c.tex),c.slice3),this.back=new f(this.texture),this.addChild(this.back)},i=extend(h,a),j=a.prototype;i.init=function(a,b){this.foundTex=d.fromImage(a.foundId),this.items=[];var e=this.unfoundTex=d.fromImage(a.unfoundId),f=this.config.spacing,g=this.config.padding,h=e.width*a.uiScale,i=e.height*a.uiScale,j=(b+1)*f+b*h+2*g;this.back.setWidth(j);var k=i+2*f;this.back.setHeight(k);var l=-j/2+g;this.back.position.x=l-g,this.back.position.y=k,this.back.scale.y=-1;for(var m=k*(1-this.config.yPos),n=0;b>n;++n){var o=new c(e);o.scale.x=o.scale.y=a.uiScale,o.anchor.x=o.anchor.y=.5,o.position.y=m,o.position.x=l+(n+1)*f+(n+.5)*h,this.items.push(o),this.addChild(o)}this.itemsFound=0},i.findItem=function(){g.removeTweens(this.items[this.itemsFound]),this.items[this.itemsFound++].texture=this.foundTex},i.loseItems=function(a){this.itemsFound-=a;for(var b=this.foundTex,c=this.unfoundTex,d=0;a>d;++d){var e=this.items[this.itemsFound+d];e.texture=c,g.removeTweens(e),g.get(e).to({texture:b},200).to({texture:c},200).to({texture:b},200).to({texture:c},200).to({texture:b},200).to({texture:c},200)}},i.destroy=function(){j.destroy.call(this),this.back.destroy(),this.texture.destroy();for(var a=0;a<this.items.length;++a)this.items[a].destroy(),g.removeTweens(this.items[a]);this.back=this.texture=this.items=this.foundTex=this.unfoundTex=null},namespace("nature").CollectionPanel=h}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.extras.BitmapText"),e=function(e){a.call(this);var f=b.instance,g=f.config.dialogs.missionRecord,h=f.getCache("MissionDialog");this.back=new c(h.getFrame(g.back)),this.addChild(this.back),this.medal=new c,this.addChild(this.medal),this.medal.x=g.medal.x,this.medal.y=g.medal.y;var i=f.config.levels[e],j=f.saveData.times[e];j<=i.times[1]?this.medal.texture=h.getFrame(g.medal.tex+"gold"):j<=i.times[0]?this.medal.texture=h.getFrame(g.medal.tex+"silver"):this.medal.texture=h.getFrame(g.medal.tex+"bronze"),this.label=new c(h.getFrame(g.label.tex)),this.label.x=g.label.x,this.label.y=g.label.y,this.addChild(this.label);var k=Math.floor(j/60).toString()+":";j%=60,k+=Math.floor(j).toPaddedString(),this.time=new d(k,g.time.font),this.addChild(this.time),this.time.x=g.time.x,this.time.y=g.time.y},f=extend(e,a),g=a.prototype;f.destroy=function(){g.destroy.call(this),this.back.destroy(),this.medal.destroy(),this.label.destroy(),this.time.destroy(),this.back=this.medal=this.label=this.time=null},namespace("nature").MissionRecord=e}(),function(){var a=include("PIXI.Sprite"),b=include("PIXI.Texture"),c=include("springroll.Positioner"),d=include("PIXI.Point"),e=function(d){this.config=d,this.states={};for(var e in d.textures)this.states[e]=b.fromFrame(d.textures[e]);a.call(this,this.states.up),this.areas=[];for(var f=0;f<d.areas.length;++f){var g=c.generateHitArea(d.areas[f]);g.id=d.areas[f].id,this.areas.push(g)}this.currentArea=null,this.downTouches={},this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.enabled=!0},f=extend(e,a),g=a.prototype;Object.defineProperty(f,"enabled",{set:function(a){this.off("touchstart",this.onTouchStart),a&&this.on("touchstart",this.onTouchStart),this.interactive=a}});var h=new d;f.onTouchStart=function(a){this.on("touchmove",this.onTouchMove),this.on("touchend",this.onTouchEnd),this.on("touchendoutside",this.onTouchEnd),this.downTouches[a.data.identifier]=!0,a.data.getLocalPosition(this,h),this.checkPoint(h)},f.onTouchMove=function(a){this.downTouches[a.data.identifier]&&(a.data.getLocalPosition(this,h),this.checkPoint(h))},f.onTouchEnd=function(a){this.off("touchmove",this.onTouchMove),this.off("touchend",this.onTouchEnd),this.off("touchendoutside",this.onTouchEnd),this.downTouches[a.data.identifier]=!1,this.checkPoint()},f.checkPoint=function(a){var b=null;if(a)for(var c=0;c<this.areas.length;++c)if(this.areas[c].contains(a.x,a.y)){b=this.areas[c].id;break}b!=this.currentArea&&(this.currentArea=b,b?this.texture=this.states[b]:this.texture=this.states.up,this.emit("stateChange",b))},f.destroy=function(){g.destroy.call(this),this.states=this.config=this.currentArea=this.downTouches=this.onTouchStart=this.onTouchMove=this.onTouchEnd=null},namespace("nature").MobileButton=e}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("springroll.pixi.IconButton"),f=include("springroll.Positioner"),g=function(){a.call(this);var g=b.instance,h=g.config.dialogs.pause;this.banner=new c(d.fromImage(h.banner.tex)),this.addChild(this.banner);var i=g.config.buttons.quitButton,j=i.imageSettings;i.label.text="QUIT",this.quitButton=new e(j,i.label,i.icon),this.addChild(this.quitButton),i=g.config.buttons.replayButton,j=i.imageSettings,i.label.text="REPLAY",this.replayButton=new e(j,i.label,i.icon),this.addChild(this.replayButton),i=g.config.buttons.playButton,j=i.imageSettings,i.label.text="PLAY",this.playButton=new e(j,i.label,i.icon),this.addChild(this.playButton);for(var k in h)f.init(this[k],h[k]);g.globalButtonSounds.addButton(this.quitButton),g.globalButtonSounds.addButton(this.replayButton),g.globalButtonSounds.addButton(this.playButton)},h=extend(g,a);h.destroy=function(){var c=b.instance;c.globalButtonSounds.removeButton(this.quitButton),c.globalButtonSounds.removeButton(this.replayButton),c.globalButtonSounds.removeButton(this.playButton),a.prototype.destroy.call(this),this.banner.destroy(),this.quitButton.destroy(),this.replayButton.destroy(),this.playButton.destroy(),this.banner=this.quitButton=this.replayButton=this.playButton=null},namespace("nature").PauseDialog=g}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("springroll.pixi.IconButton"),f=include("PIXI.extras.BitmapText"),g=include("springroll.Positioner"),h=function(){a.call(this);var h=b.instance,i=this.config=h.config.dialogs.rewardDialog;this.background=new c(d.fromFrame(i.background.tex)),this.addChild(this.background),this.title=new f("",i.title.font),this.title.setPivotToAlign=!0,this.addChild(this.title),this.timeLabel=new c(d.fromFrame(i.timeLabel.tex)),this.addChild(this.timeLabel),this.time=new f("",i.time.font),this.addChild(this.time),this.medal=new pixiflash_lib.medals,this.medal.framerate=30,this.medal.stop(),this.addChild(this.medal);var j=h.config.buttons.replayButton,k=j.imageSettings;j.label.text="REPLAY",this.replayButton=new e(k,j.label,j.icon),this.addChild(this.replayButton),j=h.config.buttons.okButton,k=j.imageSettings,j.label.text="OK",this.okButton=new e(k,j.label,j.icon),this.addChild(this.okButton);for(var l in i)g.init(this[l],i[l]);h.globalButtonSounds.addButton(this.okButton),h.globalButtonSounds.addButton(this.replayButton)},i=extend(h,a);i.setRewardLevel=function(a){this.title.text=this.config.title.text[a],b.instance.animator.play(this.medal,{anim:a,audio:"MedalSpinning"})},i.destroy=function(){a.prototype.destroy.call(this);var c=b.instance;c.animator.stop(this.medal),c.globalButtonSounds.removeButton(this.okButton),c.globalButtonSounds.removeButton(this.replayButton),this.background.destroy(),this.medal.destroy(),this.title.destroy(),this.timeLabel.destroy(),this.time.destroy(),this.replayButton.destroy(),this.okButton.destroy(),this.config=this.background=this.medal=this.title=this.timeLabel=this.time=this.replayButton=this.okButton=null},namespace("nature").RewardDialog=h}(),function(){var a=include("springroll.Application"),b=include("PIXI.Sprite"),c=include("springroll.pixi.Button"),d=function(){var d=a.instance,e=this.atlas=d.getCache("SelectBubbles"),f=(d.config.selectButtonLayout,{up:e.getFrame("missionbubble"),over:e.getFrame("missionbubble_hover"),down:e.getFrame("missionbubble")});c.call(this,f),this.icon=new b,this.addChild(this.icon),this.item=new b,this.addChild(this.item),this.item.anchor.x=this.item.anchor.y=.5,
this.item.x=42,this.item.y=29,this.item.scale.x=this.item.scale.y=.8},e=extend(d,c),f=c.prototype;e.setup=function(b){this.x=b.bubblePos.x,this.y=b.bubblePos.y,b.bubblePos.scaleX&&(this.scale.x=b.bubblePos.scaleX);var c=a.instance,d=this.atlas,e=c.saveData;if(e.times.length<=b.levelIndex);else{var f=c.config.levels[b.levelIndex],g=e.times[b.levelIndex];g<=f.times[1]?this.icon.texture=d.getFrame("missionbubble_gold"):g<=f.times[0]?this.icon.texture=d.getFrame("missionbubble_silver"):this.icon.texture=d.getFrame("missionbubble_bronze")}this.item.texture=d.getFrame(b.icon),this.levelIndex=b.levelIndex,this.character=b.id},e.destroy=function(){this.removeChildren(),this.icon.destroy(),this.item.destroy(),this.atlas=this.icon=this.item=null,f.destroy.call(this)},namespace("nature").SelectButton=d}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("PIXI.Texture"),e=include("springroll.Positioner"),f=include("springroll.TweenHelper"),g=include("createjs.Tween"),h=function(){a.call(this);var f=this.app=b.instance;this.isMobile=f.hasTouch;var g;g=f.hasTouch?this.config=f.config.dialogs.tutorialMobile:this.config=f.config.dialogs.tutorialDesktop,this.background=new c(d.fromImage(g.background.tex)),this.addChild(this.background),this.pressButtonText=new c(d.fromImage(g.pressButtonText.tex)),this.addChild(this.pressButtonText),this.pressButtonText.visible=!1,this.character=new pixiflash_lib.NatureCat,this.character.framerate=30,this.addChild(this.character),f.animator.play(this.character,"idle_R"),this.moveLabel=new c(d.fromImage(g.moveLabel.tex)),this.addChild(this.moveLabel),this.jumpLabel=new c(d.fromImage(g.jumpLabel.tex)),this.addChild(this.jumpLabel),g.left?(this.left=new c(d.fromImage(g.left.tex.none)),this.addChild(this.left),this.right=new c(d.fromImage(g.right.tex.none)),this.addChild(this.right)):(this.move=new c(d.fromImage(g.move.tex.none)),this.addChild(this.move)),this.jump=new c(d.fromImage(g.jump.tex.none)),this.addChild(this.jump);for(var h in g)this[h]&&e.init(this[h],g[h]);this.isMobile?(this.onMobileJumpChange=this.onMobileJumpChange.bind(this),this.onMobileMoveChange=this.onMobileMoveChange.bind(this)):(this.onJumpDown=this.onJumpDown.bind(this),this.onLeftDown=this.onLeftDown.bind(this),this.onLeftUp=this.onLeftUp.bind(this),this.onRightDown=this.onRightDown.bind(this),this.onRightUp=this.onRightUp.bind(this)),this.onJumpComplete=this.onJumpComplete.bind(this),this.enableDialog=this.enableDialog.bind(this),this.update=this.update.bind(this),this.isLeftDown=this.isRightDown=!1,this.isJumping=!1,this.isLeftComplete=this.isRightComplete=this.isJumpComplete=!1},i=extend(h,a);i.open=function(){var a=this.config.audioOrder;this.app.voPlayer.play(a,this.enableDialog),this.highlightIndex=0,this.highlightOrder=this.config.highlightOrder,this.highlightTimer=this.highlightOrder[this.highlightIndex],this.app.on("update",this.update)},i.update=function(a){if(this.highlightTimer-=a,this.highlightTimer<=0){switch(this.highlightOrder[++this.highlightIndex]){case"left":this.app.animator.play(this.character,"run_L"),this.left?(this.left.texture=d.fromImage(this.config.left.tex.complete),this.right.texture=d.fromImage(this.config.right.tex.none)):this.move.texture=d.fromImage(this.config.move.tex.left);break;case"right":this.app.animator.play(this.character,"run_R"),this.left?(this.left.texture=d.fromImage(this.config.left.tex.none),this.right.texture=d.fromImage(this.config.right.tex.complete)):this.move.texture=d.fromImage(this.config.move.tex.right);break;case"jump":this.isJumping=!0,this.app.animator.play(this.character,this.config.character.jumpAnim,this.onJumpComplete),f.build(this.character,this.config.character.jumpTween),this.left?(this.left.texture=d.fromImage(this.config.left.tex.none),this.right.texture=d.fromImage(this.config.right.tex.none)):this.move.texture=d.fromImage(this.config.move.tex.none),this.jump.texture=d.fromImage(this.config.jump.tex.complete)}this.highlightTimer=this.highlightOrder[++this.highlightIndex],this.highlightTimer||this.app.off("update",this.update)}},i.enableDialog=function(){if(this.jump.texture=d.fromImage(this.config.jump.tex.none),this.left?(this.left.texture=d.fromImage(this.config.left.tex.none),this.right.texture=d.fromImage(this.config.right.tex.none)):this.move.texture=d.fromImage(this.config.move.tex.none),this.isMobile){var a=this.app.states.game.panel;a.moveButton.on("stateChange",this.onMobileMoveChange),a.jumpButton.on("stateChange",this.onMobileJumpChange)}else{var b=this.app.keyboard;b.addKeyDown("arrow_left",this.onLeftDown),b.addKeyUp("arrow_left",this.onLeftUp),b.addKeyDown("arrow_right",this.onRightDown),b.addKeyUp("arrow_right",this.onRightUp),b.addKeyDown("arrow_up",this.onJumpDown),b.addKeyDown("spacebar",this.onJumpDown),b.addKeyDown("a",this.onLeftDown),b.addKeyUp("a",this.onLeftUp),b.addKeyDown("d",this.onRightDown),b.addKeyUp("d",this.onRightUp),b.addKeyDown("w",this.onJumpDown)}this.pressButtonText.visible=!0,this.config.enableAudio&&this.app.voPlayer.play(this.config.enableAudio)},i.onMobileJumpChange=function(a){a&&this.onJumpDown()},i.onMobileMoveChange=function(a){"left"==a?this.onLeftDown():this.isLeftDown&&this.onLeftUp(),"right"==a?this.onRightDown():this.isRightDown&&this.onRightUp()},i.onJumpDown=function(){this.isJumping||(this.isJumpComplete||(this.isJumpComplete=!0,this.jump.texture=d.fromImage(this.config.jump.tex.complete),this.checkForCompletion()),this.isJumping=!0,this.app.animator.play(this.character,this.config.character.jumpAnim,this.onJumpComplete),f.build(this.character,this.config.character.jumpTween))},i.onJumpComplete=function(){this.isJumping=!1,this.isRightDown==this.isLeftDown?this.app.animator.play(this.character,"idle_R"):this.isLeftDown?this.app.animator.play(this.character,"run_L"):this.isRightDown&&this.app.animator.play(this.character,"run_R")},i.onLeftDown=function(){this.isLeftDown=!0,this.isLeftComplete||(this.isLeftComplete=!0,this.left?this.left.texture=d.fromImage(this.config.left.tex.complete):this.isRightComplete?this.move.texture=d.fromImage(this.config.move.tex.all):this.move.texture=d.fromImage(this.config.move.tex.left),this.checkForCompletion()),this.isJumping||(this.isRightDown?this.app.animator.play(this.character,"idle_R"):this.app.animator.play(this.character,"run_L"))},i.onLeftUp=function(){this.isLeftDown=!1,this.isJumping||(this.isRightDown?this.app.animator.play(this.character,"run_R"):this.app.animator.play(this.character,"idle_L"))},i.onRightDown=function(){this.isRightDown=!0,this.isRightComplete||(this.isRightComplete=!0,this.right?this.right.texture=d.fromImage(this.config.right.tex.complete):this.isLeftComplete?this.move.texture=d.fromImage(this.config.move.tex.all):this.move.texture=d.fromImage(this.config.move.tex.right),this.checkForCompletion()),this.isJumping||(this.isLeftDown?this.app.animator.play(this.character,"idle_L"):this.app.animator.play(this.character,"run_R"))},i.onRightUp=function(){this.isRightDown=!1,this.isJumping||(this.isLeftDown?this.app.animator.play(this.character,"run_L"):this.app.animator.play(this.character,"idle_R"))},i.checkForCompletion=function(){if(this.isRightComplete&&this.isLeftComplete&&this.isJumpComplete){var a=this.app.states.game.panel;setTimeout(a.hideTutorialDialog.bind(a),0),this.app.voPlayer.play("NCat_Okay")}},i.close=function(){if(this.isMobile){var a=this.app.states.game.panel;a.moveButton.off("stateChange",this.onMobileMoveChange),a.jumpButton.off("stateChange",this.onMobileJumpChange)}else{var b=this.app.keyboard;if(!b)return;b.removeKeyDown("arrow_left",this.onLeftDown),b.removeKeyUp("arrow_left",this.onLeftUp),b.removeKeyDown("arrow_right",this.onRightDown),b.removeKeyUp("arrow_right",this.onRightUp),b.removeKeyDown("arrow_up",this.onJumpDown),b.removeKeyDown("spacebar",this.onJumpDown),b.removeKeyDown("a",this.onLeftDown),b.removeKeyUp("a",this.onLeftUp),b.removeKeyDown("d",this.onRightDown),b.removeKeyUp("d",this.onRightUp),b.removeKeyDown("w",this.onJumpDown)}this.character&&(this.app.animator.stop(this.character),g.removeTweens(this.character))},i.destroy=function(){a.prototype.destroy.call(this),this.jump.destroy(),this.move?this.move.destroy():(this.left.destroy(),this.right.destroy()),this.moveLabel.destroy(),this.jumpLabel.destroy(),this.character&&this.character.destroy(),this.background.destroy(),this.jump=this.move=this.left=this.right=this.moveLabel=this.jumpLabel=this.character=this.background=this.app=this.onJumpComplete=this.onJumpDown=this.onLeftDown=this.onLeftUp=this.onRightDown=this.onRightUp=this.onMobileJumpChange=this.onMobileMoveChange=null},namespace("nature").TutorialDialog=h}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("springroll.pixi.IconButton"),e=include("cloudkid.Emitter"),f=function(){a.call(this)},g=extend(f,a);g.setup=function(){var f=b.instance;this.background=new c(f.getCache("EndBG")),this.confettiContainer=new a;var g=f.config.buttons.okButton,h=g.imageSettings;g.label.text="OK",this.okButton=new d(h,g.label,g.icon),this.addChild(this.background),this.addChild(this.confettiContainer),this.addChild(this.okButton);var i=f.config.endConfetti;this.confetti=new e(this.confettiContainer,i.images,i.emitter),this.confetti.emit=!1,this.confetti.updateSpawnPos(i.pos.x,i.pos.y),f.globalButtonSounds.addButton(this.okButton)},g.teardown=function(){b.instance.globalButtonSounds.removeButton(this.okButton),this.removeChildren(),this.confetti.destroy(),this.background.destroy(),this.confettiContainer.destroy(),this.okButton.destroy(),this.confetti=this.confettiContainer=this.background=this.okButton=null},namespace("nature").EndPanel=f}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("springroll.pixi.Button"),d=include("PIXI.extras.BitmapText"),e=include("PIXI.Graphics"),f=include("nature.RewardDialog"),g=include("nature.PauseDialog"),h=include("PIXI.Rectangle"),i=include("nature.MobileButton"),j=include("nature.TutorialDialog"),k=function(){a.call(this),this.onResize=this.onResize.bind(this),this.makeTutorial=!1},l=extend(k,a);l.setup=function(){var k=b.instance;this.worldContainer=new a,this.addChild(this.worldContainer),this.worldZoomContainer=new a,this.worldContainer.addChild(this.worldZoomContainer),this.collectionPanel=new nature.CollectionPanel,this.addChild(this.collectionPanel),this.timer=new d("",{font:"48px TimerBumstead",align:"right"}),this.timer.setPivotToAlign=!0,this.addChild(this.timer);var l=k.config.buttons.pauseButton;this.pauseButton=new c(l),this.addChild(this.pauseButton);var m=this.blocker=new e;this.addChild(m),m.beginFill(0),m.drawRect(0,0,100,100),m.alpha=.7,m.visible=!1,m.scale.x=k.display.width/100,m.scale.y=k.display.height/100,m.hitArea=new h(0,0,100,100),m.interactive=!0,k.hasTouch&&(this.jumpButton=new i(k.config.buttons.jumpButton),this.addChild(this.jumpButton),this.moveButton=new i(k.config.buttons.moveButton),this.addChild(this.moveButton)),this.rewardDialog=new f,this.addChild(this.rewardDialog),this.rewardDialog.visible=!1,this.pauseDialog=new g,this.addChild(this.pauseDialog),this.pauseDialog.visible=!1,this.makeTutorial&&(this.tutorialDialog=new j,this.addChild(this.tutorialDialog),this.tutorialDialog.visible=!1),k.globalButtonSounds.addButton(this.pauseButton),k.on("resize",this.onResize)},l.setTimer=function(a){if((0|a)!=this.lastTime){this.lastTime=0|a;var b=Math.floor(a/60).toString()+":";a%=60,b+=Math.floor(a).toPaddedString(),this.timer.text=b}},l.showRewardDialog=function(){this.rewardDialog.time.text=this.timer.text,this.rewardDialog.visible=this.blocker.visible=!0,this.moveButton&&(this.moveButton.visible=this.jumpButton.visible=!1)},l.showPauseDialog=function(){this.pauseDialog.visible=this.blocker.visible=!0,this.moveButton&&(this.moveButton.visible=this.jumpButton.visible=!1)},l.hidePauseDialog=function(){this.pauseDialog.visible=this.blocker.visible=!1,this.moveButton&&(this.moveButton.visible=this.jumpButton.visible=!0)},l.showTutorialDialog=function(a){this._tutorialCallback=a,this.tutorialDialog.open(),this.tutorialDialog.visible=this.blocker.visible=!0},l.hideTutorialDialog=function(){this.tutorialDialog.close(),this.removeChild(this.tutorialDialog),this.tutorialDialog=null,this.blocker.visible=!1,this._tutorialCallback(),this._tutorialCallback=null},l.onResize=function(a,b){this.blocker.scale.x=a/100,this.blocker.scale.y=b/100},l.teardown=function(){var a=b.instance;a.off("resize",this.onResize),a.globalButtonSounds.removeButton(this.pauseButton),this.removeChildren(),this.worldContainer.destroy(),this.collectionPanel.destroy(),this.timer.destroy(),this.pauseButton.destroy(),this.blocker.destroy(),this.pauseDialog.destroy(),this.rewardDialog.destroy(),this.tutorialDialog&&this.tutorialDialog.destroy(),this.jumpButton&&(this.jumpButton.destroy(),this.moveButton.destroy()),this.worldContainer=this.collectionPanel=this.timer=this.pauseButton=this.blocker=this.pauseDialog=this.rewardDialog=this.tutorialDialog=this.jumpButton=this.moveButton=null},namespace("nature").GamePanel=k}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("springroll.pixi.Button"),d=function(){a.call(this)},e=extend(d,a);e.setup=function(){var a=b.instance,d=a.config.buttons.skipButton,e=d.imageSettings;d.label.text="SKIP",this.skipButton=new c(e,d.label),this.addChild(this.skipButton),a.globalButtonSounds.addButton(this.skipButton)},e.teardown=function(){b.instance.globalButtonSounds.removeButton(this.skipButton),this.removeChildren(),this.skipButton.destroy(),this.skipButton=null},namespace("nature").IntroPanel=d}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("nature.MissionRecord"),e=include("springroll.pixi.IconButton"),f=function(){a.call(this),this.config=null,this.levelIndex=null},g=extend(f,a);g.setup=function(){var a=this.config,f=b.instance;this.background=new c(f.getCache(a.background.id)),this.addChild(this.background);var g=new(include(a.art));g.framerate=30,g.stop(),g.x=a.pos.x,g.y=a.pos.y,g.scale.x=a.scale.x,g.scale.y=a.scale.y,this.addChild(g),this.character=g;var h=f.saveData;h.times.length<=this.levelIndex||(this.missionRecord=new d(this.levelIndex),this.addChild(this.missionRecord),this.missionRecord.x=a.recordPos.x,this.missionRecord.y=a.recordPos.y);var i=f.config.buttons.playButton,j=i.imageSettings;i.label.text="PLAY",this.playButton=new e(j,i.label,i.icon),this.addChild(this.playButton),i=f.config.buttons.backButton,j=i.imageSettings,i.label.text="BACK",this.backButton=new e(j,i.label,i.icon),this.addChild(this.backButton),f.globalButtonSounds.addButton(this.backButton),f.globalButtonSounds.addButton(this.playButton)},g.teardown=function(){var a=b.instance;a.globalButtonSounds.removeButton(this.backButton),a.globalButtonSounds.removeButton(this.playButton),this.removeChildren(),this.background.destroy(),this.character.destroy(),this.playButton.destroy(),this.backButton.destroy(),this.character=this.background=this.playButton=this.backButton=null},namespace("nature").MissionPanel=f}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("nature.SelectButton"),e=include("springroll.pixi.Button"),f=function(){a.call(this),this.onResize=this.onResize.bind(this),this.highlightButtons=this.highlightButtons.bind(this),this.unhighlightButtons=this.unhighlightButtons.bind(this)},g=extend(f,a);g.setup=function(){var f=b.instance;this.backgroundScaler=new a,this.addChild(this.backgroundScaler),this.backgroundScaler.useBoundsForSize=!1,this.background=new c(f.getCache("SelectBG")),this.backgroundScaler.addChild(this.background),this.characters=new a,this.backgroundScaler.addChild(this.characters),this.buttons=[],this.animals=[];var g=f.config.selectLayout;for(var h in g){var i=g[h];if(i.levelIndex<=f.saveData.times.length){var j=new(include(i.art));j.framerate=30,j.gotoAndStop("idleLevelSelect");var k=j.children.last();j.hitArea=k.nominalBounds.clone(),j.hitArea.x*=Math.abs(k.scale.x),j.hitArea.width*=Math.abs(k.scale.x),j.hitArea.y*=Math.abs(k.scale.y),j.hitArea.height*=Math.abs(k.scale.y),j.x=i.pos.x,j.y=i.pos.y,j.scale.x=i.scale.x,j.scale.y=i.scale.y,j.levelIndex=i.levelIndex,j.character=i.id,j.interactive=j.buttonMode=!0,this.characters.addChild(j),this.animals.push(j);var l=new d;l.setup(i),l.x+=j.x,l.y+=j.y,this.characters.addChild(l),this.buttons.push(l)}}var m=f.config.buttons.arrowButton;this.leftButton=new e(m),this.addChild(this.leftButton),this.rightButton=new e(m),this.addChild(this.rightButton),this.minPan=0;var n=f.display.width/f.scaling.scale;this.maxPan=this.background.width-n,this.setPan(0),f.on("resize",this.onResize,-2),f.globalButtonSounds.addButton(this.buttons),f.globalButtonSounds.addButton(this.leftButton),f.globalButtonSounds.addButton(this.rightButton)},g.centerOnPos=function(a){var c=b.instance,d=c.display.width/c.scaling.scale;this.setPan(a-d/2)},g.setPan=function(a){this._pan=Math.clamp(a,this.minPan,this.maxPan),this.background.x=this.characters.x=-this._pan,this.leftButton.visible=this.leftButton.enabled=this._pan>this.minPan,this.rightButton.visible=this.rightButton.enabled=this._pan<this.maxPan},g.changePan=function(a){this.setPan(this._pan+a)},g.onResize=function(a,c){var d=b.instance,e=a/d.scaling.scale;this.maxPan=this.background.width-e,this.setPan(this._pan)},g.isAnimalOffscreen=function(a){if(a.x<this._pan)return!0;var c=b.instance,d=c.display.width/c.scaling.scale;return a.x>this._pan+d?!0:!1},g.highlightButtons=function(){this.leftButton.visible=this.leftButton.highlighted=!0,this.rightButton.visible=this.rightButton.highlighted=!0},g.unhighlightButtons=function(){this.leftButton.highlighted=!1,this.rightButton.highlighted=!1,this.leftButton.visible=this._pan>this.minPan,this.rightButton.visible=this._pan<this.maxPan},g.teardown=function(){var a=b.instance;a.off("resize",this.onResize),a.globalButtonSounds.removeButton(this.buttons),a.globalButtonSounds.removeButton(this.leftButton),a.globalButtonSounds.removeButton(this.rightButton),this.removeChildren(),this.background.destroy();for(var c=0;c<this.buttons.length;++c)this.buttons[c].destroy(),this.animals[c].destroy();this.characters.destroy(),this.rightButton.destroy(),this.leftButton.destroy(),this.characters=this.background=this.buttons=this.animals=this.rightButton=this.leftButton=null},namespace("nature").SelectPanel=f}(),function(){var a=include("PIXI.Container"),b=include("springroll.Application"),c=include("PIXI.Sprite"),d=include("springroll.pixi.IconButton"),e=function(){a.call(this)},f=extend(e,a);f.setup=function(){var a=b.instance;this.background=new c(a.getCache("TitleBG"));var e=a.config.buttons.playButton,f=e.imageSettings;e.label.text="PLAY",this.playButton=new d(f,e.label,e.icon),this.addChild(this.background),this.addChild(this.playButton),a.globalButtonSounds.addButton(this.playButton)},f.teardown=function(){b.instance.globalButtonSounds.removeButton(this.playButton),this.removeChildren(),this.background.destroy(),this.playButton.destroy(),this.background=this.playButton=null},namespace("nature").TitlePanel=e}(),function(){var a=include("springroll.State"),b=function(b){a.call(this,new nature.EndPanel,b),this.onOKButton=this.onOKButton.bind(this),this.onLoaded=this.onLoaded.bind(this),this.update=this.update.bind(this),this.on("loaded",this.onLoaded)},c=a.prototype,d=extend(b,a);d.onLoaded=function(){this.panel.setup()},d.enterDone=function(){this.app.music="Adventure_MenuLoop",this.app.saveData.didEndScreen=!0,this.app.save(),this.panel.okButton.on("buttonPress",this.onOKButton),this.app.on("update",this.update),this.panel.confetti.emit=!0,this.app.voPlayer.play("NCat_AmazingWork")},d.onOKButton=function(){this.manager.state="select"},d.update=function(a){this.panel.confetti.update(a/1e3)},d.exitStart=function(){this.app.voPlayer.stop(),this.app.off("update",this.update),this.panel.okButton.off("buttonPress",this.onOKButton)},d.exit=function(){this.panel.okButton.off("buttonPress",this.onOKButton),c.exit.call(this),this.panel.teardown()},d.destroy=function(){c.destroy.call(this),this.onOKButton=null},namespace("nature").EndState=b}(),function(){var a=include("springroll.State"),b=include("springroll.TiledParser"),c=function(b){a.call(this,new nature.GamePanel,b),this.update=this.update.bind(this),this.endLevel=this.endLevel.bind(this),this.onLoading=this.onLoading.bind(this),this.onLoaded=this.onLoaded.bind(this),this.onOkButton=this.onOkButton.bind(this),this.onReplayButton=this.onReplayButton.bind(this),this.onPause=this.onPause.bind(this),this.onQuit=this.onQuit.bind(this),this.onUnpause=this.onUnpause.bind(this),this.on("loading",this.onLoading),this.on("loaded",this.onLoaded),this.levelIndex=-1,this.app.options.level&&(this.levelIndex=parseInt(this.app.options.level))},d=a.prototype,e=extend(c,a);e.onLoading=function(a){this.exiting=!1;var b=this.app;b.music=null;var c;c=this.levelIndex<0?this.levelConfig=b.config.levels[0]:this.levelConfig=b.config.levels[this.levelIndex];for(var d=0;d<c.assets.length;++d)a.push(c.assets[d]);c.showTutorial&&b.saveData.times.length<=this.levelIndex?(this.panel.makeTutorial=!0,b.hasTouch?a.push(b.config.assets.tutorials.mobile):a.push(b.config.assets.tutorials.desktop)):this.panel.makeTutorial=!1},e.onLoaded=function(){var a=this.app,c=this.panel;c.setup(),c.rewardDialog.okButton.on("buttonPress",this.onOkButton),c.rewardDialog.replayButton.on("buttonPress",this.onReplayButton),c.pauseDialog.playButton.on("buttonPress",this.onUnpause),c.pauseDialog.replayButton.on("buttonPress",this.onReplayButton),c.pauseDialog.quitButton.on("buttonPress",this.onQuit),c.pauseButton.on("buttonPress",this.onPause);var d=this.levelConfig.levelTarget;c.collectionPanel.init(a.config.objects[d.object],d.number);var e={ForestTerrain:a.getCache("ForestTerrain_tileset"),ForestObjects:a.getCache("ForestObjects_tileset")};this.level=new nature.Level(this.levelConfig,b.parse(a.getCache("LEVEL_DATA"),e)),c.worldZoomContainer.addChild(this.level.background),c.worldZoomContainer.addChild(this.level),this.camera=new nature.Camera(this.level,c.worldZoomContainer),this.levelTimer=0,c.setTimer(this.levelTimer)},e.enterDone=function(){this.app.music="Adventure_GameLoop",this.panel.tutorialDialog?this.panel.showTutorialDialog(this.startGame.bind(this)):this.startGame()},e.startGame=function(){this._isPaused=!1,this.app.on("update",this.update),this.level.player.collectionPanel=this.panel.collectionPanel,this.level.start(),this.level.goalCharacter.once("levelComplete",this.endLevel),this.levelConfig.levelStartVO&&this.app.voPlayer.play(this.levelConfig.levelStartVO)},e.update=function(a){if(!this._isPaused){var b=a/1e3;this.levelTimer+=b,this.panel.setTimer(this.levelTimer),this.level.update(b),this.camera.update()}},e.endLevel=function(){this.app.off("update",this.update),this.level.end();var a=this.app.config.levels.indexOf(this.levelConfig),b=this.app.saveData;b.times.length<=a&&a<this.app.config.levels.length-1&&(this.app.states.select.hasNewAnimal=!0);var c=0|this.levelTimer;(b.times.length<=a||b.times[a]>c)&&(b.times[a]=c,this.app.save());var d,e,f=this.levelConfig;c<=f.times[1]?(d=["NCat_AmazingJob","NCat_MedalGold"],e="gold"):c<=f.times[0]?(d=["NCat_GreatJob","NCat_MedalSilver"],e="silver"):(d=["NCat_NiceJob","NCat_MedalBronze"],e="bronze"),this.app.voPlayer.play(d),this.panel.rewardDialog.setRewardLevel(e),this.panel.showRewardDialog()},e.onPause=function(){this._isPaused=!0,this.panel.showPauseDialog(),this.level.pause()},e.onUnpause=function(){this._isPaused=!1,this.panel.hidePauseDialog(),this.level.unpause()},e.onReplayButton=function(){this.exiting||(this.exiting=!0,this.manager.refresh())},e.onOkButton=function(){if(!this.exiting){this.exiting=!0;var a=this.app;a.saveData.times.length!=a.config.levels.length||a.saveData.didEndScreen?this.manager.state="select":this.manager.state="end"}},e.onQuit=function(){this.exiting||(this.exiting=!0,this.manager.state="select")},e.exitStart=function(){this.app.voPlayer.stop(),this.app.off("update",this.update),this.app.music=null},e.exit=function(){this.level.destroy(),this.camera.destroy(),this.level=this.camera=null,this.app.unload(this.levelConfig.assets),this.panel.teardown(),d.exit.call(this)},e.destroy=function(){d.destroy.call(this)},namespace("nature").GameState=c}(),function(){var a=include("springroll.State"),b=function(b){a.call(this,new nature.IntroPanel,b),this.onIntroSkipped=this.onIntroSkipped.bind(this),this.onIntroFinished=this.onIntroFinished.bind(this),this.on("loaded",this.onLoaded)},c=a.prototype,d=extend(b,a);d.onLoaded=function(){this.panel.setup(),this.panel.skipButton.on("buttonPress",this.onIntroSkipped),this.cutscene=this.app.getCache("Intro");var a=this.app.getDisplay("cutscene");a.stage.addChild(this.cutscene),a.visible=!0,a.paused=!1,a.render(0),a.paused=!0,this.app.music=null,this.done=!1},d.enterDone=function(){this.cutscene.start(this.onIntroFinished),this.app.getDisplay("cutscene").paused=!1},d.onIntroSkipped=function(){this.done||(this.cutscene.stop(),this.onIntroFinished())},d.onIntroFinished=function(){this.done=!0,this.app.getDisplay("cutscene").paused=!0,this.manager.state="select"},d.exit=function(){c.exit.call(this),this.panel.teardown(),this.cutscene=null,window.images={},window.lib={},this.app.getDisplay("cutscene").visible=!1},d.destroy=function(){var a=this.panel;c.destroy.call(this),a.destroy&&a.destroy()},namespace("nature").IntroState=b}(),function(){var a=include("springroll.State"),b=include("springroll.DelayedCall"),c=function(b){a.call(this,new nature.MissionPanel,b),this.onPlayButton=this.onPlayButton.bind(this),this.onBackButton=this.onBackButton.bind(this),this.highlight=this.highlight.bind(this),this.unhighlight=this.unhighlight.bind(this),this.goToGame=this.goToGame.bind(this),this.on("loading",this.onLoading.bind(this)),this.on("loaded",this.onLoaded.bind(this)),this.config=null,this.levelIndex=null},d=a.prototype,e=extend(c,a);e.onLoading=function(a){a.push(this.config.background);for(var b=0;b<this.config.characterAssets.length;++b)a.push(this.config.characterAssets[b])},e.onLoaded=function(){this.panel.config=this.config,this.panel.levelIndex=this.levelIndex,this.panel.setup(),this.panel.character.gotoAndStop("idleMission"),this.panel.playButton.on("buttonPress",this.onPlayButton),this.panel.backButton.on("buttonPress",this.onBackButton)},e.enterDone=function(){if(this.app.saveData.times.length<1){var a=[this.config.vo,this.highlight,"NCat_UseButtonStartMission"];this.app.voPlayer.play(a,this.unhighlight,this.unhighlight)}else this.app.voPlayer.play(this.config.vo);this.app.animator.play(this.panel.character,"idleMission")},e.highlight=function(){this.panel.playButton.highlighted=!0,new b(this.highlightBack.bind(this),1500)},e.highlightBack=function(){this.panel.backButton.highlighted=!0,this.panel.playButton.highlighted=!1},e.unhighlight=function(){this.panel.playButton.highlighted=!1,this.panel.backButton.highlighted=!1},e.onPlayButton=function(a){this.panel.playButton.enabled=!1,this.panel.backButton.enabled=!1,this.app.voPlayer.play(this.app.config.missionGoVO.random(),this.goToGame)},e.goToGame=function(){this.manager.state="game"},e.onBackButton=function(a){this.manager.state="select"},e.exitStart=function(){this.app.voPlayer.stop(),this.app.animator.stop(this.panel.character)},e.exit=function(){this.panel.teardown(),this.app.unload(this.config.characterAssets),this.app.unload(this.config.background.id),d.exit.call(this)},e.destroy=function(){d.destroy.call(this),this.onBackButton=this.onPlayButton=null},namespace("nature").MissionState=c}(),function(){var a=include("springroll.State"),b=function(b){a.call(this,new nature.SelectPanel,b),this.onGameButton=this.onGameButton.bind(this),this.onLeftButtonDown=this.onLeftButtonDown.bind(this),this.onLeftButtonUp=this.onLeftButtonUp.bind(this),this.onRightButtonDown=this.onRightButtonDown.bind(this),this.onRightButtonUp=this.onRightButtonUp.bind(this),this.update=this.update.bind(this),this.on("loaded",this.onLoaded.bind(this)),this.hasNewAnimal=!1,this.panSpeed=this.app.config.select.panSpeed},c=a.prototype,d=extend(b,a);d.onLoaded=function(){var a=this.panel;a.setup(),this.isLeftDown=this.isRightDown=!1,a.leftButton.on("mousedown",this.onLeftButtonDown),a.leftButton.on("touchstart",this.onLeftButtonDown),a.leftButton.on("mouseup",this.onLeftButtonUp),a.leftButton.on("touchend",this.onLeftButtonUp),a.leftButton.on("mouseupoutside",this.onLeftButtonUp),a.leftButton.on("touchendoutside",this.onLeftButtonUp),a.rightButton.on("mousedown",this.onRightButtonDown),a.rightButton.on("touchstart",this.onRightButtonDown),a.rightButton.on("mouseup",this.onRightButtonUp),a.rightButton.on("touchend",this.onRightButtonUp),a.rightButton.on("mouseupoutside",this.onRightButtonUp),a.rightButton.on("touchendoutside",this.onRightButtonUp);var b,c=this.app.states.game.levelIndex,d=a.background.width/2,e=a.buttons,f=a.animals;for(b=0;b<e.length;++b)e[b].on("buttonPress",this.onGameButton),f[b].on("click",this.onGameButton),f[b].on("tap",this.onGameButton),(f[b].levelIndex==c||this.app.saveData.times.length<1)&&(d=f[b].x);for(a.centerOnPos(d),this.hasAnimalOffscreen=!1,b=0;b<f.length;++b)if(a.isAnimalOffscreen(f[b])){this.hasAnimalOffscreen=!0;break}this.choseLevel=!1},d.enterDone=function(){var a=this.app,b=[];if(a.saveData.times.length<1)b.push("NCat_NeedsOurHelp","NCat_AcornMission"+(a.hasTouch?"Tap":"Click"));else if(this.hasNewAnimal){switch(this.hasNewAnimal=!1,Math.randomInt(1,3)){case 1:b.push("NCat_NewAnimal");break;case 2:b.push("NCat_AnotherAnimal");break;case 3:b.push(a.config.selectLayout[this.panel.animals.last().character].vo)}b.push("NCat_SeeWhatTheyNeed")}!a.saveData.didPanVO&&this.hasAnimalOffscreen&&(a.saveData.didPanVO=!0,a.save(),b.push(this.panel.highlightButtons,"NCat_ButtonsLeftRight",this.panel.unhighlightButtons)),b.length&&a.voPlayer.play(b);var c,d=this.panel.animals;for(c=0;c<d.length;++c)a.animator.play(d[c],"idleLevelSelect");a.on("update",this.update),a.music="Adventure_MenuLoop"},d.onGameButton=function(a){if(!this.choseLevel){a.character||(a=a.target),this.app.states.game.levelIndex=a.levelIndex;var b=this.app.states.mission;b.config=this.app.config.missionLayout[a.character],b.levelIndex=a.levelIndex,this.choseLevel=!0,this.manager.state="mission"}},d.onLeftButtonDown=function(){this.isLeftDown=!0},d.onLeftButtonUp=function(){this.isLeftDown=!1},d.onRightButtonDown=function(){this.isRightDown=!0},d.onRightButtonUp=function(){this.isRightDown=!1},d.update=function(a){this.isRightDown?(this.panel.changePan(a/1e3*this.panSpeed),this.panel.rightButton.visible||(this.isRightDown=!1)):this.isLeftDown&&(this.panel.changePan(a/1e3*-this.panSpeed),this.panel.leftButton.visible||(this.isLeftDown=!1))},d.exitStart=function(){var a=this.app;a.voPlayer.stop(),a.off("update",this.update);var b,c=this.panel.animals;for(b=0;b<c.length;++b)a.animator.stop(c[b])},d.exit=function(){this.panel.teardown(),c.exit.call(this)},d.destroy=function(){c.destroy.call(this),this.onGameButton=null},namespace("nature").SelectState=b}(),function(){var a=include("springroll.State"),b=function(b){a.call(this,new nature.TitlePanel,b),this.onGameButton=this.onGameButton.bind(this),this.onLoaded=this.onLoaded.bind(this),this.on("loaded",this.onLoaded)},c=a.prototype,d=extend(b,a);d.onLoaded=function(){this.panel.setup()},d.enterDone=function(){this.panel.background.interactive=!0,this.panel.background.on("touchstart",this.onGameButton),this.panel.background.on("mousedown",this.onGameButton),this.panel.playButton.on("buttonPress",this.onGameButton),this.app.sound.systemMuted||(this.app.music="Adventure_MenuLoop")},d.onGameButton=function(){this.manager.state="intro"},d.exitStart=function(){this.panel.background.off("touchstart",this.onGameButton),this.panel.background.off("mousedown",this.onGameButton),
this.panel.playButton.off("buttonPress",this.onGameButton)},d.exit=function(){this.panel.background.off("touchstart",this.onGameButton),this.panel.background.off("mousedown",this.onGameButton),this.panel.playButton.off("buttonPress",this.onGameButton),c.exit.call(this),this.panel.teardown()},d.destroy=function(){c.destroy.call(this),this.onGameButton=null},namespace("nature").TitleState=b}(),function(){var a=include("springroll.Application"),b=include("springroll.pixi.PixiDisplay"),c=include("PIXI.utils");c.useFilenamesForTextures=!0;var d=new a({fps:30,name:"Nature Cat Adventure",useQueryString:!1,autoPause:window.top==window,configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",canvasId:"stage",display:b,displayOptions:{clearView:!0,transparent:!0,antiAlias:!0},preload:[{id:"ButtonAtlas",atlas:"assets/images/%SIZE%/ui/ButtonAtlas.json",image:"assets/images/%SIZE%/ui/ButtonAtlas.png"},{id:"ButtonBumstead",font:"assets/images/full/ui/ButtonBumstead.fnt",image:"assets/images/full/ui/ButtonBumstead.png"},{id:"Transition",format:"pixiflash.FlashArt",src:"assets/js/Transition.js",images:[{atlas:"assets/images/%SIZE%/ui/Transition.json",image:"assets/images/%SIZE%/ui/Transition.png"}]},{sounds:["TransitionEnd","TransitionBegining"]}],transitionSounds:{"in":"TransitionEnd",out:"TransitionBegining"}}),e="NC_Adventure_Save";d.once("loading",function(a){a.push({id:"saveLoad",cache:!1,async:function(a){this.userData.read(e,function(b){this.saveData=b,a()}.bind(this))}.bind(this)})}.bind(d)),d.once("init",function(){this.display.autoPreventDefault=this.hasTouch;var a=this.addDisplay("cutscene",springroll.EaselJSDisplay,{clearView:!1});a.enabled=!1,a.visible=!1,this.on("resize",f),this.saveData||(this.saveData={times:[],didPanVO:!1,didEndScreen:!1}),this.transition=new pixiflash_lib.Transition,this.transition.framerate=30;var b=this.config.scaling,c=this.config.assets;this.states={title:new nature.TitleState({scaling:b.title,preload:c.title}),intro:new nature.IntroState({scaling:b.intro,preload:[this.config.introCutscene],delayLoad:4}),select:new nature.SelectState({delayLoad:4,scaling:b.select,preload:c.select}),mission:new nature.MissionState({delayLoad:4,scaling:b.mission,preload:c.mission}),game:new nature.GameState({delayLoad:4,scaling:b.game,preload:this.hasTouch?[].concat(c.game,c.mobileButtons):c.game}),end:new nature.EndState({scaling:b.end,preload:c.end})},this.globalButtonSounds=new springroll.ButtonSounds("ButtonClick","ButtonRollover"),this.options.state||(this.manager.state="title")}),d.save=function(){this.userData.write(e,this.saveData)};var f=function(a,b){var c=document.getElementById("container");c.style.width=a+"px",c.style.height=b+"px"}}();