pc.script.attribute("textureAsset","asset",[],{type:"texture",max:1}),pc.script.attribute("x","number"),pc.script.attribute("y","number"),pc.script.attribute("width","number"),pc.script.attribute("height","number"),pc.script.attribute("depth","number",1),pc.script.attribute("uPercentage","number",1),pc.script.attribute("vPercentage","number",1),pc.script.attribute("rotation","number",0),pc.script.attribute("anchor","enumeration",0,{enumerations:[{name:"topLeft",value:0},{name:"top",value:1},{name:"topRight",value:2},{name:"left",value:3},{name:"center",value:4},{name:"right",value:5},{name:"bottomLeft",value:6},{name:"bottom",value:7},{name:"bottomRight",value:8}]}),pc.script.attribute("pivot","enumeration",0,{enumerations:[{name:"topLeft",value:0},{name:"top",value:1},{name:"topRight",value:2},{name:"left",value:3},{name:"center",value:4},{name:"right",value:5},{name:"bottomLeft",value:6},{name:"bottom",value:7},{name:"bottomRight",value:8}]}),pc.script.attribute("tint","rgba",[1,1,1,1]),pc.script.attribute("maxResHeight","number",560),pc.script.create("sprite",function(a){var b=null,c=null,d=new pc.Vec2,e=function(a){this.entity=a};return e.prototype={initialize:function(){var e=document.getElementById("application-canvas");this.userOffset=new pc.Vec2,this.offset=new pc.Vec2,this.scaling=new pc.Vec2,this.anchorOffset=new pc.Vec2,this.pivotOffset=new pc.Vec2,this.rotationVec2=new pc.Vec2;var f=a.graphicsDevice;if(!b){var g={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:["attribute vec2 aPosition;","attribute vec2 aUv0;","varying vec2 vUv0;","uniform vec2 uResolution;","uniform vec2 uOffset;","uniform vec2 uScale;","uniform vec2 u_rotation;","uniform vec2 pivot;","","void main(void)","{","    vec2 newPosition = vec2(aPosition.x, aPosition.y);","    newPosition.x = (newPosition.x + pivot.x) * uScale.x;","    newPosition.y = (newPosition.y + pivot.y) * uScale.y;","    vec2 rotatedPosition = vec2(newPosition.x * u_rotation.y + newPosition.y * u_rotation.x,","    newPosition.y * u_rotation.y - newPosition.x * u_rotation.x);","    vec2 newOffset = rotatedPosition - pivot * uScale + uOffset;","    gl_Position = vec4(2.0 * ((newOffset) / uResolution ) - 1.0, -0.9, 1.0);","    vUv0 = aUv0;","    ","}"].join("\n"),fshader:["precision "+f.precision+" float;","","varying vec2 vUv0;","","uniform vec4 vTint;","","uniform sampler2D uColorMap;","","uniform vec2 u_rotation;","","void main(void)","{","    vec4 color = texture2D(uColorMap, vUv0);","    gl_FragColor = vec4(color.rgb * vTint.rgb, color.a * vTint.a);","}"].join("\n")};b=new pc.Shader(f,g)}c||(c=new pc.VertexFormat(f,[{semantic:pc.SEMANTIC_POSITION,components:2,type:pc.ELEMENTTYPE_FLOAT32},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.ELEMENTTYPE_FLOAT32}]));var h=a.assets.get(this.textureAsset);h.ready(function(g){this.texture=g.resource,this.vertexBuffer=new pc.VertexBuffer(f,c,6,pc.BUFFER_DYNAMIC),this.updateSprite();var h=new pc.Command(pc.LAYER_HUD,pc.BLEND_NORMAL,function(){this.entity.enabled&&(f.setShader(b),f.setBlending(!0),f.setBlendFunction(pc.BLENDMODE_SRC_ALPHA,pc.BLENDMODE_ONE_MINUS_SRC_ALPHA),f.setDepthWrite(!1),f.setDepthTest(!1),d.set(e.offsetWidth,e.offsetHeight),f.scope.resolve("uResolution").setValue(d.data),f.scope.resolve("uScale").setValue(this.calculateScaling().data),f.scope.resolve("uOffset").setValue(this.calculateOffset().data),f.scope.resolve("uColorMap").setValue(this.texture),f.scope.resolve("vTint").setValue(this.tint.data),f.scope.resolve("u_rotation").setValue(this.calculateRotation().data),f.scope.resolve("pivot").setValue(this.calculatePivotOffset().data),f.setVertexBuffer(this.vertexBuffer,0),f.draw({type:pc.PRIMITIVE_TRIANGLES,base:0,count:6,indexed:!1}))}.bind(this));this.command=h,h.key=this.depth,a.scene.drawCalls.push(h)}.bind(this)),a.assets.load(h),a.mouse.on("mousedown",this.onMouseDown,this),a.touch&&a.touch.on("touchstart",this.onTouchDown,this)},onMouseDown:function(a){this.eventsEnabled&&this.onClick(a)},onTouchDown:function(a){this.eventsEnabled&&this.onClick(a.changedTouches[0])},onClick:function(b){var c,e,f,g,h,i,j=a.graphicsDevice.canvas,k=this.scaling,l=this.offset;c=2*(0*k.x+l.x)/d.x-1,e=2*(0*k.y+l.y)/d.y-1,f=2*(k.x*this.width+l.x)/d.x-1,g=2*(k.y*-this.height+l.y)/d.y-1,h=2*b.x/j.offsetWidth-1,i=2*(j.offsetHeight-b.y)/j.offsetHeight-1,h>=c&&f>=h&&e>=i&&i>=g&&this.fire("click")},onAttributeChanged:function(a,b,c){this.eventsEnabled=!1,"depth"===a?this.command.key=c:"width"!==a&&"height"!==a&&"uPercentage"!==a&&"vPercentage"!==a||this.updateSprite()},updateSprite:function(){if(this.vertexBuffer){this.vertexBuffer.lock();var b=(a.graphicsDevice.canvas,new pc.VertexIterator(this.vertexBuffer));b.element[pc.SEMANTIC_POSITION].set(0,-this.height),b.element[pc.SEMANTIC_TEXCOORD0].set(0,0),b.next(),b.element[pc.SEMANTIC_POSITION].set(this.width,-this.height),b.element[pc.SEMANTIC_TEXCOORD0].set(this.uPercentage,0),b.next(),b.element[pc.SEMANTIC_POSITION].set(0,0),b.element[pc.SEMANTIC_TEXCOORD0].set(0,this.vPercentage),b.next(),b.element[pc.SEMANTIC_POSITION].set(this.width,-this.height),b.element[pc.SEMANTIC_TEXCOORD0].set(this.uPercentage,0),b.next(),b.element[pc.SEMANTIC_POSITION].set(this.width,0),b.element[pc.SEMANTIC_TEXCOORD0].set(this.uPercentage,this.vPercentage),b.next(),b.element[pc.SEMANTIC_POSITION].set(0,0),b.element[pc.SEMANTIC_TEXCOORD0].set(0,this.vPercentage),this.vertexBuffer.unlock()}},calculateOffset:function(){var b=a.graphicsDevice.canvas;return this.calculateAnchorOffset(),this.calculatePivotOffset(),this.offset.set(this.x*this.scaling.x,this.y*this.scaling.y).add(this.userOffset).add(this.anchorOffset).add(this.pivotOffset),this.offset.y+=b.offsetHeight,this.offset},calculateScaling:function(){var b=a.graphicsDevice.canvas,c=b.offsetHeight/this.maxResHeight;return this.scaling.set(c,c),this.scaling},calculateAnchorOffset:function(){var b=a.graphicsDevice.canvas,c=b.offsetWidth,d=b.offsetHeight;switch(this.anchor){case 0:this.anchorOffset.set(0,0);break;case 1:this.anchorOffset.set(.5*c,0);break;case 2:this.anchorOffset.set(c,0);break;case 3:this.anchorOffset.set(0,.5*-d);break;case 4:this.anchorOffset.set(.5*c,.5*-d);break;case 5:this.anchorOffset.set(c,.5*-d);break;case 6:this.anchorOffset.set(0,-d);break;case 7:this.anchorOffset.set(c/2,-d);break;case 8:this.anchorOffset.set(c,-d);break;default:console.error("Wrong anchor: "+this.anchor)}return this.anchorOffset},calculatePivotOffset:function(){var a=this.width*this.scaling.x,b=this.height*this.scaling.y;switch(this.pivot){case 0:this.pivotOffset.set(0,0);break;case 1:this.pivotOffset.set(.5*-a,0);break;case 2:this.pivotOffset.set(-a,0);break;case 3:this.pivotOffset.set(0,.5*b);break;case 4:this.pivotOffset.set(.5*-a,.5*b);break;case 5:this.pivotOffset.set(-a,.5*b);break;case 6:this.pivotOffset.set(0,b);break;case 7:this.pivotOffset.set(-a/2,b);break;case 8:this.pivotOffset.set(-a,b);break;default:console.error("Wrong pivot: "+this.pivot)}return this.pivotOffset},calculateRotation:function(){var a=this.rotation*Math.PI/180;return this.rotationVec2.x=Math.sin(a),this.rotationVec2.y=Math.cos(a),this.rotationVec2},onEnable:function(){this.eventsEnabled=!1},onDisable:function(){this.eventsEnabled=!1},update:function(a){this.eventsEnabled=!0},destroy:function(){if(this.command){var b=a.scene.drawCalls.indexOf(this.command);b>=0&&a.scene.drawCalls.splice(b,1)}}},e});