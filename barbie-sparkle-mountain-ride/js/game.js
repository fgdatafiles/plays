(function(){function r(a,l){function b(){}b.prototype=a;var f=new b,d;for(d in l)f[d]=l[d];l.toString!==Object.prototype.toString&&(f.toString=l.toString);return f}function s(a,l){if(null==l)return null;null==l.__id__&&(l.__id__=W++);var b;null==a.hx__closures__?a.hx__closures__={}:b=a.hx__closures__[l.__id__];null==b&&(b=function(){return b.method.apply(b.scope,arguments)},b.scope=a,b.method=l,a.hx__closures__[l.__id__]=b);return b}var D=function(){return z.Boot.__string_rec(this,"")},K=function(a,
l){l=l.split("u").join("");this.r=RegExp(a,l)};K.__name__=["EReg"];K.prototype={replace:function(a,l){return a.replace(this.r,l)},__class__:K};var v=function(){};v.__name__=["HxOverrides"];v.cca=function(a,l){var b=a.charCodeAt(l);return b!=b?void 0:b};v.substr=function(a,l,b){if(null!=l&&0!=l&&null!=b&&0>b)return"";null==b&&(b=a.length);0>l?(l=a.length+l,0>l&&(l=0)):0>b&&(b=a.length+b-l);return a.substr(l,b)};v.indexOf=function(a,l,b){var f=a.length;0>b&&(b+=f,0>b&&(b=0));for(;b<f;){if(a[b]===l)return b;
b++}return-1};v.remove=function(a,l){var b=v.indexOf(a,l,0);if(-1==b)return!1;a.splice(b,1);return!0};var L=function(){this.length=0};L.__name__=["List"];L.prototype={add:function(a){a=[a];null==this.h?this.h=a:this.q[1]=a;this.q=a;this.length++},iterator:function(){return{h:this.h,hasNext:function(){return null!=this.h},next:function(){if(null==this.h)return null;var a=this.h[0];this.h=this.h[1];return a}}},__class__:L};var q=function(){};q.__name__=["Main"];q.main=function(){q.init()};q.loadScript=
function(a,l,b,f){var d;d=q.getDocument().createElement("script");d.type="text/javascript";d.async=!0;d.src=l;d.id=a;q.getDocument().body.appendChild(d);d.onload=b;d.onerror=f};q.validateBrowser=function(){var a=document.createElement("canvas");if(null==a.getContext||null==a.getContext("2d").fillText)return!1;a=window.audioContextInstance;return b.Root.isMobile()&&null==a?!1:!0};q.validateCookies=function(){return null!=z.Browser.getLocalStorage()&&null!=z.Browser.getSessionStorage()&&null!=navigator.cookieEnabled&&
navigator.cookieEnabled};q.init=function(){if(q.validateBrowser())if(q.validateCookies()){var a=q.getDocument();q.container=a.createElement("div");window.tabindex="0";q.container.style.position="relative";q.container.className="container";q.container.style.width=q.CANVAS_WIDTH_LANDSCAPE+"px";q.container.style.height=q.CANVAS_HEIGHT_LANDSCAPE+"px";q.getDocument().getElementById("game-container").appendChild(q.container);q.getWindow();q.dataBaseUrl=q.getContainer().parentElement.getAttribute("data-base-url");
q.dataWidth=t.parseFloat(q.getContainer().parentElement.getAttribute("data-width"));q.dataHeight=t.parseFloat(q.getContainer().parentElement.getAttribute("data-height"));a=q.getQueryStringValue(q.getWindow().location.href,"locale");""==a&&(a="en-us");q.dataLocale=a;q._prevDataWidth=q.dataWidth;q._prevDataHeight=q.dataHeight;b.audio.SoundManager.init();q.root=new b.Root("barbie_dreamtopia_cart_game",new c.boot.BootState);q.root.init();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||function(a){a=b.Root.isMobile()?q.TARGET_FPS_MOBILE:q.TARGET_FPS;window.setTimeout(q.update,1E3/a)}}();q.update()}else window.location.href="cookies.html";else window.location.href="unsupported.html"};q.getQueryStringValue=function(a,l){var b=a.split("?");if(2>b.length)return"";for(var b=b[1].split("&"),f=b.length,d=0;d<f;){var c=d++;if(C.startsWith(b[c],l)&&(c=b[c].split("="),!(2>c.length)))return c[1]}return""};q.update=function(){q.root.fixedUpdate();q.root.update();
q.root.render();q.root.postUpdate();"1"==b.GameConfig.getProperty("debugDraw")&&q.root.debugRender();q.dataWidth=t.parseFloat(q.getContainer().parentElement.getAttribute("data-width"));q.dataHeight=t.parseFloat(q.getContainer().parentElement.getAttribute("data-height"));if(q.dataWidth!=q._prevDataWidth||q.dataHeight!=q._prevDataHeight)q.root.onResizeWindow(),q._prevDataWidth=q.dataWidth,q._prevDataHeight=q.dataHeight;window.requestAnimFrame(q.update)};q.getDocument=function(){return window.document};
q.getWindow=function(){return window};q.getCanvas=function(){return q.canvas};q.getContainer=function(){return q.container};q.getBasePath=function(){for(var a=window.location.href.split("/"),l="",b=0,f=a.length-1;b<f;)var d=b++,l=l+(a[d]+"/");return l};var N=function(){};N.__name__=["IMap"];Math.__name__=["Math"];var H=function(){};H.__name__=["Reflect"];H.field=function(a,l){try{return a[l]}catch(b){return null}};H.setProperty=function(a,l,b){var f;if(a.__properties__&&(f=a.__properties__["set_"+
l]))a[f](b);else a[l]=b};H.isFunction=function(a){return"function"==typeof a&&!(a.__name__||a.__ename__)};H.compareMethods=function(a,l){return a==l?!0:H.isFunction(a)&&H.isFunction(l)?a.scope==l.scope&&a.method==l.method&&null!=a.method:!1};var t=function(){};t.__name__=["Std"];t.string=function(a){return z.Boot.__string_rec(a,"")};t["int"]=function(a){return a|0};t.parseInt=function(a){var l=parseInt(a,10);0!=l||120!=v.cca(a,1)&&88!=v.cca(a,1)||(l=parseInt(a));return isNaN(l)?null:l};t.parseFloat=
function(a){return parseFloat(a)};var M=function(){this.b=""};M.__name__=["StringBuf"];M.prototype={add:function(a){this.b+=t.string(a)},addSub:function(a,l,b){this.b=null==b?this.b+v.substr(a,l,null):this.b+v.substr(a,l,b)},__class__:M};var C=function(){};C.__name__=["StringTools"];C.startsWith=function(a,l){return a.length>=l.length&&v.substr(a,0,l.length)==l};C.isSpace=function(a,l){var b=v.cca(a,l);return 8<b&&14>b||32==b};C.ltrim=function(a){for(var l=a.length,b=0;b<l&&C.isSpace(a,b);)b++;return 0<
b?v.substr(a,b,l-b):a};C.rtrim=function(a){for(var l=a.length,b=0;b<l&&C.isSpace(a,l-b-1);)b++;return 0<b?v.substr(a,0,l-b):a};C.trim=function(a){return C.ltrim(C.rtrim(a))};C.replace=function(a,l,b){return a.split(l).join(b)};C.fastCodeAt=function(a,l){return a.charCodeAt(l)};var G=function(){};G.__name__=["Type"];G.getClass=function(a){return null==a?null:a instanceof Array&&null==a.__enum__?Array:a.__class__};G.getSuperClass=function(a){return a.__super__};G.getClassName=function(a){return a.__name__.join(".")};
G.createEnum=function(a,l,b){var f=H.field(a,l);if(null==f)throw"No such constructor "+l;if(H.isFunction(f)){if(null==b)throw"Constructor "+l+" need parameters";return f.apply(a,b)}if(null!=b&&0!=b.length)throw"Constructor "+l+" does not need parameters";return f};G.allEnums=function(a){return a.__empty_constructs__};var B=function(){};B.__name__=["Xml"];B.parse=function(a){return w.xml.Parser.parse(a)};B.createElement=function(a){var l=new B;l.nodeType=B.Element;l._children=[];l._attributes=new w.ds.StringMap;
l.set_nodeName(a);return l};B.createPCData=function(a){var l=new B;l.nodeType=B.PCData;l.set_nodeValue(a);return l};B.createCData=function(a){var l=new B;l.nodeType=B.CData;l.set_nodeValue(a);return l};B.createComment=function(a){var l=new B;l.nodeType=B.Comment;l.set_nodeValue(a);return l};B.createDocType=function(a){var l=new B;l.nodeType=B.DocType;l.set_nodeValue(a);return l};B.createProcessingInstruction=function(a){var l=new B;l.nodeType=B.ProcessingInstruction;l.set_nodeValue(a);return l};B.createDocument=
function(){var a=new B;a.nodeType=B.Document;a._children=[];return a};B.prototype={get_nodeName:function(){if(this.nodeType!=B.Element)throw"bad nodeType";return this._nodeName},set_nodeName:function(a){if(this.nodeType!=B.Element)throw"bad nodeType";return this._nodeName=a},get_nodeValue:function(){if(this.nodeType==B.Element||this.nodeType==B.Document)throw"bad nodeType";return this._nodeValue},set_nodeValue:function(a){if(this.nodeType==B.Element||this.nodeType==B.Document)throw"bad nodeType";
return this._nodeValue=a},get:function(a){if(this.nodeType!=B.Element)throw"bad nodeType";return this._attributes.get(a)},set:function(a,l){if(this.nodeType!=B.Element)throw"bad nodeType";this._attributes.set(a,l)},exists:function(a){if(this.nodeType!=B.Element)throw"bad nodeType";return this._attributes.exists(a)},iterator:function(){if(null==this._children)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){return this.cur<this.x.length},next:function(){return this.x[this.cur++]}}},
elementsNamed:function(a){if(null==this._children)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){for(var l=this.cur,b=this.x.length;l<b;){var f=this.x[l];if(f.nodeType==B.Element&&f._nodeName==a)break;l++}this.cur=l;return l<b},next:function(){for(var l=this.cur,b=this.x.length;l<b;){var f=this.x[l];l++;if(f.nodeType==B.Element&&f._nodeName==a)return this.cur=l,f}return null}}},firstChild:function(){if(null==this._children)throw"bad nodetype";return this._children[0]},addChild:function(a){if(null==
this._children)throw"bad nodetype";null!=a._parent&&v.remove(a._parent._children,a);a._parent=this;this._children.push(a)},__class__:B,__properties__:{set_nodeValue:"set_nodeValue",get_nodeValue:"get_nodeValue",set_nodeName:"set_nodeName",get_nodeName:"get_nodeName"}};var d={collision:{}};d.collision.B2AABB=function(){this.lowerBound=new d.common.math.B2Vec2;this.upperBound=new d.common.math.B2Vec2};d.collision.B2AABB.__name__=["box2D","collision","B2AABB"];d.collision.B2AABB.prototype={isValid:function(){var a=
this.upperBound.y-this.lowerBound.y;return a=(a=0<=this.upperBound.x-this.lowerBound.x&&0<=a)&&this.lowerBound.isValid()&&this.upperBound.isValid()},getCenter:function(){return new d.common.math.B2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},getExtents:function(){return new d.common.math.B2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},contains:function(a){var l;return l=(l=(l=(l=this.lowerBound.x<=a.lowerBound.x)&&
this.lowerBound.y<=a.lowerBound.y)&&a.upperBound.x<=this.upperBound.x)&&a.upperBound.y<=this.upperBound.y},rayCast:function(a,l){var b=-Number.MAX_VALUE,f=Number.MAX_VALUE,d=l.p1.x,c=l.p1.y,h=l.p2.x-l.p1.x,k=l.p2.y-l.p1.y,m=Math.abs(h),p=Math.abs(k),u=a.normal;if(m<Number.MIN_VALUE){if(d<this.lowerBound.x||this.upperBound.x<d)return!1}else if(m=1/h,h=(this.lowerBound.x-d)*m,d=(this.upperBound.x-d)*m,m=-1,h>d&&(m=h,h=d,d=m,m=1),h>b&&(u.x=m,u.y=0,b=h),f=Math.min(f,d),b>f)return!1;if(p<Number.MIN_VALUE){if(c<
this.lowerBound.y||this.upperBound.y<c)return!1}else if(m=1/k,h=(this.lowerBound.y-c)*m,d=(this.upperBound.y-c)*m,m=-1,h>d&&(m=h,h=d,d=m,m=1),h>b&&(u.y=m,u.x=0,b=h),f=Math.min(f,d),b>f)return!1;a.fraction=b;return!0},testOverlap:function(a){var l=a.lowerBound.y-this.upperBound.y,b=this.lowerBound.y-a.upperBound.y;return 0<a.lowerBound.x-this.upperBound.x||0<l||0<this.lowerBound.x-a.upperBound.x||0<b?!1:!0},combine:function(a,l){this.lowerBound.x=Math.min(a.lowerBound.x,l.lowerBound.x);this.lowerBound.y=
Math.min(a.lowerBound.y,l.lowerBound.y);this.upperBound.x=Math.max(a.upperBound.x,l.upperBound.x);this.upperBound.y=Math.max(a.upperBound.y,l.upperBound.y)},__class__:d.collision.B2AABB};d.common={};d.common.math={};d.common.math.B2Vec2=function(a,l){null==l&&(l=0);null==a&&(a=0);this.x=a;this.y=l};d.common.math.B2Vec2.__name__=["box2D","common","math","B2Vec2"];d.common.math.B2Vec2.make=function(a,l){return new d.common.math.B2Vec2(a,l)};d.common.math.B2Vec2.prototype={setZero:function(){this.y=
this.x=0},set:function(a,l){null==l&&(l=0);null==a&&(a=0);this.x=a;this.y=l},setV:function(a){this.x=a.x;this.y=a.y},getNegative:function(){return new d.common.math.B2Vec2(-this.x,-this.y)},negativeSelf:function(){this.x=-this.x;this.y=-this.y},copy:function(){return new d.common.math.B2Vec2(this.x,this.y)},add:function(a){this.x+=a.x;this.y+=a.y},subtract:function(a){this.x-=a.x;this.y-=a.y},multiply:function(a){this.x*=a;this.y*=a},mulM:function(a){var l=this.x;this.x=a.col1.x*l+a.col2.x*this.y;
this.y=a.col1.y*l+a.col2.y*this.y},mulTM:function(a){var l=d.common.math.B2Math.dot(this,a.col1);this.y=d.common.math.B2Math.dot(this,a.col2);this.x=l},crossVF:function(a){var l=this.x;this.x=a*this.y;this.y=-a*l},crossFV:function(a){var l=this.x;this.x=-a*this.y;this.y=a*l},minV:function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y},maxV:function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y},abs:function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var l=1/a;this.x*=l;this.y*=l;return a},isValid:function(){return d.common.math.B2Math.isValid(this.x)&&d.common.math.B2Math.isValid(this.y)},__class__:d.common.math.B2Vec2};d.collision.ClipVertex=function(){this.v=new d.common.math.B2Vec2;this.id=new d.collision.B2ContactID};d.collision.ClipVertex.__name__=["box2D","collision",
"ClipVertex"];d.collision.ClipVertex.prototype={set:function(a){this.v.setV(a.v);this.id.set(a.id)},__class__:d.collision.ClipVertex};d.collision.B2ContactID=function(){this.features=new d.collision.Features;this.features._m_id=this};d.collision.B2ContactID.__name__=["box2D","collision","B2ContactID"];d.collision.B2ContactID.prototype={set:function(a){this.set_key(a._key)},copy:function(){var a=new d.collision.B2ContactID;a.set_key(this.get_key());return a},get_key:function(){return this._key},set_key:function(a){this._key=
a;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&-16777216)>>24&255;return this._key},__class__:d.collision.B2ContactID,__properties__:{set_key:"set_key",get_key:"get_key"}};d.collision.Features=function(){};d.collision.Features.__name__=["box2D","collision","Features"];d.collision.Features.prototype={get_referenceEdge:function(){return this._referenceEdge},set_referenceEdge:function(a){this._referenceEdge=
a;this._m_id._key=this._m_id._key&-256|this._referenceEdge&255;return a},get_incidentEdge:function(){return this._incidentEdge},set_incidentEdge:function(a){this._incidentEdge=a;this._m_id._key=this._m_id._key&-65281|this._incidentEdge<<8&65280;return a},get_incidentVertex:function(){return this._incidentVertex},set_incidentVertex:function(a){this._incidentVertex=a;this._m_id._key=this._m_id._key&-16711681|this._incidentVertex<<16&16711680;return a},get_flip:function(){return this._flip},set_flip:function(a){this._flip=
a;this._m_id._key=this._m_id._key&16777215|this._flip<<24&-16777216;return a},__class__:d.collision.Features,__properties__:{set_flip:"set_flip",get_flip:"get_flip",set_incidentVertex:"set_incidentVertex",get_incidentVertex:"get_incidentVertex",set_incidentEdge:"set_incidentEdge",get_incidentEdge:"get_incidentEdge",set_referenceEdge:"set_referenceEdge",get_referenceEdge:"get_referenceEdge"}};d.collision.B2Collision=function(){};d.collision.B2Collision.__name__=["box2D","collision","B2Collision"];
d.collision.B2Collision.clipSegmentToLine=function(a,l,b,f){var d,c=0;d=l[0];var h=d.v;d=l[1];var k=d.v,m=b.x*h.x+b.y*h.y-f;d=b.x*k.x+b.y*k.y-f;0>=m&&a[c++].set(l[0]);0>=d&&a[c++].set(l[1]);0>m*d&&(b=m/(m-d),d=a[c],d=d.v,d.x=h.x+b*(k.x-h.x),d.y=h.y+b*(k.y-h.y),d=a[c],d.id=(0<m?l[0]:l[1]).id,++c);return c};d.collision.B2Collision.edgeSeparation=function(a,l,b,f,d){var c=a.m_vertices;a=a.m_normals;var h=f.m_vertexCount,k=f.m_vertices,m,p;m=l.R;p=a[b];a=m.col1.x*p.x+m.col2.x*p.y;f=m.col1.y*p.x+m.col2.y*
p.y;m=d.R;var u=m.col1.x*a+m.col1.y*f;m=m.col2.x*a+m.col2.y*f;for(var A=0,q=Number.MAX_VALUE,r=0;r<h;){var t=r++;p=k[t];p=p.x*u+p.y*m;p<q&&(q=p,A=t)}p=c[b];m=l.R;b=l.position.x+(m.col1.x*p.x+m.col2.x*p.y);l=l.position.y+(m.col1.y*p.x+m.col2.y*p.y);p=k[A];m=d.R;c=d.position.x+(m.col1.x*p.x+m.col2.x*p.y);d=d.position.y+(m.col1.y*p.x+m.col2.y*p.y);return(c-b)*a+(d-l)*f};d.collision.B2Collision.findMaxSeparation=function(a,l,b,f,n){var c=l.m_vertexCount,h=l.m_normals,k,m;m=n.R;k=f.m_centroid;var p=n.position.x+
(m.col1.x*k.x+m.col2.x*k.y),u=n.position.y+(m.col1.y*k.x+m.col2.y*k.y);m=b.R;k=l.m_centroid;p-=b.position.x+(m.col1.x*k.x+m.col2.x*k.y);u-=b.position.y+(m.col1.y*k.x+m.col2.y*k.y);m=p*b.R.col1.x+u*b.R.col1.y;for(var u=p*b.R.col2.x+u*b.R.col2.y,p=0,A=-Number.MAX_VALUE,q=0;q<c;){var r=q++;k=h[r];k=k.x*m+k.y*u;k>A&&(A=k,p=r)}h=d.collision.B2Collision.edgeSeparation(l,b,p,f,n);A=0<=p-1?p-1:c-1;m=d.collision.B2Collision.edgeSeparation(l,b,A,f,n);q=p+1<c?p+1:0;u=d.collision.B2Collision.edgeSeparation(l,
b,q,f,n);if(m>h&&m>u)k=-1;else if(u>h)k=1,A=q,m=u;else return a[0]=p,h;for(;;)if(p=-1==k?0<=A-1?A-1:c-1:A+1<c?A+1:0,h=d.collision.B2Collision.edgeSeparation(l,b,p,f,n),h>m)A=p,m=h;else break;a[0]=A;return m};d.collision.B2Collision.findIncidentEdge=function(a,l,b,f,d,c){var h=l.m_normals,k=d.m_vertexCount;l=d.m_vertices;d=d.m_normals;var m;m=b.R;b=h[f];var h=m.col1.x*b.x+m.col2.x*b.y,p=m.col1.y*b.x+m.col2.y*b.y;m=c.R;b=m.col1.x*h+m.col1.y*p;p=m.col2.x*h+m.col2.y*p;h=b;m=0;for(var u=Number.MAX_VALUE,
A=0;A<k;){var q=A++;b=d[q];b=h*b.x+p*b.y;b<u&&(u=b,m=q)}d=m;h=d+1<k?d+1:0;k=a[0];b=l[d];m=c.R;k.v.x=c.position.x+(m.col1.x*b.x+m.col2.x*b.y);k.v.y=c.position.y+(m.col1.y*b.x+m.col2.y*b.y);k.id.features.set_referenceEdge(f);k.id.features.set_incidentEdge(d);k.id.features.set_incidentVertex(0);k=a[1];b=l[h];m=c.R;k.v.x=c.position.x+(m.col1.x*b.x+m.col2.x*b.y);k.v.y=c.position.y+(m.col1.y*b.x+m.col2.y*b.y);k.id.features.set_referenceEdge(f);k.id.features.set_incidentEdge(h);k.id.features.set_incidentVertex(1)};
d.collision.B2Collision.makeClipPointVector=function(){var a=[];a[0]=new d.collision.ClipVertex;a[1]=new d.collision.ClipVertex;return a};d.collision.B2Collision.collidePolygons=function(a,l,b,f,c){var g;a.m_pointCount=0;var h=l.m_radius+f.m_radius,k;d.collision.B2Collision.s_edgeAO[0]=0;var m=d.collision.B2Collision.findMaxSeparation(d.collision.B2Collision.s_edgeAO,l,b,f,c);k=d.collision.B2Collision.s_edgeAO[0];if(!(m>h)){var p;d.collision.B2Collision.s_edgeBO[0]=0;var u=d.collision.B2Collision.findMaxSeparation(d.collision.B2Collision.s_edgeBO,
f,c,l,b);p=d.collision.B2Collision.s_edgeBO[0];if(!(u>h)){u>0.98*m+0.001?(m=f,f=l,l=c,a.m_type=d.collision.B2ManifoldType.FACE_B,k=1):(m=l,l=b,b=c,p=k,a.m_type=d.collision.B2ManifoldType.FACE_A,k=0);c=d.collision.B2Collision.s_incidentEdge;d.collision.B2Collision.findIncidentEdge(c,m,l,p,f,b);u=m.m_vertices;f=u[p];var A;A=p+1<m.m_vertexCount?u[p+1|0]:u[0];m=d.collision.B2Collision.s_localTangent;m.set(A.x-f.x,A.y-f.y);m.normalize();u=d.collision.B2Collision.s_localNormal;u.x=m.y;u.y=-m.x;var q=d.collision.B2Collision.s_planePoint;
q.set(0.5*(f.x+A.x),0.5*(f.y+A.y));g=d.collision.B2Collision.s_tangent;p=l.R;g.x=p.col1.x*m.x+p.col2.x*m.y;g.y=p.col1.y*m.x+p.col2.y*m.y;var r=d.collision.B2Collision.s_tangent2;r.x=-g.x;r.y=-g.y;m=d.collision.B2Collision.s_normal;m.x=g.y;m.y=-g.x;var t=d.collision.B2Collision.s_v11,s=d.collision.B2Collision.s_v12;t.x=l.position.x+(p.col1.x*f.x+p.col2.x*f.y);t.y=l.position.y+(p.col1.y*f.x+p.col2.y*f.y);s.x=l.position.x+(p.col1.x*A.x+p.col2.x*A.y);s.y=l.position.y+(p.col1.y*A.x+p.col2.y*A.y);l=m.x*
t.x+m.y*t.y;p=g.x*s.x+g.y*s.y+h;A=d.collision.B2Collision.s_clipPoints1;f=d.collision.B2Collision.s_clipPoints2;c=d.collision.B2Collision.clipSegmentToLine(A,c,r,-g.x*t.x-g.y*t.y+h);if(!(2>c||(c=d.collision.B2Collision.clipSegmentToLine(f,A,g,p),2>c))){a.m_localPlaneNormal.setV(u);a.m_localPoint.setV(q);u=c=0;for(q=d.common.B2Settings.b2_maxManifoldPoints;u<q;)p=u++,g=f[p],m.x*g.v.x+m.y*g.v.y-l<=h&&(r=a.m_points[c],p=b.R,t=g.v.x-b.position.x,A=g.v.y-b.position.y,r.m_localPoint.x=t*p.col1.x+A*p.col1.y,
r.m_localPoint.y=t*p.col2.x+A*p.col2.y,r.m_id.set(g.id),r.m_id.features.set_flip(k),++c);a.m_pointCount=c}}}};d.collision.B2Collision.collideCircles=function(a,l,b,f,c){a.m_pointCount=0;var g,h;g=b.R;h=l.m_p;var k=b.position.x+(g.col1.x*h.x+g.col2.x*h.y);b=b.position.y+(g.col1.y*h.x+g.col2.y*h.y);g=c.R;h=f.m_p;k=c.position.x+(g.col1.x*h.x+g.col2.x*h.y)-k;c=c.position.y+(g.col1.y*h.x+g.col2.y*h.y)-b;g=l.m_radius+f.m_radius;k*k+c*c>g*g||(a.m_type=d.collision.B2ManifoldType.CIRCLES,a.m_localPoint.setV(l.m_p),
a.m_localPlaneNormal.setZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.setV(f.m_p),a.m_points[0].m_id.set_key(0))};d.collision.B2Collision.collidePolygonAndCircle=function(a,l,b,f,c){a.m_pointCount=0;var g,h,k,m;m=c.R;k=f.m_p;var p=c.position.y+(m.col1.y*k.x+m.col2.y*k.y);g=c.position.x+(m.col1.x*k.x+m.col2.x*k.y)-b.position.x;h=p-b.position.y;m=b.R;b=g*m.col1.x+h*m.col1.y;m=g*m.col2.x+h*m.col2.y;var u=0;c=-Number.MAX_VALUE;var p=l.m_radius+f.m_radius,A=l.m_vertexCount,q=l.m_vertices;l=l.m_normals;
for(var r=0;r<A;){var t=r++;k=q[t];g=b-k.x;h=m-k.y;k=l[t];k=k.x*g+k.y*h;if(k>p)return;k>c&&(c=k,u=t)}k=u;g=q[k];A=q[k+1<A?k+1:0];c<Number.MIN_VALUE?(a.m_pointCount=1,a.m_type=d.collision.B2ManifoldType.FACE_A,a.m_localPlaneNormal.setV(l[u]),a.m_localPoint.x=0.5*(g.x+A.x),a.m_localPoint.y=0.5*(g.y+A.y),a.m_points[0].m_localPoint.setV(f.m_p),a.m_points[0].m_id.set_key(0)):(c=(b-A.x)*(g.x-A.x)+(m-A.y)*(g.y-A.y),0>=(b-g.x)*(A.x-g.x)+(m-g.y)*(A.y-g.y)?(b-g.x)*(b-g.x)+(m-g.y)*(m-g.y)>p*p||(a.m_pointCount=
1,a.m_type=d.collision.B2ManifoldType.FACE_A,a.m_localPlaneNormal.x=b-g.x,a.m_localPlaneNormal.y=m-g.y,a.m_localPlaneNormal.normalize(),a.m_localPoint.setV(g),a.m_points[0].m_localPoint.setV(f.m_p),a.m_points[0].m_id.set_key(0)):0>=c?(b-A.x)*(b-A.x)+(m-A.y)*(m-A.y)>p*p||(a.m_pointCount=1,a.m_type=d.collision.B2ManifoldType.FACE_A,a.m_localPlaneNormal.x=b-A.x,a.m_localPlaneNormal.y=m-A.y,a.m_localPlaneNormal.normalize(),a.m_localPoint.setV(A),a.m_points[0].m_localPoint.setV(f.m_p),a.m_points[0].m_id.set_key(0)):
(u=0.5*(g.x+A.x),g=0.5*(g.y+A.y),c=(b-u)*l[k].x+(m-g)*l[k].y,c>p||(a.m_pointCount=1,a.m_type=d.collision.B2ManifoldType.FACE_A,a.m_localPlaneNormal.x=l[k].x,a.m_localPlaneNormal.y=l[k].y,a.m_localPlaneNormal.normalize(),a.m_localPoint.set(u,g),a.m_points[0].m_localPoint.setV(f.m_p),a.m_points[0].m_id.set_key(0))))};d.collision.B2Collision.testOverlap=function(a,l){var b=l.lowerBound,f=a.upperBound,d=b.x-f.x,c=b.y-f.y,b=a.lowerBound,f=l.upperBound,h=b.y-f.y;return 0<d||0<c||0<b.x-f.x||0<h?!1:!0};d.collision.B2ContactPoint=
function(){this.position=new d.common.math.B2Vec2;this.velocity=new d.common.math.B2Vec2;this.normal=new d.common.math.B2Vec2;this.id=new d.collision.B2ContactID};d.collision.B2ContactPoint.__name__=["box2D","collision","B2ContactPoint"];d.collision.B2ContactPoint.prototype={__class__:d.collision.B2ContactPoint};d.collision.B2Simplex=function(){this.m_v1=new d.collision.B2SimplexVertex;this.m_v2=new d.collision.B2SimplexVertex;this.m_v3=new d.collision.B2SimplexVertex;this.m_vertices=[];this.m_vertices[0]=
this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};d.collision.B2Simplex.__name__=["box2D","collision","B2Simplex"];d.collision.B2Simplex.prototype={readCache:function(a,l,b,f,c){d.common.B2Settings.b2Assert(0<=a.count&&3>=a.count);var g,h;this.m_count=a.count;for(var k=this.m_vertices,m,p=0,u=this.m_count;p<u;)g=p++,m=k[g],m.indexA=a.indexA[g],m.indexB=a.indexB[g],g=l.getVertex(m.indexA),h=f.getVertex(m.indexB),m.wA=d.common.math.B2Math.mulX(b,g),m.wB=d.common.math.B2Math.mulX(c,
h),m.w=d.common.math.B2Math.subtractVV(m.wB,m.wA),m.a=0;1<this.m_count&&(a=a.metric,m=this.getMetric(),m<0.5*a||2*a<m||m<Number.MIN_VALUE)&&(this.m_count=0);0==this.m_count&&(m=k[0],m.indexA=0,m.indexB=0,g=l.getVertex(0),h=f.getVertex(0),m.wA=d.common.math.B2Math.mulX(b,g),m.wB=d.common.math.B2Math.mulX(c,h),m.w=d.common.math.B2Math.subtractVV(m.wB,m.wA),this.m_count=1)},writeCache:function(a){a.metric=this.getMetric();a.count=this.m_count|0;for(var l=this.m_vertices,b=0,f=this.m_count;b<f;){var d=
b++;a.indexA[d]=l[d].indexA|0;a.indexB[d]=l[d].indexB|0}},getSearchDirection:function(){switch(this.m_count){case 1:return this.m_v1.w.getNegative();case 2:var a=d.common.math.B2Math.subtractVV(this.m_v2.w,this.m_v1.w);return 0<d.common.math.B2Math.crossVV(a,this.m_v1.w.getNegative())?d.common.math.B2Math.crossFV(1,a):d.common.math.B2Math.crossVF(a,1);default:return d.common.B2Settings.b2Assert(!1),new d.common.math.B2Vec2}},getClosestPoint:function(){switch(this.m_count){case 0:return d.common.B2Settings.b2Assert(!1),
new d.common.math.B2Vec2;case 1:return this.m_v1.w;case 2:return new d.common.math.B2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return d.common.B2Settings.b2Assert(!1),new d.common.math.B2Vec2}},getWitnessPoints:function(a,l){switch(this.m_count){case 0:d.common.B2Settings.b2Assert(!1);break;case 1:a.setV(this.m_v1.wA);l.setV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;a.y=this.m_v1.a*
this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;l.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;l.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:l.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;l.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:d.common.B2Settings.b2Assert(!1)}},getMetric:function(){switch(this.m_count){case 0:return d.common.B2Settings.b2Assert(!1),0;case 1:return 0;
case 2:return d.common.math.B2Math.subtractVV(this.m_v1.w,this.m_v2.w).length();case 3:return d.common.math.B2Math.crossVV(d.common.math.B2Math.subtractVV(this.m_v2.w,this.m_v1.w),d.common.math.B2Math.subtractVV(this.m_v3.w,this.m_v1.w));default:return d.common.B2Settings.b2Assert(!1),0}},solve2:function(){var a=this.m_v1.w,l=this.m_v2.w,b=d.common.math.B2Math.subtractVV(l,a),a=-(a.x*b.x+a.y*b.y);0>=a?this.m_count=this.m_v1.a=1:(l=l.x*b.x+l.y*b.y,0>=l?(this.m_count=this.m_v2.a=1,this.m_v1.set(this.m_v2)):
(b=1/(l+a),this.m_v1.a=l*b,this.m_v2.a=a*b,this.m_count=2))},solve3:function(){var a=this.m_v1.w,l=this.m_v2.w,b=this.m_v3.w,f=d.common.math.B2Math.subtractVV(l,a),c=d.common.math.B2Math.dot(a,f),g=d.common.math.B2Math.dot(l,f),c=-c,h=d.common.math.B2Math.subtractVV(b,a),k=d.common.math.B2Math.dot(a,h),m=d.common.math.B2Math.dot(b,h),k=-k,p=d.common.math.B2Math.subtractVV(b,l),u=d.common.math.B2Math.dot(l,p),p=d.common.math.B2Math.dot(b,p),u=-u,h=d.common.math.B2Math.crossVV(f,h),f=h*d.common.math.B2Math.crossVV(l,
b),b=h*d.common.math.B2Math.crossVV(b,a),a=h*d.common.math.B2Math.crossVV(a,l);0>=c&&0>=k?this.m_count=this.m_v1.a=1:0<g&&0<c&&0>=a?(m=1/(g+c),this.m_v1.a=g*m,this.m_v2.a=c*m,this.m_count=2):0<m&&0<k&&0>=b?(g=1/(m+k),this.m_v1.a=m*g,this.m_v3.a=k*g,this.m_count=2,this.m_v2.set(this.m_v3)):0>=g&&0>=u?(this.m_count=this.m_v2.a=1,this.m_v1.set(this.m_v2)):0>=m&&0>=p?(this.m_count=this.m_v3.a=1,this.m_v1.set(this.m_v3)):0<p&&0<u&&0>=f?(g=1/(p+u),this.m_v2.a=p*g,this.m_v3.a=u*g,this.m_count=2,this.m_v1.set(this.m_v3)):
(g=1/(f+b+a),this.m_v1.a=f*g,this.m_v2.a=b*g,this.m_v3.a=a*g,this.m_count=3)},__class__:d.collision.B2Simplex};d.collision.B2SimplexVertex=function(){};d.collision.B2SimplexVertex.__name__=["box2D","collision","B2SimplexVertex"];d.collision.B2SimplexVertex.prototype={set:function(a){this.wA.setV(a.wA);this.wB.setV(a.wB);this.w.setV(a.w);this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB},__class__:d.collision.B2SimplexVertex};d.collision.B2Distance=function(){};d.collision.B2Distance.__name__=["box2D",
"collision","B2Distance"];d.collision.B2Distance.distance=function(a,l,b){++d.collision.B2Distance.b2_gjkCalls;var f=b.proxyA,c=b.proxyB,g=b.transformA,h=b.transformB,k=d.collision.B2Distance.s_simplex;k.readCache(l,f,g,c,h);var m=k.m_vertices,p=d.collision.B2Distance.s_saveA,u=d.collision.B2Distance.s_saveB,A=0;k.getClosestPoint().lengthSquared();for(var q,r=0;20>r;){A=k.m_count;for(q=0;q<A;){var s=q++;p[s]=m[s].indexA;u[s]=m[s].indexB}switch(k.m_count){case 1:break;case 2:k.solve2();break;case 3:k.solve3();
break;default:d.common.B2Settings.b2Assert(!1)}if(3==k.m_count)break;q=k.getClosestPoint();q.lengthSquared();s=k.getSearchDirection();if(s.lengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;q=m[k.m_count];q.indexA=t["int"](f.getSupport(d.common.math.B2Math.mulTMV(g.R,s.getNegative())));q.wA=d.common.math.B2Math.mulX(g,f.getVertex(q.indexA));q.indexB=t["int"](c.getSupport(d.common.math.B2Math.mulTMV(h.R,s)));q.wB=d.common.math.B2Math.mulX(h,c.getVertex(q.indexB));q.w=d.common.math.B2Math.subtractVV(q.wB,
q.wA);++r;++d.collision.B2Distance.b2_gjkIters;for(var s=!1,E=0;E<A;){var x=E++;if(q.indexA==p[x]&&q.indexB==u[x]){s=!0;break}}if(s)break;++k.m_count}d.collision.B2Distance.b2_gjkMaxIters=t["int"](d.common.math.B2Math.max(d.collision.B2Distance.b2_gjkMaxIters,r));k.getWitnessPoints(a.pointA,a.pointB);a.distance=d.common.math.B2Math.subtractVV(a.pointA,a.pointB).length();a.iterations=r;k.writeCache(l);b.useRadii&&(l=f.m_radius,c=c.m_radius,a.distance>l+c&&a.distance>Number.MIN_VALUE?(a.distance-=l+
c,b=d.common.math.B2Math.subtractVV(a.pointB,a.pointA),b.normalize(),a.pointA.x+=l*b.x,a.pointA.y+=l*b.y,a.pointB.x-=c*b.x,a.pointB.y-=c*b.y):(q=new d.common.math.B2Vec2,q.x=0.5*(a.pointA.x+a.pointB.x),q.y=0.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=q.x,a.pointA.y=a.pointB.y=q.y,a.distance=0))};d.collision.B2DistanceInput=function(){};d.collision.B2DistanceInput.__name__=["box2D","collision","B2DistanceInput"];d.collision.B2DistanceInput.prototype={__class__:d.collision.B2DistanceInput};d.collision.B2DistanceOutput=
function(){this.pointA=new d.common.math.B2Vec2;this.pointB=new d.common.math.B2Vec2};d.collision.B2DistanceOutput.__name__=["box2D","collision","B2DistanceOutput"];d.collision.B2DistanceOutput.prototype={__class__:d.collision.B2DistanceOutput};d.collision.B2DistanceProxy=function(){this.m_vertices=[]};d.collision.B2DistanceProxy.__name__=["box2D","collision","B2DistanceProxy"];d.collision.B2DistanceProxy.prototype={set:function(a){switch(a.getType()[1]){case 1:a=z.Boot.__cast(a,d.collision.shapes.B2CircleShape);
this.m_vertices=[];this.m_vertices[0]=a.m_p;this.m_count=1;this.m_radius=a.m_radius;break;case 2:a=z.Boot.__cast(a,d.collision.shapes.B2PolygonShape);this.m_vertices=a.m_vertices;this.m_count=a.m_vertexCount;this.m_radius=a.m_radius;break;default:d.common.B2Settings.b2Assert(!1)}},getSupport:function(a){for(var l=0,b=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,f=1,d=this.m_count;f<d;){var c=f++,h=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;h>b&&(l=c,b=h)}return l},getSupportVertex:function(a){for(var l=
0,b=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,f=1,d=this.m_count;f<d;){var c=f++,h=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;h>b&&(l=c,b=h)}return this.m_vertices[l]},getVertexCount:function(){return this.m_count},getVertex:function(a){d.common.B2Settings.b2Assert(0<=a&&a<this.m_count);return this.m_vertices[a]},__class__:d.collision.B2DistanceProxy};d.collision.B2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};d.collision.B2DynamicTree.__name__=
["box2D","collision","B2DynamicTree"];d.collision.B2DynamicTree.prototype={createProxy:function(a,l){var b=this.allocateNode(),f=d.common.B2Settings.b2_aabbExtension,c=d.common.B2Settings.b2_aabbExtension;b.aabb.lowerBound.x=a.lowerBound.x-f;b.aabb.lowerBound.y=a.lowerBound.y-c;b.aabb.upperBound.x=a.upperBound.x+f;b.aabb.upperBound.y=a.upperBound.y+c;b.userData=l;this.insertLeaf(b);return b},destroyProxy:function(a){this.removeLeaf(a);this.freeNode(a)},moveProxy:function(a,l,b){d.common.B2Settings.b2Assert(a.isLeaf());
if(a.aabb.contains(l))return!1;this.removeLeaf(a);var f;f=d.common.B2Settings.b2_aabbExtension+d.common.B2Settings.b2_aabbMultiplier*(0<b.x?b.x:-b.x);b=d.common.B2Settings.b2_aabbExtension+d.common.B2Settings.b2_aabbMultiplier*(0<b.y?b.y:-b.y);a.aabb.lowerBound.x=l.lowerBound.x-f;a.aabb.lowerBound.y=l.lowerBound.y-b;a.aabb.upperBound.x=l.upperBound.x+f;a.aabb.upperBound.y=l.upperBound.y+b;this.insertLeaf(a);return!0},rebalance:function(a){if(null!=this.m_root)for(var l=0;l<a;){l++;for(var b=this.m_root,
f=0;!1==b.isLeaf();)b=0!=(this.m_path>>f&1)?b.child2:b.child1,f=f+1&31;++this.m_path;this.removeLeaf(b);this.insertLeaf(b)}},getFatAABB:function(a){return a.aabb},getUserData:function(a){return a.userData},query:function(a,l){if(null!=this.m_root){var b=[],f=0;for(b[f++]=this.m_root;0<f;){var d=b[--f];if(d.aabb.testOverlap(l))if(d.isLeaf()){if(!a(d))break}else b[f++]=d.child1,b[f++]=d.child2}}},rayCast:function(a,l){if(null!=this.m_root){var b=l.p1,f=l.p2,c=d.common.math.B2Math.subtractVV(b,f);c.normalize();
var c=d.common.math.B2Math.crossFV(1,c),g=d.common.math.B2Math.absV(c),h=l.maxFraction,k=new d.collision.B2AABB,m;m=b.x+h*(f.x-b.x);h=b.y+h*(f.y-b.y);k.lowerBound.x=Math.min(b.x,m);k.lowerBound.y=Math.min(b.y,h);k.upperBound.x=Math.max(b.x,m);k.upperBound.y=Math.max(b.y,h);var p=[],u=0;for(p[u++]=this.m_root;0<u;)if(m=p[--u],!1!=m.aabb.testOverlap(k)){var h=m.aabb.getCenter(),A=m.aabb.getExtents();if(!(0<Math.abs(c.x*(b.x-h.x)+c.y*(b.y-h.y))-g.x*A.x-g.y*A.y))if(m.isLeaf()){h=new d.collision.B2RayCastInput;
h.p1=l.p1;h.p2=l.p2;h.maxFraction=l.maxFraction;h=a(h,m);if(0==h)break;m=b.x+h*(f.x-b.x);h=b.y+h*(f.y-b.y);k.lowerBound.x=Math.min(b.x,m);k.lowerBound.y=Math.min(b.y,h);k.upperBound.x=Math.max(b.x,m);k.upperBound.y=Math.max(b.y,h)}else p[u++]=m.child1,p[u++]=m.child2}}},allocateNode:function(){if(null!=this.m_freeList){var a=this.m_freeList;this.m_freeList=a.parent;a.parent=null;a.child1=null;a.child2=null;return a}return new d.collision.B2DynamicTreeNode},freeNode:function(a){a.parent=this.m_freeList;
this.m_freeList=a},insertLeaf:function(a){++this.m_insertionCount;if(null==this.m_root)this.m_root=a,this.m_root.parent=null;else{var l=a.aabb.getCenter(),b=this.m_root;if(!1==b.isLeaf()){do var f=b.child1,b=b.child2,d=Math.abs((f.aabb.lowerBound.x+f.aabb.upperBound.x)/2-l.x)+Math.abs((f.aabb.lowerBound.y+f.aabb.upperBound.y)/2-l.y),c=Math.abs((b.aabb.lowerBound.x+b.aabb.upperBound.x)/2-l.x)+Math.abs((b.aabb.lowerBound.y+b.aabb.upperBound.y)/2-l.y),b=d<c?f:b;while(!1==b.isLeaf())}l=b.parent;f=this.allocateNode();
f.parent=l;f.userData=null;f.aabb.combine(a.aabb,b.aabb);if(null!=l){b.parent.child1==b?l.child1=f:l.child2=f;f.child1=b;f.child2=a;b.parent=f;a.parent=f;do{if(l.aabb.contains(f.aabb))break;l.aabb.combine(l.child1.aabb,l.child2.aabb);f=l;l=l.parent}while(null!=l)}else f.child1=b,f.child2=a,b.parent=f,this.m_root=a.parent=f}},removeLeaf:function(a){if(a==this.m_root)this.m_root=null;else{var l=a.parent,b=l.parent;a=l.child1==a?l.child2:l.child1;if(null!=b)for(b.child1==l?b.child1=a:b.child2=a,a.parent=
b,this.freeNode(l);null!=b;){l=b.aabb;b.aabb=new d.collision.B2AABB;b.aabb.combine(b.child1.aabb,b.child2.aabb);if(l.contains(b.aabb))break;b=b.parent}else this.m_root=a,a.parent=null,this.freeNode(l)}},__class__:d.collision.B2DynamicTree};d.collision.IBroadPhase=function(){};d.collision.IBroadPhase.__name__=["box2D","collision","IBroadPhase"];d.collision.IBroadPhase.prototype={__class__:d.collision.IBroadPhase};d.collision.B2DynamicTreeBroadPhase=function(){this.m_tree=new d.collision.B2DynamicTree;
this.m_moveBuffer=[];this.m_pairBuffer=[];this.m_pairCount=0};d.collision.B2DynamicTreeBroadPhase.__name__=["box2D","collision","B2DynamicTreeBroadPhase"];d.collision.B2DynamicTreeBroadPhase.__interfaces__=[d.collision.IBroadPhase];d.collision.B2DynamicTreeBroadPhase.prototype={createProxy:function(a,l){var b=this.m_tree.createProxy(a,l);++this.m_proxyCount;this.bufferMove(b);return b},destroyProxy:function(a){this.unBufferMove(a);--this.m_proxyCount;this.m_tree.destroyProxy(a)},moveProxy:function(a,
l,b){this.m_tree.moveProxy(a,l,b)&&this.bufferMove(a)},testOverlap:function(a,l){var b=this.m_tree.getFatAABB(a),f=this.m_tree.getFatAABB(l);return b.testOverlap(f)},getUserData:function(a){return this.m_tree.getUserData(a)},getFatAABB:function(a){return this.m_tree.getFatAABB(a)},getProxyCount:function(){return this.m_proxyCount},updatePairs:function(a){for(var l=this,b=this.m_pairCount=0,f=this.m_moveBuffer;b<f.length;){var c=[f[b]];++b;var g=function(a){return function(b){if(b==a[0])return!0;l.m_pairCount==
l.m_pairBuffer.length&&(l.m_pairBuffer[l.m_pairCount]=new d.collision.B2DynamicTreePair);var e=l.m_pairBuffer[l.m_pairCount];b.id<a[0].id?(e.proxyA=b,e.proxyB=a[0]):(e.proxyA=a[0],e.proxyB=b);++l.m_pairCount;return!0}}(c),c=this.m_tree.getFatAABB(c[0]);this.m_tree.query(g,c)}this.m_moveBuffer=[];b=!0;for(f=0;b;)if(f>=this.m_pairCount)b=!1;else{var g=this.m_pairBuffer[f],c=this.m_tree.getUserData(g.proxyA),h=this.m_tree.getUserData(g.proxyB);a(c,h);for(++f;f<this.m_pairCount;){c=this.m_pairBuffer[f];
if(c.proxyA!=g.proxyA||c.proxyB!=g.proxyB)break;++f}}},query:function(a,l){this.m_tree.query(a,l)},rayCast:function(a,l){this.m_tree.rayCast(a,l)},validate:function(){},rebalance:function(a){this.m_tree.rebalance(a)},bufferMove:function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},unBufferMove:function(a){v.remove(this.m_moveBuffer,a)},comparePairs:function(a,l){return 0},__class__:d.collision.B2DynamicTreeBroadPhase};d.collision.B2DynamicTreeNode=function(){this.aabb=new d.collision.B2AABB;
this.id=d.collision.B2DynamicTreeNode.currentID++};d.collision.B2DynamicTreeNode.__name__=["box2D","collision","B2DynamicTreeNode"];d.collision.B2DynamicTreeNode.prototype={isLeaf:function(){return null==this.child1},__class__:d.collision.B2DynamicTreeNode};d.collision.B2DynamicTreePair=function(){};d.collision.B2DynamicTreePair.__name__=["box2D","collision","B2DynamicTreePair"];d.collision.B2DynamicTreePair.prototype={__class__:d.collision.B2DynamicTreePair};d.collision.B2Manifold=function(){this.m_pointCount=
0;this.m_points=[];for(var a=0,l=d.common.B2Settings.b2_maxManifoldPoints;a<l;){var b=a++;this.m_points[b]=new d.collision.B2ManifoldPoint}this.m_localPlaneNormal=new d.common.math.B2Vec2;this.m_localPoint=new d.common.math.B2Vec2};d.collision.B2Manifold.__name__=["box2D","collision","B2Manifold"];d.collision.B2Manifold.prototype={reset:function(){for(var a=0,l=d.common.B2Settings.b2_maxManifoldPoints;a<l;){var b=a++;this.m_points[b].reset()}this.m_localPlaneNormal.setZero();this.m_localPoint.setZero();
this.m_type=d.collision.B2ManifoldType.CIRCLES;this.m_pointCount=0},set:function(a){this.m_pointCount=a.m_pointCount;for(var l=0,b=d.common.B2Settings.b2_maxManifoldPoints;l<b;){var f=l++;this.m_points[f].set(a.m_points[f])}this.m_localPlaneNormal.setV(a.m_localPlaneNormal);this.m_localPoint.setV(a.m_localPoint);this.m_type=a.m_type},copy:function(){var a=new d.collision.B2Manifold;a.set(this);return a},__class__:d.collision.B2Manifold};d.collision.B2ManifoldPoint=function(){this.m_localPoint=new d.common.math.B2Vec2;
this.m_id=new d.collision.B2ContactID;this.reset()};d.collision.B2ManifoldPoint.__name__=["box2D","collision","B2ManifoldPoint"];d.collision.B2ManifoldPoint.prototype={reset:function(){this.m_localPoint.setZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.set_key(0)},set:function(a){this.m_localPoint.setV(a.m_localPoint);this.m_normalImpulse=a.m_normalImpulse;this.m_tangentImpulse=a.m_tangentImpulse;this.m_id.set(a.m_id)},__class__:d.collision.B2ManifoldPoint};d.collision.B2ManifoldType=
{__ename__:!0,__constructs__:["CIRCLES","FACE_A","FACE_B"]};d.collision.B2ManifoldType.CIRCLES=["CIRCLES",0];d.collision.B2ManifoldType.CIRCLES.toString=D;d.collision.B2ManifoldType.CIRCLES.__enum__=d.collision.B2ManifoldType;d.collision.B2ManifoldType.FACE_A=["FACE_A",1];d.collision.B2ManifoldType.FACE_A.toString=D;d.collision.B2ManifoldType.FACE_A.__enum__=d.collision.B2ManifoldType;d.collision.B2ManifoldType.FACE_B=["FACE_B",2];d.collision.B2ManifoldType.FACE_B.toString=D;d.collision.B2ManifoldType.FACE_B.__enum__=
d.collision.B2ManifoldType;d.collision.B2ManifoldType.__empty_constructs__=[d.collision.B2ManifoldType.CIRCLES,d.collision.B2ManifoldType.FACE_A,d.collision.B2ManifoldType.FACE_B];d.collision.B2OBB=function(){this.R=new d.common.math.B2Mat22;this.center=new d.common.math.B2Vec2;this.extents=new d.common.math.B2Vec2};d.collision.B2OBB.__name__=["box2D","collision","B2OBB"];d.collision.B2OBB.prototype={__class__:d.collision.B2OBB};d.collision.B2RayCastInput=function(a,l,b){null==b&&(b=1);this.p1=new d.common.math.B2Vec2;
this.p2=new d.common.math.B2Vec2;null!=a&&this.p1.setV(a);null!=l&&this.p2.setV(l);this.maxFraction=b};d.collision.B2RayCastInput.__name__=["box2D","collision","B2RayCastInput"];d.collision.B2RayCastInput.prototype={__class__:d.collision.B2RayCastInput};d.collision.B2RayCastOutput=function(){this.normal=new d.common.math.B2Vec2};d.collision.B2RayCastOutput.__name__=["box2D","collision","B2RayCastOutput"];d.collision.B2RayCastOutput.prototype={__class__:d.collision.B2RayCastOutput};d.collision.B2SeparationFunction=
function(){this.m_localPoint=new d.common.math.B2Vec2;this.m_axis=new d.common.math.B2Vec2};d.collision.B2SeparationFunction.__name__=["box2D","collision","B2SeparationFunction"];d.collision.B2SeparationFunction.prototype={initialize:function(a,l,b,f,c){this.m_proxyA=l;this.m_proxyB=f;l=a.count;d.common.B2Settings.b2Assert(0<l&&3>l);var g=new d.common.math.B2Vec2,h=new d.common.math.B2Vec2,k,m;if(1==l)this.m_type=d.collision.B2SeparationFunctionType.POINTS,g=this.m_proxyA.getVertex(a.indexA[0]),h=
this.m_proxyB.getVertex(a.indexB[0]),m=g,k=b.R,g=b.position.x+(k.col1.x*m.x+k.col2.x*m.y),b=b.position.y+(k.col1.y*m.x+k.col2.y*m.y),m=h,k=c.R,h=c.position.x+(k.col1.x*m.x+k.col2.x*m.y),c=c.position.y+(k.col1.y*m.x+k.col2.y*m.y),this.m_axis.x=h-g,this.m_axis.y=c-b,this.m_axis.normalize();else{if(a.indexB[0]==a.indexB[1])this.m_type=d.collision.B2SeparationFunctionType.FACE_A,l=this.m_proxyA.getVertex(a.indexA[0]),f=this.m_proxyA.getVertex(a.indexA[1]),h=this.m_proxyB.getVertex(a.indexB[0]),this.m_localPoint.x=
0.5*(l.x+f.x),this.m_localPoint.y=0.5*(l.y+f.y),this.m_axis=d.common.math.B2Math.crossVF(d.common.math.B2Math.subtractVV(f,l),1),this.m_axis.normalize(),m=this.m_axis,k=b.R,l=k.col1.x*m.x+k.col2.x*m.y,f=k.col1.y*m.x+k.col2.y*m.y,m=this.m_localPoint,k=b.R,g=b.position.x+(k.col1.x*m.x+k.col2.x*m.y),b=b.position.y+(k.col1.y*m.x+k.col2.y*m.y),m=h,k=c.R,h=c.position.x+(k.col1.x*m.x+k.col2.x*m.y),c=c.position.y+(k.col1.y*m.x+k.col2.y*m.y),a=(h-g)*l+(c-b)*f;else if(a.indexA[0]==a.indexA[0])this.m_type=d.collision.B2SeparationFunctionType.FACE_B,
k=this.m_proxyB.getVertex(a.indexB[0]),m=this.m_proxyB.getVertex(a.indexB[1]),g=this.m_proxyA.getVertex(a.indexA[0]),this.m_localPoint.x=0.5*(k.x+m.x),this.m_localPoint.y=0.5*(k.y+m.y),this.m_axis=d.common.math.B2Math.crossVF(d.common.math.B2Math.subtractVV(m,k),1),this.m_axis.normalize(),m=this.m_axis,k=c.R,l=k.col1.x*m.x+k.col2.x*m.y,f=k.col1.y*m.x+k.col2.y*m.y,m=this.m_localPoint,k=c.R,h=c.position.x+(k.col1.x*m.x+k.col2.x*m.y),c=c.position.y+(k.col1.y*m.x+k.col2.y*m.y),m=g,k=b.R,g=b.position.x+
(k.col1.x*m.x+k.col2.x*m.y),b=b.position.y+(k.col1.y*m.x+k.col2.y*m.y),a=(g-h)*l+(b-c)*f;else{l=this.m_proxyA.getVertex(a.indexA[0]);f=this.m_proxyA.getVertex(a.indexA[1]);k=this.m_proxyB.getVertex(a.indexB[0]);m=this.m_proxyB.getVertex(a.indexB[1]);d.common.math.B2Math.mulX(b,g);g=d.common.math.B2Math.mulMV(b.R,d.common.math.B2Math.subtractVV(f,l));d.common.math.B2Math.mulX(c,h);a=d.common.math.B2Math.mulMV(c.R,d.common.math.B2Math.subtractVV(m,k));c=g.x*g.x+g.y*g.y;b=a.x*a.x+a.y*a.y;var p=d.common.math.B2Math.subtractVV(a,
g),h=g.x*p.x+g.y*p.y,p=a.x*p.x+a.y*p.y,g=g.x*a.x+g.y*a.y,u=c*b-g*g;a=0;0!=u&&(a=d.common.math.B2Math.clamp((g*p-h*b)/u,0,1));0>(g*a+p)/b&&(a=d.common.math.B2Math.clamp((g-h)/c,0,1));g=new d.common.math.B2Vec2;g.x=l.x+a*(f.x-l.x);g.y=l.y+a*(f.y-l.y);h=new d.common.math.B2Vec2;h.x=k.x+a*(m.x-k.x);h.y=k.y+a*(m.y-k.y);0==a||1==a?(this.m_type=d.collision.B2SeparationFunctionType.FACE_B,this.m_axis=d.common.math.B2Math.crossVF(d.common.math.B2Math.subtractVV(m,k),1),this.m_axis.normalize(),this.m_localPoint=
h):(this.m_type=d.collision.B2SeparationFunctionType.FACE_A,this.m_axis=d.common.math.B2Math.crossVF(d.common.math.B2Math.subtractVV(f,l),1),this.m_localPoint=g)}0>a&&this.m_axis.negativeSelf()}},evaluate:function(a,l){var b,f,c;switch(this.m_type[1]){case 0:return b=d.common.math.B2Math.mulTMV(a.R,this.m_axis),f=d.common.math.B2Math.mulTMV(l.R,this.m_axis.getNegative()),b=this.m_proxyA.getSupportVertex(b),f=this.m_proxyB.getSupportVertex(f),b=d.common.math.B2Math.mulX(a,b),f=d.common.math.B2Math.mulX(l,
f),c=(f.x-b.x)*this.m_axis.x+(f.y-b.y)*this.m_axis.y;case 1:return c=d.common.math.B2Math.mulMV(a.R,this.m_axis),b=d.common.math.B2Math.mulX(a,this.m_localPoint),f=d.common.math.B2Math.mulTMV(l.R,c.getNegative()),f=this.m_proxyB.getSupportVertex(f),f=d.common.math.B2Math.mulX(l,f),c=(f.x-b.x)*c.x+(f.y-b.y)*c.y;case 2:return c=d.common.math.B2Math.mulMV(l.R,this.m_axis),f=d.common.math.B2Math.mulX(l,this.m_localPoint),b=d.common.math.B2Math.mulTMV(a.R,c.getNegative()),b=this.m_proxyA.getSupportVertex(b),
b=d.common.math.B2Math.mulX(a,b),c=(b.x-f.x)*c.x+(b.y-f.y)*c.y}},__class__:d.collision.B2SeparationFunction};d.collision.B2SeparationFunctionType={__ename__:!0,__constructs__:["POINTS","FACE_A","FACE_B"]};d.collision.B2SeparationFunctionType.POINTS=["POINTS",0];d.collision.B2SeparationFunctionType.POINTS.toString=D;d.collision.B2SeparationFunctionType.POINTS.__enum__=d.collision.B2SeparationFunctionType;d.collision.B2SeparationFunctionType.FACE_A=["FACE_A",1];d.collision.B2SeparationFunctionType.FACE_A.toString=
D;d.collision.B2SeparationFunctionType.FACE_A.__enum__=d.collision.B2SeparationFunctionType;d.collision.B2SeparationFunctionType.FACE_B=["FACE_B",2];d.collision.B2SeparationFunctionType.FACE_B.toString=D;d.collision.B2SeparationFunctionType.FACE_B.__enum__=d.collision.B2SeparationFunctionType;d.collision.B2SeparationFunctionType.__empty_constructs__=[d.collision.B2SeparationFunctionType.POINTS,d.collision.B2SeparationFunctionType.FACE_A,d.collision.B2SeparationFunctionType.FACE_B];d.collision.B2SimplexCache=
function(){this.indexA=[];this.indexB=[]};d.collision.B2SimplexCache.__name__=["box2D","collision","B2SimplexCache"];d.collision.B2SimplexCache.prototype={__class__:d.collision.B2SimplexCache};d.collision.B2TOIInput=function(){this.proxyA=new d.collision.B2DistanceProxy;this.proxyB=new d.collision.B2DistanceProxy;this.sweepA=new d.common.math.B2Sweep;this.sweepB=new d.common.math.B2Sweep};d.collision.B2TOIInput.__name__=["box2D","collision","B2TOIInput"];d.collision.B2TOIInput.prototype={__class__:d.collision.B2TOIInput};
d.common.math.B2Transform=function(a,l){this.position=new d.common.math.B2Vec2;this.R=new d.common.math.B2Mat22;null!=a&&(this.position.setV(a),this.R.setM(l))};d.common.math.B2Transform.__name__=["box2D","common","math","B2Transform"];d.common.math.B2Transform.prototype={initialize:function(a,l){this.position.setV(a);this.R.setM(l)},setIdentity:function(){this.position.setZero();this.R.setIdentity()},set:function(a){this.position.setV(a.position);this.R.setM(a.R)},getAngle:function(){return Math.atan2(this.R.col1.y,
this.R.col1.x)},__class__:d.common.math.B2Transform};d.common.math.B2Mat22=function(){this.col1=new d.common.math.B2Vec2(0,1);this.col2=new d.common.math.B2Vec2(0,1)};d.common.math.B2Mat22.__name__=["box2D","common","math","B2Mat22"];d.common.math.B2Mat22.fromAngle=function(a){var l=new d.common.math.B2Mat22;l.set(a);return l};d.common.math.B2Mat22.fromVV=function(a,l){var b=new d.common.math.B2Mat22;b.setVV(a,l);return b};d.common.math.B2Mat22.prototype={set:function(a){var l=Math.cos(a);a=Math.sin(a);
this.col1.x=l;this.col2.x=-a;this.col1.y=a;this.col2.y=l},setVV:function(a,l){this.col1.setV(a);this.col2.setV(l)},copy:function(){var a=new d.common.math.B2Mat22;a.setM(this);return a},setM:function(a){this.col1.setV(a.col1);this.col2.setV(a.col2)},addM:function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y},setIdentity:function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1},setZero:function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=
0},getAngle:function(){return Math.atan2(this.col1.y,this.col1.x)},getInverse:function(a){var l=this.col1.x,b=this.col2.x,f=this.col1.y,d=this.col2.y,c=l*d-b*f;0!=c&&(c=1/c);a.col1.x=c*d;a.col2.x=-c*b;a.col1.y=-c*f;a.col2.y=c*l;return a},solve:function(a,l,b){var f=this.col1.x,d=this.col2.x,c=this.col1.y,h=this.col2.y,k=f*h-d*c;0!=k&&(k=1/k);a.x=k*(h*l-d*b);a.y=k*(f*b-c*l);return a},abs:function(){this.col1.abs();this.col2.abs()},__class__:d.common.math.B2Mat22};d.collision.B2TimeOfImpact=function(){};
d.collision.B2TimeOfImpact.__name__=["box2D","collision","B2TimeOfImpact"];d.collision.B2TimeOfImpact.timeOfImpact=function(a){++d.collision.B2TimeOfImpact.b2_toiCalls;var b=a.proxyA,e=a.proxyB,f=a.sweepA,c=a.sweepB;d.common.B2Settings.b2Assert(f.t0==c.t0);d.common.B2Settings.b2Assert(1-f.t0>Number.MIN_VALUE);var g=b.m_radius+e.m_radius;a=a.tolerance;var h=0,k=0,m=0;d.collision.B2TimeOfImpact.s_cache.count=0;for(d.collision.B2TimeOfImpact.s_distanceInput.useRadii=!1;;){f.getTransform(d.collision.B2TimeOfImpact.s_xfA,
h);c.getTransform(d.collision.B2TimeOfImpact.s_xfB,h);d.collision.B2TimeOfImpact.s_distanceInput.proxyA=b;d.collision.B2TimeOfImpact.s_distanceInput.proxyB=e;d.collision.B2TimeOfImpact.s_distanceInput.transformA=d.collision.B2TimeOfImpact.s_xfA;d.collision.B2TimeOfImpact.s_distanceInput.transformB=d.collision.B2TimeOfImpact.s_xfB;d.collision.B2Distance.distance(d.collision.B2TimeOfImpact.s_distanceOutput,d.collision.B2TimeOfImpact.s_cache,d.collision.B2TimeOfImpact.s_distanceInput);if(0>=d.collision.B2TimeOfImpact.s_distanceOutput.distance){h=
1;break}d.collision.B2TimeOfImpact.s_fcn.initialize(d.collision.B2TimeOfImpact.s_cache,b,d.collision.B2TimeOfImpact.s_xfA,e,d.collision.B2TimeOfImpact.s_xfB);var p=d.collision.B2TimeOfImpact.s_fcn.evaluate(d.collision.B2TimeOfImpact.s_xfA,d.collision.B2TimeOfImpact.s_xfB);if(0>=p){h=1;break}0==k&&(m=p>g?d.common.math.B2Math.max(g-a,0.75*g):d.common.math.B2Math.max(p-a,0.02*g));if(p-m<0.5*a){if(0==k){h=1;break}break}var u=h,A=h,q=1;f.getTransform(d.collision.B2TimeOfImpact.s_xfA,q);c.getTransform(d.collision.B2TimeOfImpact.s_xfB,
q);var r=d.collision.B2TimeOfImpact.s_fcn.evaluate(d.collision.B2TimeOfImpact.s_xfA,d.collision.B2TimeOfImpact.s_xfB);if(r>=m){h=1;break}for(var s=0;;){var E;E=0!=(s&1)?A+(m-p)*(q-A)/(r-p):0.5*(A+q);f.getTransform(d.collision.B2TimeOfImpact.s_xfA,E);c.getTransform(d.collision.B2TimeOfImpact.s_xfB,E);var x=d.collision.B2TimeOfImpact.s_fcn.evaluate(d.collision.B2TimeOfImpact.s_xfA,d.collision.B2TimeOfImpact.s_xfB);if(d.common.math.B2Math.abs(x-m)<0.025*a){u=E;break}x>m?(A=E,p=x):(q=E,r=x);++s;++d.collision.B2TimeOfImpact.b2_toiRootIters;
if(50==s)break}d.collision.B2TimeOfImpact.b2_toiMaxRootIters=t["int"](d.common.math.B2Math.max(d.collision.B2TimeOfImpact.b2_toiMaxRootIters,s));if(u<(1+100*Number.MIN_VALUE)*h)break;h=u;k++;++d.collision.B2TimeOfImpact.b2_toiIters;if(1E3==k)break}d.collision.B2TimeOfImpact.b2_toiMaxIters=t["int"](d.common.math.B2Math.max(d.collision.B2TimeOfImpact.b2_toiMaxIters,k));return h};d.collision.B2WorldManifold=function(){this.m_normal=new d.common.math.B2Vec2;this.m_points=[];for(var a=0,b=d.common.B2Settings.b2_maxManifoldPoints;a<
b;){var e=a++;this.m_points[e]=new d.common.math.B2Vec2}};d.collision.B2WorldManifold.__name__=["box2D","collision","B2WorldManifold"];d.collision.B2WorldManifold.prototype={initialize:function(a,b,e,f,d){if(0!=a.m_pointCount){var c,h,k,m,p,u,A;switch(a.m_type[1]){case 0:h=b.R;c=a.m_localPoint;k=b.position.x+h.col1.x*c.x+h.col2.x*c.y;m=b.position.y+h.col1.y*c.x+h.col2.y*c.y;h=f.R;c=a.m_points[0].m_localPoint;a=f.position.x+h.col1.x*c.x+h.col2.x*c.y;c=f.position.y+h.col1.y*c.x+h.col2.y*c.y;h=a-k;f=
c-m;p=h*h+f*f;p>Number.MIN_VALUE*Number.MIN_VALUE?(p=Math.sqrt(p),this.m_normal.x=h/p,this.m_normal.y=f/p):(this.m_normal.x=1,this.m_normal.y=0);h=m+e*this.m_normal.y;c-=d*this.m_normal.y;this.m_points[0].x=0.5*(k+e*this.m_normal.x+(a-d*this.m_normal.x));this.m_points[0].y=0.5*(h+c);break;case 1:h=b.R;c=a.m_localPlaneNormal;k=h.col1.x*c.x+h.col2.x*c.y;m=h.col1.y*c.x+h.col2.y*c.y;h=b.R;c=a.m_localPoint;p=b.position.x+h.col1.x*c.x+h.col2.x*c.y;u=b.position.y+h.col1.y*c.x+h.col2.y*c.y;this.m_normal.x=
k;this.m_normal.y=m;b=0;for(var q=a.m_pointCount;b<q;){var r=b++;h=f.R;c=a.m_points[r].m_localPoint;A=f.position.x+h.col1.x*c.x+h.col2.x*c.y;c=f.position.y+h.col1.y*c.x+h.col2.y*c.y;this.m_points[r].x=A+0.5*(e-(A-p)*k-(c-u)*m-d)*k;this.m_points[r].y=c+0.5*(e-(A-p)*k-(c-u)*m-d)*m}break;case 2:for(h=f.R,c=a.m_localPlaneNormal,k=h.col1.x*c.x+h.col2.x*c.y,m=h.col1.y*c.x+h.col2.y*c.y,h=f.R,c=a.m_localPoint,p=f.position.x+h.col1.x*c.x+h.col2.x*c.y,u=f.position.y+h.col1.y*c.x+h.col2.y*c.y,this.m_normal.x=
-k,this.m_normal.y=-m,f=0,q=a.m_pointCount;f<q;)r=f++,h=b.R,c=a.m_points[r].m_localPoint,A=b.position.x+h.col1.x*c.x+h.col2.x*c.y,c=b.position.y+h.col1.y*c.x+h.col2.y*c.y,this.m_points[r].x=A+0.5*(d-(A-p)*k-(c-u)*m-e)*k,this.m_points[r].y=c+0.5*(d-(A-p)*k-(c-u)*m-e)*m}}},__class__:d.collision.B2WorldManifold};d.collision.shapes={};d.collision.shapes.B2Shape=function(){this.m_type=d.collision.shapes.B2ShapeType.UNKNOWN_SHAPE;this.m_radius=d.common.B2Settings.b2_linearSlop};d.collision.shapes.B2Shape.__name__=
["box2D","collision","shapes","B2Shape"];d.collision.shapes.B2Shape.testOverlap=function(a,b,e,f){return!0};d.collision.shapes.B2Shape.prototype={copy:function(){return null},set:function(a){this.m_radius=a.m_radius},getType:function(){return this.m_type},testPoint:function(a,b){return!1},rayCast:function(a,b,e){return!1},computeAABB:function(a,b){},computeMass:function(a,b){},computeSubmergedArea:function(a,b,e,f){return 0},__class__:d.collision.shapes.B2Shape};d.collision.shapes.B2CircleShape=function(a){null==
a&&(a=0);d.collision.shapes.B2Shape.call(this);this.m_p=new d.common.math.B2Vec2;this.m_type=d.collision.shapes.B2ShapeType.CIRCLE_SHAPE;this.m_radius=a};d.collision.shapes.B2CircleShape.__name__=["box2D","collision","shapes","B2CircleShape"];d.collision.shapes.B2CircleShape.__super__=d.collision.shapes.B2Shape;d.collision.shapes.B2CircleShape.prototype=r(d.collision.shapes.B2Shape.prototype,{copy:function(){var a=new d.collision.shapes.B2CircleShape;a.set(this);return a},set:function(a){d.collision.shapes.B2Shape.prototype.set.call(this,
a);z.Boot.__instanceof(a,d.collision.shapes.B2CircleShape)&&(a=z.Boot.__cast(a,d.collision.shapes.B2CircleShape),this.m_p.setV(a.m_p))},testPoint:function(a,b){var e=a.R,f=a.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=a.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),f=b.x-f,e=b.y-e;return f*f+e*e<=this.m_radius*this.m_radius},rayCast:function(a,b,e){var f=e.R,d=b.p1.x-(e.position.x+(f.col1.x*this.m_p.x+f.col2.x*this.m_p.y));e=b.p1.y-(e.position.y+(f.col1.y*this.m_p.x+f.col2.y*this.m_p.y));
var f=b.p2.x-b.p1.x,c=b.p2.y-b.p1.y,h=d*f+e*c,k=f*f+c*c,m=h*h-k*(d*d+e*e-this.m_radius*this.m_radius);if(0>m||k<Number.MIN_VALUE)return!1;h=-(h+Math.sqrt(m));return 0<=h&&h<=b.maxFraction*k?(h/=k,a.fraction=h,a.normal.x=d+h*f,a.normal.y=e+h*c,a.normal.normalize(),!0):!1},computeAABB:function(a,b){var e=b.R,f=b.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=b.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y);a.lowerBound.set(f-this.m_radius,e-this.m_radius);a.upperBound.set(f+this.m_radius,
e+this.m_radius)},computeMass:function(a,b){a.mass=b*d.common.B2Settings.b2_pi*this.m_radius*this.m_radius;a.center.setV(this.m_p);a.I=a.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},computeSubmergedArea:function(a,b,e,f){e=d.common.math.B2Math.mulX(e,this.m_p);var c=-(d.common.math.B2Math.dot(a,e)-b);if(c<-this.m_radius+Number.MIN_VALUE)return 0;if(c>this.m_radius)return f.setV(e),Math.PI*this.m_radius*this.m_radius;b=this.m_radius*this.m_radius;var g=c*c,
c=b*(Math.asin(c/this.m_radius)+Math.PI/2)+c*Math.sqrt(b-g);b=-0.6666666666666666*Math.pow(b-g,1.5)/c;f.x=e.x+a.x*b;f.y=e.y+a.y*b;return c},getLocalPosition:function(){return this.m_p},setLocalPosition:function(a){this.m_p.setV(a)},getRadius:function(){return this.m_radius},setRadius:function(a){this.m_radius=a},__class__:d.collision.shapes.B2CircleShape});d.collision.shapes.B2EdgeShape=function(a,b){d.collision.shapes.B2Shape.call(this);this.s_supportVec=new d.common.math.B2Vec2;this.m_v1=new d.common.math.B2Vec2;
this.m_v2=new d.common.math.B2Vec2;this.m_coreV1=new d.common.math.B2Vec2;this.m_coreV2=new d.common.math.B2Vec2;this.m_normal=new d.common.math.B2Vec2;this.m_direction=new d.common.math.B2Vec2;this.m_cornerDir1=new d.common.math.B2Vec2;this.m_cornerDir2=new d.common.math.B2Vec2;this.m_type=d.collision.shapes.B2ShapeType.EDGE_SHAPE;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=a;this.m_v2=b;this.m_direction.set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.normalize();
this.m_normal.set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.set(-d.common.B2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-d.common.B2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.set(-d.common.B2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-d.common.B2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.set(-this.m_normal.x,-this.m_normal.y)};
d.collision.shapes.B2EdgeShape.__name__=["box2D","collision","shapes","B2EdgeShape"];d.collision.shapes.B2EdgeShape.__super__=d.collision.shapes.B2Shape;d.collision.shapes.B2EdgeShape.prototype=r(d.collision.shapes.B2Shape.prototype,{testPoint:function(a,b){return!1},rayCast:function(a,b,e){var f,d=b.p2.x-b.p1.x,c=b.p2.y-b.p1.y;f=e.R;var h=e.position.x+(f.col1.x*this.m_v1.x+f.col2.x*this.m_v1.y),k=e.position.y+(f.col1.y*this.m_v1.x+f.col2.y*this.m_v1.y),m=e.position.y+(f.col1.y*this.m_v2.x+f.col2.y*
this.m_v2.y)-k;e=-(e.position.x+(f.col1.x*this.m_v2.x+f.col2.x*this.m_v2.y)-h);f=100*Number.MIN_VALUE;var p=-(d*m+c*e);if(p>f){var h=b.p1.x-h,u=b.p1.y-k,k=h*m+u*e;if(0<=k&&k<=b.maxFraction*p&&(b=-d*u+c*h,-f*p<=b&&b<=p*(1+f)))return a.fraction=k/p,b=Math.sqrt(m*m+e*e),a.normal.x=m/b,a.normal.y=e/b,!0}return!1},computeAABB:function(a,b){var e=b.R,f=b.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),d=b.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),c=b.position.x+(e.col1.x*this.m_v2.x+
e.col2.x*this.m_v2.y),e=b.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y);f<c?(a.lowerBound.x=f,a.upperBound.x=c):(a.lowerBound.x=c,a.upperBound.x=f);d<e?(a.lowerBound.y=d,a.upperBound.y=e):(a.lowerBound.y=e,a.upperBound.y=d)},computeMass:function(a,b){a.mass=0;a.center.setV(this.m_v1);a.I=0},computeSubmergedArea:function(a,b,e,f){var c=new d.common.math.B2Vec2(a.x*b,a.y*b),g=d.common.math.B2Math.mulX(e,this.m_v1);e=d.common.math.B2Math.mulX(e,this.m_v2);var h=d.common.math.B2Math.dot(a,g)-
b;a=d.common.math.B2Math.dot(a,e)-b;if(0<h){if(0<a)return 0;g.x=-a/(h-a)*g.x+h/(h-a)*e.x;g.y=-a/(h-a)*g.y+h/(h-a)*e.y}else 0<a&&(e.x=-a/(h-a)*g.x+h/(h-a)*e.x,e.y=-a/(h-a)*g.y+h/(h-a)*e.y);f.x=(c.x+g.x+e.x)/3;f.y=(c.y+g.y+e.y)/3;return 0.5*((g.x-c.x)*(e.y-c.y)-(g.y-c.y)*(e.x-c.x))},getLength:function(){return this.m_length},getVertex1:function(){return this.m_v1},getVertex2:function(){return this.m_v2},getCoreVertex1:function(){return this.m_coreV1},getCoreVertex2:function(){return this.m_coreV2},
getNormalVector:function(){return this.m_normal},getDirectionVector:function(){return this.m_direction},getCorner1Vector:function(){return this.m_cornerDir1},getCorner2Vector:function(){return this.m_cornerDir2},corner1IsConvex:function(){return this.m_cornerConvex1},corner2IsConvex:function(){return this.m_cornerConvex2},getFirstVertex:function(a){var b=a.R;return new d.common.math.B2Vec2(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*
this.m_coreV1.y))},getNextEdge:function(){return this.m_nextEdge},getPrevEdge:function(){return this.m_prevEdge},support:function(a,b,e){var f=a.R,d=a.position.x+(f.col1.x*this.m_coreV1.x+f.col2.x*this.m_coreV1.y),c=a.position.y+(f.col1.y*this.m_coreV1.x+f.col2.y*this.m_coreV1.y),h=a.position.x+(f.col1.x*this.m_coreV2.x+f.col2.x*this.m_coreV2.y);a=a.position.y+(f.col1.y*this.m_coreV2.x+f.col2.y*this.m_coreV2.y);d*b+c*e>h*b+a*e?(this.s_supportVec.x=d,this.s_supportVec.y=c):(this.s_supportVec.x=h,this.s_supportVec.y=
a);return this.s_supportVec},setPrevEdge:function(a,b,e,f){this.m_prevEdge=a;this.m_coreV1=b;this.m_cornerDir1=e;this.m_cornerConvex1=f},setNextEdge:function(a,b,e,f){this.m_nextEdge=a;this.m_coreV2=b;this.m_cornerDir2=e;this.m_cornerConvex2=f},__class__:d.collision.shapes.B2EdgeShape});d.collision.shapes.B2MassData=function(){this.mass=0;this.center=new d.common.math.B2Vec2(0,0);this.I=0};d.collision.shapes.B2MassData.__name__=["box2D","collision","shapes","B2MassData"];d.collision.shapes.B2MassData.prototype=
{__class__:d.collision.shapes.B2MassData};d.collision.shapes.B2PolygonShape=function(){d.collision.shapes.B2Shape.call(this);this.m_type=d.collision.shapes.B2ShapeType.POLYGON_SHAPE;this.m_centroid=new d.common.math.B2Vec2;this.m_vertices=[];this.m_normals=[]};d.collision.shapes.B2PolygonShape.__name__=["box2D","collision","shapes","B2PolygonShape"];d.collision.shapes.B2PolygonShape.asArray=function(a,b){var e=new d.collision.shapes.B2PolygonShape;e.setAsArray(a,b);return e};d.collision.shapes.B2PolygonShape.asVector=
function(a,b){var e=new d.collision.shapes.B2PolygonShape;e.setAsVector(a,b);return e};d.collision.shapes.B2PolygonShape.asBox=function(a,b){var e=new d.collision.shapes.B2PolygonShape;e.setAsBox(a,b);return e};d.collision.shapes.B2PolygonShape.asOrientedBox=function(a,b,e,f){null==f&&(f=0);var c=new d.collision.shapes.B2PolygonShape;c.setAsOrientedBox(a,b,e,f);return c};d.collision.shapes.B2PolygonShape.asEdge=function(a,b){var e=new d.collision.shapes.B2PolygonShape;e.setAsEdge(a,b);return e};d.collision.shapes.B2PolygonShape.computeCentroid=
function(a,b){for(var e=new d.common.math.B2Vec2,f=0,c=0;c<b;){var g=c++,h=a[g],g=g+1<b?a[g+1|0]:a[0],k=0.5*((h.x-0)*(g.y-0)-(h.y-0)*(g.x-0)),f=f+k;e.x+=0.3333333333333333*k*(0+h.x+g.x);e.y+=0.3333333333333333*k*(0+h.y+g.y)}e.x*=1/f;e.y*=1/f;return e};d.collision.shapes.B2PolygonShape.computeOBB=function(a,b,e){for(var f=[],d=0;d<e;){var c=d++;f[c]=b[c]}f[e]=f[0];b=Number.MAX_VALUE;d=1;for(c=e+1;d<c;){for(var h=d++,k=f[h-1|0],m=f[h].x-k.x,p=f[h].y-k.y,h=Math.sqrt(m*m+p*p),m=m/h,p=p/h,u=-p,A=m,q=h=
Number.MAX_VALUE,r=-Number.MAX_VALUE,t=-Number.MAX_VALUE,s=0;s<e;){var x=s++,I=f[x].x-k.x,w=f[x].y-k.y,x=m*I+p*w,I=u*I+A*w;x<h&&(h=x);I<q&&(q=I);x>r&&(r=x);I>t&&(t=I)}s=(r-h)*(t-q);s<0.95*b&&(b=s,a.R.col1.x=m,a.R.col1.y=p,a.R.col2.x=u,a.R.col2.y=A,m=0.5*(h+r),p=0.5*(q+t),u=a.R,a.center.x=k.x+(u.col1.x*m+u.col2.x*p),a.center.y=k.y+(u.col1.y*m+u.col2.y*p),a.extents.x=0.5*(r-h),a.extents.y=0.5*(t-q))}};d.collision.shapes.B2PolygonShape.__super__=d.collision.shapes.B2Shape;d.collision.shapes.B2PolygonShape.prototype=
r(d.collision.shapes.B2Shape.prototype,{copy:function(){var a=new d.collision.shapes.B2PolygonShape;a.set(this);return a},set:function(a){d.collision.shapes.B2Shape.prototype.set.call(this,a);if(z.Boot.__instanceof(a,d.collision.shapes.B2PolygonShape)){a=z.Boot.__cast(a,d.collision.shapes.B2PolygonShape);this.m_centroid.setV(a.m_centroid);this.m_vertexCount=a.m_vertexCount;this.reserve(this.m_vertexCount);for(var b=0,e=this.m_vertexCount;b<e;){var f=b++;this.m_vertices[f].setV(a.m_vertices[f]);this.m_normals[f].setV(a.m_normals[f])}}},
setAsArray:function(a,b){null==b&&(b=0);for(var e=[],f=0;f<a.length;){var d=a[f];++f;e.push(d)}this.setAsVector(e,b)},setAsVector:function(a,b){null==b&&(b=0);0==b&&(b=a.length);d.common.B2Settings.b2Assert(2<=b);this.m_vertexCount=b|0;this.reserve(b|0);for(var e=0,f=this.m_vertexCount;e<f;){var c=e++;this.m_vertices[c].setV(a[c])}e=0;for(f=this.m_vertexCount;e<f;){var c=e++,g=d.common.math.B2Math.subtractVV(this.m_vertices[c+1<this.m_vertexCount?c+1:0],this.m_vertices[c]);d.common.B2Settings.b2Assert(g.lengthSquared()>
Number.MIN_VALUE);this.m_normals[c].setV(d.common.math.B2Math.crossVF(g,1));this.m_normals[c].normalize()}this.m_centroid=d.collision.shapes.B2PolygonShape.computeCentroid(this.m_vertices,this.m_vertexCount)},setAsBox:function(a,b){this.m_vertexCount=4;this.reserve(4);this.m_vertices[0].set(-a,-b);this.m_vertices[1].set(a,-b);this.m_vertices[2].set(a,b);this.m_vertices[3].set(-a,b);this.m_normals[0].set(0,-1);this.m_normals[1].set(1,0);this.m_normals[2].set(0,1);this.m_normals[3].set(-1,0);this.m_centroid.setZero()},
setAsOrientedBox:function(a,b,e,f){null==f&&(f=0);this.m_vertexCount=4;this.reserve(4);this.m_vertices[0].set(-a,-b);this.m_vertices[1].set(a,-b);this.m_vertices[2].set(a,b);this.m_vertices[3].set(-a,b);this.m_normals[0].set(0,-1);this.m_normals[1].set(1,0);this.m_normals[2].set(0,1);this.m_normals[3].set(-1,0);this.m_centroid=e;a=new d.common.math.B2Transform;a.position=e;a.R.set(f);e=0;for(f=this.m_vertexCount;e<f;)b=e++,this.m_vertices[b]=d.common.math.B2Math.mulX(a,this.m_vertices[b]),this.m_normals[b]=
d.common.math.B2Math.mulMV(a.R,this.m_normals[b])},setAsEdge:function(a,b){this.m_vertexCount=2;this.reserve(2);this.m_vertices[0].setV(a);this.m_vertices[1].setV(b);this.m_centroid.x=0.5*(a.x+b.x);this.m_centroid.y=0.5*(a.y+b.y);this.m_normals[0]=d.common.math.B2Math.crossVF(d.common.math.B2Math.subtractVV(b,a),1);this.m_normals[0].normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y},testPoint:function(a,b){var e;e=a.R;for(var f=b.x-a.position.x,d=b.y-a.position.y,
c=f*e.col1.x+d*e.col1.y,h=f*e.col2.x+d*e.col2.y,k=0,m=this.m_vertexCount;k<m;){var p=k++;e=this.m_vertices[p];f=c-e.x;d=h-e.y;e=this.m_normals[p];if(0<e.x*f+e.y*d)return!1}return!0},rayCast:function(a,b,e){var f=0,d=b.maxFraction,c,h,k,m;c=b.p1.x-e.position.x;h=b.p1.y-e.position.y;k=e.R;var p=c*k.col1.x+h*k.col1.y,u=c*k.col2.x+h*k.col2.y;c=b.p2.x-e.position.x;h=b.p2.y-e.position.y;k=e.R;b=c*k.col1.x+h*k.col1.y-p;k=c*k.col2.x+h*k.col2.y-u;for(var A=-1,q=0,r=this.m_vertexCount;q<r;){var t=q++;m=this.m_vertices[t];
c=m.x-p;h=m.y-u;m=this.m_normals[t];c=m.x*c+m.y*h;h=m.x*b+m.y*k;if(0==h){if(0>c)return!1}else 0>h&&c<f*h?(f=c/h,A=t):0<h&&c<d*h&&(d=c/h);if(d<f-Number.MIN_VALUE)return!1}return 0<=A?(a.fraction=f,k=e.R,m=this.m_normals[A],a.normal.x=k.col1.x*m.x+k.col2.x*m.y,a.normal.y=k.col1.y*m.x+k.col2.y*m.y,!0):!1},computeAABB:function(a,b){for(var e=b.R,f=this.m_vertices[0],d=b.position.x+(e.col1.x*f.x+e.col2.x*f.y),c=b.position.y+(e.col1.y*f.x+e.col2.y*f.y),h=d,k=c,m=1,p=this.m_vertexCount;m<p;){var u=m++,f=
this.m_vertices[u],u=b.position.x+(e.col1.x*f.x+e.col2.x*f.y),f=b.position.y+(e.col1.y*f.x+e.col2.y*f.y);d<u||(d=u);c<f||(c=f);h>u||(h=u);k>f||(k=f)}a.lowerBound.x=d-this.m_radius;a.lowerBound.y=c-this.m_radius;a.upperBound.x=h+this.m_radius;a.upperBound.y=k+this.m_radius},computeMass:function(a,b){if(2==this.m_vertexCount)a.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var e=0,f=0,d=0,c=0,h=0,k=this.m_vertexCount;h<
k;){var m=h++,p=this.m_vertices[m],u;u=m+1<this.m_vertexCount?this.m_vertices[m+1|0]:this.m_vertices[0];var A=p.x-0,q=p.y-0,r=u.x-0,t=u.y-0,m=A*t-q*r,s=0.5*m,d=d+s,e=e+0.3333333333333333*s*(0+p.x+u.x),f=f+0.3333333333333333*s*(0+p.y+u.y),p=A,c=c+m*(0.3333333333333333*(0.25*(p*p+r*p+r*r)+(0*p+0*r))+0+(0.3333333333333333*(0.25*(q*q+t*q+t*t)+(0*q+0*t))+0))}a.mass=b*d;a.center.set(e*(1/d),f*(1/d));a.I=b*c}},computeSubmergedArea:function(a,b,e,f){var c=d.common.math.B2Math.mulTMV(e.R,a),g=b-d.common.math.B2Math.dot(a,
e.position),h=[],k=0;a=b=-1;for(var m=!1,p=0,u=this.m_vertexCount;p<u;){var A=p++;h[A]=d.common.math.B2Math.dot(c,this.m_vertices[A])-g;var q=h[A]<-Number.MIN_VALUE;0<A&&(q?m||(b=A-1,k++):m&&(a=A-1,k++));m=q}switch(k){case 0:return m?(a=new d.collision.shapes.B2MassData,this.computeMass(a,1),f.setV(d.common.math.B2Math.mulX(e,a.center)),a.mass):0;case 1:-1==b?b=this.m_vertexCount-1:a=this.m_vertexCount-1}g=(b+1)%this.m_vertexCount;c=(a+1)%this.m_vertexCount;k=(0-h[b])/(h[g]-h[b]);h=(0-h[a])/(h[c]-
h[a]);b=new d.common.math.B2Vec2(this.m_vertices[b].x*(1-k)+this.m_vertices[g].x*k,this.m_vertices[b].y*(1-k)+this.m_vertices[g].y*k);a=new d.common.math.B2Vec2(this.m_vertices[a].x*(1-h)+this.m_vertices[c].x*h,this.m_vertices[a].y*(1-h)+this.m_vertices[c].y*h);h=0;k=new d.common.math.B2Vec2;for(m=this.m_vertices[g];g!=c;)g=(g+1)%this.m_vertexCount,p=g==c?a:this.m_vertices[g],u=0.5*((m.x-b.x)*(p.y-b.y)-(m.y-b.y)*(p.x-b.x)),h+=u,k.x+=u*(b.x+m.x+p.x)/3,k.y+=u*(b.y+m.y+p.y)/3,m=p;k.multiply(1/h);f.setV(d.common.math.B2Math.mulX(e,
k));return h},getVertexCount:function(){return this.m_vertexCount},getVertices:function(){return this.m_vertices},getNormals:function(){return this.m_normals},getSupport:function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,f=1,d=this.m_vertexCount;f<d;){var c=f++,h=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;h>e&&(b=c,e=h)}return b},getSupportVertex:function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,f=1,d=this.m_vertexCount;f<d;){var c=f++,h=this.m_vertices[c].x*
a.x+this.m_vertices[c].y*a.y;h>e&&(b=c,e=h)}return this.m_vertices[b]},validate:function(){return!1},reserve:function(a){for(var b=this.m_vertices.length;b<a;){var e=b++;this.m_vertices[e]=new d.common.math.B2Vec2;this.m_normals[e]=new d.common.math.B2Vec2}},__class__:d.collision.shapes.B2PolygonShape});d.collision.shapes.B2ShapeType={__ename__:!0,__constructs__:["UNKNOWN_SHAPE","CIRCLE_SHAPE","POLYGON_SHAPE","EDGE_SHAPE"]};d.collision.shapes.B2ShapeType.UNKNOWN_SHAPE=["UNKNOWN_SHAPE",0];d.collision.shapes.B2ShapeType.UNKNOWN_SHAPE.toString=
D;d.collision.shapes.B2ShapeType.UNKNOWN_SHAPE.__enum__=d.collision.shapes.B2ShapeType;d.collision.shapes.B2ShapeType.CIRCLE_SHAPE=["CIRCLE_SHAPE",1];d.collision.shapes.B2ShapeType.CIRCLE_SHAPE.toString=D;d.collision.shapes.B2ShapeType.CIRCLE_SHAPE.__enum__=d.collision.shapes.B2ShapeType;d.collision.shapes.B2ShapeType.POLYGON_SHAPE=["POLYGON_SHAPE",2];d.collision.shapes.B2ShapeType.POLYGON_SHAPE.toString=D;d.collision.shapes.B2ShapeType.POLYGON_SHAPE.__enum__=d.collision.shapes.B2ShapeType;d.collision.shapes.B2ShapeType.EDGE_SHAPE=
["EDGE_SHAPE",3];d.collision.shapes.B2ShapeType.EDGE_SHAPE.toString=D;d.collision.shapes.B2ShapeType.EDGE_SHAPE.__enum__=d.collision.shapes.B2ShapeType;d.collision.shapes.B2ShapeType.__empty_constructs__=[d.collision.shapes.B2ShapeType.UNKNOWN_SHAPE,d.collision.shapes.B2ShapeType.CIRCLE_SHAPE,d.collision.shapes.B2ShapeType.POLYGON_SHAPE,d.collision.shapes.B2ShapeType.EDGE_SHAPE];d.common.B2Color=function(a,b,e){this._r=t["int"](255*d.common.math.B2Math.clamp(a,0,1));this._g=t["int"](255*d.common.math.B2Math.clamp(b,
0,1));this._b=t["int"](255*d.common.math.B2Math.clamp(e,0,1))};d.common.B2Color.__name__=["box2D","common","B2Color"];d.common.B2Color.prototype={set:function(a,b,e){this._r=t["int"](255*d.common.math.B2Math.clamp(a,0,1));this._g=t["int"](255*d.common.math.B2Math.clamp(b,0,1));this._b=t["int"](255*d.common.math.B2Math.clamp(e,0,1))},toHex:function(){return"#"+this.componentToHex(this._r)+this.componentToHex(this._g)+this.componentToHex(this._b)},componentToHex:function(a){a=a.toString(16);return"1"==
a.length?"0"+a:a},set_r:function(a){return this._r=t["int"](255*d.common.math.B2Math.clamp(a,0,1))},set_g:function(a){return this._g=t["int"](255*d.common.math.B2Math.clamp(a,0,1))},set_b:function(a){return this._b=t["int"](255*d.common.math.B2Math.clamp(a,0,1))},get_r:function(){return this._r},get_g:function(){return this._g},get_b:function(){return this._b},get_color:function(){return this._r<<16|this._g<<8|this._b},__class__:d.common.B2Color,__properties__:{get_color:"get_color",set_b:"set_b",
set_g:"set_g",set_r:"set_r"}};d.common.B2Settings=function(){};d.common.B2Settings.__name__=["box2D","common","B2Settings"];d.common.B2Settings.b2MixFriction=function(a,b){return Math.sqrt(a*b)};d.common.B2Settings.b2MixRestitution=function(a,b){return a>b?a:b};d.common.B2Settings.b2Assert=function(a){if(!a)throw"Assertion Failed";};d.common.math.B2Mat33=function(a,b,e){this.col1=new d.common.math.B2Vec3;this.col2=new d.common.math.B2Vec3;this.col3=new d.common.math.B2Vec3;null==a&&null==b&&null==
e?(this.col1.setZero(),this.col2.setZero(),this.col3.setZero()):(this.col1.setV(a),this.col2.setV(b),this.col3.setV(e))};d.common.math.B2Mat33.__name__=["box2D","common","math","B2Mat33"];d.common.math.B2Mat33.prototype={setVVV:function(a,b,e){this.col1.setV(a);this.col2.setV(b);this.col3.setV(e)},copy:function(){return new d.common.math.B2Mat33(this.col1,this.col2,this.col3)},setM:function(a){this.col1.setV(a.col1);this.col2.setV(a.col2);this.col3.setV(a.col3)},addM:function(a){this.col1.x+=a.col1.x;
this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z},setIdentity:function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1},setZero:function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0},solve22:function(a,b,e){var f=
this.col1.x,d=this.col2.x,c=this.col1.y,h=this.col2.y,k=f*h-d*c;0!=k&&(k=1/k);a.x=k*(h*b-d*e);a.y=k*(f*e-c*b);return a},solve33:function(a,b,e,f){var d=this.col1.x,c=this.col1.y,h=this.col1.z,k=this.col2.x,m=this.col2.y,p=this.col2.z,u=this.col3.x,A=this.col3.y,q=this.col3.z,r=d*(m*q-p*A)+c*(p*u-k*q)+h*(k*A-m*u);0!=r&&(r=1/r);a.x=r*(b*(m*q-p*A)+e*(p*u-k*q)+f*(k*A-m*u));a.y=r*(d*(e*q-f*A)+c*(f*u-b*q)+h*(b*A-e*u));a.z=r*(d*(m*f-p*e)+c*(p*b-k*f)+h*(k*e-m*b));return a},__class__:d.common.math.B2Mat33};
d.common.math.B2Math=function(){};d.common.math.B2Math.__name__=["box2D","common","math","B2Math"];d.common.math.B2Math.__properties__={get_MAX_VALUE:"get_MAX_VALUE",get_MIN_VALUE:"get_MIN_VALUE"};d.common.math.B2Math.isValid=function(a){return Math.isNaN(a)||a==Math.NEGATIVE_INFINITY||a==Math.POSITIVE_INFINITY?!1:!0};d.common.math.B2Math.dot=function(a,b){return a.x*b.x+a.y*b.y};d.common.math.B2Math.crossVV=function(a,b){return a.x*b.y-a.y*b.x};d.common.math.B2Math.crossVF=function(a,b){return new d.common.math.B2Vec2(b*
a.y,-b*a.x)};d.common.math.B2Math.crossFV=function(a,b){return new d.common.math.B2Vec2(-a*b.y,a*b.x)};d.common.math.B2Math.mulMV=function(a,b){return new d.common.math.B2Vec2(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)};d.common.math.B2Math.mulTMV=function(a,b){return new d.common.math.B2Vec2(d.common.math.B2Math.dot(b,a.col1),d.common.math.B2Math.dot(b,a.col2))};d.common.math.B2Math.mulX=function(a,b){var e=d.common.math.B2Math.mulMV(a.R,b);e.x+=a.position.x;e.y+=a.position.y;return e};
d.common.math.B2Math.mulXT=function(a,b){var e=d.common.math.B2Math.subtractVV(b,a.position),f=e.x*a.R.col1.x+e.y*a.R.col1.y;e.y=e.x*a.R.col2.x+e.y*a.R.col2.y;e.x=f;return e};d.common.math.B2Math.addVV=function(a,b){return new d.common.math.B2Vec2(a.x+b.x,a.y+b.y)};d.common.math.B2Math.subtractVV=function(a,b){return new d.common.math.B2Vec2(a.x-b.x,a.y-b.y)};d.common.math.B2Math.distance=function(a,b){var e=a.x-b.x,f=a.y-b.y;return Math.sqrt(e*e+f*f)};d.common.math.B2Math.distanceSquared=function(a,
b){var e=a.x-b.x,f=a.y-b.y;return e*e+f*f};d.common.math.B2Math.mulFV=function(a,b){return new d.common.math.B2Vec2(a*b.x,a*b.y)};d.common.math.B2Math.addMM=function(a,b){return d.common.math.B2Mat22.fromVV(d.common.math.B2Math.addVV(a.col1,b.col1),d.common.math.B2Math.addVV(a.col2,b.col2))};d.common.math.B2Math.mulMM=function(a,b){return d.common.math.B2Mat22.fromVV(d.common.math.B2Math.mulMV(a,b.col1),d.common.math.B2Math.mulMV(a,b.col2))};d.common.math.B2Math.mulTMM=function(a,b){var e=new d.common.math.B2Vec2(d.common.math.B2Math.dot(a.col1,
b.col1),d.common.math.B2Math.dot(a.col2,b.col1)),f=new d.common.math.B2Vec2(d.common.math.B2Math.dot(a.col1,b.col2),d.common.math.B2Math.dot(a.col2,b.col2));return d.common.math.B2Mat22.fromVV(e,f)};d.common.math.B2Math.abs=function(a){return 0<a?a:-a};d.common.math.B2Math.absV=function(a){return new d.common.math.B2Vec2(d.common.math.B2Math.abs(a.x),d.common.math.B2Math.abs(a.y))};d.common.math.B2Math.absM=function(a){return d.common.math.B2Mat22.fromVV(d.common.math.B2Math.absV(a.col1),d.common.math.B2Math.absV(a.col2))};
d.common.math.B2Math.min=function(a,b){return a<b?a:b};d.common.math.B2Math.minV=function(a,b){return new d.common.math.B2Vec2(d.common.math.B2Math.min(a.x,b.x),d.common.math.B2Math.min(a.y,b.y))};d.common.math.B2Math.max=function(a,b){return a>b?a:b};d.common.math.B2Math.maxV=function(a,b){return new d.common.math.B2Vec2(d.common.math.B2Math.max(a.x,b.x),d.common.math.B2Math.max(a.y,b.y))};d.common.math.B2Math.clamp=function(a,b,e){return a<b?b:a>e?e:a};d.common.math.B2Math.clampV=function(a,b,e){return d.common.math.B2Math.maxV(b,
d.common.math.B2Math.minV(a,e))};d.common.math.B2Math.swap=function(a,b){var e=a[0];a[0]=b[0];b[0]=e};d.common.math.B2Math.random=function(){return 2*Math.random()-1};d.common.math.B2Math.randomRange=function(a,b){var e=Math.random();return(b-a)*e+a};d.common.math.B2Math.nextPowerOfTwo=function(a){a|=a>>1&2147483647;a|=a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;return(a|a>>16&65535)+1};d.common.math.B2Math.isPowerOfTwo=function(a){return 0<a&&0==(a&a-1)};d.common.math.B2Math.get_MIN_VALUE=
function(){return Number.MIN_VALUE};d.common.math.B2Math.get_MAX_VALUE=function(){return Number.MAX_VALUE};d.common.math.B2Sweep=function(){this.localCenter=new d.common.math.B2Vec2;this.c0=new d.common.math.B2Vec2;this.c=new d.common.math.B2Vec2};d.common.math.B2Sweep.__name__=["box2D","common","math","B2Sweep"];d.common.math.B2Sweep.prototype={set:function(a){this.localCenter.setV(a.localCenter);this.c0.setV(a.c0);this.c.setV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0},copy:function(){var a=new d.common.math.B2Sweep;
a.localCenter.setV(this.localCenter);a.c0.setV(this.c0);a.c.setV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a},getTransform:function(a,b){a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.set((1-b)*this.a0+b*this.a);var e=a.R;a.position.x-=e.col1.x*this.localCenter.x+e.col2.x*this.localCenter.y;a.position.y-=e.col1.y*this.localCenter.x+e.col2.y*this.localCenter.y},advance:function(a){if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);
this.c0.x=(1-b)*this.c0.x+b*this.c.x;this.c0.y=(1-b)*this.c0.y+b*this.c.y;this.a0=(1-b)*this.a0+b*this.a;this.t0=a}},__class__:d.common.math.B2Sweep};d.common.math.B2Vec3=function(a,b,e){null==e&&(e=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=e};d.common.math.B2Vec3.__name__=["box2D","common","math","B2Vec3"];d.common.math.B2Vec3.prototype={setZero:function(){this.x=this.y=this.z=0},set:function(a,b,e){this.x=a;this.y=b;this.z=e},setV:function(a){this.x=a.x;this.y=a.y;this.z=a.z},getNegative:function(){return new d.common.math.B2Vec3(-this.x,
-this.y,-this.z)},negativeSelf:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z},copy:function(){return new d.common.math.B2Vec3(this.x,this.y,this.z)},add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z},subtract:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z},multiply:function(a){this.x*=a;this.y*=a;this.z*=a},__class__:d.common.math.B2Vec3};d.dynamics={};d.dynamics.B2Body=function(a,b){this.m_xf=new d.common.math.B2Transform;this.m_sweep=new d.common.math.B2Sweep;this.m_linearVelocity=
new d.common.math.B2Vec2;this.m_force=new d.common.math.B2Vec2;this.m_flags=0;a.bullet&&(this.m_flags|=d.dynamics.B2Body.e_bulletFlag);a.fixedRotation&&(this.m_flags|=d.dynamics.B2Body.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=d.dynamics.B2Body.e_allowSleepFlag);a.awake&&(this.m_flags|=d.dynamics.B2Body.e_awakeFlag);a.active&&(this.m_flags|=d.dynamics.B2Body.e_activeFlag);this.m_world=b;this.m_xf.position.setV(a.position);this.m_xf.R.set(a.angle);this.m_sweep.localCenter.setZero();this.m_sweep.t0=
1;this.m_sweep.a0=this.m_sweep.a=a.angle;var e=this.m_xf.R,f=this.m_sweep.localCenter;this.m_sweep.c.x=e.col1.x*f.x+e.col2.x*f.y;this.m_sweep.c.y=e.col1.y*f.x+e.col2.y*f.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.setV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.setV(a.linearVelocity);this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=
a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==d.dynamics.B2Body.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0};d.dynamics.B2Body.__name__=["box2D","dynamics","B2Body"];d.dynamics.B2Body.prototype={connectEdges:function(a,b,e){var f=Math.atan2(b.getDirectionVector().y,
b.getDirectionVector().x);e=Math.tan(0.5*(f-e));e=d.common.math.B2Math.mulFV(e,b.getDirectionVector());e=d.common.math.B2Math.subtractVV(e,b.getNormalVector());e=d.common.math.B2Math.mulFV(d.common.B2Settings.b2_toiSlop,e);e=d.common.math.B2Math.addVV(e,b.getVertex1());var c=d.common.math.B2Math.addVV(a.getDirectionVector(),b.getDirectionVector());c.normalize();var g=0<d.common.math.B2Math.dot(a.getDirectionVector(),b.getNormalVector());a.setNextEdge(b,e,c,g);b.setPrevEdge(a,e,c,g);return f},createFixture:function(a){if(!0==
this.m_world.isLocked())return null;var b=new d.dynamics.B2Fixture;b.create(this,this.m_xf,a);0!=(this.m_flags&d.dynamics.B2Body.e_activeFlag)&&b.createProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);b.m_next=this.m_fixtureList;this.m_fixtureList=b;++this.m_fixtureCount;b.m_body=this;0<b.m_density&&this.resetMassData();this.m_world.m_flags|=d.dynamics.B2World.e_newFixture;return b},createFixture2:function(a,b){null==b&&(b=0);var e=new d.dynamics.B2FixtureDef;e.shape=a;e.density=b;return this.createFixture(e)},
DestroyFixture:function(a){if(!0!=this.m_world.isLocked()){for(var b=this.m_fixtureList,e=null;null!=b;){if(b==a){null!=e?e.m_next=a.m_next:this.m_fixtureList=a.m_next;break}e=b;b=b.m_next}for(b=this.m_contactList;null!=b;){var e=b.contact,b=b.next,f=e.getFixtureA(),c=e.getFixtureB();a!=f&&a!=c||this.m_world.m_contactManager.destroy(e)}0!=(this.m_flags&d.dynamics.B2Body.e_activeFlag)&&a.destroyProxy(this.m_world.m_contactManager.m_broadPhase);a.destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;
this.resetMassData()}},setPositionAndAngle:function(a,b){var e;if(!0!=this.m_world.isLocked()){this.m_xf.R.set(b);this.m_xf.position.setV(a);e=this.m_xf.R;var f=this.m_sweep.localCenter;this.m_sweep.c.x=e.col1.x*f.x+e.col2.x*f.y;this.m_sweep.c.y=e.col1.y*f.x+e.col2.y*f.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.setV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=b;f=this.m_world.m_contactManager.m_broadPhase;for(e=this.m_fixtureList;null!=e;)e.synchronize(f,
this.m_xf,this.m_xf),e=e.m_next;this.m_world.m_contactManager.findNewContacts()}},setTransform:function(a){this.setPositionAndAngle(a.position,a.getAngle())},getTransform:function(){return this.m_xf},getPosition:function(){return this.m_xf.position},setPosition:function(a){this.setPositionAndAngle(a,this.getAngle())},getAngle:function(){return this.m_sweep.a},setAngle:function(a){this.setPositionAndAngle(this.getPosition(),a)},getWorldCenter:function(){return this.m_sweep.c},getLocalCenter:function(){return this.m_sweep.localCenter},
setLinearVelocity:function(a){this.m_type!=d.dynamics.B2Body.b2_staticBody&&this.m_linearVelocity.setV(a)},getLinearVelocity:function(){return this.m_linearVelocity},setAngularVelocity:function(a){this.m_type!=d.dynamics.B2Body.b2_staticBody&&(this.m_angularVelocity=a)},getAngularVelocity:function(){return this.m_angularVelocity},getDefinition:function(){var a=new d.dynamics.B2BodyDef;a.type=this.getType();a.allowSleep=(this.m_flags&d.dynamics.B2Body.e_allowSleepFlag)==d.dynamics.B2Body.e_allowSleepFlag;
a.angle=this.getAngle();a.angularDamping=this.m_angularDamping;a.angularVelocity=this.m_angularVelocity;a.fixedRotation=(this.m_flags&d.dynamics.B2Body.e_fixedRotationFlag)==d.dynamics.B2Body.e_fixedRotationFlag;a.bullet=(this.m_flags&d.dynamics.B2Body.e_bulletFlag)==d.dynamics.B2Body.e_bulletFlag;a.awake=(this.m_flags&d.dynamics.B2Body.e_awakeFlag)==d.dynamics.B2Body.e_awakeFlag;a.linearDamping=this.m_linearDamping;a.linearVelocity.setV(this.getLinearVelocity());a.position=this.getPosition();a.userData=
this.getUserData();return a},applyForce:function(a,b){this.m_type==d.dynamics.B2Body.b2_dynamicBody&&(!1==this.isAwake()&&this.setAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},applyTorque:function(a){this.m_type==d.dynamics.B2Body.b2_dynamicBody&&(!1==this.isAwake()&&this.setAwake(!0),this.m_torque+=a)},applyImpulse:function(a,b){this.m_type==d.dynamics.B2Body.b2_dynamicBody&&(!1==this.isAwake()&&this.setAwake(!0),this.m_linearVelocity.x+=
this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},split:function(a){for(var b=this.getLinearVelocity().copy(),e=this.getAngularVelocity(),f=this.getWorldCenter(),c=this.m_world.createBody(this.getDefinition()),g=null,h=this.m_fixtureList;null!=h;)if(a(h)){var k=h.m_next;null!=g?g.m_next=k:this.m_fixtureList=k;this.m_fixtureCount--;h.m_next=c.m_fixtureList;c.m_fixtureList=h;c.m_fixtureCount++;
h.m_body=c;h=k}else g=h,h=h.m_next;this.resetMassData();c.resetMassData();g=this.getWorldCenter();a=c.getWorldCenter();g=d.common.math.B2Math.addVV(b,d.common.math.B2Math.crossFV(e,d.common.math.B2Math.subtractVV(g,f)));b=d.common.math.B2Math.addVV(b,d.common.math.B2Math.crossFV(e,d.common.math.B2Math.subtractVV(a,f)));this.setLinearVelocity(g);c.setLinearVelocity(b);this.setAngularVelocity(e);c.setAngularVelocity(e);this.synchronizeFixtures();c.synchronizeFixtures();return c},merge:function(a){var b;
for(b=a.m_fixtureList;null!=b;){var e=b.m_next;a.m_fixtureCount--;b.m_next=this.m_fixtureList;this.m_fixtureList=b;this.m_fixtureCount++;b.m_body=a;b=e}this.m_fixtureCount=0;this.getWorldCenter();a.getWorldCenter();this.getLinearVelocity().copy();a.getLinearVelocity().copy();this.getAngularVelocity();a.getAngularVelocity();this.resetMassData();this.synchronizeFixtures()},getMass:function(){return this.m_mass},getInertia:function(){return this.m_I},getMassData:function(a){a.mass=this.m_mass;a.I=this.m_I;
a.center.setV(this.m_sweep.localCenter)},setMassData:function(a){d.common.B2Settings.b2Assert(!1==this.m_world.isLocked());if(!0!=this.m_world.isLocked()&&this.m_type==d.dynamics.B2Body.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=a.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<a.I&&0==(this.m_flags&d.dynamics.B2Body.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.copy();
this.m_sweep.localCenter.setV(a.center);this.m_sweep.c0.setV(d.common.math.B2Math.mulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.setV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y);this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-b.x)}},resetMassData:function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.setZero();if(this.m_type!=d.dynamics.B2Body.b2_staticBody&&this.m_type!=d.dynamics.B2Body.b2_kinematicBody){for(var a=
d.common.math.B2Vec2.make(0,0),b=this.m_fixtureList;null!=b;)if(0!=b.m_density){var e=b.getMassData();this.m_mass+=e.mass;a.x+=e.center.x*e.mass;a.y+=e.center.y*e.mass;this.m_I+=e.I;b=b.m_next}0<this.m_mass?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&d.dynamics.B2Body.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,d.common.B2Settings.b2Assert(0<this.m_I),this.m_invI=1/
this.m_I):this.m_invI=this.m_I=0;b=this.m_sweep.c.copy();this.m_sweep.localCenter.setV(a);this.m_sweep.c0.setV(d.common.math.B2Math.mulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.setV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y);this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-b.x)}},getWorldPoint:function(a){var b=this.m_xf.R;a=new d.common.math.B2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;
a.y+=this.m_xf.position.y;return a},getWorldVector:function(a){return d.common.math.B2Math.mulMV(this.m_xf.R,a)},getLocalPoint:function(a){return d.common.math.B2Math.mulXT(this.m_xf,a)},getLocalVector:function(a){return d.common.math.B2Math.mulTMV(this.m_xf.R,a)},getLinearVelocityFromWorldPoint:function(a){return new d.common.math.B2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},getLinearVelocityFromLocalPoint:function(a){var b=
this.m_xf.R;a=new d.common.math.B2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return new d.common.math.B2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},getLinearDamping:function(){return this.m_linearDamping},setLinearDamping:function(a){this.m_linearDamping=a},getAngularDamping:function(){return this.m_angularDamping},setAngularDamping:function(a){this.m_angularDamping=
a},setType:function(a){if(this.m_type!=a)for(this.m_type=a,this.resetMassData(),this.m_type==d.dynamics.B2Body.b2_staticBody&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0,a=this.m_contactList;null!=a;)a.contact.flagForFiltering(),a=a.next},getType:function(){return this.m_type},setBullet:function(a){this.m_flags=a?this.m_flags|d.dynamics.B2Body.e_bulletFlag:this.m_flags&~d.dynamics.B2Body.e_bulletFlag},isBullet:function(){return(this.m_flags&
d.dynamics.B2Body.e_bulletFlag)==d.dynamics.B2Body.e_bulletFlag},setSleepingAllowed:function(a){a?this.m_flags|=d.dynamics.B2Body.e_allowSleepFlag:(this.m_flags&=~d.dynamics.B2Body.e_allowSleepFlag,this.setAwake(!0))},setAwake:function(a){a?(this.m_flags|=d.dynamics.B2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~d.dynamics.B2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},isAwake:function(){return(this.m_flags&
d.dynamics.B2Body.e_awakeFlag)==d.dynamics.B2Body.e_awakeFlag},setFixedRotation:function(a){this.m_flags=a?this.m_flags|d.dynamics.B2Body.e_fixedRotationFlag:this.m_flags&~d.dynamics.B2Body.e_fixedRotationFlag;this.resetMassData()},isFixedRotation:function(){return(this.m_flags&d.dynamics.B2Body.e_fixedRotationFlag)==d.dynamics.B2Body.e_fixedRotationFlag},setActive:function(a){if(a!=this.isActive()){var b;if(a)for(this.m_flags|=d.dynamics.B2Body.e_activeFlag,a=this.m_world.m_contactManager.m_broadPhase,
b=this.m_fixtureList;null!=b;)b.createProxy(a,this.m_xf),b=b.m_next;else{this.m_flags&=~d.dynamics.B2Body.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;null!=b;)b.destroyProxy(a),b=b.m_next;for(a=this.m_contactList;null!=a;)b=a,a=a.next,this.m_world.m_contactManager.destroy(b.contact);this.m_contactList=null}}},isActive:function(){return(this.m_flags&d.dynamics.B2Body.e_activeFlag)==d.dynamics.B2Body.e_activeFlag},isSleepingAllowed:function(){return(this.m_flags&
d.dynamics.B2Body.e_allowSleepFlag)==d.dynamics.B2Body.e_allowSleepFlag},getFixtureList:function(){return this.m_fixtureList},getJointList:function(){return this.m_jointList},getControllerList:function(){return this.m_controllerList},getContactList:function(){return this.m_contactList},getNext:function(){return this.m_next},getUserData:function(){return this.m_userData},setUserData:function(a){this.m_userData=a},getWorld:function(){return this.m_world},synchronizeFixtures:function(){var a=d.dynamics.B2Body.s_xf1;
a.R.set(this.m_sweep.a0);var b=a.R,e=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*e.x+b.col2.x*e.y);a.position.y=this.m_sweep.c0.y-(b.col1.y*e.x+b.col2.y*e.y);e=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;null!=b;)b.synchronize(e,a,this.m_xf),b=b.m_next},synchronizeTransform:function(){this.m_xf.R.set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y);this.m_xf.position.y=this.m_sweep.c.y-
(a.col1.y*b.x+a.col2.y*b.y)},shouldCollide:function(a){if(this.m_type!=d.dynamics.B2Body.b2_dynamicBody&&a.m_type!=d.dynamics.B2Body.b2_dynamicBody)return!1;for(var b=this.m_jointList;null!=b;){if(b.other==a&&!1==b.joint.m_collideConnected)return!1;b=b.next}return!0},advance:function(a){this.m_sweep.advance(a);this.m_sweep.c.setV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.synchronizeTransform()},__class__:d.dynamics.B2Body};d.dynamics.B2BodyDef=function(){this.position=new d.common.math.B2Vec2;
this.linearVelocity=new d.common.math.B2Vec2;this.userData=null;this.angularDamping=this.linearDamping=this.angularVelocity=this.angle=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=d.dynamics.B2Body.b2_staticBody;this.active=!0;this.inertiaScale=1};d.dynamics.B2BodyDef.__name__=["box2D","dynamics","B2BodyDef"];d.dynamics.B2BodyDef.prototype={__class__:d.dynamics.B2BodyDef};d.dynamics.B2ContactFilter=function(){};d.dynamics.B2ContactFilter.__name__=["box2D","dynamics",
"B2ContactFilter"];d.dynamics.B2ContactFilter.prototype={shouldCollide:function(a,b){var e=a.getFilterData(),f=b.getFilterData();return e.groupIndex==f.groupIndex&&0!=e.groupIndex?0<e.groupIndex:0!=(e.maskBits&f.categoryBits)&&0!=(e.categoryBits&f.maskBits)},rayCollide:function(a,b){return null==a?!0:this.shouldCollide(z.Boot.__cast(a,d.dynamics.B2Fixture),b)},__class__:d.dynamics.B2ContactFilter};d.dynamics.B2ContactImpulse=function(){this.normalImpulses=[];this.tangentImpulses=[]};d.dynamics.B2ContactImpulse.__name__=
["box2D","dynamics","B2ContactImpulse"];d.dynamics.B2ContactImpulse.prototype={__class__:d.dynamics.B2ContactImpulse};d.dynamics.B2ContactListener=function(){};d.dynamics.B2ContactListener.__name__=["box2D","dynamics","B2ContactListener"];d.dynamics.B2ContactListener.prototype={beginContact:function(a){},endContact:function(a){},preSolve:function(a,b){},postSolve:function(a,b){},__class__:d.dynamics.B2ContactListener};d.dynamics.B2ContactManager=function(){this.m_world=null;this.m_contactCount=0;
this.m_contactFilter=d.dynamics.B2ContactFilter.b2_defaultFilter;this.m_contactListener=d.dynamics.B2ContactListener.b2_defaultListener;this.m_contactFactory=new d.dynamics.contacts.B2ContactFactory(this.m_allocator);this.m_broadPhase=new d.collision.B2DynamicTreeBroadPhase};d.dynamics.B2ContactManager.__name__=["box2D","dynamics","B2ContactManager"];d.dynamics.B2ContactManager.prototype={addPair:function(a,b){var e;e=z.Boot.__cast(a,d.dynamics.B2Fixture);var f;f=z.Boot.__cast(b,d.dynamics.B2Fixture);
var c=e.getBody(),g=f.getBody();if(c!=g){for(var h=g.getContactList();null!=h;){if(h.other==c){var k=h.contact.getFixtureA(),m=h.contact.getFixtureB();if(k==e&&m==f||k==f&&m==e)return}h=h.next}!1!=g.shouldCollide(c)&&!1!=this.m_contactFilter.shouldCollide(e,f)&&(h=this.m_contactFactory.create(e,f),e=h.getFixtureA(),f=h.getFixtureB(),c=e.m_body,g=f.m_body,h.m_prev=null,h.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=h),this.m_world.m_contactList=
h,h.m_nodeA.contact=h,h.m_nodeA.other=g,h.m_nodeA.prev=null,h.m_nodeA.next=c.m_contactList,null!=c.m_contactList&&(c.m_contactList.prev=h.m_nodeA),c.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=c,h.m_nodeB.prev=null,h.m_nodeB.next=g.m_contactList,null!=g.m_contactList&&(g.m_contactList.prev=h.m_nodeB),g.m_contactList=h.m_nodeB,++this.m_world.m_contactCount)}},findNewContacts:function(){this.m_broadPhase.updatePairs(s(this,this.addPair))},destroy:function(a){var b=a.getFixtureA(),e=
a.getFixtureB(),b=b.getBody(),e=e.getBody();a.isTouching()&&this.m_contactListener.endContact(a);null!=a.m_prev&&(a.m_prev.m_next=a.m_next);null!=a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next);null!=a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next);null!=a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev);a.m_nodeA==b.m_contactList&&(b.m_contactList=a.m_nodeA.next);null!=a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next);null!=a.m_nodeB.next&&
(a.m_nodeB.next.prev=a.m_nodeB.prev);a.m_nodeB==e.m_contactList&&(e.m_contactList=a.m_nodeB.next);this.m_contactFactory.destroy(a);--this.m_contactCount},collide:function(){for(var a=this.m_world.m_contactList;null!=a;){var b=a.getFixtureA(),e=a.getFixtureB(),f=b.getBody(),c=e.getBody();if(!1==f.isAwake()&&!1==c.isAwake())a=a.getNext();else{if(0!=(a.m_flags&d.dynamics.contacts.B2Contact.e_filterFlag)){if(!1==c.shouldCollide(f)){b=a;a=b.getNext();this.destroy(b);continue}if(!1==this.m_contactFilter.shouldCollide(b,
e)){b=a;a=b.getNext();this.destroy(b);continue}a.m_flags&=~d.dynamics.contacts.B2Contact.e_filterFlag}!1==this.m_broadPhase.testOverlap(b.m_proxy,e.m_proxy)?(b=a,a=b.getNext(),this.destroy(b)):(a.update(this.m_contactListener),a=a.getNext())}}},__class__:d.dynamics.B2ContactManager};d.dynamics.B2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;this.m_drawFlags=0};d.dynamics.B2DebugDraw.__name__=["box2D","dynamics","B2DebugDraw"];d.dynamics.B2DebugDraw.prototype=
{setFlags:function(a){this.m_drawFlags=a},getFlags:function(){return this.m_drawFlags},appendFlags:function(a){this.m_drawFlags|=a},clearFlags:function(a){this.m_drawFlags&=~a},setSprite:function(a){this.m_sprite=a},getSprite:function(){return this.m_sprite},setDrawScale:function(a){this.m_drawScale=a},getDrawScale:function(){return this.m_drawScale},setLineThickness:function(a){this.m_lineThickness=a},getLineThickness:function(){return this.m_lineThickness},setAlpha:function(a){this.m_alpha=a},getAlpha:function(){return this.m_alpha},
setFillAlpha:function(a){this.m_fillAlpha=a},getFillAlpha:function(){return this.m_fillAlpha},setXFormScale:function(a){this.m_xformScale=a},getXFormScale:function(){return this.m_xformScale},drawPolygon:function(a,b,e){console.log("drawPolygon()");this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle=e;this.m_sprite.globalAlpha=this.m_alpha;this.m_sprite.beginPath();this.m_sprite.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);for(e=1;e<b;){var f=e++;this.m_sprite.lineTo(a[f].x*
this.m_drawScale,a[f].y*this.m_drawScale)}this.m_sprite.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);this.m_sprite.stroke()},drawSolidPolygon:function(a,b,e){this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle=e.toHex();this.m_sprite.globalAlpha=this.m_alpha;this.m_sprite.beginPath();this.m_sprite.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);this.m_sprite.fillStyle="rgba("+e.get_r()+","+e.get_g()+","+e.get_b()+","+this.m_fillAlpha+")";for(e=1;e<b;){var f=e++;
this.m_sprite.lineTo(a[f].x*this.m_drawScale,a[f].y*this.m_drawScale)}this.m_sprite.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);this.m_sprite.stroke();this.m_sprite.fill()},drawCircle:function(a,b,e){this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle=e.toHex();this.m_sprite.globalAlpha=this.m_alpha;this.m_sprite.beginPath();this.m_sprite.arc(a.x*this.m_drawScale,a.y*this.m_drawScale,b*this.m_drawScale,0,2*Math.PI,!1);this.m_sprite.stroke()},drawSolidCircle:function(a,
b,e,f){this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle=f.toHex();this.m_sprite.globalAlpha=this.m_alpha;this.m_sprite.beginPath();this.m_sprite.fillStyle="rgba("+f.get_r()+","+f.get_g()+","+f.get_b()+","+this.m_fillAlpha+")";this.m_sprite.arc(a.x*this.m_drawScale,a.y*this.m_drawScale,b*this.m_drawScale,0,2*Math.PI,!1);this.m_sprite.stroke();this.m_sprite.fill()},drawSegment:function(a,b,e){this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle=e;this.m_sprite.globalAlpha=
this.m_alpha;this.m_sprite.beginPath();this.m_sprite.moveTo(a.x*this.m_drawScale,a.y*this.m_drawScale);this.m_sprite.lineTo(b.x*this.m_drawScale,b.y*this.m_drawScale);this.m_sprite.stroke()},drawTransform:function(a){this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle="#FF0000";this.m_sprite.globalAlpha=this.m_alpha;this.m_sprite.beginPath();this.m_sprite.moveTo(a.position.x*this.m_drawScale,a.position.y*this.m_drawScale);this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*
this.m_drawScale,(a.position.y+this.m_xformScale*a.R.col1.y)*this.m_drawScale);this.m_sprite.lineWidth=this.m_lineThickness;this.m_sprite.strokeStyle="#00FF00";this.m_sprite.globalAlpha=this.m_alpha;this.m_sprite.moveTo(a.position.x*this.m_drawScale,a.position.y*this.m_drawScale);this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*this.m_drawScale,(a.position.y+this.m_xformScale*a.R.col2.y)*this.m_drawScale);this.m_sprite.stroke()},__class__:d.dynamics.B2DebugDraw};d.dynamics.B2DestructionListener=
function(){};d.dynamics.B2DestructionListener.__name__=["box2D","dynamics","B2DestructionListener"];d.dynamics.B2DestructionListener.prototype={sayGoodbyeJoint:function(a){},sayGoodbyeFixture:function(a){},__class__:d.dynamics.B2DestructionListener};d.dynamics.B2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};d.dynamics.B2FilterData.__name__=["box2D","dynamics","B2FilterData"];d.dynamics.B2FilterData.prototype={copy:function(){var a=new d.dynamics.B2FilterData;a.categoryBits=
this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a},__class__:d.dynamics.B2FilterData};d.dynamics.B2Fixture=function(){this.m_filter=new d.dynamics.B2FilterData;this.m_aabb=new d.collision.B2AABB;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};d.dynamics.B2Fixture.__name__=["box2D","dynamics","B2Fixture"];d.dynamics.B2Fixture.prototype={getType:function(){return this.m_shape.getType()},getShape:function(){return this.m_shape},
setSensor:function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(a=this.m_body.getContactList();null!=a;){var b=a.contact,e=b.getFixtureA(),f=b.getFixtureB();e!=this&&f!=this||b.setSensor(e.isSensor()||f.isSensor());a=a.next}},isSensor:function(){return this.m_isSensor},setFilterData:function(a){this.m_filter=a.copy();if(null==this.m_body)for(a=this.m_body.getContactList();null!=a;){var b=a.contact,e=b.getFixtureA(),f=b.getFixtureB();e!=this&&f!=this||b.flagForFiltering();a=
a.next}},getFilterData:function(){return this.m_filter.copy()},getBody:function(){return this.m_body},getNext:function(){return this.m_next},getUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},testPoint:function(a){return this.m_shape.testPoint(this.m_body.getTransform(),a)},rayCast:function(a,b){return this.m_shape.rayCast(a,b,this.m_body.getTransform())},getMassData:function(a){null==a&&(a=new d.collision.shapes.B2MassData);this.m_shape.computeMass(a,this.m_density);
return a},setDensity:function(a){this.m_density=a},getDensity:function(){return this.m_density},getFriction:function(){return this.m_friction},setFriction:function(a){this.m_friction=a},getRestitution:function(){return this.m_restitution},setRestitution:function(a){this.m_restitution=a},getAABB:function(){return this.m_aabb},create:function(a,b,e){this.m_userData=e.userData;this.m_friction=e.friction;this.m_restitution=e.restitution;this.m_body=a;this.m_next=null;this.m_filter=e.filter.copy();this.m_isSensor=
e.isSensor;this.m_shape=e.shape.copy();this.m_density=e.density},destroy:function(){this.m_shape=null},createProxy:function(a,b){this.m_shape.computeAABB(this.m_aabb,b);this.m_proxy=a.createProxy(this.m_aabb,this)},destroyProxy:function(a){null!=this.m_proxy&&(a.destroyProxy(this.m_proxy),this.m_proxy=null)},synchronize:function(a,b,e){if(null!=this.m_proxy){var f=new d.collision.B2AABB,c=new d.collision.B2AABB;this.m_shape.computeAABB(f,b);this.m_shape.computeAABB(c,e);this.m_aabb.combine(f,c);b=
d.common.math.B2Math.subtractVV(e.position,b.position);a.moveProxy(this.m_proxy,this.m_aabb,b)}},__class__:d.dynamics.B2Fixture};d.dynamics.B2FixtureDef=function(){this.filter=new d.dynamics.B2FilterData;this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};d.dynamics.B2FixtureDef.__name__=["box2D","dynamics","B2FixtureDef"];d.dynamics.B2FixtureDef.prototype={__class__:d.dynamics.B2FixtureDef};
d.dynamics.B2Island=function(){this.m_bodies=[];this.m_contacts=[];this.m_joints=[]};d.dynamics.B2Island.__name__=["box2D","dynamics","B2Island"];d.dynamics.B2Island.prototype={initialize:function(a,b,e,f,c,d){this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=e;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=f;this.m_listener=c;this.m_contactSolver=d;for(f=this.m_bodies.length;f<a;)c=f++,this.m_bodies[c]=null;for(a=this.m_contacts.length;a<b;)f=a++,this.m_contacts[f]=
null;for(b=this.m_joints.length;b<e;)a=b++,this.m_joints[a]=null},clear:function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},solve:function(a,b,e){for(var f,c=0,g=this.m_bodyCount;c<g;)f=c++,f=this.m_bodies[f],f.getType()==d.dynamics.B2Body.b2_dynamicBody&&(f.m_linearVelocity.x+=a.dt*(b.x+f.m_invMass*f.m_force.x),f.m_linearVelocity.y+=a.dt*(b.y+f.m_invMass*f.m_force.y),f.m_angularVelocity+=a.dt*f.m_invI*f.m_torque,f.m_linearVelocity.multiply(d.common.math.B2Math.clamp(1-a.dt*f.m_linearDamping,
0,1)),f.m_angularVelocity*=d.common.math.B2Math.clamp(1-a.dt*f.m_angularDamping,0,1));this.m_contactSolver.initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);b=this.m_contactSolver;b.initVelocityConstraints(a);c=0;for(g=this.m_jointCount;c<g;)f=c++,f=this.m_joints[f],f.initVelocityConstraints(a);c=0;for(g=a.velocityIterations;c<g;){c++;for(var h=0,k=this.m_jointCount;h<k;)f=h++,f=this.m_joints[f],f.solveVelocityConstraints(a);b.solveVelocityConstraints()}c=0;for(g=this.m_jointCount;c<
g;)f=c++,f=this.m_joints[f],f.finalizeVelocityConstraints();b.finalizeVelocityConstraints();c=0;for(g=this.m_bodyCount;c<g;)f=c++,f=this.m_bodies[f],f.getType()!=d.dynamics.B2Body.b2_staticBody&&(h=a.dt*f.m_linearVelocity.x,k=a.dt*f.m_linearVelocity.y,h*h+k*k>d.common.B2Settings.b2_maxTranslationSquared&&(f.m_linearVelocity.normalize(),f.m_linearVelocity.x*=d.common.B2Settings.b2_maxTranslation*a.inv_dt,f.m_linearVelocity.y*=d.common.B2Settings.b2_maxTranslation*a.inv_dt),h=a.dt*f.m_angularVelocity,
h*h>d.common.B2Settings.b2_maxRotationSquared&&(f.m_angularVelocity=0>f.m_angularVelocity?-d.common.B2Settings.b2_maxRotation*a.inv_dt:d.common.B2Settings.b2_maxRotation*a.inv_dt),f.m_sweep.c0.setV(f.m_sweep.c),f.m_sweep.a0=f.m_sweep.a,f.m_sweep.c.x+=a.dt*f.m_linearVelocity.x,f.m_sweep.c.y+=a.dt*f.m_linearVelocity.y,f.m_sweep.a+=a.dt*f.m_angularVelocity,f.synchronizeTransform());c=0;for(g=a.positionIterations;c<g;){c++;for(var h=b.solvePositionConstraints(d.common.B2Settings.b2_contactBaumgarte),
k=!0,m=0,p=this.m_jointCount;m<p;)f=m++,f=this.m_joints[f],f=f.solvePositionConstraints(d.common.B2Settings.b2_contactBaumgarte),k=k&&f;if(h&&k)break}this.report(b.m_constraints);if(e){e=Number.MAX_VALUE;b=d.common.B2Settings.b2_linearSleepTolerance*d.common.B2Settings.b2_linearSleepTolerance;c=d.common.B2Settings.b2_angularSleepTolerance*d.common.B2Settings.b2_angularSleepTolerance;g=0;for(h=this.m_bodyCount;g<h;)f=g++,f=this.m_bodies[f],f.getType()!=d.dynamics.B2Body.b2_staticBody&&(0==(f.m_flags&
d.dynamics.B2Body.e_allowSleepFlag)&&(e=f.m_sleepTime=0),0==(f.m_flags&d.dynamics.B2Body.e_allowSleepFlag)||f.m_angularVelocity*f.m_angularVelocity>c||d.common.math.B2Math.dot(f.m_linearVelocity,f.m_linearVelocity)>b?e=f.m_sleepTime=0:(f.m_sleepTime+=a.dt,e=d.common.math.B2Math.min(e,f.m_sleepTime)));if(e>=d.common.B2Settings.b2_timeToSleep)for(a=0,e=this.m_bodyCount;a<e;)b=a++,f=this.m_bodies[b],f.setAwake(!1)}},solveTOI:function(a){this.m_contactSolver.initialize(a,this.m_contacts,this.m_contactCount,
this.m_allocator);for(var b=this.m_contactSolver,e=0,f=this.m_jointCount;e<f;){var c=e++;this.m_joints[c].initVelocityConstraints(a)}e=0;for(f=a.velocityIterations;e<f;){e++;b.solveVelocityConstraints();for(var c=0,g=this.m_jointCount;c<g;){var h=c++;this.m_joints[h].solveVelocityConstraints(a)}}e=0;for(f=this.m_bodyCount;e<f;)c=e++,c=this.m_bodies[c],c.getType()!=d.dynamics.B2Body.b2_staticBody&&(g=a.dt*c.m_linearVelocity.x,h=a.dt*c.m_linearVelocity.y,g*g+h*h>d.common.B2Settings.b2_maxTranslationSquared&&
(c.m_linearVelocity.normalize(),c.m_linearVelocity.x*=d.common.B2Settings.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y*=d.common.B2Settings.b2_maxTranslation*a.inv_dt),g=a.dt*c.m_angularVelocity,g*g>d.common.B2Settings.b2_maxRotationSquared&&(c.m_angularVelocity=0>c.m_angularVelocity?-d.common.B2Settings.b2_maxRotation*a.inv_dt:d.common.B2Settings.b2_maxRotation*a.inv_dt),c.m_sweep.c0.setV(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x,c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y,
c.m_sweep.a+=a.dt*c.m_angularVelocity,c.synchronizeTransform());e=0;for(a=a.positionIterations;e<a;){e++;f=b.solvePositionConstraints(0.75);c=!0;g=0;for(h=this.m_jointCount;g<h;)var k=g++,k=this.m_joints[k].solvePositionConstraints(d.common.B2Settings.b2_contactBaumgarte),c=c&&k;if(f&&c)break}this.report(b.m_constraints)},report:function(a){if(null!=this.m_listener)for(var b=0,e=this.m_contactCount;b<e;){for(var f=b++,c=this.m_contacts[f],f=a[f],g=0,h=f.pointCount;g<h;){var k=g++;d.dynamics.B2Island.s_impulse.normalImpulses[k]=
f.points[k].normalImpulse;d.dynamics.B2Island.s_impulse.tangentImpulses[k]=f.points[k].tangentImpulse}this.m_listener.postSolve(c,d.dynamics.B2Island.s_impulse)}},addBody:function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a},addContact:function(a){this.m_contacts[this.m_contactCount++]=a},addJoint:function(a){this.m_joints[this.m_jointCount++]=a},__class__:d.dynamics.B2Island};d.dynamics.B2TimeStep=function(){};d.dynamics.B2TimeStep.__name__=["box2D","dynamics","B2TimeStep"];
d.dynamics.B2TimeStep.prototype={set:function(a){this.dt=a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;this.warmStarting=a.warmStarting},__class__:d.dynamics.B2TimeStep};d.dynamics.B2World=function(a,b){this.s_stack=[];this.m_contactManager=new d.dynamics.B2ContactManager;this.m_contactSolver=new d.dynamics.contacts.B2ContactSolver;this.m_island=new d.dynamics.B2Island;this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=
this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;d.dynamics.B2World.m_warmStarting=!0;d.dynamics.B2World.m_continuousPhysics=!0;this.m_allowSleep=b;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var e=new d.dynamics.B2BodyDef;this.m_groundBody=this.createBody(e)};d.dynamics.B2World.__name__=["box2D","dynamics","B2World"];d.dynamics.B2World.prototype={setDestructionListener:function(a){this.m_destructionListener=
a},setContactFilter:function(a){this.m_contactManager.m_contactFilter=a},setContactListener:function(a){this.m_contactManager.m_contactListener=a},setDebugDraw:function(a){this.m_debugDraw=a},setBroadPhase:function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var e=this.m_bodyList;null!=e;){for(var f=e.m_fixtureList;null!=f;)f.m_proxy=a.createProxy(b.getFatAABB(f.m_proxy),f),f=f.m_next;e=e.m_next}},validate:function(){this.m_contactManager.m_broadPhase.validate()},
getProxyCount:function(){return this.m_contactManager.m_broadPhase.getProxyCount()},createBody:function(a){if(!0==this.isLocked())return null;a=new d.dynamics.B2Body(a,this);a.m_prev=null;a.m_next=this.m_bodyList;null!=this.m_bodyList&&(this.m_bodyList.m_prev=a);this.m_bodyList=a;++this.m_bodyCount;return a},destroyBody:function(a){if(!0!=this.isLocked()){for(var b=a.m_jointList;null!=b;){var e=b,b=b.next;null!=this.m_destructionListener&&this.m_destructionListener.sayGoodbyeJoint(e.joint);this.destroyJoint(e.joint)}for(b=
a.m_controllerList;null!=b;)e=b,b=b.nextController,e.controller.removeBody(a);for(b=a.m_contactList;null!=b;)e=b,b=b.next,this.m_contactManager.destroy(e.contact);a.m_contactList=null;for(b=a.m_fixtureList;null!=b;)e=b,b=b.m_next,null!=this.m_destructionListener&&this.m_destructionListener.sayGoodbyeFixture(e),e.destroyProxy(this.m_contactManager.m_broadPhase),e.destroy();a.m_fixtureList=null;a.m_fixtureCount=0;null!=a.m_prev&&(a.m_prev.m_next=a.m_next);null!=a.m_next&&(a.m_next.m_prev=a.m_prev);
a==this.m_bodyList&&(this.m_bodyList=a.m_next);--this.m_bodyCount}},createJoint:function(a){var b=d.dynamics.joints.B2Joint.create(a,null);b.m_prev=null;b.m_next=this.m_jointList;null!=this.m_jointList&&(this.m_jointList.m_prev=b);this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;b.m_edgeA.next=b.m_bodyA.m_jointList;null!=b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA);b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=
b.m_bodyA;b.m_edgeB.prev=null;b.m_edgeB.next=b.m_bodyB.m_jointList;null!=b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB);b.m_bodyB.m_jointList=b.m_edgeB;var e=a.bodyA,f=a.bodyB;if(!1==a.collideConnected)for(a=f.getContactList();null!=a;)a.other==e&&a.contact.flagForFiltering(),a=a.next;return b},destroyJoint:function(a){var b=a.m_collideConnected;null!=a.m_prev&&(a.m_prev.m_next=a.m_next);null!=a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_jointList&&(this.m_jointList=a.m_next);var e=
a.m_bodyA,f=a.m_bodyB;e.setAwake(!0);f.setAwake(!0);null!=a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next);null!=a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev);a.m_edgeA==e.m_jointList&&(e.m_jointList=a.m_edgeA.next);a.m_edgeA.prev=null;a.m_edgeA.next=null;null!=a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next);null!=a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev);a.m_edgeB==f.m_jointList&&(f.m_jointList=a.m_edgeB.next);a.m_edgeB.prev=null;a.m_edgeB.next=null;d.dynamics.joints.B2Joint.destroy(a,
null);--this.m_jointCount;if(!1==b)for(a=f.getContactList();null!=a;)a.other==e&&a.contact.flagForFiltering(),a=a.next},addController:function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a},removeController:function(a){null!=a.m_prev&&(a.m_prev.m_next=a.m_next);null!=a.m_next&&(a.m_next.m_prev=a.m_prev);this.m_controllerList==a&&(this.m_controllerList=a.m_next);this.m_controllerCount--},createController:function(a){if(a.m_world!=
this)throw"Controller can only be a member of one world";a.m_next=this.m_controllerList;a.m_prev=null;null!=this.m_controllerList&&(this.m_controllerList.m_prev=a);this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a},destroyController:function(a){a.clear();null!=a.m_next&&(a.m_next.m_prev=a.m_prev);null!=a.m_prev&&(a.m_prev.m_next=a.m_next);a==this.m_controllerList&&(this.m_controllerList=a.m_next);--this.m_controllerCount},setWarmStarting:function(a){d.dynamics.B2World.m_warmStarting=
a},setContinuousPhysics:function(a){d.dynamics.B2World.m_continuousPhysics=a},getBodyCount:function(){return this.m_bodyCount},getJointCount:function(){return this.m_jointCount},getContactCount:function(){return this.m_contactCount},setGravity:function(a){this.m_gravity=a},getGravity:function(){return this.m_gravity},getGroundBody:function(){return this.m_groundBody},step:function(a,b,e){0!=(this.m_flags&d.dynamics.B2World.e_newFixture)&&(this.m_contactManager.findNewContacts(),this.m_flags&=~d.dynamics.B2World.e_newFixture);
this.m_flags|=d.dynamics.B2World.e_locked;var f=d.dynamics.B2World.s_timestep2;f.dt=a;f.velocityIterations=b;f.positionIterations=e;f.inv_dt=0<a?1/a:0;f.dtRatio=this.m_inv_dt0*a;f.warmStarting=d.dynamics.B2World.m_warmStarting;this.m_contactManager.collide();0<f.dt&&this.solve(f);d.dynamics.B2World.m_continuousPhysics&&0<f.dt&&this.solveTOI(f);0<f.dt&&(this.m_inv_dt0=f.inv_dt);this.m_flags&=~d.dynamics.B2World.e_locked},clearForces:function(){for(var a=this.m_bodyList;null!=a;)a.m_force.setZero(),
a.m_torque=0,a=a.m_next},drawDebugData:function(){if(null!=this.m_debugDraw){var a=this.m_debugDraw.getFlags(),b,e,f;new d.common.math.B2Vec2;new d.common.math.B2Vec2;new d.common.math.B2Vec2;var c;new d.collision.B2AABB;new d.collision.B2AABB;c=[new d.common.math.B2Vec2,new d.common.math.B2Vec2,new d.common.math.B2Vec2,new d.common.math.B2Vec2];var g=new d.common.B2Color(0,0,0);if(0!=(a&d.dynamics.B2DebugDraw.e_shapeBit))for(b=this.m_bodyList;null!=b;){c=b.m_xf;for(e=b.getFixtureList();null!=e;)f=
e.getShape(),!1==b.isActive()?g.set(0.5,0.5,0.3):b.getType()==d.dynamics.B2Body.b2_staticBody?g.set(0.5,0.9,0.5):b.getType()==d.dynamics.B2Body.b2_kinematicBody?g.set(0.5,0.5,0.9):!1==b.isAwake()?g.set(0.6,0.6,0.6):g.set(0.9,0.7,0.7),this.drawShape(f,c,g),e=e.m_next;b=b.m_next}if(0!=(a&d.dynamics.B2DebugDraw.e_jointBit))for(b=this.m_jointList;null!=b;)this.drawJoint(b),b=b.m_next;if(0!=(a&d.dynamics.B2DebugDraw.e_controllerBit))for(b=this.m_controllerList;null!=b;)b.draw(this.m_debugDraw),b=b.m_next;
if(0!=(a&d.dynamics.B2DebugDraw.e_pairBit))for(g.set(0.3,0.9,0.9),b=this.m_contactManager.m_contactList;null!=b;)f=b.getFixtureA(),e=b.getFixtureB(),f=f.getAABB().getCenter(),e=e.getAABB().getCenter(),this.m_debugDraw.drawSegment(f,e,g),b=b.getNext();if(0!=(a&d.dynamics.B2DebugDraw.e_aabbBit))for(f=this.m_contactManager.m_broadPhase,c=[new d.common.math.B2Vec2,new d.common.math.B2Vec2,new d.common.math.B2Vec2,new d.common.math.B2Vec2],b=this.m_bodyList;null!=b;){if(!1!=b.isActive())for(e=b.getFixtureList();null!=
e;){var h=f.getFatAABB(e.m_proxy);c[0].set(h.lowerBound.x,h.lowerBound.y);c[1].set(h.upperBound.x,h.lowerBound.y);c[2].set(h.upperBound.x,h.upperBound.y);c[3].set(h.lowerBound.x,h.upperBound.y);this.m_debugDraw.drawPolygon(c,4,g);e=e.getNext()}b=b.getNext()}if(0!=(a&d.dynamics.B2DebugDraw.e_centerOfMassBit))for(b=this.m_bodyList;null!=b;)c=d.dynamics.B2World.s_xf,c.R=b.m_xf.R,c.position=b.getWorldCenter(),this.m_debugDraw.drawTransform(c),b=b.m_next}},queryAABB:function(a,b){var e=this.m_contactManager.m_broadPhase;
e.query(function(b){return a(e.getUserData(b))},b)},queryShape:function(a,b,e){null==e&&(e=new d.common.math.B2Transform,e.setIdentity());var f=this.m_contactManager.m_broadPhase,c=new d.collision.B2AABB;b.computeAABB(c,e);f.query(function(c){c=z.Boot.__cast(f.getUserData(c),d.dynamics.B2Fixture);return d.collision.shapes.B2Shape.testOverlap(b,e,c.getShape(),c.getBody().getTransform())?a(c):!0},c)},queryPoint:function(a,b){var e=this.m_contactManager.m_broadPhase,f=new d.collision.B2AABB;f.lowerBound.set(b.x-
d.common.B2Settings.b2_linearSlop,b.y-d.common.B2Settings.b2_linearSlop);f.upperBound.set(b.x+d.common.B2Settings.b2_linearSlop,b.y+d.common.B2Settings.b2_linearSlop);e.query(function(f){f=z.Boot.__cast(e.getUserData(f),d.dynamics.B2Fixture);return f.testPoint(b)?a(f):!0},f)},rayCast:function(a,b,e){var f=this.m_contactManager.m_broadPhase,c=new d.collision.B2RayCastOutput,g=new d.collision.B2RayCastInput(b,e);f.rayCast(function(g,k){var m=f.getUserData(k),m=z.Boot.__cast(m,d.dynamics.B2Fixture);
if(m.rayCast(c,g)){var p=c.fraction,u=new d.common.math.B2Vec2((1-p)*b.x+p*e.x,(1-p)*b.y+p*e.y);return a(m,u,c.normal,p)}return g.maxFraction},g)},rayCastOne:function(a,b){var e;this.rayCast(function(a,b,l,c){e=a;return c},a,b);return e},rayCastAll:function(a,b){var e=[];this.rayCast(function(a,b,l,c){e[e.length]=a;return 1},a,b);return e},getBodyList:function(){return this.m_bodyList},getJointList:function(){return this.m_jointList},getContactList:function(){return this.m_contactList},isLocked:function(){return 0<
(this.m_flags&d.dynamics.B2World.e_locked)},solve:function(a){for(var b,e=this.m_controllerList;null!=e;)e.step(a),e=e.m_next;var f=this.m_island;f.initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(b=this.m_bodyList;null!=b;)b.m_flags&=~d.dynamics.B2Body.e_islandFlag,b=b.m_next;for(e=this.m_contactList;null!=e;)e.m_flags&=~d.dynamics.contacts.B2Contact.e_islandFlag,e=e.m_next;for(e=this.m_jointList;null!=e;)e.m_islandFlag=
!1,e=e.m_next;for(var e=this.s_stack,c=this.m_bodyList;null!=c;){if(0==(c.m_flags&d.dynamics.B2Body.e_islandFlag)&&!1!=c.isAwake()&&!1!=c.isActive()&&c.getType()!=d.dynamics.B2Body.b2_staticBody){f.clear();var g=0;e[g++]=c;for(c.m_flags|=d.dynamics.B2Body.e_islandFlag;0<g;)if(b=e[--g],f.addBody(b),!1==b.isAwake()&&b.setAwake(!0),b.getType()!=d.dynamics.B2Body.b2_staticBody){for(var h,k=b.m_contactList;null!=k;)0==(k.contact.m_flags&d.dynamics.contacts.B2Contact.e_islandFlag)&&(!0!=k.contact.isSensor()&&
!1!=k.contact.isEnabled()&&!1!=k.contact.isTouching())&&(f.addContact(k.contact),k.contact.m_flags|=d.dynamics.contacts.B2Contact.e_islandFlag,h=k.other,0==(h.m_flags&d.dynamics.B2Body.e_islandFlag)&&(e[g++]=h,h.m_flags|=d.dynamics.B2Body.e_islandFlag)),k=k.next;for(b=b.m_jointList;null!=b;)!0!=b.joint.m_islandFlag&&(h=b.other,!1!=h.isActive()&&(f.addJoint(b.joint),b.joint.m_islandFlag=!0,0==(h.m_flags&d.dynamics.B2Body.e_islandFlag)&&(e[g++]=h,h.m_flags|=d.dynamics.B2Body.e_islandFlag))),b=b.next}f.solve(a,
this.m_gravity,this.m_allowSleep);g=0;for(h=f.m_bodyCount;g<h;)b=g++,b=f.m_bodies[b],b.getType()==d.dynamics.B2Body.b2_staticBody&&(b.m_flags&=~d.dynamics.B2Body.e_islandFlag)}c=c.m_next}a=0;for(f=e.length;a<f;){c=a++;if(null==e[c])break;e[c]=null}for(b=this.m_bodyList;null!=b;)!1!=b.isAwake()&&!1!=b.isActive()&&b.getType()!=d.dynamics.B2Body.b2_staticBody&&b.synchronizeFixtures(),b=b.m_next;this.m_contactManager.findNewContacts()},solveTOI:function(a){var b,e,f,c,g=this.m_island;g.initialize(this.m_bodyCount,
d.common.B2Settings.b2_maxTOIContactsPerIsland,d.common.B2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var h=d.dynamics.B2World.s_queue;for(b=this.m_bodyList;null!=b;)b.m_flags&=~d.dynamics.B2Body.e_islandFlag,b.m_sweep.t0=0,b=b.m_next;for(b=this.m_contactList;null!=b;)b.m_flags&=~(d.dynamics.contacts.B2Contact.e_toiFlag|d.dynamics.contacts.B2Contact.e_islandFlag),b=b.m_next;for(c=this.m_jointList;null!=c;)c.m_islandFlag=!1,c=c.m_next;for(;;){c=
null;var k=1;for(b=this.m_contactList;null!=b;){if(!0!=b.isSensor()&&!1!=b.isEnabled()&&!1!=b.isContinuous()){e=1;if(0!=(b.m_flags&d.dynamics.contacts.B2Contact.e_toiFlag))e=b.m_toi;else{e=b.m_fixtureA;f=b.m_fixtureB;e=e.m_body;f=f.m_body;if(!(e.getType()==d.dynamics.B2Body.b2_dynamicBody&&!1!=e.isAwake()||f.getType()==d.dynamics.B2Body.b2_dynamicBody&&!1!=f.isAwake())){b=b.m_next;continue}var m=e.m_sweep.t0;e.m_sweep.t0<f.m_sweep.t0?(m=f.m_sweep.t0,e.m_sweep.advance(m)):f.m_sweep.t0<e.m_sweep.t0&&
(m=e.m_sweep.t0,f.m_sweep.advance(m));e=b.computeTOI(e.m_sweep,f.m_sweep);d.common.B2Settings.b2Assert(0<=e&&1>=e);0<e&&1>e&&(e=(1-e)*m+e,1<e&&(e=1));b.m_toi=e;b.m_flags|=d.dynamics.contacts.B2Contact.e_toiFlag}Number.MIN_VALUE<e&&e<k&&(c=b,k=e)}b=b.m_next}if(null==c||1-100*Number.MIN_VALUE<k)break;e=c.m_fixtureA;f=c.m_fixtureB;e=e.m_body;f=f.m_body;d.dynamics.B2World.s_backupA.set(e.m_sweep);d.dynamics.B2World.s_backupB.set(f.m_sweep);e.advance(k);f.advance(k);c.update(this.m_contactManager.m_contactListener);
c.m_flags&=~d.dynamics.contacts.B2Contact.e_toiFlag;if(!0==c.isSensor()||!1==c.isEnabled())e.m_sweep.set(d.dynamics.B2World.s_backupA),f.m_sweep.set(d.dynamics.B2World.s_backupB),e.synchronizeTransform(),f.synchronizeTransform();else if(!1!=c.isTouching()){b=e;b.getType()!=d.dynamics.B2Body.b2_dynamicBody&&(b=f);g.clear();f=e=0;h[e+f++]=b;for(b.m_flags|=d.dynamics.B2Body.e_islandFlag;0<f;)if(b=h[e++],--f,g.addBody(b),!1==b.isAwake()&&b.setAwake(!0),b.getType()==d.dynamics.B2Body.b2_dynamicBody){for(c=
b.m_contactList;null!=c&&g.m_contactCount!=g.m_contactCapacity;)0==(c.contact.m_flags&d.dynamics.contacts.B2Contact.e_islandFlag)&&(!0!=c.contact.isSensor()&&!1!=c.contact.isEnabled()&&!1!=c.contact.isTouching())&&(g.addContact(c.contact),c.contact.m_flags|=d.dynamics.contacts.B2Contact.e_islandFlag,m=c.other,0==(m.m_flags&d.dynamics.B2Body.e_islandFlag)&&(m.getType()!=d.dynamics.B2Body.b2_staticBody&&(m.advance(k),m.setAwake(!0)),h[e+f]=m,++f,m.m_flags|=d.dynamics.B2Body.e_islandFlag)),c=c.next;
for(b=b.m_jointList;null!=b;)g.m_jointCount!=g.m_jointCapacity&&!0!=b.joint.m_islandFlag&&(m=b.other,!1!=m.isActive()&&(g.addJoint(b.joint),b.joint.m_islandFlag=!0,0==(m.m_flags&d.dynamics.B2Body.e_islandFlag)&&(m.getType()!=d.dynamics.B2Body.b2_staticBody&&(m.advance(k),m.setAwake(!0)),h[e+f]=m,++f,m.m_flags|=d.dynamics.B2Body.e_islandFlag))),b=b.next}b=d.dynamics.B2World.s_timestep;b.warmStarting=!1;b.dt=(1-k)*a.dt;b.inv_dt=1/b.dt;b.dtRatio=0;b.velocityIterations=a.velocityIterations;b.positionIterations=
a.positionIterations;g.solveTOI(b);k=0;for(e=g.m_bodyCount;k<e;)if(b=k++,b=g.m_bodies[b],b.m_flags&=~d.dynamics.B2Body.e_islandFlag,!1!=b.isAwake()&&b.getType()==d.dynamics.B2Body.b2_dynamicBody)for(b.synchronizeFixtures(),c=b.m_contactList;null!=c;)c.contact.m_flags&=~d.dynamics.contacts.B2Contact.e_toiFlag,c=c.next;k=0;for(c=g.m_contactCount;k<c;)b=k++,b=g.m_contacts[b],b.m_flags&=~(d.dynamics.contacts.B2Contact.e_toiFlag|d.dynamics.contacts.B2Contact.e_islandFlag);k=0;for(b=g.m_jointCount;k<b;)c=
k++,c=g.m_joints[c],c.m_islandFlag=!1;this.m_contactManager.findNewContacts()}}},drawJoint:function(a){var b=a.getBodyA(),e=a.getBodyB(),f=b.m_xf.position,c=e.m_xf.position,g=a.getAnchorA(),h=a.getAnchorB(),k=d.dynamics.B2World.s_jointColor;switch(a.m_type[1]){case 3:this.m_debugDraw.drawSegment(g,h,k);break;case 4:b=z.Boot.__cast(a,d.dynamics.joints.B2PulleyJoint);a=b.getGroundAnchorA();b=b.getGroundAnchorB();this.m_debugDraw.drawSegment(a,g,k);this.m_debugDraw.drawSegment(b,h,k);this.m_debugDraw.drawSegment(a,
b,k);break;case 5:this.m_debugDraw.drawSegment(g,h,k);break;default:b!=this.m_groundBody&&this.m_debugDraw.drawSegment(f,g,k),this.m_debugDraw.drawSegment(g,h,k),e!=this.m_groundBody&&this.m_debugDraw.drawSegment(c,h,k)}},drawShape:function(a,b,e){switch(a.m_type[1]){case 1:a=z.Boot.__cast(a,d.collision.shapes.B2CircleShape);var f=d.common.math.B2Math.mulX(b,a.m_p);this.m_debugDraw.drawSolidCircle(f,a.m_radius,b.R.col1,e);break;case 2:f=z.Boot.__cast(a,d.collision.shapes.B2PolygonShape);a=f.getVertexCount();
for(var f=f.getVertices(),c=[],g=0;g<a;){var h=g++;c[h]=d.common.math.B2Math.mulX(b,f[h])}this.m_debugDraw.drawSolidPolygon(c,a,e);break;case 3:a=z.Boot.__cast(a,d.collision.shapes.B2EdgeShape),this.m_debugDraw.drawSegment(d.common.math.B2Math.mulX(b,a.getVertex1()),d.common.math.B2Math.mulX(b,a.getVertex2()),e)}},__class__:d.dynamics.B2World};d.dynamics.contacts={};d.dynamics.contacts.B2Contact=function(){this.m_nodeA=new d.dynamics.contacts.B2ContactEdge;this.m_nodeB=new d.dynamics.contacts.B2ContactEdge;
this.m_manifold=new d.collision.B2Manifold;this.m_oldManifold=new d.collision.B2Manifold};d.dynamics.contacts.B2Contact.__name__=["box2D","dynamics","contacts","B2Contact"];d.dynamics.contacts.B2Contact.prototype={getManifold:function(){return this.m_manifold},getWorldManifold:function(a){var b=this.m_fixtureA.getBody(),e=this.m_fixtureB.getBody(),f=this.m_fixtureA.getShape(),c=this.m_fixtureB.getShape();a.initialize(this.m_manifold,b.getTransform(),f.m_radius,e.getTransform(),c.m_radius)},isTouching:function(){return(this.m_flags&
d.dynamics.contacts.B2Contact.e_touchingFlag)==d.dynamics.contacts.B2Contact.e_touchingFlag},isContinuous:function(){return(this.m_flags&d.dynamics.contacts.B2Contact.e_continuousFlag)==d.dynamics.contacts.B2Contact.e_continuousFlag},setSensor:function(a){this.m_flags=a?this.m_flags|d.dynamics.contacts.B2Contact.e_sensorFlag:this.m_flags&~d.dynamics.contacts.B2Contact.e_sensorFlag},isSensor:function(){return(this.m_flags&d.dynamics.contacts.B2Contact.e_sensorFlag)==d.dynamics.contacts.B2Contact.e_sensorFlag},
setEnabled:function(a){this.m_flags=a?this.m_flags|d.dynamics.contacts.B2Contact.e_enabledFlag:this.m_flags&~d.dynamics.contacts.B2Contact.e_enabledFlag},isEnabled:function(){return(this.m_flags&d.dynamics.contacts.B2Contact.e_enabledFlag)==d.dynamics.contacts.B2Contact.e_enabledFlag},getNext:function(){return this.m_next},getFixtureA:function(){return this.m_fixtureA},getFixtureB:function(){return this.m_fixtureB},flagForFiltering:function(){this.m_flags|=d.dynamics.contacts.B2Contact.e_filterFlag},
reset:function(a,b){this.m_flags=d.dynamics.contacts.B2Contact.e_enabledFlag;if(null==a||null==b)this.m_fixtureB=this.m_fixtureA=null;else{if(a.isSensor()||b.isSensor())this.m_flags|=d.dynamics.contacts.B2Contact.e_sensorFlag;var e=a.getBody(),f=b.getBody();if(e.getType()!=d.dynamics.B2Body.b2_dynamicBody||e.isBullet()||f.getType()!=d.dynamics.B2Body.b2_dynamicBody||f.isBullet())this.m_flags|=d.dynamics.contacts.B2Contact.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=b;this.m_manifold.m_pointCount=
0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}},update:function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=b;this.m_flags|=d.dynamics.contacts.B2Contact.e_enabledFlag;var e=!1,b=(this.m_flags&d.dynamics.contacts.B2Contact.e_touchingFlag)==d.dynamics.contacts.B2Contact.e_touchingFlag,f=this.m_fixtureA.m_body,
c=this.m_fixtureB.m_body,g=this.m_fixtureA.m_aabb.testOverlap(this.m_fixtureB.m_aabb);if(0!=(this.m_flags&d.dynamics.contacts.B2Contact.e_sensorFlag))g&&(e=this.m_fixtureA.getShape(),g=this.m_fixtureB.getShape(),f=f.getTransform(),c=c.getTransform(),e=d.collision.shapes.B2Shape.testOverlap(e,f,g,c)),this.m_manifold.m_pointCount=0;else{f.getType()!=d.dynamics.B2Body.b2_dynamicBody||f.isBullet()||c.getType()!=d.dynamics.B2Body.b2_dynamicBody||c.isBullet()?this.m_flags|=d.dynamics.contacts.B2Contact.e_continuousFlag:
this.m_flags&=~d.dynamics.contacts.B2Contact.e_continuousFlag;if(g){this.evaluate();for(var e=0<this.m_manifold.m_pointCount,g=0,h=this.m_manifold.m_pointCount;g<h;){var k=g++,k=this.m_manifold.m_points[k];k.m_normalImpulse=0;k.m_tangentImpulse=0;for(var m=k.m_id,p=0,u=this.m_oldManifold.m_pointCount;p<u;){var q=p++,q=this.m_oldManifold.m_points[q];if(q.m_id.get_key()==m.get_key()){k.m_normalImpulse=q.m_normalImpulse;k.m_tangentImpulse=q.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=
0;e!=b&&(f.setAwake(!0),c.setAwake(!0))}this.m_flags=e?this.m_flags|d.dynamics.contacts.B2Contact.e_touchingFlag:this.m_flags&~d.dynamics.contacts.B2Contact.e_touchingFlag;!1==b&&!0==e&&a.beginContact(this);!0==b&&!1==e&&a.endContact(this);0==(this.m_flags&d.dynamics.contacts.B2Contact.e_sensorFlag)&&a.preSolve(this,this.m_oldManifold)},evaluate:function(){},computeTOI:function(a,b){d.dynamics.contacts.B2Contact.s_input.proxyA.set(this.m_fixtureA.getShape());d.dynamics.contacts.B2Contact.s_input.proxyB.set(this.m_fixtureB.getShape());
d.dynamics.contacts.B2Contact.s_input.sweepA=a;d.dynamics.contacts.B2Contact.s_input.sweepB=b;d.dynamics.contacts.B2Contact.s_input.tolerance=d.common.B2Settings.b2_linearSlop;return d.collision.B2TimeOfImpact.timeOfImpact(d.dynamics.contacts.B2Contact.s_input)},__class__:d.dynamics.contacts.B2Contact};d.dynamics.contacts.B2CircleContact=function(){d.dynamics.contacts.B2Contact.call(this)};d.dynamics.contacts.B2CircleContact.__name__=["box2D","dynamics","contacts","B2CircleContact"];d.dynamics.contacts.B2CircleContact.create=
function(a){return new d.dynamics.contacts.B2CircleContact};d.dynamics.contacts.B2CircleContact.destroy=function(a,b){};d.dynamics.contacts.B2CircleContact.__super__=d.dynamics.contacts.B2Contact;d.dynamics.contacts.B2CircleContact.prototype=r(d.dynamics.contacts.B2Contact.prototype,{reset:function(a,b){d.dynamics.contacts.B2Contact.prototype.reset.call(this,a,b)},evaluate:function(){var a=this.m_fixtureA.getBody(),b=this.m_fixtureB.getBody();d.collision.B2Collision.collideCircles(this.m_manifold,
z.Boot.__cast(this.m_fixtureA.getShape(),d.collision.shapes.B2CircleShape),a.m_xf,z.Boot.__cast(this.m_fixtureB.getShape(),d.collision.shapes.B2CircleShape),b.m_xf)},__class__:d.dynamics.contacts.B2CircleContact});d.dynamics.contacts.B2ContactConstraint=function(){this.localPlaneNormal=new d.common.math.B2Vec2;this.localPoint=new d.common.math.B2Vec2;this.normal=new d.common.math.B2Vec2;this.normalMass=new d.common.math.B2Mat22;this.K=new d.common.math.B2Mat22;this.points=[];for(var a=0,b=d.common.B2Settings.b2_maxManifoldPoints;a<
b;){var e=a++;this.points[e]=new d.dynamics.contacts.B2ContactConstraintPoint}};d.dynamics.contacts.B2ContactConstraint.__name__=["box2D","dynamics","contacts","B2ContactConstraint"];d.dynamics.contacts.B2ContactConstraint.prototype={__class__:d.dynamics.contacts.B2ContactConstraint};d.dynamics.contacts.B2ContactConstraintPoint=function(){this.localPoint=new d.common.math.B2Vec2;this.rA=new d.common.math.B2Vec2;this.rB=new d.common.math.B2Vec2};d.dynamics.contacts.B2ContactConstraintPoint.__name__=
["box2D","dynamics","contacts","B2ContactConstraintPoint"];d.dynamics.contacts.B2ContactConstraintPoint.prototype={__class__:d.dynamics.contacts.B2ContactConstraintPoint};d.dynamics.contacts.B2ContactEdge=function(){};d.dynamics.contacts.B2ContactEdge.__name__=["box2D","dynamics","contacts","B2ContactEdge"];d.dynamics.contacts.B2ContactEdge.prototype={__class__:d.dynamics.contacts.B2ContactEdge};d.dynamics.contacts.B2ContactFactory=function(a){this.m_allocator=a;this.initializeRegisters()};d.dynamics.contacts.B2ContactFactory.__name__=
["box2D","dynamics","contacts","B2ContactFactory"];d.dynamics.contacts.B2ContactFactory.prototype={addType:function(a,b,e,f){var c=e[1],d=f[1];this.m_registers[c][d].createFcn=a;this.m_registers[c][d].destroyFcn=b;this.m_registers[c][d].primary=!0;e!=f&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},initializeRegisters:function(){this.m_registers=[];for(var a=0,b=G.allEnums(d.collision.shapes.B2ShapeType).length;a<b;){var e=a++;this.m_registers[e]=
[];for(var f=0,c=G.allEnums(d.collision.shapes.B2ShapeType).length;f<c;){var g=f++;this.m_registers[e][g]=new d.dynamics.contacts.B2ContactRegister}}this.addType(d.dynamics.contacts.B2CircleContact.create,d.dynamics.contacts.B2CircleContact.destroy,d.collision.shapes.B2ShapeType.CIRCLE_SHAPE,d.collision.shapes.B2ShapeType.CIRCLE_SHAPE);this.addType(d.dynamics.contacts.B2PolyAndCircleContact.create,d.dynamics.contacts.B2PolyAndCircleContact.destroy,d.collision.shapes.B2ShapeType.POLYGON_SHAPE,d.collision.shapes.B2ShapeType.CIRCLE_SHAPE);
this.addType(d.dynamics.contacts.B2PolygonContact.create,d.dynamics.contacts.B2PolygonContact.destroy,d.collision.shapes.B2ShapeType.POLYGON_SHAPE,d.collision.shapes.B2ShapeType.POLYGON_SHAPE);this.addType(d.dynamics.contacts.B2EdgeAndCircleContact.create,d.dynamics.contacts.B2EdgeAndCircleContact.destroy,d.collision.shapes.B2ShapeType.EDGE_SHAPE,d.collision.shapes.B2ShapeType.CIRCLE_SHAPE);this.addType(d.dynamics.contacts.B2PolyAndEdgeContact.create,d.dynamics.contacts.B2PolyAndEdgeContact.destroy,
d.collision.shapes.B2ShapeType.POLYGON_SHAPE,d.collision.shapes.B2ShapeType.EDGE_SHAPE)},create:function(a,b){var e=a.getType(),f=b.getType(),e=this.m_registers[e[1]][f[1]];if(null!=e.pool)return f=e.pool,e.pool=f.m_next,e.poolCount--,f.reset(a,b),f;f=e.createFcn;return null!=f?(e.primary?(f=f(this.m_allocator),f.reset(a,b)):(f=f(this.m_allocator),f.reset(b,a)),f):null},destroy:function(a){0<a.m_manifold.m_pointCount&&(a.m_fixtureA.m_body.setAwake(!0),a.m_fixtureB.m_body.setAwake(!0));var b=a.m_fixtureA.getType(),
e=a.m_fixtureB.getType(),b=this.m_registers[b[1]][e[1]];b.poolCount++;a.m_next=b.pool;b.pool=a;b=b.destroyFcn;b(a,this.m_allocator)},__class__:d.dynamics.contacts.B2ContactFactory};d.dynamics.contacts.B2ContactRegister=function(){};d.dynamics.contacts.B2ContactRegister.__name__=["box2D","dynamics","contacts","B2ContactRegister"];d.dynamics.contacts.B2ContactRegister.prototype={__class__:d.dynamics.contacts.B2ContactRegister};d.dynamics.contacts.B2PositionSolverManifold=function(){this.m_normal=new d.common.math.B2Vec2;
this.m_separations=[];this.m_points=[];for(var a=0,b=d.common.B2Settings.b2_maxManifoldPoints;a<b;){var e=a++;this.m_points[e]=new d.common.math.B2Vec2}};d.dynamics.contacts.B2PositionSolverManifold.__name__=["box2D","dynamics","contacts","B2PositionSolverManifold"];d.dynamics.contacts.B2PositionSolverManifold.prototype={initialize:function(a){d.common.B2Settings.b2Assert(0<a.pointCount);var b,e,f,c,g;switch(a.type[1]){case 0:f=a.bodyA.m_xf.R;e=a.localPoint;b=a.bodyA.m_xf.position.x+(f.col1.x*e.x+
f.col2.x*e.y);c=a.bodyA.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);f=a.bodyB.m_xf.R;e=a.points[0].localPoint;g=a.bodyB.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);f=a.bodyB.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);e=g-b;var h=f-c,k=e*e+h*h;k>Number.MIN_VALUE*Number.MIN_VALUE?(k=Math.sqrt(k),this.m_normal.x=e/k,this.m_normal.y=h/k):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=0.5*(b+g);this.m_points[0].y=0.5*(c+f);this.m_separations[0]=e*this.m_normal.x+h*this.m_normal.y-a.radius;break;
case 1:f=a.bodyA.m_xf.R;e=a.localPlaneNormal;this.m_normal.x=f.col1.x*e.x+f.col2.x*e.y;this.m_normal.y=f.col1.y*e.x+f.col2.y*e.y;f=a.bodyA.m_xf.R;e=a.localPoint;c=a.bodyA.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);g=a.bodyA.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);f=a.bodyB.m_xf.R;h=0;for(k=a.pointCount;h<k;){var m=h++;e=a.points[m].localPoint;b=a.bodyB.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);e=a.bodyB.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);this.m_separations[m]=(b-c)*this.m_normal.x+
(e-g)*this.m_normal.y-a.radius;this.m_points[m].x=b;this.m_points[m].y=e}break;case 2:f=a.bodyB.m_xf.R;e=a.localPlaneNormal;this.m_normal.x=f.col1.x*e.x+f.col2.x*e.y;this.m_normal.y=f.col1.y*e.x+f.col2.y*e.y;f=a.bodyB.m_xf.R;e=a.localPoint;c=a.bodyB.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y);g=a.bodyB.m_xf.position.y+(f.col1.y*e.x+f.col2.y*e.y);f=a.bodyA.m_xf.R;h=0;for(k=a.pointCount;h<k;)m=h++,e=a.points[m].localPoint,b=a.bodyA.m_xf.position.x+(f.col1.x*e.x+f.col2.x*e.y),e=a.bodyA.m_xf.position.y+
(f.col1.y*e.x+f.col2.y*e.y),this.m_separations[m]=(b-c)*this.m_normal.x+(e-g)*this.m_normal.y-a.radius,this.m_points[m].set(b,e);this.m_normal.x*=-1;this.m_normal.y*=-1}},__class__:d.dynamics.contacts.B2PositionSolverManifold};d.dynamics.contacts.B2ContactSolver=function(){this.m_step=new d.dynamics.B2TimeStep;this.m_constraints=[]};d.dynamics.contacts.B2ContactSolver.__name__=["box2D","dynamics","contacts","B2ContactSolver"];d.dynamics.contacts.B2ContactSolver.prototype={initialize:function(a,b,
e,f){var c;this.m_step.set(a);this.m_allocator=f;for(this.m_constraintCount=e;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new d.dynamics.contacts.B2ContactConstraint;for(a=0;a<e;){f=a++;c=b[f];var g=c.m_fixtureA,h=c.m_fixtureB,k=g.m_shape.m_radius,m=h.m_shape.m_radius,p=g.m_body,u=h.m_body;c=c.getManifold();var q=d.common.B2Settings.b2MixFriction(g.getFriction(),h.getFriction()),r=d.common.B2Settings.b2MixRestitution(g.getRestitution(),h.getRestitution()),
t=p.m_linearVelocity.x,s=p.m_linearVelocity.y,E=u.m_linearVelocity.x,x=u.m_linearVelocity.y,I=p.m_angularVelocity,w=u.m_angularVelocity;d.common.B2Settings.b2Assert(0<c.m_pointCount);d.dynamics.contacts.B2ContactSolver.s_worldManifold.initialize(c,p.m_xf,k,u.m_xf,m);g=d.dynamics.contacts.B2ContactSolver.s_worldManifold.m_normal.x;h=d.dynamics.contacts.B2ContactSolver.s_worldManifold.m_normal.y;f=this.m_constraints[f];f.bodyA=p;f.bodyB=u;f.manifold=c;f.normal.x=g;f.normal.y=h;f.pointCount=c.m_pointCount;
f.friction=q;f.restitution=r;f.localPlaneNormal.x=c.m_localPlaneNormal.x;f.localPlaneNormal.y=c.m_localPlaneNormal.y;f.localPoint.x=c.m_localPoint.x;f.localPoint.y=c.m_localPoint.y;f.radius=k+m;f.type=c.m_type;k=0;for(m=f.pointCount;k<m;){var v=k++,r=c.m_points[v],q=f.points[v];q.normalImpulse=r.m_normalImpulse;q.tangentImpulse=r.m_tangentImpulse;q.localPoint.setV(r.m_localPoint);var r=q.rA.x=d.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[v].x-p.m_sweep.c.x,B=q.rA.y=d.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[v].y-
p.m_sweep.c.y,z=q.rB.x=d.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[v].x-u.m_sweep.c.x,v=q.rB.y=d.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[v].y-u.m_sweep.c.y,y=r*h-B*g,D=z*h-v*g,y=y*y,D=D*D;q.normalMass=1/(p.m_invMass+u.m_invMass+p.m_invI*y+u.m_invI*D);var C=p.m_mass*p.m_invMass+u.m_mass*u.m_invMass,C=C+(p.m_mass*p.m_invI*y+u.m_mass*u.m_invI*D);q.equalizedMass=1/C;D=h;C=-g;y=r*C-B*D;D=z*C-v*D;y*=y;D*=D;q.tangentMass=1/(p.m_invMass+u.m_invMass+p.m_invI*y+u.m_invI*
D);q.velocityBias=0;r=f.normal.x*(E+-w*v-t- -I*B)+f.normal.y*(x+w*z-s-I*r);r<-d.common.B2Settings.b2_velocityThreshold&&(q.velocityBias+=-f.restitution*r)}2==f.pointCount&&(x=f.points[0],E=f.points[1],c=p.m_invMass,p=p.m_invI,t=u.m_invMass,u=u.m_invI,s=x.rA.x*h-x.rA.y*g,x=x.rB.x*h-x.rB.y*g,I=E.rA.x*h-E.rA.y*g,E=E.rB.x*h-E.rB.y*g,g=c+t+p*s*s+u*x*x,h=c+t+p*I*I+u*E*E,u=c+t+p*s*I+u*x*E,g*g<100*(g*h-u*u)?(f.K.col1.set(g,u),f.K.col2.set(u,h),f.K.getInverse(f.normalMass)):f.pointCount=1)}},initVelocityConstraints:function(a){for(var b=
0,e=this.m_constraintCount;b<e;){var f=b++,f=this.m_constraints[f],c=f.bodyA,d=f.bodyB,h=c.m_invMass,k=c.m_invI,m=d.m_invMass,p=d.m_invI,u=f.normal.x,q=f.normal.y,r=q,t=-u,s;if(a.warmStarting){s=f.pointCount;for(var E=0;E<s;){var x=E++,x=f.points[x];x.normalImpulse*=a.dtRatio;x.tangentImpulse*=a.dtRatio;var v=x.normalImpulse*u+x.tangentImpulse*r,w=x.normalImpulse*q+x.tangentImpulse*t;c.m_angularVelocity-=k*(x.rA.x*w-x.rA.y*v);c.m_linearVelocity.x-=h*v;c.m_linearVelocity.y-=h*w;d.m_angularVelocity+=
p*(x.rB.x*w-x.rB.y*v);d.m_linearVelocity.x+=m*v;d.m_linearVelocity.y+=m*w}}else for(s=f.pointCount,c=0;c<s;)d=c++,d=f.points[d],d.normalImpulse=0,d.tangentImpulse=0}},solveVelocityConstraints:function(){for(var a,b,e,f,c,g,h,k,m,p,u=0,q=this.m_constraintCount;u<q;){var r=u++;f=this.m_constraints[r];var r=f.bodyA,t=f.bodyB,s=r.m_angularVelocity,E=t.m_angularVelocity,x=r.m_linearVelocity,v=t.m_linearVelocity,w=r.m_invMass,B=r.m_invI,z=t.m_invMass,D=t.m_invI;k=f.normal.x;var y=m=f.normal.y,C=-k;p=f.friction;
h=0;for(g=f.pointCount;h<g;)a=h++,a=f.points[a],b=v.x-E*a.rB.y-x.x+s*a.rA.y,e=v.y+E*a.rB.x-x.y-s*a.rA.x,b=b*y+e*C,b=a.tangentMass*-b,e=p*a.normalImpulse,e=d.common.math.B2Math.clamp(a.tangentImpulse+b,-e,e),b=e-a.tangentImpulse,c=b*y,b*=C,x.x-=w*c,x.y-=w*b,s-=B*(a.rA.x*b-a.rA.y*c),v.x+=z*c,v.y+=z*b,E+=D*(a.rB.x*b-a.rB.y*c),a.tangentImpulse=e;if(1==f.pointCount)a=f.points[0],b=v.x+-E*a.rB.y-x.x- -s*a.rA.y,e=v.y+E*a.rB.x-x.y-s*a.rA.x,f=b*k+e*m,b=-a.normalMass*(f-a.velocityBias),e=a.normalImpulse+b,
0<e||(e=0),b=e-a.normalImpulse,c=b*k,b*=m,x.x-=w*c,x.y-=w*b,s-=B*(a.rA.x*b-a.rA.y*c),v.x+=z*c,v.y+=z*b,E+=D*(a.rB.x*b-a.rB.y*c),a.normalImpulse=e;else{a=f.points[0];y=f.points[1];g=a.normalImpulse;h=y.normalImpulse;c=(v.x-E*a.rB.y-x.x+s*a.rA.y)*k+(v.y+E*a.rB.x-x.y-s*a.rA.x)*m;var G=(v.x-E*y.rB.y-x.x+s*y.rA.y)*k+(v.y+E*y.rB.x-x.y-s*y.rA.x)*m;b=c-a.velocityBias;e=G-y.velocityBias;p=f.K;b-=p.col1.x*g+p.col2.x*h;for(e-=p.col1.y*g+p.col2.y*h;;){p=f.normalMass;C=-(p.col1.x*b+p.col2.x*e);p=-(p.col1.y*b+
p.col2.y*e);if(0<=C&&0<=p){g=C-g;h=p-h;f=g*k;g*=m;k*=h;m*=h;x.x-=w*(f+k);x.y-=w*(g+m);s-=B*(a.rA.x*g-a.rA.y*f+y.rA.x*m-y.rA.y*k);v.x+=z*(f+k);v.y+=z*(g+m);E+=D*(a.rB.x*g-a.rB.y*f+y.rB.x*m-y.rB.y*k);a.normalImpulse=C;y.normalImpulse=p;break}C=-a.normalMass*b;p=0;G=f.K.col1.y*C+e;if(0<=C&&0<=G){g=C-g;h=p-h;f=g*k;g*=m;k*=h;m*=h;x.x-=w*(f+k);x.y-=w*(g+m);s-=B*(a.rA.x*g-a.rA.y*f+y.rA.x*m-y.rA.y*k);v.x+=z*(f+k);v.y+=z*(g+m);E+=D*(a.rB.x*g-a.rB.y*f+y.rB.x*m-y.rB.y*k);a.normalImpulse=C;y.normalImpulse=p;
break}C=0;p=-y.normalMass*e;c=f.K.col2.x*p+b;if(0<=p&&0<=c){g=C-g;h=p-h;f=g*k;g*=m;k*=h;m*=h;x.x-=w*(f+k);x.y-=w*(g+m);s-=B*(a.rA.x*g-a.rA.y*f+y.rA.x*m-y.rA.y*k);v.x+=z*(f+k);v.y+=z*(g+m);E+=D*(a.rB.x*g-a.rB.y*f+y.rB.x*m-y.rB.y*k);a.normalImpulse=C;y.normalImpulse=p;break}p=C=0;c=b;G=e;if(0<=c&&0<=G){g=C-g;h=p-h;f=g*k;g*=m;k*=h;m*=h;x.x-=w*(f+k);x.y-=w*(g+m);s-=B*(a.rA.x*g-a.rA.y*f+y.rA.x*m-y.rA.y*k);v.x+=z*(f+k);v.y+=z*(g+m);E+=D*(a.rB.x*g-a.rB.y*f+y.rB.x*m-y.rB.y*k);a.normalImpulse=C;y.normalImpulse=
p;break}break}}r.m_angularVelocity=s;t.m_angularVelocity=E}},finalizeVelocityConstraints:function(){for(var a=0,b=this.m_constraintCount;a<b;)for(var e=a++,e=this.m_constraints[e],f=e.manifold,c=0,d=e.pointCount;c<d;){var h=c++,k=f.m_points[h],h=e.points[h];k.m_normalImpulse=h.normalImpulse;k.m_tangentImpulse=h.tangentImpulse}},solvePositionConstraints:function(a){for(var b=0,e=0,f=this.m_constraintCount;e<f;){var c=e++,c=this.m_constraints[c],g=c.bodyA,h=c.bodyB,k=g.m_mass*g.m_invMass,m=g.m_mass*
g.m_invI,p=h.m_mass*h.m_invMass,u=h.m_mass*h.m_invI;d.dynamics.contacts.B2ContactSolver.s_psm.initialize(c);for(var q=d.dynamics.contacts.B2ContactSolver.s_psm.m_normal,r=0,t=c.pointCount;r<t;){var s=r++,v=c.points[s],x=d.dynamics.contacts.B2ContactSolver.s_psm.m_points[s],w=d.dynamics.contacts.B2ContactSolver.s_psm.m_separations[s],s=x.x-g.m_sweep.c.x,y=x.y-g.m_sweep.c.y,z=x.x-h.m_sweep.c.x,x=x.y-h.m_sweep.c.y;b<w||(b=w);w=d.common.math.B2Math.clamp(a*(w+d.common.B2Settings.b2_linearSlop),-d.common.B2Settings.b2_maxLinearCorrection,
0);w*=-v.equalizedMass;v=w*q.x;w*=q.y;g.m_sweep.c.x-=k*v;g.m_sweep.c.y-=k*w;g.m_sweep.a-=m*(s*w-y*v);g.synchronizeTransform();h.m_sweep.c.x+=p*v;h.m_sweep.c.y+=p*w;h.m_sweep.a+=u*(z*w-x*v);h.synchronizeTransform()}}return b>-1.5*d.common.B2Settings.b2_linearSlop},__class__:d.dynamics.contacts.B2ContactSolver};d.dynamics.contacts.B2EdgeAndCircleContact=function(){d.dynamics.contacts.B2Contact.call(this)};d.dynamics.contacts.B2EdgeAndCircleContact.__name__=["box2D","dynamics","contacts","B2EdgeAndCircleContact"];
d.dynamics.contacts.B2EdgeAndCircleContact.create=function(a){return new d.dynamics.contacts.B2EdgeAndCircleContact};d.dynamics.contacts.B2EdgeAndCircleContact.destroy=function(a,b){};d.dynamics.contacts.B2EdgeAndCircleContact.__super__=d.dynamics.contacts.B2Contact;d.dynamics.contacts.B2EdgeAndCircleContact.prototype=r(d.dynamics.contacts.B2Contact.prototype,{reset:function(a,b){d.dynamics.contacts.B2Contact.prototype.reset.call(this,a,b)},evaluate:function(){var a=this.m_fixtureA.getBody(),b=this.m_fixtureB.getBody();
this.b2CollideEdgeAndCircle(this.m_manifold,z.Boot.__cast(this.m_fixtureA.getShape(),d.collision.shapes.B2EdgeShape),a.m_xf,z.Boot.__cast(this.m_fixtureB.getShape(),d.collision.shapes.B2CircleShape),b.m_xf)},b2CollideEdgeAndCircle:function(a,b,e,f,c){},__class__:d.dynamics.contacts.B2EdgeAndCircleContact});d.dynamics.contacts.B2PolyAndCircleContact=function(){d.dynamics.contacts.B2Contact.call(this)};d.dynamics.contacts.B2PolyAndCircleContact.__name__=["box2D","dynamics","contacts","B2PolyAndCircleContact"];
d.dynamics.contacts.B2PolyAndCircleContact.create=function(a){return new d.dynamics.contacts.B2PolyAndCircleContact};d.dynamics.contacts.B2PolyAndCircleContact.destroy=function(a,b){};d.dynamics.contacts.B2PolyAndCircleContact.__super__=d.dynamics.contacts.B2Contact;d.dynamics.contacts.B2PolyAndCircleContact.prototype=r(d.dynamics.contacts.B2Contact.prototype,{reset:function(a,b){d.dynamics.contacts.B2Contact.prototype.reset.call(this,a,b);d.common.B2Settings.b2Assert(a.getType()==d.collision.shapes.B2ShapeType.POLYGON_SHAPE);
d.common.B2Settings.b2Assert(b.getType()==d.collision.shapes.B2ShapeType.CIRCLE_SHAPE)},evaluate:function(){var a=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;d.collision.B2Collision.collidePolygonAndCircle(this.m_manifold,z.Boot.__cast(this.m_fixtureA.getShape(),d.collision.shapes.B2PolygonShape),a.m_xf,z.Boot.__cast(this.m_fixtureB.getShape(),d.collision.shapes.B2CircleShape),b.m_xf)},__class__:d.dynamics.contacts.B2PolyAndCircleContact});d.dynamics.contacts.B2PolyAndEdgeContact=function(){d.dynamics.contacts.B2Contact.call(this)};
d.dynamics.contacts.B2PolyAndEdgeContact.__name__=["box2D","dynamics","contacts","B2PolyAndEdgeContact"];d.dynamics.contacts.B2PolyAndEdgeContact.create=function(a){return new d.dynamics.contacts.B2PolyAndEdgeContact};d.dynamics.contacts.B2PolyAndEdgeContact.destroy=function(a,b){};d.dynamics.contacts.B2PolyAndEdgeContact.__super__=d.dynamics.contacts.B2Contact;d.dynamics.contacts.B2PolyAndEdgeContact.prototype=r(d.dynamics.contacts.B2Contact.prototype,{reset:function(a,b){d.dynamics.contacts.B2Contact.prototype.reset.call(this,
a,b);d.common.B2Settings.b2Assert(a.getType()==d.collision.shapes.B2ShapeType.POLYGON_SHAPE);d.common.B2Settings.b2Assert(b.getType()==d.collision.shapes.B2ShapeType.EDGE_SHAPE)},evaluate:function(){var a=this.m_fixtureA.getBody(),b=this.m_fixtureB.getBody();this.b2CollidePolyAndEdge(this.m_manifold,z.Boot.__cast(this.m_fixtureA.getShape(),d.collision.shapes.B2PolygonShape),a.m_xf,z.Boot.__cast(this.m_fixtureB.getShape(),d.collision.shapes.B2EdgeShape),b.m_xf)},b2CollidePolyAndEdge:function(a,b,e,
f,c){},__class__:d.dynamics.contacts.B2PolyAndEdgeContact});d.dynamics.contacts.B2PolygonContact=function(){d.dynamics.contacts.B2Contact.call(this)};d.dynamics.contacts.B2PolygonContact.__name__=["box2D","dynamics","contacts","B2PolygonContact"];d.dynamics.contacts.B2PolygonContact.create=function(a){return new d.dynamics.contacts.B2PolygonContact};d.dynamics.contacts.B2PolygonContact.destroy=function(a,b){};d.dynamics.contacts.B2PolygonContact.__super__=d.dynamics.contacts.B2Contact;d.dynamics.contacts.B2PolygonContact.prototype=
r(d.dynamics.contacts.B2Contact.prototype,{reset:function(a,b){d.dynamics.contacts.B2Contact.prototype.reset.call(this,a,b)},evaluate:function(){var a=this.m_fixtureA.getBody(),b=this.m_fixtureB.getBody();d.collision.B2Collision.collidePolygons(this.m_manifold,z.Boot.__cast(this.m_fixtureA.getShape(),d.collision.shapes.B2PolygonShape),a.m_xf,z.Boot.__cast(this.m_fixtureB.getShape(),d.collision.shapes.B2PolygonShape),b.m_xf)},__class__:d.dynamics.contacts.B2PolygonContact});d.dynamics.controllers=
{};d.dynamics.controllers.B2Controller=function(){};d.dynamics.controllers.B2Controller.__name__=["box2D","dynamics","controllers","B2Controller"];d.dynamics.controllers.B2Controller.prototype={step:function(a){},draw:function(a){},addBody:function(a){var b=new d.dynamics.controllers.B2ControllerEdge;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;null!=b.nextBody&&(b.nextBody.prevBody=b);this.m_bodyCount++;b.nextController=a.m_controllerList;b.prevController=
null;a.m_controllerList=b;null!=b.nextController&&(b.nextController.prevController=b);a.m_controllerCount++},removeBody:function(a){for(var b=a.m_controllerList;null!=b&&b.controller!=this;)b=b.nextController;null!=b.prevBody&&(b.prevBody.nextBody=b.nextBody);null!=b.nextBody&&(b.nextBody.prevBody=b.prevBody);null!=b.nextController&&(b.nextController.prevController=b.prevController);null!=b.prevController&&(b.prevController.nextController=b.nextController);this.m_bodyList==b&&(this.m_bodyList=b.nextBody);
a.m_controllerList==b&&(a.m_controllerList=b.nextController);a.m_controllerCount--;this.m_bodyCount--},clear:function(){for(;null!=this.m_bodyList;)this.removeBody(this.m_bodyList.body)},getNext:function(){return this.m_next},getWorld:function(){return this.m_world},getBodyList:function(){return this.m_bodyList},__class__:d.dynamics.controllers.B2Controller};d.dynamics.controllers.B2ControllerEdge=function(){};d.dynamics.controllers.B2ControllerEdge.__name__=["box2D","dynamics","controllers","B2ControllerEdge"];
d.dynamics.controllers.B2ControllerEdge.prototype={__class__:d.dynamics.controllers.B2ControllerEdge};d.dynamics.joints={};d.dynamics.joints.B2Joint=function(a){this.m_edgeA=new d.dynamics.joints.B2JointEdge;this.m_edgeB=new d.dynamics.joints.B2JointEdge;this.m_localCenterA=new d.common.math.B2Vec2;this.m_localCenterB=new d.common.math.B2Vec2;d.common.B2Settings.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=
a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};d.dynamics.joints.B2Joint.__name__=["box2D","dynamics","joints","B2Joint"];d.dynamics.joints.B2Joint.create=function(a,b){var e=null;switch(a.type[1]){case 3:e=new d.dynamics.joints.B2DistanceJoint(z.Boot.__cast(a,d.dynamics.joints.B2DistanceJointDef));break;case 5:e=new d.dynamics.joints.B2MouseJoint(z.Boot.__cast(a,d.dynamics.joints.B2MouseJointDef));break;case 2:e=new d.dynamics.joints.B2PrismaticJoint(z.Boot.__cast(a,d.dynamics.joints.B2PrismaticJointDef));
break;case 1:e=new d.dynamics.joints.B2RevoluteJoint(z.Boot.__cast(a,d.dynamics.joints.B2RevoluteJointDef));break;case 4:e=new d.dynamics.joints.B2PulleyJoint(z.Boot.__cast(a,d.dynamics.joints.B2PulleyJointDef));break;case 6:e=new d.dynamics.joints.B2GearJoint(z.Boot.__cast(a,d.dynamics.joints.B2GearJointDef));break;case 7:e=new d.dynamics.joints.B2LineJoint(z.Boot.__cast(a,d.dynamics.joints.B2LineJointDef));break;case 8:e=new d.dynamics.joints.B2WeldJoint(z.Boot.__cast(a,d.dynamics.joints.B2WeldJointDef));
break;case 9:e=new d.dynamics.joints.B2FrictionJoint(z.Boot.__cast(a,d.dynamics.joints.B2FrictionJointDef))}return e};d.dynamics.joints.B2Joint.destroy=function(a,b){};d.dynamics.joints.B2Joint.prototype={getType:function(){return this.m_type},getAnchorA:function(){return null},getAnchorB:function(){return null},getReactionForce:function(a){return null},getReactionTorque:function(a){return 0},getBodyA:function(){return this.m_bodyA},getBodyB:function(){return this.m_bodyB},getNext:function(){return this.m_next},
getUserData:function(){return this.m_userData},setUserData:function(a){this.m_userData=a},isActive:function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},initVelocityConstraints:function(a){},solveVelocityConstraints:function(a){},finalizeVelocityConstraints:function(){},solvePositionConstraints:function(a){return!1},__class__:d.dynamics.joints.B2Joint};d.dynamics.joints.B2DistanceJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.m_localAnchor1=new d.common.math.B2Vec2;this.m_localAnchor2=
new d.common.math.B2Vec2;this.m_u=new d.common.math.B2Vec2;this.m_localAnchor1.setV(a.localAnchorA);this.m_localAnchor2.setV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};d.dynamics.joints.B2DistanceJoint.__name__=["box2D","dynamics","joints","B2DistanceJoint"];d.dynamics.joints.B2DistanceJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2DistanceJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,
{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},getReactionTorque:function(a){return 0},getLength:function(){return this.m_length},setLength:function(a){this.m_length=a},getFrequency:function(){return this.m_frequencyHz},setFrequency:function(a){this.m_frequencyHz=a},getDampingRatio:function(){return this.m_dampingRatio},
setDampingRatio:function(a){this.m_dampingRatio=a},initVelocityConstraints:function(a){var b,e,f=this.m_bodyA,c=this.m_bodyB;b=f.m_xf.R;var g=this.m_localAnchor1.x-f.m_sweep.localCenter.x,h=this.m_localAnchor1.y-f.m_sweep.localCenter.y;e=b.col1.x*g+b.col2.x*h;h=b.col1.y*g+b.col2.y*h;g=e;b=c.m_xf.R;var k=this.m_localAnchor2.x-c.m_sweep.localCenter.x,m=this.m_localAnchor2.y-c.m_sweep.localCenter.y;e=b.col1.x*k+b.col2.x*m;m=b.col1.y*k+b.col2.y*m;k=e;this.m_u.x=c.m_sweep.c.x+k-f.m_sweep.c.x-g;this.m_u.y=
c.m_sweep.c.y+m-f.m_sweep.c.y-h;e=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);e>d.common.B2Settings.b2_linearSlop?this.m_u.multiply(1/e):this.m_u.setZero();b=g*this.m_u.y-h*this.m_u.x;var p=k*this.m_u.y-m*this.m_u.x;b=f.m_invMass+f.m_invI*b*b+c.m_invMass+c.m_invI*p*p;this.m_mass=0!=b?1/b:0;if(0<this.m_frequencyHz){e-=this.m_length;var p=2*Math.PI*this.m_frequencyHz,u=this.m_mass*p*p;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*p+a.dt*u);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:
0;this.m_bias=e*a.dt*u*this.m_gamma;this.m_mass=b+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y,f.m_linearVelocity.x-=f.m_invMass*a,f.m_linearVelocity.y-=f.m_invMass*b,f.m_angularVelocity-=f.m_invI*(g*b-h*a),c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*b,c.m_angularVelocity+=c.m_invI*(k*b-m*a)):this.m_impulse=0},solveVelocityConstraints:function(a){var b;a=this.m_bodyA;
var e=this.m_bodyB;b=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,c=this.m_localAnchor1.y-a.m_sweep.localCenter.y,d=b.col1.x*f+b.col2.x*c,c=b.col1.y*f+b.col2.y*c,f=d;b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,k=this.m_localAnchor2.y-e.m_sweep.localCenter.y,d=b.col1.x*h+b.col2.x*k,k=b.col1.y*h+b.col2.y*k,h=d,d=-this.m_mass*(this.m_u.x*(e.m_linearVelocity.x+-e.m_angularVelocity*k-(a.m_linearVelocity.x+-a.m_angularVelocity*c))+this.m_u.y*(e.m_linearVelocity.y+e.m_angularVelocity*
h-(a.m_linearVelocity.y+a.m_angularVelocity*f))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=d;b=d*this.m_u.x;d*=this.m_u.y;a.m_linearVelocity.x-=a.m_invMass*b;a.m_linearVelocity.y-=a.m_invMass*d;a.m_angularVelocity-=a.m_invI*(f*d-c*b);e.m_linearVelocity.x+=e.m_invMass*b;e.m_linearVelocity.y+=e.m_invMass*d;e.m_angularVelocity+=e.m_invI*(h*d-k*b)},solvePositionConstraints:function(a){var b;if(0<this.m_frequencyHz)return!0;a=this.m_bodyA;var e=this.m_bodyB;b=a.m_xf.R;var f=this.m_localAnchor1.x-
a.m_sweep.localCenter.x,c=this.m_localAnchor1.y-a.m_sweep.localCenter.y,g=b.col1.x*f+b.col2.x*c,c=b.col1.y*f+b.col2.y*c,f=g;b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,k=this.m_localAnchor2.y-e.m_sweep.localCenter.y,g=b.col1.x*h+b.col2.x*k,k=b.col1.y*h+b.col2.y*k,h=g,g=e.m_sweep.c.x+h-a.m_sweep.c.x-f,m=e.m_sweep.c.y+k-a.m_sweep.c.y-c;b=Math.sqrt(g*g+m*m);g/=b;m/=b;b-=this.m_length;b=d.common.math.B2Math.clamp(b,-d.common.B2Settings.b2_maxLinearCorrection,d.common.B2Settings.b2_maxLinearCorrection);
var p=-this.m_mass*b;this.m_u.set(g,m);g=p*this.m_u.x;m=p*this.m_u.y;a.m_sweep.c.x-=a.m_invMass*g;a.m_sweep.c.y-=a.m_invMass*m;a.m_sweep.a-=a.m_invI*(f*m-c*g);e.m_sweep.c.x+=e.m_invMass*g;e.m_sweep.c.y+=e.m_invMass*m;e.m_sweep.a+=e.m_invI*(h*m-k*g);a.synchronizeTransform();e.synchronizeTransform();return d.common.math.B2Math.abs(b)<d.common.B2Settings.b2_linearSlop},__class__:d.dynamics.joints.B2DistanceJoint});d.dynamics.joints.B2JointDef=function(){this.type=d.dynamics.joints.B2JointType.UNKNOWN_JOINT;
this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};d.dynamics.joints.B2JointDef.__name__=["box2D","dynamics","joints","B2JointDef"];d.dynamics.joints.B2JointDef.prototype={__class__:d.dynamics.joints.B2JointDef};d.dynamics.joints.B2DistanceJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.DISTANCE_JOINT;this.length=1;this.dampingRatio=this.frequencyHz=
0};d.dynamics.joints.B2DistanceJointDef.__name__=["box2D","dynamics","joints","B2DistanceJointDef"];d.dynamics.joints.B2DistanceJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2DistanceJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{initialize:function(a,b,e,f){this.bodyA=a;this.bodyB=b;this.localAnchorA.setV(this.bodyA.getLocalPoint(e));this.localAnchorB.setV(this.bodyB.getLocalPoint(f));a=f.x-e.x;e=f.y-e.y;this.length=Math.sqrt(a*a+e*e);this.dampingRatio=this.frequencyHz=
0},__class__:d.dynamics.joints.B2DistanceJointDef});d.dynamics.joints.B2FrictionJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.m_localAnchorA=new d.common.math.B2Vec2;this.m_localAnchorB=new d.common.math.B2Vec2;this.m_linearMass=new d.common.math.B2Mat22;this.m_linearImpulse=new d.common.math.B2Vec2;this.m_localAnchorA.setV(a.localAnchorA);this.m_localAnchorB.setV(a.localAnchorB);this.m_linearMass.setZero();this.m_angularMass=0;this.m_linearImpulse.setZero();this.m_angularImpulse=
0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};d.dynamics.joints.B2FrictionJoint.__name__=["box2D","dynamics","joints","B2FrictionJoint"];d.dynamics.joints.B2FrictionJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2FrictionJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*
this.m_linearImpulse.x,a*this.m_linearImpulse.y)},getReactionTorque:function(a){return a*this.m_angularImpulse},setMaxForce:function(a){this.m_maxForce=a},getMaxForce:function(){return this.m_maxForce},setMaxTorque:function(a){this.m_maxTorque=a},getMaxTorque:function(){return this.m_maxTorque},initVelocityConstraints:function(a){var b,e,f=this.m_bodyA,c=this.m_bodyB;b=f.m_xf.R;var g=this.m_localAnchorA.x-f.m_sweep.localCenter.x,h=this.m_localAnchorA.y-f.m_sweep.localCenter.y;e=b.col1.x*g+b.col2.x*
h;h=b.col1.y*g+b.col2.y*h;g=e;b=c.m_xf.R;var k=this.m_localAnchorB.x-c.m_sweep.localCenter.x,m=this.m_localAnchorB.y-c.m_sweep.localCenter.y;e=b.col1.x*k+b.col2.x*m;m=b.col1.y*k+b.col2.y*m;k=e;b=f.m_invMass;e=c.m_invMass;var p=f.m_invI,u=c.m_invI,q=new d.common.math.B2Mat22;q.col1.x=b+e;q.col2.x=0;q.col1.y=0;q.col2.y=b+e;q.col1.x+=p*h*h;q.col2.x+=-p*g*h;q.col1.y+=-p*g*h;q.col2.y+=p*g*g;q.col1.x+=u*m*m;q.col2.x+=-u*k*m;q.col1.y+=-u*k*m;q.col2.y+=u*k*k;q.getInverse(this.m_linearMass);this.m_angularMass=
p+u;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,f.m_linearVelocity.x-=b*a.x,f.m_linearVelocity.y-=b*a.y,f.m_angularVelocity-=p*(g*a.y-h*a.x+this.m_angularImpulse),c.m_linearVelocity.x+=e*a.x,c.m_linearVelocity.y+=e*a.y,c.m_angularVelocity+=u*(k*a.y-m*a.x+this.m_angularImpulse)):(this.m_linearImpulse.setZero(),this.m_angularImpulse=0)},solveVelocityConstraints:function(a){var b,
e,f=this.m_bodyA,c=this.m_bodyB,g=f.m_linearVelocity,h=f.m_angularVelocity,k=c.m_linearVelocity,m=c.m_angularVelocity,p=f.m_invMass,u=c.m_invMass,q=f.m_invI,r=c.m_invI;b=f.m_xf.R;var t=this.m_localAnchorA.x-f.m_sweep.localCenter.x,s=this.m_localAnchorA.y-f.m_sweep.localCenter.y;e=b.col1.x*t+b.col2.x*s;s=b.col1.y*t+b.col2.y*s;t=e;b=c.m_xf.R;var v=this.m_localAnchorB.x-c.m_sweep.localCenter.x,x=this.m_localAnchorB.y-c.m_sweep.localCenter.y;e=b.col1.x*v+b.col2.x*x;x=b.col1.y*v+b.col2.y*x;v=e;e=-this.m_angularMass*
(m-h);var w=this.m_angularImpulse;b=a.dt*this.m_maxTorque;this.m_angularImpulse=d.common.math.B2Math.clamp(this.m_angularImpulse+e,-b,b);e=this.m_angularImpulse-w;h-=q*e;m+=r*e;b=d.common.math.B2Math.mulMV(this.m_linearMass,new d.common.math.B2Vec2(-(k.x-m*x-g.x+h*s),-(k.y+m*v-g.y-h*t)));e=this.m_linearImpulse.copy();this.m_linearImpulse.add(b);b=a.dt*this.m_maxForce;this.m_linearImpulse.lengthSquared()>b*b&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.multiply(b));b=d.common.math.B2Math.subtractVV(this.m_linearImpulse,
e);g.x-=p*b.x;g.y-=p*b.y;h-=q*(t*b.y-s*b.x);k.x+=u*b.x;k.y+=u*b.y;m+=r*(v*b.y-x*b.x);f.m_angularVelocity=h;c.m_angularVelocity=m},solvePositionConstraints:function(a){return!0},__class__:d.dynamics.joints.B2FrictionJoint});d.dynamics.joints.B2FrictionJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.FRICTION_JOINT;this.maxTorque=this.maxForce=0};d.dynamics.joints.B2FrictionJointDef.__name__=
["box2D","dynamics","joints","B2FrictionJointDef"];d.dynamics.joints.B2FrictionJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2FrictionJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{initialize:function(a,b,e){this.bodyA=a;this.bodyB=b;this.localAnchorA.setV(this.bodyA.getLocalPoint(e));this.localAnchorB.setV(this.bodyB.getLocalPoint(e))},__class__:d.dynamics.joints.B2FrictionJointDef});d.dynamics.joints.B2GearJoint=function(a){d.dynamics.joints.B2Joint.call(this,
a);this.m_groundAnchor1=new d.common.math.B2Vec2;this.m_groundAnchor2=new d.common.math.B2Vec2;this.m_localAnchor1=new d.common.math.B2Vec2;this.m_localAnchor2=new d.common.math.B2Vec2;this.m_J=new d.dynamics.joints.B2Jacobian;var b=a.joint1.m_type,e=a.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=a.joint1.getBodyA();this.m_bodyA=a.joint1.getBodyB();b==d.dynamics.joints.B2JointType.REVOLUTE_JOINT?(this.m_revolute1=z.Boot.__cast(a.joint1,d.dynamics.joints.B2RevoluteJoint),
this.m_groundAnchor1.setV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.setV(this.m_revolute1.m_localAnchor2),b=this.m_revolute1.getJointAngle()):(this.m_prismatic1=z.Boot.__cast(a.joint1,d.dynamics.joints.B2PrismaticJoint),this.m_groundAnchor1.setV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.setV(this.m_prismatic1.m_localAnchor2),b=this.m_prismatic1.getJointTranslation());this.m_ground2=a.joint2.getBodyA();this.m_bodyB=a.joint2.getBodyB();e==d.dynamics.joints.B2JointType.REVOLUTE_JOINT?
(this.m_revolute2=z.Boot.__cast(a.joint2,d.dynamics.joints.B2RevoluteJoint),this.m_groundAnchor2.setV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.setV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.getJointAngle()):(this.m_prismatic2=z.Boot.__cast(a.joint2,d.dynamics.joints.B2PrismaticJoint),this.m_groundAnchor2.setV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.setV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.getJointTranslation());this.m_ratio=a.ratio;this.m_constant=
b+this.m_ratio*e;this.m_impulse=0};d.dynamics.joints.B2GearJoint.__name__=["box2D","dynamics","joints","B2GearJoint"];d.dynamics.joints.B2GearJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2GearJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*this.m_impulse*this.m_J.linearB.x,
a*this.m_impulse*this.m_J.linearB.y)},getReactionTorque:function(a){var b=this.m_bodyB.m_xf.R,e=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,f=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,c=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f;return a*(this.m_impulse*this.m_J.angularB-c*this.m_impulse*this.m_J.linearB.y+f*this.m_impulse*this.m_J.linearB.x)},getRatio:function(){return this.m_ratio},setRatio:function(a){this.m_ratio=a},initVelocityConstraints:function(a){var b=this.m_ground1,
e=this.m_ground2,f=this.m_bodyA,c=this.m_bodyB,d,h,k,m,p,u=0;this.m_J.setZero();null!=this.m_revolute1?(this.m_J.angularA=-1,u+=f.m_invI):(m=b.m_xf.R,d=this.m_prismatic1.m_localXAxis1,b=m.col1.x*d.x+m.col2.x*d.y,d=m.col1.y*d.x+m.col2.y*d.y,m=f.m_xf.R,h=this.m_localAnchor1.x-f.m_sweep.localCenter.x,k=this.m_localAnchor1.y-f.m_sweep.localCenter.y,p=m.col1.x*h+m.col2.x*k,k=m.col1.y*h+m.col2.y*k,m=p*d-k*b,this.m_J.linearA.set(-b,-d),this.m_J.angularA=-m,u+=f.m_invMass+f.m_invI*m*m);null!=this.m_revolute2?
(this.m_J.angularB=-this.m_ratio,u+=this.m_ratio*this.m_ratio*c.m_invI):(m=e.m_xf.R,d=this.m_prismatic2.m_localXAxis1,b=m.col1.x*d.x+m.col2.x*d.y,d=m.col1.y*d.x+m.col2.y*d.y,m=c.m_xf.R,h=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,p=m.col1.x*h+m.col2.x*k,k=m.col1.y*h+m.col2.y*k,m=p*d-k*b,this.m_J.linearB.set(-this.m_ratio*b,-this.m_ratio*d),this.m_J.angularB=-this.m_ratio*m,u+=this.m_ratio*this.m_ratio*(c.m_invMass+c.m_invI*m*m));this.m_mass=0<u?1/
u:0;a.warmStarting?(f.m_linearVelocity.x+=f.m_invMass*this.m_impulse*this.m_J.linearA.x,f.m_linearVelocity.y+=f.m_invMass*this.m_impulse*this.m_J.linearA.y,f.m_angularVelocity+=f.m_invI*this.m_impulse*this.m_J.angularA,c.m_linearVelocity.x+=c.m_invMass*this.m_impulse*this.m_J.linearB.x,c.m_linearVelocity.y+=c.m_invMass*this.m_impulse*this.m_J.linearB.y,c.m_angularVelocity+=c.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},solveVelocityConstraints:function(a){a=this.m_bodyA;var b=this.m_bodyB,
e=this.m_J.compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity),e=-this.m_mass*e;this.m_impulse+=e;a.m_linearVelocity.x+=a.m_invMass*e*this.m_J.linearA.x;a.m_linearVelocity.y+=a.m_invMass*e*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*e*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*e*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*e*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*e*this.m_J.angularB},solvePositionConstraints:function(a){a=this.m_bodyA;
var b=this.m_bodyB,e,f;e=null!=this.m_revolute1?this.m_revolute1.getJointAngle():this.m_prismatic1.getJointTranslation();f=null!=this.m_revolute2?this.m_revolute2.getJointAngle():this.m_prismatic2.getJointTranslation();e=-this.m_mass*(this.m_constant-(e+this.m_ratio*f));a.m_sweep.c.x+=a.m_invMass*e*this.m_J.linearA.x;a.m_sweep.c.y+=a.m_invMass*e*this.m_J.linearA.y;a.m_sweep.a+=a.m_invI*e*this.m_J.angularA;b.m_sweep.c.x+=b.m_invMass*e*this.m_J.linearB.x;b.m_sweep.c.y+=b.m_invMass*e*this.m_J.linearB.y;
b.m_sweep.a+=b.m_invI*e*this.m_J.angularB;a.synchronizeTransform();b.synchronizeTransform();return 0<d.common.B2Settings.b2_linearSlop},__class__:d.dynamics.joints.B2GearJoint});d.dynamics.joints.B2GearJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.type=d.dynamics.joints.B2JointType.GEAR_JOINT;this.joint2=this.joint1=null;this.ratio=1};d.dynamics.joints.B2GearJointDef.__name__=["box2D","dynamics","joints","B2GearJointDef"];d.dynamics.joints.B2GearJointDef.__super__=d.dynamics.joints.B2JointDef;
d.dynamics.joints.B2GearJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{__class__:d.dynamics.joints.B2GearJointDef});d.dynamics.joints.B2Jacobian=function(){this.linearA=new d.common.math.B2Vec2;this.linearB=new d.common.math.B2Vec2};d.dynamics.joints.B2Jacobian.__name__=["box2D","dynamics","joints","B2Jacobian"];d.dynamics.joints.B2Jacobian.prototype={setZero:function(){this.linearA.setZero();this.angularA=0;this.linearB.setZero();this.angularB=0},set:function(a,b,e,f){this.linearA.setV(a);
this.angularA=b;this.linearB.setV(e);this.angularB=f},compute:function(a,b,e,f){return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*e.x+this.linearB.y*e.y)+this.angularB*f},__class__:d.dynamics.joints.B2Jacobian};d.dynamics.joints.B2JointEdge=function(){};d.dynamics.joints.B2JointEdge.__name__=["box2D","dynamics","joints","B2JointEdge"];d.dynamics.joints.B2JointEdge.prototype={__class__:d.dynamics.joints.B2JointEdge};d.dynamics.joints.B2JointType={__ename__:!0,__constructs__:"UNKNOWN_JOINT REVOLUTE_JOINT PRISMATIC_JOINT DISTANCE_JOINT PULLEY_JOINT MOUSE_JOINT GEAR_JOINT LINE_JOINT WELD_JOINT FRICTION_JOINT".split(" ")};
d.dynamics.joints.B2JointType.UNKNOWN_JOINT=["UNKNOWN_JOINT",0];d.dynamics.joints.B2JointType.UNKNOWN_JOINT.toString=D;d.dynamics.joints.B2JointType.UNKNOWN_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.REVOLUTE_JOINT=["REVOLUTE_JOINT",1];d.dynamics.joints.B2JointType.REVOLUTE_JOINT.toString=D;d.dynamics.joints.B2JointType.REVOLUTE_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.PRISMATIC_JOINT=["PRISMATIC_JOINT",2];d.dynamics.joints.B2JointType.PRISMATIC_JOINT.toString=
D;d.dynamics.joints.B2JointType.PRISMATIC_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.DISTANCE_JOINT=["DISTANCE_JOINT",3];d.dynamics.joints.B2JointType.DISTANCE_JOINT.toString=D;d.dynamics.joints.B2JointType.DISTANCE_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.PULLEY_JOINT=["PULLEY_JOINT",4];d.dynamics.joints.B2JointType.PULLEY_JOINT.toString=D;d.dynamics.joints.B2JointType.PULLEY_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.MOUSE_JOINT=
["MOUSE_JOINT",5];d.dynamics.joints.B2JointType.MOUSE_JOINT.toString=D;d.dynamics.joints.B2JointType.MOUSE_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.GEAR_JOINT=["GEAR_JOINT",6];d.dynamics.joints.B2JointType.GEAR_JOINT.toString=D;d.dynamics.joints.B2JointType.GEAR_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.LINE_JOINT=["LINE_JOINT",7];d.dynamics.joints.B2JointType.LINE_JOINT.toString=D;d.dynamics.joints.B2JointType.LINE_JOINT.__enum__=
d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.WELD_JOINT=["WELD_JOINT",8];d.dynamics.joints.B2JointType.WELD_JOINT.toString=D;d.dynamics.joints.B2JointType.WELD_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.FRICTION_JOINT=["FRICTION_JOINT",9];d.dynamics.joints.B2JointType.FRICTION_JOINT.toString=D;d.dynamics.joints.B2JointType.FRICTION_JOINT.__enum__=d.dynamics.joints.B2JointType;d.dynamics.joints.B2JointType.__empty_constructs__=[d.dynamics.joints.B2JointType.UNKNOWN_JOINT,
d.dynamics.joints.B2JointType.REVOLUTE_JOINT,d.dynamics.joints.B2JointType.PRISMATIC_JOINT,d.dynamics.joints.B2JointType.DISTANCE_JOINT,d.dynamics.joints.B2JointType.PULLEY_JOINT,d.dynamics.joints.B2JointType.MOUSE_JOINT,d.dynamics.joints.B2JointType.GEAR_JOINT,d.dynamics.joints.B2JointType.LINE_JOINT,d.dynamics.joints.B2JointType.WELD_JOINT,d.dynamics.joints.B2JointType.FRICTION_JOINT];d.dynamics.joints.B2LimitState={__ename__:!0,__constructs__:["INACTIVE_LIMIT","AT_LOWER_LIMIT","AT_UPPER_LIMIT",
"EQUAL_LIMITS"]};d.dynamics.joints.B2LimitState.INACTIVE_LIMIT=["INACTIVE_LIMIT",0];d.dynamics.joints.B2LimitState.INACTIVE_LIMIT.toString=D;d.dynamics.joints.B2LimitState.INACTIVE_LIMIT.__enum__=d.dynamics.joints.B2LimitState;d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT=["AT_LOWER_LIMIT",1];d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT.toString=D;d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT.__enum__=d.dynamics.joints.B2LimitState;d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT=["AT_UPPER_LIMIT",
2];d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT.toString=D;d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT.__enum__=d.dynamics.joints.B2LimitState;d.dynamics.joints.B2LimitState.EQUAL_LIMITS=["EQUAL_LIMITS",3];d.dynamics.joints.B2LimitState.EQUAL_LIMITS.toString=D;d.dynamics.joints.B2LimitState.EQUAL_LIMITS.__enum__=d.dynamics.joints.B2LimitState;d.dynamics.joints.B2LimitState.__empty_constructs__=[d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT,d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT,
d.dynamics.joints.B2LimitState.EQUAL_LIMITS];d.dynamics.joints.B2LineJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.m_localAnchor1=new d.common.math.B2Vec2;this.m_localAnchor2=new d.common.math.B2Vec2;this.m_localXAxis1=new d.common.math.B2Vec2;this.m_localYAxis1=new d.common.math.B2Vec2;this.m_axis=new d.common.math.B2Vec2;this.m_perp=new d.common.math.B2Vec2;this.m_K=new d.common.math.B2Mat22;this.m_impulse=new d.common.math.B2Vec2;this.m_localAnchor1.setV(a.localAnchorA);this.m_localAnchor2.setV(a.localAnchorB);
this.m_localXAxis1.setV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.setZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT;this.m_axis.setZero();this.m_perp.setZero()};
d.dynamics.joints.B2LineJoint.__name__=["box2D","dynamics","joints","B2LineJoint"];d.dynamics.joints.B2LineJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2LineJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*
this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},getReactionTorque:function(a){return a*this.m_impulse.y},getJointTranslation:function(){var a=this.m_bodyA,b=this.m_bodyB,e=a.getWorldPoint(this.m_localAnchor1),f=b.getWorldPoint(this.m_localAnchor2),b=f.x-e.x,e=f.y-e.y,a=a.getWorldVector(this.m_localXAxis1);return a.x*b+a.y*e},getJointSpeed:function(){var a=this.m_bodyA,b=this.m_bodyB,e;e=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,
c=this.m_localAnchor1.y-a.m_sweep.localCenter.y,d=e.col1.x*f+e.col2.x*c,c=e.col1.y*f+e.col2.y*c,f=d;e=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,k=this.m_localAnchor2.y-b.m_sweep.localCenter.y,d=e.col1.x*h+e.col2.x*k,k=e.col1.y*h+e.col2.y*k,h=d;e=b.m_sweep.c.x+h-(a.m_sweep.c.x+f);var d=b.m_sweep.c.y+k-(a.m_sweep.c.y+c),m=a.getWorldVector(this.m_localXAxis1),p=a.m_linearVelocity,u=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return e*-a*m.y+d*a*m.x+(m.x*(u.x+-b*
k-p.x- -a*c)+m.y*(u.y+b*h-p.y-a*f))},isLimitEnabled:function(){return this.m_enableLimit},enableLimit:function(a){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_enableLimit=a},getLowerLimit:function(){return this.m_lowerTranslation},getUpperLimit:function(){return this.m_upperTranslation},setLimits:function(a,b){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b},isMotorEnabled:function(){return this.m_enableMotor},enableMotor:function(a){this.m_bodyA.setAwake(!0);
this.m_bodyB.setAwake(!0);this.m_enableMotor=a},setMotorSpeed:function(a){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_motorSpeed=a},getMotorSpeed:function(){return this.m_motorSpeed},setMaxMotorForce:function(a){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_maxMotorForce=a},getMaxMotorForce:function(){return this.m_maxMotorForce},getMotorForce:function(){return this.m_motorImpulse},initVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f,c;this.m_localCenterA.setV(b.getLocalCenter());
this.m_localCenterB.setV(e.getLocalCenter());var g=b.getTransform();e.getTransform();f=b.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x,k=this.m_localAnchor1.y-this.m_localCenterA.y;c=f.col1.x*h+f.col2.x*k;k=f.col1.y*h+f.col2.y*k;h=c;f=e.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y;c=f.col1.x*m+f.col2.x*p;p=f.col1.y*m+f.col2.y*p;m=c;f=e.m_sweep.c.x+m-b.m_sweep.c.x-h;c=e.m_sweep.c.y+p-b.m_sweep.c.y-k;this.m_invMassA=b.m_invMass;this.m_invMassB=
e.m_invMass;this.m_invIA=b.m_invI;this.m_invIB=e.m_invI;this.m_axis.setV(d.common.math.B2Math.mulMV(g.R,this.m_localXAxis1));this.m_a1=(f+h)*this.m_axis.y-(c+k)*this.m_axis.x;this.m_a2=m*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.setV(d.common.math.B2Math.mulMV(g.R,this.m_localYAxis1));this.m_s1=(f+h)*this.m_perp.y-
(c+k)*this.m_perp.x;this.m_s2=m*this.m_perp.y-p*this.m_perp.x;g=this.m_invMassA;h=this.m_invMassB;k=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=g+h+k*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=k*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=g+h+k*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(f=this.m_axis.x*f+this.m_axis.y*c,d.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*d.common.B2Settings.b2_linearSlop?
this.m_limitState=d.dynamics.joints.B2LimitState.EQUAL_LIMITS:f<=this.m_lowerTranslation?this.m_limitState!=d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT&&(this.m_limitState=d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT,this.m_impulse.y=0):f>=this.m_upperTranslation?this.m_limitState!=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(this.m_limitState=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT,this.m_impulse.y=0):(this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,this.m_impulse.y=0)):
this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT;!1==this.m_enableMotor&&(this.m_motorImpulse=0);a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,f=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,g=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+
this.m_impulse.y)*this.m_a2,b.m_linearVelocity.x-=this.m_invMassA*a,b.m_linearVelocity.y-=this.m_invMassA*f,b.m_angularVelocity-=this.m_invIA*c,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*f,e.m_angularVelocity+=this.m_invIB*g):(this.m_impulse.setZero(),this.m_motorImpulse=0)},solveVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f=b.m_linearVelocity,c=b.m_angularVelocity,g=e.m_linearVelocity,h=e.m_angularVelocity,k,m,p;this.m_enableMotor&&this.m_limitState!=
d.dynamics.joints.B2LimitState.EQUAL_LIMITS&&(p=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(g.x-f.x)+this.m_axis.y*(g.y-f.y)+this.m_a2*h-this.m_a1*c)),k=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=d.common.math.B2Math.clamp(this.m_motorImpulse+p,-a,a),p=this.m_motorImpulse-k,k=p*this.m_axis.x,a=p*this.m_axis.y,m=p*this.m_a1,p*=this.m_a2,f.x-=this.m_invMassA*k,f.y-=this.m_invMassA*a,c-=this.m_invIA*m,g.x+=this.m_invMassB*k,g.y+=this.m_invMassB*a,h+=this.m_invIB*p);a=
this.m_perp.x*(g.x-f.x)+this.m_perp.y*(g.y-f.y)+this.m_s2*h-this.m_s1*c;this.m_enableLimit&&this.m_limitState!=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT?(m=this.m_axis.x*(g.x-f.x)+this.m_axis.y*(g.y-f.y)+this.m_a2*h-this.m_a1*c,k=this.m_impulse.copy(),p=this.m_K.solve(new d.common.math.B2Vec2,-a,-m),this.m_impulse.add(p),this.m_limitState==d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT?this.m_impulse.y=d.common.math.B2Math.max(this.m_impulse.y,0):this.m_limitState==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&
(this.m_impulse.y=d.common.math.B2Math.min(this.m_impulse.y,0)),a=-a-(this.m_impulse.y-k.y)*this.m_K.col2.x,this.m_impulse.x=0!=this.m_K.col1.x?a/this.m_K.col1.x+k.x:k.x,p.x=this.m_impulse.x-k.x,p.y=this.m_impulse.y-k.y,k=p.x*this.m_perp.x+p.y*this.m_axis.x,a=p.x*this.m_perp.y+p.y*this.m_axis.y,m=p.x*this.m_s1+p.y*this.m_a1,p=p.x*this.m_s2+p.y*this.m_a2):(p=0!=this.m_K.col1.x?-a/this.m_K.col1.x:0,this.m_impulse.x+=p,k=p*this.m_perp.x,a=p*this.m_perp.y,m=p*this.m_s1,p*=this.m_s2);f.x-=this.m_invMassA*
k;f.y-=this.m_invMassA*a;c-=this.m_invIA*m;g.x+=this.m_invMassB*k;g.y+=this.m_invMassB*a;h+=this.m_invIB*p;b.m_linearVelocity.setV(f);b.m_angularVelocity=c;e.m_linearVelocity.setV(g);e.m_angularVelocity=h},solvePositionConstraints:function(a){a=this.m_bodyA;var b=this.m_bodyB,e=a.m_sweep.c,f=a.m_sweep.a,c=b.m_sweep.c,g=b.m_sweep.a,h,k,m,p,u,q=0,r=0;m=!1;var t=0,s=d.common.math.B2Mat22.fromAngle(f);p=d.common.math.B2Mat22.fromAngle(g);h=s;var r=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-
this.m_localCenterA.y;k=h.col1.x*r+h.col2.x*v;v=h.col1.y*r+h.col2.y*v;r=k;h=p;p=this.m_localAnchor2.x-this.m_localCenterB.x;u=this.m_localAnchor2.y-this.m_localCenterB.y;k=h.col1.x*p+h.col2.x*u;u=h.col1.y*p+h.col2.y*u;p=k;h=c.x+p-e.x-r;k=c.y+u-e.y-v;if(this.m_enableLimit){this.m_axis=d.common.math.B2Math.mulMV(s,this.m_localXAxis1);this.m_a1=(h+r)*this.m_axis.y-(k+v)*this.m_axis.x;this.m_a2=p*this.m_axis.y-u*this.m_axis.x;var x=this.m_axis.x*h+this.m_axis.y*k;d.common.math.B2Math.abs(this.m_upperTranslation-
this.m_lowerTranslation)<2*d.common.B2Settings.b2_linearSlop?(t=d.common.math.B2Math.clamp(x,-d.common.B2Settings.b2_maxLinearCorrection,d.common.B2Settings.b2_maxLinearCorrection),q=d.common.math.B2Math.abs(x),m=!0):x<=this.m_lowerTranslation?(t=d.common.math.B2Math.clamp(x-this.m_lowerTranslation+d.common.B2Settings.b2_linearSlop,-d.common.B2Settings.b2_maxLinearCorrection,0),q=this.m_lowerTranslation-x,m=!0):x>=this.m_upperTranslation&&(t=d.common.math.B2Math.clamp(x-this.m_upperTranslation+d.common.B2Settings.b2_linearSlop,
0,d.common.B2Settings.b2_maxLinearCorrection),q=x-this.m_upperTranslation,m=!0)}this.m_perp=d.common.math.B2Math.mulMV(s,this.m_localYAxis1);this.m_s1=(h+r)*this.m_perp.y-(k+v)*this.m_perp.x;this.m_s2=p*this.m_perp.y-u*this.m_perp.x;s=new d.common.math.B2Vec2;v=this.m_perp.x*h+this.m_perp.y*k;q=d.common.math.B2Math.max(q,d.common.math.B2Math.abs(v));r=0;m?(m=this.m_invMassA,p=this.m_invMassB,u=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=m+p+u*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=
u*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+p+u*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.solve(s,-v,-t)):(m=this.m_invMassA,p=this.m_invMassB,u=this.m_invIA,h=this.m_invIB,t=m+p+u*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,s.x=0!=t?-v/t:0,s.y=0);t=s.x*this.m_perp.x+s.y*this.m_axis.x;m=s.x*this.m_perp.y+s.y*this.m_axis.y;v=s.x*this.m_s1+s.y*this.m_a1;s=s.x*this.m_s2+s.y*this.m_a2;e.x-=this.m_invMassA*t;e.y-=this.m_invMassA*m;f-=this.m_invIA*
v;c.x+=this.m_invMassB*t;c.y+=this.m_invMassB*m;g+=this.m_invIB*s;a.m_sweep.a=f;b.m_sweep.a=g;a.synchronizeTransform();b.synchronizeTransform();return q<=d.common.B2Settings.b2_linearSlop&&r<=d.common.B2Settings.b2_angularSlop},__class__:d.dynamics.joints.B2LineJoint});d.dynamics.joints.B2LineJointDef=function(){d.dynamics.joints.B2JointDef.call(this)};d.dynamics.joints.B2LineJointDef.__name__=["box2D","dynamics","joints","B2LineJointDef"];d.dynamics.joints.B2LineJointDef.__super__=d.dynamics.joints.B2JointDef;
d.dynamics.joints.B2LineJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{b2LineJointDef:function(){this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=new d.common.math.B2Vec2;this.localAxisA=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.LINE_JOINT;this.localAxisA.set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0},initialize:function(a,b,e,f){this.bodyA=a;this.bodyB=b;this.localAnchorA=
this.bodyA.getLocalPoint(e);this.localAnchorB=this.bodyB.getLocalPoint(e);this.localAxisA=this.bodyA.getLocalVector(f)},__class__:d.dynamics.joints.B2LineJointDef});d.dynamics.joints.B2MouseJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.K=new d.common.math.B2Mat22;this.K1=new d.common.math.B2Mat22;this.K2=new d.common.math.B2Mat22;this.m_localAnchor=new d.common.math.B2Vec2;this.m_target=new d.common.math.B2Vec2;this.m_impulse=new d.common.math.B2Vec2;this.m_mass=new d.common.math.B2Mat22;
this.m_C=new d.common.math.B2Vec2;this.m_target.setV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,e=this.m_target.y-this.m_bodyB.m_xf.position.y,f=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*f.col1.x+e*f.col1.y;this.m_localAnchor.y=b*f.col2.x+e*f.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.setZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};d.dynamics.joints.B2MouseJoint.__name__=["box2D","dynamics","joints","B2MouseJoint"];
d.dynamics.joints.B2MouseJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2MouseJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_target},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},getReactionTorque:function(a){return 0},getTarget:function(){return this.m_target},setTarget:function(a){!1==this.m_bodyB.isAwake()&&
this.m_bodyB.setAwake(!0);this.m_target=a},getMaxForce:function(){return this.m_maxForce},setMaxForce:function(a){this.m_maxForce=a},getFrequency:function(){return this.m_frequencyHz},setFrequency:function(a){this.m_frequencyHz=a},getDampingRatio:function(){return this.m_dampingRatio},setDampingRatio:function(a){this.m_dampingRatio=a},initVelocityConstraints:function(a){var b=this.m_bodyB,e=b.getMass(),f=2*Math.PI*this.m_frequencyHz,c=e*f*f;this.m_gamma=a.dt*(2*e*this.m_dampingRatio*f+a.dt*c);this.m_gamma=
0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=a.dt*c*this.m_gamma;var c=b.m_xf.R,e=this.m_localAnchor.x-b.m_sweep.localCenter.x,f=this.m_localAnchor.y-b.m_sweep.localCenter.y,d=c.col1.x*e+c.col2.x*f,f=c.col1.y*e+c.col2.y*f,e=d,c=b.m_invMass,d=b.m_invI;this.K1.col1.x=c;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=c;this.K2.col1.x=d*f*f;this.K2.col2.x=-d*e*f;this.K2.col1.y=-d*e*f;this.K2.col2.y=d*e*e;this.K.setM(this.K1);this.K.addM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;
this.K.getInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+e-this.m_target.x;this.m_C.y=b.m_sweep.c.y+f-this.m_target.y;b.m_angularVelocity*=0.98;this.m_impulse.x*=a.dtRatio;this.m_impulse.y*=a.dtRatio;b.m_linearVelocity.x+=c*this.m_impulse.x;b.m_linearVelocity.y+=c*this.m_impulse.y;b.m_angularVelocity+=d*(e*this.m_impulse.y-f*this.m_impulse.x)},solveVelocityConstraints:function(a){var b=this.m_bodyB,e,f,c;e=b.m_xf.R;var d=this.m_localAnchor.x-b.m_sweep.localCenter.x,h=this.m_localAnchor.y-b.m_sweep.localCenter.y;
f=e.col1.x*d+e.col2.x*h;h=e.col1.y*d+e.col2.y*h;d=f;f=b.m_linearVelocity.x+-b.m_angularVelocity*h;var k=b.m_linearVelocity.y+b.m_angularVelocity*d;e=this.m_mass;f=f+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;c=k+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;k=-(e.col1.x*f+e.col2.x*c);c=-(e.col1.y*f+e.col2.y*c);e=this.m_impulse.x;f=this.m_impulse.y;this.m_impulse.x+=k;this.m_impulse.y+=c;a=a.dt*this.m_maxForce;this.m_impulse.lengthSquared()>a*a&&this.m_impulse.multiply(a/this.m_impulse.length());
k=this.m_impulse.x-e;c=this.m_impulse.y-f;b.m_linearVelocity.x+=b.m_invMass*k;b.m_linearVelocity.y+=b.m_invMass*c;b.m_angularVelocity+=b.m_invI*(d*c-h*k)},solvePositionConstraints:function(a){return!0},__class__:d.dynamics.joints.B2MouseJoint});d.dynamics.joints.B2MouseJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.target=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.MOUSE_JOINT;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};d.dynamics.joints.B2MouseJointDef.__name__=
["box2D","dynamics","joints","B2MouseJointDef"];d.dynamics.joints.B2MouseJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2MouseJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{__class__:d.dynamics.joints.B2MouseJointDef});d.dynamics.joints.B2PrismaticJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.m_localAnchor1=new d.common.math.B2Vec2;this.m_localAnchor2=new d.common.math.B2Vec2;this.m_localXAxis1=new d.common.math.B2Vec2;this.m_localYAxis1=new d.common.math.B2Vec2;
this.m_axis=new d.common.math.B2Vec2;this.m_perp=new d.common.math.B2Vec2;this.m_K=new d.common.math.B2Mat33;this.m_impulse=new d.common.math.B2Vec3;this.m_localAnchor1.setV(a.localAnchorA);this.m_localAnchor2.setV(a.localAnchorB);this.m_localXAxis1.setV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;this.m_impulse.setZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=
a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT;this.m_axis.setZero();this.m_perp.setZero()};d.dynamics.joints.B2PrismaticJoint.__name__=["box2D","dynamics","joints","B2PrismaticJoint"];d.dynamics.joints.B2PrismaticJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2PrismaticJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,
{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},getReactionTorque:function(a){return a*this.m_impulse.y},getJointTranslation:function(){var a=this.m_bodyA,
b=this.m_bodyB,e=a.getWorldPoint(this.m_localAnchor1),f=b.getWorldPoint(this.m_localAnchor2),b=f.x-e.x,e=f.y-e.y,a=a.getWorldVector(this.m_localXAxis1);return a.x*b+a.y*e},getJointSpeed:function(){var a=this.m_bodyA,b=this.m_bodyB,e;e=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,c=this.m_localAnchor1.y-a.m_sweep.localCenter.y,d=e.col1.x*f+e.col2.x*c,c=e.col1.y*f+e.col2.y*c,f=d;e=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,k=this.m_localAnchor2.y-b.m_sweep.localCenter.y,
d=e.col1.x*h+e.col2.x*k,k=e.col1.y*h+e.col2.y*k,h=d;e=b.m_sweep.c.x+h-(a.m_sweep.c.x+f);var d=b.m_sweep.c.y+k-(a.m_sweep.c.y+c),m=a.getWorldVector(this.m_localXAxis1),p=a.m_linearVelocity,u=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return e*-a*m.y+d*a*m.x+(m.x*(u.x+-b*k-p.x- -a*c)+m.y*(u.y+b*h-p.y-a*f))},isLimitEnabled:function(){return this.m_enableLimit},enableLimit:function(a){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_enableLimit=a},getLowerLimit:function(){return this.m_lowerTranslation},
getUpperLimit:function(){return this.m_upperTranslation},setLimits:function(a,b){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b},isMotorEnabled:function(){return this.m_enableMotor},enableMotor:function(a){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_enableMotor=a},setMotorSpeed:function(a){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);this.m_motorSpeed=a},getMotorSpeed:function(){return this.m_motorSpeed},setMaxMotorForce:function(a){this.m_bodyA.setAwake(!0);
this.m_bodyB.setAwake(!0);this.m_maxMotorForce=a},getMotorForce:function(){return this.m_motorImpulse},initVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f,c;this.m_localCenterA.setV(b.getLocalCenter());this.m_localCenterB.setV(e.getLocalCenter());var g=b.getTransform();e.getTransform();f=b.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x,k=this.m_localAnchor1.y-this.m_localCenterA.y;c=f.col1.x*h+f.col2.x*k;k=f.col1.y*h+f.col2.y*k;h=c;f=e.m_xf.R;var m=this.m_localAnchor2.x-
this.m_localCenterB.x,p=this.m_localAnchor2.y-this.m_localCenterB.y;c=f.col1.x*m+f.col2.x*p;p=f.col1.y*m+f.col2.y*p;m=c;f=e.m_sweep.c.x+m-b.m_sweep.c.x-h;c=e.m_sweep.c.y+p-b.m_sweep.c.y-k;this.m_invMassA=b.m_invMass;this.m_invMassB=e.m_invMass;this.m_invIA=b.m_invI;this.m_invIB=e.m_invI;this.m_axis.setV(d.common.math.B2Math.mulMV(g.R,this.m_localXAxis1));this.m_a1=(f+h)*this.m_axis.y-(c+k)*this.m_axis.x;this.m_a2=m*this.m_axis.y-p*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*
this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.setV(d.common.math.B2Math.mulMV(g.R,this.m_localYAxis1));this.m_s1=(f+h)*this.m_perp.y-(c+k)*this.m_perp.x;this.m_s2=m*this.m_perp.y-p*this.m_perp.x;g=this.m_invMassA;h=this.m_invMassB;k=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=g+h+k*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=k*this.m_s1+m*this.m_s2;this.m_K.col1.z=k*this.m_s1*this.m_a1+m*this.m_s2*
this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=k+m;this.m_K.col2.z=k*this.m_a1+m*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=g+h+k*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(f=this.m_axis.x*f+this.m_axis.y*c,d.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*d.common.B2Settings.b2_linearSlop?this.m_limitState=d.dynamics.joints.B2LimitState.EQUAL_LIMITS:f<=this.m_lowerTranslation?this.m_limitState!=
d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT&&(this.m_limitState=d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT,this.m_impulse.z=0):f>=this.m_upperTranslation?this.m_limitState!=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(this.m_limitState=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT,this.m_impulse.z=0):(this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,this.m_impulse.z=0)):this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT;!1==this.m_enableMotor&&(this.m_motorImpulse=
0);a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,f=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,c=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,g=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,b.m_linearVelocity.x-=this.m_invMassA*
a,b.m_linearVelocity.y-=this.m_invMassA*f,b.m_angularVelocity-=this.m_invIA*c,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*f,e.m_angularVelocity+=this.m_invIB*g):(this.m_impulse.setZero(),this.m_motorImpulse=0)},solveVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f=b.m_linearVelocity,c=b.m_angularVelocity,g=e.m_linearVelocity,h=e.m_angularVelocity,k,m,p;this.m_enableMotor&&this.m_limitState!=d.dynamics.joints.B2LimitState.EQUAL_LIMITS&&(p=this.m_motorMass*
(this.m_motorSpeed-(this.m_axis.x*(g.x-f.x)+this.m_axis.y*(g.y-f.y)+this.m_a2*h-this.m_a1*c)),k=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=d.common.math.B2Math.clamp(this.m_motorImpulse+p,-a,a),p=this.m_motorImpulse-k,k=p*this.m_axis.x,a=p*this.m_axis.y,m=p*this.m_a1,p*=this.m_a2,f.x-=this.m_invMassA*k,f.y-=this.m_invMassA*a,c-=this.m_invIA*m,g.x+=this.m_invMassB*k,g.y+=this.m_invMassB*a,h+=this.m_invIB*p);m=this.m_perp.x*(g.x-f.x)+this.m_perp.y*(g.y-f.y)+this.m_s2*h-this.m_s1*
c;a=h-c;this.m_enableLimit&&this.m_limitState!=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT?(p=this.m_axis.x*(g.x-f.x)+this.m_axis.y*(g.y-f.y)+this.m_a2*h-this.m_a1*c,k=this.m_impulse.copy(),p=this.m_K.solve33(new d.common.math.B2Vec3,-m,-a,-p),this.m_impulse.add(p),this.m_limitState==d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT?this.m_impulse.z=d.common.math.B2Math.max(this.m_impulse.z,0):this.m_limitState==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(this.m_impulse.z=d.common.math.B2Math.min(this.m_impulse.z,
0)),m=-m-(this.m_impulse.z-k.z)*this.m_K.col3.x,a=-a-(this.m_impulse.z-k.z)*this.m_K.col3.y,a=this.m_K.solve22(new d.common.math.B2Vec2,m,a),a.x+=k.x,a.y+=k.y,this.m_impulse.x=a.x,this.m_impulse.y=a.y,p.x=this.m_impulse.x-k.x,p.y=this.m_impulse.y-k.y,p.z=this.m_impulse.z-k.z,k=p.x*this.m_perp.x+p.z*this.m_axis.x,a=p.x*this.m_perp.y+p.z*this.m_axis.y,m=p.x*this.m_s1+p.y+p.z*this.m_a1,p=p.x*this.m_s2+p.y+p.z*this.m_a2):(p=this.m_K.solve22(new d.common.math.B2Vec2,-m,-a),this.m_impulse.x+=p.x,this.m_impulse.y+=
p.y,k=p.x*this.m_perp.x,a=p.x*this.m_perp.y,m=p.x*this.m_s1+p.y,p=p.x*this.m_s2+p.y);f.x-=this.m_invMassA*k;f.y-=this.m_invMassA*a;c-=this.m_invIA*m;g.x+=this.m_invMassB*k;g.y+=this.m_invMassB*a;h+=this.m_invIB*p;b.m_linearVelocity.setV(f);b.m_angularVelocity=c;e.m_linearVelocity.setV(g);e.m_angularVelocity=h},solvePositionConstraints:function(a){a=this.m_bodyA;var b=this.m_bodyB,e=a.m_sweep.c,f=a.m_sweep.a,c=b.m_sweep.c,g=b.m_sweep.a,h,k,m,p,u=0,q=0;m=!1;var r=0,s=d.common.math.B2Mat22.fromAngle(f),
t=d.common.math.B2Mat22.fromAngle(g);h=s;var q=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-this.m_localCenterA.y;k=h.col1.x*q+h.col2.x*v;v=h.col1.y*q+h.col2.y*v;q=k;h=t;t=this.m_localAnchor2.x-this.m_localCenterB.x;p=this.m_localAnchor2.y-this.m_localCenterB.y;k=h.col1.x*t+h.col2.x*p;p=h.col1.y*t+h.col2.y*p;t=k;h=c.x+t-e.x-q;k=c.y+p-e.y-v;if(this.m_enableLimit){this.m_axis=d.common.math.B2Math.mulMV(s,this.m_localXAxis1);this.m_a1=(h+q)*this.m_axis.y-(k+v)*this.m_axis.x;this.m_a2=
t*this.m_axis.y-p*this.m_axis.x;var x=this.m_axis.x*h+this.m_axis.y*k;d.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*d.common.B2Settings.b2_linearSlop?(r=d.common.math.B2Math.clamp(x,-d.common.B2Settings.b2_maxLinearCorrection,d.common.B2Settings.b2_maxLinearCorrection),u=d.common.math.B2Math.abs(x),m=!0):x<=this.m_lowerTranslation?(r=d.common.math.B2Math.clamp(x-this.m_lowerTranslation+d.common.B2Settings.b2_linearSlop,-d.common.B2Settings.b2_maxLinearCorrection,0),u=
this.m_lowerTranslation-x,m=!0):x>=this.m_upperTranslation&&(r=d.common.math.B2Math.clamp(x-this.m_upperTranslation+d.common.B2Settings.b2_linearSlop,0,d.common.B2Settings.b2_maxLinearCorrection),u=x-this.m_upperTranslation,m=!0)}this.m_perp=d.common.math.B2Math.mulMV(s,this.m_localYAxis1);this.m_s1=(h+q)*this.m_perp.y-(k+v)*this.m_perp.x;this.m_s2=t*this.m_perp.y-p*this.m_perp.x;s=new d.common.math.B2Vec3;v=this.m_perp.x*h+this.m_perp.y*k;t=g-f-this.m_refAngle;u=d.common.math.B2Math.max(u,d.common.math.B2Math.abs(v));
q=d.common.math.B2Math.abs(t);m?(m=this.m_invMassA,p=this.m_invMassB,h=this.m_invIA,k=this.m_invIB,this.m_K.col1.x=m+p+h*this.m_s1*this.m_s1+k*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1+k*this.m_s2,this.m_K.col1.z=h*this.m_s1*this.m_a1+k*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+k,this.m_K.col2.z=h*this.m_a1+k*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+p+h*this.m_a1*this.m_a1+k*this.m_a2*this.m_a2,this.m_K.solve33(s,
-v,-t,-r)):(m=this.m_invMassA,p=this.m_invMassB,h=this.m_invIA,k=this.m_invIB,r=h*this.m_s1+k*this.m_s2,x=h+k,this.m_K.col1.set(m+p+h*this.m_s1*this.m_s1+k*this.m_s2*this.m_s2,r,0),this.m_K.col2.set(r,x,0),r=this.m_K.solve22(new d.common.math.B2Vec2,-v,-t),s.x=r.x,s.y=r.y,s.z=0);r=s.x*this.m_perp.x+s.z*this.m_axis.x;m=s.x*this.m_perp.y+s.z*this.m_axis.y;v=s.x*this.m_s1+s.y+s.z*this.m_a1;s=s.x*this.m_s2+s.y+s.z*this.m_a2;e.x-=this.m_invMassA*r;e.y-=this.m_invMassA*m;f-=this.m_invIA*v;c.x+=this.m_invMassB*
r;c.y+=this.m_invMassB*m;g+=this.m_invIB*s;a.m_sweep.a=f;b.m_sweep.a=g;a.synchronizeTransform();b.synchronizeTransform();return u<=d.common.B2Settings.b2_linearSlop&&q<=d.common.B2Settings.b2_angularSlop},__class__:d.dynamics.joints.B2PrismaticJoint});d.dynamics.joints.B2PrismaticJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=new d.common.math.B2Vec2;this.localAxisA=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.PRISMATIC_JOINT;
this.localAxisA.set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};d.dynamics.joints.B2PrismaticJointDef.__name__=["box2D","dynamics","joints","B2PrismaticJointDef"];d.dynamics.joints.B2PrismaticJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2PrismaticJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{initialize:function(a,b,e,f){this.bodyA=a;this.bodyB=b;this.localAnchorA=
this.bodyA.getLocalPoint(e);this.localAnchorB=this.bodyB.getLocalPoint(e);this.localAxisA=this.bodyA.getLocalVector(f);this.referenceAngle=this.bodyB.getAngle()-this.bodyA.getAngle()},__class__:d.dynamics.joints.B2PrismaticJointDef});d.dynamics.joints.B2PulleyJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.m_groundAnchor1=new d.common.math.B2Vec2;this.m_groundAnchor2=new d.common.math.B2Vec2;this.m_localAnchor1=new d.common.math.B2Vec2;this.m_localAnchor2=new d.common.math.B2Vec2;this.m_u1=
new d.common.math.B2Vec2;this.m_u2=new d.common.math.B2Vec2;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.setV(a.localAnchorA);this.m_localAnchor2.setV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=
a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=d.common.math.B2Math.min(a.maxLengthA,this.m_constant-this.m_ratio*d.dynamics.joints.B2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=d.common.math.B2Math.min(a.maxLengthB,(this.m_constant-d.dynamics.joints.B2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};d.dynamics.joints.B2PulleyJoint.__name__=["box2D","dynamics","joints","B2PulleyJoint"];d.dynamics.joints.B2PulleyJoint.__super__=d.dynamics.joints.B2Joint;
d.dynamics.joints.B2PulleyJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},getReactionTorque:function(a){return 0},getGroundAnchorA:function(){var a=this.m_ground.m_xf.position.copy();a.add(this.m_groundAnchor1);return a},
getGroundAnchorB:function(){var a=this.m_ground.m_xf.position.copy();a.add(this.m_groundAnchor2);return a},getLength1:function(){var a=this.m_bodyA.getWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)},getLength2:function(){var a=this.m_bodyB.getWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)},getRatio:function(){return this.m_ratio},initVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f;f=b.m_xf.R;var c=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=f.col1.x*c+f.col2.x*g,g=f.col1.y*c+f.col2.y*g,c=h;f=e.m_xf.R;var k=this.m_localAnchor2.x-e.m_sweep.localCenter.x,m=this.m_localAnchor2.y-e.m_sweep.localCenter.y,h=f.col1.x*k+f.col2.x*m,m=f.col1.y*k+f.col2.y*m,k=h;f=e.m_sweep.c.x+
k;var h=e.m_sweep.c.y+m,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.set(b.m_sweep.c.x+c-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),b.m_sweep.c.y+g-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.set(f-p,h-u);f=this.m_u1.length();h=this.m_u2.length();f>d.common.B2Settings.b2_linearSlop?this.m_u1.multiply(1/f):this.m_u1.setZero();h>d.common.B2Settings.b2_linearSlop?this.m_u2.multiply(1/h):this.m_u2.setZero();
0<this.m_constant-f-this.m_ratio*h?(this.m_state=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,this.m_impulse=0):this.m_state=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT;f<this.m_maxLength1?(this.m_limitState1=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,this.m_limitImpulse1=0):this.m_limitState1=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT;h<this.m_maxLength2?(this.m_limitState2=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,this.m_limitImpulse2=0):this.m_limitState2=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT;
f=c*this.m_u1.y-g*this.m_u1.x;h=k*this.m_u2.y-m*this.m_u2.x;this.m_limitMass1=b.m_invMass+b.m_invI*f*f;this.m_limitMass2=e.m_invMass+e.m_invI*h*h;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,f=
(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,h=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,p=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*a,b.m_linearVelocity.y+=b.m_invMass*f,b.m_angularVelocity+=b.m_invI*(c*f-g*a),e.m_linearVelocity.x+=e.m_invMass*h,e.m_linearVelocity.y+=e.m_invMass*p,e.m_angularVelocity+=e.m_invI*(k*p-m*h)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},solveVelocityConstraints:function(a){a=
this.m_bodyA;var b=this.m_bodyB,e;e=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,c=this.m_localAnchor1.y-a.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*c,c=e.col1.y*f+e.col2.y*c,f=g;e=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,k=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=e.col1.x*h+e.col2.x*k,k=e.col1.y*h+e.col2.y*k,h=g,m,p;this.m_state==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(e=a.m_linearVelocity.x+-a.m_angularVelocity*c,g=a.m_linearVelocity.y+a.m_angularVelocity*
f,m=b.m_linearVelocity.x+-b.m_angularVelocity*k,p=b.m_linearVelocity.y+b.m_angularVelocity*h,e=-(this.m_u1.x*e+this.m_u1.y*g)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*p),p=this.m_pulleyMass*-e,e=this.m_impulse,this.m_impulse=d.common.math.B2Math.max(0,this.m_impulse+p),p=this.m_impulse-e,e=-p*this.m_u1.x,g=-p*this.m_u1.y,m=-this.m_ratio*p*this.m_u2.x,p=-this.m_ratio*p*this.m_u2.y,a.m_linearVelocity.x+=a.m_invMass*e,a.m_linearVelocity.y+=a.m_invMass*g,a.m_angularVelocity+=a.m_invI*(f*g-c*e),b.m_linearVelocity.x+=
b.m_invMass*m,b.m_linearVelocity.y+=b.m_invMass*p,b.m_angularVelocity+=b.m_invI*(h*p-k*m));this.m_limitState1==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(e=a.m_linearVelocity.x+-a.m_angularVelocity*c,g=a.m_linearVelocity.y+a.m_angularVelocity*f,e=-(this.m_u1.x*e+this.m_u1.y*g),p=-this.m_limitMass1*e,e=this.m_limitImpulse1,this.m_limitImpulse1=d.common.math.B2Math.max(0,this.m_limitImpulse1+p),p=this.m_limitImpulse1-e,e=-p*this.m_u1.x,g=-p*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*e,a.m_linearVelocity.y+=
a.m_invMass*g,a.m_angularVelocity+=a.m_invI*(f*g-c*e));this.m_limitState2==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(m=b.m_linearVelocity.x+-b.m_angularVelocity*k,p=b.m_linearVelocity.y+b.m_angularVelocity*h,e=-(this.m_u2.x*m+this.m_u2.y*p),p=-this.m_limitMass2*e,e=this.m_limitImpulse2,this.m_limitImpulse2=d.common.math.B2Math.max(0,this.m_limitImpulse2+p),p=this.m_limitImpulse2-e,m=-p*this.m_u2.x,p=-p*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*m,b.m_linearVelocity.y+=b.m_invMass*p,b.m_angularVelocity+=
b.m_invI*(h*p-k*m))},solvePositionConstraints:function(a){a=this.m_bodyA;var b=this.m_bodyB,e,f=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,g=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,k,m,p,u,q,r,s,t=0;this.m_state==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(e=a.m_xf.R,k=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,
q=e.col1.x*k+e.col2.x*m,m=e.col1.y*k+e.col2.y*m,k=q,e=b.m_xf.R,p=this.m_localAnchor2.x-b.m_sweep.localCenter.x,u=this.m_localAnchor2.y-b.m_sweep.localCenter.y,q=e.col1.x*p+e.col2.x*u,u=e.col1.y*p+e.col2.y*u,p=q,e=a.m_sweep.c.x+k,q=a.m_sweep.c.y+m,r=b.m_sweep.c.x+p,s=b.m_sweep.c.y+u,this.m_u1.set(e-f,q-c),this.m_u2.set(r-g,s-h),e=this.m_u1.length(),q=this.m_u2.length(),e>d.common.B2Settings.b2_linearSlop?this.m_u1.multiply(1/e):this.m_u1.setZero(),q>d.common.B2Settings.b2_linearSlop?this.m_u2.multiply(1/
q):this.m_u2.setZero(),e=this.m_constant-e-this.m_ratio*q,t=d.common.math.B2Math.max(t,-e),e=d.common.math.B2Math.clamp(e+d.common.B2Settings.b2_linearSlop,-d.common.B2Settings.b2_maxLinearCorrection,0),s=-this.m_pulleyMass*e,e=-s*this.m_u1.x,q=-s*this.m_u1.y,r=-this.m_ratio*s*this.m_u2.x,s=-this.m_ratio*s*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*e,a.m_sweep.c.y+=a.m_invMass*q,a.m_sweep.a+=a.m_invI*(k*q-m*e),b.m_sweep.c.x+=b.m_invMass*r,b.m_sweep.c.y+=b.m_invMass*s,b.m_sweep.a+=b.m_invI*(p*s-u*r),a.synchronizeTransform(),
b.synchronizeTransform());this.m_limitState1==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(e=a.m_xf.R,k=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,q=e.col1.x*k+e.col2.x*m,m=e.col1.y*k+e.col2.y*m,k=q,e=a.m_sweep.c.x+k,q=a.m_sweep.c.y+m,this.m_u1.set(e-f,q-c),e=this.m_u1.length(),e>d.common.B2Settings.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.setZero(),e=this.m_maxLength1-e,t=d.common.math.B2Math.max(t,-e),e=d.common.math.B2Math.clamp(e+
d.common.B2Settings.b2_linearSlop,-d.common.B2Settings.b2_maxLinearCorrection,0),s=-this.m_limitMass1*e,e=-s*this.m_u1.x,q=-s*this.m_u1.y,a.m_sweep.c.x+=a.m_invMass*e,a.m_sweep.c.y+=a.m_invMass*q,a.m_sweep.a+=a.m_invI*(k*q-m*e),a.synchronizeTransform());this.m_limitState2==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(e=b.m_xf.R,p=this.m_localAnchor2.x-b.m_sweep.localCenter.x,u=this.m_localAnchor2.y-b.m_sweep.localCenter.y,q=e.col1.x*p+e.col2.x*u,u=e.col1.y*p+e.col2.y*u,p=q,r=b.m_sweep.c.x+p,s=
b.m_sweep.c.y+u,this.m_u2.set(r-g,s-h),q=this.m_u2.length(),q>d.common.B2Settings.b2_linearSlop?(this.m_u2.x*=1/q,this.m_u2.y*=1/q):this.m_u2.setZero(),e=this.m_maxLength2-q,t=d.common.math.B2Math.max(t,-e),e=d.common.math.B2Math.clamp(e+d.common.B2Settings.b2_linearSlop,-d.common.B2Settings.b2_maxLinearCorrection,0),s=-this.m_limitMass2*e,r=-s*this.m_u2.x,s=-s*this.m_u2.y,b.m_sweep.c.x+=b.m_invMass*r,b.m_sweep.c.y+=b.m_invMass*s,b.m_sweep.a+=b.m_invI*(p*s-u*r),b.synchronizeTransform());return t<
d.common.B2Settings.b2_linearSlop},__class__:d.dynamics.joints.B2PulleyJoint});d.dynamics.joints.B2PulleyJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.groundAnchorA=new d.common.math.B2Vec2;this.groundAnchorB=new d.common.math.B2Vec2;this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.PULLEY_JOINT;this.groundAnchorA.set(-1,1);this.groundAnchorB.set(1,1);this.localAnchorA.set(-1,0);this.localAnchorB.set(1,
0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};d.dynamics.joints.B2PulleyJointDef.__name__=["box2D","dynamics","joints","B2PulleyJointDef"];d.dynamics.joints.B2PulleyJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2PulleyJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{initialize:function(a,b,e,f,c,g,h){this.bodyA=a;this.bodyB=b;this.groundAnchorA.setV(e);this.groundAnchorB.setV(f);this.localAnchorA=this.bodyA.getLocalPoint(c);
this.localAnchorB=this.bodyB.getLocalPoint(g);a=c.x-e.x;e=c.y-e.y;this.lengthA=Math.sqrt(a*a+e*e);e=g.x-f.x;f=g.y-f.y;this.lengthB=Math.sqrt(e*e+f*f);this.ratio=h;h=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=h-this.ratio*d.dynamics.joints.B2PulleyJoint.b2_minPulleyLength;this.maxLengthB=(h-d.dynamics.joints.B2PulleyJoint.b2_minPulleyLength)/this.ratio},__class__:d.dynamics.joints.B2PulleyJointDef});d.dynamics.joints.B2RevoluteJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.K=
new d.common.math.B2Mat22;this.K1=new d.common.math.B2Mat22;this.K2=new d.common.math.B2Mat22;this.K3=new d.common.math.B2Mat22;this.impulse3=new d.common.math.B2Vec3;this.impulse2=new d.common.math.B2Vec2;this.reduced=new d.common.math.B2Vec2;this.m_localAnchor1=new d.common.math.B2Vec2;this.m_localAnchor2=new d.common.math.B2Vec2;this.m_impulse=new d.common.math.B2Vec3;this.m_mass=new d.common.math.B2Mat33;this.m_localAnchor1.setV(a.localAnchorA);this.m_localAnchor2.setV(a.localAnchorB);this.m_referenceAngle=
a.referenceAngle;this.m_impulse.setZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT};d.dynamics.joints.B2RevoluteJoint.__name__=["box2D","dynamics","joints","B2RevoluteJoint"];d.dynamics.joints.B2RevoluteJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2RevoluteJoint.prototype=
r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(a){return new d.common.math.B2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},getReactionTorque:function(a){return a*this.m_impulse.z},getJointAngle:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},getJointSpeed:function(){return this.m_bodyB.m_angularVelocity-
this.m_bodyA.m_angularVelocity},isLimitEnabled:function(){return this.m_enableLimit},enableLimit:function(a){this.m_enableLimit=a},getLowerLimit:function(){return this.m_lowerAngle},getUpperLimit:function(){return this.m_upperAngle},setLimits:function(a,b){this.m_lowerAngle=a;this.m_upperAngle=b},isMotorEnabled:function(){this.m_bodyA.setAwake(!0);this.m_bodyB.setAwake(!0);return this.m_enableMotor},enableMotor:function(a){this.m_enableMotor=a},setMotorSpeed:function(a){this.m_bodyA.setAwake(!0);
this.m_bodyB.setAwake(!0);this.m_motorSpeed=a},getMotorSpeed:function(){return this.m_motorSpeed},setMaxMotorTorque:function(a){this.m_maxMotorTorque=a},getMotorTorque:function(){return this.m_maxMotorTorque},initVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f,c;f=b.m_xf.R;var g=this.m_localAnchor1.x-b.m_sweep.localCenter.x,h=this.m_localAnchor1.y-b.m_sweep.localCenter.y;c=f.col1.x*g+f.col2.x*h;h=f.col1.y*g+f.col2.y*h;g=c;f=e.m_xf.R;var k=this.m_localAnchor2.x-e.m_sweep.localCenter.x,
m=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=f.col1.x*k+f.col2.x*m;m=f.col1.y*k+f.col2.y*m;k=c;f=b.m_invMass;c=e.m_invMass;var p=b.m_invI,q=e.m_invI;this.m_mass.col1.x=f+c+h*h*p+m*m*q;this.m_mass.col2.x=-h*g*p-m*k*q;this.m_mass.col3.x=-h*p-m*q;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=f+c+g*g*p+k*k*q;this.m_mass.col3.y=g*p+k*q;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+q;this.m_motorMass=1/(p+q);!1==this.m_enableMotor&&(this.m_motorImpulse=
0);if(this.m_enableLimit){var r=e.m_sweep.a-b.m_sweep.a-this.m_referenceAngle;d.common.math.B2Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*d.common.B2Settings.b2_angularSlop?this.m_limitState=d.dynamics.joints.B2LimitState.EQUAL_LIMITS:r<=this.m_lowerAngle?(this.m_limitState!=d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT&&(this.m_impulse.z=0),this.m_limitState=d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT):r>=this.m_upperAngle?(this.m_limitState!=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&
(this.m_impulse.z=0),this.m_limitState=d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT):(this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT,this.m_impulse.z=0)}else this.m_limitState=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,r=this.m_impulse.y,b.m_linearVelocity.x-=f*a,b.m_linearVelocity.y-=f*r,b.m_angularVelocity-=p*(g*r-h*a+this.m_motorImpulse+this.m_impulse.z),
e.m_linearVelocity.x+=c*a,e.m_linearVelocity.y+=c*r,e.m_angularVelocity+=q*(k*r-m*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.setZero(),this.m_motorImpulse=0)},solveVelocityConstraints:function(a){var b=this.m_bodyA,e=this.m_bodyB,f,c,g,h,k,m=b.m_linearVelocity,p=b.m_angularVelocity,q=e.m_linearVelocity,r=e.m_angularVelocity,s=b.m_invMass,t=e.m_invMass,v=b.m_invI,w=e.m_invI;this.m_enableMotor&&this.m_limitState!=d.dynamics.joints.B2LimitState.EQUAL_LIMITS&&(g=this.m_motorMass*-(r-p-this.m_motorSpeed),
h=this.m_motorImpulse,a=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=d.common.math.B2Math.clamp(this.m_motorImpulse+g,-a,a),g=this.m_motorImpulse-h,p-=v*g,r+=w*g);if(this.m_enableLimit&&this.m_limitState!=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT){f=b.m_xf.R;g=this.m_localAnchor1.x-b.m_sweep.localCenter.x;h=this.m_localAnchor1.y-b.m_sweep.localCenter.y;c=f.col1.x*g+f.col2.x*h;h=f.col1.y*g+f.col2.y*h;g=c;f=e.m_xf.R;a=this.m_localAnchor2.x-e.m_sweep.localCenter.x;k=this.m_localAnchor2.y-e.m_sweep.localCenter.y;
c=f.col1.x*a+f.col2.x*k;k=f.col1.y*a+f.col2.y*k;a=c;c=q.x+-r*k-m.x- -p*h;var x=q.y+r*a-m.y-p*g;this.m_mass.solve33(this.impulse3,-c,-x,-(r-p));this.m_limitState==d.dynamics.joints.B2LimitState.EQUAL_LIMITS?this.m_impulse.add(this.impulse3):this.m_limitState==d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT?(f=this.m_impulse.z+this.impulse3.z,0>f&&(this.m_mass.solve22(this.reduced,-c,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=
this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(f=this.m_impulse.z+this.impulse3.z,0<f&&(this.m_mass.solve22(this.reduced,-c,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0));m.x-=s*this.impulse3.x;m.y-=s*this.impulse3.y;p-=v*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z);
q.x+=t*this.impulse3.x;q.y+=t*this.impulse3.y;r+=w*(a*this.impulse3.y-k*this.impulse3.x+this.impulse3.z)}else f=b.m_xf.R,g=this.m_localAnchor1.x-b.m_sweep.localCenter.x,h=this.m_localAnchor1.y-b.m_sweep.localCenter.y,c=f.col1.x*g+f.col2.x*h,h=f.col1.y*g+f.col2.y*h,g=c,f=e.m_xf.R,a=this.m_localAnchor2.x-e.m_sweep.localCenter.x,k=this.m_localAnchor2.y-e.m_sweep.localCenter.y,c=f.col1.x*a+f.col2.x*k,k=f.col1.y*a+f.col2.y*k,a=c,this.m_mass.solve22(this.impulse2,-(q.x+-r*k-m.x- -p*h),-(q.y+r*a-m.y-p*g)),
this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,m.x-=s*this.impulse2.x,m.y-=s*this.impulse2.y,p-=v*(g*this.impulse2.y-h*this.impulse2.x),q.x+=t*this.impulse2.x,q.y+=t*this.impulse2.y,r+=w*(a*this.impulse2.y-k*this.impulse2.x);b.m_linearVelocity.setV(m);b.m_angularVelocity=p;e.m_linearVelocity.setV(q);e.m_angularVelocity=r},solvePositionConstraints:function(a){var b,e;a=this.m_bodyA;var f=this.m_bodyB,c=0;e=0;var g,h,k;if(this.m_enableLimit&&this.m_limitState!=d.dynamics.joints.B2LimitState.INACTIVE_LIMIT){b=
f.m_sweep.a-a.m_sweep.a-this.m_referenceAngle;var m=0;this.m_limitState==d.dynamics.joints.B2LimitState.EQUAL_LIMITS?(b=d.common.math.B2Math.clamp(b-this.m_lowerAngle,-d.common.B2Settings.b2_maxAngularCorrection,d.common.B2Settings.b2_maxAngularCorrection),m=-this.m_motorMass*b,c=d.common.math.B2Math.abs(b)):this.m_limitState==d.dynamics.joints.B2LimitState.AT_LOWER_LIMIT?(b-=this.m_lowerAngle,c=-b,b=d.common.math.B2Math.clamp(b+d.common.B2Settings.b2_angularSlop,-d.common.B2Settings.b2_maxAngularCorrection,
0),m=-this.m_motorMass*b):this.m_limitState==d.dynamics.joints.B2LimitState.AT_UPPER_LIMIT&&(c=b-=this.m_upperAngle,b=d.common.math.B2Math.clamp(b-d.common.B2Settings.b2_angularSlop,0,d.common.B2Settings.b2_maxAngularCorrection),m=-this.m_motorMass*b);a.m_sweep.a-=a.m_invI*m;f.m_sweep.a+=f.m_invI*m;a.synchronizeTransform();f.synchronizeTransform()}e=a.m_xf.R;m=this.m_localAnchor1.x-a.m_sweep.localCenter.x;b=this.m_localAnchor1.y-a.m_sweep.localCenter.y;g=e.col1.x*m+e.col2.x*b;b=e.col1.y*m+e.col2.y*
b;m=g;e=f.m_xf.R;var p=this.m_localAnchor2.x-f.m_sweep.localCenter.x,q=this.m_localAnchor2.y-f.m_sweep.localCenter.y;g=e.col1.x*p+e.col2.x*q;q=e.col1.y*p+e.col2.y*q;p=g;h=f.m_sweep.c.x+p-a.m_sweep.c.x-m;k=f.m_sweep.c.y+q-a.m_sweep.c.y-b;var r=h*h+k*k;e=Math.sqrt(r);g=a.m_invMass;var s=f.m_invMass,t=a.m_invI,v=f.m_invI,w=10*d.common.B2Settings.b2_linearSlop;r>w*w&&(r=1/(g+s),h=r*-h,k=r*-k,a.m_sweep.c.x-=0.5*g*h,a.m_sweep.c.y-=0.5*g*k,f.m_sweep.c.x+=0.5*s*h,f.m_sweep.c.y+=0.5*s*k,h=f.m_sweep.c.x+p-
a.m_sweep.c.x-m,k=f.m_sweep.c.y+q-a.m_sweep.c.y-b);this.K1.col1.x=g+s;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=g+s;this.K2.col1.x=t*b*b;this.K2.col2.x=-t*m*b;this.K2.col1.y=-t*m*b;this.K2.col2.y=t*m*m;this.K3.col1.x=v*q*q;this.K3.col2.x=-v*p*q;this.K3.col1.y=-v*p*q;this.K3.col2.y=v*p*p;this.K.setM(this.K1);this.K.addM(this.K2);this.K.addM(this.K3);this.K.solve(d.dynamics.joints.B2RevoluteJoint.tImpulse,-h,-k);h=d.dynamics.joints.B2RevoluteJoint.tImpulse.x;k=d.dynamics.joints.B2RevoluteJoint.tImpulse.y;
a.m_sweep.c.x-=a.m_invMass*h;a.m_sweep.c.y-=a.m_invMass*k;a.m_sweep.a-=a.m_invI*(m*k-b*h);f.m_sweep.c.x+=f.m_invMass*h;f.m_sweep.c.y+=f.m_invMass*k;f.m_sweep.a+=f.m_invI*(p*k-q*h);a.synchronizeTransform();f.synchronizeTransform();return e<=d.common.B2Settings.b2_linearSlop&&c<=d.common.B2Settings.b2_angularSlop},__class__:d.dynamics.joints.B2RevoluteJoint});d.dynamics.joints.B2RevoluteJointDef=function(){d.dynamics.joints.B2JointDef.call(this);this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=
new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.REVOLUTE_JOINT;this.localAnchorA.set(0,0);this.localAnchorB.set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};d.dynamics.joints.B2RevoluteJointDef.__name__=["box2D","dynamics","joints","B2RevoluteJointDef"];d.dynamics.joints.B2RevoluteJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2RevoluteJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,
{initialize:function(a,b,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.getLocalPoint(e);this.localAnchorB=this.bodyB.getLocalPoint(e);this.referenceAngle=this.bodyB.getAngle()-this.bodyA.getAngle()},__class__:d.dynamics.joints.B2RevoluteJointDef});d.dynamics.joints.B2WeldJoint=function(a){d.dynamics.joints.B2Joint.call(this,a);this.m_localAnchorA=new d.common.math.B2Vec2;this.m_localAnchorB=new d.common.math.B2Vec2;this.m_impulse=new d.common.math.B2Vec3;this.m_mass=new d.common.math.B2Mat33;
this.m_localAnchorA.setV(a.localAnchorA);this.m_localAnchorB.setV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.setZero();this.m_mass=new d.common.math.B2Mat33};d.dynamics.joints.B2WeldJoint.__name__=["box2D","dynamics","joints","B2WeldJoint"];d.dynamics.joints.B2WeldJoint.__super__=d.dynamics.joints.B2Joint;d.dynamics.joints.B2WeldJoint.prototype=r(d.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},
getReactionForce:function(a){return new d.common.math.B2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},getReactionTorque:function(a){return a*this.m_impulse.z},initVelocityConstraints:function(a){var b,e,f=this.m_bodyA,c=this.m_bodyB;b=f.m_xf.R;var d=this.m_localAnchorA.x-f.m_sweep.localCenter.x,h=this.m_localAnchorA.y-f.m_sweep.localCenter.y;e=b.col1.x*d+b.col2.x*h;h=b.col1.y*d+b.col2.y*h;d=e;b=c.m_xf.R;var k=this.m_localAnchorB.x-c.m_sweep.localCenter.x,m=this.m_localAnchorB.y-c.m_sweep.localCenter.y;
e=b.col1.x*k+b.col2.x*m;m=b.col1.y*k+b.col2.y*m;k=e;b=f.m_invMass;e=c.m_invMass;var p=f.m_invI,q=c.m_invI;this.m_mass.col1.x=b+e+h*h*p+m*m*q;this.m_mass.col2.x=-h*d*p-m*k*q;this.m_mass.col3.x=-h*p-m*q;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+e+d*d*p+k*k*q;this.m_mass.col3.y=d*p+k*q;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+q;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,f.m_linearVelocity.x-=
b*this.m_impulse.x,f.m_linearVelocity.y-=b*this.m_impulse.y,f.m_angularVelocity-=p*(d*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z),c.m_linearVelocity.x+=e*this.m_impulse.x,c.m_linearVelocity.y+=e*this.m_impulse.y,c.m_angularVelocity+=q*(k*this.m_impulse.y-m*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.setZero()},solveVelocityConstraints:function(a){var b,e;a=this.m_bodyA;var f=this.m_bodyB,c=a.m_linearVelocity,g=a.m_angularVelocity,h=f.m_linearVelocity,k=f.m_angularVelocity,m=a.m_invMass,
p=f.m_invMass,q=a.m_invI,r=f.m_invI;b=a.m_xf.R;var s=this.m_localAnchorA.x-a.m_sweep.localCenter.x,t=this.m_localAnchorA.y-a.m_sweep.localCenter.y;e=b.col1.x*s+b.col2.x*t;t=b.col1.y*s+b.col2.y*t;s=e;b=f.m_xf.R;var v=this.m_localAnchorB.x-f.m_sweep.localCenter.x,w=this.m_localAnchorB.y-f.m_sweep.localCenter.y;e=b.col1.x*v+b.col2.x*w;w=b.col1.y*v+b.col2.y*w;v=e;b=h.x-k*w-c.x+g*t;e=h.y+k*v-c.y-g*s;var x=k-g,y=new d.common.math.B2Vec3;this.m_mass.solve33(y,-b,-e,-x);this.m_impulse.add(y);c.x-=m*y.x;c.y-=
m*y.y;g-=q*(s*y.y-t*y.x+y.z);h.x+=p*y.x;h.y+=p*y.y;k+=r*(v*y.y-w*y.x+y.z);a.m_angularVelocity=g;f.m_angularVelocity=k},solvePositionConstraints:function(a){var b,e;a=this.m_bodyA;var f=this.m_bodyB;b=a.m_xf.R;var c=this.m_localAnchorA.x-a.m_sweep.localCenter.x,g=this.m_localAnchorA.y-a.m_sweep.localCenter.y;e=b.col1.x*c+b.col2.x*g;g=b.col1.y*c+b.col2.y*g;c=e;b=f.m_xf.R;var h=this.m_localAnchorB.x-f.m_sweep.localCenter.x,k=this.m_localAnchorB.y-f.m_sweep.localCenter.y;e=b.col1.x*h+b.col2.x*k;k=b.col1.y*
h+b.col2.y*k;h=e;b=a.m_invMass;e=f.m_invMass;var m=a.m_invI,p=f.m_invI,q=f.m_sweep.c.x+h-a.m_sweep.c.x-c,r=f.m_sweep.c.y+k-a.m_sweep.c.y-g,s=f.m_sweep.a-a.m_sweep.a-this.m_referenceAngle,t=10*d.common.B2Settings.b2_linearSlop,v=Math.sqrt(q*q+r*r),w=d.common.math.B2Math.abs(s);v>t&&(m*=1,p*=1);this.m_mass.col1.x=b+e+g*g*m+k*k*p;this.m_mass.col2.x=-g*c*m-k*h*p;this.m_mass.col3.x=-g*m-k*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+e+c*c*m+h*h*p;this.m_mass.col3.y=c*m+h*p;this.m_mass.col1.z=
this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+p;t=new d.common.math.B2Vec3;this.m_mass.solve33(t,-q,-r,-s);a.m_sweep.c.x-=b*t.x;a.m_sweep.c.y-=b*t.y;a.m_sweep.a-=m*(c*t.y-g*t.x+t.z);f.m_sweep.c.x+=e*t.x;f.m_sweep.c.y+=e*t.y;f.m_sweep.a+=p*(h*t.y-k*t.x+t.z);a.synchronizeTransform();f.synchronizeTransform();return v<=d.common.B2Settings.b2_linearSlop&&w<=d.common.B2Settings.b2_angularSlop},__class__:d.dynamics.joints.B2WeldJoint});d.dynamics.joints.B2WeldJointDef=function(){d.dynamics.joints.B2JointDef.call(this);
this.localAnchorA=new d.common.math.B2Vec2;this.localAnchorB=new d.common.math.B2Vec2;this.type=d.dynamics.joints.B2JointType.WELD_JOINT;this.referenceAngle=0};d.dynamics.joints.B2WeldJointDef.__name__=["box2D","dynamics","joints","B2WeldJointDef"];d.dynamics.joints.B2WeldJointDef.__super__=d.dynamics.joints.B2JointDef;d.dynamics.joints.B2WeldJointDef.prototype=r(d.dynamics.joints.B2JointDef.prototype,{initialize:function(a,b,e){this.bodyA=a;this.bodyB=b;this.localAnchorA.setV(this.bodyA.getLocalPoint(e));
this.localAnchorB.setV(this.bodyB.getLocalPoint(e));this.referenceAngle=this.bodyB.getAngle()-this.bodyA.getAngle()},__class__:d.dynamics.joints.B2WeldJointDef});var b={AssetType:{__ename__:!0,__constructs__:["Image","Audio","Other","Javascript","Css"]}};b.AssetType.Image=["Image",0];b.AssetType.Image.toString=D;b.AssetType.Image.__enum__=b.AssetType;b.AssetType.Audio=["Audio",1];b.AssetType.Audio.toString=D;b.AssetType.Audio.__enum__=b.AssetType;b.AssetType.Other=["Other",2];b.AssetType.Other.toString=
D;b.AssetType.Other.__enum__=b.AssetType;b.AssetType.Javascript=["Javascript",3];b.AssetType.Javascript.toString=D;b.AssetType.Javascript.__enum__=b.AssetType;b.AssetType.Css=["Css",4];b.AssetType.Css.toString=D;b.AssetType.Css.__enum__=b.AssetType;b.AssetType.__empty_constructs__=[b.AssetType.Image,b.AssetType.Audio,b.AssetType.Other,b.AssetType.Javascript,b.AssetType.Css];b.AssetLoadingInfo=function(a,b,e,f,c){null==f&&(f=!1);this.isAbsolute=!1;this.asset=null;this.name=a;this.type=e;this.source=
b;this.isAbsolute=f;this.options=c};b.AssetLoadingInfo.__name__=["f84","AssetLoadingInfo"];b.AssetLoadingInfo.prototype={__class__:b.AssetLoadingInfo};b.events={};b.events.EventDispatcher=function(){this._eventListeners=[]};b.events.EventDispatcher.__name__=["f84","events","EventDispatcher"];b.events.EventDispatcher.prototype={addEventListener:function(a,l){this.hasEventListener(a,l)||this._eventListeners.push(new b.events.EventListener(a,l))},hasEventListener:function(a,b){for(var e=this._eventListeners.length-
1;0<=e;){if(this._eventListeners[e].eventName==a&&H.compareMethods(this._eventListeners[e].action,b))return!0;e--}return!1},dispatchEvent:function(a){a.target=this;for(var b=this._eventListeners.length-1;0<=b;){var e=this._eventListeners[b];e.eventName==a.getName()&&e.action(a);b--}},removeAllEventListeners:function(){this._eventListeners=[]},removeEventListener:function(a,b){if(this.hasEventListener(a,b))for(var e=this._eventListeners.length-1;0<=e;){var f=this._eventListeners[e];if(f.eventName==
a&&H.compareMethods(f.action,b)){this._eventListeners.splice(e,1);break}e--}},__class__:b.events.EventDispatcher};b.GameObject=function(){this._instanceId=0;this._isActive=this._isUpdating=!0;this._isInitialized=this._isMarkedForDeletion=!1;b.events.EventDispatcher.call(this);this._instanceId=b.GameObject._currentInstanceId++;this._properties=new w.ds.StringMap;this._tags=[]};b.GameObject.__name__=["f84","GameObject"];b.GameObject.__super__=b.events.EventDispatcher;b.GameObject.prototype=r(b.events.EventDispatcher.prototype,
{init:function(){this._isInitialized=!0;this.dispatchEvent(new b.events.GameObjectEvent("initialize"))},update:function(){this._isInitialized&&this._isActive||(this.init(),this._isActive&&this.activate())},fixedUpdate:function(){},postUpdate:function(){},render:function(){},activate:function(){this._isActive=!0;this.onActivated()},deactivate:function(){this._isActive=!1;this.onDeactivated()},onActivated:function(){this.dispatchEvent(new b.events.GameObjectEvent("activate"))},onDeactivated:function(){this.dispatchEvent(new b.events.GameObjectEvent("deactivate"))},
debugRender:function(){},handleMessage:function(a,b){},setProperty:function(a,b){this._properties.set(a,b)},getProperty:function(a){return this._properties.get(a)},hasProperty:function(a){return this._properties.exists(a)},getIsMarkedForDeletion:function(){return this._isMarkedForDeletion},addTag:function(a){this._tags.push(a)},removeTag:function(a){for(var b=this._tags.length,e=0;e<b;){var f=e++;this._tags[f]==a&&this._tags.splice(f,1)}},hasTag:function(a){for(var b=this._tags.length,e=0;e<b;){var f=
e++;if(this._tags[f]==a)return!0}return!1},getTags:function(){return this._tags},getName:function(){return this._name},setName:function(a){this._name=a},getInstanceId:function(){return this._instanceId},getIsActive:function(){return this._isActive},setIsActive:function(a){this._isInitialized||this.init();!this._isActive&&a&&this.activate();this._isActive&&!a&&this.deactivate();this._isActive=a},setIsUpdating:function(a){this._isUpdating=a},getIsUpdating:function(){return this._isUpdating},destroy:function(){this.setIsActive(!1);
this._isMarkedForDeletion=!0},onDestroyed:function(){this.dispatchEvent(new b.events.GameObjectEvent("destroy"))},__class__:b.GameObject});b.Component=function(a){b.GameObject.call(this);a.addComponent(this);this.setName(G.getClassName(G.getClass(this)))};b.Component.__name__=["f84","Component"];b.Component.__super__=b.GameObject;b.Component.prototype=r(b.GameObject.prototype,{getEntity:function(){return this._entity},setEntity:function(a){this._entity=a},getSiblingComponent:function(a){return this.getEntity().getComponent(a)},
getGameState:function(){return this.getEntity().getGameState()},destroy:function(){b.GameObject.prototype.destroy.call(this)},onDestroyed:function(){b.GameObject.prototype.onDestroyed.call(this)},__class__:b.Component});b.Entity=function(a){this._isZSorted=!1;this._isVisible=!0;this._parent=null;b.GameObject.call(this);this._position=new b.Vector3D;this._rotation=new b.Vector3D;this._scale=new b.Vector3D(1,1,1);this._components=[];this._children=[]};b.Entity.__name__=["f84","Entity"];b.Entity.__super__=
b.GameObject;b.Entity.prototype=r(b.GameObject.prototype,{init:function(){b.GameObject.prototype.init.call(this);for(var a=this._components.length,l=0;l<a;){var e=l++,e=this._components[e];e.getIsActive()&&e.init()}},getIsZSorted:function(){return this._isZSorted},setIsZSorted:function(a){this._isZSorted=a},getGameState:function(){return this._gameState},setGameState:function(a){this._gameState=a},hasChild:function(a){for(var b=this._children.length,e=0;e<b;){var f=e++;if(this._children[f]==a)return!0}return!1},
removeChild:function(a){for(var b=this._children.length,e=0;e<b;){var f=e++,c=this._children[f];if(c==a){c.setParent(null);this._children.splice(f,1);break}}},addChild:function(a){a==this&&b.utilities.Debug.log("Cannot parent an Entity to itself.");null!=a.getParent()&&a.getParent().removeChild(a);this._children.push(a);a.setParent(this)},childIndexOf:function(a){for(var b=this._children.length,e=0;e<b;){var c=e++;if(this._children[c]==a)return c}return-1},insertChild:function(a,l){a==this&&b.utilities.Debug.log("Cannot parent an Entity to itself.");
null!=a.getParent()&&a.getParent().removeChild(a);this._children.splice(l,0,a);a.setParent(this)},destroyAllChildren:function(){for(var a=this._children.length,b=0;b<a;){var e=b++;this._children[e].destroy()}this._children=[]},getParent:function(){return this._parent},getRootEntity:function(){return null!=this.getParent()?this.getParent():this},setParent:function(a){this._parent=a;null!=this.getParent()?this.dispatchEvent(new b.events.EntityEvent("addedToParent",{parent:this.getParent()})):this.dispatchEvent(new b.events.EntityEvent("removedFromParent"));
this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getPosition:function(){var a=this._position.getClone();if(null!=this._parent){var l=this._parent.getPosition(),e=this._parent.getScale(),c=this._parent.getRotation(),d=Math.sin(b.utilities.Math2.degToRad(c.z)),c=Math.cos(b.utilities.Math2.degToRad(c.z)),g=a.x*d+a.y*c;a.x=(a.x*c-a.y*d)*e.x+l.x;a.y=g*e.y+l.y;a.z+=l.z}return a},setIsActive:function(a){b.GameObject.prototype.setIsActive.call(this,a);for(var l=this._components.length,e=0;e<
l;){var c=e++;this._components[c].setIsActive(a)}l=this._children.length;for(e=0;e<l;)c=e++,this._children[c].setIsActive(a)},getIsActive:function(){return this._isActive},getChildren:function(a){null==a&&(a=!1);if(!a)return this._children;a=this._children;for(var b=[].concat(a),e=0,c=b.length;e<c;){var d=e++;a=a.concat(b[d].getChildren(!0))}return a},findChildByName:function(a){for(var b=this._children.length,e=0;e<b;){var c=e++,c=this._children[c];if(c.getName()==a)return c;c=c.findChildByName(a);
if(null!=c)return c}return null},getIsVisible:function(){return null!=this._parent?this._parent.getIsVisible()&&this._isVisible:this._isVisible},activate:function(){b.GameObject.prototype.activate.call(this);for(var a=this._children.length,l=0;l<a;){var e=l++;this._children[e].activate()}this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},deactivate:function(){b.GameObject.prototype.deactivate.call(this);for(var a=this._children.length,l=0;l<a;){var e=l++;this._children[e].deactivate()}this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},
setIsVisible:function(a){(this._isVisible=a)?this.dispatchEvent(new b.events.EntityEvent("visibilityOn")):this.dispatchEvent(new b.events.EntityEvent("visibilityOff"));this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getLocalPosition:function(){return this._position.getClone()},getPositionRef:function(){return this._position},setPosition:function(a,l,e){null==e&&(e=0);null==l&&(l=0);null==a&&(a=0);this._position=new b.Vector3D(a,l,e);this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},
translate:function(a,l,e){null==e&&(e=0);null==l&&(l=0);null==a&&(a=0);this._position.x+=a;this._position.y+=l;this._position.z+=e;this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},getRotationRef:function(){return this._rotation},getLocalRotation:function(){return this._rotation.getClone()},getRotation:function(){var a=this._rotation.getClone();if(null!=this._parent){var b=this._parent.getRotation();a.x+=b.x;a.y+=b.y;a.z+=b.z}return a},setRotation:function(a,l,e){null==e&&(e=0);null==
l&&(l=0);null==a&&(a=0);this._rotation.x=a;this._rotation.y=l;this._rotation.z=e;this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},setRotation2d:function(a){null==a&&(a=0);this._rotation.z=a},rotate:function(a,b,e){this._rotation.x+=a;this._rotation.y+=b;this._rotation.z+=e},rotate2d:function(a){this._rotation.z+=a},getScaleRef:function(){return this._scale},getScale:function(){var a=this._scale.getClone();if(null!=this._parent){var b=this._parent.getScale();a.x*=b.x;a.y*=b.y;a.z*=b.z}return a},
setScale:function(a,l,e){null==e&&(e=1);null==l&&(l=1);null==a&&(a=1);this._scale=new b.Vector3D(a,l,e);this.dispatchEvent(new b.events.EntityEvent("displayUpdate"))},update:function(){b.GameObject.prototype.update.call(this);for(var a=this._components.length;0<a--;){var l=this._components[a];l.getIsMarkedForDeletion()&&(l.onDestroyed(),this._components.splice(a,1))}a=this._components.length;for(l=0;l<a;){var e=l++,e=this._components[e];e.getIsActive()&&e.getIsUpdating()&&e.update()}},fixedUpdate:function(){b.GameObject.prototype.fixedUpdate.call(this);
for(var a=this._components.length,l=0;l<a;){var e=l++,e=this._components[e];e.getIsActive()&&e.fixedUpdate()}},render:function(){b.GameObject.prototype.render.call(this);for(var a=this._components.length,l=0;l<a;){var e=l++,e=this._components[e];e.getIsActive()&&e.render()}},postUpdate:function(){b.GameObject.prototype.postUpdate.call(this);for(var a=this._components.length,l=0;l<a;){var e=l++,e=this._components[e];e.getIsActive()&&e.getIsUpdating()&&e.postUpdate()}},debugRender:function(){b.GameObject.prototype.debugRender.call(this);
for(var a=this._components.length,l=0;l<a;){var e=l++,e=this._components[e];e.getIsActive()&&e.debugRender()}a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var l=b.components.Camera.getDebugCamera().getEntity(),e=b.components.Camera.getDebugCamera().getZoomScale(),c=b.components.Camera.getDebugCamera().getSiblingComponent(b.pixi.PixiCamera);a.translate(-l.getPosition().x*e+c.getContainerOffset().x,-l.getPosition().y*
e+c.getContainerOffset().y);a.scale(e,e)}a.beginPath();a.globalAlpha=0.65;a.lineWidth=1;a.strokeStyle="#44FF44";a.moveTo(this.getPosition().x,this.getPosition().y-10);a.lineTo(this.getPosition().x,this.getPosition().y+10);a.moveTo(this.getPosition().x-10,this.getPosition().y);a.lineTo(this.getPosition().x+10,this.getPosition().y);a.moveTo(this.getPosition().x-10,this.getPosition().y-10);a.lineTo(this.getPosition().x+10,this.getPosition().y+10);a.moveTo(this.getPosition().x+10,this.getPosition().y-
10);a.lineTo(this.getPosition().x-10,this.getPosition().y+10);a.stroke();a.restore();b.Root.getInstance().getLayerByName("debug").setWholeCanvasDirty(!0)},addComponent:function(a){for(var b=this._components.length,e=0;e<b;){var c=e++;if(this._components[c]==a)return null}this._components.push(a);a.setEntity(this);return a},getComponentByName:function(a){for(var b=this._components.length,e=0;e<b;){var c=e++;if(this._components[c].getName()==a)return this._components[c]}return null},getComponent:function(a){for(var b=
this._components.length,e=0;e<b;)for(var c=e++,d=G.getClass(this._components[c]);null!=d;){if(d==a)return this._components[c];d=G.getSuperClass(d)}return null},getComponentWithSuperClass:function(a){for(var b=this._components.length,e=0;e<b;){var c=e++;if(G.getSuperClass(G.getClass(this._components[c]))==a)return this._components[c]}return null},getComponentsInChildren:function(a){var b=[],e=this.getComponents(a);null!=e&&(b=b.concat(e));for(var e=this._children.length,c=0;c<e;){var d=c++,d=this._children[d].getComponentsInChildren(a);
null!=d&&(b=b.concat(d))}return b},getComponents:function(a){for(var b=[],e=this._components.length,c=0;c<e;){var d=c++;G.getClass(this._components[d])==a?b.push(this._components[d]):G.getSuperClass(G.getClass(this._components[d]))==a&&b.push(this._components[d])}return 0<b.length?b:null},handleMessage:function(a,b){for(var e=this._components.length-1;0<=e;){var c=this._components[e];c.getIsActive()&&c.handleMessage(a,b);e--}},getIsUpdating:function(){return null!=this._parent?this._isUpdating&&this._parent.getIsUpdating():
this._isUpdating},destroy:function(){b.GameObject.prototype.destroy.call(this);null!=this._gameState&&this._gameState.scheduleEntityForDeletion(this);null!=this.getParent()&&this.getParent().removeChild(this);for(var a=this._components.length;0<a--;){var l=this._components[a];l.destroy();l.onDestroyed()}for(a=this._children.length;0<a--;)l=this._children[a],l.destroy(),l.onDestroyed()},onDestroyed:function(){b.GameObject.prototype.onDestroyed.call(this);this._gameState=null},__class__:b.Entity});
b.GameConfig=function(){};b.GameConfig.__name__=["f84","GameConfig"];b.GameConfig.getProperty=function(a){return b.GameConfig._properties.get(a)};b.GameConfig.getBoolProperty=function(a){a=b.GameConfig.getProperty(a);return"TRUE"==a.toUpperCase()||"1"==a};b.GameConfig.setProperty=function(a,l){var e=t.string(l);b.GameConfig._properties.set(a,e)};b.GameConfig.parseGameConfig=function(a){for(a=B.parse(a).elementsNamed("gameConfig").next().elementsNamed("property");a.hasNext();){var l=a.next(),e=l.get("name"),
l=l.get("value");b.GameConfig._properties.set(e,l)}};b.GameConfig.prototype={__class__:b.GameConfig};b.GameEntity=function(a){null==a&&(a=!1);this._gameImage=this._flashAnimation=this._gameSprite=this._textField=this._deferredActionComponent=this._button=this._collider=this._tweener=this._simpleMovement=this._positionTweens=this._soundChannel=null;b.Entity.call(this,a)};b.GameEntity.__name__=["f84","GameEntity"];b.GameEntity.instantiate=function(a){return a.addEntity(new b.GameEntity)};b.GameEntity.__super__=
b.Entity;b.GameEntity.prototype=r(b.Entity.prototype,{getVelocity:function(){var a=this.getSimpleMovement();null==a&&(this._simpleMovement=new b.components.SimpleMovement(this));return a.getVelocity()},setVelocity:function(a,l,e){var c=this.getSimpleMovement();null==c&&(this._simpleMovement=new b.components.SimpleMovement(this));return c.setVelocity(a,l,e)},getAngularVelocity2d:function(){var a=this.getSimpleMovement();null==a&&(this._simpleMovement=new b.components.SimpleMovement(this));return a.getAngularVelocity().z},
setAngularVelocity2d:function(a){var l=this.getSimpleMovement();null==l&&(this._simpleMovement=new b.components.SimpleMovement(this));return l.setAngularVelocity(new b.Vector3D(0,0,a))},getGameImage:function(){return null!=this._gameImage?this._gameImage:this._gameImage=this.getComponent(b.components.GameImage)},getGameSprite:function(){return null!=this._gameSprite?this._gameSprite:this._gameSprite=this.getComponent(b.components.GameSprite)},getFlashAnimation:function(){return null!=this._flashAnimation?
this._flashAnimation:this._flashAnimation=this.getComponent(b.flashAnimation.FlashAnimation)},getTextField:function(){return null!=this._textField?this._textField:this._textField=this.getComponent(b.components.TextField)},getDeferredActionComponent:function(){return null!=this._deferredActionComponent?this._deferredActionComponent:this._deferredActionComponent=this.getComponent(b.components.DeferredActionComponent)},getButton:function(){return null!=this._button?this._button:this._button=this.getComponent(b.components.Button)},
getCollider:function(){return null!=this._collider?this._collider:this._collider=this.getComponent(b.components.Collider)},getTweener:function(){return null!=this._tweener?this._tweener:this._tweener=this.getComponent(b.components.Tweener)},getSimpleMovement:function(){return null!=this._simpleMovement?this._simpleMovement:this._simpleMovement=this.getComponent(b.components.SimpleMovement)},tweenToPosition:function(a,l,e,c,d,g){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=
[];this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"x",this.getPositionRef().x,a,e,d,c,g));this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"y",this.getPositionRef().y,l,e,d,c))},tweenToRotation:function(a,l,e,c,d){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getRotationRef(),"z",this.getRotationRef().z,a,l,c,e))},tweenToPositionAndRotation:function(a,l,
e,c,d,g,h){null==this._tweener&&(this._tweener=new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"x",this.getPositionRef().x,a,c,g,d,h));this._positionTweens.push(this._tweener.addTween(this.getPositionRef(),"y",this.getPositionRef().y,l,c,g,d));this._positionTweens.push(this._tweener.addTween(this.getRotationRef(),"z",this.getRotationRef().z,e,c,g,d))},tweenToScale:function(a,l,e,c,d,g){null==this._tweener&&(this._tweener=
new b.components.Tweener(this));this._positionTweens=[];this._positionTweens.push(this._tweener.addTween(this.getScaleRef(),"x",this.getScaleRef().x,a,e,d,c,g));this._positionTweens.push(this._tweener.addTween(this.getScaleRef(),"y",this.getScaleRef().y,l,e,d,c))},cancelPositionTweens:function(){if(null!=this._positionTweens){for(var a=this._positionTweens.length,b=0;b<a;){var e=b++;this._tweener.destroyTween(this._positionTweens[e])}this._positionTweens=null}},skipPositionTweens:function(){if(null!=
this._positionTweens){for(var a=this._positionTweens.length,b=0;b<a;){var e=b++;this._positionTweens[e].skip()}this._positionTweens=null}},playSound:function(a,l){null==l&&(l=!1);this.stopSound();this._soundChannel=b.audio.SoundManager.playSoundByName(a,!1,l)},stopSound:function(){null!=this._soundChannel&&this._soundChannel.stop();this._soundChannel=null},destroy:function(){b.Entity.prototype.destroy.call(this);null!=this._soundChannel&&(this._soundChannel.stop(),this._soundChannel=null)},__class__:b.GameEntity});
b.GameState=function(){this._activeEntities=this._entitiesToDelete=null;this._isPaused=!1;this._elapsedTime=0;this._hasInitialized=!1;b.GameObject.call(this);this._entities=[];this._activeEntities=[];this._entitiesToDelete=[]};b.GameState.__name__=["f84","GameState"];b.GameState.__super__=b.GameObject;b.GameState.prototype=r(b.GameObject.prototype,{getPaused:function(){return this._isPaused},init:function(){b.GameObject.prototype.init.call(this)},onButtonClicked:function(){},update:function(){b.GameObject.prototype.update.call(this);
for(var a=this._entitiesToDelete.length,l=0;l<a;){var e=l++,e=this._entitiesToDelete[e];e.onDestroyed();v.remove(this._entities,e)}b.utilities.ArrayUtils.clear(this._entitiesToDelete);l=0;if(!this._isPaused){b.utilities.ArrayUtils.clear(this._activeEntities);for(var e=[].concat(this._entities),a=e.length,c=0;c<a;){var d=c++,d=e[d];null!=d&&d.getIsActive()&&(this._activeEntities.push(d),l++,d.getIsUpdating()&&d.update())}this._elapsedTime+=b.Root.getDeltaTime()}"1"==b.GameConfig.getProperty("debugCheats")&&
b.managers.InputManager.getInstance().isKeyPressed(105)&&(b.utilities.Debug.log(this._entities),b.utilities.Debug.log(this._activeEntities),b.managers.AssetManager.outputAssets(),b.utilities.Debug.log("Active entities: "+l))},fixedUpdate:function(){b.GameObject.prototype.fixedUpdate.call(this);if(!this._isPaused)for(var a=this._activeEntities.length,l=0;l<a;){var e=l++,e=this._activeEntities[e];e.getIsActive()&&e.fixedUpdate()}},postUpdate:function(){b.GameObject.prototype.postUpdate.call(this);if(!this._isPaused)for(var a=
this._activeEntities.length,l=0;l<a;){var e=l++,e=this._activeEntities[e];e.getIsUpdating()&&e.getIsActive()&&e.postUpdate()}},render:function(){b.GameObject.prototype.render.call(this);for(var a=this._activeEntities.length,l=0;l<a;){var e=l++,e=this._activeEntities[e];e.getIsVisible()&&e.getIsActive()&&e.render()}},debugRender:function(){b.GameObject.prototype.debugRender.call(this);for(var a=this._entities.length,l=0;l<a;){var e=l++,e=this._entities[e];e.getIsActive()&&e.getIsVisible()&&e.debugRender()}},
addEntity:function(a){null==a&&(a=new b.Entity);a.setGameState(this);this._entities.push(a);return a},removeEntity:function(a){v.remove(this._entities,a)},getHasEntity:function(a){return-1!=b.utilities.ArrayUtils.indexOf(this._entities,a)},getEntities:function(){return this._entities},findEntityByName:function(a){for(var b=this._entities.length,e=0;e<b;){var c=e++,c=this._entities[c];if(c.getName()==a)return c}return null},getEntitiesByTag:function(a,b){null==b&&(b=!0);for(var e=[],c=this._entities.length,
d=0;d<c;){var g=d++,g=this._entities[g];(!b||g.getIsActive())&&g.hasTag(a)&&e.push(g)}return e},getClosestEntityToPointByTag:function(a,l,e){null==e&&(e=!0);l=this.getEntitiesByTag(l);for(var c=-1,d=null,g=l.length,h=0;h<g;){var k=h++,k=l[k];if(!e||k.getIsActive()){var m=k.getPosition(),m=(new b.Vector3D(m.x-a.x,m.y-a.y,m.z-a.z)).getLength();if(-1==c||m<c)c=m,d=k}}return d},sortEntitiesByZ:function(){this._entities.sort(function(a,b){var e=a.getPosition(),c=b.getPosition();return e.z==c.z?a.getInstanceId()>
b.getInstanceId()?1:-1:e.z<c.z?1:-1})},handleMessage:function(a,l){b.GameObject.prototype.handleMessage.call(this,a,l);if(!this._isPaused)for(var e=this._activeEntities.length-1;0<=e;)this._activeEntities[e].getIsActive()&&this._activeEntities[e].handleMessage(a,l),e--},pause:function(){this._isPaused=!0;q.getDocument().body.style.cursor="default"},resume:function(){this._isPaused=!1},bringEntityToFront:function(a,b){null==b&&(b=!1);v.remove(this._entities,a)&&this._entities.push(a);if(b)for(var e=
a.getChildren(),c=e.length,d=0;d<c;){var g=d++;this.bringEntityToFront(e[g],!0)}},sendEntityToBack:function(a,b){null==b&&(b=!1);v.remove(this._entities,a)&&this._entities.splice(0,0,a);if(b)for(var e=a.getChildren(),c=e.length,d=0;d<c;){var g=d++;this.sendEntityToBack(e[g],!0)}},insertEntityAfter:function(a,l){if(v.remove(this._entities,a)){var e=b.utilities.ArrayUtils.indexOf(this._entities,l)+1;this._entities.splice(e,0,a)}},scheduleEntityForDeletion:function(a){this._entitiesToDelete.push(a)},
destroy:function(){b.GameObject.prototype.destroy.call(this);for(var a=this._entities.length-1;0<=a;)this._entities[a].destroy(),this._entities[a].onDestroyed(),a--;this._isMarkedForDeletion=!0},__class__:b.GameState});b.Layer=function(a,l,e,c,d){null==d&&(d=!1);this._context2d=null;this._wholeCanvasDirty=this._renderedThisFrame=!1;this._canvasWidth=this._canvasHeight=0;this._autoClear=!0;this._backgroundColor="#000000";b.GameObject.call(this);this.setName(a);this._container=q.getContainer();this._canvas=
q.getDocument().createElement("canvas");this._canvas.width=l;this._canvas.height=e;this._canvasWidth=l;this._canvasHeight=e;this._canvas.setAttribute("webkitTransform","translate3d(0px, 0px, 0px);");this._canvas.style.position="absolute";this._context2d=this._canvas.getContext("2d");d?(b.Layer._masterLayer=this,this._container.appendChild(this._canvas)):this._canvas.style.visibility="hidden"};b.Layer.__name__=["f84","Layer"];b.Layer.getMasterLayer=function(){return b.Layer._masterLayer};b.Layer.__super__=
b.GameObject;b.Layer.prototype=r(b.GameObject.prototype,{getClearBounds:function(){return this._clearBounds},setClearBounds:function(a){this._clearBounds=a},getContext:function(){return this._context2d},getWholeCanvasDirty:function(){return this._wholeCanvasDirty},setWholeCanvasDirty:function(a){this._wholeCanvasDirty=a;this._renderedThisFrame=!0},clear:function(a){null==a&&(a=!1);if(b.Layer._masterLayer!=this||a)a=this._canvas.getContext("2d"),null==this._clearBounds?a.clearRect(0,0,this._canvas.width,
this._canvas.height):a.clearRect(this._clearBounds.ul.x,this._clearBounds.ul.y,this._clearBounds.wh.x,this._clearBounds.wh.y),this._wholeCanvasDirty=!1},render:function(){b.GameObject.prototype.render.call(this);b.pixi.PixiManager.getInstance().getWebGlEnabled()||(b.pixi.PixiManager.getInstance().getRenderer().view.getContext("2d").setTransform(1,0,0,1,0,0),b.pixi.PixiManager.getInstance().getRenderer().view.getContext("2d").drawImage(this._canvas,0,0,this._canvasWidth,this._canvasHeight))},getSize:function(){return new b.Vector2D(this._canvasWidth,
this._canvasHeight)},setSize:function(a,b){this._canvasWidth=a;this._canvasHeight=b;this._canvas.width=a;this._canvas.height=b},update:function(){b.GameObject.prototype.update.call(this);this._renderedThisFrame=!1},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},getContainer:function(){return this._container},getCanvas:function(){return this._canvas},getAutoClear:function(){return this._autoClear},setAutoClear:function(a){this._autoClear=a},
destroy:function(){b.GameObject.prototype.destroy.call(this);null!=this.getCanvas().parentNode&&this.getCanvas().parentNode.removeChild(this.getCanvas())},__class__:b.Layer});b.Layers=function(){};b.Layers.__name__=["f84","Layers"];b.Layers.getMaster=function(){null==b.Layers._master&&(b.Layers._master=b.Root.getInstance().getLayerByName("master"));return b.Layers._master};b.Layers.getDefault=function(){null==b.Layers._default&&(b.Layers._default=b.Root.getInstance().getLayerByName("default"));return b.Layers._default};
b.Layers.getUi=function(){null==b.Layers._ui&&(b.Layers._ui=b.Root.getInstance().getLayerByName("ui"));return b.Layers._ui};b.Layers.getPixi=function(){null==b.Layers._pixi&&(b.Layers._pixi=b.Root.getInstance().getLayerByName("pixi"));return b.Layers._pixi};b.Layers.getOrientation=function(){null==b.Layers._orientation&&(b.Layers._orientation=b.Root.getInstance().getLayerByName("orientation"));return b.Layers._orientation};b.Layers.getDebug=function(){null==b.Layers._debug&&(b.Layers._debug=b.Root.getInstance().getLayerByName("debug"));
return b.Layers._debug};b.LoadBatch=function(a){null==a&&(a=!1);this._currentRequestsActive=0;this._minLoadTimeElapsed=!1;this._currentAssetToLoad=0;this._loadCompleted=!1;this._assetsToLoad=0;this._onCompleteCallback=null;this._assetLoadingInfo=[];a&&(this._minLoadTimeElapsed=!0)};b.LoadBatch.__name__=["f84","LoadBatch"];b.LoadBatch.prototype={getLoadComplete:function(){return this._loadCompleted},addAsset:function(a,l,e,c){this._assetLoadingInfo.push(new b.AssetLoadingInfo(a,l,e,!1,c))},getAssetLoadingInfoByAssetName:function(a){for(var b=
this._assetLoadingInfo.length,e=0;e<b;){var c=e++,c=this._assetLoadingInfo[c];if(c.name==a)return c}return null},numAssets:function(){return this._assetsToLoad},onAssetLoaded:function(a){this._assetsToLoad--;this.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:this._assetLoadingInfo.length-this._assetsToLoad,total:this._assetLoadingInfo.length});this.loadNext()},onXmlHttpRequestLoaded:function(a){},checkAssetsLoaded:function(){0<this._currentRequestsActive||(b.Root.getInstance().sendGlobalMessage("onFileLoaded",
{progress:this._assetLoadingInfo.length-this._assetsToLoad,total:this._assetLoadingInfo.length}),this._loadCompleted||0<this._assetsToLoad||this.fireAllAssetsLoaded())},fireAllAssetsLoaded:function(){this._minLoadTimeElapsed&&(this._loadCompleted=!0,null!=this._onCompleteCallback&&this._onCompleteCallback())},load:function(a){this._onCompleteCallback=a;this._assetsToLoad=this._assetLoadingInfo.length;this._loadCompleted=!1;this._currentAssetToLoad=0;0==this._assetLoadingInfo.length?(a(),this._loadCompleted=
!0):(this.loadNext(),b.Root.getInstance().setIsDeferredActionsPaused(!1),b.Root.getInstance().invokeAsyncDeferredAction(1,s(this,this.onMinLoadElapsed)))},unload:function(){for(var a=this._assetLoadingInfo.length,l=0;l<a;){var e=l++;b.managers.AssetManager.unloadAsset(this._assetLoadingInfo[e].name)}},loadNext:function(){var a=this;if(!(10<=this._currentRequestsActive||0>=this._assetsToLoad&&this._minLoadTimeElapsed)){for(var l=null;null==l&&0<this._assetsToLoad;)if(l=this._assetLoadingInfo[this._currentAssetToLoad++],
null==l)this._assetsToLoad--,this.checkAssetsLoaded();else break;if(!(0>=this._assetsToLoad)){l.source=C.replace(l.source,"${locale}",q.dataLocale);switch(l.type[1]){case 4:var e;e=q.getDocument().createElement("link");e.rel="stylesheet";e.type="text/css";e.href=l.source;e.id=l.name;q.getDocument().head.appendChild(e);this.checkAssetsLoaded();this.loadNext();break;case 1:if(!b.Root.isMobile()||b.audio.SoundManager.getIsWebkitEnabled()){e=null;var c=this;if(b.managers.AssetManager.assetExists(l.name)){c._assetsToLoad--;
c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});c.loadNext();return}e=v.substr(l.source,l.source.length-3,3);var d=-1<navigator.userAgent.toLowerCase().indexOf("firefox");"mp3"==e&&(d&&!b.audio.SoundManager.getUseFlashSound())&&(l.source=C.replace(l.source,"mp3","ogg"));if(!b.audio.SoundManager.getIsWebkitEnabled()||d)b.audio.SoundManager.getUseFlashSound()?(this._currentRequestsActive++,
e=soundManager.createSound({id:l.name,url:l.source,autoLoad:!0,onload:function(){c._assetsToLoad--;a._currentRequestsActive--;c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});c.loadNext()}}),b.managers.AssetManager.registerAsset(l.name,e)):(e=document.createElement("audio"),e.src=l.source,e.preload=!0,e.autoplay=!1,e.id=l.name,this._currentRequestsActive++,e.addEventListener("canplay",
function(){c._assetsToLoad--;a._currentRequestsActive--;c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});c.loadNext()},!1),e.addEventListener("onerror",function(){c._assetsToLoad--;console.log("File not found: "+l.source);a._currentRequestsActive--;c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});
c.loadNext()}),e.addEventListener("stalled",function(){c._assetsToLoad--;console.log("File not found: "+l.source);a._currentRequestsActive--;c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});c.loadNext()}),e.addEventListener("suspend",function(){c._assetsToLoad--;console.log("Loading suspended: "+l.source);a._currentRequestsActive--;c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",
{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});c.loadNext()}),b.managers.AssetManager.registerAsset(l.name,e),e.load());else{var g=new XMLHttpRequest;g.open("GET",l.source,!0);g.responseType="arraybuffer";b.managers.AssetManager.registerAsset(l.name+"_src",l.source);this._currentRequestsActive++;g.onload=function(){b.audio.SoundManager.getAudioContextInstance().decodeAudioData(g.response,function(e){b.managers.AssetManager.registerAsset(l.name,e);c._assetsToLoad--;
a._currentRequestsActive--;c.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:c._assetLoadingInfo.length-c._assetsToLoad,total:c._assetLoadingInfo.length});c.loadNext()})};g.send()}}else b.managers.AssetManager.registerAsset(l.name,l.source),this._assetsToLoad--,this.checkAssetsLoaded(),this.loadNext();break;case 0:var h;h=q.getDocument().createElement("img");b.managers.AssetManager.registerAsset(l.name,h);this._currentRequestsActive++;var k=this;h.addEventListener("load",
function(b){PIXI.Texture.addTextureToCache(PIXI.Texture.fromImage(h.src,!1,null!=l.options?l.options.scaleMode:PIXI.SCALE_MODES.DEFAULT),l.name);a._currentRequestsActive--;a.onAssetLoaded(b)});h.addEventListener("onerror",function(){k._assetsToLoad--;alert("file not found: "+l.source);a._currentRequestsActive--;k.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:k._assetLoadingInfo.length-k._assetsToLoad,total:k._assetLoadingInfo.length});k.loadNext()});h.id=l.name;
h.src=l.source;break;case 2:var m;m=new XMLHttpRequest;var p=this;this._currentRequestsActive++;m.onload=function(){b.managers.AssetManager.registerAsset(l.name,m.responseText);p._assetsToLoad--;a._currentRequestsActive--;p.checkAssetsLoaded();b.Root.getInstance().sendGlobalMessage("onFileLoaded",{progress:p._assetLoadingInfo.length-p._assetsToLoad,total:p._assetLoadingInfo.length});p.loadNext()};m.onerror=function(){p._assetsToLoad--;alert("File not found: "+l.source);a._currentRequestsActive--;
p.checkAssetsLoaded();p.loadNext()};m.open("GET",l.source,!0);m.send();break;case 3:e=q.getDocument().createElement("script"),e.type="text/javascript",e.async=!0,e.src=l.source,e.id=l.name,q.getDocument().body.appendChild(e),this._currentRequestsActive++,e.onload=function(){a._currentRequestsActive--;a.checkAssetsLoaded();a.loadNext()}}this.loadNext()}}},onMinLoadElapsed:function(){this._minLoadTimeElapsed=!0;this.checkAssetsLoaded()},concatLoadBatch:function(a){for(var b=a._assetLoadingInfo.length,
e=0;e<b;){var c=e++,c=a._assetLoadingInfo[c];this.hasAsset(c.name)||this._assetLoadingInfo.push(c)}},hasAsset:function(a){for(var b=this._assetLoadingInfo.length,e=0;e<b;){var c=e++;if(this._assetLoadingInfo[c].name==a)return!0}return!1},__class__:b.LoadBatch};b.Localizer=function(){};b.Localizer.__name__=["f84","Localizer"];b.Localizer.initStrings=function(){var a=b.managers.AssetManager.getAsset("strings");b.Localizer.stringsXml=B.parse(a).elementsNamed("strings").next()};b.Localizer.getString=
function(a){try{return b.Localizer.stringsXml.elementsNamed(a).next().firstChild().get_nodeValue()}catch(l){throw"Could not find string: "+a;}};b.Localizer.prototype={__class__:b.Localizer};b.Manager=function(){b.GameObject.call(this)};b.Manager.__name__=["f84","Manager"];b.Manager.__super__=b.GameObject;b.Manager.prototype=r(b.GameObject.prototype,{__class__:b.Manager});b.RaycastInfo=function(){this.normal=null;this.distance=-1;this.collisionPoint=this.collider=null;this.normal=new b.Vector2D};b.RaycastInfo.__name__=
["f84","RaycastInfo"];b.RaycastInfo.prototype={__class__:b.RaycastInfo};b.Rect2D=function(a,l,e,c){null==c&&(c=0);null==e&&(e=0);null==l&&(l=0);null==a&&(a=0);this.ul=new b.Vector2D(a,l);this.wh=new b.Vector2D(e,c)};b.Rect2D.__name__=["f84","Rect2D"];b.Rect2D.prototype={getClone:function(){return new b.Rect2D(this.ul.x,this.ul.y,this.wh.x,this.wh.y)},getIntersect:function(a){return!(this.ul.x>a.ul.x+a.wh.x||this.ul.x+this.wh.x<a.ul.x||this.ul.y>a.ul.y+a.wh.y||this.ul.y+this.wh.y<a.ul.y)},containsPoint:function(a){return a.x>
this.ul.x&&a.y>this.ul.y&&a.x<this.ul.x+this.wh.x&&a.y<this.ul.y+this.wh.y},__class__:b.Rect2D};b.Root=function(a,l){this._iosAudioEnabled=!1;this._prevWidth=this._prevHeight=0;this._isUpdating=!0;this._hasFocus=!1;this._screenScale=null;this._isOrientationScreenShowing=!1;this._currentOrientation=0;this._isDeferredActionsPaused=!1;this._gameStates=this._managers=this._layers=this._deferredActions=null;this._gameId=a;this._screenScale=new b.Vector2D(1,1);this._gameStates=[];b.Root._instance=this;
this._layers=[];this._managers=[];this._deferredActions=[];this._initialState=l};b.Root.__name__=["f84","Root"];b.Root.getInstance=function(){return b.Root._instance};b.Root.getTimeScale=function(){return b.Root._timeScale};b.Root.setTimeScale=function(a){b.Root._timeScale=a};b.Root.getDeltaTime=function(){return b.Root._fixedTimestepDelta?0.016666666666666666*b.Root.getTimeScale():Math.min(0.03333333333333333,b.Root._currentTimeStamp-b.Root._prevTimeStamp)*b.Root.getTimeScale()};b.Root.getRealDeltaTime=
function(){return b.Root._currentTimeStamp-b.Root._prevTimeStamp};b.Root.isAppMode=function(){return window.isStandalone};b.Root.isIOS=function(){q.getWindow();var a=q.getWindow().navigator.platform;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")?!0:!1};b.Root.isMobile=function(){q.getWindow();var a=q.getWindow().navigator.platform;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")||-1!=a.indexOf("android")||-1!=a.indexOf("Linux")?!0:!1};b.Root.isInternetExplorer=
function(){return-1!=navigator.userAgent.toLowerCase().indexOf("msie")};b.Root.isFirefox=function(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")};b.Root.isSafari=function(){return-1<navigator.userAgent.toLowerCase().indexOf("safari/")};b.Root.getDevicePixelRatio=function(){return 1};b.Root.prototype={getGameStates:function(){return this._gameStates},getLayers:function(){return this._layers},getGameId:function(){return this._gameId},init:function(){b.Root._prevTimeStamp=w.Timer.stamp();
b.Root._currentTimeStamp=w.Timer.stamp();this.addGameState(this._initialState);this._initialState.init();q.getContainer().focus();this._prevWidth=q.getWindow().innerWidth;this._prevHeight=q.getWindow().innerHeight;q.getWindow().addEventListener("orientationchange",s(this,this.onOrientationChanged),!1);q.getWindow().addEventListener("pageshow",s(this,this.onOrientationChanged),!1);q.getWindow().addEventListener("resize",s(this,this.onResizeWindow),!1);b.Root.isMobile()&&(window.onfocus=s(this,this.onFocusGained),
window.onblur=s(this,this.onFocusLost));q.getDocument().addEventListener("webkitvisibilitychange",s(this,this.onWebkitVisibilityChange),!1);q.getWindow().addEventListener("pagehide",s(this,this.onFocusLost),!1);b.Root.isMobile()&&b.Root.isIOS()&&q.getWindow().addEventListener("touchend",s(this,this.onTouchEnd),!1);if(b.Root.isMobile())this.onOrientationChanged();else this.setScreenScale(1,1)},onAssetsLoaded:function(){},update:function(){if(!this._hasFocus)this.onFocusGained();if(this._isUpdating){for(var a=
0,a=this._managers.length;0<a--;){var l=this._managers[a];l.getIsMarkedForDeletion()&&(l.onDestroyed(),this._managers.splice(a,1))}a=this._managers.length;for(l=0;l<a;){var e=l++,e=this._managers[e];e.getIsActive()&&e.update()}b.audio.SoundManager.update();for(a=this._gameStates.length;0<a--;)l=this._gameStates[a],l.getIsMarkedForDeletion()&&(l.onDestroyed(),this._gameStates.splice(a,1));a=this._gameStates.length;for(l=0;l<a;)e=l++,this._gameStates[e].getIsActive()&&this._gameStates[e].update();for(a=
this._layers.length;0<a--;)l=this._layers[a],l.getIsMarkedForDeletion()&&(l.onDestroyed(),v.remove(this._layers,l));a=this._layers.length;for(l=0;l<a;)e=l++,this._layers[e].update()}if(!this._isDeferredActionsPaused)for(a=this._deferredActions.length;0<a--;)l=this._deferredActions[a],null!=l&&(l.timeUntilExecute-=b.Root.getDeltaTime(),0>=l.timeUntilExecute&&(l.params?l.actionToExecute(l.params):l.actionToExecute(),this._deferredActions.splice(a,1)));if(this._prevWidth!=q.getWindow().innerWidth||this._prevHeight!=
q.getWindow().innerHeight)this.onOrientationChanged(),this._prevWidth=q.getWindow().innerWidth,this._prevHeight=q.getWindow().innerHeight},fixedUpdate:function(){b.Root._currentTimeStamp=w.Timer.stamp();var a=b.Root.getDeltaTime(),a=t["int"](Math.max(1,Math.floor(a/0.016666666666666666)));b.Root._fixedTimestepDelta=!0;for(var l=0;l<a;){l++;for(var e=this._managers.length,c=0;c<e;){var d=c++,d=this._managers[d];d.getIsActive()&&d.fixedUpdate()}e=this._gameStates.length;for(c=0;c<e;)d=c++,this._gameStates[d].getIsActive()&&
this._gameStates[d].fixedUpdate()}b.Root._fixedTimestepDelta=!1},postUpdate:function(){for(var a=this._managers.length,l=0;l<a;){var e=l++,e=this._managers[e];e.getIsActive()&&e.postUpdate()}a=this._gameStates.length;for(l=0;l<a;)e=l++,this._gameStates[e].getIsActive()&&this._gameStates[e].postUpdate();b.Root._prevTimeStamp=b.Root._currentTimeStamp},updateDivClass:function(){var a="container";1==this._currentOrientation&&(a+=" portrait");q.getContainer().className=a},render:function(){for(var a=this._layers.length,
b=0;b<a;){var e=b++,e=this._layers[e];e.getAutoClear()&&e.getWholeCanvasDirty()&&e.clear()}a=this._gameStates.length;for(b=0;b<a;)e=b++,this._gameStates[e].getIsActive()&&this._gameStates[e].render();a=this._managers.length;for(b=0;b<a;)e=b++,this._managers[e].getIsActive()&&this._managers[e].render();a=this._layers.length;for(b=0;b<a;)e=b++,e=this._layers[e],"debug"!=e.getName()&&e.render()},debugRender:function(){for(var a=this._gameStates.length,b=0;b<a;){var e=b++;this._gameStates[e].debugRender()}a=
this._managers.length;for(b=0;b<a;)e=b++,this._managers[e].debugRender();a=this._layers.length;for(b=0;b<a;)e=b++,e=this._layers[e],"debug"==e.getName()&&e.render(),e.debugRender()},addGameState:function(a){for(var b=this._gameStates.length,e=0;e<b;){var c=e++;if(a==this._gameStates[c])return a}this._gameStates.push(a);return a},removeGameState:function(a,b){null==b&&(b=!0);b&&(a.destroy(),a.onDestroyed());for(var e=this._gameStates.length,c=0;c<e;){var d=c++;if(a==this._gameStates[d]){this._gameStates.splice(d,
1);break}}},addManager:function(a){this._managers.push(a);a.init()},removeManager:function(a){for(var b=this._managers.length,e=0;e<b;){var c=e++;if(this._managers[c]==a){this._managers.splice(c,1);a.destroy();break}}},getManager:function(a){for(var b=this._managers.length,e=0;e<b;){var c=e++;if(G.getClass(this._managers[c])==a)return this._managers[c]}return null},setIsDeferredActionsPaused:function(a){this._isDeferredActionsPaused=a},destroyAllDeferredActions:function(){this._deferredActions=[]},
switchToGameState:function(a,b,e){null==e&&(e=!0);null!=a&&this.removeGameState(a,e);null!=b&&this.addGameState(b)},addLayer:function(a,b){null==b&&(b=!1);b?this._layers.splice(0,0,a):this._layers.push(a)},insertLayerAfter:function(a,b){var e=v.indexOf(this._layers,b,0)+1;this._layers.splice(e,0,a)},removeLayer:function(a){a.destroy();v.remove(this._layers,a)},getLayerByName:function(a){for(var b=this._layers.length,e=0;e<b;){var c=e++,c=this._layers[c];if(c.getName()==a)return c}return null},sendGlobalMessage:function(a,
b){for(var e=this._managers.length-1;0<=e;)this._managers[e].handleMessage(a,b),e--;for(e=this._gameStates.length-1;0<=e;)this._gameStates[e].handleMessage(a,b),e--},invokeAsyncDeferredAction:function(a,l,e){a=new b.components.DeferredAction(a,l,e);this._deferredActions.push(a);return a},destroyDeferredAction:function(a){v.remove(this._deferredActions,a)},onOrientationChanged:function(){var a=this;this.invokeAsyncDeferredAction(0.35,function(){var l=!1,l=b.Root.isMobile()?q.getWindow().innerWidth>
q.getWindow().innerHeight:!0;"HORIZONTAL"==b.GameConfig.getProperty("forceOrientation")?(a._currentOrientation=0,l=!0):"VERTICAL"==b.GameConfig.getProperty("forceOrientation")?(a._currentOrientation=1,l=!1):a._currentOrientation=l?0:1;a.onResizeWindow();a.sendGlobalMessage("onOrientationChanged",{isHorizontal:l})})},setScreenScale:function(a,b){this.updateDivClass();this._screenScale.x=a;this._screenScale.y=b;this.onScreenScaleUpdated()},getScreenScale:function(){return b.Root.isAppMode()?new b.Vector2D(0.91*
this._screenScale.x,0.91*this._screenScale.y):this._screenScale},getScreenSize:function(){this.getCurrentOrientation();return new b.Vector2D(q.CANVAS_WIDTH_LANDSCAPE,q.CANVAS_HEIGHT_LANDSCAPE)},getScreenOffset:function(){var a=q.getWindow().innerWidth,l=q.getWindow().innerHeight;return 0==this._currentOrientation?new b.Vector2D(a/2-q.CANVAS_WIDTH_LANDSCAPE*this.getScreenScale().x/2,l/2-q.CANVAS_HEIGHT_LANDSCAPE*this.getScreenScale().y/2):new b.Vector2D(a/2-q.CANVAS_WIDTH_PORTRAIT*this.getScreenScale().x/
2,l/2-q.CANVAS_HEIGHT_PORTRAIT*this.getScreenScale().y/2)},getCurrentOrientation:function(){return this._currentOrientation},onWebkitVisibilityChange:function(){if(q.getDocument().webkitHidden)this.onFocusLost();else this.onFocusGained()},onFocusGained:function(){this._hasFocus||(b.managers.InputManager.getInstance().disablePageKeyPresses(),b.audio.SoundManager.resumeAllSounds(),this._isUpdating=this._hasFocus=!0,this.sendGlobalMessage("onFocusGained"))},onFocusLost:function(){b.audio.SoundManager.pauseAllSounds();
this._hasFocus&&(b.managers.InputManager.getInstance().enablePageKeyPresses(),this._isUpdating=this._hasFocus=!1,this.sendGlobalMessage("onFocusLost"))},onResizeWindow:function(){var a=1,l=a;b.Root.isMobile()||"1"==b.GameConfig.getProperty("scaleToScreenOnDesktop")?l=a=0==this._currentOrientation?Math.min(q.getWindow().innerHeight/q.CANVAS_HEIGHT_LANDSCAPE,q.getWindow().innerWidth/q.CANVAS_WIDTH_LANDSCAPE):Math.min(q.getWindow().innerHeight/q.CANVAS_HEIGHT_PORTRAIT,q.getWindow().innerWidth/q.CANVAS_WIDTH_PORTRAIT):
(l=q.dataWidth/q.CANVAS_WIDTH_LANDSCAPE,a=q.dataHeight/q.CANVAS_HEIGHT_LANDSCAPE);this.sendGlobalMessage("onResizedWindow");this.setScreenScale(l,a)},onScreenScaleUpdated:function(){var a,l;a=q.getWindow().innerWidth;l=q.getWindow().innerHeight;b.Root.isMobile()&&this.hideAddressBar();0==this._currentOrientation?(q.getContainer().style.width=q.CANVAS_WIDTH_LANDSCAPE+"px",q.getContainer().style.height=q.CANVAS_HEIGHT_LANDSCAPE+"px"):(q.getContainer().style.width=q.CANVAS_WIDTH_PORTRAIT+"px",q.getContainer().style.height=
q.CANVAS_HEIGHT_PORTRAIT+"px");var e=null;null!=b.pixi.PixiManager.getInstance().getRenderer()&&(e=b.pixi.PixiManager.getInstance().getRenderer().view);var c=0,d=0;0==this._currentOrientation?(null!=e&&(e.style.width=q.CANVAS_WIDTH_LANDSCAPE*this.getScreenScale().x*b.Root.getDevicePixelRatio()+"px",e.style.height=q.CANVAS_HEIGHT_LANDSCAPE*this.getScreenScale().y*b.Root.getDevicePixelRatio()+"px"),c=q.CANVAS_WIDTH_LANDSCAPE*this.getScreenScale().x,d=q.CANVAS_HEIGHT_LANDSCAPE*this.getScreenScale().y):
(null!=e&&(e.style.width=q.CANVAS_WIDTH_PORTRAIT*this.getScreenScale().x*b.Root.getDevicePixelRatio()+"px",e.style.height=q.CANVAS_HEIGHT_PORTRAIT*this.getScreenScale().y*b.Root.getDevicePixelRatio()+"px"),c=q.CANVAS_WIDTH_PORTRAIT*this.getScreenScale().x,d=q.CANVAS_HEIGHT_PORTRAIT*this.getScreenScale().y);q.getContainer().style.width=c+"px";q.getContainer().style.height=d+"px";q.getContainer().style.left=a/2-c/2+"px";q.getContainer().style.top=l/2-d/2+"px";this.sendGlobalMessage("onScreenScaleUpdated")},
stopUpdates:function(){this._isUpdating=!1},resumeUpdates:function(){this._isUpdating=!0},hideAddressBar:function(){this.isPhone()&&!window.location.hash&&(document.height<window.outerHeight&&(document.body.style.height=window.outerHeight+50+"px"),setTimeout(function(){window.scrollTo(0,1)},50))},isPhone:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("android")||-1!=navigator.userAgent.toLowerCase().indexOf("Linux")?
!0:!1},requestFullscreen:function(){if(!b.Root.isIOS()){var a=window.document,l=a.documentElement,e=l.requestFullscreen||l.mozRequestFullScreen||l.webkitRequestFullScreen||l.msRequestFullscreen;a.exitFullscreen=function(){};a.cancelFullScreen=function(){};a.mozCancelFullScreen=function(){};a.webkitCancelFullScreen=function(){};a.msExitFullscreen=function(){};a.fullscreenElement||(a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement)||e.call(l)}},onTouchEnd:function(){if(!1==this._iosAudioEnabled)try{var a=
b.audio.SoundManager.getAudioContextInstance(),l=a.createBuffer(1,1,22050),e=a.createBufferSource();e.buffer=l;e.connect(a.destination);e.start(0);this._iosAudioEnabled=!0;b.utilities.Debug.log("Audio enabled for iOS")}catch(c){b.utilities.Debug.log("error")}},__class__:b.Root};b.SaveData=function(){this._data={};this.load()};b.SaveData.__name__=["f84","SaveData"];b.SaveData.prototype={setItem:function(a,b){this._data[a]=b;this.save()},getItem:function(a,b){if(Object.prototype.hasOwnProperty.call(this._data,
a))return H.field(this._data,a);this.setItem(a,b);return b},save:function(){var a=b.Root.getInstance().getGameId()+"Data";if(null!=z.Browser.getSessionStorage())try{z.Browser.getSessionStorage().setItem(a,JSON.stringify(this._data))}catch(l){b.utilities.Debug.log("Error saving to session storage")}if(null!=z.Browser.getLocalStorage())try{z.Browser.getLocalStorage().setItem(a,JSON.stringify(this._data))}catch(e){b.utilities.Debug.log("Error saving to local storage")}},load:function(){var a=b.Root.getInstance().getGameId()+
"Data";if(null!=z.Browser.getSessionStorage()||null!=z.Browser.getLocalStorage()){var l=null;try{l=z.Browser.getSessionStorage().getItem(a)}catch(e){b.utilities.Debug.log("Failed to get item from session storage")}if(null==l)try{l=z.Browser.getLocalStorage().getItem(a)}catch(c){b.utilities.Debug.log("Failed to get item from session storage")}null!=l&&(this._data=JSON.parse(l))}},deleteAllSaveData:function(){this._data={};this.save()},__class__:b.SaveData};b.Vector2D=function(a,b){null==b&&(b=0);null==
a&&(a=0);this.x=this.y=0;this.x=a;this.y=b};b.Vector2D.__name__=["f84","Vector2D"];b.Vector2D.prototype={getClone:function(){return new b.Vector2D(this.x,this.y)},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},scaleBy:function(a,b){this.x*=a;this.y*=b},dotProduct:function(a){return this.x*a.x+this.y*a.y},getNormalized:function(){var a=this.getLength();return new b.Vector2D(this.x/a,this.y/a)},__class__:b.Vector2D};b.Vector3D=function(a,b,e){null==e&&(e=0);null==b&&(b=0);null==
a&&(a=0);this.x=this.y=this.z=0;this.x=a;this.y=b;this.z=e};b.Vector3D.__name__=["f84","Vector3D"];b.Vector3D.lerp=function(a,l,e){return new b.Vector3D(a.x+(l.x-a.x)*e,a.y+(l.y-a.y)*e,a.z+(l.z-a.z)*e)};b.Vector3D.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};b.Vector3D.prototype={add:function(a){return new b.Vector3D(this.x+a.x,this.y+a.y,this.z+a.z)},subtract:function(a){return new b.Vector3D(this.x-a.x,this.y-a.y,this.z-a.z)},scaleBy:function(a){this.x*=a;this.y*=a;this.z*=a},getLength:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z)},getClone:function(){return new b.Vector3D(this.x,this.y,this.z)},getNormalized:function(){var a=this.getLength();return new b.Vector3D(this.x/a,this.y/a,this.z/a)},__class__:b.Vector3D};b.events.Event=function(a){this._name=a};b.events.Event.__name__=["f84","events","Event"];b.events.Event.prototype={getName:function(){return this._name},__class__:b.events.Event};b.achievements={};b.achievements.AchievementCompleteEvent=function(a,l){this._achievementDefinition=
null;b.events.Event.call(this,a);this._achievementDefinition=l};b.achievements.AchievementCompleteEvent.__name__=["f84","achievements","AchievementCompleteEvent"];b.achievements.AchievementCompleteEvent.__super__=b.events.Event;b.achievements.AchievementCompleteEvent.prototype=r(b.events.Event.prototype,{getAchievementDefinition:function(){return this._achievementDefinition},__class__:b.achievements.AchievementCompleteEvent});b.achievements.AchievementDefinition=function(a,b,e,c,d,g){this._id=a;this._name=
b;this._description=e;this._valueName=c;this._goal=d;this._iconId=g};b.achievements.AchievementDefinition.__name__=["f84","achievements","AchievementDefinition"];b.achievements.AchievementDefinition.prototype={getIconId:function(){return this._iconId},getId:function(){return this._id},getName:function(){return this._name},getDescription:function(){return this._description},getValueName:function(){return this._valueName},getGoal:function(){return this._goal},__class__:b.achievements.AchievementDefinition};
b.achievements.AchievementsManager=function(){this._achievementsEnabled=!1;this._achievementDefinitions=this._values=null;b.Manager.call(this);b.achievements.AchievementsManager._instance=this;this._achievementDefinitions=[];this._values=new w.ds.StringMap;this._achievementsEnabled="1"==b.GameConfig.getProperty("achievementsEnabled")};b.achievements.AchievementsManager.__name__=["f84","achievements","AchievementsManager"];b.achievements.AchievementsManager.getInstance=function(){null==b.achievements.AchievementsManager._instance&&
(b.achievements.AchievementsManager._instance=new b.achievements.AchievementsManager,b.Root.getInstance().addManager(b.achievements.AchievementsManager._instance));return b.achievements.AchievementsManager._instance};b.achievements.AchievementsManager.__super__=b.Manager;b.achievements.AchievementsManager.prototype=r(b.Manager.prototype,{getCompletionPercentage:function(){for(var a=0,b=this._achievementDefinitions.length,e=0;e<b;){var c=e++;this.getIsAchievementComplete(this._achievementDefinitions[c].getId())&&
a++}return a/b},getAchievementsEnabled:function(){return this._achievementsEnabled},registerAchievement:function(a,l,e,f,d){this._achievementsEnabled&&(a=new b.achievements.AchievementDefinition(this._achievementDefinitions.length,a,l,e,f,d),this._achievementDefinitions.push(a),a=c.GameTracker.getInstance().getSaveData().getItem(e,0),this._values.set(e,a))},setValue:function(a,b){this._values.exists(a)||this._values.set(a,0);var e=this._values.get(a);b<e||(this._values.set(a,b),this.checkAchievementsComplete(a,
e,this._values.get(a)),c.GameTracker.getInstance().getSaveData().setItem(a,this._values.get(a)))},incrementValue:function(a,b){this._values.exists(a)||this._values.set(a,0);var e=this._values.get(a),f=this._values.get(a)+b;this._values.set(a,f);this.checkAchievementsComplete(a,e,this._values.get(a));c.GameTracker.getInstance().getSaveData().setItem(a,this._values.get(a))},checkAchievementsComplete:function(a,l,e){a=this.getAchievementDefinitionsByValueName(a);for(var f=a.length,d=0;d<f;){var g=d++,
g=a[g];if(l<g.getGoal()&&e>=g.getGoal()){this.dispatchEvent(new b.achievements.AchievementCompleteEvent("complete",g));var h=C.replace(b.Localizer.getString(g.getName()),"%N",t.string(g.getGoal())),k=C.replace(b.Localizer.getString(g.getDescription()),"%N",t.string(g.getGoal()));c.AlertsManager.getInstance().queueAlert(g.getIconId(),h,k)}}},getAchievementDefinitionsByValueName:function(a){for(var b=[],e=this._achievementDefinitions.length,c=0;c<e;){var d=c++,d=this._achievementDefinitions[d];d.getValueName()==
a&&b.push(d)}return b},getIsAchievementComplete:function(a){var b=this._achievementDefinitions[a];return function(a){var c=b.getValueName();return a._values.exists(c)}(this)?b.getGoal()<=function(a){var c=b.getValueName();return a._values.get(c)}(this):!1},getAchievementDefinitions:function(){return this._achievementDefinitions},resetAllValues:function(){this._values=new w.ds.StringMap},__class__:b.achievements.AchievementsManager});b.audio={};b.audio.SoundData=function(a,b,e){this._isMuted=!1;this._currentTime=
0;this._isInitialized=!1;this._soundName=a;this._volume=b;this._loop=e;this.init()};b.audio.SoundData.__name__=["f84","audio","SoundData"];b.audio.SoundData.prototype={init:function(){this._isInitialized=!0},play:function(a){},resume:function(){},update:function(){this._currentTime+=b.Root.getDeltaTime()},pause:function(){},stop:function(){b.audio.SoundManager.removeSoundFromPlayingSounds(this)},getVolume:function(){return this._volume},setVolume:function(a){this._volume=a},getMuted:function(){return this._isMuted},
setMuted:function(a){this._isMuted=a},getLoop:function(){return this._loop},setLoop:function(a){this._loop=a},getSoundLength:function(){return 1},getCurrentTime:function(){return this._currentTime},setCurrentTime:function(a){this._currentTime=a},__class__:b.audio.SoundData};b.audio.Html5SoundData=function(a,l,e){b.audio.SoundData.call(this,a,l,e)};b.audio.Html5SoundData.__name__=["f84","audio","Html5SoundData"];b.audio.Html5SoundData.__super__=b.audio.SoundData;b.audio.Html5SoundData.prototype=r(b.audio.SoundData.prototype,
{init:function(){b.audio.SoundData.prototype.init.call(this)},play:function(a){null==a&&(a=0);var l=this;b.audio.SoundData.prototype.play.call(this,a);this._audio=b.managers.AssetManager.getAsset(this._soundName);0!=a&&this._audio.addEventListener("canplay",function(b){l._audio.currentTime=a});this._audio.play();this._audio.addEventListener("ended",s(this,this.onSoundComplete),!1);this._audio.loop=this._loop;this._audio.volume=this._volume},resume:function(){b.audio.SoundData.prototype.resume.call(this);
this._audio.play()},pause:function(){b.audio.SoundData.prototype.pause.call(this);this._audio.pause()},stop:function(){b.audio.SoundData.prototype.stop.call(this);this._audio.pause()},onSoundComplete:function(a){b.audio.SoundManager.removeSoundFromPlayingSounds(this)},setVolume:function(a){b.audio.SoundData.prototype.setVolume.call(this,a);this._audio.volume=a},setMuted:function(a){b.audio.SoundData.prototype.setMuted.call(this,a);this._audio.muted=a},__class__:b.audio.Html5SoundData});b.audio.SoundManager=
function(){};b.audio.SoundManager.__name__=["f84","audio","SoundManager"];b.audio.SoundManager.getUseFlashSound=function(){return!1};b.audio.SoundManager.init=function(){try{b.audio.SoundManager._audioContext=new AudioContext,b.audio.SoundManager._isWebkitEnabled=!b.Root.isFirefox()&&null!=b.audio.SoundManager._audioContext}catch(a){b.audio.SoundManager._isWebkitEnabled=!1}b.audio.SoundManager._musicTrack=new b.utilities.WatchableValue(null)};b.audio.SoundManager.getAudioContextInstance=function(){return b.audio.SoundManager._audioContext};
b.audio.SoundManager.getIsWebkitEnabled=function(){return b.audio.SoundManager._isWebkitEnabled};b.audio.SoundManager.setIsWebkitEnabled=function(a){b.audio.SoundManager._isWebkitEnabled=a};b.audio.SoundManager.getMusicMuted=function(){return b.audio.SoundManager._musicMuted};b.audio.SoundManager.setMusicMuted=function(a){b.audio.SoundManager._musicMuted=a;null!=b.audio.SoundManager._musicTrack.get()&&(b.audio.SoundManager._musicTrack.get().setMuted(a),b.audio.SoundManager._musicMuted||b.audio.SoundManager._musicTrack.get().setVolume(b.audio.SoundManager.getMusicVolume()*
b.audio.SoundManager.getMasterVolume()));b.audio.SoundManager.getIsWebkitEnabled()||(b.Root.isMobile()&&a?b.audio.SoundManager._musicTrack.get().pause():b.Root.isMobile()&&!a&&b.audio.SoundManager._musicTrack.get().play())};b.audio.SoundManager.getSoundMuted=function(){return b.audio.SoundManager._soundMuted};b.audio.SoundManager.setSoundMuted=function(a){b.audio.SoundManager._soundMuted=a;for(var l=b.audio.SoundManager._soundsPlaying.length,e=0;e<l;){var c=e++;b.audio.SoundManager._soundsPlaying[c].setMuted(a)}};
b.audio.SoundManager.getMasterVolume=function(){return b.audio.SoundManager._masterVolume};b.audio.SoundManager.setMasterVolume=function(a){b.audio.SoundManager._masterVolume=a;b.audio.SoundManager.setMusicVolume(b.audio.SoundManager._musicVolume);b.audio.SoundManager.setSoundVolume(b.audio.SoundManager._soundVolume)};b.audio.SoundManager.getMusicVolume=function(){return b.audio.SoundManager.getMusicMuted()?0:b.audio.SoundManager._musicVolume};b.audio.SoundManager.setMusicVolume=function(a){b.audio.SoundManager._musicVolume=
a;null!=b.audio.SoundManager._musicTrack&&null!=b.audio.SoundManager._musicTrack.get()&&b.audio.SoundManager._musicTrack.get().setVolume(b.audio.SoundManager._musicMuted?0:b.audio.SoundManager.getMusicVolume()*b.audio.SoundManager.getMasterVolume())};b.audio.SoundManager.getSoundVolume=function(){return b.audio.SoundManager.getSoundMuted()?0:b.audio.SoundManager._soundVolume};b.audio.SoundManager.setSoundVolume=function(a){b.audio.SoundManager._soundVolume=a;a=b.audio.SoundManager._soundsPlaying.length;
for(var l=0;l<a;){var e=l++;b.audio.SoundManager._soundsPlaying[e].setVolume(b.audio.SoundManager._soundMuted?0:b.audio.SoundManager.getSoundVolume()*b.audio.SoundManager.getMasterVolume())}};b.audio.SoundManager.playSoundByName=function(a,l,e,c){null==c&&(c=!1);null==e&&(e=!1);null==l&&(l=!1);if(!b.audio.SoundManager.getIsWebkitEnabled()&&b.Root.isMobile()&&!l||!b.managers.AssetManager.assetExists(a))return null;a=b.audio.SoundManager.getIsWebkitEnabled()?new b.audio.WebkitSoundData(a,c?1:b.audio.SoundManager.getSoundVolume()*
b.audio.SoundManager.getMasterVolume(),e):new b.audio.Html5SoundData(a,c?1:b.audio.SoundManager.getSoundVolume()*b.audio.SoundManager.getMasterVolume(),e);a.play();b.audio.SoundManager._soundsPlaying.push(a);return a};b.audio.SoundManager.update=function(){for(var a=b.audio.SoundManager._soundsPlaying.length,l=0;l<a;){var e=l++,e=b.audio.SoundManager._soundsPlaying[e];null==e?b.audio.SoundManager.removeSoundFromPlayingSounds(e):e.update()}};b.audio.SoundManager.onSoundComplete=function(a){b.audio.SoundManager.removeSoundFromPlayingSounds(a.currentTarget)};
b.audio.SoundManager.removeSoundFromPlayingSounds=function(a){v.remove(b.audio.SoundManager._soundsPlaying,a)};b.audio.SoundManager.addSoundToPlayingSounds=function(a){b.audio.SoundManager._soundsPlaying.push(a)};b.audio.SoundManager.pauseAllSounds=function(){null!=b.audio.SoundManager._musicTrack.get()&&b.audio.SoundManager._musicTrack.get().pause();for(var a=b.audio.SoundManager._soundsPlaying.length,l=0;l<a;){var e=l++,e=b.audio.SoundManager._soundsPlaying[e];null!=e&&e.pause()}};b.audio.SoundManager.resumeAllSounds=
function(){for(var a=b.audio.SoundManager._soundsPlaying.length,l=[].concat(b.audio.SoundManager._soundsPlaying),e=0;e<a;){var c=e++;l[c].resume()}null!=b.audio.SoundManager._musicTrack.get()&&(b.audio.SoundManager._musicTrack.get().stop(),b.audio.SoundManager._musicTrack.get().resume())};b.audio.SoundManager.playMusicByNameOnMobileOnly=function(a){return b.Root.isMobile()?b.audio.SoundManager.playMusicByName(a,!0):null};b.audio.SoundManager.playMusicByName=function(a,l){null==l&&(l=!0);if(b.Root.isMobile()&&
!l)return null;if(!b.managers.AssetManager.assetExists(a))return b.utilities.Debug.log(a+" doesn't exist!"),null;null!=b.audio.SoundManager._musicTrack.get()&&b.audio.SoundManager._musicTrack.get().stop();var e;b.audio.SoundManager.getIsWebkitEnabled()?(e=new b.audio.WebkitSoundData(a,b.audio.SoundManager.getMasterVolume()*b.audio.SoundManager.getMusicVolume(),!0),e.play(0),b.audio.SoundManager._musicTrack.set(e)):(b.audio.SoundManager._musicTrack.set(new b.audio.Html5SoundData(a,b.audio.SoundManager.getMasterVolume()*
b.audio.SoundManager.getMusicVolume(),!0)),b.audio.SoundManager._musicTrack.get().play(),e=b.audio.SoundManager._musicTrack.get());b.audio.SoundManager.setMusicVolume(b.audio.SoundManager._musicVolume);b.audio.SoundManager._soundsPlaying.push(e);return e};b.audio.SoundManager.stopMusic=function(){null!=b.audio.SoundManager._musicTrack.get()&&(b.audio.SoundManager._musicTrack.get().stop(),b.audio.SoundManager._musicTrack=new b.utilities.WatchableValue(null))};b.audio.SoundManager.stopAllSounds=function(){for(var a=
b.audio.SoundManager._soundsPlaying.length-1;0<=a;){var l=b.audio.SoundManager._soundsPlaying[a];null!=l&&l.stop();b.audio.SoundManager.removeSoundFromPlayingSounds(l);a--}b.audio.SoundManager._soundsPlaying=[]};b.audio.SoundManager.prototype={__class__:b.audio.SoundManager};b.audio.WebkitSoundData=function(a,l,e){null==e&&(e=!1);null==l&&(l=1);this._audio=null;b.audio.SoundData.call(this,a,l,e)};b.audio.WebkitSoundData.__name__=["f84","audio","WebkitSoundData"];b.audio.WebkitSoundData.__super__=
b.audio.SoundData;b.audio.WebkitSoundData.prototype=r(b.audio.SoundData.prototype,{init:function(){b.audio.SoundData.prototype.init.call(this);this._audioContext=b.audio.SoundManager.getAudioContextInstance();this._audio=this._audioContext.createBufferSource();this._audio.buffer=b.managers.AssetManager.getAsset(this._soundName);null!=(J=this._audioContext,s(J,J.createGain))?this._gainNode=this._audioContext.createGain():this._gainNode=this._audioContext.createGainNode();this._audio.connect(this._gainNode,
0,0);this._gainNode.connect(this._audioContext.destination,0,0);this._audio.loop=this._loop;this._audio.id=this._soundName;this.setVolume(this._volume)},play:function(a){null==a&&(a=0);b.audio.SoundData.prototype.play.call(this,a);this._currentTime=a;try{null!=(J=this._audio,s(J,J.start))?this._audio.start(this._audioContext.currentTime,a):0==a?this._audio.noteOn():this._audio.noteGrainOn(this._audioContext.currentTime,a)}catch(l){this._audio.noteOn(this._audioContext.currentTime,a,this._audio.buffer.duration-
a)}},pause:function(){b.audio.SoundData.prototype.pause.call(this);null!=this._audio&&(null!=(J=this._audio,s(J,J.stop))?this._audio.stop(this._audioContext.currentTime):this._audio.noteOff(this._audioContext.currentTime),this._audio=null)},resume:function(){b.audio.SoundData.prototype.resume.call(this);this.stop();this.init();this.play(this._currentTime);b.audio.SoundManager.addSoundToPlayingSounds(this)},stop:function(){b.audio.SoundData.prototype.stop.call(this);null!=this._audio&&(null!=(J=this._audio,
s(J,J.stop))?this._audio.stop(0):this._audio.noteOff(this._audioContext.currentTime),this._audio=null,b.audio.SoundManager.removeSoundFromPlayingSounds(this))},getSoundLength:function(){return this._audio.buffer.duration},update:function(){b.audio.SoundData.prototype.update.call(this);this.getCurrentTime()>this.getSoundLength()&&!this.getLoop()?b.audio.SoundManager.removeSoundFromPlayingSounds(this):this.getCurrentTime()>this.getSoundLength()&&(this._currentTime-=this.getSoundLength())},onSoundComplete:function(){},
setVolume:function(a){b.audio.SoundData.prototype.setVolume.call(this,a);if(null!=this._audio&&null!=this._audio.gain||null!=this._gainNode)this._gainNode.gain.value=this._isMuted?0:a},setMuted:function(a){b.audio.SoundData.prototype.setMuted.call(this,a);this._gainNode.gain.value=this._isMuted?0:this._volume},__class__:b.audio.WebkitSoundData});b.box2d={};b.box2d.BodyMode={__ename__:!0,__constructs__:["FollowBox2dBody","FollowEntityVelocity","FollowEntityInstant"]};b.box2d.BodyMode.FollowBox2dBody=
["FollowBox2dBody",0];b.box2d.BodyMode.FollowBox2dBody.toString=D;b.box2d.BodyMode.FollowBox2dBody.__enum__=b.box2d.BodyMode;b.box2d.BodyMode.FollowEntityVelocity=["FollowEntityVelocity",1];b.box2d.BodyMode.FollowEntityVelocity.toString=D;b.box2d.BodyMode.FollowEntityVelocity.__enum__=b.box2d.BodyMode;b.box2d.BodyMode.FollowEntityInstant=["FollowEntityInstant",2];b.box2d.BodyMode.FollowEntityInstant.toString=D;b.box2d.BodyMode.FollowEntityInstant.__enum__=b.box2d.BodyMode;b.box2d.BodyMode.__empty_constructs__=
[b.box2d.BodyMode.FollowBox2dBody,b.box2d.BodyMode.FollowEntityVelocity,b.box2d.BodyMode.FollowEntityInstant];b.box2d.Box2dBody=function(a,l,e,c){this._ignoreRotation=!1;this._b2Body=this._b2BodyDef=this._b2Shape=this._b2FixtureDef=null;b.Component.call(this,a);this._bodyMode=b.box2d.BodyMode.FollowBox2dBody;this._b2BodyDef=l;this._b2Shape=e;this._b2FixtureDef=c;b.box2d.Box2dManager.getInstance().getPhysicsScale();this._b2Body=b.box2d.Box2dManager.getInstance().getB2World().createBody(this._b2BodyDef);
this._b2Body.setUserData({entity:this.getEntity()});this._b2FixtureDef.shape=this._b2Shape;this._b2Body.createFixture(this._b2FixtureDef);a=this.getEntity().getPosition();a=b.box2d.Box2dManager.getInstance().getPixelToWorld(a.x,a.y);this._b2Body.setPosition(a);this._entityOffset=new b.Vector2D};b.box2d.Box2dBody.__name__=["f84","box2d","Box2dBody"];b.box2d.Box2dBody.__super__=b.Component;b.box2d.Box2dBody.prototype=r(b.Component.prototype,{getEntityOffset:function(){return this._entityOffset},setEntityOffset:function(a){this._entityOffset=
a},setBox2dActive:function(a){this._b2Body.setActive(a)},init:function(){b.Component.prototype.init.call(this);this.updateEntityPosition()},getIgnoreRotation:function(){return this._ignoreRotation},setIgnoreRotation:function(a){this._ignoreRotation=a},onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._b2Body.setActive(!1)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._b2Body.setActive(!0);var a=this.getEntity().getPosition(),a=b.box2d.Box2dManager.getInstance().getPixelToWorld(a.x,
a.y);this._b2Body.setPosition(a)},getBodyMode:function(){return this._bodyMode},setBodyMode:function(a){this._bodyMode=a},setPosition:function(a,b){this._b2Body.setPosition(new d.common.math.B2Vec2(a,b))},getPosition:function(){return this._b2Body.getPosition()},getPixelPosition:function(){var a=b.box2d.Box2dManager.getInstance().getPhysicsScale(),l=this._b2Body.getPosition();return new b.Vector2D(l.x/a,l.y/a)},setPixelPosition:function(a,l){var e=b.box2d.Box2dManager.getInstance().getInversePhysicsScale();
this._b2Body.setPosition(new d.common.math.B2Vec2(a/e,l/e))},getB2Body:function(){return this._b2Body},update:function(){b.Component.prototype.update.call(this);var a=this.getEntity();if(this._bodyMode==b.box2d.BodyMode.FollowBox2dBody)this.updateEntityPosition(),this._ignoreRotation||a.setRotation(0,0,b.utilities.Math2.radToDeg(this._b2Body.getAngle()));else if(this._bodyMode==b.box2d.BodyMode.FollowEntityVelocity){var l=this.getEntity().getPosition(),l=b.box2d.Box2dManager.getInstance().getPixelToWorld(l.x,
l.y);this._b2Body.setLinearVelocity(new d.common.math.B2Vec2((l.x-this._b2Body.getPosition().x)/b.Root.getDeltaTime(),(l.y-this._b2Body.getPosition().y)/b.Root.getDeltaTime()));this._b2Body.setAngularVelocity((b.utilities.Math2.degToRad(a.getRotation().z)-this._b2Body.getAngle())/b.Root.getDeltaTime())}else l=this.getEntity().getPosition(),l=b.box2d.Box2dManager.getInstance().getPixelToWorld(l.x,l.y),this._b2Body.setPosition(new d.common.math.B2Vec2(l.x,l.y)),this._b2Body.setAngle(b.utilities.Math2.degToRad(a.getRotation().z))},
updateEntityPosition:function(){if(this._bodyMode==b.box2d.BodyMode.FollowBox2dBody){var a=this.getEntity(),l=this._b2Body.getPosition(),e=a.getPosition(),c=a.getLocalPosition(),c=e.subtract(c),d=b.box2d.Box2dManager.getInstance().getPhysicsScale();a.setPosition(l.x/d-c.x+this._entityOffset.x,l.y/d-c.y+this._entityOffset.y,e.z)}},destroy:function(){b.Component.prototype.destroy.call(this)},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);null!=this._b2Body&&(b.box2d.Box2dManager.getInstance().getB2World().destroyBody(this._b2Body),
this._b2Body=null)},__class__:b.box2d.Box2dBody});b.box2d.Box2dContactListener=function(){d.dynamics.B2ContactListener.call(this)};b.box2d.Box2dContactListener.__name__=["f84","box2d","Box2dContactListener"];b.box2d.Box2dContactListener.__super__=d.dynamics.B2ContactListener;b.box2d.Box2dContactListener.prototype=r(d.dynamics.B2ContactListener.prototype,{beginContact:function(a){d.dynamics.B2ContactListener.prototype.beginContact.call(this,a);var l=a.getFixtureA().getBody().getUserData().entity;null!=
l&&l.dispatchEvent(new b.box2d.Box2dEvent("beginContact",{contact:a}));l=a.getFixtureB().getBody().getUserData().entity;null!=l&&l.dispatchEvent(new b.box2d.Box2dEvent("beginContact",{contact:a}))},endContact:function(a){d.dynamics.B2ContactListener.prototype.endContact.call(this,a);var l=a.getFixtureA().getBody().getUserData().entity;null!=l&&l.dispatchEvent(new b.box2d.Box2dEvent("endContact",{contact:a}));l=a.getFixtureB().getBody().getUserData().entity;null!=l&&l.dispatchEvent(new b.box2d.Box2dEvent("endContact",
{contact:a}))},preSolve:function(a,b){d.dynamics.B2ContactListener.prototype.preSolve.call(this,a,b)},postSolve:function(a,b){d.dynamics.B2ContactListener.prototype.postSolve.call(this,a,b)},__class__:b.box2d.Box2dContactListener});b.box2d.Box2dEvent=function(a,l){this._data=null;b.events.Event.call(this,a);this._data=l};b.box2d.Box2dEvent.__name__=["f84","box2d","Box2dEvent"];b.box2d.Box2dEvent.__super__=b.events.Event;b.box2d.Box2dEvent.prototype=r(b.events.Event.prototype,{getData:function(){return this._data},
setData:function(a){this._data=a},__class__:b.box2d.Box2dEvent});b.box2d.Box2dManager=function(a,l,e,c){null==c&&(c=2);null==e&&(e=6);null==l&&(l="debug");this._debugLayerName="";this._physicsScale=0.03333333333333333;this._positionIterations=2;this._velocityIterations=6;this._b2World=this._gravity=null;b.Manager.call(this);null==a&&(a=new b.Vector2D(0,0));this._gravity=new d.common.math.B2Vec2(a.x,a.y);b.box2d.Box2dManager._instance=this;this._velocityIterations=e;this._positionIterations=c;this._debugLayerName=
l;this._b2World=new d.dynamics.B2World(this._gravity,!1)};b.box2d.Box2dManager.__name__=["f84","box2d","Box2dManager"];b.box2d.Box2dManager.getInstance=function(){return b.box2d.Box2dManager._instance};b.box2d.Box2dManager.__super__=b.Manager;b.box2d.Box2dManager.prototype=r(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this);this._debugDrawLayer=b.Root.getInstance().getLayerByName(this._debugLayerName);this._debugDraw=new d.dynamics.B2DebugDraw;this._debugDraw.setSprite(this._debugDrawLayer.getCanvas().getContext("2d"));
this._debugDraw.setDrawScale(30);this._debugDraw.setLineThickness(1);this._debugDraw.setAlpha(0.5);this._debugDraw.setFillAlpha(0.1);this._debugDraw.setFlags(d.dynamics.B2DebugDraw.e_shapeBit);this._b2World.setDebugDraw(this._debugDraw);this._b2World.setContactListener(new b.box2d.Box2dContactListener)},getB2World:function(){return this._b2World},getGravity:function(){return this._gravity},setGravity:function(a){this._gravity=a;this._b2World.setGravity(a);return a},getPhysicsScale:function(){return this._physicsScale},
getInversePhysicsScale:function(){return 1/this._physicsScale},setPhysicsScale:function(a){this._physicsScale=a},update:function(){b.Manager.prototype.update.call(this);this.dispatchEvent(new b.box2d.Box2dManagerEvent("preUpdate"));for(var a=Math.max(1,Math.floor(b.Root.getDeltaTime()/(1/60))),l=0;l<a;)l++,this._b2World.step(1/60,this._velocityIterations,this._positionIterations),this._b2World.clearForces();this.dispatchEvent(new b.box2d.Box2dManagerEvent("update"))},getPixelToWorld:function(a,b){return new d.common.math.B2Vec2(a*
this._physicsScale,b*this._physicsScale)},getWorldToPixel:function(a,l){return new b.Vector2D(a/this._physicsScale,l/this._physicsScale)},debugRender:function(){b.Manager.prototype.debugRender.call(this);this._b2World.drawDebugData();this._debugDrawLayer.setWholeCanvasDirty(!0)},__class__:b.box2d.Box2dManager});b.box2d.Box2dManagerEvent=function(a){b.events.Event.call(this,a)};b.box2d.Box2dManagerEvent.__name__=["f84","box2d","Box2dManagerEvent"];b.box2d.Box2dManagerEvent.__super__=b.events.Event;
b.box2d.Box2dManagerEvent.prototype=r(b.events.Event.prototype,{__class__:b.box2d.Box2dManagerEvent});b.box2d.Box2dRaycastInfo=function(a,b,e){this.point=a;this.normal=b;this.fixture=e};b.box2d.Box2dRaycastInfo.__name__=["f84","box2d","Box2dRaycastInfo"];b.box2d.Box2dRaycastInfo.prototype={__class__:b.box2d.Box2dRaycastInfo};b.box2d.Box2dRaycastUtil=function(){};b.box2d.Box2dRaycastUtil.__name__=["f84","box2d","Box2dRaycastUtil"];b.box2d.Box2dRaycastUtil.raycastClosest=function(a,l){b.box2d.Box2dRaycastUtil._relevantRaycastInfo=
null;b.box2d.Box2dManager.getInstance().getB2World().rayCast(b.box2d.Box2dRaycastUtil.raycastClosestCallback,a,l);return b.box2d.Box2dRaycastUtil._relevantRaycastInfo};b.box2d.Box2dRaycastUtil.raycastClosestPixel=function(a,l){return b.box2d.Box2dRaycastUtil.raycastClosest(b.box2d.Box2dManager.getInstance().getPixelToWorld(a.x,a.y),b.box2d.Box2dManager.getInstance().getPixelToWorld(l.x,l.y))};b.box2d.Box2dRaycastUtil.raycastClosestCallback=function(a,l,e,c){b.box2d.Box2dRaycastUtil._relevantRaycastInfo=
new b.box2d.Box2dRaycastInfo(l,e,a);return c};b.collision={};b.collision.Collision=function(){this.layers=[];this.ul=new b.Vector2D;this.wh=new b.Vector2D};b.collision.Collision.__name__=["f84","collision","Collision"];b.collision.Collision.prototype={hasLayer:function(a){for(var b=this.layers.length,e=0;e<b;){var c=e++;if(this.layers[c]==a)return!0}return!1},getClone:function(){var a=new b.collision.Collision;a.ul=this.ul.getClone();a.wh=this.wh.getClone();for(var l=this.layers.length,e=0;e<l;){var c=
e++;a.layers.push(this.layers[c])}return a},checkPointIntersect:function(a){return!1},getRaycastPoint:function(a,b,e,c,d){return-1},__class__:b.collision.Collision};b.collision.BoxCollision=function(a,l,e,c){b.collision.Collision.call(this);this.ul=new b.Vector2D(a,l);this.wh=new b.Vector2D(e,c)};b.collision.BoxCollision.__name__=["f84","collision","BoxCollision"];b.collision.BoxCollision.__super__=b.collision.Collision;b.collision.BoxCollision.prototype=r(b.collision.Collision.prototype,{checkPointIntersect:function(a){b.collision.Collision.prototype.checkPointIntersect.call(this,
a);return a.x>=this.ul.x&&a.y>=this.ul.y&&a.x<=this.ul.x+this.wh.x&&a.y<=this.ul.y+this.wh.y},checkBoxIntersect:function(a){return!0},getRaycastPoint:function(a,l,e,c,d){null==c&&(c=!1);d=new b.Vector2D;for(var g=[new b.Vector2D(this.ul.x,this.ul.y),new b.Vector2D(this.ul.x+this.wh.x,this.ul.y),new b.Vector2D(this.ul.x+this.wh.x,this.ul.y+this.wh.y),new b.Vector2D(this.ul.x,this.ul.y+this.wh.y)],h=-1,k=0,m=g.length-1;k<m;){var p=k++,p=b.utilities.Math2.lineIntersect2D(a,l,g[p],g[p+1],d);if(0<p)if(c){if(-1==
h||p<h)e.x=d.x,e.y=d.y,h=p}else return e.x=d.x,e.y=d.y,p}a=b.utilities.Math2.lineIntersect2D(a,l,g[0],g[g.length-1],d);if(0<a)if(c){if(-1==h||a<h)e.x=d.x,e.y=d.y,h=a}else return e.x=d.x,e.y=d.y,a;return h},getClone:function(){return null},__class__:b.collision.BoxCollision});b.collision.PolygonCollision=function(){this._lowestPoint=this._highestPoint=null;b.collision.Collision.call(this);this._lowestPoint=new b.Vector2D(999999,999999);this._highestPoint=new b.Vector2D(-999999,-999999);this._points=
[]};b.collision.PolygonCollision.__name__=["f84","collision","PolygonCollision"];b.collision.PolygonCollision.__super__=b.collision.Collision;b.collision.PolygonCollision.prototype=r(b.collision.Collision.prototype,{addPoint:function(a,l){this._points.push(new b.Vector2D(a,l));a<this._lowestPoint.x&&(this._lowestPoint.x=a);l<this._lowestPoint.y&&(this._lowestPoint.y=l);a>this._highestPoint.x&&(this._highestPoint.x=a);l>this._highestPoint.y&&(this._highestPoint.y=l)},getPoints:function(){return this._points},
checkPointIntersect:function(a){for(var b=this._points.length,e=0,c=!1,d=null,g=null;e<b;){d=this._points[e].getClone();g=this._points[(e+1)%b].getClone();d.x+=this.ul.x;d.y+=this.ul.y;g.x+=this.ul.x;g.y+=this.ul.y;if(0==e)c=0<(a.y-d.y)*(g.x-d.x)-(a.x-d.x)*(g.y-d.y);else if(c&&0>(a.y-d.y)*(g.x-d.x)-(a.x-d.x)*(g.y-d.y)||!c&&0<(a.y-d.y)*(g.x-d.x)-(a.x-d.x)*(g.y-d.y))return!1;e++}return!0},getRaycastPoint:function(a,l,e,c,d){null==c&&(c=!1);var g=new b.Rect2D;g.ul=this._lowestPoint.getClone();g.wh=new b.Vector2D(this._highestPoint.x-
this._lowestPoint.x,this._highestPoint.y-this._lowestPoint.y);g.ul.x+=this.ul.x;g.ul.y+=this.ul.y;var h=Math.abs(l.x-a.x),k=Math.abs(l.y-a.y),h=new b.Rect2D(a.x<l.x?a.x:l.x,a.y<l.y?a.y:l.y,h,k);if(!g.getIntersect(h))return-1;for(var g=new b.Vector2D,k=this._points,h=-1,m=0,p=k.length-1;m<p;){var q=m++,r=k[q].getClone();r.x+=this.ul.x;r.y+=this.ul.y;var s=k[q+1].getClone();s.x+=this.ul.x;s.y+=this.ul.y;q=b.utilities.Math2.lineIntersect2D(a,l,r,s,g);if(0<q)if(c){if(-1==h||q<h)e.x=g.x,e.y=g.y,null!=
d&&(h=(new b.Vector2D(s.y-r.y,r.x-s.x)).getNormalized(),d.x=h.x,d.y=h.y,0<(new b.Vector2D(l.x-a.x,l.y-a.y)).dotProduct(d)&&(d.x*=-1,d.y*=-1)),h=q}else return e.x=g.x,e.y=g.y,null!=d&&(e=(new b.Vector2D(s.y-r.y,r.x-s.x)).getNormalized(),d.x=e.x,d.y=e.y,0<(new b.Vector2D(l.x-a.x,l.y-a.y)).dotProduct(d)&&(d.x*=-1,d.y*=-1)),q}m=k[0].getClone();m.x+=this.ul.x;m.y+=this.ul.y;p=k[k.length-1].getClone();p.x+=this.ul.x;p.y+=this.ul.y;k=b.utilities.Math2.lineIntersect2D(a,l,m,p,g);if(0<k)if(c){if(-1==h||k<
h)e.x=g.x,e.y=g.y,null!=d&&(e=(new b.Vector2D(p.y-m.y,m.x-p.x)).getNormalized(),d.x=e.x,d.y=e.y,0<(new b.Vector2D(l.x-a.x,l.y-a.y)).dotProduct(d)&&(d.x*=-1,d.y*=-1)),h=k}else return e.x=g.x,e.y=g.y,null!=d&&(e=(new b.Vector2D(p.y-m.y,m.x-p.x)).getNormalized(),d.x=e.x,d.y=e.y,0<(new b.Vector2D(l.x-a.x,l.y-a.y)).dotProduct(d)&&(d.x*=-1,d.y*=-1)),k;return h},getClone:function(){return null},__class__:b.collision.PolygonCollision});b.components={};b.components.AlphaBlinker=function(a,l){this._alphaValues=
null;this._timeUntilNext=this._currentLevel=this._blinkDurationLeft=0;this._timePerLevel=0.15;b.Component.call(this,a);this._alphaValues=l};b.components.AlphaBlinker.__name__=["f84","components","AlphaBlinker"];b.components.AlphaBlinker.__super__=b.Component;b.components.AlphaBlinker.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},injectBlinkDuration:function(a){this._blinkDurationLeft=a},setTimePerLevel:function(a){this._timePerLevel=a},setAlpha:function(a){var l=
this.getEntity().getComponent(b.pixi.PixiContainer);null!=l&&(l.getContainer().alpha=a)},update:function(){b.Component.prototype.update.call(this);0<this._blinkDurationLeft&&(this._blinkDurationLeft-=b.Root.getDeltaTime(),this._timeUntilNext-=b.Root.getDeltaTime(),0>=this._timeUntilNext&&(this._timeUntilNext=this._timePerLevel,this._currentLevel++,this._currentLevel>this._alphaValues.length-1&&(this._currentLevel=0)),this.setAlpha(this._alphaValues[this._currentLevel]),0>=this._blinkDurationLeft&&
(this.setAlpha(1),this._blinkDurationLeft=0))},__class__:b.components.AlphaBlinker});b.components.AlphaPulser=function(a,l){this._theta=this._rate=0;b.Component.call(this,a);this._rate=l};b.components.AlphaPulser.__name__=["f84","components","AlphaPulser"];b.components.AlphaPulser.__super__=b.Component;b.components.AlphaPulser.prototype=r(b.Component.prototype,{setRate:function(a){this._rate=a},update:function(){b.Component.prototype.update.call(this);this._theta+=this._rate*b.Root.getDeltaTime();
this._theta>=Math.PI&&(this._theta-=Math.PI);var a=Math.sin(this._theta),l=this.getEntity().getComponent(b.pixi.PixiContainer);null!=l&&(l.getContainer().alpha=a)},__class__:b.components.AlphaPulser});b.components.Animation=function(a,l,e){this._fps=30;this._loop=!0;this._length=0;this._name=a;this._animationKeyframes=[];null!=l&&(this._length=l);this._offset=new b.Vector2D};b.components.Animation.__name__=["f84","components","Animation"];b.components.Animation.parseFromXmlString=function(a,l){for(var e=
B.parse(l),c=e.elementsNamed("animation").next().get("name"),c=new b.components.Animation(c,e.elementsNamed("animation").next().get("length")),e=e.elementsNamed("animation").next().elementsNamed("keyframe");e.hasNext();){var d=e.next(),d=new b.components.flashAnimation.AnimationKeyframe(d.get("index"),d.get("spriteIndex"),a);c.addKeyframe(d)}b.managers.AnimationManager.getInstance().registerAnimation(c);return c};b.components.Animation.makeLinearAnimationFromSheet=function(a,l,e,c,d){null==d&&(d=
0);null==c&&(c=-1);var g=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(l);-1==c&&(c=g.getNumSprites());a=new b.components.Animation(a,c*e);for(g=0;g<c;){var h=g++,h=new b.components.flashAnimation.AnimationKeyframe(d,h,l);a.addKeyframe(h);d+=e}b.managers.AnimationManager.getInstance().registerAnimation(a);return a};b.components.Animation.makeLinearAnimationFromSheetBySpriteName=function(a,l,e,c,d,g,h){null==h&&(h=0);null==g&&(g=-1);null==d&&(d=!1);var k=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(l),
m=k.getNumSprites();-1==g&&(g=m);for(var p=0,q=0;q<g;){var r=q++;C.startsWith(k.getSpriteInfoByIndex(r).getName(),e)&&p++}a=new b.components.Animation(a,p*c);for(q=p=0;q<m&&!(r=q++,C.startsWith(k.getSpriteInfoByIndex(r).getName(),e)&&(r=new b.components.flashAnimation.AnimationKeyframe(h,r,l),a.addKeyframe(r),h+=c,p++,p>=g)););a.setLoop(d);b.managers.AnimationManager.getInstance().registerAnimation(a);return a};b.components.Animation.prototype={getAnimationKeyframes:function(){return this._animationKeyframes},
getKeyframeLength:function(){return this._length},getLength:function(){return this._length/this._fps},getName:function(){return this._name},getLoop:function(){return this._loop},setLoop:function(a){this._loop=a},getOffset:function(){return this._offset},setOffset:function(a,b){this._offset.x=a;this._offset.y=b},addKeyframe:function(a){this._animationKeyframes.push(a);var b=a.getPosition();this._length=Math.max(this._length,a.getPosition());b>this._length&&(this._length=b)},getSpriteIndexAtPosition:function(a){for(var b=
this._animationKeyframes.length,e=this._animationKeyframes[0].getSpriteIndex(),c=0;c<b;){var d=c++;if(a>=this._animationKeyframes[d].getPosition()/this._fps)e=this._animationKeyframes[d].getSpriteIndex();else break}return e},getSpriteSheetNameAtPosition:function(a){for(var b=this._animationKeyframes.length,e=this._animationKeyframes[0].getSpriteSheetName(),c=0;c<b;){var d=c++;if(a>=this._animationKeyframes[d].getPosition()/this._fps)e=this._animationKeyframes[d].getSpriteSheetName();else break}return e},
__class__:b.components.Animation};b.components.Button=function(a,l,e,c,d){this._inactiveOneFrame=!1;this._killMessageOnMouseDown=!0;this._isMouseOver=!1;this._handPointer=!0;this._onClicked=this._onMouseDown=this._onMouseUp=this._onMouseMoved=this._onMouseOver=this._onMouseOut=null;b.Component.call(this,a);this._boxCollision=new b.collision.BoxCollision(0,0,0,0);this._collisionSize=l;this._collisionOffset=e;this._camera=d;this.setOnMouseDown(c)};b.components.Button.__name__=["f84","components","Button"];
b.components.Button.createFromHTMLElement=function(a){return new b.components.Button(a.getEntity(),a.getSize(),new b.Vector2D(0,0))};b.components.Button.createFromHTMLElementID=function(a,c,e){null==e&&(e=0);c=q.getDocument().getElementById(c);var d=c.clientWidth+e,n=c.clientHeight+e;return new b.components.Button(a,new b.Vector2D(d,n),new b.Vector2D(c.offsetLeft-a.getPosition().x-e/2+d/2,c.offsetTop-a.getPosition().y-e/2+n/2))};b.components.Button.createFromEdgeHTMLElementID=function(a,c,e,d){null==
d&&(d=0);var n=q.getDocument().getElementById(c);c=t.parseInt(n.style.width)+d;var g=t.parseInt(n.style.height)+d,h=b.components.HtmlElements.getStylePositionOfDomElement(n).y-d/2;d=b.components.HtmlElements.getStylePositionOfDomElement(n).x-d/2;return new b.components.Button(a,new b.Vector2D(c,g),new b.Vector2D(d-a.getPosition().x+c/2,h-a.getPosition().y+g/2),e)};b.components.Button.createFromGameImage=function(a){return new b.components.Button(a.getEntity(),a.getSize(),null)};b.components.Button.createFromPixiSprite=
function(a){return new b.components.Button(a.getEntity(),new b.Vector2D(a.getSprite().texture.width,a.getSprite().texture.height),null)};b.components.Button.__super__=b.Component;b.components.Button.prototype=r(b.Component.prototype,{getHandPointer:function(){return this._handPointer},setHandPointer:function(a){this._handPointer=a},getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},setOnClicked:function(a){this._onClicked=a},setOnMouseDown:function(a){this._onMouseDown=
a},setOnMouseMoved:function(a){this._onMouseMoved=a},setOnMouseUp:function(a){this._onMouseUp=a},setOnMouseOut:function(a){this._onMouseOut=a},getKillMessageOnMouseDown:function(){return this._killMessageOnMouseDown},setKillMessageOnMouseDown:function(a){this._killMessageOnMouseDown=a},getData:function(){return this._data},getCollision:function(){return this._boxCollision},getCollisionSize:function(){return this._collisionSize},setData:function(a){this._data=a},init:function(){b.Component.prototype.init.call(this);
this._prevPosition=new b.Vector2D(this.getEntity().getLocalPosition().x,this.getEntity().getPosition().y);this.updateCollision()},update:function(){b.Component.prototype.update.call(this);this._inactiveOneFrame=!1;!1==this.getEntity().getIsVisible()&&(this._inactiveOneFrame=!0);this.updateCollision()},setOffset:function(a,c){this._collisionOffset=new b.Vector2D(a,c)},getOffset:function(){return this._collisionOffset},updateCollision:function(){var a=this.getEntity().getPosition();this._boxCollision.ul.x=
a.x-this._collisionSize.x/2;this._boxCollision.ul.y=a.y-this._collisionSize.y/2;this._boxCollision.wh.x=this._collisionSize.x;this._boxCollision.wh.y=this._collisionSize.y;null!=this._collisionOffset&&(this._boxCollision.ul.x+=this._collisionOffset.x,this._boxCollision.ul.y+=this._collisionOffset.y)},onMouseClick:function(a){a=a.getClone();a.x>b.Root.getInstance().getScreenSize().x||(0>a.x||a.y>b.Root.getInstance().getScreenSize().y||0>a.y)||(null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*
this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale())),this._boxCollision.checkPointIntersect(a)&&(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseClick",{button:this,entity:this.getEntity()})),null!=this._onClicked&&this._onClicked(this)))},onMouseDown:function(a){a=a.getClone();if(a.x>b.Root.getInstance().getScreenSize().x||0>a.x||a.y>b.Root.getInstance().getScreenSize().y||
0>a.y)return!1;null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));return this._boxCollision.checkPointIntersect(a)?(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseDown",{button:this,entity:this.getEntity()})),null!=this._onMouseDown&&this._onMouseDown(this),b.Root.isMobile()&&(this._isMouseOver=
!0),!0):!1},onMouseMoved:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));if(this._boxCollision.checkPointIntersect(a)){this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOver",{button:this,entity:this.getEntity()}));if(!this._isMouseOver)this.onMouseOver(a);this._isMouseOver=
!0;this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseMove",{button:this,entity:this.getEntity()}));null!=this._onMouseMoved&&this._onMouseMoved(this)}else this._isMouseOver&&!b.Root.isMobile()&&(this.onMouseOut(a),this._isMouseOver=!1)},onMouseUp:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));
this._boxCollision.checkPointIntersect(a)&&(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseUp",{button:this,entity:this.getEntity()})),null!=this._onMouseUp&&this._onMouseUp(this),b.Root.isMobile()&&(this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOut",{button:this,entity:this.getEntity()})),null!=this._onMouseOut&&this._onMouseOut(this)))},onMouseOver:function(a){a=a.getClone();null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*this._camera.getZoomScale(),
a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale()));this._handPointer&&(q.getDocument().body.style.cursor="pointer");this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOver",{button:this,entity:this.getEntity()}));null!=this._onMouseOver&&this._onMouseOver(this);this._isMouseOver=!0},onMouseOut:function(a){null!=a&&(a=a.getClone(),null!=this._camera&&(a.x+=this._camera.getEntity().getPosition().x*
this._camera.getZoomScale(),a.y+=this._camera.getEntity().getPosition().y*this._camera.getZoomScale(),a.scaleBy(1/this._camera.getZoomScale(),1/this._camera.getZoomScale())),this._handPointer&&(q.getDocument().body.style.cursor="default"),this.getEntity().dispatchEvent(new b.events.EntityEvent("mouseOut",{button:this,entity:this.getEntity()})),null!=this._onMouseOut&&this._onMouseOut(this),this._isMouseOver=!1)},verifyTouches:function(a){var c=!1;if(null!=a&&null!=a.touches){for(var e=a.touches.length,
d=0;d<e;){var n=d++,g=a.touches[n],h=b.Root.getInstance().getScreenOffset(),n=(g.pageX-h.x)/b.Root.getInstance().getScreenScale().x,g=(g.pageY-h.y)/b.Root.getInstance().getScreenScale().y;this._boxCollision.checkPointIntersect(new b.Vector2D(n,g))&&(c=!0)}if(!c&&this._isMouseOver)this.onMouseOut(null);else if(c&&!this._isMouseOver)this.onMouseOver(null)}},setCollisionProperties:function(a,b){this._collisionSize=a;this._collisionOffset=b},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,
a,c);if((!c||!c.isDisabled)&&(this.getEntity().getIsVisible()&&this.getIsActive())&&!this._inactiveOneFrame)switch(a){case "mouseClick":this.onMouseClick(c);break;case "mouseDown":this.onMouseDown(c)&&this._killMessageOnMouseDown&&(c.isDisabled=!0);break;case "mouseUp":this.onMouseUp(c);break;case "mouseMove":this.onMouseMoved(c);break;case "verifyTouches":this.verifyTouches(c)}},activate:function(){b.Component.prototype.activate.call(this);this._inactiveOneFrame=!0},deactivate:function(){b.Component.prototype.deactivate.call(this);
this._isMouseOver&&this._handPointer&&(q.getDocument().body.style.cursor="default")},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var c=b.components.Camera.getDebugCamera().getEntity();a.translate(-c.getPosition().x,-c.getPosition().y)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(this._boxCollision.ul.x,this._boxCollision.ul.y);
a.lineTo(this._boxCollision.ul.x+this._boxCollision.wh.x,this._boxCollision.ul.y);a.lineTo(this._boxCollision.ul.x+this._boxCollision.wh.x,this._boxCollision.ul.y+this._boxCollision.wh.y);a.lineTo(this._boxCollision.ul.x,this._boxCollision.ul.y+this._boxCollision.wh.y);a.lineTo(this._boxCollision.ul.x,this._boxCollision.ul.y);a.stroke();a.restore()},destroy:function(){b.Component.prototype.destroy.call(this);if(this._isMouseOver)this.onMouseOut(null)},__class__:b.components.Button});b.components.Camera=
function(a){this._offset=this._additionalOffset=null;this._zoomScale=1;this._target=this._cameraBounds=this._slackMovement=null;b.Component.call(this,a);this._offset=new b.Vector2D;this._additionalOffset=new b.Vector2D;this._lensWidth=b.Root.getInstance().getScreenSize().x;this._lensHeight=b.Root.getInstance().getScreenSize().y;b.components.Camera._debugCamera=this};b.components.Camera.__name__=["f84","components","Camera"];b.components.Camera.getDebugCamera=function(){return b.components.Camera._debugCamera};
b.components.Camera.__super__=b.Component;b.components.Camera.prototype=r(b.Component.prototype,{getTarget:function(){return this._target},setTarget:function(a){null!=this._target&&this._target.removeEventListener("destroy",s(this,this.onTargetDestroy));this._target=a;null!=this._target&&this._target.addEventListener("destroy",s(this,this.onTargetDestroy))},setOffset:function(a){this._offset=a},getOffset:function(){return this._offset},getAdditionalOffset:function(){return this._additionalOffset},
setAdditionalOffset:function(a){this._additionalOffset.x=a.x;this._additionalOffset.y=a.y},getZoomScale:function(){return this._zoomScale},setZoomScale:function(a){this._zoomScale=a},getLensSize:function(){return new b.Vector2D(this._lensWidth,this._lensHeight)},setLensSize:function(a,b){this._lensWidth=a;this._lensHeight=b},init:function(){b.Component.prototype.init.call(this);this._slackMovement=this.getSiblingComponent(b.components.SlackMovement)},getSlackMovement:function(){return this._slackMovement},
jumpToTarget:function(){null!=this._target&&this.getEntity().setPosition(this._target.getPosition().x-this._lensWidth/this._zoomScale/2+(this._offset.x+this._additionalOffset.x)/this._zoomScale,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+(this._offset.y+this._additionalOffset.y)/this._zoomScale,this.getEntity().getPosition().z)},jumpToTargetX:function(){null!=this._target&&this.getEntity().setPosition(this._target.getPosition().x-this._lensWidth/this._zoomScale/2+(this._offset.x+
this._additionalOffset.x)/this._zoomScale,this.getEntity().getLocalPosition().y,this.getEntity().getPosition().z)},jumpToTargetY:function(){null!=this._target&&this.getEntity().setPosition(this.getEntity().getLocalPosition().x,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+(this._offset.y+this._additionalOffset.y)/this._zoomScale,this.getEntity().getPosition().z)},getCenter:function(){var a=this.getEntity().getPosition();return new b.Vector3D(a.x-this._lensWidth/this._zoomScale/2,
a.y-this._lensHeight/this._zoomScale/2,a.z)},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);null!=this._target&&(null==this._slackMovement?this.getEntity().setPosition(this._target.getPosition().x-this._lensWidth/this._zoomScale/2+(this._offset.x+this._additionalOffset.x)/this._zoomScale,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+(this._offset.y+this._additionalOffset.y)/this._zoomScale,this.getEntity().getPosition().z):this._slackMovement.setTarget(this._target.getPosition().x-
this._lensWidth/this._zoomScale/2+(this._offset.x+this._additionalOffset.x)/this._zoomScale,this._target.getPosition().y-this._lensHeight/this._zoomScale/2+(this._offset.y+this._additionalOffset.y)/this._zoomScale,this.getEntity().getPosition().z))},postUpdate:function(){b.Component.prototype.postUpdate.call(this);this.updateCameraBounds()},update:function(){b.Component.prototype.update.call(this)},updateCameraBounds:function(){if(null!=this._cameraBounds){var a=this.getEntity().getPosition().getClone(),
c=this._lensWidth/2/this._zoomScale,e=this._lensHeight/2/this._zoomScale,d=new b.Vector2D(a.x+c,a.y+e),n=!1;d.x-c<this._cameraBounds.ul.x&&(d.x=this._cameraBounds.ul.x+c,n=!0);d.y-e<this._cameraBounds.ul.y&&(d.y=this._cameraBounds.ul.y+e,n=!0);d.x+c>this._cameraBounds.ul.x+this._cameraBounds.wh.x&&(d.x=this._cameraBounds.ul.x+this._cameraBounds.wh.x-c,n=!0);d.y+e>this._cameraBounds.ul.y+this._cameraBounds.wh.y&&(d.y=this._cameraBounds.ul.y+this._cameraBounds.wh.y-e,n=!0);a.x=d.x-c;a.y=d.y-e;n&&this.getEntity().setPosition(a.x,
a.y,a.z)}},getPointConstrainedToCameraBounds:function(a,c){if(null!=this._cameraBounds){var e=new b.Vector3D(a,c),d=this._lensWidth/2/this._zoomScale,n=this._lensHeight/2/this._zoomScale,g=new b.Vector2D(a+this._offset.x+this._additionalOffset.x,c+this._offset.y+this._additionalOffset.y),h=!1;g.x-d<this._cameraBounds.ul.x&&(g.x=this._cameraBounds.ul.x+d,h=!0);g.y-n<this._cameraBounds.ul.y&&(g.y=this._cameraBounds.ul.y+n,h=!0);g.x+d>this._cameraBounds.ul.x+this._cameraBounds.wh.x&&(g.x=this._cameraBounds.ul.x+
this._cameraBounds.wh.x-d,h=!0);g.y+n>this._cameraBounds.ul.y+this._cameraBounds.wh.y&&(g.y=this._cameraBounds.ul.y+this._cameraBounds.wh.y-n,h=!0);a=g.x;c=g.y;h&&this.getEntity().setPosition(e.x,e.y,e.z)}return new b.Vector2D(a,c)},getBounds:function(){return this._cameraBounds},setBounds:function(a,c,e,d){this._cameraBounds=new b.Rect2D(a,c,e-a,d-c)},getViewBounds:function(){var a=this.getEntity().getPosition();return new b.Rect2D(a.x,a.y,2*(this._lensWidth/2/this._zoomScale),2*(this._lensHeight/
2/this._zoomScale))},destroyBounds:function(){this._cameraBounds=null},destroy:function(){b.Component.prototype.destroy.call(this);b.components.Camera._debugCamera==this&&(b.components.Camera._debugCamera=null)},onTargetDestroy:function(){this.setTarget(null)},__class__:b.components.Camera});b.components.Collider=function(a,c){this._offset=this._onEnter=this._onInside=this._onExit=null;b.Component.call(this,a);this._offset=c};b.components.Collider.__name__=["f84","components","Collider"];b.components.Collider.__super__=
b.Component;b.components.Collider.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);b.managers.PhysicsManager.getInstance().registerCollider(this)},getCollision:function(){return null},checkPointIntersect:function(a){return!1},update:function(){b.Component.prototype.update.call(this)},getRaycastPoint:function(a,c,e,d,n){b.managers.PhysicsManager.getInstance().dispatchEvent(new b.events.RaycastCheckEvent("raycastCheck",a,c));return-1},debugRender:function(){b.Component.prototype.debugRender.call(this)},
setOnEnter:function(a){this._onEnter=a},setOnExit:function(a){this._onExit=a},setOnInside:function(a){this._onInside=a},onEnter:function(a){this._isActive&&null!=this._onEnter&&this._onEnter(a,this)},onInside:function(a){this._isActive&&null!=this._onInside&&this._onInside(a,this)},onExit:function(a){this._isActive&&null!=this._onExit&&this._onExit(a,this)},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);b.managers.PhysicsManager.getInstance().removeCollider(this)},__class__:b.components.Collider});
b.components.DeferredAction=function(a,b,e,c){null==c&&(c=!1);this.isPaused=this.repeating=!1;this.timeUntilExecute=a;this.actionToExecute=b;this.params=e;this.repeating=c;this.duration=a};b.components.DeferredAction.__name__=["f84","components","DeferredAction"];b.components.DeferredAction.prototype={update:function(){this.isPaused||(this.timeUntilExecute-=b.Root.getDeltaTime())},__class__:b.components.DeferredAction};b.components.DeferredActionComponent=function(a){b.Component.call(this,a);this._deferredActions=
[]};b.components.DeferredActionComponent.__name__=["f84","components","DeferredActionComponent"];b.components.DeferredActionComponent.__super__=b.Component;b.components.DeferredActionComponent.prototype=r(b.Component.prototype,{update:function(){b.Component.prototype.update.call(this);for(var a=this._deferredActions.length-1;0<=a;){var c=this._deferredActions[a];null==c?v.remove(this._deferredActions,c):(c.update(),0>=c.timeUntilExecute&&(c.actionToExecute(c.params),c.repeating?c.timeUntilExecute=
c.duration:v.remove(this._deferredActions,c)),a--,a>this._deferredActions.length-1&&(a=this._deferredActions.length-1))}},addDeferredAction:function(a,c,e){a=new b.components.DeferredAction(a,c,e);this._deferredActions.push(a);return a},removeDeferredAction:function(a){v.remove(this._deferredActions,a)},destroyAllDeferredActions:function(){this._deferredActions=[]},__class__:b.components.DeferredActionComponent});b.components.FollowEntity=function(a,c,e){this._followLocal=!1;this._followX=this._followY=
!0;this._offset=this._target=null;b.Component.call(this,a);this._target=c;this._offset=null!=e?e:new b.Vector3D;this.updatePosition()};b.components.FollowEntity.__name__=["f84","components","FollowEntity"];b.components.FollowEntity.__super__=b.Component;b.components.FollowEntity.prototype=r(b.Component.prototype,{getFollowLocal:function(){return this._followLocal},setFollowLocal:function(a){this._followLocal=a},getOffset:function(){return this._offset},setOffset:function(a){this._offset=a},getTarget:function(){return this._target},
setTarget:function(a){this._target=a},getFollowX:function(){return this._followX},setFollowX:function(a){this._followX=a},getFollowY:function(){return this._followY},setFollowY:function(a){this._followY=a},fixedUpdate:function(){b.Component.prototype.update.call(this);this.updatePosition()},updatePosition:function(){var a=null,a=this._followLocal?this._target.getLocalPosition():this._target.getPosition();this._followX||(a.x=this.getEntity().getLocalPosition().x);this._followY||(a.y=this.getEntity().getLocalPosition().y);
this.getEntity().setPosition(a.x+this._offset.x,a.y+this._offset.y,a.z+this._offset.z)},__class__:b.components.FollowEntity});b.components.GameImage=function(a,c,e,d){this._context=this._image=this._cachedSize=this._clipRect=null;this._forceRenderRequired=!1;this._skew=this._rotation=this._spriteInfo=this._coords=null;this._alpha=1;this._maskFunction=null;this._imageName="";this.IsLargeImage=!1;b.Component.call(this,a);this._imageName=c;this._layer=e;this._cameraPositionScale=new b.Vector2D(1,1);
this._pivotPoint=new b.Vector2D;this._camera=d;this._offset=new b.Vector2D;this._scale=new b.Vector3D(1,1,1);this._skew=new b.Vector2D;this._rotation=new b.Vector3D(0,0,0);this._clipRect=null};b.components.GameImage.__name__=["f84","components","GameImage"];b.components.GameImage.__super__=b.Component;b.components.GameImage.prototype=r(b.Component.prototype,{getClipRect:function(){return this._clipRect},setClipRect:function(a){1>a.wh.x&&(a.wh.x=1);1>a.wh.y&&(a.wh.y=1);this._clipRect=a},getCamera:function(){return this._camera},
setCamera:function(a){this._camera=a},getCoords:function(){return this._coords},setCoords:function(a){this._coords=a},getRotation:function(){return this._rotation},setRotation:function(a){this._rotation=a},setSpriteInfo:function(a){this._spriteInfo=a},setImage:function(a){b.managers.AssetManager.assetExists(a)&&""!=a&&(this._imageName=a,this._image=this.getImageAsset(),this._cachedSize=null)},getImageAsset:function(){return b.managers.AssetManager.getAsset(this._imageName)},getSkew:function(){return this._skew},
setSkew:function(a,c){this._skew=new b.Vector2D(a,c)},setSource:function(a){this._imageName=a},getOffset:function(){return this._offset},setOffset:function(a,c){this._offset=new b.Vector2D(a,c)},centerOffsetOnEntity:function(){if(""!=this._imageName){var a=this.getSize(),a=null!=this._spriteInfo?new b.Vector2D(this._spriteInfo.getCoords().wh.x,this._spriteInfo.getCoords().wh.y):new b.Vector2D(this._image.width,this._image.height);this.setOffset(-a.x/2,-a.y/2)}},setOffsetBasedOnPivotPoint:function(a,
c){var e=this.getSize(),e=null!=this._spriteInfo?new b.Vector2D(this._spriteInfo.getCoords().wh.x,this._spriteInfo.getCoords().wh.y):new b.Vector2D(this._image.width,this._image.height);this.setOffset(-(e.x*a),-(e.y*(1-c)))},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a},getPivotPoint:function(){return this._pivotPoint},setPivotPoint:function(a,c){this._pivotPoint=new b.Vector2D(a,c)},getLayer:function(){return this._layer},setLayer:function(a){this._layer=a;this._context=
null},getImageName:function(){return this._imageName},getSize:function(){if(null!=this._cachedSize)return this._cachedSize;null==this._image&&(this._image=this.getImageAsset());var a=this.getEntity().getScale();return null!=this._spriteInfo?this._cachedSize=new b.Vector2D(this._spriteInfo.getCoords().wh.x*Math.abs(a.x*this._scale.x),this._spriteInfo.getCoords().wh.y*Math.abs(a.y*this._scale.y)):""==this._imageName?new b.Vector2D(0,0):this._cachedSize=new b.Vector2D(this._image.width*Math.abs(a.x*
this._scale.x),this._image.height*Math.abs(a.y*this._scale.y))},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},setScale:function(a,c,e){null==e&&(e=1);null==c&&(c=1);null==a&&(a=1);this._scale=new b.Vector3D(a,c,e)},getScale:function(){return this._scale},getCameraPositionScale:function(){return this._cameraPositionScale},setCameraPositionScale:function(a){this._cameraPositionScale=a},render:function(){b.Component.prototype.render.call(this);
if(0!=this._alpha&&(""!=this._imageName||null!=this._spriteInfo)){var a=this.getEntity(),c=a.getPosition(),e=1,d=new b.Vector2D(0,0),n=new b.Vector2D(1,1);null!=this._camera&&(d=this._camera.getEntity(),e=this._camera.getZoomScale(),d=d.getPosition(),d=new b.Vector2D(-(d.x/this._cameraPositionScale.x)*n.x,-(d.y/this._cameraPositionScale.y)*n.y),d.scaleBy(e,e));null==this._context&&(this._context=this._layer.getCanvas().getContext("2d"));this._context.save();null!=this._maskFunction&&(this._context.translate(d.x/
n.x*e,d.y/n.y*e),this._maskFunction(this._context,this),this._context.clip(),this._context.translate(-d.x*n.x*e,-d.y*n.y*e));var g=a.getScale().getClone();g.x*=this._scale.x;g.y*=this._scale.y;this._context.setTransform(1,this._skew.x/g.x,this._skew.y/g.y,1,Math.floor(c.x*n.x*e+d.x)*b.Root.getDevicePixelRatio(),Math.floor(c.y*n.y*e+d.y)*b.Root.getDevicePixelRatio());0!=a.getRotation().z+this._rotation.z&&this._context.rotate(b.utilities.Math2.degToRad(a.getRotation().z+this._rotation.z));this._context.scale(g.x*
e,g.y*e);a=this._offset.getClone();null!=this._spriteInfo&&(a.x+=this._spriteInfo.getOffset().x,a.y+=this._spriteInfo.getOffset().y);this._context.translate(Math.floor(a.x*n.x)*b.Root.getDevicePixelRatio(),Math.floor(a.y*n.y)*b.Root.getDevicePixelRatio());this._context.globalAlpha=this._alpha;this._context.scale(n.x*b.Root.getDevicePixelRatio(),n.y*b.Root.getDevicePixelRatio());null==this._spriteInfo&&null==this._coords?(null==this._image&&(this._image=this.getImageAsset()),null==this._clipRect?this._context.drawImage(this._image,
0,0):(this._clipRect.ul.x=Math.max(0,this._clipRect.ul.x),this._clipRect.ul.y=Math.max(0,this._clipRect.ul.y),this._context.drawImage(this._image,this._clipRect.ul.x,this._clipRect.ul.y,this._clipRect.wh.x,this._clipRect.wh.y,0,0,this._clipRect.wh.x*n.x*b.Root.getDevicePixelRatio(),this._clipRect.wh.y*n.y*b.Root.getDevicePixelRatio()))):null==this._spriteInfo&&null!=this._coords?(null==this._image&&(this._image=b.managers.AssetManager.getAsset(this._imageName)),this._context.drawImage(this._image,
this._coords.ul.x,this._coords.ul.y,this._coords.wh.x,this._coords.wh.y,0,0,this._coords.wh.x,this._coords.wh.y)):(n=this._spriteInfo.getCoords(),a=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(this._spriteInfo.getSpriteSheetName()),null==this._image&&(this._image=b.managers.AssetManager.getAsset(a.getImageName())),this._context.drawImage(a.getImage(),n.ul.x,n.ul.y,n.wh.x,n.wh.y,0,0,n.wh.x,n.wh.y));this._layer.setWholeCanvasDirty(!0);this._context.restore()}},quickRender:function(){b.Component.prototype.render.call(this);
new b.Vector2D(1,1);this._context=this._layer.getCanvas().getContext("2d");null!=this._maskFunction&&(this._maskFunction(this._context,this),this._context.clip());this._context.scale(this._scale.x,this._scale.y);this._context.rotate(this._rotation.z);if(null==this._spriteInfo&&null==this._coords)null==this._image&&(this._image=b.managers.AssetManager.getAsset(this._imageName));else if(null==this._spriteInfo&&null!=this._coords)null==this._image&&(this._image=b.managers.AssetManager.getAsset(this._imageName)),
this._context.drawImage(this._image,Math.floor(this._coords.ul.x),Math.floor(this._coords.ul.y),Math.floor(this._coords.wh.x),Math.floor(this._coords.wh.y),this._offset.x,this._offset.y,Math.floor(this._coords.wh.x)+2,Math.floor(this._coords.wh.y)+2);else{var a=this._spriteInfo.getCoords(),c=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(this._spriteInfo.getSpriteSheetName());null==this._image&&(this._image=b.managers.AssetManager.getAsset(c.getImageName()));this._context.drawImage(this._image,
a.ul.x,a.ul.y,a.wh.x,a.wh.y,this._offset.x,this._offset.y,a.wh.x,a.wh.y)}this._context.rotate(-this._rotation.z);this._context.scale(1/this._scale.x,this._scale.y);this._layer.setWholeCanvasDirty(!0)},destroy:function(){b.Component.prototype.destroy.call(this)},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);this._camera=null},__class__:b.components.GameImage});b.components.GameImageBatch=function(a,c,e,d,n){null==d&&(d=!0);this._entities=this._buffer=this._camera=this._cameraPositionScale=
this._context=this._layer=this._gameImages=null;this._removeGameImageComponents=!0;b.Component.call(this,a);this._removeGameImageComponents=d;this._entities=c;this._camera=n;this._cameraPositionScale=new b.Vector2D(1,1);this._context=null;this._layer=e;this._gameImages=[]};b.components.GameImageBatch.__name__=["f84","components","GameImageBatch"];b.components.GameImageBatch.__super__=b.Component;b.components.GameImageBatch.prototype=r(b.Component.prototype,{getCameraPositionScale:function(){return this._cameraPositionScale},
setCameraPositionScale:function(a){this._cameraPositionScale=a},getLayer:function(){return this._layer},setLayer:function(a){this._layer=a},init:function(){b.Component.prototype.init.call(this);for(var a=[],c=this._entities.length,e=0;e<c;){var d=e++,d=this._entities[d],n=d.getComponent(b.components.GameImage),g=d.getPosition().getClone(),h=d.getScale().getClone(),k=d.getRotation().getClone();n.setOffset(n.getOffset().x+g.x*h.x,n.getOffset().y+g.y*h.y);n.setScale(h.x,h.y,1);n.setRotation(k);n.setEntity(this.getEntity());
n.setLayer(this._layer);d.destroy();a.push(n)}this._gameImages=a},render:function(){b.Component.prototype.render.call(this);var a=this._gameImages.length;if(0!=a)if(null==this._camera){var c=new b.Vector2D(1,1),e=this._layer.getCanvas().getContext("2d");e.save();e.setTransform(c.x*b.Root.getDevicePixelRatio(),0,0,c.y*b.Root.getDevicePixelRatio(),0,0);for(c=0;c<a;){var d=c++;this._gameImages[d].quickRender()}e.restore()}else{var d=1,n=new b.Vector2D(0,0),g=new b.Vector2D(1,1),e=new b.Vector3D(0,0);
null!=this._camera&&(e=this._camera.getEntity(),d=this._camera.getZoomScale(),e=e.getPosition(),n=new b.Vector2D(-(e.x/this._cameraPositionScale.x)*g.x*b.Root.getDevicePixelRatio(),-(e.y/this._cameraPositionScale.y)*g.y*b.Root.getDevicePixelRatio()),n.scaleBy(d,d));c=this._layer.getCanvas().getContext("2d");c.save();c.setTransform(d*g.x*b.Root.getDevicePixelRatio(),0,0,d*g.y*b.Root.getDevicePixelRatio(),Math.floor(n.x),Math.floor(n.y));this._camera.getViewBounds();this.getCameraPositionScale();this._gameImages[0].getSize();
for(d=0;d<a;){var g=d++,g=this._gameImages[g],n=g.getOffset().getClone(),h=g.getScale(),k=g.getSize().x,m=g.getSize().y;n.scaleBy(h.x,h.y);n.x-k>e.x+800||(n.x+k<e.x-800||n.y-m>e.y+600||n.y+m<e.y-600)||g.quickRender()}c.restore()}},__class__:b.components.GameImageBatch});b.components.GameSprite=function(a,c,e,d){this._skew=this._rotation=this._context=null;this._alpha=1;this._onAnimationComplete=null;this._isPlaying=!0;this._maskFunction=null;this._updateScale=1;this._position=0;b.Component.call(this,
a);this._currentAnimationName=c;this._cameraPositionScale=new b.Vector2D(1,1);this._layer=e;this._pivotPoint=new b.Vector2D;this._offset=new b.Vector2D;this._camera=d;this._scale=new b.Vector3D(1,1,1);this._skew=new b.Vector2D;this._rotation=new b.Vector3D(0,0,0)};b.components.GameSprite.__name__=["f84","components","GameSprite"];b.components.GameSprite.__super__=b.Component;b.components.GameSprite.prototype=r(b.Component.prototype,{getCamera:function(){return this._camera},setCamera:function(a){this._camera=
a},setPivotPoint:function(a){this._pivotPoint=a},getPivotPoint:function(){return this._pivotPoint},getOffset:function(){return this._offset},setOffset:function(a,b){this._offset.x=a;this._offset.y=b},getUpdateScale:function(){return this._updateScale},setUpdateScale:function(a){this._updateScale=a},getLayer:function(){return this._layer},setLayer:function(a){this._layer=a},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},update:function(){b.Component.prototype.update.call(this);
if(this._isPlaying){var a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);this._position+=b.Root.getDeltaTime()*this.getUpdateScale();this._position>=a.getLength()&&(a.getLoop()?this._position-=a.getLength():(this._position=a.getLength(),this.stop()),null!=this._onAnimationComplete&&(a=this._onAnimationComplete,this._onAnimationComplete=null,a(this.getEntity())))}},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a},setPosition:function(a){this._position=
a},getPosition:function(){return this._position},setAnimation:function(a,b,e){null==e&&(e=!1);if(this._currentAnimationName!=a||e)this._position=0;this._currentAnimationName=a;this._onAnimationComplete=b;this._isPlaying=!0},getAnimation:function(){return this._currentAnimationName},play:function(){this._isPlaying=!0},stop:function(){this._isPlaying=!1},playing:function(){return this._isPlaying},setOnAnimationComplete:function(a){this._onAnimationComplete=a},getOnAnimationComplete:function(){return this._onAnimationComplete},
render:function(){b.Component.prototype.render.call(this);var a=this.getEntity(),c=a.getPosition(),e=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);if(null!=e){var d=e.getSpriteIndexAtPosition(this._position),n=e.getSpriteSheetNameAtPosition(this._position),d=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(n).getSpriteInfoByIndex(d);d.getCoords();var g=1,h=new b.Vector2D(0,0),n=new b.Vector2D(1,1);this._layer.getCanvas().getContext("2d");
this.getEntity().getRotation();this.getEntity().getScale();null!=this._camera&&(h=this._camera.getEntity(),g=this._camera.getZoomScale(),h=h.getPosition(),h=new b.Vector2D(-(h.x/this._cameraPositionScale.x)*n.x,-(h.y/this._cameraPositionScale.y)*n.y),h.scaleBy(g,g));null==this._context&&(this._context=this._layer.getCanvas().getContext("2d"));var k=a.getScale().getClone();k.x*=this._scale.x;k.y*=this._scale.y;this._context.save();null!=this._maskFunction&&(this._context.translate(h.x/n.x*g,h.y/n.y*
g),this._maskFunction(this._context,this),this._context.clip(),this._context.translate(-h.x*n.x*g,-h.y*n.y*g));this._context.setTransform(1,this._skew.x/k.x,this._skew.y/k.y,1,Math.floor(c.x*n.x*g+h.x)*b.Root.getDevicePixelRatio(),Math.floor(c.y*n.y*g+h.y)*b.Root.getDevicePixelRatio());this._context.rotate(b.utilities.Math2.degToRad(a.getRotation().z+this._rotation.z));this._context.scale(k.x*g,k.y*g);a=this._offset.getClone();null!=d&&(a.x+=d.getOffset().x+e.getOffset().x,a.y+=d.getOffset().y+e.getOffset().y);
this._context.translate(Math.floor(a.x*n.x)*b.Root.getDevicePixelRatio(),Math.floor(a.y*n.y)*b.Root.getDevicePixelRatio());this._context.globalAlpha=this._alpha;this._context.scale(n.x*b.Root.getDevicePixelRatio(),n.y*b.Root.getDevicePixelRatio());e=d.getCoords();a=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(d.getSpriteSheetName());this._context.drawImage(a.getImage(),e.ul.x,e.ul.y,e.wh.x,e.wh.y,0,0,e.wh.x,e.wh.y);this._layer.setWholeCanvasDirty(!0);this._context.restore()}},
__class__:b.components.GameSprite});b.components.HtmlElements=function(a,c,e,d){null==d&&(d="");null==e&&(e="");this._alwaysUpdatePosition=!1;this._className="";this._div=null;this._isDirty=!0;b.Component.call(this,a);this._html=e;this._className=d;this._layer=c;this.updateHtml()};b.components.HtmlElements.__name__=["f84","components","HtmlElements"];b.components.HtmlElements.showElementById=function(a,c){null==c&&(c=!0);var e=b.components.HtmlElements.getChildDivById(q.getContainer(),a);null!=e?
e.style.display=c?"block":"none":b.utilities.Debug.log("Could not find element with id of "+a+" to "+(c?"show":"hide"))};b.components.HtmlElements.getStylePositionOfDomElement=function(a){for(var c=t.parseInt(a.style.top),e=t.parseInt(a.style.left);;)if(null!=a.parentNode&&Object.prototype.hasOwnProperty.call(a.parentNode,"style")&&"layer"!=a.parentElement.className)c+=t.parseInt(a.parentElement.style.top),e+=t.parseInt(a.parentElement.style.left),a=a.parentElement;else break;return new b.Vector2D(e,
c)};b.components.HtmlElements.setElementTextById=function(a,c){var e=q.getDocument().getElementById(a);null==e?b.utilities.Debug.log("Could not find '"+a+"' on the page!"):e.innerHTML=c};b.components.HtmlElements.getChildDivById=function(a,c){for(var e=a.children.length,d=0;d<e;){var n=d++,n=a.children[n];if(n.id==c||n.hasChildNodes()&&(n=b.components.HtmlElements.getChildDivById(n,c),null!=n))return n}return null};b.components.HtmlElements.__super__=b.Component;b.components.HtmlElements.prototype=
r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.getEntity().addEventListener("displayUpdate",s(this,this.onDisplayUpdated))},getChildElementById:function(a){return q.getDocument().getElementById(a)},setChildElementTextById:function(a,c){var e=b.components.HtmlElements.getChildDivById(this.getDiv(),a);null!=e&&(e.innerHTML=c);this._html=this.getDiv().innerHTML},getDiv:function(){null==this._div&&this._isDirty&&this.updateHtml();return this._div},update:function(){b.Component.prototype.update.call(this);
null!=this._div&&this._isDirty&&this.updateHtml();null!=this._div&&this._alwaysUpdatePosition&&this.updatePosition();this.getEntity().getIsVisible()?this._div.style.display="block":this._div.style.display="none"},updateHtml:function(){b.utilities.Debug.log("updateHtml");null!=this._div&&null!=this._div.parentNode&&this._div.parentNode.removeChild(this._div);this._isDirty=!1;this._div=q.getDocument().createElement("div");this._div.className=this._className;this._div.innerHTML=this._html;this._div.style.position=
"absolute";this._div.style.webkitTransform="translate(0, 0px) scale("+this.getEntity().getScale().x*b.Root.getInstance().getScreenScale().x+","+this.getEntity().getScale().y*b.Root.getInstance().getScreenScale().y+")";this._div.style.transform="translate(0, 0px) scale("+this.getEntity().getScale().x*b.Root.getInstance().getScreenScale().x+","+this.getEntity().getScale().y*b.Root.getInstance().getScreenScale().y+")";this._layer.getContainer().appendChild(this._div);this.updatePosition()},updatePosition:function(){this._div.style.left=
this.getEntity().getPosition().x*b.Root.getInstance().getScreenScale().x-(this._center?this._div.clientWidth/2:0)+"px";this._div.style.top=this.getEntity().getPosition().y*b.Root.getInstance().getScreenScale().y-(this._center?this._div.clientHeight/2:0)+"px"},setId:function(a){null==this._div&&this._isDirty&&this.updateHtml();this._id=a;this._div.id=a},getId:function(){return this._id},getHtml:function(){return this._html},setHtml:function(a){this._html=a},setClassName:function(a){this._className=
a},getClassName:function(){return this._className},addClassName:function(a){this._className=0<this._className.length?this._className+(" "+a):a},removeClassName:function(a){this._className=C.replace(this._className,a,"")},forceUpdateNextFrame:function(){this._html=this._div.innerHTML},centerOnEntity:function(a){null==a&&(a=!0);this._center=a;this.updatePosition()},getSize:function(){return new b.Vector2D(this._div.clientWidth*b.Root.getInstance().getScreenScale().y,this._div.clientHeight*b.Root.getInstance().getScreenScale().y)},
destroy:function(){b.Component.prototype.destroy.call(this);null!=this._div.parentNode&&this._layer.getContainer().removeChild(this._div)},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c)},onDisplayUpdated:function(){},alwaysUpdatePosition:function(a){null==a&&(a=!0);this._alwaysUpdatePosition=a},__class__:b.components.HtmlElements});b.components.PropertySineWave=function(a,c,e,d,n,g,h,k,m){null==m&&(m=0);null==k&&(k=0);null==h&&(h=!1);this._magnitudeDecayRate=0;this._half=
!1;this._propertyName="";this._target=null;this._theta=this._rate=this._base=this._magnitude=0;b.Component.call(this,a);this._base=d;this._magnitude=n;this._rate=g;this._propertyName=e;this._target=c;this._half=h;this._theta=k;this._magnitudeDecayRate=m};b.components.PropertySineWave.__name__=["f84","components","PropertySineWave"];b.components.PropertySineWave.__super__=b.Component;b.components.PropertySineWave.prototype=r(b.Component.prototype,{getMagnitude:function(){return this._magnitude},setMagnitude:function(a){this._magnitude=
a},getMagnitudeDecayRate:function(){return this._magnitudeDecayRate},setMagnitudeDecayRate:function(a){this._magnitudeDecayRate=a},getBase:function(){return this._base},setBase:function(a){this._base=a},getRate:function(){return this._rate},setRate:function(a){this._rate=a},getPropertyName:function(){return this._propertyName},update:function(){b.Component.prototype.update.call(this);if(0<this._magnitude){this._magnitude-=this._magnitudeDecayRate*b.Root.getDeltaTime();0>this._magnitude&&(this._magnitude=
0);this._theta+=this._rate*b.Root.getDeltaTime();this._theta>=(this._half?Math.PI:2*Math.PI)&&(this._theta=this._half?this._theta-Math.PI:this._theta-2*Math.PI);var a=this._base+Math.sin(this._theta)*this._magnitude;H.setProperty(this._target,this._propertyName,a)}},__class__:b.components.PropertySineWave});b.components.SimpleMovement=function(a,c){this._velocity=this._angularVelocity=this._gravity=null;b.Component.call(this,a);this._velocity=new b.Vector3D;this._angularVelocity=new b.Vector3D;null!=
c&&(this._gravity=c.getClone())};b.components.SimpleMovement.__name__=["f84","components","SimpleMovement"];b.components.SimpleMovement.__super__=b.Component;b.components.SimpleMovement.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);null!=this._gravity&&(this._velocity.x+=this._gravity.x*b.Root.getDeltaTime(),this._velocity.y+=this._gravity.y*b.Root.getDeltaTime(),this._velocity.z+=this._gravity.z*
b.Root.getDeltaTime());var a=this._velocity.getClone();a.scaleBy(b.Root.getDeltaTime());var c=this._angularVelocity.getClone();c.scaleBy(b.Root.getDeltaTime());var e=this.getEntity().getLocalPosition();this.getEntity().getLocalRotation();this.getEntity().setPosition(e.x+a.x,e.y+a.y,e.z+a.z);this.getEntity().rotate(c.x,c.y,c.z)},getXyAngleFromVector:function(a){return b.utilities.Math2.getAngleInDegreesBetween2dVectors(a,new b.Vector2D(this._velocity.x,this._velocity.y))},deactivate:function(){b.Component.prototype.deactivate.call(this)},
getGravity:function(){return this._gravity.getClone()},setGravity:function(a){this._gravity=new b.Vector3D(a.x,a.y,a.z)},getVelocity:function(){return this._velocity},addVelocity:function(a,c,e){null==e&&(e=0);null==c&&(c=0);null==a&&(a=0);this._velocity=this._velocity.add(new b.Vector3D(a,c,e))},setVelocity:function(a,c,e){null==e&&(e=0);null==c&&(c=0);null==a&&(a=0);this._velocity=new b.Vector3D(a,c,e)},setVelocityX:function(a){this._velocity.x=a},setVelocityY:function(a){this._velocity.y=a},setVelocityZ:function(a){this._velocity.z=
a},getVelocityX:function(){return this._velocity.x},getVelocityY:function(){return this._velocity.y},getVelocityZ:function(){return this._velocity.z},getAngularVelocity:function(){return this._angularVelocity},setAngularVelocity:function(a){this._angularVelocity=a},__class__:b.components.SimpleMovement});b.components.SlackMovement=function(a,c){null==c&&(c=0.5);this._slack=1;this._targetPosition=null;b.Component.call(this,a);this._slack=c};b.components.SlackMovement.__name__=["f84","components","SlackMovement"];
b.components.SlackMovement.__super__=b.Component;b.components.SlackMovement.prototype=r(b.Component.prototype,{getSlack:function(){return this._slack},setSlack:function(a){this._slack=a},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);if(null!=this._targetPosition){var a=this._targetPosition.subtract(this.getEntity().getPosition()),c=a.getLength();0!=c&&(a=a.getNormalized(),a.scaleBy(c*this._slack),5E-5>a.x&&-5E-5<a.x&&(a.x=0),5E-5>a.y&&-5E-5<a.y&&(a.y=0),5E-5>a.z&&-5E-5<a.z&&
(a.z=0),c=this.getEntity().getPosition().getClone(),this.getEntity().setPosition(c.x+a.x,c.y+a.y,c.z+a.z))}},getTarget:function(){return this._targetPosition},setTarget:function(a,c,e){this._targetPosition=new b.Vector3D(a,c,e)},__class__:b.components.SlackMovement});b.components.TextField=function(a,c,e){this._spanElement=this._computedStyle=null;this._htmlText="";this._textFieldHeight=0;this._maskFunction=null;this._alpha=1;this._wrapWidth=-1;this._lineSpacing=8;this._maxWidth=1024;this._textBaseline=
"middle";this._textAlign="center";this._fillStyle="white";this._fontFamily="league_gothic-webfont";this._fontSize="16pt";this._text="";b.Component.call(this,a);this._layer=c;this._pivotPoint=new b.Vector2D;this._camera=e;null==b.components.TextField._defaultComputedStyle&&(b.components.TextField._defaultComputedStyle=q.getWindow().getComputedStyle(q.getDocument().body))};b.components.TextField.__name__=["f84","components","TextField"];b.components.TextField.__super__=b.Component;b.components.TextField.prototype=
r(b.Component.prototype,{getLayer:function(){return this._layer},setLayer:function(a){this._layer=a},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a},getMaskFunction:function(){return this._maskFunction},setMaskFunction:function(a){this._maskFunction=a},getFont:function(){return this._fontSize+" "+this._fontFamily},getFontFamily:function(){return this._fontFamily},setFontFamily:function(a){this._fontFamily=a},getFontSize:function(){return this._fontSize},setFontSize:function(a){this._fontSize=
a;this.stripAndApplyRelevantHtml()},getLineSpacing:function(){return this._lineSpacing},setLineSpacing:function(a){this._lineSpacing=a},getFillStyle:function(){return this._fillStyle},setFillStyle:function(a){this._fillStyle=a},getMaxWidth:function(){return this._maxWidth},setMaxWidth:function(a){this._maxWidth=a},getWrapWidth:function(){return this._wrapWidth},setWrapWidth:function(a){this._wrapWidth=a},getText:function(){return this._text},setText:function(a){this._htmlText!=a&&(this._htmlText=
this._text=a,this.stripAndApplyRelevantHtml())},getTextBaseline:function(){return this._textBaseline},setTextBaseline:function(a){this._textBaseline=a},setTextAlign:function(a){this._textAlign=a},getTextAlign:function(){return this._textAlign},getTextFieldHeight:function(){var a=this._layer.getCanvas().getContext("2d");a.font=this.getFont();a.fillStyle=this._fillStyle;a.textAlign=this._textAlign;a.textBaseline=this._textBaseline;a.globalAlpha=this._alpha;for(var b=this._text.split("\n"),e=b.length,
c=0,d=0;d<e;){for(var g=d++,h="",g=b[g].split(" "),k=this._fontSize.substring(0,this._fontSize.length-2),m=0,p=g.length;m<p;){var q=m++,h=h+g[q]+" ";a.measureText(h).width>this._maxWidth&&(h=g[q]+" ",c+=parseFloat(k)+parseFloat(this._lineSpacing))}c+=parseFloat(k)+parseFloat(this._lineSpacing)}return c},wrapText:function(a,b,e){for(var c=this._text.split("\n"),d=c.length,g=0;g<d;){for(var h=g++,k="",h=c[h].split(" "),m=this._fontSize.substring(0,this._fontSize.length-2),p=0,q=h.length;p<q;){var r=
p++,s=k+h[r]+" ";e.measureText(s).width>this._maxWidth?(e.fillText(k,a,b),k=h[r]+" ",b+=parseFloat(m)+parseFloat(this._lineSpacing)):k=s}e.fillText(k,a,b);b+=parseFloat(m)+parseFloat(this._lineSpacing)}},render:function(){b.Component.prototype.render.call(this);var a=this._layer.getCanvas().getContext("2d"),c=this.getEntity().getPosition().getClone(),e=this.getEntity().getRotation().z,d=this.getEntity().getScale();a.save();null!=this._maskFunction&&(a.scale(b.Root.getDevicePixelRatio(),b.Root.getDevicePixelRatio()),
this._maskFunction(a,this),a.clip(),a.scale(1/b.Root.getDevicePixelRatio(),1/b.Root.getDevicePixelRatio()));if(null!=this._camera){var n=this._camera.getEntity();a.translate(-n.getPosition().x*b.Root.getDevicePixelRatio(),-n.getPosition().y*b.Root.getDevicePixelRatio())}a.translate((c.x+this._pivotPoint.x)*b.Root.getDevicePixelRatio(),(c.y+this._pivotPoint.y)*b.Root.getDevicePixelRatio());a.rotate(b.utilities.Math2.degToRad(e));a.translate(-((c.x+this._pivotPoint.x)*d.x*b.Root.getDevicePixelRatio()),
-((c.y+this._pivotPoint.y)*d.y)*b.Root.getDevicePixelRatio());a.scale(d.x*b.Root.getDevicePixelRatio(),d.y*b.Root.getDevicePixelRatio());a.imageSmoothingEnabled=!0;a.font=this.getFont();a.fillStyle=this._fillStyle;a.textAlign=this._textAlign;a.textBaseline=this._textBaseline;a.globalAlpha=this._alpha;this.wrapText(c.x,c.y,a);this._layer.setWholeCanvasDirty(!0);a.restore()},stripAndApplyRelevantHtml:function(){var a;a=q.getDocument().createElement("div");a.innerHTML=this._htmlText;var c=B.parse(a.outerHTML);
if(c.elementsNamed("div").hasNext()){c=c.elementsNamed("div").next();if(c.elementsNamed("font").hasNext()){var e=c.elementsNamed("font").next();e.exists("size")&&(-1!=e.get("size").indexOf("px")?this._fontSize=t.parseInt(e.get("size"))+"px":this._fontSize=t.parseInt(e.get("size"))+"pt")}c.elementsNamed("span").hasNext()&&(c=c.elementsNamed("span").next(),c.exists("class")||c.exists("id")||c.exists("style"))&&(null==this._spanElement&&(this._spanElement=q.getDocument().createElement("span"),this._spanElement.style.display=
"none",c.exists("id")&&(this._spanElement.id=c.get("id")),c.exists("class")&&(this._spanElement.className=c.get("class")),c.exists("style")&&(this._spanElement.style.cssText=c.get("style")),this._computedStyle=q.getWindow().getComputedStyle(this._spanElement),q.getContainer().appendChild(this._spanElement)),this._computedStyle.fontSize!=b.components.TextField._defaultComputedStyle.fontSize&&(this._fontSize=this._computedStyle.fontSize))}b.Root.isFirefox()?this._text=a.textContent:this._text=a.innerText},
__class__:b.components.TextField});b.components.Trigger=function(){};b.components.Trigger.__name__=["f84","components","Trigger"];b.components.Trigger.prototype={__class__:b.components.Trigger};b.components.TriggerActivator=function(a,c,e){this._currentTriggers=this._tagsToHit=null;b.Component.call(this,a);this._tagsToHit=c;this._offset=null==e?new b.Vector2D:e;this._currentTriggers=[]};b.components.TriggerActivator.__name__=["f84","components","TriggerActivator"];b.components.TriggerActivator.__super__=
b.Component;b.components.TriggerActivator.prototype=r(b.Component.prototype,{getOffset:function(){return this._offset},setOffset:function(a,b){this._offset.x=a;this._offset.y=b},update:function(){b.Component.prototype.update.call(this);for(var a=b.managers.PhysicsManager.getInstance().getColliders().length,c=0;c<a;){var e=c++,e=b.managers.PhysicsManager.getInstance().getColliders()[e];if(null==this._tagsToHit||this.tagsMatch(e)){var d=this.getEntity().getPosition();if(e.checkPointIntersect(new b.Vector2D(d.x+
this._offset.x,d.y+this._offset.y)))if(!this.getIsCurrentlyInTrigger(e))e.onEnter(this.getEntity()),this._currentTriggers.push(e);else{if(this.getIsCurrentlyInTrigger(e))e.onInside(this.getEntity())}else this.getIsCurrentlyInTrigger(e)&&(e.onExit(this.getEntity()),this.removeCurrentTrigger(e))}}},removeCurrentTrigger:function(a){for(var b=this._currentTriggers.length-1;0<=b;){if(this._currentTriggers[b]==a){this._currentTriggers.splice(b,1);break}b--}},tagsMatch:function(a){if(null==a)return!1;for(var b=
this._tagsToHit.length,e=0;e<b;){var c=e++;if(a.hasTag(this._tagsToHit[c]))return!0}return!1},getIsCurrentlyInTrigger:function(a){for(var b=this._currentTriggers.length,e=0;e<b;){var c=e++;if(this._currentTriggers[c]==a)return!0}return!1},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();var c=b.components.Camera.getDebugCamera().getEntity(),e=b.components.Camera.getDebugCamera().getZoomScale(),
d=b.components.Camera.getDebugCamera().getSiblingComponent(b.pixi.PixiCamera);a.translate(-c.getPosition().x*e+d.getContainerOffset().x,-c.getPosition().y*e+d.getContainerOffset().y);a.scale(e,e);c=this.getEntity().getPosition().add(new b.Vector3D(this._offset.x,this._offset.y));a.beginPath();a.globalAlpha=0.65;a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(c.x,c.y-4);a.lineTo(c.x,c.y+4);a.moveTo(c.x-4,c.y);a.lineTo(c.x+4,c.y);a.moveTo(c.x-4,c.y-4);a.lineTo(c.x+4,c.y+4);a.moveTo(c.x+4,c.y-4);a.lineTo(c.x-
4,c.y+4);a.stroke();a.restore()},__class__:b.components.TriggerActivator});b.components.Tweener=function(a){this._tweens=null;b.Component.call(this,a);this._tweens=[]};b.components.Tweener.__name__=["f84","components","Tweener"];b.components.Tweener.__super__=b.Component;b.components.Tweener.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},addTween:function(a,c,e,d,n,g,h,k,m){null==h&&(h=0);a=new b.components.tween.Tween(a,c,e,d,n,g,h,k,m);this._tweens.push(a);
return a},skipAll:function(){for(var a=this._tweens.length,b=0;b<a;){var e=b++;this._tweens[e].skip()}},destroyTween:function(a){v.remove(this._tweens,a)},destroyAllTweens:function(){this._tweens=[]},update:function(){b.Component.prototype.update.call(this);for(var a=this._tweens.length-1;0<=a;){var c=this._tweens[a];c.update(b.Root.getDeltaTime());c._isCompleted&&this._tweens.splice(a,1);a--}},__class__:b.components.Tweener});b.components.buttons={};b.components.buttons.ButtonActionDelay=function(a,
c,e,d){this._lockDelayButtonNextFrame=!1;this._inputEnabled=!0;this._action=this._instantAction=this._deferredAction=null;this._delayTime=0;b.Component.call(this,a);this._delayTime=e;this._action=c;this._instantAction=d};b.components.buttons.ButtonActionDelay.__name__=["f84","components","buttons","ButtonActionDelay"];b.components.buttons.ButtonActionDelay.getDelayButtonLock=function(){return b.components.buttons.ButtonActionDelay._delayButtonLock};b.components.buttons.ButtonActionDelay.__super__=
b.Component;b.components.buttons.ButtonActionDelay.prototype=r(b.Component.prototype,{setOnAction:function(a){this._action=a},init:function(){b.Component.prototype.init.call(this);this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());this.getEntity().addEventListener("mouseDown",s(this,this.onMouseDown))},onMouseDown:function(){this._inputEnabled&&!b.components.buttons.ButtonActionDelay._delayButtonLock&&(this._inputEnabled=!1,this._lockDelayButtonNextFrame=!0,null!=this._instantAction&&
this._instantAction(),this._deferredAction.addDeferredAction(this._delayTime,s(this,this.onMouseDownDelayElapse)))},postUpdate:function(){b.Component.prototype.update.call(this);this._lockDelayButtonNextFrame&&(b.components.buttons.ButtonActionDelay._delayButtonLock=!0);this._lockDelayButtonNextFrame=!1},onMouseDownDelayElapse:function(){this._lockDelayButtonNextFrame=b.components.buttons.ButtonActionDelay._delayButtonLock=!1;null!=this._action&&this._action();this._inputEnabled=!0},destroy:function(){b.Component.prototype.destroy.call(this);
0<=this._delayTime&&(b.components.buttons.ButtonActionDelay._delayButtonLock=!1)},__class__:b.components.buttons.ButtonActionDelay});b.components.buttons.ButtonMouseDownPulse=function(a,c,e,d,n){null==n&&(n=!0);this._allowOnce=!0;this._buttonMouseOverScale=this._tweener=null;this._isPulseActive=!1;b.Component.call(this,a);this._pulseFromScale=c;this._pulseToScale=e;this._pulseDuration=d;this._allowOnce=n;this.getEntity().addEventListener("mouseDown",s(this,this.onMouseDown))};b.components.buttons.ButtonMouseDownPulse.__name__=
["f84","components","buttons","ButtonMouseDownPulse"];b.components.buttons.ButtonMouseDownPulse.__super__=b.Component;b.components.buttons.ButtonMouseDownPulse.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._buttonMouseOverScale=this.getSiblingComponent(b.components.buttons.ButtonMouseOverScale);this._tweener=new b.components.Tweener(this.getEntity())},disableButton:function(){this.getEntity().removeEventListener("mouseDown",s(this,this.onMouseDown))},
enableButton:function(){this.getEntity().addEventListener("mouseDown",s(this,this.onMouseDown))},onMouseDown:function(){if(!this._isPulseActive&&!b.components.buttons.ButtonActionDelay.getDelayButtonLock()){var a=this.getEntity().getComponent(b.ui.UiElement);this._isPulseActive=!0;null!=this._buttonMouseOverScale&&this._buttonMouseOverScale.setIsActive(!1);null!=a?(this._tweener.addTween(a.getScaleRef(),"x",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,
0,s(this,this.onPulseComplete)),this._tweener.addTween(a.getScaleRef(),"y",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,0)):(this._tweener.addTween(this.getEntity().getScaleRef(),"x",this._pulseFromScale,this._pulseToScale,this._pulseDuration,b.components.tween.EasingFunctions.easeOutBack,0,s(this,this.onPulseComplete)),this._tweener.addTween(this.getEntity().getScaleRef(),"y",this._pulseFromScale,this._pulseToScale,this._pulseDuration,
b.components.tween.EasingFunctions.easeOutBack,0))}},onPulseComplete:function(){this._allowOnce||(this._isPulseActive=!1,null!=this._buttonMouseOverScale&&this._buttonMouseOverScale.setIsActive(!0))},__class__:b.components.buttons.ButtonMouseDownPulse});b.components.buttons.ButtonMouseOverImage=function(a,c,e){this._gameImage=this._pixiSprite=null;b.Component.call(this,a);this._defaultImageName=c;this._mouseOverImageName=e;this.getEntity().addEventListener("mouseOver",s(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",
s(this,this.onMouseOut))};b.components.buttons.ButtonMouseOverImage.__name__=["f84","components","buttons","ButtonMouseOverImage"];b.components.buttons.ButtonMouseOverImage.__super__=b.Component;b.components.buttons.ButtonMouseOverImage.prototype=r(b.Component.prototype,{setDefaultImage:function(a){this._defaultImageName=a;this.updateImage(this._defaultImageName)},setMouseOverImage:function(a){this._mouseOverImageName=a;this.updateImage(this._mouseOverImageName)},init:function(){b.Component.prototype.init.call(this);
this._gameImage=this.getSiblingComponent(b.components.GameImage);null!=this._gameImage&&(this._gameImage.setImage(this._defaultImageName),this._gameImage.centerOffsetOnEntity());this._pixiSprite=this.getSiblingComponent(b.pixi.PixiSprite);null!=this._pixiSprite&&(this._pixiSprite.setTextureFromImageId(this._defaultImageName),this._pixiSprite.getSprite().anchor=new PIXI.Point(0.5,0.5))},disableButton:function(){this.getEntity().removeEventListener("mouseOver",s(this,this.onMouseOver));this.getEntity().removeEventListener("mouseOut",
s(this,this.onMouseOut))},enableButton:function(){this.getEntity().addEventListener("mouseOver",s(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",s(this,this.onMouseOut))},onMouseOver:function(a){this.updateImage(this._mouseOverImageName)},onMouseOut:function(a){this.updateImage(this._defaultImageName)},updateImage:function(a){null==this._gameImage&&(this._gameImage=this.getSiblingComponent(b.components.GameImage));if(null!=this._gameImage){if(this._gameImage.getImageName()==
a)return;this._gameImage.setIsActive(!0);this._gameImage.setImage(a);this._gameImage.centerOffsetOnEntity()}null==this._pixiSprite&&(this._pixiSprite=this.getSiblingComponent(b.pixi.PixiSprite));null!=this._pixiSprite&&this._pixiSprite.setTextureFromImageId(a)},__class__:b.components.buttons.ButtonMouseOverImage});b.components.buttons.ButtonMouseOverScale=function(a,c,e,d,n){null==e&&(e=0.35);null==c&&(c=1.25);this._baseScaleX=this._baseScaleY=1;this._button=this._tweener=null;b.Component.call(this,
a);this._scaleSize=c;this._scaleDuration=e;this._mouseOverEasingFunction=d;this._mouseOutEasingFunction=n;null==this._mouseOverEasingFunction&&(this._mouseOverEasingFunction=b.components.tween.EasingFunctions.linear);null==this._mouseOutEasingFunction&&(this._mouseOutEasingFunction=b.components.tween.EasingFunctions.linear);this._baseScaleX=this.getEntity().getScaleRef().x;this._baseScaleY=this.getEntity().getScaleRef().y;this.getEntity().addEventListener("mouseOver",s(this,this.onMouseOver));this.getEntity().addEventListener("mouseOut",
s(this,this.onMouseOut))};b.components.buttons.ButtonMouseOverScale.__name__=["f84","components","buttons","ButtonMouseOverScale"];b.components.buttons.ButtonMouseOverScale.__super__=b.Component;b.components.buttons.ButtonMouseOverScale.prototype=r(b.Component.prototype,{onDeactivated:function(){b.Component.prototype.onDeactivated.call(this);this._tweener.setIsActive(!1)},onActivated:function(){b.Component.prototype.onActivated.call(this);this._tweener.setIsActive(!0)},init:function(){b.Component.prototype.init.call(this);
this._tweener=new b.components.Tweener(this.getEntity());var a=this.getEntity().getComponent(b.ui.UiElement);null!=a&&(this._baseScaleX=a.getScaleRef().x,this._baseScaleY=a.getScaleRef().y)},disableButton:function(){this.onMouseOut(null);this.getEntity().removeEventListener("mouseOver",s(this,this.onMouseOver))},enableButton:function(){this.getEntity().addEventListener("mouseOver",s(this,this.onMouseOver))},onMouseOver:function(a){a=this.getEntity().getComponent(b.ui.UiElement);if(!b.components.buttons.ButtonActionDelay.getDelayButtonLock())if(this._tweener.destroyAllTweens(),
null!=a){var c=a.getScaleRef().x,e=a.getScaleRef().y;this._tweener.addTween(a.getScaleRef(),"x",c,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction);this._tweener.addTween(a.getScaleRef(),"y",e,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction)}else a=this.getEntity().getScaleRef().x,c=this.getEntity().getScaleRef().y,this._tweener.addTween(this.getEntity().getScaleRef(),"x",a,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction),this._tweener.addTween(this.getEntity().getScaleRef(),
"y",c,this._scaleSize,this._scaleDuration,this._mouseOverEasingFunction)},onMouseOut:function(a){if(null!=this._tweener)if(a=this.getEntity().getComponent(b.ui.UiElement),this._tweener.destroyAllTweens(),null!=a){var c=a.getScaleRef().x,e=a.getScaleRef().y;this._tweener.addTween(a.getScaleRef(),"x",c,this._baseScaleX,this._scaleDuration,this._mouseOutEasingFunction);this._tweener.addTween(a.getScaleRef(),"y",e,this._baseScaleY,this._scaleDuration,this._mouseOutEasingFunction)}else a=this.getEntity().getScaleRef().x,
c=this.getEntity().getScaleRef().y,this._tweener.addTween(this.getEntity().getScaleRef(),"x",a,this._baseScaleX,this._scaleDuration,this._mouseOutEasingFunction),this._tweener.addTween(this.getEntity().getScaleRef(),"y",c,this._baseScaleY,this._scaleDuration,this._mouseOutEasingFunction)},__class__:b.components.buttons.ButtonMouseOverScale});b.components.buttons.ButtonSoundPlay=function(a,c,e){b.Component.call(this,a);this._soundName=c;this._overSoundName=e};b.components.buttons.ButtonSoundPlay.__name__=
["f84","components","buttons","ButtonSoundPlay"];b.components.buttons.ButtonSoundPlay.__super__=b.Component;b.components.buttons.ButtonSoundPlay.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.getEntity().addEventListener("mouseDown",s(this,this.onMouseDown));this.getEntity().addEventListener("mouseOver",s(this,this.onMouseOver))},onMouseDown:function(){""!=this._soundName&&b.audio.SoundManager.playSoundByName(this._soundName)},onMouseOver:function(){""!=
this._soundName&&b.audio.SoundManager.playSoundByName(this._overSoundName)},destroy:function(){b.Component.prototype.destroy.call(this);this.getEntity().removeEventListener("mouseDown",s(this,this.onMouseDown))},__class__:b.components.buttons.ButtonSoundPlay});b.components.colliders={};b.components.colliders.BoxCollider=function(a,c,e){b.components.Collider.call(this,a,e);this._collision=c};b.components.colliders.BoxCollider.__name__=["f84","components","colliders","BoxCollider"];b.components.colliders.BoxCollider.__super__=
b.components.Collider;b.components.colliders.BoxCollider.prototype=r(b.components.Collider.prototype,{update:function(){b.components.Collider.prototype.update.call(this);var a=this.getEntity().getPosition().getClone(),c;c=null!=this._offset?this._offset:new b.Vector3D;this._collision.ul.x=a.x-this._collision.wh.x/2+c.x*this.getEntity().getScale().x;this._collision.ul.y=a.y-this._collision.wh.y/2+c.y*this.getEntity().getScale().y},checkPointIntersect:function(a){return this._collision.checkPointIntersect(a)},
getRaycastPoint:function(a,b,e,c,d){null==c&&(c=!1);return this._collision.getRaycastPoint(a,b,e,c,d)},debugRender:function(){b.components.Collider.prototype.debugRender.call(this);var a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var c=b.components.Camera.getDebugCamera().getEntity(),e=b.components.Camera.getDebugCamera().getZoomScale(),d=b.components.Camera.getDebugCamera().getSiblingComponent(b.pixi.PixiCamera);
a.translate(-c.getPosition().x*e+d.getContainerOffset().x,-c.getPosition().y*e+d.getContainerOffset().y);a.scale(e,e)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(this._collision.ul.x,this._collision.ul.y);a.lineTo(this._collision.ul.x+this._collision.wh.x,this._collision.ul.y);a.lineTo(this._collision.ul.x+this._collision.wh.x,this._collision.ul.y+this._collision.wh.y);a.lineTo(this._collision.ul.x,this._collision.ul.y+this._collision.wh.y);a.lineTo(this._collision.ul.x,this._collision.ul.y);
a.stroke();a.restore()},getCollision:function(){return this._collision},__class__:b.components.colliders.BoxCollider});b.components.colliders.PolygonCollider=function(a,c,e){b.components.Collider.call(this,a,e);this._collision=c};b.components.colliders.PolygonCollider.__name__=["f84","components","colliders","PolygonCollider"];b.components.colliders.PolygonCollider.__super__=b.components.Collider;b.components.colliders.PolygonCollider.prototype=r(b.components.Collider.prototype,{update:function(){b.components.Collider.prototype.update.call(this);
var a=this.getEntity().getPosition().getClone(),c;c=null!=this._offset?this._offset:new b.Vector3D;this._collision.ul.x=a.x-this._collision.wh.x/2+c.x*this.getEntity().getScale().x;this._collision.ul.y=a.y-this._collision.wh.y/2+c.y*this.getEntity().getScale().y},checkPointIntersect:function(a){return this._collision.checkPointIntersect(a)},getRaycastPoint:function(a,b,e,c,d){null==c&&(c=!1);return this._collision.getRaycastPoint(a,b,e,c,d)},debugRender:function(){b.components.Collider.prototype.debugRender.call(this);
var a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();if(null!=b.components.Camera.getDebugCamera()){var c=b.components.Camera.getDebugCamera().getEntity(),e=b.components.Camera.getDebugCamera().getZoomScale(),d=b.components.Camera.getDebugCamera().getSiblingComponent(b.pixi.PixiCamera);a.translate(-c.getPosition().x*e+d.getContainerOffset().x,-c.getPosition().y*e+d.getContainerOffset().y);a.scale(e,e)}a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";c=this._collision.getPoints().length;
for(e=0;e<c;)d=e++,0==d?a.moveTo(this._collision.ul.x+this._collision.getPoints()[d].x,this._collision.ul.y+this._collision.getPoints()[d].y):a.lineTo(this._collision.ul.x+this._collision.getPoints()[d].x,this._collision.ul.y+this._collision.getPoints()[d].y);a.lineTo(this._collision.ul.x+this._collision.getPoints()[0].x,this._collision.ul.y+this._collision.getPoints()[0].y);a.stroke();a.restore()},getCollision:function(){return this._collision},__class__:b.components.colliders.PolygonCollider});
b.components.flashAnimation={};b.components.flashAnimation.AnimationKeyframe=function(a,b,e){this._position=this._spriteIndex=0;this._position=a;this._spriteIndex=b;this._spriteSheetName=e};b.components.flashAnimation.AnimationKeyframe.__name__=["f84","components","flashAnimation","AnimationKeyframe"];b.components.flashAnimation.AnimationKeyframe.prototype={getSpriteSheetName:function(){return this._spriteSheetName},getPosition:function(){return this._position},getSpriteIndex:function(){return this._spriteIndex},
__class__:b.components.flashAnimation.AnimationKeyframe};b.components.tween={};b.components.tween.EasingFunctions=function(){};b.components.tween.EasingFunctions.__name__=["f84","components","tween","EasingFunctions"];b.components.tween.EasingFunctions.linear=function(a,b,e,c){return b+e*(a/c)};b.components.tween.EasingFunctions.easeOutExpo=function(a,b,e,c){return e*(-Math.pow(2,-10*a/c)+1)+b};b.components.tween.EasingFunctions.easeInCubic=function(a,b,e,c){a/=c;return e*a*a*a+b};b.components.tween.EasingFunctions.easeOutCubic=
function(a,b,e,c){a/=c;a--;return e*(a*a*a+1)+b};b.components.tween.EasingFunctions.easeInQuad=function(a,b,e,c){a/=c;return e*a*a+b};b.components.tween.EasingFunctions.easeOutQuad=function(a,b,e,c){a/=c;return-e*a*(a-2)+b};b.components.tween.EasingFunctions.easeInQuint=function(a,b,e,c){a/=c;return e*a*a*a*a*a+b};b.components.tween.EasingFunctions.easeOutQuint=function(a,b,e,c){a/=c;a--;return e*(a*a*a*a*a+1)+b};b.components.tween.EasingFunctions.easeOutBounce=function(a,b,e,c){a/=c;return 0.36363636363636365>
a?e*7.5625*a*a+b:0.7272727272727273>a?e*(7.5625*(a-=0.5454545454545454)*a+0.75)+b:0.9090909090909091>a?e*(7.5625*(a-=0.8181818181818182)*a+0.9375)+b:e*(7.5625*(a-=0.9545454545454546)*a+0.984375)+b};b.components.tween.EasingFunctions.easeInBack=function(a,b,e,c){return e*(a/=c)*a*(2.70158*a-1.70158)+b};b.components.tween.EasingFunctions.easeOutBack=function(a,b,e,c){return e*((a=a/c-1)*a*(3.70158*a+2.70158)+1)+b};b.components.tween.EasingFunctions.easeInOutQuint=function(a,b,e,c){a/=c/2;if(1>a)return e/
2*a*a*a*a*a+b;a-=2;return e/2*(a*a*a*a*a+2)+b};b.components.tween.GroupFader=function(a){b.Component.call(this,a);this._tweener=new b.components.Tweener(this.getEntity())};b.components.tween.GroupFader.__name__=["f84","components","tween","GroupFader"];b.components.tween.GroupFader.__super__=b.Component;b.components.tween.GroupFader.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},fadeTo:function(a,c,e,d,n){this._tweener.skipAll();null==n&&(n=b.components.tween.EasingFunctions.linear);
for(var g=!1,h=this.getEntity().getComponentsInChildren(b.pixi.PixiContainer),k=h.length,m=0;m<k;){var p=m++,q=h[p],r=null;g||0!=p||(r=d,g=!0);this._tweener.addTween(q.getContainer(),"alpha",a,c,e,n,0,r)}},__class__:b.components.tween.GroupFader});b.components.tween.Tween=function(a,b,e,c,d,g,h,k,m){this._elapsedTime=0;this._isCompleted=!1;this._action=this._params=null;this._change=this._delay=0;this._target=this._easingFunction=null;this._propertyName="";this._begin=this._end=this._duration=0;this._target=
a;this._propertyName=b;this._begin=e;this._end=c;this._duration=d;this._easingFunction=g;this._delay=h;this._action=k;this._params=m};b.components.tween.Tween.__name__=["f84","components","tween","Tween"];b.components.tween.Tween.prototype={getOnUpdate:function(){return this._onUpdate},setOnUpdate:function(a){this._onUpdate=a},update:function(a){this._change=this._end-this._begin;this._elapsedTime+=a;this._elapsedTime<this._delay||(!this._isCompleted&&this.getTransitionTimeElapsed()>=this._duration&&
(this._isCompleted=!0,this._elapsedTime=this._duration+this._delay,null!=this._action&&(a=this._action,this._action=null,a(this._params))),a=0,a=this._easingFunction(this.getTransitionTimeElapsed(),this._begin,this._change,this._duration),H.setProperty(this._target,this._propertyName,a),null!=this._onUpdate&&this._onUpdate())},skip:function(){H.setProperty(this._target,this._propertyName,this._end);this._isCompleted=!0;this._elapsedTime=this._duration},getTransitionTimeElapsed:function(){return Math.max(0,
this._elapsedTime-this._delay)},__class__:b.components.tween.Tween};b.events.EntityEvent=function(a,c){this.data=null;b.events.Event.call(this,a);this.data=c};b.events.EntityEvent.__name__=["f84","events","EntityEvent"];b.events.EntityEvent.__super__=b.events.Event;b.events.EntityEvent.prototype=r(b.events.Event.prototype,{__class__:b.events.EntityEvent});b.events.EventListener=function(a,b){this.eventName=a;this.action=b};b.events.EventListener.__name__=["f84","events","EventListener"];b.events.EventListener.prototype=
{__class__:b.events.EventListener};b.events.GameObjectEvent=function(a){b.events.Event.call(this,a)};b.events.GameObjectEvent.__name__=["f84","events","GameObjectEvent"];b.events.GameObjectEvent.__super__=b.events.Event;b.events.GameObjectEvent.prototype=r(b.events.Event.prototype,{__class__:b.events.GameObjectEvent});b.events.RaycastCheckEvent=function(a,c,e){this.start=this.end=null;b.events.Event.call(this,a);this.start=c;this.end=e};b.events.RaycastCheckEvent.__name__=["f84","events","RaycastCheckEvent"];
b.events.RaycastCheckEvent.__super__=b.events.Event;b.events.RaycastCheckEvent.prototype=r(b.events.Event.prototype,{__class__:b.events.RaycastCheckEvent});b.flashAnimation={};b.flashAnimation.FlashAnimation=function(a,c,e,d,n,g){this._prevFrame=0;this._onAnimationComplete=this._parts=this._partInstances=this._camera=null;this._alpha=1;this._spriteSheet=null;this._currentAnimationName="";this._frameChildren=null;this._isLooping=this._isPlaying=!0;this._framerate=0;this._speedScale=1;this._position=
0;this._animation=null;b.Component.call(this,a);this._animation=JSON.parse(b.managers.AssetManager.getAsset(c));this._currentAnimationName=d;this._frameChildren=[];this._parts=this._animation.parts;this._partInstances=this._animation.part_instances;this._layer=n;this._camera=g;this._spriteSheet=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(e)};b.flashAnimation.FlashAnimation.__name__=["f84","flashAnimation","FlashAnimation"];b.flashAnimation.FlashAnimation.__super__=b.Component;
b.flashAnimation.FlashAnimation.prototype=r(b.Component.prototype,{getOnAnimationComplete:function(){return this._onAnimationComplete},setOnAnimationComplete:function(a){this._onAnimationComplete=a},getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},init:function(){b.Component.prototype.init.call(this);this._framerate=this._animation.framerate;this.generateEntitiesForFrame(this._currentAnimationName,0)},getAnimationCompletionPercent:function(){return this.hasAnimation(this._currentAnimationName)?
this._position/(this.getAnimationLength()-1):0},setAnimationCompletionPercent:function(a){this._position=(this.getAnimationLength()-1)*a},getAnimationLength:function(){return this.hasAnimation(this._currentAnimationName)?this._animation.animations[this._currentAnimationName].frames.length:0},hasAnimation:function(a){return null!=this._animation.animations[a]&&void 0!=this._animation.animations[a]},getAlpha:function(){return this._alpha},setAlpha:function(a){this._alpha=a;this.generateEntitiesForFrame(this._currentAnimationName,
Math.floor(this._position))},setLooping:function(a){this._isLooping=a},getLooping:function(){return this._isLooping},getCurrentAnimationName:function(){return this._currentAnimationName},setAnimation:function(a,b,e){null==e&&(e=!1);null==b&&(b=!0);if(this._currentAnimationName!=a||e)this._isLooping=b,this._currentAnimationName=a,this._position=0,this._isPlaying=!0,this.generateEntitiesForFrame(this._currentAnimationName,0)},update:function(){b.Component.prototype.update.call(this);if(""==this.getEntity().getName())throw"Please name all entities (uniquely by entity 'type') that use the FlashAnimation component!";
if(this._isPlaying){this._position+=b.Root.getDeltaTime()*this._framerate*this._speedScale;var a=this.getAnimationLength()-1;if(this._position>a)if(this._isLooping)this._position-=a,null!=this._onAnimationComplete&&this._onAnimationComplete();else{this._position=a-1;this._isPlaying=!1;null!=this._onAnimationComplete&&(a=this._onAnimationComplete,this._onAnimationComplete=null,a());if(this._destroyEntityOnComplete){this.getEntity().destroy();return}if(this._destroyOnComplete){this.destroy();return}}if(null!=
this._camera){var a=this.getEntity().getPosition(),c=this._camera.getEntity().getPosition();c.x+=b.Root.getInstance().getScreenSize().x/2;c.y+=b.Root.getInstance().getScreenSize().y/2;if(1500<(new b.Vector3D(c.x-a.x,c.y-a.y)).getLength())return}this.generateEntitiesForFrame(this._currentAnimationName,Math.floor(this._position))}},destroyFrameChildren:function(a){null==a&&(a=!1);if(null!=this._frameChildren){for(var c=this._frameChildren.length,e=0;e<c;){var d=e++;a&&this._frameChildren[d].destroy()}b.utilities.ArrayUtils.clear(this._frameChildren)}},
getPartInfoById:function(a){return this._parts[this.getPartInstanceById(a)]},getPartInstanceById:function(a){return this._partInstances[a]},forceRegeneration:function(){this.generateEntitiesForFrame(this._currentAnimationName,Math.floor(this._position))},generateEntitiesForFrame:function(a,c){if(this.hasAnimation(a)){var e=this._animation.animations[a].frames[c];if(null!=e){var d=this.getEntity(),n=this.getEntity().getName()+"_"+a+"_"+c;if(!b.flashAnimation.FlashAnimation._cachedFrames.exists(n)){this.destroyFrameChildren();
for(var g=[],h=e.instances.length,k=0;k<h;){var m=k++,p=e.instances[m],m=p.i,q=this.getPartInfoById(m),r=this.getPartInstanceById(m),s;s=null!=p.x?p.x:0;var t;t=null!=p.y?p.y:0;var v;v=null!=p.a?p.a:1;var m=null!=p.b?p.b:0,w;w=null!=p.c?p.c:0;var x;x=null!=p.d?p.d:1;var p=null!=p.o?p.o:1,y=q.regx,q=q.regy,z=new b.Entity;z.setGameState(null);z.setPosition(s,t,0);z.setScale(v,x);z.setIsUpdating(!1);s=this._spriteSheet.getSpriteInfoByName(r+".png");r=new b.components.GameImage(z,"",this._layer,this._camera);
r.setSpriteInfo(s);s=s.getCoords();r.setOffset(s.wh.x*-y,s.wh.y*-q);d.getScale();z.setProperty("sX",m);z.setProperty("sY",w);z.setProperty("alpha",p);r.setSkew(w,m);r.setAlpha(p*this._alpha);d.addChild(z);this._frameChildren.push(z);g.push(z)}b.flashAnimation.FlashAnimation._cachedFrames.set(n,g)}}}},renderPieces:function(){b.Component.prototype.render.call(this);var a=this.getEntity().getName()+"_"+this._currentAnimationName+"_"+Math.floor(this._position);if(null!=this._frameChildren){if(null!=this._camera){var c=
this.getEntity().getPosition(),e=this._camera.getEntity().getPosition();e.x+=b.Root.getInstance().getScreenSize().x/2;e.y+=b.Root.getInstance().getScreenSize().y/2;if(1500<(new b.Vector3D(e.x-c.x,e.y-c.y)).getLength())return}if(b.flashAnimation.FlashAnimation._cachedFrames.exists(a)){if(Math.floor(this._position)!=this._prevFrame)for(this.destroyFrameChildren(),a=b.flashAnimation.FlashAnimation._cachedFrames.get(a),c=a.length,e=0;e<c;){var d=e++,d=a[d];d.setGameState(null);this._frameChildren.push(d)}a=
this._frameChildren.length;for(c=0;c<a;){e=c++;e=this._frameChildren[e];this.getEntity().addChild(e);var d=e.getComponent(b.components.GameImage),n=e.getProperty("sX"),g=e.getProperty("sY"),h=e.getProperty("alpha"),k=this.getEntity().getScale();e.setGameState(this.getGameState());d.setAlpha(this._alpha*h);d.setSkew(n*k.y,g*k.x);d.setEntity(e);d.setCamera(this._camera);e.render();d.setEntity(null);d.setCamera(null);e.setGameState(null);e.getParent().removeChild(e)}}}},postUpdate:function(){b.Component.prototype.postUpdate.call(this);
this._prevFrame=Math.floor(this._position)},setDestroyOnComplete:function(a){this._destroyOnComplete=a},setDestroyEntityOnComplete:function(a){this._destroyEntityOnComplete=a},render:function(){b.Component.prototype.render.call(this);this.renderPieces()},destroy:function(){b.Component.prototype.destroy.call(this);this.destroyFrameChildren(!1);this._frameChildren=null},__class__:b.flashAnimation.FlashAnimation});b.font={};b.font.Font=function(a,c,e){this._fontInfo=this._fontCommon=this._chars=this._kernings=
null;this._name=a;this._imageName=e;a=B.parse(b.managers.AssetManager.getAsset(c));this._chars=[];this._kernings=[];this.parseFromXml(a)};b.font.Font.__name__=["f84","font","Font"];b.font.Font.prototype={getName:function(){return this._name},setName:function(a){this._name=a},getImageName:function(){return this._imageName},getFontInfo:function(){return this._fontInfo},getFontCommon:function(){return this._fontCommon},getChars:function(){return this._chars},getKernings:function(){return this._kernings},
parseFromXml:function(a){var c=a.elementsNamed("font").next().elementsNamed("info").next(),e=new b.font.FontInfo;e.aa="1"==c.get("aa");e.bold="1"==c.get("bold");e.charset=c.get("charset");e.face=c.get("face");e.italic="1"==c.get("italic");e.outline="1"==c.get("outline");var d=c.get("padding").split(",");e.paddingBottom=parseInt(d[0]);e.paddingLeft=parseInt(d[1]);e.paddingRight=parseInt(d[2]);e.paddingTop=parseInt(d[3]);e.size=parseInt(c.get("size"));e.smooth="1"==c.get("smooth");d=c.get("spacing").split(",");
e.spacingH=parseInt(d[0]);e.spacingV=parseInt(d[1]);e.stretchH=parseInt(c.get("stretchH"));e.unicode="1"==c.get("unicode");this._fontInfo=e;c=a.elementsNamed("font").next().elementsNamed("common").next();e=new b.font.FontCommon;e.alphaChnl=parseFloat(c.get("alphaChnl"));e.base=parseInt(c.get("base"));e.redChnl=parseFloat(c.get("redChnl"));e.greenChnl=parseFloat(c.get("greenChnl"));e.blueChnl=parseFloat(c.get("blueChnl"));e.lineHeight=parseFloat(c.get("lineHeight"));e.packed="1"==c.get("packed");e.pages=
1;e.scaleH=parseFloat(c.get("scaleH"));e.scaleW=parseFloat(c.get("scaleW"));this._fontCommon=e;for(c=a.elementsNamed("font").next().elementsNamed("chars").next().elementsNamed("char");c.hasNext();)e=c.next(),d=new b.font.FontChar,d.id=parseInt(e.get("id")),d.x=parseInt(e.get("x")),d.y=parseInt(e.get("y")),d.width=parseInt(e.get("width")),d.height=parseInt(e.get("height")),d.xOffset=parseInt(e.get("xoffset")),d.yOffset=parseInt(e.get("yoffset")),d.xAdvance=parseInt(e.get("xadvance")),this._chars.push(d);
if(a.elementsNamed("font").next().elementsNamed("kernings").hasNext())for(a=a.elementsNamed("font").next().elementsNamed("kernings").next().elementsNamed("kerning");a.hasNext();)c=a.next(),e=new b.font.FontKerning,e.first=parseInt(c.get("first")),e.second=parseInt(c.get("second")),e.amount=parseInt(c.get("amount")),this._kernings.push(e)},getCharById:function(a){for(var b=this._chars.length,e=0;e<b;){var c=e++,c=this._chars[c];if(c.id==a)return c}return null},getKerningSpace:function(a,b){for(var e=
this._kernings.length,c=0;c<e;){var d=c++,d=this._kernings[d];if(d.first==a&&d.second==b)return d.amount}return 0},__class__:b.font.Font};b.font.FontChar=function(){this.id=this.x=this.y=this.width=this.height=this.xOffset=this.yOffset=this.xAdvance=this.chnl=0};b.font.FontChar.__name__=["f84","font","FontChar"];b.font.FontChar.prototype={__class__:b.font.FontChar};b.font.FontCommon=function(){this.redChnl=this.greenChnl=this.blueChnl=0;this.alphaChnl=1;this.packed=0;this.pages=1;this.scaleW=this.scaleH=
1024;this.base=25;this.lineHeight=32};b.font.FontCommon.__name__=["f84","font","FontCommon"];b.font.FontCommon.prototype={__class__:b.font.FontCommon};b.font.FontInfo=function(){this.paddingTop=this.paddingLeft=this.paddingRight=this.paddingBottom=this.spacingV=this.spacingH=this.outline=1;this.smooth=this.aa=!0;this.stretchH=100;this.unicode=!0;this.charset="";this.bold=this.italic=!1};b.font.FontInfo.__name__=["f84","font","FontInfo"];b.font.FontInfo.prototype={__class__:b.font.FontInfo};b.font.FontKerning=
function(){};b.font.FontKerning.__name__=["f84","font","FontKerning"];b.font.FontKerning.prototype={__class__:b.font.FontKerning};b.font.FontRender=function(a,c,e,d){this._prevHookLeft=this._prevHookTop="";this._forceReinstantiation=!1;this._textAlign="center";this._letters=this._isHookedToElement=this._prevTextValue=null;this._maxWidth=375;this._font=null;b.Component.call(this,a);this._font=c;this._text="";this._layer=e;this._camera=d;this._letters=[]};b.font.FontRender.__name__=["f84","font","FontRender"];
b.font.FontRender.__super__=b.Component;b.font.FontRender.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.instantiateLetters()},update:function(){b.Component.prototype.update.call(this);if(null!=this._isHookedToElement&&(this.setText(this._isHookedToElement.innerHTML),"none"==this._isHookedToElement.parentElement.style.display&&this.removeLetters(),this._isHookedToElement.style.left!=this._prevHookLeft||this._isHookedToElement.style.top!=this._prevHookTop))this.onDisplayUpdated();
if(this._prevTextValue!=this._text)this.onDisplayUpdated();this._forceReinstantiation&&(this._forceReinstantiation=!1,this.removeLetters(),this.instantiateLetters())},getText:function(){return this._text},setText:function(a){this._text=a;this._text=C.replace(this._text,"&amp;","&");this._forceReinstantiation=!0},setNonHTMLText:function(a){this._prevTextValue=this._text=a;this._forceReinstantiation=!0},instantiateLetters:function(){this.removeLetters();for(var a=this._text.length,c=new b.Vector2D(0,
this._font.getFontCommon().base),e=[],d=0,n=!1,g=0;g<a;){var h=v.cca(this._text,g),k=v.cca(this._text,g+1);if("<br>"==this._text.substring(g,g+4)||"<br/>"==this._text.substring(g,g+5))c.x=0,c.y+=this._font.getFontCommon().lineHeight,g+=4,"center"==this._textAlign?this.centerLetters(e,d):"right"==this._textAlign&&this.rightAlignLetters(e,d),d=0,e=[];else{n&&(c.x+this.getWordLength(this.getWordAtIndex(g)+15)>this._maxWidth&&(c.x=0,c.y+=this._font.getFontCommon().lineHeight+this._font.getFontInfo().spacingV,
"center"==this._textAlign?this.centerLetters(e,d):"right"==this._textAlign&&this.rightAlignLetters(e,d),d=0,e=[]),n=!1);var m=this.getEntity().getGameState().addEntity();m.setIsUpdating(!1);this.getEntity().addChild(m);m.setPosition(Math.ceil(c.x),Math.ceil(c.y));var p=this._font.getCharById(h);if(null!=p){var q=new b.components.GameImage(m,this._font.getImageName(),this._layer,this._camera);q.setOffset(p.xOffset,Math.ceil(p.yOffset-this._font.getFontCommon().base));q.setCoords(new b.Rect2D(p.x,p.y,
p.width,p.height));c.x+=Math.ceil(p.xAdvance+this._font.getFontInfo().spacingH);d+=Math.ceil(p.xAdvance+this._font.getFontInfo().spacingH);e.push(m);g<a-1&&(c.x+=this._font.getKerningSpace(h,v.cca(this._text,g+1))+this._font.getFontInfo().spacingH,d+=this._font.getKerningSpace(h,v.cca(this._text,g+1))+this._font.getFontInfo().spacingH);32!=k&&c.x+15>this._maxWidth&&(c.x=0,c.y+=this._font.getFontCommon().lineHeight+this._font.getFontInfo().spacingV,"center"==this._textAlign?this.centerLetters(e,d):
"right"==this._textAlign&&this.rightAlignLetters(e,d),d=0,e=[]);32==h&&(n=!0)}this._letters.push(m);g++}}"center"==this._textAlign?this.centerLetters(e,d):"right"==this._textAlign&&this.rightAlignLetters(e,d);this._prevTextValue=this._text},centerLetters:function(a,b){for(var e=this._maxWidth/2,c=a.length,d=0;d<c;){var g=d++,g=a[g];g.setPosition(e-b/2+g.getLocalPosition().x,g.getLocalPosition().y,g.getLocalPosition().z)}},rightAlignLetters:function(a,b){for(var e=this._maxWidth,c=a.length,d=0;d<c;){var g=
d++,g=a[g];g.setPosition(e-b+g.getLocalPosition().x,g.getLocalPosition().y,g.getLocalPosition().z)}},getWordAtIndex:function(a){for(var b=this._text.split(" "),e=0,c=0,d=0;d<a;)d++,e++,e>b[c].length&&(e=0,c++);return b[c]},getWordLength:function(a){for(var b=0,e=a.length,c=0;c<e;){var d=c++,g=v.cca(a,d),h=this._font.getCharById(g);null!=h&&(b+=h.xAdvance+this._font.getFontInfo().spacingH,d<e-1&&(d=v.cca(a,d+1),b+=this._font.getKerningSpace(g,d)+this._font.getFontInfo().spacingH))}return b},removeLetters:function(){for(var a=
this._letters.length,b=0;b<a;){var c=b++;this._letters[c].destroy()}this._letters=[]},render:function(){b.Component.prototype.render.call(this)},replaceHtmlTextElementById:function(a,c){null==c&&(c=!0);if(b.managers.FontManager.getInstance().getElementHookExists(a))c&&this.getEntity().destroy();else{null!=this._layer&&b.Root.getInstance().removeLayer(this._layer);var e=q.getDocument().getElementById(a);if(null==e)b.utilities.Debug.log("Could not find '"+a+"' on the page!");else{this._isHookedToElement=
e;b.managers.FontManager.getInstance().registerElementHook(this._isHookedToElement.id,this);this._text=e.innerHTML;e.style.display="none";var d=new b.Layer("temp",t.parseInt(e.style.width),t.parseInt(e.style.height)+t.parseInt(e.style.top),e.parentElement);this._layer=d;this._layer.getContainer().style.zIndex=e.style.zIndex;b.Root.getInstance().addLayer(d);this._textAlign=e.style.textAlign;this.onDisplayUpdated()}}},onDisplayUpdated:function(){if(null!=this._isHookedToElement){this._layer.getContainer().style.left=
Math.ceil(t.parseInt(this._isHookedToElement.style.left))+"px";this._layer.getContainer().style.top=Math.ceil(t.parseInt(this._isHookedToElement.style.top))+"px";null!=this._isHookedToElement.style.webkitTransform?this._layer.getContainer().style.webkitTransform=this._isHookedToElement.style.webkitTransform:null!=this._isHookedToElement.style.transform&&(this._layer.getContainer().style.transform=this._isHookedToElement.style.transform);this._layer.getContainer().style.width=t.parseInt(this._isHookedToElement.style.width)+
"px";this._layer.getContainer().style.height=t.parseInt(this._isHookedToElement.style.height)+t.parseInt(this._isHookedToElement.style.top)+"px";this._layer.getCanvas().style.width=t.parseInt(this._isHookedToElement.style.width)+"px";this._layer.getCanvas().style.height=t.parseInt(this._isHookedToElement.style.height)+t.parseInt(this._isHookedToElement.style.top)+"px";if("none"!=this._isHookedToElement.style.transform&&null!=this._isHookedToElement.style.transform&&("none"==this._layer.getContainer().style.webkitTransform||
null==this._layer.getContainer().style.webkitTransform)){var a=this._isHookedToElement.style.transform.split(" ")[0].split(","),c=(new K("^\\D+","g")).replace(a[0],""),c=parseInt(c),a=parseInt(a[1]);this._layer.getContainer().style.left=c+"px";this._layer.getContainer().style.top=a+"px"}this._layer.getCanvas().width=parseInt(this._layer.getCanvas().style.width);this._layer.getCanvas().height=parseInt(this._layer.getCanvas().style.height);this.getEntity().setScale(1/b.Root.getInstance().getScreenScale().x,
1/b.Root.getInstance().getScreenScale().y);Math.ceil(t.parseInt(this._isHookedToElement.style.marginLeft));this._maxWidth=Math.ceil(t.parseInt(this._isHookedToElement.style.width));this._forceReinstantiation=!0;this._prevHookLeft=this._isHookedToElement.style.left;this._prevHookTop=this._isHookedToElement.style.top}},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);switch(a){case "onScreenScaleUpdated":this.onDisplayUpdated()}},destroy:function(){b.Component.prototype.destroy.call(this);
null!=this._layer&&null!=this._isHookedToElement&&b.Root.getInstance().removeLayer(this._layer);null!=this._isHookedToElement&&b.managers.FontManager.getInstance().unregisterElementHook(this._isHookedToElement.id)},setMaxWidth:function(a){this._maxWidth=a},getMaxWidth:function(){return this._maxWidth},__class__:b.font.FontRender});b.gameStates={};b.gameStates.OrientationState=function(){this._orientationEntity=this._div=this._image=null;b.GameState.call(this)};b.gameStates.OrientationState.__name__=
["f84","gameStates","OrientationState"];b.gameStates.OrientationState.__super__=b.GameState;b.gameStates.OrientationState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this)},onOrientationChanged:function(a){b.Root.isMobile()&&!b.Root.getInstance().isPhone()?a&&0==b.GameConfig.getProperty("isLandscapeAllowedIPad")?this.showOrientationScreen(1):a||0!=b.GameConfig.getProperty("isPortraitAllowedIPad")?this.hideOrientationScreen():this.showOrientationScreen(0):b.Root.isMobile()&&
(a&&0==b.GameConfig.getProperty("isLandscapeAllowedIPhone")?this.showOrientationScreen(1):a||0!=b.GameConfig.getProperty("isPortraitAllowedIPhone")?this.hideOrientationScreen():this.showOrientationScreen(0))},showOrientationScreen:function(a){this.hideOrientationScreen(!1);b.Root.getInstance().removeGameState(this,!1);b.Root.getInstance().addGameState(this);b.Root.getInstance().stopUpdates();b.managers.InputManager.getInstance().setInputDisabled(!0);b.audio.SoundManager.pauseAllSounds();this._div=
q.getDocument().createElement("div");this._div.style.position="absolute";this._div.style.backgroundColor="#000000";this._div.style.width="100%";this._div.style.height="100%";this._div.style.zIndex="1000";q.getContainer().appendChild(this._div);switch(a){case 0:this._orientationEntity=this.addEntity();this._image=b.managers.AssetManager.getAsset(b.Root.getInstance().isPhone()?"iphoneOrientationImage":"ipadOrientationImage");this._div.appendChild(this._image);this._image.style.position="absolute";this._image.style.margin=
"auto auto auto auto";this._image.style.display="block";this._image.style.maxWidth="100%";this._image.style.maxHeight="auto";this._image.style.top="0px";this._image.style.bottom="0px";this._image.style.left="0px";this._image.style.right="0px";break;case 1:this._orientationEntity=this.addEntity(),this._image=b.managers.AssetManager.getAsset(b.Root.getInstance().isPhone()?"iphoneOrientationImage":"ipadOrientationImage"),this._div.appendChild(this._image),this._image.style.position="absolute",this._image.style.margin=
"auto auto auto auto",this._image.style.display="block",this._image.style.maxWidth="100%",this._image.style.maxHeight="auto",this._image.style.top="0px",this._image.style.bottom="0px",this._image.style.left="0px",this._image.style.right="0px"}},update:function(){b.GameState.prototype.update.call(this)},hideOrientationScreen:function(a){null==a&&(a=!0);null!=this._div&&(this._div.parentNode.removeChild(this._div),this._div=null);a&&(b.Root.getInstance().resumeUpdates(),b.managers.InputManager.getInstance().setInputDisabled(!1),
b.audio.SoundManager.resumeAllSounds(),b.Root.getInstance().hideAddressBar(),b.Root.getInstance().onScreenScaleUpdated())},handleMessage:function(a,c){b.GameState.prototype.handleMessage.call(this,a,c);switch(a){case "onOrientationChanged":this.onOrientationChanged(c.isHorizontal)}},__class__:b.gameStates.OrientationState});b.managers={};b.managers.AnimationManager=function(){this._animations=new w.ds.StringMap};b.managers.AnimationManager.__name__=["f84","managers","AnimationManager"];b.managers.AnimationManager.getInstance=
function(){null==b.managers.AnimationManager._instance&&(b.managers.AnimationManager._instance=new b.managers.AnimationManager);return b.managers.AnimationManager._instance};b.managers.AnimationManager.prototype={getAnimationByName:function(a){return this._animations.get(a)},registerAnimation:function(a){var b=a.getName();this._animations.set(b,a)},removeAnimationByName:function(a){this._animations.remove(a)},removeAllAnimations:function(){this._animations=new w.ds.StringMap},__class__:b.managers.AnimationManager};
b.managers.AssetManager=function(){};b.managers.AssetManager.__name__=["f84","managers","AssetManager"];b.managers.AssetManager.outputAssets=function(){b.utilities.Debug.log(b.managers.AssetManager.assetList)};b.managers.AssetManager.getAsset=function(a){if(!b.managers.AssetManager.assetList.exists(a))throw a+" does not exist in asset list!";return b.managers.AssetManager.assetList.get(a)};b.managers.AssetManager.assetExists=function(a){return b.managers.AssetManager.assetList.exists(a)};b.managers.AssetManager.unloadAsset=
function(a){b.managers.AssetManager.assetList.set(a,null);b.managers.AssetManager.assetList.remove(a);a=PIXI.Texture.removeTextureFromCache(a);null!=a&&a.destroy(!0)};b.managers.AssetManager.unloadLoadBatch=function(a){b.managers.AssetManager.getAsset(a).unload()};b.managers.AssetManager.registerAsset=function(a,c,e){null==e&&(e=!0);b.managers.AssetManager.assetList.exists(a)&&!e||b.managers.AssetManager.assetList.set(a,c)};b.managers.AssetManager.prototype={__class__:b.managers.AssetManager};b.managers.DebugManager=
function(){b.Manager.call(this);b.managers.DebugManager._instance=this};b.managers.DebugManager.__name__=["f84","managers","DebugManager"];b.managers.DebugManager.getInstance=function(){return b.managers.DebugManager._instance};b.managers.DebugManager.__super__=b.Manager;b.managers.DebugManager.prototype=r(b.Manager.prototype,{update:function(){b.Manager.prototype.update.call(this);"1"==b.GameConfig.getProperty("debugCheats")&&(b.managers.InputManager.getInstance().isKeyPressed(104)&&b.GameConfig.setProperty("debugDraw",
"1"==b.GameConfig.getProperty("debugDraw")?"0":"1"),b.managers.InputManager.getInstance().isKeyPressed(101)&&this.dispatchEvent(new b.managers.DebugManagerEvent("beatLevel")),b.managers.InputManager.getInstance().isKeyPressed(102)&&this.dispatchEvent(new b.managers.DebugManagerEvent("failLevel")),b.managers.InputManager.getInstance().isKeyPressed(100)&&(b.GameConfig.setProperty("forceOrientation","HORIZONTAL"==b.GameConfig.getProperty("forceOrientation")?"VERTICAL":"HORIZONTAL"),b.Root.getInstance().onOrientationChanged()))},
destroy:function(){b.Manager.prototype.destroy.call(this);b.managers.DebugManager._instance=null},__class__:b.managers.DebugManager});b.managers.DebugManagerEvent=function(a){b.events.Event.call(this,a)};b.managers.DebugManagerEvent.__name__=["f84","managers","DebugManagerEvent"];b.managers.DebugManagerEvent.__super__=b.events.Event;b.managers.DebugManagerEvent.prototype=r(b.events.Event.prototype,{__class__:b.managers.DebugManagerEvent});b.managers.FontManager=function(){this._fonts=null;b.Manager.call(this);
this._fonts=[];b.managers.FontManager._instance=this};b.managers.FontManager.__name__=["f84","managers","FontManager"];b.managers.FontManager.getInstance=function(){return b.managers.FontManager._instance};b.managers.FontManager.__super__=b.Manager;b.managers.FontManager.prototype=r(b.Manager.prototype,{registerFont:function(a){this.getHasFont(a)||this._fonts.push(a)},unregisterFont:function(a){v.remove(this._fonts,a)},getHasFont:function(a){for(var b=this._fonts.length,c=0;c<b;){var d=c++;if(a==
this._fonts[d])return!0}return!1},registerElementHook:function(a,c){b.managers.FontManager._elementHookMap.set(a,c)},getFontRenderByHookElementId:function(a){return b.managers.FontManager._elementHookMap.get(a)},getElementHookExists:function(a){return b.managers.FontManager._elementHookMap.exists(a)},unregisterElementHook:function(a){b.managers.FontManager._elementHookMap.remove(a)},getFontByName:function(a){for(var b=this._fonts.length,c=0;c<b;){var d=c++,d=this._fonts[d];if(d.getName()==a)return d}return null},
__class__:b.managers.FontManager});b.managers.InputManager=function(){this._keysDown=this._keysPressedThisFrame=null;this._isInputDisabled=this._isLeftMouseDown=!1;this._mousePosition=null;b.Manager.call(this);b.managers.InputManager._instance=this;this._mousePosition=new b.Vector2D(0,0);this._keysDown=[];this._keysPressedThisFrame=[];for(var a=0;255>a;)a++,this._keysDown.push(!1),this._keysPressedThisFrame.push(!1)};b.managers.InputManager.__name__=["f84","managers","InputManager"];b.managers.InputManager.getInstance=
function(){return b.managers.InputManager._instance};b.managers.InputManager.__super__=b.Manager;b.managers.InputManager.prototype=r(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this);q.getWindow().addEventListener("mousemove",s(this,this.onMouseMoved));q.getWindow().addEventListener("mousedown",s(this,this.onMouseDown));q.getWindow().addEventListener("mouseup",s(this,this.onMouseUp));q.getWindow().addEventListener("mouseleave",s(this,this.onMouseLeave));q.getWindow().addEventListener("mouseout",
s(this,this.onMouseOut));q.getDocument().addEventListener("keydown",s(this,this.onKeyDown));q.getDocument().addEventListener("keyup",s(this,this.onKeyUp));q.getDocument().addEventListener("keypress",s(this,this.onKeyPressed));q.getWindow().addEventListener("click",s(this,this.onMouseClick));document.addEventListener("touchstart",s(this,this.onMouseDown));document.addEventListener("touchend",s(this,this.onMouseUp));document.addEventListener("touchmove",s(this,this.onMouseMoved))},update:function(){b.Manager.prototype.update.call(this)},
postUpdate:function(){b.Manager.prototype.postUpdate.call(this);for(var a=this._keysPressedThisFrame.length,c=0;c<a;){var e=c++;this._keysPressedThisFrame[e]=!1}},getMousePosition:function(){var a=b.Root.getInstance().getScreenOffset();return new b.Vector2D((this._mousePosition.x-a.x)/b.Root.getInstance().getScreenScale().x,(this._mousePosition.y-a.y)/b.Root.getInstance().getScreenScale().y)},onMouseMoved:function(a){if(!this._isInputDisabled)if(b.Root.isMobile()){for(var c=a.changedTouches,e=c.length,
d=0;d<e;){var n=d++,g=c[n],n=g.pageX-q.getContainer().offsetParent.offsetLeft,g=g.pageY-q.getContainer().offsetParent.offsetTop;this._mousePosition.x=n;this._mousePosition.y=g;b.Root.getInstance().sendGlobalMessage("mouseMove",this.getMousePosition())}b.Root.getInstance().sendGlobalMessage("verifyTouches",a)}else c=a.pageX-q.getContainer().offsetParent.offsetLeft,a=a.pageY-q.getContainer().offsetParent.offsetTop,this._mousePosition.x=c,this._mousePosition.y=a,b.Root.getInstance().sendGlobalMessage("mouseMove",
this.getMousePosition())},onMouseDown:function(a){b.Root.getInstance().hideAddressBar();b.Root.isMobile()&&!b.Root.isIOS()&&b.Root.getInstance().requestFullscreen();if(!this._isInputDisabled)if(b.Root.isMobile()){this._isLeftMouseDown=!0;var c=a.changedTouches;a=c.length;for(var e=0;e<a;){var d=e++,n=c[d],d=n.pageX-q.getContainer().offsetParent.offsetLeft,n=n.pageY-q.getContainer().offsetParent.offsetTop;this._mousePosition.x=d;this._mousePosition.y=n;b.Root.getInstance().sendGlobalMessage("mouseDown",
this.getMousePosition())}}else this._isLeftMouseDown=!0,c=a.pageX-q.getContainer().offsetParent.offsetLeft,a=a.pageY-q.getContainer().offsetParent.offsetTop,this._mousePosition.x=c,this._mousePosition.y=a,b.Root.getInstance().sendGlobalMessage("mouseDown",this.getMousePosition())},onMouseUp:function(a){if(!this._isInputDisabled){if(b.Root.isMobile())this._isLeftMouseDown=!1;else{this._isLeftMouseDown=!1;var c;c=a.pageX-q.getContainer().offsetParent.offsetLeft;a=a.pageY-q.getContainer().offsetParent.offsetTop;
this._mousePosition.x=c;this._mousePosition.y=a}b.Root.getInstance().sendGlobalMessage("mouseUp",this.getMousePosition())}},onMouseClick:function(a){if(!this._isInputDisabled){var c=a.pageX-q.getContainer().offsetParent.offsetLeft;a=a.pageY-q.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a;b.Root.getInstance().sendGlobalMessage("mouseClick",this.getMousePosition())}},onMouseLeave:function(a){if(!this._isInputDisabled){var c=a.pageX-q.getContainer().offsetParent.offsetLeft;
a=a.pageY-q.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a;b.Root.getInstance().sendGlobalMessage("mouseLeave",this.getMousePosition())}},onMouseOut:function(a){if(!this._isInputDisabled){var c=a.pageX-q.getContainer().offsetParent.offsetLeft;a=a.pageY-q.getContainer().offsetParent.offsetTop;this._mousePosition.x=c;this._mousePosition.y=a;b.Root.getInstance().sendGlobalMessage("mouseOut",this.getMousePosition())}},onKeyDown:function(a){a.stopPropagation();this._isInputDisabled||
this._keysDown[a.keyCode]||(this._keysDown[a.keyCode]=!0,this._keysPressedThisFrame[a.keyCode]=!0,b.Root.getInstance().sendGlobalMessage("keyDown",a.keyCode))},onKeyUp:function(a){this._isInputDisabled||(this._keysDown[a.keyCode]=!1,b.Root.getInstance().sendGlobalMessage("keyUp",a.keyCode))},onKeyPressed:function(a){a.stopPropagation();this._isInputDisabled||b.Root.getInstance().sendGlobalMessage("keyPressed",a.keyCode)},disablePageKeyPresses:function(){document.onkeydown=function(a){a.preventDefault();
return!1}},enablePageKeyPresses:function(){document.onkeydown=null},getInputDisabled:function(){return this._isInputDisabled},setInputDisabled:function(a){this._isInputDisabled=a},isKeyDown:function(a){return this._keysDown[a]},isKeyPressed:function(a){return this._keysPressedThisFrame[a]},isLeftMouseDown:function(){return this._isLeftMouseDown},__class__:b.managers.InputManager});b.managers.PhysicsEvent=function(){};b.managers.PhysicsEvent.__name__=["f84","managers","PhysicsEvent"];b.managers.PhysicsEvent.prototype=
{__class__:b.managers.PhysicsEvent};b.managers.PhysicsManager=function(){this._colliders=this._raycastsThisFrame=null;b.Manager.call(this);b.managers.PhysicsManager._instance=this;this._raycastsThisFrame=[];this._colliders=[];this._debugDrawEnabled="1"==b.GameConfig.getProperty("debugDraw");this.addEventListener("raycastCheck",s(this,this.onRaycastCheck))};b.managers.PhysicsManager.__name__=["f84","managers","PhysicsManager"];b.managers.PhysicsManager.getInstance=function(){return b.managers.PhysicsManager._instance};
b.managers.PhysicsManager.createBoxColliderEntity=function(a,c,e,d,n,g,h,k){null==k&&(k=!0);g=g.addEntity();g.setPosition(a,c,e);a=new b.collision.BoxCollision(a,c,d,n);k=new b.components.colliders.BoxCollider(g,a,k?new b.Vector3D:new b.Vector3D(0.5*a.wh.x,0.5*a.wh.y));if(null!=h)for(a=h.length,c=0;c<a;)e=c++,k.addTag(h[e]);return g};b.managers.PhysicsManager.createBoxCollider=function(a,c,e,d,n,g,h){null==g&&(g=0);null==n&&(n=0);null==d&&(d=0);c=new b.collision.BoxCollision(0,0,c,e);a=new b.components.colliders.BoxCollider(a,
c,new b.Vector3D(d,n,g));if(null!=h)for(d=h.length,n=0;n<d;)g=n++,a.addTag(h[g]);return a};b.managers.PhysicsManager.__super__=b.Manager;b.managers.PhysicsManager.prototype=r(b.Manager.prototype,{update:function(){b.Manager.prototype.update.call(this)},registerCollider:function(a){for(var b=this._colliders.length,c=0;c<b;){var d=c++;if(this._colliders[d]==a)return}this._colliders.push(a)},removeCollider:function(a){for(var b=this._colliders.length,c=0;c<b;){var d=c++;if(this._colliders[d]==a){this._colliders.splice(d,
1);break}}},getColliders:function(){return this._colliders},getRaycastPoint:function(a,c,e,d,n){null==d&&(d=!0);for(var g=-1,h=null,k=null,m=0,p=0,q=this._colliders.length,r=0;r<q;){var s=r++;p++;s=this._colliders[s];if(!1!=s.getIsActive()){if(null!=n){for(var t=!1,w=n.length,y=0;y<w;){var x=y++;if(s.hasTag(n[x])){t=!0;break}}if(!t)continue}m++;t=new b.Vector2D;if(d){if(w=new b.Vector2D,y=s.getRaycastPoint(a,c,t,d,w),-1==g&&0<y||0<y&&y<g)e.distance=y,e.collider=s,e.collisionPoint=t,k=e.normal=w,h=
t,g=y,v.remove(this._colliders,s),this._colliders.unshift(s)}else if(w=new b.Vector2D,y=s.getRaycastPoint(a,c,t,d,w),0<y){e.distance=y;e.collider=s;e.collisionPoint=t;k=e.normal=w;h=t;g=y;v.remove(this._colliders,s);this._colliders.unshift(s);break}}}this._raycastsThisFrame.push({start:a,end:c,hitPoint:h,normal:k});return g},render:function(){b.Manager.prototype.render.call(this);"0"==b.GameConfig.getProperty("debugDraw")&&(this._raycastsThisFrame=[])},debugRender:function(){b.Manager.prototype.debugRender.call(this);
for(var a=this._raycastsThisFrame.length,c=0;c<a;){var e=c++,d=this._raycastsThisFrame[e],n=d.start,g=d.end,e=d.hitPoint,h=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");h.save();var k=b.components.Camera.getDebugCamera().getEntity(),m=b.components.Camera.getDebugCamera().getZoomScale(),p=b.components.Camera.getDebugCamera().getSiblingComponent(b.pixi.PixiCamera);h.translate(-k.getPosition().x*m+p.getContainerOffset().x,-k.getPosition().y*m+p.getContainerOffset().y);h.scale(m,
m);null==e?(h.beginPath(),h.globalAlpha=1,h.lineWidth=1,h.strokeStyle="#AAAAFF",h.moveTo(n.x,n.y),h.lineTo(g.x,g.y),h.stroke()):(h.beginPath(),h.globalAlpha=1,h.lineWidth=1,h.strokeStyle="#AAAAFF",h.moveTo(n.x,n.y),h.lineTo(e.x,e.y),h.stroke(),h.beginPath(),h.globalAlpha=1,h.lineWidth=1,h.strokeStyle="#FFFF00",h.moveTo(e.x,e.y),h.lineTo(g.x,g.y),h.stroke(),null!=d.normal&&(n=(new b.Vector2D(g.x-e.x,g.y-e.y)).getLength(),d=new b.Vector2D(e.x+d.normal.x*n,e.y+d.normal.y*n),h.beginPath(),h.globalAlpha=
1,h.lineWidth=1,h.strokeStyle="#FF00FF",h.moveTo(e.x,e.y),h.lineTo(d.x,d.y),h.stroke()));h.restore()}this._raycastsThisFrame=[]},destroyAllColliders:function(){for(var a=this._colliders.length-1;0<=a;)this.removeCollider(this._colliders[a]),a--;this._colliders=[]},onRaycastCheck:function(a){this._raycastsThisFrame.push({start:a.start,end:a.end})},__class__:b.managers.PhysicsManager});b.managers.VoManager=function(){this._isCurrentVoLocked=!1;this._voTrack=null;b.Manager.call(this);b.managers.VoManager._instance=
this};b.managers.VoManager.__name__=["f84","managers","VoManager"];b.managers.VoManager.getInstance=function(){return b.managers.VoManager._instance};b.managers.VoManager.__super__=b.Manager;b.managers.VoManager.prototype=r(b.Manager.prototype,{playVo:function(a,c,e,d){null==d&&(d=!1);null==e&&(e=!1);null==c&&(c=!1);if(!this._isCurrentVoLocked||c)this.stopVo(),this._voTrack=b.audio.SoundManager.playSoundByName(a,e,d),c&&(b.Root.getInstance().invokeAsyncDeferredAction(this._voTrack.getSoundLength(),
s(this,this.onHighPrioritySoundElapse)),this._isCurrentVoLocked=!0)},onHighPrioritySoundElapse:function(){this._isCurrentVoLocked=!1},stopVo:function(){null!=this._voTrack&&(this._voTrack.stop(),this._voTrack=null)},__class__:b.managers.VoManager});b.pixi={};b.pixi.PixiContainer=function(a){this._updateParentingEveryFrame=!1;this._updateTransformsEveryFrame=!0;b.Component.call(this,a);this._positionOffset=new b.Vector2D(0,0);this._scaleModifier=new b.Vector2D(1,1);this._scaleOffset=new b.Vector2D(0,
0);this._rotationOffset=0;this._container=new PIXI.Container};b.pixi.PixiContainer.__name__=["f84","pixi","PixiContainer"];b.pixi.PixiContainer.__super__=b.Component;b.pixi.PixiContainer.prototype=r(b.Component.prototype,{getUpdateParentingEveryFrame:function(){return this._updateParentingEveryFrame},setUpdateParentingEveryFrame:function(a){this._updateParentingEveryFrame=a},getUpdateTransformsEveryFrame:function(){return this._updateTransformsEveryFrame},setUpdateTransformsEveryFrame:function(a){this._updateTransformsEveryFrame=
a},getPositionOffset:function(){return this._positionOffset},setPositionOffset:function(a){this._positionOffset=a},getScaleModifier:function(){return this._scaleModifier},setScaleModifier:function(a){this._scaleModifier=a},getScaleOffset:function(){return this._scaleOffset},setScaleOffset:function(a){this._scaleOffset=a},getRotationOffset:function(){return this._rotationOffset},setRotationOffset:function(a){this._rotationOffset=a},getContainer:function(){return this._container},init:function(){b.Component.prototype.init.call(this);
this.updateTransforms();this.updateParenting()},updateParenting:function(){if(!this.getIsMarkedForDeletion()){var a=this.getEntity().getParent();if(null!=a){var c=a.getComponent(b.pixi.PixiContainer);null==c&&(c=new b.pixi.PixiContainer(a));0<c.getContainer().children.length?c.getContainer().addChildAt(this._container,c.getContainer().children.length):c.getContainer().addChild(this._container);this._parentContainer=c}else 0<b.pixi.PixiManager.getInstance().getStage().children.length?b.pixi.PixiManager.getInstance().getStage().addChildAt(this._container,
b.pixi.PixiManager.getInstance().getStage().children.length):b.pixi.PixiManager.getInstance().getStage().addChild(this._container);this._container.visible=this.getEntity().getIsVisible()}},update:function(){b.Component.prototype.update.call(this);this._container.renderable&&(this._updateTransformsEveryFrame&&this.updateTransforms(),this._updateParentingEveryFrame&&this.updateParenting())},render:function(){b.Component.prototype.render.call(this)},postUpdate:function(){b.Component.prototype.postUpdate.call(this)},
bringToFront:function(){var a=this._container.parent;null!=a&&(a.removeChild(this._container),a.addChild(this._container))},updateTransforms:function(){var a=this.getEntity().getLocalPosition(),c=this.getEntity().getScaleRef();this._container.position=new PIXI.Point(a.x+this._positionOffset.x,a.y+this._positionOffset.y);this._container.rotation=b.utilities.Math2.degToRad(this.getEntity().getLocalRotation().z+this._rotationOffset);this._container.scale=new PIXI.Point(c.x*this._scaleModifier.x+this._scaleOffset.x,
c.y*this._scaleModifier.y+this._scaleOffset.y)},destroy:function(){b.Component.prototype.destroy.call(this);null!=this._container.parent&&this._container.parent.removeChild(this._container)},__class__:b.pixi.PixiContainer});b.pixi.PixiSprite=function(a,c,e){this._destroyCachedSpriteNextFrame=!1;b.pixi.PixiContainer.call(this,a);null!=this._container.parent&&this._container.parent.removeChild(this._container);a=null;b.managers.AssetManager.assetExists(c)&&(this._currentImageElement=b.managers.AssetManager.getAsset(c),
PIXI.Texture.fromImage(this._currentImageElement.src),a=null==e?PIXI.Texture.fromImage(this._currentImageElement.src):new PIXI.Texture(PIXI.BaseTexture.fromImage(this._currentImageElement.src),e),this._currentAssetId=c);this._container=new PIXI.Sprite(a);this.updateTransforms()};b.pixi.PixiSprite.__name__=["f84","pixi","PixiSprite"];b.pixi.PixiSprite.__super__=b.pixi.PixiContainer;b.pixi.PixiSprite.prototype=r(b.pixi.PixiContainer.prototype,{getSprite:function(){return this._container},setTextureFromImageId:function(a,
c){b.managers.AssetManager.assetExists(a)&&(this._currentAssetId!=a?(this._currentImageElement=b.managers.AssetManager.getAsset(a),null==c?this.getSprite().texture=PIXI.Texture.fromImage(this._currentImageElement.src):this.getSprite().texture=new PIXI.Texture(PIXI.BaseTexture.fromImage(this._currentImageElement.src),c)):null==c?this.getSprite().texture.noFrame=!0:(this.getSprite().texture.frame=c,this.getSprite().texture.noFrame=!1),this._currentAssetId=a);this.updateTransforms()},init:function(){b.pixi.PixiContainer.prototype.init.call(this);
this.updateCull()},updateParenting:function(){b.pixi.PixiContainer.prototype.updateParenting.call(this)},render:function(){b.pixi.PixiContainer.prototype.render.call(this)},updateCull:function(){},__class__:b.pixi.PixiSprite});b.pixi.PixiAnimation=function(a,c){this._prevFrame=0;this._onAnimationComplete=null;this._position=0;this._updateScale=1;this._isPlaying=!0;b.pixi.PixiSprite.call(this,a,"");this._currentAnimationName=c};b.pixi.PixiAnimation.__name__=["f84","pixi","PixiAnimation"];b.pixi.PixiAnimation.__super__=
b.pixi.PixiSprite;b.pixi.PixiAnimation.prototype=r(b.pixi.PixiSprite.prototype,{getUpdateScale:function(){return this._updateScale},setUpdateScale:function(a){this._updateScale=a},fixedUpdate:function(){b.pixi.PixiSprite.prototype.fixedUpdate.call(this);if(this._container.renderable){var a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);if(null!=a){if(this._isPlaying&&(this._position+=b.Root.getDeltaTime()*this.getUpdateScale(),this._position>=a.getLength()&&
(a.getLoop()?this._position-=a.getLength():(this._position=a.getLength(),this.stop()),null!=this._onAnimationComplete))){var c=this._onAnimationComplete;this._onAnimationComplete=null;c(this.getEntity());a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName)}if(null!=a&&(c=a.getSpriteIndexAtPosition(this._position),this._prevFrame!=c)){var e=a.getSpriteSheetNameAtPosition(this._position),d=b.spriteSheets.SpriteSheetManager.getInstance().getSpriteSheetByName(e).getSpriteInfoByIndex(c),
n=d.getCoords();this.setTextureFromImageId(e,new PIXI.Rectangle(n.ul.x,n.ul.y,n.wh.x,n.wh.y));e=a.getOffset().x/d.getCoords().wh.x;a=a.getOffset().y/d.getCoords().wh.y;n=d.getOffset().x/d.getCoords().wh.x;d=d.getOffset().y/d.getCoords().wh.y;this.getSprite().anchor=new PIXI.Point(-e-n,-a-d);this._prevFrame=c}}}},setPosition:function(a){this._position=a},getPosition:function(){return this._position},setAnimation:function(a,b,c){null==c&&(c=!1);if(this._currentAnimationName!=a||c)this._position=0;this._currentAnimationName=
a;this._onAnimationComplete=b;this._isPlaying=!0;this._prevFrame=-1},getAnimationLength:function(){var a=b.managers.AnimationManager.getInstance().getAnimationByName(this._currentAnimationName);return null!=a?a.getLength():0},getAnimation:function(){return this._currentAnimationName},play:function(){this._isPlaying=!0},stop:function(){this._isPlaying=!1},playing:function(){return this._isPlaying},setOnAnimationComplete:function(a){this._onAnimationComplete=a},getOnAnimationComplete:function(){return this._onAnimationComplete},
__class__:b.pixi.PixiAnimation});b.pixi.PixiCamera=function(a){this._containerOffset=new b.Vector2D(0,0);this._muteRotation=!1;this._layers=[];b.components.Camera.call(this,a)};b.pixi.PixiCamera.__name__=["f84","pixi","PixiCamera"];b.pixi.PixiCamera.__super__=b.components.Camera;b.pixi.PixiCamera.prototype=r(b.components.Camera.prototype,{getContainerOffset:function(){return this._containerOffset},setContainerOffset:function(a){this._containerOffset.x=a.x;this._containerOffset.y=a.y},getMuteRotation:function(){return this._muteRotation},
setMuteRotation:function(a){this._muteRotation=a},addLayer:function(a,c,e,d,n,g){null==g&&(g=1);null==n&&(n=0);null==d&&(d=0);null==e&&(e=1);null==c&&(c=1);a=new b.pixi.PixiCameraLayer(a,c,e,d,n,g);this._layers.push(a);return a},removeLayer:function(a){v.remove(this._layers,a)},getLayerByContainer:function(a){for(var b=this._layers.length,c=0;c<b;){var d=c++,d=this._layers[d];if(d.pixiContainer==a)return d}return null},getLayers:function(){return this._layers},fixedUpdate:function(){b.components.Camera.prototype.fixedUpdate.call(this);
for(var a=this.getEntity().getPosition(),c=this._layers.length,e=0;e<c;){var d=e++,n=this._zoomScale,d=this._layers[d],n=0==d.zoomModifier?1:n*d.zoomModifier;0==d.parallaxX&&0==d.parallaxY&&(n=1);d.muteXMovement?d.pixiContainer.setPositionOffset(new b.Vector2D(d.pixiContainer.getPositionOffset().x,b.Root.getInstance().getScreenSize().y/2+this._containerOffset.y*d.parallaxY)):d.muteYMovement?d.pixiContainer.setPositionOffset(new b.Vector2D(b.Root.getInstance().getScreenSize().x/2+this._containerOffset.x*
d.parallaxX,d.pixiContainer.getPositionOffset().y)):d.muteXMovement||d.muteYMovement||d.pixiContainer.setPositionOffset(new b.Vector2D(b.Root.getInstance().getScreenSize().x/2+this._containerOffset.x*d.parallaxX,b.Root.getInstance().getScreenSize().y/2+this._containerOffset.y*d.parallaxY));this._muteRotation||d.pixiContainer.setRotationOffset(this.getEntity().getRotation().z);d.pixiContainer.getContainer().pivot=new PIXI.Point(Math.floor(a.x*d.parallaxX)-d.originX+b.Root.getInstance().getScreenSize().x/
n/2,Math.floor(a.y*d.parallaxY)-d.originY+b.Root.getInstance().getScreenSize().y/n/2);d.pixiContainer.setScaleModifier(new b.Vector2D(n,n))}},__class__:b.pixi.PixiCamera});b.pixi.PixiCameraLayer=function(a,b,c,d,n,g){null==g&&(g=1);this.muteXMovement=this.muteYMovement=!1;this.zoomModifier=1;this.originX=this.originY=0;this.parallaxX=this.parallaxY=1;this.pixiContainer=a;this.parallaxX=b;this.parallaxY=c;this.originX=d;this.originY=n;this.zoomModifier=g};b.pixi.PixiCameraLayer.__name__=["f84","pixi",
"PixiCameraLayer"];b.pixi.PixiCameraLayer.prototype={__class__:b.pixi.PixiCameraLayer};b.pixi.PixiManager=function(a){this._isSetup=!1;b.Manager.call(this)};b.pixi.PixiManager.__name__=["f84","pixi","PixiManager"];b.pixi.PixiManager.getInstance=function(){null==b.pixi.PixiManager._instance&&(b.pixi.PixiManager._instance=new b.pixi.PixiManager,b.Root.getInstance().addManager(b.pixi.PixiManager._instance));return b.pixi.PixiManager._instance};b.pixi.PixiManager.__super__=b.Manager;b.pixi.PixiManager.prototype=
r(b.Manager.prototype,{getWebGlEnabled:function(){return this._renderer.type==PIXI.RENDERER_TYPE.WEBGL},getStage:function(){return this._stage},getRenderer:function(){return this._renderer},setup:function(a){this._stage=new PIXI.Container;this._renderer=PIXI.autoDetectRenderer(b.Root.getInstance().getScreenSize().x,b.Root.getInstance().getScreenSize().y,a,!1);this._masterLayer=b.Root.getInstance().getLayerByName("master");q.getContainer().appendChild(this._renderer.view);a=q.getDocument().createElement("div");
q.getContainer().appendChild(a);a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.width=q.dataWidth+"px";a.style.height=q.dataHeight+"px";this._isSetup=!0},render:function(){b.Manager.prototype.render.call(this);this._isSetup&&this._renderer.render(this._stage)},handleMessage:function(a,c){b.Manager.prototype.handleMessage.call(this,a,c);switch(a){case "onOrientationChanged":null!=this._renderer&&this._renderer.resize(b.Root.getInstance().getScreenSize().x,b.Root.getInstance().getScreenSize().y)}},
__class__:b.pixi.PixiManager});b.pixi.PixiText=function(a,c,e,d){null==d&&(d=1);b.pixi.PixiContainer.call(this,a);null!=e&&null==e.padding&&(e.padding=8);this._container=new PIXI.Text(c,e,d);this.getText().anchor=new PIXI.Point(0.5,0.5);this.stripAndApplyRelevantHtml()};b.pixi.PixiText.__name__=["f84","pixi","PixiText"];b.pixi.PixiText.__super__=b.pixi.PixiContainer;b.pixi.PixiText.prototype=r(b.pixi.PixiContainer.prototype,{getText:function(){return this._container},getTextString:function(){return this.getText().text},
setTextString:function(a){this.getText().text=a;this.stripAndApplyRelevantHtml()},init:function(){b.pixi.PixiContainer.prototype.init.call(this)},destroy:function(){b.pixi.PixiContainer.prototype.destroy.call(this);this.getText().texture.baseTexture.destroy()},stripAndApplyRelevantHtml:function(){var a;a=q.getDocument().createElement("div");a.innerHTML=this.getTextString();var c="",c=B.parse(a.outerHTML);if(c.elementsNamed("div").hasNext()&&(c=c.elementsNamed("div").next(),c.elementsNamed("font").hasNext()&&
(c=c.elementsNamed("font").next(),c.exists("size")))){var c=-1!=c.get("size").indexOf("px")?t.parseInt(c.get("size"))+"px":t.parseInt(c.get("size"))+"pt",e=this.getText().style,d=e.font.split(" ");d[0]=c;e.font=d.join(" ");this.getText().style=e;b.Root.isFirefox()?this.getText().text=a.textContent:this.getText().text=a.innerText}},__class__:b.pixi.PixiText});b.screenTransition={};b.screenTransition.TransitionScreen=function(a,c,e){null==e&&(e=!0);b.GameState.call(this);this._from=a;this._to=c;this._destroyFrom=
e;b.audio.SoundManager.playSoundByName("transition_1")};b.screenTransition.TransitionScreen.__name__=["f84","screenTransition","TransitionScreen"];b.screenTransition.TransitionScreen.__super__=b.GameState;b.screenTransition.TransitionScreen.prototype=r(b.GameState.prototype,{onTransitionMidpoint:function(){this._destroyFrom&&this._from.destroy();b.Root.getInstance().addGameState(this._to);this.dispatchEvent(new b.screenTransition.TransitionScreenEvent("midpoint"))},onTransitionComplete:function(){this.destroy();
this.dispatchEvent(new b.screenTransition.TransitionScreenEvent("complete"))},__class__:b.screenTransition.TransitionScreen});b.screenTransition.TransitionScreenEvent=function(a){b.events.Event.call(this,a)};b.screenTransition.TransitionScreenEvent.__name__=["f84","screenTransition","TransitionScreenEvent"];b.screenTransition.TransitionScreenEvent.__super__=b.events.Event;b.screenTransition.TransitionScreenEvent.prototype=r(b.events.Event.prototype,{__class__:b.screenTransition.TransitionScreenEvent});
b.speechManager={};b.speechManager.Dialogue=function(a){this.soundName=a;this.subtitles=[]};b.speechManager.Dialogue.__name__=["f84","speechManager","Dialogue"];b.speechManager.Dialogue.prototype={__class__:b.speechManager.Dialogue};b.speechManager.SpeechManager=function(a,c){null==c&&(c=!0);null==a&&(a=!0);this._voTrack=this._speechMap=this._currentDeferredActions=null;b.Manager.call(this);this._speechMap=new b.speechManager.SpeechMap;this._voiceOversEnabled=a;this._subtitlesEnabled=c;this._currentDeferredActions=
[];b.speechManager.SpeechManager._instance=this};b.speechManager.SpeechManager.__name__=["f84","speechManager","SpeechManager"];b.speechManager.SpeechManager.getInstance=function(){return b.speechManager.SpeechManager._instance};b.speechManager.SpeechManager.__super__=b.Manager;b.speechManager.SpeechManager.prototype=r(b.Manager.prototype,{getVoiceOversEnabled:function(){return this._voiceOversEnabled},setVoiceOversEnabled:function(a){this._voiceOversEnabled=a},getSubtitlesEnabled:function(){return this._subtitlesEnabled},
setSubtitlesEnabled:function(a){this._subtitlesEnabled=a},init:function(){b.Manager.prototype.init.call(this)},setup:function(){this.parseSpeechMap()},parseSpeechMap:function(){for(var a=B.parse(b.managers.AssetManager.getAsset("speechMap")).elementsNamed("speech_map").next().elementsNamed("dialogue");a.hasNext();){for(var c=a.next(),e=new b.speechManager.Dialogue(c.get("soundName")),c=c.elementsNamed("subtitle");c.hasNext();){var d=c.next(),d=new b.speechManager.Subtitle(d.get("stringId"),t.parseFloat(d.get("time")),
t.parseFloat(d.get("duration")));e.subtitles.push(d)}this._speechMap.dialogue.push(e)}},stopVo:function(){null!=this._voTrack&&(this._voTrack.stop(),this._voTrack=null)},playVo:function(a){var c=this;null!=this._voTrack&&this.stopVo();if("0"==b.GameConfig.getProperty("speechMode")||"2"==b.GameConfig.getProperty("speechMode"))this._voTrack=b.audio.SoundManager.playSoundByName(a);if("1"==b.GameConfig.getProperty("speechMode")||"2"==b.GameConfig.getProperty("speechMode")){var e=this._speechMap.getDialogueBySoundName(a);
if(null!=e){for(;0<this._currentDeferredActions.length;)a=this._currentDeferredActions.pop(),b.Root.getInstance().destroyDeferredAction(a);a=e.subtitles.length;for(var d=0;d<a;){var n=d++,n=[e.subtitles[n]];this._currentDeferredActions.push(b.Root.getInstance().invokeAsyncDeferredAction(n[0].time,function(a){return function(){c.dispatchSubtitle(a[0])}}(n)))}}else b.utilities.Debug.log("WARNING: '"+a+"' has no subtitles.")}return this._voTrack},dispatchSubtitle:function(a){this.dispatchEvent(new b.speechManager.SubtitleEvent("showSubtitle",
a.duration,b.Localizer.getString(a.stringId)))},__class__:b.speechManager.SpeechManager});b.speechManager.SpeechMap=function(){this.dialogue=[]};b.speechManager.SpeechMap.__name__=["f84","speechManager","SpeechMap"];b.speechManager.SpeechMap.prototype={getDialogueBySoundName:function(a){for(var b=this.dialogue.length,c=0;c<b;){var d=c++;if(this.dialogue[d].soundName==a)return this.dialogue[d]}return null},__class__:b.speechManager.SpeechMap};b.speechManager.Subtitle=function(a,b,c){this.stringId=
a;this.time=b;this.duration=c};b.speechManager.Subtitle.__name__=["f84","speechManager","Subtitle"];b.speechManager.Subtitle.prototype={__class__:b.speechManager.Subtitle};b.speechManager.SubtitleEvent=function(a,c,e){this._duration=0;b.events.Event.call(this,a);this._duration=c;this._subtitleText=e};b.speechManager.SubtitleEvent.__name__=["f84","speechManager","SubtitleEvent"];b.speechManager.SubtitleEvent.__super__=b.events.Event;b.speechManager.SubtitleEvent.prototype=r(b.events.Event.prototype,
{getDuration:function(){return this._duration},getSubtitleText:function(){return this._subtitleText},__class__:b.speechManager.SubtitleEvent});b.spriteSheets={};b.spriteSheets.SpriteInfo=function(a,c,e,d){this._name=a;this._coords=c.getClone();this._spriteSheetName=e;null==d||Math.isNaN(d.x)&&Math.isNaN(d.y)?this._offset=new b.Vector2D:this._offset=new b.Vector2D(d.x,d.y)};b.spriteSheets.SpriteInfo.__name__=["f84","spriteSheets","SpriteInfo"];b.spriteSheets.SpriteInfo.prototype={getCoords:function(){return this._coords},
setOffset:function(a,b){this._offset.x=a;this._offset.y=b},getOffset:function(){return this._offset},getSpriteSheetName:function(){return this._spriteSheetName},getName:function(){return this._name},__class__:b.spriteSheets.SpriteInfo};b.spriteSheets.SpriteSheet=function(a,c){this._image=null;this._spriteInfo=[];this._spriteInfoHashTable=new w.ds.StringMap;this._name=a;null==c?this._imageName=a:(this._imageName=c,this._image=b.managers.AssetManager.getAsset(this._imageName))};b.spriteSheets.SpriteSheet.__name__=
["f84","spriteSheets","SpriteSheet"];b.spriteSheets.SpriteSheet.parseFromXmlString=function(a,c,e){e=B.parse(e);c=new b.spriteSheets.SpriteSheet(a,c);for(e=e.elementsNamed("TextureAtlas").next().elementsNamed("sprite");e.hasNext();){var d=e.next(),d=new b.spriteSheets.SpriteInfo(d.get("n"),new b.Rect2D(t.parseFloat(d.get("x")),t.parseFloat(d.get("y")),t.parseFloat(d.get("w")),t.parseFloat(d.get("h"))),a,new b.Vector2D(t.parseFloat(d.get("oX")),t.parseFloat(d.get("oY"))));c.addSpriteInfo(d)}b.spriteSheets.SpriteSheetManager.getInstance().registerSpriteSheet(c);
return c};b.spriteSheets.SpriteSheet.prototype={getNumSprites:function(){return this._spriteInfo.length},getName:function(){return this._name},getImage:function(){return this._image},getImageName:function(){return this._imageName},addSpriteInfo:function(a){this._spriteInfo.push(a);var b=a.getName();this._spriteInfoHashTable.set(b,a)},getSpriteInfoByIndex:function(a){return this._spriteInfo[a]},getSpriteInfoByName:function(a){return this._spriteInfoHashTable.get(a)},addToAllOffsets:function(a,b){for(var c=
this._spriteInfo.length,d=0;d<c;){var n=d++,n=this._spriteInfo[n];n.setOffset(n.getOffset().x+a,n.getOffset().y+b)}},__class__:b.spriteSheets.SpriteSheet};b.spriteSheets.SpriteSheetManager=function(){this._spriteSheets=new w.ds.StringMap};b.spriteSheets.SpriteSheetManager.__name__=["f84","spriteSheets","SpriteSheetManager"];b.spriteSheets.SpriteSheetManager.getInstance=function(){null==b.spriteSheets.SpriteSheetManager._instance&&(b.spriteSheets.SpriteSheetManager._instance=new b.spriteSheets.SpriteSheetManager);
return b.spriteSheets.SpriteSheetManager._instance};b.spriteSheets.SpriteSheetManager.createSpriteSheetFromGrid=function(a,c,e,d,n){var g=b.managers.AssetManager.getAsset(a),h=Math.floor(g.width/e),g=Math.floor(g.height/d);c=new b.spriteSheets.SpriteSheet(a,c);for(var k=0;k<g;)for(var m=k++,p=0;p<h;){var q=p++,q=new b.spriteSheets.SpriteInfo(a+q+"-"+m,new b.Rect2D(q*e,m*d,e,d),a,n);c.addSpriteInfo(q)}b.spriteSheets.SpriteSheetManager.getInstance().registerSpriteSheet(c)};b.spriteSheets.SpriteSheetManager.prototype=
{addToAllSpriteSheetOffsets:function(a,b,c){this.getSpriteSheetByName(a).addToAllOffsets(b,c)},getSpriteSheetByName:function(a){return this._spriteSheets.get(a)},registerSpriteSheet:function(a){var b=a.getName();this._spriteSheets.set(b,a)},removeSpriteSheetByName:function(a){this._spriteSheets.remove(a)},removeAllSpriteSheets:function(){this._spriteSheets=new w.ds.StringMap},__class__:b.spriteSheets.SpriteSheetManager};b.swipeDetector={};b.swipeDetector.SwipeDetector=function(a){this._swipeCombo=
this._mousePositions=this._swipeComboVector=null;this._isSwiping=!1;this._mouseDownPosition=null;b.Component.call(this,a);this._mousePositions=[];this._swipeCombo=[];this._swipeComboVector=[]};b.swipeDetector.SwipeDetector.__name__=["f84","swipeDetector","SwipeDetector"];b.swipeDetector.SwipeDetector.__super__=b.Component;b.swipeDetector.SwipeDetector.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},onMouseDown:function(a){},onMouseUp:function(a){},onMouseMove:function(a){},
reset:function(){this._swipeCombo=[];this._swipeComboVector=[]},addToSwipeCombo:function(a,c,e){null==this._swipeCombo&&(this._swipeCombo=[]);null==this._swipeComboVector&&(this._swipeComboVector=[]);null==this._mousePositions&&(this._mousePositions=[]);this._swipeCombo.push(a);this._swipeComboVector.push(c);this._mousePositions.push(e);5<this._swipeCombo.length&&(this._swipeCombo.shift(),this._swipeComboVector.shift(),this._mousePositions.shift());1<this._swipeCombo.length&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("",
null,null,this._swipeCombo,this._swipeComboVector,this._mousePositions))},injectMouseMove:function(a,b){this.onMouseMove({x:a,y:b})},injectMouseDown:function(a,b){this.onMouseDown({x:a,y:b})},injectMouseUp:function(a,b){this.onMouseUp({x:a,y:b})},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,a,c);switch(a){case "mouseDown":this.onMouseDown(c);break;case "mouseMove":this.onMouseMove(c);break;case "mouseUp":this.onMouseUp(c);break;case "mouseOut":this.onMouseUp(c)}},__class__:b.swipeDetector.SwipeDetector});
b.swipeDetector.DefaultSwipeDetector=function(a){this._lastMousePosition=null;b.swipeDetector.SwipeDetector.call(this,a)};b.swipeDetector.DefaultSwipeDetector.__name__=["f84","swipeDetector","DefaultSwipeDetector"];b.swipeDetector.DefaultSwipeDetector.__super__=b.swipeDetector.SwipeDetector;b.swipeDetector.DefaultSwipeDetector.prototype=r(b.swipeDetector.SwipeDetector.prototype,{onMouseDown:function(a){this._mouseDownPosition=new b.Vector2D(a.x,a.y);this._isSwiping=!0;this._swipeComboVector=[];this._swipeCombo=
[];this._mousePositions=[];this._mousePositions.push(this._mouseDownPosition.getClone());this._lastMousePosition=null},onMouseUp:function(a){this._isSwiping&&(a=new b.Vector2D(a.x,a.y),this._swipeCombo=null,this._isSwiping=!1,this._lastMousePosition=a.getClone(),this._mousePositions.push(a.getClone()))},onMouseMove:function(a){a=new b.Vector2D(a.x,a.y);null==this._lastMousePosition&&(this._lastMousePosition=a.getClone());if(this._isSwiping){var c=new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y);
-5>c.y?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeUp",this._lastMousePosition,a)),this.addToSwipeCombo("swipeUp",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone()):5<c.y?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeDown",this._lastMousePosition,a)),this.addToSwipeCombo("swipeDown",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),
a),this._lastMousePosition=a.getClone()):-5>c.x?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeLeft",this._lastMousePosition,a)),this.addToSwipeCombo("swipeLeft",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone()):5<c.x?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeRight",this._lastMousePosition,a)),this.addToSwipeCombo("swipeRight",new b.Vector2D(a.x-
this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone()):-5>c.x&&-5>c.y?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeUpLeft",this._lastMousePosition,a)),this.addToSwipeCombo("swipeUpLeft",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone()):-5>c.x&&5<c.y?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeDownLeft",
this._lastMousePosition,a)),this.addToSwipeCombo("swipeDownLeft",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone()):5<c.x&&-5>c.y?(null==this._swipeCombo&&this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeUpRight",this._lastMousePosition,a)),this.addToSwipeCombo("swipeUpRight",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone()):5<c.x&&5<c.y&&(null==this._swipeCombo&&
this.dispatchEvent(new b.swipeDetector.SwipeDetectorEvent("swipeDownRight",this._lastMousePosition,a)),this.addToSwipeCombo("swipeDownRight",new b.Vector2D(a.x-this._lastMousePosition.x,a.y-this._lastMousePosition.y),a),this._lastMousePosition=a.getClone())}},debugRender:function(){b.swipeDetector.SwipeDetector.prototype.debugRender.call(this);if(null!=this._swipeComboVector&&0!=this._swipeComboVector.length){var a=b.Layers.getDebug().getContext();a.save();var c=this._swipeComboVector.length;a.beginPath();
a.globalAlpha=0.65;a.lineWidth=1;a.strokeStyle="#4444FF";var e=b.Root.getInstance().getScreenSize().getClone();e.x*=0.5;e.y*=0.5;a.moveTo(this._mouseDownPosition.x,this._mouseDownPosition.y);e=this._mouseDownPosition.getClone();a.lineTo(e.x,e.y);for(var d=0;d<c;){var n=d++;e.x+=this._swipeComboVector[n].x;e.y+=this._swipeComboVector[n].y;a.lineTo(e.x,e.y);a.arc(e.x,e.y,2,0,2*Math.PI,!1);a.moveTo(e.x,e.y)}a.stroke();a.restore()}},__class__:b.swipeDetector.DefaultSwipeDetector});b.swipeDetector.SwipeDetectorEvent=
function(a,c,e,d,n,g){b.events.Event.call(this,a);this.start=c;this.end=e;this.combo=d;this.comboVectors=n;this.mousePositions=g};b.swipeDetector.SwipeDetectorEvent.__name__=["f84","swipeDetector","SwipeDetectorEvent"];b.swipeDetector.SwipeDetectorEvent.__super__=b.events.Event;b.swipeDetector.SwipeDetectorEvent.prototype=r(b.events.Event.prototype,{__class__:b.swipeDetector.SwipeDetectorEvent});b.tmx={};b.tmx.TmxImage=function(){this.image=null;this.width=this.height=0;this.trans="#000000";this.source=
""};b.tmx.TmxImage.__name__=["f84","tmx","TmxImage"];b.tmx.TmxImage.prototype={__class__:b.tmx.TmxImage};b.tmx.TmxImageLayer=function(){this.image=null;this.width=this.height=0;this.properties=new w.ds.StringMap};b.tmx.TmxImageLayer.__name__=["f84","tmx","TmxImageLayer"];b.tmx.TmxImageLayer.prototype={__class__:b.tmx.TmxImageLayer};b.tmx.TmxLayer=function(){this.data="";this.width=this.height=0;this.name="";this.properties=new w.ds.StringMap;this.tileValues=[]};b.tmx.TmxLayer.__name__=["f84","tmx",
"TmxLayer"];b.tmx.TmxLayer.prototype={decompressData:function(){for(var a=this.data.split(","),b=a.length,c=0;c<b;){var d=c++,d=t.parseInt(a[d]);this.tileValues.push(d)}},isSpace:function(a,b){var c=v.cca(a,b);return 9<=c&&13>=c||32==c},__class__:b.tmx.TmxLayer};b.tmx.TmxLevel=function(a,c,e,d,n,g,h){this._tiles=this._colliderEntities=this._layerContainers=null;this._isLoaded=!1;this._layer=this._fgLayer=this._camera=this._onLevelLoaded=null;this._basePath="";this._tmxMap=null;b.Component.call(this,
a);this._tmxMap=c;this._layer=d;this._fgLayer=n;this._camera=g;this._basePath=e;this._onLevelLoaded=h;this._tiles=[];this._colliderEntities=[];this._layers=[];this._layerContainers=[]};b.tmx.TmxLevel.__name__=["f84","tmx","TmxLevel"];b.tmx.TmxLevel.__super__=b.Component;b.tmx.TmxLevel.prototype=r(b.Component.prototype,{getCamera:function(){return this._camera},setCamera:function(a){this._camera=a},getBasePath:function(){return this._basePath},getLayerContainerByName:function(a){for(var b=this._layerContainers.length,
c=0;c<b;){var d=c++,d=this._layerContainers[d];if(d.getName()==a)return d}return null},getTiles:function(){return this._tiles},getTmxMap:function(){return this._tmxMap},init:function(){b.Component.prototype.init.call(this);new b.pixi.PixiContainer(this.getEntity());this._loadBatch=new b.LoadBatch(!0);for(var a=this._tmxMap.tilesets.length,c=0;c<a;){var e=c++,e=this._tmxMap.tilesets[e];if(0<e.images.length)e=this._basePath+e.images[0].source,this._loadBatch.addAsset("tmxImage"+e,e,b.AssetType.Image);
else if(0<e.tiles.length)for(var d=e.tiles.length,n=0;n<d;){var g=n++;""!=e.tiles[g].image.source&&(g=this._basePath+e.tiles[g].image.source,this._loadBatch.addAsset("tmxImage"+g,g,b.AssetType.Image))}else"undefined"!=e.source&&null!=e.source&&(d=this._basePath+e.source,console.log(e.source),this._loadBatch.addAsset("tmxTileset"+d,d,b.AssetType.Other))}a=this._tmxMap.imageLayers.length;for(c=0;c<a;)e=c++,e=this._tmxMap.imageLayers[e],console.log("ADDING tmxImage"+this._basePath+e.image.source),this._loadBatch.addAsset("tmxImage"+
this._basePath+e.image.source,this._basePath+e.image.source,b.AssetType.Image);this._loadBatch.load(s(this,this.onTilesetsLoaded))},onTilesetsLoaded:function(){for(var a=new b.LoadBatch(!0),c=this._tmxMap.tilesets.length,e=0;e<c;){var d=e++,d=this._tmxMap.tilesets[d];if(0==d.images.length){var n="tmxTileset"+this._basePath+d.source;if(b.managers.AssetManager.assetExists(n)){n=B.parse(b.managers.AssetManager.getAsset(n)).elementsNamed("tileset").next();d.name=n.get("name");d.tileWidth=parseInt(n.get("tilewidth"));
d.tileHeight=parseInt(n.get("tileheight"));var n=n.elementsNamed("image").next(),g=n.get("source"),h=new b.tmx.TmxImage;h.source=g;h.width=parseInt(n.get("width"));h.height=parseInt(n.get("height"));h.trans=n.get("trans");d.images[0]=h;a.addAsset("tmxImage"+this._basePath+g,this._basePath+g,b.AssetType.Image)}}else d.images[0].image=b.managers.AssetManager.getAsset("tmxImage"+this._basePath+d.images[0].source)}a.load(s(this,this.onTilesetImagesLoaded))},onTilesetImagesLoaded:function(){for(var a=
this._tmxMap.tilesets.length,c=0;c<a;){var e=c++,e=this._tmxMap.tilesets[e];null!=e.images[0]&&null==e.images[0].image&&(e.images[0].image=b.managers.AssetManager.getAsset("tmxImage"+this._basePath+e.images[0].source))}this.onLevelLoaded()},onLevelLoaded:function(){this._isLoaded||(this._isLoaded=!0,null!=this._onLevelLoaded&&(this._onLevelLoaded(),this._onLevelLoaded=null))},createLevel:function(a,c,e){this._isLoaded||b.utilities.Debug.log("Level not loaded; Cannot execute 'createLevel()'!");this.instantiateEntities(a,
c,e);this.processCollision(a,c,e)},instantiateEntities:function(a,c,e){null==e&&(e=0);null==c&&(c=0);for(var d=this._tmxMap.imageLayers.length,n=0;n<d;){var g=n++,h=this._tmxMap.imageLayers[g],g=this.getEntity().getGameState().addEntity();this.getEntity().addChild(g);new b.pixi.PixiSprite(g,"tmxImage"+this._basePath+h.image.source);var k=1,m=1;h.properties.exists("ParallaxX")&&(t.parseFloat(h.properties.get("ParallaxX")),h.properties.exists("ParallaxX")&&(k=t.parseFloat(h.properties.get("ParallaxX"))));
h.properties.exists("ParallaxY")&&(t.parseFloat(h.properties.get("ParallaxY")),h.properties.exists("ParallaxY")&&(m=t.parseFloat(h.properties.get("ParallaxY"))));var p=this._camera,q=this.getGameState().addEntity();null==a?this.getEntity().addChild(q):a.addChild(q);var r=new b.pixi.PixiContainer(q);q.addChild(g);p.addLayer(r,k,m);h.properties.exists("OriginX")&&(k=t.parseFloat(h.properties.get("OriginX")),g.setPosition(g.getLocalPosition().x+k*this._tmxMap.tileWidth,g.getLocalPosition().y,g.getLocalPosition().z));
h.properties.exists("OriginY")&&(h=t.parseFloat(h.properties.get("OriginY")),g.setPosition(g.getLocalPosition().x,g.getLocalPosition().y+h*this._tmxMap.tileHeight,g.getLocalPosition().z))}d=this._tmxMap.layers.length;for(n=0;n<d;)if(g=n++,h=this._tmxMap.layers[g],!h.properties.exists("NoMobile")||b.pixi.PixiManager.getInstance().getWebGlEnabled()){g=this.getGameState().addEntity();g.setName(h.name);this._layerContainers.push(g);new b.pixi.PixiContainer(g);null==a?this.getEntity().addChild(g):a.addChild(g);
for(var k=h.height,m=h.width,p=this._tmxMap.tileWidth,q=this._tmxMap.tileHeight,r=this._tmxMap.tilesets.length,s=[],v=0;v<r;){var w=v++,w=this._tmxMap.tilesets[w];if(null!=w.images[0])for(var y="tmxImage"+this._basePath+w.images[0].source,x=b.managers.AssetManager.getAsset("tmxImage"+this._basePath+w.images[0].source),z=w.tileWidth,B=w.tileHeight,C=x.width,D=x.height,H=Math.floor(C/z),J=(z-1)/C,M=(B-1)/D,K=0;K<k;)for(var L=K++,N=0;N<m;){var Q=N++,O=Q*p,S=L*q,F=h.tileValues[L*m+Q];if(0!=F){for(var Q=
F&-2147483648,T=F&1073741824,U=F&536870912,F=F&536870911,P=1,R=0;R<r;){var V=R++;F>=this._tmxMap.tilesets[V].firstgid&&(P=this._tmxMap.tilesets[V].firstgid)}P==w.firstgid&&(F-=P,0>F||(P=F%H*z/C,R=Math.floor(F/H)*B/D,F=this.getEntity().getGameState().addEntity(),F.setPosition(O,S+q,this.getEntity().getPosition().z),F.translate(0,0),s.push(F),O=new b.pixi.PixiSprite(F,y,new PIXI.Rectangle(Math.round(P*x.width),Math.round(R*x.height),Math.round(J*x.width)+1,Math.round(M*x.height)+1)),O.setUpdateParentingEveryFrame(!1),
O.setUpdateTransformsEveryFrame(!1),O.setPositionOffset(new b.Vector2D(0,-w.tileHeight)),U&&(F.setRotation(0,0,90),F.setScale(1,-1)),Q&&(U?(F.translate(z,0),F.setScale(F.getScale().x,-F.getScale().y,1)):(F.translate(z,0),F.setScale(-F.getScale().x,F.getScale().y,1))),T&&(U?(F.translate(0,z),F.setScale(-F.getScale().x,F.getScale().y,1)):(F.translate(0,B),F.setScale(F.getScale().x,-F.getScale().y,1))),F.translate(c,e),g.addChild(F)))}}}G.getClass(this._camera)==b.pixi.PixiCamera&&(k=this._camera,m=
h.properties.exists("ParallaxX")?t.parseFloat(h.properties.get("ParallaxX")):1,h=h.properties.exists("ParallaxY")?t.parseFloat(h.properties.get("ParallaxY")):1,k.addLayer(g.getComponent(b.pixi.PixiContainer),m,h))}},processCollision:function(a,c,e){null==e&&(e=0);null==c&&(c=0);for(var d=this._tmxMap.objectGroups.length,n=0;n<d;)for(var g=n++,g=this._tmxMap.objectGroups[g],h=g.objects.length,k=0;k<h;){var m=k++,m=g.objects[m],p=m.polygon;if(("Collision"==m.type||"SoftCollision"==m.type||"PreLoopCollision"==
m.type||"PostLoopCollision"==m.type)&&null!=p){var q=m.rotation,r=this.getEntity().getGameState().addEntity();null==a?this.getEntity().addChild(r):a.addChild(r);for(var s=new b.collision.PolygonCollision,t=p.points.length,v=0;v<t;){var w=v++,w=p.points[w],x=Math.sin(b.utilities.Math2.degToRad(q)),y=Math.cos(b.utilities.Math2.degToRad(q));s.addPoint(Math.floor(w.x)*y-Math.floor(w.y)*x,Math.floor(w.x)*x+Math.floor(w.y)*y)}p=new b.components.colliders.PolygonCollider(r,s);"Collision"==m.type||"PreLoopCollision"==
m.type?(p.addTag("ground"),"PreLoopCollision"==m.type&&p.addTag("preLoopGround")):"PostLoopCollision"==m.type&&p.addTag("postLoopGround");r.setPosition(Math.floor(m.x),Math.floor(m.y));r.translate(c,e);this._colliderEntities.push(r)}else if("Collision"==m.type||"PreLoopCollision"==m.type||"PostLoopCollision"==m.type||"SoftCollision"==m.type)r=this.getEntity().getGameState().addEntity(),null==a?this.getEntity().addChild(r):a.addChild(r),p=new b.collision.PolygonCollision,p.addPoint(0,0),p.addPoint(m.width,
0),p.addPoint(m.width,m.height),p.addPoint(0,m.height),p.addPoint(0,0),p=new b.components.colliders.PolygonCollider(r,p),"Collision"==m.type||"PreLoopCollision"==m.type?(p.addTag("ground"),"PreLoopCollision"==m.type&&p.addTag("preLoopGround")):"PostLoopCollision"==m.type&&p.addTag("postLoopGround"),r.setPosition(Math.floor(m.x),Math.floor(m.y)),r.translate(c,e),this._colliderEntities.push(r)}},getAllObjectsByType:function(a){for(var b=this.getAllObjects(),c=[],c=c.concat(b),b=c.length-1;0<=b;)c[b].type!=
a&&c.splice(b,1),b--;return c},getAllObjects:function(){for(var a=[],b=this._tmxMap.objectGroups.length,c=0;c<b;)for(var d=c++,d=this._tmxMap.objectGroups[d],n=d.objects.length,g=0;g<n;){var h=g++;a.push(d.objects[h])}return a},getClosestObjectToPointByArray:function(a,c){for(var e=-1,d=null,n=c.length,g=0;g<n;){var h=g++,h=c[h],k=new b.Vector2D(h.x+h.width/2,h.y+h.height/2),k=new b.Vector2D(k.x-a.x,k.y-a.y);if(-1==e||k.getLength()<e)e=k.getLength(),d=h}return d},findObjectByName:function(a){for(var b=
this.getAllObjects(),c=b.length,d=0;d<c;){var n=d++,n=b[n];if(n.name==a)return n}return null},findObjectByType:function(a){for(var b=this.getAllObjects(),c=b.length,d=0;d<c;){var n=d++,n=b[n];if(n.type==a)return n}return null},getColliderEntities:function(){return this._colliderEntities},onDestroyed:function(){b.Component.prototype.onDestroyed.call(this);this._tmxMap=null},__class__:b.tmx.TmxLevel});b.tmx.TmxMap=function(){this.tilesets=this.layers=this.objectGroups=this.imageLayers=this.properties=
null;this.width=this.height=this.tileWidth=this.tileHeight=0;this.orientation="orthogonal";this.tilesets=[];this.layers=[];this.objectGroups=[];this.imageLayers=[];this.properties=new w.ds.StringMap};b.tmx.TmxMap.__name__=["f84","tmx","TmxMap"];b.tmx.TmxMap.prototype={createPixiSpriteByTileId:function(a,c,e){for(var d=this.tilesets.length,n=0;n<d;){var g=n++,g=this.tilesets[g];if(0!=g.images.length){var h=c;if(0!=h){for(var h=h&536870911,k=1,m=0;m<d;){var p=m++;h>=this.tilesets[p].firstgid&&(k=this.tilesets[p].firstgid)}if(k==
g.firstgid&&(h-=k,!(0>h)))return c="tmxImage"+e+g.images[h].source,b.managers.AssetManager.getAsset(c),new b.pixi.PixiSprite(a,c)}}}return null},__class__:b.tmx.TmxMap};b.tmx.TmxObject=function(){this.gid=-1;this.polygon=this.polyline=null;this.x=this.y=this.rotation=this.width=this.height=0;this.name=this.type="";this.properties=new w.ds.StringMap};b.tmx.TmxObject.__name__=["f84","tmx","TmxObject"];b.tmx.TmxObject.prototype={parsePolygon:function(a){this.polygon=new b.tmx.TmxPolygon;a=a.split(" ");
for(var c=a.length,e=0;e<c;){var d=e++,d=a[d].split(","),d=new b.Vector2D(t.parseFloat(d[0]),t.parseFloat(d[1]));this.polygon.points.push(d)}},parsePolyline:function(a){this.polyline=new b.tmx.TmxPolyline;a=a.split(" ");for(var c=a.length,e=0;e<c;){var d=e++,d=a[d].split(","),d=new b.Vector2D(t.parseFloat(d[0]),t.parseFloat(d[1]));this.polyline.points.push(d)}},__class__:b.tmx.TmxObject};b.tmx.TmxObjectGroup=function(){this.visible=!0;this.width=this.height=0;this.name="";this.objects=[]};b.tmx.TmxObjectGroup.__name__=
["f84","tmx","TmxObjectGroup"];b.tmx.TmxObjectGroup.prototype={__class__:b.tmx.TmxObjectGroup};b.tmx.TmxPolygon=function(){this.points=[]};b.tmx.TmxPolygon.__name__=["f84","tmx","TmxPolygon"];b.tmx.TmxPolygon.prototype={__class__:b.tmx.TmxPolygon};b.tmx.TmxPolyline=function(){this.points=[]};b.tmx.TmxPolyline.__name__=["f84","tmx","TmxPolyline"];b.tmx.TmxPolyline.prototype={__class__:b.tmx.TmxPolyline};b.tmx.TmxReader=function(){};b.tmx.TmxReader.__name__=["f84","tmx","TmxReader"];b.tmx.TmxReader.getMapFromXmlString=
function(a){var c=new b.tmx.TmxMap;a=B.parse(a).elementsNamed("map").next();c.tileWidth=t.parseFloat(a.get("tilewidth"));c.tileHeight=t.parseFloat(a.get("tileheight"));c.width=t.parseFloat(a.get("width"));c.height=t.parseFloat(a.get("height"));c.orientation=a.get("orientation");for(var e=a.elementsNamed("properties");e.hasNext();)for(var d=e.next().elementsNamed("property");d.hasNext();){var n=d.next(),g=n.get("name"),n=n.get("value");c.properties.set(g,n)}for(e=a.elementsNamed("tileset");e.hasNext();){g=
e.next();d=new b.tmx.TmxTileset;d.firstgid=t.parseInt(g.get("firstgid"));d.source=g.get("source");d.name=g.get("name");d.tileWidth=t.parseInt(g.get("tilewidth"));d.tileHeight=t.parseInt(g.get("tileheight"));c.tilesets.push(d);if(g.elementsNamed("image").hasNext()){var n=g.elementsNamed("image").next(),h=new b.tmx.TmxImage;h.width=t.parseInt(n.get("width"));h.height=t.parseInt(n.get("height"));h.source=n.get("source");h.trans=n.get("trans");d.images.push(h)}for(g=g.elementsNamed("tile");g.hasNext();){h=
g.next();n=new b.tmx.TmxTile;n.id=h.get("id");var h=h.elementsNamed("image").next(),k=new b.tmx.TmxImage;null!=h&&(k.width=t.parseFloat(h.get("width")),k.height=t.parseFloat(h.get("height")),k.source=h.get("source"));n.image=k;d.tiles.push(n)}}for(e=a.elementsNamed("layer");e.hasNext();)if(g=e.next(),d=new b.tmx.TmxLayer,d.name=g.get("name"),d.width=t.parseFloat(g.get("width")),d.height=t.parseFloat(g.get("height")),g.elementsNamed("data").hasNext()?d.data=g.elementsNamed("data").next().firstChild().get_nodeValue():
d.data=null,d.decompressData(),c.layers.push(d),g.elementsNamed("properties").hasNext())for(g=g.elementsNamed("properties").next().elementsNamed("property");g.hasNext();)h=g.next(),n=h.get("name"),h=h.get("value"),d.properties.set(n,h);for(e=a.elementsNamed("objectgroup");e.hasNext();){g=e.next();d=new b.tmx.TmxObjectGroup;d.width=t.parseFloat(g.get("width"));d.height=t.parseFloat(g.get("height"));d.visible=1==t.parseInt(g.get("visible"));d.name=g.get("name");for(g=g.elementsNamed("object");g.hasNext();)if(h=
g.next(),n=new b.tmx.TmxObject,n.name=h.get("name"),n.width=t.parseFloat(h.get("width")),n.height=t.parseFloat(h.get("height")),n.x=t.parseFloat(h.get("x")),n.y=t.parseFloat(h.get("y")),n.type=h.get("type"),h.exists("rotation")?n.rotation=t.parseFloat(h.get("rotation")):n.rotation=0,h.exists("gid")?n.gid=t.parseInt(h.get("gid")):n.gid=null,d.objects.push(n),h.elementsNamed("polygon").hasNext()&&n.parsePolygon(h.elementsNamed("polygon").next().get("points")),h.elementsNamed("polyline").hasNext()&&
n.parsePolyline(h.elementsNamed("polyline").next().get("points")),h.elementsNamed("properties").hasNext())for(h=h.elementsNamed("properties").next().elementsNamed("property");h.hasNext();){var m=h.next(),k=m.get("name"),m=m.get("value");n.properties.set(k,m)}c.objectGroups.push(d)}for(a=a.elementsNamed("imagelayer");a.hasNext();)if(d=a.next(),!d.exists("visible")||"0"!=d.get("visible")){e=new b.tmx.TmxImageLayer;e.name=d.get("name");e.width=t.parseInt("width");e.height=t.parseInt("height");g=new b.tmx.TmxImage;
e.image=g;g.source=d.elementsNamed("image").next().get("source");if(d.elementsNamed("properties").hasNext())for(d=d.elementsNamed("properties").next().elementsNamed("property");d.hasNext();)n=d.next(),g=n.get("name"),n=n.get("value"),e.properties.set(g,n);c.imageLayers.push(e)}b.utilities.Debug.log(c);return c};b.tmx.TmxReader.prototype={__class__:b.tmx.TmxReader};b.tmx.TmxTile=function(){};b.tmx.TmxTile.__name__=["f84","tmx","TmxTile"];b.tmx.TmxTile.prototype={__class__:b.tmx.TmxTile};b.tmx.TmxTileset=
function(){this.name="";this.tileWidth=this.tileHeight=0;this.source="";this.firstgid=0;this.images=[];this.tiles=[]};b.tmx.TmxTileset.__name__=["f84","tmx","TmxTileset"];b.tmx.TmxTileset.prototype={__class__:b.tmx.TmxTileset};b.ui={};b.ui.UiElementHorizontalAlignment={__ename__:!0,__constructs__:["Left","Center","Right"]};b.ui.UiElementHorizontalAlignment.Left=["Left",0];b.ui.UiElementHorizontalAlignment.Left.toString=D;b.ui.UiElementHorizontalAlignment.Left.__enum__=b.ui.UiElementHorizontalAlignment;
b.ui.UiElementHorizontalAlignment.Center=["Center",1];b.ui.UiElementHorizontalAlignment.Center.toString=D;b.ui.UiElementHorizontalAlignment.Center.__enum__=b.ui.UiElementHorizontalAlignment;b.ui.UiElementHorizontalAlignment.Right=["Right",2];b.ui.UiElementHorizontalAlignment.Right.toString=D;b.ui.UiElementHorizontalAlignment.Right.__enum__=b.ui.UiElementHorizontalAlignment;b.ui.UiElementHorizontalAlignment.__empty_constructs__=[b.ui.UiElementHorizontalAlignment.Left,b.ui.UiElementHorizontalAlignment.Center,
b.ui.UiElementHorizontalAlignment.Right];b.ui.UiElementVerticalAlignment={__ename__:!0,__constructs__:["Top","Center","Bottom"]};b.ui.UiElementVerticalAlignment.Top=["Top",0];b.ui.UiElementVerticalAlignment.Top.toString=D;b.ui.UiElementVerticalAlignment.Top.__enum__=b.ui.UiElementVerticalAlignment;b.ui.UiElementVerticalAlignment.Center=["Center",1];b.ui.UiElementVerticalAlignment.Center.toString=D;b.ui.UiElementVerticalAlignment.Center.__enum__=b.ui.UiElementVerticalAlignment;b.ui.UiElementVerticalAlignment.Bottom=
["Bottom",2];b.ui.UiElementVerticalAlignment.Bottom.toString=D;b.ui.UiElementVerticalAlignment.Bottom.__enum__=b.ui.UiElementVerticalAlignment;b.ui.UiElementVerticalAlignment.__empty_constructs__=[b.ui.UiElementVerticalAlignment.Top,b.ui.UiElementVerticalAlignment.Center,b.ui.UiElementVerticalAlignment.Bottom];b.ui.UiElement=function(a,c){this._updateEveryFrame=!0;this._positionDirty=this._pixelPerfect=!1;this._uiPanel=this._coords=this._size=this._scale=null;b.Component.call(this,a);this.setUiPanel(c);
this._coords=new b.Vector2D(0,0);this._scale=new b.Vector2D(1,1);this._horizontalAlignment=b.ui.UiElementHorizontalAlignment.Center;this._verticalAlignment=b.ui.UiElementVerticalAlignment.Center};b.ui.UiElement.__name__=["f84","ui","UiElement"];b.ui.UiElement.__super__=b.Component;b.ui.UiElement.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);if(null==this._size){var a=this.getSiblingComponent(b.components.GameImage),c=this.getSiblingComponent(b.pixi.PixiSprite);
null!=a?this.setSize(a.getSize()):null!=c?this.setSize(new b.Vector2D(c.getSprite().width,c.getSprite().height)):this.setSize(new b.Vector2D(0,0))}this.updateDisplay()},getScaleRef:function(){return this._scale},getSize:function(){return this._size},getPixelPerfect:function(){return this._pixelPerfect},setPixelPerfect:function(a){this._pixelPerfect=a},setSize:function(a){null==this._size&&(this._size=new b.Vector2D);this._size.x=a.x;this._size.y=a.y},getUiPanel:function(){return this._uiPanel},setScale:function(a,
c){null==c&&(c=1);null==a&&(a=1);this._scale=new b.Vector2D(a,c)},setUiPanel:function(a){null!=this._uiPanel&&this._uiPanel.removeEventListener("updateDisplay",s(this,this.onUiPanelUpdateDisplay));this._uiPanel=a;this._uiPanel.addEventListener("updateDisplay",s(this,this.onUiPanelUpdateDisplay));this._uiPanel.getEntity().addChild(this.getEntity())},getHorizontalAlignment:function(){return this._horizontalAlignment},setHorizontalAlignment:function(a){this._horizontalAlignment=a;this._positionDirty=
!0},getVerticalAlignment:function(){return this._verticalAlignment},setVerticalAlignment:function(a){this._verticalAlignment=a;this._positionDirty=!0},getCoords:function(){return this._coords},getCoordsRef:function(){return this._coords},setCoords:function(a){this._coords=a},setAlignment:function(a,b){this.setHorizontalAlignment(a);this.setVerticalAlignment(b)},update:function(){b.Component.prototype.update.call(this)},postUpdate:function(){b.Component.prototype.postUpdate.call(this);(this._positionDirty||
this._updateEveryFrame)&&this.updateDisplay()},onUiPanelUpdateDisplay:function(){this._positionDirty=!0},updateDisplay:function(){q.getWindow();this._uiPanel.getSize();b.Root.getInstance().getScreenSize();this._uiPanel.getSize();b.Root.getInstance().getScreenSize();var a=this._uiPanel.getSize().x/2*this._coords.x,c=this._uiPanel.getSize().y/2*this._coords.y;this._pixelPerfect?this.getEntity().setScale(this._scale.x,this._scale.y):this.getEntity().setScale(this._scale.x/this._uiPanel.getEntity().getScale().x,
this._scale.y/this._uiPanel.getEntity().getScale().y);var e=this._size.getClone();switch(this._horizontalAlignment[1]){case 0:a+=e.x/2/this._uiPanel.getEntity().getScale().x;break;case 2:a-=e.x/2/this._uiPanel.getEntity().getScale().x}switch(this._verticalAlignment[1]){case 0:c+=e.y/2/this._uiPanel.getEntity().getScale().y;break;case 2:c-=e.y/2/this._uiPanel.getEntity().getScale().y}this.getEntity().setPosition(a,c);this._positionDirty=!1},debugRender:function(){b.Component.prototype.debugRender.call(this);
if(null!=this._size){var a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();var c=this.getEntity().getPosition();a.beginPath();a.lineWidth=1;a.strokeStyle="#0000FF";a.moveTo(c.x-this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y-this._size.y/2);a.stroke();a.restore()}},__class__:b.ui.UiElement});b.ui.UiPanel=
function(a,c){b.Component.call(this,a);this._size=c;this._window=q.getWindow()};b.ui.UiPanel.__name__=["f84","ui","UiPanel"];b.ui.UiPanel.__super__=b.Component;b.ui.UiPanel.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.setSize(this._size)},getSize:function(){return this._size},setSize:function(a){this._size=a;this.updateDisplay()},getScreenSize:function(){var a=this._size.getClone();a.x*=this._window.innerWidth/this._size.x;a.y*=this._window.innerHeight/
this._size.y;return a},updateDisplay:function(){this.dispatchEvent(new b.ui.UiPanelEvent("updateDisplay"));this.getEntity().setScale(1/b.Root.getInstance().getScreenScale().x,1/b.Root.getInstance().getScreenScale().y)},debugRender:function(){b.Component.prototype.debugRender.call(this);var a=b.Root.getInstance().getLayerByName("debug").getCanvas().getContext("2d");a.save();var c=this.getEntity().getPosition();a.beginPath();a.lineWidth=1;a.strokeStyle="#FF0000";a.moveTo(c.x-this._size.x/2,c.y-this._size.y/
2);a.lineTo(c.x+this._size.x/2,c.y-this._size.y/2);a.lineTo(c.x+this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y+this._size.y/2);a.lineTo(c.x-this._size.x/2,c.y-this._size.y/2);a.stroke();a.restore()},__class__:b.ui.UiPanel});b.ui.UiPanelEvent=function(a){b.events.Event.call(this,a)};b.ui.UiPanelEvent.__name__=["f84","ui","UiPanelEvent"];b.ui.UiPanelEvent.__super__=b.events.Event;b.ui.UiPanelEvent.prototype=r(b.events.Event.prototype,{__class__:b.ui.UiPanelEvent});b.ui.UiPanelSizeToWindow=
function(a,c,e){null==e&&(e=!0);this._constrainToGameSize=!0;this._prevWidth=this._prevHeight=0;this._uiPanel=this._window=null;b.Component.call(this,a);this._uiPanel=c;this._window=q.getWindow();this._constrainToGameSize=e};b.ui.UiPanelSizeToWindow.__name__=["f84","ui","UiPanelSizeToWindow"];b.ui.UiPanelSizeToWindow.__super__=b.Component;b.ui.UiPanelSizeToWindow.prototype=r(b.Component.prototype,{update:function(){b.Component.prototype.update.call(this);var a=this._window.innerWidth,c=this._window.innerHeight,
e=b.Root.getInstance().getScreenSize();e.x*=b.Root.getInstance().getScreenScale().x;e.y*=b.Root.getInstance().getScreenScale().y;this._constrainToGameSize&&(a>e.x&&(a=e.x),c>e.y&&(c=e.y));this._prevWidth==a&&this._prevHeight==c&&"NONE"==b.GameConfig.getProperty("forceOrientation")||this._uiPanel.setSize(new b.Vector2D(a,c));this.getEntity().setPosition(b.Root.getInstance().getScreenSize().x/2,b.Root.getInstance().getScreenSize().y/2);this._prevWidth=a;this._prevHeight=c},__class__:b.ui.UiPanelSizeToWindow});
b.utilities={};b.utilities.ArrayUtils=function(){};b.utilities.ArrayUtils.__name__=["f84","utilities","ArrayUtils"];b.utilities.ArrayUtils.indexOf=function(a,b){for(var c=a.length,d=0;d<c;){var n=d++;if(a[n]==b)return n}return-1};b.utilities.ArrayUtils.clear=function(a){a.length=0};b.utilities.ArrayUtils.prototype={__class__:b.utilities.ArrayUtils};b.utilities.Debug=function(){};b.utilities.Debug.__name__=["f84","utilities","Debug"];b.utilities.Debug.log=function(a){};b.utilities.Debug.alert=function(a){};
b.utilities.KeyCodes=function(){};b.utilities.KeyCodes.__name__=["f84","utilities","KeyCodes"];b.utilities.Math2=function(){};b.utilities.Math2.__name__=["f84","utilities","Math2"];b.utilities.Math2.degToRad=function(a){return 0.0174532925*a};b.utilities.Math2.radToDeg=function(a){return 57.2957795*a};b.utilities.Math2.randomFloat=function(a,b){return a+Math.random()*(b-a)};b.utilities.Math2.randomInt=function(a,c){return Math.floor(b.utilities.Math2.randomFloat(a,c))};b.utilities.Math2.getClosestPointOnSegment=
function(a,c,e){c=new b.Vector2D(c.x-a.x,c.y-a.y);e=(new b.Vector2D(e.x-a.x,e.y-a.y)).dotProduct(c)/c.dotProduct(c);0>e&&(e=0);1<e&&(e=1);e=new b.Vector2D(c.x*e,c.y*e);return new b.Vector2D(a.x+e.x,a.y+e.y)};b.utilities.Math2.lineIntersect2D=function(a,c,e,d,n){var g=(c.x-a.x)*(d.y-e.y)-(c.y-a.y)*(d.x-e.x),h=(c.x-a.x)*(d.y-e.y)-(c.y-a.y)*(d.x-e.x);if(0==g||0==h)return-2;d=((a.y-e.y)*(d.x-e.x)-(a.x-e.x)*(d.y-e.y))/g;e=((a.y-e.y)*(c.x-a.x)-(a.x-e.x)*(c.y-a.y))/h;return 0<d&&1>d&&0<e&&1>e?(e=(new b.Vector2D(a.x-
c.x,a.y-c.y)).getLength()*d,c=new b.Vector2D(c.x-a.x,c.y-a.y),c.scaleBy(d,d),c=new b.Vector2D(a.x+c.x,a.y+c.y),n.x=c.x,n.y=c.y,e):-1};b.utilities.Math2.clamp=function(a,b,c){return a<b?b:a>c?c:a};b.utilities.Math2.getRotated2dVector=function(a,c){var e=b.utilities.Math2.degToRad(c),d=Math.cos(e),e=Math.sin(e),n=new b.Vector2D(a.x,a.y),g=n.x*e+n.y*d;n.x=n.x*d-n.y*e;n.y=g;return n};b.utilities.Math2.getAngleInDegreesBetween2dVectors=function(a,c){return b.utilities.Math2.radToDeg(Math.atan2(a.x*c.y-
a.y*c.x,a.dotProduct(c)))};b.utilities.Math2.lerp=function(a,b,c){return(1-c)*a+c*b};b.utilities.Profiler=function(){};b.utilities.Profiler.__name__=["f84","utilities","Profiler"];b.utilities.Profiler.startTimer=function(a){var c=w.Timer.stamp();b.utilities.Profiler._profiles.set(a,c)};b.utilities.Profiler.stopTimer=function(a){return w.Timer.stamp()-b.utilities.Profiler._profiles.get(a)};b.utilities.Profiler.prototype={__class__:b.utilities.Profiler};b.utilities.StringTools2=function(){};b.utilities.StringTools2.__name__=
["f84","utilities","StringTools2"];b.utilities.StringTools2.convertFloatToTime=function(a){var c=b.Localizer.getString("GAMEPLAY_SCREEN_TIMER"),c=C.replace(c,"%N",Math.floor(a/60));a=t.string(Math.floor(a%60));2>a.length&&(a="0"+a);return c=C.replace(c,"%M",a)};b.utilities.StringTools2.prototype={__class__:b.utilities.StringTools2};b.utilities.WatchableValue=function(a){this._value=null;b.events.EventDispatcher.call(this);this._value=a};b.utilities.WatchableValue.__name__=["f84","utilities","WatchableValue"];
b.utilities.WatchableValue.__super__=b.events.EventDispatcher;b.utilities.WatchableValue.prototype=r(b.events.EventDispatcher.prototype,{set:function(a){var c=this._value;this._value=a;this._value!=c&&this.dispatchEvent(new b.utilities.WatchableValueEvent("change",this._value,c))},get:function(){return this._value},__class__:b.utilities.WatchableValue});b.utilities.WatchableValueEvent=function(a,c,e){b.events.Event.call(this,a);this.value=c;this.oldValue=e};b.utilities.WatchableValueEvent.__name__=
["f84","utilities","WatchableValueEvent"];b.utilities.WatchableValueEvent.__super__=b.events.Event;b.utilities.WatchableValueEvent.prototype=r(b.events.Event.prototype,{__class__:b.utilities.WatchableValueEvent});var c={AlertData:function(a,b,c,d,n){null==n&&(n=0);null==d&&(d=0);this.offsetX=this.offsetY=0;this.iconId=a;this.heading=b;this.body=c;this.offsetX=d;this.offsetY=n}};c.AlertData.__name__=["game","AlertData"];c.AlertData.prototype={__class__:c.AlertData};c.AlertPanel=function(a,c,e,d,n,
g,h){b.Component.call(this,a);this._iconId=c;this._heading=e;this._body=d;this._uiPanel=h;this._iconOffsetX=n;this._iconOffsetY=g;this._tweener=new b.components.Tweener(this.getEntity());this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());this._uiElement=new b.ui.UiElement(this.getEntity(),this._uiPanel);this._uiElement.setAlignment(b.ui.UiElementHorizontalAlignment.Center,b.ui.UiElementVerticalAlignment.Bottom);this._uiElement.setSize(new b.Vector2D(750,147));this._uiElement.setCoords(new b.Vector2D(0,
2))};c.AlertPanel.__name__=["game","AlertPanel"];c.AlertPanel.__super__=b.Component;c.AlertPanel.prototype=r(b.Component.prototype,{init:function(){var a=this;b.Component.prototype.init.call(this);new b.pixi.PixiContainer(this.getEntity());var d=this.getGameState().addEntity();(new b.pixi.PixiSprite(d,"alertFooter")).getSprite().anchor=new PIXI.Point(0.5,0.5);this.getEntity().addChild(d);var e=this.getGameState().addEntity();(new b.pixi.PixiSprite(e,this._iconId)).getSprite().anchor=new PIXI.Point(0.5,
0.5);e.setPosition(-275+this._iconOffsetX,this._iconOffsetY);d.addChild(e);var e=this.getGameState().addEntity(),f={};f.fill=c.GameColors.BLACK;f.font="32px league_gothic-webfont";f.align="center";(new b.pixi.PixiText(e,this._heading,f)).getText().anchor=new PIXI.Point(0,0);e.setPosition(0,-35);d.addChild(e);e=this.getGameState().addEntity();f={};f.fill=c.GameColors.BLACK;f.font="18px league_gothic-webfont";f.align="center";f.wordWrap=!0;f.wordWrapWidth=375;(new b.pixi.PixiText(e,this._body,f)).getText().anchor=
new PIXI.Point(0,0);e.setPosition(0,5);d.addChild(e);this.show();d=5.65;this._deferredAction.addDeferredAction(d,function(){a.dismiss()})},show:function(){this._tweener.addTween(this._uiElement.getCoordsRef(),"y",2,1,0.65,b.components.tween.EasingFunctions.easeOutQuad)},dismiss:function(){var a=this;this._tweener.addTween(this._uiElement.getCoordsRef(),"y",1,2,0.65,b.components.tween.EasingFunctions.easeInQuad,0,function(){a.getEntity().destroy()})},onCloseClick:function(){this._deferredAction.destroyAllDeferredActions();
this.dismiss()},__class__:c.AlertPanel});c.AlertsManager=function(){this._alertDataQueue=[];this._isAlertShowing=!1;b.Manager.call(this)};c.AlertsManager.__name__=["game","AlertsManager"];c.AlertsManager.getInstance=function(){null==c.AlertsManager._instance&&(c.AlertsManager._instance=new c.AlertsManager,b.Root.getInstance().addManager(c.AlertsManager._instance));return c.AlertsManager._instance};c.AlertsManager.__super__=b.Manager;c.AlertsManager.prototype=r(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this);
this._alertsState=new b.GameState;b.Root.getInstance().addGameState(this._alertsState);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this._alertsState);this._tweener=new b.components.Tweener(this._uiPanel.getEntity());this._deferredAction=new b.components.DeferredActionComponent(this._uiPanel.getEntity())},queueAlert:function(a,b,e,d,n){null==n&&(n=0);null==d&&(d=0);a=new c.AlertData(a,b,e,d,n);this._isAlertShowing?this._alertDataQueue.push(a):this.showAlert(a)},showAlert:function(a){b.utilities.Debug.log("AlertsManager::showAlert()");
var d=this._alertsState.addEntity();new c.AlertPanel(d,a.iconId,a.heading,a.body,a.offsetX,a.offsetY,this._uiPanel);d.addEventListener("destroy",s(this,this.onAlertPanelDestroy));this._isAlertShowing=!0},onAlertPanelDestroy:function(a){this._isAlertShowing=!1;0<this._alertDataQueue.length&&(this.showAlert(this._alertDataQueue[0]),this._alertDataQueue.splice(0,1))},__class__:c.AlertsManager});c.AnimationFactory=function(){};c.AnimationFactory.__name__=["game","AnimationFactory"];c.AnimationFactory.createAnimation=
function(a,c,e,d,n){null==n&&(n=!0);null==d&&(d=1);null==b.managers.AnimationManager.getInstance().getAnimationByName(a)&&(b.spriteSheets.SpriteSheet.parseFromXmlString(a,a,b.managers.AssetManager.getAsset(c)),b.components.Animation.makeLinearAnimationFromSheetBySpriteName(a,a,"",d,n).setOffset(e.x,e.y))};c.AnimationFactory.appendAnimation=function(a,c,e,d,n,g){null==g&&(g=!0);null==n&&(n=1);if(null==b.managers.AnimationManager.getInstance().getAnimationByName(c))for(a=b.managers.AnimationManager.getInstance().getAnimationByName(a),
b.spriteSheets.SpriteSheet.parseFromXmlString(c,c,b.managers.AssetManager.getAsset(e)),c=b.components.Animation.makeLinearAnimationFromSheetBySpriteName("tempAnim",c,"",n,g,-1,a.getKeyframeLength()),c.setOffset(d.x,d.y),d=c.getAnimationKeyframes(),c=d.length,e=0;e<c;)n=e++,a.addKeyframe(d[n])};c.AnimationFactory.prototype={__class__:c.AnimationFactory};c.ConfirmQuitState=function(a){b.GameState.call(this);this._parentState=a};c.ConfirmQuitState.__name__=["game","ConfirmQuitState"];c.ConfirmQuitState.__super__=
b.GameState;c.ConfirmQuitState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this),d=this.addEntity();(new b.pixi.PixiSprite(d,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);d=new b.ui.UiElement(d,a);d.setPixelPerfect(!0);d.setScale(200,1);var d=b.Root.getInstance().getLayerByName("ui"),e=this.addEntity();new b.ui.UiElement(e,a);new b.pixi.PixiContainer(e);var f=this.addEntity();f.setPosition(-46.5,-8.5);
(new b.pixi.PixiSprite(f,"popupBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);e.addChild(f);f=this.addEntity();f.setPosition(0,-67);new b.pixi.PixiText(f,b.Localizer.getString("GAMEPLAY_SCREEN_QUIT_CONFIRM_TEXT"),{font:"36px league_gothic-webfont",fill:"#FFFFFF",wordWrapWidth:350,wordWrap:!0,align:"center"});e.addChild(f);c.UiFactory.createTextButton(0,0.17,"GAMEPLAY_SCREEN_QUIT_CONFIRM_YES","textButton",a,d,s(this,this.onYesClicked),"ui_click_1");c.UiFactory.createPulseButtonQuick(a,0,0.67,"resumeButton",
"resumeButton",s(this,this.onNoClicked),d,"ui_click_1")},onYesClicked:function(){this.destroy();var a=new c.MenusState;c.FadeTransition.doTransition(this._parentState,a);a=c.menuScreens.TitleScreen.create(a);a.getUiPanel().getEntity().translate(0,0);c.MenusState.getInstance().addMenu(a);c.MenusState.getInstance().moveCameraInstant(-0,0);b.audio.SoundManager.playMusicByName("music_whats_gonna_happen");y.utag.UtagManager.getInstance().link("Quit: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),
"games")},onNoClicked:function(){var a=new c.PauseMenuState(this._parentState);b.Root.getInstance().addGameState(a);b.Root.getInstance().removeGameState(this)},__class__:c.ConfirmQuitState});c.CrossPromotionScreen=function(){b.GameState.call(this)};c.CrossPromotionScreen.__name__=["game","CrossPromotionScreen"];c.CrossPromotionScreen.show=function(){var a=new c.CrossPromotionScreen;b.Root.getInstance().addGameState(a);return a};c.CrossPromotionScreen.__super__=b.GameState;c.CrossPromotionScreen.prototype=
r(b.GameState.prototype,{init:function(){var a=this;b.GameState.prototype.init.call(this);var d=c.UiFactory.createFullscreenUiPanel(this);b.Root.getInstance().getLayerByName("ui");var e=this.addEntity();(new b.ui.UiElement(e,d)).setScale(200,1);(new b.pixi.PixiSprite(e,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);e=this.addEntity();(new b.pixi.PixiSprite(e,"crossPromotionFrame")).getSprite().anchor=new PIXI.Point(0.5,0.5);new b.ui.UiElement(e,d);var e=this.addEntity(),f=new b.ui.UiElement(e,
d);f.setCoords(new b.Vector2D(0,-0.7395833333333334));f.setScale(1,1);(new b.pixi.PixiSprite(e,"dtPopupLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);e=new b.LoadBatch(!0);e.addAsset("crossPromotionImage",b.GameConfig.getProperty("crossPromotionImageUrl"),b.AssetType.Image);e.load(function(){var c=a.addEntity();(new b.pixi.PixiSprite(c,"crossPromotionImage")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(c,d)).setCoords(new b.Vector2D(0,0.1))});c.UiFactory.createTextButton(0,
0.8489583333333334,"PROMO_PLAY_NOW","textButton",d,null,s(this,this.onContinueButtonClicked),"ui_click_1");c.UiFactory.createPulseButtonQuick(d,0.7,-0.7,"crossPromotionExitButton","crossPromotionExitButton",s(this,this.onCloseButtonClick),null,"ui_click_1")},onCloseButtonClick:function(){this.destroy()},onContinueButtonClicked:function(){q.getWindow().open(b.GameConfig.getProperty("crossPromotionLinkUrl"),"_blank")},__class__:c.CrossPromotionScreen});c.DollScreen=function(){b.GameState.call(this)};
c.DollScreen.__name__=["game","DollScreen"];c.DollScreen.show=function(){var a=new c.DollScreen;b.Root.getInstance().addGameState(a);return a};c.DollScreen.__super__=b.GameState;c.DollScreen.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this);b.Root.getInstance().getLayerByName("ui");var d=this.addEntity();d.setScale(200,1);new b.ui.UiElement(d,a);(new b.pixi.PixiSprite(d,"overlay")).getSprite().anchor=new PIXI.Point(0.5,
0.5);var d=c.UiFactory.createPulseButtonQuick(a,0.01171875,0.11979166666666667,"dollsBackground","dollsBackground",s(this,this.onDollButtonClick),null,"ui_click_1","",!1),e=this.addEntity();(new b.pixi.PixiSprite(e,"dollsImage"+t.string(c.DollScreen.IMAGE_INDEX+1))).getSprite().anchor=new PIXI.Point(0.5,0.5);d.addChild(e);d=this.addEntity();(new b.ui.UiElement(d,a)).setCoords(new b.Vector2D(0,-0.5416666666666666));(new b.pixi.PixiSprite(d,"dollsHeader")).getSprite().anchor=new PIXI.Point(0.5,0.5);
e=this.addEntity();e.setPosition(0,5);new b.pixi.PixiText(e,b.Localizer.getString("DOLL_SCREEN_HEADER"),{font:"34px league_gothic-webfont",fill:"#FFFFFF",align:"center"});d.addChild(e);d=this.addEntity();(new b.ui.UiElement(d,a)).setCoords(new b.Vector2D(0,-0.7395833333333334));(new b.pixi.PixiSprite(d,"dtPopupLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);c.UiFactory.createTextButton(0,0.8489583333333334,"DOLL_SCREEN_CONTINUE_BUTTON","textButton",a,null,s(this,this.onContinueButtonClicked),"ui_click_1");
c.DollScreen.IMAGE_INDEX=(c.DollScreen.IMAGE_INDEX+1)%c.DollScreen.NUM_IMAGES},onContinueButtonClicked:function(){this.destroy()},onDollButtonClick:function(){q.getWindow().open(b.GameConfig.getProperty("dollScreen.url"),"_blank")},__class__:c.DollScreen});c.EntityFactory=function(){};c.EntityFactory.__name__=["game","EntityFactory"];c.EntityFactory.createCamera=function(a,c,e,d){d=d.addEntity();d.setPosition(a,c,e);a=new b.components.Camera(d);new b.components.SlackMovement(d,0.1);a.setZoomScale(1);
a.setOffset(new b.Vector2D(0,-125));new b.components.Tweener(d);return d};c.EntityFactory.createHud=function(a){a=a.addEntity();new c.Hud(a);new b.pixi.PixiContainer(a);return a};c.EntityFactory.createFloatingText=function(a,c,e,d,n,g){null==g&&(g=56);null==n&&(n="#FFFFFF");var h=d.addEntity();h.setPosition(a,c);a=d.addEntity();h.addChild(a);c=new b.pixi.PixiSprite(a,"scoreBg");c.getSprite().anchor=new PIXI.Point(0.5,0.5);var k=d.addEntity();k.setPosition(0,4);a.addChild(k);var m={fill:"#555555"};
m.font=g+"px league_gothic-webfont";(new b.pixi.PixiText(k,e,m,1)).getText().anchor=new PIXI.Point(0.5,0.5);d=d.addEntity();d.setPosition(0,-4);k.addChild(d);k={};k.fill=n;k.font=g+"px league_gothic-webfont";(new b.pixi.PixiText(d,e,k,1)).getText().anchor=new PIXI.Point(0.5,0.5);e=new b.components.Tweener(a);e.addTween(a.getScaleRef(),"x",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0);e.addTween(a.getScaleRef(),"y",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0);e.addTween(c.getSprite(),
"alpha",1,0,0.5,b.components.tween.EasingFunctions.linear,1,function(){h.destroy()});(new b.components.SimpleMovement(a)).setVelocity(0,-50);return h};c.EntityFactory.createFloatingTextRed=function(a,c,e,d,n,g){null==g&&(g=56);null==n&&(n="#FFFFFF");var h=d.addEntity();h.setPosition(a,c);a=d.addEntity();h.addChild(a);c=new b.pixi.PixiSprite(a,"scoreBg");c.getSprite().anchor=new PIXI.Point(0.5,0.5);var k=d.addEntity();k.setPosition(0,4);a.addChild(k);var m={fill:"#550000"};m.font=g+"px league_gothic-webfont";
(new b.pixi.PixiText(k,e,m,1)).getText().anchor=new PIXI.Point(0.5,0.5);d=d.addEntity();d.setPosition(0,-4);k.addChild(d);k={};k.fill=n;k.font=g+"px league_gothic-webfont";(new b.pixi.PixiText(d,e,k,1)).getText().anchor=new PIXI.Point(0.5,0.5);e=new b.components.Tweener(a);e.addTween(a.getScaleRef(),"x",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0);e.addTween(a.getScaleRef(),"y",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0);e.addTween(c.getSprite(),"alpha",1,0,0.5,b.components.tween.EasingFunctions.linear,
1,function(){h.destroy()});(new b.components.SimpleMovement(a)).setVelocity(0,-50);return h};c.EntityFactory.prototype={__class__:c.EntityFactory};c.FadeTransition=function(a,c){b.screenTransition.TransitionScreen.call(this,a,c)};c.FadeTransition.__name__=["game","FadeTransition"];c.FadeTransition.doTransition=function(a,d){var e=new c.FadeTransition(a,d);b.Root.getInstance().addGameState(e)};c.FadeTransition.doMidpointTransition=function(a,d,e){a=new c.FadeTransition(a,d);a.addEventListener("midpoint",
e);b.Root.getInstance().addGameState(a)};c.FadeTransition.__super__=b.screenTransition.TransitionScreen;c.FadeTransition.prototype=r(b.screenTransition.TransitionScreen.prototype,{init:function(){var a=this;b.screenTransition.TransitionScreen.prototype.init.call(this);b.managers.InputManager.getInstance().setInputDisabled(!0);var c=this.addEntity();c.setPosition(512,384);this._pixiSprite=new b.pixi.PixiSprite(c,"whiteBg");this._pixiSprite.getSprite().anchor=new PIXI.Point(0.5,0.5);c.setScale(100,
100);this._tweener=new b.components.Tweener(c);this._tweener.addTween(this._pixiSprite.getSprite(),"alpha",0,1,1,b.components.tween.EasingFunctions.linear,0,function(){a.onTransitionMidpoint()});this._tweener.addTween(this._pixiSprite.getSprite(),"alpha",1,0,1,b.components.tween.EasingFunctions.linear,1.05,function(){a.onTransitionComplete()})},render:function(){b.screenTransition.TransitionScreen.prototype.render.call(this);null!=this._pixiSprite&&this._pixiSprite.bringToFront()},onTransitionMidpoint:function(){b.screenTransition.TransitionScreen.prototype.onTransitionMidpoint.call(this);
b.managers.InputManager.getInstance().setInputDisabled(!1)},__class__:c.FadeTransition});c.FontFamilies=function(){};c.FontFamilies.__name__=["game","FontFamilies"];c.GameColors=function(){};c.GameColors.__name__=["game","GameColors"];c.GameColors.prototype={__class__:c.GameColors};c.GameTracker=function(){this._seenTutorials=[!1,!1,!1,!1];this._selectedMinigameType=c.minigames.MinigameType.CartGame;this._currentLevelNumber=1;b.events.EventDispatcher.call(this);c.GameTracker._instance=this;this._saveData=
new b.SaveData};c.GameTracker.__name__=["game","GameTracker"];c.GameTracker.getInstance=function(){null==c.GameTracker._instance&&(c.GameTracker._instance=new c.GameTracker);return c.GameTracker._instance};c.GameTracker.getScoreSaveKeyForLevel=function(a){return"levelScore"+(null==a?"null":""+a)};c.GameTracker.__super__=b.events.EventDispatcher;c.GameTracker.prototype=r(b.events.EventDispatcher.prototype,{getHasBeatLevel:function(a){return this.getSaveData().getItem("level"+(null==a?"null":""+a),
!1)},setHasBeatLevel:function(a,b){null==b&&(b=!0);this.getSaveData().setItem("level"+(null==a?"null":""+a),b)},getSelectedMinigameType:function(){return this._selectedMinigameType},setSelectedMinigameType:function(a){this._selectedMinigameType=a},getSaveData:function(){return this._saveData},getNumLevels:function(){return t.parseInt(b.GameConfig.getProperty("numLevels"))},getNumLevelsUnlocked:function(){return this.getSaveData().getItem("numLevelsUnlocked",1)},setNumLevelsUnlocked:function(a){this.getSaveData().setItem("numLevelsUnlocked",
Math.min(this.getNumLevels(),Math.max(a,this.getNumLevelsUnlocked())))},setScoreForLevel:function(a,b){a>this.getScoreForLevel(b)&&this.getSaveData().setItem(c.GameTracker.getScoreSaveKeyForLevel(b),a)},getScoreForLevel:function(a){return this.getSaveData().getItem(c.GameTracker.getScoreSaveKeyForLevel(a),0)},setScoreForCurrentLevel:function(a){this.setScoreForLevel(a,this._currentLevelNumber)},setCurrentLevelNumber:function(a){this._currentLevelNumber=a},getCurrentLevelNumber:function(){return this._currentLevelNumber},
getCurrentLevelTrackerName:function(){switch(this.getCurrentLevelNumber()){case 2:return"Wispy Forest: Find the Pair";case 3:return"Sweetville: Candy Creations";case 4:return"Sparkle Mountain: Spot the Difference";default:return"Rainbow Cove: Roller Coaster"}},getHasBeatenGame:function(){return this.getSaveData().getItem("hasBeatenGame",!1)},setHasBeatenGame:function(a){this.getSaveData().setItem("hasBeatenGame",a)},getHasStartedGame:function(){return this.getSaveData().getItem("hasStartedGame",!1)},
setHasStartedGame:function(a){this.getSaveData().setItem("hasStartedGame",a)},getCartGameWins:function(){return this.getSaveData().getItem("cartGameWins",0)},setCartGameWins:function(a){this.getSaveData().setItem("cartGameWins",a)},incrementCartGameWins:function(a){this.setCartGameWins(this.getCartGameWins()+a)},getCartGameGoal:function(){var a=t.parseFloat(b.GameConfig.getProperty("cartGame.defaultGoal")),c=t.parseFloat(b.GameConfig.getProperty("cartGame.goalIncrement"));return a+c*this.getCartGameWins()},
getHasSeenTutorial:function(){return this._seenTutorials[this._currentLevelNumber-1]},setHasSeenTutorial:function(a){this._seenTutorials[this._currentLevelNumber-1]=a},__class__:c.GameTracker});c.HelpState=function(a){this._currentPage=0;b.GameState.call(this);this._parentState=a};c.HelpState.__name__=["game","HelpState"];c.HelpState.__super__=b.GameState;c.HelpState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this),
d=b.Root.getInstance().getLayerByName("ui"),e=this.addEntity();(new b.pixi.PixiSprite(e,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(e,a)).setScale(200,1);var f=this.addEntity();new b.pixi.PixiContainer(f);var n=this.addEntity();n.setPosition(-46.5,-8.5);(new b.pixi.PixiSprite(n,"popupBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);f.addChild(n);new b.ui.UiElement(f,a);a=c.UiFactory.createPulseButtonQuick(a,0.74,0.64,"closeButton","closeButton",s(this,this.onClose),
d,"ui_click_1");switch(c.GameTracker.getInstance().getSelectedMinigameType()[1]){case 0:e=this.addEntity();e.setPosition(0,35);(new b.pixi.PixiSprite(e,b.Root.isMobile()?"cartGameHelpMobile":"cartGameHelp")).getSprite().anchor=new PIXI.Point(0.5,0.5);f.addChild(e);break;case 1:e=this.addEntity();e.setPosition(0,33);(new b.pixi.PixiSprite(e,"memoryGameHelp1")).getSprite().anchor=new PIXI.Point(0.5,0.5);f.addChild(e);break;case 2:e.destroy();f.destroy();a.destroy();f=new c.minigames.MinigameTutorialState;
b.Root.getInstance().addGameState(f);e=f.addEntity();a=c.UiFactory.createFullscreenUiPanel(f);new b.ui.UiElement(e,a);new c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial(e,"tutorialBg");f.addEventListener("destroy",s(this,this.onClose));break;case 3:e.destroy(),f.destroy(),a.destroy(),f=new c.minigames.MinigameTutorialState,b.Root.getInstance().addGameState(f),e=f.addEntity(),a=c.UiFactory.createFullscreenUiPanel(f),new b.ui.UiElement(e,a),new c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial(e,
"tutorialBg"),f.addEventListener("destroy",s(this,this.onClose))}},onClose:function(){var a=new c.PauseMenuState(this._parentState);b.Root.getInstance().addGameState(a);b.Root.getInstance().removeGameState(this)},__class__:c.HelpState});c.Hud=function(a){this._inputEnabled=!0;b.Component.call(this,a);c.Hud._instance=this};c.Hud.__name__=["game","Hud"];c.Hud.getInstance=function(){return c.Hud._instance};c.Hud.__super__=b.Component;c.Hud.prototype=r(b.Component.prototype,{getInputEnabled:function(){return this._inputEnabled},
setInputEnabled:function(a){this._inputEnabled=a},getPauseButton:function(){return this._pauseButton},getSoundButton:function(){return this._soundButton},init:function(){b.Component.prototype.init.call(this);this.construct()},construct:function(){var a=c.UiFactory.createFullscreenUiPanel(this.getGameState()),d=b.Root.getInstance().getLayerByName("ui");this._pauseButton=c.UiFactory.createPulseButtonQuick(a,0.9,-0.84,"pauseButton","pauseButton",s(this,this.onPauseClick),d,"ui_click_1","",!1);this._soundButton=
c.UiFactory.createPulseButtonQuick(a,0.75,-0.84,"soundButton","soundButton",s(this,this.onToggleSound),d,"ui_click_1","",!1);d=this.getGameState().addEntity();(new b.ui.UiElement(d,a)).setCoords(new b.Vector2D(0,-0.8));this.updateSoundIcons()},onPauseClick:function(){this._inputEnabled&&this._entity.dispatchEvent(new c.HudEvent(c.HudEvent.SHOW_MENU))},onToggleSound:function(){this._inputEnabled&&(b.audio.SoundManager.setMusicMuted(!b.audio.SoundManager.getMusicMuted()),b.audio.SoundManager.setSoundMuted(!b.audio.SoundManager.getSoundMuted()),
this.updateSoundIcons())},updateSoundIcons:function(){var a=this._soundButton.getComponent(b.components.buttons.ButtonMouseOverImage);a.setDefaultImage(b.audio.SoundManager.getMusicMuted()?"soundOffButton":"soundButton");a.setMouseOverImage(b.audio.SoundManager.getMusicMuted()?"soundOffButton":"soundButton")},updateLevelTime:function(a){this._timeTextField.setText(b.utilities.StringTools2.convertFloatToTime(a))},destroy:function(){b.Component.prototype.destroy.call(this);this._pauseButton.destroy();
this._soundButton.destroy();c.Hud._instance==this&&(c.Hud._instance=null)},__class__:c.Hud});c.HudEvent=function(a){b.events.Event.call(this,a)};c.HudEvent.__name__=["game","HudEvent"];c.HudEvent.__super__=b.events.Event;c.HudEvent.prototype=r(b.events.Event.prototype,{__class__:c.HudEvent});c.LevelCompleteState=function(a){this._numStars=1;this._loadingScreen=null;this._results=a;b.GameState.call(this)};c.LevelCompleteState.__name__=["game","LevelCompleteState"];c.LevelCompleteState.__super__=b.GameState;
c.LevelCompleteState.prototype=r(b.GameState.prototype,{init:function(){var a=this;b.GameState.prototype.init.call(this);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);b.Layers.getUi();var d=this.addEntity();(new b.ui.UiElement(d,this._uiPanel)).setScale(200,1);(new b.pixi.PixiSprite(d,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._root=this.addEntity();new b.ui.UiElement(this._root,this._uiPanel);new b.pixi.PixiContainer(this._root);d=this.addEntity();d.setPosition(-46.5,-8.5);
(new b.pixi.PixiSprite(d,"popupBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._root.addChild(d);d=this.addEntity();d.setPosition(11.5,53);(new b.pixi.PixiSprite(d,"scoreStarBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._root.addChild(d);for(var d=new b.components.DeferredActionComponent(this.addEntity()),e=0,f=this._numStars;e<f;){var n=e++,g=this.addEntity(),h=new b.pixi.PixiSprite(g,"scoreStar"+(0==n%2?"Small":"Large"));h.getSprite().anchor=new PIXI.Point(0.5,0.5);g.setPosition(c.LevelCompleteState.STAR_POSITIONS[n].x,
c.LevelCompleteState.STAR_POSITIONS[n].y);this._root.addChild(g);h.getSprite().alpha=0;var k=new b.components.Tweener(g);k.addTween(g.getScaleRef(),"x",3,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0.25*n);k.addTween(g.getScaleRef(),"y",3,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0.25*n);k.addTween(g.getRotationRef(),"z",-35,0,0.35,b.components.tween.EasingFunctions.easeOutQuad,0.25*n);k.addTween(h.getSprite(),"alpha",0,1,0.15,b.components.tween.EasingFunctions.linear,0.25*n);
d.addDeferredAction(0.25*n,function(){b.audio.SoundManager.playSoundByName("ui_gem_bells_2")})}d=c.UiFactory.createPulseButtonQuickAbsolute(this,0.5,273.5,"playButton","playButton",s(this,this.onLevelCompleteNextClicked),null,"ui_click_1");this._root.addChild(d);d=!1;e="1"==b.GameConfig.getProperty("crossPromotionActive");f="1"==b.GameConfig.getProperty("crossPromotionAlwaysShowFirst");e&&(f&&c.LevelCompleteState._firstCrossPromo?d=!0:c.LevelCompleteState._numLevelCompletesUntilShowCrossPromo--,0>
c.LevelCompleteState._numLevelCompletesUntilShowCrossPromo&&(d=!0,c.LevelCompleteState._numLevelCompletesUntilShowCrossPromo=t["int"](b.GameConfig.getProperty("crossPromotionLevelCompletesPerDisplay"))),d&&(d=c.CrossPromotionScreen.show(),this.pause(),d.addEventListener("destroy",function(){a.resume()})),c.LevelCompleteState._firstCrossPromo=!1);b.audio.SoundManager.playSoundByName("level_win_1");c.GameTracker.getInstance().setNumLevelsUnlocked(c.GameTracker.getInstance().getCurrentLevelNumber()+
1);y.utag.UtagManager.getInstance().link("LevelComplete: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),"games")},onUnicornButtonClicked:function(){var a=this,d=new c.PrintablePuzzleState;b.Root.getInstance().addGameState(d);this.pause();d.addEventListener("destroy",function(){a.resume()})},onLevelCompleteNextClicked:function(){b.audio.SoundManager.playSoundByName("ui_select_1");var a="1"==b.GameConfig.getProperty("dollAdScreen.active"),d="1"==
b.GameConfig.getProperty("appAdScreen.active");a?d||(c.LevelCompleteState._showPromo=!1):c.LevelCompleteState._showPromo=!0;if(c.LevelCompleteState._showPromo)if(d)c.PromoScreen.show(s(this,this.onDollsScreenDestroyed)),this.pause();else this.onDollsScreenDestroyed(null);else if(a)a=new c.DollScreen,a.addEventListener("destroy",s(this,this.onDollsScreenDestroyed)),b.Root.getInstance().addGameState(a),this.pause();else this.onDollsScreenDestroyed(null);c.LevelCompleteState._showPromo=!c.LevelCompleteState._showPromo},
onDollsScreenDestroyed:function(a){this.resume();a=new c.MenusState;c.FadeTransition.doTransition(this,a);c.MenusState.getInstance().moveCameraInstant(0,0);c.MenusState.getInstance().moveCameraBy(0,0);this.startLoadingMinigame();b.audio.SoundManager.playMusicByName("music_whats_gonna_happen")},startLoadingMinigame:function(){var a=new b.LoadBatch;a.concatLoadBatch(b.managers.AssetManager.getAsset("gameplayLoad"));this._loadingScreen=c.menuScreens.LoadingScreen.create(c.MenusState.getInstance());c.MenusState.getInstance().addMenu(this._loadingScreen);
this._loadingScreen.getUiPanel().getEntity().translate(0,0);switch(c.GameTracker.getInstance().getSelectedMinigameType()[1]){case 0:c.menuScreens.LoadingScreen.getInstance().setRange(0,0.5);break;default:c.menuScreens.LoadingScreen.getInstance().setRange(0,1)}var d="level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"Load";a.concatLoadBatch(b.managers.AssetManager.getAsset(d));a.load(s(this,this.onLevelLoadComplete))},onLevelLoadComplete:function(){y.utag.UtagManager.getInstance().link("LevelStart: Dreamtopia - [Game Title] - Level "+
t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),"games");this._minigameState=new c.minigames.MinigameState;this._minigameState.addEventListener("ready",s(this,this.onMinigameReady));b.Root.getInstance().addGameState(this._minigameState)},onMinigameReady:function(a){c.FadeTransition.doMidpointTransition(c.MenusState.getInstance(),this._minigameState,s(this,this.onMidpoint))},onMidpoint:function(){this._minigameState.onTransitionToMinigame()},__class__:c.LevelCompleteState});c.LevelCompleteCartGameState=
function(a){c.LevelCompleteState.call(this,a)};c.LevelCompleteCartGameState.__name__=["game","LevelCompleteCartGameState"];c.LevelCompleteCartGameState.__super__=c.LevelCompleteState;c.LevelCompleteCartGameState.prototype=r(c.LevelCompleteState.prototype,{init:function(){this._numStars=this._results.lives;c.LevelCompleteState.prototype.init.call(this);var a=this._results;a.won&&c.GameTracker.getInstance().incrementCartGameWins(1);var d=new b.pixi.PixiText(this.addEntity(),a.won?b.Localizer.getString("LEVEL_COMPLETE_GOAL_LABEL"):
b.Localizer.getString("LEVEL_COMPLETE_DISTANCE_LABEL"),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"center"});d.getEntity().setPosition(-159.5,-89);this._root.addChild(d.getEntity());var d={fill:"#FFFFFF",align:"center"},e;a.won?(d.font="72px league_gothic-webfont",e=C.replace(b.Localizer.getString("LEVEL_COMPLETE_DISTANCE"),"%N",null==a.distance?"null":""+a.distance)):(d.font="62px league_gothic-webfont",e=C.replace(b.Localizer.getString("LEVEL_COMPLETE_DISTANCE_GOAL"),"%N",null==a.distance?
"null":""+a.distance),e=C.replace(e,"%M",t.string(Math.floor(c.GameTracker.getInstance().getCartGameGoal()))));d=new b.pixi.PixiText(this.addEntity(),e,d);d.getEntity().setPosition(-155,-39);this._root.addChild(d.getEntity());d=new b.pixi.PixiText(this.addEntity(),b.Localizer.getString("LEVEL_COMPLETE_GEMS_LABEL"),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"center"});d.getEntity().setPosition(146.5,-89);this._root.addChild(d.getEntity());a=new b.pixi.PixiText(this.addEntity(),null==a.gems?
"null":""+a.gems,{font:"72px league_gothic-webfont",fill:"#FFFFFF",align:"left"});a.getEntity().setPosition(132+a.getText().width/2,-39);this._root.addChild(a.getEntity());a=new b.pixi.PixiSprite(this.addEntity(),"coin");a.getSprite().anchor=new PIXI.Point(0.5,0.5);a.getEntity().setPosition(95,-45);this._root.addChild(a.getEntity())},__class__:c.LevelCompleteCartGameState});c.LevelCompleteMemoryGameState=function(a){c.LevelCompleteState.call(this,a)};c.LevelCompleteMemoryGameState.__name__=["game",
"LevelCompleteMemoryGameState"];c.LevelCompleteMemoryGameState.__super__=c.LevelCompleteState;c.LevelCompleteMemoryGameState.prototype=r(c.LevelCompleteState.prototype,{init:function(){var a=this._results;this._numStars=this._results.getStars();c.LevelCompleteState.prototype.init.call(this);var d=new b.pixi.PixiText(this.addEntity(),b.Localizer.getString("LEVEL_COMPLETE_SCORE_LABEL"),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"center"});d.getEntity().setPosition(-109.5,-89);this._root.addChild(d.getEntity());
d=new b.pixi.PixiText(this.addEntity(),null==a.score?"null":""+a.score,{font:"72px league_gothic-webfont",fill:"#FFFFFF",align:"center"});d.getEntity().setPosition(-105,-39);this._root.addChild(d.getEntity());d=new b.pixi.PixiText(this.addEntity(),b.Localizer.getString("LEVEL_COMPLETE_TIME_LABEL"),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"center"});d.getEntity().setPosition(106.5,-89);this._root.addChild(d.getEntity());a=new b.pixi.PixiText(this.addEntity(),b.utilities.StringTools2.convertFloatToTime(a.time),
{font:"72px league_gothic-webfont",fill:"#FFFFFF",align:"center"});a.getEntity().setPosition(100,-39);this._root.addChild(a.getEntity())},__class__:c.LevelCompleteMemoryGameState});c.LevelCompletePuzzleBuilderGameState=function(a){c.LevelCompleteState.call(this,a)};c.LevelCompletePuzzleBuilderGameState.__name__=["game","LevelCompletePuzzleBuilderGameState"];c.LevelCompletePuzzleBuilderGameState.__super__=c.LevelCompleteState;c.LevelCompletePuzzleBuilderGameState.prototype=r(c.LevelCompleteState.prototype,
{init:function(){var a=this._results;this._numStars=this._results.getStars();c.LevelCompleteState.prototype.init.call(this);var d=new b.pixi.PixiText(this.addEntity(),b.Localizer.getString("LEVEL_COMPLETE_SCORE_LABEL"),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"right"});d.getEntity().setPosition(-3,-54);d.getText().anchor=new PIXI.Point(1,1);this._root.addChild(d.getEntity());d=new b.pixi.PixiText(this.addEntity(),null==a.score?"null":""+a.score,{font:"72px league_gothic-webfont",fill:"#FFFFFF",
align:"left"});d.getEntity().setPosition(3,-44);d.getText().anchor=new PIXI.Point(0,1);this._root.addChild(d.getEntity());d=this.addEntity();d.setPosition(-476,-67);new b.pixi.PixiSprite(d,"scoreCollectedBg");this._root.addChild(d);for(var e=Math.min(a.collectedPuzzles.length,6),f=0,n=0,g=0;g<e;){var h=g++,k=this.addEntity();k.setPosition(63+108*f,54+100*n);(new b.pixi.PixiSprite(k,"puzzleCollected"+a.collectedPuzzles[h])).getSprite().anchor=new PIXI.Point(0.5,0.5);d.addChild(k);f++;1<=f&&(f=0,n++)}},
__class__:c.LevelCompletePuzzleBuilderGameState});c.LevelCompleteSpotTheDifferenceGameState=function(a){c.LevelCompleteState.call(this,a)};c.LevelCompleteSpotTheDifferenceGameState.__name__=["game","LevelCompleteSpotTheDifferenceGameState"];c.LevelCompleteSpotTheDifferenceGameState.__super__=c.LevelCompleteState;c.LevelCompleteSpotTheDifferenceGameState.prototype=r(c.LevelCompleteState.prototype,{init:function(){var a=this._results;this._numStars=this._results.getStars();c.LevelCompleteState.prototype.init.call(this);
var d=new b.pixi.PixiText(this.addEntity(),b.Localizer.getString("LEVEL_COMPLETE_SCORE_LABEL"),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"right"});d.getEntity().setPosition(-3,-54);d.getText().anchor=new PIXI.Point(1,1);this._root.addChild(d.getEntity());a=new b.pixi.PixiText(this.addEntity(),null==a.score?"null":""+a.score,{font:"72px league_gothic-webfont",fill:"#FFFFFF",align:"left"});a.getEntity().setPosition(3,-44);a.getText().anchor=new PIXI.Point(0,1);this._root.addChild(a.getEntity())},
__class__:c.LevelCompleteSpotTheDifferenceGameState});c.MenusState=function(){this._isCameraTransitioning=!1;this._menuScreens=[];b.GameState.call(this);c.MenusState._instance=this;this._background=this.addEntity();new b.pixi.PixiContainer(this._background);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);new b.ui.UiPanelSizeToWindow(this._uiPanel.getEntity(),this._uiPanel,!0);var a=this.addEntity(),d=this.addEntity();d.setPosition(1024,0);var e=this.addEntity();e.setPosition(1024,768);(new b.pixi.PixiSprite(a,
"cloudsBg1")).getSprite().anchor=new PIXI.Point(0.5,0.5);var f=new b.pixi.PixiSprite(d,"cloudsBg2");f.getSprite().anchor=new PIXI.Point(0.5,0.5);this._worldTitleSpriteBg=new b.pixi.PixiSprite(e,"cloudsBg2");f.getSprite().anchor=new PIXI.Point(0.5,0.5);this._background.addChild(a);this._background.addChild(d);this._background.addChild(e);new b.ui.UiElement(this._background,this._uiPanel);a=this.addEntity();this._camera=new b.pixi.PixiCamera(a);new b.components.Tweener(a);this._cameraTweener=new b.components.Tweener(a)};
c.MenusState.__name__=["game","MenusState"];c.MenusState.getInstance=function(){null==c.MenusState._instance&&(c.MenusState._instance=new c.MenusState,b.Root.getInstance().addGameState(c.MenusState._instance));return c.MenusState._instance};c.MenusState.__super__=b.GameState;c.MenusState.prototype=r(b.GameState.prototype,{getCameraTransitioning:function(){return this._isCameraTransitioning},getCamera:function(){return this._camera},init:function(){b.GameState.prototype.init.call(this)},addMenu:function(a){var b=
this;this._menuScreens.push(a);a.getEntity().addEventListener("destroy",function(){v.remove(b._menuScreens,a)});a.addEventListener("dismiss",s(this,this.onMenuScreenDismiss))},removeMenu:function(a){a.dismiss()},moveCameraBy:function(a,c,e,d){null==e&&(e=2.5);for(var n=this,g=this._menuScreens.length,h=0;h<g;){var k=h++,k=this._menuScreens[k].getUiPanel();this._cameraTweener.addTween(k.getEntity().getPositionRef(),"x",k.getEntity().getPositionRef().x,k.getEntity().getPositionRef().x+a,e,b.components.tween.EasingFunctions.easeInOutQuint,
0);this._cameraTweener.addTween(k.getEntity().getPositionRef(),"y",k.getEntity().getPositionRef().y,k.getEntity().getPositionRef().y+c,e,b.components.tween.EasingFunctions.easeInOutQuint,0)}g=this._background.getComponent(b.ui.UiElement);this._cameraTweener.addTween(g.getCoordsRef(),"x",g.getCoordsRef().x,g.getCoordsRef().x+2*(a/1024),e,b.components.tween.EasingFunctions.easeInOutQuint,0,d);this._cameraTweener.addTween(g.getCoordsRef(),"y",g.getCoordsRef().y,g.getCoordsRef().y+2*(c/768),e,b.components.tween.EasingFunctions.easeInOutQuint,
0,function(){n._isCameraTransitioning=!1});this._isCameraTransitioning=!0},moveCameraInstant:function(a,c){for(var e=this._menuScreens.length,d=0;d<e;){var n=d++;this._menuScreens[n].getUiPanel().getEntity().translate(a,c)}e=this._background.getComponent(b.ui.UiElement);e.getCoordsRef().x+=2*(a/1024);e.getCoordsRef().y+=2*(c/768);this._isCameraTransitioning=!1},skipCameraTween:function(){this._cameraTweener.skipAll();this._isCameraTransitioning=!1},onMenuScreenDismiss:function(a){a=a.target;v.remove(this._menuScreens,
a);a.getEntity().destroy()},setWorldTitleSpriteBackground:function(a){this._worldTitleSpriteBg.setTextureFromImageId(a);this._worldTitleSpriteBg.getSprite().anchor=new PIXI.Point(0.5,0.5)},setWorldTitleSpritePosition:function(a,b){this._worldTitleSpriteBg.getEntity().setPosition(a,b)},destroy:function(){b.GameState.prototype.destroy.call(this);c.MenusState._instance==this&&(c.MenusState._instance=null)},__class__:c.MenusState});c.PauseMenuState=function(a){b.GameState.call(this);this._parentState=
a};c.PauseMenuState.__name__=["game","PauseMenuState"];c.PauseMenuState.__super__=b.GameState;c.PauseMenuState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);var a=c.UiFactory.createFullscreenUiPanel(this),d=b.Root.getInstance().getLayerByName("ui"),e=this.addEntity();(new b.pixi.PixiSprite(e,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(e,a)).setScale(200,1);e=this.addEntity();new b.pixi.PixiContainer(e);new b.ui.UiElement(e,
a);a=this.addEntity();a.setPosition(-46.5,-8.5);e.addChild(a);(new b.pixi.PixiSprite(a,"popupBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=c.UiFactory.createPulseButtonQuickAbsolute(this,225,24,"helpButton","helpButton",s(this,this.onHelpClicked),d,"ui_click_1");e.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this,75,24,"resumeButton","resumeButton",s(this,this.onResumeClicked),d,"ui_click_1");e.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this,-75,24,"restartButton","restartButton",
s(this,this.onRestartClick),d,"ui_click_1");e.addChild(a);d=c.UiFactory.createPulseButtonQuickAbsolute(this,-225,24,"homeButton","homeButton",s(this,this.onQuitClicked),d,"ui_click_1");e.addChild(d)},onResumeClicked:function(){this._parentState.resume();this.destroy()},onHelpClicked:function(){this.destroy();b.Root.getInstance().addGameState(new c.HelpState(this._parentState))},onQuitClicked:function(){this.destroy();b.Root.getInstance().addGameState(new c.ConfirmQuitState(this._parentState))},onRestartClick:function(){this.destroy();
var a=new c.minigames.MinigameState;b.Root.getInstance().addGameState(a);c.FadeTransition.doMidpointTransition(this._parentState,a,function(){a.onTransitionToMinigame()})},__class__:c.PauseMenuState});c.PlayerData=function(){this._score=this._levelTime=0};c.PlayerData.__name__=["game","PlayerData"];c.PlayerData.prototype={getScore:function(){return this._score},setScore:function(a){this._score=a},setLevelTime:function(a){this._levelTime=a},getLevelTime:function(){return this._levelTime},__class__:c.PlayerData};
c.PrintablePuzzleState=function(){b.GameState.call(this)};c.PrintablePuzzleState.__name__=["game","PrintablePuzzleState"];c.PrintablePuzzleState.show=function(){var a=new c.PrintablePuzzleState;b.Root.getInstance().addGameState(a);return a};c.PrintablePuzzleState.__super__=b.GameState;c.PrintablePuzzleState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);this._tweener=new b.components.Tweener(this._uiPanel.getEntity());
this._overlay=this.addEntity();(new b.ui.UiElement(this._overlay,this._uiPanel)).setScale(200,1);(new b.pixi.PixiSprite(this._overlay,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._root=this.addEntity();(new b.ui.UiElement(this._root,this._uiPanel)).setCoords(new b.Vector2D(0,0.1));(new b.pixi.PixiSprite(this._root,"unicornPopup")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._backButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.87,-0.83,"backButton","backButton",s(this,
this.onBackButtonClicked),null,"ui_click_1","");for(var a=!0,d=c.PrintablePuzzleState._piecePositions.length,e=0;e<d;){var f=e++;if(c.GameTracker.getInstance().getHasBeatLevel(f+1)){var n=this.addEntity();n.setPosition(c.PrintablePuzzleState._piecePositions[f].x,c.PrintablePuzzleState._piecePositions[f].y);(new b.pixi.PixiSprite(n,"unicornImage"+(f+1))).getSprite().anchor=new PIXI.Point(0.5,0.5);this._root.addChild(n)}else a=!1}a?(this._printButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,
0.87,0.83,"printButton","printButton",null,null,"ui_click_1","",null,null,s(this,this.onPrintButtonClick)),b.Root.isIOS()&&(a=this._printButton.getComponent(b.components.Button),a.setOnMouseUp(s(this,this.onPrintButtonClick)),a.setOnMouseDown(null))):(a=this.addEntity(),a.setPosition(0,-9),(new b.pixi.PixiSprite(a,"unicornDivider")).getSprite().anchor=new PIXI.Point(0.5,0.5),this._root.addChild(a));a=this.addEntity();a.setPosition(1,-282.5);a.setScale(0.62,0.62);(new b.pixi.PixiSprite(a,"dtLogo")).getSprite().anchor=
new PIXI.Point(0.5,0.5);this._root.addChild(a);this.bringIn()},bringIn:function(){var a=this._overlay.getComponent(b.pixi.PixiSprite);a.getContainer().alpha=0;this._tweener.addTween(a.getContainer(),"alpha",0,1,0.35,b.components.tween.EasingFunctions.easeOutQuad);a=this._root.getComponent(b.ui.UiElement);this._tweener.addTween(a.getCoordsRef(),"y",-1.5,0.1,0.65,b.components.tween.EasingFunctions.easeOutQuad);this._tweener.addTween(this._root.getRotationRef(),"z",-45,0,0.65,b.components.tween.EasingFunctions.easeOutQuad)},
dismiss:function(){var a=this,c=this._overlay.getComponent(b.pixi.PixiSprite);this._tweener.addTween(c.getContainer(),"alpha",1,0,0.35,b.components.tween.EasingFunctions.easeOutQuad);c=this._root.getComponent(b.ui.UiElement);this._tweener.addTween(c.getCoordsRef(),"y",0.1,2.25,0.65,b.components.tween.EasingFunctions.easeOutQuad);this._tweener.addTween(this._root.getRotationRef(),"z",0,30,0.65,b.components.tween.EasingFunctions.easeOutQuad,null,function(){a.destroy()});c=this._backButton.getComponent(b.ui.UiElement);
this._tweener.addTween(c.getCoordsRef(),"y",-0.83,-1.5,0.35,b.components.tween.EasingFunctions.easeOutQuad);null!=this._printButton&&(c=this._backButton.getComponent(b.ui.UiElement),this._tweener.addTween(c.getCoordsRef(),"y",0.83,1.5,0.35,b.components.tween.EasingFunctions.easeOutQuad))},onBackButtonClicked:function(){this.dismiss()},onPrintButtonClick:function(){this.downloadImage()},downloadImage:function(){var a;a=C.replace("./images/localized/${locale}/barbie-dt-printable.pdf","${locale}",q.dataLocale);
window.open(a,"_blank")},__class__:c.PrintablePuzzleState});c.PromoScreen=function(){b.GameState.call(this)};c.PromoScreen.__name__=["game","PromoScreen"];c.PromoScreen.show=function(a){var d=new c.PromoScreen;d.setOnClose(a);b.Root.getInstance().addGameState(d);return d};c.PromoScreen.__super__=b.GameState;c.PromoScreen.prototype=r(b.GameState.prototype,{getOnClose:function(){return this._onClose},setOnClose:function(a){this._onClose=a},init:function(){b.GameState.prototype.init.call(this);this._uiPanel=
c.UiFactory.createFullscreenUiPanel(this);var a=this.addEntity();(new b.pixi.PixiSprite(a,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(a,this._uiPanel)).setScale(200,1);var d=this.addEntity();(new b.pixi.PixiSprite(d,"dtPopupLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(0,-275);a.addChild(d);d=this.addEntity();(new b.pixi.PixiSprite(d,"promoBanner")).getSprite().anchor=new PIXI.Point(0.5,0.5);var e=new b.ui.UiElement(d,this._uiPanel);e.setCoords(new b.Vector2D(-1,
1));e.setAlignment(b.ui.UiElementHorizontalAlignment.Left,b.ui.UiElementVerticalAlignment.Bottom);e=this.addEntity();e.setRotation2d(30);e.setPosition(-40,22);new b.pixi.PixiText(e,b.Localizer.getString("PROMO_CORNER_LABEL"),{font:"36px league_gothic-webfont",fill:"#FFFFFF",align:"center"},1);d.addChild(e);d=this.addEntity();(new b.pixi.PixiSprite(d,"dollsHeader")).getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(0,-200);a.addChild(d);e=this.addEntity();e.setPosition(0,5);new b.pixi.PixiText(e,
b.Localizer.getString("PROMO_HEADING"),{font:"36px league_gothic-webfont",fill:"#FFFFFF",align:"center"},1);d.addChild(e);d=this.addEntity();(new b.pixi.PixiSprite(d,"promoIconLife")).getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(-200,-70);a.addChild(d);d=this.addEntity();e=new b.pixi.PixiSprite(d,"promoBlue");e.getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(-200,75);a.addChild(d);var f=this.addEntity();new b.pixi.PixiText(f,b.Localizer.getString("PROMO_BARBIE_LIFE"),{font:"32px league_gothic-webfont",
fill:"#FFFFFF",align:"center"},1);f.setPosition(0,5);e.getSprite().anchor=new PIXI.Point(0.5,0.5);d.addChild(f);d=this.addEntity();(new b.pixi.PixiSprite(d,"promoIconDream")).getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(200,-70);a.addChild(d);d=this.addEntity();e=new b.pixi.PixiSprite(d,"promoPink");e.getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(200,75);a.addChild(d);f=this.addEntity();new b.pixi.PixiText(f,b.Localizer.getString("PROMO_BARBIE_DREAM"),{font:"32px league_gothic-webfont",
fill:"#FFFFFF",align:"center",wordWrap:!0,wordWrapWidth:250},1);f.setPosition(0,5);e.getSprite().anchor=new PIXI.Point(0.5,0.5);d.addChild(f);d=c.UiFactory.createPulseButtonQuickAbsolute(this,-200,145,"promoApple","promoApple",null,null,"ui_gem_bells_1","",!1,0.35,s(this,this.onBarbieLifeAppleButtonClick));a.addChild(d);d=c.UiFactory.createPulseButtonQuickAbsolute(this,-200,195,"promoGoogle","promoGoogle",null,null,"ui_gem_bells_1","",!1,0.35,s(this,this.onBarbieLifeGooglePlayButtonClick));a.addChild(d);
d=c.UiFactory.createPulseButtonQuickAbsolute(this,-200,245,"promoAmazon","promoAmazon",null,null,"ui_gem_bells_1","",!1,0.35,s(this,this.onBarbieLifeAmazonButtonClick));a.addChild(d);d=c.UiFactory.createPulseButtonQuickAbsolute(this,200,145,"promoApple","promoApple",null,null,"ui_gem_bells_1","",!1,0.35,s(this,this.onBarbieDreamAppleButtonClick));a.addChild(d);c.UiFactory.createTextButton(0,0.85,"DOLL_SCREEN_CONTINUE_BUTTON","textButton",this._uiPanel,null,s(this,this.onContinueButtonClick),"ui_click_1")},
onBarbieLifeAppleButtonClick:function(){q.getWindow().open(b.GameConfig.getProperty("appUrls.barbieLifeApple"),"_blank")},onBarbieLifeGooglePlayButtonClick:function(){q.getWindow().open(b.GameConfig.getProperty("appUrls.barbieLifeGooglePlay"),"_blank")},onBarbieLifeAmazonButtonClick:function(){q.getWindow().open(b.GameConfig.getProperty("appUrls.barbieLifeAmazon"),"_blank")},onBarbieDreamAppleButtonClick:function(){q.getWindow().open(b.GameConfig.getProperty("appUrls.barbieDreamApple"),"_blank")},
onContinueButtonClick:function(){this.destroy();null!=this._onClose&&this._onClose()},__class__:c.PromoScreen});c.SoundButton=function(a,c,e){b.Component.call(this,a);this._soundOnImage=c;this._soundOffImage=e};c.SoundButton.__name__=["game","SoundButton"];c.SoundButton.__super__=b.Component;c.SoundButton.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._button=this.getEntity().getComponent(b.components.Button);this._buttonActionDelay=this.getEntity().getComponent(b.components.buttons.ButtonActionDelay);
this._buttonMouseOverImage=this.getEntity().getComponent(b.components.buttons.ButtonMouseOverImage);this._buttonActionDelay.setOnAction(s(this,this.onClick))},update:function(){b.Component.prototype.update.call(this);this._buttonMouseOverImage.setDefaultImage(b.audio.SoundManager.getMusicMuted()?this._soundOffImage:this._soundOnImage);this._buttonMouseOverImage.setMouseOverImage(b.audio.SoundManager.getMusicMuted()?this._soundOffImage:this._soundOnImage)},onClick:function(){b.audio.SoundManager.setMusicMuted(!b.audio.SoundManager.getMusicMuted());
b.audio.SoundManager.setSoundMuted(b.audio.SoundManager.getMusicMuted())},__class__:c.SoundButton});c.StoryDialog=function(a){this._inputEnabled=!0;b.GameState.call(this);this._onClose=a;this._uiPanel=c.UiFactory.createFullscreenUiPanel(this)};c.StoryDialog.__name__=["game","StoryDialog"];c.StoryDialog.show=function(a){a=new c.StoryDialog(a);b.Root.getInstance().addGameState(a);return a};c.StoryDialog.__super__=b.GameState;c.StoryDialog.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);
this._overlay=this.addEntity();this._tweener=new b.components.Tweener(this._overlay);(new b.pixi.PixiSprite(this._overlay,"storyPopupBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._overlayUi=new b.ui.UiElement(this._overlay,this._uiPanel);var a=this.addEntity();a.setPosition(0,-90);var d={font:"22px Arial"};d.fill=c.GameColors.WHITE;d.wordWrapWidth=500;d.wordWrap=!0;d.align="center";this._charactersTransform=this.addEntity();new b.ui.UiElement(this._charactersTransform,this._uiPanel);var e=
new b.pixi.PixiSprite(this._charactersTransform,"level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashCharacters");2==c.GameTracker.getInstance().getCurrentLevelNumber()?e.getSprite().anchor=new PIXI.Point(0.5,0.825):e.getSprite().anchor=new PIXI.Point(0.5,1);e=this._charactersTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));this._tweener.addTween(e.getCoordsRef(),"y",2.5,1,1.5,b.components.tween.EasingFunctions.easeOutCubic,1);e=this.addEntity();
e.setPosition(0,100);var f=new b.pixi.PixiSprite(e,"storyCard");f.getSprite().anchor=new PIXI.Point(0.5,0.5);c.GameTracker.getInstance().getSelectedMinigameType()==c.minigames.MinigameType.MemoryGame&&(f.getSprite().alpha=0);this._overlay.addChild(e);var n;switch(c.GameTracker.getInstance().getSelectedMinigameType()[1]){case 0:n="STORY_CART";break;case 1:n="STORY_MEMORY";this._overCard=this.addEntity();this._overCard.setPosition(0,5E3);e=this.addEntity();this._overCard.addChild(e);e.setPosition(0,
100);e=new b.pixi.PixiSprite(e,"storyCard");e.getSprite().alpha=0;this._tweener.addTween(e.getSprite(),"alpha",0,1,0.35,b.components.tween.EasingFunctions.linear);e.getSprite().anchor=new PIXI.Point(0.5,0.5);this._uiPanel.getEntity().addChild(this._overCard);this._overCardUi=new b.ui.UiElement(this._overCard,this._uiPanel);break;case 2:n="STORY_PUZZLE_BUILDER";break;case 3:n="STORY_DIFFERENCE"}new b.pixi.PixiText(a,b.Localizer.getString(n),d);this._overlay.addChild(a);a=c.UiFactory.createPulseButtonQuickAbsolute(this,
0,350,"playButton","playButton",s(this,this.onCloseButtonClick),null,"ui_click_1");this._overlay.addChild(a);this._overlayUi.setCoords(new b.Vector2D(0,-2.3));this._tweener.addTween(this._overlayUi.getCoordsRef(),"y",-2.3,-0.16,1.5,b.components.tween.EasingFunctions.easeInOutQuint,1)},postUpdate:function(){b.GameState.prototype.postUpdate.call(this);null!=this._overCardUi&&this._overCardUi.setCoords(new b.Vector2D(this._overlayUi.getCoords().x,this._overlayUi.getCoords().y))},onCloseButtonClick:function(){this._inputEnabled&&
(this._inputEnabled=!1,null!=this._onClose&&this._onClose(),this.dismiss())},dismiss:function(){var a=this,c=this._overlay.getComponent(b.pixi.PixiSprite);this._tweener.addTween(c.getSprite(),"alpha",1,0,0.5,b.components.tween.EasingFunctions.linear);null!=this._overCard&&(c=this._overCard.getComponentsInChildren(b.pixi.PixiSprite)[0],this._tweener.addTween(c.getSprite(),"alpha",1,0,0.5,b.components.tween.EasingFunctions.linear));c=this._charactersTransform.getComponent(b.ui.UiElement);this._tweener.addTween(c.getCoordsRef(),
"y",c.getCoords().y,2.5,0.5,b.components.tween.EasingFunctions.easeInCubic,0,function(){a.destroy()})},destroy:function(){b.GameState.prototype.destroy.call(this)},__class__:c.StoryDialog});c.UiFactory=function(){};c.UiFactory.__name__=["game","UiFactory"];c.UiFactory.createFullscreenUiPanel=function(a){var c=b.Root.getInstance().getScreenSize(),e=c.getClone();c.x*=b.Root.getInstance().getScreenScale().x;c.y*=b.Root.getInstance().getScreenScale().y;a=a.addEntity();c=new b.ui.UiPanel(a,b.Root.isMobile()?
new b.Vector2D(c.x,c.y):new b.Vector2D(q.dataWidth,q.dataHeight));new b.pixi.PixiContainer(a);a.setPosition(e.x/2,e.y/2);return c};c.UiFactory.createPulseButton=function(a,c,e,d,n,g,h,k,m,p,q,r,s,t,v,w,x){x=b.GameEntity.instantiate(a.getGameState());(new b.ui.UiElement(x,a)).setCoords(new b.Vector2D(c,e));a=new b.pixi.PixiSprite(x,m);b.components.Button.createFromPixiSprite(a);new b.components.buttons.ButtonMouseDownPulse(x,d,n,g,t);new b.components.buttons.ButtonMouseOverScale(x,h,k,b.components.tween.EasingFunctions.easeOutQuint,
b.components.tween.EasingFunctions.easeOutQuint);new b.components.buttons.ButtonActionDelay(x,q,r,s);new b.components.buttons.ButtonMouseOverImage(x,m,p);new b.components.buttons.ButtonSoundPlay(x,v,w);return x};c.UiFactory.createPulseButtonQuick=function(a,b,e,d,n,g,h,k,m,p,q,r){null==q&&(q=0.35);null==p&&(p=!0);null==m&&(m="");null==k&&(k="");return c.UiFactory.createPulseButton(a,b,e,0.35,1,0.15,1.15,0.35,d,n,g,q,r,p,k,m,h)};c.UiFactory.createPulseButtonAbsolute=function(a,c,e,d,n,g,h,k,m,p,q,
r,s,t,v,w,x){a=b.GameEntity.instantiate(a);a.setPosition(c,e);c=new b.pixi.PixiSprite(a,m);b.components.Button.createFromPixiSprite(c);new b.components.buttons.ButtonMouseDownPulse(a,d,n,g,t);new b.components.buttons.ButtonMouseOverScale(a,h,k,b.components.tween.EasingFunctions.easeOutQuint,b.components.tween.EasingFunctions.easeOutQuint);new b.components.buttons.ButtonActionDelay(a,q,r,s);new b.components.buttons.ButtonMouseOverImage(a,m,p);new b.components.buttons.ButtonSoundPlay(a,v,w);return a};
c.UiFactory.createPulseButtonQuickAbsolute=function(a,b,e,d,n,g,h,k,m,p,q,r){null==q&&(q=0.35);null==p&&(p=!0);null==m&&(m="");null==k&&(k="");return c.UiFactory.createPulseButtonAbsolute(a,b,e,0.35,1,0.15,1.15,0.35,d,n,g,q,r,p,k,m,h)};c.UiFactory.createTextButton=function(a,d,e,f,n,g,h,k,m,p){null==p&&(p=!0);null==m&&(m="");null==k&&(k="");var q=n.getGameState();a=c.UiFactory.createPulseButtonQuick(n,a,d,f,f,h,g,k,m,p,0.35);q=q.addEntity();q.setPosition(0,-5);new b.pixi.PixiText(q,b.Localizer.getString(e),
{font:"32px league_gothic-webfont",fill:"#FFFFFF"});a.addChild(q);return a.getComponent(b.ui.UiElement)};c.UiFactory.prototype={__class__:c.UiFactory};c.WatchVideoDialog=function(a,d,e){this._wasPrevMuted=!1;b.GameState.call(this);this._contentIds=a;this._playerId=d;this._onClose=e;this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);this._root=this.addEntity();new b.ui.UiElement(this._root,this._uiPanel);this._wasPrevMuted=b.audio.SoundManager.getMusicMuted()};c.WatchVideoDialog.__name__=["game",
"WatchVideoDialog"];c.WatchVideoDialog.show=function(a,d,e){a=new c.WatchVideoDialog(a,d,e);b.Root.getInstance().addGameState(a);return a};c.WatchVideoDialog.__super__=b.GameState;c.WatchVideoDialog.prototype=r(b.GameState.prototype,{init:function(){var a=this;b.GameState.prototype.init.call(this);if("1"!=b.GameConfig.getProperty("ooyala.enabled"))this.onVideoFinish();else{var d=this.addEntity();new b.ui.UiElement(d,this._uiPanel);(new b.pixi.PixiSprite(d,"videoOverlay")).getSprite().anchor=new PIXI.Point(0.5,
0.5);var d=c.UiFactory.createTextButton(0,0.7604166666666666,"VIDEO_SCREEN_CLOSE_BUTTON","textButton",this._uiPanel,null,s(this,this.onCloseButtonClick),"ui_click_1"),e=this.addEntity();(new b.ui.UiElement(e,this._uiPanel)).setCoords(new b.Vector2D(-0.0380859375,-0.7005208333333334));(new b.pixi.PixiSprite(e,"dtPopupLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);this.showVideo(this._contentIds[0]);if(1<this._contentIds.length){var f=this._contentIds.length,e=this.addEntity();e.setPosition(-50*
(f-1),240);this._root.addChild(e);for(var f=0,n=this._contentIds.length;f<n;){var g=f++,h=[g],g=c.UiFactory.createPulseButtonQuickAbsolute(this,100*g,0,"numberButton","numberButton",function(b){return function(){a.onNumberButtonClicked(b[0])}}(h),null,"ui_click_1","",!1),k=this.addEntity();k.setPosition(0,-5);new b.pixi.PixiText(k,t.string(h[0]+1),{font:"42px league_gothic-webfont",fill:"#FFFFFF"});g.addChild(k);e.addChild(g)}d.setCoords(new b.Vector2D(0,0.8645833333333334))}else y.ooyala.OoyalaVideoManager.getInstance().addEventListener("videoFinish",
s(this,this.onVideoFinish));this._wasPrevMuted||b.audio.SoundManager.setMusicMuted(!0)}},onNumberButtonClicked:function(a){this.showVideo(this._contentIds[a])},showVideo:function(a){null!=this._videoDiv&&(this._videoDiv.parentNode.removeChild(this._videoDiv),y.ooyala.OoyalaVideoManager.getInstance().destroyVideo());var c=b.Root.getInstance().getScreenScale(),e=192*c.x,d=200*c.y,n=640*c.x,c=360*c.y;this._videoDiv=q.getDocument().createElement("div");this._videoDiv.style.position="absolute";this._videoDiv.style.left=
e+"px";this._videoDiv.style.top=d+"px";this._videoDiv.style.width=n+"px";this._videoDiv.style.height=c+"px";this._videoDiv.style.backgroundColor="#000000";this._videoDiv.style.display="inline-block";q.getContainer().appendChild(this._videoDiv);y.ooyala.OoyalaVideoManager.getInstance().embed(a,this._playerId,this._videoDiv,n,c);y.utag.UtagManager.getInstance().link("VideoWatched: Dreamtopia - [Game Title] - "+a,"games")},onVideoFinish:function(){this.onCloseButtonClick()},onCloseButtonClick:function(){null!=
this._onClose&&this._onClose();null!=this._videoDiv&&(this._videoDiv.parentNode.removeChild(this._videoDiv),y.ooyala.OoyalaVideoManager.getInstance().destroyVideo(),this.destroy());this._wasPrevMuted||b.audio.SoundManager.setMusicMuted(!1)},destroy:function(){b.GameState.prototype.destroy.call(this);y.ooyala.OoyalaVideoManager.getInstance().removeEventListener("videoFinish",s(this,this.onVideoFinish))},__class__:c.WatchVideoDialog});c.boot={};c.boot.BootState=function(){b.GameState.call(this)};c.boot.BootState.__name__=
["game","boot","BootState"];c.boot.BootState.__super__=b.GameState;c.boot.BootState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this);this._root=b.Root.getInstance();var a=new b.managers.PhysicsManager;this._root.addManager(a);a=new b.managers.InputManager;this._root.addManager(a);var c=new b.managers.FontManager;this._root.addManager(c);c=new b.managers.DebugManager;this._root.addManager(c);c=new b.managers.VoManager;this._root.addManager(c);c=new b.speechManager.SpeechManager;
this._root.addManager(c);a.disablePageKeyPresses();this.initLayers();this.getAssetsList()},getAssetsList:function(){var a=new b.LoadBatch(!0);a.addAsset("pixiJs","./js/pixi.min.js",b.AssetType.Javascript);a.addAsset("assetList",q.dataBaseUrl+"asset_list.xml",b.AssetType.Other);a.addAsset("strings",q.dataBaseUrl+"./locale/${locale}/strings.xml",b.AssetType.Other);a.addAsset("gameConfig",q.dataBaseUrl+"./locale/${locale}/game_config.xml",b.AssetType.Other);a.addAsset("gameCss",q.dataBaseUrl+"./locale/${locale}/css/game.css",
b.AssetType.Css);a.addAsset("styleCss",q.dataBaseUrl+"./locale/${locale}/css/style.css",b.AssetType.Css);a.addAsset("speechMap",q.dataBaseUrl+"./media/xml/speech_map.xml",b.AssetType.Other);a.addAsset("ipadOrientationImage",q.dataBaseUrl+"./media/images/system/orientation_ipad.png",b.AssetType.Image);a.addAsset("iphoneOrientationImage",q.dataBaseUrl+"./media/images/system/orientation_iphone.png",b.AssetType.Image);a.load(s(this,this.onAssetListLoaded))},onAssetListLoaded:function(){b.GameConfig.parseGameConfig(b.managers.AssetManager.getAsset("gameConfig"));
b.Localizer.initStrings();b.speechManager.SpeechManager.getInstance().setup();if(b.Root.isMobile()||"NONE"!=b.GameConfig.getProperty("forceOrientation")){var a=new b.gameStates.OrientationState;this._root.addGameState(a);b.Root.getInstance().onOrientationChanged()}a=b.managers.AssetManager.getAsset("assetList");for(a=B.parse(a).elementsNamed("loadBatch");a.hasNext();){for(var c=new b.LoadBatch,e=a.next(),d=e.get("basePath"),n=e.elementsNamed("asset");n.hasNext();){var g=n.next(),h=G.createEnum(b.AssetType,
g.get("type")),k={};switch(h[1]){case 0:if(g.exists("scaleMode")){var m=g.get("scaleMode").toLowerCase();k.scaleMode="nearest"==m?PIXI.SCALE_MODES.NEAREST:"linear"==m?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.DEFAULT}else k.scaleMode=PIXI.SCALE_MODES.DEFAULT}c.addAsset(g.get("name"),d+g.get("path"),h,k)}b.managers.AssetManager.registerAsset(e.get("name"),c)}a=b.managers.AssetManager.getAsset("loadScreenBatchPreload");a.concatLoadBatch(b.managers.AssetManager.getAsset("cartLoadScreenPreload"));a.load(s(this,
this.onLoadScreenPreloadComplete))},onLoadScreenPreloadComplete:function(){b.pixi.PixiManager.getInstance().setup({backgroundColor:0,antialias:!0,resolution:1});this._menusState=new c.MenusState;this._loadingScreen=c.menuScreens.LoadingScreen.create(this._menusState);this._menusState.addMenu(this._loadingScreen);this._root.addGameState(this._menusState);this._root.onResizeWindow();var a=b.managers.AssetManager.getAsset("loadBatchPreload");a.concatLoadBatch(b.managers.AssetManager.getAsset("cartPreload"));
a.load(s(this,this.onPreloadComplete))},onPreloadComplete:function(){this.destroy();b.audio.SoundManager.playMusicByName("music_whats_gonna_happen");var a=new b.box2d.Box2dManager;this._root.addManager(a);this._loadingScreen.dismiss();a=!0;switch(q.getQueryStringValue(q.getWindow().location.href,"minigame")){case "cartGame":c.GameTracker.getInstance().setCurrentLevelNumber(1);c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.CartGame);break;case "memoryGame":c.GameTracker.getInstance().setCurrentLevelNumber(2);
c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.MemoryGame);break;case "puzzleBuilder":c.GameTracker.getInstance().setCurrentLevelNumber(3);c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.PuzzleBuilderGame);break;case "spotTheDifference":c.GameTracker.getInstance().setCurrentLevelNumber(4);c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.SpotTheDifferenceGame);break;default:a=!1}a?(a=c.menuScreens.WorldTitleScreen.create(this._menusState),
a.getUiPanel().getEntity().translate(1024,b.Root.getInstance().getScreenSize().y),c.MenusState.getInstance().addMenu(a),c.MenusState.getInstance().moveCameraInstant(-1024,0),c.MenusState.getInstance().moveCameraBy(0,-768)):this._menusState.addMenu(c.menuScreens.TitleScreen.create(this._menusState));y.utag.UtagManager.getInstance().link("play: Dreamtopia - [Game Title]","games")},initLayers:function(){this._root.addLayer(new b.Layer("debug",q.CANVAS_WIDTH_LANDSCAPE,q.CANVAS_HEIGHT_LANDSCAPE))},__class__:c.boot.BootState});
c.menuScreens={};c.menuScreens.MenuScreen=function(a){b.Component.call(this,a);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this.getGameState());new b.ui.UiPanelSizeToWindow(this._uiPanel.getEntity(),this._uiPanel,!0)};c.menuScreens.MenuScreen.__name__=["game","menuScreens","MenuScreen"];c.menuScreens.MenuScreen.__super__=b.Component;c.menuScreens.MenuScreen.prototype=r(b.Component.prototype,{getUiPanel:function(){return this._uiPanel},init:function(){b.Component.prototype.init.call(this);this.bringIn()},
bringIn:function(){},dismiss:function(){},onDismissComplete:function(){this.dispatchEvent(new c.menuScreens.MenuScreenEvent("dismiss"))},__class__:c.menuScreens.MenuScreen});c.menuScreens.LevelSelectScreen=function(a){this._inputEnabled=!0;this._levelButtons=[];var d=this;c.menuScreens.MenuScreen.call(this,a);this._gameLogoTransform=this.getGameState().addEntity();a=new b.ui.UiElement(this._gameLogoTransform,this._uiPanel);a.setCoords(new b.Vector2D(0,0.74));a.setScale(0.55,0.55);(new b.pixi.PixiSprite(this._gameLogoTransform,
"dtLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._soundButtonTransform=this.getGameState().addEntity();new b.ui.UiElement(this._soundButtonTransform,this._uiPanel);a=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),0,0,"soundButton","soundButton",null,null,"","",!1);this._soundButtonTransform.addChild(a);(new c.SoundButton(a,"soundButton","soundOffButton")).getSiblingComponent(b.components.Button).setCamera(c.MenusState.getInstance().getCamera());this._unicornButtonTransform=
c.UiFactory.createPulseButtonQuick(this._uiPanel,0,0.68,"unicornButton","unicornButton",s(this,this.onUnicornButtonClicked),null,"ui_click_1",null,!1);this._unicornButtonTransform.getComponent(b.components.Button).setCamera(c.MenusState.getInstance().getCamera());a=0;for(var e=c.menuScreens.LevelSelectScreen._buttonPositions.length;a<e;){var f=a++,n=4<=f,g;g=!0==4<=f?"levelLockedButton":"levelPlayButton";var h=c.menuScreens.LevelSelectScreen._buttonPositions[f];g=c.UiFactory.createPulseButtonQuick(this._uiPanel,
h.x,h.y,g,g,null,null,"ui_gem_bells_2","",!1);this._levelButtons.push(g);h=this.getGameState().addEntity();new b.pixi.PixiContainer(h);h.setPosition(10,-96);g.addChild(h);var k=new b.pixi.PixiSprite(this.getGameState().addEntity(),"levelLabel"+(f+1));k.getSprite().anchor=new PIXI.Point(0.5,0.5);h.addChild(k.getEntity());k=new b.pixi.PixiText(this.getGameState().addEntity(),b.Localizer.getString("LEVEL_"+(f+1)),{font:"28px league_gothic-webfont",fill:"#FFFFFF",align:"center",lineHeight:26});k.getEntity().setPosition(-7,
4);h.addChild(k.getEntity());h=[g.getComponent(b.components.Button)];h[0].setData(f+1);h[0].setCamera(c.MenusState.getInstance().getCamera());n||g.getComponent(b.components.buttons.ButtonActionDelay).setOnAction(function(a){return function(){if(d._inputEnabled)d.onLevelButtonClicked(a[0])}}(h))}};c.menuScreens.LevelSelectScreen.__name__=["game","menuScreens","LevelSelectScreen"];c.menuScreens.LevelSelectScreen.create=function(a){a=a.addEntity();return new c.menuScreens.LevelSelectScreen(a)};c.menuScreens.LevelSelectScreen.__super__=
c.menuScreens.MenuScreen;c.menuScreens.LevelSelectScreen.prototype=r(c.menuScreens.MenuScreen.prototype,{onLevelButtonClicked:function(a){if(this._inputEnabled){c.MenusState.getInstance().getCameraTransitioning()&&c.MenusState.getInstance().skipCameraTween();a=a.getData();switch(a){case 2:c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.MemoryGame);break;case 3:c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.PuzzleBuilderGame);break;case 4:c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.SpotTheDifferenceGame);
break;default:c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.CartGame)}c.GameTracker.getInstance().setCurrentLevelNumber(a);this.dismiss();a=c.menuScreens.WorldTitleScreen.create(c.MenusState.getInstance());a.getUiPanel().getEntity().translate(0,b.Root.getInstance().getScreenSize().y);c.MenusState.getInstance().addMenu(a);c.MenusState.getInstance().moveCameraBy(0,-768);y.utag.UtagManager.getInstance().link("LevelSelected: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),
"games")}},unlockLevel:function(a){c.GameTracker.getInstance().getSaveData().setItem("levelUnlocked"+a,!0);a=this._levelButtons[a-1];a.findChildByName("costText").destroy();a=a.getComponentsInChildren(b.components.buttons.ButtonMouseOverImage)[0];a.setDefaultImage("grayLevelButton");a.setMouseOverImage("grayLevelButton")},onUnicornButtonClicked:function(){var a=this,d=new c.PrintablePuzzleState;b.Root.getInstance().addGameState(d);this.getGameState().pause();d.addEventListener("destroy",function(){a.getGameState().resume()})},
init:function(){c.menuScreens.MenuScreen.prototype.init.call(this)},bringIn:function(){c.menuScreens.MenuScreen.prototype.bringIn.call(this);this._tweener=new b.components.Tweener(this._uiPanel.getEntity());var a=this._soundButtonTransform.getComponent(b.ui.UiElement);this._tweener.addTween(a.getCoordsRef(),"x",1.5,0.89,1,b.components.tween.EasingFunctions.easeOutCubic);this._tweener.addTween(a.getCoordsRef(),"y",-1.5,-0.85,1,b.components.tween.EasingFunctions.easeOutCubic);a=this._unicornButtonTransform.getComponent(b.ui.UiElement);
this._tweener.addTween(a.getCoordsRef(),"x",1.5,0.815,1,b.components.tween.EasingFunctions.easeOutCubic);a=this._gameLogoTransform.getComponent(b.pixi.PixiContainer);this._tweener.addTween(a.getContainer(),"alpha",0,1,1,b.components.tween.EasingFunctions.linear);for(var a=this._levelButtons.length,d=0;d<a;){var e=d++,f=this._levelButtons[e],n=new b.components.Tweener(f),g=f.getComponent(b.pixi.PixiContainer);g.getContainer().alpha=0;f=[f.getComponent(b.components.Button)];f[0].setIsActive(!1);n.addTween(g.getContainer(),
"alpha",0,1,0.5,b.components.tween.EasingFunctions.linear,0.75+0.15*e,function(a){return function(){a[0].setIsActive(!0)}}(f))}},dismiss:function(){var a=this;c.menuScreens.MenuScreen.prototype.dismiss.call(this);this._inputEnabled=!1;var d=this._soundButtonTransform.getComponent(b.ui.UiElement);this._tweener.addTween(d.getCoordsRef(),"x",0.89,1.5,1,b.components.tween.EasingFunctions.easeOutCubic);this._tweener.addTween(d.getCoordsRef(),"y",-0.85,-1.5,1,b.components.tween.EasingFunctions.easeOutCubic);
d=this._unicornButtonTransform.getComponent(b.ui.UiElement);this._tweener.addTween(d.getCoordsRef(),"x",0.815,1.5,1,b.components.tween.EasingFunctions.easeOutCubic);d=this._gameLogoTransform.getComponent(b.pixi.PixiContainer);this._tweener.addTween(d.getContainer(),"alpha",1,0,1,b.components.tween.EasingFunctions.linear,0,function(){a.onDismissComplete();a._uiPanel.getEntity().destroy();a.destroy()});for(var d=this._levelButtons.length,e=0;e<d;){var f=e++,n=this._levelButtons[f],g=new b.components.Tweener(n),
n=n.getComponent(b.pixi.PixiContainer);n.getContainer().alpha=1;g.addTween(n.getContainer(),"alpha",1,0,0.35,b.components.tween.EasingFunctions.linear,0.15*f,function(){})}},__class__:c.menuScreens.LevelSelectScreen});c.menuScreens.LoadingScreen=function(a){this._isDismissing=!1;this._maxRange=1;this._minRange=0;c.menuScreens.MenuScreen.call(this,a);c.menuScreens.LoadingScreen._instance=this;this._tweener=new b.components.Tweener(this._uiPanel.getEntity());this._loadingRoot=this.getGameState().addEntity();
(new b.ui.UiElement(this._loadingRoot,this._uiPanel)).setCoords(new b.Vector2D(0,0));a=this.getGameState().addEntity();a.setPosition(0,-150);this._loadingRoot.addChild(a);(new b.pixi.PixiSprite(a,"dtLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=this.getGameState().addEntity();this._loadingRoot.addChild(a);(new b.pixi.PixiSprite(this._loadingRoot,"loadingBar")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._loadingBar=this.getGameState().addEntity();this._loadingRoot.addChild(this._loadingBar);
this._loadingBar.setPosition(-150,-27);new b.pixi.PixiSprite(this._loadingBar,"loadingBarFill");a=this.getGameState().addEntity();(new b.pixi.PixiText(a,"x",{font:"18px league_gothic-webfont"})).getText().alpha=0.001;this._loadingRoot.addChild(a)};c.menuScreens.LoadingScreen.__name__=["game","menuScreens","LoadingScreen"];c.menuScreens.LoadingScreen.getInstance=function(){return c.menuScreens.LoadingScreen._instance};c.menuScreens.LoadingScreen.create=function(a){a=a.addEntity();return new c.menuScreens.LoadingScreen(a)};
c.menuScreens.LoadingScreen.__super__=c.menuScreens.MenuScreen;c.menuScreens.LoadingScreen.prototype=r(c.menuScreens.MenuScreen.prototype,{getMinRange:function(){return this._minRange},setMinRange:function(a){this._minRange=a},setRange:function(a,b){this._minRange=a;this._maxRange=b},getMaxRange:function(){return this._maxRange},setMaxRange:function(a){this._maxRange=a},bringIn:function(){c.menuScreens.MenuScreen.prototype.bringIn.call(this);if(!this._isDismissing){var a=this._loadingRoot.getComponent(b.ui.UiElement),
d=this._loadingRoot.getComponent(b.pixi.PixiContainer);this._tweener.addTween(a.getCoordsRef(),"y",-1.5,0.25,1,b.components.tween.EasingFunctions.easeOutCubic,0);this._tweener.addTween(d.getContainer(),"alpha",0,1,1,b.components.tween.EasingFunctions.linear,0)}},init:function(){c.menuScreens.MenuScreen.prototype.init.call(this)},onFileLoaded:function(a,b){null!=this._loadingBar&&this.updateLoadingMeter(this._minRange+a/b*(this._maxRange-this._minRange))},updateLoadingMeter:function(a){this._loadingBar.setScale(Math.min(1,
a))},handleMessage:function(a,b){c.menuScreens.MenuScreen.prototype.handleMessage.call(this,a,b);switch(a){case "onFileLoaded":this.onFileLoaded(b.progress,b.total)}},dismiss:function(){var a=this;c.menuScreens.MenuScreen.prototype.dismiss.call(this);this._isDismissing=!0;this._tweener.destroyAllTweens();var d=this._loadingRoot.getComponent(b.ui.UiElement);this._tweener.addTween(d.getCoordsRef(),"y",0.25,-1.5,0.65,b.components.tween.EasingFunctions.easeInBack,0,function(){a.onDismissComplete()})},
destroy:function(){c.menuScreens.MenuScreen.prototype.destroy.call(this);c.menuScreens.LoadingScreen._instance==this&&(c.menuScreens.LoadingScreen._instance=null)},__class__:c.menuScreens.LoadingScreen});c.menuScreens.MenuScreenEvent=function(a){b.events.Event.call(this,a)};c.menuScreens.MenuScreenEvent.__name__=["game","menuScreens","MenuScreenEvent"];c.menuScreens.MenuScreenEvent.__super__=b.events.Event;c.menuScreens.MenuScreenEvent.prototype=r(b.events.Event.prototype,{__class__:c.menuScreens.MenuScreenEvent});
c.menuScreens.TitleScreen=function(a){this._skipStory=!1;this._inputEnabled=!0;c.menuScreens.MenuScreen.call(this,a);c.GameTracker.getInstance().setCurrentLevelNumber(1);c.GameTracker.getInstance().setSelectedMinigameType(c.minigames.MinigameType.CartGame);c.MenusState.getInstance().setWorldTitleSpriteBackground("level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashBg");this._headerTransform=this.getGameState().addEntity();new b.ui.UiElement(this._headerTransform,this._uiPanel);(new b.pixi.PixiSprite(this._headerTransform,
"level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashLabelBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=new b.pixi.PixiText(this.getGameState().addEntity(),b.Localizer.getString("LEVEL_"+c.GameTracker.getInstance().getCurrentLevelNumber()+"_WORLD_TITLE"),{font:"70px league_gothic-webfont",fill:"#FFFFFF",align:"center"});a.getEntity().setPosition(0,22);this._headerTransform.addChild(a.getEntity());this._gameLogoTransform=this.getGameState().addEntity();new b.ui.UiElement(this._gameLogoTransform,
this._uiPanel);(new b.pixi.PixiSprite(this._gameLogoTransform,"splashLogoSmall")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._charactersTransform=this.getGameState().addEntity();new b.ui.UiElement(this._charactersTransform,this._uiPanel);(new b.pixi.PixiSprite(this._charactersTransform,"level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashCharacters")).getSprite().anchor=new PIXI.Point(0.5,1);this._playButtonTransform=c.UiFactory.createPulseButtonQuick(this._uiPanel,0,0.67,"playButton",
"playButton",s(this,this.onPlayButtonClicked),b.Layers.getUi(),"ui_click_1");this._playButtonTransform.getComponent(b.components.Button).setCollisionProperties(new b.Vector2D(135,165),new b.Vector2D(10,-10))};c.menuScreens.TitleScreen.__name__=["game","menuScreens","TitleScreen"];c.menuScreens.TitleScreen.create=function(a){a=a.addEntity();return new c.menuScreens.TitleScreen(a)};c.menuScreens.TitleScreen.__super__=c.menuScreens.MenuScreen;c.menuScreens.TitleScreen.prototype=r(c.menuScreens.MenuScreen.prototype,
{onBackButtonClicked:function(){if(this._inputEnabled&&!c.MenusState.getInstance().getCameraTransitioning()){this.dismiss();var a=c.menuScreens.LevelSelectScreen.create(c.MenusState.getInstance());c.MenusState.getInstance().addMenu(a);a.getUiPanel().getEntity().translate(0,-768);c.MenusState.getInstance().moveCameraBy(0,768)}},onPlayButtonClicked:function(){this._inputEnabled&&(this._inputEnabled=!1,this._skipStory?this.startLoadingMinigame():this.gotoStory())},gotoStory:function(){this.dismiss();
c.MenusState.getInstance().moveCameraBy(-1024,0,2.5,s(this,this.onStoryMoveComplete));c.StoryDialog.show(s(this,this.startLoadingMinigame))},onStoryMoveComplete:function(){},startLoadingMinigame:function(){var a=new b.LoadBatch;a.concatLoadBatch(b.managers.AssetManager.getAsset("gameplayLoad"));this.dismiss();this._loadingScreen=c.menuScreens.LoadingScreen.create(c.MenusState.getInstance());c.MenusState.getInstance().addMenu(this._loadingScreen);this._loadingScreen.getUiPanel().getEntity().translate(0,
0);switch(c.GameTracker.getInstance().getSelectedMinigameType()[1]){case 0:c.menuScreens.LoadingScreen.getInstance().setRange(0,0.5);break;default:c.menuScreens.LoadingScreen.getInstance().setRange(0,1)}var d="level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"Load";a.concatLoadBatch(b.managers.AssetManager.getAsset(d));a.load(s(this,this.onLevelLoadComplete))},onVideoButtonClicked:function(){var a=this;this.getGameState().pause();c.WatchVideoDialog.show(this.getOoyalaContentIds(),b.GameConfig.getProperty("ooyala.playerId"),
function(){a.getGameState().resume()})},bringIn:function(){var a=this;c.menuScreens.MenuScreen.prototype.bringIn.call(this);this._inputEnabled=!1;var d=new b.components.Tweener(this._uiPanel.getEntity()),e=this._gameLogoTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",-2.5,-0.74,1.5,b.components.tween.EasingFunctions.easeOutCubic,0);e=this._headerTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,
2.5));d.addTween(e.getCoordsRef(),"y",-2.5,-0.415,1.5,b.components.tween.EasingFunctions.easeOutCubic,0);e=this._charactersTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,1,1.5,b.components.tween.EasingFunctions.easeOutCubic,0);e=this._playButtonTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,0.67,1.5,b.components.tween.EasingFunctions.easeOutCubic,
0,function(){a._inputEnabled=!0});null!=this._videoButtonTransform&&(e=this._videoButtonTransform.getComponent(b.ui.UiElement),e.setCoords(new b.Vector2D(e.getCoords().x,2.5)),d.addTween(e.getCoordsRef(),"y",2.5,0.763,1.5,b.components.tween.EasingFunctions.easeOutCubic,0))},dismiss:function(){var a=this;c.menuScreens.MenuScreen.prototype.dismiss.call(this);this._inputEnabled=!1;var d=new b.components.Tweener(this._uiPanel.getEntity()),e=this._gameLogoTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),
"y",-0.82,-2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._headerTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",-0.35,-2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._charactersTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",1,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._playButtonTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",0.67,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic,
0,function(){a.onDismissComplete();a._uiPanel.getEntity().destroy();a.destroy()});null!=this._videoButtonTransform&&(e=this._videoButtonTransform.getComponent(b.ui.UiElement),d.addTween(e.getCoordsRef(),"y",0.763,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic,0))},onLevelLoadComplete:function(){y.utag.UtagManager.getInstance().link("LevelStart: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),"games");this._minigameState=new c.minigames.MinigameState;
this._minigameState.addEventListener("ready",s(this,this.onMinigameReady));b.Root.getInstance().addGameState(this._minigameState)},onMidpoint:function(){this._minigameState.onTransitionToMinigame()},onMinigameReady:function(a){c.FadeTransition.doMidpointTransition(c.MenusState.getInstance(),this._minigameState,s(this,this.onMidpoint))},getOoyalaContentIds:function(){switch(c.GameTracker.getInstance().getCurrentLevelNumber()){case 1:return this.getContentIdList("rainbowCove");case 2:return this.getContentIdList("wispyForest");
case 3:return this.getContentIdList("sweetville");case 4:return this.getContentIdList("sparkleMountain");default:return[]}},getContentIdList:function(a,c){null==c&&(c=1);var e=[],d;for(d=a+(null==c?"null":""+c)+".contentId";null!=b.GameConfig.getProperty(d);)e.push(t.string(b.GameConfig.getProperty(d))),c++,d=a+(null==c?"null":""+c)+".contentId";return e},__class__:c.menuScreens.TitleScreen});c.menuScreens.WorldTitleScreen=function(a){this._inputEnabled=!0;c.menuScreens.MenuScreen.call(this,a);c.MenusState.getInstance().setWorldTitleSpritePosition(1024,
768);c.MenusState.getInstance().setWorldTitleSpriteBackground("level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashBg");this._gameLogoTransform=this.getGameState().addEntity();(new b.ui.UiElement(this._gameLogoTransform,this._uiPanel)).setScale(0.55,0.55);(new b.pixi.PixiSprite(this._gameLogoTransform,"dtLogo")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._headerTransform=this.getGameState().addEntity();new b.ui.UiElement(this._headerTransform,this._uiPanel);(new b.pixi.PixiSprite(this._headerTransform,
"level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashLabelBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=new b.pixi.PixiText(this.getGameState().addEntity(),b.Localizer.getString("LEVEL_"+c.GameTracker.getInstance().getCurrentLevelNumber()+"_WORLD_TITLE"),{font:"82px league_gothic-webfont",fill:"#FFFFFF",align:"center"});a.getEntity().setPosition(0,10);this._headerTransform.addChild(a.getEntity());this._charactersTransform=this.getGameState().addEntity();new b.ui.UiElement(this._charactersTransform,
this._uiPanel);(new b.pixi.PixiSprite(this._charactersTransform,"level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"SplashCharacters")).getSprite().anchor=new PIXI.Point(0.5,1);this._homeButtonTransform=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.87,-0.85,"","",s(this,this.onHomeButtonClick),b.Layers.getUi(),"ui_click_1","",!1);a=new b.pixi.PixiSprite(this.getGameState().addEntity(),"homeButton");a.getSprite().anchor=new PIXI.Point(0.5,0.5);a.getEntity().setScale(0.57,0.57);this._homeButtonTransform.addChild(a.getEntity());
this._homeButtonTransform.getComponent(b.components.Button).setCollisionProperties(new b.Vector2D(80,80),new b.Vector2D);this._backButtonTransform=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.87,-0.85,"","",s(this,this.onBackButtonClicked),b.Layers.getUi(),"ui_click_1","",!1);a=new b.pixi.PixiSprite(this.getGameState().addEntity(),"backButton");a.getSprite().anchor=new PIXI.Point(0.5,0.5);a.getEntity().setScale(1.1,1.1);this._backButtonTransform.addChild(a.getEntity());this._backButtonTransform.getComponent(b.components.Button).setCollisionProperties(new b.Vector2D(80,
80),new b.Vector2D);this._playButtonTransform=c.UiFactory.createPulseButtonQuick(this._uiPanel,0,0.67,"playButton","playButton",s(this,this.onPlayButtonClicked),b.Layers.getUi(),"ui_click_1");this._playButtonTransform.getComponent(b.components.Button).setCollisionProperties(new b.Vector2D(135,165),new b.Vector2D(10,-10));if("1"==b.GameConfig.getProperty("ooyala.enabled"))if(0<this.getOoyalaContentIds().length)this._videoButtonTransform=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.804,0.763,
"videoButton","videoButton",s(this,this.onVideoButtonClicked),b.Layers.getUi(),"ui_click_1");else{this._videoButtonTransform=this.getGameState().addEntity();(new b.ui.UiElement(this._videoButtonTransform,this._uiPanel)).setCoords(new b.Vector2D(0.804,0.763));(new b.pixi.PixiSprite(this._videoButtonTransform,"videoButtonGrey")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=this.getGameState().addEntity();a.setPosition(0,28);(new b.pixi.PixiSprite(a,"comingSoonBanner")).getSprite().anchor=new PIXI.Point(0.5,
0.5);this._videoButtonTransform.addChild(a);var d=this.getGameState().addEntity();d.setPosition(0,4);new b.pixi.PixiText(d,b.Localizer.getString("VIDEO_COMING_SOON"),{font:"36px league_gothic-webfont",fill:"#FFFFFF"});a.addChild(d)}};c.menuScreens.WorldTitleScreen.__name__=["game","menuScreens","WorldTitleScreen"];c.menuScreens.WorldTitleScreen.create=function(a){a=a.addEntity();return new c.menuScreens.WorldTitleScreen(a)};c.menuScreens.WorldTitleScreen.__super__=c.menuScreens.MenuScreen;c.menuScreens.WorldTitleScreen.prototype=
r(c.menuScreens.MenuScreen.prototype,{onBackButtonClicked:function(){if(this._inputEnabled&&!c.MenusState.getInstance().getCameraTransitioning()){this.dismiss();var a=c.menuScreens.LevelSelectScreen.create(c.MenusState.getInstance());c.MenusState.getInstance().addMenu(a);a.getUiPanel().getEntity().translate(0,-768);c.MenusState.getInstance().moveCameraBy(0,768)}},onHomeButtonClick:function(){this._inputEnabled&&!c.MenusState.getInstance().getCameraTransitioning()&&(this.dismiss(),c.MenusState.getInstance().setWorldTitleSpritePosition(0,
768),c.menuScreens.TitleScreen.create(c.MenusState.getInstance()),this.getUiPanel().getEntity().translate(-1024,0),c.MenusState.getInstance().moveCameraInstant(1024,0),c.MenusState.getInstance().moveCameraBy(0,768))},onPlayButtonClicked:function(){if(this._inputEnabled){this._inputEnabled=!1;var a=new b.LoadBatch;a.concatLoadBatch(b.managers.AssetManager.getAsset("gameplayLoad"));this.dismiss();this._loadingScreen=c.menuScreens.LoadingScreen.create(c.MenusState.getInstance());c.MenusState.getInstance().addMenu(this._loadingScreen);
this._loadingScreen.getUiPanel().getEntity().translate(0,0);switch(c.GameTracker.getInstance().getSelectedMinigameType()[1]){case 0:c.menuScreens.LoadingScreen.getInstance().setRange(0,0.5);break;default:c.menuScreens.LoadingScreen.getInstance().setRange(0,1)}var d="level"+c.GameTracker.getInstance().getCurrentLevelNumber()+"Load";a.concatLoadBatch(b.managers.AssetManager.getAsset(d));a.load(s(this,this.onLevelLoadComplete))}},onVideoButtonClicked:function(){var a=this;this.getGameState().pause();
c.WatchVideoDialog.show(this.getOoyalaContentIds(),b.GameConfig.getProperty("ooyala.playerId"),function(){a.getGameState().resume()})},bringIn:function(){var a=this;c.menuScreens.MenuScreen.prototype.bringIn.call(this);this._inputEnabled=!1;var d=new b.components.Tweener(this._uiPanel.getEntity()),e=this._gameLogoTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,-0.82,1.5,b.components.tween.EasingFunctions.easeOutCubic,0.5);
e=this._headerTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,-0.35,1.5,b.components.tween.EasingFunctions.easeOutCubic,0.5);e=this._charactersTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,1,1.5,b.components.tween.EasingFunctions.easeOutCubic,0.5);e=this._homeButtonTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,
2.5));d.addTween(e.getCoordsRef(),"y",2.5,-0.85,1.5,b.components.tween.EasingFunctions.easeOutCubic,0.5);e=this._backButtonTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,-0.85,1.5,b.components.tween.EasingFunctions.easeOutCubic,0.5);e=this._playButtonTransform.getComponent(b.ui.UiElement);e.setCoords(new b.Vector2D(e.getCoords().x,2.5));d.addTween(e.getCoordsRef(),"y",2.5,0.67,1.5,b.components.tween.EasingFunctions.easeOutCubic,
0,function(){a._inputEnabled=!0});null!=this._videoButtonTransform&&(e=this._videoButtonTransform.getComponent(b.ui.UiElement),e.setCoords(new b.Vector2D(e.getCoords().x,2.5)),d.addTween(e.getCoordsRef(),"y",2.5,0.763,1.5,b.components.tween.EasingFunctions.easeOutCubic,0))},dismiss:function(){var a=this;c.menuScreens.MenuScreen.prototype.dismiss.call(this);this._inputEnabled=!1;var d=new b.components.Tweener(this._uiPanel.getEntity()),e=this._gameLogoTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),
"y",-0.82,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._headerTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",-0.35,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._charactersTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",1,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._homeButtonTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",-0.85,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);
e=this._backButtonTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",-0.85,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic);e=this._playButtonTransform.getComponent(b.ui.UiElement);d.addTween(e.getCoordsRef(),"y",0.67,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic,0,function(){a.onDismissComplete();a._uiPanel.getEntity().destroy();a.destroy()});null!=this._videoButtonTransform&&(e=this._videoButtonTransform.getComponent(b.ui.UiElement),d.addTween(e.getCoordsRef(),
"y",0.763,2.5,1.5,b.components.tween.EasingFunctions.easeOutCubic,0))},onLevelLoadComplete:function(){y.utag.UtagManager.getInstance().link("LevelStart: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),"games");this._minigameState=new c.minigames.MinigameState;this._minigameState.addEventListener("ready",s(this,this.onMinigameReady));b.Root.getInstance().addGameState(this._minigameState)},onMidpoint:function(){this._minigameState.onTransitionToMinigame()},
onMinigameReady:function(a){c.FadeTransition.doMidpointTransition(c.MenusState.getInstance(),this._minigameState,s(this,this.onMidpoint))},getOoyalaContentIds:function(){switch(c.GameTracker.getInstance().getCurrentLevelNumber()){case 1:return this.getContentIdList("rainbowCove");case 2:return this.getContentIdList("wispyForest");case 3:return this.getContentIdList("sweetville");case 4:return this.getContentIdList("sparkleMountain");default:return[]}},getContentIdList:function(a,c){null==c&&(c=1);
var e=[],d;for(d=a+(null==c?"null":""+c)+".contentId";null!=b.GameConfig.getProperty(d);)e.push(t.string(b.GameConfig.getProperty(d))),c++,d=a+(null==c?"null":""+c)+".contentId";return e},__class__:c.menuScreens.WorldTitleScreen});c.minigames={};c.minigames.Minigame=function(a){this._isGameActive=this._hasSeenTutorial=!1;b.Component.call(this,a);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this.getGameState())};c.minigames.Minigame.__name__=["game","minigames","Minigame"];c.minigames.Minigame.__super__=
b.Component;c.minigames.Minigame.prototype=r(b.Component.prototype,{getResults:function(){return this._minigameResults},init:function(){b.Component.prototype.init.call(this);this._isGameActive=!1;this._hasSeenTutorial=c.GameTracker.getInstance().getHasSeenTutorial()},dispatchReady:function(){this.getGameState().dispatchEvent(new c.minigames.MinigameEvent("ready"))},onTransitionToMinigame:function(){},startGame:function(){this._hud=c.EntityFactory.createHud(this.getGameState());var a=this.getGameState();
this._hud.addEventListener(c.HudEvent.SHOW_MENU,s(a,a.showPauseMenu))},update:function(){b.Component.prototype.update.call(this);this._isGameActive&&this.updateGameplay()},updateGameplay:function(){},collectGems:function(a){c.minigames.gems.GemManager.getInstance().addGems(a);null!=this._minigameResults&&(this._minigameResults.gems+=a)},beatMinigame:function(){console.log("beat");this.dispatchEvent(new c.minigames.MinigameEvent("beat"))},failMinigame:function(){console.log("fail");this.dispatchEvent(new c.minigames.MinigameEvent("fail"))},
showTutorial:function(){c.GameTracker.getInstance().setHasSeenTutorial(!0)},__class__:c.minigames.Minigame});c.minigames.MinigameEvent=function(a){b.events.Event.call(this,a)};c.minigames.MinigameEvent.__name__=["game","minigames","MinigameEvent"];c.minigames.MinigameEvent.__super__=b.events.Event;c.minigames.MinigameEvent.prototype=r(b.events.Event.prototype,{__class__:c.minigames.MinigameEvent});c.minigames.MinigameResults=function(){this.score=this.gems=0;this.starGoals=[]};c.minigames.MinigameResults.__name__=
["game","minigames","MinigameResults"];c.minigames.MinigameResults.prototype={getStars:function(){for(var a=this.starGoals.length,b=0;b<a;){var c=b++;if(this.score<=this.starGoals[c])return c}return a},__class__:c.minigames.MinigameResults};c.minigames.MinigameState=function(){b.GameState.call(this);this._playerData=new c.PlayerData};c.minigames.MinigameState.__name__=["game","minigames","MinigameState"];c.minigames.MinigameState.__super__=b.GameState;c.minigames.MinigameState.prototype=r(b.GameState.prototype,
{init:function(){b.GameState.prototype.init.call(this);var a=c.GameTracker.getInstance().getSelectedMinigameType(),d=this.addEntity();this._root=this.addEntity();new b.pixi.PixiContainer(this._root);this._uiPanel=c.UiFactory.createFullscreenUiPanel(this);switch(a[1]){case 1:this._minigame=new c.minigames.memoryGame.MemoryGame(d);b.audio.SoundManager.playMusicByName("music_i_want_it_all");break;case 2:this._minigame=new c.minigames.puzzleBuilderGame.PuzzleBuilderGame(d);b.audio.SoundManager.playMusicByName("music_i_want_it_all");
break;case 3:this._minigame=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame(d);b.audio.SoundManager.playMusicByName("music_i_want_it_all");break;default:this._minigame=new c.minigames.cartGame.CartGame(d),b.audio.SoundManager.playMusicByName("music_youre_here")}this._minigame.addEventListener("beat",s(this,this.onBeatMinigame));this._minigame.addEventListener("fail",s(this,this.onFailMinigame))},startGameCompleteSequence:function(){var a=this,d=c.UiFactory.createFullscreenUiPanel(this);
this._gameCompleteSequence=this.addEntity();var e=new b.pixi.PixiSprite(this._gameCompleteSequence,"textBg");e.getSprite().anchor=new PIXI.Point(0.5,0.5);d=new b.ui.UiElement(this._gameCompleteSequence,d);(new b.components.DeferredActionComponent(this._gameCompleteSequence)).addDeferredAction(3,function(){a.onGameCompleteSequenceComplete()});var f=new b.components.Tweener(this._gameCompleteSequence);f.addTween(e.getSprite(),"alpha",0,1,0.15,b.components.tween.EasingFunctions.linear);f.addTween(e.getSprite(),
"alpha",1,0,0.15,b.components.tween.EasingFunctions.linear,1.75);f.addTween(d.getScaleRef(),"x",0,1,0.25,b.components.tween.EasingFunctions.easeOutBack);f.addTween(d.getScaleRef(),"y",0,1,0.25,b.components.tween.EasingFunctions.easeOutBack);f.addTween(d.getScaleRef(),"x",1,0,0.5,b.components.tween.EasingFunctions.easeInBack,1.75);f.addTween(d.getScaleRef(),"y",1,0,0.5,b.components.tween.EasingFunctions.easeInBack,1.75);e=this.addEntity();e.setPosition(0,-20);d={font:"48px league_gothic-webfont"};
d.fill=c.GameColors.WHITE;new b.pixi.PixiText(e,b.Localizer.getString("GAMEPLAY_SCREEN_GAME_COMPLETE"),d,1);this._gameCompleteSequence.addChild(e)},startGameFailSequence:function(){var a=this,d=c.UiFactory.createFullscreenUiPanel(this);this._gameCompleteSequence=this.addEntity();var e=new b.pixi.PixiSprite(this._gameCompleteSequence,"textBg");e.getSprite().anchor=new PIXI.Point(0.5,0.5);d=new b.ui.UiElement(this._gameCompleteSequence,d);(new b.components.DeferredActionComponent(this._gameCompleteSequence)).addDeferredAction(3,
function(){a.onGameCompleteSequenceComplete()});var f=new b.components.Tweener(this._gameCompleteSequence);f.addTween(e.getSprite(),"alpha",0,1,0.15,b.components.tween.EasingFunctions.linear);f.addTween(e.getSprite(),"alpha",1,0,0.15,b.components.tween.EasingFunctions.linear,1.75);f.addTween(d.getScaleRef(),"x",0,1,0.25,b.components.tween.EasingFunctions.easeOutBack);f.addTween(d.getScaleRef(),"y",0,1,0.25,b.components.tween.EasingFunctions.easeOutBack);f.addTween(d.getScaleRef(),"x",1,0,0.5,b.components.tween.EasingFunctions.easeInBack,
1.75);f.addTween(d.getScaleRef(),"y",1,0,0.5,b.components.tween.EasingFunctions.easeInBack,1.75);e=this.addEntity();e.setPosition(0,-20);d={font:"48px league_gothic-webfont"};d.fill=c.GameColors.WHITE;new b.pixi.PixiText(e,b.Localizer.getString("GAMEPLAY_SCREEN_GAME_FAIL"),d,1);this._gameCompleteSequence.addChild(e)},onGameCompleteSequenceComplete:function(){this.pause();var a;switch(c.GameTracker.getInstance().getSelectedMinigameType()[1]){case 0:a=new c.LevelCompleteCartGameState(this._minigame.getResults());
break;case 1:a=new c.LevelCompleteMemoryGameState(this._minigame.getResults());break;case 2:a=new c.LevelCompletePuzzleBuilderGameState(this._minigame.getResults());break;case 3:a=new c.LevelCompleteSpotTheDifferenceGameState(this._minigame.getResults())}b.Root.getInstance().addGameState(a);a.addEventListener("destroy",s(this,this.onDestroyLevelComplete));c.GameTracker.getInstance().setHasBeatLevel(c.GameTracker.getInstance().getCurrentLevelNumber())},onBeatMinigame:function(a){this._minigame.removeEventListener("beat",
s(this,this.onBeatMinigame));this.startGameCompleteSequence()},onFailMinigame:function(a){this._minigame.removeEventListener("fail",s(this,this.onFailMinigame));this.startGameFailSequence()},onDestroyLevelComplete:function(a){this.destroy()},showLevelComplete:function(){},showPauseMenu:function(){this.pause();b.Root.getInstance().addGameState(new c.PauseMenuState(this))},onTransitionToMinigame:function(){this._minigame.onTransitionToMinigame()},update:function(){b.GameState.prototype.update.call(this)},
destroy:function(){b.GameState.prototype.destroy.call(this)},__class__:c.minigames.MinigameState});c.minigames.MinigameTutorial=function(a,c){this._currentPage=0;this._placements=[];b.Component.call(this,a);new b.pixi.PixiContainer(a);this._backgroundImageAssetName=c};c.minigames.MinigameTutorial.__name__=["game","minigames","MinigameTutorial"];c.minigames.MinigameTutorial.__super__=b.Component;c.minigames.MinigameTutorial.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);
var a=this.getGameState().addEntity();a.setScale(2E3,1);(new b.pixi.PixiSprite(a,"overlay")).getSprite().anchor=new PIXI.Point(0.5,0.5);this.getEntity().addChild(a);this._background=this.getGameState().addEntity();(new b.pixi.PixiSprite(this._background,this._backgroundImageAssetName)).getSprite().anchor=new PIXI.Point(0.5,0.5);this._placementsContainer=this.getGameState().addEntity();new b.pixi.PixiContainer(this._placementsContainer);this._background.addChild(this._placementsContainer);this.getEntity().addChild(this._background);
a=this.getGameState().addEntity();a.setPosition(0,-300);this._headingText=new b.pixi.PixiText(a,"*HEADING",{font:"36px league_gothic-webfont",fill:"#FFFFFF"});this._background.addChild(a);this._skipButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),449,331.5,"skipButton","skipButton",s(this,this.onSkipButtonClick),null,"ui_click_1");this.getEntity().addChild(this._skipButton)},placeImage:function(a,c,d){var f=this.getGameState().addEntity();(new b.pixi.PixiSprite(f,d)).getSprite().anchor=
new PIXI.Point(0.5,0.5);f.setPosition(a,c);this._placements.push(f);this._placementsContainer.addChild(f);return f},placeText:function(a,c,d,f,n,g,h){null==h&&(h=350);null==n&&(n="center");g=this.getGameState().addEntity();var k={};k.font=f+"px league_gothic-webfont";k.fill="#FFFFFF";k.wordWrap=!0;k.wordWrapWidth=h;k.align=n;new b.pixi.PixiText(g,d,k);g.setPosition(a,c);this._placements.push(g);this._placementsContainer.addChild(g);return g},clearPlacements:function(){for(var a=this._placements.length,
b=0;b<a;){var c=b++;this._placements[c].destroy()}this._placements=[]},createNextButton:function(a,b){var d=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),a,b,"resumeButton","resumeButton",s(this,this.onNextButtonClick),null,"ui_click_1","",!1);this._background.addChild(d);return d},onNextButtonClick:function(){this._currentPage++;this.updatePage()},onSkipButtonClick:function(){this.getGameState().destroy()},updatePage:function(){this.clearPlacements()},setHeadingText:function(a){this._headingText.setTextString(a)},
destroy:function(){b.Component.prototype.destroy.call(this)},__class__:c.minigames.MinigameTutorial});c.minigames.MinigameTutorialState=function(){b.GameState.call(this)};c.minigames.MinigameTutorialState.__name__=["game","minigames","MinigameTutorialState"];c.minigames.MinigameTutorialState.__super__=b.GameState;c.minigames.MinigameTutorialState.prototype=r(b.GameState.prototype,{init:function(){b.GameState.prototype.init.call(this)},__class__:c.minigames.MinigameTutorialState});c.minigames.MinigameType=
{__ename__:!0,__constructs__:["CartGame","MemoryGame","PuzzleBuilderGame","SpotTheDifferenceGame"]};c.minigames.MinigameType.CartGame=["CartGame",0];c.minigames.MinigameType.CartGame.toString=D;c.minigames.MinigameType.CartGame.__enum__=c.minigames.MinigameType;c.minigames.MinigameType.MemoryGame=["MemoryGame",1];c.minigames.MinigameType.MemoryGame.toString=D;c.minigames.MinigameType.MemoryGame.__enum__=c.minigames.MinigameType;c.minigames.MinigameType.PuzzleBuilderGame=["PuzzleBuilderGame",2];c.minigames.MinigameType.PuzzleBuilderGame.toString=
D;c.minigames.MinigameType.PuzzleBuilderGame.__enum__=c.minigames.MinigameType;c.minigames.MinigameType.SpotTheDifferenceGame=["SpotTheDifferenceGame",3];c.minigames.MinigameType.SpotTheDifferenceGame.toString=D;c.minigames.MinigameType.SpotTheDifferenceGame.__enum__=c.minigames.MinigameType;c.minigames.MinigameType.__empty_constructs__=[c.minigames.MinigameType.CartGame,c.minigames.MinigameType.MemoryGame,c.minigames.MinigameType.PuzzleBuilderGame,c.minigames.MinigameType.SpotTheDifferenceGame];
c.minigames.VirtualController=function(a,c,d){this._desireLeft=this._desireRight=this._desireUp=this._desireDown=this._desireAbility=this._desireJump=!1;b.Component.call(this,a);this._uiPanel=c;this._character=d};c.minigames.VirtualController.__name__=["game","minigames","VirtualController"];c.minigames.VirtualController.__super__=b.Component;c.minigames.VirtualController.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._leftButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,
-0.8,0.7,"leftButton","leftButton",null,null,"","",!1,0);var a=this._leftButton.getComponent(b.components.Button);a.setOnMouseDown(s(this,this.onLeftButtonMouseDown));a.setOnMouseUp(s(this,this.onLeftButtonMouseUp));a.setOnMouseOut(s(this,this.onLeftButtonMouseUp));this._rightButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,-0.525,0.7,"rightButton","rightButton",null,null,"","",!1,0);a=this._rightButton.getComponent(b.components.Button);a.setOnMouseDown(s(this,this.onRightButtonMouseDown));
a.setOnMouseUp(s(this,this.onRightButtonMouseUp));a.setOnMouseOut(s(this,this.onRightButtonMouseUp));this._upButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.8,0.7,"upButton","upButton",null,null,"","",!1,0);a=this._upButton.getComponent(b.components.Button);a.setOnMouseDown(s(this,this.onUpButtonMouseDown));a.setOnMouseUp(s(this,this.onUpButtonMouseUp));a.setOnMouseOut(s(this,this.onUpButtonMouseUp));this._downButton=c.UiFactory.createPulseButtonQuick(this._uiPanel,0.525,0.7,"downButton",
"downButton",null,null,"","",!1,0);a=this._downButton.getComponent(b.components.Button);a.setOnMouseDown(s(this,this.onDownButtonMouseDown));a.setOnMouseUp(s(this,this.onDownButtonMouseUp));a.setOnMouseOut(s(this,this.onDownButtonMouseUp))},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);var a=new b.Vector2D;this._desireLeft?a.x=-1:this._desireRight&&(a.x=1);this._desireUp?a.y=-1:this._desireDown&&(a.y=1);this._character.desireDirection(a);this._desireJump&&this._character.desireAction(0);
this._desireAbility&&this._character.desireAction(1);this._desireAbility=this._desireJump=!1},onLeftButtonMouseDown:function(){this._desireLeft=!0},onLeftButtonMouseUp:function(){this._desireLeft=!1},onRightButtonMouseDown:function(){this._desireRight=!0},onRightButtonMouseUp:function(){this._desireRight=!1},onUpButtonMouseDown:function(){this._desireJump=this._desireUp=!0},onUpButtonMouseUp:function(){this._desireUp=!1},onDownButtonMouseDown:function(){this._desireDown=!0},onDownButtonMouseUp:function(){this._desireDown=
!1},onAbilityButtonClick:function(){this._desireAbility=!0},__class__:c.minigames.VirtualController});c.minigames.cartGame={};c.minigames.cartGame.BestDistanceDisplay=function(a){this._playingTween=!1;b.Component.call(this,a);this._tweener=new b.components.Tweener(a)};c.minigames.cartGame.BestDistanceDisplay.__name__=["game","minigames","cartGame","BestDistanceDisplay"];c.minigames.cartGame.BestDistanceDisplay.__super__=b.Component;c.minigames.cartGame.BestDistanceDisplay.prototype=r(b.Component.prototype,
{update:function(){b.Component.prototype.update.call(this);if(!this._playingTween){var a=c.minigames.cartGame.CartGame.getInstance().getPlayer();null!=a&&a.getPositionRef().x>this.getEntity().getPositionRef().x&&(a=this.getEntity().getComponent(b.pixi.PixiContainer),this._tweener.addTween(a.getContainer(),"alpha",1,0,0.35,b.components.tween.EasingFunctions.easeOutQuad),this._tweener.addTween(this.getEntity().getScaleRef(),"x",1,3,0.35,b.components.tween.EasingFunctions.easeOutQuad),this._tweener.addTween(this.getEntity().getScaleRef(),
"y",1,3,0.35,b.components.tween.EasingFunctions.easeOutQuad,0,s(this,this.onTweensComplete)),this._playingTween=!0)}},onTweensComplete:function(){this.getEntity().destroy()},__class__:c.minigames.cartGame.BestDistanceDisplay});c.minigames.cartGame.CartGame=function(a){this._passedGoal=this._gameOver=!1;this._distanceTraveled=this._numStarsCollected=0;this._isControllingZoom=!1;this._respawns=[];this._flyStartPoints=[];this._pieceTmxesToLoad=0;this._baseCameraZoom=1;this._isFlying=!0;this._currentExit=
0;this._pits=[];this._flyingLevelLoaded=this._groundedLevelLoaded=!1;this._transitionPoints=[];this._transitionStartPoints=[];this._enemies=[];this._exits=[];this._ladders=[];this._items=[];c.minigames.Minigame.call(this,a);c.minigames.cartGame.CartGame._instance=this;this._playerData=new c.PlayerData;new b.pixi.PixiContainer(this.getEntity());this._minigameResults=new c.minigames.cartGame.CartGameResults};c.minigames.cartGame.CartGame.__name__=["game","minigames","cartGame","CartGame"];c.minigames.cartGame.CartGame.getInstance=
function(){return c.minigames.cartGame.CartGame._instance};c.minigames.cartGame.CartGame.__super__=c.minigames.Minigame;c.minigames.cartGame.CartGame.prototype=r(c.minigames.Minigame.prototype,{getGameOver:function(){return this._gameOver},setGameOver:function(a){this._gameOver=a},getNumStarsCollected:function(){return this._numStarsCollected},setNumStarsCollected:function(a){this._numStarsCollected=a},getControllingZoom:function(){return this._isControllingZoom},setControllingZoom:function(a){this._isControllingZoom=
a},getDistanceTraveled:function(){return this._distanceTraveled},isFlying:function(){return this._isFlying},getPlayerStart:function(){return this._playerStart},getExits:function(){return this._exits},getCollisionBodies:function(){return this._collisionBodies},getEffectsLayer:function(){return this._effectsLayer},getBackgroundLayer:function(){return this._backgroundLayer},getTilesLayer:function(){return this._tilesLayer},getForegroundLayer:function(){return this._foregroundLayer},getPlayerLayer:function(){return this._playerLayer},
getPlayer:function(){return this._player},getSmartCamera:function(){return this._smartCamera},getPlayerData:function(){return this._playerData},getLadders:function(){return this._ladders},getItems:function(){return this._items},getEnemies:function(){return this._enemies},getTmxLevel:function(){return this._tmxLevel},getBaseCameraZoom:function(){return this._baseCameraZoom},init:function(){var a=this;c.minigames.Minigame.prototype.init.call(this);this._goal=c.GameTracker.getInstance().getCartGameGoal();
null!=c.menuScreens.LoadingScreen.getInstance()&&c.menuScreens.LoadingScreen.getInstance().setRange(0.5,1);c.AnimationFactory.createAnimation("rainbowCartIdle","rainbowCartIdleXml",new b.Vector2D(-79,-132),2,!0);c.AnimationFactory.createAnimation("rainbowCartRun","rainbowCartRunXml",new b.Vector2D(-79,-132),2,!0);c.AnimationFactory.createAnimation("invincibility","invincibilityXml",new b.Vector2D(-76,-76),1,!0);c.AnimationFactory.createAnimation("cartSparks","cartSparksXml",new b.Vector2D(-95,-30),
1,!0);c.AnimationFactory.createAnimation("balloonBounce","balloonBounceXml",new b.Vector2D(-104,-183),1,!1);c.AnimationFactory.createAnimation("cartHit","cartHitXml",new b.Vector2D(-57,-57),2,!1);this._levelGenerator=new c.minigames.cartGame.levelGenerator.LevelGenerator(this.getEntity(),null);this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());this._tweener=new b.components.Tweener(this.getEntity());this._pixelToMeters=b.GameConfig.getProperty("game.pixelsToMeters");var d=
this.getGameState().addEntity();this._camera=new b.pixi.PixiCamera(d);this._camera.setMuteRotation(!1);new b.components.SlackMovement(d,1);this._smartCamera=new c.minigames.cartGame.smartCamera.SmartCamera(d);this._baseCameraZoom=t.parseFloat(b.GameConfig.getProperty("game.baseCameraZoom"));for(var d=c.GameTracker.getInstance().getCurrentLevelNumber(),d=b.GameConfig.getProperty("level"+d+".pieces").split(","),e=d.length,f=0;f<e;){var n=f++,g=d[n],h=b.managers.AssetManager.getAsset(g);this._pieceTmxesToLoad++;
n=[this.getGameState().addEntity()];n[0].setName(g);g=b.tmx.TmxReader.getMapFromXmlString(h);new b.tmx.TmxLevel(n[0],g,"./media/xml/",null,null,null,function(b){return function(){a.onPieceTmxLoad(b[0])}}(n))}},onPieceTmxLoad:function(a){var d=a.getComponent(b.tmx.TmxLevel),e=new c.minigames.cartGame.levelGenerator.PieceElement(a.getName()),f=d.findObjectByType("Entry"),n=d.findObjectByType("Exit");if(1<d.getAllObjectsByType("SpawnNextTrigger").length)throw"More than one SpawnNextTrigger found on this Piece.";
if(null==f)throw"No Entry object found on Level Piece "+a.getName();if(null==n)throw"No Exit object found on Level Piece "+a.getName();d.getTmxMap().properties.exists("forceAtTime")&&(e.forceAtTime=t.parseFloat(d.getTmxMap().properties.get("forceAtTime")));d.getTmxMap().properties.exists("forceNextPieces")&&(e.forceNextPieces=t.string(d.getTmxMap().properties.get("forceNextPieces")).split(","));d.getTmxMap().properties.exists("minTime")&&(e.minTime=t.parseFloat(d.getTmxMap().properties.get("minTime")));
d.getTmxMap().properties.exists("maxTime")&&(e.maxTime=t.parseFloat(d.getTmxMap().properties.get("maxTime")));e.entryOffset=new b.Vector2D(f.x+f.width/2,f.y-f.height/2);e.exitOffset=new b.Vector2D(n.x+f.width/2,n.y-f.height/2);f.properties.exists("tags")&&(e.entryTags=t.string(f.properties.get("tags")).split(","));n.properties.exists("tags")&&(e.exitTags=t.string(n.properties.get("tags")).split(","));e.tmxLevel=d;this._levelGenerator.registerPieceElement(e);this._pieceTmxesToLoad--;if(0>=this._pieceTmxesToLoad)this.onLoadAllTmxes()},
onLoadAllTmxes:function(){this.dispatchReady();c.menuScreens.LoadingScreen.getInstance().setRange(0,1);this.dispatchEvent(new c.minigames.cartGame.LevelEvent("ready"))},startGame:function(){c.minigames.Minigame.prototype.startGame.call(this);this.start()},start:function(){var a=this._player.getComponent(c.minigames.cartGame.character.Character);a.setState(new c.minigames.cartGame.character.characterStates.RidingState(a))},initHud:function(){this._effectsLayer=this.getGameState().addEntity();var a=
new b.pixi.PixiContainer(this._effectsLayer);this._tilesLayer.getParent().insertChild(this._effectsLayer,this._tilesLayer.childIndexOf(a.getEntity()));a=this.getGameState().addEntity();(new b.ui.UiElement(a,this._uiPanel)).setCoords(new b.Vector2D(0,-1));(new b.pixi.PixiSprite(a,"hudHeaderBg")).getSprite().anchor=new PIXI.Point(0.5,0);a=this.getGameState().addEntity();new c.minigames.cartGame.DistanceDisplay(a);a.setPosition(0,0);var d=this.getGameState().addEntity();new c.minigames.cartGame.LifeDisplay(d);
d.setPosition(-238,-4);var e=this.getGameState().addEntity();e.setPosition(106,-3.5);new c.minigames.cartGame.PowerStarDisplay(e);var f=this.getGameState().addEntity();(new b.ui.UiElement(f,this._uiPanel)).setCoords(new b.Vector2D(0,1));(new b.pixi.PixiSprite(f,"hudFooterBg")).getSprite().anchor=new PIXI.Point(0.5,1);f=this.getGameState().addEntity();this._collectibleDisplay=new c.minigames.cartGame.CollectibleDisplay(f);f=this.getGameState().addEntity();(new b.pixi.PixiSprite(f,"rollerCoasterHeader")).getSprite().anchor=
new PIXI.Point(0.5,0.5);(new b.ui.UiElement(f,this._uiPanel)).setCoords(new b.Vector2D(0,-0.85));f.addChild(e);f.addChild(a);f.addChild(d);a=c.minigames.cartGame.PlatformerFactory.createBestDistanceDisplay(this._playerStart.x+this._goal*this._pixelToMeters,768,this.getGameState(),this._goal);this._bestDistanceLayer.addChild(a)},onAddPieceToEnd:function(a){this.spawnObjectsOnLevelPiece(a.getPieceComponent())},spawnObjectsOnLevelPiece:function(a){this.initSpawnNextTriggers(a);this.initLoopCollisionSwapTriggers(a);
this.initTransitionPoints(a);this.initResetTimerTriggers(a);this.initItems(a);this.initEnemies(a);this.initDecorations(a);this.initForegroundDecorations(a)},update:function(){c.minigames.Minigame.prototype.update.call(this);this._playerData.time+=b.Root.getDeltaTime();if(null!=this._player){var a=this._player.getPosition(),d=new b.Vector3D(a.x-this._prevPlayerPosition.x,a.y-this._prevPlayerPosition.y);this._prevPlayerPosition=a;this._distanceTraveled+=d.x/this._pixelToMeters;0>this._distanceTraveled&&
(this._distanceTraveled=0);this._distanceTraveled>=this._goal&&(this._distanceTraveled=this._goal,this.beatLevel())}a=this._camera.getEntity().getPosition();for(d=this._items.length;0<=--d;){var e=this._items[d];-1E3>e.getPosition().x-a.x&&e.destroy()}},initCollision:function(){},onLevelTmxLoad:function(){},onTransitionToMinigame:function(){c.minigames.Minigame.prototype.onTransitionToMinigame.call(this);var a=this.getGameState().addEntity();this.getEntity().addChild(a);var d=new b.pixi.PixiContainer(a);
new c.minigames.cartGame.EndlessHorizontalParallax(this.getEntity(),a,["parallaxFar1","parallaxFar2"],this._camera.getEntity(),200,1);this._camera.addLayer(d,0.05,1,0,0,0).muteYMovement=!0;this._levelGenerator.addEventListener("addToEnd",s(this,this.onAddPieceToEnd));this._backgroundLayer=this.getGameState().addEntity();a=new b.pixi.PixiContainer(this._backgroundLayer);this._backgroundLayer.setName("BackgroundLayer");this._camera.addLayer(a);this.getEntity().addChild(this._backgroundLayer);this._tilesLayer=
this.getGameState().addEntity();a=new b.pixi.PixiContainer(this._tilesLayer);this._tilesLayer.setName("TilesLayer");this._camera.addLayer(a);this.getEntity().addChild(this._tilesLayer);this._levelGenerator.setTarget(this._tilesLayer);this._playerLayer=this.getGameState().addEntity();a=new b.pixi.PixiContainer(this._playerLayer);this._playerLayer.setName("PlayerLayer");this._camera.addLayer(a);this.getEntity().addChild(this._playerLayer);this._foregroundLayer=this.getGameState().addEntity();a=new b.pixi.PixiContainer(this._foregroundLayer);
this._foregroundLayer.setName("ForegroundLayer");this._camera.addLayer(a);this.getEntity().addChild(this._foregroundLayer);this._bestDistanceLayer=this.getGameState().addEntity();this.getEntity().addChild(this._bestDistanceLayer);a=new b.pixi.PixiContainer(this._bestDistanceLayer);this._camera.addLayer(a,1,0,0,0,0).muteYMovement=!0;d=this._levelGenerator.spawnRandomPieceWithEntryTag(["start"]);if(null==d)throw"No Level Piece with an Entry Object containing a 'start' tag was found.";a=this.getGameState().addEntity();
this._tilesLayer.addChild(a);var e=this.getGameState().addEntity();d.setBackgroundEntityGroup(e);c.minigames.cartGame.CartGame.getInstance().getBackgroundLayer().addChild(e);e=this.getGameState().addEntity();d.setForegroundEntityGroup(e);c.minigames.cartGame.CartGame.getInstance().getForegroundLayer().addChild(e);e=this.getGameState().addEntity();this._playerLayer.addChild(e);d.getTmxLevel().createLevel(a,0,0);this.initPlayer(d);d.setTileGroup(a);d.setEntityGroup(e);this.spawnObjectsOnLevelPiece(d);
e=this.getGameState().addEntity();c.minigames.cartGame.CartGame.getInstance().getForegroundLayer().addChild(e);var f=!0,n=a.getChildren().length;for(d.setForegroundGroup(e);0<=--n;)d=a.getChildren()[n],f&&"Tiles"!=d.getName()&&e.addChild(d),"Tiles"==d.getName()&&(f=!1);this.initHud();this.dispatchEvent(new c.minigames.cartGame.LevelEvent("ready"));this._hasSeenTutorial?this.startGame():this.showTutorial()},spawnObjects:function(){},initPlayer:function(a){var d=a.getTmxLevel().getAllObjectsByType("PlayerStart")[0];
a=new b.Vector3D(a.getEntity().getPosition().x+d.x,a.getEntity().getPosition().y+d.y-64);this._playerStart=a.getClone();this._player=c.minigames.cartGame.PlatformerFactory.createRollerCoaster(a.x,a.y,this.getGameState());this._player.translate(-200,0);a=this._player.getComponent(c.minigames.cartGame.character.AiController);null!=a&&a.destroy();new c.minigames.cartGame.character.PlayerController(this._player);b.Root.isMobile()&&new c.minigames.VirtualController(this._player,this._uiPanel,this._player.getComponent(c.minigames.cartGame.character.Character));
this._playerLayer.addChild(this._player);this._camera.jumpToTarget();this.updateCameraFollow();this._tweener.addTween(this._smartCamera.getState(),"_characterDeltaLeadModifierX",150,t.parseFloat(b.GameConfig.getProperty("game.baseCharacterLeadX")),1,b.components.tween.EasingFunctions.easeOutQuad,1);a=this._player.getComponent(c.minigames.cartGame.character.Character);a.addEventListener("die",s(this,this.onCharacterDie));d="1"==b.GameConfig.getProperty("level"+c.GameTracker.getInstance().getCurrentLevelNumber()+
".startFlying");a.setState(new c.minigames.cartGame.character.characterStates.ParkedState(a));this._isFlying=d;this._prevPlayerPosition=a.getEntity().getPosition()},onCharacterDie:function(a){c.minigames.cartGame.CartGame.getInstance().getSmartCamera().getCamera().getTarget().getComponent(b.components.FollowEntity).setIsActive(!1)},initGroundedStart:function(){},initDecorations:function(a){for(var b=a.getTmxLevel().getAllObjectsByType("Decoration"),c=b.length,d=0;d<c;){var n=d++,n=b[n],g=null,g=this.getGameState().addEntity();
g.setPosition(a.getOffset().x+n.x,a.getOffset().y+n.y);if(null!=n.gid){var h=a.getTmxLevel().getTmxMap().createPixiSpriteByTileId(g,n.gid,a.getTmxLevel().getBasePath());g.setRotation(0,0,n.rotation);h.getSprite().anchor=new PIXI.Point(0,1);h.updateParenting();h.setUpdateParentingEveryFrame(!1)}else g.translate(0.5*n.width,0.5*n.height);a.getBackgroundEntityGroup().addChild(g);this._enemies.push(g);g.addEventListener("destroy",s(this,this.onEnemyDestroyed))}},initForegroundDecorations:function(a){for(var b=
a.getTmxLevel().getAllObjectsByType("DecorationFG"),c=b.length,d=0;d<c;){var n=d++,n=b[n],g=null,g=this.getGameState().addEntity();g.setPosition(a.getOffset().x+n.x,a.getOffset().y+n.y);if(null!=n.gid){var h=a.getTmxLevel().getTmxMap().createPixiSpriteByTileId(g,n.gid,a.getTmxLevel().getBasePath());g.setRotation(0,0,n.rotation);h.getSprite().anchor=new PIXI.Point(0,1);h.updateParenting();h.setUpdateParentingEveryFrame(!1)}else g.translate(0.5*n.width,0.5*n.height);a.getForegroundEntityGroup().addChild(g);
this._enemies.push(g);g.addEventListener("destroy",s(this,this.onEnemyDestroyed))}},initEnemies:function(a){for(var d=a.getTmxLevel().getAllObjectsByType("Obstacle"),e=d.length,f=0;f<e;){var n=f++,g=d[n],n=null,n=this.getGameState().addEntity();n.setPosition(a.getOffset().x+g.x,a.getOffset().y+g.y);null!=g.gid?(g=a.getTmxLevel().getTmxMap().createPixiSpriteByTileId(n,g.gid,a.getTmxLevel().getBasePath()),n.translate(g.getSprite().width/2,-g.getSprite().height/2),g.getSprite().anchor=new PIXI.Point(0.5,
0.2),g.updateParenting(),g.setUpdateParentingEveryFrame(!1),g=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,0,0.5*g.getSprite().width,0.5*g.getSprite().height),new b.Vector3D(0,0))):(n.translate(0.5*g.width,0.5*g.height),g=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,0,g.width,g.height),new b.Vector3D(0,0)));var h=new c.minigames.cartGame.character.DamagePlayerOnContact(n);new c.minigames.cartGame.objects.Obstacle(n);g.addTag("hostile");g.addTag("obstacle");
g.addTag("slideDestroyObstacle");g.setOnEnter(s(h,h.onEnter));g.setOnExit(s(h,h.onExit));a.getForegroundEntityGroup().addChild(n);this._enemies.push(n);n.addEventListener("destroy",s(this,this.onEnemyDestroyed))}d=a.getTmxLevel().getAllObjectsByType("Pit");e=d.length;for(f=0;f<e;)n=f++,g=d[n],n=this.getGameState().addEntity(),n.setPosition(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y+g.height/2),g=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,0,g.width,g.height)),g.addTag("trigger"),
h=new c.minigames.cartGame.Pit(n),g.setOnEnter(s(h,h.onEnter)),this._pits.push(n),n.addEventListener("destroy",s(this,this.onPitDestroyed));d=a.getTmxLevel().getAllObjectsByType("Respawn");e=d.length;for(f=0;f<e;)n=f++,n=d[n],g=this.getGameState().addEntity(),g.setPosition(a.getOffset().x+n.x+n.width/2,a.getOffset().y+n.y+n.height/2),g.addEventListener("destroy",s(this,this.onRespawnDestroy)),a.getEntity().addChild(g),this._respawns.push(g)},onEnemyDestroyed:function(a){v.remove(this._enemies,a.target)},
onPitDestroyed:function(a){v.remove(this._pits,a.target)},onRespawnDestroy:function(a){v.remove(this._respawns,a.target)},getClosestRespawnPoint:function(a){for(var c=-1,d=null,f=this._respawns.length,n=0;n<f;){var g=n++,g=this._respawns[g],h=new b.Vector2D(g.getPosition().x,g.getPosition().y),h=new b.Vector2D(h.x-a.x,h.y-a.y);if(-1==c||h.getLength()<c)c=h.getLength(),d=g}return d},getPathByName:function(a,c){var d=a.getTmxLevel().findObjectByName(c);if(null==d)return null;var f=d.polyline;if(null==
f)return null;for(var n=[],g=0,h=f.points.length;g<h;){var k=g++;n.push(new b.Vector2D(a.getOffset().x+d.x+f.points[k].x,a.getOffset().y+d.y+f.points[k].y))}return n},initItems:function(a){for(var d=a.getTmxLevel().getAllObjectsByType("Gem"),e=[],f=d.length,n=0;n<f;){var g=n++,g=d[g],g=c.minigames.cartGame.PlatformerFactory.createCoin(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y-g.height/2,this.getGameState());this._items.push(g);g.addEventListener("destroy",s(this,this.onItemDestroy));this._playerLayer.addChild(g);
var h=g.getComponent(b.pixi.PixiContainer);h.updateParenting();h.setUpdateParentingEveryFrame(!1);e.push(g)}e.sort(function(a,b){return a.getPositionRef().x<b.getPositionRef().x?-1:a.getPositionRef().x>b.getPositionRef().x?1:0});d=e.length;f=null;for(g=n=0;g<d;){h=g++;h=e[h];if(null!=f){var k=h.getComponent(b.pixi.PixiAnimation);null!=k&&(25<Math.abs(f.getPositionRef().x-h.getPositionRef().x)&&(n+=k.getAnimationLength()/8,n>k.getAnimationLength()&&(n%=k.getAnimationLength())),k.setPosition(n))}f=
h}e=a.getTmxLevel().getAllObjectsByType("RandomPowerup");d=e.length;for(f=0;f<d;){n=f++;g=e[n];n=null;switch(b.utilities.Math2.randomInt(0,3)){case 1:n=c.minigames.cartGame.PlatformerFactory.createLife(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y-g.height/2,this.getGameState());break;case 2:n=c.minigames.cartGame.PlatformerFactory.createPowerStar(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y-g.height/2,this.getGameState());break;default:n=c.minigames.cartGame.PlatformerFactory.createCoinMagnet(a.getOffset().x+
g.x+g.width/2,a.getOffset().y+g.y-g.height/2,this.getGameState())}this._items.push(n);g=n.getComponent(b.pixi.PixiContainer);g.updateParenting();g.setUpdateParentingEveryFrame(!1);n.addEventListener("destroy",s(this,this.onItemDestroy));this._playerLayer.addChild(n)}e=a.getTmxLevel().getAllObjectsByType("PowerStar");d=e.length;for(f=0;f<d;)n=f++,g=e[n],b.utilities.Math2.randomInt(0,3),n=null,n=c.minigames.cartGame.PlatformerFactory.createPowerStar(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y-
g.height/2,this.getGameState()),this._items.push(n),g=n.getComponent(b.pixi.PixiContainer),g.updateParenting(),g.setUpdateParentingEveryFrame(!1),n.addEventListener("destroy",s(this,this.onItemDestroy)),this._playerLayer.addChild(n);e=a.getTmxLevel().getAllObjectsByType("Trampoline1").concat(a.getTmxLevel().getAllObjectsByType("Trampoline"));d=e.length;for(f=0;f<d;)n=f++,g=e[n],n=null,n=c.minigames.cartGame.PlatformerFactory.createTrampoline1(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y-g.height/
2,this.getGameState()),g=n.getComponent(b.pixi.PixiContainer),g.updateParenting(),g.setUpdateParentingEveryFrame(!1),n.addEventListener("destroy",s(this,this.onItemDestroy)),a.getEntityGroup().addChild(n);e=a.getTmxLevel().getAllObjectsByType("Trampoline2");d=e.length;for(f=0;f<d;)n=f++,g=e[n],n=null,n=c.minigames.cartGame.PlatformerFactory.createTrampoline2(a.getOffset().x+g.x+g.width/2,a.getOffset().y+g.y-g.height/2,this.getGameState()),g=n.getComponent(b.pixi.PixiContainer),g.updateParenting(),
g.setUpdateParentingEveryFrame(!1),n.addEventListener("destroy",s(this,this.onItemDestroy)),a.getEntityGroup().addChild(n);e=a.getTmxLevel().getAllObjectsByType("SpeedBoost");d=e.length;for(f=0;f<d;)n=f++,n=e[n],g=null,g=c.minigames.cartGame.PlatformerFactory.createSpeedBoost(a.getOffset().x+n.x+n.width/2+25,a.getOffset().y+n.y+n.height/2+25,n.width+25,n.height+25,this.getGameState()),g.addEventListener("destroy",s(this,this.onItemDestroy)),a.getEntityGroup().addChild(g)},initTransitionPoints:function(a){null!=
a.getTmxLevel().findObjectByType("TransitionTrigger")&&(a=new b.Vector3D(a.getExitPosition().x+a.getOffset().x,a.getExitPosition().y+a.getOffset().y),this._transitionPoints.push(a))},onExitDestroyed:function(a){v.remove(this._exits,a.target)},initSpawnNextTriggers:function(a){for(var d=a.getTmxLevel().getAllObjectsByType("SpawnNextTrigger"),e=d.length,f=0;f<e;){var n=f++,g=d[n],n=this.getGameState().addEntity();n.setPosition(a.getOffset().x+g.x,a.getOffset().y+g.y);g=new b.components.colliders.BoxCollider(n,
new b.collision.BoxCollision(0,0,g.width,g.height),new b.Vector3D(0,g.height/2));g.addTag("trigger");var h=new c.minigames.cartGame.levelGenerator.SpawnNextTrigger(n);g.setOnEnter(s(h,h.onEnter));a.getEntityGroup().addChild(n)}d=a.getTmxLevel().getAllObjectsByType("GapJumpTrigger");e=d.length;for(f=0;f<e;)n=f++,g=d[n],n=this.getGameState().addEntity(),n.setPosition(a.getOffset().x+g.x,a.getOffset().y+g.y),g=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,0,g.width,g.height),
new b.Vector3D(0,g.height/2)),g.addTag("trigger"),g.setOnEnter(function(){b.achievements.AchievementsManager.getInstance().incrementValue("rainbowWorldJumpGap",1)}),a.getEntityGroup().addChild(n)},initLoopCollisionSwapTriggers:function(a){for(var d=a.getTmxLevel().getAllObjectsByType("LoopCollisionSwap"),e=d.length,f=0;f<e;){var n=f++,g=d[n],n=this.getGameState().addEntity();n.setPosition(a.getOffset().x+g.x,a.getOffset().y+g.y);g=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,
0,g.width,g.height),new b.Vector3D(0,g.height/2));g.addTag("trigger");var h=new c.minigames.cartGame.levelGenerator.LoopCollisionSwapTrigger(n,a);g.setOnEnter(s(h,h.onEnter));a.getEntityGroup().addChild(n)}},initResetTimerTriggers:function(a){for(var d=a.getTmxLevel().getAllObjectsByType("ResetTimerTrigger"),e=d.length,f=0;f<e;){var n=f++,g=d[n],n=this.getGameState().addEntity();n.setPosition(a.getOffset().x+g.x,a.getOffset().y+g.y);g=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,
0,g.width,g.height),new b.Vector3D(0,g.height/2));g.addTag("trigger");var h=new c.minigames.cartGame.ResetTimerTrigger(n);g.setOnEnter(s(h,h.onEnter));a.getEntityGroup().addChild(n)}},updateCameraFollow:function(){var a=new c.minigames.cartGame.smartCamera.cameraStates.FollowCharacter(this._smartCamera,this._player,0.25,new b.Vector2D(100,-65));a.setCharacterDeltaLeadModifierX(t.parseFloat(b.GameConfig.getProperty("game.baseCharacterLeadX")));this._smartCamera.setState(a)},onNextLevelReady:function(a){},
beatLevel:function(){if(!this._passedGoal){this._passedGoal=this._gameOver=!0;var a=this._minigameResults;a.distance=this._distanceTraveled|0;a.score=a.distance+50*a.gems;a.won=!0;var d=this._player.getComponent(c.minigames.cartGame.character.Character);a.lives=Math.floor(d.getCharacterProperties().hitPoints);c.Hud.getInstance().getPauseButton().destroy();c.Hud.getInstance().getSoundButton().destroy();c.minigames.cartGame.CartGame.getInstance().getSmartCamera().getCamera().getTarget().getComponent(b.components.FollowEntity).setIsActive(!1);
this.beatMinigame()}},failLevel:function(){if(!this._passedGoal){this._gameOver=!0;var a=this._minigameResults;a.distance=this._distanceTraveled|0;a.score=a.distance+50*a.gems;var b=this._player.getComponent(c.minigames.cartGame.character.Character);a.lives=Math.floor(b.getCharacterProperties().hitPoints);c.Hud.getInstance().getPauseButton().destroy();c.Hud.getInstance().getSoundButton().destroy();this.failMinigame()}},onItemDestroy:function(a){v.remove(this._items,a.target)},removeItemFromArray:function(a){v.remove(this._items,
a)},destroy:function(){c.minigames.Minigame.prototype.destroy.call(this);c.minigames.cartGame.CartGame._instance==this&&(c.minigames.cartGame.CartGame._instance=null)},showTutorial:function(){c.minigames.Minigame.prototype.showTutorial.call(this);var a=new c.minigames.MinigameTutorialState;b.Root.getInstance().addGameState(a);var d=a.addEntity(),e=c.UiFactory.createFullscreenUiPanel(a);new b.ui.UiElement(d,e);new c.minigames.cartGame.CartGameTutorial(d,"tutorialBg");a.addEventListener("destroy",s(this,
this.onCartGameTutorialDestroy))},onCartGameTutorialDestroy:function(a){this.startGame()},__class__:c.minigames.cartGame.CartGame});c.minigames.cartGame.CartGameResults=function(){this.distance=0;this.won=!1;c.minigames.MinigameResults.call(this);this.starGoals.push(b.GameConfig.getProperty("cartGame.starGoal1"));this.starGoals.push(b.GameConfig.getProperty("cartGame.starGoal2"));this.starGoals.push(b.GameConfig.getProperty("cartGame.starGoal3"))};c.minigames.cartGame.CartGameResults.__name__=["game",
"minigames","cartGame","CartGameResults"];c.minigames.cartGame.CartGameResults.__super__=c.minigames.MinigameResults;c.minigames.cartGame.CartGameResults.prototype=r(c.minigames.MinigameResults.prototype,{__class__:c.minigames.cartGame.CartGameResults});c.minigames.cartGame.CartGameTutorial=function(a,b){c.minigames.MinigameTutorial.call(this,a,b)};c.minigames.cartGame.CartGameTutorial.__name__=["game","minigames","cartGame","CartGameTutorial"];c.minigames.cartGame.CartGameTutorial.__super__=c.minigames.MinigameTutorial;
c.minigames.cartGame.CartGameTutorial.prototype=r(c.minigames.MinigameTutorial.prototype,{init:function(){c.minigames.MinigameTutorial.prototype.init.call(this);this.updatePage();this.createNextButton(0,305)},updatePage:function(){c.minigames.MinigameTutorial.prototype.updatePage.call(this);switch(this._currentPage){case 0:this.placeImage(0,35,"cartTutorialHazard");this.setHeadingText(b.Localizer.getString("TUTORIAL_CART_HEADING_1"));break;case 1:this.placeImage(0,35,b.Root.isMobile()?"cartTutorialJumpMobile":
"cartTutorialJump");this.setHeadingText(b.Localizer.getString("TUTORIAL_CART_HEADING_2"));break;case 2:this.placeImage(-12,53,"cartTutorialBalloons");this.setHeadingText(b.Localizer.getString("TUTORIAL_CART_HEADING_3"));break;case 3:this.placeImage(0,35,"cartTutorialStarPower");this.setHeadingText(b.Localizer.getString("TUTORIAL_CART_HEADING_4"));break;case 4:this.getGameState().destroy()}},__class__:c.minigames.cartGame.CartGameTutorial});c.minigames.cartGame.CollectibleDisplay=function(a){this._spriteChosen=
!1;b.Component.call(this,a);new b.pixi.PixiContainer(this.getEntity())};c.minigames.cartGame.CollectibleDisplay.__name__=["game","minigames","cartGame","CollectibleDisplay"];c.minigames.cartGame.CollectibleDisplay.__super__=b.Component;c.minigames.cartGame.CollectibleDisplay.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);var a=this.getGameState().addEntity();(new b.pixi.PixiSprite(a,"hudCollectibleBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);this.getEntity().addChild(a);
a=this.getGameState().addEntity();a.setPosition(8,-1);this.getEntity().addChild(a);this._text=new b.pixi.PixiText(a,"",{font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"left"},1)},update:function(){b.Component.prototype.update.call(this)},__class__:c.minigames.cartGame.CollectibleDisplay});c.minigames.cartGame.DistanceDisplay=function(a){b.Component.call(this,a);this.construct();this._goal=c.GameTracker.getInstance().getCartGameGoal()};c.minigames.cartGame.DistanceDisplay.__name__=["game",
"minigames","cartGame","DistanceDisplay"];c.minigames.cartGame.DistanceDisplay.__super__=b.Component;c.minigames.cartGame.DistanceDisplay.prototype=r(b.Component.prototype,{construct:function(){var a=this.getGameState().addEntity();a.setPosition(0,0);this._text=new b.pixi.PixiText(a,"",{font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"left"});this.getEntity().addChild(a)},update:function(){b.Component.prototype.update.call(this);var a=C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_DISTANCE"),
"%N",t.string(Math.floor(c.minigames.cartGame.CartGame.getInstance().getDistanceTraveled()))),a=C.replace(a,"%M",t.string(Math.floor(this._goal)));this._text.setTextString(a)},__class__:c.minigames.cartGame.DistanceDisplay});c.minigames.cartGame.EndlessHorizontalParallax=function(a,c,d,f,n,g){null==g&&(g=1);this._yOffset=this._rightImageIndex=this._leftImageIndex=0;this._parallax=1;this._rightMost=-512;this._leftMost=0;this._backgroundPieces=[];b.Component.call(this,a);this._surface=c;this._camera=
f;this._imageNames=d;this._parallax=g;this._yOffset=n};c.minigames.cartGame.EndlessHorizontalParallax.__name__=["game","minigames","cartGame","EndlessHorizontalParallax"];c.minigames.cartGame.EndlessHorizontalParallax.__super__=b.Component;c.minigames.cartGame.EndlessHorizontalParallax.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.fillScreen()},fillScreen:function(){var a=this._camera.getComponent(b.components.Camera),c=this._camera.getPosition().x-
0.5*a.getLensSize().x/this._parallax,d=this._camera.getPosition().x+0.5*a.getLensSize().x/this._parallax,a=0;if(this._rightMost<d)for(a=this._rightMost;this._rightMost<d;){var f=this.getGameState().addEntity(),n=new b.pixi.PixiSprite(f,this._imageNames[this._rightImageIndex]);n.getSprite().anchor=new PIXI.Point(0,0);this._rightImageIndex++;this._rightImageIndex>this._imageNames.length-1&&(this._rightImageIndex=0);f.setPosition(a,0);b.utilities.Debug.log("Placed At: "+a);this._surface.addChild(f);
this._rightMost=a+=n.getSprite().width-1;this._backgroundPieces.push(f)}if(this._leftMost>c)for(a=this._leftMost;this._leftMost>c;)d=this.getGameState().addEntity(),f=new b.pixi.PixiSprite(d,this._imageNames[this._leftImageIndex]),f.getSprite().anchor=new PIXI.Point(0,0),this._leftImageIndex--,0>this._leftImageIndex&&(this._leftImageIndex=this._imageNames.length-1),d.setPosition(a-f.getSprite().width,0),this._surface.addChild(d),this._leftMost=a-=f.getSprite().width-1,this._backgroundPieces.push(d)},
cleanTiles:function(){this._camera.getComponent(b.components.Camera);for(var a=this._backgroundPieces.length;2<a;)a=this._backgroundPieces.length,v.remove(this._backgroundPieces,this._backgroundPieces[0])},update:function(){b.Component.prototype.update.call(this);this._surface.setPosition(this._surface.getLocalPosition().x,this._camera.getPosition().y+this._yOffset);this.fillScreen();this.cleanTiles()},__class__:c.minigames.cartGame.EndlessHorizontalParallax});c.minigames.cartGame.FollowPath=function(a,
c,d,f){null==f&&(f=0);null==d&&(d=1);this._nextPointIndex=this._currentPause=0;this._direction=1;b.Component.call(this,a);this._path=c;this._speed=d;this._pointPause=f};c.minigames.cartGame.FollowPath.__name__=["game","minigames","cartGame","FollowPath"];c.minigames.cartGame.FollowPath.__super__=b.Component;c.minigames.cartGame.FollowPath.prototype=r(b.Component.prototype,{update:function(){this._currentPause-=b.Root.getDeltaTime();if(0>=this._currentPause){var a=new b.Vector2D(this._path[this._nextPointIndex].x-
this.getEntity().getPosition().x,this._path[this._nextPointIndex].y-this.getEntity().getPosition().y),a=a.getNormalized();this.getEntity().translate(a.x*this._speed,a.y*this._speed);if((new b.Vector2D(Math.abs(this.getEntity().getPosition().x-this._path[this._nextPointIndex].x),Math.abs(this.getEntity().getPosition().y-this._path[this._nextPointIndex].y))).getLength()<this._speed){this._nextPointIndex+=this._direction;if(0>this._nextPointIndex||this._nextPointIndex==this._path.length)this._direction*=
-1,this._nextPointIndex+=2*this._direction;this._currentPause=this._pointPause}}},__class__:c.minigames.cartGame.FollowPath});c.minigames.cartGame.LevelEvent=function(a){b.events.Event.call(this,a)};c.minigames.cartGame.LevelEvent.__name__=["game","minigames","cartGame","LevelEvent"];c.minigames.cartGame.LevelEvent.__super__=b.events.Event;c.minigames.cartGame.LevelEvent.prototype=r(b.events.Event.prototype,{__class__:c.minigames.cartGame.LevelEvent});c.minigames.cartGame.LifeDisplay=function(a){b.Component.call(this,
a);this.construct()};c.minigames.cartGame.LifeDisplay.__name__=["game","minigames","cartGame","LifeDisplay"];c.minigames.cartGame.LifeDisplay.__super__=b.Component;c.minigames.cartGame.LifeDisplay.prototype=r(b.Component.prototype,{construct:function(){this._lives=[];for(var a=c.minigames.cartGame.CartGame.getInstance().getPlayer().getComponent(c.minigames.cartGame.character.Character).getCharacterProperties().maxHitPoints,d=0,e=0;e<a;){e++;var f=this.getGameState().addEntity(),n=new b.pixi.PixiSprite(f,
"hudHeart");n.getSprite().anchor=new PIXI.Point(0.5,0.5);f.setPosition(d,0);d+=46;this.getEntity().addChild(f);this._lives.push(n)}},update:function(){b.Component.prototype.update.call(this);var a=c.minigames.cartGame.CartGame.getInstance().getPlayer().getComponent(c.minigames.cartGame.character.Character).getCharacterProperties().hitPoints;if(null!=this._lives)for(var d=this._lives.length,e=0;e<d;){var f=e++;a>f?this._lives[f].getSprite().alpha=1:this._lives[f].getSprite().alpha=0}},__class__:c.minigames.cartGame.LifeDisplay});
c.minigames.cartGame.Pit=function(a){b.Component.call(this,a)};c.minigames.cartGame.Pit.__name__=["game","minigames","cartGame","Pit"];c.minigames.cartGame.Pit.__super__=b.Component;c.minigames.cartGame.Pit.prototype=r(b.Component.prototype,{onEnter:function(a){b.utilities.Debug.log("Pit::onEnter()");a=a.getComponent(c.minigames.cartGame.character.Character);var d=new c.minigames.cartGame.character.DamageProperties;d.damage=1;d.instantDeath=!1;a.inflictDamage(d);0<a.getCharacterProperties().hitPoints?
(d=c.minigames.cartGame.CartGame.getInstance().getClosestRespawnPoint(a.getPosition()),a.setPosition(d.getPosition().x,d.getPosition().y),a.clampToGround(1E3),a.setVelocity(new b.Vector2D(0,0)),a.getCharacterProperties().movementSpeed=0,d=a.getEntity().getComponent(b.components.Tweener),a=a.getSiblingComponent(b.pixi.PixiContainer),d.addTween(a.getContainer(),"alpha",0,1,1,b.components.tween.EasingFunctions.linear)):a.setVelocity(new b.Vector2D(0.2*a.getVelocity().x,a.getVelocity().y))},__class__:c.minigames.cartGame.Pit});
c.minigames.cartGame.PlatformerFactory=function(){};c.minigames.cartGame.PlatformerFactory.__name__=["game","minigames","cartGame","PlatformerFactory"];c.minigames.cartGame.PlatformerFactory.createPlatformingCharacter=function(a,l,e){b.box2d.Box2dManager.getInstance().getB2World();e=e.addEntity();e.setPosition(a,l);a=new d.dynamics.B2BodyDef;a.fixedRotation=!0;a.type=d.dynamics.B2Body.b2_dynamicBody;a.allowSleep=!1;l=new d.dynamics.B2FixtureDef;l.density=1;l.friction=0;l.restitution=0;var f=new d.collision.shapes.B2CircleShape(0.75);
f.setLocalPosition(new d.common.math.B2Vec2(0,-0.75));a=new b.box2d.Box2dBody(e,a,f,l);l=new d.dynamics.B2FixtureDef;l.isSensor=!0;l.density=1;l.shape=d.collision.shapes.B2PolygonShape.asBox(0.5,0.5);a=a.getB2Body().createFixture(l);new b.components.Tweener(e);new b.components.SimpleMovement(e);l=new c.minigames.cartGame.character.Character(e);l.setGroundSensor(a);l.getCharacterProperties().baseScale=t.parseFloat(b.GameConfig.getProperty("baseCharacter.baseScale"));l.getCharacterProperties().maxHitPoints=
t.parseFloat(b.GameConfig.getProperty("baseCharacter.baseHitPoints"));l.getCharacterProperties().hitPoints=l.getCharacterProperties().maxHitPoints;l.getCharacterProperties().movementSpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.movementSpeed"));l.getCharacterProperties().slopeDownMovementSpeedModifier=t.parseFloat(b.GameConfig.getProperty("baseCharacter.slopeDownMovementSpeedModifier"));l.getCharacterProperties().slopeUpMovementSpeedModifier=t.parseFloat(b.GameConfig.getProperty("baseCharacter.slopeUpMovementSpeedModifier"));
l.getCharacterProperties().maxMovementSpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.maxMovementSpeed"));l.getCharacterProperties().flySpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.flySpeed"));l.getCharacterProperties().maxFlySpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.maxFlySpeed"));l.getCharacterProperties().accelerationSpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.accelerationSpeed"));l.getCharacterProperties().deccelerationSpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.deccelerationSpeed"));
l.getCharacterProperties().jumpPower=t.parseFloat(b.GameConfig.getProperty("baseCharacter.jumpPower"));l.getCharacterProperties().dropThroughVelocity=t.parseFloat(b.GameConfig.getProperty("baseCharacter.dropThroughVelocity"));l.getCharacterProperties().maxFallSpeed=t.parseFloat(b.GameConfig.getProperty("baseCharacter.maxFallSpeed"));l.getCharacterProperties().speedIncreasePerMeter=t.parseFloat(b.GameConfig.getProperty("baseCharacter.speedIncreasePerMeter"));l.getCharacterProperties().metersUntilSpeedIncrease=
t.parseFloat(b.GameConfig.getProperty("baseCharacter.metersUntilSpeedIncrease"));l.getCharacterProperties().baseMovementSpeed=l.getCharacterProperties().movementSpeed;l.getCharacterProperties().baseFlySpeed=l.getCharacterProperties().flySpeed;l.getCharacterProperties().boostDeccelearation=t.parseFloat(b.GameConfig.getProperty("baseCharacter.speedBoostDecceleration"));l.getEntity().setScale(l.getCharacterProperties().baseScale,l.getCharacterProperties().baseScale);return e};c.minigames.cartGame.PlatformerFactory.createRollerCoaster=
function(a,d,e){a=c.minigames.cartGame.PlatformerFactory.createPlatformingCharacter(a,d,e);d=a.getComponent(c.minigames.cartGame.character.Character);new c.minigames.cartGame.character.CharacterAnimationController(a,"rainbowCart");d.setDamageState(new c.minigames.cartGame.character.damageStates.BlinkDamageState(d));new b.pixi.PixiAnimation(a,"rainbowCartIdle");new c.minigames.cartGame.character.ItemCollector(a,t.parseFloat(b.GameConfig.getProperty("game.baseItemCollectionRange")));a.addTag("rollerCoaster");
return a};c.minigames.cartGame.PlatformerFactory.createTrampoline1=function(a,d,e){e=e.addEntity();e.setPosition(a,d);(new b.pixi.PixiSprite(e,"trampoline1")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=new b.collision.BoxCollision(0,0,650,450);a=new b.components.colliders.BoxCollider(e,a,new b.Vector3D(0,-150));a.addTag("trigger");d=new c.minigames.cartGame.objects.Trampoline(e);a.setOnEnter(s(d,d.onEnter));return e};c.minigames.cartGame.PlatformerFactory.createTrampoline2=function(a,d,e){e=e.addEntity();
e.setPosition(a,d);(new b.pixi.PixiSprite(e,"trampoline2")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=new b.collision.BoxCollision(0,0,650,450);a=new b.components.colliders.BoxCollider(e,a,new b.Vector3D(0,-150));a.addTag("trigger");d=new c.minigames.cartGame.objects.Trampoline(e);a.setOnEnter(s(d,d.onEnter));return e};c.minigames.cartGame.PlatformerFactory.createTrampolineHit=function(a,c,d){var f=d.addEntity();f.setPosition(a,c);(new b.pixi.PixiAnimation(f,"balloonBounce")).setOnAnimationComplete(function(){f.destroy()});
return f};c.minigames.cartGame.PlatformerFactory.createSpeedBoost=function(a,d,e,f,n){n=n.addEntity();n.setPosition(a,d);a=new b.collision.BoxCollision(0,0,e,f);a=new b.components.colliders.BoxCollider(n,a,new b.Vector3D(0,0));a.addTag("trigger");d=new c.minigames.cartGame.objects.SpeedBoost(n);a.setOnEnter(s(d,d.onEnter));return n};c.minigames.cartGame.PlatformerFactory.createCoin=function(a,d,e){e=e.addEntity();e.setPosition(a,d);new b.pixi.PixiSprite(e,"coin");new c.minigames.cartGame.item.Coin(e);
return e};c.minigames.cartGame.PlatformerFactory.createCoinMagnet=function(a,d,e){var f=e.addEntity();new b.pixi.PixiContainer(f);f.setPosition(a,d);a=e.addEntity();f.addChild(a);d=new b.pixi.PixiSprite(a,"magnet");new b.components.SimpleMovement(a,null);d.getSprite().anchor=new PIXI.Point(0.5,0.5);new c.minigames.cartGame.item.CoinMagnet(f);return f};c.minigames.cartGame.PlatformerFactory.createLife=function(a,d,e){var f=e.addEntity();new b.pixi.PixiContainer(f);f.setPosition(a,d);a=e.addEntity();
f.addChild(a);d=new b.pixi.PixiSprite(a,"life");new b.components.SimpleMovement(a,null);d.getSprite().anchor=new PIXI.Point(0.5,0.5);new c.minigames.cartGame.item.LifeUp(f);return f};c.minigames.cartGame.PlatformerFactory.createPowerStar=function(a,d,e){console.log("PlatformerFactory::createPowerStar()");var f=e.addEntity();new b.pixi.PixiContainer(f);f.setPosition(a,d);a=e.addEntity();f.addChild(a);d=new b.pixi.PixiSprite(a,"coloredStar"+c.minigames.cartGame.CartGame.getInstance().getNumStarsCollected());
new b.components.SimpleMovement(a,null);d.getSprite().anchor=new PIXI.Point(0.5,0.5);new c.minigames.cartGame.item.PowerStar(f);return f};c.minigames.cartGame.PlatformerFactory.createFloatingHazard=function(a,d,e,f){var n=e.addEntity();n.setPosition(a,d);new b.pixi.PixiContainer(n);a=new b.pixi.PixiAnimation(e.addEntity(),"floatingHazardBall");a.getEntity().setPosition(0,-57);n.addChild(a.getEntity());a=new b.pixi.PixiAnimation(e.addEntity(),"floatingHazardBall");a.getEntity().setPosition(0,57);a.getEntity().setScale(1,
-1);n.addChild(a.getEntity());a=new b.pixi.PixiAnimation(e.addEntity(),"floatingHazardElectricity");n.addChild(a.getEntity());d=new b.pixi.PixiSprite(e.addEntity(),"floatingHazardBallElectricity");d.getEntity().setPosition(0,-57);d.getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.components.SimpleMovement(d.getEntity())).setAngularVelocity(new b.Vector3D(0,0,9));n.addChild(d.getEntity());e=new b.pixi.PixiSprite(e.addEntity(),"floatingHazardBallElectricity");e.getEntity().setPosition(0,57);e.setScaleModifier(new b.Vector2D(1,
-1));e.getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.components.SimpleMovement(e.getEntity())).setAngularVelocity(new b.Vector3D(0,0,9));n.addChild(e.getEntity());new c.minigames.cartGame.objects.DisableableObstacle(n,[a.getEntity(),e.getEntity(),d.getEntity()]);e=new c.minigames.cartGame.character.DamagePlayerOnContact(n);a=new b.components.colliders.BoxCollider(n,new b.collision.BoxCollision(0,0,80,225));a.addTag("hostile");a.addTag("obstacle");a.setOnEnter(s(e,e.onEnter));a.setOnExit(s(e,e.onExit));
null!=f&&new c.minigames.cartGame.FollowPath(n,f,t.parseFloat(b.GameConfig.getProperty("game.obstaclePathSpeed")),0);return n};c.minigames.cartGame.PlatformerFactory.createGroundHazard=function(a,d,e){var f=e.addEntity();f.setPosition(a,d);new b.pixi.PixiContainer(f);a=new b.pixi.PixiAnimation(e.addEntity(),"groundHazardBall");f.addChild(a.getEntity());e=new b.pixi.PixiAnimation(e.addEntity(),"groundHazardElectricity");f.addChild(e.getEntity());new c.minigames.cartGame.objects.DisableableObstacle(f,
[e.getEntity()]);e=new c.minigames.cartGame.character.DamagePlayerOnContact(f);a=new b.components.colliders.BoxCollider(f,new b.collision.BoxCollision(0,0,74,65),new b.Vector3D(0,-45));a.addTag("hostile");a.addTag("obstacle");a.setOnEnter(s(e,e.onEnter));a.setOnExit(s(e,e.onExit));return f};c.minigames.cartGame.PlatformerFactory.createBestDistanceDisplay=function(a,d,e,f){var n=e.addEntity();n.setPosition(a,d);new b.pixi.PixiContainer(n);a=new b.pixi.PixiSprite(e.addEntity(),"hudBestDistance");a.getSprite().anchor=
new PIXI.Point(0.5,0.5);n.addChild(a.getEntity());e=new b.pixi.PixiText(e.addEntity(),C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_BEST_DISTANCE"),"%N",null==f?"null":""+f),{font:"22pt league_gothic-webfont",fill:"#FFFFFF"});n.addChild(e.getEntity());new c.minigames.cartGame.BestDistanceDisplay(n);return n};c.minigames.cartGame.PlatformerFactory.prototype={__class__:c.minigames.cartGame.PlatformerFactory};c.minigames.cartGame.PowerStarDisplay=function(a){b.Component.call(this,a);this.construct()};
c.minigames.cartGame.PowerStarDisplay.__name__=["game","minigames","cartGame","PowerStarDisplay"];c.minigames.cartGame.PowerStarDisplay.__super__=b.Component;c.minigames.cartGame.PowerStarDisplay.prototype=r(b.Component.prototype,{construct:function(){this._pixiSprite=new b.pixi.PixiSprite(this.getGameState().addEntity(),"starMeterFill");this._pixiSprite.getSprite().anchor=new PIXI.Point(0,0.5);this._mask=new PIXI.Graphics;this._pixiSprite.getSprite().mask=this._mask;this.getEntity().addChild(this._pixiSprite.getEntity())},
update:function(){b.Component.prototype.update.call(this);null==this._mask.parent&&null!=this._pixiSprite.getSprite().parent&&this._pixiSprite.getSprite().parent.addChild(this._mask);var a=c.minigames.cartGame.CartGame.getInstance().getNumStarsCollected(),a=Math.min(a/6,1);this._mask.clear();this._mask.beginFill();var d=this._pixiSprite.getSprite().width+20,e=-this._pixiSprite.getSprite().height/2,f=this._pixiSprite.getSprite().height/2,n=[];n.push(0);n.push(e);n.push(d*a);n.push(e);n.push(d*a+-26);
n.push(f);n.push(0);n.push(f);this._mask.drawPolygon(n);this._mask.endFill()},__class__:c.minigames.cartGame.PowerStarDisplay});c.minigames.cartGame.ResetTimerTrigger=function(a){b.Component.call(this,a)};c.minigames.cartGame.ResetTimerTrigger.__name__=["game","minigames","cartGame","ResetTimerTrigger"];c.minigames.cartGame.ResetTimerTrigger.__super__=b.Component;c.minigames.cartGame.ResetTimerTrigger.prototype=r(b.Component.prototype,{onEnter:function(){c.minigames.cartGame.levelGenerator.LevelGenerator.getInstance().resetTimer()},
onExit:function(){},__class__:c.minigames.cartGame.ResetTimerTrigger});c.minigames.cartGame.character={};c.minigames.cartGame.character.AiController=function(a){b.Component.call(this,a)};c.minigames.cartGame.character.AiController.__name__=["game","minigames","cartGame","character","AiController"];c.minigames.cartGame.character.AiController.__super__=b.Component;c.minigames.cartGame.character.AiController.prototype=r(b.Component.prototype,{getCharacter:function(){null==this._character&&(this._character=
this.getEntity().getComponent(c.minigames.cartGame.character.Character));return this._character},getState:function(){return this._state},setState:function(a){if(null!=this._state)this._state.onExit();this._state=a;this._state.onEnter()},init:function(){b.Component.prototype.init.call(this);this._character=this.getEntity().getComponent(c.minigames.cartGame.character.Character)},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);if(null!=this._state)this._state.onUpdate()},__class__:c.minigames.cartGame.character.AiController});
c.minigames.cartGame.character.Character=function(a){this._highCollisionCheckEnabled=!0;this._hasLandedFromFlightOnce=!1;this._prevMetersTravelled=0;this._dead=!1;this._inputEnabled=!0;this._footstepsMuted=!1;this._characterControlMode=c.minigames.cartGame.character.CharacterControlMode.Simple;this._direction=c.minigames.cartGame.character.CharacterDirection.Right;b.Component.call(this,a);this._characterProperties=new c.minigames.cartGame.character.CharacterProperties;this._statusStates=[]};c.minigames.cartGame.character.Character.__name__=
["game","minigames","cartGame","character","Character"];c.minigames.cartGame.character.Character.__super__=b.Component;c.minigames.cartGame.character.Character.prototype=r(b.Component.prototype,{getHighCollisionCheckEnabled:function(){return this._highCollisionCheckEnabled},setHighCollisionCheckEnabled:function(a){this._highCollisionCheckEnabled=a},getHasLandedFromFlightOnce:function(){return this._hasLandedFromFlightOnce},setHasLandedFromFlightOnce:function(a){this._hasLandedFromFlightOnce=a},setDead:function(a){(this._dead=
a)&&this.dispatchEvent(new c.minigames.cartGame.character.CharacterEvent("die"))},getDead:function(){return this._dead},getFootstepsMuted:function(){return this._footstepsMuted},setFootstepsMuted:function(a){this._footstepsMuted=a},getInputEnabled:function(){return this._inputEnabled},setInputEnabled:function(a){this._inputEnabled=a},getDamageState:function(){return this._damageState},setDamageState:function(a){this._damageState=a},getDirection:function(){return this._direction},setDirection:function(a){this._direction=
a;if(null!=this._pixiAnimation)switch(this._direction[1]){case 0:0<this.getDownVector().y?this._pixiAnimation.setScaleModifier(new b.Vector2D(-1,1)):this._pixiAnimation.setScaleModifier(new b.Vector2D(1,1));break;case 1:0<this.getDownVector().y?this._pixiAnimation.setScaleModifier(new b.Vector2D(1,1)):this._pixiAnimation.setScaleModifier(new b.Vector2D(-1,1))}},getCharacterProperties:function(){return this._characterProperties},setCharacterProperties:function(a){this._characterProperties=a},getGroundSensor:function(){return this._groundSensor},
setGroundSensor:function(a){this._groundSensor=a},getCollisionState:function(){return this._collisionState},setCollisionState:function(a){if(null!=this._collisionState)this._collisionState.onExit();this._collisionState=a;this._collisionState.onEnter()},getAbilityState:function(){return this._abilityState},setAbilityState:function(a){if(null!=this._abilityState)this._abilityState.onExit();this._abilityState=a;this._abilityState.onEnter()},getCharacterAnimationController:function(){null==this._characterAnimationController&&
(this._characterAnimationController=this.getEntity().getComponent(c.minigames.cartGame.character.CharacterAnimationController));return this._characterAnimationController},getState:function(){return this._state},setState:function(a){if(null!=this._state)this._state.onExit();this._state=a;this._state.onEnter()},getPosition:function(){return this.getEntity().getPosition()},setPosition:function(a,b){switch(this._characterControlMode[1]){case 1:this._box2dBody.setPixelPosition(a,b);break;case 0:this.getEntity().setPosition(a,
b)}},getRotation:function(){return this.getEntity().getRotation().z},setRotation:function(a){switch(this._characterControlMode[1]){case 1:this._box2dBody.getB2Body().setAngle(b.utilities.Math2.degToRad(a));break;case 0:this.getEntity().setRotation(0,0,a)}},getLocalVelocity:function(){return b.utilities.Math2.getRotated2dVector(this.getVelocity(),b.utilities.Math2.radToDeg(this.getEntity().getRotation().z))},setLocalVelocity:function(a){a=b.utilities.Math2.getRotated2dVector(a,b.utilities.Math2.radToDeg(this.getEntity().getRotation().z));
this.setVelocity(a)},getVelocity:function(){switch(this._characterControlMode[1]){case 1:if(null==this._box2dBody)break;var a=this._box2dBody.getB2Body().getLinearVelocity();return new b.Vector2D(a.x/b.box2d.Box2dManager.getInstance().getPhysicsScale(),a.y/b.box2d.Box2dManager.getInstance().getPhysicsScale());case 0:return null==this._simpleMovement&&(this._simpleMovement=this.getSiblingComponent(b.components.SimpleMovement)),new b.Vector2D(this._simpleMovement.getVelocityX(),this._simpleMovement.getVelocityY())}return new b.Vector2D(0,
0)},setVelocity:function(a){switch(this._characterControlMode[1]){case 1:if(null==this._box2dBody)break;this._box2dBody.getB2Body().setLinearVelocity(new d.common.math.B2Vec2(a.x*b.box2d.Box2dManager.getInstance().getPhysicsScale(),a.y*b.box2d.Box2dManager.getInstance().getPhysicsScale()));break;case 0:null!=this._simpleMovement&&this._simpleMovement.setVelocity(a.x,a.y)}},getCharacterControlMode:function(){return this._characterControlMode},setCharacterControlMode:function(a){var c=this.getVelocity();
this._characterControlMode=a;null==this._box2dBody&&(this._box2dBody=this.getEntity().getComponent(b.box2d.Box2dBody));null==this._simpleMovement&&(this._simpleMovement=this.getEntity().getComponent(b.components.SimpleMovement));switch(a[1]){case 1:this._box2dBody.setIsActive(!0);this._simpleMovement.setIsActive(!1);break;case 0:this._box2dBody.setIsActive(!1),this._simpleMovement.setIsActive(!0)}this.setVelocity(c)},init:function(){b.Component.prototype.init.call(this);this._box2dBody=this.getEntity().getComponent(b.box2d.Box2dBody);
this._simpleMovement=this.getEntity().getComponent(b.components.SimpleMovement);this._pixiAnimation=this.getEntity().getComponent(b.pixi.PixiAnimation);this._characterAnimationController=this.getEntity().getComponent(c.minigames.cartGame.character.CharacterAnimationController);this.setCharacterControlMode(c.minigames.cartGame.character.CharacterControlMode.Simple);this.setCollisionState(new c.minigames.cartGame.character.collisionStates.RegularCollisionState(this));null==this._state&&this.setState(new c.minigames.cartGame.character.characterStates.ParkedState(this));
new b.components.TriggerActivator(this.getEntity(),"trigger aura exit grabPoint alert hostile trigger".split(" "),new b.Vector2D(0,-this.getCharacterProperties().height/2));this._tweener=new b.components.Tweener(this.getEntity());this.clampToGround(1E3)},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);if(null!=this._state)this._state.onUpdate();if(null!=this._abilityState)this._abilityState.onUpdate();if(null!=this._damageState)this._damageState.onUpdate();if(null!=this._collisionState)this._collisionState.onUpdate();
0<this._characterProperties.slowdown&&(this._characterProperties.slowdown-=this._characterProperties.slowdownDecay*b.Root.getDeltaTime(),0>this._characterProperties.slowdown&&(this._characterProperties.slowdown=0));var a=c.minigames.cartGame.CartGame.getInstance().getDistanceTraveled();if(a>this._characterProperties.metersUntilSpeedIncrease){var d=(a-this._characterProperties.metersUntilSpeedIncrease)*this._characterProperties.speedIncreasePerMeter;this._characterProperties.flySpeed=Math.min(this._characterProperties.baseFlySpeed+
d,this._characterProperties.maxFlySpeed);this._characterProperties.movementSpeed=Math.min(this._characterProperties.baseMovementSpeed+d,this._characterProperties.maxFlySpeed)}this._prevMetersTravelled=a;for(a=this._statusStates.length;0<=--a;)this._statusStates[a].onUpdate();this.getTouchingGround()},getTouchingWall:function(){var a=new b.RaycastInfo,d=new b.RaycastInfo,e=this.getEntity().getPosition(),f=Math.max(this._characterProperties.height/2,35);this._highCollisionCheckEnabled||(f*=0.5);c.minigames.cartGame.CartGame.getInstance().isFlying()?
b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(e.x,e.y+15),new b.Vector2D(e.x+45,e.y+15),a,!0,["hostile"]):b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(e.x,e.y-f),new b.Vector2D(e.x+45,e.y-f),a,!0,["hostile"]);1<this._characterProperties.height&&(c.minigames.cartGame.CartGame.getInstance().isFlying()?b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(e.x,e.y+15-0.35*f),new b.Vector2D(e.x,e.y+15+0.35*f),d,!0,["hostile"]):b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(e.x,
e.y-0.33*f),new b.Vector2D(e.x,e.y-0.9*f),d,!0,["hostile"]));return null!=a.collider||null!=d.collider},getTouchingGround:function(){return null!=this.getGroundContact().collisionPoint},getGroundContact:function(){var a=new b.RaycastInfo,c=this.getEntity().getPosition(),d=b.utilities.Math2.getRotated2dVector(new b.Vector2D(0,-32.5),this.getEntity().getRotation().z),f=b.utilities.Math2.getRotated2dVector(new b.Vector2D(0,32.5),this.getEntity().getRotation().z);new b.Vector2D(f.x-d.x,f.y-d.y);b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(c.x+
d.x,c.y+d.y),new b.Vector2D(c.x+f.x,c.y+f.y),a,!0,["ground"]);null==a.collider&&(a=new b.RaycastInfo,c=this.getEntity().getPosition(),d=new b.Vector2D(0,-32.5),f=new b.Vector2D(0,32.5),new b.Vector2D(f.x-d.x,f.y-d.y),b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(c.x+d.x,c.y+d.y),new b.Vector2D(c.x+f.x,c.y+f.y),a,!0,["ground"]));return a},inflictDamage:function(a){if(!c.minigames.cartGame.CartGame.getInstance().getGameOver())this._damageState.onHit(a)},rotateAgainstGravity:function(){var a=
this.getDownVector();this._box2dBody.getB2Body().setAngle(b.utilities.Math2.degToRad(b.utilities.Math2.getAngleInDegreesBetween2dVectors(new b.Vector2D(0,-1),new b.Vector2D(a.x,-a.y))))},getDownVector:function(){return b.utilities.Math2.getRotated2dVector(new b.Vector2D(0,1),this.getEntity().getRotation().z)},clampToGround:function(a){var c=new b.RaycastInfo,d=this.getEntity().getPosition(),f=b.utilities.Math2.getRotated2dVector(new b.Vector2D(0,0),this.getEntity().getRotation().z);a=b.utilities.Math2.getRotated2dVector(new b.Vector2D(0,
a),this.getEntity().getRotation().z);new b.Vector2D(a.x-f.x,a.y-f.y);b.managers.PhysicsManager.getInstance().getRaycastPoint(new b.Vector2D(d.x+f.x,d.y+f.y),new b.Vector2D(d.x+a.x,d.y+a.y),c,!0,["ground"]);null!=c&&this.getEntity().setPosition(c.collisionPoint.x,c.collisionPoint.y)},addStatusState:function(a){for(var b=this._statusStates.length,c=0;c<b;){var d=c++;if(G.getClass(a)==G.getClass(this._statusStates[d]))return}this._statusStates.push(a);a.onActivate()},removeStatusState:function(a){v.remove(this._statusStates,
a);a.onDeactivate()},removeAllStatusEffects:function(){for(;0<this._statusStates.length;)this.removeStatusState(this._statusStates[0])},desireDirection:function(a){if(this._inputEnabled&&null!=this._state)this._state.onDesireDirection(a)},desireAction:function(a){if(this._inputEnabled&&null!=this._state)this._state.onDesireAction(a)},destroy:function(){b.Component.prototype.destroy.call(this);null!=this._state&&(this._state.onExit(),this._state=null)},__class__:c.minigames.cartGame.character.Character});
c.minigames.cartGame.character.CharacterAnimationController=function(a,c){null==c&&(c="");this._animationPrefix="";b.Component.call(this,a);this._animationPrefix=c;this._animationQueue=[]};c.minigames.cartGame.character.CharacterAnimationController.__name__=["game","minigames","cartGame","character","CharacterAnimationController"];c.minigames.cartGame.character.CharacterAnimationController.__super__=b.Component;c.minigames.cartGame.character.CharacterAnimationController.prototype=r(b.Component.prototype,
{getCurrentAnimationName:function(){return this._currentAnimationName},init:function(){b.Component.prototype.init.call(this)},playAnimation:function(a,c,d,f){null==d&&(d=!1);if(null==this._pixiAnimation&&(this._pixiAnimation=this.getEntity().getComponent(b.pixi.PixiAnimation),null==this._pixiAnimation))return;f=this._animationPrefix+a;null!=b.managers.AnimationManager.getInstance().getAnimationByName(f)&&(this._pixiAnimation.setAnimation(f,c,d),this._currentAnimationName=a)},resetAnimationQueue:function(){this._animationQueue=
[]},addAnimationToQueue:function(a,b){var d=new c.minigames.cartGame.character.CharacterAnimationQueueData(a,b),f=this._animationQueue.length;this._animationQueue.push(d);0==f&&this.playNextAnimationInQueue()},playNextAnimationInQueue:function(){var a=this;if(0<this._animationQueue.length){var b=this._animationQueue[0];this.playAnimation(b.animationName,function(c){return function(){a._animationQueue.splice(0,1);if(null!=b.onComplete)b.onComplete();a.playNextAnimationInQueue()}}(this),!0,!1)}},stop:function(){this._pixiAnimation.stop()},
play:function(){this._pixiAnimation.play()},__class__:c.minigames.cartGame.character.CharacterAnimationController});c.minigames.cartGame.character.CharacterAnimationQueueData=function(a,b){this.animationName=a;this.onComplete=b};c.minigames.cartGame.character.CharacterAnimationQueueData.__name__=["game","minigames","cartGame","character","CharacterAnimationQueueData"];c.minigames.cartGame.character.CharacterAnimationQueueData.prototype={__class__:c.minigames.cartGame.character.CharacterAnimationQueueData};
c.minigames.cartGame.character.CharacterControlMode={__ename__:!0,__constructs__:["Simple","Box2d"]};c.minigames.cartGame.character.CharacterControlMode.Simple=["Simple",0];c.minigames.cartGame.character.CharacterControlMode.Simple.toString=D;c.minigames.cartGame.character.CharacterControlMode.Simple.__enum__=c.minigames.cartGame.character.CharacterControlMode;c.minigames.cartGame.character.CharacterControlMode.Box2d=["Box2d",1];c.minigames.cartGame.character.CharacterControlMode.Box2d.toString=D;
c.minigames.cartGame.character.CharacterControlMode.Box2d.__enum__=c.minigames.cartGame.character.CharacterControlMode;c.minigames.cartGame.character.CharacterControlMode.__empty_constructs__=[c.minigames.cartGame.character.CharacterControlMode.Simple,c.minigames.cartGame.character.CharacterControlMode.Box2d];c.minigames.cartGame.character.CharacterDirection={__ename__:!0,__constructs__:["Left","Right"]};c.minigames.cartGame.character.CharacterDirection.Left=["Left",0];c.minigames.cartGame.character.CharacterDirection.Left.toString=
D;c.minigames.cartGame.character.CharacterDirection.Left.__enum__=c.minigames.cartGame.character.CharacterDirection;c.minigames.cartGame.character.CharacterDirection.Right=["Right",1];c.minigames.cartGame.character.CharacterDirection.Right.toString=D;c.minigames.cartGame.character.CharacterDirection.Right.__enum__=c.minigames.cartGame.character.CharacterDirection;c.minigames.cartGame.character.CharacterDirection.__empty_constructs__=[c.minigames.cartGame.character.CharacterDirection.Left,c.minigames.cartGame.character.CharacterDirection.Right];
c.minigames.cartGame.character.CharacterEvent=function(a){b.events.Event.call(this,a)};c.minigames.cartGame.character.CharacterEvent.__name__=["game","minigames","cartGame","character","CharacterEvent"];c.minigames.cartGame.character.CharacterEvent.__super__=b.events.Event;c.minigames.cartGame.character.CharacterEvent.prototype=r(b.events.Event.prototype,{__class__:c.minigames.cartGame.character.CharacterEvent});c.minigames.cartGame.character.CharacterProperties=function(){this.baseScale=1;this.maxFallSpeed=
825;this.hitPoints=this.maxHitPoints=1;this.movementFlipped=!1;this.height=150;this.slowdownDecay=0.15;this.slowdown=0;this.dropThroughVelocity=100;this.jumpPower=825;this.climbSpeed=250;this.climbDismountYVelocity=-150;this.directionChangeSpeed=100;this.deccelerationSpeed=1500;this.accelerationSpeed=1200;this.speedIncreasePerMeter=this.metersUntilSpeedIncrease=0;this.transitionSpeed=1E3;this.laneChangeAcceleration=3E3;this.maxFlyLaneChangeSpeed=600;this.minFlyLaneChangeSpeed=0;this.baseFlySpeed=
this.flySpeed=this.maxFlySpeed=600;this.boost=this.boostDeccelearation=0;this.movementSpeedModifier=this.slopeDownMovementSpeedModifier=this.slopeUpMovementSpeedModifier=1;this.baseMovementSpeed=this.movementSpeed=this.maxMovementSpeed=800};c.minigames.cartGame.character.CharacterProperties.__name__=["game","minigames","cartGame","character","CharacterProperties"];c.minigames.cartGame.character.CharacterProperties.prototype={__class__:c.minigames.cartGame.character.CharacterProperties};c.minigames.cartGame.character.DamagePlayerOnContact=
function(a){this._playersTouching=[];b.Component.call(this,a)};c.minigames.cartGame.character.DamagePlayerOnContact.__name__=["game","minigames","cartGame","character","DamagePlayerOnContact"];c.minigames.cartGame.character.DamagePlayerOnContact.__super__=b.Component;c.minigames.cartGame.character.DamagePlayerOnContact.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.getEntity().addEventListener("beginContact",s(this,this.onBeginContact));this.getEntity().addEventListener("endContact",
s(this,this.onEndContact))},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);for(var a=this._playersTouching.length,d=0;d<a;){var e=d++,e=this._playersTouching[e].getComponent(c.minigames.cartGame.character.Character),f=new c.minigames.cartGame.character.DamageProperties;f.attacker=this.getEntity();f.damage=1;e.getDamageState().onHit(f);this.getEntity().destroy()}},onBeginContact:function(a){var b=a.getData().contact;a=b.getFixtureA().getBody().getUserData().entity;b=b.getFixtureB().getBody().getUserData().entity;
a=a==this.getEntity()?b:a;null!=a.getComponent(c.minigames.cartGame.character.PlayerController)&&this._playersTouching.push(a)},onEndContact:function(a){var b=a.getData().contact;a=b.getFixtureA().getBody().getUserData().entity;b=b.getFixtureB().getBody().getUserData().entity;v.remove(this._playersTouching,a);v.remove(this._playersTouching,b)},onEnter:function(a){null!=a.getComponent(c.minigames.cartGame.character.PlayerController)&&this._playersTouching.push(a)},onExit:function(a){v.remove(this._playersTouching,
a)},__class__:c.minigames.cartGame.character.DamagePlayerOnContact});c.minigames.cartGame.character.DamageProperties=function(){this.instantDeath=!1;this.damage=10};c.minigames.cartGame.character.DamageProperties.__name__=["game","minigames","cartGame","character","DamageProperties"];c.minigames.cartGame.character.DamageProperties.prototype={__class__:c.minigames.cartGame.character.DamageProperties};c.minigames.cartGame.character.ItemCollector=function(a,c){this._magnetEnabled=!0;this._minCollectionRange=
35;this._collectionRange=0;b.Component.call(this,a);this._collectionRange=c;this._magnetizedCoins=[];this.setMagnetPullParams(t.parseFloat(b.GameConfig.getProperty("game.minPullPower")),t.parseFloat(b.GameConfig.getProperty("game.maxPullPower")),t.parseFloat(b.GameConfig.getProperty("game.pullRange")));this._maxPowerupPullRange=t.parseFloat(b.GameConfig.getProperty("game.maxPowerupPullRange"))};c.minigames.cartGame.character.ItemCollector.__name__=["game","minigames","cartGame","character","ItemCollector"];
c.minigames.cartGame.character.ItemCollector.__super__=b.Component;c.minigames.cartGame.character.ItemCollector.prototype=r(b.Component.prototype,{setMagnetEnabled:function(a){this._magnetEnabled=a},setMagnetPullParams:function(a,b,c){this._magnetMinPullPower=a;this._magnetMaxPullPower=b;this._magnetPullRange=c},update:function(){b.Component.prototype.update.call(this);for(var a=this.getEntity().getComponent(c.minigames.cartGame.character.Character),d=this.getEntity().getPosition().add(new b.Vector3D(0,
-a.getCharacterProperties().height/2)),e=c.minigames.cartGame.CartGame.getInstance().getItems().length;0<=--e;){var f=c.minigames.cartGame.CartGame.getInstance().getItems()[e],n=f.getPosition(),n=(new b.Vector3D(n.x-d.x,n.y-d.y)).getLength();n<this._magnetPullRange&&this._magnetEnabled&&(null!=f.getComponent(c.minigames.cartGame.item.Coin)&&-1==v.indexOf(this._magnetizedCoins,f,0)?(this._magnetizedCoins.push(f),new c.minigames.cartGame.item.CollectAfterTime(f,a,0.25)):-1==v.indexOf(this._magnetizedCoins,
f,0)&&n<this._maxPowerupPullRange&&this._magnetizedCoins.push(f));if(n<Math.max(this._minCollectionRange,this._collectionRange*this.getEntity().getScale().x)){var n=this.getSiblingComponent(c.minigames.cartGame.character.Character),g=f.getComponent(c.minigames.cartGame.item.Item),h=g.getSiblingComponent(c.minigames.cartGame.item.CollectAfterTime);null!=h&&h.destroy();g.onCollect(n);-1!=v.indexOf(this._magnetizedCoins,f,0)&&v.remove(this._magnetizedCoins,f)}}a=this._magnetizedCoins.length;for(e=0;e<
a;)f=e++,f=this._magnetizedCoins[f],n=f.getPosition(),n=new b.Vector3D(d.x-n.x,d.y-n.y),g=1-n.getLength()/this._magnetPullRange,g=Math.max(this._magnetMinPullPower,this._magnetMinPullPower+(this._magnetMaxPullPower-this._magnetMinPullPower)*g),n=n.getNormalized(),n.x*=g,n.y*=g,f.translate(n.x*b.Root.getDeltaTime(),n.y*b.Root.getDeltaTime())},__class__:c.minigames.cartGame.character.ItemCollector});c.minigames.cartGame.character.PlayerController=function(a){this._swipeUpToJump=!1;b.Component.call(this,
a)};c.minigames.cartGame.character.PlayerController.__name__=["game","minigames","cartGame","character","PlayerController"];c.minigames.cartGame.character.PlayerController.__super__=b.Component;c.minigames.cartGame.character.PlayerController.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._swipeDetector=new b.swipeDetector.DefaultSwipeDetector(this.getEntity());this._character=this.getEntity().getComponent(c.minigames.cartGame.character.Character);this._keyDown=
t.parseInt(b.GameConfig.getProperty("keyDown"));this._keyLeft=t.parseInt(b.GameConfig.getProperty("keyLeft"));this._keyRight=t.parseInt(b.GameConfig.getProperty("keyRight"));this._keyUp=t.parseInt(b.GameConfig.getProperty("keyUp"));this._keySpace=t.parseInt(b.GameConfig.getProperty("keySpace"));this._swipeUpToJump="1"==b.GameConfig.getProperty("swipeUpToJump");this._swipeDetector.addEventListener("",s(this,this.onSwipeCombo))},onSwipeCombo:function(a){a=a.combo[a.combo.length-1];"swipeUp"==a&&(this._character.desireAction(0),
this._character.desireDirection(new b.Vector2D(0,-1)));"swipeDown"==a&&(this._character.desireDirection(new b.Vector2D(0,1)),this._character.desireAction(2))},fixedUpdate:function(){b.Component.prototype.update.call(this);var a=new b.Vector2D;b.managers.InputManager.getInstance().isKeyDown(this._keyLeft)?a.x=-1:b.managers.InputManager.getInstance().isKeyDown(this._keyRight)&&(a.x=1);b.managers.InputManager.getInstance().isKeyDown(this._keyUp)?a.y=-1:b.managers.InputManager.getInstance().isKeyDown(this._keyDown)&&
(a.y=1);this._character.getCharacterProperties().movementFlipped&&(a.x*=-1);this._character.desireDirection(a);b.managers.InputManager.getInstance().isKeyPressed(this._keyUp)&&this._character.desireAction(0);b.managers.InputManager.getInstance().isKeyPressed(this._keySpace)&&this._character.desireAction(3);b.managers.InputManager.getInstance().isKeyPressed(this._keyDown)&&this._character.desireAction(2)},__class__:c.minigames.cartGame.character.PlayerController});c.minigames.cartGame.character.Tags=
function(){};c.minigames.cartGame.character.Tags.__name__=["game","minigames","cartGame","character","Tags"];c.minigames.cartGame.character.abilityStates={};c.minigames.cartGame.character.abilityStates.AbilityState=function(a,b){this._cooldown=this._cooldownDuration=0;this._character=a};c.minigames.cartGame.character.abilityStates.AbilityState.__name__="game minigames cartGame character abilityStates AbilityState".split(" ");c.minigames.cartGame.character.abilityStates.AbilityState.prototype={onEnter:function(){},
onUpdate:function(){if(0<this._cooldown&&(this._cooldown-=b.Root.getDeltaTime(),0>=this._cooldown))this.onCooldownElapse()},onExit:function(){},onDesireUse:function(){},onDesireUseFlying:function(){},use:function(){},useFlying:function(){},getCooldownPercent:function(){return this._cooldown/this._cooldownDuration},getReady:function(){return 0>=this._cooldown},onCooldownElapse:function(){},__class__:c.minigames.cartGame.character.abilityStates.AbilityState};c.minigames.cartGame.character.aiStates=
{};c.minigames.cartGame.character.aiStates.AiState=function(a){this._aiController=a};c.minigames.cartGame.character.aiStates.AiState.__name__="game minigames cartGame character aiStates AiState".split(" ");c.minigames.cartGame.character.aiStates.AiState.prototype={onEnter:function(){},onUpdate:function(){},onExit:function(){},__class__:c.minigames.cartGame.character.aiStates.AiState};c.minigames.cartGame.character.aiStates.ChaseState=function(a,d,e){this._giveUpChaseAtDistance=300;c.minigames.cartGame.character.aiStates.AiState.call(this,
a);this._target=d;this._giveUpChaseState=e;this._targetBody=this._target.getComponent(b.box2d.Box2dBody).getB2Body()};c.minigames.cartGame.character.aiStates.ChaseState.__name__="game minigames cartGame character aiStates ChaseState".split(" ");c.minigames.cartGame.character.aiStates.ChaseState.__super__=c.minigames.cartGame.character.aiStates.AiState;c.minigames.cartGame.character.aiStates.ChaseState.prototype=r(c.minigames.cartGame.character.aiStates.AiState.prototype,{onEnter:function(){c.minigames.cartGame.character.aiStates.AiState.prototype.onEnter.call(this)},
onUpdate:function(){c.minigames.cartGame.character.aiStates.AiState.prototype.onUpdate.call(this);var a=this._target.getPosition(),l=this._aiController.getEntity().getPosition();if(Math.abs(a.x-l.x)>this._giveUpChaseAtDistance)this._aiController.setState(this._giveUpChaseState);else{a.x<l.x?this._aiController.getCharacter().desireDirection(new b.Vector2D(-1,0)):this._aiController.getCharacter().desireDirection(new b.Vector2D(1,0));var e=!1,f;f=this._aiController.getCharacter().getDirection()==c.minigames.cartGame.character.CharacterDirection.Left?
-50:50;a=b.box2d.Box2dRaycastUtil.raycastClosestPixel(new b.Vector2D(l.x+f,l.y),new b.Vector2D(a.x,a.y));null!=a&&(a=a.fixture.getBody().getUserData().entity,null!=a&&a==this._target&&null!=a.getComponent(b.box2d.Box2dBody)&&(e=!0));var a=!1,n=c.minigames.cartGame.CartGame.getInstance().getCollisionBodies().length;f=this._aiController.getCharacter().getDirection()==c.minigames.cartGame.character.CharacterDirection.Left?-150:150;var g=b.box2d.Box2dManager.getInstance().getPixelToWorld(l.x+f,l.y-25),
l=b.box2d.Box2dManager.getInstance().getPixelToWorld(l.x+f,l.y+50);for(f=0;f<n;){var h=f++,k=c.minigames.cartGame.CartGame.getInstance().getCollisionBodies()[h],h=new d.collision.B2RayCastInput(g,l,1),m=new d.collision.B2RayCastOutput,k=k.getB2Body().getFixtureList();if(null!=k&&(k.rayCast(m,h),0<m.fraction)){a=!0;break}}a||this._aiController.setState(this._giveUpChaseState);e||this._aiController.setState(this._giveUpChaseState)}},losRaycastCallback:function(a,b,c,d){return d},onExit:function(){c.minigames.cartGame.character.aiStates.AiState.prototype.onExit.call(this)},
__class__:c.minigames.cartGame.character.aiStates.ChaseState});c.minigames.cartGame.character.aiStates.PatrolPathState=function(a,d){this._timePerRaycast=this._timeUntilNextRaycast=0.35;this._desiredXDistance=20;this._pointIndex=this._waitDuration=0;this._waitTimePerPoint=0.1;c.minigames.cartGame.character.aiStates.AiState.call(this,a);this._patrolPath=d;this._timePerRaycast=b.utilities.Math2.randomFloat(0,this._timeUntilNextRaycast)};c.minigames.cartGame.character.aiStates.PatrolPathState.__name__=
"game minigames cartGame character aiStates PatrolPathState".split(" ");c.minigames.cartGame.character.aiStates.PatrolPathState.__super__=c.minigames.cartGame.character.aiStates.AiState;c.minigames.cartGame.character.aiStates.PatrolPathState.prototype=r(c.minigames.cartGame.character.aiStates.AiState.prototype,{onEnter:function(){c.minigames.cartGame.character.aiStates.AiState.prototype.onEnter.call(this);this._aiController.getCharacter().getCharacterProperties().movementSpeedModifier=0.5},onUpdate:function(){c.minigames.cartGame.character.aiStates.AiState.prototype.onUpdate.call(this);
var a=this._aiController.getEntity().getPosition();if(0>=this._waitDuration){var d=this._patrolPath[this._pointIndex],e=new b.Vector2D(d.x-a.x,0),d=d.x<a.x;Math.abs(e.getLength())<this._desiredXDistance?(this._waitDuration=this._waitTimePerPoint,this._pointIndex++,this._pointIndex>=this._patrolPath.length&&(this._pointIndex=0)):d?this._aiController.getCharacter().desireDirection(new b.Vector2D(-1,0)):this._aiController.getCharacter().desireDirection(new b.Vector2D(1,0))}else this._waitDuration-=b.Root.getDeltaTime(),
0>=this._waitDuration&&(this._waitDuration=0);this._timeUntilNextRaycast-=b.Root.getDeltaTime();0>=this._timeUntilNextRaycast&&(e=this._aiController.getCharacter().getDirection()==c.minigames.cartGame.character.CharacterDirection.Left?-200:200,d=this._aiController.getCharacter().getDirection()==c.minigames.cartGame.character.CharacterDirection.Left?-50:50,a=b.box2d.Box2dRaycastUtil.raycastClosestPixel(new b.Vector2D(a.x+d,a.y),new b.Vector2D(a.x+e,a.y)),null!=a&&(a=a.fixture.getBody().getUserData().entity,
null!=a&&(e=a.getComponent(b.box2d.Box2dBody),d=a.getComponent(c.minigames.cartGame.character.PlayerController),null!=e&&null!=d&&this._aiController.setState(new c.minigames.cartGame.character.aiStates.ChaseState(this._aiController,a,this)))),this._timeUntilNextRaycast=this._timePerRaycast)},onExit:function(){c.minigames.cartGame.character.aiStates.AiState.prototype.onExit.call(this);this._aiController.getCharacter().getCharacterProperties().movementSpeedModifier=1},__class__:c.minigames.cartGame.character.aiStates.PatrolPathState});
c.minigames.cartGame.character.characterStates={};c.minigames.cartGame.character.characterStates.CharacterState=function(a){this._character=a};c.minigames.cartGame.character.characterStates.CharacterState.__name__="game minigames cartGame character characterStates CharacterState".split(" ");c.minigames.cartGame.character.characterStates.CharacterState.prototype={onEnter:function(){},onUpdate:function(){},onExit:function(){},onDesireDirection:function(a){},onDesireAction:function(a){},applyFriction:function(){var a=
this._character.getVelocity();0<a.x?(a.x-=this._character.getCharacterProperties().deccelerationSpeed*b.Root.getDeltaTime(),0>a.x&&(a.x=0)):0>a.x&&(a.x+=this._character.getCharacterProperties().deccelerationSpeed*b.Root.getDeltaTime(),0<a.x&&(a.x=0));this._character.setVelocity(a)},__class__:c.minigames.cartGame.character.characterStates.CharacterState};c.minigames.cartGame.character.characterStates.AerialState=function(a){this._movedThisFrame=!1;c.minigames.cartGame.character.characterStates.CharacterState.call(this,
a);this._gravity=b.GameConfig.getProperty("box2d.gravityY")};c.minigames.cartGame.character.characterStates.AerialState.__name__="game minigames cartGame character characterStates AerialState".split(" ");c.minigames.cartGame.character.characterStates.AerialState.__super__=c.minigames.cartGame.character.characterStates.CharacterState;c.minigames.cartGame.character.characterStates.AerialState.prototype=r(c.minigames.cartGame.character.characterStates.CharacterState.prototype,{onUpdate:function(){if(this._character.getTouchingWall())this.onHitWall();
else{c.minigames.cartGame.character.characterStates.CharacterState.prototype.onUpdate.call(this);var a=this._character.getGroundContact();if(this._character.getTouchingGround()&&!this._character.getDead()){var d=(new b.Vector2D(this._character.getVelocity().x,this._character.getVelocity().y)).getNormalized().dotProduct(a.normal);b.utilities.Math2.getAngleInDegreesBetween2dVectors(new b.Vector2D(0,-1),a.normal.getNormalized());0.5>d&&(this.onLand(),this._character.setState(new c.minigames.cartGame.character.characterStates.RidingState(this._character)))}this._character.getVelocity().y>
this._character.getCharacterProperties().maxFallSpeed&&this._character.setVelocity(new b.Vector2D(this._character.getVelocity().x,this._character.getCharacterProperties().maxFallSpeed))}},applyGravity:function(){this._character.setVelocity(new b.Vector2D(this._character.getVelocity().x,this._character.getVelocity().y+this._gravity*b.box2d.Box2dManager.getInstance().getInversePhysicsScale()*b.Root.getDeltaTime()))},onDesireDirection:function(a){c.minigames.cartGame.character.characterStates.CharacterState.prototype.onDesireDirection.call(this,
a)},onHitWall:function(){var a=new c.minigames.cartGame.character.DamageProperties;a.damage=1;this._character.inflictDamage(a)},onLand:function(){b.utilities.Debug.log("AerialState::onLand()")},__class__:c.minigames.cartGame.character.characterStates.AerialState});c.minigames.cartGame.character.characterStates.GroundFailState=function(a){c.minigames.cartGame.character.characterStates.AerialState.call(this,a)};c.minigames.cartGame.character.characterStates.GroundFailState.__name__="game minigames cartGame character characterStates GroundFailState".split(" ");
c.minigames.cartGame.character.characterStates.GroundFailState.__super__=c.minigames.cartGame.character.characterStates.AerialState;c.minigames.cartGame.character.characterStates.GroundFailState.prototype=r(c.minigames.cartGame.character.characterStates.AerialState.prototype,{onEnter:function(){this._character.getCharacterAnimationController().resetAnimationQueue();this._character.getCharacterAnimationController().playAnimation("GroundFail",s(this,this.onFailAnimationComplete));this._character.setVelocity(new b.Vector2D(0,
0));this._character.setDead(!0);c.minigames.cartGame.CartGame.getInstance().getSmartCamera().setState(new c.minigames.cartGame.smartCamera.cameraStates.IdleCameraState(c.minigames.cartGame.CartGame.getInstance().getSmartCamera()))},onUpdate:function(){this._character.getVelocity().y>this._character.getCharacterProperties().maxFallSpeed&&this._character.setVelocity(new b.Vector2D(this._character.getVelocity().x,this._character.getCharacterProperties().maxFallSpeed));this.applyGravity();var a=this._character.getGroundContact();
if(null!=a&&0<a.normal.getLength()){var c=a.normal;(new b.Vector2D(-c.y,c.x)).getNormalized();this._character.setPosition(a.collisionPoint.x,a.collisionPoint.y);a=b.utilities.Math2.getAngleInDegreesBetween2dVectors(new b.Vector2D(0,-1),c)-this._character.getRotation();this._character.setRotation(this._character.getRotation()+a)}},onFailAnimationComplete:function(){c.minigames.cartGame.CartGame.getInstance().failLevel()},__class__:c.minigames.cartGame.character.characterStates.GroundFailState});c.minigames.cartGame.character.characterStates.GroundedState=
function(a){c.minigames.cartGame.character.characterStates.CharacterState.call(this,a)};c.minigames.cartGame.character.characterStates.GroundedState.__name__="game minigames cartGame character characterStates GroundedState".split(" ");c.minigames.cartGame.character.characterStates.GroundedState.__super__=c.minigames.cartGame.character.characterStates.CharacterState;c.minigames.cartGame.character.characterStates.GroundedState.prototype=r(c.minigames.cartGame.character.characterStates.CharacterState.prototype,
{onUpdate:function(){c.minigames.cartGame.character.characterStates.CharacterState.prototype.onUpdate.call(this);if(this._character.getTouchingWall())this.onHitWall()},onHitWall:function(){var a=new c.minigames.cartGame.character.DamageProperties;a.damage=1;this._character.inflictDamage(a)},jump:function(){this._character.setState(new c.minigames.cartGame.character.characterStates.JumpStartState(this._character))},__class__:c.minigames.cartGame.character.characterStates.GroundedState});c.minigames.cartGame.character.characterStates.IdleState=
function(a){c.minigames.cartGame.character.characterStates.GroundedState.call(this,a)};c.minigames.cartGame.character.characterStates.IdleState.__name__="game minigames cartGame character characterStates IdleState".split(" ");c.minigames.cartGame.character.characterStates.IdleState.__super__=c.minigames.cartGame.character.characterStates.GroundedState;c.minigames.cartGame.character.characterStates.IdleState.prototype=r(c.minigames.cartGame.character.characterStates.GroundedState.prototype,{onEnter:function(){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onEnter.call(this);
0.1<this._character.getVelocity().y?(this._character.getCharacterAnimationController().resetAnimationQueue(),this._character.getCharacterAnimationController().addAnimationToQueue("JumpEnd"),this._character.getCharacterAnimationController().addAnimationToQueue("Idle")):5>Math.abs(this._character.getVelocity().x)?this._character.getCharacterAnimationController().playAnimation("Idle"):(this._character.getCharacterAnimationController().resetAnimationQueue(),this._character.getCharacterAnimationController().addAnimationToQueue("RunToIdle"),
this._character.getCharacterAnimationController().addAnimationToQueue("Idle"))},onUpdate:function(){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onUpdate.call(this);this.applyFriction();this._character.getTouchingGround()||this._character.setState(new c.minigames.cartGame.character.characterStates.JumpingState(this._character))},onDesireDirection:function(a){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onDesireDirection.call(this,a)},onDesireAction:function(a){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onDesireAction.call(this,
a);switch(a){case 0:this._character.getTouchingGround()&&this.jump();break;case 1:if(null!=this._character.getAbilityState())this._character.getAbilityState().onDesireUse()}},__class__:c.minigames.cartGame.character.characterStates.IdleState});c.minigames.cartGame.character.characterStates.InstantDeathState=function(a){this._endLevelDelay=0.5;c.minigames.cartGame.character.characterStates.AerialState.call(this,a)};c.minigames.cartGame.character.characterStates.InstantDeathState.__name__="game minigames cartGame character characterStates InstantDeathState".split(" ");
c.minigames.cartGame.character.characterStates.InstantDeathState.__super__=c.minigames.cartGame.character.characterStates.AerialState;c.minigames.cartGame.character.characterStates.InstantDeathState.prototype=r(c.minigames.cartGame.character.characterStates.AerialState.prototype,{onEnter:function(){c.minigames.cartGame.character.characterStates.AerialState.prototype.onEnter.call(this);b.utilities.Debug.log("InstantDeathState::onEnter()");this._character.setDead(!0);this._character.setDamageState(new c.minigames.cartGame.character.damageStates.InvincibleDamageState(this._character));
c.minigames.cartGame.CartGame.getInstance().getSmartCamera().getCamera().getTarget().getComponent(b.components.FollowEntity).setIsActive(!1);c.minigames.cartGame.CartGame.getInstance().getSmartCamera().setVerticalVibration(50,60,60)},onUpdate:function(){c.minigames.cartGame.character.characterStates.AerialState.prototype.onUpdate.call(this);this.applyGravity();if(0<this._endLevelDelay&&(this._endLevelDelay-=b.Root.getDeltaTime(),0>=this._endLevelDelay))this.onEndLevelDelayElapse()},onHitWall:function(){},
onExit:function(){c.minigames.cartGame.character.characterStates.AerialState.prototype.onExit.call(this);b.utilities.Debug.log("InstantDeathState::onExit()")},onEndLevelDelayElapse:function(){b.utilities.Debug.log("onEndLevelDelayElapse");c.minigames.cartGame.CartGame.getInstance().failLevel()},__class__:c.minigames.cartGame.character.characterStates.InstantDeathState});c.minigames.cartGame.character.characterStates.RidingState=function(a){this._doubleTapTime=this._currentSpeed=0;this._rotationSlack=
0.11;c.minigames.cartGame.character.characterStates.GroundedState.call(this,a);this._gravity=b.GameConfig.getProperty("cartGame.groundedGravity")};c.minigames.cartGame.character.characterStates.RidingState.__name__="game minigames cartGame character characterStates RidingState".split(" ");c.minigames.cartGame.character.characterStates.RidingState.__super__=c.minigames.cartGame.character.characterStates.GroundedState;c.minigames.cartGame.character.characterStates.RidingState.prototype=r(c.minigames.cartGame.character.characterStates.GroundedState.prototype,
{onEnter:function(){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onEnter.call(this);this._character.getVelocity();this._character.getCharacterAnimationController().addAnimationToQueue("Run");this._grindingEffect=this._character.getGameState().addEntity();this._grindingEffect.setPosition(0,0);new b.pixi.PixiAnimation(this._grindingEffect,"runningDust");this._character.getEntity().addChild(this._grindingEffect);var a=this._character.getGroundContact();null!=a&&null!=a.collisionPoint&&
this._character.setPosition(a.collisionPoint.x,a.collisionPoint.y);this._currentSpeed=Math.abs(this._character.getVelocity().x);this._sparks=this._character.getGameState().addEntity();this._sparks.setPosition(-50,0);new b.pixi.PixiAnimation(this._sparks,"cartSparks");this._character.getEntity().addChild(this._sparks)},onUpdate:function(){var a=this._character.getGroundContact();if(null!=a&&0<a.normal.getLength()){var d=a.normal,e=(new b.Vector2D(-d.y,d.x)).getNormalized(),e=new b.Vector2D(e.x*(this._currentSpeed+
this._character.getCharacterProperties().boost)*(1-this._character.getCharacterProperties().slowdown),e.y*(this._currentSpeed+this._character.getCharacterProperties().boost)*(1-this._character.getCharacterProperties().slowdown)),f=e.getNormalized().dotProduct(new b.Vector2D(0,1)),n=e.getNormalized().dotProduct(new b.Vector2D(0,-1)),g=0;0<n?g=n*this._character.getCharacterProperties().slopeUpMovementSpeedModifier:0<f&&(g=f*this._character.getCharacterProperties().slopeDownMovementSpeedModifier);this._currentSpeed>
this._character.getCharacterProperties().movementSpeed+this._character.getCharacterProperties().movementSpeed*g?this._currentSpeed-=this._character.getCharacterProperties().deccelerationSpeed*b.Root.getDeltaTime():this._currentSpeed+=this._character.getCharacterProperties().accelerationSpeed*b.Root.getDeltaTime();0<this._character.getCharacterProperties().boost?this._character.getCharacterProperties().boost-=this._character.getCharacterProperties().deccelerationSpeed*b.Root.getDeltaTime():this._character.getCharacterProperties().boost=
0;this._character.getDirection()==c.minigames.cartGame.character.CharacterDirection.Left?e.x*=-1:e.x*=1;this._character.setVelocity(e);this._character.setPosition(a.collisionPoint.x,a.collisionPoint.y);for(a=b.utilities.Math2.getAngleInDegreesBetween2dVectors(new b.Vector2D(0,-1),d)-this._character.getRotation();-180>a;)a+=360;for(;180<a;)a-=360;this._character.setRotation(this._character.getRotation()+a*this._rotationSlack);this._doubleTapTime-=b.Root.getDeltaTime();c.minigames.cartGame.character.characterStates.GroundedState.prototype.onUpdate.call(this)}else this._character.setState(new c.minigames.cartGame.character.characterStates.JumpingState(this._character))},
onExit:function(){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onExit.call(this);null!=this._grindingEffect&&this._grindingEffect.destroy();null!=this._sparks&&this._sparks.destroy()},onDesireAction:function(a){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onDesireAction.call(this,a);switch(a){case 0:0.35<this._character.getDownVector().y&&this._character.setState(new c.minigames.cartGame.character.characterStates.JumpStartState(this._character));
break;case 3:if(null!=this._character.getAbilityState())this._character.getAbilityState().onDesireUse()}},__class__:c.minigames.cartGame.character.characterStates.RidingState});c.minigames.cartGame.character.characterStates.JumpStartState=function(a){this._numFramesBeforeJump=5;c.minigames.cartGame.character.characterStates.RidingState.call(this,a)};c.minigames.cartGame.character.characterStates.JumpStartState.__name__="game minigames cartGame character characterStates JumpStartState".split(" ");
c.minigames.cartGame.character.characterStates.JumpStartState.__super__=c.minigames.cartGame.character.characterStates.RidingState;c.minigames.cartGame.character.characterStates.JumpStartState.prototype=r(c.minigames.cartGame.character.characterStates.RidingState.prototype,{onEnter:function(){c.minigames.cartGame.character.characterStates.RidingState.prototype.onEnter.call(this);this.onJump()},onExit:function(){c.minigames.cartGame.character.characterStates.RidingState.prototype.onExit.call(this)},
onJump:function(){var a=b.utilities.Math2.getRotated2dVector(new b.Vector2D(0,-1),this._character.getEntity().getRotation().z);a.x*=this._character.getCharacterProperties().jumpPower;a.y*=this._character.getCharacterProperties().jumpPower;a.x+=this._character.getVelocity().x;a.y+=this._character.getVelocity().y;a.x>this._character.getCharacterProperties().jumpPower&&(a.x=this._character.getCharacterProperties().jumpPower);a.y<-this._character.getCharacterProperties().jumpPower&&(a.y=-this._character.getCharacterProperties().jumpPower);
b.achievements.AchievementsManager.getInstance().incrementValue("dreamtopiaJump",1);this._character.setVelocity(new b.Vector2D(a.x,a.y));this._character.setState(new c.minigames.cartGame.character.characterStates.JumpingState(this._character));b.audio.SoundManager.playSoundByName("sfx_cart_jump_1")},__class__:c.minigames.cartGame.character.characterStates.JumpStartState});c.minigames.cartGame.character.characterStates.JumpingState=function(a){this._rotationSlack=0.05;c.minigames.cartGame.character.characterStates.AerialState.call(this,
a)};c.minigames.cartGame.character.characterStates.JumpingState.__name__="game minigames cartGame character characterStates JumpingState".split(" ");c.minigames.cartGame.character.characterStates.JumpingState.__super__=c.minigames.cartGame.character.characterStates.AerialState;c.minigames.cartGame.character.characterStates.JumpingState.prototype=r(c.minigames.cartGame.character.characterStates.AerialState.prototype,{onEnter:function(){c.minigames.cartGame.character.characterStates.AerialState.prototype.onEnter.call(this);
this._character.getCharacterAnimationController().resetAnimationQueue();this._character.getCharacterAnimationController().addAnimationToQueue("JumpMid");null!=c.minigames.cartGame.character.characterStates.JumpingState._tweener&&(c.minigames.cartGame.character.characterStates.JumpingState._tweener.getEntity().destroy(),c.minigames.cartGame.character.characterStates.JumpingState._tweener=null)},onExit:function(){c.minigames.cartGame.character.characterStates.AerialState.prototype.onExit.call(this);
this._character.getCharacterAnimationController().resetAnimationQueue();this._character.getCharacterAnimationController().addAnimationToQueue("JumpEnd");c.minigames.cartGame.CartGame.getInstance().getSmartCamera().setTargetRotationDeg(0)},onUpdate:function(){c.minigames.cartGame.character.characterStates.AerialState.prototype.onUpdate.call(this);0<this._character.getCharacterProperties().boost?this._character.getCharacterProperties().boost-=this._character.getCharacterProperties().deccelerationSpeed*
b.Root.getDeltaTime():this._character.getCharacterProperties().boost=0;var a=this._character.getVelocity();this.applyGravity();a.x>this._character.getCharacterProperties().movementSpeed?a.x-=this._character.getCharacterProperties().deccelerationSpeed*b.Root.getDeltaTime():a.x<-this._character.getCharacterProperties().movementSpeed&&(a.x+=this._character.getCharacterProperties().deccelerationSpeed*b.Root.getDeltaTime());for(a=0-this._character.getRotation();-180>a;)a+=360;for(;180<a;)a-=360;this._character.setRotation(this._character.getRotation()+
a*this._rotationSlack)},__class__:c.minigames.cartGame.character.characterStates.JumpingState});c.minigames.cartGame.character.characterStates.ParkedState=function(a){c.minigames.cartGame.character.characterStates.GroundedState.call(this,a)};c.minigames.cartGame.character.characterStates.ParkedState.__name__="game minigames cartGame character characterStates ParkedState".split(" ");c.minigames.cartGame.character.characterStates.ParkedState.__super__=c.minigames.cartGame.character.characterStates.GroundedState;
c.minigames.cartGame.character.characterStates.ParkedState.prototype=r(c.minigames.cartGame.character.characterStates.GroundedState.prototype,{onEnter:function(){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onEnter.call(this);this._character.getCharacterAnimationController().playAnimation("Idle");this._character.setVelocity(new b.Vector2D(0,0))},onUpdate:function(){c.minigames.cartGame.character.characterStates.GroundedState.prototype.onUpdate.call(this)},__class__:c.minigames.cartGame.character.characterStates.ParkedState});
c.minigames.cartGame.character.collisionStates={};c.minigames.cartGame.character.collisionStates.CollisionState=function(a){this._character=a};c.minigames.cartGame.character.collisionStates.CollisionState.__name__="game minigames cartGame character collisionStates CollisionState".split(" ");c.minigames.cartGame.character.collisionStates.CollisionState.prototype={onEnter:function(){this._character.getEntity().addEventListener("beginContact",s(this,this.onBeginContact));this._character.getEntity().addEventListener("endContact",
s(this,this.onEndContact))},onUpdate:function(){},onExit:function(){this._character.getEntity().removeEventListener("beginContact",s(this,this.onBeginContact));this._character.getEntity().removeEventListener("endContact",s(this,this.onEndContact))},onBeginContact:function(a){},onEndContact:function(a){},__class__:c.minigames.cartGame.character.collisionStates.CollisionState};c.minigames.cartGame.character.collisionStates.RegularCollisionState=function(a){c.minigames.cartGame.character.collisionStates.CollisionState.call(this,
a)};c.minigames.cartGame.character.collisionStates.RegularCollisionState.__name__="game minigames cartGame character collisionStates RegularCollisionState".split(" ");c.minigames.cartGame.character.collisionStates.RegularCollisionState.__super__=c.minigames.cartGame.character.collisionStates.CollisionState;c.minigames.cartGame.character.collisionStates.RegularCollisionState.prototype=r(c.minigames.cartGame.character.collisionStates.CollisionState.prototype,{__class__:c.minigames.cartGame.character.collisionStates.RegularCollisionState});
c.minigames.cartGame.character.damageStates={};c.minigames.cartGame.character.damageStates.DamageState=function(a){this._character=a};c.minigames.cartGame.character.damageStates.DamageState.__name__="game minigames cartGame character damageStates DamageState".split(" ");c.minigames.cartGame.character.damageStates.DamageState.prototype={onHit:function(a){},onUpdate:function(){},__class__:c.minigames.cartGame.character.damageStates.DamageState};c.minigames.cartGame.character.damageStates.BlinkDamageState=
function(a){this._hitEffect=null;this._hitCooldown=0;c.minigames.cartGame.character.damageStates.DamageState.call(this,a)};c.minigames.cartGame.character.damageStates.BlinkDamageState.__name__="game minigames cartGame character damageStates BlinkDamageState".split(" ");c.minigames.cartGame.character.damageStates.BlinkDamageState.__super__=c.minigames.cartGame.character.damageStates.DamageState;c.minigames.cartGame.character.damageStates.BlinkDamageState.prototype=r(c.minigames.cartGame.character.damageStates.DamageState.prototype,
{onHit:function(a){var d=this;c.minigames.cartGame.character.damageStates.DamageState.prototype.onHit.call(this,a);0<this._hitCooldown||(this._hitCooldown=2,this._character.getEntity().getComponent(b.pixi.PixiAnimation).getSprite().alpha=0.5,this._character.getCharacterProperties().hitPoints--,0>=this._character.getCharacterProperties().hitPoints&&this._character.setState(new c.minigames.cartGame.character.characterStates.InstantDeathState(this._character)),this._hitEffect=this._character.getGameState().addEntity(),
this._hitEffect.setScale(4,4),(new b.pixi.PixiAnimation(this._hitEffect,"")).setAnimation("cartHit",function(){d._hitEffect.destroy();d._hitEffect=null},!0),this._character.getEntity().getParent().addChild(this._hitEffect),this._character.getCharacterProperties().slowdown=0.5,c.minigames.cartGame.CartGame.getInstance().getSmartCamera().setVerticalVibration(50,60,60),b.audio.SoundManager.playSoundByName("sfx_cart_hit_1"))},onUpdate:function(){c.minigames.cartGame.character.damageStates.DamageState.prototype.onUpdate.call(this);
0<this._hitCooldown&&(this._hitCooldown-=b.Root.getDeltaTime(),0>=this._hitCooldown&&(this._hitCooldown=0,this.onCooldownElapse()));null!=this._hitEffect&&this._hitEffect.setPosition(this._character.getEntity().getPosition().x,this._character.getEntity().getPosition().y-this._character.getCharacterProperties().height/2,this._character.getEntity().getPosition().z)},onCooldownElapse:function(){this._character.getEntity().getComponent(b.pixi.PixiAnimation).getSprite().alpha=1},onDeath:function(){this._character.setState(new c.minigames.cartGame.character.characterStates.GroundFailState(this._character))},
__class__:c.minigames.cartGame.character.damageStates.BlinkDamageState});c.minigames.cartGame.character.damageStates.InvincibleDamageState=function(a){c.minigames.cartGame.character.damageStates.DamageState.call(this,a)};c.minigames.cartGame.character.damageStates.InvincibleDamageState.__name__="game minigames cartGame character damageStates InvincibleDamageState".split(" ");c.minigames.cartGame.character.damageStates.InvincibleDamageState.__super__=c.minigames.cartGame.character.damageStates.DamageState;
c.minigames.cartGame.character.damageStates.InvincibleDamageState.prototype=r(c.minigames.cartGame.character.damageStates.DamageState.prototype,{onHit:function(a){c.minigames.cartGame.character.damageStates.DamageState.prototype.onHit.call(this,a);if(a.instantDeath&&!this._character.getDead())this._character.setState(new c.minigames.cartGame.character.characterStates.InstantDeathState(this._character));else if(null!=a.attacker&&(a=a.attacker.getComponent(c.minigames.cartGame.objects.Obstacle),null!=
a))a.onHit()},__class__:c.minigames.cartGame.character.damageStates.InvincibleDamageState});c.minigames.cartGame.character.statusStates={};c.minigames.cartGame.character.statusStates.StatusState=function(a){this._duration=-1;this._character=a};c.minigames.cartGame.character.statusStates.StatusState.__name__="game minigames cartGame character statusStates StatusState".split(" ");c.minigames.cartGame.character.statusStates.StatusState.prototype={onActivate:function(){},onUpdate:function(){0<this._duration&&
(this._duration-=b.Root.getDeltaTime(),0>=this._duration&&this._character.removeStatusState(this))},onDeactivate:function(){},__class__:c.minigames.cartGame.character.statusStates.StatusState};c.minigames.cartGame.character.statusStates.CoinMagnetStatusState=function(a,b){c.minigames.cartGame.character.statusStates.StatusState.call(this,a);this._duration=b};c.minigames.cartGame.character.statusStates.CoinMagnetStatusState.__name__="game minigames cartGame character statusStates CoinMagnetStatusState".split(" ");
c.minigames.cartGame.character.statusStates.CoinMagnetStatusState.__super__=c.minigames.cartGame.character.statusStates.StatusState;c.minigames.cartGame.character.statusStates.CoinMagnetStatusState.prototype=r(c.minigames.cartGame.character.statusStates.StatusState.prototype,{onActivate:function(){c.minigames.cartGame.character.statusStates.StatusState.prototype.onActivate.call(this);b.utilities.Debug.log("CoinMagnetStatusState::onActivate()");this._effectEntity=this._character.getGameState().addEntity();
new b.pixi.PixiAnimation(this._effectEntity,"coinMagnetEffect");this._character.getEntity().addChild(this._effectEntity);this._character.getSiblingComponent(c.minigames.cartGame.character.ItemCollector).setMagnetPullParams(t.parseFloat(b.GameConfig.getProperty("coinMagnet.minPullPower")),t.parseFloat(b.GameConfig.getProperty("coinMagnet.maxPullPower")),t.parseFloat(b.GameConfig.getProperty("coinMagnet.pullRange")))},onUpdate:function(){c.minigames.cartGame.character.statusStates.StatusState.prototype.onUpdate.call(this);
null!=this._effectEntity&&(this._character.getDead()?this._effectEntity.setIsVisible(!1):c.minigames.cartGame.CartGame.getInstance().isFlying()?this._effectEntity.setPosition(0,5):this._effectEntity.setPosition(0,-80))},onDeactivate:function(){c.minigames.cartGame.character.statusStates.StatusState.prototype.onDeactivate.call(this);b.utilities.Debug.log("CoinMagnetStatusState::onDeactivate()");this._character.getSiblingComponent(c.minigames.cartGame.character.ItemCollector);null!=this._effectEntity&&
this._effectEntity.destroy();this._character.getSiblingComponent(c.minigames.cartGame.character.ItemCollector).setMagnetPullParams(t.parseFloat(b.GameConfig.getProperty("game.minPullPower")),t.parseFloat(b.GameConfig.getProperty("game.maxPullPower")),t.parseFloat(b.GameConfig.getProperty("game.pullRange")))},__class__:c.minigames.cartGame.character.statusStates.CoinMagnetStatusState});c.minigames.cartGame.character.statusStates.InvincibleStatusState=function(a,b){c.minigames.cartGame.character.statusStates.StatusState.call(this,
a);this._duration=b;this._prevDamageState=a.getDamageState()};c.minigames.cartGame.character.statusStates.InvincibleStatusState.__name__="game minigames cartGame character statusStates InvincibleStatusState".split(" ");c.minigames.cartGame.character.statusStates.InvincibleStatusState.__super__=c.minigames.cartGame.character.statusStates.StatusState;c.minigames.cartGame.character.statusStates.InvincibleStatusState.prototype=r(c.minigames.cartGame.character.statusStates.StatusState.prototype,{onActivate:function(){c.minigames.cartGame.character.statusStates.StatusState.prototype.onActivate.call(this);
this._character.setDamageState(new c.minigames.cartGame.character.damageStates.InvincibleDamageState(this._character));this._effectEntity=this._character.getGameState().addEntity();this._effectEntity.setPosition(0,-20);new b.pixi.PixiAnimation(this._effectEntity,"invincibility");this._character.getEntity().addChild(this._effectEntity);this._alphaPulser=new b.components.AlphaPulser(this._effectEntity,0);this._alphaPulser.setIsActive(!1)},onUpdate:function(){c.minigames.cartGame.character.statusStates.StatusState.prototype.onUpdate.call(this);
null!=this._effectEntity&&(2>=this._duration&&(this._alphaPulser.setIsActive(!0),this._alphaPulser.setRate(10/this._duration)),this._character.getDead()&&this._effectEntity.setIsVisible(!1))},onDeactivate:function(){c.minigames.cartGame.character.statusStates.StatusState.prototype.onDeactivate.call(this);this._character.getDead()||this._character.setDamageState(this._prevDamageState);null!=this._effectEntity&&this._effectEntity.destroy()},__class__:c.minigames.cartGame.character.statusStates.InvincibleStatusState});
c.minigames.cartGame.item={};c.minigames.cartGame.item.Item=function(a){b.Component.call(this,a)};c.minigames.cartGame.item.Item.__name__=["game","minigames","cartGame","item","Item"];c.minigames.cartGame.item.Item.__super__=b.Component;c.minigames.cartGame.item.Item.prototype=r(b.Component.prototype,{onCollect:function(a){this.getEntity().destroy()},__class__:c.minigames.cartGame.item.Item});c.minigames.cartGame.item.Coin=function(a){this._scoreValue=50;this._coinValue=1;c.minigames.cartGame.item.Item.call(this,
a);this._coinValue=1};c.minigames.cartGame.item.Coin.__name__=["game","minigames","cartGame","item","Coin"];c.minigames.cartGame.item.Coin.__super__=c.minigames.cartGame.item.Item;c.minigames.cartGame.item.Coin.prototype=r(c.minigames.cartGame.item.Item.prototype,{onCollect:function(a){var d=this,e=this.getEntity().getPosition(),e=c.EntityFactory.createFloatingText(e.x,e.y,"+"+this._scoreValue,this.getGameState(),"#FFFFFF",36);this.getEntity().getParent().addChild(e);var e=this.getEntity().getComponent(b.pixi.PixiContainer),
f=new b.components.Tweener(this.getEntity());f.addTween(this.getEntity().getPositionRef(),"y",this.getEntity().getPositionRef().y,this.getEntity().getPositionRef().y-150,0.5,b.components.tween.EasingFunctions.easeOutQuad);var n=this.getGameState().addEntity();a.getEntity().getParent().addChild(n);n.setPosition(this.getEntity().getPositionRef().x,this.getEntity().getPositionRef().y);(new c.particles.ParticleEffect(n)).emit();n.destroy();f.addTween(e.getContainer(),"alpha",1,0,0.5,b.components.tween.EasingFunctions.easeOutQuad,
0,function(){d.getEntity().destroy()});c.minigames.cartGame.CartGame.getInstance().removeItemFromArray(this.getEntity());c.minigames.cartGame.CartGame.getInstance().collectGems(1);b.audio.SoundManager.playSoundByName("sfx_gem_pickup_1")},__class__:c.minigames.cartGame.item.Coin});c.minigames.cartGame.item.CoinMagnet=function(a){c.minigames.cartGame.item.Item.call(this,a)};c.minigames.cartGame.item.CoinMagnet.__name__=["game","minigames","cartGame","item","CoinMagnet"];c.minigames.cartGame.item.CoinMagnet.__super__=
c.minigames.cartGame.item.Item;c.minigames.cartGame.item.CoinMagnet.prototype=r(c.minigames.cartGame.item.Item.prototype,{onCollect:function(a){c.minigames.cartGame.item.Item.prototype.onCollect.call(this,a);var d=new c.minigames.cartGame.character.statusStates.CoinMagnetStatusState(a,5);a.addStatusState(d);b.audio.SoundManager.playSoundByName("sfx_magnet_pickup")},__class__:c.minigames.cartGame.item.CoinMagnet});c.minigames.cartGame.item.CollectAfterTime=function(a,c,d){null==d&&(d=1);this._timeUntilCollect=
1;b.Component.call(this,a);this._timeUntilCollect=d;this._collector=c};c.minigames.cartGame.item.CollectAfterTime.__name__=["game","minigames","cartGame","item","CollectAfterTime"];c.minigames.cartGame.item.CollectAfterTime.__super__=b.Component;c.minigames.cartGame.item.CollectAfterTime.prototype=r(b.Component.prototype,{update:function(){b.Component.prototype.update.call(this);this._timeUntilCollect-=b.Root.getDeltaTime();0>=this._timeUntilCollect&&(this.getEntity().getComponent(c.minigames.cartGame.item.Item).onCollect(this._collector),
this.destroy())},__class__:c.minigames.cartGame.item.CollectAfterTime});c.minigames.cartGame.item.Invincibility=function(a){c.minigames.cartGame.item.Item.call(this,a)};c.minigames.cartGame.item.Invincibility.__name__=["game","minigames","cartGame","item","Invincibility"];c.minigames.cartGame.item.Invincibility.__super__=c.minigames.cartGame.item.Item;c.minigames.cartGame.item.Invincibility.prototype=r(c.minigames.cartGame.item.Item.prototype,{onCollect:function(a){c.minigames.cartGame.item.Item.prototype.onCollect.call(this,
a);var d=new c.minigames.cartGame.character.statusStates.InvincibleStatusState(a,5);a.addStatusState(d);b.audio.SoundManager.playSoundByName("sfx_invincibility_pickup")},__class__:c.minigames.cartGame.item.Invincibility});c.minigames.cartGame.item.LifeUp=function(a){c.minigames.cartGame.item.Item.call(this,a)};c.minigames.cartGame.item.LifeUp.__name__=["game","minigames","cartGame","item","LifeUp"];c.minigames.cartGame.item.LifeUp.__super__=c.minigames.cartGame.item.Item;c.minigames.cartGame.item.LifeUp.prototype=
r(c.minigames.cartGame.item.Item.prototype,{onCollect:function(a){c.minigames.cartGame.item.Item.prototype.onCollect.call(this,a);a.getCharacterProperties().hitPoints++},__class__:c.minigames.cartGame.item.LifeUp});c.minigames.cartGame.item.PowerStar=function(a){this._scoreValue=1E3;c.minigames.cartGame.item.Item.call(this,a);this._numPowerStarsToCollect=t.parseInt(b.GameConfig.getProperty("cartGame.numPowerStarsToCollect"));c.minigames.cartGame.item.PowerStar.getGlobalEventDispatcher().addEventListener("collect",
s(this,this.onCollectPowerStar))};c.minigames.cartGame.item.PowerStar.__name__=["game","minigames","cartGame","item","PowerStar"];c.minigames.cartGame.item.PowerStar.getGlobalEventDispatcher=function(){null==c.minigames.cartGame.item.PowerStar._globalEventDispatcher&&(c.minigames.cartGame.item.PowerStar._globalEventDispatcher=new b.events.EventDispatcher);return c.minigames.cartGame.item.PowerStar._globalEventDispatcher};c.minigames.cartGame.item.PowerStar.__super__=c.minigames.cartGame.item.Item;
c.minigames.cartGame.item.PowerStar.prototype=r(c.minigames.cartGame.item.Item.prototype,{init:function(){c.minigames.cartGame.item.Item.prototype.init.call(this)},onCollect:function(a){var d=this;c.minigames.cartGame.item.PowerStar.getGlobalEventDispatcher().removeEventListener("collect",s(this,this.onCollectPowerStar));var e=this.getEntity().getPosition(),e=c.EntityFactory.createFloatingText(e.x,e.y,"+"+this._scoreValue,this.getGameState(),"#FFFFFF",58);this.getEntity().getParent().addChild(e);
e=c.minigames.cartGame.CartGame.getInstance().getNumStarsCollected();e++;if(e>=this._numPowerStarsToCollect){var e=t.parseInt(b.GameConfig.getProperty("cartGame.numGemsPerPowerStar")),f=t.parseFloat(b.GameConfig.getProperty("cartGame.powerStarInvincibilityDuration"));c.minigames.gems.GemManager.getInstance().addGems(e);a.addStatusState(new c.minigames.cartGame.character.statusStates.InvincibleStatusState(a,f));e=0}c.minigames.cartGame.CartGame.getInstance().setNumStarsCollected(e);c.minigames.cartGame.CartGame.getInstance().removeItemFromArray(this.getEntity());
c.minigames.cartGame.item.PowerStar.getGlobalEventDispatcher().dispatchEvent(new c.minigames.cartGame.item.PowerStarEvent("collect"));e=this.getGameState().addEntity();a.getEntity().getParent().addChild(e);e.setPosition(this.getEntity().getPositionRef().x,this.getEntity().getPositionRef().y);(new c.particles.ParticleEffect(e)).emit();e.destroy();b.audio.SoundManager.playSoundByName("sfx_gem_pickup_1");a=this.getEntity().getComponent(b.pixi.PixiContainer);e=new b.components.Tweener(this.getEntity());
e.addTween(this.getEntity().getPositionRef(),"y",this.getEntity().getPositionRef().y,this.getEntity().getPositionRef().y-150,0.5,b.components.tween.EasingFunctions.easeOutQuad);e.addTween(a.getContainer(),"alpha",1,0,0.5,b.components.tween.EasingFunctions.easeOutQuad,0,function(){d.getEntity().destroy()})},onCollectPowerStar:function(a){a=this.getEntity().getComponentsInChildren(b.pixi.PixiSprite)[0];var d="coloredStar"+c.minigames.cartGame.CartGame.getInstance().getNumStarsCollected();b.utilities.Debug.log("New asset ID: "+
d);a.setTextureFromImageId(d)},destroy:function(){c.minigames.cartGame.item.Item.prototype.destroy.call(this);c.minigames.cartGame.item.PowerStar.getGlobalEventDispatcher().removeEventListener("collect",s(this,this.onCollectPowerStar))},__class__:c.minigames.cartGame.item.PowerStar});c.minigames.cartGame.item.PowerStarEvent=function(a){b.events.Event.call(this,a)};c.minigames.cartGame.item.PowerStarEvent.__name__=["game","minigames","cartGame","item","PowerStarEvent"];c.minigames.cartGame.item.PowerStarEvent.__super__=
b.events.Event;c.minigames.cartGame.item.PowerStarEvent.prototype=r(b.events.Event.prototype,{__class__:c.minigames.cartGame.item.PowerStarEvent});c.minigames.cartGame.levelGenerator={};c.minigames.cartGame.levelGenerator.LevelGenerator=function(a,d){this._forcedTileQueue=[];this._timeElapsed=0;this._maxNumPieces=3;this._exitTags=[];this._entryTags=[];this._spawnedPieces=[];this._pieceElements=[];b.Component.call(this,a);c.minigames.cartGame.levelGenerator.LevelGenerator._instance=this;this._target=
d;this._spawnedPieces=[]};c.minigames.cartGame.levelGenerator.LevelGenerator.__name__=["game","minigames","cartGame","levelGenerator","LevelGenerator"];c.minigames.cartGame.levelGenerator.LevelGenerator.getInstance=function(){return c.minigames.cartGame.levelGenerator.LevelGenerator._instance};c.minigames.cartGame.levelGenerator.LevelGenerator.__super__=b.Component;c.minigames.cartGame.levelGenerator.LevelGenerator.prototype=r(b.Component.prototype,{getSpawnedPieces:function(){return this._spawnedPieces},
getTarget:function(){return this._target},setTarget:function(a){this._target=a},init:function(){b.Component.prototype.init.call(this)},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);var a=this._timeElapsed;this._timeElapsed+=b.Root.getDeltaTime();for(var c=this._pieceElements.length,d=[],f=0;f<c;){var n=f++,n=this._pieceElements[n];a<=n.forceAtTime&&this._timeElapsed>n.forceAtTime&&d.push(n.id)}0<d.length&&this._forcedTileQueue.push(d[b.utilities.Math2.randomInt(0,this._forcedTileQueue.length)])},
registerPieceElement:function(a){this._pieceElements.push(a)},spawnRandomPieceWithEntryTag:function(a,d){null==d&&(d=!0);console.log("spawnRandomPieceWithEntryTag()");if(0<this._forcedTileQueue.length){var e=this._forcedTileQueue[0];v.remove(this._forcedTileQueue,this._forcedTileQueue[0]);return this.spawnPieceById(e,d)}for(var e=[],f=this._pieceElements.length,n=0;n<f;){var g=n++,g=this._pieceElements[g];if(!(0<=g.minTime&&0<=g.maxTime&&(this._timeElapsed<g.minTime||this._timeElapsed>g.maxTime)))for(var h=
a.length,k=0;k<h;){var m=k++;if(0<=v.indexOf(g.entryTags,a[m],0)){e.push(g);break}}}f=b.utilities.Math2.randomInt(0,e.length);e=e[f];f=this.getGameState().addEntity();(new b.pixi.PixiContainer(f)).getContainer().alpha=0.5;n=new c.minigames.cartGame.levelGenerator.PieceComponent(f,e.tmxLevel,e.entryTags,e.exitTags);n.setEntryPosition(e.entryOffset.getClone());n.setExitPosition(e.exitOffset.getClone());d&&this.addPieceToList(n);this._forcedTileQueue=this._forcedTileQueue.concat(e.forceNextPieces);this._target.addChild(f);
this.dispatchEvent(new c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent("spawn",n));return n},spawnRandomPieceWithExitTag:function(a,d){null==d&&(d=!0);if(0<this._forcedTileQueue.length){var e=this._forcedTileQueue[0];v.remove(this._forcedTileQueue,this._forcedTileQueue[0]);return this.spawnPieceById(e,d)}for(var e=[],f=this._pieceElements.length,n=0;n<f;){var g=n++,g=this._pieceElements[g];if(!(0<=g.minTime&&0<=g.maxTime&&(this._timeElapsed<g.minTime||this._timeElapsed>g.maxTime)))for(var h=
a.length,k=0;k<h;){var m=k++;if(0<=v.indexOf(g.exitTags,a[m],0)){e.push(g);break}}}f=b.utilities.Math2.randomInt(0,e.length);e=e[f];f=this.getGameState().addEntity();new b.pixi.PixiContainer(f);n=new c.minigames.cartGame.levelGenerator.PieceComponent(f,e.tmxLevel,e.entryTags,e.exitTags);n.setEntryPosition(e.entryOffset.getClone());n.setExitPosition(e.exitOffset.getClone());d&&this.addPieceToList(n);this._forcedTileQueue=this._forcedTileQueue.concat(e.forceNextPieces);this._target.addChild(f);this.dispatchEvent(new c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent("spawn",
n));return n},resetTimer:function(){this._timeElapsed=0},spawnPieceById:function(a,d){null==d&&(d=!0);for(var e=null,f=this._pieceElements.length,n=0;n<f;){var g=n++,g=this._pieceElements[g];if(g.id==a){e=g;break}}f=this.getGameState().addEntity();new b.pixi.PixiContainer(f);n=new c.minigames.cartGame.levelGenerator.PieceComponent(f,e.tmxLevel,e.entryTags,e.exitTags);n.setEntryPosition(e.entryOffset.getClone());n.setExitPosition(e.exitOffset.getClone());d&&this.addPieceToList(n);this._target.addChild(f);
this._forcedTileQueue=this._forcedTileQueue.concat(e.forceNextPieces);this.dispatchEvent(new c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent("spawn",n));return n},addPieceToEnd:function(a){var d=this.getLastPiece(),e=d.getOffset();a.getSiblingComponent(b.pixi.PixiContainer);a.setOffset(new b.Vector2D(-a.getEntryPosition().x+d.getExitPosition().x,-a.getEntryPosition().y+d.getExitPosition().y));a.getOffset().x+=e.x;a.getOffset().y+=e.y;this.dispatchEvent(new c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent("addToEnd",
a));return a},addPieceToList:function(a){this._spawnedPieces.push(a);if(this._spawnedPieces.length>this._maxNumPieces)for(;this._spawnedPieces.length>this._maxNumPieces;)this.destroyPieceAtFront()},getLastPiece:function(){return this._spawnedPieces[this._spawnedPieces.length-1]},destroy:function(){b.Component.prototype.destroy.call(this);c.minigames.cartGame.levelGenerator.LevelGenerator._instance==this&&(c.minigames.cartGame.levelGenerator.LevelGenerator._instance=null)},destroyPieceAtFront:function(){this._spawnedPieces[0].getEntity().destroy();
this._spawnedPieces.splice(0,1)},__class__:c.minigames.cartGame.levelGenerator.LevelGenerator});c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent=function(a,c){b.events.Event.call(this,a);this._pieceComponent=c};c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent.__name__=["game","minigames","cartGame","levelGenerator","LevelGeneratorSpawnPieceEvent"];c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent.__super__=b.events.Event;c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent.prototype=
r(b.events.Event.prototype,{getPieceComponent:function(){return this._pieceComponent},__class__:c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent});c.minigames.cartGame.levelGenerator.LoopCollisionSwapTrigger=function(a,c){b.Component.call(this,a);this._pieceComponent=c};c.minigames.cartGame.levelGenerator.LoopCollisionSwapTrigger.__name__=["game","minigames","cartGame","levelGenerator","LoopCollisionSwapTrigger"];c.minigames.cartGame.levelGenerator.LoopCollisionSwapTrigger.__super__=
b.Component;c.minigames.cartGame.levelGenerator.LoopCollisionSwapTrigger.prototype=r(b.Component.prototype,{onEnter:function(a){a=a.getComponent(c.minigames.cartGame.character.Character);if(null!=a&&!(0<a.getDownVector().y)){a=this._pieceComponent.getForegroundGroup();for(var d=a.getComponentsInChildren(b.components.colliders.PolygonCollider),e=d.length,f=0;f<e;){var n=f++,n=d[n];n.hasTag("preLoopGround")&&n.removeTag("ground");n.hasTag("postLoopGround")&&n.addTag("ground")}a=a.getComponentsInChildren(b.pixi.PixiContainer);
d=a.length;for(e=0;e<d;)f=e++,f=a[f],c.minigames.cartGame.CartGame.getInstance().getTilesLayer().addChild(f.getEntity()),f.updateParenting(),console.log(f);this.getEntity().destroy()}},__class__:c.minigames.cartGame.levelGenerator.LoopCollisionSwapTrigger});c.minigames.cartGame.levelGenerator.PieceComponent=function(a,c,d,f){this._backgroundEntityGroup=this._foregroundEntityGroup=this._entityGroup=this._foregroundGroup=this._tileGroup=null;this._exitTags=[];this._entryTags=[];b.Component.call(this,
a);this._entryPosition=new b.Vector2D;this._exitPosition=new b.Vector2D;this._tmxLevel=c;this._entryTags=d;this._exitTags=f;this._offset=new b.Vector2D};c.minigames.cartGame.levelGenerator.PieceComponent.__name__=["game","minigames","cartGame","levelGenerator","PieceComponent"];c.minigames.cartGame.levelGenerator.PieceComponent.__super__=b.Component;c.minigames.cartGame.levelGenerator.PieceComponent.prototype=r(b.Component.prototype,{getForegroundGroup:function(){return this._foregroundGroup},setForegroundGroup:function(a){this._foregroundGroup=
a},getTileGroup:function(){return this._tileGroup},setTileGroup:function(a){this._tileGroup=a},getBackgroundEntityGroup:function(){return this._backgroundEntityGroup},setBackgroundEntityGroup:function(a){this._backgroundEntityGroup=a},getForegroundEntityGroup:function(){return this._foregroundEntityGroup},setForegroundEntityGroup:function(a){this._foregroundEntityGroup=a},getEntityGroup:function(){return this._entityGroup},setEntityGroup:function(a){this._entityGroup=a},getEntryTags:function(){return this._entryTags},
getExitTags:function(){return this._exitTags},getTmxLevel:function(){return this._tmxLevel},setTmxLevel:function(a){this._tmxLevel=a},getEntryPosition:function(){return this._entryPosition},setEntryPosition:function(a){this._entryPosition.x=a.x;this._entryPosition.y=a.y},getExitPosition:function(){return this._exitPosition},setExitPosition:function(a){this._exitPosition.x=a.x;this._exitPosition.y=a.y},getPosition:function(){return this.getEntity().getPosition()},getOffset:function(){return this._offset},
setOffset:function(a){this._offset=a},update:function(){b.Component.prototype.update.call(this);if(!c.minigames.cartGame.CartGame.getInstance().getGameOver()){var a=c.minigames.cartGame.CartGame.getInstance().getPlayer().getLocalPosition();this.getOffset().x+this._exitPosition.x+500<a.x&&this.getEntity().destroy()}},destroy:function(){b.Component.prototype.destroy.call(this);null!=this.getBackgroundEntityGroup()&&this.getBackgroundEntityGroup().destroy();null!=this.getEntityGroup()&&this.getEntityGroup().destroy();
null!=this.getForegroundGroup()&&this.getForegroundGroup().destroy();null!=this.getTileGroup()&&this.getTileGroup().destroy()},__class__:c.minigames.cartGame.levelGenerator.PieceComponent});c.minigames.cartGame.levelGenerator.PieceElement=function(a){this.forceNextPieces=[];this.forceAtTime=this.minTime=this.maxTime=-1;this.id=a;this.entryOffset=new b.Vector2D;this.exitOffset=new b.Vector2D};c.minigames.cartGame.levelGenerator.PieceElement.__name__=["game","minigames","cartGame","levelGenerator",
"PieceElement"];c.minigames.cartGame.levelGenerator.PieceElement.prototype={__class__:c.minigames.cartGame.levelGenerator.PieceElement};c.minigames.cartGame.levelGenerator.SpawnNextTrigger=function(a){b.Component.call(this,a)};c.minigames.cartGame.levelGenerator.SpawnNextTrigger.__name__=["game","minigames","cartGame","levelGenerator","SpawnNextTrigger"];c.minigames.cartGame.levelGenerator.SpawnNextTrigger.__super__=b.Component;c.minigames.cartGame.levelGenerator.SpawnNextTrigger.prototype=r(b.Component.prototype,
{onEnter:function(){if(!c.minigames.cartGame.CartGame.getInstance().getGameOver()){var a=c.minigames.cartGame.levelGenerator.LevelGenerator.getInstance().getLastPiece(),a=c.minigames.cartGame.levelGenerator.LevelGenerator.getInstance().spawnRandomPieceWithEntryTag(a.getExitTags(),!1),b=this.getGameState().addEntity();c.minigames.cartGame.CartGame.getInstance().getBackgroundLayer().addChild(b);a.setBackgroundEntityGroup(b);b=this.getGameState().addEntity();c.minigames.cartGame.CartGame.getInstance().getTilesLayer().addChild(b);
a.setEntityGroup(b);b=this.getGameState().addEntity();c.minigames.cartGame.CartGame.getInstance().getForegroundLayer().addChild(b);a.setForegroundEntityGroup(b);c.minigames.cartGame.levelGenerator.LevelGenerator.getInstance().addPieceToEnd(a);c.minigames.cartGame.levelGenerator.LevelGenerator.getInstance().addPieceToList(a);b=this.getGameState().addEntity();a.setTileGroup(b);c.minigames.cartGame.CartGame.getInstance().getTilesLayer().addChild(b);a.getTmxLevel().createLevel(b,a.getOffset().x,a.getOffset().y);
this.getEntity().destroy();var d=this.getGameState().addEntity();c.minigames.cartGame.CartGame.getInstance().getForegroundLayer().addChild(d);var f=!0,n=b.getChildren().length;for(a.setForegroundGroup(d);0<=--n;)a=b.getChildren()[n],f&&"Tiles"!=a.getName()&&d.addChild(a),"Tiles"==a.getName()&&(f=!1)}},onExit:function(){},__class__:c.minigames.cartGame.levelGenerator.SpawnNextTrigger});c.minigames.cartGame.objects={};c.minigames.cartGame.objects.Obstacle=function(a){this._counted=!1;b.Component.call(this,
a)};c.minigames.cartGame.objects.Obstacle.__name__=["game","minigames","cartGame","objects","Obstacle"];c.minigames.cartGame.objects.Obstacle.__super__=b.Component;c.minigames.cartGame.objects.Obstacle.prototype=r(b.Component.prototype,{onHit:function(){var a=this.getGameState().addEntity();(new b.pixi.PixiAnimation(a,"objectExplode")).setAnimation("objectExplode",function(){a.destroy()},!0);c.minigames.cartGame.CartGame.getInstance().getPlayerLayer().addChild(a);a.setPosition(this.getEntity().getLocalPosition().x,
this.getEntity().getLocalPosition().y);this.getEntity().destroy();b.audio.SoundManager.playSoundByName("sfx_crate_break")},update:function(){b.Component.prototype.update.call(this);!this._counted&&null!=c.minigames.cartGame.CartGame.getInstance().getPlayer()&&c.minigames.cartGame.CartGame.getInstance().getPlayer().getPositionRef().x<this.getEntity().getPositionRef().x+50&&(this._counted=!0)},__class__:c.minigames.cartGame.objects.Obstacle});c.minigames.cartGame.objects.DisableableObstacle=function(a,
b){this._hit=!1;c.minigames.cartGame.objects.Obstacle.call(this,a);this._entitiesToDisable=b};c.minigames.cartGame.objects.DisableableObstacle.__name__=["game","minigames","cartGame","objects","DisableableObstacle"];c.minigames.cartGame.objects.DisableableObstacle.__super__=c.minigames.cartGame.objects.Obstacle;c.minigames.cartGame.objects.DisableableObstacle.prototype=r(c.minigames.cartGame.objects.Obstacle.prototype,{onHit:function(){if(!this._hit){for(var a=this._entitiesToDisable.length,d=0;d<
a;)d++;this.getEntity().setIsActive(!1);var e=this.getGameState().addEntity();(new b.pixi.PixiAnimation(e,"objectExplode")).setAnimation("objectExplode",function(){e.destroy()},!0);c.minigames.cartGame.CartGame.getInstance().getPlayerLayer().addChild(e);e.setPosition(this.getEntity().getLocalPosition().x,this.getEntity().getLocalPosition().y);b.audio.SoundManager.playSoundByName("sfx_electric_short");this._hit=!0}},__class__:c.minigames.cartGame.objects.DisableableObstacle});c.minigames.cartGame.objects.HitEffect=
function(a){b.Component.call(this,a);this._tweener=new b.components.Tweener(a);this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());this._pixiContainer=new b.pixi.PixiContainer(a)};c.minigames.cartGame.objects.HitEffect.__name__=["game","minigames","cartGame","objects","HitEffect"];c.minigames.cartGame.objects.HitEffect.__super__=b.Component;c.minigames.cartGame.objects.HitEffect.prototype=r(b.Component.prototype,{init:function(){var a=this;b.Component.prototype.init.call(this);
this._deferredAction.addDeferredAction(1,function(){a.getEntity().destroy()});var c=this.getGameState().addEntity(),d=new b.pixi.PixiSprite(c,"hitPiece3");d.getSprite().anchor=new PIXI.Point(0.5,0.5);this._tweener.addTween(c.getScaleRef(),"x",0,1,0.35,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(c.getScaleRef(),"y",0,1,0.35,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(d.getSprite(),"alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.35);
var d=this.getGameState().addEntity(),f=new b.pixi.PixiSprite(d,"hitPiece2");f.getSprite().anchor=new PIXI.Point(0.5,0.5);this._tweener.addTween(d.getScaleRef(),"x",0,1,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(d.getScaleRef(),"y",0,1,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(f.getSprite(),"alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.35);var f=this.getGameState().addEntity(),n=new b.pixi.PixiSprite(f,"hitPiece1");
n.getSprite().anchor=new PIXI.Point(0.5,0.5);this._tweener.addTween(f.getScaleRef(),"x",0,1,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(f.getScaleRef(),"y",0,1,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(n.getSprite(),"alpha",0,1,0.15,b.components.tween.EasingFunctions.linear);this._tweener.addTween(n.getSprite(),"alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.2);(new b.components.SimpleMovement(f)).setAngularVelocity(new b.Vector3D(0,
0,b.utilities.Math2.degToRad(90)));var n=this.getGameState().addEntity(),g=new b.pixi.PixiSprite(n,"hitPiece4");g.getSprite().anchor=new PIXI.Point(0.5,0.5);this._tweener.addTween(n.getScaleRef(),"x",0.5,1.5,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(n.getScaleRef(),"y",0.5,1.5,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(g.getSprite(),"alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.35);(new b.components.SimpleMovement(n)).setVelocity(-100,
-300);var g=this.getGameState().addEntity(),h=new b.pixi.PixiSprite(g,"hitPiece4");h.getSprite().anchor=new PIXI.Point(0.5,0.5);this._tweener.addTween(g.getScaleRef(),"x",0.5,1.5,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(g.getScaleRef(),"y",0.5,1.5,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(h.getSprite(),"alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.4);(new b.components.SimpleMovement(g)).setVelocity(350,125);var h=
this.getGameState().addEntity(),k=new b.pixi.PixiSprite(h,"hitPiece4");k.getSprite().anchor=new PIXI.Point(0.5,0.5);this._tweener.addTween(h.getScaleRef(),"x",0.5,1.5,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(h.getScaleRef(),"y",0.5,1.5,0.65,b.components.tween.EasingFunctions.easeOutQuint);this._tweener.addTween(k.getSprite(),"alpha",1,0,0.25,b.components.tween.EasingFunctions.linear,0.3);(new b.components.SimpleMovement(h)).setVelocity(-400,75);this.getEntity().addChild(c);
this.getEntity().addChild(d);this.getEntity().addChild(f);this.getEntity().addChild(n);this.getEntity().addChild(g);this.getEntity().addChild(h)},__class__:c.minigames.cartGame.objects.HitEffect});c.minigames.cartGame.objects.SpeedBoost=function(a){b.Component.call(this,a)};c.minigames.cartGame.objects.SpeedBoost.__name__=["game","minigames","cartGame","objects","SpeedBoost"];c.minigames.cartGame.objects.SpeedBoost.__super__=b.Component;c.minigames.cartGame.objects.SpeedBoost.prototype=r(b.Component.prototype,
{onEnter:function(a){a=a.getComponent(c.minigames.cartGame.character.Character);null!=a&&(a.getCharacterProperties().boost=t.parseFloat(b.GameConfig.getProperty("cartGame.speedBoostPower")),this.getEntity().destroy(),b.audio.SoundManager.playSoundByName("sfx_speed_boost"))},__class__:c.minigames.cartGame.objects.SpeedBoost});c.minigames.cartGame.objects.Trampoline=function(a){b.Component.call(this,a)};c.minigames.cartGame.objects.Trampoline.__name__=["game","minigames","cartGame","objects","Trampoline"];
c.minigames.cartGame.objects.Trampoline.__super__=b.Component;c.minigames.cartGame.objects.Trampoline.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this._tweener=new b.components.Tweener(this.getEntity())},onEnter:function(a){a=a.getComponent(c.minigames.cartGame.character.Character);if(null!=a&&-400<a.getVelocity().y){a.setState(new c.minigames.cartGame.character.characterStates.JumpingState(a));var d=t.parseFloat(b.GameConfig.getProperty("cartGame.trampolineBounceHeight"));
a.setVelocity(new b.Vector2D(a.getVelocity().x,-d));this._tweener.addTween(this.getEntity().getPositionRef(),"y",this.getEntity().getLocalPosition().y+350,this.getEntity().getLocalPosition().y,0.35,b.components.tween.EasingFunctions.easeOutBack,0);this._tweener.addTween(this.getEntity().getScaleRef(),"y",0.5,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0);this._tweener.addTween(this.getEntity().getScaleRef(),"x",1.5,1,0.35,b.components.tween.EasingFunctions.easeOutBack,0);b.audio.SoundManager.playSoundByName("sfx_balloon_bounce");
a=c.minigames.cartGame.PlatformerFactory.createTrampolineHit(a.getEntity().getPositionRef().x,a.getEntity().getPositionRef().y,this.getGameState());c.minigames.cartGame.CartGame.getInstance().getPlayerLayer().addChild(a)}},__class__:c.minigames.cartGame.objects.Trampoline});c.minigames.cartGame.smartCamera={};c.minigames.cartGame.smartCamera.SmartCamera=function(a){this._rotationSlack=0.1;this._targetRotationDeg=0;b.Component.call(this,a)};c.minigames.cartGame.smartCamera.SmartCamera.__name__=["game",
"minigames","cartGame","smartCamera","SmartCamera"];c.minigames.cartGame.smartCamera.SmartCamera.__super__=b.Component;c.minigames.cartGame.smartCamera.SmartCamera.prototype=r(b.Component.prototype,{getTargetRotationDeg:function(){return this._targetRotationDeg},setTargetRotationDeg:function(a){this._targetRotationDeg=a},getCamera:function(){return this._camera},getState:function(){return this._state},setState:function(a){if(null!=this._state)this._state.onExit();this._state=a;this._state.onEnter()},
init:function(){b.Component.prototype.init.call(this);this._camera=this.getEntity().getComponent(b.components.Camera);this._verticalVibration=new b.components.PropertySineWave(this.getEntity(),this._camera.getAdditionalOffset(),"y",0,0,25,!1,0,0);this._horizontalVibration=new b.components.PropertySineWave(this.getEntity(),this._camera.getAdditionalOffset(),"x",0,0,25,!1,0,0)},update:function(){b.Component.prototype.update.call(this);var a=this._camera.getEntity().getRotation().z,c=this._targetRotationDeg-
a;this._camera.getEntity().setRotation(0,0,a+c*this._rotationSlack)},setVerticalVibration:function(a,b,c){null==c&&(c=0);this._verticalVibration.setMagnitude(a);this._verticalVibration.setRate(b);this._verticalVibration.setMagnitudeDecayRate(c)},setHorizontalVibration:function(a,b,c){null==c&&(c=0);this._horizontalVibration.setMagnitude(a);this._horizontalVibration.setRate(b);this._horizontalVibration.setMagnitudeDecayRate(c)},fixedUpdate:function(){b.Component.prototype.fixedUpdate.call(this);if(null!=
this._state)this._state.onUpdate()},__class__:c.minigames.cartGame.smartCamera.SmartCamera});c.minigames.cartGame.smartCamera.cameraStates={};c.minigames.cartGame.smartCamera.cameraStates.CameraState=function(a){this._smartCamera=a};c.minigames.cartGame.smartCamera.cameraStates.CameraState.__name__="game minigames cartGame smartCamera cameraStates CameraState".split(" ");c.minigames.cartGame.smartCamera.cameraStates.CameraState.prototype={onEnter:function(){},onUpdate:function(){},onExit:function(){},
__class__:c.minigames.cartGame.smartCamera.cameraStates.CameraState};c.minigames.cartGame.smartCamera.cameraStates.FollowTarget=function(a,b,d,f){c.minigames.cartGame.smartCamera.cameraStates.CameraState.call(this,a);this._target=b;this._slack=d;this._offset=f};c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.__name__="game minigames cartGame smartCamera cameraStates FollowTarget".split(" ");c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.__super__=c.minigames.cartGame.smartCamera.cameraStates.CameraState;
c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.prototype=r(c.minigames.cartGame.smartCamera.cameraStates.CameraState.prototype,{onEnter:function(){c.minigames.cartGame.smartCamera.cameraStates.CameraState.prototype.onEnter.call(this);this._cameraTarget=this._smartCamera.getGameState().addEntity();new b.components.FollowEntity(this._cameraTarget,this._target);this._smartCamera.getCamera().setTarget(this._cameraTarget);this._smartCamera.getCamera().getSlackMovement().setSlack(this._slack);
this._smartCamera.getCamera().setOffset(this._offset)},onExit:function(){c.minigames.cartGame.smartCamera.cameraStates.CameraState.prototype.onExit.call(this);this._cameraTarget.destroy()},__class__:c.minigames.cartGame.smartCamera.cameraStates.FollowTarget});c.minigames.cartGame.smartCamera.cameraStates.FollowCharacter=function(a,b,d,f){this._characterDeltaLeadModifierY=this._leadDistancePerHpLost=0;this._characterDeltaLeadModifierX=250;c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.call(this,
a,b,d,f)};c.minigames.cartGame.smartCamera.cameraStates.FollowCharacter.__name__="game minigames cartGame smartCamera cameraStates FollowCharacter".split(" ");c.minigames.cartGame.smartCamera.cameraStates.FollowCharacter.__super__=c.minigames.cartGame.smartCamera.cameraStates.FollowTarget;c.minigames.cartGame.smartCamera.cameraStates.FollowCharacter.prototype=r(c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.prototype,{getCharacterDeltaLeadModifierX:function(){return this._characterDeltaLeadModifierX},
setCharacterDeltaLeadModifierX:function(a){this._characterDeltaLeadModifierX=a},getCharacterDeltaLeadModifierY:function(){return this._characterDeltaLeadModifierY},setCharacterDeltaLeadModifierY:function(a){this._characterDeltaLeadModifierY=a},onEnter:function(){c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.prototype.onEnter.call(this);this._character=this._target.getComponent(c.minigames.cartGame.character.Character);this._prevPosition=this._target.getPosition();this._cameraTarget.getComponent(b.components.FollowEntity)},
onUpdate:function(){c.minigames.cartGame.smartCamera.cameraStates.FollowTarget.prototype.onUpdate.call(this);if(null!=this._target){this._target.getPosition();var a=this._cameraTarget.getComponent(b.components.FollowEntity),d=b.utilities.Math2.getRotated2dVector(new b.Vector2D(1,0),this._target.getRotation().z),d=b.Vector3D.dot(new b.Vector3D(1,0),(new b.Vector3D(d.x,d.y)).getNormalized());a.setOffset(new b.Vector3D(this._characterDeltaLeadModifierX*d,0));this._smartCamera.getCamera();this._prevPosition=
this._target.getPosition()}},__class__:c.minigames.cartGame.smartCamera.cameraStates.FollowCharacter});c.minigames.cartGame.smartCamera.cameraStates.IdleCameraState=function(a){c.minigames.cartGame.smartCamera.cameraStates.CameraState.call(this,a)};c.minigames.cartGame.smartCamera.cameraStates.IdleCameraState.__name__="game minigames cartGame smartCamera cameraStates IdleCameraState".split(" ");c.minigames.cartGame.smartCamera.cameraStates.IdleCameraState.__super__=c.minigames.cartGame.smartCamera.cameraStates.CameraState;
c.minigames.cartGame.smartCamera.cameraStates.IdleCameraState.prototype=r(c.minigames.cartGame.smartCamera.cameraStates.CameraState.prototype,{onUpdate:function(){c.minigames.cartGame.smartCamera.cameraStates.CameraState.prototype.onUpdate.call(this)},__class__:c.minigames.cartGame.smartCamera.cameraStates.IdleCameraState});c.minigames.gems={};c.minigames.gems.GemManager=function(){b.Manager.call(this);this._numGems=new b.utilities.WatchableValue(c.GameTracker.getInstance().getSaveData().getItem("numGems",
0));this._numGems.addEventListener("change",s(this,this.onNumGemsChange))};c.minigames.gems.GemManager.__name__=["game","minigames","gems","GemManager"];c.minigames.gems.GemManager.getInstance=function(){null==c.minigames.gems.GemManager._instance&&(c.minigames.gems.GemManager._instance=new c.minigames.gems.GemManager,b.Root.getInstance().addManager(c.minigames.gems.GemManager._instance));return c.minigames.gems.GemManager._instance};c.minigames.gems.GemManager.__super__=b.Manager;c.minigames.gems.GemManager.prototype=
r(b.Manager.prototype,{init:function(){b.Manager.prototype.init.call(this)},getGems:function(){return this._numGems.get()},setGems:function(a){this._numGems.set(a);0>this._numGems.get()&&this._numGems.set(0)},addGems:function(a){this._numGems.set(this._numGems.get()+a);0>this._numGems.get()&&this._numGems.set(0)},subtractGems:function(a){this._numGems.set(this._numGems.get()-a);0>this._numGems.get()&&this._numGems.set(0)},onNumGemsChange:function(a){c.GameTracker.getInstance().getSaveData().setItem("numGems",
a.value)},__class__:c.minigames.gems.GemManager});c.minigames.memoryGame={};c.minigames.memoryGame.Card=function(a,c){this._isBadCard=!1;this._isFlippable=!0;this._prevScaleX=1;this._isFlipped=this._isFlipping=!1;b.Component.call(this,a);this._value=c};c.minigames.memoryGame.Card.__name__=["game","minigames","memoryGame","Card"];c.minigames.memoryGame.Card.__super__=b.Component;c.minigames.memoryGame.Card.prototype=r(b.Component.prototype,{getBadCard:function(){return this._isBadCard},setBadCard:function(a){this._isBadCard=
a},getFlippable:function(){return this._isFlippable},setFlippable:function(a){this._isFlippable=a},getFlipped:function(){return this._isFlipped},getValue:function(){return this._value},init:function(){b.Component.prototype.init.call(this);this._button=this.getEntity().getComponent(b.components.Button);null==this._button&&(this._button=new b.components.Button(this.getEntity(),new b.Vector2D(130,130),null,s(this,this.onClick)));this._tweener=this.getEntity().getComponent(b.components.Tweener);null==
this._tweener&&(this._tweener=new b.components.Tweener(this.getEntity()));this._deferredActionComponent=this.getEntity().getComponent(b.components.DeferredActionComponent);null!=this._deferredActionComponent&&(this._deferredActionComponent=new b.components.DeferredActionComponent(this.getEntity()));this._pixiSprite=this.getEntity().getComponent(b.pixi.PixiSprite)},update:function(){b.Component.prototype.update.call(this);var a=this.getEntity().getScaleRef().x;0>a&&0<=this._prevScaleX?this.switchToCardFront():
0<a&&0>=this._prevScaleX&&this.switchToCardBack();this._prevScaleX=this.getEntity().getScaleRef().x},onClick:function(){this._isFlipped||(!this._isFlippable||this._isFlipping)||this.flip()},flip:function(){this._isFlipping=!0;this._isFlipped?this._tweener.addTween(this.getEntity().getScaleRef(),"x",this.getEntity().getScaleRef().x,1,0.35,b.components.tween.EasingFunctions.easeOutQuint,0,s(this,this.onFlipComplete)):(this._tweener.addTween(this.getEntity().getScaleRef(),"x",this.getEntity().getScaleRef().x,
-1,0.35,b.components.tween.EasingFunctions.easeOutQuint,0,s(this,this.onFlipComplete)),this.dispatchEvent(new c.minigames.memoryGame.CardEvent("startFlip",this)),b.audio.SoundManager.playSoundByName("sfx_card_flip_1"));this._isFlipped=!this._isFlipped},switchToCardBack:function(){this._pixiSprite.setTextureFromImageId("cardBack");this._pixiSprite.getScaleModifier().x=1},switchToCardFront:function(){this._isBadCard?this._pixiSprite.setTextureFromImageId("cardRedHerring"):this._pixiSprite.setTextureFromImageId("card"+
(this._value+1));this._pixiSprite.getScaleModifier().x=-1},onFlipComplete:function(){this._isFlipping=!1;this._isFlipped?this._isBadCard?this.dispatchEvent(new c.minigames.memoryGame.CardEvent("badCardFlip",this)):this.dispatchEvent(new c.minigames.memoryGame.CardEvent("flip",this)):this.dispatchEvent(new c.minigames.memoryGame.CardEvent("unflip",this))},dismiss:function(){this.getEntity().destroy()},__class__:c.minigames.memoryGame.Card});c.minigames.memoryGame.CardEvent=function(a,c){b.events.Event.call(this,
a);this._card=c};c.minigames.memoryGame.CardEvent.__name__=["game","minigames","memoryGame","CardEvent"];c.minigames.memoryGame.CardEvent.__super__=b.events.Event;c.minigames.memoryGame.CardEvent.prototype=r(b.events.Event.prototype,{getCard:function(){return this._card},__class__:c.minigames.memoryGame.CardEvent});c.minigames.memoryGame.MemoryGame=function(a){this._timeUntilPointLoss=2;this._timeElapsed=0;this._cardsCenterOffsetY=50;this._numPoints=this._cardsCenterOffsetX=0;this._currentRound=1;
this._numMatchesMade=this._matchGoal=0;c.minigames.Minigame.call(this,a);this._cards=[];this._flippedCards=[];this._minigameResults=new c.minigames.memoryGame.MemoryGameResults};c.minigames.memoryGame.MemoryGame.__name__=["game","minigames","memoryGame","MemoryGame"];c.minigames.memoryGame.MemoryGame.__super__=c.minigames.Minigame;c.minigames.memoryGame.MemoryGame.prototype=r(c.minigames.Minigame.prototype,{init:function(){c.minigames.Minigame.prototype.init.call(this);this.dispatchReady()},onTransitionToMinigame:function(){c.minigames.Minigame.prototype.onTransitionToMinigame.call(this);
this._deferredActionComponent=new b.components.DeferredActionComponent(this.getEntity());this._root=this.getGameState().addEntity();new b.ui.UiElement(this._root,this._uiPanel);this._pointsPerGem=t.parseInt(b.GameConfig.getProperty("memoryGame.pointsPerGem"));this._timePerRound=t.parseFloat(b.GameConfig.getProperty("memoryGame.timePerRound"));this._timePerRoundDecrementPerRound=t.parseFloat(b.GameConfig.getProperty("memoryGame.timePerRoundDecrementPerRound"));this._pointsPerMatch=t.parseInt(b.GameConfig.getProperty("memoryGame.pointsPerMatch"));
this._cardColumnSpacing=t.parseInt(b.GameConfig.getProperty("memoryGame.cardColumnSpacing"));this._cardRowSpacing=t.parseInt(b.GameConfig.getProperty("memoryGame.cardRowSpacing"));var a=this.getGameState().addEntity();new b.ui.UiElement(a,this._uiPanel);(new b.pixi.PixiSprite(a,"memoryGameBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);a=this.getGameState().addEntity();(new b.ui.UiElement(a,this._uiPanel)).setCoords(new b.Vector2D(-1,1));(new b.pixi.PixiSprite(a,"sweetvilleCharacters")).getSprite().anchor=
new PIXI.Point(0,1);this._timer=this.getGameState().addEntity();this._timerText=new b.pixi.PixiText(this._timer,"",{font:"32px league_gothic-webfont",fill:"#FFFFFF"},1);this._roundCounter=this.getGameState().addEntity();this._roundCounter.setPosition(-225,0);this._roundCounterText=new b.pixi.PixiText(this._roundCounter,"",{font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"left"},1);this._pointsCounter=this.getGameState().addEntity();this._pointsCounter.setPosition(225,0);this._pointsText=new b.pixi.PixiText(this._pointsCounter,
"",{font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"right"},1);a=this.getGameState().addEntity();(new b.pixi.PixiSprite(a,"uiBar")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(a,this._uiPanel)).setCoords(new b.Vector2D(0,-0.85));a.addChild(this._pointsCounter);a.addChild(this._roundCounter);a.addChild(this._timer);this._hasSeenTutorial?this.startGame():this.showTutorial()},startGame:function(){c.minigames.Minigame.prototype.startGame.call(this);this.generateCards()},generateCards:function(){if(null!=
this._cards)for(var a=this._cards.length,d=0;d<a;){var e=d++;this._cards[e].getEntity().destroy()}this._cards=[];this._isGameActive=!0;this._numRows=t.parseInt(b.GameConfig.getProperty("memoryGame.numRows"+this._currentRound));this._numCols=t.parseInt(b.GameConfig.getProperty("memoryGame.numCols"+this._currentRound));a=-(this._numCols-1)/2*this._cardColumnSpacing+this._cardsCenterOffsetX;d=-(this._numRows-1)/2*this._cardRowSpacing+this._cardsCenterOffsetY;5<=this._numCols&&(a+=85);this._cardValuePool=
[];1==this._currentRound&&(this._cardValuePool=[-1]);this._matchGoal=e=Math.floor(this._numRows*this._numCols/2);for(var f=[],n=0;11>n;){var g=n++;f.push(g)}for(n=0;n<e;){n++;for(var g=f.splice(b.utilities.Math2.randomInt(0,f.length),1)[0],h=0;2>h;)h++,this._cardValuePool.push(g)}e=0;for(f=this._numRows;e<f;)for(n=e++,g=0,h=this._numCols;g<h;){var k=g++,m=b.utilities.Math2.randomInt(0,this._cardValuePool.length),p=this._cardValuePool[m],k=c.minigames.memoryGame.MemoryGameFactory.createCard(a+k*this._cardColumnSpacing,
d+n*this._cardRowSpacing,p,this.getGameState()),q=k.getComponent(c.minigames.memoryGame.Card);q.addEventListener("flip",s(this,this.onCardFlip));q.addEventListener("unflip",s(this,this.onCardUnflip));q.addEventListener("startFlip",s(this,this.onStartCardFlip));q.addEventListener("badCardFlip",s(this,this.onBadCardFlip));k.addEventListener("destroy",s(this,this.onDestroyCard));-1==p&&q.setBadCard(!0);this._cardValuePool.splice(m,1);this._root.addChild(k);this._cards.push(q)}a=[].concat(this._cards);
for(d=0;0<a.length;)d++,f=b.utilities.Math2.randomInt(0,a.length),e=a[f].getEntity(),a.splice(f,1),f=new b.components.Tweener(e),n=b.utilities.Math2.randomFloat(800,1E3),g=b.utilities.Math2.randomFloat(100,500),0.5<b.utilities.Math2.randomFloat(0,1)&&(n*=-1),0.5<b.utilities.Math2.randomFloat(0,1)&&(g*=-1),f.addTween(e.getPositionRef(),"x",e.getLocalPosition().x+n,e.getLocalPosition().x,0.65,b.components.tween.EasingFunctions.easeOutQuad,0.025*d),f.addTween(e.getPositionRef(),"y",e.getLocalPosition().y+
g,e.getLocalPosition().y,0.65,b.components.tween.EasingFunctions.easeOutQuad,0.025*d),f.addTween(e.getRotationRef(),"z",b.utilities.Math2.randomFloat(-720,720),0,0.65,b.components.tween.EasingFunctions.easeOutQuad,0.025*d),h=b.utilities.Math2.randomFloat(3.5,4.5),f.addTween(e.getScaleRef(),"x",h,1,0.65,b.components.tween.EasingFunctions.easeOutQuad,0.025*d),f.addTween(e.getScaleRef(),"y",h,1,0.65,b.components.tween.EasingFunctions.easeOutQuad,0.025*d),e.translate(n,g)},update:function(){c.minigames.Minigame.prototype.update.call(this);
null!=this._roundCounterText&&this._roundCounterText.setTextString(C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_ROUND"),"%N",t.string(this._currentRound)));null!=this._pointsText&&this._pointsText.setTextString(C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_SCORE"),"%N",t.string(this._numPoints)))},updateGameplay:function(){c.minigames.Minigame.prototype.updateGameplay.call(this);this._timeUntilPointLoss-=b.Root.getDeltaTime();0>=this._timeUntilPointLoss&&(this._timeUntilPointLoss=
2,this._numPoints-=5,0>this._numPoints&&(this._numPoints=0));this._timeElapsed+=b.Root.getDeltaTime();this._timerText.setTextString(b.utilities.StringTools2.convertFloatToTime(this._timeElapsed));this._minigameResults.time+=b.Root.getDeltaTime()},enableCardFlips:function(){for(var a=this._cards.length,b=0;b<a;){var c=b++;this._cards[c].setFlippable(!0)}},disableCardFlips:function(){for(var a=this._cards.length,b=0;b<a;){var c=b++;this._cards[c].setFlippable(!1)}},onStartCardFlip:function(a){if(a.getCard().getBadCard())this.disableCardFlips();
else if(this._flippedCards.push(a.getCard()),2==this._flippedCards.length)this.onSelectCards()},onBadCardFlip:function(a){var b=this;this._flippedCards.push(a.getCard());a=a.getCard();c.EntityFactory.createFloatingText(a.getEntity().getPosition().x,a.getEntity().getPosition().y,"-50",this.getGameState(),"#FF0000");this._numPoints-=50;0>this._numPoints&&(this._numPoints=0);this._deferredActionComponent.addDeferredAction(1,function(){b.onMismatchCards()})},onCardFlip:function(a){},onCardUnflip:function(a){},
onSelectCards:function(){var a=this;this.disableCardFlips();for(var b=this._flippedCards.length,c=this._flippedCards[0],d=!0,n=1;n<b;){var g=n++,g=this._flippedCards[g];c.getValue()!=g.getValue()&&(d=!1)}this._deferredActionComponent.addDeferredAction(1,function(){if(d)a.onMatchCards();else a.onMismatchCards()})},onMatchCards:function(){for(var a=this._flippedCards.length,d=0;d<a;){var e=d++,e=this._flippedCards[e];c.EntityFactory.createFloatingText(e.getEntity().getPosition().x,e.getEntity().getPosition().y,
"+150",this.getGameState());var f=this.getGameState().addEntity();this.getEntity().addChild(f);f.setPosition(e.getEntity().getPosition().x,e.getEntity().getPosition().y);(new c.particles.ParticleEffect(f)).emit();f.destroy();e.dismiss()}this.enableCardFlips();this._numMatchesMade++;this._minigameResults.matches++;this._flippedCards=[];this._numPoints+=this._pointsPerMatch;if(this._numMatchesMade>=this._matchGoal)this.onMatchAllCards();b.audio.SoundManager.playSoundByName("sfx_card_match_1");b.achievements.AchievementsManager.getInstance().incrementValue("cardMatch",
1)},onMismatchCards:function(){for(var a=this._flippedCards.length,c=0;c<a;){var d=c++;this._flippedCards[d].flip()}this.enableCardFlips();this._flippedCards=[];b.audio.SoundManager.playSoundByName("sfx_card_flip_1")},onMatchAllCards:function(){this._numMatchesMade=this._matchGoal=0;this._timePerRound-=this._timePerRoundDecrementPerRound;0>this._timePerRound&&(this._timePerRound=0);3==this._currentRound?(this._minigameResults.score=this._numPoints,this.collectGems(Math.floor(this._numPoints/this._pointsPerGem)),
this.beatMinigame(),b.audio.SoundManager.playSoundByName("ui_whistle_1")):(this._currentRound++,y.utag.UtagManager.getInstance().link("RoundComplete: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),"games"),this.generateCards())},onDestroyCard:function(a){a=a.target.getComponent(c.minigames.memoryGame.Card);v.remove(this._cards,a)},showTutorial:function(){c.minigames.Minigame.prototype.showTutorial.call(this);var a=new c.minigames.MinigameTutorialState;
b.Root.getInstance().addGameState(a);var d=a.addEntity(),e=c.UiFactory.createFullscreenUiPanel(a);new b.ui.UiElement(d,e);new c.minigames.memoryGame.MemoryGameTutorial(d,"tutorialBg");a.addEventListener("destroy",s(this,this.onMemoryGameTutorialDestroy))},onMemoryGameTutorialDestroy:function(a){this.startGame()},__class__:c.minigames.memoryGame.MemoryGame});c.minigames.memoryGame.MemoryGameFactory=function(){};c.minigames.memoryGame.MemoryGameFactory.__name__=["game","minigames","memoryGame","MemoryGameFactory"];
c.minigames.memoryGame.MemoryGameFactory.createCard=function(a,d,e,f){f=f.addEntity();f.setPosition(a,d);(new b.pixi.PixiSprite(f,"cardBack")).getSprite().anchor=new PIXI.Point(0.5,0.5);new c.minigames.memoryGame.Card(f,e);return f};c.minigames.memoryGame.MemoryGameFactory.prototype={__class__:c.minigames.memoryGame.MemoryGameFactory};c.minigames.memoryGame.MemoryGameResults=function(){this.time=this.matches=0;c.minigames.MinigameResults.call(this);this.starGoals.push(b.GameConfig.getProperty("memoryGame.starGoal1"));
this.starGoals.push(b.GameConfig.getProperty("memoryGame.starGoal2"));this.starGoals.push(b.GameConfig.getProperty("memoryGame.starGoal3"))};c.minigames.memoryGame.MemoryGameResults.__name__=["game","minigames","memoryGame","MemoryGameResults"];c.minigames.memoryGame.MemoryGameResults.__super__=c.minigames.MinigameResults;c.minigames.memoryGame.MemoryGameResults.prototype=r(c.minigames.MinigameResults.prototype,{__class__:c.minigames.memoryGame.MemoryGameResults});c.minigames.memoryGame.MemoryGameTutorial=
function(a,b){c.minigames.MinigameTutorial.call(this,a,b)};c.minigames.memoryGame.MemoryGameTutorial.__name__=["game","minigames","memoryGame","MemoryGameTutorial"];c.minigames.memoryGame.MemoryGameTutorial.__super__=c.minigames.MinigameTutorial;c.minigames.memoryGame.MemoryGameTutorial.prototype=r(c.minigames.MinigameTutorial.prototype,{init:function(){c.minigames.MinigameTutorial.prototype.init.call(this);this.createNextButton(0,305);this.updatePage()},updatePage:function(){c.minigames.MinigameTutorial.prototype.updatePage.call(this);
switch(this._currentPage){case 0:this.setHeadingText(b.Localizer.getString("TUTORIAL_MEMORY_HEADING_1"));this.placeImage(-150,-60,"cardBack");this.placeImage(0,-45,"hairTutorialArrow");this.placeImage(150,-60,"card1");this.placeImage(-150,120,"card2");this.placeImage(0,135,"hairTutorialPlus");this.placeImage(150,120,"card2");break;case 1:this.getGameState().destroy()}},__class__:c.minigames.memoryGame.MemoryGameTutorial});c.minigames.puzzleBuilderGame={};c.minigames.puzzleBuilderGame.GridCell=function(a){this._puzzlePiece=
null;this._coords=a};c.minigames.puzzleBuilderGame.GridCell.__name__=["game","minigames","puzzleBuilderGame","GridCell"];c.minigames.puzzleBuilderGame.GridCell.prototype={getPuzzlePiece:function(){return this._puzzlePiece},setPuzzlePiece:function(a){this._puzzlePiece=a},getCandyId:function(){return null==this._puzzlePiece?0:this._puzzlePiece.getCandyId()},getCoords:function(){return this._coords},setCoords:function(a){this._coords.x=a.x;this._coords.y=a.y},__class__:c.minigames.puzzleBuilderGame.GridCell};
c.minigames.puzzleBuilderGame.PercentBarDisplay=function(a,c){b.Component.call(this,a);this._fillImage=c;this.construct()};c.minigames.puzzleBuilderGame.PercentBarDisplay.__name__=["game","minigames","puzzleBuilderGame","PercentBarDisplay"];c.minigames.puzzleBuilderGame.PercentBarDisplay.__super__=b.Component;c.minigames.puzzleBuilderGame.PercentBarDisplay.prototype=r(b.Component.prototype,{construct:function(){this._pixiSprite=new b.pixi.PixiSprite(this.getGameState().addEntity(),this._fillImage);
this._pixiSprite.getSprite().anchor=new PIXI.Point(0,0.5);this._mask=new PIXI.Graphics;this._pixiSprite.getSprite().mask=this._mask;this.getEntity().addChild(this._pixiSprite.getEntity())},init:function(){b.Component.prototype.init.call(this);this.setPercent(0)},setPercent:function(a){null==this._mask.parent&&null!=this._pixiSprite.getSprite().parent&&this._pixiSprite.getSprite().parent.addChild(this._mask);this._mask.clear();this._mask.beginFill();var b=this._pixiSprite.getSprite().width,c=-this._pixiSprite.getSprite().height/
2,d=this._pixiSprite.getSprite().height/2,n=[];n.push(0);n.push(c);n.push(b*a);n.push(c);n.push(b*a);n.push(d);n.push(0);n.push(d);this._mask.drawPolygon(n);this._mask.endFill()},__class__:c.minigames.puzzleBuilderGame.PercentBarDisplay});c.minigames.puzzleBuilderGame.PuzzleBuilderGame=function(a){this._timeUntilPointLoss=1;this._pointLossPerSecond=5;this._timeElapsed=0;this._timeLimitActive=!1;this._currentRound=1;this._numRounds=3;this._prevTimeLeft=this._numPoints=0;this._timeLeft=180;c.minigames.Minigame.call(this,
a);c.minigames.puzzleBuilderGame.PuzzleBuilderGame._instance=this;this._deferredActionComponent=new b.components.DeferredActionComponent(this.getEntity());this._minigameResults=new c.minigames.puzzleBuilderGame.PuzzleBuilderGameResults;this._timeLeft=b.GameConfig.getProperty("puzzleBuilder.timeLimit");this._numRounds=t.parseInt(b.GameConfig.getProperty("puzzleBuilder.numRounds"));this._pointLossPerSecond=t.parseInt(b.GameConfig.getProperty("puzzleBuilder.pointLossPerSecond"))};c.minigames.puzzleBuilderGame.PuzzleBuilderGame.__name__=
["game","minigames","puzzleBuilderGame","PuzzleBuilderGame"];c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance=function(){return c.minigames.puzzleBuilderGame.PuzzleBuilderGame._instance};c.minigames.puzzleBuilderGame.PuzzleBuilderGame.__super__=c.minigames.Minigame;c.minigames.puzzleBuilderGame.PuzzleBuilderGame.prototype=r(c.minigames.Minigame.prototype,{getPuzzleGrid:function(){return this._puzzleGrid},getPuzzlePieceData:function(){return this._puzzlePieceData},onTransitionToMinigame:function(){c.minigames.Minigame.prototype.onTransitionToMinigame.call(this);
var a=this.getGameState().addEntity();new b.ui.UiElement(a,this._uiPanel);(new b.pixi.PixiSprite(a,"puzzleGameBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._pointsCounter=this.getGameState().addEntity();this._pointsCounter.setPosition(175,0);var d={font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"right"};this._pointsText=new b.pixi.PixiText(this._pointsCounter,"",d,1);a=this.getGameState().addEntity();a.setPosition(-180,0);this._roundText=new b.pixi.PixiText(a,C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_ROUND"),
"%N","1"),d);this.parsePuzzlePieceData();this.parsePuzzleShapeData();this.generateGridForShape(this.getRandomShapeData());d=this.getGameState().addEntity();this._puzzlePieceSpawner=new c.minigames.puzzleBuilderGame.PuzzlePieceSpawner(d,this._puzzlePieceData);d=this.getGameState().addEntity();(new b.pixi.PixiSprite(d,"uiBar")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(d,this._uiPanel)).setCoords(new b.Vector2D(0,-0.85));d.addChild(this._pointsCounter);d.addChild(a);this._puzzlePieceSpawner.setIsActive(!1);
this._hasSeenTutorial?this.startGame():this.showTutorial()},showTutorial:function(){c.minigames.Minigame.prototype.showTutorial.call(this);var a=new c.minigames.MinigameTutorialState;b.Root.getInstance().addGameState(a);var d=a.addEntity(),e=c.UiFactory.createFullscreenUiPanel(a);new b.ui.UiElement(d,e);new c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial(d,"tutorialBg");a.addEventListener("destroy",s(this,this.onTutorialDestroy))},onTutorialDestroy:function(a){this.startGame()},startGame:function(){c.minigames.Minigame.prototype.startGame.call(this);
this._isGameActive=!0;this._puzzlePieceSpawner.setIsActive(!0)},refillShapeDataPool:function(){this._puzzleShapeDataPool=[];for(var a=this._puzzleShapeData.length,b=0;b<a;){var c=b++;this._puzzleShapeDataPool.push(this._puzzleShapeData[c])}},init:function(){c.minigames.Minigame.prototype.init.call(this);this.dispatchReady()},update:function(){c.minigames.Minigame.prototype.update.call(this);var a=Math.floor(this._timeLeft);a!=this._prevTimeLeft&&10>a&&(b.audio.SoundManager.playSoundByName("ui_clock_tick_1"),
this._prevTimeLeft=a);null!=this._timeDisplay&&this._timeDisplay.setPercent(1-this._timeLeft/this._timeLimit);null!=this._pointsText&&this._pointsText.setTextString(C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_SCORE"),"%N",t.string(this._numPoints)));this._timeElapsed+=b.Root.getDeltaTime();this._minigameResults.timeElapsed=this._timeElapsed},updateGameplay:function(){c.minigames.Minigame.prototype.updateGameplay.call(this);this._timeLimitActive&&(this._timeLeft-=b.Root.getDeltaTime(),
0>=this._timeLeft&&(this._timeLeft=0,this.beatMinigame(),b.audio.SoundManager.playSoundByName("ui_whistle_1")));this._timeUntilPointLoss-=b.Root.getDeltaTime();0>=this._timeUntilPointLoss&&(this._timeUntilPointLoss=1,this._numPoints-=this._pointLossPerSecond,0>this._numPoints&&(this._numPoints=0))},generateGridForShape:function(a){var d=this.getGameState().addEntity(),e=this.getGameState().addEntity();d.addChild(e);d=new b.ui.UiElement(d,this._uiPanel);this._puzzleGrid=new c.minigames.puzzleBuilderGame.PuzzleGrid(e);
this._puzzleGrid.setWidth(a.getWidth());this._puzzleGrid.setHeight(a.getHeight());this._puzzleGrid.setShapeData(a);this._puzzleGrid.initializeGrid();this._puzzleGrid.generateShapeSpaces();e.setPosition(0.5*-(this._puzzleGrid.getGridCellWidth()*this._puzzleGrid.getWidth()),0.5*-(this._puzzleGrid.getGridCellHeight()*this._puzzleGrid.getHeight()));"Fish"==a.getImageId()&&e.translate(50,0);"Butterfly"==a.getImageId()&&e.translate(50,0);"Gem"==a.getImageId()&&e.translate(50,0);a=new b.Vector2D(0,0.35);
d.setCoords(new b.Vector2D(a.x,a.y))},parsePuzzlePieceData:function(){this._puzzlePieceData=[];var a=new w.xml.Fast(B.parse(b.managers.AssetManager.getAsset("puzzleBuilderPieces")));if(a.hasNode.resolve("pieces"))for(a=a.node.resolve("pieces").nodes.resolve("piece").iterator();a.hasNext();){var d=a.next(),d=c.minigames.puzzleBuilderGame.PuzzlePieceData.getFromXmlNode(d);this._puzzlePieceData.push(d)}},parsePuzzleShapeData:function(){this._puzzleShapeData=[];var a=new w.xml.Fast(B.parse(b.managers.AssetManager.getAsset("puzzleBuilderShapes")));
if(a.hasNode.resolve("shapes"))for(a=a.node.resolve("shapes").nodes.resolve("shape").iterator();a.hasNext();){var d=a.next(),d=c.minigames.puzzleBuilderGame.PuzzleShapeData.getFromXmlNode(d);this._puzzleShapeData.push(d)}this.refillShapeDataPool()},onPlacePuzzlePiece:function(a){this._numPoints+=this._puzzleGrid.getScoreForCandyId(a.getCandyId())},onCompletePuzzleGridShape:function(){var a=this._puzzleGrid.getEntity().getParent().getComponent(b.ui.UiElement),d=new b.components.Tweener(this._puzzleGrid.getEntity());
(new b.components.tween.GroupFader(this._puzzleGrid.getEntity())).fadeTo(1,0,0.35,null,b.components.tween.EasingFunctions.easeOutQuad);this._revealedShapeEntity=this.getGameState().addEntity();this._revealedShapeEntity.setPosition(-20,-50);var e=new b.pixi.PixiSprite(this._revealedShapeEntity,this._puzzleGrid.getShapeData().getImageRevealAsset());e.getSprite().anchor=new PIXI.Point(0.5,0.5);a.getEntity().addChild(this._revealedShapeEntity);e.getSprite().alpha=0;d.addTween(e.getContainer(),"alpha",
0,1,0.35,b.components.tween.EasingFunctions.easeOutQuad);this._deferredActionComponent.addDeferredAction(2,s(this,this.onCompletePuzzleDelayElapse));this._numPoints+=this._puzzleGrid.getGridScore();a=this._minigameResults;a.stars=3;a.score=this._numPoints;a.collectedPuzzles.push(this._puzzleGrid.getShapeData().getImageId());b.audio.SoundManager.playSoundByName("ui_gem_bells_2");y.utag.UtagManager.getInstance().link("RoundComplete: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),
"games");this._currentRound++;this._currentRound<=this._numRounds&&(a=b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_ROUND"),a=C.replace(a,"%N",t.string(this._currentRound)),this._roundText.setTextString(a))},onCompletePuzzleDelayElapse:function(){this._puzzleGrid.getEntity().destroy();this._revealedShapeEntity.destroy();this._revealedShapeEntity=null;this._currentRound<=this._numRounds?this.generateGridForShape(this.getRandomShapeData()):this.beatMinigame();null!=this._puzzleGrid.getEntity().getParent()&&
this._puzzleGrid.getEntity().getParent().getComponent(b.ui.UiElement).setScale(1,1)},getRandomShapeData:function(){0==this._puzzleShapeDataPool.length&&this.refillShapeDataPool();var a=b.utilities.Math2.randomInt(0,this._puzzleShapeDataPool.length),a=this._puzzleShapeDataPool[a];v.remove(this._puzzleShapeDataPool,a);return a},eatPuzzlePiece:function(a){var c=a.getEntity();c.getComponent(b.pixi.PixiSprite).setUpdateParentingEveryFrame(!0);this.getGameState().bringEntityToFront(c);a=c.getComponent(b.components.Tweener);
a.addTween(c.getPositionRef(),"x",c.getPositionRef().x,-150,1.5,b.components.tween.EasingFunctions.linear,0);a.addTween(c.getPositionRef(),"y",c.getPositionRef().y,265,1.5,b.components.tween.EasingFunctions.linear,0);a.addTween(c.getScaleRef(),"x",1,2,0.75,b.components.tween.EasingFunctions.easeOutQuad,0);a.addTween(c.getScaleRef(),"y",1,2,0.75,b.components.tween.EasingFunctions.easeOutQuad,0);a.addTween(c.getScaleRef(),"x",2,0,0.75,b.components.tween.EasingFunctions.easeOutQuad,0.75);a.addTween(c.getScaleRef(),
"y",2,0,0.75,b.components.tween.EasingFunctions.easeOutQuad,0.75,function(){c.destroy()});a.addTween(c.getRotationRef(),"z",0,180,0.75,b.components.tween.EasingFunctions.linear,0.75)},destroy:function(){c.minigames.Minigame.prototype.destroy.call(this);c.minigames.puzzleBuilderGame.PuzzleBuilderGame._instance==this&&(c.minigames.puzzleBuilderGame.PuzzleBuilderGame._instance=null)},__class__:c.minigames.puzzleBuilderGame.PuzzleBuilderGame});c.minigames.puzzleBuilderGame.PuzzleBuilderGameResults=function(){this.timeElapsed=
0;this.collectedPuzzles=[];this.stars=0;c.minigames.MinigameResults.call(this);this.starGoals.push(b.GameConfig.getProperty("puzzleBuilder.starGoal1"));this.starGoals.push(b.GameConfig.getProperty("puzzleBuilder.starGoal2"));this.starGoals.push(b.GameConfig.getProperty("puzzleBuilder.starGoal3"))};c.minigames.puzzleBuilderGame.PuzzleBuilderGameResults.__name__=["game","minigames","puzzleBuilderGame","PuzzleBuilderGameResults"];c.minigames.puzzleBuilderGame.PuzzleBuilderGameResults.__super__=c.minigames.MinigameResults;
c.minigames.puzzleBuilderGame.PuzzleBuilderGameResults.prototype=r(c.minigames.MinigameResults.prototype,{__class__:c.minigames.puzzleBuilderGame.PuzzleBuilderGameResults});c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial=function(a,b){c.minigames.MinigameTutorial.call(this,a,b)};c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial.__name__=["game","minigames","puzzleBuilderGame","PuzzleBuilderGameTutorial"];c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial.__super__=c.minigames.MinigameTutorial;
c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial.prototype=r(c.minigames.MinigameTutorial.prototype,{init:function(){c.minigames.MinigameTutorial.prototype.init.call(this);this.createNextButton(0,305);this.updatePage()},updatePage:function(){c.minigames.MinigameTutorial.prototype.updatePage.call(this);switch(this._currentPage){case 0:this.setHeadingText(b.Localizer.getString("TUTORIAL_PUZZLE_HEADING_1"));this.placeImage(-35,20,"puzzleGameTutorialGrid").setScale(1,1);this.startDragSequence();
break;case 1:null!=this._dragSequence&&this._dragSequence.destroy();this.setHeadingText(b.Localizer.getString("TUTORIAL_PUZZLE_HEADING_3"));this.placeImage(-85,-140,"puzzlePiece1_11").setScale(1.15,1.15);this.placeText(15,-125,b.Localizer.getString("TUTORIAL_PUZZLE_BODY_3_A"),82,"left").getComponent(b.pixi.PixiText).getText().anchor=new PIXI.Point(0,0.5);this.placeImage(-85,10,"puzzlePiece1_1").setScale(1.15,1.15);this.placeText(15,20,b.Localizer.getString("TUTORIAL_PUZZLE_BODY_3_B"),82,"left").getComponent(b.pixi.PixiText).getText().anchor=
new PIXI.Point(0,0.5);this.placeImage(-85,160,"puzzlePiece1_8").setScale(1.15,1.15);this.placeText(15,175,b.Localizer.getString("TUTORIAL_PUZZLE_BODY_3_C"),82,"left").getComponent(b.pixi.PixiText).getText().anchor=new PIXI.Point(0,0.5);break;case 2:this.getGameState().destroy()}},startDragSequence:function(){var a=this;this._dragSequence=this.getGameState().addEntity();this._placementsContainer.addChild(this._dragSequence);this._puzzlePiece=this.getGameState().addEntity();(new b.pixi.PixiSprite(this._puzzlePiece,
"puzzleGameTutorialPiece")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._dragSequence.addChild(this._puzzlePiece);console.log(this._puzzlePiece);this._hand=this.getGameState().addEntity();var c=new b.pixi.PixiSprite(this._hand,"puzzleGameTutorialHand");c.getSprite().anchor=new PIXI.Point(0.2,0.2);this._dragSequence.addChild(this._hand);(new b.components.FollowEntity(this._puzzlePiece,this._hand)).setFollowLocal(!0);var d=new b.Vector3D(206,-174),f=new b.Vector3D(124,94);this._hand.setPosition(d.x,
d.y);var n=new b.components.Tweener(this._hand),g=new b.components.DeferredActionComponent(this._hand);n.addTween(this._hand.getPositionRef(),"x",d.x,f.x,1,b.components.tween.EasingFunctions.linear,1);n.addTween(this._hand.getPositionRef(),"y",d.y,f.y,1,b.components.tween.EasingFunctions.linear,1);g.addDeferredAction(4,function(){n.addTween(c.getSprite(),"alpha",1,0,0.35,b.components.tween.EasingFunctions.linear,null,function(){a._dragSequence.destroy();a.startDragSequence()})})},__class__:c.minigames.puzzleBuilderGame.PuzzleBuilderGameTutorial});
c.minigames.puzzleBuilderGame.PuzzleGrid=function(a){this._width=this._height=8;this._gridCellWidth=this._gridCellHeight=56;b.Component.call(this,a);new b.pixi.PixiContainer(this.getEntity())};c.minigames.puzzleBuilderGame.PuzzleGrid.__name__=["game","minigames","puzzleBuilderGame","PuzzleGrid"];c.minigames.puzzleBuilderGame.PuzzleGrid.__super__=b.Component;c.minigames.puzzleBuilderGame.PuzzleGrid.prototype=r(b.Component.prototype,{getShapeData:function(){return this._puzzleShapeData},setShapeData:function(a){this._puzzleShapeData=
a},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getHeight:function(){return this._height},setHeight:function(a){this._height=a},getGridCellWidth:function(){return this._gridCellWidth},getGridCellHeight:function(){return this._gridCellHeight},init:function(){b.Component.prototype.init.call(this);this._placedPieces=[];this._gridCells=[]},update:function(){b.Component.prototype.update.call(this)},initializeGrid:function(){var a=new b.pixi.PixiSprite(this.getGameState().addEntity(),
this._puzzleShapeData.getImageAsset());this.getEntity().addChild(this.getGameState().addEntity());a.getSprite().anchor=new PIXI.Point(0.5,0.5);a.getEntity().setPosition(this._width/2*this._gridCellWidth-this._gridCellWidth/2+10,this._height/2*this._gridCellHeight-this._gridCellHeight/2+6);this.getEntity().addChild(a.getEntity());this._gridData=new c.minigames.puzzleBuilderGame.PuzzleGridData(this._width,this._height)},generateShapeSpaces:function(){},gridCoordsToLocalPosition:function(a,c){return new b.Vector2D(a*
this._gridCellWidth,c*this._gridCellHeight)},localPositionToGridCoords:function(a,c){var d=new b.Vector2D(Math.floor((a+0.5*this._gridCellWidth)/this._gridCellWidth),Math.floor((c+0.5*this._gridCellHeight)/this._gridCellHeight));0>d.x&&(d.x=0);0>d.y&&(d.y=0);d.x>=this._width&&(d.x=this._width-1);d.y>=this._height&&(d.y=this._height-1);return d},mousePositionToGridCoords:function(){var a=b.managers.InputManager.getInstance().getMousePosition(),c=this.getEntity().getPosition();return this.localPositionToGridCoords(a.x-
c.x,a.y-c.y)},getPositionInBounds:function(a,b){var c=this.getEntity().getPosition(),d=this._gridCellWidth*this._width,n=this._gridCellHeight*this._height;return a>c.x-60&&a<c.x+d+60&&b>c.y-60&&b<c.y+n+60},getPieceFitsAtCoords:function(a,b,c){for(var d=0,n=c.getCoverageHeight();d<n;)for(var g=d++,h=0,k=c.getCoverageWidth();h<k;){var m=h++,p=a+m,q=b+g;if(0!=c.getCoverageByCoords(m,g)&&(0>p||0>q||p>=this._width||q>=this._height||0!=this._gridData.getGridCellByCoords(p,q).getCandyId()||!this._puzzleShapeData.getSpaceSlotAtCoords(p,
q)))return!1}return!0},occupyCellsWithPuzzlePiece:function(a,b,c){for(var d=0,n=c.getPuzzlePieceData().getCoverageHeight();d<n;)for(var g=d++,h=0,k=c.getPuzzlePieceData().getCoverageWidth();h<k;){var m=h++;0!=c.getPuzzlePieceData().getCoverageByCoords(m,g)&&this._gridData.getGridCellByCoords(a+m,b+g).setPuzzlePiece(c)}this._placedPieces.push(c)},freeCellsWithPuzzlePiece:function(a,b,c){for(var d=0,n=c.getPuzzlePieceData().getCoverageHeight();d<n;)for(var g=d++,h=0,k=c.getPuzzlePieceData().getCoverageWidth();h<
k;){var m=h++;0!=c.getPuzzlePieceData().getCoverageByCoords(m,g)&&this._gridData.getGridCellByCoords(a+m,b+g).setPuzzlePiece(null)}v.remove(this._placedPieces,c)},checkShapeFilled:function(){for(var a=0,b=this._height;a<b;)for(var c=a++,d=0,n=this._width;d<n;){var g=d++;if(this._puzzleShapeData.getSpaceSlotAtCoords(g,c)&&0==this._gridData.getGridCellByCoords(g,c).getCandyId())return!1}return!0},getScoreForCandyId:function(a){var c=[];c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece1PointValue")));
c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece2PointValue")));c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece3PointValue")));c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece4PointValue")));c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece5PointValue")));c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece6PointValue")));c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece7PointValue")));c.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece8PointValue")));
return c[a-1]},getGridScore:function(){var a=[];a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece1PointValue")));a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece2PointValue")));a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece3PointValue")));a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece4PointValue")));a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece5PointValue")));a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece6PointValue")));
a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece7PointValue")));a.push(t.parseInt(b.GameConfig.getProperty("puzzleBuilder.piece8PointValue")));for(var c=0,d=this._placedPieces.length,f=0;f<d;)var n=f++,c=c+a[this._placedPieces[n].getCandyId()-1];return c},__class__:c.minigames.puzzleBuilderGame.PuzzleGrid});c.minigames.puzzleBuilderGame.PuzzleGridData=function(a,d){this._width=a;this._height=d;this._gridCells=[];for(var e=0,f=this._height;e<f;)for(var n=e++,g=0,h=this._width;g<h;){var k=
g++,k=new c.minigames.puzzleBuilderGame.GridCell(new b.Vector2D(k,n));this._gridCells.push(k)}};c.minigames.puzzleBuilderGame.PuzzleGridData.__name__=["game","minigames","puzzleBuilderGame","PuzzleGridData"];c.minigames.puzzleBuilderGame.PuzzleGridData.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},getGridCellByCoords:function(a,b){return this._gridCells[b*this._width+a]},__class__:c.minigames.puzzleBuilderGame.PuzzleGridData};c.minigames.puzzleBuilderGame.PuzzlePiece=
function(a){this._isTweening=!1;this._offsetX=this._offsetY=0;this._col=this._row=-1;this._isDragging=this._isPlaced=!1;this._pixiSprite=null;b.Component.call(this,a)};c.minigames.puzzleBuilderGame.PuzzlePiece.__name__=["game","minigames","puzzleBuilderGame","PuzzlePiece"];c.minigames.puzzleBuilderGame.PuzzlePiece.__super__=b.Component;c.minigames.puzzleBuilderGame.PuzzlePiece.prototype=r(b.Component.prototype,{getPuzzlePieceData:function(){return this._puzzlePieceData},setPuzzlePieceData:function(a){this._puzzlePieceData=
a;this.updateDisplay();this._startLifetime=this._lifetime=b.GameConfig.getProperty("puzzleBuilder.piece"+this.getCandyId()+"Lifetime");this._halfLife=this._startLifetime/2},getCandyId:function(){return this._puzzlePieceData.getCandyId()},init:function(){b.Component.prototype.init.call(this);var a=this._pixiSprite.getSprite().width,d=this._pixiSprite.getSprite().height,e=a+30,f=d+30;this._button=new b.components.Button(this.getEntity(),new b.Vector2D(e,f),new b.Vector2D(0.5*a,0.5*d));this._button.setOnMouseDown(s(this,
this.onMouseDown));this._simpleMovement=this.getSiblingComponent(b.components.SimpleMovement);this._pixiSprite=this.getSiblingComponent(b.pixi.PixiSprite);this._tweener=new b.components.Tweener(this.getEntity());this._alphaBlinker=new b.components.AlphaBlinker(this.getEntity(),[c.minigames.puzzleBuilderGame.PuzzlePiece.HALF_LIFE_ALPHA_VALUE,0.2]);this._offsetX=0.5*-this._pixiSprite.getSprite().width;this._offsetY=0.5*-this._pixiSprite.getSprite().height;1==this._puzzlePieceData.getCoverageWidth()?
this._offsetX-=2:2==this._puzzlePieceData.getCoverageWidth()&&(this._offsetX+=28);1==this._puzzlePieceData.getCoverageHeight()?this._offsetY-=2:2==this._puzzlePieceData.getCoverageHeight()&&(this._offsetY+=28)},onMouseDown:function(){this._isDragging=!0;this._simpleMovement.setIsActive(!1);this._dragReturnPosition=this.getEntity().getPosition();this._button.setIsActive(!1);this._isPlaced||b.audio.SoundManager.playSoundByName("sfx_pop_1")},onMouseUp:function(){if(this._isDragging){this._isDragging=
!1;var a=c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().getPuzzleGrid(),d=b.managers.InputManager.getInstance().getMousePosition(),e=a.mousePositionToGridCoords(),f=!1;a.getPositionInBounds(d.x,d.y)&&a.getPieceFitsAtCoords(e.x,e.y,this.getPuzzlePieceData())&&(f=!0,this.placeAtGridCoords(e.x,e.y),b.audio.SoundManager.playSoundByName("sfx_pop_1"));f||this.returnToDragStart()}},placeAtGridCoords:function(a,b){var d=c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().getPuzzleGrid(),
f=d.gridCoordsToLocalPosition(a,b);d.getEntity().addChild(this.getEntity());this.getEntity().setPosition(f.x+this._offsetX,f.y+this._offsetY);d.occupyCellsWithPuzzlePiece(a,b,this);this._col=a;this._row=b;this._isPlaced=!0;c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().onPlacePuzzlePiece(this);if(d.checkShapeFilled())c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().onCompletePuzzleGridShape()},returnToDragStart:function(){this._tweener.addTween(this.getEntity().getPositionRef(),
"x",this.getEntity().getPosition().x,this._dragReturnPosition.x,0.35,b.components.tween.EasingFunctions.easeOutQuad,0,s(this,this.onReturnTweenComplete));this._tweener.addTween(this.getEntity().getPositionRef(),"y",this.getEntity().getPosition().y,this._dragReturnPosition.y,0.35,b.components.tween.EasingFunctions.easeOutQuad,0,s(this,this.onReturnTweenComplete));this._isTweening=!0},onReturnTweenComplete:function(){this._isTweening=!1;this._simpleMovement.setIsActive(!0);this._button.setIsActive(!0)},
update:function(){b.Component.prototype.update.call(this);if(this._isDragging){c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().getPuzzleGrid();var a=b.managers.InputManager.getInstance().getMousePosition();this.getEntity().setPosition(a.x+this._offsetX,a.y+this._offsetY)}this._isPlaced&&0<this._lifetime&&(a=this._lifetime,this._lifetime-=b.Root.getDeltaTime(),0>=this._lifetime?(this._lifetime=0,this._alphaBlinker.setIsActive(!1),this._pixiSprite.getSprite().alpha=1,this.onLifetimeElapse()):
(c.minigames.puzzleBuilderGame.PuzzlePiece.BLINK_TIME<a&&c.minigames.puzzleBuilderGame.PuzzlePiece.BLINK_TIME>=this._lifetime&&this._alphaBlinker.injectBlinkDuration(c.minigames.puzzleBuilderGame.PuzzlePiece.BLINK_TIME),c.minigames.puzzleBuilderGame.PuzzlePiece.BLINK_TIME>this._lifetime?this._alphaBlinker.setTimePerLevel(b.utilities.Math2.lerp(c.minigames.puzzleBuilderGame.PuzzlePiece.MAX_BLINK_SPEED,c.minigames.puzzleBuilderGame.PuzzlePiece.MIN_BLINK_SPEED,1-this._lifetime/c.minigames.puzzleBuilderGame.PuzzlePiece.BLINK_TIME)):
this._halfLife>this._lifetime&&(this._pixiSprite.getSprite().alpha=b.utilities.Math2.lerp(this._pixiSprite.getSprite().alpha,c.minigames.puzzleBuilderGame.PuzzlePiece.HALF_LIFE_ALPHA_VALUE,b.Root.getDeltaTime()*c.minigames.puzzleBuilderGame.PuzzlePiece.HALF_LIFE_ALPHA_FADE_SPEED))));this._isDragging||this._isTweening||(a=this.getEntity().getPosition(),a.x<c.minigames.puzzleBuilderGame.PuzzlePiece.DESTROY_LEFT?this.getEntity().destroy():a.x>c.minigames.puzzleBuilderGame.PuzzlePiece.DESTROY_RIGHT&&
this.getEntity().destroy())},onLifetimeElapse:function(){c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().getPuzzleGrid().freeCellsWithPuzzlePiece(this._col,this._row,this);c.minigames.puzzleBuilderGame.PuzzleBuilderGame.getInstance().eatPuzzlePiece(this)},updateDisplay:function(){null==this._pixiSprite&&(this._pixiSprite=this.getEntity().getComponent(b.pixi.PixiSprite));var a=this._puzzlePieceData.getImageAsset();this._pixiSprite.setTextureFromImageId(a)},handleMessage:function(a,c){b.Component.prototype.handleMessage.call(this,
a,c);switch(a){case "mouseUp":this.onMouseUp()}},__class__:c.minigames.puzzleBuilderGame.PuzzlePiece});c.minigames.puzzleBuilderGame.PuzzlePieceData=function(a,b,c,d,n){this._coverageHeight=1;this._coverageWidth=3;this._imageAsset=a;this._coverageWidth=c;this._coverageHeight=d;this._coverage=n;this._candyId=b};c.minigames.puzzleBuilderGame.PuzzlePieceData.__name__=["game","minigames","puzzleBuilderGame","PuzzlePieceData"];c.minigames.puzzleBuilderGame.PuzzlePieceData.getFromXmlNode=function(a){var b=
a.node.resolve("imageAsset").get_innerData(),d=t.parseInt(a.node.resolve("candyId").get_innerData()),f=t.parseInt(a.node.resolve("coverageWidth").get_innerData()),n=t.parseInt(a.node.resolve("coverageHeight").get_innerData()),g=[];a=a.node.resolve("coverage").get_innerData().split(",");for(var h=a.length,k=0;k<h;){var m=k++;g.push(t.parseInt(a[m]))}if(f*n!=a.length)throw"Defined coverage does not match the coverageWidth and coverageHeight for piece with imageAsset "+b;return new c.minigames.puzzleBuilderGame.PuzzlePieceData(b,
d,f,n,g)};c.minigames.puzzleBuilderGame.PuzzlePieceData.prototype={getImageAsset:function(){return this._imageAsset},getCoverageWidth:function(){return this._coverageWidth},getCoverageHeight:function(){return this._coverageHeight},getCoverage:function(){return this._coverage},getCandyId:function(){return this._candyId},getCoverageByCoords:function(a,b){return this._coverage[b*this._coverageWidth+a]},__class__:c.minigames.puzzleBuilderGame.PuzzlePieceData};c.minigames.puzzleBuilderGame.PuzzlePieceSpawner=
function(a,c){this._spawnFromLeft=!1;this._bottom=325;this._top=100;this._right=1024;this._left=-100;this._maxPieceSpeed=250;this._minPieceSpeed=100;this._maxTimeUntilNextPiece=2;this._minTimeUntilNextPiece=1;this._timeUntilNextPiece=0;b.Component.call(this,a);this._puzzlePieceDataPool=c};c.minigames.puzzleBuilderGame.PuzzlePieceSpawner.__name__=["game","minigames","puzzleBuilderGame","PuzzlePieceSpawner"];c.minigames.puzzleBuilderGame.PuzzlePieceSpawner.__super__=b.Component;c.minigames.puzzleBuilderGame.PuzzlePieceSpawner.prototype=
r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);this.rollNextPiece()},update:function(){b.Component.prototype.update.call(this);this._timeUntilNextPiece-=b.Root.getDeltaTime();0>=this._timeUntilNextPiece&&(this.onNextPieceTimeElapse(),this.rollNextPiece())},onNextPieceTimeElapse:function(){var a=this._puzzlePieceDataPool[b.utilities.Math2.randomInt(0,this._puzzlePieceDataPool.length)],d=this.createPuzzlePiece(a).getComponent(c.minigames.puzzleBuilderGame.PuzzlePiece),
e=b.utilities.Math2.randomFloat(this._top,this._bottom),f=new b.components.SimpleMovement(d.getEntity()),n=0;switch(a.getCandyId()){case 1:n=t.parseFloat(b.GameConfig.getProperty("puzzleBuilder.piece1Speed"));break;case 2:n=t.parseFloat(b.GameConfig.getProperty("puzzleBuilder.piece2Speed"));break;case 3:n=t.parseFloat(b.GameConfig.getProperty("puzzleBuilder.piece3Speed"))}this._spawnFromLeft?(a=this._left,f.setVelocity(n,0)):(a=this._right,f.setVelocity(-n,0));e=new b.Vector3D(a,e);d.getEntity().setPosition(e.x,
e.y)},rollNextPiece:function(){this._spawnFromLeft=!this._spawnFromLeft;this._timeUntilNextPiece=b.utilities.Math2.randomFloat(this._minTimeUntilNextPiece,this._maxTimeUntilNextPiece)},createPuzzlePiece:function(a){var d=this.getGameState().addEntity();(new b.pixi.PixiSprite(d,"")).setUpdateParentingEveryFrame(!0);(new c.minigames.puzzleBuilderGame.PuzzlePiece(d)).setPuzzlePieceData(a);d.setScale(1.15,1.15);return d},__class__:c.minigames.puzzleBuilderGame.PuzzlePieceSpawner});c.minigames.puzzleBuilderGame.PuzzleShapeData=
function(a,b,c,d){this._imageId=a;this._width=b;this._height=c;this._spaces=d};c.minigames.puzzleBuilderGame.PuzzleShapeData.__name__=["game","minigames","puzzleBuilderGame","PuzzleShapeData"];c.minigames.puzzleBuilderGame.PuzzleShapeData.getFromXmlNode=function(a){var b=a.node.resolve("imageId").get_innerData(),d=t.parseInt(a.node.resolve("width").get_innerData()),f=t.parseInt(a.node.resolve("height").get_innerData()),n=[];a=a.node.resolve("spaces").get_innerData().split(",");for(var g=a.length,
h=0;h<g;){var k=h++;n.push(t.parseInt(a[k]))}if(d*f!=a.length)throw"Defined spaces do not match the width and height for shape with imageId "+b;return new c.minigames.puzzleBuilderGame.PuzzleShapeData(b,d,f,n)};c.minigames.puzzleBuilderGame.PuzzleShapeData.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},getSpaces:function(){return this._spaces},getImageId:function(){return this._imageId},getImageAsset:function(){return"puzzle"+this._imageId},getImageRevealAsset:function(){return"puzzleReveal"+
this._imageId},getSpaceSlotAtCoords:function(a,b){return 1==this._spaces[b*this._width+a]},__class__:c.minigames.puzzleBuilderGame.PuzzleShapeData};c.minigames.puzzleBuilderGame.StarDisplay=function(a,c,d,f,n){this._spacing=0;this._emptyImage=this._fullImage="";this._numStars=this._numStarsEarned=0;b.Component.call(this,a);this._numStars=c;this._emptyImage=d;this._fullImage=f;this._spacing=n;this._earnedStars=[];this._tweener=new b.components.Tweener(a)};c.minigames.puzzleBuilderGame.StarDisplay.__name__=
["game","minigames","puzzleBuilderGame","StarDisplay"];c.minigames.puzzleBuilderGame.StarDisplay.__super__=b.Component;c.minigames.puzzleBuilderGame.StarDisplay.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this);for(var a=0,c=this._numStars;a<c;){var d=a++,f=this.getGameState().addEntity();f.setPosition(d*this._spacing,0);(new b.pixi.PixiSprite(f,this._emptyImage)).getSprite().anchor=new PIXI.Point(0.5,0.5);this.getEntity().addChild(f);f=this.getGameState().addEntity();
f.setPosition(d*this._spacing,0);d=new b.pixi.PixiSprite(f,this._fullImage);d.getSprite().anchor=new PIXI.Point(0.5,0.5);d.getContainer().alpha=0;this.getEntity().addChild(f);this._earnedStars.push(f)}},setNumStarsEarned:function(a){var c=this._numStarsEarned;this._numStarsEarned=Math.min(this._numStars,a);if(this._numStarsEarned>c)for(a=c,c=this._numStarsEarned;a<c;){var d=a++,d=this._earnedStars[d],f=d.getComponent(b.pixi.PixiSprite);this._tweener.addTween(d.getScaleRef(),"x",6,1,0.65,b.components.tween.EasingFunctions.easeOutQuad);
this._tweener.addTween(d.getScaleRef(),"y",6,1,0.65,b.components.tween.EasingFunctions.easeOutQuad);this._tweener.addTween(d.getRotationRef(),"z",-35,0,0.65,b.components.tween.EasingFunctions.easeOutQuad);this._tweener.addTween(f.getContainer(),"alpha",0,1,0.15,b.components.tween.EasingFunctions.easeOutQuad)}},getNumStarsEarned:function(){return this._numStarsEarned},__class__:c.minigames.puzzleBuilderGame.StarDisplay});c.minigames.spotTheDifferenceGame={};c.minigames.spotTheDifferenceGame.DifferenceObject=
function(a,c){this._found=!1;b.Component.call(this,a);this._object=c};c.minigames.spotTheDifferenceGame.DifferenceObject.__name__=["game","minigames","spotTheDifferenceGame","DifferenceObject"];c.minigames.spotTheDifferenceGame.DifferenceObject.__super__=b.Component;c.minigames.spotTheDifferenceGame.DifferenceObject.prototype=r(b.Component.prototype,{getFound:function(){return this._found},getObject:function(){return this._object},init:function(){b.Component.prototype.init.call(this);var a=this.getEntity().getComponent(b.pixi.PixiSprite);
this._button=new b.components.Button(this.getEntity(),new b.Vector2D(a.getSprite().width,a.getSprite().height),null,s(this,this.onClick));this._button.setHandPointer(!1);this._button.setKillMessageOnMouseDown(!0);this._alphaPulser=new b.components.AlphaPulser(this.getEntity(),2);this._alphaPulser.setIsActive(!1)},createButtonOnEntity:function(a){var c=this.getEntity().getComponent(b.pixi.PixiSprite);this._buttonClone=this.getGameState().addEntity();new b.pixi.PixiContainer(this._buttonClone);a.addChild(this._buttonClone);
this._buttonClone.setPosition(this.getEntity().getLocalPosition().x,this.getEntity().getLocalPosition().y);this._buttonCloneComp=new b.components.Button(this._buttonClone,new b.Vector2D(c.getSprite().width,c.getSprite().height),null,s(this,this.onClick));this._buttonCloneComp.setHandPointer(!1);this._buttonCloneComp.setKillMessageOnMouseDown(!0)},update:function(){b.Component.prototype.update.call(this)},onClick:function(){b.utilities.Debug.log("Clicked difference");this.dispatchEvent(new c.minigames.spotTheDifferenceGame.DifferenceObjectEvent("click",
this._object));null!=this._button&&(this._button.destroy(),this._button=null);null!=this._buttonCloneComp&&(this._buttonCloneComp.destroy(),this._buttonCloneComp=null)},onFind:function(){var a=this.getGameState().addEntity();(new b.pixi.PixiSprite(a,"findCircle")).getSprite().anchor=new PIXI.Point(0.5,0.5);this._buttonClone.addChild(a);a.setScale(0,0);var c=new b.components.Tweener(a);c.addTween(a.getScaleRef(),"x",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack);c.addTween(a.getScaleRef(),
"y",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack);c.addTween(a.getRotationRef(),"z",-30,0,0.35,b.components.tween.EasingFunctions.linear);this.stopPulse();this._found=!0},pulse:function(){if(null==this._hintAnimation){var a=this.getGameState().addEntity();this.getEntity().addChild(a);this._hintAnimation=new b.pixi.PixiAnimation(a,"hintSparkles")}},stopPulse:function(){null!=this._hintAnimation&&this._hintAnimation.getEntity().destroy()},destroy:function(){b.Component.prototype.destroy.call(this);
null!=this._buttonClone&&this._buttonClone.destroy()},__class__:c.minigames.spotTheDifferenceGame.DifferenceObject});c.minigames.spotTheDifferenceGame.DifferenceObjectEvent=function(a,c){b.events.Event.call(this,a);this._object=c};c.minigames.spotTheDifferenceGame.DifferenceObjectEvent.__name__=["game","minigames","spotTheDifferenceGame","DifferenceObjectEvent"];c.minigames.spotTheDifferenceGame.DifferenceObjectEvent.__super__=b.events.Event;c.minigames.spotTheDifferenceGame.DifferenceObjectEvent.prototype=
r(b.events.Event.prototype,{getObject:function(){return this._object},__class__:c.minigames.spotTheDifferenceGame.DifferenceObjectEvent});c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame=function(a){this._objectsFoundCounter=0;this._timeUntilPointLoss=1;this._hintRechargeDuration=this._timeUntilHintAvailable=0;this._lockFinding=!1;this._score=this._timeElapsed=0;this._numRounds=3;this._currentRound=1;this._totalObjectsToFind=this._objectsToFind=0;c.minigames.Minigame.call(this,a);this._sceneData=
[];this._deferredAction=new b.components.DeferredActionComponent(this.getEntity());this._minigameResults=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameResults;new b.pixi.PixiContainer(this.getEntity())};c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceGame"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.__super__=c.minigames.Minigame;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.prototype=
r(c.minigames.Minigame.prototype,{init:function(){c.minigames.Minigame.prototype.init.call(this);b.utilities.Debug.log("SpotTheDifferenceGame::init()");c.AnimationFactory.createAnimation("hintSparkles","hintSparklesXml",new b.Vector2D(-61,-71),1,!0);this.dispatchReady()},onTransitionToMinigame:function(){c.minigames.Minigame.prototype.onTransitionToMinigame.call(this);b.utilities.Debug.log("SpotTheDifferenceGame::onTransitionToMinigame()");this._hintRechargeDuration=t.parseFloat(b.GameConfig.getProperty("spotTheDifference.hintRechargeDuration"));
var a=this.getGameState().addEntity();new b.pixi.PixiSprite(a,"spotTheDifferenceGameBg");this.getEntity().addChild(a);this.parseSceneData();a=this.getGameState().addEntity();a.setPosition(0,8);(new b.pixi.PixiSprite(a,"hudFindCounterBg")).getSprite().anchor=new PIXI.Point(0.5,0.5);var d=this.getGameState().addEntity();d.setPosition(25,-2);this._findCounterText=new b.pixi.PixiText(d,"",{font:"52px league_gothic-webfont",fill:"#FFFFFF",align:"center"});a.addChild(d);d=this.getGameState().addEntity();
(new b.pixi.PixiSprite(d,"spotTheDifferenceJewel")).getSprite().anchor=new PIXI.Point(0.5,0.5);d.setPosition(-40,-7);a.addChild(d);this._roundCounter=this.getGameState().addEntity();this._roundCounter.setPosition(-225,0);this._roundCounterText=new b.pixi.PixiText(this._roundCounter,"",{font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"left"},1);this._pointsCounter=this.getGameState().addEntity();this._pointsCounter.setPosition(225,0);this._pointsText=new b.pixi.PixiText(this._pointsCounter,
"",{font:"32px league_gothic-webfont",fill:"#FFFFFF",align:"right"},1);this._hintButton=c.UiFactory.createPulseButtonQuickAbsolute(this.getGameState(),-450,0,"hudHintButton","hudHintButton",s(this,this.onHintButtonClicked),null,"ui_click_1","",!1);this._hintButton.getComponent(b.components.Button).setIsActive(!1);d=this.getGameState().addEntity();(new b.pixi.PixiSprite(d,"uiBar")).getSprite().anchor=new PIXI.Point(0.5,0.5);(new b.ui.UiElement(d,this._uiPanel)).setCoords(new b.Vector2D(0,-0.83));d.addChild(a);
d.addChild(this._roundCounter);d.addChild(this._pointsCounter);d.addChild(this._hintButton);this._hasSeenTutorial?this.startGame():this.showTutorial()},showTutorial:function(){c.minigames.Minigame.prototype.showTutorial.call(this);var a=new c.minigames.MinigameTutorialState;b.Root.getInstance().addGameState(a);var d=a.addEntity(),e=c.UiFactory.createFullscreenUiPanel(a);new b.ui.UiElement(d,e);new c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial(d,"tutorialBg");a.addEventListener("destroy",
s(this,this.onTutorialDestroy))},onTutorialDestroy:function(a){this.startGame()},startGame:function(){c.minigames.Minigame.prototype.startGame.call(this);this._hintButton.getComponent(b.components.Button).setIsActive(!0);this.generateDifferenceScene();this._isGameActive=!0},generateDifferenceScene:function(){if(0==c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame._availableSceneIndexes.length)for(var a=this._sceneData.length,d=0;d<a;){var e=d++;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame._availableSceneIndexes.push(e)}a=
c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame._availableSceneIndexes.splice(b.utilities.Math2.randomInt(0,c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame._availableSceneIndexes.length),1)[0];a=this._sceneData[a];null!=this._root&&this._root.destroy();this._root=this.getGameState().addEntity();this._root.setPosition(12,139);d=new b.components.Tweener(this._root);new b.pixi.PixiContainer(this._root);this.getEntity().addChild(this._root);e=this.getGameState().addEntity();this._root.addChild(e);
this._spotTheDifferenceLeftSplit=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit(e,a);var f=this.getGameState().addEntity();this._root.addChild(f);this._spotTheDifferenceRightSplit=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit(f,a);f.setPosition(506,0);this._spotTheDifferenceSplitManager=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManager(this._root,this._spotTheDifferenceLeftSplit,this._spotTheDifferenceRightSplit);this._spotTheDifferenceSplitManager.addEventListener("click",
s(this,this.onFindDifferenceObject));this._spotTheDifferenceSplitManager.addEventListener("objectSpawn",s(this,this.onDifferenceObjectSpawn));d.addTween(e.getPositionRef(),"x",-550,0,0.35,b.components.tween.EasingFunctions.easeOutQuad);d.addTween(e.getRotationRef(),"z",-30,0,0.35,b.components.tween.EasingFunctions.easeOutQuad);d.addTween(f.getPositionRef(),"x",1056,506,0.35,b.components.tween.EasingFunctions.easeOutQuad);d.addTween(f.getRotationRef(),"z",30,0,0.35,b.components.tween.EasingFunctions.easeOutQuad);
a=t.parseInt(b.GameConfig.getProperty("spotTheDifference.round"+this._currentRound+"HiddenObjects"));d=this._spotTheDifferenceLeftSplit.getSpotTheDifferenceSceneData().getObjects().length;d=Math.min(2*a,d);this._spotTheDifferenceSplitManager.generateDifferences(d);this._objectsToFind=this._totalObjectsToFind=a;this._objectsFoundCounter=0;this.updateFindCounter()},onDifferenceObjectSpawn:function(a){},onFindDifferenceObject:function(a){var d=this;if(!this._lockFinding){a=this._spotTheDifferenceSplitManager.getDifferenceObjectsByObject(a.getObject());
for(var e=a.length,f=0;f<e;){var n=f++,g=a[n];g.onFind();c.EntityFactory.createFloatingText(g.getEntity().getPosition().x,g.getEntity().getPosition().y-15,"+50",this.getGameState());this._score+=50;var n=[this.getGameState().addEntity()],h=new b.pixi.PixiSprite(n[0],"spotTheDifferenceJewel");h.getEntity().setPosition(g.getEntity().getPosition().x,g.getEntity().getPosition().y);h.getSprite().anchor=new PIXI.Point(0.5,0.5);var g=new b.components.Tweener(n[0]),k=0,m=[new b.Vector2D(465,60)];n[0].setScale(0,
0);g.addTween(n[0].getScaleRef(),"x",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack);g.addTween(n[0].getScaleRef(),"y",0,1,0.35,b.components.tween.EasingFunctions.easeOutBack);g.addTween(h.getContainer(),"alpha",0,1,0.15,b.components.tween.EasingFunctions.easeOutQuad,k);k+=0.65;g.addTween(n[0].getPositionRef(),"x",n[0].getPositionRef().x,m[0].x,1,b.components.tween.EasingFunctions.easeInCubic,k);g.addTween(n[0].getPositionRef(),"y",n[0].getPositionRef().y,m[0].y,1,b.components.tween.EasingFunctions.easeInCubic,
k);g.addTween(n[0].getScaleRef(),"x",1,2,0.75,b.components.tween.EasingFunctions.easeOutQuad,k);g.addTween(n[0].getScaleRef(),"y",1,2,0.75,b.components.tween.EasingFunctions.easeOutQuad,k);g.addTween(n[0].getScaleRef(),"x",2,1,0.25,b.components.tween.EasingFunctions.easeOutQuad,k+0.75);g.addTween(n[0].getScaleRef(),"y",2,1,0.25,b.components.tween.EasingFunctions.easeOutQuad,k+0.75);k+=1;g.addTween(n[0].getScaleRef(),"x",1,3,0.15,b.components.tween.EasingFunctions.easeOutQuad,k);g.addTween(n[0].getScaleRef(),
"y",1,3,0.15,b.components.tween.EasingFunctions.easeOutQuad,k);g.addTween(h.getContainer(),"alpha",1,0,0.15,b.components.tween.EasingFunctions.easeOutQuad,k,function(a,b){return function(){var e=d.getGameState().addEntity();e.setPosition(a[0].x,a[0].y);(new c.particles.ParticleEffect(e)).emit();e.destroy();b[0].destroy();d._objectsFoundCounter++;d.updateFindCounter()}}(m,n));this._objectsToFind--;this.checkAllObjectsFound()}b.audio.SoundManager.playSoundByName("ui_gem_bells_2")}},updateFindCounter:function(){this._findCounterText.setTextString(this._objectsFoundCounter+
"/"+t.string(this._totalObjectsToFind))},checkAllObjectsFound:function(){if(0>=this._objectsToFind)this.onAllObjectsFound()},onAllObjectsFound:function(){var a=this;this._lockFinding||(this._lockFinding=!0,this._deferredAction.addDeferredAction(2,function(c){return function(){var c=a._root.getComponent(b.components.Tweener);c.addTween(a._spotTheDifferenceLeftSplit.getEntity().getPositionRef(),"y",0,1E3,0.75,b.components.tween.EasingFunctions.linear,1);c.addTween(a._spotTheDifferenceLeftSplit.getEntity().getRotationRef(),
"z",0,-45,0.75,b.components.tween.EasingFunctions.linear,1);c.addTween(a._spotTheDifferenceRightSplit.getEntity().getPositionRef(),"y",0,1E3,0.75,b.components.tween.EasingFunctions.linear,1);c.addTween(a._spotTheDifferenceRightSplit.getEntity().getRotationRef(),"z",0,45,0.75,b.components.tween.EasingFunctions.linear,1);a._currentRound++;a._currentRound>a._numRounds?(c=a._minigameResults,a._timeElapsed<=t.parseInt(b.GameConfig.getProperty("spotTheDifference.3StarsMaxTime"))?c.stars=3:a._timeElapsed<=
t.parseInt(b.GameConfig.getProperty("spotTheDifference.2StarsMaxTime"))?c.stars=2:c.stars=1,a._currentRound=a._numRounds,a._deferredAction.addDeferredAction(2,function(){a._minigameResults.score=a._score;a.beatMinigame()})):a._deferredAction.addDeferredAction(2,function(){a._lockFinding=!1;a.generateDifferenceScene()})}}(this)),y.utag.UtagManager.getInstance().link("RoundComplete: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),"games"))},onHintButtonClicked:function(){if(!(0<
this._timeUntilHintAvailable||this._lockFinding)&&null!=this._spotTheDifferenceSplitManager){var a=this._spotTheDifferenceSplitManager.getUnfoundDifferenceObjects();if(0<a.length){var d=b.utilities.Math2.randomInt(0,a.length);a[d].pulse();this._hintButton.getComponent(b.pixi.PixiSprite).getSprite().alpha=0.5;this._timeUntilHintAvailable=this._hintRechargeDuration;y.utag.UtagManager.getInstance().link("HintUsed: Dreamtopia - [Game Title] - Level "+t.string(c.GameTracker.getInstance().getCurrentLevelTrackerName()),
"games")}}},update:function(){c.minigames.Minigame.prototype.update.call(this);null!=this._pointsText&&this._pointsText.setTextString(C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_SCORE"),"%N",t.string(this._score)));null!=this._roundCounterText&&this._roundCounterText.setTextString(C.replace(b.Localizer.getString("GAMEPLAY_SCREEN_MEMORY_ROUND"),"%N",t.string(this._currentRound)))},updateGameplay:function(){c.minigames.Minigame.prototype.updateGameplay.call(this);this._timeElapsed+=b.Root.getDeltaTime();
0<this._timeUntilHintAvailable&&(this._timeUntilHintAvailable-=b.Root.getDeltaTime(),0>=this._timeUntilHintAvailable&&(this._hintButton.getComponent(b.pixi.PixiSprite).getSprite().alpha=1));this._timeUntilPointLoss-=b.Root.getDeltaTime();0>this._timeUntilPointLoss&&(this._timeUntilPointLoss=1,this._score-=1,0>this._score&&(this._score=0))},parseSceneData:function(){this._sceneData=[];for(var a=(new w.xml.Fast(B.parse(b.managers.AssetManager.getAsset("spotTheDifferenceSceneData")))).node.resolve("scenes").nodes.resolve("scene").iterator();a.hasNext();){var d=
a.next(),d=c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData.getFromXmlData(d);this._sceneData.push(d)}},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame});c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameResults=function(){this.stars=0;c.minigames.MinigameResults.call(this);this.starGoals.push(b.GameConfig.getProperty("spotTheDifference.starGoal1"));this.starGoals.push(b.GameConfig.getProperty("spotTheDifference.starGoal2"));this.starGoals.push(b.GameConfig.getProperty("spotTheDifference.starGoal3"))};
c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameResults.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceGameResults"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameResults.__super__=c.minigames.MinigameResults;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameResults.prototype=r(c.minigames.MinigameResults.prototype,{__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameResults});c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial=
function(a,b){c.minigames.MinigameTutorial.call(this,a,b)};c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceGameTutorial"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial.__super__=c.minigames.MinigameTutorial;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial.prototype=r(c.minigames.MinigameTutorial.prototype,{init:function(){c.minigames.MinigameTutorial.prototype.init.call(this);this.setHeadingText(b.Localizer.getString("TUTORIAL_SPOT_THE_DIFFERENCE_HEADING_1"));
this.placeImage(-120,-55,"barbie-dt2-tutorial-1").setScale(1,1);this.placeImage(120,-55,"barbie-dt2-tutorial-2").setScale(1,1);this.placeText(0,125,b.Localizer.getString("TUTORIAL_SPOT_THE_DIFFERENCE_BODY_2"+(b.Root.isMobile()?"_MOBILE":"")),32,"center",!0,450);this.placeImage(0,185,"spotTheDifferenceTutorialCounter").addChild(this.placeText(18,-2,"2/3",34));this.createNextButton(0,305);this._skipButton.destroy()},onNextButtonClick:function(){c.minigames.MinigameTutorial.prototype.onSkipButtonClick.call(this)},
__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceGameTutorial});c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject=function(){this._objectPlacements=[]};c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceObject"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject.getFromXmlNode=function(a){var b=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject;for(a=a.nodes.resolve("placement").iterator();a.hasNext();){var d=
a.next(),d=c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement.getFromXmlNode(d);"barbie-dt2-spot-5-item-03"==d.getImageAsset()?b.getObjectPlacements().splice(0,0,d):b.getObjectPlacements().push(d)}return b};c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject.prototype={getObjectPlacements:function(){return this._objectPlacements},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject};c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement=function(a,
b,c){this._imageAsset=a;this._x=b;this._y=c};c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceObjectPlacement"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement.getFromXmlNode=function(a){var b=a.node.resolve("imageAsset").get_innerData(),d=t.parseFloat(a.node.resolve("x").get_innerData());a=t.parseFloat(a.node.resolve("y").get_innerData());return new c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement(b,
d,a)};c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement.prototype={getImageAsset:function(){return this._imageAsset},getX:function(){return this._x},getY:function(){return this._y},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceObjectPlacement};c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData=function(a){this._objects=[];this._backgroundImageAsset=a};c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData.__name__=["game","minigames","spotTheDifferenceGame",
"SpotTheDifferenceSceneData"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData.getFromXmlData=function(a){var b=a.node.resolve("backgroundImageAsset").get_innerData(),b=new c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData(b);for(a=a.nodes.resolve("object").iterator();a.hasNext();){var d=a.next(),d=c.minigames.spotTheDifferenceGame.SpotTheDifferenceObject.getFromXmlNode(d);b.getObjects().push(d)}return b};c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData.prototype=
{getObjects:function(){return this._objects},getBackgroundImageAsset:function(){return this._backgroundImageAsset},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceSceneData};c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit=function(a,c){b.Component.call(this,a);new b.pixi.PixiContainer(this.getEntity());this._spotTheDifferenceSceneData=c;var d=this.getGameState().addEntity();new b.pixi.PixiSprite(d,this._spotTheDifferenceSceneData.getBackgroundImageAsset());this.getEntity().addChild(d)};
c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceSplit"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit.__super__=b.Component;c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit.prototype=r(b.Component.prototype,{getSpotTheDifferenceSceneData:function(){return this._spotTheDifferenceSceneData},init:function(){b.Component.prototype.init.call(this)},addObject:function(a,d,e){null==e&&(e=!1);this.getEntity().addChild(a);
return e?(a.getComponent(b.pixi.PixiSprite),new c.minigames.spotTheDifferenceGame.DifferenceObject(a,d)):null},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplit});c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManager=function(a,c,d){b.Component.call(this,a);this._spotTheDifferenceSplitLeft=c;this._spotTheDifferenceSplitRight=d;this._differenceObjects=[];a=this._spotTheDifferenceSplitLeft.getSpotTheDifferenceSceneData();this._differenceObjectPool=[].concat(a.getObjects())};
c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManager.__name__=["game","minigames","spotTheDifferenceGame","SpotTheDifferenceSplitManager"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManager.__super__=b.Component;c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManager.prototype=r(b.Component.prototype,{generateDifferences:function(a){for(var c=0;c<a;){c++;var d=b.utilities.Math2.randomInt(0,this._differenceObjectPool.length);this.generateObjectWithRandomDifferences(d);
v.remove(this._differenceObjectPool,this._differenceObjectPool[d])}},generateObjectWithRandomDifferences:function(a){a=this._differenceObjectPool[a];var d=[].concat(a.getObjectPlacements()),e=this._spotTheDifferenceSplitLeft.getGameState().addEntity(),f=d[b.utilities.Math2.randomInt(0,d.length)];v.remove(d,f);(new b.pixi.PixiSprite(e,f.getImageAsset())).getSprite().anchor=new PIXI.Point(0.5,0.5);e.setPosition(f.getX(),f.getY());d=this._spotTheDifferenceSplitLeft.addObject(e,a,!0);d.createButtonOnEntity(this._spotTheDifferenceSplitRight.getEntity());
this._differenceObjects.push(d);d.addEventListener("click",s(this,this.onFindDifferenceObject));b.utilities.Debug.log(f.getImageAsset());this.dispatchEvent(new c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent("objectSpawn",a))},onFindDifferenceObject:function(a){a.target.removeEventListener("click",s(this,this.onFindDifferenceObject));this.dispatchEvent(a)},getDifferenceObjectsByObject:function(a){for(var b=[],c=this._differenceObjects.length,d=0;d<c;){var n=d++,n=this._differenceObjects[n];
n.getObject()==a&&b.push(n)}return b},getUnfoundDifferenceObjects:function(){for(var a=[],b=this._differenceObjects.length,c=0;c<b;){var d=c++,d=this._differenceObjects[d];d.getFound()||a.push(d)}return a},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManager});c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent=function(a,c){b.events.Event.call(this,a);this._object=c};c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent.__name__=["game",
"minigames","spotTheDifferenceGame","SpotTheDifferenceSplitManagerSpawnEvent"];c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent.__super__=b.events.Event;c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent.prototype=r(b.events.Event.prototype,{getObjects:function(){return this._object},__class__:c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent});c.particles={};c.particles.ParticleEffect=function(a){b.Component.call(this,a)};c.particles.ParticleEffect.__name__=
["game","particles","ParticleEffect"];c.particles.ParticleEffect.__super__=b.Component;c.particles.ParticleEffect.prototype=r(b.Component.prototype,{init:function(){b.Component.prototype.init.call(this)},emit:function(){for(var a=this.getEntity().getPosition(),c=0;20>c;){c++;var d=[this.getGameState().addEntity()];null!=this.getEntity().getParent()&&this.getEntity().getParent().addChild(d[0]);var f=new b.pixi.PixiSprite(d[0],"starParticle");f.getSprite().anchor=new PIXI.Point(0.5,0.5);var n=0.6+b.utilities.Math2.randomFloat(-0.35,
0.35);d[0].setScale(n,n);d[0].setPosition(a.x+b.utilities.Math2.randomFloat(-5,5),a.y-(this.getEntity().getPosition().y-a.y)+b.utilities.Math2.randomFloat(-5,5));var g=new b.components.Tweener(d[0]);g.addTween(f.getContainer(),"alpha",1,0,0.35,b.components.tween.EasingFunctions.linear,b.utilities.Math2.randomFloat(0.4,0.6),function(a){return function(){a[0].destroy()}}(d));g.addTween(d[0].getScaleRef(),"x",0,n,0.15,b.components.tween.EasingFunctions.easeOutQuad);g.addTween(d[0].getScaleRef(),"y",
0,n,0.15,b.components.tween.EasingFunctions.easeOutQuad);d=new b.components.SimpleMovement(d[0],new b.Vector3D(0,500));d.setVelocity(b.utilities.Math2.randomFloat(-500,1E3),b.utilities.Math2.randomFloat(-400,400));f=b.utilities.Math2.randomFloat(360,720);d.setAngularVelocity(new b.Vector3D(0,0,f))}},__class__:c.particles.ParticleEffect});var w={Timer:function(){}};w.Timer.__name__=["haxe","Timer"];w.Timer.stamp=function(){return(new Date).getTime()/1E3};w.ds={};w.ds.IntMap=function(){};w.ds.IntMap.__name__=
["haxe","ds","IntMap"];w.ds.IntMap.__interfaces__=[N];w.ds.StringMap=function(){this.h={}};w.ds.StringMap.__name__=["haxe","ds","StringMap"];w.ds.StringMap.__interfaces__=[N];w.ds.StringMap.prototype={set:function(a,b){this.h["$"+a]=b},get:function(a){return this.h["$"+a]},exists:function(a){return this.h.hasOwnProperty("$"+a)},remove:function(a){a="$"+a;if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},__class__:w.ds.StringMap};w.io={};w.io.Eof=function(){};w.io.Eof.__name__=["haxe",
"io","Eof"];w.io.Eof.prototype={toString:function(){return"Eof"},__class__:w.io.Eof};w.xml={};w.xml._Fast={};w.xml._Fast.NodeAccess=function(a){this.__x=a};w.xml._Fast.NodeAccess.__name__=["haxe","xml","_Fast","NodeAccess"];w.xml._Fast.NodeAccess.prototype={resolve:function(a){var b=this.__x.elementsNamed(a).next();if(null==b)throw(this.__x.nodeType==B.Document?"Document":this.__x.get_nodeName())+" is missing element "+a;return new w.xml.Fast(b)},__class__:w.xml._Fast.NodeAccess};w.xml._Fast.AttribAccess=
function(a){this.__x=a};w.xml._Fast.AttribAccess.__name__=["haxe","xml","_Fast","AttribAccess"];w.xml._Fast.AttribAccess.prototype={__class__:w.xml._Fast.AttribAccess};w.xml._Fast.HasAttribAccess=function(a){this.__x=a};w.xml._Fast.HasAttribAccess.__name__=["haxe","xml","_Fast","HasAttribAccess"];w.xml._Fast.HasAttribAccess.prototype={__class__:w.xml._Fast.HasAttribAccess};w.xml._Fast.HasNodeAccess=function(a){this.__x=a};w.xml._Fast.HasNodeAccess.__name__=["haxe","xml","_Fast","HasNodeAccess"];w.xml._Fast.HasNodeAccess.prototype=
{resolve:function(a){return this.__x.elementsNamed(a).hasNext()},__class__:w.xml._Fast.HasNodeAccess};w.xml._Fast.NodeListAccess=function(a){this.__x=a};w.xml._Fast.NodeListAccess.__name__=["haxe","xml","_Fast","NodeListAccess"];w.xml._Fast.NodeListAccess.prototype={resolve:function(a){var b=new L;for(a=this.__x.elementsNamed(a);a.hasNext();){var c=a.next();b.add(new w.xml.Fast(c))}return b},__class__:w.xml._Fast.NodeListAccess};w.xml.Fast=function(a){if(a.nodeType!=B.Document&&a.nodeType!=B.Element)throw"Invalid nodeType "+
t.string(a.nodeType);this.x=a;this.node=new w.xml._Fast.NodeAccess(a);this.nodes=new w.xml._Fast.NodeListAccess(a);this.att=new w.xml._Fast.AttribAccess(a);this.has=new w.xml._Fast.HasAttribAccess(a);this.hasNode=new w.xml._Fast.HasNodeAccess(a)};w.xml.Fast.__name__=["haxe","xml","Fast"];w.xml.Fast.prototype={get_name:function(){return this.x.nodeType==B.Document?"Document":this.x.get_nodeName()},get_innerData:function(){var a=this.x.iterator();if(!a.hasNext())throw this.get_name()+" does not have data";
var b=a.next(),c=a.next();if(null!=c){if(b.nodeType==B.PCData&&(c.nodeType==B.CData&&""==C.trim(b.get_nodeValue()))&&(b=a.next(),null==b||b.nodeType==B.PCData&&""==C.trim(b.get_nodeValue())&&null==a.next()))return c.get_nodeValue();throw this.get_name()+" does not only have data";}if(b.nodeType!=B.PCData&&b.nodeType!=B.CData)throw this.get_name()+" does not have data";return b.get_nodeValue()},__class__:w.xml.Fast,__properties__:{get_innerData:"get_innerData",get_name:"get_name"}};w.xml.Parser=function(){};
w.xml.Parser.__name__=["haxe","xml","Parser"];w.xml.Parser.parse=function(a){var b=B.createDocument();w.xml.Parser.doParse(a,0,b);return b};w.xml.Parser.doParse=function(a,b,c){null==b&&(b=0);for(var d=null,n=1,g=1,h=null,k=0,m=0,p=0,q=a.charCodeAt(b),r=new M;q==q;){switch(n){case 0:switch(q){case 10:case 13:case 9:case 32:break;default:n=g;continue}break;case 1:switch(q){case 60:n=0;g=2;break;default:k=b;n=13;continue}break;case 13:60==q?(g=B.createPCData(r.b+v.substr(a,k,b-k)),r=new M,c.addChild(g),
m++,n=0,g=2):38==q&&(r.addSub(a,k,b-k),n=18,g=13,k=b+1);break;case 17:93==q&&(93==a.charCodeAt(b+1)&&62==a.charCodeAt(b+2))&&(n=B.createCData(v.substr(a,k,b-k)),c.addChild(n),m++,b+=2,n=1);break;case 2:switch(q){case 33:if(91==a.charCodeAt(b+1)){b+=2;if("CDATA["!=v.substr(a,b,6).toUpperCase())throw"Expected <![CDATA[";b+=5;n=17}else if(68==a.charCodeAt(b+1)||100==a.charCodeAt(b+1)){if("OCTYPE"!=v.substr(a,b+2,6).toUpperCase())throw"Expected <!DOCTYPE";b+=8;n=16}else{if(45!=a.charCodeAt(b+1)||45!=
a.charCodeAt(b+2))throw"Expected \x3c!--";b+=2;n=15}k=b+1;break;case 63:n=14;k=b;break;case 47:if(null==c)throw"Expected node name";k=b+1;n=0;g=10;break;default:n=3;k=b;continue}break;case 3:if(!(97<=q&&122>=q||65<=q&&90>=q||48<=q&&57>=q||58==q||46==q||95==q||45==q)){if(b==k)throw"Expected node name";d=B.createElement(v.substr(a,k,b-k));c.addChild(d);n=0;g=4;continue}break;case 4:switch(q){case 47:n=11;m++;break;case 62:n=9;m++;break;default:n=5;k=b;continue}break;case 5:if(!(97<=q&&122>=q||65<=q&&
90>=q||48<=q&&57>=q||58==q||46==q||95==q||45==q)){if(k==b)throw"Expected attribute name";h=v.substr(a,k,b-k);if(d.exists(h))throw"Duplicate attribute";n=0;g=6;continue}break;case 6:switch(q){case 61:n=0;g=7;break;default:throw"Expected =";}break;case 7:switch(q){case 34:case 39:n=8;k=b;break;default:throw'Expected "';}break;case 8:q==a.charCodeAt(k)&&(g=v.substr(a,k+1,b-k-1),d.set(h,g),n=0,g=4);break;case 9:k=b=w.xml.Parser.doParse(a,b,d);n=1;break;case 11:switch(q){case 62:n=1;break;default:throw"Expected >";
}break;case 12:switch(q){case 62:return 0==m&&c.addChild(B.createPCData("")),b;default:throw"Expected >";}case 10:if(!(97<=q&&122>=q||65<=q&&90>=q||48<=q&&57>=q||58==q||46==q||95==q||45==q)){if(k==b)throw"Expected node name";if(v.substr(a,k,b-k)!=c.get_nodeName())throw"Expected </"+c.get_nodeName()+">";n=0;g=12;continue}break;case 15:45==q&&(45==a.charCodeAt(b+1)&&62==a.charCodeAt(b+2))&&(c.addChild(B.createComment(v.substr(a,k,b-k))),b+=2,n=1);break;case 16:91==q?p++:93==q?p--:62==q&&0==p&&(c.addChild(B.createDocType(v.substr(a,
k,b-k))),n=1);break;case 14:63==q&&62==a.charCodeAt(b+1)&&(b++,n=v.substr(a,k+1,b-k-2),c.addChild(B.createProcessingInstruction(n)),n=1);break;case 18:59==q&&(k=v.substr(a,k,b-k),35==k.charCodeAt(0)?(k=120==k.charCodeAt(1)?t.parseInt("0"+v.substr(k,1,k.length-1)):t.parseInt(v.substr(k,1,k.length-1)),r.add(String.fromCharCode(k))):w.xml.Parser.escapes.exists(k)?r.add(w.xml.Parser.escapes.get(k)):r.b+=t.string("&"+k+";"),k=b+1,n=g)}q=C.fastCodeAt(a,++b)}1==n&&(k=b,n=13);if(13==n)return b==k&&0!=m||
c.addChild(B.createPCData(r.b+v.substr(a,k,b-k))),b;throw"Unexpected end";};var z={Boot:function(){}};z.Boot.__name__=["js","Boot"];z.Boot.getClass=function(a){return a instanceof Array&&null==a.__enum__?Array:a.__class__};z.Boot.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];c=a[0]+"(";b+="\t";for(var d=2,n=
a.length;d<n;)var g=d++,c=2!=g?c+(","+z.Boot.__string_rec(a[g],b)):c+z.Boot.__string_rec(a[g],b);return c+")"}c=a.length;d="[";b+="\t";for(n=0;n<c;)g=n++,d+=(0<g?",":"")+z.Boot.__string_rec(a[g],b);return d+"]"}try{d=a.toString}catch(h){return"???"}if(null!=d&&d!=Object.toString&&(c=a.toString(),"[object Object]"!=c))return c;c=null;d="{\n";b+="\t";n=null!=a.hasOwnProperty;for(c in a)n&&!a.hasOwnProperty(c)||("prototype"==c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c)||
(2!=d.length&&(d+=", \n"),d+=b+c+" : "+z.Boot.__string_rec(a[c],b));b=b.substring(1);return d+("\n"+b+"}");case "function":return"<function>";case "string":return a;default:return String(a)}};z.Boot.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var d=0,n=c.length;d<n;){var g=d++,g=c[g];if(g==b||z.Boot.__interfLoop(g,b))return!0}return z.Boot.__interfLoop(a.__super__,b)};z.Boot.__instanceof=function(a,b){if(null==b)return!1;switch(b){case X:return(a|
0)===a;case S:return"number"==typeof a;case T:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.__enum__;case Y:return!0;default:if(null!=a){if("function"==typeof b&&(a instanceof b||z.Boot.__interfLoop(z.Boot.getClass(a),b)))return!0}else return!1;return b==Z&&null!=a.__name__||b==aa&&null!=a.__ename__?!0:a.__enum__==b}};z.Boot.__cast=function(a,b){if(z.Boot.__instanceof(a,b))return a;throw"Cannot cast "+t.string(a)+" to "+t.string(b);};
z.Browser=function(){};z.Browser.__name__=["js","Browser"];z.Browser.getLocalStorage=function(){try{var a=window.localStorage;a.getItem("");return a}catch(b){return null}};z.Browser.getSessionStorage=function(){try{var a=window.sessionStorage;a.getItem("");return a}catch(b){return null}};var y={ooyala:{}};y.ooyala.OoyalaVideoManager=function(){this._hidFullscreen=this._hasForcePlayed=!1;b.Manager.call(this)};y.ooyala.OoyalaVideoManager.__name__=["mattel","ooyala","OoyalaVideoManager"];y.ooyala.OoyalaVideoManager.getInstance=
function(){null==y.ooyala.OoyalaVideoManager._instance&&(y.ooyala.OoyalaVideoManager._instance=new y.ooyala.OoyalaVideoManager,b.Root.getInstance().addManager(y.ooyala.OoyalaVideoManager._instance));return y.ooyala.OoyalaVideoManager._instance};y.ooyala.OoyalaVideoManager.__super__=b.Manager;y.ooyala.OoyalaVideoManager.prototype=r(b.Manager.prototype,{embed:function(a,c,d,f,n){var g=this,h;h=q.getDocument().createElement("script");h.src="http://player.ooyala.com/v3/"+c+"?platform=html5";h.addEventListener("load",
function(c){c=q.getDocument();g._currentDiv=c.createElement("div");g._currentDiv.id="ooyalaplayer";g._currentDiv.style.width=f+"px";g._currentDiv.style.height=n+"px";d.appendChild(g._currentDiv);g._player=OO.Player.create("ooyalaplayer",a,{});g._player.subscribe("played","ooyalaplayer",s(g,g.onVideoPlayed));b.Root.isMobile()||g._player.play();g._hasForcePlayed=!1;g._player.setVolume(1)});q.getDocument().body.appendChild(h)},destroyVideo:function(){null!=this._player&&(this._player.destroy(),this._player=
null);null!=this._currentDiv&&this._currentDiv.parentNode.removeChild(this._currentDiv)},update:function(){b.Manager.prototype.update.call(this);if(null!=this._player)for(var a=q.getDocument().body.getElementsByClassName("oo_fullscreen"),c=0,d=a.length;c<d;){var f=c++;a.item(f).style.display="none";this._hidFullscreen=!0}},onVideoPlayed:function(){this.dispatchEvent(new y.ooyala.OoyalaVideoManagerEvent("videoFinish"))},destroy:function(){b.Manager.prototype.destroy.call(this);y.ooyala.OoyalaVideoManager._instance=
null},handleMessage:function(a,c){b.Manager.prototype.handleMessage.call(this,a,c);b.Root.isMobile()},__class__:y.ooyala.OoyalaVideoManager});y.ooyala.OoyalaVideoManagerEvent=function(a){b.events.Event.call(this,a)};y.ooyala.OoyalaVideoManagerEvent.__name__=["mattel","ooyala","OoyalaVideoManagerEvent"];y.ooyala.OoyalaVideoManagerEvent.__super__=b.events.Event;y.ooyala.OoyalaVideoManagerEvent.prototype=r(b.events.Event.prototype,{__class__:y.ooyala.OoyalaVideoManagerEvent});y.utag={};y.utag.UtagManager=
function(){this._gameTitle="DreamtopiaCartGame";b.Manager.call(this);y.utag.UtagManager._instance=this;this._utag=window.utag};y.utag.UtagManager.__name__=["mattel","utag","UtagManager"];y.utag.UtagManager.getInstance=function(){null==y.utag.UtagManager._instance&&(y.utag.UtagManager._instance=new y.utag.UtagManager,b.Root.getInstance().addManager(y.utag.UtagManager._instance));return y.utag.UtagManager._instance};y.utag.UtagManager.__super__=b.Manager;y.utag.UtagManager.prototype=r(b.Manager.prototype,
{link:function(a,b){var c={};c.event_id=C.replace(a,"[Game Title]",this._gameTitle);c.event_category_id=b;null!=this._utag&&this._utag.link(c)},view:function(a){var b={};a=C.replace(a,"[Game Title]",this._gameTitle);a=C.replace(a,"[locale]",q.dataLocale);b.page_id=a;null!=this._utag&&this._utag.view(b)},__class__:y.utag.UtagManager});var J,W=0;Array.prototype.indexOf&&(v.indexOf=function(a,b,c){return Array.prototype.indexOf.call(a,b,c)});Math.NaN=Number.NaN;Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;
Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;Math.isFinite=function(a){return isFinite(a)};Math.isNaN=function(a){return isNaN(a)};String.prototype.__class__=String;String.__name__=["String"];Array.__name__=["Array"];Date.prototype.__class__=Date;Date.__name__=["Date"];var X={__name__:["Int"]},Y={__name__:["Dynamic"]},S=Number;S.__name__=["Float"];var T=Boolean;T.__ename__=["Bool"];var Z={__name__:["Class"]},aa={};B.Element="element";B.PCData="pcdata";B.CData="cdata";B.Comment="comment";B.DocType=
"doctype";B.ProcessingInstruction="processingInstruction";B.Document="document";z.JQuery=window.jQuery;q.TARGET_FPS=60;q.TARGET_FPS_MOBILE=30;q.CANVAS_WIDTH_LANDSCAPE=1024;q.CANVAS_HEIGHT_LANDSCAPE=768;q.CANVAS_WIDTH_PORTRAIT=640;q.CANVAS_HEIGHT_PORTRAIT=960;q.BACKGROUND_COLOR="#000000";q.dataLocale="";d.collision.B2Collision.b2_nullFeature=255;d.collision.B2Collision.s_incidentEdge=d.collision.B2Collision.makeClipPointVector();d.collision.B2Collision.s_clipPoints1=d.collision.B2Collision.makeClipPointVector();
d.collision.B2Collision.s_clipPoints2=d.collision.B2Collision.makeClipPointVector();d.collision.B2Collision.s_edgeAO=[];d.collision.B2Collision.s_edgeBO=[];d.collision.B2Collision.s_localTangent=new d.common.math.B2Vec2;d.collision.B2Collision.s_localNormal=new d.common.math.B2Vec2;d.collision.B2Collision.s_planePoint=new d.common.math.B2Vec2;d.collision.B2Collision.s_normal=new d.common.math.B2Vec2;d.collision.B2Collision.s_tangent=new d.common.math.B2Vec2;d.collision.B2Collision.s_tangent2=new d.common.math.B2Vec2;
d.collision.B2Collision.s_v11=new d.common.math.B2Vec2;d.collision.B2Collision.s_v12=new d.common.math.B2Vec2;d.collision.B2Collision.b2CollidePolyTempVec=new d.common.math.B2Vec2;d.collision.B2Distance.s_simplex=new d.collision.B2Simplex;d.collision.B2Distance.s_saveA=[];d.collision.B2Distance.s_saveB=[];d.collision.B2DynamicTreeNode.currentID=0;d.collision.B2TimeOfImpact.b2_toiCalls=0;d.collision.B2TimeOfImpact.b2_toiIters=0;d.collision.B2TimeOfImpact.b2_toiMaxIters=0;d.collision.B2TimeOfImpact.b2_toiRootIters=
0;d.collision.B2TimeOfImpact.b2_toiMaxRootIters=0;d.collision.B2TimeOfImpact.s_cache=new d.collision.B2SimplexCache;d.collision.B2TimeOfImpact.s_distanceInput=new d.collision.B2DistanceInput;d.collision.B2TimeOfImpact.s_xfA=new d.common.math.B2Transform;d.collision.B2TimeOfImpact.s_xfB=new d.common.math.B2Transform;d.collision.B2TimeOfImpact.s_fcn=new d.collision.B2SeparationFunction;d.collision.B2TimeOfImpact.s_distanceOutput=new d.collision.B2DistanceOutput;d.collision.shapes.B2Shape.e_hitCollide=
1;d.collision.shapes.B2Shape.e_missCollide=0;d.collision.shapes.B2Shape.e_startsInsideCollide=-1;d.collision.shapes.B2PolygonShape.s_mat=new d.common.math.B2Mat22;d.common.B2Settings.VERSION="2.1alpha";d.common.B2Settings.USHRT_MAX=65535;d.common.B2Settings.b2_pi=Math.PI;d.common.B2Settings.b2_maxManifoldPoints=2;d.common.B2Settings.b2_aabbExtension=0.1;d.common.B2Settings.b2_aabbMultiplier=2;d.common.B2Settings.b2_polygonRadius=2*d.common.B2Settings.b2_linearSlop;d.common.B2Settings.b2_linearSlop=
0.005;d.common.B2Settings.b2_angularSlop=0.011111111111111112*d.common.B2Settings.b2_pi;d.common.B2Settings.b2_toiSlop=8*d.common.B2Settings.b2_linearSlop;d.common.B2Settings.b2_maxTOIContactsPerIsland=32;d.common.B2Settings.b2_maxTOIJointsPerIsland=32;d.common.B2Settings.b2_velocityThreshold=1;d.common.B2Settings.b2_maxLinearCorrection=0.2;d.common.B2Settings.b2_maxAngularCorrection=0.044444444444444446*d.common.B2Settings.b2_pi;d.common.B2Settings.b2_maxTranslation=2;d.common.B2Settings.b2_maxTranslationSquared=
d.common.B2Settings.b2_maxTranslation*d.common.B2Settings.b2_maxTranslation;d.common.B2Settings.b2_maxRotation=0.5*d.common.B2Settings.b2_pi;d.common.B2Settings.b2_maxRotationSquared=d.common.B2Settings.b2_maxRotation*d.common.B2Settings.b2_maxRotation;d.common.B2Settings.b2_contactBaumgarte=0.2;d.common.B2Settings.b2_timeToSleep=0.5;d.common.B2Settings.b2_linearSleepTolerance=0.01;d.common.B2Settings.b2_angularSleepTolerance=0.011111111111111112*d.common.B2Settings.b2_pi;d.common.math.B2Math.b2Vec2_zero=
new d.common.math.B2Vec2(0,0);d.common.math.B2Math.b2Mat22_identity=d.common.math.B2Mat22.fromVV(new d.common.math.B2Vec2(1,0),new d.common.math.B2Vec2(0,1));d.common.math.B2Math.b2Transform_identity=new d.common.math.B2Transform(d.common.math.B2Math.b2Vec2_zero,d.common.math.B2Math.b2Mat22_identity);d.dynamics.B2Body.s_xf1=new d.common.math.B2Transform;d.dynamics.B2Body.e_islandFlag=1;d.dynamics.B2Body.e_awakeFlag=2;d.dynamics.B2Body.e_allowSleepFlag=4;d.dynamics.B2Body.e_bulletFlag=8;d.dynamics.B2Body.e_fixedRotationFlag=
16;d.dynamics.B2Body.e_activeFlag=32;d.dynamics.B2Body.b2_staticBody=0;d.dynamics.B2Body.b2_kinematicBody=1;d.dynamics.B2Body.b2_dynamicBody=2;d.dynamics.B2ContactFilter.b2_defaultFilter=new d.dynamics.B2ContactFilter;d.dynamics.B2ContactListener.b2_defaultListener=new d.dynamics.B2ContactListener;d.dynamics.B2ContactManager.s_evalCP=new d.collision.B2ContactPoint;d.dynamics.B2DebugDraw.e_shapeBit=1;d.dynamics.B2DebugDraw.e_jointBit=2;d.dynamics.B2DebugDraw.e_aabbBit=4;d.dynamics.B2DebugDraw.e_pairBit=
8;d.dynamics.B2DebugDraw.e_centerOfMassBit=16;d.dynamics.B2DebugDraw.e_controllerBit=32;d.dynamics.B2Island.s_impulse=new d.dynamics.B2ContactImpulse;d.dynamics.B2World.s_timestep2=new d.dynamics.B2TimeStep;d.dynamics.B2World.s_xf=new d.common.math.B2Transform;d.dynamics.B2World.s_backupA=new d.common.math.B2Sweep;d.dynamics.B2World.s_backupB=new d.common.math.B2Sweep;d.dynamics.B2World.s_timestep=new d.dynamics.B2TimeStep;d.dynamics.B2World.s_queue=[];d.dynamics.B2World.s_jointColor=new d.common.B2Color(0.5,
0.8,0.8);d.dynamics.B2World.e_newFixture=1;d.dynamics.B2World.e_locked=2;d.dynamics.contacts.B2Contact.e_sensorFlag=1;d.dynamics.contacts.B2Contact.e_continuousFlag=2;d.dynamics.contacts.B2Contact.e_islandFlag=4;d.dynamics.contacts.B2Contact.e_toiFlag=8;d.dynamics.contacts.B2Contact.e_touchingFlag=16;d.dynamics.contacts.B2Contact.e_enabledFlag=32;d.dynamics.contacts.B2Contact.e_filterFlag=64;d.dynamics.contacts.B2Contact.s_input=new d.collision.B2TOIInput;d.dynamics.contacts.B2PositionSolverManifold.circlePointA=
new d.common.math.B2Vec2;d.dynamics.contacts.B2PositionSolverManifold.circlePointB=new d.common.math.B2Vec2;d.dynamics.contacts.B2ContactSolver.staticFix=d.common.B2Settings.b2_maxManifoldPoints;d.dynamics.contacts.B2ContactSolver.s_worldManifold=new d.collision.B2WorldManifold;d.dynamics.contacts.B2ContactSolver.s_psm=new d.dynamics.contacts.B2PositionSolverManifold;d.dynamics.joints.B2PulleyJoint.b2_minPulleyLength=2;d.dynamics.joints.B2RevoluteJoint.tImpulse=new d.common.math.B2Vec2;b.GameObject._currentInstanceId=
0;b.GameConfig._properties=new w.ds.StringMap;b.Layer._currentZIndex=0;b.LoadBatch.MIN_LOAD_TIME=1;b.LoadBatch.MAX_ACTIVE_REQUESTS=10;b.Root.ORIENTATION_HORIZONTAL=0;b.Root.ORIENTATION_VERTICAL=1;b.Root.MAX_TIMESTEP=0.03333333333333333;b.Root.PHYSICS_SCALE=30;b.Root.FIXED_TIMESTEP=0.016666666666666666;b.Root._timeScale=1;b.Root._devicePixelRatio=-1;b.Root._prevTimeStamp=0;b.Root._currentTimeStamp=0;b.Root._fixedTimestepDelta=!1;b.achievements.AchievementCompleteEvent.COMPLETE="complete";b.audio.SoundManager._masterVolume=
1;b.audio.SoundManager._musicVolume=0.65;b.audio.SoundManager._soundVolume=1;b.audio.SoundManager._musicMuted=!1;b.audio.SoundManager._soundMuted=!1;b.audio.SoundManager._soundsPlaying=[];b.audio.SoundManager._isWebkitEnabled=!1;b.audio.SoundManager._soundTimers=new w.ds.StringMap;b.box2d.Box2dEvent.BEGIN_CONTACT="beginContact";b.box2d.Box2dEvent.END_CONTACT="endContact";b.box2d.Box2dManager.PHYSICS_FPS=60;b.box2d.Box2dManager.TIMESTEP=1/60;b.box2d.Box2dManagerEvent.PRE_UPDATE="preUpdate";b.box2d.Box2dManagerEvent.UPDATE=
"update";b.components.SlackMovement.EPSILON=5E-5;b.components.TextField.DEFAULT_FILL_STYLE="white";b.components.buttons.ButtonActionDelay._delayButtonLock=!1;b.events.EntityEvent.VISIBILITY_OFF="visibilityOff";b.events.EntityEvent.VISIBILITY_ON="visibilityOn";b.events.EntityEvent.DISPLAY_UPDATE="displayUpdate";b.events.EntityEvent.ADDED_TO_PARENT="addedToParent";b.events.EntityEvent.REMOVED_FROM_PARENT="removedFromParent";b.events.EntityEvent.MOUSE_DOWN="mouseDown";b.events.EntityEvent.MOUSE_UP="mouseUp";
b.events.EntityEvent.MOUSE_MOVE="mouseMove";b.events.EntityEvent.MOUSE_OUT="mouseOut";b.events.EntityEvent.MOUSE_OVER="mouseOver";b.events.EntityEvent.MOUSE_CLICK="mouseClick";b.events.GameObjectEvent.DESTROY="destroy";b.events.GameObjectEvent.ACTIVATE="activate";b.events.GameObjectEvent.DEACTIVATE="deactivate";b.events.GameObjectEvent.INITIALIZE="initialize";b.events.RaycastCheckEvent.RAYCAST_CHECK="raycastCheck";b.flashAnimation.FlashAnimation._cachedFrames=new w.ds.StringMap;b.managers.AssetManager.assetList=
new w.ds.StringMap;b.managers.DebugManagerEvent.BEAT_LEVEL="beatLevel";b.managers.DebugManagerEvent.FAIL_LEVEL="failLevel";b.managers.DebugManagerEvent.TURBO_START="turboStart";b.managers.DebugManagerEvent.TURBO_END="turboEnd";b.managers.DebugManagerEvent.COMIC_SNAPSHOT="comicSnapshot";b.managers.FontManager._elementHookMap=new w.ds.StringMap;b.managers.PhysicsEvent.RAYCAST_CHECK="raycastCheck";b.pixi.PixiContainer._updatesThisFrame=0;b.pixi.PixiSprite.CULL_VIEWPORT_BUFFER=225;b.screenTransition.TransitionScreenEvent.MIDPOINT=
"midpoint";b.screenTransition.TransitionScreenEvent.COMPLETE="complete";b.speechManager.SubtitleEvent.SHOW_SUBTITLE="showSubtitle";b.swipeDetector.SwipeDetector.MAX_POINTS_TO_REMEMBER=5;b.swipeDetector.SwipeDetector.STRAIGHT_SWIPE_DETECTION_DISTANCE=5;b.swipeDetector.SwipeDetector.DIAGONAL_SWIPE_DETECTION_DISTANCE=5;b.swipeDetector.SwipeDetectorEvent.SWIPE_UP="swipeUp";b.swipeDetector.SwipeDetectorEvent.SWIPE_DOWN="swipeDown";b.swipeDetector.SwipeDetectorEvent.SWIPE_LEFT="swipeLeft";b.swipeDetector.SwipeDetectorEvent.SWIPE_RIGHT=
"swipeRight";b.swipeDetector.SwipeDetectorEvent.SWIPE_UP_LEFT="swipeUpLeft";b.swipeDetector.SwipeDetectorEvent.SWIPE_UP_RIGHT="swipeUpRight";b.swipeDetector.SwipeDetectorEvent.SWIPE_DOWN_LEFT="swipeDownLeft";b.swipeDetector.SwipeDetectorEvent.SWIPE_DOWN_RIGHT="swipeDownRight";b.swipeDetector.SwipeDetectorEvent.SWIPE_COMBO="";b.tmx.TmxLevel.TILE_SLICE_OFFSET_X=0;b.tmx.TmxLevel.TILE_SLICE_OFFSET_Y=0;b.tmx.TmxLevel.TILE_SLICE_WIDTH=1024;b.tmx.TmxLevel.TILE_SLICE_HEIGHT=1024;b.ui.UiPanelEvent.UPDATE_DISPLAY=
"updateDisplay";b.utilities.KeyCodes.KEY_0=48;b.utilities.KeyCodes.KEY_1=49;b.utilities.KeyCodes.KEY_2=50;b.utilities.KeyCodes.KEY_3=51;b.utilities.KeyCodes.KEY_4=52;b.utilities.KeyCodes.KEY_5=53;b.utilities.KeyCodes.KEY_6=54;b.utilities.KeyCodes.KEY_7=55;b.utilities.KeyCodes.KEY_8=56;b.utilities.KeyCodes.KEY_9=57;b.utilities.KeyCodes.A=65;b.utilities.KeyCodes.B=66;b.utilities.KeyCodes.C=67;b.utilities.KeyCodes.D=68;b.utilities.KeyCodes.E=69;b.utilities.KeyCodes.F=70;b.utilities.KeyCodes.G=71;b.utilities.KeyCodes.H=
72;b.utilities.KeyCodes.I=73;b.utilities.KeyCodes.J=74;b.utilities.KeyCodes.K=75;b.utilities.KeyCodes.L=76;b.utilities.KeyCodes.M=77;b.utilities.KeyCodes.N=78;b.utilities.KeyCodes.O=79;b.utilities.KeyCodes.P=80;b.utilities.KeyCodes.Q=81;b.utilities.KeyCodes.R=82;b.utilities.KeyCodes.S=83;b.utilities.KeyCodes.T=84;b.utilities.KeyCodes.U=85;b.utilities.KeyCodes.V=86;b.utilities.KeyCodes.W=87;b.utilities.KeyCodes.X=88;b.utilities.KeyCodes.Y=89;b.utilities.KeyCodes.Z=90;b.utilities.KeyCodes.KP0=96;b.utilities.KeyCodes.KP1=
97;b.utilities.KeyCodes.KP2=98;b.utilities.KeyCodes.KP3=99;b.utilities.KeyCodes.KP4=100;b.utilities.KeyCodes.KP5=101;b.utilities.KeyCodes.KP6=102;b.utilities.KeyCodes.KP7=103;b.utilities.KeyCodes.KP8=104;b.utilities.KeyCodes.KP9=105;b.utilities.KeyCodes.KP_MULTIPLY=106;b.utilities.KeyCodes.KP_ADD=107;b.utilities.KeyCodes.KP_ENTER=108;b.utilities.KeyCodes.KP_SUBTRACT=109;b.utilities.KeyCodes.KP_PERIOD=110;b.utilities.KeyCodes.KP_DIVIDE=111;b.utilities.KeyCodes.F1=112;b.utilities.KeyCodes.F2=113;b.utilities.KeyCodes.F3=
114;b.utilities.KeyCodes.F4=115;b.utilities.KeyCodes.F5=116;b.utilities.KeyCodes.F6=117;b.utilities.KeyCodes.F7=118;b.utilities.KeyCodes.F8=119;b.utilities.KeyCodes.F9=120;b.utilities.KeyCodes.F11=122;b.utilities.KeyCodes.F12=123;b.utilities.KeyCodes.F13=124;b.utilities.KeyCodes.F14=125;b.utilities.KeyCodes.F15=126;b.utilities.KeyCodes.BACKSPACE=8;b.utilities.KeyCodes.TAB=9;b.utilities.KeyCodes.ENTER=13;b.utilities.KeyCodes.SHIFT=16;b.utilities.KeyCodes.CONTROL=17;b.utilities.KeyCodes.CAPSLOCK=18;
b.utilities.KeyCodes.ESCAPE=27;b.utilities.KeyCodes.SPACE=32;b.utilities.KeyCodes.PAGEUP=33;b.utilities.KeyCodes.PAGEDOWN=34;b.utilities.KeyCodes.END=35;b.utilities.KeyCodes.HOME=36;b.utilities.KeyCodes.LEFT=37;b.utilities.KeyCodes.RIGHT=38;b.utilities.KeyCodes.UP=39;b.utilities.KeyCodes.DOWN=40;b.utilities.KeyCodes.INSERT=45;b.utilities.KeyCodes.DELETE=46;b.utilities.KeyCodes.NUMLOCK=144;b.utilities.KeyCodes.BREAK=19;b.utilities.Profiler._profiles=new w.ds.StringMap;b.utilities.WatchableValueEvent.CHANGE=
"change";c.AlertPanel.ENTER_SPEED=0.65;c.AlertPanel.SHOW_DURATION=5;c.AlertPanel.EXIT_SPEED=0.65;c.CrossPromotionScreen.IMAGE_INDEX=0;c.CrossPromotionScreen.NUM_IMAGES=3;c.DollScreen.IMAGE_INDEX=0;c.DollScreen.NUM_IMAGES=3;c.FadeTransition.TIME_SCALE=1;c.FadeTransition.TRANSITION_TIME=0.65;c.FadeTransition.FADE_TIME=3.65;c.FadeTransition.FADE_DURATION=0;c.FontFamilies.ARIAL="league_gothic-webfont";c.FontFamilies.ACTUAL_ARIAL="Arial";c.FontFamilies.WORK_SANS_BLACK="league_gothic-webfont";c.GameColors.WHITE=
"#FFFFFF";c.GameColors.BLACK="#000000";c.GameTracker.NUM_LEVELS_UNLOCKED_KEY="numLevelsUnlocked";c.GameTracker.LEVEL_SCORE_SAVE_KEY="levelScore";c.GameTracker.HAS_BEATEN_GAME_KEY="hasBeatenGame";c.GameTracker.HAS_STARTED_GAME_KEY="hasStartedGame";c.GameTracker.HAS_BEAT_LEVEL_KEY="level";c.HelpState.NUM_PAGES=8;c.HudEvent.SHOW_MENU="OnMenu";c.HudEvent.TOGGLE_MUSIC="onToggleMusic";c.LevelCompleteState.STAR_POSITIONS=[new b.Vector2D(-99.5,86),new b.Vector2D(11,50.5),new b.Vector2D(121.5,86)];c.LevelCompleteState._showPromo=
!0;c.LevelCompleteState._numLevelCompletesUntilShowCrossPromo=1;c.LevelCompleteState._firstCrossPromo=!0;c.PrintablePuzzleState._piecePositions=[new b.Vector2D(-220,-138.5),new b.Vector2D(221.5,-139),new b.Vector2D(-220.5,122),new b.Vector2D(221,121.5)];c.menuScreens.LevelSelectScreen._buttonPositions=[new b.Vector2D(-0.3,-0.55),new b.Vector2D(-0.6,-0.025),new b.Vector2D(0.2,0.455),new b.Vector2D(0.575,-0.15)];c.menuScreens.MenuScreenEvent.DISMISS="dismiss";c.minigames.MinigameEvent.BEAT="beat";c.minigames.MinigameEvent.FAIL=
"fail";c.minigames.MinigameEvent.READY="ready";c.minigames.cartGame.LevelEvent.READY="ready";c.minigames.cartGame.LifeDisplay.SPACING_X=46;c.minigames.cartGame.character.CharacterEvent.DIE="die";c.minigames.cartGame.character.Tags.HAS_BEEN_SMOKE_BOMBED="hasBeenSmokeBombed";c.minigames.cartGame.character.Tags.OBSTACLE="obstacle";c.minigames.cartGame.character.Tags.SLIDE_DESTROY_OBSTACLE="slideDestroyObstacle";c.minigames.cartGame.character.Tags.ROLLER_COASTER="rollerCoaster";c.minigames.cartGame.character.Tags.BUMBLEBEE=
"bumbleBee";c.minigames.cartGame.character.Tags.SUPER_GIRL="superGirl";c.minigames.cartGame.character.Tags.TRIGGER="trigger";c.minigames.cartGame.character.characterStates.RidingState.NUM_FOOTSTEP_SOUNDS=3;c.minigames.cartGame.character.characterStates.RidingState.DOUBLE_TAP_DURATON=0.2;c.minigames.cartGame.item.PowerStarEvent.COLLECT="collect";c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent.SPAWN="spawn";c.minigames.cartGame.levelGenerator.LevelGeneratorSpawnPieceEvent.ADD_TO_END=
"addToEnd";c.minigames.memoryGame.Card.FLIP_DURATION=0.35;c.minigames.memoryGame.CardEvent.FLIP="flip";c.minigames.memoryGame.CardEvent.UNFLIP="unflip";c.minigames.memoryGame.CardEvent.START_FLIP="startFlip";c.minigames.memoryGame.CardEvent.BAD_CARD_FLIP="badCardFlip";c.minigames.memoryGame.MemoryGame.SECONDS_PER_POINT_LOSS=2;c.minigames.memoryGame.MemoryGame.POINTS_LOST_PER_SECOND=5;c.minigames.memoryGame.MemoryGame.NUM_CARD_TYPES=11;c.minigames.memoryGame.MemoryGame.NUM_CARDS_TO_MATCH=2;c.minigames.memoryGame.MemoryGame.MATCH_DELAY=
1;c.minigames.memoryGame.MemoryGame.CLOCK_SFX_START_TIME=10;c.minigames.memoryGame.MemoryGame.POINT_LOSS_ON_RED_HERRING=50;c.minigames.puzzleBuilderGame.PuzzleBuilderGame.NUM_POINTS_PER_SOLVE=1E3;c.minigames.puzzleBuilderGame.PuzzleBuilderGame.CLOCK_SFX_START_TIME=10;c.minigames.puzzleBuilderGame.PuzzleBuilderGame.PUZZLE_GRID_COORDS_X=0;c.minigames.puzzleBuilderGame.PuzzleBuilderGame.PUZZLE_GRID_COORDS_Y=0.35;c.minigames.puzzleBuilderGame.PuzzlePiece.DESTROY_LEFT=-200;c.minigames.puzzleBuilderGame.PuzzlePiece.DESTROY_RIGHT=
1224;c.minigames.puzzleBuilderGame.PuzzlePiece.MIN_OPACITY=0;c.minigames.puzzleBuilderGame.PuzzlePiece.HALF_LIFE_ALPHA_FADE_SPEED=3;c.minigames.puzzleBuilderGame.PuzzlePiece.HALF_LIFE_ALPHA_VALUE=0.5;c.minigames.puzzleBuilderGame.PuzzlePiece.BLINK_TIME=5;c.minigames.puzzleBuilderGame.PuzzlePiece.MIN_BLINK_SPEED=0.035;c.minigames.puzzleBuilderGame.PuzzlePiece.MAX_BLINK_SPEED=0.15;c.minigames.spotTheDifferenceGame.DifferenceObjectEvent.CLICK="click";c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.POINTS_LOST_PER_SECOND=
1;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.SECONDS_PER_POINT_LOSS=1;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.POINTS_PER_FIND=50;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.CLOCK_SFX_START_TIME=10;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame.SCENE_ADVANCE_DELAY=2;c.minigames.spotTheDifferenceGame.SpotTheDifferenceGame._availableSceneIndexes=[];c.minigames.spotTheDifferenceGame.SpotTheDifferenceSplitManagerSpawnEvent.OBJECT_SPAWN="objectSpawn";w.xml.Parser.escapes=
function(a){a=new w.ds.StringMap;a.set("lt","<");a.set("gt",">");a.set("amp","&");a.set("quot",'"');a.set("apos","'");a.set("nbsp",String.fromCharCode(160));return a}(this);y.ooyala.OoyalaVideoManagerEvent.VIDEO_FINISH="videoFinish";q.main()})();
