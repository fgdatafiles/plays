!function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(){b.call(this),this.background=new a(images.startButtonBG),this.startButton=new a(images.startButton),this.startButton.x=11.5,this.startButton.y=11.5,this.stopButton=new a(images.stopButton),this.stopButton.x=11.5,this.stopButton.y=11.5,this.addChild(this.background,this.startButton),this.regX=this.getBounds().width/2,this.regY=this.getBounds().height/2,this.y=700+this.regY},e=(b.prototype,extend(d,b));e.toggle=function(a){a?(this.removeChild(this.startButton),this.addChild(this.stopButton)):(this.removeChild(this.stopButton),this.addChild(this.startButton))},e.highlight=function(a){c.get(this).to({scaleX:1.25,scaleY:1.25},500,createjs.Ease.sineInOut).to({scaleX:1,scaleY:1},500,createjs.Ease.sineInOut).to({scaleX:1.25,scaleY:1.25},500,createjs.Ease.sineInOut).to({scaleX:1,scaleY:1},500,createjs.Ease.sineInOut).to({scaleX:1.25,scaleY:1.25},500,createjs.Ease.sineInOut).to({scaleX:1,scaleY:1},500,createjs.Ease.sineInOut)},e.trash=function(){c.get(this).to({scaleX:0,scaleY:0},100).call(function(){this.parent.removeChild(this)}.bind(this))},namespace("wgbh").CycleSwitch=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(c){b.call(this),this.sprite=new a(images[c.image]),this.addChild(this.sprite);var d=c.image+"Highlight";this.highlight=new a(images[d]),this.highlight.x=this.highlight.y=-5,this.addChildAt(this.highlight,0),this.highlight.alpha=0,this.regX=this.getBounds().width/2,this.regY=this.getBounds().height/2},e=(b.prototype,extend(d,b));e.bobA=function(a){var b=this.y;c.get(this).wait(a).to({y:b+10},1e3,createjs.Ease.sineInOut).call(function(){this.bobB(b)}.bind(this))},e.bobB=function(a){c.get(this).to({y:a},1e3,createjs.Ease.sineInOut).call(this.bobA.bind(this))},e.hungry=function(a){var b;b=a?-45:0,c.get(this).to({rotation:b},1e3,createjs.Ease.sineInOut)},e.feedbackHighlight=function(a){a?(this.highlightActive=!0,this.addChildAt(this.highlight,0),c.get(this.highlight).to({alpha:1},500).to({alpha:0},500).call(function(){this.feedbackHighlight(!0)}.bind(this))):(this.highlightActive=!1,c.get(this.highlight,{override:!0}).to({alpha:0},500))},e.trash=function(){c.get(this).to({scaleX:0,scaleY:0},100).call(function(){this.parent.removeChild(this)}.bind(this))},namespace("wgbh").Fish=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(c){b.call(this),this.gamedata=app.config.gameData,this.gamestate=app._states.game;var d=c.image+"HighlightWhite";this.highlight=new a(images[d]),this.highlight.x=this.highlight.y=-5,this.addChild(this.highlight),this.highlight.alpha=0,this.fishSprite=new a(images[c.image]),this.addChild(this.fishSprite),this.onMouseDown=this.onMouseDown.bind(this),this.addEventListener("mousedown",this.onMouseDown),this.isFish=!0,this.active=!0},e=b.prototype,f=extend(d,b);f.onMouseDown=function(a){this.active&&(this.gamestate.onSourceDown(this,a),this.gamestate.TrainingManager.trainingFish&&this.gamestate.TrainingManager.tankArrow())},f.feedbackHighlight=function(a){a?(this.highlightActive=!0,this.addChildAt(this.highlight,0),c.get(this.highlight).to({alpha:1},500).call(function(){c.get(this.highlight).to({alpha:0},500).call(function(){this.feedbackHighlight(!0)}.bind(this))}.bind(this))):(this.highlightActive=!1,c.get(this.highlight,{override:!0}).to({alpha:0},500))},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("wgbh").FishSource=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Text"),d=include("createjs.Tween"),e=function(){b.call(this),this.gamedata=app.config.gameData,this.gamestate=app._states.game,this.leveldata=this.gamedata.levels[this.gamedata.currentLevel],this.barBG=new a(images.plantMeter),this.addChild(this.barBG),this.highlight=new a(images.training_meter_highlight),this.highlight.y=-10,this.highlight.x=-10,this.highlight.alpha=0,this.addChild(this.highlight);var c=new createjs.Graphics;c.beginFill("#92ed1b"),c.drawRect(0,0,91,19),this.statusBar=new createjs.Shape(c),this.statusBar.x=10,this.statusBar.y=14,this.statusBar.scaleX=0,this.addChild(this.statusBar),this.plantIcon=new a(images[this.leveldata.meterImage]),this.addChild(this.plantIcon),this.plantIcon.x=this.barBG.image.width-this.plantIcon.image.width-3,this.plantIcon.y=5},f=(b.prototype,extend(e,b));f.setup=function(){this.targetCount=this.gamestate.leveldata.goalCount,this.goalText=new c(this.targetCount,"22px Arial","black"),this.goalText.x=110,this.goalText.y=12,this.addChild(this.goalText)},f.updateStats=function(a){d.get(this.statusBar).to({scaleX:this.gamestate.harvestCount/this.targetCount},150)},f.trainingHighlight=function(){d.get(this.highlight).to({alpha:1},500,createjs.Ease.sineInOut).to({alpha:0},500,createjs.Ease.sineInOut).to({alpha:1},500,createjs.Ease.sineInOut).to({alpha:0},500,createjs.Ease.sineInOut).to({alpha:1},500,createjs.Ease.sineInOut).to({alpha:0},500,createjs.Ease.sineInOut)},f.trash=function(){d.get(this).to({scaleX:0,scaleY:0},100).call(function(){this.parent.removeChild(this)}.bind(this))},namespace("wgbh").HarvestUI=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Sound"),d=include("createjs.Tween"),e=function(c){b.call(this),this.pipedata=c,this.planter=c.planter,this.gamedata=app.config.gameData,this.gamestate=app._states.game,this.tileRadius=this.gamedata.gridSettings.tileRadius,this.footprint=c.footprint,this.connect=c.connect,this.connectPoints=c.connectPoints,this.pipeSprite=new a(images[c.image]),this.pipeSprite.regX=this.pipeSprite.image.width/2,this.pipeSprite.regY=this.pipeSprite.image.height/2,this.pipeSprite.x=this.pipeSprite.y=this.tileRadius/2;var d=this.pipeSprite.image.width>this.pipeSprite.image.height?this.pipeSprite.image.width:this.pipeSprite.image.height;this.pipeSprite.startScale=this.pipeSprite.scaleX=this.pipeSprite.scaleY=d/this.gamedata.gridSettings.tileRadius*1.25,c.rotation&&(this.pipeSprite.rotation=90*c.rotation),this.addChild(this.pipeSprite);for(var e=0;e<this.connectPoints.length;e++){var f=this.connectPoints[e],g=new a(images.button);g.scaleX=g.scaleY=0,g.x=f.x*this.tileRadius,g.y=f.y*this.tileRadius,this.addChild(g)}this.alpha=.6,this.placed=!1,this.active=!1,this.flowDone=!1,this.connectedPipes=[],this.plant=null,this.planter&&(this.plant=new wgbh.Plant,this.plant.x=this.tileRadius/2,this.plant.y=this.tileRadius/2,this.addChild(this.plant)),/Mobi/.test(navigator.userAgent)&&this.planter&&this.addEventListener("click",this.gamestate.FeedbackManager.editHarvestWarning)},f=(b.prototype,extend(e,b));f.growPlants=function(){this.plant&&this.plant.cycle(),this.plantsGrown=!0},f.activate=function(){if(this.gamestate.activePipes.push(this),this.planter&&!this.plantCounted&&this.gamestate.plantCount++,this.active=!0,this.activeCheck=!0,this.tint(!0),this.connectedPipes[0])for(var a=0;a<this.connectedPipes.length;a++)this.connectedPipes[a].activeCheck||this.connectedPipes[a].activate()},f.flow=function(){d.get(this.pipeSprite).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:this.pipeSprite.startScale,scaleY:this.pipeSprite.startScale},100),this.planter&&this.growPlants()},f.locateConnections=function(){for(var a=[],b=0;b<this.connectPoints.length;b++){var c=this.connectPoints[b],d=this.x+c.x*this.tileRadius,e=this.y+c.y*this.tileRadius;a.push({x:d,y:e})}return a},f.addConnection=function(a){this.connectedPipes.push(a)},f.removeConnection=function(a){var b=this.connectedPipes.indexOf(a);this.connectedPipes.splice(b,1),this.connectedPipes.length<1&&!this.isStartPipe&&!this.isEndPipe&&this.tint(!1)},f.removeAllConnections=function(a){for(var b=0;b<this.connectedPipes.length;b++)this.connectedPipes[b].removeConnection(this);this.connectedPipes=[],this.tint(!1)},f.removePlants=function(){},f.resetPipe=function(){this.removeAllConnections()},f.tint=function(a){a===!1?this.alpha=.6:this.alpha=1},f.addHighlight=function(){this.highlightStatus=3,this.highlight=new a(images.tank_pipe_highlight),this.highlight.x=this.highlight.y=-5,this.highlight.scaleX=this.highlight.scaleY=1.1,this.addChildAt(this.highlight,0),this.highlight.alpha=0},f.feedbackHighlight=function(a){this.highlight&&(a?(this.highlightActive=!0,this.addChildAt(this.highlight,0),d.get(this.highlight).to({alpha:1},500).call(function(){d.get(this.highlight).to({alpha:0},500).call(function(){this.feedbackHighlight(!0)}.bind(this))}.bind(this))):(this.highlightActive=!1,d.get(this.highlight,{override:!0}).to({alpha:0},500)))},f.trash=function(){c.instance.play("sfx_pop"),d.get(this).to({scaleX:0,scaleY:0},100).call(function(){this.parent.removeChild(this)}.bind(this))},namespace("wgbh").Pipe=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(c){b.call(this),this.gamedata=app.config.gameData,this.gamestate=app._states.game,c.trainingHighlight&&(this.trainingHighlight=new a(images[c.trainingHighlight]),this.trainingHighlight.regX=this.trainingHighlight.image.width/2,this.trainingHighlight.regY=this.trainingHighlight.image.height/2,this.addChild(this.trainingHighlight),this.trainingHighlight.alpha=0,this.highlight=this.trainingHighlight),this.pipeSprite=new a(images[c.image+"_shadow"]),this.pipeSprite.regX=this.pipeSprite.image.width/2,this.pipeSprite.regY=this.pipeSprite.image.height/2;var d=this.pipeSprite.image.width>this.pipeSprite.image.height?this.pipeSprite.image.width:this.pipeSprite.image.height;this.pipeSprite.scaleX=this.pipeSprite.scaleY=d/this.gamedata.gridSettings.tileRadius*1.1,c.rotation&&(this.pipeSprite.rotation=90*c.rotation),this.addChild(this.pipeSprite),this.isPipe=!0,this.active=!0,c.highlightScrollY&&(this.highlightScrollY=c.highlightScrollY),this.startDrag=this.startDrag.bind(this),this.onDrag=this.onDrag.bind(this),this.endDrag=this.endDrag.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.addEventListener("mousedown",this.startDrag)},e=b.prototype,f=extend(d,b);f.onMouseDown=function(a){this.startDrag(a)},f.startDrag=function(a,b){this.active&&(this.removeEventListener("mousedown",this.startDrag),this.addEventListener("pressmove",this.onDrag),this.addEventListener("pressup",this.endDrag),this.startX=a.rawX)},f.onDrag=function(a){a.rawX>this.startX+25&&(this.gamestate.onSourceDown(this,a),this.endDrag(a))},f.endDrag=function(a){this.addEventListener("mousedown",this.startDrag),this.removeEventListener("pressmove",this.onDrag),this.removeEventListener("pressup",this.endDrag)},f.addHighlight=function(){this.newHighlight=new a(images.pipeHighlightWhite),this.newHighlight.regX=this.newHighlight.image.width/2,this.newHighlight.regY=this.newHighlight.image.height/2,this.newHighlight.scaleX=this.newHighlight.scaleY=1.1,this.addChildAt(this.newHighlight,0),this.newHighlight.alpha=0,this.highlight=this.newHighlight},f.feedbackHighlight=function(a){this.gamestate.TrainingManager.trainingActive?this.highlight=this.trainingHighlight:this.highlight=this.newHighlight,a?(this.highlightActive=!0,c.get(this.highlight).to({alpha:1},500).call(function(){c.get(this.highlight).to({alpha:0},500).call(function(){this.feedbackHighlight(!0)}.bind(this))}.bind(this))):(this.highlightActive=!1,c.get(this.highlight,{override:!0}).to({alpha:0},500))},f.stopHighlight=function(){c.get(this.highlight,{override:!0}).to({alpha:0},500)},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("wgbh").PipeSource=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Tween"),d=function(){b.call(this),this.gamestate=app._states.game,this.gamedata=app.config.gameData;var c=this.gamedata.plants[this.gamestate.leveldata.plantType];this.sprout=new a(images.sprout),this.sprout.regX=this.sprout.image.width/2,this.sprout.regY=this.sprout.image.height,this.sprout.y=-5,this.addChild(this.sprout),this.plant=new a(images[c.healthy]),this.plant.regX=this.plant.image.width/2,this.plant.regY=this.plant.image.height,this.plant.y=-5,"Carrots"==this.gamestate.leveldata.plantType&&(this.hitImage=new a(images[this.gamedata.plants.Cucumbers.healthy]),this.hitImage.regX=this.hitImage.image.width/2,this.hitImage.regY=this.hitImage.image.height,this.hitImage.y=-5,this.hitImage.alpha=.01,this.addChild(this.hitImage)),this.wilted=new a(images[c.wilted]),this.wilted.regX=this.wilted.image.width/2,this.wilted.regY=this.wilted.image.height,this.wilted.y=-5,this.wiltedHighlight=new a(images[c.wiltedWarning]),this.wiltedHighlight.regX=this.wiltedHighlight.image.width/2,this.wiltedHighlight.regY=this.wiltedHighlight.image.height,this.wiltedHighlight.y=-3,this.harvestHighlightImage=new a(images[c.highlight]),this.harvestHighlightImage.regX=this.harvestHighlightImage.image.width/2,this.harvestHighlightImage.regY=this.harvestHighlightImage.image.height,this.harvestHighlightImage.y=5;var d=new createjs.Graphics;d.setStrokeStyle(2),d.beginStroke("red"),d.drawRect(0,0,90,100),this.plantMask=new createjs.Shape(d),this.plantMask.x=-45,this.plantMask.y=-106,this.highlightContainer=new b,this.highlightContainer.addChild(this.wiltedHighlight),this.highlightContainer.addChild(this.harvestHighlightImage),this.pulse(this.highlightContainer),this.wiltedHighlight.visible=!1,this.harvestHighlightImage.visible=!1,this.highlightContainer.visible=!1,this.addChild(this.highlightContainer),this.sprout.mask=this.plantMask,this.plant.mask=this.plantMask,this.highlightContainer.mask=this.plantMask,this.unhealthy=!1,this.currentPlant=this.sprout,this.harvest=this.harvest.bind(this),this.growthTime=5,this.age=0,this.arbitraryNum=Math.floor(5*Math.random())},e=b.prototype,f=extend(d,b);f.reset=function(){this.age=0,this.toggleHarvest(!1),this.harvestActive=!1,this.removeChild(this.plant),this.addChild(this.sprout),this.stage=0},f.cycle=function(){this.unhealthy||(this.age++,this.age==this.growthTime+this.arbitraryNum&&this.growStageA(),this.age==2*this.growthTime+this.arbitraryNum&&this.growStageB())},f.growStageA=function(){this.removeChild(this.sprout),this.addChild(this.plant),this.plant.y=10,this.plant.scaleX=this.plant.scaleY=.75,this.stage=1},f.growStageB=function(){c.get(this.plant).to({y:0,scaleX:1,scaleY:1},300,createjs.Ease.backOut),this.stage=2,this.harvestActive=!0,this.toggleHarvest(!0)},f.toggleUnhealthy=function(a){a&&!this.unhealthy?(this.unhealthy=!0,this.sprout.alpha=0,this.plant.alpha=0,this.addChild(this.wilted),this.wiltedHighlight.visible=!0,this.toggleHarvest(!1),this.harvestHighlight(!1)):!a&&this.unhealthy&&(this.sprout.alpha=1,this.unhealthy=!1,this.removeChild(this.wilted),this.wiltedHighlight.visible=!1,this.feedbackHighlight(!1),1==this.stage&&(this.highlightContainer.y=10),this.plant.alpha=1,this.harvestActive&&this.toggleHarvest(!0))},f.harvest=function(){this.gamestate.farmActive&&(this.harvestActive=!1,this.harvestFeedback=!1,this.removeChild(this.plant),this.addChild(this.sprout),this.age=0,this.gamestate.harvestPlant(),this.toggleHarvest(!1),this.harvestHighlight(!1))},f.editHarvestWarning=function(){!this.gamestate.farmActive&&this.gamestate.FeedbackManager.currentFeedbackStatus&&this.gamestate.SoundManager.playVO("enable farm to harvest!")},f.toggleHarvest=function(a){a?(this.harvestFeedback=!0,this.harvestHighlight(!0),this.addEventListener("mousedown",this.harvest),this.gamestate.harvestAlert||this.gamestate.FeedbackManager.alertHarvest(this)):(this.harvestFeedback=!1,this.harvestHighlight(!1),this.removeEventListener("mousedown",this.harvest))},f.feedbackHighlight=function(a){this.highlightContainer.visible=a},f.harvestHighlight=function(a){a&&this.harvestActive&&!this.unhealthy?(this.harvestHighlightImage.visible=!0,this.highlightContainer.visible=!0):(this.harvestHighlightImage.visible=!1,this.highlightContainer.visible=!1)},f.pulse=function(a){c.get(a).to({alpha:1},500).to({alpha:.25},500).call(this.pulse.bind(this,a))},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("wgbh").Plant=d}(),function(){var a=include("createjs.Container"),b=include("createjs.Tween"),c=function(){a.call(this),this.gamestate=app._states.game,this.gamedata=this.gamestate.gamedata,this.settings=this.gamedata.feedback,this.fish=[]},d=(a.prototype,extend(c,a));d.setup=function(){this.tankCapMax=this.settings.tankCap[this.gamestate.leveldata.tankSize-1].max},d.setSize=function(b){this.size=this.gamestate.tankSize,1==this.size?this.gamestate.tankCap=5:2==this.size?this.gamestate.tankCap=8:3==this.size&&(this.gamestate.tankCap=12),this.BGwidth=200+200*this.size,this.fishContainer=new a,this.BGContainer&&(this.BGContainer.removeAllChildren(),this.removeChild(this.BGContainer));var c=new createjs.Graphics;c.beginFill("#0bf4ec"),c.setStrokeStyle(2),c.beginStroke("#c0f8ff"),c.drawRect(0,10,this.BGwidth,120),this.BGA=new createjs.Shape(c),c=new createjs.Graphics,c.beginFill("#1fd0c8"),c.drawRect(10,20,this.BGwidth-20,100),this.BGB=new createjs.Shape(c),c=new createjs.Graphics;var d=new createjs.Matrix2D;d.translate(0,0),d.scale(this.BGwidth/515,1),c.beginBitmapFill(images.tankDirty,"no-repeat",d),c.drawRect(10,20,this.BGwidth-20,100),this.dirty=new createjs.Shape(c),c=new createjs.Graphics,c.beginBitmapFill(images.tankSheen,"no-repeat",d),c.drawRect(10,20,this.BGwidth-20,100),this.glass=new createjs.Shape(c),c=new createjs.Graphics,c.beginFill("#35305b"),c.setStrokeStyle(5),c.beginStroke("#60549e"),c.drawRect(-10,0,this.BGwidth+20,20),this.BGC=new createjs.Shape(c),this.BGContainer=new a,this.BGContainer.addChild(this.BGA,this.BGB,this.BGC),this.addChild(this.BGContainer),this.addChild(this.fishContainer),this.addChild(this.dirty),this.addChild(this.glass),this.glass.y=3,this.dirty.y=3,this.dirty.alpha=0,this.x=625-100*this.size,this.y=800-this.gamestate.gamedata.gridSettings.tileRadius},d.addStartFish=function(){var a;a=this.gamestate.leveldata.isTrainingLevel&&!this.gamedata.training.complete?0:this.gamedata.feedback.tankCap[this.size-1].start;for(var b=0;a>b;b++)newFish=new wgbh.Fish(this.gamestate.gamedata.fishTypes[Math.floor(Math.random()*this.gamestate.gamedata.fishTypes.length)]),this.gamestate.DragManager.addObject(newFish),newFish.enableDrag(),this.gamestate.dragLayer.addChild(newFish),newFish.x=this.x+100+150*b,newFish.y=725,newFish.isFish=!0,this.addFish(newFish,!0)},d.addFish=function(a,b){var c=a.parent.localToLocal(a.x,a.y,this.fishContainer);a.x=c.x,a.y=c.y,this.fishContainer.addChild(a),this.fish.push(a),this.gamestate.fishCount=this.fish.length,a.placed=!0,this.fish.sort(this.compareX),this.sortFish(b),this.fish.length>=this.tankCapMax&&this.gamestate.EditDrawer.toggleFish(!1),this.gamestate.TrainingManager.trainingFish&&(this.gamestate.TrainingManager.trainingFishAdded(),a.disableDrag())},d.sortFish=function(a){for(var c,d,e=(this.BGwidth-70)/this.fish.length,f=0;f<this.fish.length;f++)c=this.fish[f],d=75+e*f,b.removeTweens(c),a?(c.x=d,c.y=60,b.get(c).wait(150*f).call(c.bobA)):b.get(c).to({x:d,y:60},500).wait(150*f).call(c.bobA)},d.hungryFish=function(a){this.fish.forEach(function(b){b.hungry(a)})},d.removeFish=function(a){var b=this.localToLocal(a.x,a.y,this.gamestate.dragLayer);a.x=b.x,a.y=b.y,index=this.fish.indexOf(a),this.fish.splice(index,1),this.gamestate.fishCount=this.fish.length,this.sortFish(),this.fish.length<this.tankCapMax&&this.gamestate.EditDrawer.toggleFish(!0)},d.clearFish=function(){for(var a=0;a<this.fish.length;a++)b.get(this.fish[a]).to({scaleX:0,scaleY:0},250);this.fish=[],this.gamestate.fishCount=0,this.addStartFish()},d.highlight=function(a){},d.compareX=function(a,b){return a.x<b.x?-1:a.x>b.x?1:0},namespace("wgbh").Tank=c}(),function(){var a=include("createjs.Container"),b=include("createjs.Tween"),c=function(b,c,d,e,f){a.call(this),this.grid=b,this.radius=e,this.padding=f,this.xCoord=c,this.yCoord=d,this.pipeType=0,this.setup()},d=a.prototype,e=extend(c,a);e.setup=function(){this.x=this.grid.gridSettings.offsetX+this.radius*this.xCoord,this.y=this.grid.gridSettings.offsetY+this.radius*this.yCoord;var a=new createjs.Graphics;a.beginFill("white"),a.drawRect(this.padding,this.padding,this.radius-1*this.padding,this.radius-1*this.padding);var b=new createjs.Graphics;b.setStrokeStyle(3),b.beginStroke("#FFFFFF"),b.drawRect(0,0,this.radius,this.radius),this.outline=new createjs.Shape(b),this.outline.alpha=.5,this.addChild(this.outline),this.BG=new createjs.Shape(a),this.BG.regX=this.BG.regY=this.radius/2,this.BG.x=this.BG.y=this.radius/2,this.BG.alpha=.5,this.BG.scaleX=this.BG.scaleY=.1,this.arr_pipes=[this.pipeH,this.pipeV,this.pipeT],this.pipeType=null,this.isOccupied=!1,this.highlight=this.highlight.bind(this)},e.occupy=function(a){this.isOccupied=a},e.highlight=function(a){a?b.get(this.BG).to({scaleX:1,scaleY:1},250):b.get(this.BG).to({scaleX:.1,scaleY:.1},500)},e.teardown=function(){d.teardown.call(this),this.skin=null},namespace("wgbh").Tile=c}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container");PipeSource=include("wgbh.PipeSource");var c=function(){b.call(this),this.gamedata=app.config.gameData,this.gamestate=app._states.game,this.background=null,this.arr_pipes=[],this.arr_fish=[],this.setup()},d=(b.prototype,extend(c,b));d.setup=function(){this.background=new a(images.toolbar_bg),this.background2=new a(images.toolbar_bg),this.cover=new a(images.toolbar_cover),this.cover.y=536,this.addChild(this.background),this.editContainer=new b,this.editContainer.addChild(this.editFishButton),this.editContainer.addChild(this.editTankButton),this.editContainer.addChild(this.editPipeButton),this.sourceContainer=new b,this.tankContainer=new b,this.fishContainer=new b,this.background2.alpha=.01,this.sourceContainer.addChild(this.background2);for(var c,d=125,e=0;e<this.gamedata.pipes.length;e++)c=new PipeSource(this.gamedata.pipes[e]),c.selectID=e,c.scaleX=c.scaleY=.75,c.x=100,c.y=d,d=c.y+c.getBounds().height*c.scaleX+40,this.sourceContainer.addChild(c),this.arr_pipes.push(c),4==e&&c.addHighlight();for(var f=0;f<this.gamedata.fishTypes.length;f++){var g=new wgbh.FishSource(this.gamedata.fishTypes[f]);g.selectID=f,g.x=85-g.getBounds().width/2,g.y=575+100*f,this.fishContainer.addChild(g),this.arr_fish.push(g)}this.sourceContainer.y=-290,this.addChild(this.sourceContainer),this.addChild(this.cover),this.addChild(this.fishContainer),this.startDrag=this.startDrag.bind(this),this.onDrag=this.onDrag.bind(this),this.endDrag=this.endDrag.bind(this),this.sourceContainer.addEventListener("mousedown",this.startDrag),this.sourceContainer.mouseChildren=!0},d.toggleFish=function(a){a?this.arr_fish.forEach(function(a){a.alpha=1,a.active=!0}):(this.arr_fish.forEach(function(a){a.alpha=.5,a.active=!1}),this.gamestate.SoundManager.playVO("feedback-fish-ran-out"))},d.startDrag=function(a,b){this.gamestate.TrainingManager.trainingActive||(this.lastY=a.rawY,this.sourceContainer.removeEventListener("mousedown",this.startDrag),this.sourceContainer.addEventListener("pressmove",this.onDrag),this.sourceContainer.addEventListener("pressup",this.endDrag))},d.onDrag=function(a){var b=a.rawY-this.lastY,c=this.sourceContainer.y+b;0>=c&&c>=-290&&(this.sourceContainer.y=c),this.lastY=a.rawY},d.endDrag=function(a){this.lastY=null,this.sourceContainer.addEventListener("mousedown",this.startDrag),this.sourceContainer.removeEventListener("pressmove",this.onDrag),this.sourceContainer.removeEventListener("pressup",this.endDrag)},namespace("wgbh").EditDrawer=c}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Sound"),d=function(d,e){this.status=d,b.call(this),this.gamestate=app._states.game,this.endScreenData=app.config.gameData.endScreen,this.gamestate.gamePaused=!0,"success"==d?(c.instance.play("Challenge Complete"),this.vo=[this.endScreenData.success.vo[this.endScreenData.success.index]],this.vo.push(this.gamestate.leveldata.successAudio),this.vo.push(this.endScreenData.praise.vo[this.endScreenData.praise.index]),this.endScreenData.praise.index<3?this.endScreenData.praise.index++:this.endScreenData.praise.index=0):(this.vo=["uhoh-not-healthy"],this.vo.push(this.endScreenData[d].vo),this.vo.push("try-again")),this.gamestate.TrainingManager.trainingActive?this.gamestate.SoundManager.playVO("train-success"):this.gamestate.SoundManager.playVO(this.vo),this.endScreenData.success.index<2?this.endScreenData.success.index++:this.endScreenData.success.index=0,this.image=this.endScreenData[d].icon,e&&(this.callback=e),this.frame=new a(images.level_fail_frame),this.addChild(this.frame),"success"==d?(this.icon=new a(images[this.gamestate.leveldata.menuImageDone]),this.icon.scaleX=this.icon.scaleY=1.5):this.icon=new a(images[this.image]),this.icon.regX=this.icon.image.width/2,this.icon.regY=this.icon.image.height/2,this.icon.x=620,this.icon.y=475,this.addChild(this.icon),"success"==d?(this.nextButton=new a(images.nextButton),this.nextButton.x=680,this.nextButton.y=635,this.nextButton.addEventListener("mousedown",this.onNext.bind(this)),this.addChild(this.nextButton)):(this.homeButton=new a(images.homeButton),this.homeButton.x=680,this.homeButton.y=635,this.homeButton.addEventListener("mousedown",this.onHome.bind(this)),this.addChild(this.homeButton)),this.replayButton=new a(images.replayButton),this.replayButton.x=590-this.replayButton.image.width,this.replayButton.y=635,this.replayButton.addEventListener("mousedown",this.onReplay.bind(this)),this.addChild(this.replayButton),this.textImage=new a(images[this.endScreenData[d].textImage]),this.textImage.x=107,this.textImage.y=45,this.addChild(this.textImage)},e=(b.prototype,extend(d,b));e.onReplay=function(){this.hide(),this.popupActive=!1,this.gamestate.resetLevel(),this.gamestate.SoundManager.stopSound(),c.instance.play("sfx_click")},e.onNext=function(){this.hide(),this.popupActive=!1,"success"==this.status?this.gamestate.doPayoff():this.gamestate.backToMenu(),this.gamestate.SoundManager.stopSound(),c.instance.play("sfx_click")},e.onHome=function(){this.gamestate.backToMenu(),this.hide(),this.gamestate.SoundManager.stopSound(),c.instance.play("sfx_click")},e.hide=function(){this.gamestate.gamePaused=!1,this.removeAllChildren(),this.parent.removeChild(this)},namespace("wgbh").EndScreen=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Text"),d=function(a){b.call(this),this.stats=null,this.setup()},e=(b.prototype,extend(d,b));e.setup=function(){var b=new createjs.Graphics;b.beginFill("#cecece"),b.setStrokeStyle(1),b.beginStroke("#000000"),b.drawRect(0,0,1280,800),this.BG=new createjs.Shape(b),this.addChild(this.BG),this.doButton=new a(images.button),this.doButton.x=640-this.doButton.image.width/2,this.doButton.y=350,this.doButton.addEventListener("mousedown",this.onButtonPress.bind(this)),this.addChild(this.doButton)},e.refreshPopup=function(a,b,d){this.titletext&&this.removeChild(this.titletext),this.titletext=new c(a,"45px Arial","black"),this.titletext.textAlign="center",this.titletext.x=640,this.titletext.y=10,this.addChild(this.titletext),this.popupActive=!0,this.feedback&&this.removeChild(this.feedback),this.feedback=new c(b,"30px Arial","black"),this.feedback.textAlign="center",this.feedback.x=640,this.feedback.y=200,this.addChild(this.feedback),d?this.callback=d:this.callback=!1},e.onButtonPress=function(){this.hide(),this.popupActive=!1,this.callback&&this.callback()},e.hide=function(){this.parent.removeChild(this)},namespace("wgbh").FullscreenPopup=d}(),function(){var a=include("createjs.Container"),b=include("wgbh.Tile"),c=function(){a.call(this),this.gamestate=app._states.game,this.gamedata=app.config.gameData,this.gridSettings=this.gamedata.gridSettings,this.gridWidth=this.gridSettings.gridWidth,this.gridHeight=this.gridSettings.gridHeight,this.tileRadius=this.gridSettings.tileRadius,this.tilePadding=this.gridSettings.tilePadding,this.width=this.gridWidth*this.tileRadius,this.arr_tiles=[],this.arr_rows=[],this.startTile=null,this.endTile=null,this.lastTile=null},d=(a.prototype,extend(c,a));d.setup=function(){for(var a,c=0;c<this.gridWidth;c++){for(var d=[],e=0;e<this.gridHeight;e++)a=new b(this,c,e,this.tileRadius,this.tilePadding),c==4-this.gamestate.tankSize&&5==e&&(a.startTile=!0,this.startTile=a),c==5+this.gamestate.tankSize&&5==e&&(a.endTile=!0,this.endTile=a),this.addChild(a),this.arr_tiles.push(a),d.push(a);this.arr_rows.push(d)}},d.checkFootprint=function(a){for(var b=null,c=0;c<this.arr_tiles.length;c++){var d=this.arr_tiles[c];if(a.x>d.x-d.radius/2&&a.x<d.x+d.radius/2&&a.y>d.y-d.radius/2&&a.y<d.y+d.radius/2){b=d;break}}if(null!==b){var e=!0;if(a.footprint)for(var f=0;f<a.footprint.length;f++){var g=a.footprint[f];if(cX=b.xCoord+g.x,cY=b.yCoord+g.y,this.arr_rows[cX][cY].isOccupied){e=!1;break}}if(e)return b}},d.occupyTiles=function(a,b,c){if(b.occupy(c),a.footprint)for(var d=0;d<a.footprint.length;d++){var e=a.footprint[d];cX=b.xCoord+e.x,cY=b.yCoord+e.y,this.arr_rows[cX][cY].occupy(c)}},d.obstructTiles=function(a){for(var b=0;b<a.length;b++){var c=a[b];cX=c[0],cY=c[1],this.arr_rows[cX][cY].occupy(!0),this.arr_rows[cX][cY].highlight(!0)}},d.obstructAll=function(){this.arr_rows.forEach(function(a){a.forEach(function(a){a.occupy(!0)})})},d.findGrowTiles=function(){for(var a=0;a<this.arr_tiles.length;a++)null!==this.arr_tiles[a].pipeType&&this.arr_tiles[a].checkGrowArea()},namespace("wgbh").GridManager=c}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Sound"),d=function(c,d){b.call(this),this.gamestate=app._states.game,this.leveldata=c,this.gamestate.gamePaused=!0,d&&(this.callback=d);var e=new createjs.Graphics;e.beginFill("black"),e.drawRect(0,0,1280,800),this.tint=new createjs.Shape(e),this.tint.alpha=.5,this.tint.addEventListener("mousedown",this.nothing.bind(this)),this.addChild(this.tint),this.BG=new a(images.home_button_window),this.BG.x=640-this.BG.image.width/2,this.BG.y=400-this.BG.image.height/2,this.addChild(this.BG),this.homeButton=new a(images.home_button_home),this.homeButton.x=500,this.homeButton.y=325,this.homeButton.addEventListener("mousedown",this.onHomeButton.bind(this)),this.addChild(this.homeButton),this.resetButton=new a(images.home_button_level_reset),this.resetButton.x=640-this.resetButton.image.width/2,this.resetButton.y=325,this.resetButton.addEventListener("mousedown",this.onResetButton.bind(this)),this.addChild(this.resetButton),this.ccButton=new a(images.home_button_cc),this.ccButton.x=705,this.ccButton.y=325,this.ccButton.addEventListener("mousedown",this.toggleCaptions.bind(this)),this.ccButtonOff=new a(images.home_button_cc_off),this.ccButtonOff.x=705,this.ccButtonOff.y=325,this.ccButtonOff.addEventListener("mousedown",this.toggleCaptions.bind(this)),app.captions._mute?this.addChild(this.ccButton):this.addChild(this.ccButtonOff),this.closeButton=new a(images.home_button_close),this.closeButton.x=640-this.closeButton.image.width/2,this.closeButton.y=450,this.closeButton.addEventListener("mousedown",this.onButtonPress.bind(this)),this.addChild(this.closeButton),this.popupActive=!0},e=(b.prototype,extend(d,b));e.onButtonPress=function(){c.instance.play("sfx_click"),this.hide(),this.popupActive=!1},e.onResetButton=function(){c.instance.play("sfx_click"),this.gamestate.resetLevel(!0),this.hide()},e.onHomeButton=function(){c.instance.play("sfx_click"),this.gamestate.backToMenu(),this.hide()},e.toggleCaptions=function(){c.instance.play("sfx_click"),app.captions._mute?(app.captions._mute=!1,this.removeChild(this.ccButton),this.addChild(this.ccButtonOff)):(app.captions._mute=!0,this.removeChild(this.ccButtonOff),this.addChild(this.ccButton))},e.nothing=function(){},e.hide=function(){this.gamestate.gamePaused=!1,this.removeAllChildren(),this.parent.removeChild(this)},namespace("wgbh").HomeMenu=d}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("springroll.Sound"),d=include("createjs.Tween"),e=function(c,d){b.call(this),this.gamestate=app._states.game,
this.leveldata=c,this.gamestate.gamePaused=!0,this.hidden=!1,d&&(this.callback=d);var e=new createjs.Graphics;e.beginFill("black"),e.drawRect(0,0,1280,800),this.tint=new createjs.Shape(e),this.tint.alpha=.5,this.tint.addEventListener("mousedown",this.nothing.bind(this)),this.addChild(this.tint),this.BG=new a(images.intro_frame),this.BG.x=640-this.BG.image.width/2,this.BG.y=400-this.BG.image.height/2,this.addChild(this.BG),this.icon=new a(images[this.leveldata.introImage]),this.icon.x=620-this.icon.image.width/2,this.icon.y=350,this.addChild(this.icon),this.nextButton=new a(images.intro_next_arrow),this.nextButton.x=1100,this.nextButton.y=700,this.nextButton.regX=this.nextButton.image.width/2,this.nextButton.regY=this.nextButton.image.height/2,this.nextButton.addEventListener("mousedown",this.onButtonPress.bind(this)),this.addChild(this.nextButton);var f="LI_text_"+this.leveldata.plantType;this.titleText=new a(images[f]),this.titleText.x=this.BG.x+27,this.titleText.y=this.BG.y+26,this.addChild(this.titleText);var g="LI_"+this.leveldata.goalCount;this.countText=new a(images[g]),this.countText.x=700,this.countText.y=450,this.addChild(this.countText),this.popupActive=!0,this.gamestate.SoundManager.playVO(this.leveldata.introAudio,this.highlightNext.bind(this))},f=(b.prototype,extend(e,b));f.onButtonPress=function(){c.instance.play("sfx_click"),this.gamestate.SoundManager.stopVO(),this.hide(),this.popupActive=!1,this.callback&&this.callback()},f.highlightNext=function(a){this.hidden||d.get(this.nextButton).to({scaleX:1.25,scaleY:1.25},750,createjs.Ease.quadInOut).to({scaleX:1,scaleY:1},750,createjs.Ease.quadInOut).call(this.highlightNext.bind(this))},f.nothing=function(){},f.hide=function(){this.gamestate.gamePaused=!1,this.hidden=!0,this.removeAllChildren(),this.parent.removeChild(this)},namespace("wgbh").LevelIntro=e}(),function(){var a=include("createjs.Bitmap"),b=include("createjs.Container"),c=include("createjs.Text"),d=function(a,c,d){b.call(this),this.gamestate=app._states.game,this.setup(a,c,d)},e=(b.prototype,extend(d,b));e.setup=function(b,d,e){var f=new createjs.Graphics;f.beginFill("#60549e"),f.setStrokeStyle(5),f.beginStroke("#3c3a6d"),f.drawRect(0,0,700,500),this.BG=new createjs.Shape(f),this.addChild(this.BG),this.doButton=new a(images.button),this.doButton.x=275,this.doButton.y=350,this.doButton.addEventListener("mousedown",this.onButtonPress.bind(this)),this.addChild(this.doButton),this.x=350,this.y=100,this.titletext=new c(b,"45px Arial","white"),this.titletext.textAlign="center",this.titletext.x=350,this.titletext.y=10,this.addChild(this.titletext),this.feedback=new c(d,"30px Arial","white"),this.feedback.textAlign="center",this.feedback.y=200,this.feedback.x=350,this.addChild(this.feedback),"function"==typeof e?this.callback=e:this.callback=!1},e.onButtonPress=function(){this.hide(),this.popupActive=!1,this.callback&&this.callback()},e.hide=function(){this.removeAllChildren(),this.parent.removeChild(this),this.gamestate.popup=null},namespace("wgbh").PopupWindow=d}(),function(){var a=include("springroll.Sound"),b=function(a){this.app=app,this.gamedata=this.app.config.gameData,this.levels=this.gamedata.levels,this.soundInstance=null,this.soundPlaying=!1,this.arr_sounds=[]},c=b.prototype;c.playVO=function(a,b){app.voPlayer.play(a,b)},c.playSound=function(b,c,d,e){return this.soundInstance&&c&&(this.soundPlaying=!1,this.soundInstance.stop()),Array.isArray(b)?void this.playSequence(b):(this.soundPlaying||(this.soundPlaying=!0,this.soundInstance=a.instance.play(b,function(){this.soundPlaying=!1,this.soundEnded(d)}.bind(this))),void(e&&e()))},c.playSequence=function(a){this.arr_sounds=a,this.index=0,this.nextSequence(a)},c.nextSequence=function(){this.arr_sounds[this.index]?(this.playVO(this.arr_sounds[this.index],!1,this.nextSequence.bind(this)),this.index++):this.arr_sounds=[]},c.stopSound=function(){this.soundPlaying&&this.soundInstance.stop()},c.stopVO=function(){app.voPlayer.stop()},c.soundEnded=function(a){this.soundPlaying=!1,this.soundInstance=null,a&&a()},namespace("wgbh").SoundManager=b}(),function(){var a=include("createjs.Tween"),b=function(a){this.app=app,this.gamestate=app._states.game,this.gamedata=this.app.config.gameData,this.leveldata=this.gamedata.levels[this.gamedata.currentLevel],this.settings=this.gamedata.feedback,this.warningCount=this.settings.warningCount,this.feedbackTimer=5,this.fishFoodClock=this.settings.fishFoodTime,this.ratio=this.settings.ratio.fish/this.settings.ratio.plants,this.tankCapHappy=this.settings.tankCap[this.leveldata.tankSize-1].happy,this.tankCapMax=this.settings.tankCap[this.leveldata.tankSize-1].max,this.connectionAlertState=0,this.fishFoodTimer=this.settings.fishFoodTime,this.fishFoodCount=0,this.currentFeedbackStatus=null,this.lastFeedbackExtreme=null,this.smallChangeFeedback=!1,this.editHarvestWarning=this.editHarvestWarning.bind(this),this.muteFeedback=!1},c=b.prototype;c.updateStatus=function(a){return!this.gamestate.TrainingManager.trainingActive&&this.gamestate.fishCount>0&&this.fishFoodTimer--,this.connectionAlertState>0&&(this.connectionAlertState=0),this.harvestReminderTime&&(this.harvestReminderTime--,this.harvestReminderTime<=0&&this.doHarvestReminder()),this.editReminderTime&&(this.editReminderTime--,this.editReminderTime<=0&&this.doHarvestReminder()),this.editReminderStatus=0,this.checkTankCapacity()?(this.feedbackTimer--,void(this.feedbackTimer<=0&&(this.currentFeedbackStatus=this.checkTankCapacity(),this.beginFeedback(this.checkTankCapacity())))):("tank-crowded"==this.currentFeedbackStatus&&this.resetWarnings(),!this.checkPlantFishRatio()||this.currentFeedbackStatus&&this.checkPlantFishRatio()!=this.currentFeedbackStatus?(this.currentFeedbackStatus!=this.checkPlantFishRatio()&&this.resetWarnings(),this.fishFoodTimer<=0?void this.fishFoodAlert():void this.resetWarnings()):(this.feedbackTimer--,void(this.feedbackTimer<=0&&(this.currentFeedbackStatus=this.checkPlantFishRatio(),this.beginFeedback(this.checkPlantFishRatio())))))},c.resetWarnings=function(){if(this.currentFeedbackStatus=null,this.feedbackTimer=5,this.warningCount=this.settings.warningCount,this.smallChangeFeedback=!1,0!==this.gamestate.Tank.dirty.alpha&&a.get(this.gamestate.Tank.dirty).to({alpha:0},500),this.togglePlantHealth(!1),this.targetArray)for(var b=0;b<this.targetArray.length;b++)this.targetArray[b].feedbackHighlight(!1)},c.beginFeedback=function(a){this.gamestate.toggleCycle(!1),this.warningCount--,this.warningCount>=0?this.playFeedback(a):this.gamestate.endGame(!1,a)},c.checkPlantFishRatio=function(){var a,b=this.gamestate.fishCount,c=this.gamestate.plantCount,d=b/this.ratio;return 1>b?"add-fish":c>d+3?(a=this.gamestate.fishCount<this.tankCapHappy?"add-fish":"remove-plants","RATIOLOW"==this.lastFeedbackExtreme&&(this.smallChangeFeedback=!0),a):d-3>c?(a=c<Math.ceil(this.leveldata.goalCount/2)?"add-plants":"remove-fish","RATIOHIGH"==this.lastFeedbackExtreme&&(this.smallChangeFeedback=!0),a):!1},c.checkTankCapacity=function(){return this.gamestate.fishCount<=this.tankCapHappy?!1:"tank-crowded"},c.playFeedback=function(a){"add-plants"==a||"remove-fish"==a?this.lastFeedbackExtreme="RATIOLOW":("remove-plants"==a||"add-fish"==a)&&(this.lastFeedbackExtreme="RATIOHIGH");var b=this.warningCount<this.settings.warningCount-1?2:1,c="feedback-"+a+"-"+b;this.smallChangeFeedback&&(voArray=[c,"feedback-small-changes-1"],this.gamestate.SoundManager.playSequence(voArray)),this.gamestate.SoundManager.playVO(c),this.feedbackTimer=4,this.sendHighlight(a)},c.connectionAlert=function(){var b=this.connectionAlertState>0?2:1;this.gamestate.SoundManager.playVO("feedback-connect-pipes-"+b),this.connectionAlertState++,this.gamestate.startPipe.highlightActive||(this.gamestate.startPipe.feedbackHighlight(!0),this.gamestate.endPipe.feedbackHighlight(!0),a.get(this,{override:!0}).wait(5e3).call(function(){this.gamestate.startPipe.feedbackHighlight(!1),this.gamestate.endPipe.feedbackHighlight(!1)}))},c.fishFoodAlert=function(a){return this.fishHungry=!0,this.gamestate.Tank.hungryFish(!0),this.gamestate.enableFishFood(!0),this.fishFoodTimer=this.settings.fishFoodTime,this.fishFoodCount++,this.gamestate.TrainingManager.trainingActive?(this.gamestate.TrainingManager.fishFoodArrow(),void this.gamestate.SoundManager.playVO(["train-fish-food-1","train-fish-food-2"])):void(this.fishFoodCount<=2?(this.fishAlertedAtSomePoint?this.gamestate.SoundManager.playVO("train-fish-food-1"):(this.fishAlertedAtSomePoint=!0,this.gamestate.SoundManager.playVO("feedback-feed-fish")),this.fishFoodTimer=this.settings.fishFoodTime):this.gamestate.endGame(!1,"fish-food"))},c.fishFed=function(){this.gamestate.TrainingManager.trainingActive&&this.gamestate.TrainingManager.clearArrow(),this.gamestate.Tank.hungryFish(!1),this.fishFoodCount=0,this.fishFoodTimer=this.settings.fishFoodTime,this.fishHungry=!1},c.alertHarvest=function(a){null===this.currentFeedbackStatus&&(this.harvestAlerted||(this.harvestReminderTime=this.gamedata.feedback.harvestReminderTime,this.gamestate.TrainingManager.trainingActive?(this.gamestate.TrainingManager.harvestArrow(a),this.gamestate.SoundManager.playVO("train-harvest")):(vo=["feedback-harvest-a","feedback-harvest-b"],this.gamestate.SoundManager.playVO(vo)),this.harvestAlerted=!0,this.harvestReminderStatus=0))},c.doHarvestReminder=function(){if(null===this.currentFeedbackStatus){var a;a=0===this.harvestReminderStatus?"feedback-harvest-a":"feedback-harvest-reminder",this.harvestReminderStatus++,this.harvestReminderTime=this.gamedata.feedback.harvestReminderTime,this.gamestate.SoundManager.playVO(a)}},c.startEditTimer=function(){this.editReminderTime=this.gamedata.feedback.editReminderTime,this.editReminderStatus=0},c.runEditTimer=function(){this.editReminderTime--,this.editReminderTime<0&&this.editReminder()},c.editReminder=function(){if(!(this.connectionAlertState>0)){var a;a=0===this.editReminderStatus?"feedback-edit-idle-1":"feedback-edit-idle-2",this.gamestate.SoundManager.playVO(a),this.editReminderStatus++,this.startEditTimer(),this.gamestate.cycleSwitch.highlight()}},c.sendHighlight=function(b){"add-fish"==b?(this.targetArray=this.gamestate.EditDrawer.arr_fish,this.togglePlantHealth(!0)):"remove-plants"==b?(this.targetArray=this.gamestate.activePipes,this.togglePlantHealth(!0)):"remove-fish"==b||"tank-crowded"==b?(this.targetArray=this.gamestate.Tank.fish,a.get(this.gamestate.Tank.dirty).to({alpha:this.gamestate.Tank.dirty.alpha+.3},250)):"add-plants"==b&&(this.targetArray=[this.gamestate.EditDrawer.arr_pipes[4]],a.get(this.gamestate.Tank.dirty).to({alpha:this.gamestate.Tank.dirty.alpha+.3},250));for(var c=0;c<this.targetArray.length;c++)this.targetArray[c].highlightActive||("remove-plants"==b?this.targetArray[c].plant&&this.targetArray[c].plant.feedbackHighlight(!0):this.targetArray[c].feedbackHighlight(!0))},c.togglePlantHealth=function(a){for(var b,c=0;c<this.gamestate.activePipes.length;c++)b=this.gamestate.activePipes[c],b.plant&&b.plant.toggleUnhealthy(a)},c.editHarvestWarning=function(){!this.gamestate.farmActive&&this.currentFeedbackStatus&&this.gamestate.SoundManager.playVO("feedback-edit-harvest")},namespace("wgbh").FeedbackManager=b}(),function(){var a=include("createjs.Tween"),b=include("createjs.Bitmap"),c=function(a){this.app=app,this.gamestate=this.app._states.game,this.SoundManager=this.gamestate.SoundManager,this.GridManager=this.gamestate.GridManager,this.trainingData=this.app.config.gameData.training,this.levels=this.app.config.gameData.levels,this.trainingArrow=new b(images.training_arrow),this.trainingArrow.regX=this.trainingArrow.image.width/2,this.trainingArrow.regY=this.trainingArrow.image.height/2,this.meterCount=0,this.startTraining=this.startTraining.bind(this)},d=c.prototype;d.startTraining=function(){this.trainingData.complete||(this.gamestate.GridManager.obstructAll(),this.disablePipes(),this.disableFish(),this.gamestate.cycleSwitch.removeAllEventListeners(),this.trainingActive=!0,this.trainingStatus=0,this.SoundManager.playVO("train-intro",this.prompt.bind(this)),this.meterVOtriggered=!1)},d.prompt=function(){if(this.trainingData.targetTiles[this.trainingStatus]){var b=this.trainingData.targetTiles[this.trainingStatus],c=b.tile[0],d=b.tile[1],e=b.highlightImage,f=b.sourcePipe;a.get(this).wait(1e3).call(function(){this.targetTile(c,d,e,f)}),this.trainingData.VO[this.trainingStatus]&&this.SoundManager.playVO(this.trainingData.VO[this.trainingStatus])}else this.promptFish();this.trainingStatus++},d.promptPipeConnect=function(){this.gamestate.startPipe.highlightActive||(this.gamestate.startPipe.feedbackHighlight(!0),this.gamestate.endPipe.feedbackHighlight(!0),a.get(this,{override:!0}).wait(5e3).call(function(){this.gamestate.startPipe.feedbackHighlight(!1),this.gamestate.endPipe.feedbackHighlight(!1)})),this.SoundManager.playVO("train-pipes-connect")},d.promptFish=function(){this.gamestate.dragLayer.addChild(this.trainingArrow),this.trainingArrow.scaleX=-1,this.trainingArrow.y=715,this.trainingArrow.x=175,this.gamestate.EditDrawer.toggleFish(!0),this.currentSourcePipe.feedbackHighlight(!1),this.gamestate.EditDrawer.arr_fish.forEach(function(a){a.feedbackHighlight(!0)}),this.SoundManager.playVO("train-drag-fish"),this.trainingFish=!0,this.promptFish=!0},d.tankArrow=function(){this.gamestate.dragLayer.addChild(this.trainingArrow),this.trainingArrow.scaleX=1,this.trainingArrow.y=740,this.trainingArrow.x=550,this.promptFish=!1},d.trainingFishAdded=function(){this.gamestate.dragLayer.removeChild(this.trainingArrow),this.gamestate.EditDrawer.arr_fish.forEach(function(a){a.feedbackHighlight(!1)}),this.disableFish(),this.promptCycle()},d.promptCycle=function(){this.SoundManager.playVO(["train-turn-on-water","train-right-amounts"]),this.gamestate.cycleSwitch.highlight(),this.gamestate.cycleSwitch.addEventListener("mousedown",this.gamestate.onSwitchDown.bind(this.gamestate)),this.trainingArrow.scaleX=1,this.gamestate.dragLayer.addChild(this.trainingArrow),this.trainingArrow.x=this.gamestate.cycleSwitch.x-75,this.trainingArrow.y=this.gamestate.cycleSwitch.y+10},d.targetTile=function(c,d,e,f){this.currentSourcePipe&&(this.currentSourcePipe.active=!1,this.currentSourcePipe.feedbackHighlight(!1)),this.currentSourcePipe=this.gamestate.EditDrawer.arr_pipes[f],this.currentSourcePipe.feedbackHighlight(!0),this.currentSourcePipe.active=!0,8==this.trainingStatus&&this.promptPipeConnect(),a.get(this.currentSourcePipe.parent).to({y:this.currentSourcePipe.highlightScrollY},500,createjs.Ease.sineInOut).call(function(){var a=this.currentSourcePipe.parent.localToLocal(this.currentSourcePipe.x,this.currentSourcePipe.y,this.gamestate.dragLayer);this.trainingArrow.x=a.x+100,this.trainingArrow.y=a.y,this.trainingArrow.scaleX=-1,this.gamestate.dragLayer.addChild(this.trainingArrow)}.bind(this)),this.trainTarget&&(this.trainTarget.highlight(!1),this.trainTarget=null),this.trainTarget=this.GridManager.arr_rows[c][d],this.trainTarget.occupy(!1),this.highlightImage=new b(images[e]),this.highlightImage.regX=this.highlightImage.image.width/2,this.highlightImage.regY=this.highlightImage.image.height/2,this.highlightImage.x=this.trainTarget.radius/2,this.highlightImage.y=this.trainTarget.radius/2,this.pulsing||this.highlightPulse(),this.trainTarget.addChild(this.highlightImage)},d.highlightPulse=function(){this.pulsing=!0,a.get(this.highlightImage).to({alpha:.5},750,createjs.Ease.quadInOut).to({alpha:1},750,createjs.Ease.quadInOut).call(this.highlightPulse.bind(this))},d.nextArrow=function(){this.trainingArrow.scaleX=1,this.trainingArrow.x=this.trainTarget.x-35,this.trainingArrow.y=this.trainTarget.y+50},d.clearArrow=function(){this.gamestate.dragLayer.removeChild(this.trainingArrow)},d.fishFoodArrow=function(){this.trainingArrow.scaleX=-1,this.trainingArrow.x=this.gamestate.fishFoodShaker.x,this.trainingArrow.y=this.gamestate.fishFoodShaker.y-100},d.harvestArrow=function(a){this.harvestArrowTriggered||(this.trainingArrow.scaleX=1,this.gamestate.dragLayer.addChild(this.trainingArrow),this.trainingArrow.x=a.parent.x,this.trainingArrow.y=a.parent.y)},d.meterArrow=function(){this.gamestate.dragLayer.addChild(this.trainingArrow),this.trainingArrow.scaleX=-1,this.trainingArrow.x=225,this.trainingArrow.y=50,this.trainingArrow.rotation=45},d.disablePipes=function(){this.gamestate.EditDrawer.arr_pipes.forEach(function(a){a.active=!1})},d.disableFish=function(){this.gamestate.EditDrawer.arr_fish.forEach(function(a){a.active=!1})},d.meterVO=function(){this.meterVOtriggered||(this.meterCount++,this.meterCount>1&&(this.meterArrow(),this.gamestate.SoundManager.playVO("train-meter"),this.gamestate.HarvestUI.trainingHighlight(),this.meterVOtriggered=!0))},namespace("wgbh").TrainingManager=c}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.backgroundContainer=new c,this.addChild(this.backgroundContainer),this.worldContainer=new c,this.pipeContainer=new c,this.farmContainer=new c,this.obstructionContainer=new c,this.tankContainer=new c,this.UIcontainer=new c,this.HarvestUI=new wgbh.HarvestUI,this.worldContainer.addChild(this.farmContainer),this.worldContainer.addChild(this.obstructionContainer),this.worldContainer.addChild(this.tankContainer),this.worldContainer.addChild(this.pipeContainer),this.addChild(this.worldContainer),this.addChild(this.UIcontainer),this.GridManager=new wgbh.GridManager,this.Tank=new wgbh.Tank,this.EditDrawer=new wgbh.EditDrawer,this.dragLayer=new c,this.addChild(this.dragLayer),this.cycleSwitch=new wgbh.CycleSwitch,this.UIcontainer.addChild(this.cycleSwitch),this.fishFoodShaker=new b(images.fishFood),this.fishFoodShaker.regX=this.fishFoodShaker.image.width/2,this.fishFoodShaker.regY=this.fishFoodShaker.image.height/2,this.fishFoodShaker.scaleX=this.fishFoodShaker.scaleY=.5,this.fishFoodContainer=new c,this.fishFoodContainer.addChild(this.fishFoodShaker),this.fishFoodContainer.x=1175,this.fishFoodContainer.y=750,this.addChild(this.fishFoodContainer),this.homeButton=new b(images.homeButton),this.homeButton.scaleX=this.homeButton.scaleY=.9,this.homeButton.y=5,this.homeButton.x=190,this.UIcontainer.addChild(this.homeButton),this.addChild(this.HarvestUI),this.popupContainer=new c,this.addChild(this.popupContainer)},f.addBackground=function(a){this.background=new b(images[a.backgroundImage]),this.backgroundContainer.addChild(this.background)},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("wgbh").GamePanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.container_A=new c,this.container_B=new c,this.container_C=new c,this.BG_A=new b(images.introBG_A),this.BG_B=new b(images.introBG_B),this.BG_C=new b(images.introBG_C),this.container_A.addChild(this.BG_A),this.container_B.addChild(this.BG_B),this.container_C.addChild(this.BG_C),this.farmstand=new b(images.farmstand),this.farmstand.x=175,this.farmstand.y=250,this.container_A.addChild(this.farmstand),app.load("assets/images/animations/screenOnePlant.json",function(a){this.plantSpriteSheet=new createjs.SpriteSheet(a)}.bind(this)),this.pipe=new b(images.pipe),this.pipe.x=300,this.pipe.y=350,this.container_B.addChild(this.pipe),this.soil=new b(images.soil),this.soil.x=775,this.soil.y=500,this.soil.alpha=0,this.container_B.addChild(this.soil),this.noSoil=new b(images.noSoil),this.noSoil.x=750,this.noSoil.y=375,this.noSoil.alpha=0,this.container_B.addChild(this.noSoil),app.load("assets/images/animations/screenTwoWaterLoop.json",function(a){this.waterLoopSpriteSheet=new createjs.SpriteSheet(a),this.waterLoop=new createjs.Sprite(this.waterLoopSpriteSheet),this.waterLoop.framerate=10,this.waterLoop.x=30,this.waterLoop.y=75,this.container_B.addChild(this.waterLoop)}.bind(this)),this.tank=new b(images.tank),this.tank.x=350,this.tank.y=250,this.container_C.addChild(this.tank),app.load("assets/images/animations/dirtyWater.json",function(a){this.dirtyWaterSpriteSheet=new createjs.SpriteSheet(a),this.dirtyWater=new createjs.Sprite(this.dirtyWaterSpriteSheet),this.dirtyWater.framerate=10,this.dirtyWater.x=-10,this.dirtyWater.y=40,this.dirtyWater.framerate=8,this.container_C.addChild(this.dirtyWater)}.bind(this)),app.load("assets/images/animations/fishLoop.json",function(a){this.fishLoopSpriteSheet=new createjs.SpriteSheet(a),this.fishLoop=new createjs.Sprite(this.fishLoopSpriteSheet),this.fishLoop.framerate=10,this.fishLoop.x=-10,this.fishLoop.y=40,this.fishLoop.framerate=10,this.container_C.addChild(this.fishLoop)}.bind(this)),app.load("assets/images/animations/pipeWater.json",function(a){this.pipeWaterSpriteSheet=new createjs.SpriteSheet(a),this.pipeWater=new createjs.Sprite(this.pipeWaterSpriteSheet),this.pipeWater.framerate=10,this.pipeWater.x=410,this.pipeWater.y=320,this.pipeWater.scaleX=this.pipeWater.scaleY=1.1,this.pipeWater.framerate=5,this.pipeWater.gotoAndStop("pipeWater"),this.container_C.addChild(this.pipeWater)}.bind(this)),this.nextButton=new b(images.skip),this.nextButton.regX=this.nextButton.image.width/2,this.nextButton.regY=this.nextButton.image.height/2,this.nextButton.x=1120,this.nextButton.y=725,this.nextButton.scaleX=this.nextButton.scaleY=1.2,this.addChild(this.container_A),this.addChild(this.nextButton)},f.teardown=function(){e.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").IntroPanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=function(){a.call(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.background=new b(images.background),this.addChild(this.background),this.farmstand=new b(images.farmstand),this.addChild(this.farmstand),this.farmstand.regX=this.farmstand.image.width/2,this.farmstand.regY=this.farmstand.image.height/2,this.farmstand.x=640,this.farmstand.y=400},e.teardown=function(){d.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").MenuPanel=c}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.background=new b(images.payoffBG),this.addChild(this.background);var a=["","_blue","_orange"],d=a[Math.floor(3*Math.random())];this.fidgit=new c,this.fidgitSprite=new b(images["fidgit"+d]),this.fidgitEating=new b(images["fidgit_eating"+d]),this.fidgitEating.x=this.fidgitEating.y=-5,this.fidgitEating.alpha=0,this.fidgit.addChild(this.fidgitSprite,this.fidgitEating),this.fidgit.regX=this.fidgit.getBounds().width/2,this.fidgit.regY=this.fidgit.getBounds().height/2,this.fidgit.x=450,this.fidgit.y=555,this.truck=new c,this.truckSprite=new b(images.truck),this.truckEating=new b(images.truck_eating),this.truckEating.x=this.truckEating.y=-5,this.truckEating.alpha=0,this.truck.addChild(this.truckSprite,this.truckEating),this.truck.y=465,this.truck.x=-470,this.grassA=new b(images.grassA),this.grassA.y=635,this.grassB=new b(images.grassB),this.grassB.y=800-this.grassB.image.height,this.plantContainer=new c,this.addChild(this.fidgit),this.addChild(this.grassA),this.addChild(this.truck),this.addChild(this.plantContainer),this.addChild(this.grassB)},f.teardown=function(){e.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").PayoffPanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=function(){a.call(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.background=new b(images.TitleBackground),this.addChildAt(this.background,0),this.playButton=new b(images.PlayButton),this.addChild(this.playButton),this.playButton.y=675,this.playButton.x=640,this.playButton.regX=this.playButton.image.width/2,this.playButton.regY=this.playButton.image.height/2},e.teardown=function(){d.teardown.call(this),this.background=null,this.playButton=null},namespace("wgbh").TitlePanel=c}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("wgbh.GamePanel"),c=include("wgbh.Pipe"),d=include("createjs.Tween"),e=include("createjs.Text"),f=include("createjs.Bitmap"),g=include("wgbh.FeedbackManager"),h=include("wgbh.SoundManager"),i=include("springroll.Sound"),j=include("wgbh.TrainingManager"),k=function(c){a.call(this,new b,c),this.gamedata=app.config.gameData},l=extend(k,a);l.enter=function(){},l.onAssetsLoaded=function(){this.GridManager=this.panel.GridManager,this.EditDrawer=this.panel.EditDrawer,this.Tank=this.panel.Tank,this.SetupScreen=this.panel.setupScreen,this.HarvestUI=this.panel.HarvestUI,this.worldContainer=this.panel.worldContainer,this.pipeContainer=this.panel.pipeContainer,this.DragManager=new springroll.DragManager(app.display,this.onDragStart.bind(this),this.onDragEnd.bind(this)),this.FeedbackManager=new g,this.SoundManager=new h,this.TrainingManager=new j,/Mobi/.test(navigator.userAgent)&&(this.DragManager.allowStickyClick=!1),this.dragLayer=this.panel.dragLayer,this.leveldata=this.gamedata.levels[this.gamedata.currentLevel],this.panel.addBackground(this.leveldata),this.fishFoodShaker=this.panel.fishFoodContainer,this.DragManager.addObject(this.fishFoodShaker),this.fishFoodShaker.enableDrag(),this.fishFoodShaker.startX=this.fishFoodShaker.x,this.fishFoodShaker.startY=this.fishFoodShaker.y,this.fishFoodShaker.scaleX=this.fishFoodShaker.scaleY=0,app.load("assets/images/animations/fishfood.json",function(a){this.spriteSheet=new createjs.SpriteSheet(a),this.fishFoodAnim=new createjs.Sprite(this.spriteSheet),this.fishFoodAnim.x=-85,this.fishFoodAnim.y=15,this.fishFoodAnim.alpha=0,this.panel.fishFoodContainer.addChild(this.fishFoodAnim)}.bind(this)),this.toggleCycle=this.toggleCycle.bind(this),this.cycleSwitch=this.panel.cycleSwitch,this.cycleSwitch.addEventListener("mousedown",this.onSwitchDown.bind(this)),this.placedPipes=[],this.activePipes=[],this.startPipe=null,this.endPipe=null,this.plantType=null,this.tankSize=null,this.fishCount=null,this.plantCount=0,this.plantsReady=0,this.harvestCount=0,this.tankSize=this.leveldata.tankSize,this.fishCount=0,this.editMode=!1,this.endGame=this.endGame.bind(this),this.doPayoff=this.doPayoff.bind(this),this.resetLevel=this.resetLevel.bind(this),this.update=this.update.bind(this),app.on("update",this.update),this.GridManager.setup(),this.Tank.setup(),this.HarvestUI.setup(),this.leveldata.obstruction&&(this.obstructionImage=new f(images[this.leveldata.obstruction.image]),this.obstructionImage.x=this.leveldata.obstruction.position.x,this.obstructionImage.y=this.leveldata.obstruction.position.y,this.obstructionImage.scaleX=this.obstructionImage.scaleY=this.leveldata.obstruction.scale,this.GridManager.obstructTiles(this.leveldata.obstruction.occupiedTiles),this.panel.obstructionContainer.addChild(this.obstructionImage)),this.leveldata.obstructionB&&(this.obstructionImageB=new f(images[this.leveldata.obstructionB.image]),this.obstructionImageB.x=this.leveldata.obstructionB.position.x,this.obstructionImageB.y=this.leveldata.obstructionB.position.y,this.obstructionImageB.scaleX=this.obstructionImageB.scaleY=this.leveldata.obstructionB.scale,this.GridManager.obstructTiles(this.leveldata.obstructionB.occupiedTiles),this.panel.obstructionContainer.addChild(this.obstructionImageB)),this.farmActive=!1,this.farmTime=0,this.fishFoodTime=0,this.systemStartHP=50,this.manyPlantTrigger=0,this.manyFishTrigger=0,this.tankCapTrigger=0,this.cycleTime=1e3,this.setupRound(),this.panel.homeButton.on("mousedown",this.homeMenu.bind(this))},l.enterDone=function(){this.startRound()},l.update=function(a){this.gamePaused||(this.cycleTime-=a,this.cycleTime<=0&&(this.cycleTime=1e3,this.farmActive?this.cycleFarm():this.FeedbackManager.runEditTimer()),this.fishFeedActive&&this.checkFishFeed())},l.setupRound=function(){this.panel.farmContainer.addChild(this.GridManager),this.panel.UIcontainer.addChild(this.EditDrawer),this.panel.UIcontainer.addChild(this.editTankButton),this.Tank.setSize(this.tankSize),this.panel.tankContainer.addChild(this.Tank),this.cycleSwitch.x=this.Tank.x-this.cycleSwitch.getBounds().width/2,this.updateHarvest(),d.get(this).wait(100).call(this.addStartPipe),this.systemHP=this.systemStartHP,this.Tank.addStartFish()},l.startRound=function(){this.FeedbackManager.fishFed(),this.levelIntro(),this.enableFishFood(!1),app.music=null,app.music="farm building loop"},l.levelIntro=function(){this.leveldata.isTrainingLevel?this.introScreen=new wgbh.LevelIntro(this.leveldata,this.TrainingManager.startTraining):this.introScreen=new wgbh.LevelIntro(this.leveldata),this.panel.popupContainer.addChild(this.introScreen)},l.addStartPipe=function(){var a=new c(this.gamedata.tank_pipe);a.x=this.GridManager.startTile.x,a.y=this.GridManager.startTile.y,a.isPipe=!0,a.isStartPipe=!0,a.addHighlight(),this.dragLayer.addChild(a),this.DragManager.addObject(a),a.enableDrag(),this.onDragEnd(a),this.startPipe=a,this.addEndPipe()},l.addEndPipe=function(){var a=new c(this.gamedata.tank_pipe);a.x=this.GridManager.endTile.x,a.y=this.GridManager.endTile.y,a.isPipe=!0,a.isEndPipe=!0,a.addHighlight(),this.dragLayer.addChild(a),this.DragManager.addObject(a),a.enableDrag(),this.onDragEnd(a),this.endPipe=a},l.onSwitchDown=function(){this.editMode||(this.toggleCycle(!this.farmActive),i.instance.play("b-switch-plastic"))},l.toggleCycle=function(a,b){a?(this.FeedbackManager.editReminderTime=!1,this.activatePipes()?(b||i.instance.play("water-on"),this.farmActive=!0,this.togglePipeEdit(!1),this.cycleSwitch.toggle(!0),!this.fishFoodToggled&&this.fishCount&&(d.get(this).wait(1e3).call(function(){this.FeedbackManager.fishFoodAlert()}.bind(this)),this.fishFoodToggled=!0)):this.FeedbackManager.connectionAlert()):this.farmActive&&(b||i.instance.play("water-off"),this.FeedbackManager.startEditTimer(),this.farmActive=!1,this.cycleSwitch.toggle(!1),this.togglePipeEdit(!0))},l.cycleFarm=function(){this.farmTime++,this.activePipes.forEach(function(a){a.flow()}),this.FeedbackManager.updateStatus()},l.togglePipeEdit=function(a){for(var b=0;b<this.placedPipes.length;b++)this.placedPipes[b].isStartPipe||this.placedPipes[b].isEndPipe||(a?this.placedPipes[b].enableDrag():this.placedPipes[b].disableDrag(),this.placedPipes[b].plant&&this.placedPipes[b].plant.harvestHighlight(!a))},l.activatePipes=function(){return this.activePipes.forEach(function(a){a.activeCheck=!1,a.active=!1,a.plantCounted=!1,a.isEndPipe||a.tint(!1)}),this.activePipes=[],this.plantCount=0,this.startPipe.activate(),this.endPipe.active?!0:!1},l.showTempStatsUI=function(){this.tempStats&&this.panel.removeChild(this.tempStats),this.tempStats=new e(this.stats,"40px Arial","white"),this.panel.addChild(this.tempStats)},l.harvestPlant=function(){this.harvestCount++,this.updateHarvest(),this.FeedbackManager.harvestReminderTime=null,this.TrainingManager.trainingActive&&(this.TrainingManager.clearArrow(),this.TrainingManager.meterVO()),i.instance.play("ding")},l.updateHarvest=function(){this.HarvestUI.updateStats(),this.harvestCount==this.leveldata.goalCount&&d.get(this).wait(250).call(function(){this.endGame(!0,"success")}.bind(this))},l.onSourceDown=function(a,b){var d;if(this.toggleCycle(!1),a.isPipe){if(this.DragManager.draggedObj)return!1;d=new c(this.gamedata.pipes[a.selectID]);var e=a.parent.localToLocal(a.x,a.y,this.dragLayer);d.x=e.x-this.gamedata.gridSettings.tileRadius/2+25,d.y=e.y-this.gamedata.gridSettings.tileRadius/2,d.isPipe=!0,this.TrainingManager.trainingActive&&this.TrainingManager.nextArrow()}else if(a.isFish){if(this.DragManager.draggedObj)return!1;d=new wgbh.Fish(this.gamedata.fishTypes[a.selectID]),d.x=b.currentTarget.x+d.getBounds().width/2,d.y=b.currentTarget.y+d.getBounds().height/2,d.isFish=!0}return this.dragLayer.addChild(d),this.DragManager.addObject(d),d.enableDrag(),this.DragManager.startDrag(d,b),!0},l.onDragStart=function(a,b){return a==this.fishFoodShaker?(this.dragLayer.addChild(a),d.get(this.panel.fishFoodShaker).to({rotation:-60
},200).call(function(){d.get(this.fishFoodAnim).to({alpha:1},100),this.fishFoodAnim.gotoAndPlay("fish_food_loop")}.bind(this)),void(this.fishFeedActive=!0)):void(a.isPipe?(this.DragManager.isStickyClick&&a.planter&&a.plant.harvestFeedback&&this.FeedbackManager.editHarvestWarning(),a.placed&&(a.placed=!1,this.dragLayer.addChild(a),this.GridManager.occupyTiles(a,a.placeTile,!1),a.resetPipe(),index=this.placedPipes.indexOf(a),this.placedPipes.splice(index,1),a.active&&(a.active=!1,a.activeCheck=!1,index=this.activePipes.indexOf(a),this.activePipes.splice(index,1)),this.activatePipes())):a.isFish&&a.placed&&(a.placed=!1,this.dragLayer.addChild(a),this.Tank.removeFish(a),this.dragLayer.addChild(a),this.toggleCycle(!1)))},l.onDragEnd=function(a){if(a==this.fishFoodShaker)return this.fishFeedActive=!1,d.get(this.fishFoodAnim).to({alpha:0},200),d.get(this.panel.fishFoodShaker).to({rotation:0},200),void d.get(a).to({x:a.startX,y:a.startY},300).call(function(){this.FeedbackManager.fishHungry||this.enableFishFood(!1)}.bind(this));if(a.isPipe){if(a.x<this.gamedata.settings.toolbarWidth)return void a.trash();if(placeTile=this.GridManager.checkFootprint(a),!placeTile||placeTile.isOccupied)return void a.trash();this.GridManager.occupyTiles(a,placeTile,!0),a.disableDrag(),this.TrainingManager.trainingActive&&this.TrainingManager.clearArrow(),d.get(a).to({x:placeTile.x,y:placeTile.y},200,createjs.Ease.backOut).call(function(){this.pipeContainer.addChild(a),this.checkConnection(a),this.placedPipes.push(a),placeTile.startTile||placeTile.endTile||this.TrainingManager.trainingActive||a.enableDrag()}.bind(this)),a.placed=!0,a.placeTile=placeTile,this.TrainingManager.trainingActive&&(placeTile==this.TrainingManager.trainTarget&&this.TrainingManager.prompt(),placeTile.isScaffold&&this.TrainingManager.checkScaffold()),null===this.startPipe&&placeTile.startTile&&(this.startPipe=a,this.activePipes.push(a),a.active=!0,a.tint(!0),this.DragManager.removeObject(a)),null===this.endPipe&&placeTile.endTile&&(this.endPipe=a,this.activePipes.push(a),a.tint(!0),this.DragManager.removeObject(a))}else if(a.isFish){if(a.x<this.Tank.x||a.x>this.Tank.x+this.Tank.BGwidth-a.getBounds().width||a.y<700)return void a.trash();this.Tank.addFish(a),a.placed=!0}},l.checkConnection=function(a){var b=a.locateConnections();if(this.placedPipes[0])for(var c=0;c<this.placedPipes.length;c++)for(var d=this.placedPipes[c].locateConnections(),e=0;e<d.length;e++)for(var f=d[e],g=0;g<b.length;g++){var h=b[g];this.checkSqrt(f,h)<10&&(this.placedPipes[c].addConnection(a),a.addConnection(this.placedPipes[c]),this.activatePipes(),i.instance.play("b-latch-snap"))}},l.enableFishFood=function(a){a?d.get(this.fishFoodShaker).to({scaleX:1,scaleY:1},300).call(this.fishFoodHighlight.bind(this)):d.get(this.fishFoodShaker).to({scaleX:0,scaleY:0},250),this.fishFoodHighlightStatus=5},l.checkFishFeed=function(){this.fishFoodShaker.x>=this.Tank.x&&this.fishFoodShaker.x<=this.Tank.x+this.Tank.BGwidth&&this.fishFed()},l.fishFed=function(){this.fishFeedActive=!1,this.FeedbackManager.fishFed()},l.fishFoodHighlight=function(){this.fishFoodHighlightStatus>0?(this.fishFoodHighlightStatus--,d.get(this.fishFoodShaker).to({scaleX:1.2,scaleY:1.2},300).to({scaleX:1,scaleY:1},300).call(this.fishFoodHighlight.bind(this))):this.fishFoodHighlightStatus=3},l.endGame=function(a,b){this.SoundManager.stopVO(),this.app.music=null,this.panel.worldContainer.visible=!1,this.panel.UIcontainer.visible=!1,this.fishFoodShaker.visible=!1,this.FeedbackManager.fishAlertedAtSomePoint=!1,a?(this.gamedata.levels[this.gamedata.currentLevel].levelComplete=!0,this.gamedata.levels[this.gamedata.currentLevel+1]&&this.gamedata.levels[this.gamedata.currentLevel+1].levelLocked&&(this.gamedata.levels[this.gamedata.currentLevel+1].levelLocked=!1,this.gamedata.menu.nextUnlockIndex=this.gamedata.currentLevel+1),this.callback=this.doPayoff):this.callback=this.resetLevel,this.saveGame(),this.popup=new wgbh.EndScreen(b,this.callback),this.panel.popupContainer.addChild(this.popup),this.toggleCycle(!1,!0)},l.doPayoff=function(){this.SoundManager.stopVO(),this.gamedata.harvestCount=this.harvestCount,this.manager.state="payoff"},l.resetLevel=function(a){if(this.SoundManager.stopVO(),this.TrainingManager.trainingActive||a)return void this.manager.refresh();this.panel.worldContainer.visible=!0,this.panel.UIcontainer.visible=!0,this.fishFoodShaker.visible=!0,this.FeedbackManager.harvestAlerted=!1,this.fishFoodToggled=!1,this.toggleCycle(!1),this.Tank.clearFish(),this.EditDrawer.toggleFish(!0),this.FeedbackManager.resetWarnings();for(var b=0;b<this.activePipes.length;b++)this.activePipes[b].plant&&this.activePipes[b].plant.reset();this.harvestCount=0,this.updateHarvest(),this.startRound()},l.checkSqrt=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=Math.sqrt(c*c+d*d);return e},l.homeMenu=function(){this.newHomeMenu=new wgbh.HomeMenu,this.panel.popupContainer.addChild(this.newHomeMenu)},l.backToMenu=function(){this.SoundManager.stopVO(),d.removeAllTweens(),this.manager.state="menu",app.music=null},l.saveGame=function(){for(var a=[],b=0;b<this.gamedata.levels.length;b++){var c={};c.levelComplete=this.gamedata.levels[b].levelComplete,c.levelLocked=this.gamedata.levels[b].levelLocked,a.push(c)}app.userData.write("savegame",a)},l.exitStart=function(){d.removeAllTweens(),this.fishFoodToggled=!1,this.popup=null,this.DragManager.destroy(),app.off("update",this.update)},namespace("wgbh").GameState=k}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("createjs.Tween"),c=include("wgbh.IntroPanel"),d=function(b){a.call(this,new c,b)},e=extend(d,a);e.enterDone=function(){this.one()},e.animatePlant=function(a,c){b.get(this).wait(c).call(function(){a.gotoAndPlay("screenOnePlant")}.bind(this))},e.one=function(){app.voPlayer.play("game-intro-1-mission",this.two.bind(this));for(var a,b,c=0;6>c;c++)a=new createjs.Sprite(this.panel.plantSpriteSheet),this.panel.container_A.addChild(a),b=600*c,3>c?(a.x=370,a.y=385+132*c):(a.x=825,a.y=385+132*(c-3)),a.framerate=5,a.gotoAndStop("screenOnePlant"),this.animatePlant(a,b);this.panel.nextButton.addEventListener("mousedown",this.two.bind(this))},e.two=function(){this.panel.removeChild(this.panel.container_A),this.panel.addChild(this.panel.container_B),this.panel.addChild(this.panel.nextButton),this.panel.nextButton.removeAllEventListeners(),this.panel.nextButton.addEventListener("mousedown",this.three.bind(this)),this.pingLoop(this.panel.waterLoop),b.get(this.panel.soil).wait(1500).to({alpha:1},500),b.get(this.panel.noSoil).wait(2500).to({alpha:1},500),app.voPlayer.play("game-intro-2-growplants",this.three.bind(this))},e.three=function(){this.panel.removeChild(this.panel.container_B),this.panel.addChild(this.panel.container_C),this.panel.nextButton.removeAllEventListeners(),this.panel.nextButton.addEventListener("mousedown",this.onPlay.bind(this)),this.panel.addChild(this.panel.nextButton),this.panel.fishLoop.gotoAndPlay("fish_loop"),this.pingLoop(this.panel.dirtyWater,4e3),b.get(this).wait(3e3).call(function(){this.panel.pipeWater.gotoAndPlay("pipeWater"),this.panel.pipeWater.addEventListener("animationend",this.stopLoop)}.bind(this)),app.voPlayer.play("game-intro-3b-fishpoop",this.onPlay.bind(this))},e.pingLoop=function(a,b,c){a.removeAllEventListeners(),a.addEventListener("animationend",function(){this.pongLoop(a,b,c)}.bind(this)),a.gotoAndPlay(a.spriteSheet._animations[0])},e.pongLoop=function(a,c,d){a.removeAllEventListeners(),d?a.addEventListener("animationend",this.stopLoop):a.addEventListener("animationend",function(){this.pingLoop(a)}.bind(this)),a.stop(),b.get(this).wait(c).call(function(){a.gotoAndPlay(a.spriteSheet._animations[1])}.bind(this))},e.stopLoop=function(a){a.target.stop()},e.onPlay=function(){app.voPlayer.stop(),this.nextState()},e.exit=function(){},namespace("wgbh").IntroState=d}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("createjs.Bitmap"),c=include("wgbh.SoundManager"),d=include("springroll.Sound"),e=include("createjs.Tween"),f=include("wgbh.MenuPanel"),g=function(b){a.call(this,new f,b),this.gamedata=app.config.gameData,this.levels=this.gamedata.levels,app.music=null,this.SoundManager=new c,this.onPlay=this.onPlay.bind(this)},h=extend(g,a);h.onAssetsLoaded=function(){this.buildMenu()},h.buildMenu=function(){this.locks=[],this.someLocked=!1;for(var a=0;a<this.levels.length;a++){var c;c=this.levels[a].levelComplete?this.levels[a].menuImageDone:this.levels[a].menuImage;var d=new b(images[c]);if(5>a?2>a?(d.y=200,d.x=125+160*a):4>a?(d.y=370,d.x=125+160*(a-2)):(d.y=550,d.x=200):a>=5&&(7>a?(d.y=200,d.x=810+160*(a-5)):9>a?(d.y=370,d.x=810+160*(a-7)):9==a&&(d.y=550,d.x=900)),d.selectID=a,this.panel.addChild(d),this.levels[a].levelLocked||this.gamedata.menu.nextUnlockIndex==a){var e=new b(images.menu_locked);e.x=d.x+4,e.y=d.y+4,this.panel.addChild(e),this.locks.push(e),this.someLocked=!0}else this.locks.push(null);this.levels[a].levelLocked?d.addEventListener("mousedown",this.locked.bind(this)):d.addEventListener("mousedown",this.onPlay.bind(this))}},h.enterDone=function(){this.begin()},h.begin=function(){var a;this.gamedata.menu.firstTime&&!this.gamedata.levels[0].levelComplete?(a="menu-firsttime",this.gamedata.menu.firstTime=!1):this.gamedata.menu.nextUnlockIndex?(a=this.levels[this.gamedata.menu.nextUnlockIndex].menuUnlockAudio,e.get(this).wait(2500).call(this.doUnlock)):a=this.someLocked?"menu-returning":"menu-all-unlocked",this.SoundManager.playVO(a)},h.onPlay=function(a){this.SoundManager.stopVO(),d.instance.play("sfx_click"),this.gamedata.currentLevel=a.target.selectID,this.nextState()},h.locked=function(){this.SoundManager.playVO("menu-locked-2")},h.doUnlock=function(){var a=this.locks[this.gamedata.menu.nextUnlockIndex],b=a.x+a.image.width/2,c=a.y+a.image.height/2;e.get(a).to({scaleX:0,scaleY:0,x:b,y:c},500,createjs.Ease.backIn),this.gamedata.menu.nextUnlockIndex=null,d.instance.play("sfx_dingmany")},h.exit=function(){},namespace("wgbh").MenuState=g}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("wgbh.PayoffPanel"),c=include("createjs.Bitmap"),d=include("wgbh.SoundManager"),e=include("springroll.Sound"),f=include("createjs.Tween"),g=function(c){a.call(this,new b,c)},h=extend(g,a);h.onAssetsLoaded=function(){app.music=null,app.music="food catch loop",this.gamedata=app.config.gameData,this.leveldata=this.gamedata.levels[this.gamedata.currentLevel],this.SoundManager=new d,this.fidgit=this.panel.fidgit,this.truck=this.panel.truck,this.string_plant=this.gamedata.plants[this.gamedata.levels[this.gamedata.currentLevel].plantType].healthy,this.truckPlantString=this.leveldata.introImage,this.truckIcon=new c(images[this.truckPlantString]),this.truckIcon.scaleX=this.truckIcon.scaleY=.55,this.truckIcon.x=150-this.truckIcon.image.width/2,this.truckIcon.y=60,this.truck.addChild(this.truckIcon),this.startDrag=this.startDrag.bind(this),this.onDrag=this.onDrag.bind(this),this.endPayoff=this.endPayoff.bind(this),this.update=this.update.bind(this),app.on("update",this.update),/Mobi/.test(navigator.userAgent)?this.panel.addEventListener("mousedown",this.startDrag):app.display.stage.addEventListener("stagemousemove",this.onDrag),this.startPlants=this.gamedata.harvestCount,this.plantTally=this.gamedata.harvestCount,this.spawnTime=1.5,this.spawnTimer=0,this.gamedata.currentLevel<6?(this.spawnTime=1.5,this.plantSpeed=2):(this.spawnTime=1,this.plantSpeed=3),this.activePlants=[],this.missedPlants=[],this.plantsDone=0,this.plantsEaten=0,this.plantsMissed=0,this.idleTimer=600},h.enterDone=function(){this.SoundManager.playVO(["train-payoff-here-comes","train-payoff-help-catch"]),this.startGenerator(!0),f.get(this).wait(6e3).call(this.doVOtidbit)},h.update=function(a){this.idleTimer--,this.idleTimer<=0&&(this.idleTimer=600,this.idleReminder()),this.generatorActive&&(this.spawnTimer++,this.plantTally>0&&this.spawnTimer>60*this.spawnTime&&(this.spawnTimer=0,this.spawnPlant()),this.activePlants.forEach(function(a){a.y+=this.plantSpeed+a.speed,a.y>this.fidgit.y+50&&(a.x>this.fidgit.x-135&&a.x<this.fidgit.x+135?this.eat(a):a.y>this.fidgit.y+100&&this.miss(a))}.bind(this)),this.truckActive&&this.missedPlants.forEach(function(a){this.truck.x+466>a.x&&this.truckGet(a)}.bind(this)))},h.doVOtidbit=function(){var a;a=Math.random()>.5?"payoff-tasty":"payoff-delicious",this.leveldata.isVeg?(this.SoundManager.playVO("payoff-vegetables"),f.get(this).wait(6e3).call(function(){this.SoundManager.playVO(a)}.bind(this))):this.leveldata.isFruit?(this.SoundManager.playVO("payoff-fruit"),f.get(this).wait(6e3).call(function(){this.SoundManager.playVO(a)}.bind(this))):this.SoundManager.playVO(a)},h.idleReminder=function(){this.SoundManager.playVO("payoff-idle")},h.startGenerator=function(a){a?this.generatorActive=!0:this.generatorActive=!1},h.spawnPlant=function(){this.plantTally--;var a=new c(images[this.string_plant]);this.activePlants.push(a),a.regX=a.image.width/2,a.regY=a.image.height/2,a.x=this.randomIntRange(50,1e3),a.y=50,a.speed=this.randomIntRange(0,4),a.scaleX=a.scaleY=0,f.get(a).to({scaleX:1,scaleY:1},250,createjs.Ease.backOut),this.panel.plantContainer.addChild(a)},h.startDrag=function(a){this.panel.addEventListener("pressmove",this.onDrag);var b=a.rawX/app.realWidth*1280;f.get(this.fidgit,{override:!0}).to({x:b},350,createjs.Ease.backOut)},h.onDrag=function(a){this.idleTimer=600;var b=a.rawX/app.realWidth*1280;f.get(this.fidgit,{override:!0}).to({x:b},350,createjs.Ease.backOut)},h.eat=function(a){e.instance.play("fidgit-chew");var b=this.activePlants.indexOf(a);this.activePlants.splice(b,1),this.plantsEaten++,this.plantsDone++,f.get(a).to({x:this.fidgit.x,y:this.fidgit.y+50},100).call(this.fidgitFlash.bind(this)).to({scaleX:0,scaleY:0},250,createjs.Ease.backOut).call(function(){this.plantsDone>=this.startPlants&&this.doTruck()}.bind(this))},h.miss=function(a){var b=this.activePlants.indexOf(a);this.activePlants.splice(b,1),this.missedPlants.push(a),this.plantsMissed++,this.plantsDone++,f.get(a).to({rotation:90,y:this.fidgit.y+195},500,createjs.Ease.bounceOut).call(function(){this.plantsDone>=this.startPlants&&this.doTruck()}.bind(this))},h.truckGet=function(a){var b=this.missedPlants.indexOf(a);this.missedPlants.splice(b,1),f.get(a).to({scaleX:0,scaleY:0},250,createjs.Ease.backOut),this.truckFlash()},h.fidgitFlash=function(){f.get(this.panel.fidgitEating).to({alpha:1},100).wait(50).to({alpha:0},100)},h.truckFlash=function(){f.get(this.panel.truckEating).to({alpha:1},100).wait(50).to({alpha:0},100)},h.doTruck=function(){this.truckActive=!0,this.panel.removeAllEventListeners(),app.display.stage.removeAllEventListeners(),f.get(this.fidgit,{override:!0}).to({scaleX:0,scaleY:0},500,createjs.Ease.backIn),f.get(this.panel.truck).wait(1e3).to({x:1300},6e3).call(this.endPayoff.bind(this)),f.get(this).wait(1300).call(function(){e.instance.play("truck-horn")}.bind(this))},h.endPayoff=function(){this.SoundManager.stopSound(),app.off("update",this.update),this.manager.state="menu"},h.randomIntRange=function(a,b){return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a))+a},h.exit=function(){this.panel.removeChild(this.congratsScreen),app.music=null},namespace("wgbh").PayoffState=g}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("createjs.Tween"),c=include("springroll.Sound"),d=include("wgbh.TitlePanel"),e=function(b){a.call(this,new d,b),this.onPlay=this.onPlay.bind(this)},f=extend(e,a);f.enterDone=function(){this.panel.playButton.addEventListener("click",this.onPlay.bind(this)),app.userData.read("savegame",function(a){if(a)for(var b=0;b<a.length;b++)app.config.gameData.levels[b].levelLocked=a[b].levelLocked,app.config.gameData.levels[b].levelComplete=a[b].levelComplete}),this.highlightNext()},f.highlightNext=function(a){b.get(this.panel.playButton).to({scaleX:1.25,scaleY:1.25},750,createjs.Ease.quadInOut).to({scaleX:1,scaleY:1},750,createjs.Ease.quadInOut).call(this.highlightNext.bind(this))},f.onPlay=function(){b.removeAllTweens(),c.instance.play("sfx_click"),this.nextState()},f.exit=function(){this.panel.playButton.removeEventListener("click",this.onPlay)},namespace("wgbh").TitleState=e}(),function(){var a=include("wgbh.TitleState"),b=include("wgbh.IntroState"),c=include("wgbh.MenuState"),d=include("wgbh.GameState"),e=include("wgbh.PayoffState"),f=include("springroll.Application"),g=include("lib.Transition"),h=include("springroll.easeljs.EaselJSDisplay"),i=function(a,b){window.images[b.id]=a},j=new f({fps:60,name:"game_global_aquaponics",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",display:h,displayOptions:{clearView:!0},preload:[{id:"loading_screen01",src:"assets/images/loading_screen01.png",complete:i}]});j.on("init",function(){var f=this.config.assets;this.config.scaling,this.manifests;this.transition=new g,this.transition.framerate=30,this.states={title:new a({next:"intro",preload:f.title,scaling:"panel"}),intro:new b({next:"menu",preload:f.intro,scaling:"panel"}),menu:new c({next:"game",preload:f.menu,scaling:"panel"}),game:new d({next:"title",previous:"title",preload:f.game,scaling:"panel"}),payoff:new e({next:"title",previous:"game",preload:f.payoff,scaling:"panel"})}}),j.captions._mute=!0,window.app=j}();