function Body(a){var b=include("Box2D.Dynamics.b2FixtureDef"),c=include("Box2D.Collision.Shapes.b2PolygonShape"),d=include("Box2D.Collision.Shapes.b2CircleShape"),e=include("Box2D.Dynamics.b2BodyDef"),f=include("Box2D.Common.Math.b2Vec2");this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=1,this.tileWidth=app.config.MAP.tileWidth;var g=Box2D.Dynamics.b2Body;this.setup=function(){this.definition=new e;for(var h in app.config.PHYSICS.definitionDefaults)this.definition[h]=a[h]||app.config.PHYSICS.definitionDefaults[h];this.definition.position=new f(this.bodyData.x/app.config.PHYSICS.PHYSICS_SCALE||0,this.bodyData.y/app.config.PHYSICS.PHYSICS_SCALE||0),this.definition.linearVelocity=new f(this.bodyData.vx||0,this.bodyData.vy||0),this.definition.userData=this.bodyData,"dynamic"==this.bodyData.type?this.definition.type=g.b2_dynamicBody:"kinematic"==this.bodyData.type?this.definition.type=g.b2_kinematicBody:this.definition.type=g.b2_staticBody,this.body=app.phy_world.CreateBody(this.definition),this.fixtureDef=new b;for(var i in app.config.PHYSICS.fixtureDefaults)this.fixtureDef[i]=a[i]||app.config.PHYSICS.fixtureDefaults[i];this.fixtureDef.filter.groupIndex=this.fixtureDef.group,this.bodyData.shape=a.shape||app.config.PHYSICS.defaults.shape,this.offsetY=this.bodyData.offsetY||0,this.offsetX=this.bodyData.offsetX||0;var j,k,l;switch(a.shape){case"circle":if(a.radius=this.bodyData.radius||app.config.PHYSICS.defaults.radius,this.fixtureDef.shape=new d(a.radius/app.config.PHYSICS.PHYSICS_SCALE),a.color)this.view=new createjs.Shape,this.view.graphics.f(this.bodyData.color).dc(0,0,this.bodyData.radius),this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.view.name="circle";else if(a.bitmap){this.view=new createjs.Bitmap(this.bodyData.bitmap),this.view.regX=.5*this.bodyData.bitmap.width,this.view.regY=.5*this.bodyData.bitmap.height;2*this.bodyData.radius/this.bodyData.bitmap.width;this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.view.name=this.bodyData.name?this.bodyData.name:"circleBitmap"}else a.sprite&&(this.view=new createjs.Sprite(app.SPRITE_SHEETS.game,this.bodyData.sprite),j=this.view.spriteSheet.getAnimation(this.bodyData.sprite).frames[0],k=this.view.spriteSheet.getFrame(j),l=app.config.scalingSize.height/app.realHeight,this.view.regX=.5*k.rect.width-k.regX,this.view.regY=.5*k.rect.height-k.regY,this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.view.name=this.bodyData.name?this.bodyData.name:"circleSprite");break;case"polygon":this.fixtureDef.shape=new c,this.fixtureDef.shape.SetAsArray(this.bodyData.points,this.bodyData.points.length);break;case"block":if(this.bodyData.width=a.width||app.config.PHYSICS.defaults.width,this.bodyData.height=a.height||app.config.PHYSICS.defaults.height,this.fixtureDef.shape=new c,this.fixtureDef.shape.SetAsBox(this.bodyData.width/app.config.PHYSICS.PHYSICS_SCALE/2,this.bodyData.height/app.config.PHYSICS.PHYSICS_SCALE/2),a.color){var m=this.bodyData.width,n=this.bodyData.height,o=void 0==this.bodyData.regX?.5:this.bodyData.regX;a.regY||.5;this.view=new createjs.Shape,this.view.graphics.f(this.bodyData.color).dr(0,0,m,n),this.view.regX=m*o,this.view.regY=n*o,this.view.x=this.bodyData.x,this.view.y=this.bodyData.y+this.offsetY,this.view.rotation=a.angle*(180/Math.PI)||0,this.view.name="block"}else a.sprite&&(this.view=new createjs.Sprite(app.SPRITE_SHEETS.game,this.bodyData.sprite),j=this.view.spriteSheet.getAnimation(this.bodyData.sprite).frames[0],k=this.view.spriteSheet.getFrame(j),this.view.regX=.5*k.rect.width-k.regX,this.view.regY=.5*k.rect.height-k.regY,this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.view.name=this.bodyData.name?this.bodyData.name:"blockSprite")}this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y),this.body.CreateFixture(this.fixtureDef)},this.resetPosition=function(a){a?this.setPosition({x:this.view.startX,y:this.view.startY}):this.setPosition({x:this.view.initX,y:this.view.initY})},this.setPosition=function(a){this.body.SetPosition(new f(a.x/app.config.PHYSICS.PHYSICS_SCALE,a.y/app.config.PHYSICS.PHYSICS_SCALE)),this.updateView()},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.updateView=function(){this.view&&(this.view.x=this.body.GetPosition().x*app.config.PHYSICS.PHYSICS_SCALE,this.view.y=this.body.GetPosition().y*app.config.PHYSICS.PHYSICS_SCALE+this.offsetY),this.hitarea&&(this.hitarea.x=this.view.x,this.hitarea.y=this.view.y)},this.updatePlacementChecker=function(a){if(this.hitarea){var b=this.sizeGridCol*app.config.MAP.tileWidth,c=this.sizeGridRow*app.config.MAP.tileWidth;a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(.5*-b,.5*-c,b,c):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(.5*-b,.5*-c,b,c)}},this.removePhysicsObject=function(){app.phy_world.DestroyBody(this.body)},this.setRestitution=function(a){this.body.DestroyFixture(this.fixtureDef),this.fixtureDef.restitution=a},this.clearObject=function(){this.removePhysicsObject(),this.view&&this.view.parent.removeChild(this.view),this.hitarea&&this.hitarea.parent.removeChild(this.hitarea),this.view=null},this.addToView=function(a){a.addChild(this.view)},this.updateGroupIndex=function(a){var b=this.body.GetFixtureList(),c=b.GetFilterData();c.groupIndex=a,b.SetFilterData(c)},this.getGroupIndex=function(){var a=this.body.GetFixtureList(),b=a.GetFilterData();return b.groupIndex},this.setup()}function Box2DPhysics_Main(){var a,b=include("Box2D.Dynamics.b2World"),c=include("Box2D.Common.Math.b2Vec2"),d=include("Box2D.Dynamics.b2DebugDraw");this.dt_remaining=0,this.setup=function(d){app.phy_world=new b(new c(app.config.PHYSICS.GRAVITY_X,app.config.PHYSICS.GRAVITY_Y),!0),this.tc=new Box2D.Dynamics.Controllers.b2BuoyancyController,this.tc.density=1,this.tc.linearDrag=.6,this.tc.angularDrag=.4,app.physics_debug_qa&&(a=app.debug_display.canvas.getContext("2d"),this.addDebug())},this.addDebug=function(){this.debugDraw=new d,this.debugDraw.SetSprite(a),this.debugDraw.SetDrawScale(app.config.PHYSICS.PHYSICS_SCALE),this.debugDraw.SetFlags(d.e_shapeBit|d.e_jointBit),this.debugDraw.SetFillAlpha(app.config.PHYSICS.FILL_ALPHA),this.debugDraw.SetLineThickness(app.config.PHYSICS.LINE_THICK),app.phy_world.SetDebugDraw(this.debugDraw)},this.update=function(a,b){for(this.dt_remaining+=b;this.dt_remaining>app.STEP_TIME;)this.dt_remaining-=app.STEP_TIME,app.phy_world.Step(app.STEP_TIME,10,10),app.phy_world.ClearForces();a&&app.phy_world.DrawDebugData()},this.setup()}function BugBall(a,b,c,d,e){var f=include("Box2D.Common.Math.b2Vec2");this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=1,this.ballShape=a.shape||"circle",this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70,this.hitConveyor=null,this.currentDir=-1,this.portalTest=!1,this.currentPortal=null,this.headTest=!1,this.currentHead=null,this.prevVel={x:0,y:0},this.active=!0,this.ready=!0;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="bugball",this.ball=new Body(this.bodyData),this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.ball.view.x,this.view.initY=this.ball.view.y,this.view.startX=this.ball.view.x,this.view.startY=this.ball.view.y),this.glow=new createjs.Sprite(app.SPRITE_SHEETS.game,"ball_glow"),this.glow.regX=30,this.glow.regY=30,this.view.name="ball"},this.toggleAwake=function(a){this.ball.body.SetAwake(a),this.glow.visible=!a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-30,-30,60,60),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.hitarea.alpha=app.HIT_ALPHA},this.changeObject=function(a){this.ball&&a>=0&&this.ball.view.gotoAndStop("ball"+a)}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(null,null,!0),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a,b){(a.x!=this.ball.view.x||a.y!=this.ball.view.y)&&(this.moved=!0),this.ball.setPosition(a),this.updateView()},this.updateView=function(){this.ball&&(this.ball.updateView(),this.view.x=this.ball.view.x,this.view.y=this.ball.view.y,this.glow.x=this.ball.view.x,this.glow.y=this.ball.view.y),this.prevBtn&&(this.prevBtn.x=this.ball.view.x-30,this.prevBtn.y=this.ball.view.y-90,this.nextBtn.x=this.ball.view.x-30,this.nextBtn.y=this.ball.view.y+90)},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(a){this.ball.resetPosition(a),this.updateView()},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-30,-30,60,60):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-30,-30,60,60),this.ball.view.alpha=a?1:app.ILLEGAL_ALPHA},this.setArrows=function(a,b){this.prevBtn=a,this.nextBtn=b,this.prevBtn.x=this.ball.view.x-30,this.prevBtn.y=this.ball.view.y-90,this.nextBtn.x=this.ball.view.x-30,this.nextBtn.y=this.ball.view.y+90},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a);var d=c?this.cont.numChildren:3;c?this.cont.addChild(this.view,this.glow,this.ball.view):this.cont.addChildAt(this.view,this.glow,this.ball.view,d)},this.removePhysicsObject=function(){},this.clearObject=function(a){this.ball&&(this.ball.clearObject(),this.ball=null),a||(this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view),this.glow.parent&&this.glow.parent.removeChild(this.glow),this.prevBtn=null,this.nextBtn=null)},this.updateGroupIndex=function(a,b){this.isActive=-3==a?!1:!0,this.ball.updateGroupIndex(a)},this.setLaunchData=function(a,b,c){this.ball.body.SetLinearDamping(a),this.ball.body.SetAngularDamping(app.config.PHYSICS.OBJ_ANGULAR_DAMPING),this.ball.body.ApplyImpulse(new f(b,c),this.ball.body.GetWorldCenter())}.bind(this),this.isAwake=function(){return this.ball.body.IsAwake()},this.savePrevVel=function(){var a=this.ball.body.GetLinearVelocity();this.prevVel={x:a.x,y:a.y}}}function Obstacle_Bridge(a,b,c,d,e){this.bodyData=a||{},this.sizeGridCol=3,this.sizeGridRow=3,this.bumperShape=a.shape||"circle",this.view=new createjs.Container,this.bgView=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.delay=0,this.delayCounter=0,this.timeCounter=0,this.timeDelayOn=90,this.tileWidth=app.config.MAP.tileWidth,this.isActive=!0,this.dir="open";Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="bridge",this.size=null!=this.bodyData.size?this.bodyData.size:"wide",this.canMove=null!=this.bodyData.move?this.bodyData.move:!1,this.delay=this.bodyData.delay||90,this.box=new createjs.Sprite(app.SPRITE_SHEETS.game,"water_trap"),this.box.regX=90,this.box.regY=90,this.box.name="block",this.wallDepth=3,this.bridgeSize="wide"==this.size?50:30,this.bridgeWidth=this.tileWidth*this.sizeGridCol*.5,this.bridge1=new Body({kind:"bridge",shape:"block",color:"brown",width:this.tileWidth*this.sizeGridCol-10,height:this.wallDepth,x:this.bodyData.x+5,y:this.bodyData.y-this.bridgeSize-5,type:"static"}),this.bridge2=new Body({kind:"bridge",shape:"block",color:"brown",width:this.tileWidth*this.sizeGridCol-10,height:this.wallDepth,x:this.bodyData.x+5,y:this.bodyData.y+this.bridgeSize,type:"static"}),this.bridge1.view.visible=!1,this.bridge2.view.visible=!1;var a=this.canMove?"_moving1":"_bridge";this.piece1=new createjs.Sprite(app.SPRITE_SHEETS.game,this.size+a),this.piece1.regX=0,this.piece1.regY=90,this.piece1.x=-90,this.piece2=new createjs.Sprite(app.SPRITE_SHEETS.game,this.size+"_moving2"),this.piece2.regX=180,this.piece2.regY=90,this.piece2.x=90,this.canMove||(this.piece2.visible=!1),this.view.addChild(this.box,this.piece2,this.piece1),this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-90,-90,this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.bodyData.size="thin"==this.bodyData.size?"wide":"thin",this.clearObject(!0),this.setup(),this.addToView(a.target.parent))}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.addToView(null,null,!0),this.dragStart(a,this),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.view.x||a.y!=this.view.y)&&(this.moved=!0),this.bodyData.x=a.x,this.bodyData.y=a.y,this.view.x=a.x,this.view.y=a.y,this.bgView.x=a.x,this.bgView.y=a.y,this.bridge1.setPosition({x:a.x,y:a.y-this.bridgeSize-5}),this.bridge2.setPosition({x:a.x,y:a.y+this.bridgeSize})},this.updateView=function(){this.view&&this.isActive&&this.canMove&&(this.delayCounter==this.delay?0==this.timeCounter?(this.speed="open"==this.dir?-1:1,this.bridgeWidth+=this.speed,this.soundFunc(this,this.dir),this.updateBridge(),this.timeCounter++):this.timeCounter==this.timeDelayOn?(this.delayCounter=0,this.timeCounter=0,this.dir="open"==this.dir?"close":"open"):(this.timeCounter++,this.bridgeWidth+=this.speed,this.updateBridge()):this.delayCounter++)},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.timeCounter=0,this.delayCounter=0,this.bridgeWidth=this.tileWidth*this.sizeGridCol*.5,this.dir="open",this.updateBridge()},this.updateBridge=function(){var a=this.bridgeWidth/90;this.piece1.scaleX=a,this.piece2.scaleX=a},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-90,-90,this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-90,-90,this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.box.alpha=a?1:app.ILLEGAL_ALPHA,this.piece1.alpha=a?1:app.ILLEGAL_ALPHA,this.piece2.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a,this.btmCont=b),c?this.cont.addChild(this.view,this.bridge1.view,this.bridge2.view):this.btmCont.addChild(this.view,this.bridge1.view,this.bridge2.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){this.bridge1.clearObject(),this.bridge2.clearObject(),this.bridge1=null,this.bridge2=null,this.piece1.parent&&this.piece1.parent.removeChild(this.piece1),this.piece2.parent&&this.piece2.parent.removeChild(this.piece2),this.box.parent&&this.box.parent.removeChild(this.box),a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=a==app.BallGroupIndex?!1:!0,this.bridge1.updateGroupIndex(a),this.bridge2.updateGroupIndex(a)},this.checkHitArea=function(a){if(!this.isActive)return!1;var b=!1,c=Math.abs(a.view.x-this.view.x),d=Math.abs(a.view.y-this.view.y),e=a.bodyData.radius+1.5*this.tileWidth-20;b=e>c&&e>d;var f=!1;return b&&(a.view.y<this.bridge1.view.y||a.view.y>this.bridge2.view.y?f=!0:this.canMove&&(e-=this.bridgeWidth,5>e&&(e=0),e>c&&(f=!0))),{hit:b,water:f}},this.setup()}function Obstacle_Bumper(a,b,c,d,e,f){this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=1,this.bumperShape=a.shape||"circle",this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.sfxFunc=f,this.arrowOffsetY=70,this.tileWidth=app.config.MAP.tileWidth;Box2D.Dynamics.b2Body;this.setup=function(){if(this.bodyData.kind="bumper","circle"==this.bodyData.shape){var a=this.bodyData.color||"blue";this.bumper=new Body({kind:"shell",sprite:a+"_seashell",shape:"circle",width:60,height:60,x:this.bodyData.x,y:this.bodyData.y,type:"static",restitution:.2})}else this.bumper=new Body({kind:"stick",sprite:"stick",shape:"block",width:60,height:10,x:this.bodyData.x,y:this.bodyData.y,type:"static",angle:45,restitution:.8});this.view.name="obstacle",this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-30,-30,60,60),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||("circle"==this.bodyData.shape&&("blue"==this.bodyData.color?this.bodyData.color="orange":this.bodyData.color="blue"),this.bodyData.x=this.bumper.view.x,this.bodyData.y=this.bumper.view.y,this.clearObject(!0),this.setup(),a.target.parent.addChild(this.bumper.view),this.resetPosition())}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.bumper.view.x||a.y!=this.bumper.view.y)&&(this.moved=!0),this.bumper.setPosition(a),this.updateView()},this.updateView=function(){this.bumper&&(this.bumper.updateView(),this.view.x=this.bumper.view.x,this.view.y=this.bumper.view.y)},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.view.x=this.bumper.view.x,this.view.y=this.bumper.view.y},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5),-(this.sizeGridRow*this.tileWidth*.5),this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5),-(this.sizeGridRow*this.tileWidth*.5),this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth),this.bumper.view.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a){this.cont||(this.cont=a),this.cont.addChild(this.view,this.bumper.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){this.bumper&&(this.bumper.clearObject(),this.bumper=null),a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=-3==a?!1:!0,this.bumper.updateGroupIndex(a)},this.setup()}function Obstacle_Conveyor(a,b,c,d,e){this.bodyData=a||{},this.sizeGridCol=2,this.sizeGridRow=2,this.bumperShape=a.shape||"circle",this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70,this.timeDelayOn=100,this.timeDelayOff=100,this.timeCounter=0,this.delay=0,this.isActive=!0,this.delayCounter=0,this.tileWidth=app.config.MAP.tileWidth,this.arrowDir=[!1,!0,!1,!0],this.initDir=3,this.currentDir=3,this.isActive=!0;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="conveyor",this.bodyData.color=this.bodyData.color||"green",this.timeDelayOn=this.bodyData.timeDelayOn||100,this.timeDelayOff=this.bodyData.timeDelayOff||100,this.delay=this.bodyData.delay||120,this.arrowDir=this.bodyData.arrow||new Array(!1,!0,!1,!0),this.currentDir=null!=this.bodyData.dir?this.bodyData.dir:1,this.initDir=this.currentDir,this.limit=this.bodyData.limit||2;2==this.limit?"pink":"#ff6699";this.view=new createjs.Container,this.bg=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor_"+this.limit+"rect"),this.bg.regX=30,this.bg.regY=30,this.bg.name="block",this.arrow=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor_arrow"),this.arrow.regX=60,this.arrow.regY=60,this.arrow.rotation=90*this.currentDir,this.indicator=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor_"+this.limit+"way"),this.indicator.regX=60,this.indicator.regY=60,this.indicator.x=30,this.indicator.y=30,this.indicator.rotation=90*this.currentDir,"play"==app.gameMode&&(this.indicator.visible=!1),this.arrow.y=.5*this.tileWidth,this.arrow.x=.5*this.tileWidth,this.view.addChild(this.bg,this.arrow,this.indicator),this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-30,-30,this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){if(!this.moved){switch(this.currentDir<3?this.currentDir++:this.currentDir=0,this.currentDir){case 0:case 2:2==this.limit?this.arrowDir=[!0,!1,!0,!1]:(this.arrowDir=[!1,!0,!1,!0],this.arrowDir[this.currentDir]=!0);break;case 1:case 3:2==this.limit?this.arrowDir=[!1,!0,!1,!0]:(this.arrowDir=[!0,!1,!0,!1],this.arrowDir[this.currentDir]=!0)}this.initDir=this.currentDir,this.arrow.rotation=90*this.currentDir,this.indicator.rotation=90*this.currentDir}}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(null,null,!0),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.view.x||a.y!=this.view.y)&&(this.moved=!0),this.view.x=a.x,this.view.y=a.y,this.updateView()},this.updateView=function(){if(this.view&&this.isActive)if(this.delayCounter==this.delay){this.delayCounter=0;var a=-1,b=this.currentDir+1;for(b=b>=this.arrowDir.length?0:b;-1==a;){if(this.arrowDir[b]){a=b;break}b=b>=this.arrowDir.length?0:b+1}this.soundFunc(this,"change"),this.currentDir=a,this.arrow.rotation=90*this.currentDir}else this.delayCounter++},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.timeCounter=0,this.delayCounter=0,this.currentDir=this.initDir,this.arrow.rotation=90*this.currentDir},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-30,-30,this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-30,-30,this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.bg.alpha=a?1:app.ILLEGAL_ALPHA,this.arrow.alpha=a?1:app.ILLEGAL_ALPHA,this.indicator.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a),this.indicator&&(this.indicator.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a,this.btmCont=b),c?this.cont.addChild(this.view):this.btmCont.addChild(this.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=a==app.BallGroupIndex?!1:!0},this.checkHitArea=function(a){if(!this.isActive)return!1;var b=!1,c=Math.abs(a.view.x-(this.view.x+30)),d=Math.abs(a.view.y-(this.view.y+30)),e=a.bodyData.radius+this.tileWidth-10;return b=e>c&&e>d},this.setup()}function Obstacle_CrabWalk(a,b,c,d,e){var f=include("Box2D.Common.Math.b2Vec2");this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=3,this.numCrab=1,this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70,this.tileWidth=app.config.MAP.tileWidth,this.crabSpeed=1,this.waitTime=0,this.timeCount=0,this.wait=!1,this.atEnd=!1,this.crabRadius=20,this.crabSpacing=10,this.crabOffset=2*this.crabRadius+10,this.animationOn=!1;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="crab",this.numCrab=this.bodyData.crab,this.crabDist=.5*this.tileWidth+(this.tileWidth-this.crabRadius),this.crabDir=this.bodyData.dir||1,this.crab=new Body({kind:"crab",shape:"circle",sprite:"orange_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.bodyData.y,type:"kinematic"}),this.crab.view.stop(),this.crab.view.rotation=90,this.crab2=null,this.crab3=null,this.crabOffset=2*this.crabRadius+10,1==this.bodyData.crab?(this.waitTime=0,this.crabOffset=0):2==this.bodyData.crab?(this.waitTime=30,this.crab2=new Body({kind:"crab",shape:"circle",sprite:"blue_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.crab.view.y+this.crabOffset,type:"kinematic"}),this.crab2.view.stop(),this.crabSpeed*=this.crabDir,this.crab2.view.rotation=90):3==this.bodyData.crab&&(this.waitTime=30,this.crab2=new Body({kind:"crab",shape:"circle",sprite:"blue_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.bodyData.y,type:"kinematic"}),this.crab3=new Body({kind:"crab",shape:"circle",sprite:"purple_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.bodyData.y,type:"kinematic"}),this.crab2.view.stop(),this.crab3.view.stop(),this.crab2.view.rotation=90,this.crab3.view.rotation=90),this.cir=new createjs.Shape,this.cir.graphics.f("pink").dc(0,0,1),this.cir.x=this.bodyData.x,this.cir.y=this.bodyData.y,this.cir.visible=!1,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y),this.resetPosition()},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-(this.tileWidth*this.sizeGridCol/2),-(this.tileWidth*this.sizeGridRow/2),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.numCrab<3?this.numCrab++:this.numCrab=1,this.bodyData.crab=this.numCrab,this.changeCrabNum(this.numCrab,a.target.parent))}.bind(this),this.changeCrabNum=function(a,b){this.bodyData.x=this.cir.x,this.bodyData.y=this.cir.y,this.clearObject(!0),this.setup(),this.bodyData.crab>=2&&b.addChild(this.crab2.view),3==this.bodyData.crab&&b.addChild(this.crab2.view,this.crab3.view),b.addChild(this.crab.view,this.cir)},this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){this.bodyData.x=a.x,this.bodyData.y=a.y,(a.x!=this.cir.x||a.y!=this.cir.y)&&(this.moved=!0),this.cir.x=a.x,this.cir.y=a.y,this.crabDir>0?this.crab.setPosition({x:a.x,y:a.y-this.crabDist}):this.crab.setPosition({x:a.x,y:a.y+this.crabDist-this.crabOffset}),this.crab2&&this.crab2.setPosition({x:a.x,y:this.crab.view.y+this.crabOffset}),this.crab3&&(this.crab2.setPosition({x:a.x,y:a.y}),this.crab3.setPosition({x:a.x,y:a.y+this.crabDist})),this.updateView()},this.updateView=function(){if(this.crab){this.crab.updateView(),this.crab2&&this.crab2.updateView(),this.crab3&&this.crab3.updateView(),this.view.x=this.cir.x,this.view.y=this.cir.y;var a=this.crab.body.GetLinearVelocity().y,b=this.crab.body.GetWorldCenter().y*app.config.PHYSICS.PHYSICS_SCALE,c=b-this.bodyData.y,d=this.crabDist,e=-this.crabDist;if(2==this.bodyData.crab?d=this.crabDist-2*this.crabRadius-10:3==this.bodyData.crab&&(d=0),0==a||this.animationOn||(this.hitarea&&!this.hitarea.visible&&"make"==app.gameMode||"play"==app.gameMode)&&(this.animationOn=!0,this.crab.view.play(),this.crab2&&this.crab2.view.play(),this.crab3&&this.crab3.view.play(),this.bodyData.obsIndx==app.obstaclesIndx&&this.soundFunc(this,this.bodyData.crab)),this.crabSpeed>0&&c>d||this.crabSpeed<0&&e>c){if(this.wait||(this.wait=!0,this.timeCount=0,this.crab.body.SetLinearVelocity(new f(0,0)),!this.crab3&&this.crab2?this.crab2.body.SetLinearVelocity(new f(0,0)):this.crab3&&this.crab3.body.SetLinearVelocity(new f(0,0)),this.animationOn=!1,this.crab.view.stop(),this.crab2&&this.crab2.view.stop(),this.crab3&&this.crab3.view.stop()),this.wait&&this.timeCount>=this.waitTime){this.wait=!1,this.timeCount=0,this.crabSpeed*=-1;var g=this.crabSpeed<0?d-1:e+1,h=this.bodyData.y+g;this.crab.setPosition({x:this.bodyData.x,y:h}),this.crab.body.IsAwake()||this.crab.body.SetAwake(!0),this.crab.body.SetLinearVelocity(new f(0,this.crabSpeed)),this.crab2&&(this.crab3?(this.crab3.body.IsAwake()||this.crab3.body.SetAwake(!0),g=this.crabSpeed>0?-(e+1):0,this.crab3.setPosition({x:this.bodyData.x,y:this.bodyData.y+g}),this.crab3.body.SetLinearVelocity(new f(0,-this.crabSpeed))):(this.crab2.body.IsAwake()||this.crab2.body.SetAwake(!0),this.crab2.body.SetLinearVelocity(new f(0,this.crabSpeed)))),this.animationOn=!0,this.crab.view.play(),
this.crab2&&this.crab2.view.play(),this.crab3&&this.crab3.view.play(),this.bodyData.obsIndx==app.obstaclesIndx&&this.soundFunc(this,this.bodyData.crab)}this.wait&&this.timeCount++}}},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.crab&&(this.crab.view.x=this.cir.x,this.crab.view.y=this.cir.y,this.view.x=this.cir.x,this.view.y=this.cir.y,this.setPosition({x:this.bodyData.x,y:this.bodyData.y}),this.crabSpeed=this.crabSpeed<0?-1*this.crabSpeed:this.crabSpeed,this.crabSpeed*=this.crabDir,this.crab.body.SetLinearVelocity(new f(0,this.crabSpeed)),this.crab3?(this.crabSpeed*=-1,this.crab.body.SetLinearVelocity(new f(0,this.crabSpeed)),this.crab3.body.SetLinearVelocity(new f(0,-this.crabSpeed))):this.crab2&&this.crab2.body.SetLinearVelocity(new f(0,this.crabSpeed)),this.animationOn=!1,this.crab.view.stop(),this.crab2&&this.crab2.view.stop(),this.crab3&&this.crab3.view.stop())},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(this.tileWidth*this.sizeGridCol/2),-(this.tileWidth*this.sizeGridRow/2),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(this.tileWidth*this.sizeGridCol/2),-(this.tileWidth*this.sizeGridRow/2),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.crab.view.alpha=a?1:app.ILLEGAL_ALPHA,this.crab2&&(this.crab2.view.alpha=a?1:app.ILLEGAL_ALPHA),this.crab3&&(this.crab3.view.alpha=a?1:app.ILLEGAL_ALPHA)},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a){this.cont||(this.cont=a),this.cont.addChild(this.view,this.crab.view,this.cir),this.crab2&&this.cont.addChild(this.crab2.view),this.crab3&&this.cont.addChild(this.crab3.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){this.crab&&(this.crab.clearObject(),this.crab2&&this.crab2.clearObject(),this.crab3&&this.crab3.clearObject(),this.cir&&this.cir.parent.removeChild(this.cir),this.crab3=null,this.crab2=null,this.crab=null,this.cir=null),a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=-3==a?!1:!0,-3==a?this.clearObject():(this.clearObject(),this.setup(),this.crab2&&b.addChild(this.crab2.view),this.crab3&&b.addChild(this.crab3.view),b.addChild(this.crab.view,this.cir),this.resetPosition())},this.setup()}function Obstacle_CrabWalkSide(a,b,c,d,e){var f=include("Box2D.Common.Math.b2Vec2");this.bodyData=a||{},this.sizeGridCol=3,this.sizeGridRow=1,this.numCrab=1,this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70,this.tileWidth=app.config.MAP.tileWidth,this.crabSpeed=1,this.waitTime=0,this.timeCount=0,this.wait=!1,this.atEnd=!1,this.crabRadius=20,this.crabSpacing=10,this.crabOffset=2*this.crabRadius+10,this.animationOn=!1;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="crab",this.numCrab=this.bodyData.crab,this.crabDist=.5*this.tileWidth+(this.tileWidth-this.crabRadius),this.crabDir=this.bodyData.dir||1,this.crab=new Body({kind:"crab",shape:"circle",sprite:"orange_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.bodyData.y,type:"kinematic"}),this.crab.view.stop(),this.crab2=null,this.crab3=null,this.crabOffset=2*this.crabRadius+10,1==this.bodyData.crab?(this.waitTime=0,this.crabOffset=0):2==this.bodyData.crab?(this.waitTime=30,this.crab2=new Body({kind:"crab",shape:"circle",sprite:"blue_crab",radius:this.crabRadius,x:this.bodyData.x+this.crabOffset,y:this.crab.view.y,type:"kinematic"}),this.crabSpeed*=this.crabDir,this.crab2.view.stop()):3==this.bodyData.crab&&(this.waitTime=30,this.crab2=new Body({kind:"crab",shape:"circle",sprite:"blue_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.bodyData.y,type:"kinematic"}),this.crab3=new Body({kind:"crab",shape:"circle",sprite:"purple_crab",radius:this.crabRadius,x:this.bodyData.x,y:this.bodyData.y,type:"kinematic"}),this.crab2.view.stop(),this.crab3.view.stop()),this.cir=new createjs.Shape,this.cir.graphics.f("pink").dc(0,0,1),this.cir.x=this.bodyData.x,this.cir.y=this.bodyData.y,this.cir.visible=!1,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y),this.resetPosition()},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-(this.tileWidth*this.sizeGridCol/2),-(this.tileWidth*this.sizeGridRow/2),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.numCrab<3?this.numCrab++:this.numCrab=1,this.bodyData.crab=this.numCrab,this.changeCrabNum(this.numCrab,a.target.parent))}.bind(this),this.changeCrabNum=function(a,b){this.bodyData.x=this.cir.x,this.bodyData.y=this.cir.y,this.clearObject(!0),this.setup(),this.bodyData.crab>=2&&b.addChild(this.crab2.view),3==this.bodyData.crab&&b.addChild(this.crab2.view,this.crab3.view),b.addChild(this.crab.view,this.cir)},this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){this.bodyData.x=a.x,this.bodyData.y=a.y,(a.x!=this.cir.x||a.y!=this.cir.y)&&(this.moved=!0),this.cir.x=a.x,this.cir.y=a.y,this.crabDir>0?this.crab.setPosition({x:a.x-this.crabDist,y:a.y}):this.crab.setPosition({x:a.x+this.crabDist-this.crabOffset,y:a.y}),this.crab2&&this.crab2.setPosition({x:this.crab.view.x+this.crabOffset,y:this.crab.view.y}),this.crab3&&(this.crab2.setPosition({x:a.x,y:a.y}),this.crab3.setPosition({x:a.x+this.crabDist,y:a.y})),this.updateView()},this.updateView=function(){if(this.crab){this.crab.updateView(),this.crab2&&this.crab2.updateView(),this.crab3&&this.crab3.updateView(),this.view.x=this.cir.x,this.view.y=this.cir.y;var a=this.crab.body.GetLinearVelocity().x,b=this.crab.body.GetWorldCenter().x*app.config.PHYSICS.PHYSICS_SCALE,c=b-this.bodyData.x,d=this.crabDist,e=-this.crabDist;if(2==this.bodyData.crab?d=this.crabDist-2*this.crabRadius-10:3==this.bodyData.crab&&(d=0),0==a||this.animationOn||(this.hitarea&&!this.hitarea.visible&&"make"==app.gameMode||"play"==app.gameMode)&&(this.animationOn=!0,this.crab.view.play(),this.crab2&&this.crab2.view.play(),this.crab3&&this.crab3.view.play(),this.bodyData.obsIndx==app.obstaclesIndx&&this.soundFunc(this,this.bodyData.crab)),this.crabSpeed>0&&c>d||this.crabSpeed<0&&e>c){if(this.wait||(this.wait=!0,this.timeCount=0,this.crab.body.SetLinearVelocity(new f(0,0)),!this.crab3&&this.crab2?this.crab2.body.SetLinearVelocity(new f(0,0)):this.crab3&&this.crab3.body.SetLinearVelocity(new f(0,0)),this.animationOn=!1,this.crab.view.stop(),this.crab2&&this.crab2.view.stop(),this.crab3&&this.crab3.view.stop()),this.wait&&this.timeCount>=this.waitTime){this.wait=!1,this.timeCount=0,this.crabSpeed*=-1;var g=this.crabSpeed<0?d-1:e+1,h=this.bodyData.x+g;this.crab.setPosition({x:h,y:this.bodyData.y}),this.crab.body.IsAwake()||this.crab.body.SetAwake(!0),this.crab.body.SetLinearVelocity(new f(this.crabSpeed,0)),this.crab2&&(this.crab3?(this.crab3.body.IsAwake()||this.crab3.body.SetAwake(!0),g=this.crabSpeed>0?-(e+1):0,this.crab3.setPosition({x:this.bodyData.x+g,y:this.bodyData.y}),this.crab3.body.SetLinearVelocity(new f(-this.crabSpeed,0))):(this.crab2.body.IsAwake()||this.crab2.body.SetAwake(!0),this.crab2.body.SetLinearVelocity(new f(this.crabSpeed,0)))),this.animationOn=!0,this.crab.view.play(),this.crab2&&this.crab2.view.play(),this.crab3&&this.crab3.view.play(),this.bodyData.obsIndx==app.obstaclesIndx&&this.soundFunc(this,this.bodyData.crab)}this.wait&&this.timeCount++}}},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.crab&&(this.crab.view.x=this.cir.x,this.crab.view.y=this.cir.y,this.view.x=this.cir.x,this.view.y=this.cir.y,this.setPosition({x:this.bodyData.x,y:this.bodyData.y}),this.crabSpeed=this.crabSpeed<0?-1*this.crabSpeed:this.crabSpeed,this.crabSpeed*=this.crabDir,this.crab.body.SetLinearVelocity(new f(this.crabSpeed,0)),this.crab3?(this.crabSpeed*=-1,this.crab.body.SetLinearVelocity(new f(this.crabSpeed,0)),this.crab3.body.SetLinearVelocity(new f(-this.crabSpeed,0))):this.crab2&&this.crab2.body.SetLinearVelocity(new f(this.crabSpeed,0)),this.animationOn=!1,this.crab.view.stop(),this.crab2&&this.crab2.view.stop(),this.crab3&&this.crab3.view.stop())},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(this.tileWidth*this.sizeGridCol/2),-(this.tileWidth*this.sizeGridRow/2),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(this.tileWidth*this.sizeGridCol/2),-(this.tileWidth*this.sizeGridRow/2),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.crab.view.alpha=a?1:app.ILLEGAL_ALPHA,this.crab2&&(this.crab2.view.alpha=a?1:app.ILLEGAL_ALPHA),this.crab3&&(this.crab3.view.alpha=a?1:app.ILLEGAL_ALPHA)},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a){this.cont||(this.cont=a),this.cont.addChild(this.view,this.crab.view,this.cir),this.crab2&&this.cont.addChild(this.crab2.view),this.crab3&&this.cont.addChild(this.crab3.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){this.crab&&(this.crab.clearObject(),this.crab2&&this.crab2.clearObject(),this.crab3&&this.crab3.clearObject(),this.cir&&this.cir.parent.removeChild(this.cir),this.crab3=null,this.crab2=null,this.crab=null,this.cir=null),a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=-3==a?!1:!0,-3==a?this.clearObject():(this.clearObject(),this.setup(),this.crab2&&b.addChild(this.crab2.view),this.crab3&&b.addChild(this.crab3.view),b.addChild(this.crab.view,this.cir),this.resetPosition())},this.setup()}function Obstacle_Diamond(a,b,c,d,e){this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=1,this.bumperShape=a.shape||"circle",this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70,this.timeDelayOn=100,this.timeDelayOff=100,this.timeCounter=0,this.delay=0,this.isActive=!0,this.delayCounter=0,this.currentDir=0,this.check=!0;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="diamond",this.bodyData.color=this.bodyData.color||"green",this.timeDelayOn=this.bodyData.timeDelayOn||200,this.timeDelayOff=this.bodyData.timeDelayOff||200,this.delay=this.bodyData.delay||0,this.bodyData.group=this.bodyData.group||app.CollideGroupIndex,this.bodyData.obsIndx=void 0==this.bodyData.obsIndx?app.obstaclesIndx:this.bodyData.obsIndx,this.ground=new createjs.Sprite(app.SPRITE_SHEETS.game,"diamond3"),this.ground.regX=30,this.ground.regY=30,this.view.addChild(this.ground),this.bumper=new Body({kind:"diamond",shape:"block",color:"green",width:40,height:40,x:this.bodyData.x,y:this.bodyData.y,type:"static",angle:40,restitution:.2}),this.bumper.view.alpha=.01,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-30,-30,60,60),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){!this.moved}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(null,null,!0),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.bumper.view.x||a.y!=this.bumper.view.y)&&(this.moved=!0),this.bumper.setPosition(a),this.view.x=this.bumper.view.x,this.view.y=this.bumper.view.y},this.updateView=function(){if(this.bumper&&(this.bumper.view.x=this.bumper.body.GetPosition().x*app.config.PHYSICS.PHYSICS_SCALE,this.bumper.view.y=this.bumper.body.GetPosition().y*app.config.PHYSICS.PHYSICS_SCALE,this.view.x=this.bumper.view.x,this.view.y=this.bumper.view.y,this.isActive))if(this.delayCounter==this.delay){this.timeCounter++;(this.bodyData.group==app.CollideGroupIndex&&this.timeCounter==this.timeDelayOn||this.bodyData.group==app.BallGroupIndex&&this.timeCounter==this.timeDelayOff&&this.check)&&(this.timeCounter=0,this.check=!1,this.currentDir=0==this.currentDir?1:0,1==this.currentDir&&this.bodyData.group==app.CollideGroupIndex?(this.toggleBumperVisibility(app.BallGroupIndex),this.ground.gotoAndStop("diamond1"),!app.mgCourse.gameOver&&app.mgCourse.playMode&&this.bodyData.obsIndx==app.obstaclesIndx&&app.sound.play("sfx_diamond_down")):(this.ground.gotoAndStop("diamond2"),!app.mgCourse.gameOver&&app.mgCourse.playMode&&this.bodyData.obsIndx==app.obstaclesIndx&&app.sound.play("sfx_diamond_up")),createjs.Tween.get(this.ground).wait(500).call(function(){0==this.currentDir&&this.bodyData.group==app.BallGroupIndex?this.ground.gotoAndStop("diamond3"):(this.toggleBumperVisibility(app.BallGroupIndex),this.ground.gotoAndStop("diamond1"),this.check=!0)}.bind(this)).wait(100).call(function(){"diamond3"==this.ground.currentAnimation&&(this.bodyData.group=app.CollideGroupIndex,this.bumper.updateGroupIndex(this.bodyData.group),this.check=!0)}.bind(this)))}else this.delayCounter++},this.toggleBumperVisibility=function(a){this.isActive&&(this.bodyData.group=a,this.bumper.updateGroupIndex(a))}.bind(this),this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){createjs.Tween.removeTweens(this.ground),this.ground.gotoAndStop("diamond3"),this.ground.visible=!0,this.ground.alpha=1,this.toggleBumperVisibility(app.CollideGroupIndex),this.timeCounter=0,this.delayCounter=0,this.currentDir=0,this.check=!0,this.view.x=this.bumper.view.x,this.view.y=this.bumper.view.y},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-30,-30,60,60):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-30,-30,60,60),this.ground.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a,this.btmCont=b),c?this.cont.addChild(this.view,this.bumper.view):this.btmCont.addChild(this.view,this.bumper.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){this.bumper&&(this.bumper.clearObject(),this.bumper=null),a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=a==app.BallGroupIndex?!1:!0,this.bodyData.group=a,this.bumper.updateGroupIndex(a)},this.checkHitArea=function(a){if(!this.isActive)return!1;var b=!1,c=Math.abs(a.view.x-this.view.x),d=Math.abs(a.view.y-this.view.y),e=a.bodyData.radius+10;return b=e>c&&e>d},this.setup()}function Obstacle_Fruit(a,b,c,d,e){this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=1,this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.tileWidth=app.config.MAP.tileWidth,this.setup=function(){this.fruitType=null!=this.bodyData.fruit?this.bodyData.fruit:0,this.fruit=new createjs.Sprite(app.SPRITE_SHEETS.game,"fruit_"+app.fruitNamesArr[this.fruitType]),this.view.addChild(this.fruit),this.fruit.regX=30,this.fruit.regY=30,this.view.name="view",this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a,b){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-30,-30,60,60),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",b)},this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(null,null,!0),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.view.x||a.y!=this.view.y)&&(this.moved=!0),this.view.x=a.x,this.view.y=a.y},this.updateView=function(){},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5),-(this.sizeGridRow*this.tileWidth*.5),this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5),-(this.sizeGridRow*this.tileWidth*.5),this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth),this.fruit.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a,this.btmCont=b),c?this.cont.addChild(this.view):this.btmCont.addChild(this.view),this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){a||(this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=-3==a?!1:!0},this.setup()}function Obstacle_Head(a,b,c,d,e){this.bodyData=a||{},this.sizeGridCol=3,this.sizeGridRow=3,this.bumperShape=a.shape||"circle",this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.timeDelayOn=100,this.timeCounter=0,this.delay=0,this.isActive=!0,this.delayCounter=0,this.wallDepth=10,this.initDir=2,this.currentDir=2,this.mouthSpeed=1,this.fastSpeed=3,this.slowSpeed=1,this.tileWidth=app.config.MAP.tileWidth,this.canUpdate=!0,this.wallDist=50,this.mouthDir="up";Box2D.Dynamics.b2Body;this.setup=function(){switch(this.bodyData.kind="head",this.bodyData.color=this.bodyData.color||"green",this.delay=this.bodyData.delay||50,this.initDir=this.currentDir=null!=this.bodyData.dir?this.bodyData.dir:2,this.mouthSpeed="fast"==this.bodyData.speed?this.fastSpeed:this.slowSpeed,this.timeDelayOn="fast"==this.bodyData.speed?60:100,this.size=this.bodyData.size||"big",this.view=new createjs.Container,this.bg=new createjs.Shape,this.bg.graphics.f("black").dr(-75,-85,this.tileWidth*this.sizeGridCol-30,60),this.wallDepth="big"==this.size?10:50,this.wallDiff=Math.abs(this.bodyData.y-(this.bodyData.y+(60*this.sizeGridCol*.5-5))),this.movingWall=new createjs.Sprite(app.SPRITE_SHEETS.game,"head_teeth"),this.movingWall.regX=90,this.movingWall.regY=140,this.head=new createjs.Sprite(app.SPRITE_SHEETS.game,this.size+"_head_front"),this.head.regX=90,this.head.regY=90,this.view.addChild(this.movingWall,this.head),this.wall1=new Body({kind:"head",shape:"block",color:this.bodyData.color,width:this.tileWidth*this.sizeGridCol,height:this.wallDepth,x:this.bodyData.x,y:this.bodyData.y-(60*this.sizeGridCol*.5-.5*this.wallDepth),type:"static"}),this.wall2=new Body({kind:"head",shape:"block",color:this.bodyData.color,width:this.wallDepth,height:this.tileWidth*this.sizeGridCol,y:this.bodyData.y,x:this.bodyData.x+(60*this.sizeGridCol*.5-.5*this.wallDepth),type:"static"}),this.wall3=new Body({kind:"head",shape:"block",color:this.bodyData.color,width:this.tileWidth*this.sizeGridCol,height:this.wallDepth,x:this.bodyData.x,y:this.bodyData.y+(60*this.sizeGridCol*.5-.5*this.wallDepth),type:"static"}),this.wall4=new Body({kind:"head",shape:"block",color:this.bodyData.color,width:this.wallDepth,height:this.tileWidth*this.sizeGridCol,y:this.bodyData.y,x:this.bodyData.x-(60*this.sizeGridCol*.5-.5*this.wallDepth),type:"static"}),this.wall1.view.alpha=0,this.wall2.view.alpha=0,this.wall3.view.alpha=0,this.wall4.view.alpha=0,this.wallsArr=[this.wall1,this.wall2,this.wall3,this.wall4],this.currentDir){case 0:this.wall1.updateGroupIndex(app.BallGroupIndex),this.movingWall.rotation=180;break;case 1:this.mouthSpeed*=-1,this.wall2.updateGroupIndex(app.BallGroupIndex),this.movingWall.rotation=90;break;case 2:this.mouthSpeed*=-1,this.wall3.updateGroupIndex(app.BallGroupIndex),this.movingWall.rotation=0;break;case 3:this.wall4.updateGroupIndex(app.BallGroupIndex),this.movingWall.rotation=270}this.head.rotation=90*this.currentDir,this.mouthSpeed*=-1,this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-90,-90,180,180),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.currentDir=3==this.currentDir?0:this.currentDir+1,this.initDir=this.currentDir,this.movingWall.rotation=90*this.currentDir,this.head.rotation=90*this.currentDir,this.bg.rotation=90*this.currentDir,this.resetSpeed())}.bind(this),this.resetSpeed=function(){switch(this.mouthSpeed=Math.abs(this.mouthSpeed),this.currentDir){case 0:break;case 1:this.mouthSpeed*=-1;break;case 2:this.mouthSpeed*=-1;break;case 3:}this.mouthSpeed*=-1}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag),this.addToView(null,null,!0)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.view.x||a.y!=this.view.y)&&(this.moved=!0),this.bodyData.x=a.x,this.bodyData.y=a.y,this.view.x=a.x,this.view.y=a.y,this.bg.x=a.x,this.bg.y=a.y;for(var b,c,d=0;d<this.wallsArr.length;d++)b=a.x,c=a.y,1==d?b+=this.tileWidth*this.sizeGridCol*.5-.5*this.wallDepth:3==d&&(b-=this.tileWidth*this.sizeGridCol*.5-.5*this.wallDepth),0==d?c-=this.tileWidth*this.sizeGridCol*.5-.5*this.wallDepth:2==d&&(c+=this.tileWidth*this.sizeGridCol*.5-.5*this.wallDepth),this.wallsArr[d].setPosition({x:b,y:c})},this.updateView=function(a){if(this.wall1&&this.canUpdate&&this.isActive){for(var b=0;b<this.wallsArr.length;b++)this.wallsArr[b].updateView();var c=!1;if(this.delayCounter==this.delay){var d=(Math.abs(this.movingWall.x),Math.abs(this.movingWall.y),this.mouthSpeed*(a/16));0==this.timeCounter?(this.mouthSpeed*=-1,this.mouthDir="up"==this.mouthDir?"down":"up",0==this.currentDir||2==this.currentDir?(this.movingWall.y+=d,this.movingWall.y<-100?this.movingWall.y=-100:this.movingWall.y>100&&(this.movingWall.y=100)):this.movingWall.x+=d,this.timeCounter++,this.soundFunc(this,this.currentDir)):this.timeCounter==this.timeDelayOn?(this.timeCounter=0,this.delayCounter=0):(this.timeCounter++,0==this.currentDir||2==this.currentDir?(this.movingWall.y+=d,2==this.currentDir?this.movingWall.y<-this.wallDist?this.movingWall.y=-this.wallDist:this.movingWall.y>0&&(c=!0,this.movingWall.y=0):this.movingWall.y>this.wallDist?this.movingWall.y=this.wallDist:this.movingWall.y<0&&(c=!0,this.movingWall.y=0)):(this.movingWall.x+=d,1==this.currentDir?this.movingWall.x<-this.wallDist?this.movingWall.x=-this.wallDist:this.movingWall.x>0&&(c=!0,this.movingWall.x=0):this.movingWall.x>this.wallDist?this.movingWall.x=this.wallDist:this.movingWall.x<0&&(c=!0,this.movingWall.x=0)))}else this.delayCounter++,1==this.delayCounter&&((0==this.currentDir||2==this.currentDir)&&0==this.movingWall.y||(1==this.currentDir||3==this.currentDir)&&0==this.movingWall.x)&&(this.wallsArr[this.currentDir].view.visible=!0,this.wallsArr[this.currentDir].updateGroupIndex(app.CollideGroupIndex)),this.delayCounter==this.delay-2&&((0==this.currentDir||2==this.currentDir)&&0==this.movingWall.y||(1==this.currentDir||3==this.currentDir)&&0==this.movingWall.x)&&(this.wallsArr[this.currentDir].view.visible=!1,this.wallsArr[this.currentDir].updateGroupIndex(app.BallGroupIndex))}},this.toggleBumperVisibility=function(){this.delay.destroy(),this.delay=null}.bind(this),this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.isActive&&(this.mouthDir="up",this.timeCounter=0,this.delayCounter=0,this.currentDir=this.initDir,this.updateWall(!0),this.setPosition({x:this.bodyData.x,y:this.bodyData.y}),this.resetSpeed())},this.updateWall=function(a){this.movingWall.x=this.movingWall.y=0,this.movingWall.rotation=90*this.currentDir,this.head.rotation=90*this.currentDir,this.bg.rotation=90*this.currentDir;for(var b=0;b<this.wallsArr.length;b++)this.wallsArr[b].view.visible=b!=this.currentDir||a?!0:!1,this.wallsArr[b].updateGroupIndex(b!=this.currentDir||a?app.CollideGroupIndex:app.BallGroupIndex)},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-90,-90,60*this.sizeGridCol,60*this.sizeGridRow):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-90,-90,60*this.sizeGridCol,60*this.sizeGridRow)},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a,this.btmCont=b),this.btmCont.addChild(this.bg),this.cont.addChild(this.view);for(var d=0;d<this.wallsArr.length;d++)this.wallsArr[d].addToView(this.cont);this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){for(var b=0;b<this.wallsArr.length;b++)this.wallsArr[b].clearObject();a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view),this.bg.parent&&this.bg.parent.removeChild(this.bg))},this.rotateHead=function(a){var b=this.currentDir;return this.canUpdate=!1,this.timeCounter=0,this.delayCounter=0,this.currentDir=this.currentDir!=this.initDir?this.initDir:this.initDir+1,this.currentDir>3&&(this.currentDir=0),0==b||2==b?createjs.Tween.get(this.movingWall).to({y:0},200).wait(500).call(function(){this.updateWall(!1)}.bind(this)).wait(200).to({x:0},10).wait(200).call(function(){switch(this.mouthSpeed=Math.abs(this.mouthSpeed),this.currentDir){case 0:this.mouthSpeed*=-1,this.movingWall.y=this.wallDist;break;case 1:this.movingWall.x=-this.wallDist;break;case 2:this.movingWall.y=-this.wallDist;break;case 3:this.mouthSpeed*=-1,this.movingWall.x=this.wallDist}this.mouthSpeed*=-1,this.canUpdate=!0}.bind(this)):createjs.Tween.get(this.movingWall).to({x:0},200).wait(500).call(function(){this.updateWall(!1)}.bind(this)).wait(200).to({y:0},10).wait(200).call(function(){switch(this.mouthSpeed=Math.abs(this.mouthSpeed),this.currentDir){case 0:this.mouthSpeed*=-1,this.movingWall.y=this.wallDist;break;case 1:this.movingWall.x=-this.wallDist;break;case 2:this.movingWall.y=-this.wallDist;break;case 3:this.mouthSpeed*=-1,this.movingWall.x=this.wallDist}this.mouthSpeed*=-1,this.canUpdate=!0}.bind(this)),this.currentDir},this.checkHitArea=function(a){if(!this.isActive)return!1;var b=!1,c=Math.abs(a.view.x-this.view.x),d=Math.abs(a.view.y-this.view.y),e=a.bodyData.radius+90-10;return b=e>c&&e>d},this.updateGroupIndex=function(a,b){this.isActive=a==app.BallGroupIndex?!1:!0;for(var c=0;c<this.wallsArr.length;c++)this.wallsArr[c].updateGroupIndex(a)},this.setup()}function Obstacle_Portal(a,b,c,d,e){this.bodyData=a||{},this.sizeGridCol=1,this.sizeGridRow=1,this.bumperShape=a.shape||"circle",this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70,this.timeDelayOn=100,this.timeDelayOff=100,this.timeCounter=0,this.delay=0,this.isActive=!0,this.delayCounter=0,this.tileWidth=app.config.MAP.tileWidth,this.arrowDir=[!1,!0,!1,!0],this.initDir=3,this.currentDir=3,this.isActive=!0,this.wallDepth=4,this.pairedPortal=null;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="portal",this.bodyData.color=this.bodyData.color||"green",this.timeDelayOn=this.bodyData.timeDelayOn||100,this.timeDelayOff=this.bodyData.timeDelayOff||100,this.delay=this.bodyData.delay||120,this.arrowDir=this.bodyData.arrow||new Array(!1,!0,!1,!0),this.currentDir=null!=this.bodyData.dir?this.bodyData.dir:3,this.initDir=this.currentDir,this.view=new createjs.Container,this.bg=new createjs.Sprite(app.SPRITE_SHEETS.game,this.bodyData.color+"_portal_bottom"),this.bg.name="block",this.bg.regX=30,this.bg.regY=30,this.arrow=new createjs.Sprite(app.SPRITE_SHEETS.game,this.bodyData.color+"_portal_top"),this.arrow.regX=30,this.arrow.regY=30,this.arrow.rotation=90*this.currentDir+90,this.wall1=new Body({kind:"portal",shape:"block",color:this.bodyData.color,width:this.tileWidth,height:this.wallDepth,x:this.bodyData.x,y:this.bodyData.y-(.5*this.tileWidth-2),type:"static"}),this.wall2=new Body({kind:"portal",shape:"block",color:this.bodyData.color,width:this.wallDepth,height:this.tileWidth,y:this.bodyData.y,x:this.bodyData.x+(.5*this.tileWidth-2),
type:"static"}),this.wall3=new Body({kind:"portal",shape:"block",color:this.bodyData.color,width:this.tileWidth,height:this.wallDepth,x:this.bodyData.x,y:this.bodyData.y+(.5*this.tileWidth-2),type:"static"}),this.wall4=new Body({kind:"portal",shape:"block",color:this.bodyData.color,width:this.wallDepth,height:this.tileWidth,y:this.bodyData.y,x:this.bodyData.x-(.5*this.tileWidth-2),type:"static"}),this.wallsArr=[this.wall1,this.wall2,this.wall3,this.wall4];for(var a=0;a<this.wallsArr.length;a++)this.wallsArr[a].view.visible=!1,a==this.currentDir?this.wallsArr[a].updateGroupIndex(app.BallGroupIndex):this.wallsArr[a].updateGroupIndex(app.CollideGroupIndex);this.view.addChild(this.arrow),this.view.x=this.bodyData.x,this.view.y=this.bodyData.y,this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-(.5*this.tileWidth),-(.5*this.tileWidth),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){if(!this.moved){switch(this.currentDir<3?this.currentDir++:this.currentDir=0,this.currentDir){case 0:case 2:this.arrowDir=[!0,!1,!0,!1];break;case 1:case 3:this.arrowDir=[!1,!0,!1,!0]}this.initDir=this.currentDir,this.arrow.rotation=90*this.currentDir+90;for(var b=0;b<this.wallsArr.length;b++)b==this.currentDir?this.wallsArr[b].updateGroupIndex(app.BallGroupIndex):this.wallsArr[b].updateGroupIndex(app.CollideGroupIndex)}}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(null,null,!0),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.addToView(null,null,!1),this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.setPosition=function(a){(a.x!=this.view.x||a.y!=this.view.y)&&(this.moved=!0),this.bodyData.x=a.x,this.bodyData.y=a.y,this.view.x=a.x,this.view.y=a.y,this.bg.parent!=this.view?(this.bg.x=a.x,this.bg.y=a.y):(this.bg.x=0,this.bg.y=0);for(var b,c,d=0;d<this.wallsArr.length;d++)b=a.x,c=a.y,1==d?b+=.5*this.tileWidth-.5*this.wallDepth:3==d&&(b-=.5*this.tileWidth-.5*this.wallDepth),0==d?c-=.5*this.tileWidth-.5*this.wallDepth:2==d&&(c+=.5*this.tileWidth-.5*this.wallDepth),this.wallsArr[d].setPosition({x:b,y:c});this.updateView()},this.updateView=function(){},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.timeCounter=0,this.delayCounter=0,this.currentDir=this.initDir,this.arrow.rotation=90*this.currentDir+90,this.bg.x=this.view.x,this.bg.y=this.view.y},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(.5*this.tileWidth),-(.5*this.tileWidth),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(.5*this.tileWidth),-(.5*this.tileWidth),this.tileWidth*this.sizeGridCol,this.tileWidth*this.sizeGridRow),this.arrow.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a,b,c){this.cont||(this.cont=a,this.btmCont=b),c?(this.view.addChildAt(this.bg,1),this.bg.x=0,this.bg.y=0):this.btmCont.addChild(this.bg),this.cont.addChild(this.view);for(var d=0;d<this.wallsArr.length;d++)this.wallsArr[d].addToView(this.cont);c||this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){for(var b=0;b<this.wallsArr.length;b++)this.wallsArr[b].clearObject();a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view),this.bg.parent&&this.bg.parent.removeChild(this.bg))},this.updateGroupIndex=function(a,b){this.isActive=a==app.BallGroupIndex?!1:!0;for(var c=0;c<this.wallsArr.length;c++)c!=this.currentDir&&this.isActive?this.wallsArr[c].updateGroupIndex(app.CollideGroupIndex):this.wallsArr[c].updateGroupIndex(app.BallGroupIndex)},this.checkHitArea=function(a){if(!this.isActive)return!1;var b=!1,c=Math.abs(a.view.x-this.view.x),d=Math.abs(a.view.y-this.view.y),e=a.bodyData.radius+.5*this.tileWidth-10;return b=e>c&&e>d,{hit:b,pair:this.pairedPortal}},this.setup()}function Obstacle_Turtle(a,b,c,d,e){var f=include("Box2D.Common.Math.b2Vec2"),g=include("Box2D.Dynamics.Joints.b2MouseJointDef");this.bodyData=a||{},this.sizeGridCol=3,this.sizeGridRow=4,this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.tileWidth=app.config.MAP.tileWidth,this.pos={x:0,y:0},this.initPos={x:0,y:0},this.pathDiff=[[[120,0],[0,180],[-120,0],[0,-180]],[[120,0],[0,60],[-120,0],[0,60],[120,0],[0,60],[-120,0],[0,-60],[120,0],[0,-60],[-120,0],[0,-60]]],this.path=[],this.pathIndx=0,this.turtleSpeed=1.1,this.turtleNum=1,this.turtlesArr=[],this.mouseJointArr=[],this.currentPath=0,this.animationOn=!1;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="turtle",this.turtleNum=this.bodyData.turtle||1,this.pos.x=this.bodyData.x,this.pos.y=this.bodyData.y,this.currentPath=0|this.bodyData.path,this.color=0==this.currentPath?"turtle":"turtle_green",this.updatePath();for(var a=0;a<this.turtleNum;a++){var b=(0==this.currentPath,1),c=0==a?{x:this.bodyData.x,y:this.bodyData.y}:{x:this.path[a-b][0],y:this.path[a-b][1]},d=new Body({kind:"turtle",shape:"circle",sprite:this.color,radius:15,x:c.x,y:c.y,type:"dynamic",restitution:1,density:10,mass:10});d.pathIndx=a,d.moveX=0,d.moveY=0,d.view.rotation=90,d.pos={x:c.x,y:c.y},d.initPos={x:c.x,y:c.y};var e=new g;e.bodyA=app.phy_world.GetGroundBody(),e.bodyB=d.body;var f=d.body.GetWorldCenter();e.target.Set(f.x,f.y),e.collideConnected=!0,e.maxForce=1e4,e.timeStep=app.STEP_TIME;var h=app.phy_world.CreateJoint(e);this.mouseJointArr.push(h),this.turtlesArr.push(d)}this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y),this.resetPosition()},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5)+this.tileWidth,-(this.sizeGridRow*this.tileWidth*.5)+90,this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.bodyData.x=this.turtlesArr[0].view.x,this.bodyData.y=this.turtlesArr[0].view.y,1==this.turtleNum?this.turtleNum=3:(this.turtleNum=1,this.currentPath=0==this.currentPath?1:0),this.bodyData.turtle=this.turtleNum,this.bodyData.path=this.currentPath,this.clearObject(!0),this.setup(),this.addToView(a.target.parent))}.bind(this),this.startDrag=function(a){this.moved=!1,this.dragStart(a,this),this.startRow=this.view.row,this.startCol=this.view.col,a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0),this.addToView()}.bind(this),this.endDrag=function(a){this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.updatePath=function(){var a=[this.pos.x,this.pos.y];for(this.path=[],i=0;i<this.pathDiff[this.currentPath].length;i++){var b=[0,0];b[0]=a[0]+this.pathDiff[this.currentPath][i][0],b[1]=a[1]+this.pathDiff[this.currentPath][i][1],this.path.push(b),a[0]=this.path[i][0],a[1]=this.path[i][1]}},this.setPosition=function(a){(a.x!=this.turtlesArr[0].view.x||a.y!=this.turtlesArr[0].view.y)&&(this.moved=!0),this.pos.x=a.x,this.pos.y=a.y,this.updatePath();for(var b=0;b<this.turtlesArr.length;b++){var c=0==b?{x:this.pos.x,y:this.pos.y}:{x:this.path[b-1][0],y:this.path[b-1][1]},d=this.turtlesArr[b];d.pathIndx=0,d.moveX=0,d.moveY=0,d.setPosition(c),d.initPos={x:c.x,y:c.y},d.pos={x:c.x,y:c.y};var e=this.mouseJointArr[b];e&&e.SetTarget(new f(d.initPos.x/app.config.PHYSICS.PHYSICS_SCALE,d.initPos.y/app.config.PHYSICS.PHYSICS_SCALE))}this.updateView()},this.updateView=function(){for(var a=!1,b=0;b<this.turtlesArr.length;b++){var c=this.turtlesArr[b],d=0,e=1;c.view.rotation=90,0==this.pathDiff[this.currentPath][c.pathIndx][0]?d=0:this.pathDiff[this.currentPath][c.pathIndx][0]>0?(d=this.turtleSpeed,c.view.rotation=90):this.pathDiff[this.currentPath][c.pathIndx][0]<0&&(e=-1,c.view.rotation=-90,d=this.turtleSpeed),c.moveX+=d,c.pos.x+=e*d,0==this.pathDiff[this.currentPath][c.pathIndx][1]?d=0:this.pathDiff[this.currentPath][c.pathIndx][1]>0?(e=1,c.view.rotation=180,d=this.turtleSpeed):this.pathDiff[this.currentPath][c.pathIndx][1]<0&&(e=-1,c.view.rotation=0,d=this.turtleSpeed),c.moveY+=d,c.pos.y+=e*d;var g=Math.abs(this.pathDiff[this.currentPath][c.pathIndx][0])-c.moveX,h=Math.abs(this.pathDiff[this.currentPath][c.pathIndx][1])-c.moveY;(0>g||0>h)&&(c.moveX=0,c.moveY=0,c.pos.x=this.path[c.pathIndx][0],c.pos.y=this.path[c.pathIndx][1],c.pathIndx>=this.path.length-1?c.pathIndx=0:c.pathIndx++);var i=this.mouseJointArr[b];i&&i.SetTarget(new f(c.pos.x/app.config.PHYSICS.PHYSICS_SCALE,c.pos.y/app.config.PHYSICS.PHYSICS_SCALE)),c.view.x=c.body.GetPosition().x*app.config.PHYSICS.PHYSICS_SCALE,c.view.y=c.body.GetPosition().y*app.config.PHYSICS.PHYSICS_SCALE,(c.moveX>3||c.moveY>3)&&!this.animationOn&&(a=!0,c.view.play()),0==b&&(this.view.x=c.view.x,this.view.y=c.view.y)}a&&(this.animationOn=!0)},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){for(var a=0;a<this.turtlesArr.length;a++){var b=this.turtlesArr[a];0==a&&(this.pos={x:b.initPos.x,y:b.initPos.x}),b.pathIndx=a,b.moveX=0,b.moveY=0,b.view.rotation=90,b.view.stop(),b.pos={x:b.initPos.x,y:b.initPos.y},b.setPosition({x:b.initPos.x,y:b.initPos.y});var c=this.mouseJointArr[a];c&&c.SetTarget(new f(b.pos.x/app.config.PHYSICS.PHYSICS_SCALE,b.pos.y/app.config.PHYSICS.PHYSICS_SCALE)),0==a&&(this.view.x=b.view.x,this.view.y=b.view.y)}this.animationOn=!1},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5)+this.tileWidth,-(this.sizeGridRow*this.tileWidth*.5)+90,this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5)+this.tileWidth,-(this.sizeGridRow*this.tileWidth*.5)+90,this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth)},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a){this.cont||(this.cont=a),this.cont.addChild(this.view);for(var b=0;b<this.turtlesArr.length;b++)this.cont.addChild(this.turtlesArr[b].view);this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){for(;this.turtlesArr.length>0;){var b=this.turtlesArr[0];b.clearObject(),app.phy_world.DestroyBody(this.mouseJointArr[0]),this.mouseJointArr.shift(0),this.turtlesArr.shift(0)}a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){if(this.isActive=a==app.BallGroupIndex?!1:!0,this.isActive){this.clearObject(),this.setup();for(var c=0;c<this.turtlesArr.length;c++)b.addChild(this.turtlesArr[c].view);this.resetPosition()}else this.clearObject()},this.setup()}function Obstacle_TurtleSide(a,b,c,d,e){var f=include("Box2D.Common.Math.b2Vec2"),g=include("Box2D.Dynamics.Joints.b2MouseJointDef");this.bodyData=a||{},this.sizeGridCol=4,this.sizeGridRow=3,this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.tileWidth=app.config.MAP.tileWidth,this.pos={x:0,y:0},this.initPos={x:0,y:0},this.pathDiff=[[[180,0],[0,120],[-180,0],[0,-120]],[[0,120],[60,0],[0,-120],[60,0],[0,120],[60,0],[0,-120],[-60,0],[0,120],[-60,0],[0,-120],[-60,0]]],this.path=[],this.pathIndx=0,this.turtleSpeed=1.1,this.turtleNum=1,this.turtlesArr=[],this.mouseJointArr=[],this.currentPath=0;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="turtle",this.turtleNum=this.bodyData.turtle||1,this.pos.x=this.bodyData.x,this.pos.y=this.bodyData.y,this.currentPath=0|this.bodyData.path,this.color=0==this.currentPath?"turtle":"turtle_green",this.updatePath();for(var a=0;a<this.turtleNum;a++){var b=(0==this.currentPath,1),c=0==a?{x:this.bodyData.x,y:this.bodyData.y}:{x:this.path[a-b][0],y:this.path[a-b][1]},d=new Body({kind:"turtle",shape:"circle",sprite:this.color,radius:15,x:c.x,y:c.y,type:"dynamic",restitution:1,density:10,mass:10});d.pathIndx=a,d.moveX=0,d.moveY=0,d.pos={x:c.x,y:c.y},d.initPos={x:c.x,y:c.y};var e=new g;e.bodyA=app.phy_world.GetGroundBody(),e.bodyB=d.body;var f=d.body.GetWorldCenter();e.target.Set(f.x,f.y),e.collideConnected=!0,e.maxForce=1e4,e.timeStep=app.STEP_TIME;var h=app.phy_world.CreateJoint(e);this.mouseJointArr.push(h),this.turtlesArr.push(d)}this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.resetPosition(),0==this.view.x&&0==this.view.y&&(this.view.x=this.turtlesArr[0].view.x,this.view.y=this.turtlesArr[0].view.y),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5)+90,-(this.sizeGridRow*this.tileWidth*.5)+this.tileWidth,this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.bodyData.x=this.turtlesArr[0].view.x,this.bodyData.y=this.turtlesArr[0].view.y,1==this.turtleNum?this.turtleNum=3:(this.turtleNum=1,this.currentPath=0==this.currentPath?1:0),this.bodyData.turtle=this.turtleNum,this.bodyData.path=this.currentPath,this.clearObject(!0),this.setup(),this.addToView(a.target.parent))}.bind(this),this.startDrag=function(a){this.moved=!1,this.dragStart(a,this),this.addToView(),this.startRow=this.view.row,this.startCol=this.view.col,a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.updatePath=function(){var a=[this.pos.x,this.pos.y];for(this.path=[],i=0;i<this.pathDiff[this.currentPath].length;i++){var b=[0,0];b[0]=a[0]+this.pathDiff[this.currentPath][i][0],b[1]=a[1]+this.pathDiff[this.currentPath][i][1],this.path.push(b),a[0]=this.path[i][0],a[1]=this.path[i][1]}},this.setPosition=function(a){(a.x!=this.turtlesArr[0].view.x||a.y!=this.turtlesArr[0].view.y)&&(this.moved=!0),this.pos.x=a.x,this.pos.y=a.y,this.updatePath();for(var b=0;b<this.turtlesArr.length;b++){var c=0==b?{x:this.pos.x,y:this.pos.y}:{x:this.path[b-1][0],y:this.path[b-1][1]},d=this.turtlesArr[b];d.pathIndx=0,d.moveX=0,d.moveY=0,d.setPosition(c),d.initPos={x:c.x,y:c.y},d.pos={x:c.x,y:c.y};var e=this.mouseJointArr[b];e&&e.SetTarget(new f(d.initPos.x/app.config.PHYSICS.PHYSICS_SCALE,d.initPos.y/app.config.PHYSICS.PHYSICS_SCALE)),0==b&&(this.view.x=d.view.x+30,this.view.y=d.view.y-30)}},this.updateView=function(){for(var a=!1,b=0;b<this.turtlesArr.length;b++){var c=this.turtlesArr[b],d=0,e=1;0==this.pathDiff[this.currentPath][c.pathIndx][0]?d=0:this.pathDiff[this.currentPath][c.pathIndx][0]>0?(d=this.turtleSpeed,c.view.rotation=90):this.pathDiff[this.currentPath][c.pathIndx][0]<0&&(e=-1,c.view.rotation=-90,d=this.turtleSpeed),c.moveX+=d,c.pos.x+=e*d,0==this.pathDiff[this.currentPath][c.pathIndx][1]?d=0:this.pathDiff[this.currentPath][c.pathIndx][1]>0?(e=1,c.view.rotation=180,d=this.turtleSpeed):this.pathDiff[this.currentPath][c.pathIndx][1]<0&&(e=-1,c.view.rotation=0,d=this.turtleSpeed),c.moveY+=d,c.pos.y+=e*d;var g=Math.abs(this.pathDiff[this.currentPath][c.pathIndx][0])-c.moveX,h=Math.abs(this.pathDiff[this.currentPath][c.pathIndx][1])-c.moveY;(0>g||0>h)&&(c.moveX=0,c.moveY=0,c.pos.x=this.path[c.pathIndx][0],c.pos.y=this.path[c.pathIndx][1],c.pathIndx>=this.path.length-1?c.pathIndx=0:c.pathIndx++);var i=this.mouseJointArr[b];i&&i.SetTarget(new f(c.pos.x/app.config.PHYSICS.PHYSICS_SCALE,c.pos.y/app.config.PHYSICS.PHYSICS_SCALE)),c.view.x=c.body.GetPosition().x*app.config.PHYSICS.PHYSICS_SCALE,c.view.y=c.body.GetPosition().y*app.config.PHYSICS.PHYSICS_SCALE,(c.moveX>3||c.moveY>3)&&!this.animationOn&&(a=!0,c.view.play())}a&&(this.animationOn=!0)},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){for(var a=0;a<this.turtlesArr.length;a++){var b=this.turtlesArr[a];0==a&&(this.pos={x:b.initPos.x,y:b.initPos.x}),b.pathIndx=a,b.moveX=0,b.moveY=0,b.view.rotation=90,b.view.stop(),b.pos={x:b.initPos.x,y:b.initPos.y},b.setPosition({x:b.initPos.x,y:b.initPos.y});var c=this.mouseJointArr[a];c&&c.SetTarget(new f(b.pos.x/app.config.PHYSICS.PHYSICS_SCALE,b.pos.y/app.config.PHYSICS.PHYSICS_SCALE)),this.animationOn=!1}},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5)+this.tileWidth,-(this.sizeGridRow*this.tileWidth*.5)+90,this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-(this.sizeGridCol*this.tileWidth*.5)+this.tileWidth,-(this.sizeGridRow*this.tileWidth*.5)+90,this.sizeGridCol*this.tileWidth,this.sizeGridRow*this.tileWidth)},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a){this.cont||(this.cont=a),this.cont.addChild(this.view);for(var b=0;b<this.turtlesArr.length;b++)this.cont.addChild(this.turtlesArr[b].view);this.resetPosition()},this.removePhysicsObject=function(){},this.clearObject=function(a){for(;this.turtlesArr.length>0;){var b=this.turtlesArr[0];b.clearObject(),app.phy_world.DestroyBody(this.mouseJointArr[0]),this.mouseJointArr.shift(0),this.turtlesArr.shift(0)}a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){if(this.isActive=a==app.BallGroupIndex?!1:!0,this.isActive){this.clearObject(),this.setup();for(var c=0;c<this.turtlesArr.length;c++)b.addChild(this.turtlesArr[c].view);this.resetPosition()}else this.clearObject()},this.setup()}function Obstacle_Windmill(a,b,c,d,e){var f=include("Box2D.Common.Math.b2Vec2"),g=include("Box2D.Dynamics.Joints.b2RevoluteJointDef");this.bodyData=a||{},this.sizeGridCol=3,this.sizeGridRow=3,this.numBlade=1,this.view=new createjs.Container,this.isMovable=b,this.dragStart=c,this.dragDuring=d,this.dragEnd=e,this.arrowOffsetY=70;Box2D.Dynamics.b2Body;this.setup=function(){this.bodyData.kind="windmill",this.numBlade=this.bodyData.blade,this.dir=this.bodyData.dir?this.bodyData.dir:2,2==this.bodyData.blade?this.blade=new Body({kind:"windmill",sprite:"yellow_spinner",shape:"block",width:160,height:10,x:this.bodyData.x,y:this.bodyData.y,type:"dynamic"}):(this.blade=new Body({kind:"windmill",sprite:"blue_spinner",shape:"block",width:80,height:10,x:this.bodyData.x,y:this.bodyData.y,type:"dynamic"}),this.blade.view.gotoAndStop("blue_spinner")),this.cir=new Body({kind:"windmill",shape:"circle",color:"pink",radius:10,x:this.bodyData.x,y:this.bodyData.y,group:2,type:"static"}),this.cir.view.visible=!1,pivot_joint=new g,pivot_joint.bodyA=this.blade.body,pivot_joint.bodyB=this.cir.body,"2"==this.bodyData.blade?pivot_joint.localAnchorA=new f(0,0):pivot_joint.localAnchorA=new f(1.3,0),pivot_joint.localAnchorB=new f(0,0),pivot_joint.collideConnected=!1,this.blade.body.SetAngularVelocity(this.dir),this.spinning_joint=app.phy_world.CreateJoint(pivot_joint),this.isMovable&&this.view&&this.view.addEventListener("mousedown",this.startDrag),this.view&&(this.view.initX=this.view.x,this.view.initY=this.view.y,this.view.startX=this.view.x,this.view.startY=this.view.y)},this.addSoundFunction=function(a){this.soundFunc=a},this.addHitArea=function(a){this.hitarea=new createjs.Shape,this.hitarea.graphics.f(app.PLACE_COLOR).dr(-90,-90,180,180),this.view.addChildAt(this.hitarea,0),this.view.mouseChildren=!1,this.view.name="hitarea",this.hitarea.alpha=app.HIT_ALPHA,this.view.addEventListener("click",this.changeObject)},this.changeObject=function(a){this.moved||(this.numBlade=1==this.numBlade?2:1,this.changeBlade(this.numBlade))}.bind(this),this.startDrag=function(a){this.moved=!1,this.startRow=this.view.row,this.startCol=this.view.col,this.dragStart(a,this),this.addToView(),a.target.addEventListener("pressmove",this.dragging),a.target.addEventListener("pressup",this.endDrag)}.bind(this),this.dragging=function(a){this.dragDuring(a,this),this.startRow!=this.view.row&&this.startCol!=this.view.col&&(this.moved=!0)}.bind(this),this.endDrag=function(a){this.dragEnd(a,this),a.target.removeEventListener("pressmove",this.dragging),a.target.removeEventListener("pressup",this.endDrag)}.bind(this),this.changeBlade=function(a,b){this.bodyData.blade=a,this.bodyData.x=this.cir.view.x,this.bodyData.y=this.cir.view.y,this.clearObject(!0),this.setup(),this.cont.addChild(this.blade.view,this.cir.view),this.resetPosition()},this.setPosition=function(a){(a.x!=this.cir.view.x||a.y!=this.cir.view.y)&&(this.moved=!0),this.cir.setPosition(a),this.blade.setPosition(a),this.updateView(),"1"==this.bodyData.blade&&(this.blade.view.x-=.65*this.bodyData.width)},this.updateView=function(){this.blade&&(this.blade.view.x=this.blade.body.GetPosition().x*app.config.PHYSICS.PHYSICS_SCALE,this.blade.view.y=this.blade.body.GetPosition().y*app.config.PHYSICS.PHYSICS_SCALE,this.blade.view.rotation=this.blade.body.GetAngle()*(180/Math.PI),(this.blade.body.GetAngularVelocity()>this.dir||this.blade.body.GetAngularVelocity()<this.dir)&&this.blade.body.SetAngularVelocity(this.dir),this.view.x=this.cir.view.x,this.view.y=this.cir.view.y)},this.setInitPosition=function(a){this.view.initX=a.x,this.view.initY=a.y},this.resetPosition=function(){this.blade&&("2"==this.bodyData.blade?this.blade.view.x=this.cir.view.x:this.blade.view.x=this.cir.view.x-.65*this.bodyData.width,this.blade.view.y=this.cir.view.y,this.blade.body.SetAngle(0),this.blade.view.rotation=0,this.view.x=this.cir.view.x,this.view.y=this.cir.view.y)},this.updatePlacementChecker=function(a){a?this.hitarea.graphics.clear().f(app.PLACE_COLOR).dr(-90,-90,180,180):this.hitarea.graphics.clear().f(app.NO_PLACE_COLOR).dr(-90,-90,180,180),this.blade.view.alpha=a?1:app.ILLEGAL_ALPHA},this.toggleHitArea=function(a){this.hitarea&&(this.hitarea.visible=a)},this.addToView=function(a){this.cont||(this.cont=a),this.cont.addChild(this.view,this.blade.view,this.cir.view),this.resetPosition()},this.removePhysicsObject=function(){app.phy_world.DestroyJoint(this.spinning_joint)},this.clearObject=function(a){this.blade&&(this.removePhysicsObject(),this.blade.clearObject(),this.cir.clearObject(),this.blade=null,this.cir=null),a||(this.view.removeEventListener("click",this.changeObject),this.view.removeEventListener("mousedown",this.startDrag),this.view.removeEventListener("pressmove",this.dragging),this.view.removeEventListener("pressup",this.endDrag),this.view.parent&&this.view.parent.removeChild(this.view))},this.updateGroupIndex=function(a,b){this.isActive=a==app.BallGroupIndex?!1:!0,a==app.BallGroupIndex?this.clearObject():(this.clearObject(),this.setup(),this.addToView(b))},this.setup()}function gradient(a,b,c){var d={Hex:a,R:parseInt(a.slice(1,3),16),G:parseInt(a.slice(3,5),16),B:parseInt(a.slice(5,7),16)},e={Hex:b,R:parseInt(b.slice(1,3),16),G:parseInt(b.slice(3,5),16),B:parseInt(b.slice(5,7),16)};diffR=e.R-d.R,diffG=e.G-d.G,diffB=e.B-d.B,stepsHex=[],stepsR=[],stepsG=[],stepsB=[];for(var f=0;c>=f;f++)stepsR[f]=Math.round(d.R+diffR/c*f).toString(16),stepsG[f]=Math.round(d.G+diffG/c*f).toString(16),stepsB[f]=Math.round(d.B+diffB/c*f).toString(16),stepsR[f]=1==stepsR[f].length?"0"+stepsR[f]:stepsR[f],stepsG[f]=1==stepsG[f].length?"0"+stepsG[f]:stepsG[f],stepsB[f]=1==stepsB[f].length?"0"+stepsB[f]:stepsB[f],stepsHex[f]="#"+stepsR[f]+stepsG[f]+stepsB[f];return stepsHex}namespace("WGBH").Body=Body,namespace("WGBH").Box2DPhysics_Main=Box2DPhysics_Main,namespace("WGBH").BugBall=BugBall,function(){var a=include("createjs.Container"),b=include("WGBH.Body"),c=include("Box2D.Dynamics.b2ContactListener"),d=function(){a.call(this)},e=extend(d,a);e.init=function(b,c,d,e){this.currentScene=b,this.toggleMessagePanel=c,this.freezeUI=e,this.launchFunc=d,this.launchIt=this.launchIt.bind(this),this.startLaunch=this.startLaunch.bind(this),this.moveLaunch=this.moveLaunch.bind(this),this.onPanelUpdate=this.onPanelUpdate.bind(this),this.buildMap=this.buildMap.bind(this),this.getPrevObstacles=this.getPrevObstacles.bind(this),this.getNextObstacles=this.getNextObstacles.bind(this),this.clearObstacles=this.clearObstacles.bind(this),this.markThisTile=this.markThisTile.bind(this),this.changeObstacles=this.changeObstacles.bind(this),this.checkConveyorHitTest=this.checkConveyorHitTest.bind(this),this.checkPortalHitTest=this.checkPortalHitTest.bind(this),this.endGameShowMessage=this.endGameShowMessage.bind(this),this.checkHeadHitTest=this.checkHeadHitTest.bind(this),this.checkBridgeHitTest=this.checkBridgeHitTest.bind(this),this.changeFruit=this.changeFruit.bind(this),this.stopAllSound=this.stopAllSound.bind(this),this.playObstacleSound=this.playObstacleSound.bind(this),this.resetObstacleStats=this.resetObstacleStats.bind(this),this.mapData=app.config.MAP,this.tileWidth=this.mapData.tileWidth,this.mapWidth=this.mapData.mapWidth,this.mapHeight=this.mapData.map[0].length/this.mapWidth,this.showGrid=!1,this.showGridStats=!1,this.world_active=!1,this.playMode=!1,this.gameOver=!1,this.maxImpulse=104,this.forceMultiplier=10,this.holeRadius=30,this.ballRadius=20,this.arrowInitScale=.45,this.colorIndx=0,this.arrowHandleHeight=13,this.diffX=10,this.currentDamping=2,this.strokeNum=0,this.obstaclesIndx=1,this.conveyorSpeed=5,this.fruitCount=0,this.canUpdate=!0,this.gameInfoY=660,this.holeDist=this.holeRadius+this.ballRadius-15,this.multiplierArr=[1,1,1,1,1,1,1],this.impulseArr=[5,10,20,35,55,75,100],this.wallsArr=[],this.obstaclesArr=[],this.playObstaclesArr=[[],[],[],[]],this.fruitsArr=[],this.fruitIndx=0,this.obstacleStatsArr={},this.mapTiles=[],app.debug_display.visible=!0,app.debug_display.stage.mouseEnabled=!1,this.bgContainer=new a,this.visualBtmContainer=new a,this.visualBtmContainer.name="visualBtmContainer",this.visualContainer=new a,this.visualContainer.name="visualContainer",this.obs1Container=new a,this.obs2Conatiner=new a,this.obs3Container=new a,this.obs4Container=new a,this.strokesContainer=new a,this.playObstaclesContArr=[this.obs1Container,this.obs2Conatiner,this.obs3Container,this.obs4Container],this.board=new a,this.board.x=2,this.board.y=20,this.bgContainer.addChild(this.board),this.tileSheet=new createjs.SpriteSheet({images:["assets/images/tiles.png"],frames:{height:60,width:60,regX:0,regY:0,count:3}}),this.tiles=new createjs.Sprite(this.tileSheet,0),this.createHitArea(),this.toolbarOffset="play"==this.currentScene?525:170,this.createArrow(),this.createColorMeter(),this.fruitSparkle=new createjs.Sprite(app.SPRITE_SHEETS.game,"fruit_sparkle"),this.fruitSparkle.regX=30,this.fruitSparkle.regY=30,this.fruitSparkle.visible=!1,this.fruitSparkle.alpha=0,this.visualContainer.addChild(this.fruitSparkle),this.strkTxt=new createjs.Text("Fruit","24px nunitobold",app.FONT_COLOR),this.strkTxt.textAlign="center",this.strkTxt.x=180+this.toolbarOffset,this.strkTxt.y=this.gameInfoY,this.strokesContainer.addChild(this.strkTxt),this.fruitsCounterArr=[],this.fruitType=app.fruitNamesArr[app.config.COURSE["course"+app.courseIndx].fruitType],this.fruitsContainer=new createjs.Container,this.fruitsContainer.x=this.strkTxt.x-75,this.fruitsContainer.y=this.strkTxt.y+30,this.fruitsContainer.scaleX=this.fruitsContainer.scaleY=.5;var f=new createjs.Sprite(app.SPRITE_SHEETS.game,this.fruitType+"_slots");f.name="fruitsBg",this.fruitsContainer.addChild(f);for(var g=15,h=0;3>h;h++){var i=new createjs.Sprite(app.SPRITE_SHEETS.game,"feedback_"+this.fruitType);this.fruitsContainer.addChild(i),this.fruitsCounterArr.push(i),i.x=g,i.y=1,i.visible=!1,g+=87}this.strokesContainer.addChild(this.fruitsContainer),this.visualContainer.addChild(this.strokesContainer),this.strokesContainer.visible=!1},e.addItem=function(a,b,c){this.obstaclesArr.push(a),c?a.addToView(this.visualBtmContainer):a.addToView(this.visualContainer,this.visualBtmContainer),b&&a.addHitArea(this.visualContainer)},e.addFruit=function(a){a.caught=!1,a.view.caught=!1,this.fruitsArr.push(a),a.addToView(this.visualContainer,this.visualBtmContainer),a.addHitArea(this.visualContainer,this.changeFruit)},e.changeFruit=function(a){this.fruitIndx++,this.fruitIndx>=app.fruitNamesArr.length&&(this.fruitIndx=0);for(var b=0;b<this.fruitsArr.length;b++)this.fruitsArr[b].fruit.gotoAndStop("fruit_"+app.fruitNamesArr[this.fruitIndx])},e.showSelected=function(a){},e.removeItem=function(a){var b;for(b=0;b<this.obstaclesArr.length;b++)if(this.obstaclesArr[b]==a){this.obstaclesArr.splice(b,1);break}for(b=0;b<this.fruitsArr.length;b++)if(this.fruitsArr[b]==a){this.fruitsArr.splice(b,1);break}a.clearObject()},e.setup=function(a,b,c,d,e){this.ballX=a.x,this.ballY=a.y,a.x=a.x*this.tileWidth+.5*this.tileWidth+this.board.x,a.y=a.y*this.tileWidth+.5*this.tileWidth+this.board.y,a.radius=this.ballRadius,a.group=app.BallGroupIndex,a.type="dynamic",this.ball=new BugBall(a,b,c,d,e),this.ball.setup(),"maker"==this.currentScene&&this.ball.addHitArea(this.visualContainer),this.ball.toggleAwake(!1),this.ball.updateView(),this.addChild(this.bgContainer);for(var f=0;f<this.playObstaclesContArr.length;f++)this.addChild(this.playObstaclesContArr[f]),f==app.obstaclesIndx-1?this.playObstaclesContArr[f].visible=!0:this.playObstaclesContArr[f].visible=!1;this.addChild(this.visualBtmContainer,this.visualContainer,this.hitContainer),this.visualContainer.addChild(this.arrow),this.ball.addToView(this.visualContainer,this.visualBtmContainer),app.box2D.update(app.physics_debug_qa,16),app.physics_debug_qa&&app.debug_display.stage.update(),app.on("update",this.onPanelUpdate)},e.createHitArea=function(){this.hitContainer=new a;var b=new createjs.Shape;b.graphics.f("white").dr(0,100,app.config.scalingSize.maxWidth,app.config.scalingSize.height-200),
b.x=-(.5*(app.config.scalingSize.maxWidth-app.config.scalingSize.width)),this.hitContainer.addChild(b),this.hitContainer.mouseChildren=!1,this.hitContainer.alpha=.01},e.clearStage=function(){for(;this.wallsArr.length>0;)this.wallsArr[0].clearObject(),this.wallsArr.shift();this.clearObstacles();for(var a=0;a<this.playObstaclesArr.length;a++)for(;this.playObstaclesArr[a].length>0;)this.playObstaclesArr[a][0].clearObject(),this.playObstaclesArr[a].shift();if("maker"==this.currentScene)for(;this.fruitsArr.length>0;)this.fruitsArr[0].clearObject(),this.fruitsArr.shift();this.ball&&(this.ball.clearObject(),this.ball=null),this.hole&&(this.visualContainer.removeChild(this.hole),this.hole=null),this.delay&&this.delay.destroy(),createjs.Tween.removeAllTweens(),this.celebrate&&this.celebrate.stop(),this.flag&&(this.flag.parent.removeChild(this.flag),this.flag=null)},e.markThisTile=function(a,b){this.mapTiles[a].open=b;var c=b?"blue":"red";this.statsTiles[a].graphics.clear().f(c).dr(0,0,60,60)},e.clearObstacles=function(){for(;this.obstaclesArr.length>0;)this.obstaclesArr[0].clearObject(),this.obstaclesArr.shift();if("maker"==this.currentScene)for(;this.fruitsArr.length>0;)this.fruitsArr[0].clearObject(),this.fruitsArr.shift();for(var a in this.mapTiles){var b=null,c=null;this.hole&&(b="t_"+this.hole.view.row+"_"+this.hole.view.col),this.ball&&(c="t_"+this.ball.view.row+"_"+this.ball.view.col),a!=b&&a!=c&&this.markThisTile(a,!0)}},e.buildMap=function(a){var b,c,d=this.mapData.map[a],e=a+1;for(defineTile={walkable:function(a){return 2===d[a]?!0:!1},empty:function(a){return 3===d[a]?!0:!1}},this.board.removeAllChildren(),tileIndex=0,this.mapTiles=[],this.statsTiles=[],b=0;b<this.mapHeight;b++)for(c=0;c<this.mapWidth;c++){var f=new createjs.Text(b+"_"+c,"13px Arial","grey");f.visible=this.showGrid;var g=new createjs.Shape;g.graphics.f("blue").dr(0,0,60,60),g.alpha=.3,g.visible=this.showGridStats,this.statsTiles["t_"+b+"_"+c]=g,tileClone=this.tiles.clone(),tileClone.name="t_"+b+"_"+c,tileClone.gotoAndStop(d[tileIndex]-1),tileClone.x=c*this.tileSheet._frameWidth,tileClone.y=b*this.tileSheet._frameHeight,this.mapTiles["t_"+b+"_"+c]={index:tileIndex,row:b,col:c,open:!0,walkable:defineTile.walkable(tileIndex),empty:defineTile.empty(tileIndex)},f.x=tileClone.x,f.y=tileClone.y,g.x=tileClone.x,g.y=tileClone.y,tileIndex++,tileClone.visible=!1,this.board.addChild(tileClone,g,f)}var h=new createjs.Sprite(app.SPRITE_SHEETS.game,"hole_"+e+"_green");h.x=60,h.y=120,this.board.addChild(h)},e.setupCourse=function(d,e,f){"maker"==this.currentScene&&(this.playMode=!1),this.buildMap(d);var g,h;for(g=0;g<e.walls.length;g++)e.walls[g].kind="wall",e.walls[g].width=Math.abs(e.walls[g].startX-e.walls[g].endX)*this.tileWidth,e.walls[g].height=Math.abs(e.walls[g].startY-e.walls[g].endY)*this.tileWidth,e.walls[g].width=0==e.walls[g].width?60:e.walls[g].width+this.tileWidth,e.walls[g].height=0==e.walls[g].height?60:e.walls[g].height+this.tileWidth,e.walls[g].x=this.board.x+(e.walls[g].startX*this.tileWidth+.5*e.walls[g].width),e.walls[g].y=this.board.y+e.walls[g].startY*this.tileWidth+.5*e.walls[g].height,this.wallsArr.push(new b(e.walls[g],!1));var i,j;if(e.obstacles&&"maker"!=this.currentScene)for(g=0;g<e.obstacles.length;g++)for(h=0;h<e.obstacles[g].length;h++){e.obstacles[g][h].x=this.board.x+e.obstacles[g][h].startX*this.tileWidth+.5*this.tileWidth,e.obstacles[g][h].y=this.board.y+e.obstacles[g][h].startY*this.tileWidth+.5*this.tileWidth,e.obstacles[g][h].group=g!=app.obstaclesIndx-1?app.BallGroupIndex:app.CollideGroupIndex,e.obstacles[g][h].obsIndx=g+1;var k=e.obstacles[g][h].group;switch(e.obstacles[g][h].mode="play",this.currentType=e.obstacles[g][h].kind,e.obstacles[g][h].kind){case"windmill":i=new WGBH.Obstacle_Windmill(e.obstacles[g][h]);break;case"bumper":i=new WGBH.Obstacle_Bumper(e.obstacles[g][h]);break;case"diamond":i=new WGBH.Obstacle_Diamond(e.obstacles[g][h]);break;case"crab":i=new WGBH.Obstacle_CrabWalk(e.obstacles[g][h]);break;case"conveyor":i=new WGBH.Obstacle_Conveyor(e.obstacles[g][h]);break;case"turtle":i=new WGBH.Obstacle_Turtle(e.obstacles[g][h]);break;case"portal":e.obstacles[g][h].color=app.portalColorArr[h],i=new WGBH.Obstacle_Portal(e.obstacles[g][h]);var l={kind:e.obstacles[g][h].kind,color:app.portalColorArr[h]};l.x=this.board.x+e.obstacles[g][h].startX2*this.tileWidth+.5*this.tileWidth,l.y=this.board.y+e.obstacles[g][h].startY2*this.tileWidth+.5*this.tileWidth,l.dir=e.obstacles[g][h].dir2,j=new WGBH.Obstacle_Portal(l),j.set=g,j.item=h+e.obstacles[g].length,j.type=l.kind,this.playObstaclesArr[g][j.item]=j,j.addToView(this.playObstaclesContArr[g],this.playObstaclesContArr[g]),j.updateGroupIndex(e.obstacles[g][h].group,this.visualContainer),i.pairedPortal=j,j.pairedPortal=i;break;case"head":i=new WGBH.Obstacle_Head(e.obstacles[g][h]);break;case"bridge":i=new WGBH.Obstacle_Bridge(e.obstacles[g][h]);break;default:i=new b(e.obstacles[g][h])}i.set=g,i.item=h,i.type=e.obstacles[g][h].kind,this.playObstaclesArr[g][h]=i,i.addSoundFunction(this.playObstacleSound),i.addToView(this.playObstaclesContArr[g],this.playObstaclesContArr[g]),i.updateGroupIndex(k,this.visualContainer)}if(e.fruits&&"maker"!=this.currentScene)for(this.fruitIndx=e.fruitType,g=0;g<e.fruits.length;g++){var m=new createjs.Sprite(app.SPRITE_SHEETS.game,"fruit_"+app.fruitNamesArr[this.fruitIndx]);this.visualBtmContainer.addChildAt(m,0),m.x=e.fruits[g].x*this.tileWidth+this.board.x+.5*this.tileWidth,m.y=e.fruits[g].y*this.tileWidth+this.board.y+.5*this.tileWidth,m.regX=30,m.regY=30,m.caught=!1,this.fruitsArr.push(m)}if(this.hole||(this.hole=new WGBH.ObstacleIcon("hole",1,1),this.hole.name="hole",this.hole.view.name="hole",this.hole.view.col=e.hole.x,this.hole.view.row=e.hole.y),this.hole.setPosition({x:e.hole.x*this.tileWidth+this.board.x+.5*this.tileWidth,y:e.hole.y*this.tileWidth+this.board.y+.5*this.tileWidth}),this.hole.view.startX=this.hole.x,this.hole.view.startY=this.hole.y,"maker"==this.currentScene&&(this.hole.view.visible=!0),this.markThisTile("t_"+e.hole.y+"_"+e.hole.x,!1),this.markThisTile("t_"+this.ballY+"_"+this.ballX,!1),this.ball.view.col=this.ballX,this.ball.view.row=this.ballY,this.hole.addToView(this.visualContainer),this.flag)this.flag.x=this.hole.x-5,this.flag.y=this.hole.y+5;else{var n=app.courseIndx+1;this.flag=new a;var o=new createjs.Sprite(app.SPRITE_SHEETS.game,"maker"==this.currentScene?"maker_flag_up":"blank_flag_up"),p=new createjs.Sprite(app.SPRITE_SHEETS.game,"num"+n);p.x=26,p.y=12,this.flag.regY=105,this.flag.addChild(o,p),p.visible="maker"==this.currentScene?!1:!0,this.addChild(this.flag),this.flag.x=this.hole.x-5,this.flag.y=this.hole.y+5,this.flag.scaleX=this.flag.scaleY=1.1,this.celebrate=new createjs.Sprite(app.SPRITE_SHEETS.game,"party1"),this.celebrate.gotoAndStop("party1"),this.celebrate.regX=90,this.celebrate.regY=90}if("maker"!=this.currentScene){for(g=0;g<this.playObstaclesContArr.length;g++)1==app.courseIndx&&this.addChild(this.playObstaclesContArr[g]),this.playObstaclesContArr[g].visible=g==app.obstaclesIndx-1?!0:!1;this.changeObstacles(app.obstaclesIndx)}else this.flag.visible=!1;var q=new c;app.phy_world.SetContactListener(q),q.BeginContact=function(a){var b=a.GetFixtureA().GetBody().GetUserData(),c=a.GetFixtureB().GetBody().GetUserData();"bugball"!=b.kind&&"bugball"!=c.kind||"wall"!=b.kind&&"wall"!=c.kind||app.sound.play("sfx_wall")}},e.playSingleObstacleSound=function(a){if(!this.gameOver)switch(a){case"windmill":app.obstaclesIndx<3||"maker"==this.currentScene?this.obsSFX=app.sound.play("sfx_windmill_slow",{loop:!0}):this.obsSFX=app.sound.play("sfx_windmill_fast",{loop:!0});break;case"turtle":this.obsSFX=app.sound.play("sfx_turtle1",{loop:!0})}},e.playObstacleSound=function(a,b){if(!this.gameOver){var c=a.bodyData.kind;"crab"==c&&(c+=b);var d=this.obstacleStatsArr[c];if(null==d&&(this.obstacleStatsArr[c]={target:null,got:!1},d=this.obstacleStatsArr[c]),null==d.target&&(d.target=a),a==d.target)switch(c){case"conveyor":"change"==b&&(this.obsSFX=app.sound.play("sfx_conveyor_turn"));break;case"crab1":case"crab2":case"crab3":this.obsSFX=app.sound.play("sfx_crab"+b);break;case"bridge":this.obsSFX=app.sound.play("sfx_bridge");break;case"head":this.obsSFX=app.sound.play("sfx_head_open")}}},e.resetObstacleStats=function(){for(var a=Object.keys(this.obstacleStatsArr),b=0;b<a.length;b++)this.obstacleStatsArr[a[b]].target=null,this.obstacleStatsArr[a[b]].got=!1},e.stopAllSound=function(){this.obsSFX&&(this.obsSFX.stop(),this.obsSFX=null)},e.getPrevObstacles=function(a){app.obstaclesIndx--,app.obstaclesIndx<0&&(app.obstaclesIndx=4);for(var b=0;b<this.playObstaclesContArr.length;b++){this.playObstaclesContArr[b].visible=b==this.obstaclesIndx?!0:!1;for(var c=0;c<this.playObstaclesArr[b].length;c++){var d=b==this.obstaclesIndx?app.CollideGroupIndex:app.BallGroupIndex;this.playObstaclesArr[b][c].updateGroupIndex(d,this.visualContainer)}}},e.getNextObstacles=function(a){this.obstaclesIndx++,this.obstaclesIndx>4&&(this.obstaclesIndx=0);for(var b=0;b<this.playObstaclesContArr.length;b++){this.playObstaclesContArr[b].visible=b==this.obstaclesIndx?!0:!1;for(var c=0;c<this.playObstaclesArr[b].length;c++){var d=b==this.obstaclesIndx?app.CollideGroupIndex:app.BallGroupIndex;this.playObstaclesArr[b][c].updateGroupIndex(d,this.visualContainer)}}},e.toggleGame=function(a){createjs.Tween.removeAllTweens(),this.fruitSparkle.alpha=0,this.fruitSparkle.visible=!1,this.world_active=a,this.toggleArrowVisibility(!1),this.forceContainer.visible=a,this.ball.ready=!0,this.ball.toggleAwake(!1);var b=0,c=0;if(a){if(this.resetObstacleStats(),this.playMode=!0,this.updateArrowHandleColor(),this.strokesContainer.visible=!0,this.hitContainer.addEventListener("mousedown",this.startLaunch),this.flag&&(this.flag.visible=!0,this.flag.x=this.hole.x-5,this.flag.y=this.hole.y+5),"maker"!=this.currentScene)this.ball.ball.view.alpha=1,this.hole.obsIcon.alpha=1,this.toggleFruitsActive(!0);else{for(b=0;b<this.fruitsArr.length;b++)this.fruitsArr[b].toggleHitArea(!1);for(this.fruitsContainer.getChildByName("fruitsBg").gotoAndStop(app.fruitNamesArr[this.fruitIndx]+"_slots"),b=0;b<this.fruitsCounterArr.length;b++)this.fruitsCounterArr[b].gotoAndStop("feedback_"+app.fruitNamesArr[this.fruitIndx])}for(this.obstacleTypesArr=[],b=0;b<this.obstaclesArr.length;b++){this.obstaclesArr[b].toggleHitArea(!1);var d=!0;for(c=0;c<this.obstacleTypesArr.length;c++)if(this.obstacleTypesArr[c]==this.obstaclesArr[b].bodyData.kind){d=!1;break}d&&(this.obstacleTypesArr.push(this.obstaclesArr[b].bodyData.kind),this.playSingleObstacleSound(this.obstaclesArr[b].bodyData.kind))}this.hole.toggleHitArea(!1),this.ball.toggleHitArea(!1)}else{for(this.flag&&(this.flag.visible=!1),this.fruitCount=0,this.strokeNum=0,this.gameOver=!1,this.playMode=!1,this.strokesContainer.visible=!1,this.ball.currentPortal=null,this.ball.currentHead=null,this.ball.portalTest=!1,this.ball.headTest=!1,this.ball.active=!0,this.ball.ball.view.alpha=1,this.ball.hitConveyor=null,this.ball.currentDir=-1,this.hitContainer.removeEventListener("mousedown",this.startLaunch),this.hitContainer.removeEventListener("presup",this.launchIt),this.hitContainer.removeEventListener("pressmove",this.moveLaunch),"maker"==this.currentScene&&this.hole.toggleHitArea(!0),b=0;b<this.obstaclesArr.length;b++)this.obstaclesArr[b].toggleHitArea(!0),"head"==this.obstaclesArr[b].type&&(this.obstaclesArr[b].canUpdate=!0);for(this.ball.toggleHitArea(!0),b=0;b<this.fruitsArr.length;b++)"maker"==this.currentScene&&(this.fruitsArr[b].alpha=1,this.fruitsArr[b].toggleHitArea(!0),this.fruitsArr[b].view.caught=!1,this.fruitsArr[b].view.visible=!0),this.fruitsArr[b].visible=!0,this.fruitsArr[b].caught=!1,this.fruitsCounterArr[b].visible=!1}app.debug_display.stage.update()},e.toggleInteractivity=function(a){a?"maker"!=this.currentScene?this.hitContainer.addEventListener("mousedown",this.startLaunch):(this.hitContainer.removeEventListener("mousedown",this.onMouseDown),this.playMode&&this.hitContainer.addEventListener("mousedown",this.startLaunch)):"maker"!=this.currentScene?(this.hitContainer.removeEventListener("mousedown",this.startLaunch),this.hitContainer.removeEventListener("presup",this.launchIt),this.hitContainer.removeEventListener("pressmove",this.moveLaunch)):(this.hitContainer.addEventListener("mousedown",this.onMouseDown),this.playMode&&this.hitContainer.removeEventListener("mousedown",this.startLaunch))},e.onMouseDown=function(a){},e.toggleFruitsActive=function(a){for(i=0;i<this.fruitsArr.length;i++)this.fruitsArr[i].alpha=a?1:.2},e.resetGame=function(){this.world_active=!1,this.gameOver=!1,this.fruitCount=0,"maker"==this.currentScene?(this.playMode=!1,this.toggleArrowVisibility(!1),this.ball.resetPosition(!0),this.flag&&(this.flag.visible=!1)):(this.ball.resetPosition(!1),this.toggleArrowVisibility(!1)),this.ball.toggleAwake(!1);var a,b;for(a=0;a<this.obstaclesArr.length;a++)this.obstaclesArr[a].resetPosition();for(a=0;a<this.playObstaclesArr.length;a++)for(b=0;b<this.playObstaclesArr[a].length;b++)this.playObstaclesArr[a][b].resetPosition();for(a=0;a<this.fruitsArr.length;a++)"maker"==this.currentScene&&(this.fruitsArr[a].toggleHitArea(!0),this.fruitsArr[a].view.alpha=1,this.fruitsArr[a].view.visible=!0),this.fruitsArr[a].alpha=1,this.fruitsArr[a].visible=!0,this.fruitsArr[a].caught=!1,this.fruitsCounterArr[a].visible=!1;this.strokeNum=0},e.createArrow=function(){this.arrow=new createjs.Container,this.arrowHead=new createjs.Shape,this.arrowHead.graphics.s("white").ss(1).f("rgba(128,255,0,1)").p("EAAAAClMADSAAAMAAAABeMACngCYMgCngCdMAAAABjMgDSAAAMAAAAB0").ef().f("rgba(128,255,0,1)").p("EAAAABrMAF4AAA").ef().cp(),this.arrowHead.x=15,this.arrowHead.regY=9.5,this.arrowHandle=new createjs.Shape,this.arrowHandle.graphics.s("white").ss(1).f("#8cc63e").de(-50,-(.5*this.arrowHandleHeight),100,this.arrowHandleHeight),this.arrow.addChild(this.arrowHandle,this.arrowHead),this.arrowHandle.scaleX=this.arrowInitScale,this.arrow.visible=!1},e.createColorMeter=function(){this.forceContainer=new createjs.Container,this.addChild(this.forceContainer),this.forceContainer.visible=!1,this.forceContainer.x=320+this.toolbarOffset,this.forceContainer.y=this.gameInfoY,this.circlesArr=[],this.colorArr=["#79cc0d","#4bc10e","#1cb108","#159906","#108006","#096702"];var a=new createjs.Text("Power","24px nunitobold",app.FONT_COLOR);a.textAlign="center",a.x=60,a.y=0,this.forceContainer.addChild(a),this.powerbar=new createjs.Sprite(app.SPRITE_SHEETS.game,"power_meter1"),this.forceContainer.addChild(this.powerbar),this.powerbar.y=25,this.powerbar.x=15},e.toggleArrowVisibility=function(a){this.arrow.visible=a,a&&(this.visualContainer.addChildAt(this.arrow,this.visualContainer.getChildIndex(this.ball.view)),this.arrow.x=this.ball.view.x,this.arrow.y=this.ball.view.y,this.arrow.rotation=0,this.arrowHandle.scaleX=this.arrowInitScale)},e.updateArrowHandleColor=function(){this.colorIndx=Math.floor((this.arrowHandle.scaleX-this.arrowInitScale)/(1-this.arrowInitScale)*(this.colorArr.length-1)),this.arrow.visible?this.powerbar.gotoAndStop("power_meter"+(this.colorIndx+2)):this.powerbar.gotoAndStop("power_meter1"),this.arrowHandle.graphics.clear().s("white").ss(2).f(this.colorArr[this.colorIndx]).de(-90,-(.5*this.arrowHandleHeight),100,this.arrowHandleHeight),this.arrowHead.graphics.clear().f(this.colorArr[this.colorIndx]).ss(2,void 0,void 0,10).s("white").sd([],0).p("EAAAAClMAEYAAAMAAAABeMACngCYMgCngCdMAAAABjMgEYAAAMAAAAB0").es().ef().f(this.colorArr[this.colorIndx]).p("EAAAABrMAF4AAA").ef().cp()},e.startLaunch=function(a){this.ball.ready&&(this.gameOver||(this.world_active=!1,this.startPt=[a.stageX,a.stageY],this.toggleArrowVisibility(!0),this.updateArrowHandleColor(),this.hitContainer.addEventListener("pressup",this.launchIt),this.hitContainer.addEventListener("pressmove",this.moveLaunch)))},e.changeObstacles=function(a){app.obstaclesIndx=a,this.resetObstacleStats();for(var b=0;b<this.playObstaclesContArr.length;b++){this.playObstaclesContArr[b].visible=b==app.obstaclesIndx-1?!0:!1;for(var c=0;c<this.playObstaclesArr[b].length;c++){var d=b==app.obstaclesIndx-1?app.CollideGroupIndex:app.BallGroupIndex;this.playObstaclesArr[b][c].updateGroupIndex(d,this.visualContainer)}}this.stopAllSound(),app.obstaclesIndx>0&&this.playSingleObstacleSound(this.currentType)},e.moveLaunch=function(a){if(this.ball.ready){var b=a.stageX-this.startPt[0],c=a.stageY-this.startPt[1],d=Math.atan2(b,c),e=Math.sqrt(b*b+c*c);e=e>50?1:e/50,this.arrowHandle.scaleX=e<this.arrowInitScale?this.arrowInitScale:e,this.updateArrowHandleColor();var f=d*(180/Math.PI)+90;this.arrow.rotation=-f}},e.launchIt=function(a){this.toggleArrowVisibility(!1),this.flag&&(this.flag.visible=!1),this.maxImpulse=this.impulseArr[this.colorIndx];var b=this.startPt[0]-a.stageX,c=this.startPt[1]-a.stageY;if((0!=b||0!=c)&&this.ball.ready){this.arrow.visible=!1,this.world_active=!0,this.ball.glow.visible=!1,this.strokeNum++;var d=b>0?1:-1,e=c>0?1:-1,f=Math.abs(b),g=Math.abs(c);f>g?(g=this.maxImpulse/b*c,f=this.maxImpulse):(g=this.maxImpulse,f=this.maxImpulse/c*b),this.hitContainer.removeEventListener("pressup",this.launchIt),this.hitContainer.removeEventListener("pressmove",this.moveLaunch),(d>0&&0>f||0>d&&f>0)&&(f=-f),(e>0&&0>g||0>e&&g>0)&&(g=-g);var h=app.config.PHYSICS.OBJ_LINEAR_DAMPING;h=this.currentDamping,this.ball.setLaunchData(h,f,g),this.launchFunc&&this.launchFunc()}},e.checkHitTest=function(){if(this.ball.view.x<this.hole.x+this.holeDist&&this.ball.view.x>this.hole.x-this.holeDist&&this.ball.view.y<this.hole.y+this.holeDist&&this.ball.view.y>this.hole.y-this.holeDist&&!this.gameOver){this.gameOver=!0,this.stopAllSound(),app.sound.stopAll(),this.hitContainer.removeEventListener("mousedown",this.startLaunch),this.hitContainer.removeEventListener("presup",this.launchIt),this.hitContainer.removeEventListener("pressmove",this.moveLaunch),this.ball.toggleAwake(!1),this.world_active=!1,this.ball.glow.visible=!1;var a="maker"==this.currentScene?0:4e3;this.freezeUI&&this.freezeUI(),app.sound.play("sfx_hole"),createjs.Tween.get(this.ball.ball.view).to({x:this.hole.x,y:this.hole.y},100).wait(600).call(function(){"maker"!=this.currentScene&&(this.addChild(this.celebrate),this.celebrate.visible=!0,this.celebrate.x=this.hole.x,this.celebrate.y=this.hole.y,app.obstaclesIndx<=1?(app.sound.play("sfx_easy"),this.celebrate.gotoAndPlay("party1")):app.obstaclesIndx<=3?(app.sound.play("sfx_med"),this.celebrate.gotoAndPlay("party2")):(app.sound.play("sfx_hard"),this.celebrate.gotoAndPlay("party3")))}.bind(this)).wait(a).call(this.endGameShowMessage)}},e.endGameShowMessage=function(){this.ball.setPosition({x:this.hole.x,y:this.hole.y},!0),this.toggleMessagePanel(!0),this.delay=null,this.celebrate&&(this.celebrate.visible=!1,this.celebrate.stop())},e.checkConveyorHitTest=function(a){if(!this.gameOver){var b=a.checkHitArea(this.ball);if(b&&(null==this.ball.hitConveyor||this.ball.hitConveyor==a&&this.ball.currentDir!=a.currentDir)){app.sound.play("sfx_conveyor_hit");var c=this.ball.view.x<a.view.x?0:1,d=this.ball.view.y<a.view.y?0:1;this.ball.hitConveyor=a,this.ball.currentDir=a.currentDir;var e=this.ball.ball.body.GetLinearVelocity(),f=e.x,g=e.y;this.ball.toggleAwake(!1);var h=20;f=this.clamp(f,-h,h),g=this.clamp(g,-h,h),this.conveyorSpeed=25;var i=this.clamp(e.x,19,25),j=this.clamp(e.y,19,25),k=0;switch(a.currentDir){case 0:1==d&&(k=10),this.ball.setLaunchData(this.currentDamping,f,-(j+k));break;case 1:0==c&&(k=10),this.ball.setLaunchData(this.currentDamping,i+k,g);break;case 2:0==d&&(k=10),this.ball.setLaunchData(this.currentDamping,f,j+k);break;default:1==c&&(k=10),this.ball.setLaunchData(this.currentDamping,-(i+k),g)}}b||this.ball.hitConveyor==a&&(this.ball.hitConveyor=null)}},e.checkHeadHitTest=function(a){if(!this.gameOver||!this.ball.headTest){var b=a.checkHitArea(this.ball);if(b&&a.canUpdate&&(null==this.ball.currentHead||this.ball.currentHead!=a)){this.ball.currentHead=a,this.ball.headTest=!0,this.ball.toggleAwake(!1);var c,d,e=a.rotateHead(this.ball);switch(this.headSpeed=15,e){case 0:c=0,d=-this.headSpeed;break;case 1:c=this.headSpeed,d=0;break;case 2:c=0,d=this.headSpeed;break;case 3:c=-this.headSpeed,d=0}app.sound.play("sfx_head_turn"),this.ball.setPosition({x:a.view.x,y:a.view.y}),this.ball.ball.view.visible=!1,this.ball.glow.visible=!1,createjs.Tween.get(this.ball).wait(1110).call(function(){this.ball.ball.view.visible=!0,this.ball.setLaunchData(this.currentDamping,c,d)}.bind(this)).wait(2500).call(function(){this.ball.currentHead=null,this.ball.headTest=!1}.bind(this))}}},e.checkBridgeHitTest=function(a){if(!this.gameOver){var b=a.checkHitArea(this.ball);b.water&&!createjs.Tween.hasActiveTweens()&&(this.ball.active=!1,this.ball.ready=!1,this.ball.toggleAwake(!1),this.ball.glow.visible=!1,app.sound.play("sfx_water"),createjs.Tween.get(this.ball.ball.view).to({alpha:0},900).call(function(){this.ball.ball.view.alpha=1,this.ball.resetPosition(!0),this.ball.active=!0,this.ball.ready=!0,this.ball.toggleAwake(!1)}.bind(this)))}},e.checkDiamondHitTest=function(a){if(!this.gameOver){var b=a.checkHitArea(this.ball);b&&"diamond3"==a.ground.currentAnimation&&this.ball.glow.visible&&this.ball.setLaunchData(this.currentDamping,3,3)}},e.checkPortalHitTest=function(a){if(!this.gameOver){var b=a.checkHitArea(this.ball);if(b.hit&&(null==this.ball.currentPortal||this.ball.currentPortal!=a)){this.ball.currentPortal=a,createjs.Tween.removeAllTweens(),this.ball.portalTest=!0,this.ball.savePrevVel(),this.ball.toggleAwake(!1),this.ball.ready=!1,this.ball.setPosition({x:a.pairedPortal.view.x,y:a.pairedPortal.view.y});var c=Math.abs(1==a.currentDir||3==a.currentDir?this.ball.prevVel.x:this.ball.prevVel.y),d=Math.abs(0==a.currentDir||2==a.currentDir?this.ball.prevVel.y:this.ball.prevVel.x);switch(this.ball.currentPortal=a.pairedPortal,app.sound.play("sfx_portal"),a.pairedPortal.currentDir){case 0:d=10>d?-10:-d,c=0;break;case 1:c=10>c?10:c,d=0;break;case 2:c=0,d=10>d?10:d;break;case 3:c=10>c?-10:-c,d=0}this.ball.setLaunchData(this.currentDamping,c,d),createjs.Tween.get(this.ball).wait(500).call(function(){this.ball.currentPortal=null}.bind(this))}}},e.stopGame=function(){this.stopAllSound(),this.world_active=!1,this.hitContainer.removeEventListener("pressup",this.launchIt),this.hitContainer.removeEventListener("pressmove",this.moveLaunch),this.hitContainer.removeEventListener("mousedown",this.startLaunch),app.off("update",this.onPanelUpdate)},e.onPanelUpdate=function(a){if(app.time_elapsed=a/1e3,app.delta_factor=app.time_elapsed/app.STEP_TIME,this.playMode&&this.ball&&this.ball.updateView(a),this.world_active&&this.ball&&this.ball.active&&this.ball.isAwake()){this.ball.glow.visible=!1;var b=this.ball.ball.body.GetLinearVelocity(),c=Math.abs(b.x),d=Math.abs(b.y),e=c>d?c:d;.1>e?(this.ball.ready=!0,this.ball.toggleAwake(!1),this.updateArrowHandleColor()):(this.ball.ready=!1,this.arrow.visible&&(this.arrow.visible=!1)),this.checkHitTest()}if(this.playMode){this.ball&&this.arrow&&(this.arrow.x=this.ball.view.x,this.arrow.y=this.ball.view.y);var f,g;for(app.box2D.update(app.physics_debug_qa,Math.round(a)/1e3),app.physics_debug_qa&&app.debug_display.stage.update(),f=0;f<this.obstaclesArr.length;f++)this.obstaclesArr[f].updateView(a),"conveyor"==this.obstaclesArr[f].type||"conveyor2"==this.obstaclesArr[f].type?this.checkConveyorHitTest(this.obstaclesArr[f]):"portal"==this.obstaclesArr[f].type?this.checkPortalHitTest(this.obstaclesArr[f]):"head"==this.obstaclesArr[f].type?this.checkHeadHitTest(this.obstaclesArr[f]):"bridge"==this.obstaclesArr[f].type?this.checkBridgeHitTest(this.obstaclesArr[f]):"diamond"==this.obstaclesArr[f].type&&this.checkDiamondHitTest(this.obstaclesArr[f]);for(f=0;f<this.playObstaclesArr.length;f++)for(g=0;g<this.playObstaclesArr[f].length;g++)this.playObstaclesArr[f][g].updateView(a),"conveyor"==this.playObstaclesArr[f][g].type||"conveyor2"==this.playObstaclesArr[f][g].type?this.checkConveyorHitTest(this.playObstaclesArr[f][g]):"portal"==this.playObstaclesArr[f][g].type?this.checkPortalHitTest(this.playObstaclesArr[f][g]):"head"==this.playObstaclesArr[f][g].type?this.checkHeadHitTest(this.playObstaclesArr[f][g]):"bridge"==this.playObstaclesArr[f][g].type?this.checkBridgeHitTest(this.playObstaclesArr[f][g]):"diamond"==this.playObstaclesArr[f][g].type&&this.checkDiamondHitTest(this.playObstaclesArr[f][g]);for(f=0;f<this.fruitsArr.length;f++){var h="maker"!=this.currentScene?this.fruitsArr[f]:this.fruitsArr[f].view;this.ball.view.x<h.x+this.holeDist&&this.ball.view.x>h.x-this.holeDist&&this.ball.view.y<h.y+this.holeDist&&this.ball.view.y>h.y-this.holeDist&&!this.gameOver&&!h.caught&&(this.visualContainer.addChild(this.fruitSparkle),this.fruitSparkle.x=h.x,this.fruitSparkle.y=h.y,this.fruitSparkle.visible=!0,this.fruitSparkle.alpha=0,createjs.Tween.removeTweens(this.fruitSparkle),createjs.Tween.get(this.fruitSparkle).to({alpha:1},200).wait(100).to({alpha:0}),app.sound.play("sfx_sparkle"),h.caught=!0,h.visible=!1,this.fruitCount++,"make"==this.currentScene&&(this.fruitsArr[f].caught=!0),this.fruitsCounterArr[this.fruitCount-1].visible=!0)}}},e.clamp=function(a,b,c){return b>=a?b:a>=c?c:a},namespace("WGBH").CourseManager=d}(),function(){var a=function(){},b=a.prototype;b.initialize=function(){app.LOCAL_STORAGE=!0,this.keys=Object.keys(app.config.COURSE),this.data=app.config.COURSE,localStorage.getItem("dw_bugball")||(localStorage.clear(),localStorage.setItem("dw_bugball",1)),this.getData()},b.saveData=function(){if(app.LOCAL_STORAGE){for(var a,b,c,d=0;d<this.keys.length-1;d++)a=this.data[this.keys[d]].completed?1:0,b=this.data[this.keys[d]].unlock?1:0,c=this.data[this.keys[d]].level,localStorage.setItem(this.keys[d]+"_level",JSON.stringify(c)),localStorage.setItem(this.keys[d]+"_unlocked",b),localStorage.setItem(this.keys[d]+"_completed",a);localStorage.setItem("gamedone",app.GAME_DONE?1:0),localStorage.setItem("firstFdbk",app.firstFdbk?1:0),localStorage.setItem("firstMap",app.firstMap?1:0),localStorage.setItem("firstBug",app.firstBug?1:0),localStorage.setItem("firstMaker",app.firstMaker?1:0),localStorage.setItem("firstMakerBug",app.firstMakerBug?1:0),localStorage.setItem("firstHole",app.firstHole?1:0),localStorage.setItem("firstMakerPlay",app.firstMakerPlay?1:0),localStorage.setItem("makerTutorial",app.makerTutorial?1:0),localStorage.setItem("firstDelete",app.firstDelete?1:0)}},b.getData=function(){if(app.LOCAL_STORAGE){for(var a=0;a<this.keys.length-1;a++){var b=JSON.parse(localStorage.getItem(this.keys[a]+"_level")),c=localStorage.getItem(this.keys[a]+"_unlocked"),d=localStorage.getItem(this.keys[a]+"_completed");b?this.data[this.keys[a]].level=b:localStorage.setItem(this.keys[a]+"_level",JSON.stringify([0,0,0,0,0])),c?this.data[this.keys[a]].unlock=0==c?!1:!0:(localStorage.setItem(this.keys[a]+"_unlocked",0==a?1:0),this.data[this.keys[a]].unlock=0==a?!0:!1),d?this.data[this.keys[a]].completed=0==d?!1:!0:localStorage.setItem(this.keys[a]+"_completed",0)}var e=localStorage.getItem("gamedone"),f=localStorage.getItem("firstFdbk"),g=localStorage.getItem("firstMap"),h=localStorage.getItem("firstBug"),i=localStorage.getItem("firstMaker"),j=localStorage.getItem("firstMakerBug"),k=localStorage.getItem("firstHole"),l=localStorage.getItem("firstMakerPlay"),m=localStorage.getItem("makerTutorial"),n=localStorage.getItem("firstDelete");e?app.GAME_DONE=0==e?!1:!0:localStorage.setItem("gamedone",0),f?app.firstFdbk=0==f?!1:!0:localStorage.setItem("firstFdbk",1),g?app.firstMap=0==g?!1:!0:localStorage.setItem("firstMap",1),h?app.firstBug=0==h?!1:!0:localStorage.setItem("firstBug",1),i?app.firstMaker=0==i?!1:!0:localStorage.setItem("firstMaker",1),j?app.firstMakerBug=0==j?!1:!0:localStorage.setItem("firstMakerBug",1),k?app.firstHole=0==k?!1:!0:localStorage.setItem("firstHole",1),l?app.firstMakerPlay=0==l?!1:!0:localStorage.setItem("firstMakerPlay",1),n?app.firstDelete=0==n?!1:!0:localStorage.setItem("firstDelete",1),m?app.makerTutorial=0==m?!1:!0:localStorage.setItem("makerTutorial",1)}},a.shuffleArray=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},a.arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c=a.length;c--;)if(a[c]!==b[c])return!1;return!0},a.getInstance=function(){return void 0==this.instance&&(this.instance=new WGBH.GameManager),this.instance},namespace("WGBH").GameManager=a}(),function(){var a=include("createjs.Container"),b=function(b,c,d){a.call(this),this.setup(b,c,d)},c=extend(b,a);c.setup=function(a,b,c){this.mouseChildren=!1,this.sizeGridCol=b,this.sizeGridRow=c,this.canPlace=!1,this.kind=a,this.obstacleObject=new createjs.Container,this.obsIcon=new createjs.Container,this.icon=null,this.obsImg=null;var d,e,f="#63dfe7";if("bumper"==a)this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"orange_seashell"),d=this.obsImg.spriteSheet.getAnimation("orange_seashell").frames[0],e=this.obsImg.spriteSheet.getFrame(d),this.obsImg.regX=.5*e.rect.width-e.regX,this.obsImg.regY=.5*e.rect.height-e.regY,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"orange_seashell"),this.icon.regX=this.obsImg.regX,this.icon.regY=this.obsImg.regY,this.obsIcon.addChild(this.icon);else if("stick"==a)this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"stick"),d=this.obsImg.spriteSheet.getAnimation("stick").frames[0],e=this.obsImg.spriteSheet.getFrame(d),this.obsImg.regX=.5*e.rect.width-e.regX,this.obsImg.regY=.5*e.rect.height-e.regY,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"stick"),this.icon.regX=this.obsImg.regX,this.icon.regY=this.obsImg.regY,this.obsIcon.addChild(this.icon);else if("windmill"==a)this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"blue_spinner"),d=this.obsImg.spriteSheet.getAnimation("blue_spinner").frames[0],e=this.obsImg.spriteSheet.getFrame(d),this.obsImg.regX=.92*e.rect.width-e.regX,this.obsImg.regY=.5*e.rect.height-e.regY,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"windmill_icon"),this.icon.regX=30,this.icon.regY=30,this.obsIcon.addChild(this.icon);else if("crabwalk"==a||"crabwalkside"==a){var g="crabwalkside"==a?"orange":"purple",h="crabwalkside"==a?0:90;this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,g+"_crab"),this.obsImg.stop(),this.obsImg.regX=30,this.obsImg.regY=30,this.obsImg.rotation=h,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,g+"_crab"),this.icon.regX=this.obsImg.regX,this.icon.regY=this.obsImg.regY,this.icon.rotation=h,this.icon.stop(),this.obsIcon.addChild(this.icon)}else if("diamond"==a)this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"diamond3"),this.obsImg.regX=30,this.obsImg.regY=30,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"diamond_icon"),this.icon.regX=this.obsImg.regX,this.icon.regY=this.obsImg.regY,this.obsIcon.addChild(this.icon);else if("conveyor"==a||"conveyor2"==a){var i=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor"==a?"conveyor_2rect":"conveyor_3rect");i.regX=30,i.regY=30,this.obstacleObject.addChild(i);var j=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor_arrow");j.regX=60,j.regY=60,j.rotation=90,j.x=30,j.y=30,this.obstacleObject.addChild(j),this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor"==a?"conveyor_2way":"conveyor_3way"),this.obsImg.regX=90,this.obsImg.regY=90,this.obsImg.y=60,this.obsImg.rotation=90,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"conveyor"==a?"conveyor2_icon":"conveyor3_icon"),this.icon.regX=30,this.icon.regY=30,this.obsIcon.addChild(this.icon)}else if("turtle"==a||"turtle2"==a){var k="turtle"==a?90:0;this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"turtle"),this.obsImg.stop(),this.obsImg.rotation=k,this.obsImg.regX=30,this.obsImg.regY=30,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"turtle"),this.icon.stop(),this.icon.regX=30,this.icon.regY=30,this.icon.rotation=k,this.obsIcon.addChild(this.icon)}else if("portal"==a){this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"portal_icon"),this.obsImg.regX=30,this.obsImg.regY=30;var l=new createjs.Sprite(app.SPRITE_SHEETS.game,"portal_icon");l.regX=30,l.regY=30,l.y=60,
this.obstacleObject.addChild(l),this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"portal_icon"),this.icon.regX=this.obsImg.regX,this.icon.regY=this.obsImg.regY,this.obsIcon.addChild(this.icon)}else if("head"==a){var m=new createjs.Sprite(app.SPRITE_SHEETS.game,"head_teeth");m.regX=90,m.regY=90,m.y=50,m.rotation=180,this.obstacleObject.addChild(m),this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"big_head_front"),this.obsImg.rotation=180,this.obsImg.regX=90,this.obsImg.regY=90,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"head_icon"),this.icon.regX=30,this.icon.regY=30,this.obsIcon.addChild(this.icon)}else if("bridge"==a){var n=new createjs.Sprite(app.SPRITE_SHEETS.game,"water_trap");n.regX=90,n.regY=90,this.obstacleObject.addChild(n),this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"wide_bridge"),this.obsImg.regX=90,this.obsImg.regY=90,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"bridge_icon"),this.icon.regX=30,this.icon.regY=30,this.obsIcon.addChild(this.icon)}else if("fruit"==a)this.obsImg=new createjs.Sprite(app.SPRITE_SHEETS.game,"fruit_orange"),d=this.obsImg.spriteSheet.getAnimation("fruit_orange").frames[0],e=this.obsImg.spriteSheet.getFrame(d),this.obsImg.regX=30,this.obsImg.regY=30,this.icon=new createjs.Sprite(app.SPRITE_SHEETS.game,"fruit_orange"),this.icon.regX=this.obsImg.regX,this.icon.regY=this.obsImg.regY,this.obsIcon.addChild(this.icon),this.fruitIndx=0;else{f="grey",this.obsImg=new createjs.Shape,this.obsImg.graphics.f(f).dc(0,0,30),this.obsImg.visible=!1;var o=new createjs.Sprite(app.SPRITE_SHEETS.game,"hole");o.regX=25.5,o.regY=23.5,this.obstacleObject.addChild(o),this.obsIcon.visible=!1}this.obsHit=new createjs.Shape,this.obsHit.graphics.f(app.PLACE_COLOR).dr(0,0,60*b,60*c),this.obsHit.alpha=app.HIT_ALPHA,this.obsHit.regX=60*b*.5,this.obsHit.regY=60*c*.5,this.obsHit.name="hole",this.addChild(this.obsHit),this.obstacleObject.addChild(this.obsImg),this.obstacleObject.visible="hole"!=a?!1:!0;var p=new createjs.Shape;p.graphics.f(f).dc(0,0,30),this.obsIcon.addChildAt(p,0),this.addChild(this.obsIcon,this.obstacleObject),"conveyor"==a||"conveyor2"==a?(this.obsHit.regX=30,this.obsHit.regY=30):"turtle2"==a?(this.obsHit.regX-=60,this.obsHit.regY-=90):"turtle"==a?(this.obsHit.regX-=90,this.obsHit.regY-=60):"portal"==a&&(this.obsHit.regX=30,this.obsHit.regY=30),this.view=this.obsHit,this.view.visible=!1},c.setPosition=function(a){this.x=a.x,this.y=a.y,this.initX=a.x,this.initY=a.y,this.view.initX=a.x,this.view.initY=a.y,this.x=a.x,this.y=a.y},c.addToView=function(a,b){this.cont||(this.cont=a),b?this.cont.addChild(this):this.cont.addChildAt(this,0)},c.toggleHitArea=function(a){this.view.visible=a,this.obstacleObject.visible="hole"==this.kind?!0:a,this.obsIcon.visible="hole"==this.kind?!1:!a},c.togglePlacementArea=function(a){var b=a?app.PLACE_COLOR:app.NO_PLACE_COLOR;this.obsHit.graphics.clear().f(b).dr(0,0,60*this.sizeGridCol,60*this.sizeGridRow),this.obstacleObject.alpha=a?1:.4,this.canPlace=a},c.updatePlacementChecker=function(a){var b=a?app.PLACE_COLOR:app.NO_PLACE_COLOR;this.obsHit.graphics.clear().f(b).dr(0,0,60*this.sizeGridCol,60*this.sizeGridRow),this.obstacleObject.alpha=a?1:.4,this.canPlace=a},namespace("WGBH").ObstacleIcon=b}(),namespace("WGBH").Obstacle_Bridge=Obstacle_Bridge,namespace("WGBH").Obstacle_Bumper=Obstacle_Bumper,namespace("WGBH").Obstacle_Conveyor=Obstacle_Conveyor,namespace("WGBH").Obstacle_CrabWalk=Obstacle_CrabWalk,namespace("WGBH").Obstacle_CrabWalkSide=Obstacle_CrabWalkSide,namespace("WGBH").Obstacle_Diamond=Obstacle_Diamond,namespace("WGBH").Obstacle_Fruit=Obstacle_Fruit,namespace("WGBH").Obstacle_Head=Obstacle_Head,namespace("WGBH").Obstacle_Portal=Obstacle_Portal,namespace("WGBH").Obstacle_Turtle=Obstacle_Turtle,namespace("WGBH").Obstacle_TurtleSide=Obstacle_TurtleSide,namespace("WGBH").Obstacle_Windmill=Obstacle_Windmill,function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Container"),c=include("springroll.easeljs.Button"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.nextBtn=new c(images.NextBtn),this.nextBtn.visible=!1,this.nextBtn.regX=71.5,this.nextBtn.regY=76.5,this.homeBtn=new c(images.HomeButton),this.msgContainer=new b,this.msgContainer.name="msgContainer",this.bgContainer=new b,this.bgContainer.name="bgContainer",this.menuContainer=new b,this.menuContainer.name="menuContainer",this.visualContainer=new b,this.visualContainer.name="visualContainer",this.editContainer=new b,this.editContainer.name="editContainer",this.buttonContainer=new b,this.buttonContainer.name="buttonContainer",this.gameCompleteContainer=new b,this.gameCompleteContainer.name="gameCompleteContainer";var a=new createjs.Sprite(app.SPRITE_SHEETS.game,"bottom_UI_bamboo");this.visualContainer.addChild(a),a.x=15.5,a.y=562,this.bg=new createjs.Bitmap(images["bg"+(app.courseIndx+1)]),this.bgContainer.addChild(this.bg),this.bg.x=app.BG_OFFSET,this.mgCourse=new WGBH.CourseManager,app.mgCourse=this.mgCourse,this.addChild(this.bgContainer,this.visualContainer,this.mgCourse,this.editContainer,this.buttonContainer,this.msgContainer,this.homeBtn,this.menuContainer,this.gameCompleteContainer,this.nextBtn)},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("WGBH").GamePanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Container"),c=include("springroll.easeljs.Button"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.resetBtn=new c(images.ResetBtn),this.resetBtn.visible=!1,this.resetBtn.regX=52.5,this.resetBtn.regY=120,this.playBtn=new c(images.PlayBtn),this.playBtn.regX=52.5,this.playBtn.regY=120,this.clearBtn=new c(images.ClearBtn),this.clearBtn.enabled=!1,this.clearBtn.regX=52.5,this.clearBtn.regY=120,this.homeBtn=new c(images.HomeButton),this.msgContainer=new b,this.msgContainer.name="msgContainer",this.menuContainer=new b,this.menuContainer.name="menuContainer",this.bgContainer=new b,this.bgContainer.name="bgContainer",this.visualContainer=new b,this.visualContainer.name="visualContainer",this.toolsContainer=new b,this.toolsContainer.name="toolsContainer",this.layoutContainer=new b,this.layoutContainer.name="layoutContainer",this.editContainer=new b,this.editContainer.name="editContainer",this.tutorialContainer=new b,this.mgCourse=new WGBH.CourseManager,app.mgCourse=this.mgCourse,this.bg=new createjs.Bitmap(images.bg1),this.bgContainer.addChild(this.bg),this.bg.x=app.BG_OFFSET,this.addChild(this.bgContainer,this.mgCourse,this.editContainer,this.visualContainer,this.toolsContainer,this.resetBtn,this.playBtn,this.clearBtn,this.menuContainer,this.layoutContainer,this.msgContainer,this.homeBtn,this.tutorialContainer)},f.teardown=function(){e.teardown.call(this),this.skin=null},namespace("WGBH").MakerPanel=d}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("springroll.easeljs.Button"),c=function(){a.call(this)},d=a.prototype,e=extend(c,a);e.setup=function(){this.bgContainer=new createjs.Container,this.addChild(this.bgContainer),this.bg=new createjs.Shape,this.bg.graphics.f("white").dr(0,0,app.config.scalingSize.maxWidth+4,app.config.scalingSize.maxHeight),this.bg.x=-(.5*(app.config.scalingSize.maxWidth-app.config.scalingSize.width))-2,this.bg.y=-(.5*(app.config.scalingSize.maxHeight-app.config.scalingSize.height)),this.bgContainer.addChildAt(this.bg,0),this.map=new createjs.Bitmap(images.Map),this.bgContainer.addChild(this.map),this.map.x=app.BG_OFFSET,this.path=new createjs.Sprite(app.SPRITE_SHEETS.game,"path1"),this.bgContainer.addChild(this.path),this.path.x=63,this.path.y=143,this.path.visible=!1,this.levelsBtnArr=[],this.levelsBtnPosArr=[[135,503,5.4],[145,336,-5.14],[250,337,4.33],[416,280,-10.42],[545,327,-2.02],[705,329,-12.02],[626,210,-2.85],[541,150,-.31],[835,143,10.92]],this.numCourses=Object.keys(app.config.COURSE).length-1;var a,c,d,e,f,g=0,h=-1;this.currentIndx=0;for(var i=0;i<this.levelsBtnPosArr.length;i++){var j=new createjs.Container,k=app.config.COURSE["course"+i].completed,l=app.config.COURSE["course"+i].unlock;e=new createjs.Sprite(app.SPRITE_SHEETS.game,"flag_outline"),e.name="outline",e.regY=109,e.regX=4,j.addChild(e),f=new createjs.Sprite(app.SPRITE_SHEETS.game,"hole_map"),f.name="hole",f.regX=25,f.regY=17.5,f.rotation=-this.levelsBtnPosArr[i][2],j.addChild(f),a=new createjs.Sprite(app.SPRITE_SHEETS.game,"blank_flag_up"),j.addChild(a),a.regX=0,a.regY=105,a.name="flag",c=new createjs.Sprite(app.SPRITE_SHEETS.game,"num"+(i+1)),c.name="num",j.addChild(c),c.x=26,c.y=-94;var m=new createjs.Sprite(app.SPRITE_SHEETS.game,"star_filled");m.x=-13,m.y=-120,j.addChild(m),app.showStar&&i==app.courseIndx?(m.visible=!0,m.alpha=0,app.showStar=!1,g=1100,createjs.Tween.get(m).wait(500).to({alpha:1},200).call(this.playSound).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200)):m.visible=k,d=new createjs.Shape,d.graphics.f("white").dr(0,-105,106,105),d.alpha=.01,j.addChild(d),this.bgContainer.addChildAt(j,3),j.level=i,j.mouseChildren=!1,j.x=this.levelsBtnPosArr[i][0],j.y=this.levelsBtnPosArr[i][1]+105,j.rotation=this.levelsBtnPosArr[i][2],l||-1!=h||(h=i,i>1&&(this.path.visible=!0,this.path.gotoAndStop("path"+(h-1)))),!l||app.showFlag&&app.courseIndx+1==i?(e.visible=!1,a.gotoAndStop("blank_flag_disabled"),f.gotoAndStop("hole_map_disabled"),c.alpha=.5):(a.gotoAndStop("blank_flag_up"),f.gotoAndStop("hole_map")),this.levelsBtnArr.push(j)}app.showFlag&&(app.showFlag=!1,g+=1500,app.courseIndx>0?this.path.visible=!0:this.path.visible=!1,this.path.gotoAndStop("path"+app.courseIndx),createjs.Tween.get(this.levelsBtnArr[app.courseIndx+1]).wait(g).call(function(){this.path.visible=!0,this.path.gotoAndStop("path"+(app.courseIndx+1)),this.flagSFX=app.sound.play("sfx_flag")}.bind(this)).wait(200).call(function(){this.levelsBtnArr[app.courseIndx+1].getChildByName("flag").gotoAndStop("blank_flag_up"),this.levelsBtnArr[app.courseIndx+1].getChildByName("outline").visible=!0,this.levelsBtnArr[app.courseIndx+1].getChildByName("hole").gotoAndStop("hole_map"),this.levelsBtnArr[app.courseIndx+1].getChildByName("num").alpha=1}.bind(this)).to({scaleX:1.1,scaleY:1.1},200).to({scaleX:1,scaleY:1},200)),-1==h&&(this.path.gotoAndStop("path8"),this.path.visible=!0),this.makerButton=new createjs.Container,this.makerButton.name="maker",e=new createjs.Sprite(app.SPRITE_SHEETS.game,"flag_outline"),e.name="outline",e.regY=105,this.makerButton.addChild(e),f=new createjs.Sprite(app.SPRITE_SHEETS.game,"hole_map"),f.name="hole",f.regX=21,f.regY=16.5,this.makerButton.addChild(f),a=new createjs.Sprite(app.SPRITE_SHEETS.game,"maker_flag_up"),this.makerButton.addChild(a),a.regX=0,a.regY=105,a.name="flag",d=new createjs.Shape,d.graphics.f("white").dr(0,-190,190,190),d.alpha=.01,this.makerButton.addChild(d),this.bgContainer.addChildAt(this.makerButton,2),this.makerButton.mouseChildren=!1,this.makerButton.x=830,this.makerButton.y=620,this.playButton=new b(images.PlayButton),this.addChild(this.bgContainer)},e.playSound=function(){app.sound.play("sfx_star")},e.panelReady=function(){},e.teardown=function(){d.teardown.call(this),this.bg=null,this.playButton=null},namespace("WGBH").MapPanel=c}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("springroll.easeljs.Button"),d=function(){a.call(this)},e=a.prototype,f=extend(d,a);f.setup=function(){this.bgContainer=new createjs.Container,this.addChild(this.bgContainer),this.bg=new createjs.Shape,this.bg.graphics.f("white").dr(0,0,app.config.scalingSize.maxWidth+4,app.config.scalingSize.maxHeight),this.bgContainer.addChildAt(this.bg,0),this.bgImg=new b(images.TitleBackground),this.bgContainer.addChild(this.bgImg),this.bgImg.y=0,this.bgImg.x=app.BG_OFFSET,this.playButton=new c(images.PlayButton),this.nextButton=new c(images.NextButton),this.nextButton.regX=71.5,this.nextButton.regY=76.5,this.playButton.regX=71.5,this.playButton.regY=76.5,this.nextButton.visible=!1,this.addChild(this.playButton,this.nextButton)},f.panelReady=function(){},f.teardown=function(){e.teardown.call(this),this.bg=null,this.bgImg=null,this.playButton=null},namespace("WGBH").TitlePanel=d}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.GamePanel"),c=include("springroll.easeljs.Button"),d=function(c){a.call(this,new b,c),this.setupCourse=this.setupCourse.bind(this),this.resetGame=this.resetGame.bind(this),this.getNextCourse=this.getNextCourse.bind(this),this.clearStage=this.clearStage.bind(this),this.toggleMessagePanel=this.toggleMessagePanel.bind(this),this.closeMenu=this.closeMenu.bind(this),this.gotoMap=this.gotoMap.bind(this),this.showGameMenu=this.showGameMenu.bind(this),this.toggleGame=this.toggleGame.bind(this),this.getPrevBall=this.getPrevBall.bind(this),this.getNextBall=this.getNextBall.bind(this),this.chooseBallColor=this.chooseBallColor.bind(this),this.changeObstacle=this.changeObstacle.bind(this),this.ballTutorial=this.ballTutorial.bind(this),this.onUpdate=this.onUpdate.bind(this),this.tutorialDone=this.tutorialDone.bind(this),this.soundDone=this.soundDone.bind(this),this.freezeUI=this.freezeUI.bind(this)},e=extend(d,a);e.enterDone=function(){this.courseIndx=app.courseIndx,this.tileWidth=app.config.MAP.tileWidth,this.currentState="play",this.pulseTime=200,this.stateIndx=0,this.strokeNum=0,this.firstComplete=!0,this.currentLevel=app.obstaclesIndx,this.tutorialMove=!1,this.indicatorOffsetX=4,this.indicatorOffsetY=5,app.gameMode="play",app.showFlag=!1,this.totalCourses=Object.keys(app.config.COURSE).length-1,this.panel.mgCourse.init("play",this.toggleMessagePanel,null,this.freezeUI);var a=new createjs.Bitmap(images.feedbackBG);a.x=app.BG_OFFSET,this.panel.msgContainer.addChild(a),a.name="bg",a.addEventListener("click",this.gotThis),0==app.courseIndx&&this.createBallColorMenuPanel(),this.panel.msgContainer.mouseChildren=!0,this.msgNextBtn=new c(images.NextBtn),this.msgResetBtn=new c(images.ReplayBtn),this.fruitType=app.fruitNamesArr[app.config.COURSE["course"+this.courseIndx].fruitType];var b=new createjs.Sprite(app.SPRITE_SHEETS.game,"DW_heads");this.panel.msgContainer.addChild(b),b.x=.5*app.STAGE_WIDTH-241.5,b.y=326,this.msgStarArr=[];var d=0,e=b.x+31,f=b.y+95;for(this.level=app.config.COURSE["course"+app.courseIndx].level,d=0;5>d;d++){var g=new createjs.Sprite(app.SPRITE_SHEETS.game,0==this.level[d]?"star_empty":"star_filled");this.panel.msgContainer.addChild(g),g.x=e,g.y=f,this.msgStarArr.push(g),e+=112}var h=new createjs.Sprite(app.SPRITE_SHEETS.game,this.fruitType+"_slots");for(this.panel.msgContainer.addChild(h),h.x=.5*app.STAGE_WIDTH-113,h.y=440,e=h.x+13,f=h.y,this.msgFruitArr=[],d=0;3>d;d++){var i=new createjs.Sprite(app.SPRITE_SHEETS.game,"feedback_"+this.fruitType);this.panel.msgContainer.addChild(i),i.x=e,i.y=f,i.alpha=0,this.msgFruitArr.push(i),e+=87}this.msgResetBtn.scaleX=this.msgResetBtn.scaleY=.8,this.msgNextBtn.scaleX=this.msgNextBtn.scaleY=.8,this.panel.msgContainer.addChild(this.msgResetBtn,this.msgNextBtn),this.toggleMessagePanel(!1),this.buttonsArr=[],e=60;var j=new createjs.Text("Difficulty","24px nunitobold",app.FONT_COLOR);for(j.textAlign="center",j.x=320,j.textBaseline="middle",j.y=app.config.scalingSize.height-157,this.panel.buttonContainer.addChild(j),this.indicator=new createjs.Sprite(app.SPRITE_SHEETS.game,"blue_indicator"),this.panel.buttonContainer.addChild(this.indicator),d=1;5>=d;d++){var k=new c(images["DW"+d]);k.x=e,k.y=app.config.scalingSize.height-137,this.buttonsArr.push(k),k.indx=d-1,k.name=d+"_button",app.firstHole&&0==app.courseIndx?(k.enabled=!1,this.indicator.x=k.x-this.indicatorOffsetX,this.indicator.y=k.y-this.indicatorOffsetY):(d==this.currentLevel+1&&(this.indicator.x=k.x-this.indicatorOffsetX,this.indicator.y=k.y-this.indicatorOffsetY),k.addEventListener("pressup",this.changeObstacle));var l=0==this.level[d-1]?"empty":"filled",m=new createjs.Sprite(app.SPRITE_SHEETS.game,"star_"+l);m.x=e+28,m.y=k.y+97,m.name="star"+d,this.panel.buttonContainer.addChild(k,m),e+=100}this.levelIndicator=new createjs.Shape,this.levelIndicator.graphics.ss(2).s("black").dr(-2,-2,74,84),this.levelIndicator.x=this.buttonsArr[1].x,this.levelIndicator.y=this.buttonsArr[1].y,this.setupCourse(app.config.COURSE["course"+this.courseIndx]),this.panel.mgCourse.toggleGame(!0,!1),this.msgResetBtn.addEventListener("click",this.resetGame),this.msgNextBtn.addEventListener("click",this.getNextCourse),this.panel.homeBtn.addEventListener("click",this.gotoMap),this.panel.mgCourse.toggleGame(!0),app.firstBug&&0==app.courseIndx?(app.firstBug=!1,WGBH.GameManager.getInstance().saveData(),app.voPlayer.play("choose_ball"),this.panel.mgCourse.toggleInteractivity(!1),this.arm=new createjs.Sprite(app.SPRITE_SHEETS.game,"tutorial_arm"),this.panel.buttonContainer.addChild(this.arm),this.arm.visible=!1):0!=app.courseIndx?this.bgSnd=app.sound.play("bg",{loop:!0}):null==app.jungleSFX&&(app.jungleSFX=app.sound.play("jungle_bg",{loop:!0,volume:app.JUNGLE_VOL}))},e.ballTutorial=function(){app.voPlayer.play(["ball_pull_back","ball_force"],this.tutorialDone),this.arm.x=-1100,this.arm.y=260,this.arm.rotation=-5,this.arm.visible=!0,createjs.Tween.get(this.arm).wait(1100).to({x:-660},200).to({rotation:0},200).call(function(){this.panel.mgCourse.toggleArrowVisibility(!0)}.bind(this)),createjs.Tween.get(this.panel).wait(1300).call(function(){this.startX=300,this.panel.mgCourse.startPt=[this.startX,300]}.bind(this)).wait(1800).call(function(){this.tutorialMove=!0,app.on("update",this.onUpdate)}.bind(this)).wait(1500).call(function(){this.arm.visible=!1,this.tutorialMove=!1,app.off("update",this.onUpdate),this.panel.mgCourse.ball.setLaunchData(this.panel.mgCourse.currentDamping,this.panel.mgCourse.maxImpulse,0)}.bind(this))},e.tutorialDone=function(){createjs.Tween.removeAllTweens(),this.panel.mgCourse.toggleGame(!0),this.panel.mgCourse.resetGame();for(var a=0;a<this.buttonsArr.length;a++){var b=this.buttonsArr[a];b.enabled=!0,b.addEventListener("pressup",this.changeObstacle)}this.bgSnd=app.sound.play("bg",{loop:!0})},e.onUpdate=function(a){this.tutorialMove&&(this.startX-=2,this.arm.x>-720&&(this.arm.x-=2),this.panel.mgCourse.moveLaunch({stageX:this.startX,stageY:300}))},e.changeObstacle=function(a){app.sound.play("sfx_click"),this.levelIndicator.x=this.buttonsArr[a.target.indx].x,this.levelIndicator.y=this.buttonsArr[a.target.indx].y,this.currentLevel=a.target.indx;for(var b=1;5>=b;b++){var c=this.panel.buttonContainer.getChildByName(b+"_button");b-1==this.currentLevel&&(this.indicator.x=c.x-this.indicatorOffsetX),this.indicator.y=c.y-this.indicatorOffsetY}this.toggleGame(),this.panel.mgCourse.changeObstacles(a.target.indx)},e.toggleGame=function(){this.stateIndx=0==this.stateIndx?1:0,this.panel.mgCourse.playMode=!0,this.panel.mgCourse.toggleGame(!0),this.resetGame(),this.panel.editContainer.visible=!1},e.createBallColorMenuPanel=function(a){this.colorChoiceCont=new createjs.Container,this.panel.menuContainer.addChild(this.colorChoiceCont),this.menuBg=new createjs.Bitmap(images.selectBG),this.menuBg.x=-(.5*(app.config.scalingSize.maxWidth-app.config.scalingSize.width))-2,this.menuBg.y=-(.5*(app.config.scalingSize.maxHeight-app.config.scalingSize.height)),this.menuBg.addEventListener("click",this.gotThis),this.menuBg.name="menuBG",this.colorChoiceCont.addChild(this.menuBg);for(var b=100,d=450,e=0;3>e;e++){var f=new createjs.Sprite(app.SPRITE_SHEETS.game,"ball"+e+"_select");this.colorChoiceCont.addChild(f),f.gotoAndStop("ball"+e+"_select"),f.x=2==e?b-20:b-10,f.y=d-300,f.name="bug"+e;var g=new c(images.heartBtn);this.colorChoiceCont.addChild(g),g.x=2==e?b-10:b,g.y=d,g.indx=e,g.name="btn"+e,g.addEventListener("click",this.chooseBallColor),b+=340}},e.gotThis=function(a){},e.chooseBallColor=function(a){app.ballColor=a.target.indx,app.sound.play("sfx_select");for(var b=0;3>b;b++){var c=this.colorChoiceCont.getChildByName("btn"+b);c.enabled=!1,c.alpha=b==app.ballColor?1:.5,c.removeEventListener("click",this.chooseBallColor)}var d=this.colorChoiceCont.getChildByName("bug"+app.ballColor);d.gotoAndPlay("ball"+app.ballColor+"select"),app.sound.play("sfx_bug"),createjs.Tween.get(d).wait(1e3).call(function(){if(this.colorChoiceCont.visible=!1,this.ball&&this.ball.changeObject(app.ballColor),app.voPlayer.stop(),app.firstHole){app.firstHole=!1,WGBH.GameManager.getInstance().saveData(),app.voPlayer.play("course_ui",this.ballTutorial);var a=500,b=200;createjs.Tween.get(this.buttonsArr[0]).wait(b).call(function(){this.indicator.x=this.buttonsArr[0].x-this.indicatorOffsetX,this.indicator.y=this.buttonsArr[0].y-this.indicatorOffsetY}.bind(this)),b+=700,createjs.Tween.get(this.buttonsArr[1]).wait(b).call(function(){this.indicator.x=this.buttonsArr[1].x-this.indicatorOffsetX,this.indicator.y=this.buttonsArr[1].y-this.indicatorOffsetY}.bind(this)),b+=700,createjs.Tween.get(this.buttonsArr[2]).wait(b).call(function(){this.indicator.x=this.buttonsArr[2].x-this.indicatorOffsetX,this.indicator.y=this.buttonsArr[2].y-this.indicatorOffsetY}.bind(this)),b+=700,createjs.Tween.get(this.buttonsArr[3]).wait(b).call(function(){this.indicator.x=this.buttonsArr[3].x-this.indicatorOffsetX,this.indicator.y=this.buttonsArr[3].y-this.indicatorOffsetY}.bind(this)),b+=700,createjs.Tween.get(this.buttonsArr[4]).wait(b).call(function(){this.indicator.x=this.buttonsArr[4].x-this.indicatorOffsetX,this.indicator.y=this.buttonsArr[4].y-this.indicatorOffsetY}.bind(this)).wait(a).call(function(){}.bind(this)).wait(200).call(function(){this.indicator.x=this.buttonsArr[1].x-this.indicatorOffsetX,this.indicator.y=this.buttonsArr[1].y-this.indicatorOffsetY}.bind(this))}else this.bgSnd=app.sound.play("bg",{loop:!0}),null!=app.jungleSFX&&(app.jungleSFX.stop(),app.jungleSFX=null)}.bind(this))},e.closeMenu=function(a){this.colorChoiceCont.visible=!1},e.gotoMap=function(a){app.voPlayer.stop(),this.bgSnd&&(this.bgSnd.stop(),this.bgSnd=null),app.sound.play("sfx_click"),createjs.Tween.removeAllTweens(),app.off("update",this.onUpdate),app.manager.state="map"},e.freezeUI=function(){for(var a=0;a<this.buttonsArr.length;a++)this.buttonsArr[a].enabled=!1,this.buttonsArr[a].removeEventListener("pressup",this.changeObstacle);this.bgSnd&&(this.bgSnd.stop(),this.bgSnd=null)},e.showGameMenu=function(a){this.panel.menuContainer.visible=!0},e.clearStage=function(){this.panel.mgCourse.clearStage(),this.ball=null},e.toggleMessagePanel=function(a){if(this.panel.addChild(this.panel.msgContainer),this.panel.msgContainer.visible=a,this.msgResetBtn.x=.5*app.STAGE_WIDTH-130,this.msgResetBtn.y=570,this.msgNextBtn.x=.5*app.STAGE_WIDTH+70,this.msgNextBtn.y=570,a){this.showParty=!1,app.jungleSFX=app.sound.play("jungle_bg",{loop:!0,volume:app.JUNGLE_VOL}),this.stateIndx=1,this.panel.mgCourse.playMode=!1;for(var b=0;b<this.msgFruitArr.length;b++)this.msgFruitArr[b].visible=!0,this.msgFruitArr[b].alpha=b<this.panel.mgCourse.fruitCount?1:0;var c=Object.keys(app.config.COURSE).length;if(this.courseIndx<c-1&&(app.config.COURSE["course"+(this.courseIndx+1)].unlock||(app.showFlag=!0,app.config.COURSE["course"+(this.courseIndx+1)].unlock=!0),app.courseIndx==c-2&&!app.GAME_DONE)){app.showFlag=!1,app.GAME_DONE=!0,this.showParty=!0,this.panel.msgContainer.visible=!1;var d=new createjs.Bitmap(images.gameDoneBG);this.panel.gameCompleteContainer.addChild(d),d.x=app.BG_OFFSET;var e=200,f=550;for(b=0;3>b;b++){var g=new createjs.Sprite(app.SPRITE_SHEETS.game,"ball"+b+"_win");g.gotoAndStop("ball"+b+"_win"),g.scaleX=.9,g.scaleY=.9,0==b?g.x=e:1==b?g.x=e+450:g.x=e+200,g.y=f,createjs.Tween.get(g,{loop:!0}).wait(300*b).to({y:400},500).to({y:550},500),this.panel.gameCompleteContainer.addChild(g)}app.voPlayer.play("party_page",this.soundDone),this.partySnd=app.sound.play("party_bg",{loop:!0,volume:.3}),this.panel.nextBtn.visible=!0,this.panel.nextBtn.addEventListener("click",this.gotoMap)}var h=0,i=app.config.COURSE["course"+this.courseIndx].level;for(b=0;5>b;b++)b!=app.obstaclesIndx&&1==i[b]&&this.msgStarArr[b].gotoAndStop("star_filled");for(0==i[app.obstaclesIndx]&&(i[app.obstaclesIndx]=1,app.firstFdbk&&(this.msgResetBtn.enabled=!1,this.msgNextBtn.enabled=!1,this.msgResetBtn.removeEventListener("click",this.resetGame),this.msgNextBtn.removeEventListener("click",this.getNextCourse)),createjs.Tween.get(this.msgStarArr[0]).wait(1e3).call(function(){app.sound.play("sfx_star"),this.msgStarArr[app.obstaclesIndx].gotoAndStop("star_filled"),app.firstFdbk&&(app.firstFdbk=!1,app.voPlayer.play("fdbk_ui"),this.oriScale=this.msgResetBtn.scaleX,createjs.Tween.get(this.msgResetBtn).wait(4e3).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime),createjs.Tween.get(this.msgNextBtn).wait(7200).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).call(function(){this.msgNextBtn.enabled=!0,this.msgNextBtn.addEventListener("click",this.getNextCourse),this.msgResetBtn.enabled=!0,this.msgResetBtn.addEventListener("click",this.resetGame)}.bind(this)))}.bind(this))),this.panel.buttonContainer.getChildByName("star"+(app.obstaclesIndx+1)).gotoAndStop("star_filled"),b=0;5>b&&0!=i[b];b++)h++;5==h&&(app.config.COURSE["course"+this.courseIndx].completed||(app.showStar=!0,app.config.COURSE["course"+this.courseIndx].completed=!0)),WGBH.GameManager.getInstance().saveData(),this.showParty||(app.voPlayer.play("fdbk_"+app.feedbackAudioArr[app.feedbackAudioIndx]),app.feedbackAudioIndx++,app.feedbackAudioIndx>=app.feedbackAudioArr.length&&(app.feedbackAudioIndx=0))}},e.soundDone=function(){this.oriScale=this.panel.nextBtn.scaleX,this.partySnd.volume=1,createjs.Tween.get(this.panel.nextBtn).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime)},e.resetGame=function(a){if(createjs.Tween.removeAllTweens(),this.stateIndx=0,this.world_active=!0,this.panel.mgCourse.resetGame(),this.toggleMessagePanel(!1),a){app.jungleSFX&&(app.jungleSFX.stop(),app.jungleSFX=null),this.oriScale&&(this.msgResetBtn.scaleX=this.msgResetBtn.scaleY=this.oriScale,this.msgNextBtn.scaleX=this.msgNextBtn.scaleY=this.oriScale),app.voPlayer.stop(),app.sound.play("sfx_click"),this.panel.mgCourse.toggleGame(!0),this.bgSnd=app.sound.play("bg",{loop:!0});for(var b=0;b<this.buttonsArr.length;b++)this.buttonsArr[b].enabled=!0,this.buttonsArr[b].addEventListener("pressup",this.changeObstacle)}this.panel.editContainer.visible=!1},e.getNextCourse=function(a){app.sound.play("sfx_click"),this.world_active=!1,this.gameOver=!1,app.courseIndx=this.courseIndx,this.clearStage(),app.manager.state="map"},e.setupCourse=function(a){var b={sprite:"ball"+app.ballColor,shape:"circle",radius:this.ballRadius,x:a.ball.x,y:a.ball.y,group:2,fixedRotation:!0};this.panel.mgCourse.setup(b,!1),this.ball=this.panel.mgCourse.ball,this.panel.mgCourse.setupCourse(this.courseIndx,a)},e.getPrevBall=function(a){0==app.ballColor?app.ballColor=2:app.ballColor--,this.ball.changeObject(app.ballColor)},e.getNextBall=function(a){2==app.ballColor?app.ballColor=0:app.ballColor++,this.ball.changeObject(app.ballColor)},e.exitStart=function(){createjs.Tween.removeAllTweens(),this.bgSnd&&(this.bgSnd.stop(),this.bgSnd=null),this.partySnd&&(this.partySnd.stop(),this.partySnd=null),app.voPlayer.stop(),this.panel.mgCourse.stopGame(),this.panel.mgCourse.clearStage(),this.msgResetBtn.removeEventListener("click",this.resetGame),this.msgNextBtn.removeEventListener("click",this.getNextCourse),this.panel.homeBtn.removeEventListener("click",this.gotoMap),this.panel.msgContainer.getChildByName("bg").removeEventListener("click",this.gotThis),this.menuBg&&this.menuBg.removeEventListener("click",this.gotThis),this.ballNextArrow=null,this.ballPrevArrow=null,this.ball=null},namespace("WGBH").GameState=d}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.MakerPanel"),c=include("springroll.easeljs.Button"),d=include("WGBH.Obstacle_Windmill"),e=include("WGBH.Obstacle_CrabWalk"),f=include("WGBH.Obstacle_CrabWalkSide"),g=include("WGBH.Obstacle_Bumper"),h=include("WGBH.Obstacle_Diamond"),i=include("WGBH.Obstacle_Conveyor"),j=include("WGBH.Obstacle_Turtle"),k=include("WGBH.Obstacle_TurtleSide"),l=include("WGBH.Obstacle_Portal"),m=include("WGBH.Obstacle_Head"),n=include("WGBH.Obstacle_Bridge"),o=include("WGBH.Obstacle_Fruit"),p=include("WGBH.ObstacleIcon"),q=include("createjs.Container"),r=function(c){a.call(this,new b,c),this.setupCourse=this.setupCourse.bind(this),this.resetGame=this.resetGame.bind(this),this.clearStage=this.clearStage.bind(this),this.toggleMessagePanel=this.toggleMessagePanel.bind(this),this.toggleBuildTest=this.toggleBuildTest.bind(this),this.addTools=this.addTools.bind(this),this.startBallDrag=this.startBallDrag.bind(this),this.ballDrag=this.ballDrag.bind(this),this.stopBallDrag=this.stopBallDrag.bind(this),this.showGameMenu=this.showGameMenu.bind(this),this.gotoMap=this.gotoMap.bind(this),this.closeMenu=this.closeMenu.bind(this),this.createObstacle=this.createObstacle.bind(this),this.moveObstacle=this.moveObstacle.bind(this),this.releaseObstacle=this.releaseObstacle.bind(this),this.createLayoutButtons=this.createLayoutButtons.bind(this),this.selectCourse=this.selectCourse.bind(this),this.getNextBall=this.getNextBall.bind(this),this.getPrevBall=this.getPrevBall.bind(this),this.clearAll=this.clearAll.bind(this),this.getNewGame=this.getNewGame.bind(this),this.checkClearButton=this.checkClearButton.bind(this),this.resumeEditGame=this.resumeEditGame.bind(this),this.gotoClear=this.gotoClear.bind(this),this.chooseBallColor=this.chooseBallColor.bind(this),this.onUpdate=this.onUpdate.bind(this),this.soundDone=this.soundDone.bind(this),this.playInstrDone=this.playInstrDone.bind(this),this.playObstacleSound=this.playObstacleSound.bind(this)},s=extend(r,a);s.enterDone=function(){this.portalMax=8,this.portalCount=0,this.courseIndx=0,this.tileWidth=app.config.MAP.tileWidth,this.ballRadius=20,this.pulseTime=100,this.targetX=-1,this.targetY=-1,this.walkableSpotsArr=[],this.obstaclesArr=[],this.currentState="build",app.gameMode="make",this.totalCourses=Object.keys(app.config.COURSE).length,this.colorIndxArr=[];for(var a=0;a<app.portalColorArr.length;a++)this.colorIndxArr.push(a);this.panel.mgCourse.init("maker",this.toggleMessagePanel),this.checkGameScale(),this.createToolBar(),this.createMessagePanel(),this.createLayoutButtons(),this.createBallColorMenuPanel(),app.makerTutorial?(this.panel.playBtn.enabled=!1,this.panel.clearBtn.enabled=!1):(this.panel.playBtn.addEventListener("click",this.toggleBuildTest),this.panel.clearBtn.addEventListener("click",this.gotoClear),
this.panel.resetBtn.addEventListener("click",this.toggleBuildTest)),this.panel.homeBtn.addEventListener("click",this.gotoMap),this.msgResetBtn.addEventListener("click",this.resetGame),this.msgNewBtn.addEventListener("click",this.getNewGame),this.clearYesBtn.addEventListener("click",this.clearAll),this.clearNoBtn.addEventListener("click",this.resumeEditGame),this.checkClearButton(),app.firstMaker&&(app.firstMaker=!1,WGBH.GameManager.getInstance().saveData(),app.voPlayer.play("choose_green"))},s.createBallColorMenuPanel=function(){this.colorChoiceCont=new createjs.Container,this.panel.menuContainer.addChild(this.colorChoiceCont),this.menuBg=new createjs.Bitmap(images.selectBG),this.menuBg.x=-(.5*(app.config.scalingSize.maxWidth-app.config.scalingSize.width))-2,this.menuBg.y=-(.5*(app.config.scalingSize.maxHeight-app.config.scalingSize.height)),this.menuBg.addEventListener("click",this.gotThis),this.menuBg.name="menuBG",this.colorChoiceCont.addChild(this.menuBg);for(var a=100,b=450,d=0;3>d;d++){var e=new createjs.Sprite(app.SPRITE_SHEETS.game,"ball"+d+"_select");this.colorChoiceCont.addChild(e),e.gotoAndStop("ball"+d+"_select"),e.x=2==d?a-20:a-10,e.y=b-300,e.name="bug"+d;var f=new c(images.heartBtn);this.colorChoiceCont.addChild(f),f.x=2==d?a-10:a,f.y=b,f.indx=d,f.name="btn"+d,f.addEventListener("click",this.chooseBallColor),a+=340}},s.chooseBallColor=function(a){app.jungleSFX&&(app.jungleSFX.stop(),app.jungleSFX=null),app.sound.play("sfx_select"),app.ballColor=a.target.indx;for(var b=0;3>b;b++){var c=this.colorChoiceCont.getChildByName("btn"+b);c.enabled=!1,c.alpha=b==app.ballColor?1:.5,c.removeEventListener("click",this.chooseBallColor)}var d=this.colorChoiceCont.getChildByName("bug"+app.ballColor);d.gotoAndPlay("ball"+app.ballColor+"select"),app.sound.play("sfx_bug"),createjs.Tween.get(d).wait(1e3).call(function(){this.colorChoiceCont.visible=!1,this.ball&&this.ball.changeObject(app.ballColor),app.makerTutorial?(this.panel.mgCourse.toggleInteractivity(!1),app.makerTutorial=!1,WGBH.GameManager.getInstance().saveData(),app.voPlayer.stop(),this.tutIndx=1,app.voPlayer.play("maker_edit_mode-1",this.soundDone),this.arm=new createjs.Sprite(app.SPRITE_SHEETS.game,"tutorial_arm"),this.arm.scaleX=-1,this.arm.regX=820,this.arm.x=this.toolsArr[1].x+200,this.arm.y=this.toolsArr[1].y+80,this.arm.rotation=70,this.panel.tutorialContainer.addChild(this.arm),createjs.Tween.get(this.arm).to({y:this.arm.y-150},550),createjs.Tween.get(this.toolsArr[1]).wait(600).call(function(){app.sound.play("sfx_pick"),this.toolsArr[1].col=7,this.toolsArr[1].row=10,this.toolsArr[1].view.col=this.toolsArr[1].col,this.toolsArr[1].view.row=this.toolsArr[1].row,this.toolsArr[1].toggleHitArea(!0),this.toolsArr[1].updatePlacementChecker(!1),this.panel.toolsContainer.addChild(this.toolsArr[1])}.bind(this)).wait(1e3).call(function(){this.moveObs=!0,this.startPt={x:this.toolsArr[1].x,y:this.toolsArr[1].y};var a=4*(this.tileWidth*app.gameScale)+this.panel.msgContainer.x,b=7*(this.tileWidth*app.gameScale)+this.panel.msgContainer.y;this.targetPt={x:a,y:b},app.on("update",this.onUpdate)}.bind(this))):(this.bgSnd=app.sound.play("bg",{loop:!0}),this.bgSnd.volume=.3)}.bind(this))},s.soundDone=function(){if(this.tutIndx++,2==this.tutIndx)app.voPlayer.play("maker_edit_mode-2",this.soundDone),this.obs=this.panel.mgCourse.obstaclesArr[0],createjs.Tween.get(this.arm).to({x:this.arm.x-200,rotation:this.arm.rotation-10},100).wait(200).to({rotation:this.arm.rotation+10,x:this.arm.x},100).wait(1e3).to({rotation:this.arm.rotation-10,x:this.arm.x-200},100).wait(200).to({rotation:this.arm.rotation+10},100).to({x:this.arm.x+200,y:this.arm.y+450},300),createjs.Tween.get(this.obs).wait(100).call(function(){app.sound.play("sfx_pick"),this.obs.changeObject()}.bind(this)).wait(1400).call(function(){app.sound.play("sfx_pick"),this.obs.changeObject()}.bind(this));else if(3==this.tutIndx)app.voPlayer.play("maker_edit_mode-3",this.soundDone),this.oriScale=this.panel.playBtn.scaleX,createjs.Tween.get(this.panel.playBtn).wait(1e3).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime);else if(4==this.tutIndx)app.voPlayer.play("maker_edit_mode-4",this.soundDone),this.oriScale=this.panel.clearBtn.scaleX,createjs.Tween.get(this.panel.clearBtn).wait(300).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime);else{this.panel.playBtn.addEventListener("click",this.toggleBuildTest),this.panel.clearBtn.addEventListener("click",this.gotoClear);for(var a=0;a<this.toolsArr.length;a++)this.toolsArr[a].addEventListener("mousedown",this.createObstacle),this.toolsArr[a].addEventListener("pressmove",this.moveObstacle),this.toolsArr[a].addEventListener("pressup",this.releaseObstacle);this.panel.mgCourse.toggleInteractivity(!0),this.panel.playBtn.enabled=!0,this.panel.clearBtn.enabled=!0,this.bgSnd=app.sound.play("bg",{loop:!0}),this.bgSnd.volume=.3}},s.onUpdate=function(a){this.moveObs&&(this.startPt.x>this.targetPt.x?this.startPt.x-=1.3:this.startPt.x+=1.3,this.startPt.y>this.targetPt.y?this.startPt.y-=2:this.startPt.y+=2,this.moveObstacle({target:this.toolsArr[1],stageX:this.startPt.x,stageY:this.startPt.y}),this.arm.x=this.toolsArr[1].x+200,this.arm.y=this.toolsArr[1].y-60,this.toolsArr[1].canPlace&&(this.moveObs=!1,app.off("update",this.onUpdate),app.sound.play("sfx_drop"),this.releaseObstacle({target:this.toolsArr[1]}),createjs.Tween.get(this.arm).to({x:this.arm.x+200,rotation:this.arm.rotation+10},100),this.panel.clearBtn.enabled=!1))},s.resumeEditGame=function(a){app.sound.play("sfx_click"),this.panel.mgCourse.toggleGame(!1),this.clearMessageCont.visible=!1,app.voPlayer.stop()},s.clearAll=function(a){a&&(app.sound.play("sfx_click"),app.voPlayer.stop()),this.panel.mgCourse.clearObstacles(),this.clearMessageCont.visible=!1,this.checkClearButton(),this.toggleToolIcon("portal",!0),this.toggleToolIcon("fruit",!0),this.portalCount=0,this.colorIndxArr=[];for(var b=0;b<app.portalColorArr.length;b++)this.colorIndxArr.push(b)},s.createLayoutButtons=function(){var a=75,b=170,d=new createjs.Bitmap(images.selectGreenBG);d.x=-(.5*(app.config.scalingSize.maxWidth-app.config.scalingSize.width))-2,d.y=-(.5*(app.config.scalingSize.maxHeight-app.config.scalingSize.height)),this.panel.layoutContainer.addChild(d),d.name="bg",d.addEventListener("click",this.gotThis);var e=new createjs.Bitmap(images.bamboo);e.x=d.x,this.panel.layoutContainer.addChild(e);for(var f=[10,3,2,7],g=0;g<f.length;g++){var h=new c(images["layout"+f[g]+"Btn"]);this.panel.layoutContainer.addChild(h),h.x=a,h.y=b,h.name=f[g]-1,h.addEventListener("click",this.selectCourse),1==g?(a=75,b+=310):a+=500}},s.selectCourse=function(a){app.sound.play("sfx_select"),this.panel.layoutContainer.visible=!1,this.courseIndx=a.target.name,this.setupCourse(app.config.COURSE["course"+this.courseIndx]),app.firstMakerBug&&(app.firstMakerBug=!1,WGBH.GameManager.getInstance().saveData(),app.voPlayer.play("choose_ball"))},s.gotoClear=function(a){1==a.target.alpha&&(app.sound.play("sfx_click"),this.panel.msgContainer.addChild(this.clearMessageCont),this.clearMessageCont.visible=!0,app.firstDelete&&(app.firstDelete=!1,app.voPlayer.play("delete_check"),WGBH.GameManager.getInstance().saveData()))},s.closeMenu=function(a){this.panel.menuContainer.visible=!1},s.gotoMap=function(a){app.voPlayer.stop(),this.bgSnd&&(this.bgSnd.stop(),this.bgSnd=null),this.bgSnd=null,app.sound.play("sfx_click"),createjs.Tween.removeAllTweens(),app.off("update",this.onUpdate),app.manager.state="map"},s.showGameMenu=function(a){app.manager.state="map"},s.createToolBar=function(){this.editBgContainer=new q,this.playBgContainer=new q;var a=new createjs.Sprite(app.SPRITE_SHEETS.game,"bottom_UI_edit_bamboo");a.x=15.5,a.y=560,this.editBgContainer.addChild(a);var b=new createjs.Sprite(app.SPRITE_SHEETS.game,"bottom_UI_play_bamboo");b.x=15.5,b.y=615,this.playBgContainer.addChild(b),this.playBgContainer.visible=!1,this.panel.bgContainer.addChild(this.playBgContainer,this.editBgContainer),this.addTools()},s.createMessagePanel=function(){this.gameOverMessageCont=new q,this.panel.msgContainer.addChild(this.gameOverMessageCont);var a=new createjs.Bitmap(images.feedbackBG);a.x=app.BG_OFFSET,a.name="bg",a.addEventListener("click",this.gotThis),this.panel.msgContainer.mouseChildren=!0,this.msgResetBtn=new c(images.ReplayBtn),this.msgNewBtn=new c(images.NewBtn),this.gameOverMessageCont.addChild(a,this.msgNewBtn,this.msgResetBtn),this.fruitType=app.fruitNamesArr[0],this.fruitBG=new createjs.Sprite(app.SPRITE_SHEETS.game,this.fruitType+"_slots"),this.gameOverMessageCont.addChild(this.fruitBG),this.fruitBG.x=.5*app.STAGE_WIDTH-113,this.fruitBG.y=370;var b=this.fruitBG.x+15,d=this.fruitBG.y;this.msgFruitArr=[];for(var e=0;3>e;e++){var f=new createjs.Sprite(app.SPRITE_SHEETS.game,"feedback_"+this.fruitType);this.gameOverMessageCont.addChild(f),f.x=b,f.y=d,f.alpha=0,this.msgFruitArr.push(f),b+=87}this.clearMessageCont=new q,this.panel.msgContainer.addChild(this.clearMessageCont),a=new createjs.Shape,a.graphics.f("black").dr(0,0,app.config.scalingSize.maxWidth,app.config.scalingSize.maxHeight),this.clearMessageCont.addChild(a),a.name="bg",a.x=-(.5*(app.config.scalingSize.maxWidth-app.config.scalingSize.width)),a.y=-(.5*(app.config.scalingSize.maxHeight-app.config.scalingSize.height)),a.alpha=.7,a.addEventListener("click",this.gotThis),this.clearMessageCont.addChild(a);var g=new createjs.Shape;g.graphics.ss(1).s("black").f("white").rr(0,0,967,556,20),g.x=28.5,g.y=106,this.clearMessageCont.addChild(g);var h=new createjs.Text("Are you sure you want to delete everything?","62px nunitobold",app.FONT_COLOR);this.clearMessageCont.addChild(h),h.textAlign="center",h.x=.5*app.STAGE_WIDTH,h.y=200,h.lineWidth=700,h.lineHeight=70,h.name="msg",this.clearYesBtn=new c(images.YesBtn),this.clearNoBtn=new c(images.NoBtn),this.clearMessageCont.addChild(h,this.clearYesBtn,this.clearNoBtn),this.clearMessageCont.visible=!1,this.toggleMessagePanel(!1)},s.gotThis=function(){},s.addTools=function(){this.obstalceObjArr=[{name:"bumper",size:[1,1]},{name:"windmill",size:[3,3]},{name:"crabwalkside",size:[3,1]},{name:"conveyor",size:[2,2]},{name:"turtle",size:[4,3]},{name:"head",size:[3,3]},{name:"portal",size:[1,2]},{name:"stick",size:[1,1]},{name:"diamond",size:[1,1]},{name:"crabwalk",size:[1,3]},{name:"conveyor2",size:[2,2]},{name:"turtle2",size:[3,4]},{name:"bridge",size:[3,3]},{name:"fruit",size:[1,1]}],this.toolsArr=[];var a=415,b=654;this.iconsContainer=new q,this.panel.toolsContainer.addChild(this.iconsContainer);var c=new createjs.Text("Obstacles","24px nunitobold",app.FONT_COLOR);this.panel.toolsContainer.addChild(c),c.x=605,c.y=595,c.textBaseline="middle";for(var d=0;d<this.obstalceObjArr.length;d++)this.obs=new p(this.obstalceObjArr[d].name,this.obstalceObjArr[d].size[0],this.obstalceObjArr[d].size[1]),this.panel.toolsContainer.addChild(this.obs),this.obs.setPosition({x:a,y:b}),this.obs.name=this.obstalceObjArr[d].name,this.obs.type="icon",app.makerTutorial||(this.obs.addEventListener("mousedown",this.createObstacle),this.obs.addEventListener("pressmove",this.moveObstacle),this.obs.addEventListener("pressup",this.releaseObstacle)),this.toolsArr.push(this.obs),6==d?(a=415,b+=70):a+=81;this.checkGameScale()},s.createObstacle=function(a){1==a.target.alpha&&(app.sound.play("sfx_pick"),this.checkGameScale(),this.updateLocation(a),a.target.view.col=a.target.col,a.target.view.row=a.target.row,a.target.toggleHitArea(!0),a.target.updatePlacementChecker(!1),"hole"==a.target.name?(a.target.addToView(null,!0),this.startBallDrag(a,a.target)):"fruit"==a.target.name?(a.target.obsImg.gotoAndStop("fruit_"+app.fruitNamesArr[this.panel.mgCourse.fruitIndx]),this.panel.toolsContainer.addChild(a.target)):this.panel.toolsContainer.addChild(a.target))},s.moveObstacle=function(a){if(1==a.target.alpha){this.updateLocation(a),a.target.view.col=a.target.col,a.target.view.row=a.target.row;var b=a.target.col*this.tileWidth+this.panel.mgCourse.board.x+.5*this.tileWidth,c=a.target.row*this.tileWidth+this.panel.mgCourse.board.y+.5*this.tileWidth;a.target.x=b,a.target.y=c;var d=this.checkOpenSpots(a.target);a.target.togglePlacementArea(d)}},s.releaseObstacle=function(a){if(1==a.target.alpha&&a.target.canPlace){var b=this.panel.mgCourse.mapTiles["t_"+a.target.row+"_"+a.target.col].empty;if("hole"!=a.target.name&&a.target.toggleHitArea(!1),!b){app.sound.play("sfx_drop");var c=null;if("bumper"==a.target.name)c=new g({color:"orange",shape:"circle",radius:30,x:a.target.x,y:a.target.y,fixedRotation:!0,type:"static"},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("stick"==a.target.name)c=new g({color:"blue",shape:"block",radius:30,x:a.target.x,y:a.target.y,fixedRotation:!0,type:"static"},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("windmill"==a.target.name)c=new d({x:a.target.x,y:a.target.y,width:60,height:60,blade:1},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0),this.panel.mgCourse.showSelected(c);else if("crabwalk"==a.target.name)c=new e({x:a.target.x,y:a.target.y,crab:1},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("crabwalkside"==a.target.name)c=new f({x:a.target.x,y:a.target.y,crab:1},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("diamond"==a.target.name)c=new h({x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("conveyor"==a.target.name)c=new i({x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("conveyor2"==a.target.name)c=new i({x:a.target.x,y:a.target.y,arrow:[!0,!1,!0,!0],limit:3},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("turtle"==a.target.name)c=new k({color:"#660033",shape:"circle",radius:30,x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("turtle2"==a.target.name)c=new j({color:"#660033",shape:"circle",radius:30,x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("portal"==a.target.name){if(this.portalCount<this.portalMax){c=new l({color:app.portalColorArr[this.colorIndxArr[0]],shape:"block",x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);var p=new l({color:app.portalColorArr[this.colorIndxArr[0]],shape:"block",x:a.target.x,y:a.target.y+60},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag);this.panel.mgCourse.addItem(p,!0),p.view.name="obstacle",p.type=a.target.name,p.view.col=a.target.col,p.view.row=a.target.row+1,c.colorIndx=this.colorIndxArr[0],p.colorIndx=this.colorIndxArr[0];this.colorIndxArr.shift();c.pairedPortal=p,p.pairedPortal=c,this.stopBallDrag(a,p),this.portalCount++,this.portalCount==this.portalMax&&this.toggleToolIcon("portal",!1),p.addSoundFunction(this.playObstacleSound)}}else if("head"==a.target.name)c=new m({size:"big",x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("bridge"==a.target.name)c=new n({x:a.target.x,y:a.target.y},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addItem(c,!0);else if("fruit"==a.target.name){var q=this.panel.mgCourse.fruitIndx;c=new o({x:a.target.x,y:a.target.y,fruit:q},!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.panel.mgCourse.addFruit(c),3==this.panel.mgCourse.fruitsArr.length&&this.toggleToolIcon("fruit",!1)}null!=c&&(c.view.name="obstacle",c.type=a.target.name,c.view.col=a.target.col,c.view.row=a.target.row,this.stopBallDrag(a,c),c.addSoundFunction(this.playObstacleSound))}"hole"!=a.target.name?(a.target.x=a.target.initX,a.target.y=a.target.initY):(a.target.addToView(null,!1),this.stopBallDrag(a,a.target)),this.checkClearButton()}else"hole"!=a.target.name?(a.target.toggleHitArea(!1),a.target.x=a.target.initX,a.target.y=a.target.initY,app.sound.play("sfx_back")):this.stopBallDrag(a,a.target),this.checkClearButton()},s.playObstacleSound=function(a,b){this.gameOverMessageCont.visible||this.panel.mgCourse.playObstacleSound(a,b)},s.checkGameScale=function(){app.gameScale=app.realHeight/app.config.scalingSize.height},s.startBallDrag=function(a,b){this.checkGameScale(),"build"==this.currentState&&(app.sound.play("sfx_pick"),this.markThisTile(b.view.row,b.view.col,!0),this.unMarkOpenSpots(b),this.panel.editContainer.visible=!1)},s.ballDrag=function(a,b){this.updateLocation(a);var c=b.view.col*this.tileWidth+this.panel.mgCourse.board.x+.5*this.tileWidth,d=b.view.row*this.tileWidth+this.panel.mgCourse.board.y+.5*this.tileWidth;b.setPosition({x:c,y:d});var e=this.checkOpenSpots(b);b.updatePlacementChecker(e)},s.stopBallDrag=function(a,b){var c,d;b.moved&&this.updateLocation(a),this.mapTiles=this.panel.mgCourse.mapTiles;var e=this.mapTiles["t_"+b.view.row+"_"+b.view.col].walkable,f=this.mapTiles["t_"+b.view.row+"_"+b.view.col].open,g=this.mapTiles["t_"+b.view.row+"_"+b.view.col].empty;f=this.checkOpenSpots(b);g?(app.sound.play("sfx_back"),"obstacle"==b.view.name?("portal"==b.type?(this.colorIndxArr.push(b.colorIndx),this.markThisTile(b.pairedPortal.view.row,b.pairedPortal.view.col,!0),this.panel.mgCourse.removeItem(b.pairedPortal),this.portalCount--,this.toggleToolIcon("portal",!0)):"fruit"==b.type&&this.toggleToolIcon("fruit",!0),this.panel.mgCourse.removeItem(b)):"hole"==b.view.name||"ball"==b.view.name?(b.setPosition({x:b.view.startX,y:b.view.startY}),d=(b.view.startX-this.panel.mgCourse.board.x-.5*this.tileWidth)/this.tileWidth,c=(b.view.startY-this.panel.mgCourse.board.y-.5*this.tileWidth)/this.tileWidth,b.view.col=d,b.view.row=c,b.updatePlacementChecker(!0),this.markThisTile(b.view.row,b.view.col,!1)):b.setPosition({x:b.view.startX,y:b.view.startY})):e&&f?(b.moved&&app.sound.play("sfx_drop"),this.markThisTile(b.view.row,b.view.col,!1),this.markOpenSpots(b),"obstacle"==b.view.name?(b.setInitPosition({x:b.view.x,y:b.view.y}),this.panel.mgCourse.showSelected(b)):"hole"==b.view.name?(b.view.startX=b.x,b.view.startY=b.y):"ball"==b.view.name&&(b.view.startX=b.view.x,b.view.startY=b.view.y,b.ball.view.startX=b.view.x,b.ball.view.startY=b.view.y)):(app.sound.play("sfx_back"),"obstacle"==b.view.name?("portal"==b.type?(this.colorIndxArr.push(b.colorIndx),this.markThisTile(b.pairedPortal.view.row,b.pairedPortal.view.col,!0),this.panel.mgCourse.removeItem(b.pairedPortal),this.portalCount--,this.toggleToolIcon("portal",!0)):"fruit"==b.type&&this.toggleToolIcon("fruit",!0),this.panel.mgCourse.removeItem(b)):(b.setPosition({x:b.view.startX,y:b.view.startY}),d=(b.view.startX-this.panel.mgCourse.board.x-.5*this.tileWidth)/this.tileWidth,c=(b.view.startY-this.panel.mgCourse.board.y-.5*this.tileWidth)/this.tileWidth,b.view.col=d,b.view.row=c,b.updatePlacementChecker(!0),this.markThisTile(b.view.row,b.view.col,!1))),this.panel.editContainer.visible=!0,this.checkClearButton()},s.toggleToolIcon=function(a,b){for(var c=0;c<this.toolsArr.length;c++)this.toolsArr[c].name==a&&(this.toolsArr[c].alpha=b?1:.2)},s.markThisTile=function(a,b,c){this.panel.mgCourse.markThisTile("t_"+a+"_"+b,c)},s.checkOpenSpots=function(a){var b,c,d=0,e=0;if(this.mapTiles=this.panel.mgCourse.mapTiles,0==d&&0==e){if(b=this.mapTiles["t_"+a.view.row+"_"+a.view.col].open,c=this.mapTiles["t_"+a.view.row+"_"+a.view.col].walkable,!b||!c)return!1;if(1==a.sizeGridCol&&1==a.sizeGridRow)return!0}a.sizeGridCol>1&&(d=.5*(a.sizeGridCol-1),d=a.view.col-Math.floor(d)),a.sizeGridRow>1&&(e=.5*(a.sizeGridRow-1),e=a.view.row-Math.floor(e)),0==d&&(d=a.view.col),0==e&&(e=a.view.row),(2==a.sizeGridCol&&2==a.sizeGridRow||3==a.sizeGridCol&&4==a.sizeGridRow||4==a.sizeGridCol&&3==a.sizeGridRow)&&(d=a.view.col,e=a.view.row);for(var f=0;f<a.sizeGridCol;f++)for(var g=0;g<a.sizeGridRow;g++)if(b=this.mapTiles["t_"+(e+g)+"_"+(d+f)].open,c=this.mapTiles["t_"+(e+g)+"_"+(d+f)].walkable,!b||!c)return!1;return!0},s.markOpenSpots=function(a){var b=0,c=0;if(this.markThisTile(a.view.row,a.view.col,!1),a.sizeGridCol>1&&(b=.5*(a.sizeGridCol-1),b=a.view.col-b),a.sizeGridRow>1&&(c=.5*(a.sizeGridRow-1),c=a.view.row-c),(2==a.sizeGridCol&&2==a.sizeGridRow||3==a.sizeGridCol&&4==a.sizeGridRow||4==a.sizeGridCol&&3==a.sizeGridRow||1==a.sizeGridCol&&3==a.sizeGridRow)&&(b=a.view.col,c=a.view.row,1==a.sizeGridCol&&3==a.sizeGridRow&&c--),0!=b&&0!=c)for(var d=0;d<a.sizeGridCol;d++)for(var e=0;e<a.sizeGridRow;e++)this.markThisTile(c+e,b+d,!1)},s.unMarkOpenSpots=function(a){this.markThisTile(a.view.row,a.view.col,!0);var b=0,c=0;a.sizeGridCol>1&&(b=.5*(a.sizeGridCol-1),b=a.view.col-b),a.sizeGridRow>1&&(c=.5*(a.sizeGridRow-1),c=a.view.row-c),(2==a.sizeGridCol&&2==a.sizeGridRow||3==a.sizeGridCol&&4==a.sizeGridRow||4==a.sizeGridCol&&3==a.sizeGridRow||1==a.sizeGridCol&&3==a.sizeGridRow)&&(b=a.view.col,c=a.view.row,1==a.sizeGridCol&&3==a.sizeGridRow&&c--);for(var d=0;d<a.sizeGridCol;d++)for(var e=0;e<a.sizeGridRow;e++)this.markThisTile(c+e,b+d,!0)},s.toggleBuildTest=function(a){this.currentState="build"==this.currentState?"test":"build","build"==this.currentState?(a&&(app.sound.stopAll(),this.bgSnd=null,app.sound.play("sfx_click"),this.bgSnd?this.bgSnd.volume=1:this.bgSnd=app.sound.play("bg",{loop:!0,volume:.3})),this.playBgContainer.visible=!1,this.checkClearButton(),this.panel.clearBtn.visible=!0,this.editBgContainer.visible=!0,this.panel.editContainer.visible=!0,this.panel.toolsContainer.visible=!0,this.world_active=!1,this.gameOver=!1,this.panel.mgCourse.toggleGame(!1),this.panel.mgCourse.resetGame(),this.panel.mgCourse.flag.visible=!1,this.panel.playBtn.visible=!0,this.panel.resetBtn.visible=!1):(app.sound.play("sfx_click"),this.playBgContainer.visible=!0,this.panel.clearBtn.visible=!1,this.editBgContainer.visible=!1,this.panel.editContainer.visible=!1,this.panel.toolsContainer.visible=!1,this.panel.mgCourse.toggleGame(!0),this.ball.setInitPosition({x:this.ball.view.x,y:this.ball.view.y}),this.panel.playBtn.visible=!1,this.panel.resetBtn.visible=!0,app.firstMakerPlay?(app.firstMakerPlay=!1,WGBH.GameManager.getInstance().saveData(),app.voPlayer.play("maker_play_mode",this.playInstrDone),this.panel.resetBtn.enabled=!1,this.panel.resetBtn.removeEventListener("click",this.toggleBuildTest),this.panel.mgCourse.toggleInteractivity(!1),this.oriScale=this.panel.resetBtn.scaleX,createjs.Tween.get(this.panel.resetBtn).wait(1e3).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime)):a&&(this.bgSnd?this.bgSnd.volume=1:this.bgSnd=app.sound.play("bg",{loop:!0,volume:1})))},s.playInstrDone=function(){this.panel.resetBtn.enabled=!0,this.panel.resetBtn.addEventListener("click",this.toggleBuildTest),this.panel.mgCourse.toggleInteractivity(!0),this.bgSnd&&(this.bgSnd.volume=1)},s.checkClearButton=function(){this.panel.clearBtn.alpha=0==this.panel.mgCourse.obstaclesArr.length&&0==this.panel.mgCourse.fruitsArr.length?.2:1,this.panel.clearBtn.enabled=1==this.panel.clearBtn.alpha?!0:!1},s.updateLocation=function(a){var b=(a.stageX-this.panel.msgContainer.x)/(this.tileWidth*app.gameScale),c=(a.stageY-this.panel.msgContainer.y)/(this.tileWidth*app.gameScale);a.target.col=Math.round(b)-1,a.target.row=Math.round(c)-1,a.target.col=a.target.col>this.panel.mgCourse.mapWidth-1?this.panel.mgCourse.mapWidth-1:a.target.col,a.target.col=a.target.col<0?0:a.target.col,a.target.row=a.target.row>this.panel.mgCourse.mapHeight-1?this.panel.mgCourse.mapHeight-1:a.target.row,a.target.row=a.target.row<0?0:a.target.row},s.clearStage=function(){this.panel.mgCourse.clearStage()},s.toggleMessagePanel=function(a){if(this.panel.addChild(this.msgContainer),this.panel.msgContainer.addChild(this.gameOverMessageCont),this.gameOverMessageCont.visible=a,this.msgResetBtn.x=.5*app.STAGE_WIDTH-143,this.msgNewBtn.x=.5*app.STAGE_WIDTH+70,this.clearYesBtn.x=.5*app.STAGE_WIDTH-219,this.clearNoBtn.x=.5*app.STAGE_WIDTH+40,this.msgNewBtn.y=520,this.msgResetBtn.y=520,this.clearNoBtn.y=this.clearYesBtn.y=430,a){app.sound.stopAll(),this.bgSnd=null,app.jungleSFX=app.sound.play("jungle_bg",{loop:!0,volume:app.JUNGLE_VOL});var b=0==this.panel.mgCourse.fruitsArr.length?!1:!0;b?(this.msgNewBtn.y=520,this.msgResetBtn.y=520):(this.msgNewBtn.y=450,this.msgResetBtn.y=450),this.fruitBG.visible=b,this.fruitType=app.fruitNamesArr[this.panel.mgCourse.fruitIndx],this.fruitBG.gotoAndStop(this.fruitType+"_slots");for(var c=0;c<this.msgFruitArr.length;c++)this.msgFruitArr[c].gotoAndStop("feedback_"+this.fruitType),this.msgFruitArr[c].visible=b,this.msgFruitArr[c].alpha=c<this.panel.mgCourse.fruitCount?1:0;app.voPlayer.play("fdbk_"+app.feedbackAudioArr[app.feedbackAudioIndx]),app.feedbackAudioIndx++,app.feedbackAudioIndx>=app.feedbackAudioArr.length&&(app.feedbackAudioIndx=0)}},s.resetGame=function(a){a&&(app.jungleSFX&&(app.jungleSFX.stop(),app.jungleSFX=null),this.bgSnd=app.sound.play("bg",{loop:!0}),this.bgSnd.volume=.3,app.sound.play("sfx_click")),this.clearMessageCont.visible=!1,this.world_active=!1,this.panel.mgCourse.resetGame(),this.toggleMessagePanel(!1),this.panel.menuContainer.visible=!1,this.currentState="test",this.toggleBuildTest(),this.panel.mgCourse.toggleGame(!1)},s.getNewGame=function(a){this.resetGame(),this.clearStage(),this.clearAll(),a&&app.sound.play("sfx_click"),this.panel.layoutContainer.visible=!0;for(var b=0;3>b;b++){var c=this.colorChoiceCont.getChildByName("btn"+b);c.enabled=!0,c.alpha=1,c.addEventListener("click",this.chooseBallColor),c=this.colorChoiceCont.getChildByName("bug"+b),c.gotoAndStop("ball"+b+"_select")}this.colorChoiceCont.visible=!0,this.panel.menuContainer.visible=!0},s.setupCourse=function(a){var b={sprite:"ball"+app.ballColor,shape:"circle",name:"ball",radius:this.ballRadius,x:a.ball.x,y:a.ball.y,group:2,fixedRotation:!0};this.panel.mgCourse.setup(b,!0,this.startBallDrag,this.ballDrag,this.stopBallDrag),this.ball=this.panel.mgCourse.ball,this.panel.mgCourse.setupCourse(this.courseIndx,a,"maker"),this.hole=this.panel.mgCourse.hole,this.hole.addEventListener("mousedown",this.createObstacle),this.hole.addEventListener("pressmove",this.moveObstacle),this.hole.addEventListener("pressup",this.releaseObstacle)},s.getPrevBall=function(a){0==app.ballColor?app.ballColor=2:app.ballColor--,this.ball.changeObject(app.ballColor)},s.getNextBall=function(a){2==app.ballColor?app.ballColor=0:app.ballColor++,this.ball.changeObject(app.ballColor)},s.exitStart=function(){this.bgSnd&&(this.bgSnd.stop(),this.bgSnd=null),app.jungleSFX=null,this.panel.mgCourse.stopGame(),this.panel.mgCourse.clearStage(),this.panel.playBtn.removeEventListener("click",this.toggleBuildTest),this.panel.resetBtn.removeEventListener("click",this.toggleBuildTest),this.panel.homeBtn.removeEventListener("click",this.gotoMap),this.msgResetBtn.removeEventListener("click",this.resetGame),this.msgNewBtn.addEventListener("click",this.getNewGame),this.panel.resetBtn.removeEventListener("click",this.resetGame),this.menuBg.removeEventListener("click",this.closeMenu),this.gameOverMessageCont.getChildByName("bg").removeEventListener("click",this.gotThis),this.clearMessageCont.getChildByName("bg").removeEventListener("click",this.gotThis),this.panel.layoutContainer.getChildByName("bg").removeEventListener("click",this.gotThis),this.clearYesBtn.removeEventListener("click",this.clearAll),this.clearNoBtn.removeEventListener("click",this.resumeEditGame),this.panel.clearBtn.removeEventListener("click",this.gotoClear),this.ballPrevArrow=null,this.ballNextArrow=null},namespace("WGBH").MakerState=r}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.MapPanel"),c=function(c){a.call(this,new b,c)},d=extend(c,a);d.enterDone=function(){this.onPlay=this.onPlay.bind(this),null==app.jungleSFX&&(app.jungleSFX=app.sound.play("jungle_bg",{loop:!0,volume:app.JUNGLE_VOL}));for(var a=0;a<this.panel.levelsBtnArr.length;a++){var b=app.config.COURSE["course"+a].unlock;b&&(this.panel.levelsBtnArr[a].addEventListener("click",this.onPlay),this.panel.levelsBtnArr[a].addEventListener("rollover",this.onOver),this.panel.levelsBtnArr[a].addEventListener("rollout",this.onOut),this.panel.levelsBtnArr[a].addEventListener("mousedown",this.onDown),this.panel.levelsBtnArr[a].addEventListener("pressup",this.onOut))}if(this.panel.makerButton.addEventListener("rollover",this.onOver),this.panel.makerButton.addEventListener("rollout",this.onOut),this.panel.makerButton.addEventListener("mousedown",this.onDown),this.panel.makerButton.addEventListener("click",this.onMaker),this.panel.makerButton.addEventListener("pressup",this.onOut),app.firstMap){app.firstMap=!1,app.voPlayer.play("menu_page");var c=500;createjs.Tween.get(this.panel.levelsBtnArr[0]).wait(1500).to({scaleX:1.1,scaleY:1.1},c).to({scaleX:.8,scaleY:.8},c).to({scaleX:1.1,scaleY:1.1},c).to({scaleX:.8,scaleY:.8},c).to({scaleX:1.1,scaleY:1.1},c).to({scaleX:.8,scaleY:.8},c).to({scaleX:1,scaleY:1},c),createjs.Tween.get(this.panel.makerButton).wait(6e3).to({scaleX:1.1,scaleY:1.1},c).to({scaleX:.8,scaleY:.8},c).to({scaleX:1.1,scaleY:1.1},c).to({scaleX:.8,scaleY:.8},c).to({scaleX:1.1,scaleY:1.1},c).to({scaleX:.8,scaleY:.8},c).to({scaleX:1,scaleY:1},c)}},d.onDown=function(a){var b=a.target.getChildByName("flag");b.gotoAndStop("maker"==a.target.name?"maker_flag_down":"blank_flag_down")},d.onOver=function(a){var b=a.target.getChildByName("flag");b.gotoAndStop("maker"==a.target.name?"maker_flag_over":"blank_flag_over")},d.onOut=function(a){var b=a.target.getChildByName("flag");b.gotoAndStop("maker"==a.target.name?"maker_flag_up":"blank_flag_up")},d.onPlay=function(a){var b=a.target.getChildByName("flag");b.gotoAndStop("maker"==a.target.name?"maker_flag_up":"blank_flag_up");var c=app.config.COURSE["course"+a.target.level],d=!1;c&&(d=app.config.COURSE["course"+a.target.level].unlock),d&&(app.jungleSFX.stop(),app.jungleSFX=null,app.voPlayer.stop(),app.sound.play("sfx_click"),app.courseIndx=a.target.level,app.manager.state="game")},d.onMaker=function(a){var b=a.target.getChildByName("flag");b.gotoAndStop("maker"==a.target.name?"maker_flag_up":"blank_flag_up"),app.voPlayer.stop(),app.sound.play("sfx_click"),app.manager.state="maker"},d.exit=function(){createjs.Tween.removeAllTweens(),this.panel.flagSFX&&this.panel.flagSFX.stop();for(var a=0;a<this.panel.levelsBtnArr.length;a++)this.panel.levelsBtnArr[a].removeEventListener("click",this.onPlay),
this.panel.levelsBtnArr[a].removeEventListener("rollover",this.onOver),this.panel.levelsBtnArr[a].removeEventListener("rollout",this.onOut),this.panel.levelsBtnArr[a].removeEventListener("pressup",this.onOut),this.panel.levelsBtnArr[a].removeEventListener("mousedown",this.onDown);this.panel.makerButton.removeEventListener("rollover",this.onOver),this.panel.makerButton.removeEventListener("rollout",this.onOut),this.panel.makerButton.removeEventListener("pressup",this.onOut),this.panel.makerButton.removeEventListener("mousedown",this.onDown),this.panel.makerButton.removeEventListener("click",this.onMaker)},namespace("WGBH").MapState=c}(),function(){var a=include("springroll.easeljs.BaseState"),b=include("WGBH.TitlePanel"),c=function(c){a.call(this,new b,c)},d=extend(c,a);d.enterDone=function(){WGBH.GameManager.getInstance().initialize(),this.onPlay=this.onPlay.bind(this),this.soundDone=this.soundDone.bind(this),this.panel.playButton.addEventListener("click",this.onPlay),this.panel.nextButton.addEventListener("click",this.onPlay2)},d.onPlay=function(){app.sound.play("sfx_click"),this.panel.bgImg.image=images.SetupBackground,this.panel.bgImg.y=0,this.panel.bgImg.x=app.BG_OFFSET,this.panel.removeChild(this.panel.playButton),this.panel.playButton.removeEventListener("click",this.onPlay),this.panel.nextButton.visible=!0,app.voPlayer.play("setup_screen",this.soundDone),null==app.jungleSFX&&(app.jungleSFX=app.sound.play("jungle_bg",{loop:!0,volume:app.JUNGLE_VOL}))},d.soundDone=function(){this.oriScale=this.panel.playButton.scaleX,this.pulseTime=200,createjs.Tween.get(this.panel.nextButton).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:1.1*this.oriScale,scaleY:1.1*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime).wait(100).to({scaleX:.8*this.oriScale,scaleY:.8*this.oriScale},this.pulseTime).wait(100).to({scaleX:this.oriScale,scaleY:this.oriScale},this.pulseTime)},d.onPlay2=function(){app.voPlayer.stop(),app.sound.stop(),app.sound.play("sfx_click"),app.manager.state="map"},d.exit=function(){this.panel.playButton.removeEventListener("click",this.onPlay2)},namespace("WGBH").TitleState=c}(),function(){var a=include("WGBH.TitleState"),b=include("WGBH.MapState"),c=include("WGBH.GameState"),d=include("WGBH.MakerState"),e=include("springroll.Application"),f=include("lib.Transition"),g=include("springroll.easeljs.EaselJSDisplay"),h=include("WGBH.Box2DPhysics_Main"),i=function(a,b){for(var c=.1,d=["purple_crab","orange_crab","blue_crab","turtle","turtle_green","ball0_select","ball1_select","ball2_select","party1","party2","party3"],e=0;e<d.length;e++)a.animations[d[e]]&&(a.animations[d[e]].speed=c),("ball0_select"==d[e]||"ball1_select"==d[e]||"ball2_select"==d[e])&&(a.animations[d[e]].next=!1);j.SPRITE_SHEETS[b.id]=new createjs.SpriteSheet(a)},j=new e({fps:60,name:"arthur_minigolf",state:"title",canvasId:"stage",configPath:"assets/config/config.json",manifestsPath:"assets/config/manifests.json",captionsPath:"assets/config/captions.json",transition:new f,debug:!0,minLogLevel:0,display:g,displayOptions:{clearView:!0},preload:[{id:"game",src:"assets/images/spritesheets/game_sprites.json",complete:i}]});j.SPRITE_SHEETS=[],j.on("init",function(){var e=this.config.assets,f=this.config.scaling;this.manifests;this.physics_debug_qa=!1,this.STEP_TIME=1/60,this.STAGE_WIDTH=988,this.STAGE_HEIGHT=556,this.gameScale=j.realHeight/j.config.scalingSize.height,this.courseIndx=0,this.obstaclesIndx=1,this.firstTime=!0,this.ballColor=0,this.BallGroupIndex=-3,this.CollideGroupIndex=3,this.gameMode="",this.BG_OFFSET=-(.5*(j.config.scalingSize.maxWidth-j.config.scalingSize.width)),this.FONT_COLOR="#00a8ff",this.PLACE_COLOR="yellow",this.NO_PLACE_COLOR="magenta",this.HIT_ALPHA=.5,this.ILLEGAL_ALPHA=.4,this.firstFdbk=!0,this.firstMap=!0,this.firstBug=!0,this.firstMaker=!0,this.firstMakerBug=!0,this.firstHole=!0,this.firstDelete=!0,this.makerTutorial=!0,this.firstMakerPlay=!0,this.GAME_DONE=!1,this.showStar=!1,this.jungleSFX=null,this.JUNGLE_VOL=.2,this.portalColorArr=["red","blue","green","orange","pink","purple","sky","yellow"],this.fruitNamesArr=["orange","watermelon","dragon"],this.feedbackAudioArr=["yay","awesome","nice"],this.feedbackAudioIndx=0,this.levelsArr=[],this.initEaselDisplays(),this.box2D=new h,this.states={title:new a({next:"map",preload:e.title,scaling:f.title}),map:new b({next:"game",preload:e.map,scaling:f.map}),game:new c({next:"title",previous:"title",preload:e.game,scaling:f.game}),maker:new d({next:"title",previous:"title",preload:e.maker,scaling:f.maker})}}),j.initEaselDisplays=function(){this.debug_display=j.addDisplay("debug-stage",g),this.debug_display.visible=!1},window.app=j}();