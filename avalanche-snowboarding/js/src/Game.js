AvalancheSnowboarding.Game=function(game){};AvalancheSnowboarding.Game.prototype={create:function(){AvalancheSnowboarding.Model.reset();this.isFirstUpdate=true;this.background=new AvalancheSnowboarding.Background(this.game);this.slope=new AvalancheSnowboarding.Slope(this.game,this);var levelData=this.game.cache.getJSON('levels');var levelEndData=levelData.objects[levelData.objects.length-1];if(levelEndData.type!='end')
console.error('Last object in json file should be with type=end');var distanceTotal=Number(levelEndData.x);this.player=new AvalancheSnowboarding.PlayerObject();this.player.init({game:this.game,type:'player',name:'player',rotation:0,x:280,y:207,layer:this.slope,gameScene:this,distanceTotal:distanceTotal,});this.hud=new AvalancheSnowboarding.HUD(this.game);if(this.game.device.desktop){this.leftKey=this.game.input.keyboard.addKey(Phaser.Keyboard.DOWN);this.rightKey=this.game.input.keyboard.addKey(Phaser.Keyboard.UP);}else{}
this.audioMusic=this.game.add.audio("music");this.audioMusic.loop=true;},start:function(){this.resume();this.player.run();this.audioMusic.play();},pause:function(){AvalancheSnowboarding.Model.isPaused=true;},resume:function(){AvalancheSnowboarding.Model.isPaused=false;},update:function(){if(this.isFirstUpdate){this.isFirstUpdate=false;this.pause();this.hud.startCountdown(this.start,this);}
if(!AvalancheSnowboarding.Model.isPaused){if(this.game.device.desktop){if(this.leftKey.isDown){this.player.shiftLeft();}
if(this.rightKey.isDown){this.player.shiftRight();}}else if(this.input.activePointer.isDown){var yDelta=this.game.input.activePointer.position.y-this.game.input.activePointer.positionDown.y;if(yDelta>0){this.player.shiftLeft();}else if(yDelta<0){this.player.shiftRight();}}
this.player.move();var distance=this.player.distance;var distanceTotal=this.player.distanceTotal;var speed=this.player.speed;this.background.move(speed);this.slope.move(speed,distance,distanceTotal);this.hud.updateLocator(distance,distanceTotal);}},render:function(){return;this.game.debug.body(this.player.view);for(var i=0;i<this.slope.allObjects.length;i++)
this.game.debug.body(this.slope.allObjects[i].view);},destroy:function(){if(this.audioMusic!=null){this.audioMusic.stop();this.audioMusic=null;}},gotoWin:function(){this.destroy();this.game.state.start('Win');},gotoLose:function(){this.destroy();this.game.state.start('Lose');},};