!function(a,b,c,d,e,f,g){"use strict";function h(){var a=255*(.5+.5*Math.random()),b=255*(.5+.5*Math.random()),c=255*(.5+.5*Math.random());return a<<16|b<<8|c}function i(a,b){var c=b.gravity,d=b.backboard.position.y,e=a.getLinearVelocity().lengthSquared(),f=a.getPosition().y;return c*(f-d)+.5*e}function j(a,b){var c=b.bounds,d=c.left,e=c.right,f=c.top,g=a.getPosition(),h=g.x,i=g.y;return h>d&&e>h&&f>i}function k(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function l(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}function m(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function n(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}function o(a){if(a.angleSnap&&(a.angleSnap*=Math.PI/180),a.armRotation&&(a.armRotation*=Math.PI/180),a.ball&&a.ball.angleSnap&&(a.ball.angleSnap*=Math.PI/180),a.ball&&a.ball.initialThrowAngle&&(a.ball.initialThrowAngle*=Math.PI/180),a.ball&&a.ball.throwAngleBounds&&(a.ball.throwAngleBounds[0]*=Math.PI/180,a.ball.throwAngleBounds[1]*=Math.PI/180),a.helper&&a.helper.initialAngle&&(a.helper.initialAngle*=Math.PI/180),a.obstacle&&a.obstacle.rotation&&(a.obstacle.rotation*=Math.PI/180),a.helpers){var b=!0,c=!1,d=void 0;try{for(var e,f=a.helpers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.initialAngle&&(g.initialAngle*=Math.PI/180)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}}if(a.obstacles){var i=!0,j=!1,k=void 0;try{for(var l,m=a.obstacles[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;n.rotation&&(n.rotation*=Math.PI/180)}}catch(h){j=!0,k=h}finally{try{!i&&m["return"]&&m["return"]()}finally{if(j)throw k}}}a.hints&&a.hints.throwAngleRange&&(a.hints.throwAngleRange[0]*=Math.PI/180,a.hints.throwAngleRange[1]*=Math.PI/180),a.ball&&a.ball.circumference&&(a.ball.diameter=a.ball.circumference/Math.PI)}function p(a,b){var c=a.ball,d=a.backboard,e=a.helper,f=a.obstacle,g=a.star,h=Ca(a,["ball","backboard","helper","obstacle","star"]),i=b.helpers,j=void 0===i?[]:i,k=b.obstacles,l=void 0===k?[]:k,m=b.stars,n=void 0===m?[]:m;d=Aa({},d,b.backboard);var o=d.board,p=o.scale,q=o.offset,r=o.restitution;d.boardObstacle={position:{x:b.backboard.position.x+q.x,y:b.backboard.position.y+q.y},rotation:0,object:"backboard",scale:p,restitution:r};var s=Aa({},h,b),t=void 0;return s.useDome&&(t=Aa({},s.dome,{rotation:0,object:"jupiter-dome"})),Aa({},s,{ball:Aa({},c,b.ball),backboard:d,helpers:j.map(function(a){return Aa({},e,a)}),obstacles:[].concat(Fa(l.map(function(a){return Aa({},f,a)})),[d.boardObstacle],Fa(t?[t]:[])),stars:n.map(function(a){return Aa({},g,a)})})}function q(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=b[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=a[i],k=j.pose,l=j.loop||j.once;c.push([k,l])}}catch(m){e=!0,f=m}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}function r(a,b,c){var d=function(b){if("string"!=typeof b)return'Invalid "vo": '+b;if(!a.hasSound(b)){if(!c)return"Missing sound: "+b;c.push(b)}},e=["random"];if("object"!==("undefined"==typeof b?"undefined":wa(b)))return d(b);for(var f in b){var g=b[f];if(!e.includes(f)||!Array.isArray(g))return'Invalid "vo": '+b;var h=!0,i=!1,j=void 0;try{for(var k,l=g[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value,n=d(m);if(n)return n}}catch(n){i=!0,j=n}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}}}function s(a,b){var c=function(b){return"string"!=typeof b?'Invalid "animation" value: '+b:b in a.getConfig().animations?void 0:'Unknown "animation" value: '+b};if(!Array.isArray(b))return c(b);var d=!0,e=!1,f=void 0;try{for(var g,h=b[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=c(i);if(j)return j}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}}function t(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Array.isArray(b))return"Should be array";var d=["vo","animation","gameVisual"],e=!0,f=!1,g=void 0;try{for(var h,i=b.entries()[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=Ea(j,2),l=k[0],m=k[1];for(var n in m)if(!d.includes(n))return"Entry "+l+" has invalid key: "+n;var o=m.vo,p=m.animation,q=m.gameVisual;if(null==o)return"Entry "+l+': Missing "vo"';var t=r(a,o,c);if(t)return"Entry "+l+": "+t;if(null!=p){var u=s(a,p);if(u)return"Entry "+l+": "+u}if(null!=q){if("string"!=typeof q)return"Entry "+l+': Invalid "gameVisual" value: '+q;var v=["flashFirstButton","flashThrowArrow","flashHelper","flashObstacle","flashHintButton","flashForceButton","flashTryAgainButton"];if(!v.includes(q))return"Entry "+l+': Unknown "gameVisual" value: '+q}}}catch(w){f=!0,g=w}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}}function u(a,b,c){"level"===c&&a.state instanceof Xa&&a.state.running&&(c="level-no-ball");var d=a.app,e=d.getConfig().animations,f=a.state,g=d.spineAssets,h=(g.mindyFront,g.mindySide,[]),i=new Set,j=void 0,k=function(a,b,g,k){var l=[],m=[];if(g){var n=[];l.push(function(){return f.setMindyAnimation(n)});var o=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=e[a];if(j){if(j!==a){var g=e[j];if(g.end&&n.push([g.pose,g.end]),f.pose!==g.pose){n.push([g.pose,e.transitions[g.pose].out]);var h=e.transitions[f.pose]["in"];Array.isArray(h)?n.push.apply(n,Fa(h.map(function(a){return[f.pose,a]}))):n.push([f.pose,h])}f.start&&n.push([f.pose,f.start])}}else{var i=e[e.defaults[c]],k="level-no-ball"===c?"side-no-ball":i.pose;i&&f.pose!==k&&(n.push([i.pose,e.transitions[k].out]),n.push([f.pose,e.transitions[f.pose]["in"]])),f.start&&n.push([f.pose,f.start])}if(0===b){var m=n.map(function(a){var b=Ea(a,2),c=b[0],e=b[1];return d.animationDurations[c][e]}).reduce(function(a,b){return a+b},0);l.push(m)}f.loop&&n.push([f.pose,f.loop]),f.once&&n.push([f.pose,f.once]),j=a};Array.isArray(g)?g.forEach(o):o(g)}k&&(i.add(k),l.push(function(){return f[k]=!0}),m.push(function(){return f[k]=!1})),"object"===("undefined"==typeof b?"undefined":wa(b))&&"random"in b&&(b=b.random[Math.floor(b.random.length*Math.random())]),h=[].concat(Fa(h),l,[b],m),u=b},l=!0,m=!1,n=void 0;try{for(var o,p=b.entries()[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=o.value,r=Ea(q,2),s=r[0],t=r[1],u=t.vo,v=t.animation,w=t.gameVisual;k(s,u,v,w)}}catch(x){m=!0,n=x}finally{try{!l&&p["return"]&&p["return"]()}finally{if(m)throw n}}if(j){var y=e[j],z=e[e.defaults[c]],A="level-no-ball"===c?"side-no-ball":z.pose,B=[];if(y.end&&B.push([y.pose,y.end]),y.pose!==A){B.push([y.pose,e.transitions[y.pose].out]);var C=e.transitions[A]["in"];Array.isArray(C)?B.push.apply(B,Fa(C.map(function(a){return[z.pose,a]}))):B.push([z.pose,C])}B.push([z.pose,z.loop]),h.push(function(){f.setMindyAnimation(B)})}return{voSeq:h,handleAbort:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=i[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var g=d.value;f[g]&&(f[g]=!1)}}catch(h){b=!0,c=h}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}}}}function v(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function w(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}function x(a){var e=a.disabled,f=a.state,g=a.store.app,h=g.getConfig().pixelsPerMeter,i=new c.Point(1/h,-1/h),j=new c.Point(h,-h),k=f.levelData.backboard,l=f.levelData.mindy,m=f.initialFrame,n=f.currentFrame,o=0;f.flashHelper&&(o=.1*Math.sin(2*Math.PI*a.store.time/500));var p=16777215;if(f.flashObstacle){var q=.8+.2*Math.sin(2*Math.PI*a.store.time/500);p=255*q<<16|255*q<<8|255*q}var r=Math.max(0,n.ball.pos.y*h-770),s=f.levelData.obstacles.filter(function(a){return"backboard"!==a.object&&"jupiter-dome"!==a.object}),t=f.levelData.obstacles.find(function(a){return"backboard"===a.object}),u=f.levelData.obstacles.find(function(a){return"jupiter-dome"===a.object});return va.createElement(b.Container,{key:f.runCount,y:r},va.createElement(b.Sprite,{texture:g.getCache(f.levelData.bg),y:800,anchor:new c.Point(0,1)}),va.createElement(b.Container,{scale:j,y:800},s.map(function(a,d){return va.createElement(b.Sprite,{key:d,scale:new c.Point(i.x*a.scale,i.y*a.scale),x:a.position.x,y:a.position.y,rotation:a.rotation,tint:-1===f.flashObstacleIndex||f.flashObstacleIndex===d?p:16777215,texture:g.getCache(a.object),filters:[jb]})}),va.createElement(b.Container,{x:t.position.x+.8,y:t.position.y-1.4,rotation:-Math.PI/8+f.levelData.armRotation},va.createElement(b.Sprite,{scale:i,anchor:new c.Point(.05,.52),texture:g.getCache("obj-arm")})),va.createElement(b.Sprite,{scale:new c.Point(i.x*t.scale,i.y*t.scale),x:t.position.x,y:t.position.y,texture:g.getCache(t.object)}),f.levelData.helpers.map(function(a,d){return va.createElement(b.Sprite,{key:d,texture:g.getCache("obj-trampoline"),scale:new c.Point(.5*i.x,.5*i.y),anchor:new c.Point(.5,.2),y:a.position.y,x:a.position.x,rotation:f.simulation.helperAngles[d]+o})}),va.createElement(ib,{x:m.ball.pos.x+l.offset.x,y:m.ball.pos.y+l.offset.y,interactive:!0,buttonMode:!0,scale:new c.Point(i.x*l.scale,i.y*l.scale),store:f.root,click:!e&&f.toggleRunning,tap:!e&&f.toggleRunning,animSeq:f.mindyAnimation}),f.levelData.stars.map(function(a,d){return!f.currentFrame.stars[d]&&va.createElement(b.Sprite,{key:d,scale:i,anchor:new c.Point(.5,.5),texture:g.getCache("star-large"),x:a.position.x,y:a.position.y})}),f.frameIndex>0&&va.createElement(b.Sprite,{scale:i,anchor:new c.Point(.5,.5),x:n.ball.pos.x,y:n.ball.pos.y,rotation:n.ball.rot,texture:g.getCache("obj-ball")}),va.createElement(b.Container,{x:k.position.x,y:k.position.y},va.createElement(b.Sprite,{scale:new c.Point(i.x*k.rim.scale,i.y*k.rim.scale),anchor:new c.Point(.5,.1),texture:g.getCache("obj-net")})),u&&va.createElement(b.Sprite,{scale:new c.Point(i.x*u.scale,i.y*u.scale),x:u.position.x,y:u.position.y,texture:g.getCache(u.object)}),!f.running&&!e&&va.createElement(d.Fragment,null,f.levelData.helpers.map(function(a,b){return va.createElement(Ja,{key:b,y:a.position.y,x:a.position.x,rotation:f.simulation.helperAngles[b]+Math.PI/2+o,radius:.6,scale:i,anchor:new c.Point(.5,.5),spriteSheet:{frames:{up:g.getCache("ui-control-tramp"),down:g.getCache("ui-control-tramp-hover")}},onDragStart:function(){return g.triggerSound("button-level-ui")},onDragEnd:function(){return g.triggerSound("button-level-ui")},onRotate:function(a){return f.simulation.setHelperAngle(b,a-Math.PI/2)}})}),va.createElement(Ja,{active:f.flashThrowArrow&&Math.floor(a.store.time/1e3*5)%2>0,x:m.ball.pos.x,y:m.ball.pos.y,rotation:f.simulation.throwAngle,radius:.6,scale:i,anchor:new c.Point(.5,.5),spriteSheet:{frames:{up:g.getCache("ui-control-ball"),down:g.getCache("ui-control-ball-hover")}},onDragStart:function(){return g.triggerSound("button-level-ui")},onDragEnd:function(){return g.triggerSound("button-level-ui")},onRotate:function(a){return f.simulation.setThrowAngle(a)}}))),va.createElement(lb,{state:f,scale:h,cheat:f.useHintTrajectory}),!1)}function y(a){var d=a.state,e=a.disabled,f=d.root,g=f.app,h=g.getConfig().worlds,i=h[d.selectedWorld],j=f.gameStore,k=j.unlockedWorlds,l=j.unlockedLevels,m=1e3*g.getConfig().timings.worldButtonVOTimeout;return React.createElement(b.Container,null,React.createElement(b.Sprite,{x:0,y:0,anchor:new c.Point(0,0),texture:g.getCache("bg-space")}),React.createElement(b.Sprite,{texture:g.getCache("world-large-"+i.image),anchor:new c.Point(.5,.5),x:640,y:400}),React.createElement(b.Sprite,{x:0,y:0,anchor:new c.Point(0,0),texture:g.getCache("overlay-menu")}),h.progression.map(function(a,f){var i=652*f/(h.progression.length-1)+314,j=a in k;return React.createElement(b.Container,{key:f,x:i,y:95},React.createElement(Ga,{anchor:new c.Point(.5,.5),spriteSheet:{up:g.getCache("world-btn"),down:g.getCache("world-btn-hover")},onOver:function(){return!d.voActive&&g.triggerSound(h[a].sound,m,"world-trigger")},onDown:function(){return!d.voActive&&g.triggerSound(h[a].sound,m,"world-trigger")},onClick:function(){return j&&d.setSelectedWorld(a)},disabled:e},function(d){var e=d.isOver;return e&&React.createElement(b.Text,{style:pb,y:85,anchor:new c.Point(.5,.5),text:a})}),React.createElement(b.Sprite,{anchor:new c.Point(.5,.5),texture:g.getCache("world-small-"+h[a].image)}),!j&&React.createElement(b.Sprite,{anchor:new c.Point(.5,.5),texture:g.getCache("world-btn-lock")}))}),i.levels.map(function(a,b){var c=g.getLevel(a).stars.length,h=f.gameStore.levelStarCount[a],j=a in l,k=850*(b+1)/(i.levels.length+1)+215,m=16777215;if(0===b&&d.flashFirstButton){var n=.8+.2*Math.sin(2*Math.PI*f.time/500);m=255*n<<16|255*n<<8|255*n}return React.createElement(qb,{key:b,store:f,tint:m,unlocked:j,x:k,y:710,name:b+1,numStars:c,starCount:h,onClick:j&&function(){return d.enterLevel(d.selectedWorld,b)},disabled:e})}),1===d.root.gameStore.mainMenuViewCount&&React.createElement(ib,{store:f,x:170,y:800,scale:.5,animSeq:d.mindyAnimation}))}function z(a){var e=a.state,f=a.disabled,g=e.root,h=g.app,i=e.simulation.forceLevel;return va.createElement(d.Fragment,null,va.createElement(mb,{store:g,state:e,disabled:f}),!e.scored&&e.running&&va.createElement(Ga,{x:g.xOffset+40,y:760,anchor:new c.Point(0,1),spriteSheet:{up:h.getCache("ui-reset"),down:h.getCache("ui-reset-hover")},onDown:function(){return h.triggerSound("button-state-change")},onClick:e.toggleRunning,disabled:f}),!e.running&&va.createElement(b.Container,{x:300,y:720},va.createElement(b.Sprite,{anchor:new c.Point(.5,.5),texture:h.getCache("ui-force-container")}),va.createElement(Ga,{active:e.flashForceButton&&Math.floor(g.time/1e3*5)%2>0,anchor:new c.Point(.5,.5),spriteSheet:{up:h.getCache("ui-force-minus"),down:h.getCache("ui-force-minus-hover")},onDown:function(){return h.triggerSound("button-level-ui")},x:-62,onClick:function(){return i>1&&e.simulation.setForceLevel(i-1)},disabled:f}),va.createElement(Ga,{active:e.flashForceButton&&Math.floor(g.time/1e3*5)%2===0,anchor:new c.Point(.5,.5),spriteSheet:{up:h.getCache("ui-force-plus"),down:h.getCache("ui-force-plus-hover")},onDown:function(){return h.triggerSound("button-level-ui")},x:62,onClick:function(){return i<e.levelData.ball.forceLevels&&e.simulation.setForceLevel(i+1)},disabled:f}),va.createElement(b.Container,{x:-46,y:-15},va.createElement(ub,{forceLevel:i,forceLevels:e.levelData.ball.forceLevels}))),!e.running&&e.showHintButton&&va.createElement(Ga,{active:e.flashHintButton&&Math.floor(g.time/1e3*5)%2>0,anchor:new c.Point(.5,.5),x:1200-g.xOffset,y:720,spriteSheet:{up:h.getCache("ui-hint"),down:h.getCache("ui-hint-hover")},onDown:function(){return h.triggerSound("button-level-ui")},onClick:e.toggleHintTrajectory,disabled:f}),e.scored&&va.createElement(d.Fragment,null,va.createElement(b.Container,{alpha:Math.min(1,Math.max(0,e.timeSinceScored-vb)/100)},va.createElement(tb,null)),va.createElement(b.Container,{x:640,y:400-Math.max(0,-10+1200/(1+Math.max(0,e.timeSinceScored-vb)/1e3*60))},va.createElement(b.Sprite,{texture:h.getCache(e.isEnd()?"overlay-finish":"overlay-success"),anchor:new c.Point(.5,.5)}),!e.isEnd()&&Array(e.levelData.stars.length).fill(0).map(function(a,d){return va.createElement(b.Sprite,{key:d,anchor:new c.Point(.5,.5),x:400*((d+1)/(e.levelData.stars.length+1)-.5),texture:h.getCache(d<e.currentFrame.getStarCount()?"star-large":"star-large-outline")})}),va.createElement(Ga,{anchor:new c.Point(.5,.5),x:-170,y:200,spriteSheet:{up:h.getCache("btn-play-again"),down:h.getCache("btn-play-again-hover")},onDown:function(){return h.triggerSound("button-state-change")},onClick:e.toggleRunning,disabled:f}),va.createElement(Ga,{anchor:new c.Point(.5,.5),x:170,y:200,spriteSheet:{up:h.getCache(e.wasCompleted?"btn-main-menu":"btn-continue"),down:h.getCache(e.wasCompleted?"btn-main-menu-hover":"btn-continue-hover")},onDown:function(){return h.triggerSound("button-state-change")},onClick:e.wasCompleted?e.enterMainMenu:e.enterNextState,disabled:f}))),e.failed&&va.createElement(b.Container,{alpha:Math.min(1,Math.max(0,e.timeSinceFailed-wb)/1e3*60/10)},va.createElement(tb,null),va.createElement(b.Container,{x:640,y:400},va.createElement(b.Sprite,{texture:h.getCache("overlay-failure"),anchor:new c.Point(.5,.5),interactive:!0,buttonMode:!0,click:!f&&e.toggleRunning,tap:!f&&e.toggleRunning}),va.createElement(Ga,{active:e.flashTryAgainButton&&Math.floor(g.time/1e3*5)%2>0,anchor:new c.Point(.5,.5),x:0,y:200,spriteSheet:{up:h.getCache("btn-try-again"),down:h.getCache("btn-try-again-hover")},onDown:function(){return h.triggerSound("button-state-change")},onClick:e.toggleRunning,disabled:f}))),!(!e.hasNextLevel()&&e.getNextWorld()&&e.scored&&!e.wasCompleted)&&va.createElement(Ga,{anchor:new c.Point(.5,.5),x:g.xOffset+80,y:80,spriteSheet:{up:h.getCache("btn-back"),down:h.getCache("btn-back-hover")},onDown:function(){return h.triggerSound("button-state-change")},onClick:e.enterMainMenu,disabled:f}))}function A(a){var e=a.state,f=e.root,g=f.app,h=g.getConfig().warp;return va.createElement(b.Container,null,va.createElement(sb,{time:f.time},function(a){return a=Math.max(0,a-1e3*h.delay),va.createElement(d.Fragment,null,va.createElement(zb,{time:a,app:g,world:e.nextWorld}),va.createElement(b.Text,{alpha:Math.min(1,(a-1e3*(h.duration+h.textDelay))/1e3),style:Ab,x:640,y:400,anchor:new c.Point(.5,.5),text:g.getConfig().worlds[e.nextWorld].name}))}),va.createElement(b.Sprite,{x:0,y:0,anchor:new c.Point(0,0),texture:g.getCache("overlay-menu")}),va.createElement(Ga,{anchor:new c.Point(.5,.5),x:640,y:710,spriteSheet:{up:g.getCache("btn-continue"),down:g.getCache("btn-continue-hover")},onDown:function(){return g.triggerSound("button-state-change")},onClick:e.enterNextState}))}function B(a){var e=a.store,f=a.disabled,g=void 0===f?!1:f,h=a.state,i=void 0===h?e.state:h,j=e.app;return j?i instanceof Sa?va.createElement(d.Fragment,null,va.createElement(b.Sprite,{x:0,y:0,anchor:new c.Point(0,0),texture:j.getCache("bg-splash")}),va.createElement(Ga,{x:1080,y:600,anchor:new c.Point(.5,.5),scale:.7,spriteSheet:j.getCache("play-button"),onDown:function(){return j.triggerSound("button-splash")},onClick:i.enterNextState})):i instanceof Ta?va.createElement(d.Fragment,null,va.createElement(b.Sprite,{x:0,y:0,anchor:new c.Point(0,0),texture:j.getCache("bg-space")}),va.createElement(b.Text,{style:Mb,x:640,y:450,anchor:new c.Point(.5,.5),text:"Loading"}),va.createElement(b.Text,{style:Mb,x:640,y:550,anchor:new c.Point(.5,.5),text:Math.floor(100*i.progress)+"%"}),va.createElement(b.Sprite,{x:150+980*i.progress,y:300,scale:new c.Point(-1,1),anchor:new c.Point(.5,.5),texture:j.getCache("sunspot-swim").frames[Math.floor(e.time/1e3*20)%16]})):i instanceof Va?va.createElement(rb,{state:i,disabled:g}):i instanceof Xa?va.createElement(xb,{state:i,disabled:g}):i instanceof Wa?va.createElement(Bb,{state:i}):i instanceof Ua?va.createElement(Lb,{state:i,inView:va.createElement(B,{store:e,state:i.inState,disabled:!0}),outView:va.createElement(B,{store:e,state:i.outState,disabled:!0})}):va.createElement(b.Text,{style:Mb,x:640,y:400,anchor:new c.Point(.5,.5),text:"Unknown state"}):va.createElement(d.Fragment,null,va.createElement(b.Text,{style:Mb,x:640,y:400,anchor:new c.Point(.5,.5),text:"Loading"}),va.createElement(b.Text,{style:Mb,x:640,y:450,text:".".repeat(a.store.time/1e3%4)}))}function C(){var a=new c.Application({width:1280,height:800,autoStart:!1,antialias:!0,view:document.getElementsByTagName("canvas")[0]});return a.ticker.stop(),a}function D(a){var b=document.getElementById("content");b.ondragover=function(a){return a.preventDefault()},b.ondrop=function(b){b.preventDefault();try{var c=b.dataTransfer.items&&"file"===b.dataTransfer.items[0].kind?b.dataTransfer.items[0].getAsFile():b.dataTransfer.files[0],d=new FileReader;d.onload=function(b){try{var c=JSON.parse(b.target.result);a(c)}catch(b){alert("couldnt read file: "+b)}},d.readAsText(c)}catch(b){alert("Something went wrong: "+b)}}}function E(a){var b=void 0;D(function(c){if(o(c),c.global)return b=c,void alert("imported global level config");var d=p(b||a.app._app.config.baseLevel,c),e=[],f=!0,g=!1,h=void 0;try{for(var i,j=d.obstacles[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=k.object;a.app.getCache(l)||e.push({image:"images/obstacles/"+l+".png"})}}catch(m){g=!0,h=m}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}var n=function(){return a.enterState(new Xa(a,void 0,d))};e.length>0?a.app._app.load(e,{cacheAll:!0,complete:n}):n()})}var F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta="default"in b?b["default"]:b,ua="default"in c?c["default"]:c,va="default"in d?d["default"]:d,wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},xa=function(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(i){return void c(i)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}},ya=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},za=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Aa=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},Ba=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},Ca=function(a,b){var c={};for(var d in a)b.indexOf(d)>=0||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c},Da=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},Ea=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Fa=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},Ga=function(a){function c(){var a,b,d,e;ya(this,c);for(var f=arguments.length,g=Array(f),h=0;f>h;h++)g[h]=arguments[h];return b=d=Da(this,(a=c.__proto__||Object.getPrototypeOf(c)).call.apply(a,[this].concat(g))),d.state={isDown:!1,isOver:!1},d.onButtonDown=function(a){d.setState({isDown:!0}),d.props.onDown&&d.props.onDown(a)},d.onButtonUp=function(a){d.state.isDown&&(d.setState({isDown:!1}),d.props.onClick&&d.props.onClick(a)),d.props.onUp&&d.props.onUp(a)},d.onButtonUpOutside=function(a){d.setState({isDown:!1}),d.props.onUp&&d.props.onUp(a)},d.onButtonOver=function(){d.setState({isOver:!0}),d.props.onOver&&d.props.onOver()},d.onButtonOut=function(){d.setState({isOver:!1})},e=b,Da(d,e)}return Ba(c,a),za(c,[{key:"render",value:function(){var a=this.props,c=a.spriteSheet,d=(a.onClick,a.onDown,a.onUp,a.active),e=a.disabled,f=a.children,g=Ca(a,["spriteSheet","onClick","onDown","onUp","active","disabled","children"]),h=c.frames||c.up&&c,i=h?h[d||this.state.isDown||this.state.isOver&&!("over"in h)?"down":this.state.isOver?"over":"up"]:c,j=va.createElement(b.Sprite,Aa({},g,{texture:i,interactive:!e,buttonMode:!e,pointerdown:this.onButtonDown,pointerup:this.onButtonUp,pointerupoutside:this.onButtonUpOutside,pointerover:this.onButtonOver,pointerout:this.onButtonOut}));if("function"==typeof f){var k=f(this.state);return va.createElement(va.Fragment,null,j,k)}return j}}]),c}(va.Component),Ha=5,Ia=function(a){function b(){var a,c,d,e;ya(this,b);for(var f=arguments.length,g=Array(f),h=0;f>h;h++)g[h]=arguments[h];return c=d=Da(this,(a=b.__proto__||Object.getPrototypeOf(b)).call.apply(a,[this].concat(g))),d.state={dragging:!1},d.prevPos=null,d.onWindowDown=function(a){d.setSticky(!1),d.setState({dragging:!1}),window.removeEventListener("mousedown",d.onWindowDown),window.removeEventListener("touchstart",d.onWindowDown)},d.onDown=function(a){d.startPos=a.data.global.clone(),d.prevPos=a.data.global.clone(),d.setSticky(!0),d.setState({dragging:!0}),d.props.onDown&&d.props.onDown(a,a.data.global.clone())},d.onUp=function(){d.sticky?(window.addEventListener("mousedown",d.onWindowDown),window.addEventListener("touchstart",d.onWindowDown)):d.setState({dragging:!1})},d.onMove=function(a){var b=a.data.global.clone(),c=d.startPos.distance(b);c>Ha&&d.sticky&&d.setSticky(!1),b.subtract(d.prevPos),d.prevPos=a.data.global.clone(),d.props.onDrag&&d.props.onDrag(a,b)},e=c,Da(d,e)}return Ba(b,a),za(b,[{key:"setSticky",value:function(a){this.sticky=a}},{key:"componentDidUpdate",value:function(a,b){this.props.onDragStart&&!b.dragging&&this.state.dragging&&this.props.onDragStart(),this.props.onDragEnd&&b.dragging&&!this.state.dragging&&this.props.onDragEnd()}},{key:"render",value:function(){var a=this.props,b=(a.onDrag,Ca(a,["onDrag"]));return va.createElement(Ga,Aa({},b,{onDown:!this.state.dragging&&this.onDown,onUp:this.onUp,pointermove:this.state.dragging&&this.onMove}))}}]),b}(va.Component),Ja=function(a){function c(){var a,b,d,e;ya(this,c);for(var f=arguments.length,g=Array(f),h=0;f>h;h++)g[h]=arguments[h];return b=d=Da(this,(a=c.__proto__||Object.getPrototypeOf(c)).call.apply(a,[this].concat(g))),d.onDown=function(a,b){d.startAngle=d.props.rotation,d.startPos=b.clone(),d.endPos=b.clone();var c=a.currentTarget.parent.getGlobalPosition();d.startPos.subtract(c),d.endPos.subtract(c)},d.onDrag=function(a,b){if(d.endPos.add(b),d.props.onRotate){var c=d,e=c.startPos,f=c.endPos,g=e.x*f.y-e.y*f.x,h=e.dotProd(f),i=Math.atan2(g,h);d.props.onRotate(d.startAngle-i)}},e=b,Da(d,e)}return Ba(c,a),za(c,[{key:"render",value:function(){var a=this.props,c=a.x,d=a.y,e=a.radius,f=a.rotation,g=(a.onRotate,Ca(a,["x","y","radius","rotation","onRotate"]));return va.createElement(b.Container,{x:c,y:d,rotation:f},va.createElement(Ia,Aa({},g,{x:e,onDown:this.onDown,onDrag:this.onDrag})))}}]),c}(va.Component),Ka=function(a){var c=a.scale,d=a.shape;return va.createElement(b.Graphics,{draw:function(a){a.beginFill(16777215),a.drawCircle(c*d.m_p.x,-c*d.m_p.y,c*d.m_radius),a.endFill()}})},La=function(a){var c=a.scale,d=a.shape;return va.createElement(b.Graphics,{draw:function(a){a.lineStyle(2,13421772);var b=d.m_vertices[0];a.moveTo(c*b.x,-c*b.y);for(var e=1;e<d.m_count;e++){var f=d.m_vertices[e];a.lineTo(c*f.x,-c*f.y)}a.lineTo(c*b.x,-c*b.y)}})},Ma=(function(a){function b(){return ya(this,b),Da(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return Ba(b,a),za(b,[{key:"render",value:function(){var a=this.props,b=a.scale,c=a.shapes;return va.createElement(d.Fragment,null,va.createElement(Ka,{scale:b,shape:c.leftRim}),va.createElement(Ka,{scale:b,shape:c.rightRim}),va.createElement(La,{scale:b,shape:c.topSensor}),va.createElement(La,{scale:b,shape:c.bottomSensor}))}}]),b}(va.PureComponent),function(a){function c(){return ya(this,c),Da(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return Ba(c,a),za(c,[{key:"render",value:function(){var a=this.props,c=a.helper,d=a.rotation,e=a.scale;return va.createElement(b.Graphics,{x:e*c.position.x,y:800-e*c.position.y,rotation:-d,draw:function(a){a.clear(),a.beginFill(16711680),a.drawCircle(e*-c.width/2,0,e*c.edge.radius),a.drawCircle(e*+c.width/2,0,e*c.edge.radius),a.endFill(),a.lineStyle(3,65280),a.moveTo(e*-c.width/2,0),a.lineTo(e*c.width/2,0)}})}}]),c}(va.PureComponent),function(a){function c(){return ya(this,c),Da(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return Ba(c,a),za(c,[{key:"render",value:function(){var a=this.props,c=a.obstacle,d=a.polygons,e=a.scale;return va.createElement(b.Graphics,{x:e*c.position.x,y:800-e*c.position.y,rotation:-c.rotation,draw:function(a){a.clear(),a.lineStyle(1.5,65535);var b=!0,e=!1,f=void 0;try{for(var g,i=d[Symbol.iterator]();!(b=(g=i.next()).done);b=!0){var j=g.value,k=j[0];a.beginFill(h(),.5),a.moveTo(c.scale*k[0],c.scale*k[1]);for(var l=1;l<j.length;l++){var m=j[l];a.lineTo(c.scale*m[0],c.scale*m[1])}a.lineTo(c.scale*k[0],c.scale*k[1]),a.endFill()}}catch(n){e=!0,f=n}finally{try{!b&&i["return"]&&i["return"]()}finally{if(e)throw f}}}})}}]),c}(va.PureComponent),function(a){function c(){return ya(this,c),Da(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return Ba(c,a),za(c,[{key:"render",value:function(){var a=this.props,c=a.star,d=a.scale;return va.createElement(b.Graphics,{x:d*c.position.x,y:800-d*c.position.y,draw:function(a){a.beginFill(21760,.5),a.drawCircle(0,0,d*c.radius),a.endFill()}})}}]),c}(va.PureComponent),function(){function a(b){ya(this,a),this.world=b}return za(a,[{key:"createFloor",value:function(a){var b=a.y,c=a.restitution,d=a.friction,e=a.bounds,f=this.world.createBody();return f.createFixture(g.Edge({x:e.left,y:b},{x:e.right,y:b}),{restitution:c,friction:d,userData:{type:"floor"}}),f}},{key:"createBall",value:function(a){var b=a.position,c=a.mass,d=a.radius,e=a.linearDamping,f=a.angularDamping,h=a.throwAngle,i=a.throwMagnitude,j=this.world.createBody({type:"dynamic",position:new g.Vec2(b.x,b.y),linearDamping:e,angularDamping:f});return j.createFixture(g.Circle(d),{density:c/(4/3*Math.PI*d*d*d),friction:1,restitution:0,userData:{type:"ball"}}),j.m_force.set(new g.Vec2(Math.cos(h),Math.sin(h)).mul(i)),j}},{key:"createHelper",value:function(a){var b=this.world.createBody();return b.setPosition(a.position),b.createFixture(g.Circle(g.Vec2(-a.width/2,0),a.edge.radius),{restitution:a.edge.restitution,userData:{type:"helper-edge"}}),b.createFixture(g.Circle(g.Vec2(a.width/2,0),a.edge.radius),{restitution:a.edge.restitution,userData:{type:"helper-edge"}}),b.createFixture(g.Edge(g.Vec2(-a.width/2,0),g.Vec2(a.width/2,0)),{restitution:a.restitution,userData:{type:"helper"}}),b}},{key:"createObstacle",value:function(a){var b=this.world.createBody();b.setPosition(a.position),b.setAngle(a.rotation);var c=!0,d=!1,e=void 0;try{for(var f,h=a.polygons[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var i=f.value;b.createFixture(g.Polygon(i),{restitution:a.restitution,userData:{type:"obstacle",object:a.object}})}}catch(j){d=!0,e=j}finally{try{!c&&h["return"]&&h["return"]();
}finally{if(d)throw e}}return b}},{key:"createStar",value:function(a){var b=this.world.createBody();b.createFixture(g.Circle(a.position,a.radius),{isSensor:!0,userData:{type:"star",index:a.index}})}},{key:"createBackboard",value:function(a){var b=this.world.createBody(),c={type:"backboard"};b.setPosition(a.position);var d=a.rim.radius,e=a.rim.thickness,f=g.Box(d,a.sensorHeight,{x:0,y:a.sensorHeight}),h=g.Box(d,a.sensorHeight,{x:0,y:-a.sensorHeight}),i=g.Circle(g.Vec2(-d,0),e/2),j=g.Circle(g.Vec2(d,0),e/2);return b.createFixture(i,{restitution:a.rim.restitution,userData:c}),b.createFixture(j,{restitution:a.rim.restitution,userData:c}),b.createFixture(f,{isSensor:!0,userData:{type:"sensor",sensor:"hoopSensorTop"}}),b.createFixture(h,{isSensor:!0,userData:{type:"sensor",sensor:"hoopSensorBottom"}}),{leftRim:i,rightRim:j,topSensor:f,bottomSensor:h}}}]),a}()),Na=function(){function a(b,c){if(ya(this,a),this.state=0,b){var d=b.state,e=c.has("hoopSensorTop"),f=c.has("hoopSensorBottom");0===d||e||f?0===d&&e&&!f?this.state=1:1===d&&e&&f?this.state=2:1!==d&&2!==d||e||!f?this.state=d:this.state=3:this.state=0}}return za(a,[{key:"triggered",value:function(){return 3===this.state}}]),a}(),Oa=function(){function a(b,c,d){var e=this;if(ya(this,a),this._hoopSensor=new Na,this.framesSinceScored=-1,this.framesSinceFailed=-1,c&&c.isEnd())throw new Error("no frame after end frame");if(this.ball={rot:b.getAngle(),pos:b.getPosition().clone(),awake:b.isAwake(),collisions:[],inBounds:!0,energy:0},this.stars=[],c){var f=new Set;this.stars=[].concat(Fa(c.stars));for(var g=function(a){var b=a.contact;if(!b.isTouching())return"continue";var d=b.getFixtureA(),g=b.getFixtureB(),h=void 0;switch("ball"!==d.getUserData().type?h=d:"ball"!==g.getUserData().type&&(h=g),h.getUserData().type){case"sensor":f.add(h.getUserData().sensor);break;case"star":e.stars[h.getUserData().index]=!0;break;default:e.ball.collisions.push({initial:!c.ball.collisions.some(function(a){return a.fixture===h}),fixture:h,data:h.getUserData(),impulse:b.v_points[0].normalImpulse})}},h=b.getContactList();null!==h;h=h.next){g(h)}if(this.ball.inBounds=j(b,d),this.ball.energy=i(b,d),this._hoopSensor=new Na(c._hoopSensor,f),c.framesSinceScored>-1?this.framesSinceScored=c.framesSinceScored+1:this.framesSinceScored=this._hoopSensor.triggered()?0:-1,c.framesSinceFailed>-1)this.framesSinceFailed=c.framesSinceFailed+1;else if(-1===this.framesSinceScored){var k=!this.ball.inBounds||this.ball.energy<=0||!this.ball.awake;this.framesSinceFailed=k?0:-1}}}return za(a,[{key:"getStarCount",value:function(){return this.stars.reduce(function(a,b){return b?a+1:a},0)}},{key:"ballHasCollided",value:function(){return this.ball.collisions.length>0}},{key:"isEnd",value:function(){return!this.ball.awake||!this.ball.inBounds}}]),a}(),Pa=(F=function(){function a(b){ya(this,a),this._frames=[],k(this,"throwAngle",G,this),k(this,"forceLevel",H,this),k(this,"helperAngles",I,this),this._state=b,this._world=new g.World(new g.Vec2(0,-b.levelData.gravity)),this.throwAngle=b.levelData.ball.initialThrowAngle,this.forceLevel=b.levelData.ball.initialForceLevel;var c=new Ma(this._world);c.createFloor(Aa({},b.levelData.floor,{bounds:b.levelData.bounds})),this.backboard=c.createBackboard(b.levelData.backboard),this._helpers=b.levelData.helpers.map(function(a){return c.createHelper(a)}),this.helperAngles=b.levelData.helpers.map(function(a){return a.initialAngle});var d=!0,e=!1,f=void 0;try{for(var h,i=b.levelData.stars.entries()[Symbol.iterator]();!(d=(h=i.next()).done);d=!0){var j=h.value,l=Ea(j,2),m=l[0],n=l[1];c.createStar({position:n.position,radius:n.radius,index:m})}}catch(o){e=!0,f=o}finally{try{!d&&i["return"]&&i["return"]()}finally{if(e)throw f}}var p=b.root.app.getConfig().pixelsPerMeter,q=function(a){var d=a.scale,e=a.restitution,f=Ca(a,["scale","restitution"]);c.createObstacle(Aa({},f,{polygons:b.root.app.getObstacleData(f.object).polygons.map(function(a){return a.map(function(a){var b=Ea(a,2),c=b[0],e=b[1];return{x:c/p*d,y:-e/p*d}})}),restitution:e}))},r=!0,s=!1,t=void 0;try{for(var u,v=b.levelData.obstacles[Symbol.iterator]();!(r=(u=v.next()).done);r=!0){var w=u.value;q(w)}}catch(o){s=!0,t=o}finally{try{!r&&v["return"]&&v["return"]()}finally{if(s)throw t}}}return za(a,[{key:"getFrames",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.initialFrame;if(this._frames[0]!==this.initialFrame)throw new Error("should be in sync");for(;this._frames.length-1<a&&!this._frames[this._frames.length-1].isEnd();)this._step();return this._frames}},{key:"_step",value:function(){this._world.step(1/60);var a=this._frames[this._frames.length-1],b=new Oa(this._ball,a,this._state.levelData);return this._frames.push(b),b}},{key:"setThrowAngle",value:function(a){if(this._state.running)throw new Error("Can't change ball angle during simulation");var b=this._state.levelData.ball.angleSnap;a=Math.round(a/b)*b,a>Math.PI&&(a-=2*Math.PI),a<-Math.PI&&(a+=2*Math.PI);var c=Ea(this._state.levelData.ball.throwAngleBounds,2),d=c[0],e=c[1];a=Math.max(d,Math.min(e,a)),this.throwAngle!==a&&(this._setThrowAngle(a),this._state.root.app.playSound("rotate-click"))}},{key:"_setThrowAngle",value:function(a){this.throwAngle=a}},{key:"setHelperAngle",value:function(a,b){if(this._state.running)throw new Error("Can't change helper angle during simulation");var c=this._state.levelData.angleSnap;b=Math.round(b/c)*c,this.helperAngles[a]!==b&&(this._setHelperAngle(a,b),this._state.root.app.playSound("rotate-click"))}},{key:"_setHelperAngle",value:function(a,b){this.helperAngles[a]=b}},{key:"setForceLevel",value:function(a){this.forceLevel=a}},{key:"initialFrame",get:function(){var a=this._state.levelData.ball,b=a.forceLevels,c=Ea(a.forceRange,2),d=c[0],e=c[1],f=this.throwAngle,g=(this.forceLevel-1)/(b-1)*(e-d)+d;this._ball&&this._world.destroyBody(this._ball);var h=new Ma(this._world);this._ball=h.createBall(Aa({},this._state.levelData.ball,{throwMagnitude:g,radius:this._state.levelData.ball.diameter/2,throwAngle:f}));var i=!0,j=!1,k=void 0;try{for(var l,m=this._helpers.entries()[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value,o=Ea(n,2),p=o[0],q=o[1];q.setAngle(this.helperAngles[p])}}catch(r){j=!0,k=r}finally{try{!i&&m["return"]&&m["return"]()}finally{if(j)throw k}}var s=new Oa(this._ball);this._frames.length=0,this._frames.push(s);var t=this._state.levelData.trajectoryLength;this._frameIndexOfFirstCollision=t;for(var u=1;t>=u;u++){var v=this._step();if(v.ballHasCollided()||v.isEnd()){this._frameIndexOfFirstCollision=u;break}}return s}},{key:"trajectory",get:function(){return this.getFrames().slice(0,this._frameIndexOfFirstCollision).map(function(a){return a.ball.pos})}},{key:"cheatTrajectory",get:function(){var a=this._state.levelData.trajectoryLength;return this.getFrames(this._frameIndexOfFirstCollision+a).slice(0,this._frameIndexOfFirstCollision+a).map(function(a){return a.ball.pos})}}]),a}(),G=l(F.prototype,"throwAngle",[a.observable],{enumerable:!0,initializer:function(){return Math.PI/4}}),H=l(F.prototype,"forceLevel",[a.observable],{enumerable:!0,initializer:function(){return 1}}),I=l(F.prototype,"helperAngles",[a.observable],{enumerable:!0,initializer:function(){return[]}}),l(F.prototype,"initialFrame",[a.computed],Object.getOwnPropertyDescriptor(F.prototype,"initialFrame"),F.prototype),l(F.prototype,"trajectory",[a.computed],Object.getOwnPropertyDescriptor(F.prototype,"trajectory"),F.prototype),l(F.prototype,"cheatTrajectory",[a.computed],Object.getOwnPropertyDescriptor(F.prototype,"cheatTrajectory"),F.prototype),l(F.prototype,"_setThrowAngle",[a.action],Object.getOwnPropertyDescriptor(F.prototype,"_setThrowAngle"),F.prototype),l(F.prototype,"_setHelperAngle",[a.action],Object.getOwnPropertyDescriptor(F.prototype,"_setHelperAngle"),F.prototype),l(F.prototype,"setForceLevel",[a.action],Object.getOwnPropertyDescriptor(F.prototype,"setForceLevel"),F.prototype),F),Qa=function(){function a(b){ya(this,a),this.dispose=function(){},this.root=b}return za(a,[{key:"getName",value:function(){return""}}]),a}(),Ra=(J=function(a){function b(){var a,c,d,e;ya(this,b);for(var f=arguments.length,g=Array(f),h=0;f>h;h++)g[h]=arguments[h];return c=d=Da(this,(a=b.__proto__||Object.getPrototypeOf(b)).call.apply(a,[this].concat(g))),m(d,"mindyAnimation",K,d),e=c,Da(d,e)}return Ba(b,a),za(b,[{key:"setMindyAnimation",value:function(a){this.mindyAnimation=a}}]),b}(Qa),K=n(J.prototype,"mindyAnimation",[a.observable],{enumerable:!0,initializer:function(){return[["front","Idle"]]}}),n(J.prototype,"setMindyAnimation",[a.action],Object.getOwnPropertyDescriptor(J.prototype,"setMindyAnimation"),J.prototype),J),Sa=function(a){function b(){var a,c,d,e;ya(this,b);for(var f=arguments.length,g=Array(f),h=0;f>h;h++)g[h]=arguments[h];return c=d=Da(this,(a=b.__proto__||Object.getPrototypeOf(b)).call.apply(a,[this].concat(g))),d.enterNextState=function(){d.root.enterState(new Ta(d.root))},e=c,Da(d,e)}return Ba(b,a),b}(Qa),Ta=(L=function(a){function b(a){ya(this,b);var c=Da(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return m(c,"progress",M,c),c.enterNextState=function(){c.root.enterState(new Va(c.root))},c.root.app.loadAssets(function(a){c.progress=a},c.enterNextState),c}return Ba(b,a),b}(Qa),M=n(L.prototype,"progress",[a.observable],{enumerable:!0,initializer:function(){return 0}}),L),Ua=(N=function(b){function c(a,b,d){ya(this,c);var e=Da(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a));return e.transitionTime=1e3*a.app.getConfig().timings.transition,e.outState=b,e.inState=d,e}return Ba(c,b),za(c,[{key:"transition",value:function(){var b=this;this.startTime=this.root.time,this.root.enterState(this),a.when(function(){return b.time>=1}).then(function(){b.root.enterState(b.inState)})}},{key:"time",get:function(){return Math.min(1,(this.root.time-this.startTime)/this.transitionTime)}}]),c}(Qa),n(N.prototype,"time",[a.computed],Object.getOwnPropertyDescriptor(N.prototype,"time"),N.prototype),N),Va=(O=function(a){function b(a){ya(this,b);var c=Da(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));m(c,"voActive",P,c),m(c,"flashFirstButton",Q,c),m(c,"selectedWorld",R,c);var d=a.app.getConfig().animations["front-idle"],e=d.pose,f=d.loop;return c.setMindyAnimation([[e,f]]),c.root.gameStore.incMainMenuViewCount(),c}return Ba(b,a),za(b,[{key:"getName",value:function(){return"menu"}},{key:"enterLevel",value:function(a,b){var c=new Xa(this.root,{world:a,levelIndex:b}),d=new Ua(this.root,this,c);d.transition()}},{key:"setSelectedWorld",value:function(a){this.selectedWorld=a}},{key:"setFirstButtonFlash",value:function(a){this.flashFirstButton=a}}]),b}(Ra),P=n(O.prototype,"voActive",[a.observable],{enumerable:!0,initializer:function(){return!1}}),Q=n(O.prototype,"flashFirstButton",[a.observable],{enumerable:!0,initializer:function(){return!1}}),R=n(O.prototype,"selectedWorld",[a.observable],{enumerable:!0,initializer:function(){return this.root.app.getConfig().worlds.progression[0]}}),n(O.prototype,"setSelectedWorld",[a.action],Object.getOwnPropertyDescriptor(O.prototype,"setSelectedWorld"),O.prototype),n(O.prototype,"setFirstButtonFlash",[a.action],Object.getOwnPropertyDescriptor(O.prototype,"setFirstButtonFlash"),O.prototype),O),Wa=function(b){function c(b,d,e){ya(this,c);var f=Da(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,b));f.enterNextState=function(){var a=new Va(f.root);a.setSelectedWorld(f.nextWorld),f.root.enterState(a)},f.prevWorld=d,f.nextWorld=e,f.mountTime=f.root.time;var g=f.root.app.getConfig().warp,h=g.duration+g.textDelay;return f.dispose=a.when(function(){return f.root.time-f.mountTime>1e3*h},function(){f.root.app.playVo(f.root.app.getConfig().worlds[e].sound)}),f}return Ba(c,b),za(c,[{key:"getName",value:function(){return"newWorldUnlock"}}]),c}(Qa),Xa=(S=a.action.bound,T=a.action.bound,U=a.action.bound,V=a.action.bound,W=a.action.bound,X=function(b){function c(b){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{world:"earth",levelIndex:0},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;ya(this,c);var f=Da(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,b));m(f,"running",Y,f),f.startTime=0,m(f,"runCount",Z,f),m(f,"failCount",$,f),m(f,"showHintButton",_,f),m(f,"useHintTrajectory",aa,f),m(f,"flashThrowArrow",ba,f),m(f,"flashHelper",ca,f),m(f,"flashObstacle",da,f),m(f,"flashHintButton",ea,f),m(f,"flashForceButton",fa,f),m(f,"flashTryAgainButton",ga,f),f.flashObstacleIndex=-1,f.enterNextState=function(){var a=void 0;if(!f.wasCompleted)if(f.hasNextLevel())a=new c(f.root,{world:f.worldData.world,levelIndex:f.worldData.levelIndex+1});else{var b=f.getNextWorld();b?a=new Wa(f.root,f.worldData.world,b):(a=new Va(f.root),a.setSelectedWorld(f.worldData.world))}f.root.enterState(a)},f.enterMainMenu=function(){var a=new Va(f.root);a.setSelectedWorld(f.worldData.world);var b=new Ua(f.root,f,a);b.transition()};var g=f.root.app.getConfig();f.setMindyAnimation(f.root.app.getConfig().animations.presets["get-ball"]);var h=g.worlds[d.world].levels[d.levelIndex];return f.worldData=d,f.levelName=h,f.levelData=e||f.root.app.getLevel(h),f.simulation=new Pa(f),f.wasCompleted=f.root.gameStore.levelScoreCount[h]>0,f.dispose=a.when(function(){return f.scored},function(){return f.root.gameStore.incLevelScoreCount(h)}),f}return Ba(c,b),za(c,[{key:"getName",value:function(){return"level"}},{key:"hasNextLevel",value:function(){var a=this.root.app.getConfig();return!!a.worlds[this.worldData.world].levels[this.worldData.levelIndex+1]}},{key:"getNextWorld",value:function(){var a=this.root.app.getConfig(),b=a.worlds.progression.indexOf(this.worldData.world);return a.worlds.progression[b+1]}},{key:"isEnd",value:function(){return!this.hasNextLevel()&&!this.getNextWorld()}},{key:"toggleRunning",value:function(){this.running||(this.startTime=this.root.time+1e3*this.levelData.mindy.throwDelay,this.setMindyAnimation(this.root.app.getConfig().animations.presets["throw-ball"])),this.running&&(this.runCount++,this.setMindyAnimation(this.root.app.getConfig().animations.presets["get-ball"]),this.scoreTime=null,this.failTime=null),this.running&&this.currentFrame.framesSinceFailed>-1&&this.failCount++,this.running=!this.running}},{key:"setThrowArrowFlash",value:function(a){this.flashThrowArrow=a}},{key:"setHelperFlash",value:function(a){this.flashHelper=a}},{key:"setObstacleFlash",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.flashObstacleIndex=b,this.flashObstacle=a}},{key:"toggleHintTrajectory",value:function(){this.useHintTrajectory=!this.useHintTrajectory}},{key:"frameIndex",get:function(){if(!this.running)return 0;var a=Math.floor((this.root.time-this.startTime)/1e3*60);return Math.max(0,a)}},{key:"initialFrame",get:function(){return this.simulation.initialFrame}},{key:"currentFrame",get:function(){var a=this.simulation.getFrames(this.frameIndex),b=Math.min(this.frameIndex,a.length-1);return a[b]}},{key:"scored",get:function(){var a=this.currentFrame.framesSinceScored>-1;return a&&null==this.scoreTime&&(this.scoreTime=this.root.time),a}},{key:"failed",get:function(){var a=this.currentFrame.framesSinceFailed>-1;return a&&null==this.failTime&&(this.failTime=this.root.time),a}},{key:"timeSinceScored",get:function(){return this.scoreTime?this.root.time-this.scoreTime:0}},{key:"timeSinceFailed",get:function(){return this.failTime?this.root.time-this.failTime:0}},{key:"collidedWithHelper",get:function(){return this.simulation.getFrames().some(function(a){return a.ball.collisions.some(function(a){return"helper"===a.type})})}}]),c}(Ra),Y=n(X.prototype,"running",[a.observable],{enumerable:!0,initializer:function(){return!1}}),Z=n(X.prototype,"runCount",[a.observable],{enumerable:!0,initializer:function(){return 0}}),$=n(X.prototype,"failCount",[a.observable],{enumerable:!0,initializer:function(){return 0}}),_=n(X.prototype,"showHintButton",[a.observable],{enumerable:!0,initializer:function(){return!1}}),aa=n(X.prototype,"useHintTrajectory",[a.observable],{enumerable:!0,initializer:function(){return!1}}),ba=n(X.prototype,"flashThrowArrow",[a.observable],{enumerable:!0,initializer:function(){return!1}}),ca=n(X.prototype,"flashHelper",[a.observable],{enumerable:!0,initializer:function(){return!1}}),da=n(X.prototype,"flashObstacle",[a.observable],{enumerable:!0,initializer:function(){return!1}}),ea=n(X.prototype,"flashHintButton",[a.observable],{enumerable:!0,initializer:function(){return!1}}),fa=n(X.prototype,"flashForceButton",[a.observable],{enumerable:!0,initializer:function(){return!1}}),ga=n(X.prototype,"flashTryAgainButton",[a.observable],{enumerable:!0,initializer:function(){return!1}}),n(X.prototype,"toggleRunning",[S],Object.getOwnPropertyDescriptor(X.prototype,"toggleRunning"),X.prototype),n(X.prototype,"setThrowArrowFlash",[T],Object.getOwnPropertyDescriptor(X.prototype,"setThrowArrowFlash"),X.prototype),n(X.prototype,"setHelperFlash",[U],Object.getOwnPropertyDescriptor(X.prototype,"setHelperFlash"),X.prototype),n(X.prototype,"setObstacleFlash",[V],Object.getOwnPropertyDescriptor(X.prototype,"setObstacleFlash"),X.prototype),n(X.prototype,"toggleHintTrajectory",[W],Object.getOwnPropertyDescriptor(X.prototype,"toggleHintTrajectory"),X.prototype),n(X.prototype,"frameIndex",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"frameIndex"),X.prototype),n(X.prototype,"initialFrame",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"initialFrame"),X.prototype),n(X.prototype,"currentFrame",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"currentFrame"),X.prototype),n(X.prototype,"scored",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"scored"),X.prototype),n(X.prototype,"failed",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"failed"),X.prototype),n(X.prototype,"timeSinceScored",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"timeSinceScored"),X.prototype),n(X.prototype,"timeSinceFailed",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"timeSinceFailed"),X.prototype),n(X.prototype,"collidedWithHelper",[a.computed],Object.getOwnPropertyDescriptor(X.prototype,"collidedWithHelper"),X.prototype),X),Ya=window.include,Za=Ya("springroll.Application"),$a=function(){function a(b){var c=this,d=b.onReady,e=b.onUpdate,f=b.onPause,g=b.onSoundEnd;ya(this,a),this.onSoundEnd=g;var h=new Za({name:"Mindy's Moonball",basePath:"assets/",configPath:"config/config.json",defaultAssetType:"pixi",audioTypes:["mp3"],swfPath:"swfs/",captionsPath:"audio/vo/captions.json"});window.app=h,this._app=h,h.on("pause",function(a){return f(a)}),h.on("update",function(a){return e(a)},300),h.on("init",function(){for(var a in h.config.animations.presets){var b=q(h.config.animations,h.config.animations.presets[a]);h.config.animations.presets[a]=b}o(h.config.baseLevel),h.config.pixelsPerMeter=h.config.baseLevel.ball.spriteWidth/h.config.baseLevel.ball.diameter;for(var e in h.config.levels){var f=h.config.levels[e];o(f)}var g=new Set;for(var i in h.config.levels){var j=!0,k=!1,l=void 0;try{for(var m,n=h.config.levels[i].obstacles[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var p=m.value,r=p.object;g.has(r)||(g.add(r),h.config.images.push({image:"images/obstacles/"+r+".png"}))}}catch(s){k=!0,l=s}finally{try{!j&&n["return"]&&n["return"]()}finally{if(k)throw l}}}c.activeSounds={},c._app.sound.setContextVolume("music",.3),h.load(h.config.images.filter(function(a){return a.preload}),{cacheAll:!0,complete:function(){d()}})})}return za(a,[{key:"loadAssets",value:function(a,b){var c=this,d=this._app,e=[];for(var f in this._app.config.sequences){var g=this._app.config.sequences[f],h=!0,i=!1,j=void 0;try{for(var k,l=g[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value,n=m.vo;"string"==typeof n?e.push(n):"random"in n&&Array.isArray(n.random)&&e.push.apply(e,Fa(n.random))}}catch(o){i=!0,j=o}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}}var p=Aa({},this._app.config.sounds.vo);p.sounds=e.map(function(a){return{id:a,src:a}}),this._app.sound.addContext(p);var q=[].concat(e,Fa(this._app.config.sounds.music.sounds.filter(function(a){return!a.preload}).map(function(a){return a.id})),Fa(this._app.config.sounds.sfx.sounds.filter(function(a){return!a.preload}).map(function(a){return a.id}))),r=0,s=0,t=function(){var e=(r+s)/(q.length+d.config.images.length);a(e),1===e&&(c._loadSpineAssets(),b())},u=!0,v=!1,w=void 0;try{for(var x,y=q[Symbol.iterator]();!(u=(x=y.next()).done);u=!0){var z=x.value;this._app.sound.preload(z,function(){r++,t()})}}catch(o){v=!0,w=o}finally{try{!u&&y["return"]&&y["return"]()}finally{if(v)throw w}}var A=!0,B=!1,C=void 0;try{for(var D,E=d.config.images[Symbol.iterator]();!(A=(D=E.next()).done);A=!0){var F=D.value;F.preload?s++:d.load(F,{cacheAll:!0,complete:function(){s++,t()}})}}catch(o){B=!0,C=o}finally{try{!A&&E["return"]&&E["return"]()}finally{if(B)throw C}}}},{key:"_loadSpineAssets",value:function(){var a=this.getCache("mindy-json"),b=this.getCache("mindy-atlas"),c=this.getCache("mindy-png"),d=a.front,e=a.side,f=b,g=new ua.spine.core.TextureAtlas(f,function(a,b){b(new ua.BaseTexture(c))}),h=new ua.spine.core.AtlasAttachmentLoader(g),i=new ua.spine.core.SkeletonJson(h),j=i.readSkeletonData(d),k=i.readSkeletonData(e);this.spineAssets={front:j,side:k};var l=function(a){var b={},c=!0,d=!1,e=void 0;try{for(var f,g=a.animations[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;b[h.name]=1e3*h.duration}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b};this.animationDurations={front:l(j),side:l(k)}}},{key:"getCache",value:function(a){return this._app.getCache(a)}},{key:"hasSound",value:function(a){return this._app.sound.isLoaded(a)}},{key:"getSoundDuration",value:function(a){return this._app.sound.getDuration(a)}},{key:"setMusic",value:function(a){this._app.music=a}},{key:"playSound",value:function(a,b){var c={};null!=b&&(c.volume=b),this._app.sound.play(a,c)}},{key:"stopSound",value:function(a){this._app.sound.stop(a)}},{key:"triggerSound",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;if(d in this.activeSounds);else{this.activeSounds[d]=!0;var e="world-trigger"===d?this._app.voPlayer:this._app.sound;e.play(a,function(){b._app.setTimeout(function(){delete b.activeSounds[d]},c)})}}},{key:"playVo",value:function(a,b){var c=this,d=new Promise(function(b){return c._app.voPlayer.play(a,b)});return d.then(function(){c.onSoundEnd()}),this.abortVo=b,d}},{key:"stopVo",value:function(){this.abortVo&&(this.abortVo(),this.abortVo=null),this._app.voPlayer.stop()}},{key:"getConfig",value:function(){return this._app.config}},{key:"getSequence",value:function(a){var b=this._app.config.sequences[a];if(!b)throw new Error("Sequence does not exist! "+a);return b}},{key:"getLevel",value:function(a){var b=this._app.config.levels[a];if(!b)throw new Error("level does not exist "+a);var c=p(this._app.config.baseLevel,b);return c}},{key:"getObstacleData",value:function(a){var b=this._app.config.obstacles[a];if(!b)throw new Error("obstacle does not exist "+a);return b}}]),a}(),_a="MindysMoonballGameState",ab=(ha=function(){function b(c){var d=this;ya(this,b),v(this,"mainMenuViewCount",ia,this),v(this,"levelScoreCount",ja,this),v(this,"levelStarCount",ka,this),this._worlds=c.getConfig().worlds;var e=!0,f=!1,g=void 0;try{for(var h,i=this._worlds.progression[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=!0,l=!1,m=void 0;try{for(var n,o=this._worlds[j].levels[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=n.value;this.levelScoreCount[p]=0}}catch(q){l=!0,m=q}finally{try{!k&&o["return"]&&o["return"]()}finally{if(l)throw m}}}}catch(q){f=!0,g=q}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}if(window.location.search.includes("reset"))window.localStorage.removeItem(_a);else{var r=window.localStorage.getItem(_a);r&&(this.json=JSON.parse(r))}a.autorun(function(){window.localStorage.setItem(_a,JSON.stringify(d.json))},{name:"save-state"})}return za(b,[{key:"incMainMenuViewCount",value:function(){this.mainMenuViewCount++}},{key:"incLevelScoreCount",value:function(a){this.levelScoreCount[a]++}},{key:"setLevelStarCount",value:function(a,b){this.levelStarCount[a]=b}},{key:"unlockedWorlds",get:function(){var a=this,b={},c=!0,d=!0,e=!1,f=void 0;try{for(var g,h=this._worlds.progression[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;if(!c)break;b[i]=!0,c=this._worlds[i].levels.every(function(b){return a.levelScoreCount[b]>0})}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return b}},{key:"unlockedLevels",get:function(){var a={};for(var b in this.unlockedWorlds){var c=!0,d=!0,e=!1,f=void 0;try{for(var g,h=this._worlds[b].levels[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;if(!c)break;a[i]=!0,c=this.levelScoreCount[i]>0}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}}return a}},{key:"json",get:function(){var a=this.levelScoreCount,b=this.levelStarCount;return{levelScoreCount:a,levelStarCount:b}},set:function(a){var b=a.levelScoreCount,c=a.levelStarCount;this.levelScoreCount=b,this.levelStarCount=c}}]),b}(),ia=w(ha.prototype,"mainMenuViewCount",[a.observable],{enumerable:!0,initializer:function(){return 0}}),ja=w(ha.prototype,"levelScoreCount",[a.observable],{enumerable:!0,initializer:function(){return{}}}),ka=w(ha.prototype,"levelStarCount",[a.observable],{enumerable:!0,initializer:function(){return{}}}),w(ha.prototype,"incMainMenuViewCount",[a.action],Object.getOwnPropertyDescriptor(ha.prototype,"incMainMenuViewCount"),ha.prototype),w(ha.prototype,"incLevelScoreCount",[a.action],Object.getOwnPropertyDescriptor(ha.prototype,"incLevelScoreCount"),ha.prototype),w(ha.prototype,"setLevelStarCount",[a.action],Object.getOwnPropertyDescriptor(ha.prototype,"setLevelStarCount"),ha.prototype),w(ha.prototype,"unlockedWorlds",[a.computed],Object.getOwnPropertyDescriptor(ha.prototype,"unlockedWorlds"),ha.prototype),w(ha.prototype,"unlockedLevels",[a.computed],Object.getOwnPropertyDescriptor(ha.prototype,"unlockedLevels"),ha.prototype),w(ha.prototype,"json",[a.computed],Object.getOwnPropertyDescriptor(ha.prototype,"json"),ha.prototype),ha),bb=(la=function(){function a(){var b=this;ya(this,a),v(this,"app",ma,this),v(this,"paused",na,this),v(this,"time",oa,this),v(this,"xOffset",pa,this),this._timeLastActive=0,v(this,"seqActive",qa,this),this.gameStore=null,v(this,"state",ra,this),v(this,"handleResize",sa,this),this.ping=function(){b._timeLastActive=b.time},this.stage=document.getElementsByTagName("canvas")[0],this.handleResize(),window.addEventListener("resize",this.handleResize),window.addEventListener("mousedown",this.ping),window.addEventListener("mouseup",this.ping),window.addEventListener("mousemove",this.ping),window.addEventListener("touchstart",this.ping),window.addEventListener("touchend",this.ping),window.addEventListener("touchmove",this.ping)}return za(a,[{key:"enterState",value:function(a){this.state.dispose(),this.state=a,this.ping()}},{key:"setReady",value:function(a){this.app=a,this.gameStore=new ab(a),this.ping()}},{key:"setPause",value:function(a){this.paused=a,this.ping()}},{key:"updateTime",value:function(a){this.time+=a,this.seqActive&&(this._timeLastActive=this.time)}},{key:"playSequence",value:function(a){var b=this;this.seqActive&&this.stopSequences();var c=this.app.getSequence(a),d=u(this,c,this.state.getName()),e=d.voSeq,f=d.handleAbort,g=this.app.playVo(e,f);return this.seqActive=!0,g.then(function(){return b.seqActive=!1}),g}},{key:"stopSequences",value:function(){this.app.stopVo(),this.seqActive=!1}},{key:"timeLastActive",get:function(){return this.time-this._timeLastActive}}]),a}(),ma=w(la.prototype,"app",[a.observable],{enumerable:!0,initializer:function(){return null}}),na=w(la.prototype,"paused",[a.observable],{enumerable:!0,initializer:function(){return!1}}),oa=w(la.prototype,"time",[a.observable],{enumerable:!0,initializer:function(){return 0}}),pa=w(la.prototype,"xOffset",[a.observable],{enumerable:!0,initializer:function(){return 0}}),qa=w(la.prototype,"seqActive",[a.observable],{enumerable:!0,initializer:function(){return!1}}),ra=w(la.prototype,"state",[a.observable],{enumerable:!0,initializer:function(){return new Sa(this)}}),sa=w(la.prototype,"handleResize",[a.action],{enumerable:!0,initializer:function(){var a=this;return function(){var b=a.stage.clientWidth,c=Math.max(0,b-window.innerWidth)/2;a.xOffset=c/b*1280}}}),w(la.prototype,"timeLastActive",[a.computed],Object.getOwnPropertyDescriptor(la.prototype,"timeLastActive"),la.prototype),w(la.prototype,"enterState",[a.action],Object.getOwnPropertyDescriptor(la.prototype,"enterState"),la.prototype),w(la.prototype,"setReady",[a.action],Object.getOwnPropertyDescriptor(la.prototype,"setReady"),la.prototype),w(la.prototype,"setPause",[a.action],Object.getOwnPropertyDescriptor(la.prototype,"setPause"),la.prototype),w(la.prototype,"updateTime",[a.action],Object.getOwnPropertyDescriptor(la.prototype,"updateTime"),la.prototype),la);PIXI.spine.Spine.globalAutoUpdate=!1;var cb,db,eb,fb,gb=b.PixiComponent("Spine",{create:function(a){var b=a.data,c=new PIXI.spine.Spine(b);return c.state.addListener({complete:function(b){a.onEnd()}}),c},willUnmount:function(a){a.state.clearListeners()},applyProps:function(a,b,c){if(b.visible!==c.visible&&(a.visible=c.visible),!b.visible&&c.visible)a.state.setAnimation(0,c.animation,c.loop),a.update(0);else if(c.visible&&(b.entry!==c.entry&&a.state.setAnimation(0,c.animation,c.loop),b.time!==c.time)){var d=(c.time-b.time)/1e3;a.update(d)}}}),hb=function(a){function c(a){ya(this,c);var b=Da(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a));return b.handleEnd=function(){b.index<b.props.animSeq.length-1&&b.index++},b.index=0,b}return Ba(c,a),za(c,[{key:"componentWillReceiveProps",value:function(a){this.props.animSeq!==a.animSeq&&(this.index=0)}},{key:"render",value:function(){var a=this,c=this.props,d=c.store,e=c.animSeq,f=Ca(c,["store","animSeq"]),g=d,h=(g.state,g.app.spineAssets),i=(h.front,h.side,e[this.index]),j=Ea(i,2),k=j[0],l=j[1];return va.createElement(b.Container,f,["side","front"].map(function(b){return va.createElement(gb,{key:b,entry:i,visible:k===b,time:g.time,data:g.app.spineAssets[b],animation:l,onEnd:a.handleEnd,loop:a.index===e.length-1})}))}}]),c}(va.Component),ib=e.observer(hb),jb=new PIXI.filters.OutlineFilter(2,16777215),kb=b.PixiComponent("Trajectory",{create:function(a){return new PIXI.Graphics},applyProps:function(a,b,c){if(b.trajectory!==c.trajectory||b.cheat!==c.cheat){var d=c.trajectory,e=c.scale,f=c.cheat;a.clear(),a.beginFill(f?65280:16777215);var g=!0,h=!1,i=void 0;try{for(var j,k=d.entries()[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value,m=Ea(l,2),n=m[0],o=m[1];if(0!==n){var p=3.5*Math.pow((d.length-n)/d.length,.3);a.drawCircle(e*o.x,-e*o.y,p)}}}catch(q){h=!0,i=q}finally{try{!g&&k["return"]&&k["return"]()}finally{if(h)throw i}}a.endFill()}}}),lb=e.observer(function(a){var c=a.state,d=a.scale,e=a.cheat,f=e?c.simulation.cheatTrajectory:c.simulation.trajectory;return va.createElement(b.Container,{y:800},va.createElement(kb,{trajectory:f,scale:d,cheat:e}))}),mb=e.observer(x),nb=new PIXI.TextStyle({fontFamily:"Komika",fontSize:40,padding:5,fill:"#ffdd33"}),ob=new PIXI.TextStyle({fontFamily:"Komika",fontSize:40,padding:5,fill:"#dddddd"}),pb=new PIXI.TextStyle({fontFamily:"Komika",fontSize:24,padding:5,fill:"#ffdd33"}),qb=function(a){var d=a.store,e=a.unlocked,f=a.name,g=a.numStars,h=a.starCount,i=a.x,j=a.y,k=a.disabled,l=Ca(a,["store","unlocked","name","numStars","starCount","x","y","disabled"]);return React.createElement(b.Container,{x:i,y:j},React.createElement(Ga,Aa({},l,{anchor:new c.Point(.5,.5),disabled:k||!e,spriteSheet:e?{up:d.app.getCache("btn-level"),down:d.app.getCache("btn-level-hover")}:d.app.getCache("btn-level-disabled"),onDown:function(){return d.app.triggerSound("button-state-change");
}})),React.createElement(b.Text,{style:e?nb:ob,y:-17,anchor:new c.Point(.5,.5),text:f}),Array(g).fill(0).map(function(a,f){return React.createElement(b.Sprite,{key:f,anchor:new c.Point(.5,.5),x:100*((f+1)/(g+1)-.5),y:25,texture:d.app.getCache(e?h>f?"star-small":"star-small-outline":"star-small-disabled")})}))},rb=e.observer(y),sb=function(a){function b(a){ya(this,b);var c=Da(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.timeOfMount=c.props.time+(c.props.delay||0),c}return Ba(b,a),za(b,[{key:"render",value:function(){var a=this.props.time-this.timeOfMount;return a>=0?this.props.children(a):null}}]),b}(va.Component),tb=b.PixiComponent("OverlayBackground",{create:function(a){var b=new PIXI.Graphics;return b.beginFill(0,.6),b.drawRect(0,0,1280,800),b.endFill(),b}}),ub=b.PixiComponent("ForceBar",{create:function(a){return new PIXI.Graphics},applyProps:function(a,b,c){if(b.forceLevel!==c.forceLevel||b.forceLevels!==c.forceLevels){a.clear();for(var d=c.forceLevel,e=c.forceLevels,f=e,g=.4,h=92/(f+g*f+g),i=0;f>i;i++){a.beginFill(d>i?1549653:9803157);var j=(g+i*(1+g))*h;a.drawRect(j,0,h,30),a.endFill()}}}}),vb=1e3/60*10,wb=1e3,xb=e.observer(z),yb=2.3999632297286535,zb=function(a){function d(a){ya(this,d);var b=Da(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a));return b.zoomBlurFilter=new PIXI.filters.ZoomBlurFilter(.5,[640,400,0]),b.preBright=new PIXI.filters.ColorMatrixFilter,b.postBright=new PIXI.filters.ColorMatrixFilter,b.filters=[b.preBright,b.zoomBlurFilter,b.postBright],b}return Ba(d,a),za(d,[{key:"render",value:function(){var a=this.props,d=a.time,e=a.app,f=a.world,g=e.getConfig().warp,h=1e3*g.duration,i=h*g.slowApproach,j=h/2,k=d;if(k>i){var l=h-i;k=i+l*(1-Math.exp(-(k-i)/l))}var m=g.topSpeed/60/j,n=m*k,o=.5*m*k*k;if(k>j){var p=k-j;n=m*j-m*p,o=.5*m*j*j+m*j*p-.5*m*p*p}n*=g.zoomBlurIntensity;var q=Math.floor(o),r=Math.pow(2,o%1-1),s=Math.exp(.005*(k-h));return this.preBright.brightness(1+2*n),this.zoomBlurFilter.strength=n/2,this.postBright.brightness(1+8*n),va.createElement(b.Container,null,va.createElement(b.Container,{filters:this.filters},va.createElement(b.Sprite,{x:640,y:400,rotation:yb*q,anchor:new c.Point(.5,.5),scale:new c.Point(2*r,2*r),texture:e.getCache("bg-recursive")}),va.createElement(b.Sprite,{x:640,y:400,rotation:yb*(q+1),anchor:new c.Point(.5,.5),scale:new c.Point(r,r),texture:e.getCache("bg-recursive")})),va.createElement(b.Sprite,{x:640,y:400,anchor:new c.Point(.5,.5),scale:new c.Point(s,s),texture:e.getCache("world-large-"+f)}))}}]),d}(va.Component),Ab=new PIXI.TextStyle({fontFamily:"Komika",fontSize:60,padding:10,fill:"#ffdd33",stroke:"#333333",strokeThickness:5}),Bb=e.observer(A),Cb=302,Db=135,Eb=400,Fb=400,Gb=-Eb,Hb=800+Fb,Ib=3,Jb=1280-Ib*Cb,Kb=800-Ib*Db,Lb=e.observer(cb=function(a){function e(a){ya(this,e);var b=Da(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a));return b.mask=new PIXI.Graphics,b.renderMask(),b}return Ba(e,a),za(e,[{key:"componentDidUpdate",value:function(a){this.renderMask()}},{key:"renderMask",value:function(){var a=this.props.state,b=Gb+a.time*(1280+Eb),c=Hb-a.time*(800+Fb);this.mask.clear(),this.mask.beginFill(0),this.mask.moveTo(-Ib*Cb+b,-Ib*Db+c),this.mask.lineTo(Ib*Cb+b,Ib*Db+c),this.mask.lineTo(Ib*Cb+b,Ib*Db+c+Kb),this.mask.lineTo(-Ib*Cb+b-Jb,Ib*Db+c+Kb),this.mask.lineTo(-Ib*Cb+b-Jb,-Ib*Db+c),this.mask.endFill()}},{key:"render",value:function(){var a=this.props,e=a.state,f=a.inView,g=a.outView;e.time;return va.createElement(d.Fragment,null,g,va.createElement(b.Container,{mask:this.mask},f),va.createElement(b.Sprite,{anchor:new c.Point(.35,.84),x:Gb+e.time*(1280+Eb),y:Hb-e.time*(800+Fb),texture:e.root.app.getCache("transition-sunspot")}))}}]),e}(va.Component))||cb,Mb=new PIXI.TextStyle({fontFamily:"Komika",fontSize:60,padding:10,fill:"#ffdd33"}),Nb=e.observer(B),Ob=(eb=db=function(){function b(c){var d=this;ya(this,b),fb.call(this),this.store=c,a.reaction(function(){return c.state},this.onStateChange,{fireImmediately:!0,name:"sequencerStateChange"});var e=1e3*c.app.getConfig().timings.idleTimeout;a.reaction(function(){return Math.floor(c.timeLastActive/e)},function(a){return a>0&&d.timeout&&d.timeout()},{name:"sequencerTimeout"})}return za(b,[{key:"setReaction",value:function(b,c){var d=a.reaction(b,c);this.disposeFns.push(d)}},{key:"setWhen",value:function(b,c){var d=a.when(b);d.then(c)["catch"](function(){}),this.disposeFns.push(function(){return d.cancel()})}},{key:"setTimeout",value:function(a){this.timeout=a}},{key:"createScaffold",value:function(a){var b=this.store,c=(this.store.app,a.levelData);switch(c.scaffold.type){case"GenericIntro":var d=c.scaffold,e=d.introSequence,f=d.idleSequences;return b.playSequence(e),f;default:alert("Unknown scaffold type: "+c.scaffold.type)}}},{key:"setupHints",value:function(a){var b=this,c=this.store,d=this.store.app,e=a.levelData,f=d.getConfig().hints,g=f.offset,h=f.period,i=f.forceGeneric,j=f.forceAssist,k=f.throwAngleGeneric,l=f.throwAngleAssist,m=void 0,n=0,o=void 0,p=0;if(e.hints){var q=e.hints,r=q.throwAngleRange,s=q.force;r&&(o=r,p=k+l),s&&(m=s,n=i+j)}this.setReaction(function(){return a.running},function(d){if(b.recentlyFailed&&!d&&a.failCount>=g&&(a.failCount-g)%h===0)if(null!=m&&n>0&&a.simulation.forceLevel!==m)n>j?c.playSequence("forcePromptGeneral"):(a.simulation.forceLevel>m&&c.playSequence("forcePromptLess"),a.simulation.forceLevel<m&&c.playSequence("forcePromptMore")),n--;else{var e=!1,f=!1;if(null!=o&&p>0){var i=o,k=Ea(i,2),q=k[0],r=k[1];e=a.simulation.throwAngle<q,f=a.simulation.throwAngle>r}e||f?(p>l?c.playSequence("scaffoldBallDifferent"):(e&&c.playSequence("scaffoldBallHigher"),f&&c.playSequence("scaffoldBallLower")),p--):a.showHintButton||(a.showHintButton=!0,c.playSequence("hintPrompt"))}})}}]),b}(),fb=function(){var a=this;this.disposeFns=[],this.onStateChange=function(b){var c=a.store,d=a.store.app;if(c.stopSequences(),a.disposeFns.forEach(function(a){return a()}),a.disposeFns.length=0,a.setTimeout(null),b instanceof Va&&1===c.gameStore.mainMenuViewCount){b.voActive=!0;var e=c.playSequence("gameIntro");0===c.gameStore.levelScoreCount["earth-1"]&&(e=e.then(function(){return c.playSequence("buttonPromptEarthFirstTime")}),a.setTimeout(function(){b.voActive=!0,c.playSequence("buttonPromptFirst").then(function(){return b.voActive=!1})})),e.then(function(){return b.voActive=!1})}if(b instanceof Xa){var f=b.levelData,g=b.root.gameStore.levelScoreCount[b.levelName]>0,h=f.idleSequences,i=0;if(!g&&f.scaffold){var j=a.createScaffold(b);j&&(h=j)}else f.introSequence&&c.playSequence(f.introSequence);a.setTimeout(function(){if(!b.running&&h){var a=h[i];c.playSequence(a),i=(i+1)%h.length}else b.scored?c.playSequence("successLevel"):b.failed&&c.playSequence("overlayTryAgain")}),a.recentlyFailed=!1,a.setReaction(function(){return b.scored},function(d){d&&(a.recentlyFailed=!1,c.playSequence("successRandom").then(function(){switch(b.currentFrame.getStarCount()){case 1:c.playSequence("starWinOne");break;case 2:c.playSequence("starWinTwo");break;case 3:c.playSequence("starWinThree")}}))}),a.setReaction(function(){return b.failed},function(b){b&&(a.recentlyFailed=!0,c.playSequence("scaffoldGeneric"))}),a.setupHints(b),a.setReaction(function(){return b.running},function(a){c.stopSequences()})}b instanceof Wa&&d.playVo("travel-progress")}},eb),Pb=function(){function b(a){return c.apply(this,arguments)}var c=xa(regeneratorRuntime.mark(function d(b){var c,e;return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,a.when(function(){return null!=b.app});case 2:c=b.app,e=new Ob(b);case 4:case"end":return d.stop()}},d,this)}));return b}(),Qb=function(){var b=xa(regeneratorRuntime.mark(function c(b){var d;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,a.when(function(){return!!b.app});case 2:d=b.app._app.sound._markLoaded,b.app._app.sound._markLoaded=function(a){return a&&d(a)},D(function(a){var c=[],d=t(b.app,a,c);if(d)return void alert(d);var e=Aa({},b.app.getConfig().sounds.vo);e.sounds=c.map(function(a){return{id:a,src:a}}),b.app._app.sound.addContext(e),b.app._app.sound.preload(c,function(){var d=!0,e=!1,f=void 0;try{for(var g,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;if(!b.app.hasSound(i))return void alert("Sound does not exist: "+i)}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}var k=u(b,a,b.state instanceof Xa?"level":"menu"),l=k.voSeq,m=k.handleAbort;b.app.stopVo();b.app.playVo(l,m)})});case 5:case"end":return c.stop()}},c,this)}));return function(a){return b.apply(this,arguments)}}(),Rb=new bb,Sb=C();document.addEventListener("contextmenu",function(a){return a.preventDefault()}),window.location.search.includes("designer")&&E(Rb),a.autorun(function(){return Sb.ticker.update(Rb.time)}),ta.render(React.createElement(Nb,{store:Rb}),Sb.stage);var Tb=new $a({onReady:function(){return Rb.setReady(Tb)},onUpdate:function(a){return Rb.updateTime(a)},onPause:function(a){return Rb.setPause(a)},onSoundEnd:function(){return Rb.ping()}});window.location.search.includes("sequenceDesigner")?Qb(Rb):Pb(Rb);var Ub=void 0;a.reaction(function(){return Rb.state},function(a){var b=null;a instanceof Xa&&(b=a.levelData.music),a instanceof Va&&(b="music-menu"),a instanceof Ua&&Tb.playSound("sunspot-transit"),Ub instanceof Wa&&Tb.stopSound("planet-transition-11secs"),a instanceof Wa&&Tb.playSound("planet-transition-11secs"),Tb.setMusic(b),Ub=a});var Vb=0,Wb=0;a.reaction(function(){return Rb.state instanceof Xa&&Rb.state.currentFrame},function(a){if(Rb.state instanceof Xa&&a){var b=a.getStarCount();if(b>Wb&&Tb.playSound("star-hit"),Wb=b,Rb.state.scored){var c=Rb.gameStore.levelStarCount[Rb.state.levelName];(null==c||b>c)&&Rb.gameStore.setLevelStarCount(Rb.state.levelName,b)}}if(Rb.state instanceof Xa&&a){for(var d=Rb.state.simulation.getFrames(),e=new Map,f=Rb.state.frameIndex,g=Vb+1;f>=g&&g<d.length;g++){var h=d[g],i=!0,j=!1,k=void 0;try{for(var l,m=h.ball.collisions[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;if(n.initial){var o=Math.min(1,.1*n.impulse);switch(n.data.type){case"backboard":e.set("basketball-backboard",o);break;default:e.set("basketball-bounce",o)}}}}catch(p){j=!0,k=p}finally{try{!i&&m["return"]&&m["return"]()}finally{if(j)throw k}}0===h.framesSinceScored&&e.set("basketball-swish",1)}var q=!0,r=!1,s=void 0;try{for(var t,u=e[Symbol.iterator]();!(q=(t=u.next()).done);q=!0){var v=t.value,w=Ea(v,2),x=w[0],y=w[1];Tb.playSound(x,y)}}catch(p){r=!0,s=p}finally{try{!q&&u["return"]&&u["return"]()}finally{if(r)throw s}}Vb=f}},{name:"frameReaction"})}(mobx,ReactPixi,PIXI,React,mobxReact,null,planck);