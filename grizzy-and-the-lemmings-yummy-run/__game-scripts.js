var SplineManager=pc.createScript("splineManager");SplineManager.prototype.initialize=function(){this.p1=new pc.Vec3,this.p2=new pc.Vec3,this.allPoints=[],this.evtBus=new pc.EventHandler,this.isInitialized=!1,this.sections=[],this.firstPointInsections={}},SplineManager.prototype.addPoints=function(t){this.sections.push(t);for(var n=[],e=0;e<t.children.length;e++)0===e&&(this.firstPointInsections[t.getGuid()]=t.children[e].getPosition()),this.AddPointToArray(t.children[e]),n.push(t.children[e].getPosition());return n},SplineManager.prototype.removePoints=function(t){var n=this.sections.indexOf(t);-1!==n&&this.sections.splice(n,1);for(var e=0;e<t.children.length;e++)this.removePointFromArray(t.children[e])},SplineManager.prototype.removePointFromArray=function(t){for(var n=this.allPoints.length-1;n>=0;n--)if(this.allPoints[n].equals(t.getPosition())){this.allPoints.splice(n,1);break}},SplineManager.prototype.AddPointToArray=function(t){t.model.enabled=!1,this.allPoints.push(t.getPosition())},SplineManager.prototype.getDirection=function(t){var n=this.getPreviousAndNextWayMarkers(t);return this.p1.sub2(n.end,n.start)},SplineManager.prototype.getStartDirection=function(){return this.getDirection(this.getStartPoint())},SplineManager.prototype.getStartPoint=function(){return this.allPoints[1]},SplineManager.prototype.firstPointInLastSection=function(){var t=Math.floor(this.allPoints.length/3)+Math.floor(this.allPoints.length/3*Math.random());return console.log(t,this.allPoints.length),this.allPoints[t].clone()},SplineManager.prototype.placeObs=function(t,n,e,i){var o=this.getClosestPointOnSpline(t,e,i),s=o.pos,r=o.waymarkers,a=(new pc.Vec3).sub2(r.end,r.start).normalize().scale(n);return np=s.add(a),np},SplineManager.prototype.progress=function(t,n,e,i){var o=this.getClosestPointOnSpline(t,e,i),s=o.pos,r=o.waymarkers,a=(new pc.Vec3).sub2(r.end,r.start).normalize().scale(n);return np=s.add(a),n<0&&(np=this.getClosestPointOnSpline(np.clone(),!1,i).pos),np},SplineManager.prototype.getSubPoints=function(t,n,e){var i=this.getPreviousAndNextWayMarkers(t,e),o=this.allPoints.indexOf(i.start)-n,s=this.allPoints.indexOf(i.end)+n;o=Math.max(o,0),s=Math.max(s,this.allPoints.length-1);this.allPoints.slice(o,s)},SplineManager.prototype.getClosestPointOnSpline=function(t,n,e){var i=this.getPreviousAndNextWayMarkers(t,n,e);return{pos:this.closestPointToPoint(i.start,i.end,t,!0),waymarkers:i}},SplineManager.prototype.getPreviousAndNextWayMarkers=function(t,n,e){for(var i=0,o=new pc.Vec3,s=new pc.Vec3,r=e||this.allPoints,a=r[0].clone(),l=0;l<r.length;l++){var p=r[l];this.p1.sub2(p,t).lengthSq()<this.p2.sub2(a,t).lengthSq()&&(i=l,a=r[l].clone())}if(0===i)o=r[0].clone(),s=r[1].clone();else{if(i===r.length-1)return this.evtBus.fire("atEnd"),{start:r[r.length-2].clone(),end:r[r.length-1].clone()};if(n)for(var c in this.firstPointInsections)this.firstPointInsections[c].equals(a)&&this.atfirstPointInSection(c);var h=r[i+1].clone(),g=r[i-1].clone();this.p1.sub2(g,a).lengthSq()>this.p2.sub2(g,t).lengthSq()?(o=g,s=a):(o=a,s=h)}return{start:o,end:s}},SplineManager.prototype.atfirstPointInSection=function(t){if(this.currentSection!==t){this.currentSection=t;for(var n=0;n<this.sections.length;n++)if(this.sections[n].getGuid()==t&&n>1){var e=this.sections[0];this.removePoints(e),this.evtBus.fire("newSection",e);break}}},SplineManager.prototype.closestPointToPointParameter=function(t,n,e,i){var o=(new pc.Vec3).sub2(e,t),s=(new pc.Vec3).sub2(n,t),r=s.dot(s),a=s.dot(o)/r;return i&&(a=Math.min(Math.max(a,0),1)),a},SplineManager.prototype.closestPointToPoint=function(t,n,e,i){var o=this.closestPointToPointParameter(t,n,e,i);return(new pc.Vec3).sub2(n,t).scale(o).add(t)};var PathFollower=pc.createScript("pathFollower");PathFollower.attributes.add("frontPos",{type:"entity",title:"frontPos",description:"All the points"}),PathFollower.attributes.add("splineManagerInst",{type:"entity",title:"splineManagerInstance",description:"splineManagerInst"}),PathFollower.attributes.add("rearPos",{type:"entity",title:"rearPos",description:"All the points"}),PathFollower.attributes.add("speed",{type:"number",title:"speed",default:1}),PathFollower.attributes.add("maxQuadCurveDist",{type:"number",title:"maxQuadCurveDist",default:10}),PathFollower.prototype.initialize=function(){this.splineManager=this.splineManagerInst.script.get("splineManager"),this.isPlayer=!1,this.followRear=!1,this.totalDistTravelled=0,this.frm=0},PathFollower.prototype.startFollowFront=function(t,s){this.startPoint=t.clone(),this.totalDistTravelled=0,this.entity.setPosition(t),this.updatePos=!0,this.directionOfTravel=this.splineManager.getDirection(t.clone()),this.fPos=this.startPoint.clone(),this.rPos=this.startPoint.clone(),this.camPosF=this.startPoint.clone(),this.camPosC=this.startPoint.clone(),this.rearCountdown=0,this.isPlayer=s},PathFollower.prototype.startFollowRear=function(){this.followRear=!0},PathFollower.prototype.resetPos=function(t){this.startFollowFront(t,!1)},PathFollower.prototype.follow=function(t){if(!0===this.updatePos&&!1===this.app.eol&&this.app.systemPaused<=0&&!1===this.app.userPaused){var s=this.fPos.clone();if(this.frm++,this.frm%2==0){if(this.directionOfTravel&&this.lastPos){var i=this.lastPos.clone().add(this.directionOfTravel.clone().scale(.5));this.totalDistTravelled+=this.entity.getPosition().clone().sub(i).length(),this.entity.setPosition(i)}}else{var e=this.splineManager.getSubPoints(this.fPos,2,this.isPlayer);if(this.fPos=this.splineManager.progress(this.fPos,2*this.speed*(1/60),!1,e),this.followRear){this.rPos.clone();this.rPos=this.splineManager.progress(this.fPos,-this.maxQuadCurveDist,e),this.rearPos.setPosition(this.rPos);i=this.fPos.clone().add(this.rPos).scale(.5);this.totalDistTravelled+=this.entity.getPosition().clone().sub(i).length(),this.entity.setPosition(i),this.lastPos=i,this.directionOfTravel=this.fPos.clone().sub(s)}else this.entity.setPosition(this.startPoint),this.rearCountdown+=t,this.rearCountdown>=this.maxQuadCurveDist/this.speed&&this.startFollowRear();this.frontPos.setPosition(this.fPos),this.entity.lookAt(this.fPos)}}};var Player=pc.createScript("player");Player.attributes.add("target",{type:"entity",title:"followObject"}),Player.attributes.add("displayEntity",{type:"entity",title:"displayEntity"}),Player.attributes.add("cameraFollow",{type:"entity",title:"camera"}),Player.attributes.add("opponentEntity",{type:"entity",title:"opponentEntity"}),Player.attributes.add("ui",{type:"entity",title:"ui"}),Player.prototype.start=function(){this.inGameHud=this.ui.script.get("inGameHud"),this.camera=this.cameraFollow.script.get("cameraFollow"),this.isChangingLanes=!1,this.offset=2,this.pathFollowerInst=this.target.script.get("pathFollower"),this.pathFollowerInst.splineManager.evtBus.on("atEnd",this.endOfTheLine,this),this.pathFollowerInst.startFollowFront(this.pathFollowerInst.splineManager.getStartPoint(),!0),this.lookAtPos=new pc.Vec3,this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.entity.collision.on("triggerleave",this.onTriggerExit,this),this.setInitialPosition=!1,this.changeLanes=!1,this.jumpTime=200,this.jumpDelayedCall=null,this.currentPosition=2,this.isBoosting=!1,this.isJumping=!1,this.startTime=Date.now(),this.isInvincible=!1,this.sounds=this.entity.sound,this.progressionSpeed=0,this.changeLanesDelayedCall=null,this.isTouchingTruck=!1,this.hitTruck=!1,this.isPointerDown=!1,this.keyDown=!1},Player.prototype.checkPosition=function(t){var e=this.opponentEntity.getPosition();this.pathFollowerInst.fPos.clone().sub(e).lengthSq()<this.pathFollowerInst.rPos.clone().sub(e).lengthSq()?this.app.transData.tempRaceData.highestPosition=this.currentPosition=2:this.app.transData.tempRaceData.highestPosition=this.currentPosition=1},Player.prototype.initialize=function(){this.isUsingTouch=!1;var t=this.app.touch,e=this.app.mouse;this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this),e&&(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)),t&&(t.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this))},Player.prototype.endOfTheLine=function(){},Player.prototype.endHasCollected=function(){this.hasCollected=!1},Player.prototype.onTriggerExit=function(t){"Truck"===t.name&&(this.isTouchingTruck=!1)},Player.prototype.onTriggerEnter=function(t){"collectable"===t.name&&(t.script.get("collectable").collect(),this.sounds.play("jar_pickup"),this.app.transData.tempRaceData.jars++,this.hasCollected=!0,this.entity.delayedCall(.5,this.endHasCollected,this),this.app.transData.tempRaceData.jars%6==0&&(!1===this.isTouchingTruck&&(this.isBoosting=!0,this.playCharacterSound("boost"),this.startInvincible(1,{r:.3,g:.3,b:1,a:.8}),this.camera.shake(.02,1),this.entity.delayedCall(1,this.endBoost.bind(this))),this.app.transData.tempRaceData.boosts++)),"TargetTruck"===t.name&&(this.app.transData.tempRaceData.fastestTime=Math.round((Date.now()-this.startTime)/1e3),this.entity.fire("complete")),"Truck"===t.name&&(this.isTouchingTruck=!0,this.hitTruck=!0,this.hitTruckCall&&this.hitTruckCall.kill(),this.hitTruckCall=this.entity.delayedCall(.5,this.hitTruckFalse,this),this.checkStable(!0),this.sounds.play("crash_truck"),this.isBoosting=!1,!0===this.isChangingLanes?((this.offset<0&&t.script.get("truck").isLeft||this.offset>0&&!t.script.get("truck").isLeft)&&(this.changeLanes=!0),this.pathFollowerInst.speed=-.2*this.pathFollowerInst.speed):this.pathFollowerInst.speed=-.3*this.pathFollowerInst.speed),this.isBoosting||!1===this.isJumping&&("logModel"===t.name&&(this.sounds.play("crash_logs"),this.startUnstable(),this.changeLanes=!0),"holeModel"===t.name&&(this.sounds.play("crash_pothole"),this.startUnstable()))},Player.prototype.startUnstable=function(){this.checkStable(),this.unstable=!0,this.entity.delayedCall(2.5,this.stopUnstable,this),this.displayEntity.script.get("playerDisplay").unstable(),this.pathFollowerInst.speed=0},Player.prototype.stopUnstable=function(){this.unstable=!1,this.displayEntity.script.get("playerDisplay").resumeNormalDriving()},Player.prototype.endBoost=function(){this.isBoosting=!1},Player.prototype.checkStable=function(t){!0===this.unstable?this.isInvincible||(this.app.transData.tempRaceData.furthestDistance=Math.round(this.pathFollowerInst.totalDistTravelled),this.entity.fire("dead")):(t||this.startInvincible(1,{r:1,g:.3,b:.3,a:.8}),this.camera.shake(.2,.2))},Player.prototype.hitTruckFalse=function(){this.hitTruck=!1},Player.prototype.startInvincible=function(t,e){this.isInvincible=!0,this.entity.delayedCall(t,this.stopInvincible,this),this.displayEntity.script.get("playerDisplay").showInvincible(e)},Player.prototype.stopInvincible=function(){this.isInvincible=!1,this.displayEntity.script.get("playerDisplay").hideInivincible()},Player.prototype.update=function(t){if(this.pathFollowerInst.follow(t),(this.isPointerDown||this.keyDown)&&Date.now()-this.mouseDownTime>this.jumpTime&&this.inGameHud.movementIndicator.showJump(),!1===this.isPointerDown&&!1===this.keyDown&&this.inGameHud.movementIndicator.hideJump(),!0===this.pathFollowerInst.updatePos){4==this.app.transData.selectedLevel&&(this.progressionSpeed=this.pathFollowerInst.totalDistTravelled/1e3);var e=this.target.getPosition().add(this.target.right.clone().scale(this.offset).add(this.target.forward.clone().scale(-1))),i=this.entity.getPosition(),s=(new pc.Vec3).lerp(i,e,8*t),o=this.pathFollowerInst.splineManager.getClosestPointOnSpline(this.target.getPosition().add(this.target.forward.scale(5))).pos;o.sub(this.target.getPosition()),this.lookAtPos=(new pc.Vec3).lerp(this.lookAtPos,o,2*t),!1===this.setInitialPosition?(this.entity.setPosition(e),this.entity.lookAt(this.entity.getPosition().clone().add(o)),this.setInitialPosition=!0,this.camera.setInitialPosition(),this.playCharacterSound("moving",!0)):(this.entity.setPosition(s),this.lookAtPos=(new pc.Vec3).lerp(this.lookAtPos,o,2*t),this.entity.lookAt(this.entity.getPosition().clone().add(this.lookAtPos))),this.checkPosition()}this.isBoosting?this.pathFollowerInst.speed=38+this.progressionSpeed:this.pathFollowerInst.speed+=(24+this.progressionSpeed-this.pathFollowerInst.speed)*t,!0===this.changeLanes&&(this.changeLanesDelayedCall&&this.changeLanesDelayedCall.kill(),this.sounds.play("change_lanes"),this.offset*=-1,this.isChangingLanes=!0,this.changeLanesDelayedCall=this.entity.delayedCall(.5,this.laneSwitchComplete,this),this.displayEntity.script.get("playerDisplay").changeLane(this.offset<0),this.inGameHud.movementIndicator.showChangeLanes(this.offset<0?"left":"right")),!0===this.doJump&&(this.playCharacterSound("jump"),this.jumpDelayedCall&&this.jumpDelayedCall.kill(),this.isJumping=!0,this.displayEntity.script.get("playerDisplay").doJump(),this.jumpDelayedCall=this.entity.delayedCall(.5,this.jumpOver,this)),this.doJump=!1,this.changeLanes=!1},Player.prototype.jumpOver=function(){this.jumpDelayedCall=null,this.isJumping=!1},Player.prototype.laneSwitchComplete=function(){this.isChangingLanes=!1},Player.prototype.playCharacterSound=function(t,e){var i="grizzy_";"Grizzy"!==this.app.userData.characterSelected&&(i="lemmings_");var s=i+t;e?!1===this.sounds.slot(s).isPlaying&&(this.sounds.play(s),this.sounds.slot(s).loop=!0):(this.sounds.play(s),this.sounds.slot(s).loop=!1)},Player.prototype.stopCharacterSound=function(t){var e="grizzy_";"Grizzy"!==this.app.userData.characterSelected&&(e="lemmings_"),this.sounds.stop(e+t)},Player.prototype.onKeyDown=function(t){console.log("onKeyDown",this.keyDown),t.key!=pc.KEY_SPACE||this.keyDown||(this.keyDown=!0,this.mouseDownTime=Date.now(),t.event.preventDefault())},Player.prototype.onKeyUp=function(t){console.log("key up",this.keyDown),t.key==pc.KEY_SPACE&&(this.keyDown=!1,this.release(),t.event.preventDefault())},Player.prototype.onMouseDown=function(t){t.event.preventDefault(),window.focus(this.app.graphicsDevice.canvas),this.keyDown=!1,this.isPointerDown=!0,this.isUsingTouch||(this.mouseDownTime=Date.now())},Player.prototype.onMouseUp=function(t){this.keyDown=!1,t.event.preventDefault(),this.isPointerDown=!1,this.isUsingTouch||this.release()},Player.prototype.onTouchStart=function(t){t.event.preventDefault(),this.isUsingTouch=!0,this.isPointerDown=!0,this.mouseDownTime=Date.now()},Player.prototype.onTouchEnd=function(t){t.event.preventDefault(),this.isPointerDown=!1,this.release()},Player.prototype.release=function(){this.app.systemPaused<=0&&(Date.now()-this.mouseDownTime>this.jumpTime?this.doJump=!0:this.changeLanes=!0)};var CameraFollow=pc.createScript("cameraFollow");CameraFollow.attributes.add("target",{type:"entity",title:"followObject"}),CameraFollow.prototype.initialize=function(){this.cameraLock=!0,this.entity.delayedCall(1,this.unlockCamera,this),this.initialPositionSet=!1,this.isShaking=!1,this.shakeMagnitute=0,this.pathFollowInstance=this.target.script.get("player").target},CameraFollow.prototype.unlockCamera=function(){this.cameraLock=!1},CameraFollow.prototype.shake=function(t,i){this.isShaking=!0,this.shakeMagnitute=t,this.entity.delayedCall(i,this.stopShake,this)},CameraFollow.prototype.stopShake=function(){this.isShaking=!1},CameraFollow.prototype.setInitialPosition=function(t){this.initialPositionSet||(this.updateLookPos=this.target.getPosition().add(pc.Vec3.UP.clone().scale(3)),this.entity.setPosition(this.target.getPosition().clone().add(this.target.forward.scale(-1)).add(pc.Vec3.UP.clone().scale(3))),this.initialPositionSet=!0)},CameraFollow.prototype.update=function(t){if(this.initialPositionSet){var i=this.target.forward.clone();this.pathFollowInstance.camForward&&(i=this.pathFollowInstance.camForward.clone());var e=this.target.getPosition().clone().add(i.clone().normalize().scale(-1)).add(pc.Vec3.UP.clone().scale(3.1)),o=this.entity.getPosition(),a=7*t,s=(new pc.Vec3).lerp(o,e,a);this.entity.setPosition(s);var n=this.target.getPosition().add(pc.Vec3.UP.clone().add(i.clone().scale(4)).scale(3.1));if(this.updateLookPos=(new pc.Vec3).lerp(this.updateLookPos.clone(),n,a),this.isShaking){var l=this.app.mathUtils.randomVec3(10*this.shakeMagnitute);this.updateLookPos.add(l)}this.entity.lookAt(this.updateLookPos)}};var TrackSection=pc.createScript("trackSection");TrackSection.prototype.initialize=function(){this.collectablesInSection=[],this.staticObjectsInSection=[]},TrackSection.prototype.update=function(t){},TrackSection.prototype.addToMainTrack=function(t,e){this.startLPos=this.entity.findByName("sl").getPosition(),this.startRPos=this.entity.findByName("sr").getPosition();var i=(new pc.Vec3).sub2(this.startLPos,this.startRPos),o=Math.atan2(i.z,i.x),n=(new pc.Vec3).sub2(t,e),c=Math.atan2(n.z,n.x);this.entity.setEulerAngles(0,(o-c)/(2*Math.PI)*360,0);var s=t.clone().add(this.entity.getPosition().sub(this.entity.findByName("sl").getPosition()));this.entity.setPosition(s)},TrackSection.prototype.removeFromCollectables=function(t){var e=this.collectablesInSection.indexOf(t);-1!==e&&this.collectablesInSection.splice(e,1)},TrackSection.prototype.addCollectable=function(t){t.script.get("collectable").currentSection=this,this.collectablesInSection.push(t)},TrackSection.prototype.addStaticObstacle=function(t){this.staticObjectsInSection.push(t)},TrackSection.prototype.getEndPositions=function(){return{l:this.entity.findByName("el").getPosition(),r:this.entity.findByName("er").getPosition()}},TrackSection.prototype.dispose=function(){for(var t=0;t<this.collectablesInSection.length;t++)this.collectablesInSection[t].script.get("poolItem").returnToPool();this.collectablesInSection=[];for(t=0;t<this.staticObjectsInSection.length;t++)this.staticObjectsInSection[t].script.get("poolItem").returnToPool();this.staticObjectsInSection=[]};var TrackManager=pc.createScript("trackManager");TrackManager.attributes.add("OriginalTrackSection1",{type:"entity",title:"OriginalTrackSection1",description:"tracks to duplicate"}),TrackManager.attributes.add("OriginalTrackSection2",{type:"entity",title:"OriginalTrackSection2",description:"tracks to duplicate"}),TrackManager.attributes.add("OriginalTrackSection3",{type:"entity",title:"OriginalTrackSection3",description:"tracks to duplicate"}),TrackManager.attributes.add("OriginalTrackSection4",{type:"entity",title:"OriginalTrackSection4",description:"tracks to duplicate"}),TrackManager.attributes.add("player",{type:"entity",title:"player"}),TrackManager.attributes.add("opponent",{type:"entity",title:"Opponent"}),TrackManager.attributes.add("difficultyLevel",{type:"number",title:"Difficulty Level"}),TrackManager.prototype.initialize=function(){this.allOriginals=[this.OriginalTrackSection1,this.OriginalTrackSection2,this.OriginalTrackSection3,this.OriginalTrackSection4],this.pool=new TrackSectionPool(this.allOriginals),this.currentTrack=[],this.isFirstSection=!0},TrackManager.prototype.postInitialize=function(){this.splineManager=this.entity.script.get("splineManager"),this.obstacleManager=this.entity.script.get("obstacleManager"),this.addNewRandomTrackSection(),this.addNewRandomTrackSection(),this.addNewRandomTrackSection(),this.addNewRandomTrackSection(),this.player.script.get("player").start(this.entity),this.opponent.script.get("opponent").start(this.entity),this.splineManager.evtBus.on("newSection",this.newSection,this)},TrackManager.prototype.addNewRandomTrackSection=function(){var t={l:new pc.Vec3(-4,1,0),r:new pc.Vec3(4,1,0)};this.currentTrack.length>0&&(t=this.currentTrack[this.currentTrack.length-1].script.get("trackSection").getEndPositions());var i=this.pool.getSection();this.entity.addChild(i),i.script.get("trackSection").addToMainTrack(t.l,t.r),this.currentTrack.push(i);var e=this.splineManager.addPoints(i.findByName("trackPoints"));!0===this.isFirstSection?this.isFirstSection=!1:this.obstacleManager.newSection(e,i,this.difficultyLevel)},TrackManager.prototype.newSection=function(t){t.parent.script.get("trackSection").dispose(),t.parent.script.get("poolItem").returnToPool(),this.addNewRandomTrackSection()},TrackManager.prototype.update=function(t){};var PlayerDisplay=pc.createScript("playerDisplay");PlayerDisplay.attributes.add("player",{type:"entity",title:"Player"}),PlayerDisplay.attributes.add("grizzy",{type:"entity",title:"grizzy"}),PlayerDisplay.attributes.add("lemmings",{type:"entity",title:"lemmings"}),PlayerDisplay.attributes.add("characterSelection",{type:"number",title:"Character Selection",default:0}),PlayerDisplay.prototype.initialize=function(){var t="Grizzy"===this.app.userData.characterSelected?0:1;this.setCharacter(t),this.boundLeft=this.playLeft.bind(this),this.boundRight=this.playRight.bind(this),this.delayedCall=null,this.isStable=!0,this.currentLane="left",this.isFlashing=!1,this.flashTime=0,this.flashOn=!1},PlayerDisplay.prototype.unstable=function(t){this.animController.play("unstable",1,!0),this.isStable=!1},PlayerDisplay.prototype.update=function(t){if(this.isFlashing){this.flashTime+=t;var e=this.flashOn;if(this.flashTime>.1&&(this.flashOn=!this.flashOn,this.flashTime=0),e!=this.flashOn){var i=this.tint;if(this.flashOn)for(var l=0;l<this.selected.spine.spine.skeleton.slots.length;l++){var s=this.selected.spine.spine.skeleton.slots[l];s&&s.attachment&&this.selected.spine.spine.setTint(s.attachment.name,i)}else this.selected.spine.spine._tint={}}}},PlayerDisplay.prototype.resumeNormalDriving=function(){this.isStable=!0,"left"==this.currentLane?this.playLeft():this.playRight()},PlayerDisplay.prototype.doJump=function(){this.animController.play("jump",1,!1,2,!0)},PlayerDisplay.prototype.changeLane=function(t){this.currentLane=t?"left":"right",!1!==this.isStable&&(this.delayedCall&&this.delayedCall.kill(),t?(this.animController.play("right-to-left",1,!1),this.delayedCall=this.entity.delayedCall(.5,this.boundLeft,this)):(this.animController.play("left-to-right",1,!1),this.delayedCall=this.entity.delayedCall(.5,this.boundRight,this)))},PlayerDisplay.prototype.playLeft=function(){!1!==this.isStable&&this.animController.play("left",1,!0)},PlayerDisplay.prototype.playRight=function(){!1!==this.isStable&&this.animController.play("right",1,!0)},PlayerDisplay.prototype.showInvincible=function(t){this.tint=t,this.isFlashing=!0},PlayerDisplay.prototype.hideInivincible=function(){this.isFlashing=!1,this.selected.enabled=!0,this.selected.spine.spine._tint={}},PlayerDisplay.prototype.setCharacter=function(t){this.characterSelection=t,this.selected=0===this.characterSelection?this.grizzy:this.lemmings,this.grizzy.enabled=!1,this.lemmings.enabled=!1,this.selected.enabled=!0,this.animController=new AnimationController(this.selected),this.selected.spine.state.defaultMix=.25,this.animController.play("loop",1,!0,1),this.resumeNormalDriving()};function getOrthogonalVectors(t,i,e){var n,o;Math.abs(t.z)>.7071067811865476?(n=t.y*t.y+t.z*t.z,o=1/Math.sqrt(n),i.x=0,i.y=-t.z*o,i.z=t.y*o,e.x=n*o,e.y=-t.x*i.z,e.z=t.x*i.y):(n=t.x*t.x+t.y*t.y,o=1/Math.sqrt(n),i.x=-t.y*o,i.y=t.x*o,i.z=0,e.x=-t.z*i.y,e.y=t.z*i.x,e.z=n*o)}var PointToPointConstraint=pc.createScript("pointToPointConstraint");PointToPointConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second entity",type:"entity"}),PointToPointConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of entity B (if specified).",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),PointToPointConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),PointToPointConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),PointToPointConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),PointToPointConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"entityB"===t||"pivotB"===t?this.createConstraint():"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},PointToPointConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=this.entity.rigidbody.body,i=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);if(this.entityB&&this.entityB.rigidbody){var e=this.entityB.rigidbody.body,n=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);this.constraint=new Ammo.btPoint2PointConstraint(t,e,i,n)}else this.constraint=new Ammo.btPoint2PointConstraint(t,i);this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},PointToPointConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},PointToPointConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},PointToPointConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3;this.entity.getWorldTransform().transformPoint(this.pivotA,i),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var HingeConstraint=pc.createScript("hingeConstraint");HingeConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),HingeConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),HingeConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),HingeConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),HingeConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),HingeConstraint.attributes.add("limits",{title:"Limits",description:"Low and high angular limits for the constraint in degrees. By default, low is greater than high meaning no limits.",type:"vec2",default:[1,-1]}),HingeConstraint.attributes.add("softness",{title:"Softness",description:'Softness of the constraint. Recommend 0.8 to 1. Describes the percentage of limits where movement is free. Beyond this softness percentage, the limit is gradually enforced until the "hard" (1.0) limit is reached.',type:"number",min:0,max:1,default:.9}),HingeConstraint.attributes.add("biasFactor",{title:"Bias Factor",description:"Bias factor of the constraint. Recommend 0.3 +/- approximately 0.3. Strength with which constraint resists zeroth order (angular, not angular velocity) limit violation.",type:"number",min:0,max:1,default:.3}),HingeConstraint.attributes.add("relaxationFactor",{title:"Relaxation Factor",description:"Relaxation factor of the constraint. Recommend to keep this near 1. The lower the value, the less the constraint will fight velocities which violate the angular limits.",type:"number",min:0,max:1,default:1}),HingeConstraint.attributes.add("enableMotor",{title:"Use Motor",description:"Enable a motor to power the automatic rotation around the hinge axis.",type:"boolean",default:!1}),HingeConstraint.attributes.add("motorTargetVelocity",{title:"Target Velocity",description:"Target motor angular velocity.",type:"number",default:0}),HingeConstraint.attributes.add("maxMotorImpulse",{title:"Max Motor Impulse",description:"Maximum motor impulse.",type:"number",default:0}),HingeConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),HingeConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),HingeConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),HingeConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),HingeConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){if("pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t)this.createConstraint();else if("limits"===t||"softness"===t||"biasFactor"===t||"relaxationFactor"===t){var n=this.limits.x*Math.PI/180,o=this.limits.y*Math.PI/180;this.constraint.setLimit(n,o,this.softness,this.biasFactor,this.relaxationFactor)}else"enableMotor"===t||"motorTargetVelocity"===t||"maxMotorImpulse"===t?(this.constraint.enableAngularMotor(this.enableMotor,this.motorTargetVelocity*Math.PI/180,this.maxMotorImpulse),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},HingeConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisA.x,this.axisA.y,this.axisA.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btHingeConstraint(o,d,r,l,!1),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btHingeConstraint(o,r,!1);var p=this.limits.x*Math.PI/180,y=this.limits.y*Math.PI/180;this.constraint.setLimit(p,y,this.softness,this.biasFactor,this.relaxationFactor),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.constraint.enableAngularMotor(this.enableMotor,this.motorTargetVelocity*Math.PI/180,this.maxMotorImpulse),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},HingeConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},HingeConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},HingeConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3,e=new pc.Vec3,n=new pc.Vec3,o=new pc.Vec3,s=this.entity.getWorldTransform();s.transformPoint(this.pivotA,i),s.transformVector(this.axisA,e),e.normalize().scale(.5),n.add2(i,e),o.sub2(i,e),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.app.renderLine(n,o,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var ConeTwistConstraint=pc.createScript("coneTwistConstraint");ConeTwistConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),ConeTwistConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),ConeTwistConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),ConeTwistConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),ConeTwistConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),ConeTwistConstraint.attributes.add("swingSpan1",{title:"Swing 1 Limit",description:"The Swing 1 Limit limits the rotation around the swing axis. Swing 1 Limit limits an axis of rotation orthogonal to the twist axis and Swing Limit 2. The limit angle is symmetric. Therefore, a value of 20 will limit the rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("swingSpan2",{title:"Swing 2 Limit",description:"The Swing 2 Limit limits the rotation around the swing axis. Swing 2 Limit limits an axis of rotation orthogonal to the twist axis and Swing Limit 1. The limit angle is symmetric. Therefore, a value of 20 will limit the rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("twistSpan",{title:"Twist Limit",description:"The Twist Limit limits the rotation around the twist axis. The limit angle is symmetric. Therefore, a value of 20 will limit the twist rotation between -20 and 20 degrees.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),ConeTwistConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),ConeTwistConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),ConeTwistConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),ConeTwistConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"swingSpan1"===t?(this.constraint.setLimit(5,this.swingSpan1*Math.PI/180),this.activate()):"swingSpan2"===t?(this.constraint.setLimit(4,this.swingSpan2*Math.PI/180),this.activate()):"twistSpan"===t?(this.constraint.setLimit(3,this.twistSpan*Math.PI/180),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},ConeTwistConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisA.x,this.axisA.y,this.axisA.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btConeTwistConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btConeTwistConstraint(o,r);this.constraint.setLimit(3,this.twistSpan*Math.PI/180),this.constraint.setLimit(4,this.swingSpan2*Math.PI/180),this.constraint.setLimit(5,this.swingSpan1*Math.PI/180),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},ConeTwistConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},ConeTwistConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},ConeTwistConstraint.prototype.update=function(t){this.debugRender&&this.app.renderLine(this.entity.getPosition(),pc.Vec3.ZERO,this.debugColor)};var SliderConstraint=pc.createScript("sliderConstraint");SliderConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),SliderConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),SliderConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),SliderConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),SliderConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),SliderConstraint.attributes.add("linearLimits",{title:"Linear Limits",description:"Linear limits of the constraint.",type:"vec2",default:[1,-1]}),SliderConstraint.attributes.add("angularLimits",{title:"Angular Limits",description:"Angular limits of the constraint.",type:"vec2",default:[0,0]}),SliderConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),SliderConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),SliderConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),SliderConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),SliderConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"linearLimits"===t?(this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.activate()):"angularLimits"===t?(this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},SliderConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([this.axisA.x,this.axisA.y,this.axisA.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(r.setOrigin(s),this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btSliderConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btSliderConstraint(o,r);this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},SliderConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},SliderConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},SliderConstraint.prototype.update=function(t){this.debugRender};var Generic6DofConstraint=pc.createScript("generic6DofConstraint");Generic6DofConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),Generic6DofConstraint.attributes.add("axisA",{title:"Axis",description:"Axis of rotation of the constraint in the local space this entity.",type:"vec3",default:[0,1,0]}),Generic6DofConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second connected entity.",type:"entity"}),Generic6DofConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,0,0]}),Generic6DofConstraint.attributes.add("axisB",{title:"Connected Axis",description:"Axis of rotation of the constraint in the local space of the connected entity (if specified).",type:"vec3",default:[0,1,0]}),Generic6DofConstraint.attributes.add("linearLimits",{title:"Linear Limits",description:"Linear limits of the constraint.",type:"vec2",default:[1,-1]}),Generic6DofConstraint.attributes.add("angularLimits",{title:"Angular Limits",description:"Angular limits of the constraint.",type:"vec2",default:[0,0]}),Generic6DofConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:1e30}),Generic6DofConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),Generic6DofConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),Generic6DofConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),Generic6DofConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,e){"pivotA"===t||"axisA"===t||"entityB"===t||"pivotB"===t||"axisB"===t?this.createConstraint():"linearLimits"===t?(this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.activate()):"angularLimits"===t?(this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.activate()):"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},Generic6DofConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=new pc.Vec3,i=new pc.Vec3,e=new pc.Quat,n=new pc.Mat4,o=this.entity.rigidbody.body,s=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);getOrthogonalVectors(this.axisA,t,i),n.set([this.axisA.x,this.axisA.y,this.axisA.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1]),e.setFromMat4(n);var a=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),r=new Ammo.btTransform(a,s);if(r.setOrigin(s),this.entityB&&this.entityB.rigidbody){var d=this.entityB.rigidbody.body,h=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);getOrthogonalVectors(this.axisB,t,i),n.set([t.x,t.y,t.z,0,i.x,i.y,i.z,0,this.axisB.x,this.axisB.y,this.axisB.z,0,0,0,0,1]),e.setFromMat4(n);var c=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(c,h);this.constraint=new Ammo.btSliderConstraint(o,d,r,l),Ammo.destroy(l),Ammo.destroy(c),Ammo.destroy(h)}else this.constraint=new Ammo.btSliderConstraint(o,r);this.constraint.setLowerLinLimit(this.linearLimits.x),this.constraint.setUpperLinLimit(this.linearLimits.y),this.constraint.setLowerAngLimit(this.angularLimits.x),this.constraint.setUpperAngLimit(this.angularLimits.y),this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),Ammo.destroy(r),Ammo.destroy(a),Ammo.destroy(s),this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},Generic6DofConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},Generic6DofConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},Generic6DofConstraint.prototype.update=function(t){this.debugRender};var Truck=pc.createScript("truck");Truck.attributes.add("target",{type:"entity",title:"pathFollower"}),Truck.attributes.add("leftIndicator",{type:"entity",title:"leftIndicator"}),Truck.attributes.add("rightIndicator",{type:"entity",title:"rightIndicator"}),Truck.attributes.add("exclamation",{type:"entity",title:"exclamation"}),Truck.attributes.add("player",{type:"entity",title:"player"}),Truck.prototype.initialize=function(){this.entity.parent.on("removedFromPool",this.resetVals.bind(this)),this.entity.parent.on("returnToPool",this.inPool.bind(this)),this.distSqToPlayer=0,this.resetVals()},Truck.prototype.inPool=function(){this.entity.sound.stop("engine_noise"),this.entity.setLocalPosition(pc.Vec3.ZERO),this.target.setLocalPosition(pc.Vec3.ZERO)},Truck.prototype.resetVals=function(){this.targetOffset=this.offset=Math.random()<.5?-2:2,this.isLeft=this.offset<0,this.pathFollowerInst=this.target.script.get("pathFollower"),this.pathFollowerInst.speed=10,this.lookAtPos=new pc.Vec3,this.lookTarget=new pc.Vec3,this.obsCheckInterval=0,this.truckCheckInterval=0,this.exclamation&&this.exclamation.setLocalScale(0,0,0)},Truck.prototype.addToTrack=function(t,e,i,s){this.startPos=s,this.obstacleManger=e,this.pathFollowerInst.startFollowFront(t,!1),this.entity.setPosition(t),this.pathFollowerInst.resetPos(t),this.isTargetTruck=!!i,this.entity.sound.play("engine_noise"),this.entity.sound.slot("engine_noise").loop=!0,this.exclamation&&this.exclamation.setLocalScale(0,0,0)},Truck.prototype.update=function(t){if(this.pathFollowerInst.follow(t),!0===this.pathFollowerInst.updatePos){this.isTargetTruck&&(this.offset=this.targetOffset=0);var e=this.target.getPosition().add(this.target.right.clone().scale(this.offset).add(this.target.forward.clone().scale(-1))),i=this.entity.getPosition(),s=(new pc.Vec3).lerp(i,e,5*t);this.entity.setPosition(s),this.lookAtPos=(new pc.Vec3).lerp(this.lookAtPos,this.target.forward,2*t),this.lookTarget=this.entity.getPosition().clone().add(this.lookAtPos),this.entity.lookAt(this.lookTarget);var o=this.player.getPosition(),a=this.lookTarget.clone().sub(o).lengthSq(),n=this.distSqToPlayer=s.clone().sub(o).lengthSq();if(a<n&&n<50&&n>20)return void this.obstacleManger.removeTruck(this.entity);this.checkObstacles(t),this.checkOtherTrucks(t),this.offset+=(this.targetOffset-this.offset)*(2*t),this.isLeft=this.offset<0,(this.player.offset<0&&this.targetOffset<0||this.player.offset>0&&this.targetOffset>0)&&(this.targetOffset*=-1),this.posDownTrack=this.startPos+this.pathFollowerInst.totalDistTravelled}},Truck.prototype.checkObstacles=function(t){if(this.obsCheckInterval+=t,this.obsCheckInterval>.5&&(this.obsCheckInterval=0,this.obstacleManger.allObstacles&&0!==this.obstacleManger.allObstacles.length&&!this.isTargetTruck)){for(var e=null,i=Number.MAX_VALUE,s=(this.lookTarget.clone(),0);s<this.obstacleManger.allObstacles.length;s++){var o=this.obstacleManger.allObstacles[s].script.get("obstacle"),a=this.entity.getPosition().sub(o.entity.getPosition()).lengthSq(),n=this.entity.getPosition().add(this.entity.forward.scale(2)).sub(o.entity.getPosition()).lengthSq();n<a&&n<i&&(i=n,e=o)}if(i=Math.sqrt(i),e&&(e.isLeft&&this.targetOffset<0||!1===e.isLeft&&this.targetOffset>0)){var r=e.isLeft?-1:1;i<10&&(this.distSqToPlayer>Math.pow(30,2)?this.targetOffset*=-1:(this.stop(),console.log("stopping as player is too close"))),i<20?this.isIndicating!==r&&this.indicate(r):0!==this.isIndicating&&this.stopIndicating()}else 0!==this.isIndicating&&this.stopIndicating()}},Truck.prototype.indicate=function(t){this.isIndicating=t,this.exclamation.setLocalScale(.5,.5,.5),this.exTween&&this.exTween.kill(),this.exTween=this.exclamation.tween(this.exclamation.getLocalScale()).to(new pc.Vec3(1,1,1),1,pc.ElasticOut).start(),t<0?(this.leftIndicator.script.get("indicator").turnOff(),this.rightIndicator.script.get("indicator").turnOn()):(this.rightIndicator.script.get("indicator").turnOff(),this.leftIndicator.script.get("indicator").turnOn())},Truck.prototype.stopIndicating=function(){this.isIndicating=0,this.exTween&&this.exTween.kill(),this.exTween=this.exclamation.tween(this.exclamation.getLocalScale()).to(new pc.Vec3(0,0,0),.3,pc.BackIn).start(),this.rightIndicator.script.get("indicator").turnOff(),this.leftIndicator.script.get("indicator").turnOff()},Truck.prototype.stop=function(){this.pathFollowerInst.speed=0,this.stopped=!0},Truck.prototype.checkOtherTrucks=function(t){if(this.truckCheckInterval+=t,this.truckCheckInterval>.3){this.truckCheckInterval=0;for(var e=this.entity.getPosition(),i=0;i<this.obstacleManger.allTrucks.length;i++){var s=this.obstacleManger.allTrucks[i];if(s&&s!==this.entity)if(s.getPosition().sub(e).lengthSq()<Math.pow(30,2)){this.obstacleManger.removeTruck(s);break}}}};var ObstacleManager=pc.createScript("obstacleManager");ObstacleManager.attributes.add("truckPrefab",{type:"entity",title:"truckPrefab"}),ObstacleManager.attributes.add("targetTruckPrefab",{type:"entity",title:"targetTruckPrefab"}),ObstacleManager.attributes.add("collectablePrefab",{type:"entity",title:"collectable prefab"}),ObstacleManager.attributes.add("holePrefab",{type:"entity",title:"hole prefab"}),ObstacleManager.attributes.add("logPrefab",{type:"entity",title:"log prefab"}),ObstacleManager.attributes.add("player",{type:"entity",title:"player"}),ObstacleManager.attributes.add("cameraRefEnt",{type:"entity",title:"cameraRefEnt"}),ObstacleManager.prototype.initialize=function(){this.trackManager=this.entity.script.get("trackManager"),this.allTrucks=[],this.levelConfig=new LevelConfig(this.app),this.currentLevelConfig=this.levelConfig.getLevelConfig(this.app.transData.selectedLevel),this.collectablePool=new ObjectPool(this.collectablePrefab,14),this.app.transData.selectedLevel>=1&&(this.truckPool=new ObjectPool(this.truckPrefab,6)),2===this.app.transData.selectedLevel&&(this.holePool=new ObjectPool(this.holePrefab,20)),this.app.transData.selectedLevel>=3&&(this.holePool=new ObjectPool(this.holePrefab,15),this.logPool=new ObjectPool(this.logPrefab,15)),this.targetTruckParts=this.targetTruckPrefab.clone(),this.totalTrackLength=0,this.allObstacles=[],this.cameraRef=this.cameraRefEnt.camera,this.totalTruckCount=0,this.lastTruckAdded=!1,this.targetTruck=null,this.totalTraveresed=0,this.entity.on("destroy",this.dispose,this)},ObstacleManager.prototype.postInitialize=function(){this.splineManager=this.entity.script.get("splineManager")},ObstacleManager.prototype.update=function(t){},ObstacleManager.prototype.dispose=function(){this.collectablePool&&this.collectablePool.dispose(),this.holePool&&this.holePool.dispose(),this.truckPool&&this.truckPool.dispose(),this.logPool&&this.logPool.dispose()},ObstacleManager.prototype.newSection=function(t,e,a){this.traverseSpline(t,e),this.distToLastTruckSpawn=this.totalTraveresed/this.totalTruckCount*this.currentLevelConfig.levelLength},ObstacleManager.prototype.traverseSpline=function(t,e){var a,s,l,i,o=e.script.get("trackSection"),r=t[0].clone(),n=t[0].clone();this.splineManager.evtBus.on("atEnd",this.stopCollectableLoop,this),this.doTraverse=!0;var c=0,h=2,p=(this.levelConfig.getObstacle(this.currentLevelConfig),100);for(c=0;this.doTraverse;)if(c++,p=this.app.mathUtils.randomRange(this.currentLevelConfig.distBetweenObstacles.min,this.currentLevelConfig.distBetweenObstacles.max),4===this.app.transData.selectedLevel&&(p-=this.totalTraveresed/2e3),r=this.splineManager.placeObs(r.clone(),p,!1,t),1!=c){a=this.splineManager.placeObs(r.clone(),5,!1,t),s=this.splineManager.placeObs(r.clone(),-5,!1,t),l=a.clone().sub(s).normalize();var d=n.clone();n=a.clone().add(s).scale(.5),h*=Math.random()<.5?-1:1,i=new pc.Vec3(-l.z,0,l.x).scale(h);var b=this.levelConfig.getObstacle(this.currentLevelConfig);if(this.totalTraveresed+=d.sub(n).length(),"truck"==b.obstacleType)this.spawnTruckAtPoint(n.add(i));else{var g=this.getObstacleModel(b.obstacleType);this.entity.addChild(g),g.setPosition(n.add(i)),g.script.get("obstacle").initAndSetDirection(this,a.clone().sub(s),h,this.totalTraveresed),g.once("returnToPool",this.removeFromObstacleList,this),o.addStaticObstacle(g),this.allObstacles.push(g)}b}for(r=t[0],c=0,p=50,this.doTraverse=!0,this.splineManager.evtBus.on("atEnd",this.stopCollectableLoop,this);this.doTraverse;){r.clone();r=this.splineManager.placeObs(r.clone(),p,!1,t),a=this.splineManager.placeObs(r.clone(),.5*p,!1,t),s=this.splineManager.placeObs(r.clone(),.5*-p,!1,t),l=a.clone().sub(s).normalize(),n=a.add(s).scale(.5),i=new pc.Vec3(-l.z,0,l.x).scale(h);var u=this.collectablePool.getItem();this.entity.addChild(u),u.setPosition(n.add(i)),c%10==0&&(h*=-1),o.addCollectable(u),c++}},ObstacleManager.prototype.removeFromObstacleList=function(t){var e=this.allObstacles.indexOf(t);-1!==e&&this.allObstacles.splice(e,1)},ObstacleManager.prototype.getObstacleModel=function(t){return"hole"===t?this.holePool.getItem():"log"===t?this.logPool.getItem():void 0},ObstacleManager.prototype.stopCollectableLoop=function(){this.splineManager.evtBus.off("atEnd",this.stopCollectableLoop),this.doTraverse=!1},ObstacleManager.prototype.removeTruck=function(t){var e=this.allTrucks.indexOf(t);-1!=e&&(this.allTrucks.splice(e,1),t.parent.script.get("poolItem").returnToPool())},ObstacleManager.prototype.spawnTruckAtPoint=function(t){if(!0!==this.lastTruckAdded){for(var e=0;e<this.allTrucks.length;e++){if(this.allTrucks[e].getPosition().sub(t).lengthSq()<Math.pow(100,2))return}if(this.totalTruckCount===this.currentLevelConfig.levelLength){var a=this.targetTruckParts;this.entity.addChild(a);var s=a.findByName("TargetTruck");this.targetTruck=s.script.get("truck"),this.targetTruck.addToTrack(t,this,!0,this.totalTraveresed),this.lastTruckAdded=!0,this.totalTruckCount++}else if(!1===this.lastTruckAdded){a=this.truckPool.getItem();this.entity.addChild(a),(s=a.findByName("Truck")).script.get("truck").addToTrack(t,this,!1,this.totalTraveresed),this.allTrucks.push(s),this.totalTruckCount++}}};var SectionObj=pc.createScript("sectionObj");SectionObj.prototype.initialize=function(){},SectionObj.prototype.update=function(t){};var Collectable=pc.createScript("collectable");Collectable.attributes.add("displayEntity",{type:"entity",title:"displayEntity"}),Collectable.prototype.initialize=function(){},Collectable.prototype.collect=function(){this.entity.script.get("poolItem").returnToPool(),this.currentSection&&this.currentSection.removeFromCollectables(this.entity)};var CameraBump=pc.createScript("cameraBump");CameraBump.prototype.initialize=function(){this.ct=null,this.lift()},CameraBump.prototype.lift=function(){this.ct=this.entity.tween(this.entity.getLocalPosition()).to({x:this.randomRange(-.1,.1),y:this.randomRange(0,.1),z:this.randomRange(-.1,.1)},this.randomRange(.1,.2),pc.SineOut).on("complete",this.land.bind(this)).start()},CameraBump.prototype.land=function(){this.ct=this.entity.tween(this.entity.getLocalPosition()).to({x:this.entity.getLocalPosition().x,y:0,z:this.entity.getLocalPosition().z},this.randomRange(.1,.3),pc.BounceOut).on("complete",this.idle.bind(this)).start()},CameraBump.prototype.idle=function(){this.ct=this.entity.tween(this.entity.getLocalPosition()).to({x:0,y:0,z:0},this.randomRange(0,1),pc.SineInOut).on("complete",this.lift.bind(this)).start()},CameraBump.prototype.update=function(t){this.ct&&((this.app.systemPaused>0||!0===this.app.userPaused)&&!0===this.ct.playing&&this.ct.pause(),this.app.systemPaused<=0&&!1===this.app.userPaused&&!1===this.ct.playing&&this.ct.resume())},CameraBump.prototype.randomRange=function(t,i){return t+Math.random()*(i-t)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,s=this._tweens.length;i<s;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),s--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,s){pc.events.attach(this),this.manager=i,s&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._to=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,s,e,n,r){return this._toProps=_parseProperties(t),this.duration=i,s&&(this.easing=s),e&&this.delay(e),n&&this.repeat(n),r&&this.yoyo(r),this._to=!0,this},toFrom:function(t,i,s,e,n,r,h){return this._toProps=_parseProperties(t),this._fromProps=_parseProperties(i),this.duration=s,e&&(this.easing=e),n&&this.delay(n),r&&this.repeat(r),h&&this.yoyo(h),this._to=!0,this},from:function(t,i,s,e,n,r){return this._fromProps=_parseProperties(t),this.duration=i,s&&(this.easing=s),e&&this.delay(e),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,s,e,n,r){return this._toProps=_parseProperties(t),this.duration=i,s&&(this.easing=s),e&&this.delay(e),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,s,e;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,!this._fromProps)for(t in this._fromProps={},this._toProps)this._fromProps[t]=this.target[t];if(!this._toProps)for(t in this._toProps={},this._fromProps)this._toProps[t]=this.target[t];for(t in this._toProps)this._toProps.hasOwnProperty(t)&&(this._sv[t]=this._fromProps[t],this._ev[t]=this._toProps[t]);return this._from?this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._fromProps.x?this._fromProps.x:this.target.x,s=void 0!==this._fromProps.y?this._fromProps.y:this.target.y,e=void 0!==this._fromProps.z?this._fromProps.z:this.target.z,this._fromQuat.setFromEulerAngles(i,s,e)):this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._toProps.x?this._toProps.x:this.target.x,s=void 0!==this._toProps.y?this._toProps.y:this.target.y,e=void 0!==this._toProps.z?this._toProps.z:this.target.z,this._toQuat.setFromEulerAngles(i,s,e)),this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},kill:function(){this.stop(),this.complete=null,this.target=null,this._fromProps=null,this._toProps=null,this.pending=null},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var s,e,n=this.time/this.duration,r=this.easing(n);for(var h in this._toProps)this._toProps.hasOwnProperty(h)&&(s=this._sv[h],e=this._ev[h],this.target[h]=s+(e-s)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var o=this._repeat(i);return o?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),o}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._toProps){var s=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=s}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*Math.asin(1/s)/(2*Math.PI),-s*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*Math.asin(1/s)/(2*Math.PI),s*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,s=.1,e=.4;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=e*Math.asin(1/s)/(2*Math.PI),(t*=2)<1?s*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)*-.5:s*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var s=this._app.tween(t);return s.entity=this,this.once("destroy",s.stop,s),i&&i.element&&(s.element=i.element),s};var t=pc.Application.getApplication();t&&t.addTweenManager()}();var Spine=pc.createScript("spine");Spine.attributes.add("atlas",{type:"asset",assetType:"text"}),Spine.attributes.add("skeleton",{type:"asset",assetType:"json"}),Spine.attributes.add("textures",{type:"asset",array:!0,assetType:"texture"}),Spine.attributes.add("priority",{type:"number",default:1}),Spine.prototype.initialize=function(){this.atlas&&this.textures&&this.skeleton&&(this.entity.addComponent("spine",{atlasAsset:this.atlas.id,textureAssets:this.textures.map((function(t){return t.id})),skeletonAsset:this.skeleton.id}),this.entity.spine&&(this.priority=this.priority?this.priority:0,this.entity.spine.spine.priority=this.priority)),this.on("attr:priority",(function(t){this.entity.spine&&(this.entity.spine.spine.priority=t)}),this)};var spine,__extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){var e,n,i,a=function(){function Animation(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var i=0;i<e.length;i++)this.timelineIds[e[i].getPropertyId()]=!0;this.duration=n}return Animation.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},Animation.prototype.apply=function(t,e,n,i,a,r,o,s){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,n,a,r,o,s)},Animation.binarySearch=function(t,e,n){void 0===n&&(n=1);var i=0,a=t.length/n-2;if(0==a)return n;for(var r=a>>>1;;){if(t[(r+1)*n]<=e?i=r+1:a=r,i==a)return(i+1)*n;r=i+a>>>1}},Animation.linearSearch=function(t,e,n){for(var i=0,a=t.length-n;i<=a;i+=n)if(t[i]>e)return i;return-1},Animation}();t.Animation=a,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(n=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(i=t.TimelineType||(t.TimelineType={}));var r=function(){function CurveTimeline(e){if(e<=0)throw new Error("frameCount must be > 0: "+e);this.curves=t.Utils.newFloatArray((e-1)*CurveTimeline.BEZIER_SIZE)}return CurveTimeline.prototype.getFrameCount=function(){return this.curves.length/CurveTimeline.BEZIER_SIZE+1},CurveTimeline.prototype.setLinear=function(t){this.curves[t*CurveTimeline.BEZIER_SIZE]=CurveTimeline.LINEAR},CurveTimeline.prototype.setStepped=function(t){this.curves[t*CurveTimeline.BEZIER_SIZE]=CurveTimeline.STEPPED},CurveTimeline.prototype.getCurveType=function(t){var e=t*CurveTimeline.BEZIER_SIZE;if(e==this.curves.length)return CurveTimeline.LINEAR;var n=this.curves[e];return n==CurveTimeline.LINEAR?CurveTimeline.LINEAR:n==CurveTimeline.STEPPED?CurveTimeline.STEPPED:CurveTimeline.BEZIER},CurveTimeline.prototype.setCurve=function(t,e,n,i,a){var r=.03*(2*-e+i),o=.03*(2*-n+a),s=.006*(3*(e-i)+1),l=.006*(3*(n-a)+1),h=2*r+s,u=2*o+l,c=.3*e+r+.16666667*s,d=.3*n+o+.16666667*l,p=t*CurveTimeline.BEZIER_SIZE,f=this.curves;f[p++]=CurveTimeline.BEZIER;for(var m=c,g=d,v=p+CurveTimeline.BEZIER_SIZE-1;p<v;p+=2)f[p]=m,f[p+1]=g,c+=h,d+=u,h+=s,u+=l,m+=c,g+=d},CurveTimeline.prototype.getCurvePercent=function(e,n){n=t.MathUtils.clamp(n,0,1);var i=this.curves,a=e*CurveTimeline.BEZIER_SIZE,r=i[a];if(r==CurveTimeline.LINEAR)return n;if(r==CurveTimeline.STEPPED)return 0;for(var o=0,s=++a,l=a+CurveTimeline.BEZIER_SIZE-1;a<l;a+=2)if((o=i[a])>=n){var h=void 0,u=void 0;return a==s?(h=0,u=0):(h=i[a-2],u=i[a-1]),u+(i[a+1]-u)*(n-h)/(o-h)}var c=i[a-1];return c+(1-c)*(n-o)/(1-o)},CurveTimeline.LINEAR=0,CurveTimeline.STEPPED=1,CurveTimeline.BEZIER=2,CurveTimeline.BEZIER_SIZE=19,CurveTimeline}();t.CurveTimeline=r;var o=function(n){function RotateTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e<<1),i}return __extends(RotateTimeline,n),RotateTimeline.prototype.getPropertyId=function(){return(i.rotate<<24)+this.boneIndex},RotateTimeline.prototype.setFrame=function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+RotateTimeline.ROTATION]=n},RotateTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<h[0])switch(s){case e.setup:return void(u.rotation=u.data.rotation);case e.first:var c=u.data.rotation-u.rotation;u.rotation+=(c-360*(16384-(16384.499999999996-c/360|0)))*o}else if(i>=h[h.length-RotateTimeline.ENTRIES]){var d=h[h.length+RotateTimeline.PREV_ROTATION];switch(s){case e.setup:u.rotation=u.data.rotation+d*o;break;case e.first:case e.replace:d+=u.data.rotation-u.rotation,d-=360*(16384-(16384.499999999996-d/360|0));case e.add:u.rotation+=d*o}}else{var p=a.binarySearch(h,i,RotateTimeline.ENTRIES),f=h[p+RotateTimeline.PREV_ROTATION],m=h[p],g=this.getCurvePercent((p>>1)-1,1-(i-m)/(h[p+RotateTimeline.PREV_TIME]-m)),v=h[p+RotateTimeline.ROTATION]-f;switch(v=f+(v-360*(16384-(16384.499999999996-v/360|0)))*g,s){case e.setup:u.rotation=u.data.rotation+(v-360*(16384-(16384.499999999996-v/360|0)))*o;break;case e.first:case e.replace:v+=u.data.rotation-u.rotation;case e.add:u.rotation+=(v-360*(16384-(16384.499999999996-v/360|0)))*o}}},RotateTimeline.ENTRIES=2,RotateTimeline.PREV_TIME=-2,RotateTimeline.PREV_ROTATION=-1,RotateTimeline.ROTATION=1,RotateTimeline}(r);t.RotateTimeline=o;var s=function(n){function TranslateTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*TranslateTimeline.ENTRIES),i}return __extends(TranslateTimeline,n),TranslateTimeline.prototype.getPropertyId=function(){return(i.translate<<24)+this.boneIndex},TranslateTimeline.prototype.setFrame=function(t,e,n,i){t*=TranslateTimeline.ENTRIES,this.frames[t]=e,this.frames[t+TranslateTimeline.X]=n,this.frames[t+TranslateTimeline.Y]=i},TranslateTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<h[0])switch(s){case e.setup:return u.x=u.data.x,void(u.y=u.data.y);case e.first:u.x+=(u.data.x-u.x)*o,u.y+=(u.data.y-u.y)*o}else{var c=0,d=0;if(i>=h[h.length-TranslateTimeline.ENTRIES])c=h[h.length+TranslateTimeline.PREV_X],d=h[h.length+TranslateTimeline.PREV_Y];else{var p=a.binarySearch(h,i,TranslateTimeline.ENTRIES);c=h[p+TranslateTimeline.PREV_X],d=h[p+TranslateTimeline.PREV_Y];var f=h[p],m=this.getCurvePercent(p/TranslateTimeline.ENTRIES-1,1-(i-f)/(h[p+TranslateTimeline.PREV_TIME]-f));c+=(h[p+TranslateTimeline.X]-c)*m,d+=(h[p+TranslateTimeline.Y]-d)*m}switch(s){case e.setup:u.x=u.data.x+c*o,u.y=u.data.y+d*o;break;case e.first:case e.replace:u.x+=(u.data.x+c-u.x)*o,u.y+=(u.data.y+d-u.y)*o;break;case e.add:u.x+=c*o,u.y+=d*o}}},TranslateTimeline.ENTRIES=3,TranslateTimeline.PREV_TIME=-3,TranslateTimeline.PREV_X=-2,TranslateTimeline.PREV_Y=-1,TranslateTimeline.X=1,TranslateTimeline.Y=2,TranslateTimeline}(r);t.TranslateTimeline=s;var l=function(r){function ScaleTimeline(t){return r.call(this,t)||this}return __extends(ScaleTimeline,r),ScaleTimeline.prototype.getPropertyId=function(){return(i.scale<<24)+this.boneIndex},ScaleTimeline.prototype.apply=function(i,r,o,s,l,h,u){var c=this.frames,d=i.bones[this.boneIndex];if(d.active)if(o<c[0])switch(h){case e.setup:return d.scaleX=d.data.scaleX,void(d.scaleY=d.data.scaleY);case e.first:d.scaleX+=(d.data.scaleX-d.scaleX)*l,d.scaleY+=(d.data.scaleY-d.scaleY)*l}else{var p=0,f=0;if(o>=c[c.length-ScaleTimeline.ENTRIES])p=c[c.length+ScaleTimeline.PREV_X]*d.data.scaleX,f=c[c.length+ScaleTimeline.PREV_Y]*d.data.scaleY;else{var m=a.binarySearch(c,o,ScaleTimeline.ENTRIES);p=c[m+ScaleTimeline.PREV_X],f=c[m+ScaleTimeline.PREV_Y];var g=c[m],v=this.getCurvePercent(m/ScaleTimeline.ENTRIES-1,1-(o-g)/(c[m+ScaleTimeline.PREV_TIME]-g));p=(p+(c[m+ScaleTimeline.X]-p)*v)*d.data.scaleX,f=(f+(c[m+ScaleTimeline.Y]-f)*v)*d.data.scaleY}if(1==l)h==e.add?(d.scaleX+=p-d.data.scaleX,d.scaleY+=f-d.data.scaleY):(d.scaleX=p,d.scaleY=f);else{var T=0,y=0;if(u==n.mixOut)switch(h){case e.setup:T=d.data.scaleX,y=d.data.scaleY,d.scaleX=T+(Math.abs(p)*t.MathUtils.signum(T)-T)*l,d.scaleY=y+(Math.abs(f)*t.MathUtils.signum(y)-y)*l;break;case e.first:case e.replace:T=d.scaleX,y=d.scaleY,d.scaleX=T+(Math.abs(p)*t.MathUtils.signum(T)-T)*l,d.scaleY=y+(Math.abs(f)*t.MathUtils.signum(y)-y)*l;break;case e.add:T=d.scaleX,y=d.scaleY,d.scaleX=T+(Math.abs(p)*t.MathUtils.signum(T)-d.data.scaleX)*l,d.scaleY=y+(Math.abs(f)*t.MathUtils.signum(y)-d.data.scaleY)*l}else switch(h){case e.setup:T=Math.abs(d.data.scaleX)*t.MathUtils.signum(p),y=Math.abs(d.data.scaleY)*t.MathUtils.signum(f),d.scaleX=T+(p-T)*l,d.scaleY=y+(f-y)*l;break;case e.first:case e.replace:T=Math.abs(d.scaleX)*t.MathUtils.signum(p),y=Math.abs(d.scaleY)*t.MathUtils.signum(f),d.scaleX=T+(p-T)*l,d.scaleY=y+(f-y)*l;break;case e.add:T=t.MathUtils.signum(p),y=t.MathUtils.signum(f),d.scaleX=Math.abs(d.scaleX)*T+(p-Math.abs(d.data.scaleX)*T)*l,d.scaleY=Math.abs(d.scaleY)*y+(f-Math.abs(d.data.scaleY)*y)*l}}}},ScaleTimeline}(s);t.ScaleTimeline=l;var h=function(t){function ShearTimeline(e){return t.call(this,e)||this}return __extends(ShearTimeline,t),ShearTimeline.prototype.getPropertyId=function(){return(i.shear<<24)+this.boneIndex},ShearTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<h[0])switch(s){case e.setup:return u.shearX=u.data.shearX,void(u.shearY=u.data.shearY);case e.first:u.shearX+=(u.data.shearX-u.shearX)*o,u.shearY+=(u.data.shearY-u.shearY)*o}else{var c=0,d=0;if(i>=h[h.length-ShearTimeline.ENTRIES])c=h[h.length+ShearTimeline.PREV_X],d=h[h.length+ShearTimeline.PREV_Y];else{var p=a.binarySearch(h,i,ShearTimeline.ENTRIES);c=h[p+ShearTimeline.PREV_X],d=h[p+ShearTimeline.PREV_Y];var f=h[p],m=this.getCurvePercent(p/ShearTimeline.ENTRIES-1,1-(i-f)/(h[p+ShearTimeline.PREV_TIME]-f));c+=(h[p+ShearTimeline.X]-c)*m,d+=(h[p+ShearTimeline.Y]-d)*m}switch(s){case e.setup:u.shearX=u.data.shearX+c*o,u.shearY=u.data.shearY+d*o;break;case e.first:case e.replace:u.shearX+=(u.data.shearX+c-u.shearX)*o,u.shearY+=(u.data.shearY+d-u.shearY)*o;break;case e.add:u.shearX+=c*o,u.shearY+=d*o}}},ShearTimeline}(s);t.ShearTimeline=h;var u=function(n){function ColorTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*ColorTimeline.ENTRIES),i}return __extends(ColorTimeline,n),ColorTimeline.prototype.getPropertyId=function(){return(i.color<<24)+this.slotIndex},ColorTimeline.prototype.setFrame=function(t,e,n,i,a,r){t*=ColorTimeline.ENTRIES,this.frames[t]=e,this.frames[t+ColorTimeline.R]=n,this.frames[t+ColorTimeline.G]=i,this.frames[t+ColorTimeline.B]=a,this.frames[t+ColorTimeline.A]=r},ColorTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=t.slots[this.slotIndex];if(h.bone.active){var u=this.frames;if(i<u[0])switch(s){case e.setup:return void h.color.setFromColor(h.data.color);case e.first:var c=h.color,d=h.data.color;c.add((d.r-c.r)*o,(d.g-c.g)*o,(d.b-c.b)*o,(d.a-c.a)*o)}else{var p=0,f=0,m=0,g=0;if(i>=u[u.length-ColorTimeline.ENTRIES]){var v=u.length;p=u[v+ColorTimeline.PREV_R],f=u[v+ColorTimeline.PREV_G],m=u[v+ColorTimeline.PREV_B],g=u[v+ColorTimeline.PREV_A]}else{var T=a.binarySearch(u,i,ColorTimeline.ENTRIES);p=u[T+ColorTimeline.PREV_R],f=u[T+ColorTimeline.PREV_G],m=u[T+ColorTimeline.PREV_B],g=u[T+ColorTimeline.PREV_A];var y=u[T],A=this.getCurvePercent(T/ColorTimeline.ENTRIES-1,1-(i-y)/(u[T+ColorTimeline.PREV_TIME]-y));p+=(u[T+ColorTimeline.R]-p)*A,f+=(u[T+ColorTimeline.G]-f)*A,m+=(u[T+ColorTimeline.B]-m)*A,g+=(u[T+ColorTimeline.A]-g)*A}if(1==o)h.color.set(p,f,m,g);else{c=h.color;s==e.setup&&c.setFromColor(h.data.color),c.add((p-c.r)*o,(f-c.g)*o,(m-c.b)*o,(g-c.a)*o)}}}},ColorTimeline.ENTRIES=5,ColorTimeline.PREV_TIME=-5,ColorTimeline.PREV_R=-4,ColorTimeline.PREV_G=-3,ColorTimeline.PREV_B=-2,ColorTimeline.PREV_A=-1,ColorTimeline.R=1,ColorTimeline.G=2,ColorTimeline.B=3,ColorTimeline.A=4,ColorTimeline}(r);t.ColorTimeline=u;var c=function(n){function TwoColorTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*TwoColorTimeline.ENTRIES),i}return __extends(TwoColorTimeline,n),TwoColorTimeline.prototype.getPropertyId=function(){return(i.twoColor<<24)+this.slotIndex},TwoColorTimeline.prototype.setFrame=function(t,e,n,i,a,r,o,s,l){t*=TwoColorTimeline.ENTRIES,this.frames[t]=e,this.frames[t+TwoColorTimeline.R]=n,this.frames[t+TwoColorTimeline.G]=i,this.frames[t+TwoColorTimeline.B]=a,this.frames[t+TwoColorTimeline.A]=r,this.frames[t+TwoColorTimeline.R2]=o,this.frames[t+TwoColorTimeline.G2]=s,this.frames[t+TwoColorTimeline.B2]=l},TwoColorTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=t.slots[this.slotIndex];if(h.bone.active){var u=this.frames;if(i<u[0])switch(s){case e.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case e.first:var c=h.color,d=h.darkColor,p=h.data.color,f=h.data.darkColor;c.add((p.r-c.r)*o,(p.g-c.g)*o,(p.b-c.b)*o,(p.a-c.a)*o),d.add((f.r-d.r)*o,(f.g-d.g)*o,(f.b-d.b)*o,0)}else{var m=0,g=0,v=0,T=0,y=0,A=0,C=0;if(i>=u[u.length-TwoColorTimeline.ENTRIES]){var S=u.length;m=u[S+TwoColorTimeline.PREV_R],g=u[S+TwoColorTimeline.PREV_G],v=u[S+TwoColorTimeline.PREV_B],T=u[S+TwoColorTimeline.PREV_A],y=u[S+TwoColorTimeline.PREV_R2],A=u[S+TwoColorTimeline.PREV_G2],C=u[S+TwoColorTimeline.PREV_B2]}else{var x=a.binarySearch(u,i,TwoColorTimeline.ENTRIES);m=u[x+TwoColorTimeline.PREV_R],g=u[x+TwoColorTimeline.PREV_G],v=u[x+TwoColorTimeline.PREV_B],T=u[x+TwoColorTimeline.PREV_A],y=u[x+TwoColorTimeline.PREV_R2],A=u[x+TwoColorTimeline.PREV_G2],C=u[x+TwoColorTimeline.PREV_B2];var w=u[x],M=this.getCurvePercent(x/TwoColorTimeline.ENTRIES-1,1-(i-w)/(u[x+TwoColorTimeline.PREV_TIME]-w));m+=(u[x+TwoColorTimeline.R]-m)*M,g+=(u[x+TwoColorTimeline.G]-g)*M,v+=(u[x+TwoColorTimeline.B]-v)*M,T+=(u[x+TwoColorTimeline.A]-T)*M,y+=(u[x+TwoColorTimeline.R2]-y)*M,A+=(u[x+TwoColorTimeline.G2]-A)*M,C+=(u[x+TwoColorTimeline.B2]-C)*M}if(1==o)h.color.set(m,g,v,T),h.darkColor.set(y,A,C,1);else{c=h.color,d=h.darkColor;s==e.setup&&(c.setFromColor(h.data.color),d.setFromColor(h.data.darkColor)),c.add((m-c.r)*o,(g-c.g)*o,(v-c.b)*o,(T-c.a)*o),d.add((y-d.r)*o,(A-d.g)*o,(C-d.b)*o,0)}}}},TwoColorTimeline.ENTRIES=8,TwoColorTimeline.PREV_TIME=-8,TwoColorTimeline.PREV_R=-7,TwoColorTimeline.PREV_G=-6,TwoColorTimeline.PREV_B=-5,TwoColorTimeline.PREV_A=-4,TwoColorTimeline.PREV_R2=-3,TwoColorTimeline.PREV_G2=-2,TwoColorTimeline.PREV_B2=-1,TwoColorTimeline.R=1,TwoColorTimeline.G=2,TwoColorTimeline.B=3,TwoColorTimeline.A=4,TwoColorTimeline.R2=5,TwoColorTimeline.G2=6,TwoColorTimeline.B2=7,TwoColorTimeline}(r);t.TwoColorTimeline=c;var d=function(){function AttachmentTimeline(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return AttachmentTimeline.prototype.getPropertyId=function(){return(i.attachment<<24)+this.slotIndex},AttachmentTimeline.prototype.getFrameCount=function(){return this.frames.length},AttachmentTimeline.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},AttachmentTimeline.prototype.apply=function(t,i,r,o,s,l,h){var u=t.slots[this.slotIndex];if(u.bone.active)if(h!=n.mixOut||l!=e.setup){var c=this.frames;if(r<c[0]){if(l==e.setup||l==e.first){var d=u.data.attachmentName;u.setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}}else{var p=0;p=r>=c[c.length-1]?c.length-1:a.binarySearch(c,r,1)-1;var f=this.attachmentNames[p];t.slots[this.slotIndex].setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var m=u.data.attachmentName;u.setAttachment(null==m?null:t.getAttachment(this.slotIndex,m))}},AttachmentTimeline}();t.AttachmentTimeline=d;var p=null,f=function(n){function DeformTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e),i.frameVertices=new Array(e),null==p&&(p=t.Utils.newFloatArray(64)),i}return __extends(DeformTimeline,n),DeformTimeline.prototype.getPropertyId=function(){return(i.deform<<27)+ +this.attachment.id+this.slotIndex},DeformTimeline.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},DeformTimeline.prototype.apply=function(n,i,r,o,s,l,h){var u=n.slots[this.slotIndex];if(u.bone.active){var c=u.getAttachment();if(c instanceof t.VertexAttachment&&c.deformAttachment==this.attachment){var d=u.deform;0==d.length&&(l=e.setup);var p=this.frameVertices,f=p[0].length,m=this.frames;if(r<m[0]){var g=c;switch(l){case e.setup:return void(d.length=0);case e.first:if(1==s){d.length=0;break}var v=t.Utils.setArraySize(d,f);if(null==g.bones)for(var T=g.vertices,y=0;y<f;y++)v[y]+=(T[y]-v[y])*s;else{s=1-s;for(y=0;y<f;y++)v[y]*=s}}}else{var A=t.Utils.setArraySize(d,f);if(r>=m[m.length-1]){var C=p[m.length-1];if(1==s)if(l==e.add)if(null==(g=c).bones){T=g.vertices;for(var S=0;S<f;S++)A[S]+=C[S]-T[S]}else for(var x=0;x<f;x++)A[x]+=C[x];else t.Utils.arrayCopy(C,0,A,0,f);else switch(l){case e.setup:var w=c;if(null==w.bones){T=w.vertices;for(var M=0;M<f;M++){var E=T[M];A[M]=E+(C[M]-E)*s}}else for(var I=0;I<f;I++)A[I]=C[I]*s;break;case e.first:case e.replace:for(var b=0;b<f;b++)A[b]+=(C[b]-A[b])*s;break;case e.add:if(null==(g=c).bones){T=g.vertices;for(var R=0;R<f;R++)A[R]+=(C[R]-T[R])*s}else for(var k=0;k<f;k++)A[k]+=C[k]*s}}else{var P=a.binarySearch(m,r),_=p[P-1],V=p[P],B=m[P],F=this.getCurvePercent(P-1,1-(r-B)/(m[P-1]-B));if(1==s)if(l==e.add)if(null==(g=c).bones){T=g.vertices;for(var N=0;N<f;N++){var D=_[N];A[N]+=D+(V[N]-D)*F-T[N]}}else for(var U=0;U<f;U++){D=_[U];A[U]+=D+(V[U]-D)*F}else for(var L=0;L<f;L++){D=_[L];A[L]=D+(V[L]-D)*F}else switch(l){case e.setup:var O=c;if(null==O.bones){T=O.vertices;for(var Y=0;Y<f;Y++){D=_[Y],E=T[Y];A[Y]=E+(D+(V[Y]-D)*F-E)*s}}else for(var X=0;X<f;X++){D=_[X];A[X]=(D+(V[X]-D)*F)*s}break;case e.first:case e.replace:for(var W=0;W<f;W++){D=_[W];A[W]+=(D+(V[W]-D)*F-A[W])*s}break;case e.add:if(null==(g=c).bones){T=g.vertices;for(var q=0;q<f;q++){D=_[q];A[q]+=(D+(V[q]-D)*F-T[q])*s}}else for(var H=0;H<f;H++){D=_[H];A[H]+=(D+(V[H]-D)*F)*s}}}}}}},DeformTimeline}(r);t.DeformTimeline=f;var m=function(){function EventTimeline(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return EventTimeline.prototype.getPropertyId=function(){return i.event<<24},EventTimeline.prototype.getFrameCount=function(){return this.frames.length},EventTimeline.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},EventTimeline.prototype.apply=function(t,e,n,i,r,o,s){if(null!=i){var l=this.frames,h=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,i,r,o,s),e=-1;else if(e>=l[h-1])return;if(!(n<l[0])){var u=0;if(e<l[0])u=0;else for(var c=l[u=a.binarySearch(l,e)];u>0&&l[u-1]==c;)u--;for(;u<h&&n>=l[u];u++)i.push(this.events[u])}}},EventTimeline}();t.EventTimeline=m;var g=function(){function DrawOrderTimeline(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return DrawOrderTimeline.prototype.getPropertyId=function(){return i.drawOrder<<24},DrawOrderTimeline.prototype.getFrameCount=function(){return this.frames.length},DrawOrderTimeline.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},DrawOrderTimeline.prototype.apply=function(i,r,o,s,l,h,u){var c=i.drawOrder,d=i.slots;if(u!=n.mixOut||h!=e.setup){var p=this.frames;if(o<p[0])h!=e.setup&&h!=e.first||t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length);else{var f=0;f=o>=p[p.length-1]?p.length-1:a.binarySearch(p,o)-1;var m=this.drawOrders[f];if(null==m)t.Utils.arrayCopy(d,0,c,0,d.length);else for(var g=0,v=m.length;g<v;g++)c[g]=d[m[g]]}}else t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length)},DrawOrderTimeline}();t.DrawOrderTimeline=g;var v=function(r){function IkConstraintTimeline(e){var n=r.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*IkConstraintTimeline.ENTRIES),n}return __extends(IkConstraintTimeline,r),IkConstraintTimeline.prototype.getPropertyId=function(){return(i.ikConstraint<<24)+this.ikConstraintIndex},IkConstraintTimeline.prototype.setFrame=function(t,e,n,i,a,r,o){t*=IkConstraintTimeline.ENTRIES,this.frames[t]=e,this.frames[t+IkConstraintTimeline.MIX]=n,this.frames[t+IkConstraintTimeline.SOFTNESS]=i,this.frames[t+IkConstraintTimeline.BEND_DIRECTION]=a,this.frames[t+IkConstraintTimeline.COMPRESS]=r?1:0,this.frames[t+IkConstraintTimeline.STRETCH]=o?1:0},IkConstraintTimeline.prototype.apply=function(t,i,r,o,s,l,h){var u=this.frames,c=t.ikConstraints[this.ikConstraintIndex];if(c.active)if(r<u[0])switch(l){case e.setup:return c.mix=c.data.mix,c.softness=c.data.softness,c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,void(c.stretch=c.data.stretch);case e.first:c.mix+=(c.data.mix-c.mix)*s,c.softness+=(c.data.softness-c.softness)*s,c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch}else if(r>=u[u.length-IkConstraintTimeline.ENTRIES])l==e.setup?(c.mix=c.data.mix+(u[u.length+IkConstraintTimeline.PREV_MIX]-c.data.mix)*s,c.softness=c.data.softness+(u[u.length+IkConstraintTimeline.PREV_SOFTNESS]-c.data.softness)*s,h==n.mixOut?(c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch):(c.bendDirection=u[u.length+IkConstraintTimeline.PREV_BEND_DIRECTION],c.compress=0!=u[u.length+IkConstraintTimeline.PREV_COMPRESS],c.stretch=0!=u[u.length+IkConstraintTimeline.PREV_STRETCH])):(c.mix+=(u[u.length+IkConstraintTimeline.PREV_MIX]-c.mix)*s,c.softness+=(u[u.length+IkConstraintTimeline.PREV_SOFTNESS]-c.softness)*s,h==n.mixIn&&(c.bendDirection=u[u.length+IkConstraintTimeline.PREV_BEND_DIRECTION],c.compress=0!=u[u.length+IkConstraintTimeline.PREV_COMPRESS],c.stretch=0!=u[u.length+IkConstraintTimeline.PREV_STRETCH]));else{var d=a.binarySearch(u,r,IkConstraintTimeline.ENTRIES),p=u[d+IkConstraintTimeline.PREV_MIX],f=u[d+IkConstraintTimeline.PREV_SOFTNESS],m=u[d],g=this.getCurvePercent(d/IkConstraintTimeline.ENTRIES-1,1-(r-m)/(u[d+IkConstraintTimeline.PREV_TIME]-m));l==e.setup?(c.mix=c.data.mix+(p+(u[d+IkConstraintTimeline.MIX]-p)*g-c.data.mix)*s,c.softness=c.data.softness+(f+(u[d+IkConstraintTimeline.SOFTNESS]-f)*g-c.data.softness)*s,h==n.mixOut?(c.bendDirection=c.data.bendDirection,c.compress=c.data.compress,c.stretch=c.data.stretch):(c.bendDirection=u[d+IkConstraintTimeline.PREV_BEND_DIRECTION],c.compress=0!=u[d+IkConstraintTimeline.PREV_COMPRESS],c.stretch=0!=u[d+IkConstraintTimeline.PREV_STRETCH])):(c.mix+=(p+(u[d+IkConstraintTimeline.MIX]-p)*g-c.mix)*s,c.softness+=(f+(u[d+IkConstraintTimeline.SOFTNESS]-f)*g-c.softness)*s,h==n.mixIn&&(c.bendDirection=u[d+IkConstraintTimeline.PREV_BEND_DIRECTION],c.compress=0!=u[d+IkConstraintTimeline.PREV_COMPRESS],c.stretch=0!=u[d+IkConstraintTimeline.PREV_STRETCH]))}},IkConstraintTimeline.ENTRIES=6,IkConstraintTimeline.PREV_TIME=-6,IkConstraintTimeline.PREV_MIX=-5,IkConstraintTimeline.PREV_SOFTNESS=-4,IkConstraintTimeline.PREV_BEND_DIRECTION=-3,IkConstraintTimeline.PREV_COMPRESS=-2,IkConstraintTimeline.PREV_STRETCH=-1,IkConstraintTimeline.MIX=1,IkConstraintTimeline.SOFTNESS=2,IkConstraintTimeline.BEND_DIRECTION=3,IkConstraintTimeline.COMPRESS=4,IkConstraintTimeline.STRETCH=5,IkConstraintTimeline}(r);t.IkConstraintTimeline=v;var T=function(n){function TransformConstraintTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*TransformConstraintTimeline.ENTRIES),i}return __extends(TransformConstraintTimeline,n),TransformConstraintTimeline.prototype.getPropertyId=function(){return(i.transformConstraint<<24)+this.transformConstraintIndex},TransformConstraintTimeline.prototype.setFrame=function(t,e,n,i,a,r){t*=TransformConstraintTimeline.ENTRIES,this.frames[t]=e,this.frames[t+TransformConstraintTimeline.ROTATE]=n,this.frames[t+TransformConstraintTimeline.TRANSLATE]=i,this.frames[t+TransformConstraintTimeline.SCALE]=a,this.frames[t+TransformConstraintTimeline.SHEAR]=r},TransformConstraintTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.transformConstraints[this.transformConstraintIndex];if(u.active)if(i<h[0]){var c=u.data;switch(s){case e.setup:return u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,void(u.shearMix=c.shearMix);case e.first:u.rotateMix+=(c.rotateMix-u.rotateMix)*o,u.translateMix+=(c.translateMix-u.translateMix)*o,u.scaleMix+=(c.scaleMix-u.scaleMix)*o,u.shearMix+=(c.shearMix-u.shearMix)*o}}else{var d=0,p=0,f=0,m=0;if(i>=h[h.length-TransformConstraintTimeline.ENTRIES]){var g=h.length;d=h[g+TransformConstraintTimeline.PREV_ROTATE],p=h[g+TransformConstraintTimeline.PREV_TRANSLATE],f=h[g+TransformConstraintTimeline.PREV_SCALE],m=h[g+TransformConstraintTimeline.PREV_SHEAR]}else{var v=a.binarySearch(h,i,TransformConstraintTimeline.ENTRIES);d=h[v+TransformConstraintTimeline.PREV_ROTATE],p=h[v+TransformConstraintTimeline.PREV_TRANSLATE],f=h[v+TransformConstraintTimeline.PREV_SCALE],m=h[v+TransformConstraintTimeline.PREV_SHEAR];var T=h[v],y=this.getCurvePercent(v/TransformConstraintTimeline.ENTRIES-1,1-(i-T)/(h[v+TransformConstraintTimeline.PREV_TIME]-T));d+=(h[v+TransformConstraintTimeline.ROTATE]-d)*y,p+=(h[v+TransformConstraintTimeline.TRANSLATE]-p)*y,f+=(h[v+TransformConstraintTimeline.SCALE]-f)*y,m+=(h[v+TransformConstraintTimeline.SHEAR]-m)*y}if(s==e.setup){c=u.data;u.rotateMix=c.rotateMix+(d-c.rotateMix)*o,u.translateMix=c.translateMix+(p-c.translateMix)*o,u.scaleMix=c.scaleMix+(f-c.scaleMix)*o,u.shearMix=c.shearMix+(m-c.shearMix)*o}else u.rotateMix+=(d-u.rotateMix)*o,u.translateMix+=(p-u.translateMix)*o,u.scaleMix+=(f-u.scaleMix)*o,u.shearMix+=(m-u.shearMix)*o}},TransformConstraintTimeline.ENTRIES=5,TransformConstraintTimeline.PREV_TIME=-5,TransformConstraintTimeline.PREV_ROTATE=-4,TransformConstraintTimeline.PREV_TRANSLATE=-3,TransformConstraintTimeline.PREV_SCALE=-2,TransformConstraintTimeline.PREV_SHEAR=-1,TransformConstraintTimeline.ROTATE=1,TransformConstraintTimeline.TRANSLATE=2,TransformConstraintTimeline.SCALE=3,TransformConstraintTimeline.SHEAR=4,TransformConstraintTimeline}(r);t.TransformConstraintTimeline=T;var y=function(n){function PathConstraintPositionTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*PathConstraintPositionTimeline.ENTRIES),i}return __extends(PathConstraintPositionTimeline,n),PathConstraintPositionTimeline.prototype.getPropertyId=function(){return(i.pathConstraintPosition<<24)+this.pathConstraintIndex},PathConstraintPositionTimeline.prototype.setFrame=function(t,e,n){t*=PathConstraintPositionTimeline.ENTRIES,this.frames[t]=e,this.frames[t+PathConstraintPositionTimeline.VALUE]=n},PathConstraintPositionTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<h[0])switch(s){case e.setup:return void(u.position=u.data.position);case e.first:u.position+=(u.data.position-u.position)*o}else{var c=0;if(i>=h[h.length-PathConstraintPositionTimeline.ENTRIES])c=h[h.length+PathConstraintPositionTimeline.PREV_VALUE];else{var d=a.binarySearch(h,i,PathConstraintPositionTimeline.ENTRIES);c=h[d+PathConstraintPositionTimeline.PREV_VALUE];var p=h[d],f=this.getCurvePercent(d/PathConstraintPositionTimeline.ENTRIES-1,1-(i-p)/(h[d+PathConstraintPositionTimeline.PREV_TIME]-p));c+=(h[d+PathConstraintPositionTimeline.VALUE]-c)*f}s==e.setup?u.position=u.data.position+(c-u.data.position)*o:u.position+=(c-u.position)*o}},PathConstraintPositionTimeline.ENTRIES=2,PathConstraintPositionTimeline.PREV_TIME=-2,PathConstraintPositionTimeline.PREV_VALUE=-1,PathConstraintPositionTimeline.VALUE=1,PathConstraintPositionTimeline}(r);t.PathConstraintPositionTimeline=y;var A=function(t){function PathConstraintSpacingTimeline(e){return t.call(this,e)||this}return __extends(PathConstraintSpacingTimeline,t),PathConstraintSpacingTimeline.prototype.getPropertyId=function(){return(i.pathConstraintSpacing<<24)+this.pathConstraintIndex},PathConstraintSpacingTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<h[0])switch(s){case e.setup:return void(u.spacing=u.data.spacing);case e.first:u.spacing+=(u.data.spacing-u.spacing)*o}else{var c=0;if(i>=h[h.length-PathConstraintSpacingTimeline.ENTRIES])c=h[h.length+PathConstraintSpacingTimeline.PREV_VALUE];else{var d=a.binarySearch(h,i,PathConstraintSpacingTimeline.ENTRIES);c=h[d+PathConstraintSpacingTimeline.PREV_VALUE];var p=h[d],f=this.getCurvePercent(d/PathConstraintSpacingTimeline.ENTRIES-1,1-(i-p)/(h[d+PathConstraintSpacingTimeline.PREV_TIME]-p));c+=(h[d+PathConstraintSpacingTimeline.VALUE]-c)*f}s==e.setup?u.spacing=u.data.spacing+(c-u.data.spacing)*o:u.spacing+=(c-u.spacing)*o}},PathConstraintSpacingTimeline}(y);t.PathConstraintSpacingTimeline=A;var C=function(n){function PathConstraintMixTimeline(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*PathConstraintMixTimeline.ENTRIES),i}return __extends(PathConstraintMixTimeline,n),PathConstraintMixTimeline.prototype.getPropertyId=function(){return(i.pathConstraintMix<<24)+this.pathConstraintIndex},PathConstraintMixTimeline.prototype.setFrame=function(t,e,n,i){t*=PathConstraintMixTimeline.ENTRIES,this.frames[t]=e,this.frames[t+PathConstraintMixTimeline.ROTATE]=n,this.frames[t+PathConstraintMixTimeline.TRANSLATE]=i},PathConstraintMixTimeline.prototype.apply=function(t,n,i,r,o,s,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<h[0])switch(s){case e.setup:return u.rotateMix=u.data.rotateMix,void(u.translateMix=u.data.translateMix);case e.first:u.rotateMix+=(u.data.rotateMix-u.rotateMix)*o,u.translateMix+=(u.data.translateMix-u.translateMix)*o}else{var c=0,d=0;if(i>=h[h.length-PathConstraintMixTimeline.ENTRIES])c=h[h.length+PathConstraintMixTimeline.PREV_ROTATE],d=h[h.length+PathConstraintMixTimeline.PREV_TRANSLATE];else{var p=a.binarySearch(h,i,PathConstraintMixTimeline.ENTRIES);c=h[p+PathConstraintMixTimeline.PREV_ROTATE],d=h[p+PathConstraintMixTimeline.PREV_TRANSLATE];var f=h[p],m=this.getCurvePercent(p/PathConstraintMixTimeline.ENTRIES-1,1-(i-f)/(h[p+PathConstraintMixTimeline.PREV_TIME]-f));c+=(h[p+PathConstraintMixTimeline.ROTATE]-c)*m,d+=(h[p+PathConstraintMixTimeline.TRANSLATE]-d)*m}s==e.setup?(u.rotateMix=u.data.rotateMix+(c-u.data.rotateMix)*o,u.translateMix=u.data.translateMix+(d-u.data.translateMix)*o):(u.rotateMix+=(c-u.rotateMix)*o,u.translateMix+=(d-u.translateMix)*o)}},PathConstraintMixTimeline.ENTRIES=3,PathConstraintMixTimeline.PREV_TIME=-3,PathConstraintMixTimeline.PREV_ROTATE=-2,PathConstraintMixTimeline.PREV_TRANSLATE=-1,PathConstraintMixTimeline.ROTATE=1,PathConstraintMixTimeline.TRANSLATE=2,PathConstraintMixTimeline}(r);t.PathConstraintMixTimeline=C}(spine||(spine={})),function(t){var e=function(){function AnimationState(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new a(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new n})),this.data=e}return AnimationState.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,i=e.length;n<i;n++){var a=e[n];if(null!=a){a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast;var r=t*a.timeScale;if(a.delay>0){if(a.delay-=r,a.delay>0)continue;r=-a.delay,a.delay=0}var o=a.next;if(null!=o){var s=a.trackLast-o.delay;if(s>=0){for(o.delay=0,o.trackTime+=0==a.timeScale?0:(s/a.timeScale+t)*o.timeScale,a.trackTime+=r,this.setCurrent(n,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(a.trackLast>=a.trackEnd&&null==a.mixingFrom){e[n]=null,this.queue.end(a),this.disposeNext(a);continue}if(null!=a.mixingFrom&&this.updateMixingFrom(a,t)){var l=a.mixingFrom;for(a.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}a.trackTime+=r}}this.queue.drain()},AnimationState.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(null==n)return!0;var i=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),i):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},AnimationState.prototype.apply=function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var n=this.events,i=this.tracks,a=!1,r=0,o=i.length;r<o;r++){var s=i[r];if(!(null==s||s.delay>0)){a=!0;var l=0==r?t.MixBlend.first:s.mixBlend,h=s.alpha;null!=s.mixingFrom?h*=this.applyMixingFrom(s,e,l):s.trackTime>=s.trackEnd&&null==s.next&&(h=0);var u=s.animationLast,c=s.getAnimationTime(),d=s.animation.timelines.length,p=s.animation.timelines;if(0==r&&1==h||l==t.MixBlend.add)for(var f=0;f<d;f++)t.Utils.webkit602BugfixHelper(h,l),p[f].apply(e,u,c,n,h,l,t.MixDirection.mixIn);else{var m=s.timelineMode,g=0==s.timelinesRotation.length;g&&t.Utils.setArraySize(s.timelinesRotation,d<<1,null);var v=s.timelinesRotation;for(f=0;f<d;f++){var T=p[f],y=(m[f]&AnimationState.NOT_LAST-1)==AnimationState.SUBSEQUENT?l:t.MixBlend.setup;T instanceof t.RotateTimeline?this.applyRotateTimeline(T,e,c,h,y,v,f<<1,g):(t.Utils.webkit602BugfixHelper(h,l),T.apply(e,u,c,n,h,y,t.MixDirection.mixIn))}}this.queueEvents(s,c),n.length=0,s.nextAnimationLast=c,s.nextTrackLast=s.trackTime}}return this.queue.drain(),a},AnimationState.prototype.applyMixingFrom=function(e,n,i){var a=e.mixingFrom;null!=a.mixingFrom&&this.applyMixingFrom(a,n,i);var r=0;0==e.mixDuration?(r=1,i==t.MixBlend.first&&(i=t.MixBlend.setup)):((r=e.mixTime/e.mixDuration)>1&&(r=1),i!=t.MixBlend.first&&(i=a.mixBlend));var o=r<a.eventThreshold?this.events:null,s=r<a.attachmentThreshold,l=r<a.drawOrderThreshold,h=a.animationLast,u=a.getAnimationTime(),c=a.animation.timelines.length,d=a.animation.timelines,p=a.alpha*e.interruptAlpha,f=p*(1-r);if(i==t.MixBlend.add)for(var m=0;m<c;m++)d[m].apply(n,h,u,o,f,i,t.MixDirection.mixOut);else{var g=a.timelineMode,v=a.timelineHoldMix,T=0==a.timelinesRotation.length;T&&t.Utils.setArraySize(a.timelinesRotation,c<<1,null);var y=a.timelinesRotation;a.totalAlpha=0;for(m=0;m<c;m++){var A=d[m],C=t.MixDirection.mixOut,S=void 0,x=0;switch(g[m]&AnimationState.NOT_LAST-1){case AnimationState.SUBSEQUENT:if(S=i,!s&&A instanceof t.AttachmentTimeline){if((g[m]&AnimationState.NOT_LAST)==AnimationState.NOT_LAST)continue;S=t.MixBlend.setup}if(!l&&A instanceof t.DrawOrderTimeline)continue;x=f;break;case AnimationState.FIRST:S=t.MixBlend.setup,x=f;break;case AnimationState.HOLD:S=t.MixBlend.setup,x=p;break;default:S=t.MixBlend.setup;var w=v[m];x=p*Math.max(0,1-w.mixTime/w.mixDuration)}a.totalAlpha+=x,A instanceof t.RotateTimeline?this.applyRotateTimeline(A,n,u,x,S,y,m<<1,T):(t.Utils.webkit602BugfixHelper(x,i),S==t.MixBlend.setup&&(A instanceof t.AttachmentTimeline?(s||(g[m]&AnimationState.NOT_LAST)==AnimationState.NOT_LAST)&&(C=t.MixDirection.mixIn):A instanceof t.DrawOrderTimeline&&l&&(C=t.MixDirection.mixIn)),A.apply(n,h,u,o,x,S,C))}}return e.mixDuration>0&&this.queueEvents(a,u),this.events.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime,r},AnimationState.prototype.applyRotateTimeline=function(e,n,i,a,r,o,s,l){if(l&&(o[s]=0),1!=a){var h=e,u=h.frames,c=n.bones[h.boneIndex];if(c.active){var d=0,p=0;if(i<u[0])switch(r){case t.MixBlend.setup:c.rotation=c.data.rotation;default:return;case t.MixBlend.first:d=c.rotation,p=c.data.rotation}else if(d=r==t.MixBlend.setup?c.data.rotation:c.rotation,i>=u[u.length-t.RotateTimeline.ENTRIES])p=c.data.rotation+u[u.length+t.RotateTimeline.PREV_ROTATION];else{var f=t.Animation.binarySearch(u,i,t.RotateTimeline.ENTRIES),m=u[f+t.RotateTimeline.PREV_ROTATION],g=u[f],v=h.getCurvePercent((f>>1)-1,1-(i-g)/(u[f+t.RotateTimeline.PREV_TIME]-g));p=u[f+t.RotateTimeline.ROTATION]-m,p=m+(p-=360*(16384-(16384.499999999996-p/360|0)))*v+c.data.rotation,p-=360*(16384-(16384.499999999996-p/360|0))}var T=0,y=p-d;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))T=o[s];else{var A=0,C=0;l?(A=0,C=y):(A=o[s],C=o[s+1]);var S=y>0,x=A>=0;t.MathUtils.signum(C)!=t.MathUtils.signum(y)&&Math.abs(C)<=90&&(Math.abs(A)>180&&(A+=360*t.MathUtils.signum(A)),x=S),T=y+A-A%360,x!=S&&(T+=360*t.MathUtils.signum(A)),o[s]=T}o[s+1]=y,d+=T*a,c.rotation=d-360*(16384-(16384.499999999996-d/360|0))}}else e.apply(n,0,i,null,1,r,t.MixDirection.mixIn)},AnimationState.prototype.queueEvents=function(t,e){for(var n=t.animationStart,i=t.animationEnd,a=i-n,r=t.trackLast%a,o=this.events,s=0,l=o.length;s<l;s++){var h=o[s];if(h.time<r)break;h.time>i||this.queue.event(t,h)}for((t.loop?0==a||r>t.trackTime%a:e>=i&&t.animationLast<i)&&this.queue.complete(t);s<l;s++){o[s].time<n||this.queue.event(t,o[s])}},AnimationState.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},AnimationState.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var n=e;;){var i=n.mixingFrom;if(null==i)break;this.queue.end(i),n.mixingFrom=null,n.mixingTo=null,n=i}this.tracks[e.trackIndex]=null,this.queue.drain()}}},AnimationState.prototype.setCurrent=function(t,e,n){var i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(n&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)},AnimationState.prototype.setAnimation=function(t,e,n){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,n)},AnimationState.prototype.setAnimationWith=function(t,e,n){if(null==e)throw new Error("animation cannot be null.");var i=!0,a=this.expandToIndex(t);null!=a&&(-1==a.nextTrackLast?(this.tracks[t]=a.mixingFrom,this.queue.interrupt(a),this.queue.end(a),this.disposeNext(a),a=a.mixingFrom,i=!1):this.disposeNext(a));var r=this.trackEntry(t,e,n,a);return this.setCurrent(t,r,i),this.queue.drain(),r},AnimationState.prototype.addAnimation=function(t,e,n,i){var a=this.data.skeletonData.findAnimation(e);if(null==a)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,a,n,i)},AnimationState.prototype.addAnimationWith=function(t,e,n,i){if(null==e)throw new Error("animation cannot be null.");var a=this.expandToIndex(t);if(null!=a)for(;null!=a.next;)a=a.next;var r=this.trackEntry(t,e,n,a);if(null==a)this.setCurrent(t,r,!0),this.queue.drain();else if(a.next=r,i<=0){var o=a.animationEnd-a.animationStart;0!=o?(a.loop?i+=o*(1+(a.trackTime/o|0)):i+=Math.max(o,a.trackTime),i-=this.data.getMix(a.animation,e)):i=a.trackTime}return r.delay=i,r},AnimationState.prototype.setEmptyAnimation=function(t,e){var n=this.setAnimationWith(t,AnimationState.emptyAnimation,!1);return n.mixDuration=e,n.trackEnd=e,n},AnimationState.prototype.addEmptyAnimation=function(t,e,n){n<=0&&(n-=e);var i=this.addAnimationWith(t,AnimationState.emptyAnimation,!1,n);return i.mixDuration=e,i.trackEnd=e,i},AnimationState.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,i=this.tracks.length;n<i;n++){var a=this.tracks[n];null!=a&&this.setEmptyAnimation(a.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},AnimationState.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},AnimationState.prototype.trackEntry=function(e,n,i,a){var r=this.trackEntryPool.obtain();return r.trackIndex=e,r.animation=n,r.loop=i,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=n.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==a?0:this.data.getMix(a.animation,n),r.mixBlend=t.MixBlend.replace,r},AnimationState.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},AnimationState.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,n=this.tracks.length;e<n;e++){if(null!=(i=this.tracks[e])){for(;null!=i.mixingFrom;)i=i.mixingFrom;do{null!=i.mixingFrom&&i.mixBlend==t.MixBlend.add||this.computeHold(i),i=i.mixingTo}while(null!=i)}}this.propertyIDs.clear();for(e=this.tracks.length-1;e>=0;e--)for(var i=this.tracks[e];null!=i;)this.computeNotLast(i),i=i.mixingFrom},AnimationState.prototype.computeHold=function(e){var n=e.mixingTo,i=e.animation.timelines,a=e.animation.timelines.length,r=t.Utils.setArraySize(e.timelineMode,a);e.timelineHoldMix.length=0;var o=t.Utils.setArraySize(e.timelineHoldMix,a),s=this.propertyIDs;if(null!=n&&n.holdPrevious)for(var l=0;l<a;l++)s.add(i[l].getPropertyId()),r[l]=AnimationState.HOLD;else t:for(l=0;l<a;l++){var h=i[l],u=h.getPropertyId();if(s.add(u))if(null==n||h instanceof t.AttachmentTimeline||h instanceof t.DrawOrderTimeline||h instanceof t.EventTimeline||!n.animation.hasTimeline(u))r[l]=AnimationState.FIRST;else{for(var c=n.mixingTo;null!=c;c=c.mixingTo)if(!c.animation.hasTimeline(u)){if(e.mixDuration>0){r[l]=AnimationState.HOLD_MIX,o[l]=c;continue t}break}r[l]=AnimationState.HOLD}else r[l]=AnimationState.SUBSEQUENT}},AnimationState.prototype.computeNotLast=function(e){for(var n=e.animation.timelines,i=e.animation.timelines.length,a=e.timelineMode,r=this.propertyIDs,o=0;o<i;o++)if(n[o]instanceof t.AttachmentTimeline){var s=n[o];r.add(s.slotIndex)||(a[o]|=AnimationState.NOT_LAST)}},AnimationState.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},AnimationState.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},AnimationState.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},AnimationState.prototype.clearListeners=function(){this.listeners.length=0},AnimationState.prototype.clearListenerNotifications=function(){this.queue.clear()},AnimationState.emptyAnimation=new t.Animation("<empty>",[],0),AnimationState.SUBSEQUENT=0,AnimationState.FIRST=1,AnimationState.HOLD=2,AnimationState.HOLD_MIX=3,AnimationState.NOT_LAST=4,AnimationState}();t.AnimationState=e;var n=function(){function TrackEntry(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return TrackEntry.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},TrackEntry.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},TrackEntry.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},TrackEntry.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},TrackEntry.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},TrackEntry}();t.TrackEntry=n;var i,a=function(){function EventQueue(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return EventQueue.prototype.start=function(t){this.objects.push(i.start),this.objects.push(t),this.animState.animationsChanged=!0},EventQueue.prototype.interrupt=function(t){this.objects.push(i.interrupt),this.objects.push(t)},EventQueue.prototype.end=function(t){this.objects.push(i.end),this.objects.push(t),this.animState.animationsChanged=!0},EventQueue.prototype.dispose=function(t){this.objects.push(i.dispose),this.objects.push(t)},EventQueue.prototype.complete=function(t){this.objects.push(i.complete),this.objects.push(t)},EventQueue.prototype.event=function(t,e){this.objects.push(i.event),this.objects.push(t),this.objects.push(e)},EventQueue.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var a=t[n],r=t[n+1];switch(a){case i.start:null!=r.listener&&r.listener.start&&r.listener.start(r);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(r);break;case i.interrupt:null!=r.listener&&r.listener.interrupt&&r.listener.interrupt(r);for(o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(r);break;case i.end:null!=r.listener&&r.listener.end&&r.listener.end(r);for(o=0;o<e.length;o++)e[o].end&&e[o].end(r);case i.dispose:null!=r.listener&&r.listener.dispose&&r.listener.dispose(r);for(o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(r);this.animState.trackEntryPool.free(r);break;case i.complete:null!=r.listener&&r.listener.complete&&r.listener.complete(r);for(o=0;o<e.length;o++)e[o].complete&&e[o].complete(r);break;case i.event:var s=t[2+n++];null!=r.listener&&r.listener.event&&r.listener.event(r,s);for(o=0;o<e.length;o++)e[o].event&&e[o].event(r,s)}}this.clear(),this.drainDisabled=!1}},EventQueue.prototype.clear=function(){this.objects.length=0},EventQueue}();t.EventQueue=a,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(i=t.EventType||(t.EventType={}));var r=function(){function AnimationStateAdapter(){}return AnimationStateAdapter.prototype.start=function(t){},AnimationStateAdapter.prototype.interrupt=function(t){},AnimationStateAdapter.prototype.end=function(t){},AnimationStateAdapter.prototype.dispose=function(t){},AnimationStateAdapter.prototype.complete=function(t){},AnimationStateAdapter.prototype.event=function(t,e){},AnimationStateAdapter}();t.AnimationStateAdapter=r}(spine||(spine={})),function(t){var e=function(){function AnimationStateData(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return AnimationStateData.prototype.setMix=function(t,e,n){var i=this.skeletonData.findAnimation(t);if(null==i)throw new Error("Animation not found: "+t);var a=this.skeletonData.findAnimation(e);if(null==a)throw new Error("Animation not found: "+e);this.setMixWith(i,a,n)},AnimationStateData.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var i=t.name+"."+e.name;this.animationToMixTime[i]=n},AnimationStateData.prototype.getMix=function(t,e){var n=t.name+"."+e.name,i=this.animationToMixTime[n];return void 0===i?this.defaultMix:i},AnimationStateData}();t.AnimationStateData=e}(spine||(spine={})),function(t){var e=function(){function AssetManager(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.rawDataUris={},this.textureLoader=t,this.pathPrefix=e}return AssetManager.prototype.downloadText=function(t,e,n){var i=new XMLHttpRequest;i.overrideMimeType("text/html"),this.rawDataUris[t]&&(t=this.rawDataUris[t]),i.open("GET",t,!0),i.onload=function(){200==i.status?e(i.responseText):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},AssetManager.prototype.downloadBinary=function(t,e,n){var i=new XMLHttpRequest;this.rawDataUris[t]&&(t=this.rawDataUris[t]),i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status?e(new Uint8Array(i.response)):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},AssetManager.prototype.setRawDataURI=function(t,e){this.rawDataUris[this.pathPrefix+t]=e},AssetManager.prototype.loadBinary=function(t,e,n){var i=this;void 0===e&&(e=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++,this.downloadBinary(t,(function(n){i.assets[t]=n,e&&e(t,n),i.toLoad--,i.loaded++}),(function(e,a){i.errors[t]="Couldn't load binary "+t+": status "+status+", "+a,n&&n(t,"Couldn't load binary "+t+": status "+status+", "+a),i.toLoad--,i.loaded++}))},AssetManager.prototype.loadText=function(t,e,n){var i=this;void 0===e&&(e=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(n){i.assets[t]=n,e&&e(t,n),i.toLoad--,i.loaded++}),(function(e,a){i.errors[t]="Couldn't load text "+t+": status "+status+", "+a,n&&n(t,"Couldn't load text "+t+": status "+status+", "+a),i.toLoad--,i.loaded++}))},AssetManager.prototype.loadTexture=function(t,e,n){var i=this;void 0===e&&(e=null),void 0===n&&(n=null);var a=t=this.pathPrefix+t;this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(n){var o=i.textureLoader(r);i.assets[a]=o,i.toLoad--,i.loaded++,e&&e(t,r)},r.onerror=function(e){i.errors[t]="Couldn't load image "+t,i.toLoad--,i.loaded++,n&&n(t,"Couldn't load image "+t)},this.rawDataUris[t]&&(t=this.rawDataUris[t]),r.src=t},AssetManager.prototype.loadTextureAtlas=function(e,n,i){var a=this;void 0===n&&(n=null),void 0===i&&(i=null);var r=e.lastIndexOf("/")>=0?e.substring(0,e.lastIndexOf("/")):"";e=this.pathPrefix+e,this.toLoad++,this.downloadText(e,(function(o){var s={count:0},l=new Array;try{new t.TextureAtlas(o,(function(e){l.push(""==r?e:r+"/"+e);var n=document.createElement("img");return n.width=16,n.height=16,new t.FakeTexture(n)}))}catch(t){var h=t;return a.errors[e]="Couldn't load texture atlas "+e+": "+h.message,i&&i(e,"Couldn't load texture atlas "+e+": "+h.message),a.toLoad--,void a.loaded++}for(var _loop_1=function(h){var u=!1;a.loadTexture(h,(function(h,c){if(s.count++,s.count==l.length)if(u)a.errors[e]="Couldn't load texture atlas page "+h+"} of atlas "+e,i&&i(e,"Couldn't load texture atlas page "+h+" of atlas "+e),a.toLoad--,a.loaded++;else try{var d=new t.TextureAtlas(o,(function(t){return a.get(""==r?t:r+"/"+t)}));a.assets[e]=d,n&&n(e,d),a.toLoad--,a.loaded++}catch(t){var p=t;a.errors[e]="Couldn't load texture atlas "+e+": "+p.message,i&&i(e,"Couldn't load texture atlas "+e+": "+p.message),a.toLoad--,a.loaded++}}),(function(t,n){u=!0,s.count++,s.count==l.length&&(a.errors[e]="Couldn't load texture atlas page "+t+"} of atlas "+e,i&&i(e,"Couldn't load texture atlas page "+t+" of atlas "+e),a.toLoad--,a.loaded++)}))},u=0,c=l;u<c.length;u++){_loop_1(c[u])}}),(function(t,n){a.errors[e]="Couldn't load texture atlas "+e+": status "+status+", "+n,i&&i(e,"Couldn't load texture atlas "+e+": status "+status+", "+n),a.toLoad--,a.loaded++}))},AssetManager.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},AssetManager.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},AssetManager.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},AssetManager.prototype.isLoadingComplete=function(){return 0==this.toLoad},AssetManager.prototype.getToLoad=function(){return this.toLoad},AssetManager.prototype.getLoaded=function(){return this.loaded},AssetManager.prototype.dispose=function(){this.removeAll()},AssetManager.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},AssetManager.prototype.getErrors=function(){return this.errors},AssetManager}();t.AssetManager=e}(spine||(spine={})),function(t){var e=function(){function AtlasAttachmentLoader(t){this.atlas=t}return AtlasAttachmentLoader.prototype.newRegionAttachment=function(e,n,i){var a=this.atlas.findRegion(i);if(null==a)throw new Error("Region not found in atlas: "+i+" (region attachment: "+n+")");a.renderObject=a;var r=new t.RegionAttachment(n);return r.setRegion(a),r},AtlasAttachmentLoader.prototype.newMeshAttachment=function(e,n,i){var a=this.atlas.findRegion(i);if(null==a)throw new Error("Region not found in atlas: "+i+" (mesh attachment: "+n+")");a.renderObject=a;var r=new t.MeshAttachment(n);return r.region=a,r},AtlasAttachmentLoader.prototype.newBoundingBoxAttachment=function(e,n){return new t.BoundingBoxAttachment(n)},AtlasAttachmentLoader.prototype.newPathAttachment=function(e,n){return new t.PathAttachment(n)},AtlasAttachmentLoader.prototype.newPointAttachment=function(e,n){return new t.PointAttachment(n)},AtlasAttachmentLoader.prototype.newClippingAttachment=function(e,n){return new t.ClippingAttachment(n)},AtlasAttachmentLoader}();t.AtlasAttachmentLoader=e}(spine||(spine={})),function(t){!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(t.BlendMode||(t.BlendMode={}))}(spine||(spine={})),function(t){var e=function(){function Bone(t,e,n){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return Bone.prototype.isActive=function(){return this.active},Bone.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},Bone.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},Bone.prototype.updateWorldTransformWith=function(e,n,i,a,r,o,s){this.ax=e,this.ay=n,this.arotation=i,this.ascaleX=a,this.ascaleY=r,this.ashearX=o,this.ashearY=s,this.appliedValid=!0;var l=this.parent;if(null==l){var h=this.skeleton,u=i+90+s,c=h.scaleX,d=h.scaleY;return this.a=t.MathUtils.cosDeg(i+o)*a*c,this.b=t.MathUtils.cosDeg(u)*r*c,this.c=t.MathUtils.sinDeg(i+o)*a*d,this.d=t.MathUtils.sinDeg(u)*r*d,this.worldX=e*c+h.x,void(this.worldY=n*d+h.y)}var p=l.a,f=l.b,m=l.c,g=l.d;switch(this.worldX=p*e+f*n+l.worldX,this.worldY=m*e+g*n+l.worldY,this.data.transformMode){case t.TransformMode.Normal:u=i+90+s;var v=t.MathUtils.cosDeg(i+o)*a,T=t.MathUtils.cosDeg(u)*r,y=t.MathUtils.sinDeg(i+o)*a,A=t.MathUtils.sinDeg(u)*r;return this.a=p*v+f*y,this.b=p*T+f*A,this.c=m*v+g*y,void(this.d=m*T+g*A);case t.TransformMode.OnlyTranslation:u=i+90+s;this.a=t.MathUtils.cosDeg(i+o)*a,this.b=t.MathUtils.cosDeg(u)*r,this.c=t.MathUtils.sinDeg(i+o)*a,this.d=t.MathUtils.sinDeg(u)*r;break;case t.TransformMode.NoRotationOrReflection:var C=0;(w=p*p+m*m)>1e-4?(f=m*(w=Math.abs(p*g-f*m)/w),g=p*w,C=Math.atan2(m,p)*t.MathUtils.radDeg):(p=0,m=0,C=90-Math.atan2(g,f)*t.MathUtils.radDeg);var S=i+o-C,x=i+s-C+90;v=t.MathUtils.cosDeg(S)*a,T=t.MathUtils.cosDeg(x)*r,y=t.MathUtils.sinDeg(S)*a,A=t.MathUtils.sinDeg(x)*r;this.a=p*v-f*y,this.b=p*T-f*A,this.c=m*v+g*y,this.d=m*T+g*A;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var w,M=t.MathUtils.cosDeg(i),E=t.MathUtils.sinDeg(i),I=(p*M+f*E)/this.skeleton.scaleX,b=(m*M+g*E)/this.skeleton.scaleY;(w=Math.sqrt(I*I+b*b))>1e-5&&(w=1/w),I*=w,b*=w,w=Math.sqrt(I*I+b*b),this.data.transformMode==t.TransformMode.NoScale&&p*g-f*m<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(w=-w);var R=Math.PI/2+Math.atan2(b,I),k=Math.cos(R)*w,P=Math.sin(R)*w;v=t.MathUtils.cosDeg(o)*a,T=t.MathUtils.cosDeg(90+s)*r,y=t.MathUtils.sinDeg(o)*a,A=t.MathUtils.sinDeg(90+s)*r;this.a=I*v+k*y,this.b=I*T+k*A,this.c=b*v+P*y,this.d=b*T+P*A}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},Bone.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},Bone.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},Bone.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},Bone.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},Bone.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},Bone.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var n=e.a,i=e.b,a=e.c,r=e.d,o=1/(n*r-i*a),s=this.worldX-e.worldX,l=this.worldY-e.worldY;this.ax=s*r*o-l*i*o,this.ay=l*n*o-s*a*o;var h=o*r,u=o*n,c=o*i,d=o*a,p=h*this.a-c*this.c,f=h*this.b-c*this.d,m=u*this.c-d*this.a,g=u*this.d-d*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(p*p+m*m),this.ascaleX>1e-4){var v=p*g-f*m;this.ascaleY=v/this.ascaleX,this.ashearY=Math.atan2(p*f+m*g,v)*t.MathUtils.radDeg,this.arotation=Math.atan2(m,p)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,f)*t.MathUtils.radDeg},Bone.prototype.worldToLocal=function(t){var e=this.a,n=this.b,i=this.c,a=this.d,r=1/(e*a-n*i),o=t.x-this.worldX,s=t.y-this.worldY;return t.x=o*a*r-s*n*r,t.y=s*e*r-o*i*r,t},Bone.prototype.localToWorld=function(t){var e=t.x,n=t.y;return t.x=e*this.a+n*this.b+this.worldX,t.y=e*this.c+n*this.d+this.worldY,t},Bone.prototype.worldToLocalRotation=function(e){var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(this.a*n-this.c*i,this.d*i-this.b*n)*t.MathUtils.radDeg+this.rotation-this.shearX},Bone.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(i*this.c+n*this.d,i*this.a+n*this.b)*t.MathUtils.radDeg},Bone.prototype.rotateWorld=function(e){var n=this.a,i=this.b,a=this.c,r=this.d,o=t.MathUtils.cosDeg(e),s=t.MathUtils.sinDeg(e);this.a=o*n-s*a,this.b=o*i-s*r,this.c=s*n+o*a,this.d=s*i+o*r,this.appliedValid=!1},Bone}();t.Bone=e}(spine||(spine={})),function(t){var e,n=function n(i,a,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,i<0)throw new Error("index must be >= 0.");if(null==a)throw new Error("name cannot be null.");this.index=i,this.name=a,this.parent=r};t.BoneData=n,function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(spine||(spine={})),function(t){var e=function e(t,n,i){this.name=t,this.order=n,this.skinRequired=i};t.ConstraintData=e}(spine||(spine={})),function(t){var e=function e(t,n){if(null==n)throw new Error("data cannot be null.");this.time=t,this.data=n};t.Event=e}(spine||(spine={})),function(t){var e=function e(t){this.name=t};t.EventData=e}(spine||(spine={})),function(t){var e=function(){function IkConstraint(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return IkConstraint.prototype.isActive=function(){return this.active},IkConstraint.prototype.apply=function(){this.update()},IkConstraint.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},IkConstraint.prototype.apply1=function(e,n,i,a,r,o,s){e.appliedValid||e.updateAppliedTransform();var l=e.parent,h=l.a,u=l.b,c=l.c,d=l.d,p=-e.ashearX-e.arotation,f=0,m=0;switch(e.data.transformMode){case t.TransformMode.OnlyTranslation:f=n-e.worldX,m=i-e.worldY;break;case t.TransformMode.NoRotationOrReflection:p+=Math.atan2(c,h)*t.MathUtils.radDeg;var g=Math.abs(h*d-u*c)/(h*h+c*c);u=-c*g,d=h*g;default:var v=n-l.worldX,T=i-l.worldY,y=h*d-u*c;f=(v*d-T*u)/y-e.ax,m=(T*h-v*c)/y-e.ay}p+=Math.atan2(m,f)*t.MathUtils.radDeg,e.ascaleX<0&&(p+=180),p>180?p-=360:p<-180&&(p+=360);var A=e.ascaleX,C=e.ascaleY;if(a||r){switch(e.data.transformMode){case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:f=n-e.worldX,m=i-e.worldY}var S=e.data.length*A,x=Math.sqrt(f*f+m*m);if(a&&x<S||r&&x>S&&S>1e-4){var w=(x/S-1)*s+1;A*=w,o&&(C*=w)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+p*s,A,C,e.ashearX,e.ashearY)},IkConstraint.prototype.apply2=function(e,n,i,a,r,o,s,l){if(0!=l){e.appliedValid||e.updateAppliedTransform(),n.appliedValid||n.updateAppliedTransform();var h=e.ax,u=e.ay,c=e.ascaleX,d=c,p=e.ascaleY,f=n.ascaleX,m=0,g=0,v=0;c<0?(c=-c,m=180,v=-1):(m=0,v=1),p<0&&(p=-p,v=-v),f<0?(f=-f,g=180):g=0;var T=n.ax,y=0,A=0,C=0,S=e.a,x=e.b,w=e.c,M=e.d,E=Math.abs(c-p)<=1e-4;E?(A=S*T+x*(y=n.ay)+e.worldX,C=w*T+M*y+e.worldY):(y=0,A=S*T+e.worldX,C=w*T+e.worldY);var I=e.parent;S=I.a,x=I.b,w=I.c;var b,R,k=1/(S*(M=I.d)-x*w),P=A-I.worldX,_=C-I.worldY,V=(P*M-_*x)*k-h,B=(_*S-P*w)*k-u,F=Math.sqrt(V*V+B*B),N=n.data.length*f;if(F<1e-4)return this.apply1(e,i,a,!1,o,!1,l),void n.updateWorldTransformWith(T,y,0,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY);var D=((P=i-I.worldX)*M-(_=a-I.worldY)*x)*k-h,U=(_*S-P*w)*k-u,L=D*D+U*U;if(0!=s){s*=c*(f+1)/2;var O=Math.sqrt(L),Y=O-F-N*c+s;if(Y>0){var X=Math.min(1,Y/(2*s))-1;L=(D-=(X=(Y-s*(1-X*X))/O)*D)*D+(U-=X*U)*U}}t:if(E){var W=(L-F*F-(N*=c)*N)/(2*F*N);W<-1?W=-1:W>1&&(W=1,o&&(d*=(Math.sqrt(L)/(F+N)-1)*l+1)),R=Math.acos(W)*r,S=F+N*W,x=N*Math.sin(R),b=Math.atan2(U*S-D*x,D*S+U*x)}else{var q=(S=c*N)*S,H=(x=p*N)*x,j=Math.atan2(U,D),G=-2*H*F,z=H-q;if((M=G*G-4*z*(w=H*F*F+q*L-q*H))>=0){var J=Math.sqrt(M);G<0&&(J=-J);var Z=(J=-(G+J)/2)/z,Q=w/J,K=Math.abs(Z)<Math.abs(Q)?Z:Q;if(K*K<=L){_=Math.sqrt(L-K*K)*r,b=j-Math.atan2(_,K),R=Math.atan2(_/p,(K-F)/c);break t}}var $=t.MathUtils.PI,tt=F-S,et=tt*tt,nt=0,it=0,at=F+S,rt=at*at,ot=0;(w=-S*F/(q-H))>=-1&&w<=1&&(w=Math.acos(w),(M=(P=S*Math.cos(w)+F)*P+(_=x*Math.sin(w))*_)<et&&($=w,et=M,tt=P,nt=_),M>rt&&(it=w,rt=M,at=P,ot=_)),L<=(et+rt)/2?(b=j-Math.atan2(nt*r,tt),R=$*r):(b=j-Math.atan2(ot*r,at),R=it*r)}var st=Math.atan2(y,T)*v,lt=e.arotation;(b=(b-st)*t.MathUtils.radDeg+m-lt)>180?b-=360:b<-180&&(b+=360),e.updateWorldTransformWith(h,u,lt+b*l,d,e.ascaleY,0,0),lt=n.arotation,(R=((R+st)*t.MathUtils.radDeg-n.ashearX)*v+g-lt)>180?R-=360:R<-180&&(R+=360),n.updateWorldTransformWith(T,y,lt+R*l,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}else n.updateWorldTransform()},IkConstraint}();t.IkConstraint=e}(spine||(spine={})),function(t){var e=function(t){function IkConstraintData(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return __extends(IkConstraintData,t),IkConstraintData}(t.ConstraintData);t.IkConstraintData=e}(spine||(spine={})),function(t){var e=function(){function PathConstraint(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,i=t.bones.length;n<i;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return PathConstraint.prototype.isActive=function(){return this.active},PathConstraint.prototype.apply=function(){this.update()},PathConstraint.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof t.PathAttachment){var n=this.rotateMix,i=this.translateMix,a=n>0;if(i>0||a){var r=this.data,o=r.spacingMode==t.SpacingMode.Percent,s=r.rotateMode,l=s==t.RotateMode.Tangent,h=s==t.RotateMode.ChainScale,u=this.bones.length,c=l?u:u+1,d=this.bones,p=t.Utils.setArraySize(this.spaces,c),f=null,m=this.spacing;if(h||!o){h&&(f=t.Utils.setArraySize(this.lengths,u));for(var g=r.spacingMode==t.SpacingMode.Length,v=0,T=c-1;v<T;){var y=(k=d[v]).data.length;if(y<PathConstraint.epsilon)h&&(f[v]=0),p[++v]=0;else if(o){if(h){var A=y*k.a,C=y*k.c,S=Math.sqrt(A*A+C*C);f[v]=S}p[++v]=m}else{A=y*k.a,C=y*k.c;var x=Math.sqrt(A*A+C*C);h&&(f[v]=x),p[++v]=(g?y+m:m)*x/y}}}else for(v=1;v<c;v++)p[v]=m;var w=this.computeWorldPositions(e,c,l,r.positionMode==t.PositionMode.Percent,o),M=w[0],E=w[1],I=r.offsetRotation,b=!1;if(0==I)b=s==t.RotateMode.Chain;else b=!1,I*=(R=this.target.bone).a*R.d-R.b*R.c>0?t.MathUtils.degRad:-t.MathUtils.degRad;v=0;for(var R=3;v<u;v++,R+=3){var k;(k=d[v]).worldX+=(M-k.worldX)*i,k.worldY+=(E-k.worldY)*i;var P=(A=w[R])-M,_=(C=w[R+1])-E;if(h){var V=f[v];if(0!=V){var B=(Math.sqrt(P*P+_*_)/V-1)*n+1;k.a*=B,k.c*=B}}if(M=A,E=C,a){var F=k.a,N=k.b,D=k.c,U=k.d,L=0,O=0,Y=0;if(L=l?w[R-1]:0==p[v+1]?w[R+2]:Math.atan2(_,P),L-=Math.atan2(D,F),b){O=Math.cos(L),Y=Math.sin(L);var X=k.data.length;M+=(X*(O*F-Y*D)-P)*n,E+=(X*(Y*F+O*D)-_)*n}else L+=I;L>t.MathUtils.PI?L-=t.MathUtils.PI2:L<-t.MathUtils.PI&&(L+=t.MathUtils.PI2),L*=n,O=Math.cos(L),Y=Math.sin(L),k.a=O*F-Y*D,k.b=O*N-Y*U,k.c=Y*F+O*D,k.d=Y*N+O*U}k.appliedValid=!1}}}},PathConstraint.prototype.computeWorldPositions=function(e,n,i,a,r){var o=this.target,s=this.position,l=this.spaces,h=t.Utils.setArraySize(this.positions,3*n+2),u=null,c=e.closed,d=e.worldVerticesLength,p=d/6,f=PathConstraint.NONE;if(!e.constantSpeed){var m=e.lengths,g=m[p-=c?1:2];if(a&&(s*=g),r)for(var v=1;v<n;v++)l[v]*=g;u=t.Utils.setArraySize(this.world,8);v=0;for(var T=0,y=0;v<n;v++,T+=3){var A=s+=q=l[v];if(c)(A%=g)<0&&(A+=g),y=0;else{if(A<0){f!=PathConstraint.BEFORE&&(f=PathConstraint.BEFORE,e.computeWorldVertices(o,2,4,u,0,2)),this.addBeforePosition(A,u,0,h,T);continue}if(A>g){f!=PathConstraint.AFTER&&(f=PathConstraint.AFTER,e.computeWorldVertices(o,d-6,4,u,0,2)),this.addAfterPosition(A-g,u,0,h,T);continue}}for(;;y++){var C=m[y];if(!(A>C)){if(0==y)A/=C;else A=(A-(z=m[y-1]))/(C-z);break}}y!=f&&(f=y,c&&y==p?(e.computeWorldVertices(o,d-4,4,u,0,2),e.computeWorldVertices(o,0,4,u,4,2)):e.computeWorldVertices(o,6*y+2,8,u,0,2)),this.addCurvePosition(A,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,T,i||v>0&&0==q)}return h}c?(d+=2,u=t.Utils.setArraySize(this.world,d),e.computeWorldVertices(o,2,d-4,u,0,2),e.computeWorldVertices(o,0,2,u,d-4,2),u[d-2]=u[0],u[d-1]=u[1]):(p--,d-=4,u=t.Utils.setArraySize(this.world,d),e.computeWorldVertices(o,2,d,u,0,2));for(var S=t.Utils.setArraySize(this.curves,p),x=0,w=u[0],M=u[1],E=0,I=0,b=0,R=0,k=0,P=0,_=0,V=0,B=0,F=0,N=0,D=0,U=0,L=0,O=(v=0,2);v<p;v++,O+=6)E=u[O],I=u[O+1],b=u[O+2],R=u[O+3],N=2*(_=.1875*(w-2*E+b))+(B=.09375*(3*(E-b)-w+(k=u[O+4]))),D=2*(V=.1875*(M-2*I+R))+(F=.09375*(3*(I-R)-M+(P=u[O+5]))),U=.75*(E-w)+_+.16666667*B,L=.75*(I-M)+V+.16666667*F,x+=Math.sqrt(U*U+L*L),U+=N,L+=D,N+=B,D+=F,x+=Math.sqrt(U*U+L*L),U+=N,L+=D,x+=Math.sqrt(U*U+L*L),U+=N+B,L+=D+F,x+=Math.sqrt(U*U+L*L),S[v]=x,w=k,M=P;if(s*=a?x:x/e.lengths[p-1],r)for(v=1;v<n;v++)l[v]*=x;for(var Y=this.segments,X=0,W=(v=0,T=0,y=0,0);v<n;v++,T+=3){var q;A=s+=q=l[v];if(c)(A%=x)<0&&(A+=x),y=0;else{if(A<0){this.addBeforePosition(A,u,0,h,T);continue}if(A>x){this.addAfterPosition(A-x,u,d-4,h,T);continue}}for(;;y++){var H=S[y];if(!(A>H)){if(0==y)A/=H;else A=(A-(z=S[y-1]))/(H-z);break}}if(y!=f){f=y;var j=6*y;for(w=u[j],M=u[j+1],E=u[j+2],I=u[j+3],b=u[j+4],R=u[j+5],N=2*(_=.03*(w-2*E+b))+(B=.006*(3*(E-b)-w+(k=u[j+6]))),D=2*(V=.03*(M-2*I+R))+(F=.006*(3*(I-R)-M+(P=u[j+7]))),U=.3*(E-w)+_+.16666667*B,L=.3*(I-M)+V+.16666667*F,X=Math.sqrt(U*U+L*L),Y[0]=X,j=1;j<8;j++)U+=N,L+=D,N+=B,D+=F,X+=Math.sqrt(U*U+L*L),Y[j]=X;U+=N,L+=D,X+=Math.sqrt(U*U+L*L),Y[8]=X,U+=N+B,L+=D+F,X+=Math.sqrt(U*U+L*L),Y[9]=X,W=0}for(A*=X;;W++){var G=Y[W];if(!(A>G)){var z;if(0==W)A/=G;else A=W+(A-(z=Y[W-1]))/(G-z);break}}this.addCurvePosition(.1*A,w,M,E,I,b,R,k,P,h,T,i||v>0&&0==q)}return h},PathConstraint.prototype.addBeforePosition=function(t,e,n,i,a){var r=e[n],o=e[n+1],s=e[n+2]-r,l=e[n+3]-o,h=Math.atan2(l,s);i[a]=r+t*Math.cos(h),i[a+1]=o+t*Math.sin(h),i[a+2]=h},PathConstraint.prototype.addAfterPosition=function(t,e,n,i,a){var r=e[n+2],o=e[n+3],s=r-e[n],l=o-e[n+1],h=Math.atan2(l,s);i[a]=r+t*Math.cos(h),i[a+1]=o+t*Math.sin(h),i[a+2]=h},PathConstraint.prototype.addCurvePosition=function(t,e,n,i,a,r,o,s,l,h,u,c){if(0==t||isNaN(t))return h[u]=e,h[u+1]=n,void(h[u+2]=Math.atan2(a-n,i-e));var d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,v=f*t,T=3*v,y=f*T,A=T*t,C=e*g+i*y+r*A+s*p,S=n*g+a*y+o*A+l*p;h[u]=C,h[u+1]=S,c&&(h[u+2]=t<.001?Math.atan2(a-n,i-e):Math.atan2(S-(n*m+a*v*2+o*d),C-(e*m+i*v*2+r*d)))},PathConstraint.NONE=-1,PathConstraint.BEFORE=-2,PathConstraint.AFTER=-3,PathConstraint.epsilon=1e-5,PathConstraint}();t.PathConstraint=e}(spine||(spine={})),function(t){var e=function(t){function PathConstraintData(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n}return __extends(PathConstraintData,t),PathConstraintData}(t.ConstraintData);t.PathConstraintData=e,function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(t.PositionMode||(t.PositionMode={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(t.SpacingMode||(t.SpacingMode={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(t.RotateMode||(t.RotateMode={}))}(spine||(spine={})),function(t){var e=function(){function Assets(t){this.toLoad=new Array,this.assets={},this.clientId=t}return Assets.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},Assets}(),n=function(){function SharedAssetManager(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return SharedAssetManager.prototype.queueAsset=function(t,n,i){var a=this.clientAssets[t];return null==a&&(a=new e(t),this.clientAssets[t]=a),null!==n&&(a.textureLoader=n),a.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0)},SharedAssetManager.prototype.loadText=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.overrideMimeType("text/html"),i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=i.responseText:n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},SharedAssetManager.prototype.loadJson=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.overrideMimeType("text/html"),i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=JSON.parse(i.responseText):n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},SharedAssetManager.prototype.loadTexture=function(t,e,n){var i=this;if(n=this.pathPrefix+n,this.queueAsset(t,e,n)){var a=new Image;a.crossOrigin="anonymous",a.onload=function(t){i.rawAssets[n]=a},a.onerror=function(t){i.errors[n]="Couldn't load image "+n},a.src=n}},SharedAssetManager.prototype.get=function(t,e){e=this.pathPrefix+e;var n=this.clientAssets[t];return null==n||n.assets[e]},SharedAssetManager.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var n=t.toLoad[e],i=t.assets[n];if(null==i){var a=this.rawAssets[n];if(null==a)continue;a instanceof HTMLImageElement?t.assets[n]=t.textureLoader(a):t.assets[n]=a}}},SharedAssetManager.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},SharedAssetManager.prototype.dispose=function(){},SharedAssetManager.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},SharedAssetManager.prototype.getErrors=function(){return this.errors},SharedAssetManager}();t.SharedAssetManager=n}(spine||(spine={})),function(t){var e=function(){function Skeleton(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var n=0;n<e.bones.length;n++){var i=e.bones[n],a=void 0;if(null==i.parent)a=new t.Bone(i,this,null);else{var r=this.bones[i.parent.index];a=new t.Bone(i,this,r),r.children.push(a)}this.bones.push(a)}this.slots=new Array,this.drawOrder=new Array;for(n=0;n<e.slots.length;n++){var o=e.slots[n],s=(a=this.bones[o.boneData.index],new t.Slot(o,a));this.slots.push(s),this.drawOrder.push(s)}this.ikConstraints=new Array;for(n=0;n<e.ikConstraints.length;n++){var l=e.ikConstraints[n];this.ikConstraints.push(new t.IkConstraint(l,this))}this.transformConstraints=new Array;for(n=0;n<e.transformConstraints.length;n++){var h=e.transformConstraints[n];this.transformConstraints.push(new t.TransformConstraint(h,this))}this.pathConstraints=new Array;for(n=0;n<e.pathConstraints.length;n++){var u=e.pathConstraints[n];this.pathConstraints.push(new t.PathConstraint(u,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return Skeleton.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++){(a=t[e]).sorted=a.data.skinRequired,a.active=!a.sorted}if(null!=this.skin){var i=this.skin.bones;for(e=0,n=this.skin.bones.length;e<n;e++){var a=this.bones[i[e].index];do{a.sorted=!1,a.active=!0,a=a.parent}while(null!=a)}}var r=this.ikConstraints,o=this.transformConstraints,s=this.pathConstraints,l=r.length,h=o.length,u=s.length,c=l+h+u;t:for(e=0;e<c;e++){for(var d=0;d<l;d++){if((p=r[d]).data.order==e){this.sortIkConstraint(p);continue t}}for(d=0;d<h;d++){if((p=o[d]).data.order==e){this.sortTransformConstraint(p);continue t}}for(d=0;d<u;d++){var p;if((p=s[d]).data.order==e){this.sortPathConstraint(p);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},Skeleton.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target;this.sortBone(n);var i=e.bones,a=i[0];if(this.sortBone(a),i.length>1){var r=i[i.length-1];this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}this._updateCache.push(e),this.sortReset(a.children),i[i.length-1].sorted=!0}},Skeleton.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target,i=n.data.index,a=n.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,a),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,a);for(var r=0,o=this.data.skins.length;r<o;r++)this.sortPathConstraintAttachment(this.data.skins[r],i,a);var s=n.getAttachment();s instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(s,a);var l=e.bones,h=l.length;for(r=0;r<h;r++)this.sortBone(l[r]);this._updateCache.push(e);for(r=0;r<h;r++)this.sortReset(l[r].children);for(r=0;r<h;r++)l[r].sorted=!0}},Skeleton.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var n=e.bones,i=n.length;if(e.data.local)for(var a=0;a<i;a++){var r=n[a];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(a=0;a<i;a++)this.sortBone(n[a]);this._updateCache.push(e);for(var o=0;o<i;o++)this.sortReset(n[o].children);for(o=0;o<i;o++)n[o].sorted=!0}},Skeleton.prototype.sortPathConstraintAttachment=function(t,e,n){var i=t.attachments[e];if(i)for(var a in i)this.sortPathConstraintAttachmentWith(i[a],n)},Skeleton.prototype.sortPathConstraintAttachmentWith=function(e,n){if(e instanceof t.PathAttachment){var i=e.bones;if(null==i)this.sortBone(n);else for(var a=this.bones,r=0;r<i.length;)for(var o=i[r++],s=r+o;r<s;r++){var l=i[r];this.sortBone(a[l])}}},Skeleton.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},Skeleton.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];i.active&&(i.sorted&&this.sortReset(i.children),i.sorted=!1)}},Skeleton.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,n=t.length;e<n;e++){var i=t[e];i.ax=i.x,i.ay=i.y,i.arotation=i.rotation,i.ascaleX=i.scaleX,i.ascaleY=i.scaleY,i.ashearX=i.shearX,i.ashearY=i.shearY,i.appliedValid=!0}var a=this._updateCache;for(e=0,n=a.length;e<n;e++)a[e].update()},Skeleton.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},Skeleton.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var i=this.ikConstraints;for(e=0,n=i.length;e<n;e++){(s=i[e]).mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}var a=this.transformConstraints;for(e=0,n=a.length;e<n;e++){var r=(s=a[e]).data;s.rotateMix=r.rotateMix,s.translateMix=r.translateMix,s.scaleMix=r.scaleMix,s.shearMix=r.shearMix}var o=this.pathConstraints;for(e=0,n=o.length;e<n;e++){var s;r=(s=o[e]).data;s.position=r.position,s.spacing=r.spacing,s.rotateMix=r.rotateMix,s.translateMix=r.translateMix}},Skeleton.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var n=0,i=e.length;n<i;n++)e[n].setToSetupPose()},Skeleton.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},Skeleton.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var a=e[n];if(a.data.name==t)return a}return null},Skeleton.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},Skeleton.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var a=e[n];if(a.data.name==t)return a}return null},Skeleton.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},Skeleton.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},Skeleton.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,i=e.length;n<i;n++){var a=e[n],r=a.data.attachmentName;if(null!=r){var o=t.getAttachment(n,r);null!=o&&a.setAttachment(o)}}this.skin=t,this.updateCache()}},Skeleton.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},Skeleton.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},Skeleton.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var n=this.slots,i=0,a=n.length;i<a;i++){var r=n[i];if(r.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(i,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(o)}}throw new Error("Slot not found: "+t)},Skeleton.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var a=e[n];if(a.data.name==t)return a}return null},Skeleton.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var a=e[n];if(a.data.name==t)return a}return null},Skeleton.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var a=e[n];if(a.data.name==t)return a}return null},Skeleton.prototype.getBounds=function(e,n,i){if(void 0===i&&(i=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==n)throw new Error("size cannot be null.");for(var a=this.drawOrder,r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=0,u=a.length;h<u;h++){var c=a[h];if(c.bone.active){var d=0,p=null,f=c.getAttachment();if(f instanceof t.RegionAttachment)d=8,p=t.Utils.setArraySize(i,d,0),f.computeWorldVertices(c.bone,p,0,2);else if(f instanceof t.MeshAttachment){var m=f;d=m.worldVerticesLength,p=t.Utils.setArraySize(i,d,0),m.computeWorldVertices(c,0,d,p,0,2)}if(null!=p)for(var g=0,v=p.length;g<v;g+=2){var T=p[g],y=p[g+1];r=Math.min(r,T),o=Math.min(o,y),s=Math.max(s,T),l=Math.max(l,y)}}}e.set(r,o),n.set(s-r,l-o)},Skeleton.prototype.update=function(t){this.time+=t},Skeleton}();t.Skeleton=e}(spine||(spine={})),function(t){var e=function(){function SkeletonBinary(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return SkeletonBinary.prototype.readSkeletonData=function(e){var i=this.scale,a=new t.SkeletonData;a.name="";var r=new n(e);if(a.hash=r.readString(),a.version=r.readString(),"3.8.75"==a.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");a.x=r.readFloat(),a.y=r.readFloat(),a.width=r.readFloat(),a.height=r.readFloat();var o=r.readBoolean();o&&(a.fps=r.readFloat(),a.imagesPath=r.readString(),a.audioPath=r.readString());var s=0;s=r.readInt(!0);for(var l=0;l<s;l++)r.strings.push(r.readString());s=r.readInt(!0);for(l=0;l<s;l++){var h=r.readString(),u=0==l?null:a.bones[r.readInt(!0)];(p=new t.BoneData(l,h,u)).rotation=r.readFloat(),p.x=r.readFloat()*i,p.y=r.readFloat()*i,p.scaleX=r.readFloat(),p.scaleY=r.readFloat(),p.shearX=r.readFloat(),p.shearY=r.readFloat(),p.length=r.readFloat()*i,p.transformMode=SkeletonBinary.TransformModeValues[r.readInt(!0)],p.skinRequired=r.readBoolean(),o&&t.Color.rgba8888ToColor(p.color,r.readInt32()),a.bones.push(p)}s=r.readInt(!0);for(l=0;l<s;l++){var c=r.readString(),d=a.bones[r.readInt(!0)],p=new t.SlotData(l,c,d);t.Color.rgba8888ToColor(p.color,r.readInt32());var f=r.readInt32();-1!=f&&t.Color.rgb888ToColor(p.darkColor=new t.Color,f),p.attachmentName=r.readStringRef(),p.blendMode=SkeletonBinary.BlendModeValues[r.readInt(!0)],a.slots.push(p)}s=r.readInt(!0);l=0;for(var m=void 0;l<s;l++){(p=new t.IkConstraintData(r.readString())).order=r.readInt(!0),p.skinRequired=r.readBoolean(),m=r.readInt(!0);for(var g=0;g<m;g++)p.bones.push(a.bones[r.readInt(!0)]);p.target=a.bones[r.readInt(!0)],p.mix=r.readFloat(),p.softness=r.readFloat()*i,p.bendDirection=r.readByte(),p.compress=r.readBoolean(),p.stretch=r.readBoolean(),p.uniform=r.readBoolean(),a.ikConstraints.push(p)}s=r.readInt(!0);for(l=0,m=void 0;l<s;l++){(p=new t.TransformConstraintData(r.readString())).order=r.readInt(!0),p.skinRequired=r.readBoolean(),m=r.readInt(!0);for(g=0;g<m;g++)p.bones.push(a.bones[r.readInt(!0)]);p.target=a.bones[r.readInt(!0)],p.local=r.readBoolean(),p.relative=r.readBoolean(),p.offsetRotation=r.readFloat(),p.offsetX=r.readFloat()*i,p.offsetY=r.readFloat()*i,p.offsetScaleX=r.readFloat(),p.offsetScaleY=r.readFloat(),p.offsetShearY=r.readFloat(),p.rotateMix=r.readFloat(),p.translateMix=r.readFloat(),p.scaleMix=r.readFloat(),p.shearMix=r.readFloat(),a.transformConstraints.push(p)}s=r.readInt(!0);for(l=0,m=void 0;l<s;l++){(p=new t.PathConstraintData(r.readString())).order=r.readInt(!0),p.skinRequired=r.readBoolean(),m=r.readInt(!0);for(g=0;g<m;g++)p.bones.push(a.bones[r.readInt(!0)]);p.target=a.slots[r.readInt(!0)],p.positionMode=SkeletonBinary.PositionModeValues[r.readInt(!0)],p.spacingMode=SkeletonBinary.SpacingModeValues[r.readInt(!0)],p.rotateMode=SkeletonBinary.RotateModeValues[r.readInt(!0)],p.offsetRotation=r.readFloat(),p.position=r.readFloat(),p.positionMode==t.PositionMode.Fixed&&(p.position*=i),p.spacing=r.readFloat(),p.spacingMode!=t.SpacingMode.Length&&p.spacingMode!=t.SpacingMode.Fixed||(p.spacing*=i),p.rotateMix=r.readFloat(),p.translateMix=r.readFloat(),a.pathConstraints.push(p)}var v=this.readSkin(r,a,!0,o);null!=v&&(a.defaultSkin=v,a.skins.push(v));l=a.skins.length;for(t.Utils.setArraySize(a.skins,s=l+r.readInt(!0));l<s;l++)a.skins[l]=this.readSkin(r,a,!1,o);s=this.linkedMeshes.length;for(l=0;l<s;l++){var T=this.linkedMeshes[l],y=null==T.skin?a.defaultSkin:a.findSkin(T.skin);if(null==y)throw new Error("Skin not found: "+T.skin);var A=y.getAttachment(T.slotIndex,T.parent);if(null==A)throw new Error("Parent mesh not found: "+T.parent);T.mesh.deformAttachment=T.inheritDeform?A:T.mesh,T.mesh.setParentMesh(A),T.mesh.updateUVs()}this.linkedMeshes.length=0,s=r.readInt(!0);for(l=0;l<s;l++){(p=new t.EventData(r.readStringRef())).intValue=r.readInt(!1),p.floatValue=r.readFloat(),p.stringValue=r.readString(),p.audioPath=r.readString(),null!=p.audioPath&&(p.volume=r.readFloat(),p.balance=r.readFloat()),a.events.push(p)}s=r.readInt(!0);for(l=0;l<s;l++)a.animations.push(this.readAnimation(r,r.readString(),a));return a},SkeletonBinary.prototype.readSkin=function(e,n,i,a){var r=null,o=0;if(i){if(0==(o=e.readInt(!0)))return null;r=new t.Skin("default")}else{(r=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var s=0,l=r.bones.length;s<l;s++)r.bones[s]=n.bones[e.readInt(!0)];for(s=0,l=e.readInt(!0);s<l;s++)r.constraints.push(n.ikConstraints[e.readInt(!0)]);for(s=0,l=e.readInt(!0);s<l;s++)r.constraints.push(n.transformConstraints[e.readInt(!0)]);for(s=0,l=e.readInt(!0);s<l;s++)r.constraints.push(n.pathConstraints[e.readInt(!0)]);o=e.readInt(!0)}for(s=0;s<o;s++)for(var h=e.readInt(!0),u=0,c=e.readInt(!0);u<c;u++){var d=e.readStringRef(),p=this.readAttachment(e,n,r,h,d,a);null!=p&&r.setAttachment(h,d,p)}return r},SkeletonBinary.prototype.readAttachment=function(e,n,a,r,o,s){var l=this.scale,h=e.readStringRef();null==h&&(h=o);var u=e.readByte();switch(SkeletonBinary.AttachmentTypeValues[u]){case t.AttachmentType.Region:var c=e.readStringRef(),d=e.readFloat(),p=e.readFloat(),f=e.readFloat(),m=e.readFloat(),g=e.readFloat(),v=e.readFloat(),T=e.readFloat(),y=e.readInt32();null==c&&(c=h);var A=this.attachmentLoader.newRegionAttachment(a,h,c);return null==A?null:(A.path=c,A.x=p*l,A.y=f*l,A.scaleX=m,A.scaleY=g,A.rotation=d,A.width=v*l,A.height=T*l,t.Color.rgba8888ToColor(A.color,y),A.updateOffset(),A);case t.AttachmentType.BoundingBox:var C=e.readInt(!0),S=this.readVertices(e,C),x=(y=s?e.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(a,h));return null==x?null:(x.worldVerticesLength=C<<1,x.vertices=S.vertices,x.bones=S.bones,s&&t.Color.rgba8888ToColor(x.color,y),x);case t.AttachmentType.Mesh:c=e.readStringRef(),y=e.readInt32(),C=e.readInt(!0);var w=this.readFloatArray(e,C<<1,1),M=this.readShortArray(e),E=(S=this.readVertices(e,C),e.readInt(!0)),I=null;v=0,T=0;return s&&(I=this.readShortArray(e),v=e.readFloat(),T=e.readFloat()),null==c&&(c=h),null==(b=this.attachmentLoader.newMeshAttachment(a,h,c))?null:(b.path=c,t.Color.rgba8888ToColor(b.color,y),b.bones=S.bones,b.vertices=S.vertices,b.worldVerticesLength=C<<1,b.triangles=M,b.regionUVs=w,b.updateUVs(),b.hullLength=E<<1,s&&(b.edges=I,b.width=v*l,b.height=T*l),b);case t.AttachmentType.LinkedMesh:c=e.readStringRef(),y=e.readInt32();var b,R=e.readStringRef(),k=e.readStringRef(),P=e.readBoolean();v=0,T=0;return s&&(v=e.readFloat(),T=e.readFloat()),null==c&&(c=h),null==(b=this.attachmentLoader.newMeshAttachment(a,h,c))?null:(b.path=c,t.Color.rgba8888ToColor(b.color,y),s&&(b.width=v*l,b.height=T*l),this.linkedMeshes.push(new i(b,R,r,k,P)),b);case t.AttachmentType.Path:for(var _=e.readBoolean(),V=e.readBoolean(),B=(C=e.readInt(!0),S=this.readVertices(e,C),t.Utils.newArray(C/3,0)),F=0,N=B.length;F<N;F++)B[F]=e.readFloat()*l;y=s?e.readInt32():0;return null==(c=this.attachmentLoader.newPathAttachment(a,h))?null:(c.closed=_,c.constantSpeed=V,c.worldVerticesLength=C<<1,c.vertices=S.vertices,c.bones=S.bones,c.lengths=B,s&&t.Color.rgba8888ToColor(c.color,y),c);case t.AttachmentType.Point:d=e.readFloat(),p=e.readFloat(),f=e.readFloat(),y=s?e.readInt32():0;var D=this.attachmentLoader.newPointAttachment(a,h);return null==D?null:(D.x=p*l,D.y=f*l,D.rotation=d,s&&t.Color.rgba8888ToColor(D.color,y),D);case t.AttachmentType.Clipping:var U=e.readInt(!0),L=(C=e.readInt(!0),S=this.readVertices(e,C),y=s?e.readInt32():0,this.attachmentLoader.newClippingAttachment(a,h));return null==L?null:(L.endSlot=n.slots[U],L.worldVerticesLength=C<<1,L.vertices=S.vertices,L.bones=S.bones,s&&t.Color.rgba8888ToColor(L.color,y),L)}return null},SkeletonBinary.prototype.readVertices=function(e,n){var i=n<<1,r=new a,o=this.scale;if(!e.readBoolean())return r.vertices=this.readFloatArray(e,i,o),r;for(var s=new Array,l=new Array,h=0;h<n;h++){var u=e.readInt(!0);l.push(u);for(var c=0;c<u;c++)l.push(e.readInt(!0)),s.push(e.readFloat()*o),s.push(e.readFloat()*o),s.push(e.readFloat())}return r.vertices=t.Utils.toFloatArray(s),r.bones=l,r},SkeletonBinary.prototype.readFloatArray=function(t,e,n){var i=new Array(e);if(1==n)for(var a=0;a<e;a++)i[a]=t.readFloat();else for(a=0;a<e;a++)i[a]=t.readFloat()*n;return i},SkeletonBinary.prototype.readShortArray=function(t){for(var e=t.readInt(!0),n=new Array(e),i=0;i<e;i++)n[i]=t.readShort();return n},SkeletonBinary.prototype.readAnimation=function(e,n,i){for(var a=new Array,r=this.scale,o=0,s=new t.Color,l=new t.Color,h=0,u=e.readInt(!0);h<u;h++)for(var c=e.readInt(!0),d=0,p=e.readInt(!0);d<p;d++){var f=e.readByte(),m=e.readInt(!0);switch(f){case SkeletonBinary.SLOT_ATTACHMENT:(y=new t.AttachmentTimeline(m)).slotIndex=c;for(var g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readStringRef());a.push(y),o=Math.max(o,y.frames[m-1]);break;case SkeletonBinary.SLOT_COLOR:(y=new t.ColorTimeline(m)).slotIndex=c;for(g=0;g<m;g++){var v=e.readFloat();t.Color.rgba8888ToColor(s,e.readInt32()),y.setFrame(g,v,s.r,s.g,s.b,s.a),g<m-1&&this.readCurve(e,g,y)}a.push(y),o=Math.max(o,y.frames[(m-1)*t.ColorTimeline.ENTRIES]);break;case SkeletonBinary.SLOT_TWO_COLOR:(y=new t.TwoColorTimeline(m)).slotIndex=c;for(g=0;g<m;g++){v=e.readFloat();t.Color.rgba8888ToColor(s,e.readInt32()),t.Color.rgb888ToColor(l,e.readInt32()),y.setFrame(g,v,s.r,s.g,s.b,s.a,l.r,l.g,l.b),g<m-1&&this.readCurve(e,g,y)}a.push(y),o=Math.max(o,y.frames[(m-1)*t.TwoColorTimeline.ENTRIES])}}for(h=0,u=e.readInt(!0);h<u;h++){var T=e.readInt(!0);for(d=0,p=e.readInt(!0);d<p;d++){f=e.readByte(),m=e.readInt(!0);switch(f){case SkeletonBinary.BONE_ROTATE:(y=new t.RotateTimeline(m)).boneIndex=T;for(g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readFloat()),g<m-1&&this.readCurve(e,g,y);a.push(y),o=Math.max(o,y.frames[(m-1)*t.RotateTimeline.ENTRIES]);break;case SkeletonBinary.BONE_TRANSLATE:case SkeletonBinary.BONE_SCALE:case SkeletonBinary.BONE_SHEAR:var y=void 0,A=1;f==SkeletonBinary.BONE_SCALE?y=new t.ScaleTimeline(m):f==SkeletonBinary.BONE_SHEAR?y=new t.ShearTimeline(m):(y=new t.TranslateTimeline(m),A=r),y.boneIndex=T;for(g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readFloat()*A,e.readFloat()*A),g<m-1&&this.readCurve(e,g,y);a.push(y),o=Math.max(o,y.frames[(m-1)*t.TranslateTimeline.ENTRIES])}}}for(h=0,u=e.readInt(!0);h<u;h++){var C=e.readInt(!0);m=e.readInt(!0);(y=new t.IkConstraintTimeline(m)).ikConstraintIndex=C;for(g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readFloat(),e.readFloat()*r,e.readByte(),e.readBoolean(),e.readBoolean()),g<m-1&&this.readCurve(e,g,y);a.push(y),o=Math.max(o,y.frames[(m-1)*t.IkConstraintTimeline.ENTRIES])}for(h=0,u=e.readInt(!0);h<u;h++){C=e.readInt(!0),m=e.readInt(!0);(y=new t.TransformConstraintTimeline(m)).transformConstraintIndex=C;for(g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()),g<m-1&&this.readCurve(e,g,y);a.push(y),o=Math.max(o,y.frames[(m-1)*t.TransformConstraintTimeline.ENTRIES])}for(h=0,u=e.readInt(!0);h<u;h++){C=e.readInt(!0);var S=i.pathConstraints[C];for(d=0,p=e.readInt(!0);d<p;d++){f=e.readByte(),m=e.readInt(!0);switch(f){case SkeletonBinary.PATH_POSITION:case SkeletonBinary.PATH_SPACING:y=void 0,A=1;f==SkeletonBinary.PATH_SPACING?(y=new t.PathConstraintSpacingTimeline(m),S.spacingMode!=t.SpacingMode.Length&&S.spacingMode!=t.SpacingMode.Fixed||(A=r)):(y=new t.PathConstraintPositionTimeline(m),S.positionMode==t.PositionMode.Fixed&&(A=r)),y.pathConstraintIndex=C;for(g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readFloat()*A),g<m-1&&this.readCurve(e,g,y);a.push(y),o=Math.max(o,y.frames[(m-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case SkeletonBinary.PATH_MIX:(y=new t.PathConstraintMixTimeline(m)).pathConstraintIndex=C;for(g=0;g<m;g++)y.setFrame(g,e.readFloat(),e.readFloat(),e.readFloat()),g<m-1&&this.readCurve(e,g,y);a.push(y),o=Math.max(o,y.frames[(m-1)*t.PathConstraintMixTimeline.ENTRIES])}}}for(h=0,u=e.readInt(!0);h<u;h++){var x=i.skins[e.readInt(!0)];for(d=0,p=e.readInt(!0);d<p;d++){c=e.readInt(!0);for(var w=0,M=e.readInt(!0);w<M;w++){var E=x.getAttachment(c,e.readStringRef()),I=null!=E.bones,b=E.vertices,R=I?b.length/3*2:b.length;m=e.readInt(!0);(y=new t.DeformTimeline(m)).slotIndex=c,y.attachment=E;for(g=0;g<m;g++){v=e.readFloat();var k=void 0,P=e.readInt(!0);if(0==P)k=I?t.Utils.newFloatArray(R):b;else{k=t.Utils.newFloatArray(R);var _=e.readInt(!0);if(P+=_,1==r)for(var V=_;V<P;V++)k[V]=e.readFloat();else for(V=_;V<P;V++)k[V]=e.readFloat()*r;if(!I){V=0;for(var B=k.length;V<B;V++)k[V]+=b[V]}}y.setFrame(g,v,k),g<m-1&&this.readCurve(e,g,y)}a.push(y),o=Math.max(o,y.frames[m-1])}}}var F=e.readInt(!0);if(F>0){y=new t.DrawOrderTimeline(F);var N=i.slots.length;for(h=0;h<F;h++){v=e.readFloat();var D=e.readInt(!0),U=t.Utils.newArray(N,0);for(d=N-1;d>=0;d--)U[d]=-1;var L=t.Utils.newArray(N-D,0),O=0,Y=0;for(d=0;d<D;d++){for(c=e.readInt(!0);O!=c;)L[Y++]=O++;U[O+e.readInt(!0)]=O++}for(;O<N;)L[Y++]=O++;for(d=N-1;d>=0;d--)-1==U[d]&&(U[d]=L[--Y]);y.setFrame(h,v,U)}a.push(y),o=Math.max(o,y.frames[F-1])}var X=e.readInt(!0);if(X>0){for(y=new t.EventTimeline(X),h=0;h<X;h++){v=e.readFloat();var W=i.events[e.readInt(!0)],q=new t.Event(v,W);q.intValue=e.readInt(!1),q.floatValue=e.readFloat(),q.stringValue=e.readBoolean()?e.readString():W.stringValue,null!=q.data.audioPath&&(q.volume=e.readFloat(),q.balance=e.readFloat()),y.setFrame(h,q)}a.push(y),o=Math.max(o,y.frames[X-1])}return new t.Animation(n,a,o)},SkeletonBinary.prototype.readCurve=function(t,e,n){switch(t.readByte()){case SkeletonBinary.CURVE_STEPPED:n.setStepped(e);break;case SkeletonBinary.CURVE_BEZIER:this.setCurve(n,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},SkeletonBinary.prototype.setCurve=function(t,e,n,i,a,r){t.setCurve(e,n,i,a,r)},SkeletonBinary.AttachmentTypeValues=[0,1,2,3,4,5,6],SkeletonBinary.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],SkeletonBinary.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],SkeletonBinary.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],SkeletonBinary.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],SkeletonBinary.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],SkeletonBinary.BONE_ROTATE=0,SkeletonBinary.BONE_TRANSLATE=1,SkeletonBinary.BONE_SCALE=2,SkeletonBinary.BONE_SHEAR=3,SkeletonBinary.SLOT_ATTACHMENT=0,SkeletonBinary.SLOT_COLOR=1,SkeletonBinary.SLOT_TWO_COLOR=2,SkeletonBinary.PATH_POSITION=0,SkeletonBinary.PATH_SPACING=1,SkeletonBinary.PATH_MIX=2,SkeletonBinary.CURVE_LINEAR=0,SkeletonBinary.CURVE_STEPPED=1,SkeletonBinary.CURVE_BEZIER=2,SkeletonBinary}();t.SkeletonBinary=e;var n=function(){function BinaryInput(t,e,n,i){void 0===e&&(e=new Array),void 0===n&&(n=0),void 0===i&&(i=new DataView(t.buffer)),this.strings=e,this.index=n,this.buffer=i}return BinaryInput.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},BinaryInput.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},BinaryInput.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},BinaryInput.prototype.readInt=function(t){var e=this.readByte(),n=127&e;return 0!=(128&e)&&(n|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<28)))),t?n:n>>>1^-(1&n)},BinaryInput.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},BinaryInput.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",n=0;n<t;){var i=this.readByte();switch(i>>4){case 12:case 13:e+=String.fromCharCode((31&i)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&i)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(i),n++}}return e},BinaryInput.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},BinaryInput.prototype.readBoolean=function(){return 0!=this.readByte()},BinaryInput}(),i=function i(t,e,n,a,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=a,this.inheritDeform=r},a=function a(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(spine||(spine={})),function(t){var e=function(){function SkeletonBounds(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return SkeletonBounds.prototype.update=function(e,n){if(null==e)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,a=this.polygons,r=this.polygonPool,o=e.slots,s=o.length;i.length=0,r.freeAll(a),a.length=0;for(var l=0;l<s;l++){var h=o[l];if(h.bone.active){var u=h.getAttachment();if(u instanceof t.BoundingBoxAttachment){var c=u;i.push(c);var d=r.obtain();d.length!=c.worldVerticesLength&&(d=t.Utils.newFloatArray(c.worldVerticesLength)),a.push(d),c.computeWorldVertices(h,0,c.worldVerticesLength,d,0,2)}}}n?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},SkeletonBounds.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.polygons,r=0,o=a.length;r<o;r++)for(var s=a[r],l=s,h=0,u=s.length;h<u;h+=2){var c=l[h],d=l[h+1];t=Math.min(t,c),e=Math.min(e,d),n=Math.max(n,c),i=Math.max(i,d)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=i},SkeletonBounds.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},SkeletonBounds.prototype.aabbIntersectsSegment=function(t,e,n,i){var a=this.minX,r=this.minY,o=this.maxX,s=this.maxY;if(t<=a&&n<=a||e<=r&&i<=r||t>=o&&n>=o||e>=s&&i>=s)return!1;var l=(i-e)/(n-t),h=l*(a-t)+e;if(h>r&&h<s)return!0;if((h=l*(o-t)+e)>r&&h<s)return!0;var u=(r-e)/l+t;return u>a&&u<o||(u=(s-e)/l+t)>a&&u<o},SkeletonBounds.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},SkeletonBounds.prototype.containsPoint=function(t,e){for(var n=this.polygons,i=0,a=n.length;i<a;i++)if(this.containsPointPolygon(n[i],t,e))return this.boundingBoxes[i];return null},SkeletonBounds.prototype.containsPointPolygon=function(t,e,n){for(var i=t,a=t.length,r=a-2,o=!1,s=0;s<a;s+=2){var l=i[s+1],h=i[r+1];if(l<n&&h>=n||h<n&&l>=n){var u=i[s];u+(n-l)/(h-l)*(i[r]-u)<e&&(o=!o)}r=s}return o},SkeletonBounds.prototype.intersectsSegment=function(t,e,n,i){for(var a=this.polygons,r=0,o=a.length;r<o;r++)if(this.intersectsSegmentPolygon(a[r],t,e,n,i))return this.boundingBoxes[r];return null},SkeletonBounds.prototype.intersectsSegmentPolygon=function(t,e,n,i,a){for(var r=t,o=t.length,s=e-i,l=n-a,h=e*a-n*i,u=r[o-2],c=r[o-1],d=0;d<o;d+=2){var p=r[d],f=r[d+1],m=u*f-c*p,g=u-p,v=c-f,T=s*v-l*g,y=(h*g-s*m)/T;if((y>=u&&y<=p||y>=p&&y<=u)&&(y>=e&&y<=i||y>=i&&y<=e)){var A=(h*v-l*m)/T;if((A>=c&&A<=f||A>=f&&A<=c)&&(A>=n&&A<=a||A>=a&&A<=n))return!0}u=p,c=f}return!1},SkeletonBounds.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},SkeletonBounds.prototype.getWidth=function(){return this.maxX-this.minX},SkeletonBounds.prototype.getHeight=function(){return this.maxY-this.minY},SkeletonBounds}();t.SkeletonBounds=e}(spine||(spine={})),function(t){var e=function(){function SkeletonClipping(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return SkeletonClipping.prototype.clipStart=function(e,n){if(null!=this.clipAttachment)return 0;this.clipAttachment=n;var i=n.worldVerticesLength,a=t.Utils.setArraySize(this.clippingPolygon,i);n.computeWorldVertices(e,0,i,a,0,2);var r=this.clippingPolygon;SkeletonClipping.makeClockwise(r);for(var o=this.clippingPolygons=this.triangulator.decompose(r,this.triangulator.triangulate(r)),s=0,l=o.length;s<l;s++){var h=o[s];SkeletonClipping.makeClockwise(h),h.push(h[0]),h.push(h[1])}return o.length},SkeletonClipping.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},SkeletonClipping.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},SkeletonClipping.prototype.isClipping=function(){return null!=this.clipAttachment},SkeletonClipping.prototype.clipTriangles=function(e,n,i,a,r,o,s,l){var h=this.clipOutput,u=this.clippedVertices,c=this.clippedTriangles,d=this.clippingPolygons,p=this.clippingPolygons.length,f=l?12:8,m=0;u.length=0,c.length=0;t:for(var g=0;g<a;g+=3)for(var v=i[g]<<1,T=e[v],y=e[v+1],A=r[v],C=r[v+1],S=e[v=i[g+1]<<1],x=e[v+1],w=r[v],M=r[v+1],E=e[v=i[g+2]<<1],I=e[v+1],b=r[v],R=r[v+1],k=0;k<p;k++){var P=u.length;if(!this.clip(T,y,S,x,E,I,d[k],h)){(O=t.Utils.setArraySize(u,P+3*f))[P]=T,O[P+1]=y,O[P+2]=o.r,O[P+3]=o.g,O[P+4]=o.b,O[P+5]=o.a,l?(O[P+6]=A,O[P+7]=C,O[P+8]=s.r,O[P+9]=s.g,O[P+10]=s.b,O[P+11]=s.a,O[P+12]=S,O[P+13]=x,O[P+14]=o.r,O[P+15]=o.g,O[P+16]=o.b,O[P+17]=o.a,O[P+18]=w,O[P+19]=M,O[P+20]=s.r,O[P+21]=s.g,O[P+22]=s.b,O[P+23]=s.a,O[P+24]=E,O[P+25]=I,O[P+26]=o.r,O[P+27]=o.g,O[P+28]=o.b,O[P+29]=o.a,O[P+30]=b,O[P+31]=R,O[P+32]=s.r,O[P+33]=s.g,O[P+34]=s.b,O[P+35]=s.a):(O[P+6]=A,O[P+7]=C,O[P+8]=S,O[P+9]=x,O[P+10]=o.r,O[P+11]=o.g,O[P+12]=o.b,O[P+13]=o.a,O[P+14]=w,O[P+15]=M,O[P+16]=E,O[P+17]=I,O[P+18]=o.r,O[P+19]=o.g,O[P+20]=o.b,O[P+21]=o.a,O[P+22]=b,O[P+23]=R),P=c.length,(J=t.Utils.setArraySize(c,P+3))[P]=m,J[P+1]=m+1,J[P+2]=m+2,m+=3;continue t}var _=h.length;if(0!=_){for(var V=x-I,B=E-S,F=T-E,N=I-y,D=1/(V*F+B*(y-I)),U=_>>1,L=this.clipOutput,O=t.Utils.setArraySize(u,P+U*f),Y=0;Y<_;Y+=2){var X=L[Y],W=L[Y+1];O[P]=X,O[P+1]=W,O[P+2]=o.r,O[P+3]=o.g,O[P+4]=o.b,O[P+5]=o.a;var q=X-E,H=W-I,j=(V*q+B*H)*D,G=(N*q+F*H)*D,z=1-j-G;O[P+6]=A*j+w*G+b*z,O[P+7]=C*j+M*G+R*z,l&&(O[P+8]=s.r,O[P+9]=s.g,O[P+10]=s.b,O[P+11]=s.a),P+=f}P=c.length;var J=t.Utils.setArraySize(c,P+3*(U-2));U--;for(Y=1;Y<U;Y++)J[P]=m,J[P+1]=m+Y,J[P+2]=m+Y+1,P+=3;m+=U+1}}},SkeletonClipping.prototype.clip=function(t,e,n,i,a,r,o,s){var l=s,h=!1,u=null;o.length%4>=2?(u=s,s=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(n),u.push(i),u.push(a),u.push(r),u.push(t),u.push(e),s.length=0;for(var c=o,d=o.length-4,p=0;;p+=2){for(var f=c[p],m=c[p+1],g=c[p+2],v=c[p+3],T=f-g,y=m-v,A=u,C=u.length-2,S=s.length,x=0;x<C;x+=2){var w=A[x],M=A[x+1],E=A[x+2],I=A[x+3],b=T*(I-v)-y*(E-g)>0;if(T*(M-v)-y*(w-g)>0){if(b){s.push(E),s.push(I);continue}var R=(P=I-M)*(g-f)-(_=E-w)*(v-m);if(Math.abs(R)>1e-6){var k=(_*(m-M)-P*(f-w))/R;s.push(f+(g-f)*k),s.push(m+(v-m)*k)}else s.push(f),s.push(m)}else if(b){var P,_;R=(P=I-M)*(g-f)-(_=E-w)*(v-m);if(Math.abs(R)>1e-6){k=(_*(m-M)-P*(f-w))/R;s.push(f+(g-f)*k),s.push(m+(v-m)*k)}else s.push(f),s.push(m);s.push(E),s.push(I)}h=!0}if(S==s.length)return l.length=0,!0;if(s.push(s[0]),s.push(s[1]),p==d)break;var V=s;(s=u).length=0,u=V}if(l!=s){l.length=0;p=0;for(var B=s.length-2;p<B;p++)l[p]=s[p]}else l.length=l.length-2;return h},SkeletonClipping.makeClockwise=function(t){for(var e=t,n=t.length,i=e[n-2]*e[1]-e[0]*e[n-1],a=0,r=0,o=0,s=0,l=n-3;s<l;s+=2)a=e[s],r=e[s+1],o=e[s+2],i+=a*e[s+3]-o*r;if(!(i<0)){s=0;var h=n-2;for(l=n>>1;s<l;s+=2){var u=e[s],c=e[s+1],d=h-s;e[s]=e[d],e[s+1]=e[d+1],e[d]=u,e[d+1]=c}}},SkeletonClipping}();t.SkeletonClipping=e}(spine||(spine={})),function(t){var e=function(){function SkeletonData(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return SkeletonData.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},SkeletonData.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},SkeletonData.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var a=e[n];if(a.name==t)return a}return null},SkeletonData.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},SkeletonData}();t.SkeletonData=e}(spine||(spine={})),function(t){var e=function(){function SkeletonJson(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return SkeletonJson.prototype.readSkeletonData=function(e){var n=this.scale,i=new t.SkeletonData,a="string"==typeof e?JSON.parse(e):e,r=a.skeleton;if(null!=r){if(i.hash=r.hash,i.version=r.spine,"3.8.75"==i.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height,i.fps=r.fps,i.imagesPath=r.images}if(a.bones)for(var o=0;o<a.bones.length;o++){var s=a.bones[o],l=null,h=this.getValue(s,"parent",null);if(null!=h&&null==(l=i.findBone(h)))throw new Error("Parent bone not found: "+h);(p=new t.BoneData(i.bones.length,s.name,l)).length=this.getValue(s,"length",0)*n,p.x=this.getValue(s,"x",0)*n,p.y=this.getValue(s,"y",0)*n,p.rotation=this.getValue(s,"rotation",0),p.scaleX=this.getValue(s,"scaleX",1),p.scaleY=this.getValue(s,"scaleY",1),p.shearX=this.getValue(s,"shearX",0),p.shearY=this.getValue(s,"shearY",0),p.transformMode=SkeletonJson.transformModeFromString(this.getValue(s,"transform","normal")),p.skinRequired=this.getValue(s,"skin",!1),i.bones.push(p)}if(a.slots)for(o=0;o<a.slots.length;o++){var u=(M=a.slots[o]).name,c=M.bone,d=i.findBone(c);if(null==d)throw new Error("Slot bone not found: "+c);var p=new t.SlotData(i.slots.length,u,d),f=this.getValue(M,"color",null);null!=f&&p.color.setFromString(f);var m=this.getValue(M,"dark",null);null!=m&&(p.darkColor=new t.Color(1,1,1,1),p.darkColor.setFromString(m)),p.attachmentName=this.getValue(M,"attachment",null),p.blendMode=SkeletonJson.blendModeFromString(this.getValue(M,"blend","normal")),i.slots.push(p)}if(a.ik)for(o=0;o<a.ik.length;o++){var g=a.ik[o];(p=new t.IkConstraintData(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(var v=0;v<g.bones.length;v++){c=g.bones[v];if(null==(S=i.findBone(c)))throw new Error("IK bone not found: "+c);p.bones.push(S)}var T=g.target;if(p.target=i.findBone(T),null==p.target)throw new Error("IK target bone not found: "+T);p.mix=this.getValue(g,"mix",1),p.softness=this.getValue(g,"softness",0)*n,p.bendDirection=this.getValue(g,"bendPositive",!0)?1:-1,p.compress=this.getValue(g,"compress",!1),p.stretch=this.getValue(g,"stretch",!1),p.uniform=this.getValue(g,"uniform",!1),i.ikConstraints.push(p)}if(a.transform)for(o=0;o<a.transform.length;o++){g=a.transform[o];(p=new t.TransformConstraintData(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(v=0;v<g.bones.length;v++){c=g.bones[v];if(null==(S=i.findBone(c)))throw new Error("Transform constraint bone not found: "+c);p.bones.push(S)}T=g.target;if(p.target=i.findBone(T),null==p.target)throw new Error("Transform constraint target bone not found: "+T);p.local=this.getValue(g,"local",!1),p.relative=this.getValue(g,"relative",!1),p.offsetRotation=this.getValue(g,"rotation",0),p.offsetX=this.getValue(g,"x",0)*n,p.offsetY=this.getValue(g,"y",0)*n,p.offsetScaleX=this.getValue(g,"scaleX",0),p.offsetScaleY=this.getValue(g,"scaleY",0),p.offsetShearY=this.getValue(g,"shearY",0),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),p.scaleMix=this.getValue(g,"scaleMix",1),p.shearMix=this.getValue(g,"shearMix",1),i.transformConstraints.push(p)}if(a.path)for(o=0;o<a.path.length;o++){g=a.path[o];(p=new t.PathConstraintData(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(v=0;v<g.bones.length;v++){c=g.bones[v];if(null==(S=i.findBone(c)))throw new Error("Transform constraint bone not found: "+c);p.bones.push(S)}T=g.target;if(p.target=i.findSlot(T),null==p.target)throw new Error("Path target slot not found: "+T);p.positionMode=SkeletonJson.positionModeFromString(this.getValue(g,"positionMode","percent")),p.spacingMode=SkeletonJson.spacingModeFromString(this.getValue(g,"spacingMode","length")),p.rotateMode=SkeletonJson.rotateModeFromString(this.getValue(g,"rotateMode","tangent")),p.offsetRotation=this.getValue(g,"rotation",0),p.position=this.getValue(g,"position",0),p.positionMode==t.PositionMode.Fixed&&(p.position*=n),p.spacing=this.getValue(g,"spacing",0),p.spacingMode!=t.SpacingMode.Length&&p.spacingMode!=t.SpacingMode.Fixed||(p.spacing*=n),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),i.pathConstraints.push(p)}if(a.skins)for(o=0;o<a.skins.length;o++){var y=a.skins[o],A=new t.Skin(y.name);if(y.bones)for(var C=0;C<y.bones.length;C++){var S;if(null==(S=i.findBone(y.bones[C])))throw new Error("Skin bone not found: "+y.bones[o]);A.bones.push(S)}if(y.ik)for(C=0;C<y.ik.length;C++){if(null==(x=i.findIkConstraint(y.ik[C])))throw new Error("Skin IK constraint not found: "+y.ik[o]);A.constraints.push(x)}if(y.transform)for(C=0;C<y.transform.length;C++){if(null==(x=i.findTransformConstraint(y.transform[C])))throw new Error("Skin transform constraint not found: "+y.transform[o]);A.constraints.push(x)}if(y.path)for(C=0;C<y.path.length;C++){var x;if(null==(x=i.findPathConstraint(y.path[C])))throw new Error("Skin path constraint not found: "+y.path[o]);A.constraints.push(x)}for(var u in y.attachments){var w=i.findSlot(u);if(null==w)throw new Error("Slot not found: "+u);var M=y.attachments[u];for(var E in M){var I=this.readAttachment(M[E],A,w.index,E,i);null!=I&&A.setAttachment(w.index,E,I)}}i.skins.push(A),"default"==A.name&&(i.defaultSkin=A)}o=0;for(var b=this.linkedMeshes.length;o<b;o++){var R=this.linkedMeshes[o];if(null==(A=null==R.skin?i.defaultSkin:i.findSkin(R.skin)))throw new Error("Skin not found: "+R.skin);var k=A.getAttachment(R.slotIndex,R.parent);if(null==k)throw new Error("Parent mesh not found: "+R.parent);R.mesh.deformAttachment=R.inheritDeform?k:R.mesh,R.mesh.setParentMesh(k),R.mesh.updateUVs()}if(this.linkedMeshes.length=0,a.events)for(var P in a.events){var _=a.events[P];(p=new t.EventData(P)).intValue=this.getValue(_,"int",0),p.floatValue=this.getValue(_,"float",0),p.stringValue=this.getValue(_,"string",""),p.audioPath=this.getValue(_,"audio",null),null!=p.audioPath&&(p.volume=this.getValue(_,"volume",1),p.balance=this.getValue(_,"balance",0)),i.events.push(p)}if(a.animations)for(var V in a.animations){var B=a.animations[V];this.readAnimation(B,V,i)}return i},SkeletonJson.prototype.readAttachment=function(e,i,a,r,o){var s=this.scale;switch(r=this.getValue(e,"name",r),this.getValue(e,"type","region")){case"region":var l=this.getValue(e,"path",r),h=this.attachmentLoader.newRegionAttachment(i,r,l);return null==h?null:(h.path=l,h.x=this.getValue(e,"x",0)*s,h.y=this.getValue(e,"y",0)*s,h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.rotation=this.getValue(e,"rotation",0),h.width=e.width*s,h.height=e.height*s,null!=(C=this.getValue(e,"color",null))&&h.color.setFromString(C),h.updateOffset(),h);case"boundingbox":var u=this.attachmentLoader.newBoundingBoxAttachment(i,r);return null==u?null:(this.readVertices(e,u,e.vertexCount<<1),null!=(C=this.getValue(e,"color",null))&&u.color.setFromString(C),u);case"mesh":case"linkedmesh":l=this.getValue(e,"path",r);var c=this.attachmentLoader.newMeshAttachment(i,r,l);if(null==c)return null;c.path=l,null!=(C=this.getValue(e,"color",null))&&c.color.setFromString(C),c.width=this.getValue(e,"width",0)*s,c.height=this.getValue(e,"height",0)*s;var d=this.getValue(e,"parent",null);if(null!=d)return this.linkedMeshes.push(new n(c,this.getValue(e,"skin",null),a,d,this.getValue(e,"deform",!0))),c;var p=e.uvs;return this.readVertices(e,c,p.length),c.triangles=e.triangles,c.regionUVs=p,c.updateUVs(),c.edges=this.getValue(e,"edges",null),c.hullLength=2*this.getValue(e,"hull",0),c;case"path":if(null==(l=this.attachmentLoader.newPathAttachment(i,r)))return null;l.closed=this.getValue(e,"closed",!1),l.constantSpeed=this.getValue(e,"constantSpeed",!0);var f=e.vertexCount;this.readVertices(e,l,f<<1);for(var m=t.Utils.newArray(f/3,0),g=0;g<e.lengths.length;g++)m[g]=e.lengths[g]*s;return l.lengths=m,null!=(C=this.getValue(e,"color",null))&&l.color.setFromString(C),l;case"point":var v=this.attachmentLoader.newPointAttachment(i,r);return null==v?null:(v.x=this.getValue(e,"x",0)*s,v.y=this.getValue(e,"y",0)*s,v.rotation=this.getValue(e,"rotation",0),null!=(C=this.getValue(e,"color",null))&&v.color.setFromString(C),v);case"clipping":var T=this.attachmentLoader.newClippingAttachment(i,r);if(null==T)return null;var y=this.getValue(e,"end",null);if(null!=y){var A=o.findSlot(y);if(null==A)throw new Error("Clipping end slot not found: "+y);T.endSlot=A}var C;f=e.vertexCount;return this.readVertices(e,T,f<<1),null!=(C=this.getValue(e,"color",null))&&T.color.setFromString(C),T}return null},SkeletonJson.prototype.readVertices=function(e,n,i){var a=this.scale;n.worldVerticesLength=i;var r=e.vertices;if(i!=r.length){var o=new Array,s=new Array;for(c=0,d=r.length;c<d;){var l=r[c++];s.push(l);for(var h=c+4*l;c<h;c+=4)s.push(r[c]),o.push(r[c+1]*a),o.push(r[c+2]*a),o.push(r[c+3])}n.bones=s,n.vertices=t.Utils.toFloatArray(o)}else{var u=t.Utils.toFloatArray(r);if(1!=a)for(var c=0,d=r.length;c<d;c++)u[c]*=a;n.vertices=u}},SkeletonJson.prototype.readAnimation=function(e,n,i){var a=this.scale,r=new Array,o=0;if(e.slots)for(var s in e.slots){var l=e.slots[s];if(-1==(Z=i.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(var h in l){var u=l[h];if("attachment"==h){(A=new t.AttachmentTimeline(u.length)).slotIndex=Z;for(var c=0,d=0;d<u.length;d++){var p=u[d];A.setFrame(c++,this.getValue(p,"time",0),p.name)}r.push(A),o=Math.max(o,A.frames[A.getFrameCount()-1])}else if("color"==h){(A=new t.ColorTimeline(u.length)).slotIndex=Z;for(c=0,d=0;d<u.length;d++){p=u[d];var f=new t.Color;f.setFromString(p.color),A.setFrame(c,this.getValue(p,"time",0),f.r,f.g,f.b,f.a),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=h)throw new Error("Invalid timeline type for a slot: "+h+" ("+s+")");(A=new t.TwoColorTimeline(u.length)).slotIndex=Z;for(c=0,d=0;d<u.length;d++){p=u[d];var m=new t.Color,g=new t.Color;m.setFromString(p.light),g.setFromString(p.dark),A.setFrame(c,this.getValue(p,"time",0),m.r,m.g,m.b,m.a,g.r,g.g,g.b),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var v in e.bones){var T=e.bones[v],y=i.findBoneIndex(v);if(-1==y)throw new Error("Bone not found: "+v);for(var h in T){u=T[h];if("rotate"===h){(A=new t.RotateTimeline(u.length)).boneIndex=y;for(c=0,d=0;d<u.length;d++){p=u[d];A.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"angle",0)),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==h&&"scale"!==h&&"shear"!==h)throw new Error("Invalid timeline type for a bone: "+h+" ("+v+")");var A=null,C=1,S=0;"scale"===h?(A=new t.ScaleTimeline(u.length),S=1):"shear"===h?A=new t.ShearTimeline(u.length):(A=new t.TranslateTimeline(u.length),C=a),A.boneIndex=y;for(c=0,d=0;d<u.length;d++){p=u[d];var x=this.getValue(p,"x",S),w=this.getValue(p,"y",S);A.setFrame(c,this.getValue(p,"time",0),x*C,w*C),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}}if(e.ik)for(var M in e.ik){var E=e.ik[M],I=i.findIkConstraint(M);(A=new t.IkConstraintTimeline(E.length)).ikConstraintIndex=i.ikConstraints.indexOf(I);for(c=0,d=0;d<E.length;d++){p=E[d];A.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"mix",1),this.getValue(p,"softness",0)*a,this.getValue(p,"bendPositive",!0)?1:-1,this.getValue(p,"compress",!1),this.getValue(p,"stretch",!1)),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var M in e.transform){E=e.transform[M],I=i.findTransformConstraint(M);(A=new t.TransformConstraintTimeline(E.length)).transformConstraintIndex=i.transformConstraints.indexOf(I);for(c=0,d=0;d<E.length;d++){p=E[d];A.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1),this.getValue(p,"scaleMix",1),this.getValue(p,"shearMix",1)),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}if(e.path)for(var M in e.path){E=e.path[M];var b=i.findPathConstraintIndex(M);if(-1==b)throw new Error("Path constraint not found: "+M);var R=i.pathConstraints[b];for(var h in E){u=E[h];if("position"===h||"spacing"===h){A=null,C=1;"spacing"===h?(A=new t.PathConstraintSpacingTimeline(u.length),R.spacingMode!=t.SpacingMode.Length&&R.spacingMode!=t.SpacingMode.Fixed||(C=a)):(A=new t.PathConstraintPositionTimeline(u.length),R.positionMode==t.PositionMode.Fixed&&(C=a)),A.pathConstraintIndex=b;for(c=0,d=0;d<u.length;d++){p=u[d];A.setFrame(c,this.getValue(p,"time",0),this.getValue(p,h,0)*C),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===h){(A=new t.PathConstraintMixTimeline(u.length)).pathConstraintIndex=b;for(c=0,d=0;d<u.length;d++){p=u[d];A.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1)),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[(A.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}}if(e.deform)for(var k in e.deform){var P=e.deform[k],_=i.findSkin(k);if(null==_)throw new Error("Skin not found: "+k);for(var s in P){l=P[s];if(-1==(Z=i.findSlotIndex(s)))throw new Error("Slot not found: "+l.name);for(var h in l){u=l[h];var V=_.getAttachment(Z,h);if(null==V)throw new Error("Deform attachment not found: "+u.name);var B=null!=V.bones,F=V.vertices,N=B?F.length/3*2:F.length;(A=new t.DeformTimeline(u.length)).slotIndex=Z,A.attachment=V;c=0;for(var D=0;D<u.length;D++){p=u[D];var U=void 0,L=this.getValue(p,"vertices",null);if(null==L)U=B?t.Utils.newFloatArray(N):F;else{U=t.Utils.newFloatArray(N);var O=this.getValue(p,"offset",0);if(t.Utils.arrayCopy(L,0,U,O,L.length),1!=a)for(var Y=(d=O)+L.length;d<Y;d++)U[d]*=a;if(!B)for(d=0;d<N;d++)U[d]+=F[d]}A.setFrame(c,this.getValue(p,"time",0),U),this.readCurve(p,A,c),c++}r.push(A),o=Math.max(o,A.frames[A.getFrameCount()-1])}}}var X=e.drawOrder;if(null==X&&(X=e.draworder),null!=X){A=new t.DrawOrderTimeline(X.length);var W=i.slots.length;for(c=0,D=0;D<X.length;D++){var q=X[D],H=null,j=this.getValue(q,"offsets",null);if(null!=j){H=t.Utils.newArray(W,-1);var G=t.Utils.newArray(W-j.length,0),z=0,J=0;for(d=0;d<j.length;d++){var Z,Q=j[d];if(-1==(Z=i.findSlotIndex(Q.slot)))throw new Error("Slot not found: "+Q.slot);for(;z!=Z;)G[J++]=z++;H[z+Q.offset]=z++}for(;z<W;)G[J++]=z++;for(d=W-1;d>=0;d--)-1==H[d]&&(H[d]=G[--J])}A.setFrame(c++,this.getValue(q,"time",0),H)}r.push(A),o=Math.max(o,A.frames[A.getFrameCount()-1])}if(e.events){for(A=new t.EventTimeline(e.events.length),c=0,d=0;d<e.events.length;d++){var K=e.events[d],$=i.findEvent(K.name);if(null==$)throw new Error("Event not found: "+K.name);var tt=new t.Event(t.Utils.toSinglePrecision(this.getValue(K,"time",0)),$);tt.intValue=this.getValue(K,"int",$.intValue),tt.floatValue=this.getValue(K,"float",$.floatValue),tt.stringValue=this.getValue(K,"string",$.stringValue),null!=tt.data.audioPath&&(tt.volume=this.getValue(K,"volume",1),tt.balance=this.getValue(K,"balance",0)),A.setFrame(c++,tt)}r.push(A),o=Math.max(o,A.frames[A.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");i.animations.push(new t.Animation(n,r,o))},SkeletonJson.prototype.readCurve=function(t,e,n){if(t.hasOwnProperty("curve"))if("stepped"==t.curve)e.setStepped(n);else{var i=t.curve;e.setCurve(n,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}},SkeletonJson.prototype.getValue=function(t,e,n){return void 0!==t[e]?t[e]:n},SkeletonJson.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},SkeletonJson.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},SkeletonJson.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},SkeletonJson.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},SkeletonJson.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},SkeletonJson}();t.SkeletonJson=e;var n=function n(t,e,i,a,r){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=a,this.inheritDeform=r}}(spine||(spine={})),function(t){var e=function e(t,n,i){this.slotIndex=t,this.name=n,this.attachment=i};t.SkinEntry=e;var n=function(){function Skin(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return Skin.prototype.setAttachment=function(t,e,n){if(null==n)throw new Error("attachment cannot be null.");var i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=n},Skin.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],i=!1,a=0;a<this.bones.length;a++)if(this.bones[a]==n){i=!0;break}i||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var r=t.constraints[e];for(i=!1,a=0;a<this.constraints.length;a++)if(this.constraints[a]==r){i=!0;break}i||this.constraints.push(r)}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];this.setAttachment(s.slotIndex,s.name,s.attachment)}},Skin.prototype.copySkin=function(e){for(var n=0;n<e.bones.length;n++){for(var i=e.bones[n],a=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==i){a=!0;break}a||this.bones.push(i)}for(n=0;n<e.constraints.length;n++){var o=e.constraints[n];for(a=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==o){a=!0;break}a||this.constraints.push(o)}var s=e.getAttachments();for(n=0;n<s.length;n++){var l=s[n];null!=l.attachment&&(l.attachment instanceof t.MeshAttachment?(l.attachment=l.attachment.newLinkedMesh(),this.setAttachment(l.slotIndex,l.name,l.attachment)):(l.attachment=l.attachment.copy(),this.setAttachment(l.slotIndex,l.name,l.attachment)))}},Skin.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},Skin.prototype.removeAttachment=function(t,e){var n=this.attachments[t];n&&(n[e]=null)},Skin.prototype.getAttachments=function(){for(var t=new Array,n=0;n<this.attachments.length;n++){var i=this.attachments[n];if(i)for(var a in i){var r=i[a];r&&t.push(new e(n,a,r))}}return t},Skin.prototype.getAttachmentsForSlot=function(t,n){var i=this.attachments[t];if(i)for(var a in i){var r=i[a];r&&n.push(new e(t,a,r))}},Skin.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},Skin.prototype.attachAll=function(t,e){for(var n=0,i=0;i<t.slots.length;i++){var a=t.slots[i],r=a.getAttachment();if(r&&n<e.attachments.length){var o=e.attachments[n];for(var s in o){if(r==o[s]){var l=this.getAttachment(n,s);null!=l&&a.setAttachment(l);break}}}n++}},Skin}();t.Skin=n}(spine||(spine={})),function(t){var e=function(){function Slot(e,n){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("bone cannot be null.");this.data=e,this.bone=n,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return Slot.prototype.getSkeleton=function(){return this.bone.skeleton},Slot.prototype.getAttachment=function(){return this.attachment},Slot.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},Slot.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},Slot.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},Slot.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},Slot}();t.Slot=e}(spine||(spine={})),function(t){var e=function e(n,i,a){if(this.color=new t.Color(1,1,1,1),n<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");if(null==a)throw new Error("boneData cannot be null.");this.index=n,this.name=i,this.boneData=a};t.SlotData=e}(spine||(spine={})),function(t){var e,n,i=function(){function Texture(t){this._image=t}return Texture.prototype.getImage=function(){return this._image},Texture.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},Texture.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return n.MirroredRepeat;case"clamptoedge":return n.ClampToEdge;case"repeat":return n.Repeat;default:throw new Error("Unknown texture wrap "+t)}},Texture}();t.Texture=i,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(n=t.TextureWrap||(t.TextureWrap={}));var a=function a(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};t.TextureRegion=a;var r=function(t){function FakeTexture(){return null!==t&&t.apply(this,arguments)||this}return __extends(FakeTexture,t),FakeTexture.prototype.setFilters=function(t,e){},FakeTexture.prototype.setWraps=function(t,e){},FakeTexture.prototype.dispose=function(){},FakeTexture}(i);t.FakeTexture=r}(spine||(spine={})),function(t){var e=function(){function TextureAtlas(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return TextureAtlas.prototype.load=function(e,r){if(null==r)throw new Error("textureLoader cannot be null.");for(var o=new n(e),s=new Array(4),l=null;;){var h=o.readLine();if(null==h)break;if(0==(h=h.trim()).length)l=null;else if(l){var u=new a;u.name=h,u.page=l;var c=o.readValue();"true"==c.toLocaleLowerCase()?u.degrees=90:"false"==c.toLocaleLowerCase()?u.degrees=0:u.degrees=parseFloat(c),u.rotate=90==u.degrees,o.readTuple(s);var d=parseInt(s[0]),p=parseInt(s[1]);o.readTuple(s);var f=parseInt(s[0]),m=parseInt(s[1]);u.u=d/l.width,u.v=p/l.height,u.rotate?(u.u2=(d+m)/l.width,u.v2=(p+f)/l.height):(u.u2=(d+f)/l.width,u.v2=(p+m)/l.height),u.x=d,u.y=p,u.width=Math.abs(f),u.height=Math.abs(m),4==o.readTuple(s)&&4==o.readTuple(s)&&o.readTuple(s),u.originalWidth=parseInt(s[0]),u.originalHeight=parseInt(s[1]),o.readTuple(s),u.offsetX=parseInt(s[0]),u.offsetY=parseInt(s[1]),u.index=parseInt(o.readValue()),u.texture=l.texture,this.regions.push(u)}else{(l=new i).name=h,2==o.readTuple(s)&&(l.width=parseInt(s[0]),l.height=parseInt(s[1]),o.readTuple(s)),o.readTuple(s),l.minFilter=t.Texture.filterFromString(s[0]),l.magFilter=t.Texture.filterFromString(s[1]);var g=o.readValue();l.uWrap=t.TextureWrap.ClampToEdge,l.vWrap=t.TextureWrap.ClampToEdge,"x"==g?l.uWrap=t.TextureWrap.Repeat:"y"==g?l.vWrap=t.TextureWrap.Repeat:"xy"==g&&(l.uWrap=l.vWrap=t.TextureWrap.Repeat),l.texture=r(h),l.texture.setFilters(l.minFilter,l.magFilter),l.texture.setWraps(l.uWrap,l.vWrap),l.width=l.texture.getImage().width,l.height=l.texture.getImage().height,this.pages.push(l)}}},TextureAtlas.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},TextureAtlas.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},TextureAtlas}();t.TextureAtlas=e;var n=function(){function TextureAtlasReader(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return TextureAtlasReader.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},TextureAtlasReader.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},TextureAtlasReader.prototype.readTuple=function(t){var e=this.readLine(),n=e.indexOf(":");if(-1==n)throw new Error("Invalid line: "+e);for(var i=0,a=n+1;i<3;i++){var r=e.indexOf(",",a);if(-1==r)break;t[i]=e.substr(a,r-a).trim(),a=r+1}return t[i]=e.substring(a).trim(),i+1},TextureAtlasReader}(),i=function i(){};t.TextureAtlasPage=i;var a=function(t){function TextureAtlasRegion(){return null!==t&&t.apply(this,arguments)||this}return __extends(TextureAtlasRegion,t),TextureAtlasRegion}(t.TextureRegion);t.TextureAtlasRegion=a}(spine||(spine={})),function(t){var e=function(){function TransformConstraint(e,n){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var i=0;i<e.bones.length;i++)this.bones.push(n.findBone(e.bones[i].name));this.target=n.findBone(e.target.name)}return TransformConstraint.prototype.isActive=function(){return this.active},TransformConstraint.prototype.apply=function(){this.update()},TransformConstraint.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},TransformConstraint.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,a=this.shearMix,r=this.target,o=r.a,s=r.b,l=r.c,h=r.d,u=o*h-s*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,m=p.length;f<m;f++){var g=p[f],v=!1;if(0!=e){var T=g.a,y=g.b,A=g.c,C=g.d;(I=Math.atan2(l,o)-Math.atan2(A,T)+c)>t.MathUtils.PI?I-=t.MathUtils.PI2:I<-t.MathUtils.PI&&(I+=t.MathUtils.PI2),I*=e;var S=Math.cos(I),x=Math.sin(I);g.a=S*T-x*A,g.b=S*y-x*C,g.c=x*T+S*A,g.d=x*y+S*C,v=!0}if(0!=n){var w=this.temp;r.localToWorld(w.set(this.data.offsetX,this.data.offsetY)),g.worldX+=(w.x-g.worldX)*n,g.worldY+=(w.y-g.worldY)*n,v=!0}if(i>0){var M=Math.sqrt(g.a*g.a+g.c*g.c),E=Math.sqrt(o*o+l*l);M>1e-5&&(M=(M+(E-M+this.data.offsetScaleX)*i)/M),g.a*=M,g.c*=M,M=Math.sqrt(g.b*g.b+g.d*g.d),E=Math.sqrt(s*s+h*h),M>1e-5&&(M=(M+(E-M+this.data.offsetScaleY)*i)/M),g.b*=M,g.d*=M,v=!0}if(a>0){y=g.b,C=g.d;var I,b=Math.atan2(C,y);(I=Math.atan2(h,s)-Math.atan2(l,o)-(b-Math.atan2(g.c,g.a)))>t.MathUtils.PI?I-=t.MathUtils.PI2:I<-t.MathUtils.PI&&(I+=t.MathUtils.PI2),I=b+(I+d)*a;M=Math.sqrt(y*y+C*C);g.b=Math.cos(I)*M,g.d=Math.sin(I)*M,v=!0}v&&(g.appliedValid=!1)}},TransformConstraint.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,a=this.shearMix,r=this.target,o=r.a,s=r.b,l=r.c,h=r.d,u=o*h-s*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,m=p.length;f<m;f++){var g=p[f],v=!1;if(0!=e){var T=g.a,y=g.b,A=g.c,C=g.d;(E=Math.atan2(l,o)+c)>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),E*=e;var S=Math.cos(E),x=Math.sin(E);g.a=S*T-x*A,g.b=S*y-x*C,g.c=x*T+S*A,g.d=x*y+S*C,v=!0}if(0!=n){var w=this.temp;r.localToWorld(w.set(this.data.offsetX,this.data.offsetY)),g.worldX+=w.x*n,g.worldY+=w.y*n,v=!0}if(i>0){var M=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleX)*i+1;g.a*=M,g.c*=M,M=(Math.sqrt(s*s+h*h)-1+this.data.offsetScaleY)*i+1,g.b*=M,g.d*=M,v=!0}if(a>0){var E;(E=Math.atan2(h,s)-Math.atan2(l,o))>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2);y=g.b,C=g.d;E=Math.atan2(C,y)+(E-t.MathUtils.PI/2+d)*a;M=Math.sqrt(y*y+C*C);g.b=Math.cos(E)*M,g.d=Math.sin(E)*M,v=!0}v&&(g.appliedValid=!1)}},TransformConstraint.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,a=this.target;a.appliedValid||a.updateAppliedTransform();for(var r=this.bones,o=0,s=r.length;o<s;o++){var l=r[o];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!=t){var u=a.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,d=l.ay;0!=e&&(c+=(a.ax-c+this.data.offsetX)*e,d+=(a.ay-d+this.data.offsetY)*e);var p=l.ascaleX,f=l.ascaleY;0!=n&&(p>1e-5&&(p=(p+(a.ascaleX-p+this.data.offsetScaleX)*n)/p),f>1e-5&&(f=(f+(a.ascaleY-f+this.data.offsetScaleY)*n)/f));var m=l.ashearY;if(0!=i){u=a.ashearY-m+this.data.offsetShearY;u-=360*(16384-(16384.499999999996-u/360|0)),l.shearY+=u*i}l.updateWorldTransformWith(c,d,h,p,f,l.ashearX,m)}},TransformConstraint.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,a=this.target;a.appliedValid||a.updateAppliedTransform();for(var r=this.bones,o=0,s=r.length;o<s;o++){var l=r[o];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!=t&&(h+=(a.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!=e&&(u+=(a.ax+this.data.offsetX)*e,c+=(a.ay+this.data.offsetY)*e);var d=l.ascaleX,p=l.ascaleY;0!=n&&(d>1e-5&&(d*=(a.ascaleX-1+this.data.offsetScaleX)*n+1),p>1e-5&&(p*=(a.ascaleY-1+this.data.offsetScaleY)*n+1));var f=l.ashearY;0!=i&&(f+=(a.ashearY+this.data.offsetShearY)*i),l.updateWorldTransformWith(u,c,h,d,p,l.ashearX,f)}},TransformConstraint}();t.TransformConstraint=e}(spine||(spine={})),function(t){var e=function(t){function TransformConstraintData(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return __extends(TransformConstraintData,t),TransformConstraintData}(t.ConstraintData);t.TransformConstraintData=e}(spine||(spine={})),function(t){var e=function(){function Triangulator(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return Triangulator.prototype.triangulate=function(t){var e=t,n=t.length>>1,i=this.indicesArray;i.length=0;for(var a=0;a<n;a++)i[a]=a;var r=this.isConcaveArray;r.length=0;a=0;for(var o=n;a<o;++a)r[a]=Triangulator.isConcave(a,n,e,i);var s=this.triangles;for(s.length=0;n>3;){for(var l=n-1,h=(a=0,1);;){t:if(!r[a]){for(var u=i[l]<<1,c=i[a]<<1,d=i[h]<<1,p=e[u],f=e[u+1],m=e[c],g=e[c+1],v=e[d],T=e[d+1],y=(h+1)%n;y!=l;y=(y+1)%n)if(r[y]){var A=i[y]<<1,C=e[A],S=e[A+1];if(Triangulator.positiveArea(v,T,p,f,C,S)&&Triangulator.positiveArea(p,f,m,g,C,S)&&Triangulator.positiveArea(m,g,v,T,C,S))break t}break}if(0==h){do{if(!r[a])break;a--}while(a>0);break}l=a,a=h,h=(h+1)%n}s.push(i[(n+a-1)%n]),s.push(i[a]),s.push(i[(a+1)%n]),i.splice(a,1),r.splice(a,1);var x=(--n+a-1)%n,w=a==n?0:a;r[x]=Triangulator.isConcave(x,n,e,i),r[w]=Triangulator.isConcave(w,n,e,i)}return 3==n&&(s.push(i[2]),s.push(i[0]),s.push(i[1])),s},Triangulator.prototype.decompose=function(t,e){var n=t,i=this.convexPolygons;this.polygonPool.freeAll(i),i.length=0;var a=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(a),a.length=0;var r=this.polygonIndicesPool.obtain();r.length=0;var o=this.polygonPool.obtain();o.length=0;for(var s=-1,l=0,h=0,u=e.length;h<u;h+=3){var c=e[h]<<1,d=e[h+1]<<1,p=e[h+2]<<1,f=n[c],m=n[c+1],g=n[d],v=n[d+1],T=n[p],y=n[p+1],A=!1;if(s==c){var C=o.length-4,S=Triangulator.winding(o[C],o[C+1],o[C+2],o[C+3],T,y),x=Triangulator.winding(T,y,o[0],o[1],o[2],o[3]);S==l&&x==l&&(o.push(T),o.push(y),r.push(p),A=!0)}A||(o.length>0?(i.push(o),a.push(r)):(this.polygonPool.free(o),this.polygonIndicesPool.free(r)),(o=this.polygonPool.obtain()).length=0,o.push(f),o.push(m),o.push(g),o.push(v),o.push(T),o.push(y),(r=this.polygonIndicesPool.obtain()).length=0,r.push(c),r.push(d),r.push(p),l=Triangulator.winding(f,m,g,v,T,y),s=c)}o.length>0&&(i.push(o),a.push(r));for(h=0,u=i.length;h<u;h++)if(0!=(r=a[h]).length)for(var w=r[0],M=r[r.length-1],E=(o=i[h])[C=o.length-4],I=o[C+1],b=o[C+2],R=o[C+3],k=o[0],P=o[1],_=o[2],V=o[3],B=Triangulator.winding(E,I,b,R,k,P),F=0;F<u;F++)if(F!=h){var N=a[F];if(3==N.length){var D=N[0],U=N[1],L=N[2],O=i[F];T=O[O.length-2],y=O[O.length-1];if(D==w&&U==M){S=Triangulator.winding(E,I,b,R,T,y),x=Triangulator.winding(T,y,k,P,_,V);S==B&&x==B&&(O.length=0,N.length=0,o.push(T),o.push(y),r.push(L),E=b,I=R,b=T,R=y,F=0)}}}for(h=i.length-1;h>=0;h--)0==(o=i[h]).length&&(i.splice(h,1),this.polygonPool.free(o),r=a[h],a.splice(h,1),this.polygonIndicesPool.free(r));return i},Triangulator.isConcave=function(t,e,n,i){var a=i[(e+t-1)%e]<<1,r=i[t]<<1,o=i[(t+1)%e]<<1;return!this.positiveArea(n[a],n[a+1],n[r],n[r+1],n[o],n[o+1])},Triangulator.positiveArea=function(t,e,n,i,a,r){return t*(r-i)+n*(e-r)+a*(i-e)>=0},Triangulator.winding=function(t,e,n,i,a,r){var o=n-t,s=i-e;return a*s-r*o+o*e-t*s>=0?1:-1},Triangulator}();t.Triangulator=e}(spine||(spine={})),function(t){var e=function(){function IntSet(){this.array=new Array}return IntSet.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},IntSet.prototype.contains=function(t){return null!=this.array[0|t]},IntSet.prototype.remove=function(t){this.array[0|t]=void 0},IntSet.prototype.clear=function(){this.array.length=0},IntSet}();t.IntSet=e;var n=function(){function Color(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.r=t,this.g=e,this.b=n,this.a=i}return Color.prototype.set=function(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this.clamp(),this},Color.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},Color.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},Color.prototype.add=function(t,e,n,i){return this.r+=t,this.g+=e,this.b+=n,this.a+=i,this.clamp(),this},Color.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},Color.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},Color.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},Color.WHITE=new Color(1,1,1,1),Color.RED=new Color(1,0,0,1),Color.GREEN=new Color(0,1,0,1),Color.BLUE=new Color(0,0,1,1),Color.MAGENTA=new Color(1,0,1,1),Color}();t.Color=n;var i=function(){function MathUtils(){}return MathUtils.clamp=function(t,e,n){return t<e?e:t>n?n:t},MathUtils.cosDeg=function(t){return Math.cos(t*MathUtils.degRad)},MathUtils.sinDeg=function(t){return Math.sin(t*MathUtils.degRad)},MathUtils.signum=function(t){return t>0?1:t<0?-1:0},MathUtils.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},MathUtils.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},MathUtils.randomTriangular=function(t,e){return MathUtils.randomTriangularWith(t,e,.5*(t+e))},MathUtils.randomTriangularWith=function(t,e,n){var i=Math.random(),a=e-t;return i<=(n-t)/a?t+Math.sqrt(i*a*(n-t)):e-Math.sqrt((1-i)*a*(e-n))},MathUtils.PI=3.1415927,MathUtils.PI2=2*MathUtils.PI,MathUtils.radiansToDegrees=180/MathUtils.PI,MathUtils.radDeg=MathUtils.radiansToDegrees,MathUtils.degreesToRadians=MathUtils.PI/180,MathUtils.degRad=MathUtils.degreesToRadians,MathUtils}();t.MathUtils=i;var a=function(){function Interpolation(){}return Interpolation.prototype.apply=function(t,e,n){return t+(e-t)*this.applyInternal(n)},Interpolation}();t.Interpolation=a;var r=function(t){function Pow(e){var n=t.call(this)||this;return n.power=2,n.power=e,n}return __extends(Pow,t),Pow.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},Pow}(a);t.Pow=r;var o=function(t){function PowOut(e){return t.call(this,e)||this}return __extends(PowOut,t),PowOut.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},PowOut}(r);t.PowOut=o;var s=function(){function Utils(){}return Utils.arrayCopy=function(t,e,n,i,a){for(var r=e,o=i;r<e+a;r++,o++)n[o]=t[r]},Utils.setArraySize=function(t,e,n){void 0===n&&(n=0);var i=t.length;if(i==e)return t;if(t.length=e,i<e)for(var a=i;a<e;a++)t[a]=n;return t},Utils.ensureArrayCapacity=function(t,e,n){return void 0===n&&(n=0),t.length>=e?t:Utils.setArraySize(t,e,n)},Utils.newArray=function(t,e){for(var n=new Array(t),i=0;i<t;i++)n[i]=e;return n},Utils.newFloatArray=function(t){if(Utils.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);for(var e=new Array(t),n=0;n<e.length;n++)e[n]=0;return e},Utils.newShortArray=function(t){if(Utils.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);for(var e=new Array(t),n=0;n<e.length;n++)e[n]=0;return e},Utils.toFloatArray=function(t){return Utils.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t},Utils.toSinglePrecision=function(t){return Utils.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t},Utils.webkit602BugfixHelper=function(t,e){},Utils.contains=function(t,e,n){void 0===n&&(n=!0);for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},Utils.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,Utils}();t.Utils=s;var l=function(){function DebugUtils(){}return DebugUtils.logBones=function(t){for(var e=0;e<t.bones.length;e++){var n=t.bones[e];console.log(n.data.name+", "+n.a+", "+n.b+", "+n.c+", "+n.d+", "+n.worldX+", "+n.worldY)}},DebugUtils}();t.DebugUtils=l;var h=function(){function Pool(t){this.items=new Array,this.instantiator=t}return Pool.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},Pool.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},Pool.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},Pool.prototype.clear=function(){this.items.length=0},Pool}();t.Pool=h;var u=function(){function Vector2(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Vector2.prototype.set=function(t,e){return this.x=t,this.y=e,this},Vector2.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},Vector2.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},Vector2}();t.Vector2=u;var c=function(){function TimeKeeper(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return TimeKeeper.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},TimeKeeper}();t.TimeKeeper=c;var d=function(){function WindowedMean(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return WindowedMean.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},WindowedMean.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},WindowedMean.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},WindowedMean}();t.WindowedMean=d}(spine||(spine={})),function(){var t;Math.fround||(Math.fround=(t=new Float32Array(1),function(e){return t[0]=e,t[0]}))}(),function(t){var e=function e(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var n=function(e){function VertexAttachment(t){var n=e.call(this,t)||this;return n.id=(65535&VertexAttachment.nextID++)<<11,n.worldVerticesLength=0,n.deformAttachment=n,n}return __extends(VertexAttachment,e),VertexAttachment.prototype.computeWorldVertices=function(t,e,n,i,a,r){n=a+(n>>1)*r;var o=t.bone.skeleton,s=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,d=0;d<e;d+=2){u+=(g=h[u])+1,c+=g}var p=o.bones;if(0==s.length)for(b=a,w=3*c;b<n;b+=r){var f=0,m=0,g=h[u++];for(g+=u;u<g;u++,w+=3){A=p[h[u]],R=l[w],k=l[w+1];var v=l[w+2];f+=(R*A.a+k*A.b+A.worldX)*v,m+=(R*A.c+k*A.d+A.worldY)*v}i[b]=f,i[b+1]=m}else for(var T=s,y=(b=a,w=3*c,c<<1);b<n;b+=r){f=0,m=0,g=h[u++];for(g+=u;u<g;u++,w+=3,y+=2){A=p[h[u]],R=l[w]+T[y],k=l[w+1]+T[y+1],v=l[w+2];f+=(R*A.a+k*A.b+A.worldX)*v,m+=(R*A.c+k*A.d+A.worldY)*v}i[b]=f,i[b+1]=m}}else{s.length>0&&(l=s);for(var A,C=(A=t.bone).worldX,S=A.worldY,x=A.a,w=A.b,M=A.c,E=A.d,I=e,b=a;b<n;I+=2,b+=r){var R=l[I],k=l[I+1];i[b]=R*x+k*w+C,i[b+1]=R*M+k*E+S}}},VertexAttachment.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},VertexAttachment.nextID=0,VertexAttachment}(e);t.VertexAttachment=n}(spine||(spine={})),function(t){!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(t.AttachmentType||(t.AttachmentType={}))}(spine||(spine={})),function(t){var e=function(e){function BoundingBoxAttachment(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i}return __extends(BoundingBoxAttachment,e),BoundingBoxAttachment.prototype.copy=function(){var t=new BoundingBoxAttachment(name);return this.copyTo(t),t.color.setFromColor(this.color),t},BoundingBoxAttachment}(t.VertexAttachment);t.BoundingBoxAttachment=e}(spine||(spine={})),function(t){var e=function(e){function ClippingAttachment(n){var i=e.call(this,n)||this;return i.color=new t.Color(.2275,.2275,.8078,1),i}return __extends(ClippingAttachment,e),ClippingAttachment.prototype.copy=function(){var t=new ClippingAttachment(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},ClippingAttachment}(t.VertexAttachment);t.ClippingAttachment=e}(spine||(spine={})),function(t){var e=function(e){function MeshAttachment(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i.tempColor=new t.Color(0,0,0,0),i}return __extends(MeshAttachment,e),MeshAttachment.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var n=this.uvs,i=this.uvs.length,a=this.region.u,r=this.region.v,o=0,s=0;if(this.region instanceof t.TextureAtlasRegion){var l=this.region,h=l.texture.getImage().width,u=l.texture.getImage().height;switch(l.degrees){case 90:a-=(l.originalHeight-l.offsetY-l.height)/h,r-=(l.originalWidth-l.offsetX-l.width)/u,o=l.originalHeight/h,s=l.originalWidth/u;for(var c=0;c<i;c+=2)n[c]=a+e[c+1]*o,n[c+1]=r+(1-e[c])*s;return;case 180:a-=(l.originalWidth-l.offsetX-l.width)/h,r-=l.offsetY/u,o=l.originalWidth/h,s=l.originalHeight/u;for(c=0;c<i;c+=2)n[c]=a+(1-e[c])*o,n[c+1]=r+(1-e[c+1])*s;return;case 270:a-=l.offsetY/h,r-=l.offsetX/u,o=l.originalHeight/h,s=l.originalWidth/u;for(c=0;c<i;c+=2)n[c]=a+(1-e[c+1])*o,n[c+1]=r+e[c]*s;return}a-=l.offsetX/h,r-=(l.originalHeight-l.offsetY-l.height)/u,o=l.originalWidth/h,s=l.originalHeight/u}else null==this.region?(a=r=0,o=s=1):(o=this.region.u2-a,s=this.region.v2-r);for(c=0;c<i;c+=2)n[c]=a+e[c]*o,n[c+1]=r+e[c+1]*s},MeshAttachment.prototype.getParentMesh=function(){return this.parentMesh},MeshAttachment.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},MeshAttachment.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new MeshAttachment(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},MeshAttachment.prototype.newLinkedMesh=function(){var t=new MeshAttachment(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},MeshAttachment}(t.VertexAttachment);t.MeshAttachment=e}(spine||(spine={})),function(t){var e=function(e){function PathAttachment(n){var i=e.call(this,n)||this;return i.closed=!1,i.constantSpeed=!1,i.color=new t.Color(1,1,1,1),i}return __extends(PathAttachment,e),PathAttachment.prototype.copy=function(){var e=new PathAttachment(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},PathAttachment}(t.VertexAttachment);t.PathAttachment=e}(spine||(spine={})),function(t){var e=function(e){function PointAttachment(n){var i=e.call(this,n)||this;return i.color=new t.Color(.38,.94,0,1),i}return __extends(PointAttachment,e),PointAttachment.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},PointAttachment.prototype.computeWorldRotation=function(e){var n=t.MathUtils.cosDeg(this.rotation),i=t.MathUtils.sinDeg(this.rotation),a=n*e.a+i*e.b,r=n*e.c+i*e.d;return Math.atan2(r,a)*t.MathUtils.radDeg},PointAttachment.prototype.copy=function(){var t=new PointAttachment(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},PointAttachment}(t.VertexAttachment);t.PointAttachment=e}(spine||(spine={})),function(t){var e=function(e){function RegionAttachment(n){var i=e.call(this,n)||this;return i.x=0,i.y=0,i.scaleX=1,i.scaleY=1,i.rotation=0,i.width=0,i.height=0,i.color=new t.Color(1,1,1,1),i.offset=t.Utils.newFloatArray(8),i.uvs=t.Utils.newFloatArray(8),i.tempColor=new t.Color(1,1,1,1),i}return __extends(RegionAttachment,e),RegionAttachment.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*e,a=n+this.region.width*t,r=i+this.region.height*e,o=this.rotation*Math.PI/180,s=Math.cos(o),l=Math.sin(o),h=n*s+this.x,u=n*l,c=i*s+this.y,d=i*l,p=a*s+this.x,f=a*l,m=r*s+this.y,g=r*l,v=this.offset;v[RegionAttachment.OX1]=h-d,v[RegionAttachment.OY1]=c+u,v[RegionAttachment.OX2]=h-g,v[RegionAttachment.OY2]=m+u,v[RegionAttachment.OX3]=p-g,v[RegionAttachment.OY3]=m+f,v[RegionAttachment.OX4]=p-d,v[RegionAttachment.OY4]=c+f},RegionAttachment.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},RegionAttachment.prototype.computeWorldVertices=function(t,e,n,i){var a=this.offset,r=t.worldX,o=t.worldY,s=t.a,l=t.b,h=t.c,u=t.d,c=0,d=0;c=a[RegionAttachment.OX1],d=a[RegionAttachment.OY1],e[n]=c*s+d*l+r,e[n+1]=c*h+d*u+o,n+=i,c=a[RegionAttachment.OX2],d=a[RegionAttachment.OY2],e[n]=c*s+d*l+r,e[n+1]=c*h+d*u+o,n+=i,c=a[RegionAttachment.OX3],d=a[RegionAttachment.OY3],e[n]=c*s+d*l+r,e[n+1]=c*h+d*u+o,n+=i,c=a[RegionAttachment.OX4],d=a[RegionAttachment.OY4],e[n]=c*s+d*l+r,e[n+1]=c*h+d*u+o},RegionAttachment.prototype.copy=function(){var e=new RegionAttachment(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},RegionAttachment.OX1=0,RegionAttachment.OY1=1,RegionAttachment.OX2=2,RegionAttachment.OY2=3,RegionAttachment.OX3=4,RegionAttachment.OY3=5,RegionAttachment.OX4=6,RegionAttachment.OY4=7,RegionAttachment.X1=0,RegionAttachment.Y1=1,RegionAttachment.C1R=2,RegionAttachment.C1G=3,RegionAttachment.C1B=4,RegionAttachment.C1A=5,RegionAttachment.U1=6,RegionAttachment.V1=7,RegionAttachment.X2=8,RegionAttachment.Y2=9,RegionAttachment.C2R=10,RegionAttachment.C2G=11,RegionAttachment.C2B=12,RegionAttachment.C2A=13,RegionAttachment.U2=14,RegionAttachment.V2=15,RegionAttachment.X3=16,RegionAttachment.Y3=17,RegionAttachment.C3R=18,RegionAttachment.C3G=19,RegionAttachment.C3B=20,RegionAttachment.C3A=21,RegionAttachment.U3=22,RegionAttachment.V3=23,RegionAttachment.X4=24,RegionAttachment.Y4=25,RegionAttachment.C4R=26,RegionAttachment.C4G=27,RegionAttachment.C4B=28,RegionAttachment.C4A=29,RegionAttachment.U4=30,RegionAttachment.V4=31,RegionAttachment}(t.Attachment);t.RegionAttachment=e}(spine||(spine={})),function(t){var e=function(){function JitterEffect(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return JitterEffect.prototype.begin=function(t){},JitterEffect.prototype.transform=function(e,n,i,a){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},JitterEffect.prototype.end=function(){},JitterEffect}();t.JitterEffect=e}(spine||(spine={})),function(t){var e=function(){function SwirlEffect(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}return SwirlEffect.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},SwirlEffect.prototype.transform=function(e,n,i,a){var r=this.angle*t.MathUtils.degreesToRadians,o=e.x-this.worldX,s=e.y-this.worldY,l=Math.sqrt(o*o+s*s);if(l<this.radius){var h=SwirlEffect.interpolation.apply(0,r,(this.radius-l)/this.radius),u=Math.cos(h),c=Math.sin(h);e.x=u*o-c*s+this.worldX,e.y=c*o+u*s+this.worldY}},SwirlEffect.prototype.end=function(){},SwirlEffect.interpolation=new t.PowOut(2),SwirlEffect}();t.SwirlEffect=e}(spine||(spine={})),pc.extend(pc,function(){function versionCompare(t,e,n){var i=n&&n.lexicographical,a=n&&n.zeroExtend,r=t.split("."),o=e.split(".");function isValidPart(t){return(i?/^\d+[A-Za-z]*$/:/^\d+$/).test(t)}if(!r.every(isValidPart)||!o.every(isValidPart))return NaN;if(a){for(;r.length<o.length;)r.push("0");for(;o.length<r.length;)o.push("0")}i||(r=r.map(Number),o=o.map(Number));for(var s=0;s<r.length;++s){if(o.length==s)return 1;if(r[s]!=o[s])return r[s]>o[s]?1:-1}return r.length!=o.length?-1:0}var t=0,e=1,n=2,i={9728:pc.FILTER_NEAREST,9729:pc.FILTER_LINEAR,9984:pc.FILTER_NEAREST_MIPMAP_NEAREST,9985:pc.FILTER_LINEAR_MIPMAP_NEAREST,9986:pc.FILTER_NEAREST_MIPMAP_LINEAR,9987:pc.FILTER_LINEAR_MIPMAP_LINEAR},a={33648:pc.ADDRESS_MIRRORED_REPEAT,33071:pc.ADDRESS_CLAMP_TO_EDGE,10487:pc.ADDRESS_REPEAT},r=[0,1,2,2,3,0],SpineTextureWrapper=function(t){this._image={width:t.width,height:t.height},this.pcTexture=t};SpineTextureWrapper.prototype={setFilters:function(t,e){this.pcTexture.minFilter=i[t],this.pcTexture.magFilter=i[e]},setWraps:function(t,e){this.pcTexture.addressU=a[t],this.pcTexture.addressV=a[e]},getImage:function(){return this._image}};var Spine=function(t,e,n,i){this._app=t,this._position=new pc.Vec3;var a=new spine.TextureAtlas(e,(function(t){return new SpineTextureWrapper(i[t])})),r=new spine.SkeletonJson(new spine.AtlasAttachmentLoader(a));r.scale*=.01;var o=r.readSkeletonData(n);this.skeletonVersion=o.version,this._spine_3_6_0=versionCompare(this.skeletonVersion,"3.6.0")<=0,this._spine_3_7_99=versionCompare(this.skeletonVersion,"3.7.99")<=0,this.skeleton=new spine.Skeleton(o),this.skeleton.updateWorldTransform(),this.stateData=new spine.AnimationStateData(this.skeleton.data),this.states=[new spine.AnimationState(this.stateData)],this.clipper=new spine.SkeletonClipping,this._node=new pc.GraphNode,this._meshes=[],this._meshInstances=[],this._materials={},this._tint={},this._aabb=new pc.BoundingBox,this._aabbTempArray=[],this._aabbTempOffset=new pc.Vec2,this._aabbTempSize=new pc.Vec2,this._renderCounts={vertexCount:0,indexCount:0},this._vertexFormat=null,this._vertexBuffer=null,this._indexBuffer=null,this._priority=0,this._timeScale=1,this._layers=[pc.LAYERID_WORLD],this.init(),this.autoUpdate=!0,this._model=new pc.Model,this._model.graph=this._node,this._model.meshInstances=this._meshInstances,this._hidden=!1};return Spine.prototype.destroy=function(){this._model&&this.removeFromLayers();for(var t=0;t<this._meshInstances.length;t++)this._meshInstances[t].mesh.vertexBuffer=null,this._meshInstances[t].mesh.indexBuffer.length=0,this._meshInstances[t].material=null;this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._model=null,this._meshInstances=[],this.skeleton=null,this.stateData=null,this.state=null,this._materials={},this._node=null},Spine.prototype.hide=function(){if(!this._hidden){for(var t=0,e=this._meshInstances.length;t<e;t++)this._meshInstances[t].visible=!1;this._hidden=!0}},Spine.prototype.show=function(){if(this._hidden){for(var t=0,e=this._meshInstances.length;t<e;t++)this._meshInstances[t].visible=!0;this._hidden=!1}},Spine.prototype.init=function(){this._vertexFormat=new pc.VertexFormat(this._app.graphicsDevice,[{semantic:pc.SEMANTIC_POSITION,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_NORMAL,components:4,type:pc.TYPE_UINT8,normalize:!0},{semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32},{semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_UINT8,normalize:!0}]);for(var t=this.skeleton.drawOrder,e=0,n=t.length;e<n;e++)this.initSlot(t[e])},Spine.prototype.initSlot=function(e){e.positions=[],e.uvs=[],e.indices=[],e.vertexColor={},e._active={name:"",type:t},this.initAttachment(e)},Spine.prototype.createMaterial=function(t){var e=new pc.StandardMaterial;if(e.shadingModel=pc.SPECULAR_BLINN,e.diffuse=new pc.Color(0,0,0),e.emissiveMap=t,e.emissiveMapChannel="rgb",e.emissiveVertexColor=!0,e.emissiveVertexColorChannel="rgb",e.opacityMap=t,e.opacityMapChannel="a",e.opacityVertexColor=!0,e.opacityVertexColorChannel="a",e.depthWrite=!1,e.cull=pc.CULLFACE_NONE,e.blendType=pc.BLEND_PREMULTIPLIED,this._spine_3_6_0){var n=["gl_FragColor.rgb *= vVertexColor.a;","gl_FragColor.a = dAlpha;"].join("\n");e.chunks.outputAlphaPremulPS=n}return e.update(),e},Spine.prototype.initAttachment=function(t){var i=t.attachment;if(i&&(t._active.name=i.name,i instanceof spine.RegionAttachment?t._active.type=n:i instanceof spine.MeshAttachment&&(t._active.type=e),i.region&&i.region.texture)){var a=i.region.texture.pcTexture;if(a)if(a instanceof pc.StandardMaterial)this._materials[a.name]=a,t.material=a.name;else{var r=null;if(a.name?r=a.name:a.getSource()instanceof Image&&(r=a.getSource().getAttribute("src")),r){if(void 0===this._materials[r]){var o=this.createMaterial(a);this._materials[r]=o}t.material=r}}}},Spine.prototype.updateSlot=function(i,a){var o=i.attachment,s=o.name,l=o instanceof spine.RegionAttachment?n:o instanceof spine.MeshAttachment?e:t;i._active.name===s&&i._active.type==l||this.initAttachment(i),i.positions.length=0,o instanceof spine.RegionAttachment?o.computeWorldVertices(i.bone,i.positions,0,2):o instanceof spine.MeshAttachment&&o.computeWorldVertices(i,0,o.worldVerticesLength,i.positions,0,2);var h=this._tint[s];i.vertexColor={r:Math.round(255*i.color.r*(h?h.r:1)),g:Math.round(255*i.color.g*(h?h.g:1)),b:Math.round(255*i.color.b*(h?h.b:1)),a:Math.round(255*i.color.a*(h?h.a:1))};var u,c,d=o.triangles||r;if(a.isClipping()){a.clipTriangles(i.positions,0,d,d.length,o.uvs,spine.Color.WHITE,spine.Color.WHITE,false),i.positions.length=0,i.uvs.length=0;for(c=a.clippedVertices.length,u=0;u<c;u+=8)i.positions.push(a.clippedVertices[u],a.clippedVertices[u+1]),i.uvs.push(a.clippedVertices[u+6],1-a.clippedVertices[u+7]);i.indices=a.clippedTriangles.slice()}else{for(i.uvs.length=0,c=i.positions.length,u=0;u<c;u+=2)i.uvs.push(o.uvs[u],1-o.uvs[u+1]);i.indices=d}this._renderCounts.vertexCount+=i.positions.length/2,this._renderCounts.indexCount+=i.indices.length},Spine.prototype.updateSkeleton=function(t){this._renderCounts.vertexCount=0,this._renderCounts.indexCount=0;var e=this.clipper,n=!1;n=!0;for(var i=this.skeleton.drawOrder,a=i.length,r=0;r<a;r++){var o=i[r];if(this._spine_3_7_99||o.bone.active)if(n){0;var s=o.getAttachment();s instanceof spine.ClippingAttachment?e.clipStart(o,s):s instanceof spine.RegionAttachment||s instanceof spine.MeshAttachment?this.updateSlot(o,e):this._spine_3_7_99||e.clipEndWithSlot(o)}else e.clipEndWithSlot(o);else e.clipEndWithSlot(o)}},Spine.prototype.render=function(){if(this._meshInstances.forEach((function(t){t.material=null})),this.removeFromLayers(),this._meshes=[],this._meshInstances.length=0,this._renderCounts.indexCount>0&&this._renderCounts.vertexCount>0){this.skeleton.getBounds(this._aabbTempOffset,this._aabbTempSize,this._aabbTempArray),this._aabb.center=new pc.Vec3(this._aabbTempOffset.x,this._aabbTempOffset.y,0),this._aabb.halfExtents=new pc.Vec3(.5*this._aabbTempSize.x,.5*this._aabbTempSize.y,0),(!this._vertexBuffer||this._vertexBuffer.getNumVertices()<this._renderCounts.vertexCount)&&(this._vertexBuffer&&this._vertexBuffer.destroy(),this._vertexBuffer=new pc.VertexBuffer(this._app.graphicsDevice,this._vertexFormat,this._renderCounts.vertexCount)),(!this._indexBuffer||this._indexBuffer.getNumIndices()<this._renderCounts.indexCount)&&(this._indexBuffer&&this._indexBuffer.destroy(),this._indexBuffer=new pc.IndexBuffer(this._app.graphicsDevice,pc.INDEXFORMAT_UINT16,this._renderCounts.indexCount));for(var t=null,e=0,n=0,i=new pc.VertexIterator(this._vertexBuffer),a=new Uint16Array(this._indexBuffer.lock()),r=0,o=0,s=this.skeleton.drawOrder,l=s.length,h=0;h<l;h++){var u=s[h];if(u.attachment&&u.material&&u.positions.length>0&&u.indices.length>0){t&&t!==u.material&&(this.SubmitBatch(e,n,t),t=u.material,e=r,n=0),t=u.material;var c,d=u.positions,p=u.vertexColor.r,f=u.vertexColor.g,m=u.vertexColor.b,g=u.vertexColor.a,v=u.uvs,T=d.length/2;for(c=0;c<T;c++)i.element[pc.SEMANTIC_POSITION].set(d[2*c],d[2*c+1]),i.element[pc.SEMANTIC_NORMAL].set(0,255,0,0),i.element[pc.SEMANTIC_COLOR].set(p,f,m,g),i.element[pc.SEMANTIC_TEXCOORD0].set(v[2*c],v[2*c+1]),i.next();var y=u.indices,A=y.length;for(c=0;c<A;c++)a[r+c]=y[c]+o;n+=A,r+=A,o+=T}}i.end(),this._indexBuffer.unlock(),this.SubmitBatch(e,n,t)}this.addToLayers()},Spine.prototype.SubmitBatch=function(t,e,n){if(e>0){var i=new pc.Mesh;i.vertexBuffer=this._vertexBuffer,i.indexBuffer[0]=this._indexBuffer,i.primitive[0].type=pc.PRIMITIVE_TRIANGLES,i.primitive[0].base=t,i.primitive[0].count=e,i.primitive[0].indexed=!0,i.aabb=this._aabb,this._meshes.push(i);var a=new pc.MeshInstance(this._node,i,this._materials[n]);a.drawOrder=this.priority+this._meshInstances.length,a.visible=!this._hidden,this._meshInstances.push(a)}},Spine.prototype.update=function(t){if(!this._hidden){t*=this._timeScale;var e,n=this.states.length;for(e=0;e<n;e++)this.states[e].update(t);for(e=0;e<n;e++)this.states[e].apply(this.skeleton);this.autoUpdate&&this.skeleton.updateWorldTransform(),this.updateSkeleton(),this.render()}},Spine.prototype.setPosition=function(t){this._position.copy(t)},Spine.prototype.setTint=function(t,e){this._tint[t]=e},Spine.prototype.removeFromLayers=function(){if(this._model)for(var t=0;t<this._layers.length;t++){var e=this._app.scene.layers.getLayerById(this._layers[t]);e&&e.removeMeshInstances(this._model.meshInstances)}},Spine.prototype.addToLayers=function(){if(this._model)for(var t=0;t<this._layers.length;t++){var e=this._app.scene.layers.getLayerById(this._layers[t]);e&&e.addMeshInstances(this._model.meshInstances)}},Object.defineProperty(Spine.prototype,"state",{get:function(){return this.states[0]}}),Object.defineProperty(Spine.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t}}),Object.defineProperty(Spine.prototype,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t}}),Object.defineProperty(Spine.prototype,"layers",{get:function(){return this._layers},set:function(t){this._model&&this.removeFromLayers(),this._layers=t||[],this._model&&this.addToLayers()}}),{Spine:Spine}}()),pc.extend(pc,function(){var t=function SpineComponentSystem(t){pc.ComponentSystem.call(this,t),this.id="spine",this.ComponentType=pc.SpineComponent,this.DataType=pc.SpineComponentData,this.schema=["enabled","atlasAsset","textureAssets","skeletonAsset","atlasData","textures","skeletonData","speed","spine"],pc.ComponentSystem.bind("update",this.onUpdate,this)};return(t.prototype=Object.create(pc.ComponentSystem.prototype)).constructor=t,Object.assign(t.prototype,{initializeComponentData:function(t,e,n){n=["enabled","atlasAsset","textureAssets","skeletonAsset","atlasData","textures","skeletonData","spine"],pc.ComponentSystem.prototype.initializeComponentData.call(this.system,t,e,n)},removeComponent:function(t){var e=t.spine.data;e.spine&&e.spine.destroy(),t.spine.removeComponent()},onUpdate:function(t){var e=this.store;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],a=i.data;a.enabled&&i.entity.enabled&&a.spine&&(a.spine.setPosition(i.entity.getPosition()),a.spine.update(a.speed*t))}}}),{SpineComponentSystem:t}}()),pc.extend(pc,function(){var t=function SpineComponent(t,e){pc.Component.call(this,t,e),this.on("set_atlasAsset",this.onSetAsset,this),this.on("set_textureAssets",this.onSetAssets,this),this.on("set_skeletonAsset",this.onSetAsset,this),this.on("set_atlasData",this.onSetResource,this),this.on("set_textures",this.onSetResource,this),this.on("set_skeletonData",this.onSetResource,this)};return(t.prototype=Object.create(pc.Component.prototype)).constructor=t,Object.assign(t.prototype,{_createSpine:function(){this.data.spine&&(this.data.spine.destroy(),this.data.spine=null);for(var t={},e=0,n=this.textureAssets.length;e<n;e++){var i=this.system.app.assets.get(this.textureAssets[e]),a=pc.path.getBasename(i.file.url),r=a.indexOf("?");-1!==r&&(a=a.substring(0,r)),t[a]=i.resource}this.data.spine=new pc.Spine(this.system.app,this.atlasData,this.skeletonData,t),this.state=this.data.spine.state,this.states=this.data.spine.states,this.skeleton=this.data.spine.skeleton,this.entity.addChild(this.data.spine._node)},_onAssetReady:function(t){"texture"===t.type&&this.textures.push(t.resource),"json"===t.type&&(this.skeletonData=t.resource),"text"===t.type&&(this.atlasData=t.resource)},_onAssetAdd:function(t){t.off("change",this.onAssetChanged,this),t.on("change",this.onAssetChanged,this),t.off("remove",this.onAssetRemoved,this),t.on("remove",this.onAssetRemoved,this),t.ready(this._onAssetReady,this),this.system.app.assets.load(t)},onSetResource:function(){this.data.atlasData&&this.data.textures.length&&this.data.skeletonData&&this._createSpine()},onSetAsset:function(t,e,n){var i=this.system.app.assets,a=null;if(e&&(a=i.get(e))&&(a.off("change",this.onAssetChanged),a.off("remove",this.onAssetRemoved)),n){var r=n;n instanceof pc.Asset&&(r=n.id,this.data[t]=r),(a=i.get(r))?this._onAssetAdd(a):i.on("add:"+r)}},onSetAssets:function(t,e,n){var i,a,r=this.system.app.assets,o=null;if(e.length)for(i=0,a=e.length;i<a;i++)(o=r.get(e[i]))&&(o.off("change",this.onAssetChanged),o.off("remove",this.onAssetRemoved));if(n&&n.length){var s=n.map((function(t){return t instanceof pc.Asset?t.id:t}));for(i=0,a=n.length;i<a;i++)(o=r.get(s[i]))?this._onAssetAdd(o):r.on("add:"+s[i])}},onAssetChanged:function(t,e,n,i){},onAssetRemoved:function(t){},onEnable:function(){pc.Component.prototype.onEnable.call(this);var t=this.data.spine;t&&t.addToLayers()},onDisable:function(){pc.Component.prototype.onDisable.call(this);var t=this.data.spine;t&&t.removeFromLayers()},hide:function(){this.data.spine&&this.data.spine.hide()},show:function(){this.data.spine&&this.data.spine.show()},removeComponent:function(){var t;if(this.atlasAsset&&(t=this.system.app.assets.get(this.atlasAsset))&&(t.off("change",this.onAssetChanged),t.off("remove",this.onAssetRemoved)),this.skeletonAsset&&(t=this.system.app.assets.get(this.skeletonAsset))&&(t.off("change",this.onAssetChanged),t.off("remove",this.onAssetRemoved)),this.textureAssets&&this.textureAssets.length)for(var e=0;e<this.textureAssets.length;e++)(t=this.system.app.assets.get(this.textureAssets[e]))&&(t.off("change",this.onAssetChanged),t.off("remove",this.onAssetRemoved))}}),{SpineComponent:t}}()),pc.extend(pc,{SpineComponentData:function(){this.enabled=!0,this.atlasAsset=null,this.textureAssets=[],this.skeletonAsset=null,this.speed=1,this.spine=null,this.atlasData=null,this.textures=[],this.skeletonData=null}}),function(){if(pc.Application.registerPlugin){pc.Application.registerPlugin("spine",(function(t){new pc.SpineComponentSystem(t)}))}else{var t=pc.Application.getApplication(),e=new pc.SpineComponentSystem(t);t.systems.add(e)}}();var AnimationController=function(t){this.entity=t,this.paused=!1,this.playing=!1,this.speed=1,this.state="",this.delegateObj={start:this.onStart.bind(this),complete:this.onComplete.bind(this),event:this.onEvent.bind(this),interrupt:this.onInterrupt.bind(this)},this.entity.spine.state.addListener(this.delegateObj),pc.events.attach(this)};AnimationController.prototype.getMainTrack=function(){return this.entity.spine.state.tracks[0]},AnimationController.prototype.setPlaybackSpeed=function(t){this.speed=t,this.getMainTrack()&&(this.getMainTrack().timeScale=this.speed)},AnimationController.prototype.play=function(t,i,e,n,o){this.playing=!0,this.paused=!1,void 0===n&&(n=0),(this.state!==t||o)&&this.entity.spine.state.setAnimation(n,t,void 0!==e&&e),this.state=t,void 0!==i&&this.setPlaybackSpeed(i)},AnimationController.prototype.stop=function(){this.playing=!1,this.paused=!1,this.entity.spine.state.setEmptyAnimation(0,0)},AnimationController.prototype.pause=function(){this.playing&&(this.paused=!0,this.getMainTrack().timeScale=0)},AnimationController.prototype.resume=function(){this.playing&&(this.paused=!1,this.getMainTrack().timeScale=this.speed)},AnimationController.prototype.destroy=function(){this.entity=null,this.delegateObj=null},AnimationController.prototype.onStart=function(t){this.fire("start",t)},AnimationController.prototype.onComplete=function(t){this.fire("complete",t)},AnimationController.prototype.onEvent=function(t,i){this.fire("event",t,i)},AnimationController.prototype.onInterrupt=function(t){this.fire("interrupt",t,event)};pc.Entity.prototype.delayedCall=function(e,t,n){for(var i=0;this["delayedExecuteTween"+i];)i++;var l="delayedExecuteTween"+i;return this[l]=this.tween(undefined).to(1,e,pc.Linear),this[l].start(),this[l].once("complete",(function(){t.call(n),this[l]=null}),this),this[l]};var TrackSectionPool=function(o){this.pool=[];for(var t=0;t<o.length;t++)this.addToPool(o[t]),this.addToPool(o[t]);this.pool.sort(this.shuffle)};TrackSectionPool.prototype.addToPool=function(o){var t=o.clone();t.script.get("poolItem").registerPool(this),this.pool.push(t)},TrackSectionPool.prototype.shuffle=function(o,t){return Math.random()<.5?-1:1},TrackSectionPool.prototype.getSection=function(){this.pool.sort(this.shuffle);var o=this.pool.shift();return o.enabled=!0,o},TrackSectionPool.prototype.returnItem=function(o){-1===this.pool.indexOf(o)&&this.pool.push(o),o.parent&&o.parent.removeChild(o),o.setEulerAngles(0,0,0),o.enabled=!1};var ObjectPool=function(o,t){isNaN(t)&&(t=10),this.original=o,this.pool=[];for(var e=0;e<t;e++)this.addToPool()};ObjectPool.prototype.addToPool=function(){var o=this.original.clone();o.script.get("poolItem").registerPool(this),this.pool.push(o)},ObjectPool.prototype.getItem=function(){0===this.pool.length&&this.addToPool();var o=this.pool.shift();return o.script.get("poolItem").removedFromPool(),o.enabled=!0,o},ObjectPool.prototype.returnItem=function(o){-1===this.pool.indexOf(o)?this.pool.push(o):console.log("already in the pool"),o.parent&&o.parent.removeChild(o),o.setEulerAngles(0,0,0),o.enabled=!1},ObjectPool.prototype.dispose=function(){console.log("this.pool ",this.pool),this.pool=[]};var PoolItem=pc.createScript("poolItem");PoolItem.prototype.registerPool=function(o){this.pool=o},PoolItem.prototype.returnToPool=function(){this.entity.enabled=!1,this.pool.returnItem(this.entity),this.entity.fire("returnToPool")},PoolItem.prototype.removedFromPool=function(){this.entity.fire("removedFromPool")};var ButtonManager=function(t){t.buttonManager||(this.app=t,this.app.buttonManager=this,this.buttonActionLookup={})};ButtonManager.prototype.initButton=function(t,e,n,o){this.disposeBtn(t),t.element.on("mouseenter",this.onEnter,this),t.element.on("mousedown",this.onPress,this),t.element.on("mouseup",this.onRelease,this),t.element.on("mouseleave",this.onLeave,this),this.buttonActionLookup[t._guid]={a:e,s:n,p:o},t.element.on("touchstart",this.onPress,this),t.element.on("touchend",this.onRelease,this),t.hovered=!1},ButtonManager.prototype.disposeBtn=function(t){this.buttonActionLookup[t._guid]&&delete this.buttonActionLookup[t._guid],t.element.off("mouseenter"),t.element.off("mousedown"),t.element.off("mouseup"),t.element.off("mouseup"),t.element.off("mouseleave"),t.element.off("touchstart"),t.element.off("touchend"),t.element.off("touchend")},ButtonManager.prototype.onEnter=function(t){this.app.uiUtils.buttonBounceIn(t.element.entity),document.body.style.cursor="pointer"},ButtonManager.prototype.onLeave=function(t){this.hovered=!1,this.app.uiUtils.buttonBounceOut(t.element.entity),document.body.style.cursor="default"},ButtonManager.prototype.onPress=function(t){this.app.gSoundManager&&this.app.gSoundManager.playSound("uiClick"),this.app.uiUtils.buttonBounceIn(t.element.entity),this.lastPressed=t.element.entity},ButtonManager.prototype.onRelease=function(t){if(this.lastPressed===t.element.entity){this.app.uiUtils.buttonBounceOut(t.element.entity);var e=this.buttonActionLookup[t.element.entity._guid];e&&e.a.call(e.s,e.p)}this.lastPressed=null};var TitleScreen=pc.createScript("titleScreen");TitleScreen.attributes.add("bg",{type:"entity",title:"bg"}),TitleScreen.attributes.add("rays",{type:"entity",title:"rays"}),TitleScreen.attributes.add("rayHolder",{type:"entity",title:"rayHolder"}),TitleScreen.attributes.add("playButton",{type:"entity",title:"playButton"}),TitleScreen.attributes.add("continueButton",{type:"entity",title:"continueButton"}),TitleScreen.attributes.add("newGameButton",{type:"entity",title:"newGameButton"}),TitleScreen.attributes.add("grizzyTitle",{type:"entity",title:"grizzyTitle"}),TitleScreen.attributes.add("gameTitle",{type:"entity",title:"gameTitle"}),TitleScreen.attributes.add("grizzyCharacter",{type:"entity",title:"grizzyCharacter"}),TitleScreen.attributes.add("lemmingsCharacter",{type:"entity",title:"lemmingsCharacter"}),TitleScreen.attributes.add("jar1",{type:"entity",title:"jar1"}),TitleScreen.attributes.add("jar2",{type:"entity",title:"jar2"}),TitleScreen.attributes.add("jar3",{type:"entity",title:"jar3"}),TitleScreen.attributes.add("jar4",{type:"entity",title:"jar4"}),TitleScreen.prototype.initialize=function(){this.app.uiUtils.quality="auto",this.app.uiUtils.bounceIn(this.grizzyCharacter,.1),this.app.uiUtils.bounceIn(this.lemmingsCharacter,.2),this.app.uiUtils.bounceIn(this.grizzyTitle,.3),this.app.uiUtils.bounceIn(this.jar1,.32),this.app.uiUtils.bounceIn(this.jar2,.34),this.app.uiUtils.bounceIn(this.jar3,.36),this.app.uiUtils.bounceIn(this.jar4,.38),this.app.uiUtils.bounceIn(this.gameTitle,.4),!0===this.app.userData.getLevelData(1).hasRun?(this.playButton.enabled=!1,this.app.uiUtils.bounceIn(this.continueButton,.5),this.app.uiUtils.bounceIn(this.newGameButton,.6)):(this.app.uiUtils.bounceIn(this.playButton,.5),this.newGameButton.enabled=!1,this.continueButton.enabled=!1),this.app.uiUtils.bounceIn(this.rays,.1,!0),this.app.uiUtils.addToParallax(this.bg,-.05,!0),this.app.uiUtils.addToParallax(this.rayHolder,-.04,!0),this.app.uiUtils.addToParallax(this.jar3,-.045),this.app.uiUtils.addToParallax(this.jar4,-.025),this.app.uiUtils.addToParallax(this.jar2,.04),this.app.uiUtils.addToParallax(this.jar1,.07),this.app.uiUtils.addToParallax(this.lemmingsCharacter,-.03),this.app.uiUtils.addToParallax(this.grizzyCharacter,-.03),this.app.uiUtils.addToParallax(this.grizzyTitle,-.02),this.app.uiUtils.addToParallax(this.gameTitle,-.02),this.app.uiUtils.addToParallax(this.playButton,.01),this.app.uiUtils.addToParallax(this.continueButton,.01),this.app.uiUtils.addToParallax(this.newGameButton,.01),this.app.uiUtils.addToParallax(this.newGameButton,.01),this.app.buttonManager.initButton(this.playButton,this.playClicked,this),this.app.buttonManager.initButton(this.continueButton,this.playClicked,this),this.app.buttonManager.initButton(this.newGameButton,this.newGameClicked,this),this.app.uiUtils.mouseOffset=new pc.Vec3(0,this.app.uiUtils.screenHeight/2,0)},TitleScreen.prototype.postInitialize=function(){this.app.gSoundManager.playMusic("music_title")},TitleScreen.prototype.playClicked=function(t){console.log("play clicked"),this.app.buttonManager.disposeBtn(this.playButton),this.app.buttonManager.disposeBtn(this.newGameButton),this.app.uiUtils.animPageOut(this.gotoLevelSelect,this)},TitleScreen.prototype.gotoLevelSelect=function(){this.app.nav.gotoPage("LevelSelect")},TitleScreen.prototype.newGameClicked=function(t){this.app.buttonManager.disposeBtn(this.playButton),this.app.buttonManager.disposeBtn(this.newGameButton),this.app.uiUtils.animPageOut(this.gotoNewGame,this)},TitleScreen.prototype.gotoNewGame=function(t){this.app.nav.gotoPage("NewGame")},TitleScreen.prototype.update=function(t){};var UiUtils=function(t){if(this.app=t,!this.app.uiUtils){this.app.uiUtils=this,this.averageDeltaTime=1/60,this.totalTime=0,this.framesPassed=0;var e=this.app.touch,i=this.app.mouse;e?(e.on(pc.EVENT_TOUCHSTART,this.onPointerStart,this),e.on(pc.EVENT_TOUCHMOVE,this.onPointerMove,this),e.on(pc.EVENT_TOUCHEND,this.onPointerEnd,this)):i&&(i.on(pc.EVENT_MOUSEDOWN,this.onPointerStart,this),i.on(pc.EVENT_MOUSEMOVE,this.onPointerMove,this),i.on(pc.EVENT_MOUSEUP,this.onPointerEnd,this)),this.screenWidth=this.app.graphicsDevice.canvas.clientWidth,this.screenHeight=this.app.graphicsDevice.canvas.clientHeight,this.centreScreen=new pc.Vec3(this.screenWidth/2,this.screenHeight/2,0),this.mouseOffset=new pc.Vec3(0,0,0),console.log("mouseOffset1",this.mouseOffset),this.pointerDownPos=new pc.Vec3(0,0,0),this.pointerPos=new pc.Vec3(0,0,0),this.autoAdjustQuality=!1,window.app=this.app}};UiUtils.prototype.update=function(t){"auto"==this.quality?(this.framesPassed++,this.totalTime+=t,this.framesPassed>60&&(this.framesPassed/this.totalTime<40?this.app.graphicsDevice.maxPixelRatio>1?this.app.graphicsDevice.maxPixelRatio=1:1===this.app.graphicsDevice.maxPixelRatio&&(this.app.graphicsDevice.maxPixelRatio=.75):this.app.graphicsDevice.maxPixelRatio=window.devicePixelRatio,this.framesPassed=0,this.totalTime=0)):("low"==this.quality&&(this.app.graphicsDevice.maxPixelRatio=1),"high"==this.quality&&(this.app.graphicsDevice.maxPixelRatio=window.devicePixelRatio));if(this.pointerPos&&this.parallaxItems){var e=new pc.Vec3(this.centreScreen.x-this.pointerPos.x,this.pointerPos.y-this.centreScreen.y,0),i=new pc.Vec3(0,0,0).lerp(this.mouseOffset,e,5*t),s=new pc.Vec3(0,0,0).sub2(i,this.mouseOffset);s.lengthSq()>Math.pow(30,2)?this.mouseOffset=this.mouseOffset.add(s.normalize().scale(30)):this.mouseOffset=i;for(var a=0;a<this.parallaxItems.length;a++){var o=this.parallaxItems[a],n=this.mouseOffset.clone().scale(o.scrollMult);o.element.setLocalPosition(o.initialPos.clone().add(n))}}},UiUtils.prototype.bounceIn=function(t,e,i=!1,s,a){this.animTweens||(this.animTweens=[]),this.pageElements||(this.pageElements=[]),this.pageElements.push(t),t.setLocalScale(pc.Vec3.ZERO);var o=new pc.Vec3(.8,.8,.8);i&&(o=new pc.Vec3(1.2,1.2,1.2));var n=t.tween(t.getLocalScale()).toFrom(new pc.Vec3(1,1,1),o,1,pc.ElasticOut).delay(e).on("complete",(()=>{s&&s.apply(a)}));n.start(),this.animTweens.push(n)},UiUtils.prototype.animPageOut=function(t,e){for(var i=0;i<this.pageElements.length;i++){var s=this.pageElements[i],a=s.tween(s.getLocalScale()).to(new pc.Vec3(0,0,0),.2,pc.SineOut).delay(i/20);i==this.pageElements.length-1&&a.on("complete",t,e),a.start()}this.clearPage(),this.pageElements=[],this.animTweens=[]},UiUtils.prototype.buttonBounceIn=function(t,e){t.btnTween&&t.btnTween.kill();var i=t.tween(t.getLocalScale()).to(new pc.Vec3(1.1,1.1,1.1),.7,pc.ElasticOut);i.start(),t.tween(t.getLocalRotation()).to(new pc.Vec3(0,0,.04*Math.random()-.02),.1,pc.Linear).start(),t.btnTween=i},UiUtils.prototype.buttonBounceOut=function(t,e){t.btnTween&&t.btnTween.kill(),t.tween(t.getLocalRotation()).to(new pc.Vec3(0,0,0),.1,pc.Linear).start();var i=t.tween(t.getLocalScale()).to(new pc.Vec3(1,1,1),.2,pc.SineOut);i.start(),t.btnTween=i},UiUtils.prototype.addToParallax=function(t,e,i){this.parallaxItems||(this.parallaxItems=[]);var s=t.getLocalPosition().clone();if(isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),isNaN(s.z)&&(s.z=0),this.parallaxItems.push({element:t,scrollMult:e*window.devicePixelRatio,initialPos:s}),i){var a=1+2*Math.abs(e*window.devicePixelRatio),o=t.getLocalScale();o.scale(a),t.setLocalScale(o)}this.pointerPos={x:0,y:700}},UiUtils.prototype.clearPage=function(){if(this.animTweens)for(var t=0;t<this.animTweens.length;t++)this.animTweens[t].kill();this.parallaxItems=[]},UiUtils.prototype.onPointerStart=function(t){var e=t.touches?t.touches[0]:t;this.pointerDown=!0,this.pointerDownPos={x:e.x,y:e.y},this.pointerPos={x:e.x,y:e.y}},UiUtils.prototype.onPointerMove=function(t){var e=t.touches?t.touches[0]:t;this.pointerPos={x:e.x,y:e.y}},UiUtils.prototype.onPointerEnd=function(t){this.pointerDown=!1,this.pointerUpPos={x:this.pointerPos.x,y:this.pointerPos.y}};var LevelSelect=pc.createScript("levelSelect");LevelSelect.attributes.add("bg",{type:"entity",title:"bg"}),LevelSelect.attributes.add("header",{type:"entity",title:"header"}),LevelSelect.attributes.add("headerText",{type:"entity"}),LevelSelect.attributes.add("panelHolder",{type:"entity"}),LevelSelect.attributes.add("level1Panel",{type:"entity",title:"level1Panel"}),LevelSelect.attributes.add("level2Panel",{type:"entity",title:"level2Panel"}),LevelSelect.attributes.add("level3Panel",{type:"entity",title:"level3Panel"}),LevelSelect.attributes.add("levelInfinitePanel",{type:"entity",title:"levelInfinitePanel"}),LevelSelect.prototype.initialize=function(){this.app.gSoundManager.playMusic("music_title"),this.app.uiUtils.quality="auto",this.app.uiUtils.bounceIn(this.header,.1),this.app.uiUtils.bounceIn(this.level1Panel,.2),this.app.uiUtils.bounceIn(this.level2Panel,.3),this.app.uiUtils.bounceIn(this.level3Panel,.4),this.app.uiUtils.bounceIn(this.levelInfinitePanel,.5),"ar-sa"==this.app.i18n.locale&&(this.headerText.element.spacing=.8),this.app.uiUtils.addToParallax(this.bg,-.05,!0),this.app.uiUtils.addToParallax(this.header,.01),this.app.uiUtils.addToParallax(this.panelHolder,-.01),this.app.uiUtils.mouseOffset=new pc.Vec3(0,this.app.uiUtils.screenHeight/2,0)},LevelSelect.prototype.playClicked=function(e){console.log("play clicked")},LevelSelect.prototype.newGameClicked=function(e){console.log("play clicked")},LevelSelect.prototype.update=function(e){var t=1024/768,l=this.app.graphicsDevice.width/this.app.graphicsDevice.height;if(t>l){var i=l/t;this.panelHolder.setLocalScale(new pc.Vec3(i,i,i))}else this.panelHolder.setLocalScale(new pc.Vec3(1,1,1))};var LevelSelectGroup=pc.createScript("levelSelectGroup");LevelSelectGroup.attributes.add("level",{type:"number",title:"level"}),LevelSelectGroup.attributes.add("lockedPanel",{type:"entity",title:"lockedPanel"}),LevelSelectGroup.attributes.add("unLockedPanel",{type:"entity",title:"unLockedPanel"}),LevelSelectGroup.attributes.add("header",{type:"entity",title:"header"}),LevelSelectGroup.attributes.add("positionText",{type:"entity",title:"positionText"}),LevelSelectGroup.attributes.add("timeText",{type:"entity",title:"timeText"}),LevelSelectGroup.attributes.add("yummyText",{type:"entity",title:"yummyText"}),LevelSelectGroup.attributes.add("boostText",{type:"entity",title:"boostText"}),LevelSelectGroup.attributes.add("headerText",{type:"entity",title:"headerText"}),LevelSelectGroup.attributes.add("stars",{type:"entity",title:"stars"}),LevelSelectGroup.attributes.add("playButton",{type:"entity",title:"playButton"}),LevelSelectGroup.prototype.postInitialize=function(){var t=this.app.userData.getLevelData(this.level),e=this.app.userData.getStars(t);this.stars.script.get("starsDisplay").showStars(e),t.unlocked?this.initUnlocked(t):this.initLocked()},LevelSelectGroup.prototype.initLocked=function(){this.unLockedPanel.enabled=!1,this.lockedPanel.enabled=!0},LevelSelectGroup.prototype.initUnlocked=function(t){this.unLockedPanel.enabled=!0,this.lockedPanel.enabled=!1,4!==t.levelNumber?(this.positionText.element.text=t.highestPosition.toString(),this.timeText.element.text=t.fastestTime.toString(),this.yummyText.element.text=t.jars.toString(),this.boostText.element.text=t.boosts.toString()):(this.timeText.element.text=t.furthestDistance.toString(),this.yummyText.element.text=t.jars.toString(),this.boostText.element.text=t.boosts.toString()),this.app.buttonManager.initButton(this.entity,this.playLevel,this),this.app.buttonManager.initButton(this.playButton,this.playLevel,this),this.app.uiUtils.addToParallax(this.header,.005),this.app.uiUtils.addToParallax(this.playButton,.005)},LevelSelectGroup.prototype.playLevel=function(){this.app.buttonManager.disposeBtn(this.entity),this.app.buttonManager.disposeBtn(this.playButton),this.app.uiUtils.animPageOut(this.gotoRace,this)},LevelSelectGroup.prototype.gotoRace=function(){this.app.transData.selectedLevel=this.level,this.app.nav.gotoPage("CharacterSelect")},LevelSelectGroup.prototype.update=function(t){};var RootScriptLoader=pc.createScript("rootScriptLoader");RootScriptLoader.prototype.initialize=function(){new Nav(this.app),new UiUtils(this.app),new ButtonManager(this.app),new UserData(this.app),new TransitoryData(this.app),new MathUtils(this.app)},RootScriptLoader.prototype.update=function(t){this.app.uiUtils.update(t)};var AssetLoader=pc.createScript("assetLoader");AssetLoader.prototype.initialize=function(){console.log("starting load"),this.allAssetNames=[],this.loadedAssets=[],this.allAssetNames.push("Track_1"),this.allAssetNames.push("Track_2"),this.allAssetNames.push("Track_3"),this.allAssetNames.push("Track_4"),this.allAssetNames.push("track_1.json"),this.allAssetNames.push("track_1_tex.png"),this.allAssetNames.push("track_2.json"),this.allAssetNames.push("track_2_tex.png"),this.allAssetNames.push("track_3.json"),this.allAssetNames.push("track_3_tex.png"),this.allAssetNames.push("track_4.json"),this.allAssetNames.push("track_4_tex.png");for(var s=0;s<this.allAssetNames.length;s++){var t=this.app.assets.find(this.allAssetNames[s]);t.ready(this.assetLoaded.bind(this)),this.app.assets.load(t)}},AssetLoader.prototype.assetLoaded=function(s){this.loadedAssets.push(s),console.log(this.loadedAssets.length,this.allAssetNames.length),this.loadedAssets.length===this.allAssetNames.length&&this.entity.delayedCall(.2,this.gotoRace.bind(this))},AssetLoader.prototype.gotoRace=function(){this.app.nav.gotoPage("Race")},AssetLoader.prototype.update=function(s){};var Nav=function(i){this.app=i,this.app.nav||(this.app.nav=this,this.history=[],this.currentPage="loader",this.isLoading=!1)};Nav.prototype.gotoPage=function(i,t){!0!==this.isLoading&&(t||this.history.push(this.currentPage),this.currentPage=i,this.oldHierarchy=this.app.root.findByName("Root"),this.isLoading=!0,this.app.scenes.loadSceneHierarchy(this.app.scenes.find(i).url,this.hasLoaded.bind(this)))},Nav.prototype.hasLoaded=function(i,t){if(i)console.error(i);else{this.isLoading=!1,this.newHierarchy=this.app.root.findByName("Root");var o=this.oldHierarchy.findByName("soundManager");if(o){for(var a=this.newHierarchy.find("name","soundManager"),e=0;e<a.length;e++){var s=a[e];console.log("nsm",e,s,a),s&&s!==o&&s.destroy()}this.oldHierarchy.removeChild(o),o._parent=this.newHierarchy}this.oldHierarchy.destroy(),this.oldHierarchy=null}},Nav.prototype.gotoHome=function(){},Nav.prototype.goBack=function(){this.gotoPage(this.history.pop(),!0)};var CharacterSelect=pc.createScript("characterSelect");CharacterSelect.attributes.add("bg",{type:"entity",title:"bg"}),CharacterSelect.attributes.add("bg2",{type:"entity",title:"bg2"}),CharacterSelect.attributes.add("header",{type:"entity",title:"header"}),CharacterSelect.attributes.add("grizzyButton",{type:"entity",title:"grizzyButton"}),CharacterSelect.attributes.add("grizzyHolder",{type:"entity",title:"grizzyHolder"}),CharacterSelect.attributes.add("lemmingsHolder",{type:"entity",title:"lemmingsHolder"}),CharacterSelect.attributes.add("grizzyBoard",{type:"entity",title:"grizzyBoard"}),CharacterSelect.attributes.add("lemmingsBoard",{type:"entity",title:"lemmingsBoard"}),CharacterSelect.attributes.add("grizzyButtonHolder",{type:"entity",title:"grizzyButtonHolder"}),CharacterSelect.attributes.add("lemmingsButton",{type:"entity",title:"lemmingsButton"}),CharacterSelect.attributes.add("lemmingsTitle",{type:"entity",title:"lemmingsTitle"}),CharacterSelect.attributes.add("grizzyTitle",{type:"entity",title:"grizzyTitle"}),CharacterSelect.prototype.initialize=function(){this.app.gSoundManager.playMusic("music_title"),this.app.uiUtils.quality="auto",this.app.uiUtils.bounceIn(this.header,.1),this.app.uiUtils.bounceIn(this.grizzyHolder,.2),this.app.uiUtils.bounceIn(this.grizzyTitle,.4),this.app.uiUtils.bounceIn(this.lemmingsTitle,.5),this.app.uiUtils.bounceIn(this.lemmingsHolder,.3),this.app.uiUtils.addToParallax(this.bg,-.05,!0),this.app.uiUtils.addToParallax(this.bg2,-.03,!0),this.app.uiUtils.addToParallax(this.grizzyButton,-.01),this.app.uiUtils.addToParallax(this.lemmingsButton,-.01),this.app.uiUtils.addToParallax(this.grizzyButtonHolder,.01),this.app.uiUtils.addToParallax(this.lemmingsTitle,.01),this.app.uiUtils.mouseOffset=new pc.Vec3(0,this.app.uiUtils.screenHeight/2,0),this.app.buttonManager.initButton(this.grizzyButton,this.grizzyClicked,this),this.app.buttonManager.initButton(this.lemmingsButton,this.lemmingsClicked,this),this.app.buttonManager.initButton(this.grizzyBoard,this.grizzyClicked,this),this.app.buttonManager.initButton(this.lemmingsBoard,this.lemmingsClicked,this)},CharacterSelect.prototype.grizzyClicked=function(t){this.app.gSoundManager.playSting(),this.app.userData.characterSelected="Grizzy",this.app.buttonManager.disposeBtn(this.grizzyButton),this.app.buttonManager.disposeBtn(this.lemmingsButton),this.app.buttonManager.disposeBtn(this.grizzyBoard),this.app.buttonManager.disposeBtn(this.lemmingsBoard),this.app.uiUtils.animPageOut(this.gotoRace,this)},CharacterSelect.prototype.lemmingsClicked=function(t){this.app.gSoundManager.playSting(),this.app.userData.characterSelected="Lemmings",this.app.buttonManager.disposeBtn(this.grizzyButton),this.app.buttonManager.disposeBtn(this.lemmingsButton),this.app.buttonManager.disposeBtn(this.grizzyBoard),this.app.buttonManager.disposeBtn(this.lemmingsBoard),this.app.uiUtils.animPageOut(this.gotoRace,this)},CharacterSelect.prototype.gotoRace=function(){this.app.nav.gotoPage("RaceLoader")},CharacterSelect.prototype.update=function(t){};var UserData=function(e){this.app=e,this.app.userData||(this.app.userData=this,this.saveKey="YummyRun",this.loadLevelData())};UserData.prototype.loadLevelData=function(){var e=window.localStorage.getItem(this.saveKey);if(e){var t=JSON.parse(e);this.levelData=t.levelData,this.characterSelected=t.characterSelected}else this.reset()},UserData.prototype.saveLevelData=function(){var e={};e.levelData=this.levelData,e.characterSelected=this.characterSelected,window.localStorage.setItem(this.saveKey,JSON.stringify(e)),console.log("save Data")},UserData.prototype.reset=function(){console.log("reset Data"),this.characterSelected="Lemmings",this.levelData=[this.getBlankLevelData(1),this.getBlankLevelData(2),this.getBlankLevelData(3),this.getBlankLevelData(4)],this.levelData[0].unlocked=!0,this.saveLevelData()},UserData.prototype.levelComplete=function(e,t,a,s,i,l){var r={highestPosition:!1,fastestTime:!1,jars:!1,boosts:!1,furthestDistance:!1};e<this.levelData.length&&(this.levelData[e].unlocked=!0);var o=this.levelData[e-1];return 4!==e?((t<o.highestPosition||0===o.highestPosition)&&(o.highestPosition=t,r.highestPosition=!0),(a<o.fastestTime||0===o.fastestTime)&&(o.fastestTime=a,r.fastestTime=!0)):o.furthestDistance<l&&(o.furthestDistance=l,r.furthestDistance=!0),o.jars<s&&(o.jars=s,r.jars=!0),o.boosts<i&&(o.boosts=i,r.boosts=!0),o.hasRun=!0,this.saveLevelData(),r},UserData.prototype.getStars=function(e){return 4!=e.levelNumber?1===e.highestPosition?3:e.jars>=5*e.levelNumber?2:e.hasRun?1:0:e.furthestDistance>8e3?3:e.furthestDistance>5e3?2:e.furthestDistance>1e3?1:0},UserData.prototype.getLevelData=function(e){return console.log(this.levelData[e-1]),JSON.parse(JSON.stringify(this.levelData[e-1]))},UserData.prototype.getBlankLevelData=function(e){var t={};return t.levelNumber=e,t.highestPosition=0,t.fastestTime=0,t.jars=0,t.boosts=0,t.hasRun=!1,t.unlocked=!1,t.furthestDistance=0,t};var Game=pc.createScript("game");Game.attributes.add("player",{type:"entity",title:"player"}),Game.attributes.add("skybox",{type:"asset",title:"skybox"}),Game.attributes.add("eolScreen",{type:"entity",title:"eolScreen"}),Game.prototype.initialize=function(){this.app.gSoundManager.playMusic("music_race"),this.app.transData.tempRaceData=this.app.userData.getBlankLevelData(this.app.transData.selectedLevel),this.app.uiUtils.quality="low",this.player.on("dead",this.endGame,this),this.player.on("complete",this.completeGame,this),this.app.setSkybox(this.skybox),this.app.eol=!1,this.app.userPaused=!1,this.app.systemPaused=0},Game.prototype.endGame=function(){4===this.app.transData.selectedLevel?this.goToResults():this.app.nav.gotoPage("GameOver")},Game.prototype.completeGame=function(){this.app.eol=!0,this.eolScreen.script.get("eolScreen").show(this.app.userData.characterSelected,this.app.transData.tempRaceData.highestPosition),this.entity.delayedCall(3,this.goToResults.bind(this))},Game.prototype.goToResults=function(){this.app.nav.gotoPage("ResultsScreen"),this.app.gSoundManager.playSting()},Game.prototype.update=function(t){this.app.systemPaused<0&&(this.app.systemPaused=0)};var TransitoryData=function(a){this.app=a,this.app.transData||(this.app.transData=this,this.selectedLevel=4,this.justUnlocked=null,this.tempRaceData=this.app.userData.getBlankLevelData(2))};var LevelConfig=function(e){this.app=e,this.allLevels=[new Level1Config,new Level2Config,new Level3Config,new Level4Config]};LevelConfig.prototype.getLevelConfig=function(e){return this.allLevels[e-1]},LevelConfig.prototype.getObstacle=function(e){for(var t=[],n=0;n<e.obstaclePool.length;n++)for(var i=t.length+e.obstaclePool[n].spawnlikelihood;t.length<i;)t.push(e.obstaclePool[n]);return t[Math.floor(Math.random()*t.length)]};var Level1Config=function(){this.t=new ObstacleConfig("truck",2,100),this.obstaclePool=[this.t],this.distBetweenObstacles={min:20,max:30},this.distBetweenLaneChange={min:50,max:100},this.levelLength=5},Level2Config=function(){var e=new ObstacleConfig("hole",1,15);this.t=new ObstacleConfig("truck",2,100),this.obstaclePool=[e,this.t],this.distBetweenObstacles={min:15,max:30},this.distBetweenLaneChange={min:50,max:100},this.levelLength=10},Level3Config=function(){var e=new ObstacleConfig("hole",1,20),t=new ObstacleConfig("log",2,20);this.t=new ObstacleConfig("truck",2,100),this.obstaclePool=[e,t,this.t],this.distBetweenObstacles={min:20,max:30},this.distBetweenLaneChange={min:50,max:100},this.levelLength=15},Level4Config=function(){var e=new ObstacleConfig("hole",1,20),t=new ObstacleConfig("log",2,20);this.t=new ObstacleConfig("truck",2,100),this.obstaclePool=[e,t,this.t],this.distBetweenObstacles={min:20,max:30},this.distBetweenLaneChange={min:50,max:100},this.levelLength=Number.MAX_VALUE},ObstacleConfig=function(e,t,n){this.obstacleType=e,this.spawnlikelihood=t,this.minDist={min:n,max:n+3}};var MathUtils=function(t){t.mathUtils||(this.app=t,this.app.mathUtils=this)};MathUtils.prototype.randomRange=function(t,n){return t+Math.random()*(n-t)},MathUtils.prototype.randomInt=function(t,n){return Math.floor(t+Math.random()*(n-t))},MathUtils.prototype.randomElement=function(t){return t[this.randomInt(0,t.length)]},MathUtils.prototype.randomVec3=function(t){return new pc.Vec3(this.randomRange(.5*-t,.5*t),this.randomRange(.5*-t,.5*t),this.randomRange(.5*-t,.5*t))};var Obstacle=pc.createScript("obstacle");Obstacle.attributes.add("jumpButton",{type:"entity",title:"jumpButton"}),Obstacle.attributes.add("player",{type:"entity",title:"player"}),Obstacle.prototype.initialize=function(){this.isLeft=!1},Obstacle.prototype.initAndSetDirection=function(t,e,i,a){this.posDownTrack=a,this.isLeft=i<0,this.obstacleManger=t,this.entity.setEulerAngles(0,this.app.mathUtils.randomRange(0,360),0)};var ObstacleCollision=pc.createScript("obstacleCollision");ObstacleCollision.prototype.initialize=function(){},ObstacleCollision.prototype.update=function(i){};var Opponent=pc.createScript("opponent");Opponent.attributes.add("target",{type:"entity",title:"followObject"}),Opponent.attributes.add("displayEntity",{type:"entity",title:"displayEntity"}),Opponent.attributes.add("playerEntity",{type:"entity",title:"playerEntity"}),Opponent.attributes.add("obstacleEntity",{type:"entity",title:"obstacleEntity"}),Opponent.prototype.start=function(){this.isChangingLanes=!1,this.offset=2,this.isInAir=!1,this.doJump=!1,this.isJumping=!1,this.obstacleManager=this.obstacleEntity.script.get("obstacleManager"),this.pathFollowerInst=this.target.script.get("pathFollower"),this.pathFollowerInst.splineManager.evtBus.on("atEnd",this.endOfTheLine,this),this.pathFollowerInst.startFollowFront(this.pathFollowerInst.splineManager.getStartPoint(),!1),this.lookAtPos=new pc.Vec3,this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.setInitialPosition=!1,this.changeLanes=!1,this.jumpTime=200,this.jumpDelayedCall=null,this.isJumping=!1,this.sounds=this.entity.sound,this.obsCheckInterval=0,this.infront=!1},Opponent.prototype.initialize=function(){},Opponent.prototype.endOfTheLine=function(){},Opponent.prototype.onTriggerEnter=function(t){"collectable"===t.name&&t.script.get("collectable").collect(),!1===this.isInAir&&("logModel"===t.name&&(this.checkStable(),this.displayEntity.script.get("opponentDisplay").unstable(),this.sounds.play("crash_logs"),this.offset*=-1),"holeModel"===t.name&&(this.checkStable(),this.displayEntity.script.get("opponentDisplay").unstable(),this.sounds.play("crash_pothole"))),"Truck"===t.name&&(this.checkStable(),this.sounds.play("crash_truck"),this.pathFollowerInst.speed=1,this.displayEntity.script.get("opponentDisplay").unstable(),!0===this.isChangingLanes&&(this.offset*=-1))},Opponent.prototype.checkStable=function(){!1===this.displayEntity.script.get("opponentDisplay").isStable&&console.log("dead")},Opponent.prototype.update=function(t){if(this.pathFollowerInst.follow(t),!0===this.pathFollowerInst.updatePos){this.speedAdjust(t);var s=this.target.getPosition().add(this.target.right.clone().scale(this.offset).add(this.target.forward.clone().scale(-1))),e=this.entity.getPosition(),i=(new pc.Vec3).lerp(e,s,5*t),n=this.pathFollowerInst.splineManager.getClosestPointOnSpline(this.target.getPosition().add(this.target.forward.scale(5))).pos;n.sub(this.target.getPosition()),this.lookAtPos=(new pc.Vec3).lerp(this.lookAtPos,n,2*t),!1===this.setInitialPosition?(this.entity.setPosition(s),this.entity.lookAt(this.entity.getPosition().clone().add(n)),this.setInitialPosition=!0,this.playCharacterSound("moving",!0)):(this.entity.setPosition(i),this.lookAtPos=(new pc.Vec3).lerp(this.lookAtPos,n,2*t),this.entity.lookAt(this.entity.getPosition().clone().add(this.lookAtPos))),this.checkObstacles(t)}!0===this.changeLanes&&Math.random()<.9&&(this.offset*=-1,this.isChangingLanes=!0,this.entity.delayedCall(.5,this.laneSwitchComplete,this),this.displayEntity.script.get("opponentDisplay").changeLane(this.offset<0)),!0===this.doJump&&(Math.random()<.9&&(this.isInAir=!0,this.playCharacterSound("jump"),this.displayEntity.script.get("opponentDisplay").doJump()),this.jumpDelayedCall&&this.jumpDelayedCall.kill(),this.isJumping=!0,this.jumpDelayedCall=this.entity.delayedCall(1,this.jumpOver,this)),this.doJump=!1,this.changeLanes=!1},Opponent.prototype.speedAdjust=function(t){var s=this.playerEntity.getPosition(),e=24;this.pathFollowerInst.fPos.clone().sub(s).lengthSq()<this.pathFollowerInst.rPos.clone().sub(s).lengthSq()?(this.infront=!1,e*=1.1):(this.infront=!0,e*=.9),this.pathFollowerInst.speed+=(e-this.pathFollowerInst.speed)*(5*t)},Opponent.prototype.jumpOver=function(){this.jumpDelayedCall=null,this.isJumping=!1,this.isInAir=!1},Opponent.prototype.laneSwitchComplete=function(){this.isChangingLanes=!1},Opponent.prototype.checkObstacles=function(t){if(this.obsCheckInterval+=t,this.obsCheckInterval>.2&&(this.obsCheckInterval=0,this.obstacleManager.allObstacles&&0!==this.obstacleManager.allObstacles.length&&this.obstacleManager.allTrucks&&0!==this.obstacleManager.allTrucks.length)){for(var s=null,e=Number.MAX_VALUE,i=this.entity.getPosition().clone().add(this.lookAtPos),n=0;n<this.obstacleManager.allObstacles.length;n++){(l=(a=this.obstacleManager.allObstacles[n]).getPosition().sub(i).lengthSq())<e&&(e=l,s=a)}(e<30&&s.script.get("obstacle").isLeft&&this.offset<0||!1===s.script.get("obstacle").isLeft&&this.offset>0)&&(this.isJumping||(this.doJump=!0));var o=null;for(e=Number.MAX_VALUE,n=0;n<this.obstacleManager.allTrucks.length;n++){var a,l;(l=(a=this.obstacleManager.allTrucks[n]).getPosition().sub(i).lengthSq())<e&&(e=l,o=a)}(e<50&&o.script.get("truck").isLeft&&this.offset<0||!1===o.script.get("truck").isLeft&&this.offset>0)&&(this.changeLanes=!0)}},Opponent.prototype.playCharacterSound=function(t,s){var e="grizzy_";"Lemmings"!==this.app.userData.characterSelected&&(e="lemmings_");var i=e+t;s?!1===this.sounds.slot(i).isPlaying&&(this.sounds.play(i),this.sounds.slot(i).loop=!0):(this.sounds.play(i),this.sounds.slot(i).loop=!1)},Opponent.prototype.stopCharacterSound=function(t){var s="grizzy_";"Lemmings"!==this.app.userData.characterSelected&&(s="lemmings_"),this.sounds.stop(s+t)};var OpponentDisplay=pc.createScript("opponentDisplay");OpponentDisplay.attributes.add("player",{type:"entity",title:"Player"}),OpponentDisplay.attributes.add("grizzy",{type:"entity",title:"grizzy"}),OpponentDisplay.attributes.add("lemmings",{type:"entity",title:"lemmings"}),OpponentDisplay.attributes.add("characterSelection",{type:"number",title:"Character Selection",default:0}),OpponentDisplay.attributes.add("camera",{type:"entity",title:"camera"}),OpponentDisplay.prototype.initialize=function(){this.setCharacter(this.characterSelection),this.boundLeft=this.playLeft.bind(this),this.boundRight=this.playRight.bind(this),this.delayedCall=null,this.isStable=!0,this.currentLane="left";var t="Grizzy"===this.app.userData.characterSelected?1:0;this.setCharacter(t),this.opponenentScript=this.entity.parent.script.get("opponent")},OpponentDisplay.prototype.unstable=function(){this.animController.play("unstable",1,!0),this.entity.delayedCall(2,this.resumeNormalDriving,this),this.isStable=!1},OpponentDisplay.prototype.resumeNormalDriving=function(){this.isStable=!0,"left"==this.currentLane?this.playLeft():this.playRight()},OpponentDisplay.prototype.doJump=function(){this.animController.play("jump",1,!1,2,!0)},OpponentDisplay.prototype.changeLane=function(t){this.currentLane=t?"left":"right",!1!==this.isStable&&(this.delayedCall&&this.delayedCall.kill(),t?(this.animController.play("right-to-left",1,!1),this.delayedCall=this.entity.delayedCall(.5,this.boundLeft,this)):(this.animController.play("left-to-right",1,!1),this.delayedCall=this.entity.delayedCall(.5,this.boundRight,this)))},OpponentDisplay.prototype.playLeft=function(){!1!==this.isStable&&this.animController.play("left",1,!0)},OpponentDisplay.prototype.playRight=function(){!1!==this.isStable&&this.animController.play("right",1,!0)},OpponentDisplay.prototype.update=function(t){if(!1===this.opponenentScript.infront)this.selected.enabled=!1;else{this.selected.enabled=!0;var e=this.camera.getRotation(),i=this.entity.parent.getRotation();e.slerp(e,i,.9),this.entity.setRotation(e)}},OpponentDisplay.prototype.setCharacter=function(t){this.characterSelection=t,this.selected=0===this.characterSelection?this.grizzy:this.lemmings,this.grizzy.enabled=!1,this.lemmings.enabled=!1,this.selected.enabled=!0,this.animController=new AnimationController(this.selected),this.selected.spine.state.defaultMix=.25,this.animController.play("loop",1,!0,1),this.resumeNormalDriving()};var InGameHud=pc.createScript("inGameHud");InGameHud.attributes.add("playerEntity",{type:"entity",title:"playerEntity"}),InGameHud.attributes.add("obstacleManagerEntity",{type:"entity",title:"obstacleManagerEntity"}),InGameHud.attributes.add("jarsDisp",{type:"entity",title:"jarsDisp"}),InGameHud.attributes.add("positionText",{type:"entity",title:"positionText"}),InGameHud.attributes.add("distToVan",{type:"entity",title:"distToVan"}),InGameHud.attributes.add("distToVanText",{type:"entity",title:"distToVanText"}),InGameHud.attributes.add("lemmingsMirror",{type:"entity",title:"lemmingsMirror"}),InGameHud.attributes.add("grizzyMirror",{type:"entity",title:"grizzyMirror"}),InGameHud.attributes.add("pauseBtn",{type:"entity",title:"pauseBtn"}),InGameHud.attributes.add("pauseScreenEntity",{type:"entity",title:"pauseScreenEntity"}),InGameHud.attributes.add("vanIcon",{type:"entity",title:"vanIcon"}),InGameHud.attributes.add("tapeIcon",{type:"entity",title:"tapeIcon"}),InGameHud.attributes.add("onboarding",{type:"entity",title:"onboarding"}),InGameHud.attributes.add("arrowsDisplay",{type:"entity",title:"arrowsDisplay"}),InGameHud.prototype.initialize=function(){this.jars=[],this.visibleJars=0;for(var t=1;t<7;)this.jars.push(this.entity.findByName("Jar"+t)),t++;"Grizzy"==this.app.userData.characterSelected?(this.grizzyMirror.enabled=!0,this.lemmingsMirror.enabled=!1,this.mirror=this.grizzyMirror):(this.grizzyMirror.enabled=!1,this.lemmingsMirror.enabled=!0,this.mirror=this.lemmingsMirror),this.happyChar=this.mirror.findByName("happy"),this.scaredChar=this.mirror.findByName("scared"),this.neutralChar=this.mirror.findByName("neutral"),this.player=this.playerEntity.script.get("player"),this.obstacleManager=this.obstacleManagerEntity.script.get("obstacleManager"),this.movementIndicator=this.arrowsDisplay.script.get("movementIndicator"),this.updateVals(),this.displayDistNum=0,this.pauseScreen=this.pauseScreenEntity.script.get("pauseScreen"),this.app.buttonManager.initButton(this.pauseBtn,this.showPause,this),4==this.app.transData.selectedLevel?(this.tapeIcon.enabled=!0,this.vanIcon.enabled=!1):(this.tapeIcon.enabled=!1,this.vanIcon.enabled=!0),1===this.app.transData.selectedLevel&&this.entity.delayedCall(2,this.showOnboarding1,this),2===this.app.transData.selectedLevel&&this.entity.delayedCall(2,this.showOnboarding2,this)},InGameHud.prototype.showOnboarding1=function(){this.app.systemPaused+=1,this.onboarding.on("complete",this.resumeGame,this),this.onboarding.script.get("onboarding").show1()},InGameHud.prototype.showOnboarding2=function(){this.app.systemPaused+=1,this.onboarding.on("complete",this.resumeGame,this),this.onboarding.script.get("onboarding").show2()},InGameHud.prototype.resumeGame=function(){this.app.systemPaused-=1},InGameHud.prototype.showPause=function(){this.pauseScreen.show()},InGameHud.prototype.update=function(t){this.updateVals(t)},InGameHud.prototype.updateVals=function(t){if(this.visibleJars!=this.app.transData.tempRaceData.jars%6){this.visibleJars=this.app.transData.tempRaceData.jars%6;for(var e=0;e<this.jars.length;e++)this.jars[e].script.get("hudJarElement").showCollected(e<this.visibleJars)}if(this.jarsDisp.element.text=this.app.transData.tempRaceData.jars.toString(),this.positionText.element.text=this.app.transData.tempRaceData.highestPosition.toString(),this.player.unstable||this.player.hitTruck?(this.neutralChar.enabled=!1,this.happyChar.enabled=!1,this.scaredChar.enabled=!0):(this.player.isBoosting||this.player.hasCollected?(this.happyChar.enabled=!0,this.neutralChar.enabled=!1):(this.happyChar.enabled=!1,this.neutralChar.enabled=!0),this.scaredChar.enabled=!1),this.player&&this.player.pathFollowerInst)if(4!=this.app.transData.selectedLevel){var a="- m";this.obstacleManager.targetTruck?a=Math.round(this.obstacleManager.targetTruck.entity.getPosition().clone().sub(this.player.entity.getPosition().clone()).length())-10:isNaN(this.obstacleManager.distToLastTruckSpawn)||(a=Math.round(this.obstacleManager.distToLastTruckSpawn-this.player.pathFollowerInst.totalDistTravelled)+100),this.displayDistNum+=(a-this.displayDistNum)*(5*t),this.displayDistNum=Math.abs(this.displayDistNum),!0===this.app.eol&&(this.displayDistNum=0),this.distToVanText.element.text=Math.round(this.displayDistNum)+"m"}else this.distToVanText.element.text=Math.round(this.player.pathFollowerInst.totalDistTravelled)+"m"};var HudJarElement=pc.createScript("hudJarElement");HudJarElement.prototype.initialize=function(){this.collected=this.entity.findByName("Collected"),this.notCollected=this.entity.findByName("NotCollected")},HudJarElement.prototype.showCollected=function(e){e?(this.collected.enabled=!0,this.notCollected.enabled=!1):(this.collected.enabled=!1,this.notCollected.enabled=!0)},HudJarElement.prototype.update=function(e){};var GameOver=pc.createScript("gameOver");GameOver.attributes.add("bg",{type:"entity",title:"bg"}),GameOver.attributes.add("header",{type:"entity",title:"header"}),GameOver.attributes.add("heroCharacter",{type:"entity",title:"heroCharacter"}),GameOver.attributes.add("heroHolder",{type:"entity",title:"heroHolder"}),GameOver.attributes.add("heroGrizzy",{type:"entity",title:"heroGrizzy"}),GameOver.attributes.add("heroLemmings",{type:"entity",title:"heroLemmings"}),GameOver.attributes.add("headerText",{type:"entity",title:"headerText"}),GameOver.attributes.add("levelSelectBtn",{type:"entity",title:"levelSelectBtn"}),GameOver.attributes.add("replayBtn",{type:"entity",title:"replayBtn"}),GameOver.attributes.add("continueBtn",{type:"entity",title:"continueBtn"}),GameOver.prototype.initialize=function(){this.app.uiUtils.quality="auto";var t=this.app.transData.tempRaceData;this.level=t.levelNumber,this.app.gSoundManager.playSound("oops"),this.app.uiUtils.bounceIn(this.header,.2),this.app.uiUtils.bounceIn(this.heroHolder,.3),this.app.uiUtils.bounceIn(this.replayBtn,.4),this.app.uiUtils.bounceIn(this.levelSelectBtn,.5),this.app.uiUtils.bounceIn(this.continueBtn,.6),this.app.buttonManager.initButton(this.replayBtn,this.replayLevel,this),this.app.buttonManager.initButton(this.continueBtn,this.continuePressed,this),this.app.buttonManager.initButton(this.levelSelectBtn,this.gotoLevelSelect,this),this.app.uiUtils.addToParallax(this.header,.005),this.app.uiUtils.addToParallax(this.bg,-.03,!0),this.app.uiUtils.addToParallax(this.heroCharacter,.01,!0),this.app.uiUtils.addToParallax(this.replayBtn,.02),this.app.uiUtils.addToParallax(this.continueBtn,.02),this.app.uiUtils.addToParallax(this.levelSelectBtn,.02),"Grizzy"===this.app.userData.characterSelected?(this.heroGrizzy.enabled=!0,this.heroLemmings.enabled=!1):(this.heroGrizzy.enabled=!1,this.heroLemmings.enabled=!0)},GameOver.prototype.disableButtons=function(){this.app.buttonManager.disposeBtn(this.replayBtn),this.app.buttonManager.disposeBtn(this.continueBtn),this.app.buttonManager.disposeBtn(this.levelSelectBtn)},GameOver.prototype.replayLevel=function(){this.disableButtons(),this.app.uiUtils.animPageOut(this.gotoRace,this)},GameOver.prototype.gotoRace=function(){this.app.transData.selectedLevel=this.level,this.app.nav.gotoPage("RaceLoader")},GameOver.prototype.continuePressed=function(){this.disableButtons(),this.app.uiUtils.animPageOut(this.gotoCharacterSelect,this)},GameOver.prototype.gotoCharacterSelect=function(){this.app.nav.gotoPage("CharacterSelect")},GameOver.prototype.gotoLevelSelect=function(){this.disableButtons(),this.app.uiUtils.animPageOut(this.gotoLevelSelectCB,this)},GameOver.prototype.gotoLevelSelectCB=function(){this.app.nav.gotoPage("LevelSelect")},GameOver.prototype.update=function(t){};var SoundManager=pc.createScript("soundManager");SoundManager.prototype.initialize=function(){if(this.app.gSoundManager)return console.log(this.app.gSoundManager),void this.entity.destroy();this.app.gSoundManager=this,this.stingPlaying=!1,this.musicPlaying=!1,this.isMuted=!1},SoundManager.prototype.update=function(t){},SoundManager.prototype.toggleMute=function(){0!==this.app.systems.sound.volume?(this.app.systems.sound.volume=0,this.isMuted=!0):(this.app.systems.sound.volume=1,this.isMuted=!1)},SoundManager.prototype.playSound=function(t,i){this.entity&&this.entity.sound&&this.entity.sound.slot(t)&&this.entity.sound.play(t)},SoundManager.prototype.playMusic=function(t){(this.currentMusic&&this.stingPlaying||this.currentMusic!=t)&&(this.musicPlaying=!1,this.entity.sound.stop(this.currentMusic)),this.currentMusic=t,!1===this.stingPlaying&&(this.currentMusic===t&&!0===this.musicPlaying||(this.musicPlaying=!0,this.entity.sound.play(t),this.entity.sound.slot(t).loop=!0))},SoundManager.prototype.playSting=function(){console.log("playSting"),this.currentMusic&&this.entity.sound.stop(this.currentMusic),!1===this.stingPlaying&&(this.entity.sound.play("sting"),this.entity.sound.slot("sting").loop=!1,this.stingPlaying=!0,this.stingDelayedCall&&this.stingDelayedCall.kill(),this.stingDelayedCall=this.entity.delayedCall(3.5,this.playCuedMusic,this))},SoundManager.prototype.playCuedMusic=function(){console.log("play cued music"),this.stingPlaying=!1,this.playMusic(this.currentMusic)};var EolScreen=pc.createScript("eolScreen");EolScreen.attributes.add("position",{type:"entity",title:"position"}),EolScreen.attributes.add("position1",{type:"entity",title:"position1"}),EolScreen.attributes.add("position2",{type:"entity",title:"position2"}),EolScreen.attributes.add("character",{type:"entity",title:"character"}),EolScreen.attributes.add("characterGrizzy",{type:"entity",title:"characterGrizzy"}),EolScreen.attributes.add("characterLemmings",{type:"entity",title:"characterLemmings"}),EolScreen.prototype.initialize=function(){this.position.enabled=!1,this.character.enabled=!1},EolScreen.prototype.show=function(t,e){"Grizzy"==t?(this.characterGrizzy.enabled=!0,this.characterLemmings.enabled=!1):(this.characterGrizzy.enabled=!1,this.characterLemmings.enabled=!0),this.character.enabled=!0,1==e?(this.position1.enabled=!0,this.position2.enabled=!1):(this.position1.enabled=!1,this.position2.enabled=!0),this.position.enabled=!0;var i=this.position.getLocalPosition().clone();this.character.getLocalPosition().clone();console.log(i),this.position.setLocalPosition(new pc.Vec3(2e3,0,0)),this.character.setLocalScale(new pc.Vec3(0,0,0)),this.position.tween(this.position.getLocalPosition()).to(i,1,pc.ElasticOut).start(),this.character.tween(this.character.getLocalScale()).toFrom(new pc.Vec3(1,1,1),new pc.Vec3(.6,.6,.6),1.2,pc.ElasticOut).delay(.2).start()},EolScreen.prototype.update=function(t){};var PauseScreen=pc.createScript("pauseScreen");PauseScreen.attributes.add("screenGroup",{type:"entity",title:"screenGroup"}),PauseScreen.attributes.add("bg",{type:"entity",title:"bg"}),PauseScreen.attributes.add("header",{type:"entity",title:"header"}),PauseScreen.attributes.add("levelSelectBtn",{type:"entity",title:"levelSelectBtn"}),PauseScreen.attributes.add("restartBtn",{type:"entity",title:"restartBtn"}),PauseScreen.attributes.add("continueBtn",{type:"entity",title:"continueBtn"}),PauseScreen.attributes.add("muteBtn",{type:"entity",title:"muteBtn"}),PauseScreen.attributes.add("homeBtn",{type:"entity",title:"homeBtn"}),PauseScreen.prototype.initialize=function(){this.screenGroup.enabled=!1},PauseScreen.prototype.levelSelectPressed=function(){this.hide(),this.app.nav.gotoPage("LevelSelect")},PauseScreen.prototype.restartPressed=function(){this.hide(),this.app.nav.gotoPage("RaceLoader")},PauseScreen.prototype.continuePressed=function(){this.app.userPaused=!1,this.hide()},PauseScreen.prototype.homePressed=function(){this.app.userPaused=!1,this.hide(),this.app.nav.gotoPage("TitleScreen")},PauseScreen.prototype.helpPressed=function(){},PauseScreen.prototype.update=function(t){},PauseScreen.prototype.show=function(){this.app.userPaused=!0,this.screenGroup.enabled=!0,this.app.buttonManager.initButton(this.homeBtn,this.homePressed,this),this.app.buttonManager.initButton(this.levelSelectBtn,this.levelSelectPressed,this),this.app.buttonManager.initButton(this.restartBtn,this.restartPressed,this),this.app.buttonManager.initButton(this.continueBtn,this.continuePressed,this),this.app.uiUtils.bounceIn(this.header,.1),this.app.uiUtils.bounceIn(this.homeBtn,.05),this.app.uiUtils.bounceIn(this.muteBtn,.15),this.app.uiUtils.bounceIn(this.levelSelectBtn,.2),this.app.uiUtils.bounceIn(this.restartBtn,.3),this.app.uiUtils.bounceIn(this.continueBtn,.4),this.app.uiUtils.addToParallax(this.bg,-.03,!0),this.app.uiUtils.addToParallax(this.header,-.01),this.app.uiUtils.addToParallax(this.levelSelectBtn,-.01),this.app.uiUtils.addToParallax(this.restartBtn,-.01),this.app.uiUtils.addToParallax(this.continueBtn,-.01)},PauseScreen.prototype.hide=function(){this.app.userPaused=!1,this.app.buttonManager.disposeBtn(this.homeBtn),this.app.buttonManager.disposeBtn(this.levelSelectBtn),this.app.buttonManager.disposeBtn(this.restartBtn),this.app.buttonManager.disposeBtn(this.continueBtn),this.app.uiUtils.clearPage(),this.screenGroup.enabled=!1};var AppLoader=pc.createScript("appLoader");AppLoader.attributes.add("en-gb",{type:"asset"}),AppLoader.attributes.add("ar-sa",{type:"asset"}),AppLoader.attributes.add("de-de",{type:"asset"}),AppLoader.attributes.add("es-mx",{type:"asset"}),AppLoader.attributes.add("ru-ru",{type:"asset"}),AppLoader.attributes.add("ro-ro",{type:"asset"}),AppLoader.attributes.add("it-it",{type:"asset"}),AppLoader.attributes.add("nl-nl",{type:"asset"}),AppLoader.attributes.add("pl-pl",{type:"asset"}),AppLoader.attributes.add("da-dk",{type:"asset"}),AppLoader.attributes.add("fr-fr",{type:"asset"}),AppLoader.attributes.add("hu-hu",{type:"asset"}),AppLoader.attributes.add("tr-tr",{type:"asset"}),AppLoader.attributes.add("pt-br",{type:"asset"}),AppLoader.attributes.add("no-no",{type:"asset"}),AppLoader.attributes.add("pt-pt",{type:"asset"}),AppLoader.attributes.add("sv-se",{type:"asset"}),AppLoader.attributes.add("mask",{type:"entity",title:"mask"}),AppLoader.attributes.add("fillBar",{type:"entity",title:"fillBar"}),AppLoader.prototype.initialize=function(){var t=this.goToTitleScreen.bind(this),a=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||"en",e=new URLSearchParams(window.location.search);LANG&&(a=LANG),e.get("lang")&&(a=e.get("lang")),this.app.i18n.locale=a;var s=this.updateProgress.bind(this);this.app.systemPaused=0;var p=this.app.assets.findByTag("ui").concat(this.app.assets.findByTag("game")).concat(this.app.assets.findByTag("sounds")),r=this.app.i18n.locale;r=r.toLowerCase(),p.push(this[r]);for(var d=[],i=0,o=0;o<p.length;o++)p[o].ready((function(a){i++,-1!=d.indexOf(a)&&d.splice(d.indexOf(a),1),s(i/p.length),console.log("finished loading",a.name,d,i,p.length),i===p.length&&(console.log("all loaded"),t())}),this),console.log("loading",p[o].name),d.push(p[o]),this.app.assets.load(p[o])},AppLoader.prototype.updateProgress=function(t){this.mask.element.width=t*this.fillBar.element.width},AppLoader.prototype.goToTitleScreen=function(){this.app.nav.gotoPage("TitleScreen")};var MuteButtons=pc.createScript("muteButtons");MuteButtons.attributes.add("muteOnBtn",{type:"entity",title:"muteOnBtn"}),MuteButtons.attributes.add("muteOffBtn",{type:"entity",title:"muteOffBtn"}),MuteButtons.prototype.initialize=function(){this.app.buttonManager.initButton(this.muteOnBtn,this.toggleMute,this),this.app.buttonManager.initButton(this.muteOffBtn,this.toggleMute,this),this.on("destroy",this.dispose,this),this.updateMuteState()},MuteButtons.prototype.update=function(t){},MuteButtons.prototype.dispose=function(){this.app.buttonManager.disposeBtn(this.muteOnBtn),this.app.buttonManager.disposeBtn(this.muteOffBtn)},MuteButtons.prototype.toggleMute=function(){this.app.gSoundManager.toggleMute(),this.updateMuteState()},MuteButtons.prototype.updateMuteState=function(){this.app.gSoundManager.isMuted?(this.muteOnBtn.enabled=!0,this.muteOffBtn.enabled=!1):(this.muteOnBtn.enabled=!1,this.muteOffBtn.enabled=!0)};var Indicator=pc.createScript("indicator");Indicator.prototype.initialize=function(){this.entity.sprite.enabled=!1,this.isOn=!1,this.lightOn=!1,this.dc=null},Indicator.prototype.turnOn=function(){this.dc&&this.dc.kill(),this.switchLightOn()},Indicator.prototype.turnOff=function(){this.entity.sprite.enabled=!1,this.dc&&this.dc.kill()},Indicator.prototype.switchLightOn=function(){this.entity.sprite.enabled=!0,this.dc=this.entity.delayedCall(.35,this.switchLightOff,this)},Indicator.prototype.switchLightOff=function(){this.entity.sprite.enabled=!1,this.dc=this.entity.delayedCall(.35,this.switchLightOn,this)},Indicator.prototype.update=function(t){};var RotateScreen=pc.createScript("rotateScreen");RotateScreen.attributes.add("rotateScreenGroup",{type:"entity",title:"rotateScreenGroup"}),RotateScreen.prototype.initialize=function(){this.rotateScreenGroup.enabled=!1;for(var e=this.entity;!e.screen&&e!=this.app.root;)e=e.parent;e.screen&&(this.screenRef=e)},RotateScreen.prototype.update=function(e){this.app.graphicsDevice.width<this.app.graphicsDevice.height?!1===this.rotateScreenGroup.enabled&&(this.rotateScreenGroup.enabled=!0,this.screenRef&&(this.screenRef.screen.scaleBlend=0),this.app.systemPaused+=1):!0===this.rotateScreenGroup.enabled&&(this.rotateScreenGroup.enabled=!1,this.screenRef&&(this.screenRef.screen.scaleBlend=1),this.app.systemPaused-=1)};var BackButton=pc.createScript("backButton");BackButton.attributes.add("btn",{type:"entity",title:"btn"}),BackButton.attributes.add("targetPage",{type:"string",title:"targetPage"}),BackButton.prototype.initialize=function(){this.app.buttonManager.initButton(this.btn,this.goBack,this)},BackButton.prototype.goBack=function(){this.app.nav.gotoPage(this.targetPage)},BackButton.prototype.update=function(t){};var NewGame=pc.createScript("newGame");NewGame.attributes.add("bg",{type:"entity",title:"bg"}),NewGame.attributes.add("header",{type:"entity",title:"header"}),NewGame.attributes.add("panel",{type:"entity",title:"panel"}),NewGame.attributes.add("noBtn",{type:"entity",title:"noBtn"}),NewGame.attributes.add("yesBtn",{type:"entity",title:"yesBtn"}),NewGame.prototype.initialize=function(){this.app.uiUtils.bounceIn(this.header,.2),this.app.uiUtils.bounceIn(this.panel,.3),this.app.uiUtils.bounceIn(this.yesBtn,.4),this.app.uiUtils.bounceIn(this.noBtn,.5),this.app.buttonManager.initButton(this.yesBtn,this.yesClicked,this),this.app.buttonManager.initButton(this.noBtn,this.noClicked,this),this.app.uiUtils.addToParallax(this.bg,-.05,!0),this.app.uiUtils.addToParallax(this.panel,.01,!0),this.app.uiUtils.addToParallax(this.header,.02,!0),this.app.uiUtils.addToParallax(this.yesBtn,.02,!0),this.app.uiUtils.addToParallax(this.noBtn,.02,!0)},NewGame.prototype.update=function(t){},NewGame.prototype.yesClicked=function(){this.app.userData.reset(),this.app.buttonManager.disposeBtn(this.yesBtn),this.app.buttonManager.disposeBtn(this.noBtn),this.app.uiUtils.animPageOut(this.gotoLevelSelectScreen,this)},NewGame.prototype.noClicked=function(){this.app.buttonManager.disposeBtn(this.yesBtn),this.app.buttonManager.disposeBtn(this.noBtn),this.app.uiUtils.animPageOut(this.gotoTitleScreen,this)},NewGame.prototype.gotoTitleScreen=function(){this.app.nav.gotoPage("TitleScreen")},NewGame.prototype.gotoLevelSelectScreen=function(){this.app.nav.gotoPage("LevelSelect")};var MovementIndicator=pc.createScript("movementIndicator");MovementIndicator.attributes.add("jumpArrow",{type:"entity",title:"jumpArrow"}),MovementIndicator.attributes.add("leftArrow",{type:"entity",title:"leftArrow"}),MovementIndicator.attributes.add("rightArrow",{type:"entity",title:"rightArrow"}),MovementIndicator.prototype.initialize=function(){this.hideRightCall=null,this.hideLeftCall=null,this.jumpShowing=!1,this.rightShowing=!1,this.leftShowing=!1,this.hideArrow(this.leftArrow),this.hideArrow(this.rightArrow),this.hideArrow(this.jumpArrow),this.inTweens=[],this.outTweens=[]},MovementIndicator.prototype.update=function(t){},MovementIndicator.prototype.showChangeLanes=function(t){"left"===t&&(this.hideLeftCall&&this.hideLeftCall.kill(),this.leftShowing=!0,this.leftArrow.enabled=!0,this.showArrowExpand(this.leftArrow),this.hideRight(),this.hideLeftCall=this.entity.delayedCall(.5,this.hideLeft,this)),"right"===t&&(this.hideRightCall&&this.hideRightCall.kill(),this.rightShowing=!0,this.rightArrow.enabled=!0,this.showArrowExpand(this.rightArrow),this.hideLeft(),this.hideRightCall=this.entity.delayedCall(.5,this.hideRight,this))},MovementIndicator.prototype.showJump=function(t){!1===this.jumpShowing&&(this.jumpArrow.enabled=!0,this.jumpShowing=!0,this.showArrowExpand(this.jumpArrow))},MovementIndicator.prototype.showArrowExpand=function(t,i){var e=.2;i&&(e=.5),t.setLocalScale(new pc.Vec3(1,.3,1)),t.element.opacity=0,t.tween(t.getLocalScale()).to(new pc.Vec3(1,1,1),e,pc.CircularOut).start(),t.tween(t.element).to({opacity:.8},e,pc.CircularOut).start()},MovementIndicator.prototype.hideLeft=function(t){this.leftShowing&&(this.leftShowing=!1,this.hideArrow(this.leftArrow))},MovementIndicator.prototype.hideRight=function(t){this.rightShowing&&(this.rightShowing=!1,this.hideArrow(this.rightArrow))},MovementIndicator.prototype.hideJump=function(t){this.jumpShowing&&(this.jumpShowing=!1,this.hideArrow(this.jumpArrow))},MovementIndicator.prototype.hideArrow=function(t){t.tween(t.getLocalScale()).to(new pc.Vec3(.2,.2,.2),.2,pc.BackIn).start(),t.tween(t.element).to({opacity:0},.2,pc.CircularOut).on("complete",(()=>{t.enabled=!1})).start()};var Rotatey=pc.createScript("rotatey");Rotatey.prototype.initialize=function(){},Rotatey.prototype.update=function(t){};var Onboarding=pc.createScript("onboarding");Onboarding.attributes.add("characterHolder",{type:"entity",title:"characterHolder"}),Onboarding.attributes.add("grizzy",{type:"entity",title:"grizzy"}),Onboarding.attributes.add("lemmings",{type:"entity",title:"lemmings"}),Onboarding.attributes.add("touchHand",{type:"entity",title:"touchHand"}),Onboarding.attributes.add("keyboardIndicator",{type:"entity",title:"keyboardIndicator"}),Onboarding.attributes.add("indicatorHolder",{type:"entity",title:"indicatorHolder"}),Onboarding.attributes.add("tapIndicator",{type:"entity",title:"tapIndicator"}),Onboarding.attributes.add("holdIndicator",{type:"entity",title:"holdIndicator"}),Onboarding.attributes.add("onboardingHolder",{type:"entity",title:"onboardingHolder"}),Onboarding.prototype.initialize=function(){this.app.touch?(this.handHolder=this.touchHand,this.keyboardIndicator.enabled=!1):(this.handHolder=this.keyboardIndicator,this.touchHand.enabled=!1),this.handUp=this.handHolder.findByName("up"),this.handDown=this.handHolder.findByName("down"),this.hide()},Onboarding.prototype.update=function(t){},Onboarding.prototype.hide=function(){this.hideAll(),this.onboardingHolder.enabled=!1,this.entity.fire("complete")},Onboarding.prototype.show1=function(){this.hideAll(),this.onboardingHolder.enabled=!0,this.characterHolder.enabled=!0,this.handHolder.enabled=!0,this.indicatorHolder.enabled=!0,"Grizzy"===this.app.userData.characterSelected?(this.grizzy.enabled=!0,this.lemmings.enabled=!1):(this.lemmings.enabled=!0,this.grizzy.enabled=!1),this.characterHolder.setLocalPosition(300,-200,0),this.handHolder.setLocalPosition(new pc.Vec3(600,-800,0)),this.cursorMove(new pc.Vec3(500,0,0)),this.entity.delayedCall(1,this.clickMove,this),this.entity.delayedCall(2,this.clickMove,this),this.entity.delayedCall(3,this.clickMove,this),this.entity.delayedCall(4,(()=>{this.cursorMove(new pc.Vec3(600,-800,0))})),this.entity.delayedCall(5,this.hide,this)},Onboarding.prototype.clickMove=function(){this.cursorDown(),this.showTap(),this.moveCharacter()},Onboarding.prototype.clickJump=function(){this.cursorDown(),this.showHold().on("complete",this.jumpCharacter,this)},Onboarding.prototype.hideAll=function(){this.characterHolder.enabled=!1,this.grizzy.enabled=!1,this.lemmings.enabled=!1,this.handHolder.enabled=!1,this.handDown.enabled=!1,this.handUp.enabled=!1,this.indicatorHolder.enabled=!1,this.tapIndicator.enabled=!1,this.holdIndicator.enabled=!1},Onboarding.prototype.show2=function(){this.hideAll(),this.onboardingHolder.enabled=!0,this.characterHolder.enabled=!0,this.handHolder.enabled=!0,this.indicatorHolder.enabled=!0,"Grizzy"===this.app.userData.characterSelected?(this.grizzy.enabled=!0,this.lemmings.enabled=!1):(this.lemmings.enabled=!0,this.grizzy.enabled=!1),this.characterHolder.setLocalPosition(300,-200,0),this.handHolder.setLocalPosition(new pc.Vec3(600,-800,0)),this.cursorMove(new pc.Vec3(500,0,0)),this.entity.delayedCall(1,this.clickJump,this),this.entity.delayedCall(3,this.clickJump,this),this.entity.delayedCall(5,this.clickJump,this),this.entity.delayedCall(7,(()=>{this.cursorMove(new pc.Vec3(600,-800,0))})),this.entity.delayedCall(8,this.hide,this)},Onboarding.prototype.moveCharacter=function(){var t=this.characterHolder.getLocalPosition().clone();t.x*=-1,this.characterHolder.tween(this.characterHolder.getLocalPosition()).to(t,.5,pc.ExpoInOut).start()},Onboarding.prototype.jumpCharacter=function(){var t=this.characterHolder.getLocalPosition().clone(),e=this.characterHolder.getLocalPosition().clone();e.y+=200,this.characterHolder.tween(this.characterHolder.getLocalPosition()).to(e,.5,pc.QuarticOut).start().on("complete",(()=>{this.characterHolder.tween(this.characterHolder.getLocalPosition()).to(t,.5,pc.QuarticIn).start()}))},Onboarding.prototype.cursorMove=function(t){this.handUp.enabled=!0;var e=this.app.touch?.5:.01,i=this.handHolder.tween(this.handHolder.getLocalPosition()).to(t,e,pc.QuartInOut);return i.start(),i},Onboarding.prototype.cursorDown=function(t){this.handDown.enabled=!0,this.handUp.enabled=!1},Onboarding.prototype.cursorUp=function(t){this.handDown.enabled=!1,this.handUp.enabled=!0,this.tapIndicator.enabled=!1,this.holdIndicator.enabled=!1},Onboarding.prototype.showTap=function(t){this.cursorDown(),this.indicatorHolder.setLocalPosition(this.handHolder.getLocalPosition()),this.app.touch&&(this.tapIndicator.enabled=!0,this.holdIndicator.enabled=!1),this.entity.delayedCall(.2,this.cursorUp,this)},Onboarding.prototype.showHold=function(t){return this.cursorDown(),this.indicatorHolder.setLocalPosition(this.handHolder.getLocalPosition()),this.app.touch&&(this.tapIndicator.enabled=!1,this.holdIndicator.enabled=!0),this.holdIndicator.setLocalScale(new pc.Vec3(.5,.5,.5)),this.holdIndicator.tween(this.holdIndicator.getLocalScale()).toFrom(new pc.Vec3(1,1,1),new pc.Vec3(.5,.5,.5),1).start().on("complete",(()=>{this.cursorUp()}))};pc.script.createLoadingScreen((function(n){n.on("preload:start",(function(){})),n.on("preload:end",(function(){})),n.on("start",(function(){}))}));var StarsDisplay=pc.createScript("starsDisplay");StarsDisplay.attributes.add("star1",{type:"entity",title:"star1"}),StarsDisplay.attributes.add("star2",{type:"entity",title:"star2"}),StarsDisplay.attributes.add("star3",{type:"entity",title:"star3"}),StarsDisplay.prototype.initialize=function(){},StarsDisplay.prototype.showStars=function(t,a){for(var i=0;i<3;){var s=this["star"+ ++i].findByName("lit"),e=this["star"+i].findByName("unlit");i<=t?(s.enabled=!0,e.enabled=!1,a&&this.app.uiUtils.bounceIn(s,1+i/3)):(s.enabled=!1,e.enabled=!0,a&&this.app.uiUtils.bounceIn(e,1+i/3))}};var ResultsScreen=pc.createScript("resultsScreen");ResultsScreen.attributes.add("bg",{type:"entity",title:"bg"}),ResultsScreen.attributes.add("header",{type:"entity",title:"header"}),ResultsScreen.attributes.add("heroCharacter",{type:"entity",title:"heroCharacter"}),ResultsScreen.attributes.add("heroGroup",{type:"entity",title:"heroGroup"}),ResultsScreen.attributes.add("heroGrizzy",{type:"entity",title:"heroGrizzy"}),ResultsScreen.attributes.add("heroLemmings",{type:"entity",title:"heroLemmings"}),ResultsScreen.attributes.add("resultsPanelStd",{type:"entity",title:"resultsPanelStd"}),ResultsScreen.attributes.add("resultsPanelEndless",{type:"entity",title:"resultsPanelEndless"}),ResultsScreen.attributes.add("starRating",{type:"entity",title:"starRating"}),ResultsScreen.attributes.add("positionText",{type:"entity",title:"positionText"}),ResultsScreen.attributes.add("timeText",{type:"entity",title:"timeText"}),ResultsScreen.attributes.add("yummyTextStd",{type:"entity",title:"yummyTextStd"}),ResultsScreen.attributes.add("boostTextStd",{type:"entity",title:"boostTextStd"}),ResultsScreen.attributes.add("distanceText",{type:"entity",title:"distanceText"}),ResultsScreen.attributes.add("yummyTextEndless",{type:"entity",title:"yummyTextEndless"}),ResultsScreen.attributes.add("boostTextEndless",{type:"entity",title:"boostTextEndless"}),ResultsScreen.attributes.add("headerText",{type:"entity",title:"headerText"}),ResultsScreen.attributes.add("levelSelectBtn",{type:"entity",title:"levelSelectBtn"}),ResultsScreen.attributes.add("replayBtn",{type:"entity",title:"replayBtn"}),ResultsScreen.attributes.add("continueBtn",{type:"entity",title:"continueBtn"}),ResultsScreen.prototype.initialize=function(){this.app.gSoundManager.playMusic("music_results"),this.app.gSoundManager.playSound("resultscheer"),this.app.uiUtils.quality="auto";var t=this.app.transData.tempRaceData;this.level=t.levelNumber;var e=this.app.userData.levelComplete(t.levelNumber,t.highestPosition,t.fastestTime,t.jars,t.boosts,t.furthestDistance),s=this.app.userData.getStars(this.app.userData.getLevelData(this.level));this.entity.delayedCall(1.3,this.playStars,this),this.starRating.script.get("starsDisplay").showStars(s,!0),"Grizzy"===this.app.userData.characterSelected?(this.heroGrizzy.enabled=!0,this.heroLemmings.enabled=!1):(this.heroGrizzy.enabled=!1,this.heroLemmings.enabled=!0),4===this.level?(this.resultsPanelStd.enabled=!1,this.resultsPanelEndless.enabled=!0,this.distanceText.element.text=t.furthestDistance.toString(),this.distanceText.findByName("Image").enabled=e.furthestDistance,this.yummyTextEndless.element.text=t.jars.toString(),this.yummyTextStd.findByName("Image").enabled=e.jars,this.boostTextEndless.element.text=t.boosts.toString(),this.boostTextStd.findByName("Image").enabled=e.boosts,this.continueBtn.enabled=!1):(this.resultsPanelStd.enabled=!0,this.resultsPanelEndless.enabled=!1,this.continueBtn.enabled=!0,this.positionText.element.text=t.highestPosition.toString(),this.positionText.findByName("Image").enabled=e.highestPosition,this.timeText.element.text=t.fastestTime.toString(),this.timeText.findByName("Image").enabled=e.fastestTime,this.yummyTextStd.element.text=t.jars.toString(),this.yummyTextStd.findByName("Image").enabled=e.jars,this.boostTextStd.element.text=t.boosts.toString(),this.boostTextStd.findByName("Image").enabled=e.boosts),this.app.uiUtils.bounceIn(this.header,.2),this.app.uiUtils.bounceIn(this.heroGroup,.3),this.app.uiUtils.bounceIn(this.resultsPanelStd,.4),this.app.uiUtils.bounceIn(this.resultsPanelEndless,.4),this.app.uiUtils.bounceIn(this.starRating,.5),this.app.uiUtils.bounceIn(this.replayBtn,.6),this.app.uiUtils.bounceIn(this.continueBtn,.8),this.app.buttonManager.initButton(this.replayBtn,this.replayLevel,this),this.app.buttonManager.initButton(this.continueBtn,this.playNextLevel,this),this.app.uiUtils.addToParallax(this.header,.005),this.app.uiUtils.addToParallax(this.bg,-.03,!0),this.app.uiUtils.addToParallax(this.resultsPanelStd,-.02),this.app.uiUtils.addToParallax(this.resultsPanelEndless,-.02),this.app.uiUtils.addToParallax(this.heroCharacter,.01,!0),this.app.uiUtils.addToParallax(this.replayBtn,.02),this.app.uiUtils.addToParallax(this.continueBtn,.02),this.app.transData.tempRaceData=null},ResultsScreen.prototype.playStars=function(){var t=this.app.userData.getStars(this.app.userData.getLevelData(this.level));1===t&&this.app.gSoundManager.playSound("star1"),2===t&&this.app.gSoundManager.playSound("star2"),3===t&&this.app.gSoundManager.playSound("star3")},ResultsScreen.prototype.disableButtons=function(){this.app.buttonManager.disposeBtn(this.replayBtn),this.app.buttonManager.disposeBtn(this.continueBtn)},ResultsScreen.prototype.replayLevel=function(){this.disableButtons(),this.app.uiUtils.animPageOut(this.gotoRace,this)},ResultsScreen.prototype.gotoRace=function(){this.app.transData.selectedLevel=this.level,this.app.nav.gotoPage("RaceLoader")},ResultsScreen.prototype.playNextLevel=function(){this.disableButtons(),this.app.uiUtils.animPageOut(this.gotoNextRace,this)},ResultsScreen.prototype.gotoNextRace=function(){this.app.transData.selectedLevel=this.level+1,this.app.nav.gotoPage("LevelSelect")},ResultsScreen.prototype.gotoLevelSelect=function(){this.disableButtons(),this.app.uiUtils.animPageOut(this.gotoLevelSelectCB,this)},ResultsScreen.prototype.gotoLevelSelectCB=function(){this.app.nav.gotoPage("LevelSelect")},ResultsScreen.prototype.update=function(t){};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #1d292c;","}","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none"}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var LocalisedAsset=pc.createScript("localisedAsset");LocalisedAsset.attributes.add("en-gb",{type:"asset"}),LocalisedAsset.attributes.add("ar-sa",{type:"asset"}),LocalisedAsset.attributes.add("de-de",{type:"asset"}),LocalisedAsset.attributes.add("es-mx",{type:"asset"}),LocalisedAsset.attributes.add("ru-ru",{type:"asset"}),LocalisedAsset.attributes.add("ro-ro",{type:"asset"}),LocalisedAsset.attributes.add("it-it",{type:"asset"}),LocalisedAsset.attributes.add("nl-nl",{type:"asset"}),LocalisedAsset.attributes.add("pl-pl",{type:"asset"}),LocalisedAsset.attributes.add("da-dk",{type:"asset"}),LocalisedAsset.attributes.add("fr-fr",{type:"asset"}),LocalisedAsset.attributes.add("hu-hu",{type:"asset"}),LocalisedAsset.attributes.add("tr-tr",{type:"asset"}),LocalisedAsset.attributes.add("pt-br",{type:"asset"}),LocalisedAsset.attributes.add("no-no",{type:"asset"}),LocalisedAsset.attributes.add("pt-pt",{type:"asset"}),LocalisedAsset.attributes.add("sv-se",{type:"asset"}),LocalisedAsset.prototype.initialize=function(){var t=this.app.i18n.locale;t=t.toLowerCase(),this.entity.element.textureAsset=this[t]},LocalisedAsset.prototype.update=function(t){};var ContentScaler=pc.createScript("contentScaler");ContentScaler.attributes.add("nativeWidth",{type:"number",default:1024}),ContentScaler.attributes.add("nativeHeight",{type:"number",default:768}),ContentScaler.prototype.initialize=function(){},ContentScaler.prototype.update=function(t){var e=this.nativeWidth/this.nativeHeight,i=this.app.graphicsDevice.width/this.app.graphicsDevice.height;if(e>i){var a=i/e;this.entity.setLocalScale(new pc.Vec3(a,a,a))}else this.entity.setLocalScale(new pc.Vec3(1,1,1))};var ImageReplacement=pc.createScript("imageReplacement");ImageReplacement.attributes.add("play",{type:"asset"}),ImageReplacement.attributes.add("newGame",{type:"asset"}),ImageReplacement.attributes.add("continue",{type:"asset"}),ImageReplacement.attributes.add("loading",{type:"asset"}),ImageReplacement.attributes.add("areYouSureSavedNewGame",{type:"asset"}),ImageReplacement.attributes.add("areYouSureSavedData",{type:"asset"}),ImageReplacement.attributes.add("areYouSureLoseProgress",{type:"asset"}),ImageReplacement.attributes.add("levelSelect",{type:"asset"}),ImageReplacement.attributes.add("level1",{type:"asset"}),ImageReplacement.attributes.add("level2",{type:"asset"}),ImageReplacement.attributes.add("level3",{type:"asset"}),ImageReplacement.attributes.add("infiniteMode",{type:"asset"}),ImageReplacement.attributes.add("personalBests",{type:"asset"}),ImageReplacement.attributes.add("1st",{type:"asset"}),ImageReplacement.attributes.add("2nd",{type:"asset"}),ImageReplacement.attributes.add("characterSelect",{type:"asset"}),ImageReplacement.attributes.add("grizzy",{type:"asset"}),ImageReplacement.attributes.add("theLemmings",{type:"asset"}),ImageReplacement.attributes.add("results",{type:"asset"}),ImageReplacement.attributes.add("new",{type:"asset"}),ImageReplacement.attributes.add("oopsTryAgain",{type:"asset"}),ImageReplacement.attributes.add("paused",{type:"asset"}),ImageReplacement.attributes.add("distance",{type:"asset"}),ImageReplacement.prototype.initialize=function(){"ar-sa"==this.app.i18n.locale&&(this.app.imgReplacement=this)},ImageReplacement.prototype.update=function(e){};var TextImageReplacement=pc.createScript("textImageReplacement");TextImageReplacement.prototype.initialize=function(){if(this.app.imgReplacement){var e=this.entity.element.key;console.log(this.entity.element.type),this.entity.element.type=pc.ELEMENTTYPE_IMAGE,this.entity.element.textureAsset=this.app.imgReplacement[e],this.entity.element.enabled=!1,this.entity.element.enabled=!0,this.entity.setLocalScale(.7,.7,.7),console.log(e,this.app.imgReplacement[e])}},TextImageReplacement.prototype.update=function(e){};