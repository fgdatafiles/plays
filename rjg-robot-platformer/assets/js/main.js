var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),SceneLoader=function(_super){function SceneLoader(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.assetsToLoad=0,_this.assetsLoaded=0,_this.categoriesLoaded=0,_this.totalCategories=0,_this.loadAssets=function(loader,prefix,assets,loadedCallback){var id;_this.assetsToLoad+=assets.length,_this.totalCategories++,assets.forEach(function(asset){"string"==typeof asset?(id=asset.split("\\").pop().split("/").pop().split(".")[0],loader.add(id,prefix+asset)):asset.id&&asset.src?loader.add(asset.id,prefix+asset.src):(console.warn("Could not laod asset:"),console.warn(asset))}),loader.onProgress.add(_this.assetLoaded),loader.onComplete.add(loadedCallback),loader.load()},_this.imgLoaded=function(loader,resource){for(var key in resource)Textures.add(key,resource[key].texture);_this.categoryComplete()},_this.animLoaded=function(loader,resource){for(var key in resource)resource[key].spineData&&Animations.add(key,resource[key].spineData),null!=resource[key].children&&(_this.assetsToLoad+=resource[key].children.length);_this.categoryComplete()},_this.particleLoaded=function(loader,resource){for(var key in resource)Particles.add(key,resource[key].data);_this.categoryComplete()},_this.assetLoaded=function(){if(_this.progressCallback){_this.assetsLoaded++;var progress=_this.assetsLoaded/_this.assetsToLoad;_this.progressCallback(progress)}},_this.categoryComplete=function(){_this.completCallback&&(_this.categoriesLoaded++,_this.categoriesLoaded>=_this.totalCategories&&!_this.isLoaded&&(_this.isLoaded=!0,setTimeout(_this.completCallback,750)))},_this.reset=function(){for(var textureUrl in _this.isLoaded=!1,Textures.clear(),Animations.clear(),Particles.clear(),_this.imgLoader.reset(),_this.animLoader.reset(),_this.particleLoader.reset(),PIXI.utils.BaseTextureCache)PIXI.utils.BaseTextureCache[textureUrl].destroy(!0);for(var textureUrl in PIXI.utils.TextureCache)PIXI.utils.TextureCache[textureUrl].destroy(!0)},_this}return __extends(SceneLoader,_super),SceneLoader}(springroll.EventDispatcher),ResourceView=function(_super){function ResourceView(resource,texture){var _this=_super.call(this,texture)||this;return _this.sinTime=0,_this.update=function(){_this.sinTime+=app.time.delta/100;var s=(Math.sin(_this.sinTime)+1)/2;_this.scale.x=MathUtils.lerp(1.2,1,s),_this.scale.y=MathUtils.lerp(1,1.2,s);var s2=Math.max(0,Math.sin(_this.sinTime));_this.anchor.y=MathUtils.lerp(.35,.5,s2)},_this.enabledChanged=function(enabled,resource){_this.visible=enabled},_this.alphaChanged=function(alpha,resource){_this.alpha=alpha},_this.onCollected=function(){},_this.id=resource.id,_this.anchor.x=.5,_this.anchor.y=.5,_this.x=resource.x,_this.y=resource.y,_this.model=resource,_this}return __extends(ResourceView,_super),ResourceView.prototype.bindToModel=function(){this.model.enabledChanged.add(this.enabledChanged),this.model.alphaChanged.add(this.alphaChanged),this.model.dispatchInitialState(),app.on("update",this.update)},ResourceView.prototype.unbindFromModel=function(){this.model.alphaChanged.remove(this.alphaChanged),this.model.enabledChanged.remove(this.enabledChanged),app.on("update",this.update)},ResourceView}(PIXI.Sprite),HudBaseMenu=function(_super){function HudBaseMenu(menuType){var _this=_super.call(this)||this;return _this.glowOffset=new Point(7,10),_this.setupGlowAndHighlight=function(glowTexture){_this.btnGlow=new PIXI.Sprite(Textures.get(glowTexture)),_this.btnGlow.visible=!1,_this.btnGlow.anchor.x=_this.btnGlow.anchor.y=0,_this.addChild(_this.btnGlow);_this.btnHighlight=new PIXI.Sprite(Textures.get("hudHighlightPart")),_this.btnHighlight.blendMode=PIXI.BLEND_MODES.ADD,_this.btnHighlight.anchor.x=_this.btnHighlight.anchor.y=0,_this.btnHighlight.scale.x=_this.btnHighlight.scale.y=1.2,_this.btnHighlight.alpha=0,_this.addChild(_this.btnHighlight)},_this.updateGlow=function(partName){_this.btnGlow.visible=!1;for(var i=0;i<_this.buttons.length;i++){var btn=_this.buttons[i];if(btn.partName==partName)return _this.btnGlow.x=btn.x-_this.glowOffset.x,_this.btnGlow.y=btn.y-_this.glowOffset.y,void(_this.btnGlow.visible=!0)}console.warn("Tried to move glow to "+partName+". but the button doesnt exist!")},_this.updateHighlight=function(partName){for(var i=_this.btnHighlight.alpha=0;i<_this.buttons.length;i++){var btn=_this.buttons[i];if(btn.partName==partName){_this.btnHighlight.x=btn.x-_this.glowOffset.x,_this.btnHighlight.y=btn.y-_this.glowOffset.y;var tl=new TimelineLite;return tl.to(_this.btnHighlight,.2,{alpha:1}),tl.to(_this.btnHighlight,.2,{alpha:0}),tl.to(_this.btnHighlight,.2,{alpha:1}),tl.to(_this.btnHighlight,.2,{alpha:0}),tl.to(_this.btnHighlight,.2,{alpha:.5}),void tl.to(_this.btnHighlight,.2,{alpha:0})}}console.error("Tried to move btnHighlight to "+partName+" but the button doesnt exist!")},_this.calcButtonPos=function(index){return new Point(-40,37+110*index)},_this.teardown=function(){_this.buttons.forEach(function(button){button.removeAllListeners()}),_this.lockedButtons.forEach(function(lockedButton){lockedButton.removeAllListeners()})},_this._menuType=menuType,_this}return __extends(HudBaseMenu,_super),Object.defineProperty(HudBaseMenu.prototype,"menuType",{get:function(){return this._menuType},enumerable:!1,configurable:!0}),HudBaseMenu.prototype.addButtons=function(btnData,signal){var _this=this;this.buttons=[],this.lockedButtons=[],btnData.forEach(function(btnInfo,index){var btnPos=_this.calcButtonPos(index);if(app.unlockManager.isAvailable(btnInfo.robotPart)){var btn=new HudPartBtn(btnInfo,btnPos);_this.buttons.push(btn),_this.addChild(btn),btn.on("pointerdown",function(event){signal.dispatch(btnInfo.robotPart),app.sound.play("sfx-button-3")})}else{var lockedBtn=new LockedHubPartBtn(btnInfo,btnPos);_this.lockedButtons.push(lockedBtn),_this.addChild(lockedBtn),lockedBtn.interactive=!0,lockedBtn.on("pointerdown",function(event){app.voPlayer.play("save-up-for-new-parts")})}})},HudBaseMenu}(PIXI.Container),BuyBox=function(_super){function BuyBox(listIndex,craftingCallback){var _this=_super.call(this)||this;return _this.addMissionBtn=function(cost){for(var missingResourceIndex=0,i=0;i<cost.length;i++){var planet=Constants.Planets[i];if(app.wallet.get(planet)<cost[i]){missingResourceIndex=i;break}}_this.craftOrMissionBtn=new Button("CollectButton_"+Constants.Planets[missingResourceIndex],525,84,3),_this.craftOrMissionBtn.scale.x=_this.craftOrMissionBtn.scale.y=.8,_this.craftOrMissionBtn.on("pointerdown",function(){return _this.gotoMission(missingResourceIndex)}),_this.addChild(_this.craftOrMissionBtn)},_this.gotoMission=function(planetID){_this.craftOrMissionBtn.removeAllListeners(),PlayerPrefs.currentPlanet=Constants.Planets[planetID],LevelLoader.requestNextLevel(function(){PlayerPrefs.currentLevel.levelNr=-1,PlayerPrefs.currentLevel.isChallenge=!0,MenuSignals.fadeToGame.dispatch(),GameSignals.gotoWorld.dispatch()},!0,!1)},_this.setImages=function(bgTexture,iconTexture,offset){void 0===offset&&(offset=0);var bg=new PIXI.Sprite(Textures.get(bgTexture));bg.x=bg.y=offset,_this.addChild(bg);var icon=new PIXI.Sprite(Textures.get(iconTexture));icon.anchor.x=icon.anchor.y=.5,icon.x=70,icon.y=115,_this.addChild(icon)},_this.setText=function(title,description,textColour){var partName=new PIXI.Text(title,{fontFamily:"Peralta",fontSize:30,fill:textColour});partName.anchor.x=.5,partName.x=145,partName.y=32,_this.addChild(partName);var partDescription=new PIXI.Text(description,{wordWrap:!0,wordWrapWidth:150,fontFamily:"Wellfleet",fontSize:20,fill:textColour});partDescription.x=120,partDescription.y=82,_this.addChild(partDescription)},_this.setCost=function(cost){_this.craftingCost=new CraftingCostView(cost),_this.craftingCost.x=320,_this.craftingCost.y=53,_this.addChild(_this.craftingCost)},_this.teardown=function(){_this.craftOrMissionBtn&&_this.craftOrMissionBtn.removeAllListeners()},_this.setPos=function(point){_this.x=point.x,_this.y=point.y},_this.listIndex=listIndex,_this.craftingCallback=craftingCallback,_this}return __extends(BuyBox,_super),BuyBox}(PIXI.Container),Constants=function(){function Constants(){}return Constants.init=function(){(Constants.PartCosts={})[Constants.Parts_Wheels]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Body_Med]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Head_Normal]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Pincer]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Springs]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Tracks]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Drill]=[3,0,0,0,0],Constants.PartCosts[Constants.Parts_Foamer]=[0,4,0,0,0],Constants.PartCosts[Constants.Parts_Body_Short]=[1,3,0,0,0],Constants.PartCosts[Constants.Parts_Head_SuperEars]=[2,2,0,0,0],Constants.PartCosts[Constants.Parts_Wings]=[2,3,0,0,0],Constants.PartCosts[Constants.Parts_Rocket]=[0,0,4,0,0],Constants.PartCosts[Constants.Parts_Booster]=[1,2,2,0,0],Constants.PartCosts[Constants.Parts_Head_XrayVision]=[1,1,3,0,0],Constants.PartCosts[Constants.Parts_Body_Tall]=[0,0,4,2,0],Constants.PartCosts[Constants.Parts_Head_HeatVision]=[0,0,3,3,0],(Constants.SkinCosts={})[Constants.Parts_Wheels]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Head_Normal]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Body_Med]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Pincer]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Springs]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Tracks]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Drill]=[3,0,0,0,0],Constants.SkinCosts[Constants.Parts_Foamer]=[0,4,0,0,0],Constants.SkinCosts[Constants.Parts_Body_Short]=[1,3,0,0,0],Constants.SkinCosts[Constants.Parts_Head_SuperEars]=[2,2,0,0,0],Constants.SkinCosts[Constants.Parts_Wings]=[2,3,0,0,0],Constants.SkinCosts[Constants.Parts_Rocket]=[0,0,4,0,0],Constants.SkinCosts[Constants.Parts_Booster]=[1,2,2,0,0],Constants.SkinCosts[Constants.Parts_Head_XrayVision]=[1,1,3,0,0],Constants.SkinCosts[Constants.Parts_Body_Tall]=[0,0,4,2,0],Constants.SkinCosts[Constants.Parts_Head_HeatVision]=[0,0,3,3,0],(Constants.PartTitles={})[Constants.Parts_Wheels]="Wheels",Constants.PartTitles[Constants.Parts_Head_Normal]="Basic Head",Constants.PartTitles[Constants.Parts_Body_Med]="Normal Body",Constants.PartTitles[Constants.Parts_Pincer]="Pincers",Constants.PartTitles[Constants.Parts_Springs]="Springs",Constants.PartTitles[Constants.Parts_Tracks]="Treads",Constants.PartTitles[Constants.Parts_Drill]="Drill Arms",Constants.PartTitles[Constants.Parts_Foamer]="Foamer Arms",Constants.PartTitles[Constants.Parts_Body_Short]="Short Body",Constants.PartTitles[Constants.Parts_Head_SuperEars]="Super Ears",Constants.PartTitles[Constants.Parts_Wings]="Wings",Constants.PartTitles[Constants.Parts_Rocket]="Rocket Legs",Constants.PartTitles[Constants.Parts_Booster]="Booster Arms",Constants.PartTitles[Constants.Parts_Head_XrayVision]="X-Ray Head",Constants.PartTitles[Constants.Parts_Body_Tall]="Tall Body",Constants.PartTitles[Constants.Parts_Head_HeatVision]="Heat Vision",(Constants.PartDescription_Short={})[Constants.Parts_Wheels]="fast on flat ground",Constants.PartDescription_Short[Constants.Parts_Head_Normal]="normal head",Constants.PartDescription_Short[Constants.Parts_Body_Med]="normal height",Constants.PartDescription_Short[Constants.Parts_Pincer]="grab Parts in gaps",Constants.PartDescription_Short[Constants.Parts_Springs]="jumps over obstacles",Constants.PartDescription_Short[Constants.Parts_Tracks]="works on rough ground",Constants.PartDescription_Short[Constants.Parts_Drill]="drill cracked ground",Constants.PartDescription_Short[Constants.Parts_Foamer]="create foam platforms",Constants.PartDescription_Short[Constants.Parts_Body_Short]="for small spaces",Constants.PartDescription_Short[Constants.Parts_Head_SuperEars]="hear quite things",Constants.PartDescription_Short[Constants.Parts_Wings]="glide through the air",Constants.PartDescription_Short[Constants.Parts_Rocket]="launches into the air",Constants.PartDescription_Short[Constants.Parts_Booster]="boost forward quickly",Constants.PartDescription_Short[Constants.Parts_Head_XrayVision]="see cracked floors",Constants.PartDescription_Short[Constants.Parts_Body_Tall]="reach up high",Constants.PartDescription_Short[Constants.Parts_Head_HeatVision]="see hot things",(Constants.PartType={})[Constants.Parts_Head_Normal]=Constants.Head,Constants.PartType[Constants.Parts_Body_Med]=Constants.Body,Constants.PartType[Constants.Parts_Wheels]=Constants.Legs,Constants.PartType[Constants.Parts_Pincer]=Constants.Arms,Constants.PartType[Constants.Parts_Springs]=Constants.Legs,Constants.PartType[Constants.Parts_Tracks]=Constants.Legs,Constants.PartType[Constants.Parts_Drill]=Constants.Arms,Constants.PartType[Constants.Parts_Foamer]=Constants.Arms,Constants.PartType[Constants.Parts_Body_Short]=Constants.Body,Constants.PartType[Constants.Parts_Head_SuperEars]=Constants.Head,Constants.PartType[Constants.Parts_Wings]=Constants.Arms,Constants.PartType[Constants.Parts_Rocket]=Constants.Legs,Constants.PartType[Constants.Parts_Booster]=Constants.Arms,Constants.PartType[Constants.Parts_Head_XrayVision]=Constants.Head,Constants.PartType[Constants.Parts_Body_Tall]=Constants.Body,Constants.PartType[Constants.Parts_Head_HeatVision]=Constants.Head},Constants.Epsilon=1e-4,Constants.TileWidth=150,Constants.TileHeight=75,Constants.ScreenWidth=1280,Constants.ScreenHeight=720,Constants.KeyCodeLeft=37,Constants.KeyCodeRight=39,Constants.KeyCodeUp=38,Constants.KeyCodeDown=40,Constants.KeyCodeSpace=32,Constants.KeyCodeW=87,Constants.KeyCodeA=65,Constants.KeyCodeS=83,Constants.KeyCodeD=68,Constants.KeyCodeR=82,Constants.TerrainAtlasWidth=10,Constants.TerrainAtlasHeight=13,Constants.ItemsAtlasWidth=3,Constants.ItemsAtlasHeight=2,Constants.Earth="Earth",Constants.Moon="Moon",Constants.Mars="Mars",Constants.Enceladus="Enceladus",Constants.Bortron7="Bortron7",Constants.Bolt="Bolt",Constants.Nut="Nut",Constants.Cog="Cog",Constants.Spring="Spring",Constants.Chip="Chip",Constants.LevelsPerPlanet=9,Constants.Planets=[Constants.Earth,Constants.Moon,Constants.Mars,Constants.Enceladus,Constants.Bortron7],Constants.Resources=[Constants.Bolt,Constants.Nut,Constants.Cog,Constants.Spring,Constants.Chip],Constants.Collectable_Pickup="collectablePickup",Constants.Collectable_Resource="collectableResource",Constants.Parts_Wheels="LegsWheels",Constants.Parts_Tracks="LegsTracks",Constants.Parts_Springs="LegsSprings",Constants.Parts_Rocket="LegsRocket",Constants.Parts_Pincer="ArmPincer",Constants.Parts_Drill="ArmDrill",Constants.Parts_Wings="ArmWing",Constants.Parts_Foamer="ArmFoam",Constants.Parts_Booster="ArmBooster",Constants.Parts_Body_Tall="BodyTall",Constants.Parts_Body_Med="BodyMed",Constants.Parts_Body_Short="BodyShort",Constants.Parts_Head_Normal="HeadNormal",Constants.Parts_Head_SuperEars="HeadSuperEars",Constants.Parts_Head_XrayVision="HeadXray",Constants.Parts_Head_HeatVision="HeadHeatVision",Constants.SkinDefault="Default",Constants.SkinBlue="Blue",Constants.SkinRed="Red",Constants.SkinGreen="Green",Constants.Head="Head",Constants.Legs="Legs",Constants.Arms="Arms",Constants.Body="Body",Constants.Colours={Default:"#bfdbef",Orange:"#bfdbef",Blue:"#2f4b92",Red:"#6d1d23",Green:"#505f27"},Constants.DefaultParts=[Constants.Parts_Wheels,Constants.Parts_Head_Normal,Constants.Parts_Body_Med,Constants.Parts_Pincer],Constants.UnlockOrder=[Constants.Parts_Springs,Constants.Parts_Tracks,Constants.Parts_Drill,Constants.Parts_Foamer,Constants.Parts_Body_Short,Constants.Parts_Head_SuperEars,Constants.Parts_Wings,Constants.Parts_Rocket,Constants.Parts_Booster,Constants.Parts_Head_XrayVision,Constants.Parts_Body_Tall,Constants.Parts_Head_HeatVision],Constants.highPlatformObstacleIds=["b4b66570-0e65-46ff-9f9b-3452b79dd30b","1dd74ed5-9c06-4020-b547-3748811048d3","1b481892-7ad7-416e-908b-ae740c748a6f","83e9b1dc-cf8d-4f49-8e16-3c80519a8b40","fc0e7223-0668-4e24-b951-043a44ffee4c","19a19f18-b043-4dbe-8e4b-19a9e367ba9a","377c02d2-6e6a-4f6f-857b-406431723be7","d2d42d86-3707-463e-ab1c-88c5ccfaa9c5","cb016075-77e6-4670-bc6b-f3200bec3a9c","4c72cf23-e041-4450-b209-2c2309610311","58380c85-8686-45a0-8ded-c8ae811cfb6d","a990d7de-062e-41bb-b923-d362f557ebd3","c8707695-8300-4489-89e8-ca9c9cd4fdf4","5e2e749f-e46b-44ff-b381-e23e41b90f3b","bbc5f8e2-d2d6-407a-8622-eaf71e0480b3","129f9bf9-58b9-4d2d-a448-c0de9e1713d1","3aa42b83-8045-4768-b5e9-059aac24750a","f03946f6-5abd-4f0e-873f-36a320e56760","39c33fcf-be8f-43b3-a8c4-ab3579efac39","7c36169d-6ca5-4b28-acdd-fb9f363177b2","0efb66c9-06cf-4438-9201-466d45b0bdeb","9f8d0dd6-aa20-46bd-b751-fb901ef9dc63","e0efcebf-1369-4e29-a3ed-49ce610423cc","88ec2e21-0351-4aea-85d5-4efe16675148","694a76b1-ef0f-441b-a70b-04fbf9e4b0d8","a36dcf9c-6baf-4f57-9af3-866a68b80a91","b38adc11-fc83-4842-bbc4-2465950e78f9","0cb765f6-8647-4e51-b843-b7d2473603bc","2fa92f83-eead-4fa1-a050-c2256f95d2a1","89c889fa-44f3-4505-8d47-a5dad03fa136","ff8e8f1d-da1c-4798-b821-470a1b8438ed","57d7867e-7ee7-4b29-942b-31f2aca75f82","3f46fe55-3f45-48d8-ac3a-55d23ae8e249","03f1d44c-6bd1-43bf-94b4-82a3c9ca2b72"],Constants}();Constants.init();var Collision,ItemID=function(){function ItemID(){}return ItemID.StartPositionRight=1+(ItemID.offset=130),ItemID.StartPositionLeft=7+ItemID.offset,ItemID.Resource=3+ItemID.offset,ItemID.HeatResource=9+ItemID.offset,ItemID.StarLeft=5+ItemID.offset,ItemID.StarMiddle=2+ItemID.offset,ItemID.StarRight=6+ItemID.offset,ItemID.SuperEarCollectable=4+ItemID.offset,ItemID}(),TileID=function(){function TileID(){}return TileID.slopeTopRight=16,TileID.slopeTopLeft=26,TileID.slopeMidRight=10,TileID.slopeMidLeft=49,TileID.platformLeft=31,TileID.platformMiddle=32,TileID.platformRight=33,TileID.platformSingle=38,TileID.roughGroundLeft=35,TileID.roughGroundMid=36,TileID.roughGroundRight=37,TileID.roughGroundSingle=34,TileID.drillHole=70,TileID.xrayDrillHole=101,TileID.drillHoleCover=2,TileID.drillHoleCoverCracked=6,TileID.drillThrough=25,TileID.xrayDrillThrough=102,TileID.drillThroughCover=32,TileID.drillThroughCoverCracked=24,TileID.smallDipLeft=71,TileID.smallDipMid=72,TileID.smallDipRight=73,TileID.dipLeft=79,TileID.dipLeftEnd=97,TileID.dipRight=80,TileID.dipRightEnd=98,TileID.iceWallBase=123,TileID.iceWallMid=113,TileID.iceWallTop=103,TileID.validRespawnTiles=[1,2,3,4,5,7,31,32,33,38,42,44,45,46,50,71,72,73,75,79,80,97,98],TileID}(),TutStep=function(){function TutStep(){}return TutStep.Intro="Intro",TutStep.WorkShopIntro="WorkShopIntro",TutStep.GotoFirstMission="GotoFirstMission",TutStep.Complete="Complete",TutStep}(),ActionTutorial=function(worldMediator,worldView){var _this=this;this.armInstructionPlayed=!1,this.update=function(){1550<_this.worldMediator.robot.x&&!_this.armInstructionPlayed&&_this.armInstrux()},this.armsUsed=function(){setTimeout(function(){_this.worldMediator.levelIsComplete()?(WorldSignals.useArms.remove(_this.armsUsed),app.voPlayer.play("onboarding-gap-complete"),app.analyticsEmitter.startCorrectFeedback(AnalyticsUtils.levelID,"correct feedback for using pincers","pincerFeedback","audio",1e3,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),setTimeout(function(){app.analyticsEmitter.endCorrectFeedback(AnalyticsUtils.levelID,"correct feedback for using pincers","pincerFeedback","audio",1e3,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},1e3)):app.voPlayer.play("onboarding-gap-miss")},50)},this.armInstrux=function(){_this.armInstructionPlayed=!0,_this.worldView.gameUI.controls.hide(),_this.worldMediator.enabled=!1,GameSignals.disableInput.dispatch(.2),_this.worldMediator.gamePhysix.setXVelocity(0),_this.worldMediator.robot.legs.update(0),app.voPlayer.play(["onboarding-bolt-gap","onboarding-sean-pincer"]),setTimeout(function(){_this.worldView.gameCont.addChild(new ButtonHighlight("smallCircleGlow",1900,640,1.5))},1600),setTimeout(function(){Device.isTouchDevice?app.voPlayer.play("onboarding-gap-touch"):app.voPlayer.play("onboarding-gap-desktop"),_this.worldMediator.enabled=!0,GameSignals.enableInput.dispatch(),_this.worldView.gameUI.controls.showActionControlls(),_this.worldView.gameUI.controls.showMovementControlls(),WorldSignals.useArms.add(_this.armsUsed)},10200),setTimeout(function(){if(Device.isTouchDevice){var _x=_this.worldView.gameUI.controls.actionBtn.x,_y=_this.worldView.gameUI.controls.actionBtn.y;_this.worldView.gameUI.addChild(new ButtonHighlight("UnlockPulse",_x,_y,.45))}else _this.worldView.gameUI.addChild(new ButtonHighlight("buildPartGlow",440,660,.4))},11e3)},this.teardown=function(){},this.worldMediator=worldMediator,this.worldView=worldView,PlayerPrefs.actionTutorialPlayed=!0,this.worldView.gameUI.controls.hide(),this.worldView.gameUI.controls.showMovementControlls()},EditRobotMediator=function(){function EditRobotMediator(parent,onExitCallback){var _this=this;this.show=function(){app.on("resize",_this.editRobotView.resize),_this.editRobotView.setupLockedColours(_this.currentPart),WorldSignals.setSelectedPart.add(_this.updateCurrentSelection),WorldSignals.updateDescription.add(_this.getUpdatedDescription),_this.editRobotView.addSignals(),_this.setupRobot(),TweenLite.to(_this.editRobotView,.2,{alpha:1}),_this.editRobotView.visible=!0;var timeline=new TimelineLite;timeline.add(function(){return _this.editRobotView.showScreen()},.4),timeline.add(function(){return _this.editRobotView.showHud()},.4),setTimeout(function(){if(_this.enable(),_this.editRobotView.redBtn.on("pointerdown",function(event){_this.editRobotView.playButtonSFX("sfx-button-1"),_this.colourPart(Constants.SkinRed,_this.editRobotView.redBtn.position)}),_this.editRobotView.blueBtn.on("pointerdown",function(event){_this.editRobotView.playButtonSFX("sfx-button-1"),_this.colourPart(Constants.SkinBlue,_this.editRobotView.blueBtn.position)}),_this.editRobotView.greenBtn.on("pointerdown",function(event){_this.editRobotView.playButtonSFX("sfx-button-1"),_this.colourPart(Constants.SkinGreen,_this.editRobotView.greenBtn.position)}),_this.editRobotView.orangeBtn.on("pointerdown",function(event){_this.editRobotView.playButtonSFX("sfx-button-1"),_this.colourPart(Constants.SkinDefault,_this.editRobotView.orangeBtn.position)}),PlayerPrefs.firstColourCrafted&&!PlayerPrefs.colourTutorialPlayed)_this.playUnlockAnim();else{var clips=["enter-design-1","onboarding-design-workshop"];app.voPlayer.play(clips[Math.floor(Math.random()*clips.length)])}},400)},this.hide=function(){app.off("resize",_this.editRobotView.resize),_this.disable(),_this.editRobotView.redBtn.removeAllListeners(),_this.editRobotView.blueBtn.removeAllListeners(),_this.editRobotView.greenBtn.removeAllListeners(),_this.editRobotView.orangeBtn.removeAllListeners(),_this.editRobotView.hideScreen(),_this.editRobotView.hideHud(),TweenLite.to(_this.editRobotView,.2,{alpha:0})},this.setupRobot=function(){_this.isVOActivated=!1,_this.equipHead(PlayerPrefs.robotHead),_this.equipArms(PlayerPrefs.robotArms),_this.equipLegs(PlayerPrefs.robotLegs),_this.equipBody(PlayerPrefs.robotBody),_this.editRobotView.updateDescription("","Select a part from the hud"),_this.isVOActivated=!0},this.updateCurrentSelection=function(selectedPart){_this.currentPart=selectedPart},this.colourPart=function(colour,pos){if(_this.currentPart){var prevColour=SkinColour.get(_this.currentPart);SkinColour.set(_this.currentPart,colour),_this.menuRobot.updatePartColour(_this.currentPart,colour),_this.editRobotView.updateSelectBoxPos(pos),app.analyticsEmitter.ChangedPaint(AnalyticsUtils.clickPos,colour,_this.currentPart,Constants.PartType[_this.currentPart],prevColour)}},this.enable=function(){WorldSignals.trySelectArms.add(_this.equipArms),WorldSignals.trySelectLegs.add(_this.equipLegs),WorldSignals.trySelectHead.add(_this.equipHead),WorldSignals.trySelectBody.add(_this.equipBody),_this.editRobotView.editPartsHud.enableHud(),_this.mindyMediator&&_this.mindyMediator.enable()},this.disable=function(){WorldSignals.trySelectArms.remove(_this.equipArms),WorldSignals.trySelectLegs.remove(_this.equipLegs),WorldSignals.trySelectHead.remove(_this.equipHead),WorldSignals.trySelectBody.remove(_this.equipBody),_this.editRobotView.editPartsHud.disableHud(),_this.mindyMediator&&_this.mindyMediator.disable()},this.equipArms=function(partName){_this.currentPart=partName,PlayerPrefs.robotArms=partName,_this.menuRobot.equipPart(partName,Constants.Arms);var vo=_this.getArmVo(partName);vo&&!app.voPlayer.playing&&_this.playVO(vo),_this.udpateDescriptionBox(partName),WorldSignals.selectArms.dispatch(partName)},this.equipLegs=function(partName){_this.currentPart=partName,PlayerPrefs.robotLegs=partName,_this.menuRobot.equipPart(partName,Constants.Legs);var vo=_this.getLegsVo(partName);vo&&!app.voPlayer.playing&&_this.playVO(vo),_this.udpateDescriptionBox(partName),WorldSignals.selectLegs.dispatch(partName)},this.equipHead=function(partName){_this.currentPart=partName,PlayerPrefs.robotHead=partName,_this.menuRobot.equipPart(partName,Constants.Head);var vo=_this.getHeadVo(partName);vo&&!app.voPlayer.playing&&_this.playVO(vo),_this.udpateDescriptionBox(partName),WorldSignals.selectHead.dispatch(partName)},this.equipBody=function(partName){var armsAvailable=(_this.currentPart=partName)!=Constants.Parts_Body_Short;WorldSignals.setArmsBtnState.dispatch(armsAvailable);var vo=_this.getBodyVo(partName);vo&&!app.voPlayer.playing&&_this.playVO(vo),_this.menuRobot.equipBody(partName),_this.udpateDescriptionBox(partName),PlayerPrefs.robotBody=partName,WorldSignals.selectBody.dispatch(partName)},this.getUpdatedDescription=function(partName){var newDesc=_this.robotDescriptions.getPartDescInfo(partName);_this.editRobotView.updateDescription(newDesc[0],newDesc[1])},this.udpateDescriptionBox=function(partName){_this.getUpdatedDescription(partName),_this.editRobotView.setupLockedColours(partName)},this.playUnlockAnim=function(){if(PlayerPrefs.saveColourTutorialPlayed(),PlayerPrefs.firstSkin){GameSignals.disableInput.dispatch();var animPos=_this.editRobotView.redLocked.position;PlayerPrefs.firstSkin.colour==Constants.SkinGreen?animPos=_this.editRobotView.greenLocked.position:PlayerPrefs.firstSkin.colour==Constants.SkinBlue&&(animPos=_this.editRobotView.blueLocked.position),setTimeout(function(){app.voPlayer.play("onboarding-change-color");var name=PlayerPrefs.firstSkin.partName,type=Constants.PartType[name];_this.editRobotView.descriptionBox.addChild(new UnlockColourAnim(animPos)),_this.editRobotView.editPartsHud.showMenu(type),type==Constants.Arms?_this.equipArms(name):type==Constants.Head?_this.equipHead(name):type==Constants.Legs?_this.equipLegs(name):type==Constants.Body&&_this.equipBody(name)},900),setTimeout(GameSignals.enableInput.dispatch,2e3)}},this.editRobotView=new EditRobotView(onExitCallback),this.editRobotView.visible=!1,parent.addChild(this.editRobotView),this.menuRobot=new MenuRobotMediator(this.editRobotView),this.menuRobot.placeRobot(670,550),this.menuRobot.scaleRobot(1.5),this.robotDescriptions=new PartDescriptions,this.setupRobot(),Device.lowEndDevice||(this.mindyMediator=new HeadMediatorMindy(this.editRobotView.talkingHead))}return Object.defineProperty(EditRobotMediator,"analyticsID",{get:function(){return"Design screen"},enumerable:!1,configurable:!0}),EditRobotMediator.prototype.getArmVo=function(part){switch(part){case Constants.Parts_Pincer:return"equip-pincers";case Constants.Parts_Drill:return"equip-drill";case Constants.Parts_Wings:return"equip-wings";case Constants.Parts_Foamer:return"equip-foamer";case Constants.Parts_Booster:return"equip-boosters";default:return console.error("getArmVo: no vo for",part),null}},EditRobotMediator.prototype.playVO=function(voId){var _this=this;if(!this.isVOActivated)return!1;var shouldPlay=.5<Math.random();this.voTimeline=new TimelineLite,this.voTimeline.add(function(){return _this.playRobot(voId)}),shouldPlay&&this.voTimeline.add(function(){return _this.playScreenVo(voId)},2)},EditRobotMediator.prototype.playRobot=function(id){this.editRobotView.playRobotVO(id)},EditRobotMediator.prototype.playScreenVo=function(id){var talkingHeadVoId=id+"-mindy";app.voPlayer.play(talkingHeadVoId)},EditRobotMediator.prototype.getLegsVo=function(part){switch(part){case Constants.Parts_Wheels:return"equip-wheel";case Constants.Parts_Tracks:return"equip-tread";case Constants.Parts_Springs:return"equip-springs";case Constants.Parts_Rocket:return"equip-rocket";default:return console.error("getLegsVo: no vo for",part),null}},EditRobotMediator.prototype.getHeadVo=function(part){switch(part){case Constants.Parts_Head_Normal:return"equip-basic-head";case Constants.Parts_Head_SuperEars:return"equip-sonar-head";case Constants.Parts_Head_XrayVision:return"equip-xray-head";case Constants.Parts_Head_HeatVision:return"equip-heat-head";default:return console.error("getHeadVo: no vo for",part),null}},EditRobotMediator.prototype.getBodyVo=function(part){switch(part){case Constants.Parts_Body_Short:return"equip-short-body";case Constants.Parts_Body_Med:return"equip-medium-body";case Constants.Parts_Body_Tall:return"equip-tall-body";default:return console.error("getBodyVo: no vo for",part),null}},EditRobotMediator}(),FoamerTutorial=function(worldView,robot){var _this=this;this.oneSecondTick=function(){app.lostFocus||(_this.armActivated||_this.blinkActionBtn(),!_this.firstGapPassed&&950<_this.robot.x&&(_this.firstGapPassed=!0),!_this.cliffReached&&1550<_this.robot.x&&(_this.cliffReached=!0,app.voPlayer.play("test-foamer-ledge")),2e3<_this.robot.x&&(PlayerPrefs.foamerTutorialPlayed=!0))},this.blinkActionBtn=function(){if(Device.isTouchDevice){var _x=_this.worldView.gameUI.controls.actionBtn.x,_y=_this.worldView.gameUI.controls.actionBtn.y;_this.worldView.gameUI.addChild(new ButtonHighlight("UnlockPulse",_x,_y,.45))}else _this.worldView.gameUI.addChild(new ButtonHighlight("buildPartGlow",440,660,.4))},this.showFoamGrid=function(){_this.armActivated||(_this.armActivated=!0,app.voPlayer.play("test-foamer-place-desktop"))},this.foamTile=function(point){_this.firstGapFoamed||_this.firstGapPassed||(787.5!=point.y||675!=point.x&&825!=point.x?app.voPlayer.play(["test-foamer-place-fail-1","test-foamer-place-fail-2"]):(_this.firstGapFoamed=!0,app.voPlayer.play("test-foamer-place-pass"))),_this.cliffPlacementCorrect?_this.cliff2PlacementCorrect||(2025!=point.x||487.5!=point.y&&412.5!=point.y?app.voPlayer.play("test-foamer-place-fail-1"):(_this.cliff2PlacementCorrect=!0,PlayerPrefs.foamerTutorialPlayed=!0,app.voPlayer.play("onboarding-gap-complete"))):_this.cliffReached&&(1725!=point.x||712.5!=point.y&&637.5!=point.y?app.voPlayer.play("test-foamer-place-fail-1"):(_this.cliffPlacementCorrect=!0,app.voPlayer.play("onboarding-gap-complete")))},this.update=function(){},this.teardown=function(){clearInterval(_this.interval)},this.worldView=worldView,this.robot=robot,WorldSignals.showFoamGrid.add(this.showFoamGrid),WorldSignals.foamTile.add(this.foamTile),this.interval=setInterval(this.oneSecondTick,1e3),setTimeout(function(){app.voPlayer.play(["test-foamer-this-arm-can-make","test-foamer-activate-"+(Device.isDesktop?"desktop":"touch")])},200)},GameMediator=function(){function GameMediator(parent){var _this=this;this.inputBlockTapCount=0,this.gotoGame=function(){_this.inMenu?(_this.inMenu=!1,_this.disableInput(),_this.stopSounds(),_this.mainMenu.teardown(),_this.mainMenu=null,app.menuLoader.reset(),setTimeout(function(){_this.addLoadingScreen(),app.worldLoader.load(null,_this.gameAssetsLoaded)},50)):console.error("Trying to get to game, with game already started.")},this.gameAssetsLoaded=function(){Textures.initPlanet(),_this.removeLoadingScreen();var lvl=PlayerPrefs.currentLevel;_this.world=new WorldMediator(_this.parent),_this.world.init(lvl.isTutorial),_this.playLevelMusic(lvl,PlayerPrefs.currentPlanet),_this.inGame=!0},this.gotoMainMenu=function(missionRecord){_this.inMenu?console.error("Trying to get to menu, with menu already active."):(_this.inMenu=!0,_this.inGame=!1,_this.disableInput(),_this.stopSounds(),_this.world&&(_this.world.teardown(),_this.world=null,app.worldLoader.reset()),setTimeout(function(){_this.addLoadingScreen(),_this.missionRecord=missionRecord,app.menuLoader.load(null,_this.menuAssetsLoaded)},50))},this.stopSounds=function(){Device.lowEndDevice&&app.sound.unloadAll()},this.menuAssetsLoaded=function(){_this.removeLoadingScreen(),_this.mainMenu=new MainMenuMediator(_this.parent,_this.missionRecord),_this.playMusic("music-menu")},this.enableInput=function(){_this.inputBlock.interactive=!1,_this.inputBlock.alpha=0},this.disableInput=function(value){void 0===value&&(value=0),_this.inputBlock.interactive=!0,_this.inputBlock.alpha=.05,_this.inputBlockTapCount=0},this.playMusic=function(name,vol){void 0===vol&&(vol=1),_this.gameMusic?_this.gameMusic.alias!=name&&(_this.gameMusic.stop(),_this.gameMusic=app.sound.play(name,{loop:-1})):_this.gameMusic=app.sound.play(name,{loop:-1})},this.playLevelMusic=function(lvl,currentPlanet){if("convention"==lvl.levelID)_this.playMusic("music-bortron-party",.5);else{var music="music-earth";switch(currentPlanet){case Constants.Moon:music="music-moon";break;case Constants.Mars:music="music-mars";break;case Constants.Enceladus:music="music-enceladus";break;case Constants.Bortron7:music="music-bortron"}_this.playMusic(music)}},this.initInputBlock=function(){_this.inputBlock=new PIXI.Graphics,_this.inputBlock.beginFill(0),_this.inputBlock.moveTo(0,0),_this.inputBlock.lineTo(1280,0),_this.inputBlock.lineTo(1280,720),_this.inputBlock.lineTo(0,720),_this.inputBlock.endFill(),_this.inputBlock.interactive=!1,_this.inputBlock.on("pointerdown",_this.tapInputBlock),_this.parent.addChild(_this.inputBlock)},this.tapInputBlock=function(){_this.inputBlockTapCount++,15<_this.inputBlockTapCount&&_this.enableInput()},this.addLoadingScreen=function(){_this.loadingText=new PIXI.Text("loading...",{fontFamily:"Peralta",fontSize:50,fill:"#58a9bf",align:"center"}),_this.loadingText.x=640-app.display.sideOffset,_this.loadingText.y=640,_this.loadingText.anchor.x=.5,_this.parent.addChild(_this.loadingText)},this.removeLoadingScreen=function(){try{_this.parent.removeChild(_this.loadingText),_this.loadingText=null}catch(e){}},this.preventXFromClosingApp=function(){if(app.closeBtn){app.closeBtn.addEventListener("click",function(){_this.inGame?(_this.gotoMainMenu(null),event.preventDefault()):app.closeBtn&&app.exitApp()})}},this.parent=parent,this.initInputBlock(),GameSignals.gotoWorld.add(this.gotoGame),GameSignals.gotoMainMenu.add(this.gotoMainMenu),GameSignals.disableInput.add(this.disableInput),GameSignals.enableInput.add(this.enableInput),this.playMusic("music-menu"),app.triggerAppResize(),this.gotoMainMenu(null),this.preventXFromClosingApp()}return Object.defineProperty(GameMediator.prototype,"ID",{get:function(){return this.inGame?"world":"menu"},enumerable:!1,configurable:!0}),GameMediator}(),HeadMediatorMindy=function(headView){var _this=this;this.enable=function(){app.voPlayer.on("start",_this.onVoStart)},this.disable=function(){app.voPlayer.off("start",_this.onVoStart),clearTimeout(_this.stopTalkingTimeout)},this.onVoStart=function(clip){var length=_this.clipLengths[clip];length&&(_this.stopTalkingTimeout=setTimeout(_this.stopTalking,length),_this.headView.startTalking())},this.stopTalking=function(){_this.headView.stopTalking()},this.headView=headView,this.headView.stopTalking(),this.clipLengths=[],this.clipLengths["equip-wheel-mindy"]=3160,this.clipLengths["equip-tread-mindy"]=2700,this.clipLengths["equip-springs-mindy"]=5500,this.clipLengths["equip-rocket-mindy"]=9e3,this.clipLengths["equip-pincers-mindy"]=4e3,this.clipLengths["equip-wings-mindy"]=3e3,this.clipLengths["equip-boosters-mindy"]=3600,this.clipLengths["equip-drill-mindy"]=2700,this.clipLengths["equip-foamer-mindy"]=8500,this.clipLengths["equip-short-body-mindy"]=4800,this.clipLengths["equip-medium-body-mindy"]=6e3,this.clipLengths["equip-tall-body-mindy"]=3300,this.clipLengths["equip-basic-head-mindy"]=1800,this.clipLengths["equip-xray-head-mindy"]=4e3,this.clipLengths["equip-sonar-head-mindy"]=13200,this.clipLengths["equip-heat-head-mindy"]=3650,this.clipLengths["enter-edit-1"]=3200,this.clipLengths["enter-edit-2"]=1600,this.clipLengths["edit-to-1"]=2800,this.clipLengths["edit-to-2"]=2e3,this.clipLengths["edit-to-3"]=2500,this.clipLengths["edit-to-4"]=2200,this.clipLengths["edit-to-5"]=2900,this.clipLengths["enter-design-1"]=3200,this.clipLengths["onboarding-design-workshop"]=3500,this.clipLengths["onboarding-change-color"]=3e3,this.clipLengths["select-color-1"]=3e3,this.clipLengths["select-color-2"]=4500},HeadMediatorSydney=function(headView){var _this=this;this.show=function(){_this.onScreen||(_this.onScreen=!0,_this.headView.show(),app.sound.play("sfx-audio-out"))},this.hide=function(){_this.onScreen&&(_this.onScreen=!1,_this.headView.hide(),app.sound.play("sfx-audio-out"))},this.teardown=function(){app.voPlayer.off("start",_this.onVoStart),clearTimeout(_this.hideTimeout),clearTimeout(_this.stopTalkingTimeout)},this.onVoStart=function(clip){var length=_this.clipLengths[clip];length&&(clearTimeout(_this.stopTalkingTimeout),_this.stopTalkingTimeout=setTimeout(_this.stopTalking,length),_this.headView.startTalking())},this.stopTalking=function(){_this.headView.stopTalking()},this.headView=headView,this.onScreen=!1,this.headView.stopTalking(),this.headView.hide(),app.voPlayer.on("start",this.onVoStart),this.clipLengths=[],this.clipLengths["make-part-1"]=3900,this.clipLengths["make-part-2"]=4250,this.clipLengths["need-resources-1"]=3180,this.clipLengths["need-resources-2"]=5700,this.clipLengths["part-test-1"]=3370,this.clipLengths["part-test-2"]=1500,this.clipLengths["part-variant-1"]=6700,this.clipLengths["part-variant-2"]=2110,this.clipLengths["onboarding-make-welcome-2"]=1900,this.clipLengths["onboarding-make-welcome-3"]=2900,this.clipLengths["onboarding-make-welcome-5"]=2480,this.clipLengths["onboarding-make-welcome-6"]=2850,this.clipLengths["onboarding-make-welcome-7"]=2950,this.clipLengths["onboarding-make-welcome-8"]=3e3,this.clipLengths["onboarding-make-welcome-9"]=1330,this.clipLengths["onboarding-make-welcome-10"]=2330,this.clipLengths["onboarding-make-welcome-11"]=1700,this.clipLengths["onboarding-make-welcome-12"]=5700,this.clipLengths["onboarding-make-welcome-13"]=700,this.clipLengths["onboarding-make-welcome-14"]=2870,this.clipLengths["onboarding-make-welcome-15"]=5e3,this.clipLengths["onboarding-make-welcome-16"]=3810,this.clipLengths["make-all-created-1"]=2800,this.clipLengths["make-all-created-2"]=4100,this.clipLengths["make-no-new-parts"]=5600},HiddenObjIntro=function(robot,level,gamePhysix){var _this=this;this.teardown=function(){_this.timeout.teardown()},this.update=function(){},app.voPlayer.play("head-general-1"),this.timeout=new HiddenObjTimeout(12e3,robot,level,gamePhysix)},LoadingMediator=function(){function LoadingMediator(parent){var _this=this;this.initView=function(){_this.loadingView.init(),Device.isCordova?_this.onPressScreen():_this.loadingView.once("pointerdown",_this.onPressScreen);$.getJSON("assets/config/buildInfo.json",function(data){_this.loadingView.addBuildInfo(data)})},this.onPressScreen=function(){_this.loadingView.removePrompt(),app.sound.play("sfx-button-action"),app.menuLoader.load(_this.onAssetsLoadProgress,_this.onAssetsLoaded)},this.onAssetsLoadProgress=function(p){_this.loadingView.updateProgress(p)},this.onAssetsLoaded=function(){_this.loadingView.updateProgress(1),setTimeout(function(){app.trigger("loadingcomplete"),app.splashLoader.reset()},500)},this.teardown=function(){_this.loadingView.teardown(),_this.loadingView.parent.removeChild(_this.loadingView)},this.loadingView=new LoadingView,parent.addChild(this.loadingView),app.worldLoader=new WorldLoader,app.menuLoader=new MenuLoader,app.splashLoader=new SplashLoader,app.splashLoader.load(this.initView),app.triggerAppResize()}return Object.defineProperty(LoadingMediator.prototype,"ID",{get:function(){return"loading"},enumerable:!1,configurable:!0}),LoadingMediator}(),MainMenuMediator=function(){function MainMenuMediator(parent,missionRecord){var _this=this;void 0===missionRecord&&(missionRecord=null),this.mainMenuShot={y:360,scale:.5},this.subMenuShot={y:580,scale:.8},this.editMenuShot={y:770,scale:1.3},this.levelSelectShot={y:580,scale:.8},this.gameShot={y:1e3,scale:2.25},this.nullScreen={hide:function(){},show:function(){}},this.currentScreen=null,this.init=function(missionRecord,firstVisit){void 0===missionRecord&&(missionRecord=null),_this.timeout=new Timeout(1e4,[]),GameSignals.enableInput.dispatch(),firstVisit?_this.playGameIntro():PlayerPrefs.tutStep==TutStep.GotoFirstMission?(_this.mainMenuView.menuConsole.raise(),_this.guideToFirstMission()):PlayerPrefs.playEndgameVO?(_this.playEngameVO(),_this.gotoConsole(!0)):null!=missionRecord&&missionRecord.isSuccessful?_this.gotoMissionComplete(missionRecord):null!=missionRecord&&missionRecord.isMissingPart?_this.gotoPartsWorkshops():_this.gotoConsole(),MenuSignals.fadeToGame.add(_this.navigateToWorld),MenuSignals.resetMenu.add(_this.activateMissionConsole),MenuSignals.gotoHelpMission.add(_this.gotoHelpMission),MenuSignals.hideHomeBtn.add(_this.hideHomeBtn),MenuSignals.jiggleHomeBtn.add(_this.jiggleHomeBtn),app.on("resize",_this.resize)},this.teardown=function(){app.off("resize",_this.resize),_this.enableConsoleButtons(!1),MenuSignals.removeAll(),_this.mainMenuView.teardown(),_this.headMediatorSydney&&_this.headMediatorSydney.hide(),_this.timeout&&_this.timeout.teardown()},this.gotoConsole=function(showJet){void 0===showJet&&(showJet=!0),app.voPlayer.stop(),_this.transitioning||(_this.transitioning=!0,_this.navigateToConsole()),showJet&&_this.mainMenuView.menuConsole.showJet()},this.gotoMissionSelection=function(){if(!_this.transitioning){var showHome=!0;PlayerPrefs.tutStep==TutStep.GotoFirstMission&&(showHome=!1);var missionSelection=new MissionSelectionMediator(_this.mainMenuView.subMenuCont);_this.navigateToSubmenu(missionSelection,_this.levelSelectShot,showHome),_this.mainMenuView.playSFX("sfx-button-make"),_this.timeout.setClips(["level-to-1"]),app.analyticsEmitter.ClickedPlay(AnalyticsUtils.clickPos)}},this.gotoMissionComplete=function(missionRecord){var missionComplete=new MissionCompleteMediator(missionRecord,_this.mainMenuView.subMenuCont);_this.navigateToSubmenu(missionComplete,_this.mainMenuShot,!1),_this.mainMenuView.menuConsole.hideMenuConsole(),_this.mainMenuView.menuConsole.raise(),_this.timeout.setClips([])},this.playEngameVO=function(){PlayerPrefs.playEndgameVO=!1,setTimeout(function(){app.voPlayer.play(["end-payoff-mission-control-1","end-payoff-mission-control-2"])},50)},this.gotoPartsWorkshops=function(){if(!_this.transitioning){if(PlayerPrefs.tutStep==TutStep.WorkShopIntro){var partsWorkshop=new TutorialPartsWorkshopMediator(_this.mainMenuView.subMenuCont);_this.navigateToSubmenu(partsWorkshop,_this.subMenuShot,!1)}else{partsWorkshop=new PartsWorkshopMediator(_this.mainMenuView.subMenuCont);_this.navigateToSubmenu(partsWorkshop,_this.subMenuShot,!0)}_this.mainMenuView.playSFX("sfx-button-make"),_this.timeout.setClips([]),_this.headMediatorSydney&&_this.headMediatorSydney.show()}app.analyticsEmitter.ClickedMake(AnalyticsUtils.clickPos,app.wallet.resources)},this.gotoEditRobot=function(){if(!_this.transitioning){var editRobot=new EditRobotMediator(_this.mainMenuView.subMenuCont,_this.gotoConsole);_this.navigateToSubmenu(editRobot,_this.editMenuShot,!1),_this.mainMenuView.playSFX("sfx-button-edit"),_this.timeout.setClips([]),app.analyticsEmitter.ClickedEdit(AnalyticsUtils.clickPos)}},this.gotoHelpMission=function(){LevelLoader.requestHelpLevel(PlayerPrefs.partsUnlocked,function(){MenuSignals.fadeToGame.dispatch(),GameSignals.gotoWorld.dispatch()})},this.navigateToWorld=function(){_this.transitioning=!0,app.voPlayer.stop(),_this.hideCurrentSubmenu(),_this.currentScreen=_this.nullScreen,_this.mainMenuView.lookAt(_this.gameShot,.2),_this.mainMenuView.setHomeButtonVisibility(!1),_this.mainMenuView.setCloseButtonVisibility(!1),setTimeout(function(){_this.transitioning=!1},.2)},this.navigateToConsole=function(){_this.transitioning=!0,_this.hideCurrentSubmenu(),_this.mainMenuView.menuConsole.raise(),_this.enableConsoleButtons(!1),_this.mainMenuView.setHomeButtonVisibility(!1),_this.mainMenuView.setCloseButtonVisibility(!0),_this.mainMenuView.lookAt(_this.mainMenuShot,.2),PlayerPrefs.tutStep==TutStep.GotoFirstMission?_this.guideToFirstMission():PlayerPrefs.firstColourCrafted&&!PlayerPrefs.colourTutorialPlayed?_this.guidToEditScreen():(_this.mainMenuView.showPlayBtn(),_this.mainMenuView.showBackground(),_this.mainMenuView.menuConsole.showMenuConsole(_this.showEditBtn()),_this.highlightButtons(),setTimeout(function(){_this.enableConsoleButtons(!0),PlayerPrefs.firstColourCrafted?_this.timeout.setClips(["to-play","to-edit-mode"]):_this.timeout.setClips(["to-play"])},300)),setTimeout(function(){_this.transitioning=!1},200),app.lostFocus||app.sound.play("sfx-button-home"),_this.headMediatorSydney&&_this.headMediatorSydney.hide()},this.navigateToSubmenu=function(screen,camShot,showHomeBtn){_this.transitioning=!0,_this.hideCurrentSubmenu(),_this.mainMenuView.menuConsole.lower(),_this.currentScreen=screen,_this.mainMenuView.hidePlayBtn(),_this.mainMenuView.showBackground(),_this.disableFlashBtn(),_this.enableConsoleButtons(!1),setTimeout(function(){_this.currentScreen.show(),_this.mainMenuView.lookAt(camShot,.2)},.1),setTimeout(function(){_this.transitioning=!1,_this.mainMenuView.setHomeButtonVisibility(showHomeBtn),_this.mainMenuView.setCloseButtonVisibility(!1)},.3),_this.mainMenuView.menuConsole.resetButtonStates()},this.highlightButtons=function(){0==PlayerPrefs.partsUnlocked&&2<app.wallet.get(Constants.Earth)&&PlayerPrefs.readyForNextPart&&(app.voPlayer.play("new-part-mission-control"),_this.mainMenuView.menuConsole.hideEditButton(),_this.mainMenuView.menuConsole.editRobotBtn.interactive=!1)},this.hideCurrentSubmenu=function(){_this.currentScreen&&(_this.currentScreen.hide(),app.analyticsEmitter.ClickHome(AnalyticsUtils.clickPos,_this.currentScreen.analyticsID||"unknown"))},this.playGameIntro=function(){GameSignals.disableInput.dispatch(),_this.mainMenuView.menuConsole.showJet(),_this.hideHomeBtn(),_this.mainMenuView.hidePlayBtn(0),_this.mainMenuView.menuConsole.hideMenuConsole();var t=1500;app.voPlayer.delayedPlay("intro-1",t),app.voPlayer.delayedPlay("intro-2",t+=2e3),app.voPlayer.delayedPlay("intro-3",t+=2e3),app.voPlayer.delayedPlay("intro-4",t+=7500),app.voPlayer.delayedPlay("intro-6",t+=6e3),app.voPlayer.delayedPlay("onboarding-make-welcome-1",t+=1750),setTimeout(function(){PlayerPrefs.tutStep=TutStep.WorkShopIntro,GameSignals.enableInput.dispatch()},t),setTimeout(function(){_this.mainMenuView.menuConsole.showMakeButton()},t+=1650),setTimeout(function(){_this.mainMenuView.menuConsole.partsWorkshopBtn.interactive=!0,_this.mainMenuView.menuConsole.addChild(new ButtonHighlight("makeBtnGlow",30,305,2))},t+=1e3),_this.timeStamp=Date.now(),app.analyticsEmitter.startTutorial("menu intruduction"),GoogleAnalytics.sendTutorialBegin()},this.guideToFirstMission=function(){_this.hideHomeBtn(),_this.mainMenuView.hidePlayBtn(0),_this.mainMenuView.menuConsole.hideMenuConsole(),_this.enableConsoleButtons(!1);var t=0;app.voPlayer.delayedPlay("to-play",t+=200),setTimeout(function(){_this.timeout.setClips(["to-play"]),_this.mainMenuView.playButton.button.interactive=!0,_this.mainMenuView.showPlayBtn(0)},t+=400);var tutTime=Date.now()-_this.timeStamp;app.analyticsEmitter.endTutorial("menu intruduction",tutTime),GoogleAnalytics.sendTutorialComplete()},this.guidToEditScreen=function(){_this.hideHomeBtn(),_this.mainMenuView.menuConsole.hideMenuConsole(),_this.mainMenuView.hidePlayBtn(0),_this.enableConsoleButtons(!1),_this.timeout.setClips(["to-edit-mode"]);var t=0;app.voPlayer.delayedPlay("onboarding-ready-edit",t+=200),setTimeout(function(){_this.mainMenuView.menuConsole.showEditButton(),_this.mainMenuView.menuConsole.editRobotBtn.interactive=!0},t+=900),setTimeout(function(){_this.mainMenuView.menuConsole.addChild(new ButtonHighlight("makeBtnGlow",480,310,2.2))},t+=1100)},this.activateMissionConsole=function(){_this.gotoConsole(),_this.mainMenuView.menuConsole.animateMenuConsole(_this.showEditBtn())},this.enableConsoleButtons=function(isInteractive){_this.mainMenuView.menuConsole.partsWorkshopBtn.interactive=isInteractive,(_this.mainMenuView.playButton.button.interactive=isInteractive)&&PlayerPrefs.readyForNextPart&&_this.mainMenuView.menuConsole.partsWorkshopBtn.setFlash(!0),_this.showEditBtn()&&(_this.mainMenuView.menuConsole.editRobotBtn.interactive=isInteractive)},this.resize=function(offset){_this.mainMenuView.resize(offset)},this.hideHomeBtn=function(){_this.mainMenuView.setHomeButtonVisibility(!1)},this.jiggleHomeBtn=function(){_this.mainMenuView.setHomeButtonVisibility(!0),new ButtonJiggle(_this.mainMenuView.homeBtn)};var firstVisit=PlayerPrefs.tutStep==TutStep.Intro;this.mainMenuView=new MainMenuView(this.mainMenuShot,firstVisit),parent.addChildAt(this.mainMenuView,0),this.mainMenuView.x=-app.display.sideOffset,Device.lowEndDevice||(this.headMediatorSydney=new HeadMediatorSydney(this.mainMenuView.sydneyHead)),this.currentScreen=null,this.transitioning=!1,this.enableConsoleButtons(!1),this.mainMenuView.homeBtn.on("pointerup",this.gotoConsole),this.mainMenuView.menuConsole.editRobotBtn.on("pointerup",this.gotoEditRobot),this.mainMenuView.menuConsole.partsWorkshopBtn.on("pointerup",this.gotoPartsWorkshops),this.mainMenuView.playButton.button.on("pointerup",this.gotoMissionSelection),app.options.debug&&this.mainMenuView.debugMenuBtn.on("pointerup",this.mainMenuView.debugMenuView.show),this.init(missionRecord,firstVisit)}return MainMenuMediator.prototype.disableFlashBtn=function(){this.mainMenuView.menuConsole.partsWorkshopBtn.setFlash(!1),this.mainMenuView.menuConsole.editRobotBtn.setFlash(!1)},MainMenuMediator.prototype.showEditBtn=function(){return PlayerPrefs.firstColourCrafted},MainMenuMediator}(),MenuRobotMediator=function(parent){var _this=this;this.equipCurrentParts=function(){_this.equipBody(PlayerPrefs.robotBody),_this.equipPart(PlayerPrefs.robotLegs,Constants.Legs),_this.equipPart(PlayerPrefs.robotHead,Constants.Head),PlayerPrefs.robotBody&&PlayerPrefs.robotBody!=Constants.Parts_Body_Short&&_this.equipPart(PlayerPrefs.robotArms,Constants.Arms)},this.equipPart=function(partName,partType){partName&&partType&&(_this.menuRobotView.equipPart(partName,partType),_this.updatePartColour(partName,SkinColour.get(partName)))},this.equipBody=function(partName){partName&&(_this.menuRobotView.equipBody(partName),_this.updatePartColour(partName,SkinColour.get(partName)))},this.updatePartColour=function(partName,colour){_this.menuRobotView.updatePartSkin(partName,colour)},this.placeRobot=function(x,y){_this.menuRobotView.x=x,_this.menuRobotView.y=y},this.scaleRobot=function(s){_this.menuRobotView.scale.x=s,_this.menuRobotView.scale.y=s},this.menuRobotView=new MenuRobotView,parent.addChild(this.menuRobotView)},MissionCompleteMediator=function(){function MissionCompleteMediator(missionRecord,parent){var _this=this;this.show=function(){_this.missionCompleteView.reset(),_this.missionCompleteView.init(),Constants.Planets.forEach(function(planet,index){var amount=_this.getAmount(planet);planet==_this.missionRecord.planetName&&(amount=_this.getResourceAmountBeforeLevel(planet));var shouldActivate=!_this.planetService.isNextPlanetForProgression(index),isActivated=_this.planetService.isPlanetUnlocked(index)&&shouldActivate;_this.missionCompleteView.addResource(planet,amount,isActivated)}),_this.missionRecord&&(_this.missionCompleteView.setPlanet(PlayerPrefs.currentPlanet),_this.showRewardAnimation(),_this.playRewardVO(_this.missionRecord.hasAllStars()))},this.playRewardVO=function(hasAllStars){setTimeout(function(){if(MissionCompleteMediator.voCount++,MenuLoader.sunspotToggle=!MenuLoader.sunspotToggle,hasAllStars){vo=["alright","results-starriffic","jet-great-thinking","jet-youre-a-creative-builder","results-general-1","results-general-3"];app.voPlayer.play(vo[MissionCompleteMediator.voCount%vo.length])}else{var vo=["jet-great-thinking","jet-youre-a-creative-builder","results-general-1","results-general-3"];app.voPlayer.play(vo[MissionCompleteMediator.voCount%vo.length])}},1200)},this.hide=function(){_this.rewardTimeLine&&_this.rewardTimeLine.kill(),TweenLite.to(_this.missionCompleteView,.2,{alpha:0}),_this.missionCompleteView.disableButtons(),_this.missionCompleteView.teardown()},this.gotoMissionSelection=function(){_this.missionCompleteView.disableButtons(),MenuSignals.resetMenu.dispatch(),app.analyticsEmitter.ClickNext(AnalyticsUtils.clickPos)},this.missionRecord=missionRecord,this.planetService=new PlanetService(PlayerPrefs.levels),this.missionCompleteView=new MissionCompleteView,this.missionCompleteView.alpha=0,parent.addChild(this.missionCompleteView),this.missionCompleteView.nextButton.on("pointerdown",function(){_this.missionCompleteView.playSFX("sfx-next-arrow-2"),_this.gotoMissionSelection()}),this.hide()}return MissionCompleteMediator.prototype.getAmount=function(planet){return app.wallet.get(planet)},MissionCompleteMediator.prototype.getResourceAmountBeforeLevel=function(planet){return this.getAmount(planet)-this.missionRecord.resourcesCount},MissionCompleteMediator.prototype.showRewardAnimation=function(){var _this=this;this.rewardTimeLine=new TimelineLite,this.missionCompleteView.fadeIn(),this.missionCompleteView.showResourcePanel(this.rewardTimeLine,this.missionRecord.planetName,this.getResourceAmountBeforeLevel(this.missionRecord.planetName),this.missionRecord.resourcesCount,.5),this.missionCompleteView.showSunspot(1.2);var progressEndTime=this.missionCompleteView.getProgressAnimationTime(this.missionRecord.starCount,this.missionRecord.totalStarCount)+2;this.missionCompleteView.animateProgress(this.rewardTimeLine,this.missionRecord.starCount,this.missionRecord.totalStarCount,2,progressEndTime),this.missionRecord.hasAllStars()&&(this.missionCompleteView.playStar(this.rewardTimeLine,progressEndTime),this.rewardTimeLine.add(function(){return _this.missionCompleteView.playSFX("sfx-collect-star")},progressEndTime)),this.missionCompleteView.playNextButtonAnimation(this.rewardTimeLine,progressEndTime)},MissionCompleteMediator.voCount=0,MissionCompleteMediator}(),MissionSelectionMediator=function(){function MissionSelectionMediator(parent){var _this=this;this.currentPlanetIndex=0,this.currentPlanetOverride=-1,this.levelBuffer=0,this.shouldAnimateTransition=function(lvl){if(lvl)for(var i=0;i<4;i++){var finalLevelNr=9*(i+1)-1;if(lvl.levelNr==finalLevelNr&&lvl.completed&&!PlayerPrefs.payoffPlayed[i])return PlayerPrefs.payoffPlayed[i]=!0}return!1},this.show=function(){var lvl=PlayerPrefs.currentLevel,animateTransition=_this.shouldAnimateTransition(lvl);_this.disableLevelButtonsForTransition(),TweenLite.to(_this.missionSelectionView,.2,{alpha:1});var planetIndex=_this.getCurrentPlanetIndex(animateTransition);_this.updateSelectedPlanet(planetIndex),_this.missionSelectionView.scrollToPlanet(_this.currentPlanetIndex,!0),animateTransition?_this.playTransitionTutorial(_this.currentPlanetIndex):(_this.updatePlanets(),PlayerPrefs.tutStep==TutStep.GotoFirstMission?(PlayerPrefs.tutStep=TutStep.Complete,_this.playTutorialVO()):_this.playPlanetVO())},this.hide=function(){TweenLite.to(_this.missionSelectionView,.2,{alpha:0}),_this.missionSelectionView.disableButtons(),_this.timeout&&clearTimeout(_this.timeout)},this.playTransitionTutorial=function(missionID){GameSignals.disableInput.dispatch(),_this.missionSelectionView.setChallengeAvailable(!1),_this.unlockPlanetsUpTo(Math.floor(PlayerPrefs.currentLevel.levelNr/9));PlayerPrefs.currentLevel.levelNr;var t=300;setTimeout(function(){_this.missionSelectionView.flashLevelButtons(),app.sound.play("Xylophone")},t),t+=1500,setTimeout(_this.missionSelectionView.flashChallengeButton,t),t+=1e3,setTimeout(function(){_this.updateSelectedPlanet(_this.currentPlanetIndex+1),_this.missionSelectionView.scrollToPlanet(_this.currentPlanetIndex)},t),t+=500,setTimeout(function(){var voName="planet-unlocked-"+Constants.Planets[_this.currentPlanetIndex].toLocaleLowerCase();_this.missionSelectionView.planetUnlockAnim(_this.currentPlanetIndex),app.voPlayer.play(voName)},t),t+=500,setTimeout(function(){_this.updatePlanets(),app.sound.play("PlanetUnlock")},t),t+=200,setTimeout(function(){_this.missionSelectionView.enableButtons(!1),GameSignals.enableInput.dispatch()},t)},this.updatePlanets=function(){_this.missionSelectionView.planetViews.forEach(function(planetView,index){planetView.updateUnlockedState(_this.planetService.isPlanetUnlocked(index))})},this.unlockPlanetsUpTo=function(lastUnlocked){_this.missionSelectionView.planetViews.forEach(function(planetView,index){var isUnlocked=index<=lastUnlocked;planetView.updateUnlockedState(isUnlocked)})},this.getCurrentPlanetIndex=function(animateTransition){var lvl=PlayerPrefs.currentLevel;return animateTransition&&lvl?PlanetService.planetIdFromLevel(lvl.levelNr):-1!=_this.currentPlanetOverride?_this.currentPlanetOverride:PlanetService.planetIdFromLevel(PlayerPrefs.levels.length)},this.assignLevelButtons=function(){for(var lvlBtns=_this.missionSelectionView.levelBtns,_loop_1=function(i){lvlBtns[i].on("pointerdown",function(){return _this.playLevel(i+_this.levelBuffer)})},i=0;i<lvlBtns.length;i++)_loop_1(i)},this.isTutorialLevel=function(levelNr){return levelNr<2},this.playLevel=function(levelNr){if(PlayerPrefs.currentLevelNumber=levelNr+1-_this.levelBuffer,_this.currentPlanetOverride=-1,44==levelNr)_this.playFinalLevel(levelNr);else if(levelNr==PlayerPrefs.levels.length){var firstSpringLevel=0<PlayerPrefs.partsUnlocked&&!PlayerPrefs.springTutPlayed;_this.isTutorialLevel(levelNr)?_this.playTutorialLevel(levelNr):PlayerPrefs.nextLevel?_this.playNextLevel():firstSpringLevel?_this.playSpringLevel(levelNr):_this.playNewLevel()}else levelNr<PlayerPrefs.levels.length?_this.replayOldLevel(levelNr):console.warn("Trying to play a future level: ",levelNr);app.analyticsEmitter.ClickedLevel("NA",AnalyticsUtils.clickPos,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},this.playFinalLevel=function(levelNr){if(43<PlayerPrefs.levels.length){var lvl=new LevelInfo("convention",null,levelNr);LevelLoader.requestLevel(lvl,_this.gotoLevel)}},this.playTutorialLevel=function(levelNr){var levelID;levelID=0==levelNr?"a002":"a004";var problemID=LevelLoader.getProblemFromLevel(levelID),lvl=new LevelInfo(levelID,problemID,levelNr);LevelLoader.requestLevel(lvl,_this.gotoLevel)},this.playSpringLevel=function(levelNr){PlayerPrefs.springTutPlayed=!0,PlayerPrefs.swapPartTut=!0;var problemID=LevelLoader.getProblemFromLevel("b001"),lvl=new LevelInfo("b001",problemID,levelNr);LevelLoader.requestLevel(lvl,_this.gotoLevel)},this.playNextLevel=function(){PlayerPrefs.nextLevel?(PlayerPrefs.nextLevel.isTutorial&&HelpMissionUtils.setupRobot(PlayerPrefs.partsUnlocked),LevelLoader.requestLevel(PlayerPrefs.nextLevel,_this.gotoLevel)):(console.error("next level required"),_this.playNewLevel())},this.playNewLevel=function(){LevelLoader.requestNextLevel(function(){PlayerPrefs.nextLevel=PlayerPrefs.currentLevel,_this.gotoLevel()},!1,!0)},this.replayOldLevel=function(levelid){var levelInfo=PlayerPrefs.levels[levelid];LevelLoader.requestLevel(levelInfo,function(){PlayerPrefs.currentLevel.attempt++,PlayerPrefs.currentLevel.isTutorial=!1,_this.gotoLevel()})},this.playChallengeLevel=function(){_this.currentPlanetOverride=_this.currentPlanetIndex,LevelLoader.requestNextLevel(function(){PlayerPrefs.currentLevel.levelNr=-1,PlayerPrefs.currentLevel.isChallenge=!0,_this.gotoLevel()},!0,!0),app.voPlayer.play("select-challenge")},this.gotoLevel=function(){_this.missionSelectionView.disableButtons(),MenuSignals.fadeToGame.dispatch(),GameSignals.gotoWorld.dispatch()},this.tryChangePlanet=function(desiredPlanet){0<=desiredPlanet&&desiredPlanet<Constants.Planets.length&&(_this.updateSelectedPlanet(desiredPlanet),_this.missionSelectionView.scrollToPlanet(_this.currentPlanetIndex),_this.disableLevelButtonsForTransition(),_this.playPlanetVO(),app.analyticsEmitter.ClickedPlanet(AnalyticsUtils.clickPos,Constants.Planets[desiredPlanet])),_this.timeout&&clearTimeout(_this.timeout)},this.updateSelectedPlanet=function(planetIndex){_this.currentPlanetIndex=MathUtils.clamp(planetIndex,0,Constants.Planets.length-1),PlayerPrefs.currentPlanet=Constants.Planets[_this.currentPlanetIndex],_this.levelBuffer=_this.currentPlanetIndex*Constants.LevelsPerPlanet,_this.missionSelectionView.updateButtonTextures(PlayerPrefs.levels,_this.levelBuffer),_this.missionSelectionView.setChallengeAvailable(_this.challengeAvailable)},this.playPlanetVO=function(){try{app.voPlayer.play(["select-earth","select-earths-moon","select-mars","select-enceladus","select-bortron7"][_this.currentPlanetIndex]),_this.missionSelectionView.playSFX("sfx-button-5")}catch(e){}},this.playTutorialVO=function(){_this.missionSelectionView.playSFX("sfx-button-5"),setTimeout(function(){app.voPlayer.play(["onboarding-lvl-select-1","onboarding-lvl-select-2"]),_this.missionSelectionView.addChild(new ButtonHighlight("diamondHighlight",357,592))},300),_this.timeout=setTimeout(function(){_this.missionSelectionView.addChild(new ButtonHighlight("diamondHighlight",357,592)),PlayerPrefs.tutStep=TutStep.Complete},9100)},this.disableLevelButtonsForTransition=function(){PlayerPrefs.tutStep!=TutStep.GotoFirstMission&&(_this.missionSelectionView.disableButtons(),setTimeout(function(){_this.missionSelectionView.enableButtons(_this.challengeAvailable)},400))},this.planetService=new PlanetService(PlayerPrefs.levels),this.missionSelectionView=new MissionSelectionView,this.missionSelectionView.alpha=0,parent.addChild(this.missionSelectionView),this.currentPlanetIndex=0,this.assignLevelButtons(),this.missionSelectionView.challengeBtn.on("pointerdown",this.playChallengeLevel),this.missionSelectionView.nextPlanetBtn.on("pointerdown",function(){_this.missionSelectionView.playSFX("sfx-button-5"),_this.tryChangePlanet(_this.currentPlanetIndex+1)}),this.missionSelectionView.previousPlanetBtn.on("pointerdown",function(){_this.missionSelectionView.playSFX("sfx-button-5"),_this.tryChangePlanet(_this.currentPlanetIndex-1)})}return Object.defineProperty(MissionSelectionMediator.prototype,"challengeAvailable",{get:function(){return PlayerPrefs.levels.length>=this.levelBuffer+Constants.LevelsPerPlanet},enumerable:!1,configurable:!0}),MissionSelectionMediator}(),MoveTutorial=function(worldMediator,worldView){var _this=this;this.playedVO1=!1,this.playedVO2=!1,this.update=function(){_this.worldMediator.robot&&(660<_this.worldMediator.robot.x&&!_this.playedVO1?_this.moveVO():1400<_this.worldMediator.robot.x&&!_this.playedVO2&&_this.resourceVO())},this.moveVO=function(){_this.playedVO1=!0,app.voPlayer.play("onboarding-movement-4")},this.resourceVO=function(){_this.playedVO2=!0,app.voPlayer.play("onboarding-first-bolt"),_this.worldView.gameUI.controls.hide(),_this.worldMediator.enabled=!1,GameSignals.disableInput.dispatch(.2),_this.worldMediator.gamePhysix.setXVelocity(0),_this.worldMediator.robot.legs.update(0),setTimeout(function(){_this.worldView.gameCont.addChild(new ButtonHighlight("smallCircleGlow",1720,650,1.5))},1800),setTimeout(function(){_this.worldMediator.enabled=!0,GameSignals.enableInput.dispatch(),_this.worldView.gameUI.controls.showMovementControlls()},1e4)},this.teardown=function(){},this.worldMediator=worldMediator,this.worldView=worldView,PlayerPrefs.moveTutorialPlayed=!0,this.worldView.gameUI.controls.hide(),setTimeout(function(){_this.worldView.gameUI.controls.showMovementControlls()},550)},PartsWorkshopMediator=function(){function PartsWorkshopMediator(parent){var _this=this;this.partCrafted=function(part){GameSignals.disableInput.dispatch(),_this.partsWorkshopView.clearSlot(0),_this.partsWorkshopView.clearSlot(0),app.wallet.buyPart(part.cost),app.unlockManager.unlockNextPart(),_this.partsWorkshopView.updateCanBuy(),_this.partsWorkshopView.updateResources(app.wallet.getAll()),part.type==Constants.Body?_this.menuRobot.equipBody(part.name):_this.menuRobot.equipPart(part.name,part.type),PlayerPrefs.saveResources(app.wallet),PlayerPrefs.saveParts(app.unlockManager),MenuSignals.hideHomeBtn.dispatch(),_this.partsWorkshopView.playCraftingPayoff(0),setTimeout(function(){HelpMissionUtils.setupRobot(PlayerPrefs.partsUnlocked),MenuSignals.gotoHelpMission.dispatch()},1500),app.analyticsEmitter.BuiltPart(part.cost,app.wallet.resources),GoogleAnalytics.sendCurrencySpent(part.cost)},this.skinCrafted=function(skin,index){app.wallet.buyPart(skin.cost),PlayerPrefs.saveResources(app.wallet),_this.partsWorkshopView.playSFX("sfx-button-build"),_this.partsWorkshopView.updateCanBuy(),SkinColour.setUnlocked(skin.partName,skin.colour),_this.partsWorkshopView.addSkinUnlockPlaceholder(index),_this.partsWorkshopView.updateResources(app.wallet.getAll());var clips=["part-variant-1","part-variant-2"];app.voPlayer.play(clips[Math.floor(Math.random()*clips.length)]),PlayerPrefs.firstColourCrafted?(SkinColour.set(skin.partName,skin.colour),_this.menuRobot.updatePartColour(skin.partName,skin.colour)):_this.guidToEditScreen(skin),app.analyticsEmitter.BuiltPaint(skin.cost,app.wallet.resources),GoogleAnalytics.sendCurrencySpent(skin.cost)},this.guidToEditScreen=function(skin){PlayerPrefs.saveFirstColourCrafted(skin),_this.partsWorkshopView.clearSlot(0),_this.partsWorkshopView.clearSlot(0),setTimeout(MenuSignals.jiggleHomeBtn.dispatch,300)},this.getRandomUnlockableSkins=function(){var unlockableSkins=SkinColour.getUnlockableSkins();if(0==unlockableSkins.length)return[];if(1==unlockableSkins.length)return unlockableSkins;for(var randomSkins=[],i=0;i<2;i++){var randID=Math.floor(Math.random()*unlockableSkins.length);randomSkins.push(unlockableSkins[randID]),unlockableSkins.splice(randID,1)}return randomSkins},this.partsWorkshopView=new PartsWorkshopView,this.partsWorkshopView.alpha=0,parent.addChild(this.partsWorkshopView),this.menuRobot=new MenuRobotMediator(this.partsWorkshopView),this.menuRobot.placeRobot(950,510),this.menuRobot.scaleRobot(1)}return Object.defineProperty(PartsWorkshopMediator,"analyticsID",{get:function(){return"Build screen"},enumerable:!1,configurable:!0}),PartsWorkshopMediator.prototype.show=function(){var resources=app.wallet.getAll();this.partsWorkshopView.updateResources(resources),this.updateParts(),TweenLite.to(this.partsWorkshopView,.2,{alpha:1})},PartsWorkshopMediator.prototype.hide=function(){this.partsWorkshopView.clearSlots(),TweenLite.to(this.partsWorkshopView,.2,{alpha:0})},PartsWorkshopMediator.prototype.updateParts=function(){var canBuyPart=!1,morePartsAvailable=EnlearnUtils.hasNextStep();if(morePartsAvailable&&PlayerPrefs.readyForNextPart){var nextPart=app.unlockManager.nextAvailablePart();this.partsWorkshopView.addCraftablePart(nextPart,this.partCrafted),canBuyPart=app.wallet.canBuy(nextPart.cost)}this.updateSkins(),this.playVO(morePartsAvailable,canBuyPart)},PartsWorkshopMediator.prototype.playVO=function(morePartsAvailable,canBuyPart){morePartsAvailable&&PlayerPrefs.readyForNextPart?canBuyPart?app.voPlayer.play(app.rand("make-part-1","make-part-2")):.5<Math.random()?app.voPlayer.play("need-resources-2"):app.voPlayer.play(["need-resources-1","need-resources-3"]):morePartsAvailable?app.voPlayer.play("make-no-new-parts"):0==SkinColour.getUnlockableSkins().length&&app.voPlayer.play(app.rand("make-all-created-1","make-all-created-2"))},PartsWorkshopMediator.prototype.updateSkins=function(){var craftableSkins=this.getRandomUnlockableSkins();this.partsWorkshopView.addCraftableSkins(craftableSkins,this.skinCrafted)},PartsWorkshopMediator}(),RobotConvention=function(worldMediator,worldView){var _this=this;this.closestRobot=-1,this.voID=0,this.vo=[["robot-actor-3-2","robot-actor-3-3","robot-actor-3-5","robot-actor-3-8"],["robot-actor-1-1","robot-actor-1-2","robot-actor-1-4","robot-actor-1-7"],["robot-actor-2-1","robot-actor-2-2","robot-actor-2-8","robot-actor-2-9"],["robot-actor-4-1","robot-actor-4-2","robot-actor-4-5","robot-actor-4-14"]],this.update=function(){_this.star&&MathUtils.squareDistance(_this.star,_this.worldMediator.robot)<6400&&_this.EndGame()},this.teardown=function(){_this.robots.forEach(function(robot){robot.teardown()}),clearInterval(_this.voTO)},this.tryTriggerVO=function(){for(var closestRobot=-1,i=0;i<4;i++)if(MathUtils.squareDistance(_this.robots[i],_this.worldMediator.robot)<14400){closestRobot=i;break}closestRobot!=_this.closestRobot&&(_this.closestRobot=closestRobot,-1!=_this.closestRobot&&(_this.voID=(_this.voID+1)%4,app.voPlayer.play(_this.vo[_this.closestRobot][_this.voID])))},this.AddStar=function(){_this.star=new PIXI.Sprite(Textures.get("starLarge")),_this.star.anchor.x=_this.star.anchor.y=.5,_this.star.x=1850,_this.star.y=600,_this.worldView.gameCont.addChild(_this.star)},this.EndGame=function(){_this.worldView.gameUI.HideTopUI(),PlayerPrefs.playEndgameVO=!0,app.voPlayer.stop(),app.sound.play("sfx-star-hit"),_this.star.parent.removeChild(_this.star),_this.star=null;var discoBall=new PIXI.spine.Spine(Animations.get("discoBall"));discoBall.scale.x=discoBall.scale.y=.75,discoBall.x=620,discoBall.y=100,_this.worldView.addChild(discoBall),discoBall.state.setAnimation(0,"DiscoDrop",!1),setTimeout(function(){discoBall.state.setAnimation(1,"DiscoRotate",!0),_this.discoParticles=new ParticlesView(Particles.get("Disco"),["DiscoLight1","DiscoLight2","DiscoLight3"]),_this.worldView.addChild(_this.discoParticles),_this.discoParticles.playOnce(),app.sound.play("fanfare")},600),setTimeout(function(){_this.discoParticles&&(_this.discoParticles.emitter.emit=!1,_this.discoParticles.emitter.autoUpdate=!1)},6900),setTimeout(function(){WorldSignals.completeLevel.dispatch()},7e3)},this.addBG=function(){var stage=new PIXI.Sprite(Textures.get("stage"));stage.x=1500,stage.y=282,_this.worldView.gameCont.addChildAt(stage,0)},this.addRobots=function(){var robot1=new DancingRobot(560,830,"robot0");_this.worldView.gameCont.addChildAt(robot1,1);var robot2=new DancingRobot(840,830,"robot1",.02,112,2);_this.worldView.gameCont.addChildAt(robot2,1);var robot3=new DancingRobot(1250,830,"robot2",.02,182,2);_this.worldView.gameCont.addChildAt(robot3,1);var robot4=new DancingRobot(1450,830,"robot3",.02,112,2);_this.worldView.gameCont.addChildAt(robot4,1),_this.robots=[robot1,robot2,robot3,robot4]},this.worldMediator=worldMediator,this.worldView=worldView,this.addBG(),this.addRobots(),this.AddStar(),this.voTO=setInterval(this.tryTriggerVO,300)},GameSignals=function(){function GameSignals(){}return GameSignals.gotoWorld=new signals.Signal,GameSignals.gotoMainMenu=new signals.Signal,GameSignals.enableInput=new signals.Signal,GameSignals.disableInput=new signals.Signal,GameSignals.removeAll=function(){for(var key in GameSignals){var value=GameSignals[key];value instanceof signals.Signal&&value.removeAll()}},GameSignals}(),MenuSignals=function(){function MenuSignals(){}return MenuSignals.resetMenu=new signals.Signal,MenuSignals.fadeToGame=new signals.Signal,MenuSignals.gotoHelpMission=new signals.Signal,MenuSignals.jiggleHomeBtn=new signals.Signal,MenuSignals.hideHomeBtn=new signals.Signal,MenuSignals.removeAll=function(){for(var key in MenuSignals){var value=MenuSignals[key];value instanceof signals.Signal&&value.removeAll()}},MenuSignals}(),WorldSignals=function(){function WorldSignals(){}return WorldSignals.exitBtnDown=new signals.Signal,WorldSignals.trySelectLegs=new signals.Signal,WorldSignals.selectLegs=new signals.Signal,WorldSignals.updateSelectedColour=new signals.Signal,WorldSignals.updateDescription=new signals.Signal,WorldSignals.showEditPartDesc=new signals.Signal,WorldSignals.trySelectArms=new signals.Signal,WorldSignals.selectArms=new signals.Signal,WorldSignals.trySelectBody=new signals.Signal,WorldSignals.selectBody=new signals.Signal,WorldSignals.trySelectHead=new signals.Signal,WorldSignals.selectHead=new signals.Signal,WorldSignals.showHeatVision=new signals.Signal,WorldSignals.hideHeatVision=new signals.Signal,WorldSignals.respawnPositionUpdate=new signals.Signal,WorldSignals.collectStar=new signals.Signal,WorldSignals.restartGame=new signals.Signal,WorldSignals.playRobotAnim=new signals.Signal,WorldSignals.drillTile=new signals.Signal,WorldSignals.showFoamGrid=new signals.Signal,WorldSignals.hideFoamGrid=new signals.Signal,WorldSignals.updateCracks=new signals.Signal,WorldSignals.hideCracks=new signals.Signal,WorldSignals.setDrillTargetView=new signals.Signal,WorldSignals.pingSonar=new signals.Signal,WorldSignals.useArms=new signals.Signal,WorldSignals.tryGrabResources=new signals.Signal,WorldSignals.clickGameCont=new signals.Signal,WorldSignals.foamTile=new signals.Signal,WorldSignals.FoamColliderOn=new signals.Signal,WorldSignals.collectResource=new signals.Signal,WorldSignals.meltIceWall=new signals.Signal,WorldSignals.onFloorEnter=new signals.Signal,WorldSignals.onFloorExit=new signals.Signal,WorldSignals.onTileUpdate=new signals.Signal,WorldSignals.setArmsBtnState=new signals.Signal,WorldSignals.setSelectedPart=new signals.Signal,WorldSignals.enlearnAttempt=new signals.Signal,WorldSignals.completeLevel=new signals.Signal,WorldSignals.showPartScaffold=new signals.Signal,WorldSignals.openLegsMenu=new signals.Signal,WorldSignals.closeHUDTray=new signals.Signal,WorldSignals.flashMenuButtons=new signals.Signal,WorldSignals.removeAll=function(){for(var key in WorldSignals){var value=WorldSignals[key];value instanceof signals.Signal&&value.removeAll()}},WorldSignals}(),SwapPartTutorial=function(worldView){var _this=this;this.highlightLegs=function(){_this.worldView.gameUI.hud.addChild(new ButtonHighlight("hudBtnGlow",40,520)),_this.highlightLegsTo=setTimeout(_this.highlightLegs,1e3)},this.onOpenLegs=function(){clearInterval(_this.highlightLegsTo),WorldSignals.openLegsMenu.remove(_this.onOpenLegs),app.voPlayer.play("onboarding-select-springs"),setTimeout(function(){WorldSignals.showPartScaffold.dispatch("Ledge1or2Tiles")},500)},this.onSelectSprings=function(legs){legs==Constants.Parts_Springs&&(WorldSignals.selectLegs.remove(_this.onSelectSprings),app.voPlayer.play("onboarding-springs-great"))},this.update=function(){},this.teardown=function(){},PlayerPrefs.swapPartTut=!1,this.worldView=worldView,PlayerPrefs.swapTutorialPlayed=!0,WorldSignals.trySelectLegs.dispatch(Constants.Parts_Wheels),app.voPlayer.delayedPlay("onboarding-select-legs",200),this.highlightLegsTo=setTimeout(this.highlightLegs,5500),WorldSignals.selectLegs.add(this.onSelectSprings),WorldSignals.openLegsMenu.add(this.onOpenLegs)},TutorialPartsWorkshopMediator=function(parent){var _this=this;this.show=function(){TweenLite.to(_this.partsWorkshopView,.2,{alpha:1}),_this.initResources(),_this.playInto()},this.hide=function(){_this.partsWorkshopView.clearSlots(),TweenLite.to(_this.partsWorkshopView,.2,{alpha:0}),clearInterval(_this.jiggleInterval)},this.initResources=function(){app.wallet.reset();var resources=app.wallet.getAll();_this.partsWorkshopView.updateResources(resources)},this.playInto=function(){app.wallet.set(Constants.Earth,0),_this.addLegs();var t=300;app.voPlayer.delayedPlay("onboarding-make-welcome-2",t),setTimeout(function(){return _this.highlightPart(0)},t+=2500),app.voPlayer.delayedPlay("onboarding-make-welcome-3",t),app.voPlayer.delayedPlay("onboarding-make-welcome-6",t+=3500),setTimeout(_this.highlightRequiredResources,t),app.voPlayer.delayedPlay("onboarding-make-welcome-7",t+=3300),setTimeout(_this.addInitialResources,t),app.voPlayer.delayedPlay("onboarding-make-welcome-8",t+=3500),setTimeout(_this.showLegHammer,t)},this.showLegHammer=function(){_this.partsWorkshopView.updateCanBuy(),_this.partsWorkshopView.jiggleButtons(),clearInterval(_this.jiggleInterval),_this.jiggleInterval=setInterval(_this.partsWorkshopView.jiggleButtons,1400)},this.addLegs=function(){var legs=new CraftablePart(Constants.Parts_Wheels);_this.partsWorkshopView.addCraftablePart(legs,_this.onCraftLegs)},this.highlightPart=function(id){var y=300+162*id;_this.partsWorkshopView.addChild(new ButtonHighlight("buildPartGlow",550,y))},this.onCraftLegs=function(part){_this.buyPartPayoff(),_this.updateTutorialBot(1);var t=100;app.voPlayer.delayedPlay("onboarding-make-welcome-9",t),setTimeout(function(){var body=new CraftablePart(Constants.Parts_Body_Med);_this.partsWorkshopView.addCraftablePart(body,_this.onCraftBody)},t+=300),app.voPlayer.delayedPlay("onboarding-make-welcome-10",t+=900)},this.onCraftBody=function(part){_this.buyPartPayoff(),_this.updateTutorialBot(2);var t=100;app.voPlayer.delayedPlay("onboarding-make-welcome-11",t),setTimeout(function(){var head=new CraftablePart(Constants.Parts_Head_Normal);_this.partsWorkshopView.addCraftablePart(head,_this.onCraftHead)},t+=300)},this.onCraftHead=function(part){_this.buyPartPayoff(),_this.updateTutorialBot(3);var t=100;app.voPlayer.delayedPlay("onboarding-make-welcome-12",t),setTimeout(function(){var arms=new CraftablePart(Constants.Parts_Pincer);_this.partsWorkshopView.addCraftablePart(arms,_this.onCraftArms)},t+=300)},this.onCraftArms=function(part){_this.buyPartPayoff(),_this.updateTutorialBot(4);var t=100;app.voPlayer.delayedPlay("onboarding-make-welcome-13",t),app.voPlayer.delayedPlay("onboarding-make-welcome-14",t+=1500),app.voPlayer.delayedPlay("onboarding-make-welcome-15",t+=3400),app.voPlayer.delayedPlay("onboarding-make-welcome-16",t+=5100),setTimeout(function(){PlayerPrefs.tutStep=TutStep.GotoFirstMission,MenuSignals.jiggleHomeBtn.dispatch(),clearInterval(_this.jiggleInterval),_this.jiggleInterval=setInterval(MenuSignals.jiggleHomeBtn.dispatch,1400)},t+=300)},this.buyPartPayoff=function(){_this.partsWorkshopView.clearSlot(0),app.wallet.buyPart([3,0,0,0,0]),_this.partsWorkshopView.updateResources(app.wallet.getAll()),_this.partsWorkshopView.playCraftingPayoff(0)},this.highlightRequiredResources=function(){_this.partsWorkshopView.addChild(new ButtonHighlight("resourceGlow",610,280))},this.addInitialResources=function(){_this.partsWorkshopView.addChild(new ButtonHighlight("smallCircleGlow",480,150));for(var _loop_2=function(i){setTimeout(function(){app.wallet.set(Constants.Earth,i),_this.partsWorkshopView.updateResources(app.wallet.getAll())},30*i)},i=1;i<13;i++)_loop_2(i)},this.updateTutorialBot=function(step){_this.tutorialRobot&&_this.partsWorkshopView.removeChild(_this.tutorialRobot),_this.tutorialRobot=new PIXI.Sprite(Textures.get("botTut"+step)),_this.tutorialRobot.scale.x=_this.tutorialRobot.scale.y=1.2,_this.tutorialRobot.anchor.x=.5,_this.tutorialRobot.anchor.y=1,_this.tutorialRobot.x=950,_this.tutorialRobot.y=520,_this.partsWorkshopView.addChild(_this.tutorialRobot)},this.partsWorkshopView=new PartsWorkshopView,this.partsWorkshopView.alpha=0,parent.addChild(this.partsWorkshopView)},UnlockColourAnim=function(_super){function UnlockColourAnim(pos){var _this=_super.call(this)||this;return _this.x=pos.x+40,_this.y=pos.y+38,_this.lockImg=new PIXI.Sprite(Textures.get("colourLocked")),_this.lockImg.anchor.x=_this.lockImg.anchor.y=.5,_this.lockImg.scale.x=_this.lockImg.scale.y=.8,_this.addChild(_this.lockImg),setTimeout(function(){_this.lockImg.texture=Textures.get("unlocked"),_this.lockImg.scale.x=_this.lockImg.scale.y=.3,TweenLite.to(_this.lockImg.scale,.2,{x:.9,y:.9}),_this.addSplats()},900),setTimeout(function(){_this.parent.removeChild(_this)},1700),_this}return __extends(UnlockColourAnim,_super),UnlockColourAnim.prototype.addSplats=function(){for(var i=0;i<35;i++){var texName="splat_"+(1+Math.floor(4*Math.random())),splat=new PIXI.Sprite(Textures.get(texName)),destX=500*Math.random()-250,destY=500*Math.random()-250;TweenLite.to(splat,.3,{x:destX,y:destY,alpha:0}),this.addChild(splat)}},UnlockColourAnim}(PIXI.Container),WorldComsMonitorMediator=function(comsView){var _this=this;this.teardown=function(){app.voPlayer.off("start",_this.onVoStart),clearTimeout(_this.hideTimeout),clearTimeout(_this.stopTalkingTimeout)},this.show=function(info){_this.comsView.setCharacter(info.char),_this.comsView.startTalking(),clearTimeout(_this.hideTimeout),clearTimeout(_this.stopTalkingTimeout),_this.stopTalkingTimeout=setTimeout(_this.stopTalking,info.duration),_this.hideTimeout=setTimeout(_this.hide,info.duration+750),_this.onScreen||(_this.onScreen=!0,_this.comsView.show())},this.stopTalking=function(){_this.comsView.stopTalking()},this.hide=function(){clearTimeout(_this.hideTimeout),clearTimeout(_this.stopTalkingTimeout),_this.onScreen&&(_this.onScreen=!1,_this.comsView.hide())},this.onVoStart=function(clip){var voInfo=_this.clips[clip];voInfo?_this.show(voInfo):_this.hide()},this.setupVOTriggers=function(){app.voPlayer.on("start",_this.onVoStart),_this.clips=[],_this.clips["fail-1"]=new VOInfo(3600,"Jet"),_this.clips["fail-2"]=new VOInfo(4600,"Jet"),_this.clips["d-fail-booster-ice"]=new VOInfo(5100,"Jet"),_this.clips["d-fail-drill-ground"]=new VOInfo(3800,"Jet"),_this.clips["d-fail-dry-ground"]=new VOInfo(5600,"Jet"),_this.clips["d-fail-foam-higher"]=new VOInfo(6500,"Jet"),_this.clips["d-fail-foamer-gap"]=new VOInfo(4400,"Jet"),_this.clips["d-fail-foamer-ledge"]=new VOInfo(3e3,"Jet"),_this.clips["d-fail-ground-gap"]=new VOInfo(3600,"Jet"),_this.clips["d-fail-high-wall-gap"]=new VOInfo(5500,"Jet"),_this.clips["d-fail-ice-wall-moving"]=new VOInfo(6200,"Jet"),_this.clips["d-fail-ice-wall"]=new VOInfo(7e3,"Jet"),_this.clips["d-fail-large-ground-gap"]=new VOInfo(6e3,"Jet"),_this.clips["d-fail-ledge"]=new VOInfo(4520,"Jet"),_this.clips["d-fail-narrow-tunnel"]=new VOInfo(5e3,"Jet"),_this.clips["d-fail-pincer-gap"]=new VOInfo(2700,"Jet"),_this.clips["d-fail-rocket-higher"]=new VOInfo(3780,"Jet"),_this.clips["d-fail-rocky-terrain"]=new VOInfo(7200,"Jet"),_this.clips["d-fail-small-tunnel"]=new VOInfo(4e3,"Jet"),_this.clips["d-fail-spring-ledge"]=new VOInfo(2800,"Jet"),_this.clips["d-fail-tall-gap"]=new VOInfo(2900,"Jet"),_this.clips["d-fail-tall-ledge"]=new VOInfo(7e3,"Jet"),_this.clips["d-fail-tread-booster"]=new VOInfo(5600,"Jet"),_this.clips["d-fail-treads-rocky"]=new VOInfo(3400,"Jet"),_this.clips["d-fail-wall-gap"]=new VOInfo(7500,"Jet"),_this.clips["d-fail-wings-gap"]=new VOInfo(5e3,"Jet"),_this.clips["d-fail-xtall-ledge"]=new VOInfo(6500,"Jet"),_this.clips["onboarding-select-legs"]=new VOInfo(6e3,"Jet"),_this.clips["onboarding-select-springs"]=new VOInfo(1600,"Jet"),_this.clips["onboarding-springs-great"]=new VOInfo(6300,"Jet"),_this.clips["onboarding-movement-4"]=new VOInfo(1500,"Jet"),_this.clips["onboarding-first-bolt"]=new VOInfo(10700,"Jet"),_this.clips["onboarding-bolt-gap"]=new VOInfo(5800,"Jet"),_this.clips["new-part-required"]=new VOInfo(4800,"Jet"),_this.clips["test-springs"]=new VOInfo(9400,"Sean"),_this.clips["test-tread"]=new VOInfo(6200,"Sean"),_this.clips["test-drill-desktop"]=new VOInfo(8150,"Sean"),_this.clips["test-drill-touch"]=new VOInfo(7300,"Sean"),_this.clips["test-foamer-this-arm-can-make"]=new VOInfo(2e3,"Sean"),_this.clips["test-foamer-activate-desktop"]=new VOInfo(3e3,"Sean"),_this.clips["test-foamer-activate-touch"]=new VOInfo(3e3,"Sean"),_this.clips["test-foamer-place-desktop"]=new VOInfo(8e3,"Sean"),_this.clips["test-foamer-place-touch"]=new VOInfo(7600,"Sean"),_this.clips["test-foamer-place-pass"]=new VOInfo(4e3,"Sean"),_this.clips["test-foamer-place-fail-1"]=new VOInfo(3200,"Sean"),_this.clips["test-foamer-place-fail-2"]=new VOInfo(3600,"Sean"),_this.clips["test-foamer-ledge"]=new VOInfo(8200,"Sean"),_this.clips["test-short-body"]=new VOInfo(5200,"Sean"),_this.clips["test-sonar-head"]=new VOInfo(11e3,"Sean"),_this.clips["test-wings-desktop"]=new VOInfo(7600,"Sean"),_this.clips["test-wings-touch"]=new VOInfo(7500,"Sean"),_this.clips["test-rocket-legs"]=new VOInfo(8400,"Sean"),_this.clips["test-boosters-desktop"]=new VOInfo(8500,"Sean"),_this.clips["test-boosters-touch"]=new VOInfo(9e3,"Sean"),_this.clips["test-boosters-ice-desktop"]=new VOInfo(6300,"Sean"),_this.clips["test-boosters-ice-touch"]=new VOInfo(6600,"Sean"),_this.clips["test-xray-head"]=new VOInfo(11e3,"Sean"),_this.clips["test-tall-body"]=new VOInfo(7100,"Sean"),_this.clips["test-heat-head"]=new VOInfo(6500,"Sean"),_this.clips["head-general-1"]=new VOInfo(5500,"Sean"),_this.clips["head-ears-to"]=new VOInfo(7800,"Sean"),_this.clips["head-xray-to"]=new VOInfo(7500,"Sean"),_this.clips["head-heat-to"]=new VOInfo(5e3,"Sean"),_this.clips["onboarding-gap-complete"]=new VOInfo(1200,"Sean"),_this.clips["onboarding-gap-desktop"]=new VOInfo(3800,"Sean"),_this.clips["onboarding-gap-miss"]=new VOInfo(4800,"Sean"),_this.clips["onboarding-gap-touch"]=new VOInfo(3100,"Sean"),_this.clips["onboarding-sean-pincer"]=new VOInfo(4300,"Sean")},this.comsView=comsView,this.onScreen=!1,this.setupVOTriggers()},VOInfo=function(duration,char){this.duration=duration,this.char=char},WorldMediator=function(parent){var _this=this;this.enabled=!0,this.respawnPosition=null,this.init=function(isHelpMission){_this.level=new Level(PlayerPrefs.currentLevelJson),PlayerPrefs.currentLevelJson={},_this.robot=new Robot(_this.level.facingRight),_this.missionRecord=new MissionRecord(_this.level.pickups.length,_this.level.resources.length,PlayerPrefs.currentPlanet),_this.gamePhysix=new GamePhysix(_this.robot,_this.level),_this.pickupCollection=new PickupCollection(_this.robot,_this.level),_this.obstacleDetection=new ObstacleDetection(_this.robot,_this.level),_this.partManager=new PartManager(_this.robot,_this.level,_this.gamePhysix);var showPartHUD=!isHelpMission&&0<PlayerPrefs.partsUnlocked;_this.worldView.setup(_this.level,_this.robot,showPartHUD),_this.worldView.gameUI.addResourceBGs(_this.level.resources.length),_this.camera=new GameCamera(_this.worldView.gameCont,_this.robot,_this.level),Device.lowEndDevice||(_this.worldComsMonitor=new WorldComsMonitorMediator(_this.worldView.gameUI.worldComsMonitor)),_this.initSignals(),_this.recordProblemStart(),AnalyticsUtils.missionRecord=_this.missionRecord;var popupDelay=_this.worldView.levelPopup?3e3:0;setTimeout(function(){GameInput.enable(),_this.playIntro(isHelpMission)},popupDelay)},this.recordProblemStart=function(){var level=PlayerPrefs.currentLevel;app.analyticsEmitter.startRound(level.levelID,AnalyticsUtils.progress,AnalyticsUtils.hasRequiredParts,AnalyticsUtils.requiredParts,AnalyticsUtils.obstacleTypes,_this.level.pickups.length,_this.level.resources.length,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),GoogleAnalytics.sendStartRound(AnalyticsUtils.stageName,AnalyticsUtils.levelID),EnlearnUtils.recordProblemStart(level),_this.startTime=Date.now()},this.initSignals=function(){WorldSignals.respawnPositionUpdate.add(_this.respawnPositionUpdate),WorldSignals.exitBtnDown.add(_this.exitLevel),WorldSignals.completeLevel.add(_this.completeLevel),WorldSignals.collectStar.add(_this.onCollectStar),WorldSignals.collectResource.add(_this.onCollectResource),WorldSignals.restartGame.add(_this.restartGame),WorldSignals.clickGameCont.add(_this.clickGameCont),WorldSignals.useArms.add(_this.useArms),WorldSignals.enlearnAttempt.add(_this.worldView.enlearnAttempt),app.on("update",_this.update),app.on("resize",_this.resize)},this.teardown=function(){app.off("update",_this.update),app.off("resize",_this.resize),clearTimeout(_this.restartTimeout),GameInput.disable(),WorldSignals.removeAll(),_this.gamePhysix.teardown(),_this.partManager.teardown(),_this.obstacleDetection.teardown(),_this.worldComsMonitor&&_this.worldComsMonitor.teardown(),_this.worldView.teardown(),_this.tutorial&&_this.tutorial.teardown(),_this.level=null,_this.robot=null,_this.gamePhysix=null,_this.pickupCollection=null,_this.camera=null,_this.tutorial=null,app.voPlayer.stop()},this.respawnPositionUpdate=function(respawnPos,facingRight){_this.respawnPosition=respawnPos,_this.respawnFacingRight=facingRight},this.restartGame=function(){_this.robot.isAlive&&(_this.robot.isAlive=!1,_this.obstacleDetection.fallOnRocks(),GameInput.disable(),_this.gamePhysix.setXVelocity(0),_this.gamePhysix.setYVelocity(0),WorldSignals.playRobotAnim.dispatch("death"),_this.worldView.playDeathSFX(),_this.restartTimeout=setTimeout(function(){var pos=_this.respawnPosition||_this.level.startPos;_this.gamePhysix.setRobotPos(pos),_this.robot.facingRight=_this.respawnFacingRight||_this.level.facingRight,_this.worldView.robotView.updatePosition(1e4),GameInput.enable(),WorldSignals.playRobotAnim.dispatch("respawn"),_this.robot.isAlive=!0},750),app.analyticsEmitter.PlayerDied(AnalyticsUtils.levelID,_this.robot.pos,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge))},this.onCollectStar=function(star){_this.worldView.playStarCollectSFX(),_this.missionRecord.collectStar(),_this.worldView.removeStar(star.id),_this.worldView.gameUI.updateStars(_this.missionRecord.starCount,_this.missionRecord.totalStarCount),app.analyticsEmitter.CollectedStar(AnalyticsUtils.levelID,{x:star.x,y:star.y},_this.missionRecord.starCount,_this.missionRecord.totalStarCount,AnalyticsUtils.requiredPartsArray,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},this.onCollectResource=function(resource){_this.worldView.playResourceCollectSFX(),_this.missionRecord.collectResource();var worldPos=_this.worldView.gameCont.position,resourceScreenPos=new Point(resource.x+worldPos.x,resource.y+worldPos.y);_this.worldView.gameUI.onCollectResource(_this.missionRecord.resourcesCount,resourceScreenPos),_this.worldView.removeResource(resource.id),_this.levelIsComplete()&&_this.completeLevel(),app.analyticsEmitter.CollectedResource(AnalyticsUtils.levelID,{x:resource.x,y:resource.y},_this.missionRecord.resourcesCount,_this.missionRecord.totalResourcesCount,app.wallet.resources,AnalyticsUtils.requiredPartsArray,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},this.levelIsComplete=function(){return _this.missionRecord.resourcesCount>=_this.missionRecord.totalResourcesCount},this.allStarsCollected=function(){return _this.missionRecord.starCount>=_this.missionRecord.totalStarCount},this.completeLevel=function(){GameInput.disable(),_this.updateResourcesAndProgress(),_this.worldView.playLvlCompleteSFX(),_this.missionRecord.isSuccessful=!0,setTimeout(function(){EnlearnUtils.recordProblemEnd(PlayerPrefs.currentLevel,!0)},300),setTimeout(function(){GameSignals.gotoMainMenu.dispatch(_this.missionRecord)},1500);var duration=Date.now()-_this.startTime,resources=_this.missionRecord.totalResourcesCount;app.analyticsEmitter.endRound(duration,AnalyticsUtils.stars,resources,app.wallet.resources,AnalyticsUtils.stageName+" - ID: "+AnalyticsUtils.levelID,AnalyticsUtils.isChallenge),GoogleAnalytics.sendEndRound(AnalyticsUtils.stageName,AnalyticsUtils.levelID),GoogleAnalytics.sendLevelScore(AnalyticsUtils.levelID,AnalyticsUtils.stars.collected),GoogleAnalytics.sendCurrencyEarned(PlayerPrefs.currentPlanet,AnalyticsUtils.resources.collected)},this.updateResourcesAndProgress=function(){app.wallet.add(PlayerPrefs.currentPlanet,_this.missionRecord.totalResourcesCount);var lvl=PlayerPrefs.currentLevel;lvl.isTutorial&&(PlayerPrefs.helpMissionID=0),lvl.completed||(lvl.completed=!0,lvl.isChallenge||lvl.isDebug||(PlayerPrefs.levels.push(lvl),PlayerPrefs.nextLevel=null)),lvl.fullStars=lvl.fullStars||_this.allStarsCollected(),PlayerPrefs.saveResources(app.wallet),PlayerPrefs.saveRobot(_this.robot)},this.exitLevel=function(){EnlearnUtils.recordProblemEnd(PlayerPrefs.currentLevel,!1),_this.missionRecord.isSuccessful=!1,PlayerPrefs.saveResources(app.wallet),GameSignals.gotoMainMenu.dispatch(_this.missionRecord);var duration=Date.now()-_this.startTime;app.analyticsEmitter.ExitRound(duration,AnalyticsUtils.stars,AnalyticsUtils.resources,app.wallet.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.analyticsEmitter.ClickHome(AnalyticsUtils.clickPos,"level "+PlayerPrefs.currentLevel.levelID)},this.update=function(delta){app.lostFocus||(_this.enabled&&(_this.gamePhysix.update(delta),_this.pickupCollection.update(delta),_this.camera.lookAt(_this.robot.pos),_this.robot.update(delta),_this.worldView.update(delta)),_this.tutorial&&_this.tutorial.update())},this.resize=function(offset){_this.worldView.resize(offset)},this.clickGameCont=function(args){_this.robot.arms.name==Constants.Parts_Foamer?_this.robot.body.name!=Constants.Parts_Body_Short&&_this.robot.arms.tryFoam(args.data.global.x-_this.worldView.gameCont.x+app.display.sideOffset,args.data.global.y-_this.worldView.gameCont.y):app.analyticsEmitter.offClick(AnalyticsUtils.levelID,AnalyticsUtils.clickPos,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},this.playIntro=function(isHelpMission){isHelpMission?_this.tutorial=new HelpMissionIntro(PlayerPrefs.helpMissionID,_this.missionRecord,_this.worldView.gameUI):PlayerPrefs.currentLevel&&"convention"==PlayerPrefs.currentLevel.levelID?_this.tutorial=new RobotConvention(_this,_this.worldView):PlayerPrefs.currentLevel&&0==PlayerPrefs.currentLevel.levelNr&&!PlayerPrefs.moveTutorialPlayed?_this.tutorial=new MoveTutorial(_this,_this.worldView):PlayerPrefs.currentLevel&&1==PlayerPrefs.currentLevel.levelNr&&!PlayerPrefs.actionTutorialPlayed?_this.tutorial=new ActionTutorial(_this,_this.worldView):PlayerPrefs.swapPartTut?_this.tutorial=new SwapPartTutorial(_this.worldView):_this.shouldPlayHiddenItemIntro()&&(_this.tutorial=new HiddenObjIntro(_this.robot,_this.level,_this.gamePhysix)),4!=PlayerPrefs.partsUnlocked||PlayerPrefs.foamerTutorialPlayed||(_this.tutorial=new FoamerTutorial(_this.worldView,_this.robot)),setTimeout(GameSignals.enableInput.dispatch,50)},this.shouldPlayHiddenItemIntro=function(){return 0<_this.level.heatResources.length&&_this.robot.head.name!=Constants.Parts_Head_HeatVision||0<_this.level.earResources.length&&_this.robot.head.name!=Constants.Parts_Head_SuperEars||0<_this.gamePhysix.drillableXrayTiles.length&&_this.robot.head.name!=Constants.Parts_Head_XrayVision},this.useArms=function(){var armName=_this.robot.arms?_this.robot.arms.name:"Unknown";app.analyticsEmitter.ActivateArm(AnalyticsUtils.levelID,_this.robot.pos,armName,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},this.worldView=new WorldView,parent.addChildAt(this.worldView,0),this.worldView.x=-app.display.sideOffset},ObstacleZone=function(){function ObstacleZone(json,id){var _this=this;this.contains=function(pos){return pos.x>_this.x&&pos.y>_this.y&&pos.x<_this.x+_this.width&&pos.y<_this.y+_this.height},this.id=id,this.x=json.x,this.y=json.y,this.width=json.width,this.height=json.height,this.completed=!1,this.partCombinations=[new PartCombination(json.properties)],json.properties.altCombination&&this.partCombinations.push(new PartCombination(json.properties,!1))}return Object.defineProperty(ObstacleZone.prototype,"hasAltSolution",{get:function(){return 1<this.partCombinations.length},enumerable:!1,configurable:!0}),ObstacleZone}(),PartCombination=function(){function PartCombination(obstacleProperties,primaryCombination){var _this=this;void 0===primaryCombination&&(primaryCombination=!0),this.hasCorrectParts=function(robot){return!(!_this.requiresBody||_this.body!=Constants.Parts_Body_Tall)||(!_this.requiresLegs||_this.legs==robot.legs.name)&&((!_this.requiresArms||_this.arms==robot.arms.name)&&((!_this.requiresBody||_this.body==robot.body.name)&&(!_this.requiresHead||_this.head==robot.head.name)))},primaryCombination?(this.legs=obstacleProperties.legs||"",this.arms=obstacleProperties.arms||"",this.body=obstacleProperties.body||"",this.head=obstacleProperties.head||""):(this.legs=obstacleProperties.alt_legs||"",this.arms=obstacleProperties.alt_arms||"",this.body=obstacleProperties.alt_body||"",this.head=obstacleProperties.alt_head||"")}return Object.defineProperty(PartCombination.prototype,"requiresLegs",{get:function(){return""!=this.legs},enumerable:!1,configurable:!0}),Object.defineProperty(PartCombination.prototype,"requiresArms",{get:function(){return""!=this.arms},enumerable:!1,configurable:!0}),Object.defineProperty(PartCombination.prototype,"requiresHead",{get:function(){return""!=this.head},enumerable:!1,configurable:!0}),Object.defineProperty(PartCombination.prototype,"requiresBody",{get:function(){return""!=this.body},enumerable:!1,configurable:!0}),PartCombination}(),DrillableTile=function(_super){function DrillableTile(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(DrillableTile,_super),DrillableTile}(Matter.Body),IceWall=function(_super){function IceWall(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(IceWall,_super),IceWall}(Matter.Body),Level=function(_super){function Level(levelJson){var _this=_super.call(this)||this;return _this.initTiles=function(levelJson){var colliders=levelJson.layers.find(function(layer){return"collisions"==layer.name});_this.colliders=colliders.data},_this.initItems=function(levelJson){_this.pickups=[],_this.resources=[];var nrTiles=_this.Width*_this.Height,items=levelJson.layers.find(function(layer){return"items"==layer.name});items=items.data;for(var i=0;i<nrTiles;i++)if(0!==items[i]){var _x=i%_this.Width*Constants.TileWidth,_y=Math.floor(i/_this.Width)*Constants.TileHeight;if(items[i]===ItemID.StartPositionRight)_x+=Constants.TileWidth/2,_this.startPos=new Point(_x,_y+20),_this.facingRight=!0;else if(items[i]===ItemID.StartPositionLeft)_x+=Constants.TileWidth/2,_this.startPos=new Point(_x,_y+20),_this.facingRight=!1;else if(items[i]==ItemID.StarLeft||items[i]==ItemID.StarMiddle||items[i]==ItemID.StarRight){_x+=Constants.TileWidth/2,_y+=Constants.TileHeight/2,items[i]==ItemID.StarLeft?_x-=50:items[i]==ItemID.StarRight&&(_x+=50);var pickupType=items[i];_this.pickups.push(new Pickup(i,new Point(_x,_y),pickupType))}else if(items[i]==ItemID.Resource||items[i]==ItemID.HeatResource){_x+=Constants.TileWidth/2,_y+=Constants.TileHeight/2;var resourceType=items[i],resource=new Resource(i,new Point(_x,_y),resourceType);resourceType==ItemID.HeatResource&&(resource.enabled=!1),_this.resources.push(resource)}else if(items[i]==ItemID.SuperEarCollectable){_x+=Constants.TileWidth/2,_y+=Constants.TileHeight/2;resourceType=items[i];(resource=new Resource(i,new Point(_x,_y),resourceType)).requiredPart=Constants.Parts_Head_SuperEars,_this.resources.push(resource)}}},_this.initObstacles=function(levelJson){_this.obstacleZones=[];var obstacles=levelJson.layers.find(function(layer){return"enlearn"==layer.name});if(obstacles){obstacles=obstacles.objects;for(var i=0;i<obstacles.length;i++){var obstacle=obstacles[i];obstacle&&obstacle.properties&&obstacle.properties.id?_this.obstacleZones.push(new ObstacleZone(obstacles[i],obstacle.properties.id)):console.warn("Invalid ObstacleZone ignored.")}}},_this.Width=levelJson.width,_this.Height=levelJson.height,_this.initTiles(levelJson),_this.initItems(levelJson),_this.initObstacles(levelJson),_this}return __extends(Level,_super),Object.defineProperty(Level.prototype,"heatResources",{get:function(){return this.resources.filter(function(r){return r.type==ItemID.HeatResource})},enumerable:!1,configurable:!0}),Object.defineProperty(Level.prototype,"earResources",{get:function(){return this.resources.filter(function(r){return r.type==ItemID.SuperEarCollectable})},enumerable:!1,configurable:!0}),Level}(springroll.EventDispatcher),LevelInfo=function(){function LevelInfo(levelID,problemID,levelNr){this.isTutorial=!1,this.isChallenge=!1,this.isDebug=!1,this.levelID=levelID,this.problemID=problemID,this.levelNr=levelNr,this.fullStars=!1,this.completed=!1,this.attempt=0}return Object.defineProperty(LevelInfo.prototype,"firstAttempt",{get:function(){return 0==this.attempt},enumerable:!1,configurable:!0}),LevelInfo}(),Pickup=function(id,startPos,type){this.id=id,this.x=startPos.x,this.y=startPos.y,this.type=type},Resource=function(){function Resource(id,startPos,type){var _this=this;this.enabledChanged=new signals.Signal,this.alphaChanged=new signals.Signal,this.sfxVolumeChanged=new signals.Signal,this.dispatchInitialState=function(){_this.enabled=_this.enabled,_this.alpha=_this.alpha},this.id=id,this.x=startPos.x,this.y=startPos.y,this.type=type,this.enabled=!0,this.alpha=1}return Object.defineProperty(Resource.prototype,"pos",{get:function(){return new Point(this.x,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(Resource.prototype,"enabled",{get:function(){return this._enabled},set:function(enabled){this._enabled=enabled,this.enabledChanged.dispatch(enabled,this)},enumerable:!1,configurable:!0}),Object.defineProperty(Resource.prototype,"alpha",{get:function(){return this._alpha},set:function(alpha){this._alpha=alpha,this.alphaChanged.dispatch(alpha,this)},enumerable:!1,configurable:!0}),Object.defineProperty(Resource.prototype,"sfxVolume",{get:function(){return this._sfxVolume},set:function(sfxVolume){this._sfxVolume=sfxVolume,this.sfxVolumeChanged.dispatch(sfxVolume,this)},enumerable:!1,configurable:!0}),Resource}(),MissionRecord=function(){function MissionRecord(collectablesCount,resourcesCount,planetName,isSuccessful){void 0===isSuccessful&&(isSuccessful=!1),this.resourcesCollected=0,this.collectablesCollected=0,this.totalCollectables=collectablesCount,this.totalResources=resourcesCount,this._planetName=planetName,this._isSuccessful=isSuccessful,this.isMissingPart=!1}return Object.defineProperty(MissionRecord.prototype,"isSuccessful",{get:function(){return this._isSuccessful},set:function(v){this._isSuccessful=v},enumerable:!1,configurable:!0}),Object.defineProperty(MissionRecord.prototype,"planetName",{get:function(){return this._planetName},enumerable:!1,configurable:!0}),Object.defineProperty(MissionRecord.prototype,"resourcesCount",{get:function(){return this.resourcesCollected},enumerable:!1,configurable:!0}),Object.defineProperty(MissionRecord.prototype,"totalResourcesCount",{get:function(){return this.totalResources},enumerable:!1,configurable:!0}),Object.defineProperty(MissionRecord.prototype,"starCount",{get:function(){return this.collectablesCollected},enumerable:!1,configurable:!0}),Object.defineProperty(MissionRecord.prototype,"totalStarCount",{get:function(){return this.totalCollectables},enumerable:!1,configurable:!0}),MissionRecord.prototype.collectResource=function(){this.resourcesCollected++},MissionRecord.prototype.collectStar=function(){this.collectablesCollected++},MissionRecord.prototype.hasAllStars=function(){return 0<this.totalStarCount&&this.starCount==this.totalStarCount},MissionRecord}(),BoosterArms=function(){function BoosterArms(){var _this=this;this.name=Constants.Parts_Booster,this.enabled=!0,this.active=!1,this.cooldown=1e3,this.flameDist=130,this.teardown=function(){_this.active=!1;for(var i=0;i<_this.timeouts.length;i++)clearTimeout(_this.timeouts[i])},this.useBoosters=function(){_this.active=!0,_this.cooldownProgress=_this.cooldown,WorldSignals.useArms.dispatch(),WorldSignals.playRobotAnim.dispatch("boost"),app.sound.play("sfx-boost",{volume:.3});var deactivationTimeout=setTimeout(function(){_this.active=!1},400);_this.timeouts.push(deactivationTimeout);var tryMelt1=setTimeout(_this.tryMelt1,300);_this.timeouts.push(tryMelt1);var tryMelt2=setTimeout(_this.tryMelt2,600);_this.timeouts.push(tryMelt2)},this.tryMelt1=function(){var target={x:_this.robot.x+(_this.robot.facingRight?-_this.flameDist:_this.flameDist),y:_this.robot.y-100};_this.iceWallId=-1;var points=Matter.Query.point(_this.physix.iceWalls,target);0<points.length&&(_this.iceWallId=points[0].coordId)},this.tryMelt2=function(){var target={x:_this.robot.x+(_this.robot.facingRight?-_this.flameDist:_this.flameDist),y:_this.robot.y-100},points=Matter.Query.point(_this.physix.iceWalls,target);0<points.length&&points[0].coordId==_this.iceWallId&&(app.sound.play("sfx-icemelt-2",{volume:.5}),WorldSignals.meltIceWall.dispatch(_this.iceWallId),app.analyticsEmitter.MeltedIce(AnalyticsUtils.levelID,_this.robot.pos,target,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge))}}return BoosterArms.prototype.init=function(gamePhysix,robot){this.robot=robot,this.physix=gamePhysix,this.cooldownProgress=0,this.timeouts=[]},BoosterArms.prototype.update=function(delta){0<this.cooldownProgress?this.cooldownProgress-=delta:GameInput.doAction&&this.enabled&&this.useBoosters()},BoosterArms}(),DrillArms=function(){function DrillArms(){var _this=this;this.name=Constants.Parts_Drill,this.enabled=!0,this.cooldown=1500,this.update=function(delta){0<_this.cooldownProgress?_this.cooldownProgress-=delta:GameInput.doAction&&_this.enabled&&_this.drill()},this.updateDrillTarget=function(){if(!app.lostFocus){var physix=_this.gamePhysix,target=_this.getTarget(),points=Matter.Query.point(physix.drillableTiles,target);if(0<points.length)if(!points[0].requiresXray||_this.robot.head.name==Constants.Parts_Head_XrayVision)return void WorldSignals.setDrillTargetView.dispatch(target,!0);WorldSignals.setDrillTargetView.dispatch(target,!1)}},this.drill=function(){app.sound.play("sfx-drill"),WorldSignals.useArms.dispatch(),WorldSignals.playRobotAnim.dispatch("drill"),_this.cooldownProgress=_this.cooldown;var physix=_this.gamePhysix,target=_this.getTarget(),points=Matter.Query.point(physix.drillableTiles,target);if(0<points.length){var drillableTile=points[0];drillableTile.requiresXray&&_this.robot.head.name!=Constants.Parts_Head_XrayVision||(WorldSignals.drillTile.dispatch(drillableTile.coordId),app.analyticsEmitter.DrilledRocks(AnalyticsUtils.levelID,_this.robot.pos,target,drillableTile.requiresXray,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge))}},this.getTarget=function(){var target={x:_this.robot.x,y:_this.robot.y};return target.x+=_this.robot.facingRight?70:-70,target.y+=60,target},this.teardown=function(){clearInterval(_this.updateTargetInterval);WorldSignals.setDrillTargetView.dispatch({x:-2e3,y:-2e3},!0)}}return DrillArms.prototype.init=function(gamePhysix,robot){this.gamePhysix=gamePhysix,this.robot=robot,this.updateTargetInterval=setInterval(this.updateDrillTarget,50),this.updateDrillTarget()},DrillArms}(),FoamerArms=function(){function FoamerArms(){var _this=this;this.name=Constants.Parts_Foamer,this._enabled=!0,this.tryFoam=function(targetX,targetY){if(!(0<_this.cooldown)&&(_this.cooldown=1200,WorldSignals.useArms.dispatch(),_this.enabled&&_this.foamgridActive)){var tileX=Math.floor(targetX/Constants.TileWidth),tileY=Math.floor(targetY/Constants.TileHeight);Math.floor(_this.robot.pos.x/Constants.TileWidth),Math.floor(_this.robot.pos.y/Constants.TileHeight);if(tileY>=_this.gamePhysix.levelHeight-1||tileX<=1||tileX>=_this.gamePhysix.levelWidth-2)return;var target={x:targetX,y:targetY};null==_this.gamePhysix.tileAtPoint(target)?(_this.gamePhysix.addFoamTile(tileX,tileY),app.sound.play("sfx-foam-gun",{volume:.3}),app.analyticsEmitter.PlacedPlatform(AnalyticsUtils.levelID,_this.robot.pos,!0,target,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)):app.analyticsEmitter.PlacedPlatform(AnalyticsUtils.levelID,_this.robot.pos,!1,target,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}},this.ondisable=function(){_this.foamgridActive=!1,WorldSignals.hideFoamGrid.dispatch()},this.teardown=function(){WorldSignals.hideFoamGrid.dispatch()}}return Object.defineProperty(FoamerArms.prototype,"enabled",{get:function(){return this._enabled},set:function(value){0==(this._enabled=value)&&this.ondisable()},enumerable:!1,configurable:!0}),FoamerArms.prototype.init=function(gamePhysix,robot){this.gamePhysix=gamePhysix,this.robot=robot,this.cooldown=0,this.foamgridActive=!1},FoamerArms.prototype.update=function(delta){0<this.cooldown?this.cooldown-=delta:this.enabled&&GameInput.doAction&&(this.cooldown=750,this.foamgridActive=!this.foamgridActive,this.foamgridActive?WorldSignals.showFoamGrid.dispatch():WorldSignals.hideFoamGrid.dispatch())},FoamerArms}(),HeatVisionHead=function(){function HeatVisionHead(){var _this=this;this.name=Constants.Parts_Head_HeatVision,this.teardown=function(){clearInterval(_this.interval),WorldSignals.hideHeatVision.dispatch(),_this.level.heatResources.forEach(function(r){r.enabled=!1,r.alpha=0,r.sfxVolume=0})},this.updateHeatResources=function(){app.lostFocus||(_this.heatVisionOrigin=new Point(_this.robot.x,_this.robot.y-100),_this.level.heatResources.forEach(function(heatResource){var hrToOrigin=new Point(_this.heatVisionOrigin.x-heatResource.x,_this.heatVisionOrigin.y-heatResource.y);_this.distanceFromOrigin=Math.sqrt(hrToOrigin.x*hrToOrigin.x+hrToOrigin.y*hrToOrigin.y),heatResource.alpha=_this.calculateResourceFX(_this.distanceFromOrigin),heatResource.sfxVolume=heatResource.alpha/3}))},this.calculateResourceFX=function(distanceFromOrigin){var opacity=MathUtils.inverseLerp(440,320,distanceFromOrigin);return opacity=MathUtils.clamp(opacity,0,1)}}return HeatVisionHead.prototype.init=function(robot,level){this.robot=robot,this.level=level,this.thermoVisionSFX=app.sound.play("sfx-thermo-vision"),this.level.heatResources.forEach(function(r){r.enabled=!0}),WorldSignals.showHeatVision.dispatch(),this.interval=setInterval(this.updateHeatResources,50)},HeatVisionHead}(),MedBody=function(){this.name=Constants.Parts_Body_Med},NormalHead=function(){function NormalHead(){this.name=Constants.Parts_Head_Normal,this.teardown=function(){}}return NormalHead.prototype.init=function(robot,level){this.robot=robot,this.level=level},NormalHead}(),PincerArms=function(){function PincerArms(){var _this=this;this.name=Constants.Parts_Pincer,this.enabled=!0,this.cooldown=1e3,this.teardown=function(){clearTimeout(_this.grabTimeout)},this.usePincers=function(){_this.cooldownProgress=_this.cooldown,WorldSignals.playRobotAnim.dispatch("grab"),app.sound.play("sfx-pincer",{volume:.3}),_this.grabTimeout=setTimeout(_this.tryGrab,400)},this.tryGrab=function(){WorldSignals.useArms.dispatch();var target={x:_this.robot.x+(_this.robot.facingRight?120:-120),y:_this.robot.y-100};0<Matter.Query.point(_this.gamePhysix.iceWalls,target).length||WorldSignals.tryGrabResources.dispatch()}}return PincerArms.prototype.init=function(gamePhysix,robot){this.robot=robot,this.gamePhysix=gamePhysix,this.cooldownProgress=0},PincerArms.prototype.update=function(delta){0<this.cooldownProgress?this.cooldownProgress-=delta:GameInput.doAction&&this.enabled&&this.usePincers()},PincerArms}(),Robot=function(){function Robot(isFacingRight){this.facingRight=isFacingRight,this.isAlive=!0,this.squash=1}return Object.defineProperty(Robot.prototype,"body",{get:function(){return this._body},set:function(v){this._body=v},enumerable:!1,configurable:!0}),Object.defineProperty(Robot.prototype,"x",{get:function(){return this.matterBody?this.matterBody.baseCollider.position.x:0},enumerable:!1,configurable:!0}),Object.defineProperty(Robot.prototype,"y",{get:function(){return this.matterBody?this.matterBody.baseCollider.position.y:0},enumerable:!1,configurable:!0}),Object.defineProperty(Robot.prototype,"boostersActive",{get:function(){return!(!this.arms||this.arms.name!=Constants.Parts_Booster||!this.arms.active)},enumerable:!1,configurable:!0}),Object.defineProperty(Robot.prototype,"pos",{get:function(){return new Point(this.x,this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(Robot.prototype,"headPos",{get:function(){return this.body.name==Constants.Parts_Body_Tall?new Point(this.x,this.y-250):this.body.name==Constants.Parts_Body_Short?new Point(this.x,this.y-90):new Point(this.x,this.y-175)},enumerable:!1,configurable:!0}),Object.defineProperty(Robot.prototype,"velocity",{get:function(){return new Point(this.matterBody.velocity.x,this.matterBody.velocity.y)},enumerable:!1,configurable:!0}),Robot.prototype.update=function(delta){this.squash=MathUtils.lerp(this.squash,1,.01*delta)},Robot}(),RobotMatterBody=function(_super){function RobotMatterBody(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RobotMatterBody,_super),RobotMatterBody}(Matter.Body),RobotParts=function(){function RobotParts(){}return RobotParts.getLegs=function(id){return id==Constants.Parts_Tracks?new TrackLegs:id==Constants.Parts_Wheels?new WheelLegs:id==Constants.Parts_Springs?new SpringLegs:id==Constants.Parts_Rocket?new RocketLegs:void console.error("Unknown legs requested: ",id)},RobotParts.getArms=function(id){return id==Constants.Parts_Pincer?new PincerArms:id==Constants.Parts_Drill?new DrillArms:id==Constants.Parts_Wings?new WingArms:id==Constants.Parts_Foamer?new FoamerArms:id==Constants.Parts_Booster?new BoosterArms:void console.error("Unknown arms requested: ",id)},RobotParts.getBody=function(id){return id==Constants.Parts_Body_Tall?new TallBody:id==Constants.Parts_Body_Med?new MedBody:id==Constants.Parts_Body_Short?new ShortBody:void console.error("Unknown body requested: ",id)},RobotParts.getHead=function(id){return id==Constants.Parts_Head_Normal?new NormalHead:id==Constants.Parts_Head_SuperEars?new SuperEarsHead:id==Constants.Parts_Head_XrayVision?new XrayVisionHead:id==Constants.Parts_Head_HeatVision?new HeatVisionHead:void console.error("Unknown head requested: ",id)},RobotParts}(),RocketLegs=function(){function RocketLegs(){this.name=Constants.Parts_Rocket,this.topSpeed=2,this.jumpStart={x:0,y:0},this.teardown=function(){}}return RocketLegs.prototype.init=function(gamePhysix,robot){this.cooldownProgress=0,this.gamePhysix=gamePhysix,this.robot=robot},RocketLegs.prototype.update=function(delta){this.cooldownProgress-=delta,this.gamePhysix.onFloor?this.gamePhysix.canJump()&&this.cooldownProgress<0&&(GameInput.goRight||GameInput.goLeft)&&this.jump():this.strafe(16)},RocketLegs.prototype.jump=function(){this.cooldownProgress=2e3,this.robot.facingRight=!!GameInput.goRight,WorldSignals.playRobotAnim.dispatch("rocketLaunch"),app.sound.play("sfx-rocket-takeoff",{volume:.3});this.gamePhysix.setYVelocity(-17),this.gamePhysix.disablePlatformCollision(),this.jumpStart.x=this.robot.x,this.jumpStart.y=this.robot.y},RocketLegs.prototype.strafe=function(delta){var acceleration=.002*delta,speed=this.topSpeed,velX=this.gamePhysix.velocityX;if(this.robot.boostersActive&&(speed*=3),this.gamePhysix.onFloor&&(speed*=0),GameInput.goRight)velX=MathUtils.lerp(velX,speed,acceleration),this.gamePhysix.setXVelocity(velX),this.robot.facingRight=!0;else if(GameInput.goLeft)velX=MathUtils.lerp(velX,-speed,acceleration),this.gamePhysix.setXVelocity(velX),this.robot.facingRight=!1;else{var deceleration=.001*delta;velX=MathUtils.lerp(velX,0,deceleration),this.gamePhysix.setXVelocity(velX)}},RocketLegs.prototype.onLand=function(onRoughGround){this.gamePhysix.setXVelocity(0),onRoughGround?WorldSignals.restartGame.dispatch():(WorldSignals.playRobotAnim.dispatch("rocketLand"),app.sound.play("sfx-rocket-land")),app.analyticsEmitter.PlayerJumped(AnalyticsUtils.levelID,this.jumpStart,this.robot.pos,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},RocketLegs}(),ShortBody=function(){this.name=Constants.Parts_Body_Short},SpringLegs=function(){function SpringLegs(){var _this=this;this.name=Constants.Parts_Springs,this.topSpeed=3.85,this.jumpVelocity=11,this.jumpCooldown=0,this.jumpStart={x:0,y:0},this.teardown=function(){_this.robot.squash=1}}return SpringLegs.prototype.init=function(gamePhysix,robot){this.gamePhysix=gamePhysix,this.robot=robot,this.gamePhysix.canJump()&&this.jump()},SpringLegs.prototype.update=function(delta){if(this.jumpCooldown-=delta,this.speed=this.topSpeed,this.velX=this.gamePhysix.velocityX,this.robot.boostersActive&&(this.speed*=2),this.gamePhysix.canJump())if(GameInput.goRight)this.jump(),this.gamePhysix.setXVelocity(this.speed),this.robot.facingRight=!0;else if(GameInput.goLeft)this.jump(),this.gamePhysix.setXVelocity(-this.speed),this.robot.facingRight=!1;else{var deceleration=.01*delta;this.velX=MathUtils.lerp(this.velX,0,deceleration),this.gamePhysix.setXVelocity(this.velX)}else if(GameInput.goRight)this.gamePhysix.setXVelocity(this.speed),this.robot.facingRight=!0;else if(GameInput.goLeft)this.gamePhysix.setXVelocity(-this.speed),this.robot.facingRight=!1;else{deceleration=.001*delta;this.velX=MathUtils.lerp(this.velX,0,deceleration),this.gamePhysix.setXVelocity(this.velX)}},SpringLegs.prototype.jump=function(){0<this.jumpCooldown||(this.jumpCooldown=300,this.gamePhysix.setYVelocity(-this.jumpVelocity),this.gamePhysix.disablePlatformCollision(),app.sound.play("sfx-spring-alt"),this.jumpStart.x=this.robot.x,this.jumpStart.y=this.robot.y)},SpringLegs.prototype.onLand=function(onRoughGround){this.robot.squash=.85,onRoughGround?WorldSignals.restartGame.dispatch():(GameInput.goRight||GameInput.goLeft)&&this.jump(),app.analyticsEmitter.PlayerJumped(AnalyticsUtils.levelID,this.jumpStart,this.robot.pos,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},SpringLegs}(),SuperEarsHead=function(){function SuperEarsHead(){var _this=this;this.name=Constants.Parts_Head_SuperEars,this.animationInterval=0,this.checkDistanceToResource=function(){if(app.lostFocus)_this.interval=setTimeout(_this.checkDistanceToResource,1e3);else{var distance=_this.getClosestResourceDist();if(distance){distance=MathUtils.clamp(distance,3,25),_this.interval=setTimeout(_this.checkDistanceToResource,30*distance);var vol=.2;distance<20&&(vol=.5),distance<7&&(vol=.8),app.sound.play("sfx-ears-beep",{volume:vol}),_this.animationInterval++,4==_this.animationInterval&&(_this.animationInterval=0,WorldSignals.pingSonar.dispatch(_this.robot.headPos,_this.angleToClosest))}}},this.getClosestResourceDist=function(){if(0!=_this.level.earResources.length){for(var closestResourceDist=null,cloestsResource=null,i=0;i<_this.level.resources.length;i++){var resource=_this.level.resources[i];if(resource.requiredPart==Constants.Parts_Head_SuperEars){var dist=_this.calcSquareDistance(resource.pos);(null==closestResourceDist||dist<closestResourceDist)&&(closestResourceDist=dist,cloestsResource=resource)}}return _this.angleToClosest=_this.calcAngle(cloestsResource),closestResourceDist}},this.calcSquareDistance=function(recourcePos){var distX=_this.robot.pos.x-recourcePos.x,distY=_this.robot.pos.y-100-recourcePos.y,distXInTiles=distX/Constants.TileWidth,distYInTiles=distY/Constants.TileHeight;return distXInTiles*distXInTiles+distYInTiles*distYInTiles},this.calcAngle=function(recourcePos){var headPos=_this.robot.headPos;return Math.atan2(headPos.y-recourcePos.y,headPos.x-recourcePos.x)-Math.PI},this.teardown=function(){clearInterval(_this.interval)}}return SuperEarsHead.prototype.init=function(robot,level){this.robot=robot,this.level=level,this.interval=setTimeout(this.checkDistanceToResource,0)},SuperEarsHead}(),TallBody=function(){this.name=Constants.Parts_Body_Tall},TrackLegs=function(){function TrackLegs(){var _this=this;this.name=Constants.Parts_Tracks,this.topSpeed=4,this._volume=0,this.terrainVolume=0,this.squashSin=0,this._deltaSpeed=0,this._desiredVelocity=0,this.teardown=function(){_this.wheelAudio.stop(),_this.bumpyTerrainAudio.stop()}}return TrackLegs.prototype.init=function(gamePhysix,robot){this.gamePhysix=gamePhysix,this.robot=robot,this.terrainVolume=this._volume=0,this.wheelAudio=app.sound.play("sfx-treads",{volume:this._volume,loop:!0}),this.bumpyTerrainAudio=app.sound.play("TEMP-sfx-rocky-terrain",{volume:this.terrainVolume,loop:!0})},TrackLegs.prototype.update=function(delta){this.updateMovement(delta),this._volume=Math.min(Math.abs(this.gamePhysix.velocityX),4)/12,this.wheelAudio.volume=MathUtils.lerp(this.wheelAudio.volume,this._volume,.1),this.gamePhysix.onFloor&&this.gamePhysix.currentTile&&this.gamePhysix.currentTile.isRoughGround?this.terrainVolume=MathUtils.lerp(this.terrainVolume,.3,.05):this.terrainVolume=MathUtils.lerp(this.terrainVolume,0,.01),this.bumpyTerrainAudio.volume=this.terrainVolume*this._volume},TrackLegs.prototype.updateMovement=function(delta){this._deltaSpeed=this.topSpeed,GameInput.goRight?(this.robot.facingRight=!0,this._desiredVelocity=this.robot.boostersActive?1.1*this._deltaSpeed:this._deltaSpeed):GameInput.goLeft&&(this.robot.facingRight=!1,this._desiredVelocity=this.robot.boostersActive?1.1*-this._deltaSpeed:-this._deltaSpeed),this.gamePhysix.onFloor&&(this._desiredVelocity*=.85),this._desiredVelocity=MathUtils.lerp(this.gamePhysix.velocityX,this._desiredVelocity,delta*delta*.0025),this.gamePhysix.setXVelocity(this._desiredVelocity),this.squashSin+=.05*delta;var fpsEqializedVelocity=41e-5*Math.abs(this.robot.velocity.x)+.013;this.robot.squash=1+Math.sin(this.squashSin)*fpsEqializedVelocity},TrackLegs.prototype.onLand=function(onRoughGround){},TrackLegs}(),WheelLegs=function(){function WheelLegs(){var _this=this;this.name=Constants.Parts_Wheels,this.topSpeed=8,this.teardown=function(){_this.wheelAudio.stop()}}return WheelLegs.prototype.init=function(gamePhysix,robot){this.gamePhysix=gamePhysix,this.robot=robot,this.volume=0,this.wheelAudio=app.sound.play("sfx-wheel",{volume:this.volume,loop:!0})},WheelLegs.prototype.update=function(delta){this.volume=.09*Math.min(Math.abs(this.gamePhysix.velocityX),4),this.wheelAudio.volume=this.volume,this.updateMovement(delta)},WheelLegs.prototype.updateMovement=function(delta){if(this.currentVelocity=this.gamePhysix.velocityX,this.desiredVelocity=0,GameInput.goRight?(this.robot.facingRight=!0,this.desiredVelocity=this.topSpeed):GameInput.goLeft&&(this.robot.facingRight=!1,this.desiredVelocity=-this.topSpeed),this.robot.boostersActive){this.robot.facingRight?this.desiredVelocity+=1.75*this.topSpeed:this.desiredVelocity-=1.75*this.topSpeed}this.gamePhysix.onFloor&&(this.desiredVelocity*=.8),this.timeStep=.0025*delta,this.desiredVelocity=MathUtils.lerp(this.currentVelocity,this.desiredVelocity,this.timeStep),this.gamePhysix.setXVelocity(this.desiredVelocity)},WheelLegs.prototype.onLand=function(onRoughGround){onRoughGround&&WorldSignals.restartGame.dispatch()},WheelLegs}(),WingArms=function(){function WingArms(){var _this=this;this.name=Constants.Parts_Wings,this.enabled=!0,this.cooldown=1500,this.defaultGravity=.001,this.forwardBoost=7,this.glideTime=0,this.maxGlideTime=1100,this.flap=function(){_this._isGliding=!0,_this.glideTime=_this.maxGlideTime,_this.cooldownProgress=_this.cooldown,app.sound.play("sfx-wing-flap"),WorldSignals.useArms.dispatch(),WorldSignals.playRobotAnim.dispatch("flap"),-5<_this.robot.velocity.y&&!_this.gamePhysix.onFloor&&_this.gamePhysix.setYVelocity(-5)},this.teardown=function(){_this._isGliding=!1}}return Object.defineProperty(WingArms.prototype,"isGliding",{get:function(){return this._isGliding},enumerable:!1,configurable:!0}),WingArms.prototype.init=function(gamePhysix,robot){this.gamePhysix=gamePhysix,this.robot=robot,this.cooldownProgress=0},WingArms.prototype.update=function(delta){if(0<this.cooldownProgress?this.cooldownProgress-=delta:GameInput.doAction&&this.enabled&&this.flap(),this._isGliding)if(this.glideTime-=delta,this.glideTime<0)this.glideTime=0,this._isGliding=!1;else{var boost=this.robot.facingRight?this.forwardBoost:-this.forwardBoost,p=(this.maxGlideTime-this.glideTime)/this.maxGlideTime;boost=MathUtils.lerp(boost,boost/2,p),this.gamePhysix.setXVelocity(boost),1<this.robot.velocity.y&&this.gamePhysix.setYVelocity(1)}},WingArms}(),XrayVisionHead=function(){function XrayVisionHead(){var _this=this;this.name=Constants.Parts_Head_XrayVision,this.blured=!1,this.teardown=function(){_this.xrayActionSFX.stop(),clearInterval(_this.interval),WorldSignals.hideCracks.dispatch()},this.updateCracks=function(){if(!app.lostFocus){var xrayOrigin=new Point(_this.robot.x,_this.robot.y-100);WorldSignals.updateCracks.dispatch(xrayOrigin)}}}return XrayVisionHead.prototype.init=function(robot,level){this.robot=robot,this.level=level,this.xrayActionSFX=app.sound.play("sfx-xray-triggered",{volume:.3}),this.interval=setInterval(this.updateCracks,100)},XrayVisionHead}(),ScaffoldInfo=function(stepName,level){this.stepName=stepName,this.level=level},Silence=function(){function Silence(start,end){this._start=start,this._end=end}return Object.defineProperty(Silence.prototype,"start",{get:function(){return this._start},enumerable:!1,configurable:!0}),Object.defineProperty(Silence.prototype,"end",{get:function(){return this._end},enumerable:!1,configurable:!0}),Silence}(),SilenceParser=function(){function SilenceParser(){}return SilenceParser.prototype.parse=function(content){return content.split("\n").map(function(line){var silenceInfo=line.split("\t"),start=parseFloat(silenceInfo[0]),end=parseFloat(silenceInfo[1]);return new Silence(start,end)}).filter(function(silence){return!isNaN(silence.start)&&!isNaN(silence.end)})},SilenceParser}(),VoStep=function(){function VoStep(voId){this._voConfig=app.config.voConfig[voId],this._voId=this._voConfig.vo}return Object.defineProperty(VoStep.prototype,"voId",{get:function(){return this._voId},enumerable:!1,configurable:!0}),Object.defineProperty(VoStep.prototype,"silences",{get:function(){var text=Texts.get(this._voConfig.silenceFile);return this.readSilencesFromFile(text)},enumerable:!1,configurable:!0}),VoStep.prototype.readSilencesFromFile=function(content){return(new SilenceParser).parse(content)},VoStep}(),GameCamera=function(){function GameCamera(gameCont,robot,level){this.gameWorld=gameCont,this.robotPosOnScreen=new Point(700,450),this.levelWidth=level.Width*Constants.TileWidth-Constants.ScreenWidth,this.levelHeight=level.Height*Constants.TileHeight,this.lookAt(robot.pos,!0)}return GameCamera.prototype.lookAt=function(target,instantly){void 0===instantly&&(instantly=!1),null!=target&&(this.desiredX=-(target.x-this.robotPosOnScreen.x),this.desiredY=-(target.y-this.robotPosOnScreen.y),instantly||(this.desiredX=MathUtils.lerp(this.gameWorld.x,this.desiredX,.8),this.desiredY=MathUtils.lerp(this.gameWorld.y,this.desiredY,.8)),this.setCamPos(this.desiredX,this.desiredY))},GameCamera.prototype.moveBy=function(x,y){this.setCamPos(this.gameWorld.x-x,this.gameWorld.y-y)},GameCamera.prototype.setCamPos=function(x,y){this.gameWorld.x=MathUtils.clamp(x,-(this.levelWidth+app.display.sideOffset),app.display.sideOffset),this.gameWorld.y=MathUtils.clamp(y,-(this.levelHeight-Constants.ScreenHeight),0)},GameCamera}(),GameInput=function(){function GameInput(){}return GameInput.goRight=!1,GameInput.goLeft=!1,GameInput.doAction=!1,GameInput.enabled=!1,GameInput.initialized=!1,GameInput.enable=function(){GameInput.enabled=!0,GameInput.initialized||GameInput.initialize()},GameInput.disable=function(){GameInput.enabled=!1,GameInput.goRight=!1,GameInput.goLeft=!1,GameInput.doAction=!1},GameInput.initialize=function(){Device.isDesktop&&(document.addEventListener("keydown",function(e){GameInput.enabled&&(e.keyCode==Constants.KeyCodeRight&&(GameInput.goRight=!0),e.keyCode==Constants.KeyCodeLeft&&(GameInput.goLeft=!0),e.keyCode==Constants.KeyCodeSpace&&(GameInput.doAction=!0),app.options.debug&&(e.keyCode==Constants.KeyCodeW&&WorldSignals.trySelectLegs.dispatch(Constants.Parts_Springs),e.keyCode==Constants.KeyCodeA&&WorldSignals.trySelectLegs.dispatch(Constants.Parts_Wheels),e.keyCode==Constants.KeyCodeS&&WorldSignals.trySelectLegs.dispatch(Constants.Parts_Tracks),e.keyCode==Constants.KeyCodeD&&WorldSignals.trySelectLegs.dispatch(Constants.Parts_Rocket)))}),document.addEventListener("keyup",function(e){e.keyCode==Constants.KeyCodeRight&&(GameInput.goRight=!1),e.keyCode==Constants.KeyCodeLeft&&(GameInput.goLeft=!1),e.keyCode==Constants.KeyCodeSpace&&(GameInput.doAction=!1)}))},GameInput}(),GamePhysix=function(_super){function GamePhysix(robot,level){var _this=_super.call(this)||this;return _this.velocityX=0,_this.prevVelocityY=0,_this.lag=0,_this._pushBack=0,_this.platformCollisionActive=!0,_this.yVelIndex=0,_this.yVelHistory=[0,0,0,0,0],_this.interval=1e3/60,_this.count=0,_this.maxUpdateCount=7,_this.isGliding=function(){return!!(_this.robot&&_this.robot.arms&&_this.robot.arms.name==Constants.Parts_Wings&&_this.robot.arms.isGliding)},_this.pushRobotAwayFromWalls=function(){var left={x:_this.robot.x-28,y:_this.robot.y+-15},topLeft={x:_this.robot.x-10,y:_this.robot.y-100};if((0<Matter.Query.point(_this.levelGeomerty,left).length||0<Matter.Query.point(_this.levelGeomerty,topLeft).length)&&(Matter.Body.translate(_this.robot.matterBody,{x:1,y:0}),_this.robot.velocity.x<0))_this.setXVelocity(0);else{var right={x:_this.robot.x+28,y:_this.robot.y+-15},topRight={x:_this.robot.x+10,y:_this.robot.y-100};(0<Matter.Query.point(_this.levelGeomerty,right).length||0<Matter.Query.point(_this.levelGeomerty,topRight).length)&&(Matter.Body.translate(_this.robot.matterBody,{x:-1,y:0}),0<_this.robot.velocity.x)&&_this.setXVelocity(0)}},_this.disablePlatformCollision=function(){if(_this.platformCollisionActive){_this.platformCollisionActive=!1;for(var i=0;i<_this.platforms.length;i++)_this.platforms[i].collisionFilter.category=Collision.Off;_this.foamTile&&(_this.foamTile.collisionFilter.category=Collision.Off)}},_this.updatePlatformCollision=function(){for(var i=0;i<_this.platforms.length;i++)_this.robot.y<_this.platforms[i].position.y?_this.platforms[i].collisionFilter.category=Collision.On:_this.platforms[i].collisionFilter.category=Collision.Off;_this.foamTile&&(_this.robot.y<_this.foamTile.position.y?_this.foamTile.collisionFilter.category=Collision.On:_this.foamTile.collisionFilter.category=Collision.Off)},_this.startingDescent=function(){_this.enablePlatformCollision(),_this.descending||_this.hasLanded||(_this.descending=!0)},_this.enablePlatformCollision=function(){if(!_this.platformCollisionActive){_this.platformCollisionActive=!0;for(var i=0;i<_this.platforms.length;i++)_this.robot.y<_this.platforms[i].position.y-40&&(_this.platforms[i].collisionFilter.category=Collision.On);_this.foamTile&&_this.robot.y<_this.foamTile.position.y-40&&(_this.foamTile.collisionFilter.category=Collision.On)}},_this.landFallback=function(){_this.yVelIndex=(_this.yVelIndex+1)%_this.yVelHistory.length,_this.yVelHistory[_this.yVelIndex]=_this.robot.velocity.y,0!=_this.robot.velocity.y||_this.hasLanded||(_this.yVelHistory.forEach(function(element){}),_this.onLand())},_this.onLand=function(){_this.descending=!1,_this.hasLanded=!0,_this.onFloor=!0,WorldSignals.onFloorEnter.dispatch(),_this.updatePlatformCollision()},_this.onCollision=function(event){var xDist=_this.robot.x-event.pairs[0].activeContacts[0].vertex.x,yDist=_this.robot.y-event.pairs[0].activeContacts[0].vertex.y;if(xDist<-18||18<xDist){var rightSide=0<xDist;_this.onSideCollision(rightSide)}else yDist<18&&_this.onFloorCollision(event,yDist)},_this.onSideCollision=function(rightSide){_this._pushBack=(rightSide?2:-2)-.5*_this.velocityX,_this._pushBack=MathUtils.clamp(_this._pushBack,-5,5),_this.velocityX=_this._pushBack},_this.onFloorCollision=function(event,yDist){_this.onLand(),"Robot"==event.pairs[0].bodyA.label?(_this.currentTile=event.pairs[0].bodyB,_this.robot.legs.onLand(_this.currentTile.isRoughGround)):"Robot"==event.pairs[0].bodyB.label&&(_this.currentTile=event.pairs[0].bodyA,_this.robot.legs.onLand(_this.currentTile.isRoughGround))},_this.trySelectBody=function(newBody){var baseX=_this.robot.matterBody.baseCollider.position.x,baseY=_this.robot.matterBody.baseCollider.position.y;if(newBody==Constants.Parts_Body_Short){var basePos={x:baseX,y:baseY};return Matter.Body.setPosition(_this.robot.matterBody.medCollider,basePos),Matter.Body.setPosition(_this.robot.matterBody.tallCollider,basePos),!0}if(newBody==Constants.Parts_Body_Med){var midPos={x:baseX,y:baseY-160};if(null==_this.tileAtPoint(midPos)){Matter.Body.setPosition(_this.robot.matterBody.medCollider,midPos),Matter.Body.setPosition(_this.robot.matterBody.medCollider,midPos);basePos={x:baseX,y:baseY};return Matter.Body.setPosition(_this.robot.matterBody.tallCollider,basePos),!0}}else if(newBody==Constants.Parts_Body_Tall){midPos={x:baseX,y:baseY-160};var topPos={x:baseX,y:baseY-240};if(null==_this.tileAtPoint(midPos)&&null==_this.tileAtPoint(topPos))return Matter.Body.setPosition(_this.robot.matterBody.medCollider,midPos),Matter.Body.setPosition(_this.robot.matterBody.tallCollider,topPos),!0}return!1},_this.drillTile=function(coordId){for(var i=_this.drillableTiles.length-1;0<=i;i--){_this.drillableTiles[i].coordId===coordId&&(Matter.World.remove(_this.world,_this.drillableTiles[i]),_this.drillableTiles.splice(i,1))}},_this.meltIceWall=function(coordId){for(var i=_this.iceWalls.length-1;0<=i;i--){_this.iceWalls[i].coordId===coordId&&(Matter.World.remove(_this.world,_this.iceWalls[i]),_this.iceWalls.splice(i,1))}},_this.addFoamTile=function(tileX,tileY){_this.removeFoamTile();var x=tileX*Constants.TileWidth+Constants.TileWidth/2,y=tileY*Constants.TileHeight+Constants.TileHeight/2;_this.foamTile=Matter.Bodies.rectangle(x,y,Constants.TileWidth,Constants.TileHeight,{isStatic:!0}),_this.foamTile.collisionFilter.category=y-_this.robot.y<0?Collision.Off:Collision.On,_this.foamTile.label="FoamTile",Matter.World.add(_this.world,_this.foamTile),WorldSignals.foamTile.dispatch({x:x,y:y})},_this.removeFoamTile=function(){_this.foamTile&&(Matter.World.remove(_this.world,_this.foamTile),_this.foamTile=null)},_this.tileAtPoint=function(target){var points=Matter.Query.point(_this.levelGeomerty,target);return 0<points.length?points[0]:0<(points=Matter.Query.point(_this.platforms,target)).length?points[0]:0<(points=Matter.Query.point(_this.drillableTiles,target)).length?points[0]:_this.foamTile&&0<(points=Matter.Query.point([_this.foamTile],target)).length?points[0]:null},_this.robot=robot,_this.level=level,_this.levelHeight=level.Height,_this.levelWidth=level.Width,_this.engine=Matter.Engine.create(),_this.engine.constraintIterations=7,_this.world=_this.engine.world,Matter.Events.on(_this.engine,"collisionStart",_this.onCollision),WorldSignals.drillTile.add(_this.drillTile),WorldSignals.meltIceWall.add(_this.meltIceWall),WorldSignals.FoamColliderOn.add(function(){_this.foamTile.collisionFilter.category=Collision.On}),robot.matterBody=PhysicsBodyFactory.createRobotBody(_this.world),_this.setRobotPos(level.startPos),PhysicsBodyFactory.createLevel(_this.world,_this.level,function(levelGeomerty,platforms,drillableTiles,iceWalls,respawnTiles){_this.levelGeomerty=levelGeomerty,_this.platforms=platforms,_this.drillableTiles=drillableTiles,_this.iceWalls=iceWalls,_this.respawnTiles=respawnTiles}),_this.updatePlatformCollision(),_this}return __extends(GamePhysix,_super),Object.defineProperty(GamePhysix.prototype,"drillableXrayTiles",{get:function(){return this.drillableTiles.filter(function(t){return t.requiresXray})},enumerable:!1,configurable:!0}),GamePhysix.prototype.teardown=function(){Matter.Events.off(this.engine,"collisionStart",this.onCollision),this.level=null,this.engine=null,this.world=null},GamePhysix.prototype.update=function(delta){for(this.count=0,this.lag+=delta;this.lag>=this.interval&&this.count<=this.maxUpdateCount;)this.updatePhysic(this.interval),this.count++,this.lag-=this.interval;100<this.lag&&(this.lag=100)},GamePhysix.prototype.updatePhysic=function(interval){Matter.Engine.update(this.engine,interval),this.updateRobot(interval),this.updateOnFloorAndFallingState(interval),this.pushRobotAwayFromWalls(),this.landFallback(),this.slowDownFallSpeed()},GamePhysix.prototype.updateRobot=function(delta){this.isGliding()||this.robot.legs.update(delta),this.robot.arms.update(delta)},GamePhysix.prototype.updateOnFloorAndFallingState=function(delta){var pos={x:this.robot.x,y:this.robot.y+30},newTileUnderRobot=this.tileAtPoint(pos);this.tileUnderRobot!=newTileUnderRobot&&(this.tileUnderRobot=newTileUnderRobot,WorldSignals.onTileUpdate.dispatch(this.tileUnderRobot),this.updateRespawnPosition(this.tileUnderRobot,pos));var newOnFloor=null!=this.tileUnderRobot;this.onFloor&&!newOnFloor&&(this.hasLanded=!1,this.currentTile=null,this.updatePlatformCollision(),WorldSignals.onFloorExit.dispatch()),this.onFloor=newOnFloor,this.prevVelocityY<0&&0<=this.robot.velocity.y&&this.startingDescent(),this.prevVelocityY=this.robot.velocity.y},GamePhysix.prototype.updateRespawnPosition=function(tileUnderRobot,robotTilePos){if(tileUnderRobot&&0<Matter.Query.point(this.respawnTiles,robotTilePos).length){var facingRight=this.robot.facingRight,respawnPos={x:tileUnderRobot.position.x,y:tileUnderRobot.position.y-90};WorldSignals.respawnPositionUpdate.dispatch(respawnPos,facingRight)}},GamePhysix.prototype.canJump=function(){return this.hasLanded&&this.onFloor},GamePhysix.prototype.slowDownFallSpeed=function(){var yVelocity=this.robot.matterBody.velocity.y;this.descending&&.1<yVelocity&&this.setYVelocity(yVelocity-.1)},GamePhysix.prototype.setRobotPos=function(pos){Matter.Body.setPosition(this.robot.matterBody,pos)},GamePhysix.prototype.setXVelocity=function(value){this.velocityX=value,Matter.Body.setVelocity(this.robot.matterBody,{x:value,y:this.robot.velocity.y})},GamePhysix.prototype.setYVelocity=function(value){Matter.Body.setVelocity(this.robot.matterBody,{x:this.robot.velocity.x,y:value})},GamePhysix.prototype.heavymethod=function(){if(window.slow)for(var x=void 0,i=0;i<5e6;i++)x=1e10*Math.random(),Math.sqrt(x)},GamePhysix}(springroll.EventDispatcher);!function(Collision){Collision[Collision.On=1]="On",Collision[Collision.Off=2]="Off"}(Collision||(Collision={}));var GoogleAnalytics=function(){function GoogleAnalytics(){}return GoogleAnalytics.Init=function(){app.googleAnalytics?app.googleAnalytics.init("196475515"):console.error("Google Analytics service could not be initialized")},GoogleAnalytics.sendStartGame=function(){this.sendEvent("startGame")},GoogleAnalytics.sendEndGame=function(){this.sendEvent("endGame")},GoogleAnalytics.sendTutorialBegin=function(){this.sendEvent("tutorial_begin")},GoogleAnalytics.sendTutorialComplete=function(){this.sendEvent("tutorial_complete")},GoogleAnalytics.sendStartRound=function(stageName,levelID){this.sendEvent("startRound",this.getLevelLabel(stageName,levelID))},GoogleAnalytics.sendEndRound=function(stageName,levelID){this.sendEvent("endRound",this.getLevelLabel(stageName,levelID))},GoogleAnalytics.sendLevelScore=function(levelID,score){this.sendEvent("post_score","id "+levelID,score)},GoogleAnalytics.sendCurrencyEarned=function(currentPlanet,resourceCount){this.sendEvent("earn_virtual_currency",currentPlanet,resourceCount)},GoogleAnalytics.sendCurrencySpent=function(spent){var label="";spent.forEach(function(cost,index){0!==cost&&(label+=Constants.Planets[index]+" "+cost+". ")}),this.sendEvent("spend_virtual_currency",label)},GoogleAnalytics.getLevelLabel=function(stageName,levelID){return stageName+" - "+levelID},GoogleAnalytics.category="rjg-robot-platformer-app",GoogleAnalytics.sendEvent=function(action,label,value){app.googleAnalytics?(console.log("Google Analytics::send::",action,label,value),app.googleAnalytics.event(GoogleAnalytics.category,action,label,value)):console.error("Google Analytics service has not been initialized")},GoogleAnalytics}(),HiddenObjTimeout=function(delay,robot,level,gamePhysix){var _this=this;this.teardown=function(){clearTimeout(_this.timeout)},this.onTimeout=function(){clearTimeout(_this.timeout),_this.timeout=setTimeout(_this.onTimeout,1.75*_this.delay),app.lostFocus||(0<_this.level.heatResources.length&&_this.robot.head.name!=Constants.Parts_Head_HeatVision?(app.voPlayer.play("head-heat-to"),WorldSignals.showPartScaffold.dispatch("HeatObstacle")):0<_this.level.earResources.length&&_this.robot.head.name!=Constants.Parts_Head_SuperEars?(app.voPlayer.play("head-ears-to"),WorldSignals.showPartScaffold.dispatch("EarObstacle")):0<_this.gamePhysix.drillableXrayTiles.length&&_this.robot.head.name!=Constants.Parts_Head_XrayVision&&(app.voPlayer.play("head-xray-to"),WorldSignals.showPartScaffold.dispatch("XrayObstacle")))},this.delay=delay,this.robot=robot,this.level=level,this.gamePhysix=gamePhysix,this.timeout=setTimeout(this.onTimeout,delay)},IKSolver=function(){function IKSolver(){}return IKSolver.rotation=0,IKSolver.getRotation=function(robot,tile){if(IKSolver.rotation=0,null!=tile&&tile.isRoughGround){robot.pos.x,Constants.TileWidth;IKSolver.rotation=8*Math.random()-4;var pos01=1-robot.pos.x%Constants.TileWidth/Constants.TileWidth;IKSolver.rotation+=5*Math.sin(pos01*Math.PI*4)}return robot.facingRight||(IKSolver.rotation*=-1),IKSolver.rotation},IKSolver.getOffset=function(robot,tile){if(null!=tile&&tile.isRoughGround){var pos01=1-robot.pos.x%Constants.TileWidth/Constants.TileWidth;return 30+5*Math.sin(pos01*Math.PI*4)}return 10},IKSolver}(),LevelLoader=function(){function LevelLoader(){}return LevelLoader.requestLevel=function(levelInfo,callback){this.levelRequested||(this.levelRequested=!0,LevelLoader.load(levelInfo.levelID,function(jsonData){PlayerPrefs.currentLevel=levelInfo,PlayerPrefs.currentLevelJson=jsonData,callback()}))},LevelLoader.requestNextLevel=function(callback,isChallange,allowNewPart){this.levelRequested||(this.levelRequested=!0,this.newPartLevelAllowed(isChallange)&&allowNewPart?this.loadNextLevel(callback):this.requestLevelFromEnlearn(callback))},LevelLoader.newPartLevelAllowed=function(isChallenge){if(!EnlearnUtils.hasNextStep())return!1;var noMoreLevels=PlayerPrefs.levels.length>=Constants.Planets.length*Constants.LevelsPerPlanet-1;return isChallenge?noMoreLevels:!(PlayerPrefs.levels.length%9==0)},LevelLoader.requestHelpLevel=function(helpMissionID,callback){this.levelRequested||(this.levelRequested=!0,this.loadHelpLevel(helpMissionID,callback))},LevelLoader.loadNextLevel=function(callback){var _this=this;if(app.enlearn){var newStepType=EnlearnUtils.calulateNextStepType(),allowedStepTypes=EnlearnUtils.calulateAllowedStepTypes();app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"isReadyForStepType"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.enlearn.isReadyForStepType(allowedStepTypes,newStepType).then(function(isReady){if(app.analyticsEmitter.ReceivedEnlearnData(AnalyticsUtils.levelID,{type:"isReadyForStepType",value:"false"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),isReady=isReady||app.options.debug&&PlayerPrefs.autoCraft,PlayerPrefs.readyForNextPart=PlayerPrefs.readyForNextPart||isReady,isReady){var nextHelpMissionID=PlayerPrefs.partsUnlocked+1;_this.loadHelpLevel(nextHelpMissionID,callback)}else _this.requestLevelFromEnlearn(callback)})}else{if(.75<Math.random()){var nextHelpMissionID=PlayerPrefs.partsUnlocked+1;this.loadHelpLevel(nextHelpMissionID,callback)}else this.requestLevelFromEnlearn(callback)}},LevelLoader.loadHelpLevel=function(helpMissionID,callback){PlayerPrefs.helpMissionID=helpMissionID;var levelID=LevelLoader.helpMissions[helpMissionID],problemID=LevelLoader.getProblemFromLevel(levelID);LevelLoader.load(levelID,function(jsonData){var lvlNr=PlayerPrefs.levels.length,lvl=new LevelInfo(levelID,problemID,lvlNr);lvl.isTutorial=!0,PlayerPrefs.currentLevel=lvl,PlayerPrefs.currentLevelJson=jsonData,callback()})},LevelLoader.requestLevelFromEnlearn=function(callback){var appData={allowedStepTypes:EnlearnUtils.calulateAllowedStepTypes()};try{app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"getNextProblem"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.enlearn.getNextProblem(appData).then(function(problemID){app.analyticsEmitter.ReceivedEnlearnData(AnalyticsUtils.levelID,{type:"getNextProblem",value:"problemID"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),console.log("> LevelLoader::requestLevelFromEnlearn:: problemID: "+problemID);var levelID=LevelLoader.getLevelFromProblem(problemID);console.log("> Enlearn suggest "+levelID+" ("+problemID+")"),LevelLoader.load(levelID,function(jsonData){var lvlNr=PlayerPrefs.levels.length;PlayerPrefs.currentLevel=new LevelInfo(levelID,problemID,lvlNr),PlayerPrefs.currentLevelJson=jsonData,callback()})})}catch(e){console.error("Loading Enlearn level failed: ",e),this.requestRandomLevel(callback)}},LevelLoader.requestRandomLevel=function(callback){console.log("> LevelLoader::requestRandomLevel");var levelID=this.getRandomLevelID(),problemID=LevelLoader.getProblemFromLevel(levelID);LevelLoader.load(levelID,function(jsonData){var lvlNr=PlayerPrefs.levels.length;PlayerPrefs.currentLevel=new LevelInfo(levelID,problemID,lvlNr),PlayerPrefs.currentLevelJson=jsonData,callback()})},LevelLoader.load=function(levelID,callback){var lvl=app.config.levels[levelID];lvl?callback(lvl):(console.warn("Error loading level, "),console.warn("Loading Random level instead."),this.requestRandomLevel(callback)),this.levelRequested=!1},LevelLoader.getLevelFromProblem=function(problemID){for(var levels=app.config.enlearnEcosystem.problems,i=0;i<levels.length;i++)if(levels[i].id==problemID)return levels[i].name;return console.warn("problemID "+problemID+" is not mapped to a level"),LevelLoader.getRandomLevelID()},LevelLoader.getProblemFromLevel=function(levelID){for(var levels=app.config.enlearnEcosystem.problems,i=0;i<levels.length;i++)if(levels[i].name==levelID)return levels[i].id;return console.warn("levelID "+levelID+" is not mapped to a level"),null},LevelLoader.getRandomLevelID=function(){console.log("LevelLoader::getRandomLevelID");var tierID=MathUtils.clamp(PlayerPrefs.partsUnlocked+1,0,Constants.UnlockOrder.length+1);tierID=Math.floor(Math.random()*tierID);var levelID=Math.floor(Math.random()*LevelLoader.levels[tierID].length);return LevelLoader.levels[tierID][levelID]},LevelLoader.levels=[["a001","a002","a003","a004","a005","a006","a007"],["b001","b002","b003","b004","b005","b099","b100"],["c001","c002","c003","c004","c005","c006","c007","c008","c100"],["d001","d002","d003","d004","d005","d006","d007","d099"],["e001","e002","e003","e004","e005","e006","e007","e008","e099","e100"],["f001","f002","f003","f004","f005","f006","f007"],["g001","g002","g003","g004","g005","g006","g007"],["h001","h002","h003","h004","h005","h006"],["i001","i002","i003","i004","i005","i006"],["j001","j002","j003","j004","j005","j006"],["k001","k002","k003","k004","k005","k006"],["m001","m002","m003","m004","m005","m006"],["n001","n002","n003","n004","n005","n006"]],LevelLoader.helpMissions=["a001","b004","c003","d001","e006","f001","g001","h004","i001","j002","k004","m001","n001"],LevelLoader.levelRequested=!1,LevelLoader}(),MenuLoader=function(_super){function MenuLoader(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.load=function(progressCallback,completCallback){var particles,anims;_this.isLoaded?completCallback():(_this.loadImages(),_this.animLoader=new PIXI.loaders.Loader,_this.particleLoader=new PIXI.loaders.Loader,anims=app.config.animations.menu,Device.lowEndDevice?particles=app.config.particles.menuLowEnd:(particles=app.config.particles.menu,anims=anims.concat(app.config.animations.menuHeads)),_this.loadAssets(_this.particleLoader,"",particles,_this.particleLoaded),_this.loadAssets(_this.animLoader,"",anims,_this.animLoaded),_this.progressCallback=progressCallback,_this.completCallback=completCallback)},_this.loadImages=function(){_this.loadIntroAssets=PlayerPrefs.tutStep==TutStep.Intro,_this.imgLoader=new PIXI.loaders.Loader;var images=app.config.loading.images.menu;images=images.concat(app.config.loading.images.partHud),_this.loadIntroAssets&&(_this.totalCategories++,images=images.concat(app.config.loading.images.intoAnim)),images=images.concat(app.config.loading.images.rewardScreen),images=MenuLoader.sunspotToggle?images.concat([{id:"sunspot",src:"images/rewardScreen/SunspotReward1.png"}]):images.concat([{id:"sunspot",src:"images/rewardScreen/SunspotReward2.png"}]),PlayerPrefs.tutStep==TutStep.Intro&&(images=images.concat(app.config.loading.images.tutorial)),_this.loadAssets(_this.imgLoader,app.assetPrefix,images,_this.menuImagesLoaded)},_this.menuImagesLoaded=function(loader,resource){_this.imgLoaded(loader,resource),_this.loadIntroAssets&&_this.loadIntro()},_this.loadIntro=function(){var introTextures={SpaceBackground:Textures.get("SpaceBackground"),RewardsEarth:Textures.get("RewardsEarth"),RewardsMoon:Textures.get("RewardsMoon"),RewardsMars:Textures.get("RewardsMars"),RewardsEnceladus:Textures.get("RewardsEnceladus"),RewardsBortron7:Textures.get("RewardsBortron7"),ResourceChip:Textures.get("ResourceChip"),Bortron7_sky:Textures.get("Bortron7_sky"),Bortron7_bg2:Textures.get("Bortron7_bg2"),Bortron7_bg3:Textures.get("Bortron7_bg3"),Bortron7_bg4:Textures.get("Bortron7_bg4"),Bortron7_bg5:Textures.get("Bortron7_bg5"),OrbitLine:Textures.get("OrbitLine"),BuildGrid:Textures.get("BuildGrid"),botTut1:Textures.get("botTut1"),botTut2:Textures.get("botTut2"),botTut3:Textures.get("botTut3"),botTut4:Textures.get("botTut4"),WorkShop:Textures.get("WorkShop")},atlas=new PIXI.spine.core.TextureAtlas;atlas.addTextureHash(introTextures,!0);var loader=new PIXI.loaders.Loader;loader.add("introAnim","assets/animations/intro/IntroAnim.json",{metadata:{spineAtlas:atlas}}),loader.once("complete",function(loader,resources){Animations.introAnim=resources.introAnim,_this.categoryComplete()}),loader.load()},_this}return __extends(MenuLoader,_super),MenuLoader.sunspotToggle=!1,MenuLoader}(SceneLoader),ObstacleDetection=function(robot,level){var _this=this;this.hintToggle=!1,this.passedObstacles=[],this.correct=1,this.incorrect=0,this.exitedHighPlatformObstacles=[],this.teardown=function(){clearInterval(_this.obstacleCheckInterval)},this.checkObstacleEnter=function(){if(!app.lostFocus){_this.newObstacle=null;for(var i=0;i<_this.level.obstacleZones.length;i++)if(_this.level.obstacleZones[i].contains(_this.robot.pos)){_this.newObstacle=_this.level.obstacleZones[i];break}_this.currentObstacle&&!_this.newObstacle?_this.robotLeftObstacle():!_this.currentObstacle&&_this.newObstacle&&_this.robotEnteredObstacle(_this.newObstacle)}},this.fallOnRocks=function(){_this.failCurrentObstacle()},this.robotEnteredObstacle=function(newObstacle){_this.currentObstacle=newObstacle,1==_this.currentObstacle.partCombinations[0].requiresBody?_this.attemptCurrentObstacle(!0):0==_this.currentObstacle.partCombinations[0].requiresArms?_this.attemptCurrentObstacle(!1):_this.currentObstacle.hasAltSolution&&0==_this.currentObstacle.partCombinations[1].requiresArms&&_this.attemptCurrentObstacle(!1)},this.checkForHighPlatformHint=function(obstacleID){if(!(-1<EnlearnUtils.completedObstacles.indexOf(obstacleID)||-1==Constants.highPlatformObstacleIds.indexOf(obstacleID))){var index=_this.exitedHighPlatformObstacles.map(function(obj){return obj.id}).indexOf(obstacleID);if(-1<index){var obstacle=_this.exitedHighPlatformObstacles[index];obstacle.count++,2<obstacle.count&&(app.voPlayer.play("fail-2"),WorldSignals.flashMenuButtons.dispatch([Constants.Arms,Constants.Legs]),obstacle.count=0)}else _this.exitedHighPlatformObstacles.push({id:obstacleID,count:1})}},this.robotLeftObstacle=function(){_this.checkForHighPlatformHint(_this.currentObstacle.id),_this.currentObstacle=null},this.legsSelected=function(){_this.currentObstacle&&1==_this.currentObstacle.partCombinations[0].requiresLegs&&0==_this.currentObstacle.partCombinations[0].requiresArms?_this.attemptCurrentObstacle(!0):WorldSignals.closeHUDTray.dispatch()},this.armsSelected=function(){WorldSignals.closeHUDTray.dispatch()},this.useArms=function(recordFail){_this.currentObstacle&&1==_this.currentObstacle.partCombinations[0].requiresArms&&_this.attemptCurrentObstacle(!0)},this.bodySelected=function(){_this.currentObstacle&&1==_this.currentObstacle.partCombinations[0].requiresBody&&0==_this.currentObstacle.partCombinations[0].requiresArms?_this.attemptCurrentObstacle(!0):WorldSignals.closeHUDTray.dispatch()},this.headSelected=function(){_this.currentObstacle&&1==_this.currentObstacle.partCombinations[0].requiresHead&&0==_this.currentObstacle.partCombinations[0].requiresArms?_this.attemptCurrentObstacle(!0):WorldSignals.closeHUDTray.dispatch()},this.passCurrentObstacle=function(){if(_this.currentObstacle&&!_this.currentObstacle.completed){console.log("ObstacleDetection::passCurrentObstacle: "+_this.currentObstacle.id),_this.currentObstacle.completed=!0;var obsType=_this.getObstacleType(),obsID=_this.currentObstacle.id;_this.passedObstacles.push(obsID),WorldSignals.enlearnAttempt.dispatch(!0,obsType),app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"recordStepAttempt",value:"passed"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.enlearn?(app.enlearn.recordStepAttempt(_this.currentObstacle.id,_this.correct),EnlearnUtils.completedObstacles.push(_this.currentObstacle.id)):console.warn("enlearn not available")}else console.warn("Trying to pass obstacle which does not exist.")},this.getObstacleType=function(){if(_this.currentObstacle&&_this.currentObstacle.partCombinations[0])for(var eco=app.config.enlearnEcosystem,probs=eco.problems,types=eco.stepTypes,i=0;i<probs.length;i++)for(var steps=probs[i].steps,j=0;j<steps.length;j++)if(steps[j].id==_this.currentObstacle.id)for(var k=0;k<types.length;k++)if(types[k].id==steps[j].type)return types[k].name;return""},this.failCurrentObstacle=function(){if(_this.currentObstacle)if(_this.currentObstacle.completed)console.warn("Trying to fail obstacle which has been passed.");else{var obsID=_this.currentObstacle.id,obsType=_this.getObstacleType(),delay=_this.getObstacleFailDelay(obsType);setTimeout(function(){return _this.delayedFail(obsID,obsType)},delay)}else console.warn("Trying to fail obstacle which does not exist.")},this.getObstacleFailDelay=function(obsType){return"ShortBody"==obsType?5e3:100},this.delayedFail=function(ObstacleID,obsType){console.log("ObstacleDetection::delayedFail:: id"+ObstacleID),app.enlearn?-1==_this.passedObstacles.indexOf(ObstacleID)?(WorldSignals.enlearnAttempt.dispatch(!1,obsType),_this.playScaffold(_this.currentObstacle.id),app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"recordStepAttempt",value:"failed"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.enlearn.recordStepAttempt(_this.currentObstacle.id,_this.incorrect),console.log("delayedFail: "+ObstacleID+" failed.")):console.log("delayedFail: "+ObstacleID+" ignored, because we've since passed it."):console.warn("enlearn not available")},this.attemptCurrentObstacle=function(recordFail){if(_this.currentObstacle&&!_this.currentObstacle.completed){for(var i=0;i<_this.currentObstacle.partCombinations.length;i++)if(_this.currentObstacle.partCombinations[i].hasCorrectParts(_this.robot))return void _this.passCurrentObstacle();recordFail&&_this.failCurrentObstacle()}},this.playScaffold=function(obstacleId){app.enlearn?(app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"getNextScaffold"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.enlearn.getNextScaffold(obstacleId).then(function(scaffoldID){var hint=null,scaffold=EnlearnUtils.getScaffoldInfo(scaffoldID);scaffold&&0==scaffold.level?(hint=_this.getConcreteHint(scaffold.stepName),WorldSignals.showPartScaffold.dispatch(scaffold.stepName)):scaffold&&1==scaffold.level?(hint=_this.getMediumHint(scaffold.stepName),WorldSignals.showPartScaffold.dispatch(scaffold.stepName)):hint=_this.getGenericHint(),app.voPlayer.play(hint),app.enlearn.recordScaffoldShown(obstacleId,scaffoldID);try{app.analyticsEmitter.startIncorrectFeedback(AnalyticsUtils.levelID,"wrong part feedback","wrongPartVO","audio",4e3,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),app.analyticsEmitter.ReceivedEnlearnData(AnalyticsUtils.levelID,{type:"getNextScaffold",value:"scaffoldID"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),setTimeout(function(){return app.analyticsEmitter.endIncorrectFeedback(AnalyticsUtils.levelID,"wrong part feedback","wrongPartVO","audio",4e3)},4e3,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}catch(e){}})):app.voPlayer.play(_this.getGenericHint())},this.getGenericHint=function(){return _this.hintToggle=!_this.hintToggle,_this.hintToggle?"fail-1":"fail-2"},this.getMediumHint=function(obstacleName){switch(obstacleName){case"CreviceCollect":return"d-fail-wall-gap";case"RockyGround":return"d-fail-rocky-terrain";case"Ledge1or2Tiles":case"Gap1Tile":return"d-fail-ledge";case"Gap2Tile":return"d-fail-large-ground-gap";case"DrillObstacle":return"d-fail-dry-ground";case"ShortBody":return"d-fail-narrow-tunnel";case"FoamObstacle":return"d-fail-ground-gap";case"TallBody":return"d-fail-high-wall-gap";case"EarObstacle":return"head-ears-to";case"HeatObstacle":return"head-heat-to";case"Ledge3or4Tiles":return 7<PlayerPrefs.partsUnlocked?"d-fail-ice-wall-moving":"d-fail-ground-gap";case"XrayObstacle":return _this.robot.head.name!=Constants.Parts_Head_XrayVision?"head-xray-to":_this.robot.arms.name!=Constants.Parts_Drill?"d-fail-dry-ground":_this.getGenericHint();case"Booster":return _this.robot.arms.name!=Constants.Parts_Booster?"d-fail-ice-wall":_this.robot.legs.name!=Constants.Parts_Tracks?"d-fail-ice-wall-moving":_this.getGenericHint()}return _this.getGenericHint()},this.getConcreteHint=function(obstacleName){switch(obstacleName){case"CreviceCollect":return"d-fail-pincer-gap";case"RockyGround":return"d-fail-treads-rocky";case"Ledge1or2Tiles":case"Gap1Tile":return"d-fail-spring-ledge";case"Gap2Tile":return"d-fail-wings-gap";case"DrillObstacle":return"d-fail-drill-ground";case"ShortBody":return"d-fail-small-tunnel";case"FoamObstacle":return"d-fail-foamer-ledge";case"TallBody":return"d-fail-tall-gap";case"EarObstacle":return"head-ears-to";case"HeatObstacle":return"head-heat-to";case"XrayObstacle":return"head-xray-to";case"Ledge3or4Tiles":return 7<PlayerPrefs.partsUnlocked?"d-fail-rocket-higher":"d-fail-foamer-ledge";case"XrayObstacle":return _this.robot.head.name!=Constants.Parts_Head_XrayVision?"head-xray-to":_this.robot.arms.name!=Constants.Parts_Drill?"d-fail-drill-ground":_this.getGenericHint();case"Booster":return _this.robot.arms.name!=Constants.Parts_Booster?"d-fail-booster-ice":_this.robot.legs.name!=Constants.Parts_Tracks?"d-fail-tread-booster":_this.getGenericHint()}return _this.getGenericHint()},this.robot=robot,this.level=level,WorldSignals.selectLegs.add(this.legsSelected),WorldSignals.selectArms.add(this.armsSelected),WorldSignals.selectBody.add(this.bodySelected),WorldSignals.selectHead.add(this.headSelected),WorldSignals.useArms.add(this.useArms),this.obstacleCheckInterval=setInterval(this.checkObstacleEnter,200)},HelpMissionIntro=function(){function HelpMissionIntro(missionID,missionRecord,gameUI){if(this.update=function(){},this.teardown=function(){},0<missionID){var isMissingPart=missionID>PlayerPrefs.partsUnlocked;if(isMissingPart)app.voPlayer.play("new-part-required"),missionRecord.isMissingPart=isMissingPart,gameUI.wiggleHomeBtn(),PlayerPrefs.readyForNextPart=!0,WorldSignals.trySelectLegs.dispatch(Constants.Parts_Wheels),WorldSignals.trySelectArms.dispatch(Constants.Parts_Pincer),WorldSignals.trySelectBody.dispatch(Constants.Parts_Body_Med),WorldSignals.trySelectHead.dispatch(Constants.Parts_Head_Normal);else{var voID=HelpMissionUtils.getIntroVO();app.voPlayer.delayedPlay(voID,50),HelpMissionIntro.activeInstructionID=voID+"intro",app.analyticsEmitter.startInstruction(AnalyticsUtils.levelID,"partIntroduction",HelpMissionIntro.activeInstructionID,"audio",HelpMissionIntro.averageInstructionLength,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge),setTimeout(function(){app.analyticsEmitter.endInstruction(AnalyticsUtils.levelID,"audio",HelpMissionIntro.averageInstructionLength,"partIntroduction",HelpMissionIntro.activeInstructionID,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},HelpMissionIntro.averageInstructionLength)}}}return HelpMissionIntro.activeInstructionID="",HelpMissionIntro.averageInstructionLength=7e3,HelpMissionIntro}(),PartManager=function(robot,level,gamePhysix){var _this=this;this.teardown=function(){_this.robot&&(_this.robot.legs&&_this.robot.legs.teardown(),_this.robot.arms&&_this.robot.arms.teardown(),_this.robot.head&&_this.robot.head.teardown())},this.setupInitialRobot=function(){_this.trySelectLegs(PlayerPrefs.robotLegs,!0),_this.trySelectArms(PlayerPrefs.robotArms,!0),_this.trySelectHead(PlayerPrefs.robotHead,!0);var robotBody=PlayerPrefs.robotBody;_this.trySelectBody(Constants.Parts_Body_Med,!0),robotBody!=Constants.Parts_Body_Med&&setTimeout(function(){_this.trySelectBody(robotBody,!0)},50)},this.trySelectLegs=function(legsName,initial){if(void 0===initial&&(initial=!1),_this.robot.isAlive&&(null==_this.robot.legs||_this.robot.legs.name!=legsName)){var prevPart="none";_this.robot.legs&&(prevPart=_this.robot.legs.name,_this.robot.legs.teardown());var legs=RobotParts.getLegs(legsName);if(legs.init(_this.gamePhysix,_this.robot),_this.robot.legs=legs,_this.gamePhysix.onFloor&&_this.gamePhysix.currentTile&&_this.gamePhysix.currentTile.isRoughGround&&_this.robot.legs.onLand(!0),PlayerPrefs.robotLegs=legsName,WorldSignals.selectLegs.dispatch(legsName),!initial){if(!app.voPlayer.playing){var r=.5<Math.random();legsName==Constants.Parts_Wheels?app.voPlayer.play("equip-wheel"+(r?"":"-mindy")):legsName==Constants.Parts_Tracks?app.voPlayer.play("equip-tread"+(r?"":"-mindy")):legsName==Constants.Parts_Springs?app.voPlayer.play("equip-springs"+(r?"":"-mindy")):legsName==Constants.Parts_Rocket&&app.voPlayer.play("equip-rocket"+(r?"":"-mindy"))}app.analyticsEmitter.selectAnswer(AnalyticsUtils.levelID,AnalyticsUtils.clickPos,"legs",legsName,prevPart,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}}},this.trySelectArms=function(armName,initial){if(void 0===initial&&(initial=!1),null==_this.robot.arms||_this.robot.arms.name!=armName){var prevPart="none";_this.robot.arms&&(prevPart=_this.robot.arms.name,_this.robot.arms.teardown());var arms=RobotParts.getArms(armName);if(arms.init(_this.gamePhysix,_this.robot),_this.robot.arms=arms,PlayerPrefs.robotArms=armName,WorldSignals.selectArms.dispatch(armName),!initial){if(!app.voPlayer.playing){var r=.5<Math.random();armName==Constants.Parts_Pincer?app.voPlayer.play("equip-pincers"+(r?"":"-mindy")):armName==Constants.Parts_Drill?app.voPlayer.play("equip-drill"+(r?"":"-mindy")):armName==Constants.Parts_Wings?app.voPlayer.play("equip-wings"+(r?"":"-mindy")):armName==Constants.Parts_Foamer?app.voPlayer.play("equip-foamer"+(r?"":"-mindy")):armName==Constants.Parts_Booster&&app.voPlayer.play("equip-boosters"+(r?"":"-mindy"))}app.analyticsEmitter.selectAnswer(AnalyticsUtils.levelID,AnalyticsUtils.clickPos,"arms",armName,prevPart,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}}},this.trySelectBody=function(bodyName,initial){var nameTemp;void 0===initial&&(initial=!1),null!=_this.robot.body&&(nameTemp=_this.robot.body.name);var name=nameTemp;if(null==_this.robot.body||name!=bodyName){var prevPart="none";if(_this.robot.body&&(prevPart=_this.robot.body.name),_this.gamePhysix.trySelectBody(bodyName)){var armsAvailable=bodyName!=Constants.Parts_Body_Short;if(WorldSignals.setArmsBtnState.dispatch(armsAvailable),_this.robot.arms.enabled=armsAvailable,PlayerPrefs.robotBody=bodyName,_this.robot.body=RobotParts.getBody(bodyName),WorldSignals.selectBody.dispatch(bodyName),!initial){if(!app.voPlayer.playing){var r=.5<Math.random();bodyName==Constants.Parts_Body_Short?app.voPlayer.play("equip-short-body"+(r?"":"-mindy")):bodyName==Constants.Parts_Body_Med?app.voPlayer.play("equip-medium-body"+(r?"":"-mindy")):bodyName==Constants.Parts_Body_Tall&&app.voPlayer.play("equip-tall-body"+(r?"":"-mindy"))}app.analyticsEmitter.selectAnswer(AnalyticsUtils.levelID,AnalyticsUtils.clickPos,"body",bodyName,prevPart,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}}else console.log("> Cant select "+bodyName+", blocked by tile above robot.")}},this.trySelectHead=function(headName,initial){if(void 0===initial&&(initial=!1),null==_this.robot.head||_this.robot.head.name!=headName){var prevPart="none";_this.robot.head&&(prevPart=_this.robot.head.name,_this.robot.head.teardown());var head=RobotParts.getHead(headName);if(head.init(_this.robot,_this.level),_this.robot.head=head,PlayerPrefs.robotHead=headName,WorldSignals.selectHead.dispatch(headName),!initial){if(!app.voPlayer.playing){var r=.5<Math.random();headName==Constants.Parts_Head_Normal?app.voPlayer.play("equip-basic-head"+(r?"":"-mindy")):headName==Constants.Parts_Head_SuperEars?app.voPlayer.play("equip-sonar-head"+(r?"":"-mindy")):headName==Constants.Parts_Head_XrayVision?app.voPlayer.play("equip-xray-head"+(r?"":"-mindy")):headName==Constants.Parts_Head_HeatVision&&app.voPlayer.play("equip-heat-head"+(r?"":"-mindy"))}app.analyticsEmitter.selectAnswer(AnalyticsUtils.levelID,AnalyticsUtils.clickPos,"head",headName,prevPart,AnalyticsUtils.stars,AnalyticsUtils.resources,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}}},this.robot=robot,this.level=level,this.gamePhysix=gamePhysix,this.setupInitialRobot(),WorldSignals.trySelectLegs.add(this.trySelectLegs),WorldSignals.trySelectArms.add(this.trySelectArms),WorldSignals.trySelectBody.add(this.trySelectBody),WorldSignals.trySelectHead.add(this.trySelectHead)},PhysicsBodyFactory=function(){function PhysicsBodyFactory(){}return PhysicsBodyFactory.createRobotBody=function(world){var baseCollider=Matter.Bodies.circle(100,60,22,{label:"Robot"}),shortCollider=Matter.Bodies.circle(100,-20,10),medCollider=Matter.Bodies.circle(100,-100,10),tallCollider=Matter.Bodies.circle(100,-180,10),compositBody=Matter.Body.create({parts:[baseCollider,shortCollider,medCollider,tallCollider],inertia:1/0});compositBody.collisionFilter.category=Collision.On,compositBody.collisionFilter.mask=Collision.On,Matter.World.add(world,compositBody),compositBody.position.y+=30,compositBody.positionPrev.y=compositBody.position.y;var robotBody=compositBody;return robotBody.baseCollider=baseCollider,robotBody.shortCollider=shortCollider,robotBody.medCollider=medCollider,robotBody.tallCollider=tallCollider,robotBody},PhysicsBodyFactory.createLevel=function(world,level,callback){var i,x,y,coordId,tileId,levelWidth=level.Width,heightInPix=level.Height*Constants.TileHeight,widthInPix=level.Width*Constants.TileWidth,platforms=[],drillableTiles=[],iceWalls=[],levelGeomerty=[],respawnTiles=[];levelGeomerty.push(Matter.Bodies.rectangle(widthInPix/2,heightInPix-50,widthInPix,50,{isStatic:!0})),levelGeomerty.push(Matter.Bodies.rectangle(290,heightInPix/2,50,heightInPix+3e3,{isStatic:!0})),levelGeomerty.push(Matter.Bodies.rectangle(widthInPix-290,heightInPix/2,50,heightInPix+3e3,{isStatic:!0}));var colliders=level.colliders;for(i=0;i<colliders.length;i++)if(0!==(tileId=colliders[i])){if(x=Math.floor(i%levelWidth),coordId=(y=Math.floor(i/levelWidth))*level.Width+x,tileId===TileID.drillHole||tileId===TileID.drillThrough||tileId===TileID.drillHoleCoverCracked||tileId===TileID.drillThroughCoverCracked)drillableTiles.push(this.makeDrillableTile(x,y,coordId));else if(tileId===TileID.xrayDrillHole||tileId===TileID.xrayDrillThrough)drillableTiles.push(this.makeDrillableTile(x,y,coordId,!0));else if(TileUtils.isPlatform(tileId))platforms.push(this.makeTile(x,y,coordId));else if(TileUtils.isSlope(tileId))levelGeomerty.push(this.makeSlope(x,y,tileId,coordId));else if(TileUtils.isSmallDip(tileId))levelGeomerty.push(this.makeSingleDip(x,y,coordId));else if(tileId===TileID.dipLeft||tileId===TileID.dipLeftEnd)levelGeomerty.push(this.makeDipLeft(x,y,coordId));else if(tileId===TileID.dipRight||tileId===TileID.dipRightEnd)levelGeomerty.push(this.makeDipRight(x,y,coordId));else if(tileId===TileID.iceWallBase)iceWalls.push(this.makeIceWall(x,y,coordId));else if(tileId===TileID.iceWallMid||tileId===TileID.iceWallTop);else if(TileUtils.isRoughGround(tileId)){var tile=this.makeTile(x,y,coordId);tile.isRoughGround=!0,levelGeomerty.push(tile)}else y<level.Height-1&&1<x&&x<level.Width-2&&levelGeomerty.push(this.makeTile(x,y,coordId));TileUtils.isValidRespawnPosition(tileId)&&respawnTiles.push(this.makeTile(x,y,coordId))}Matter.World.add(world,levelGeomerty),Matter.World.add(world,drillableTiles),Matter.World.add(world,iceWalls),Matter.World.add(world,platforms),callback(levelGeomerty,platforms,drillableTiles,iceWalls,respawnTiles)},PhysicsBodyFactory.makeDrillableTile=function(x,y,coordId,requiresXray){void 0===requiresXray&&(requiresXray=!1),x=x*Constants.TileWidth+Constants.TileWidth/2,y=y*Constants.TileHeight+Constants.TileHeight/2;var width=2*Constants.TileWidth,tile=Matter.Bodies.rectangle(x,y,width,Constants.TileHeight,{isStatic:!0});tile.collisionFilter.category=Collision.On,tile.label="DrillTile_"+coordId;var drillableTile=tile;return drillableTile.coordId=coordId,drillableTile.requiresXray=requiresXray,drillableTile},PhysicsBodyFactory.makeIceWall=function(x,y,coordId){x=x*Constants.TileWidth+Constants.TileWidth/2,y=y*Constants.TileHeight-Constants.TileHeight/2;var wallCollider=Matter.Bodies.rectangle(x,y,Constants.TileWidth,3*Constants.TileHeight,{isStatic:!0});wallCollider.collisionFilter.category=Collision.On,wallCollider.label="IceWall_"+coordId;var iceWall=wallCollider;return iceWall.coordId=coordId,iceWall},PhysicsBodyFactory.makeSlope=function(x,y,tileId,coordId){x*=Constants.TileWidth,y*=Constants.TileHeight;var slope,vectors=[];return tileId===TileID.slopeMidLeft||tileId===TileID.slopeTopLeft?(vectors=[{x:0,y:0},{x:0,y:Constants.TileHeight},{x:Constants.TileWidth,y:Constants.TileHeight}],(slope=Matter.Bodies.fromVertices(x+.33*Constants.TileWidth,y+.66*Constants.TileHeight,vectors,{isStatic:!0})).slopeLeft=!0):tileId!==TileID.slopeMidRight&&tileId!==TileID.slopeTopRight||(vectors=[{x:0,y:Constants.TileHeight},{x:Constants.TileWidth,y:0},{x:Constants.TileWidth,y:Constants.TileHeight}],(slope=Matter.Bodies.fromVertices(x+.66*Constants.TileWidth,y+.66*Constants.TileHeight,vectors,{isStatic:!0})).slopeRight=!0),slope.collisionFilter.category=Collision.On,slope.label="Slope_"+coordId,slope},PhysicsBodyFactory.makeSingleDip=function(x,y,coordId){x*=Constants.TileWidth,y*=Constants.TileHeight;var vectors;vectors=[{x:0,y:0},{x:0,y:Constants.TileHeight},{x:Constants.TileWidth,y:Constants.TileHeight},{x:Constants.TileWidth,y:0},{x:.5*Constants.TileWidth,y:.2*Constants.TileHeight}];var dip=Matter.Bodies.fromVertices(x+.61*Constants.TileWidth,y+.505*Constants.TileHeight,vectors,{isStatic:!0});return dip.label="Dip_"+coordId,dip.collisionFilter.category=Collision.On,dip},PhysicsBodyFactory.makeDipLeft=function(x,y,coordId){x*=Constants.TileWidth,y*=Constants.TileHeight;var vectors;vectors=[{x:0,y:0},{x:0,y:Constants.TileHeight},{x:Constants.TileWidth,y:Constants.TileHeight},{x:Constants.TileWidth,y:.45*Constants.TileHeight},{x:.4*Constants.TileWidth,y:.25*Constants.TileHeight}];var dip=Matter.Bodies.fromVertices(x+.35*Constants.TileWidth,y+.551*Constants.TileHeight,vectors,{isStatic:!0});return dip.label="Dip_"+coordId,dip.collisionFilter.category=Collision.On,dip},PhysicsBodyFactory.makeDipRight=function(x,y,coordId){x*=Constants.TileWidth,y*=Constants.TileHeight;var vectors;vectors=[{x:0,y:.45*Constants.TileHeight},{x:0,y:Constants.TileHeight},{x:Constants.TileWidth,y:Constants.TileHeight},{x:Constants.TileWidth,y:0},{x:.6*Constants.TileWidth,y:.25*Constants.TileHeight}];var dip=Matter.Bodies.fromVertices(x+.65*Constants.TileWidth,y+.551*Constants.TileHeight,vectors,{isStatic:!0});return dip.label="Dip_"+coordId,dip.collisionFilter.category=Collision.On,dip},PhysicsBodyFactory.makeTile=function(x,y,coordId){x=x*Constants.TileWidth+Constants.TileWidth/2,y=y*Constants.TileHeight+Constants.TileHeight/2;var tile=Matter.Bodies.rectangle(x,y,Constants.TileWidth,Constants.TileHeight,{isStatic:!0});return tile.label="Tile_"+coordId,tile.collisionFilter.category=Collision.On,tile},PhysicsBodyFactory}(),PickupCollection=function(robot,level){var _this=this;this._topY=0,this._botY=65,this.update=function(delta){this._pickup=this.testCollision(this.level.pickups),null!=this._pickup&&(WorldSignals.collectStar.dispatch(this._pickup),this.level.pickups.remove(this._pickup)),this._resource=this.testCollision(this.level.resources),null!=this._resource&&this._resource.enabled&&(null!=this._resource.requiredPart&&this.robot.head.name!==this._resource.requiredPart||(WorldSignals.collectResource.dispatch(this._resource),this.level.resources.remove(this._resource)))},this.testCollision=function(items){_this._playerX=_this.robot.pos.x,_this._playerY=_this.robot.pos.y-Constants.TileHeight/2,_this._botY=65,_this._topY=-170,_this.robot.body.name==Constants.Parts_Body_Tall?_this._topY=-230:_this.robot.body.name==Constants.Parts_Body_Short&&(_this._topY=-120);for(var i=0;i<items.length;i++)if(_this._xDist=Math.abs(items[i].x-_this._playerX),_this._xDist<55&&(_this._yDist=items[i].y-_this._playerY,_this._yDist>_this._topY&&_this._yDist<_this._botY))return items[i]},this.tryGrabResources=function(){_this._grabX=_this.robot.pos.x+(_this.robot.facingRight?130:-130),_this._grabY=_this.robot.pos.y+(_this.robot.body.name==Constants.Parts_Body_Tall?-180:-90);for(var i=0;i<_this.level.resources.length;i++)if(_this._resource=_this.level.resources[i],_this._resource.enabled&&(_this._xDist=Math.abs(_this._resource.x-_this._grabX),_this._yDist=Math.abs(_this._resource.y-_this._grabY),_this._xDist<40&&_this._yDist<40))return _this.level.resources.splice(i,1),void WorldSignals.collectResource.dispatch(_this._resource)},this.robot=robot,this.level=level,WorldSignals.tryGrabResources.add(this.tryGrabResources)},PlanetService=function(){function PlanetService(progress){this.progress=progress}return PlanetService.prototype.numberOfUnlockedPlanet=function(){return Math.floor(this.progress.length/Constants.LevelsPerPlanet)},PlanetService.prototype.isNextPlanetForProgression=function(planetIndex){var isLastUnlockedPlanet=planetIndex==this.numberOfUnlockedPlanet(),indexFirstLevel=Constants.LevelsPerPlanet*(planetIndex+1)-1-Constants.LevelsPerPlanet+1;return this.progress.length<=indexFirstLevel&&isLastUnlockedPlanet},PlanetService.prototype.planetForIndex=function(index){return Constants.Planets[index]},PlanetService.prototype.isPlanetUnlocked=function(index){return index<=this.numberOfUnlockedPlanet()},PlanetService.getResourceForPlanet=function(index){return Constants.Resources[index]},PlanetService.planetIdFromLevel=function(levelNr){return Math.floor(levelNr/Constants.LevelsPerPlanet)},PlanetService}(),PlayerPrefs=function(){function PlayerPrefs(){}return PlayerPrefs.load=function(){localStorage.getItem("VERSION");localStorage.setItem("VERSION",""+PlayerPrefs.VERSION),PlayerPrefs.tutStep=localStorage.getItem("tutStep"),PlayerPrefs.swapTutorialPlayed=!0===JSON.parse(localStorage.getItem("swapTutorialPlayed")),PlayerPrefs.foamerTutorialPlayed=!0===JSON.parse(localStorage.getItem("foamerTutorialPlayed")),PlayerPrefs.moveTutorialPlayed=!0===JSON.parse(localStorage.getItem("moveTutorialPlayed")),PlayerPrefs.actionTutorialPlayed=!0===JSON.parse(localStorage.getItem("actionTutorialPlayed")),PlayerPrefs.firstSkin=JSON.parse(localStorage.getItem("firstSkin"))||null,PlayerPrefs.firstColourCrafted=!0===JSON.parse(localStorage.getItem("firstColourCrafted")),PlayerPrefs.colourTutorialPlayed=!0===JSON.parse(localStorage.getItem("colourTutorialPlayed")),PlayerPrefs.springTutPlayed=!0===JSON.parse(localStorage.getItem("springTutPlayed")),PlayerPrefs.nextLevel=JSON.parse(localStorage.getItem("nextLevel")),PlayerPrefs.payoffPlayed=JSON.parse(localStorage.getItem("payoffPlayed")),PlayerPrefs.currentPlanet=localStorage.getItem("currentPlanet"),PlayerPrefs.partsUnlocked=parseInt(localStorage.getItem("partsUnlocked")),PlayerPrefs.helpMissionID=parseInt(localStorage.getItem("helpMissionID")),PlayerPrefs.robotLegs=localStorage.getItem("robotLegs"),PlayerPrefs.robotArms=localStorage.getItem("robotArms"),PlayerPrefs.robotBody=localStorage.getItem("robotBody"),PlayerPrefs.robotHead=localStorage.getItem("robotHead"),PlayerPrefs.resources={};for(var i=0;i<Constants.Planets.length;i++){var localStorageKey="resources"+Constants.Planets[i];PlayerPrefs.resources[Constants.Planets[i]]=parseInt(localStorage.getItem(localStorageKey))}PlayerPrefs.levels=JSON.parse(localStorage.getItem("levels")),PlayerPrefs.currentPartString=JSON.parse(localStorage.getItem("currentPartString")),PlayerPrefs.unlockedSkins=JSON.parse(localStorage.getItem("unlockedSkins")),PlayerPrefs.validatePrefs(),PlayerPrefs.saveGameToDisc(),PlayerPrefs.populateData()},PlayerPrefs.populateData=function(){SkinColour.init(PlayerPrefs.currentPartString,PlayerPrefs.unlockedSkins)},PlayerPrefs.saveRobot=function(robot){PlayerPrefs.robotLegs=robot.legs.name,PlayerPrefs.robotArms=robot.arms.name,PlayerPrefs.robotBody=robot.body.name,PlayerPrefs.robotHead=robot.head.name,PlayerPrefs.saveGameToDisc()},PlayerPrefs.saveSkins=function(){PlayerPrefs.unlockedSkins=SkinColour.unlockedSkins,PlayerPrefs.currentPartString=SkinColour.parts,PlayerPrefs.saveGameToDisc()},PlayerPrefs.saveResources=function(wallet){for(var i=0;i<Constants.Planets.length;i++)PlayerPrefs.resources[Constants.Planets[i]]=wallet.get(Constants.Planets[i]);PlayerPrefs.saveGameToDisc()},PlayerPrefs.saveParts=function(unlockManager){PlayerPrefs.partsUnlocked=unlockManager.numberOfPartsUnlocked,PlayerPrefs.saveGameToDisc()},PlayerPrefs.saveFirstColourCrafted=function(skin){PlayerPrefs.firstColourCrafted=!0,PlayerPrefs.firstSkin=skin,PlayerPrefs.saveGameToDisc()},PlayerPrefs.saveColourTutorialPlayed=function(){PlayerPrefs.colourTutorialPlayed=!0,PlayerPrefs.saveGameToDisc()},PlayerPrefs.saveGameToDisc=function(){try{localStorage.setItem("tutStep",PlayerPrefs.tutStep),localStorage.setItem("swapTutorialPlayed",PlayerPrefs.swapTutorialPlayed?"true":"false"),localStorage.setItem("foamerTutorialPlayed",PlayerPrefs.foamerTutorialPlayed?"true":"false"),localStorage.setItem("moveTutorialPlayed",PlayerPrefs.moveTutorialPlayed?"true":"false"),localStorage.setItem("actionTutorialPlayed",PlayerPrefs.actionTutorialPlayed?"true":"false"),localStorage.setItem("firstSkin",JSON.stringify(PlayerPrefs.firstSkin)),localStorage.setItem("firstColourCrafted",PlayerPrefs.firstColourCrafted?"true":"false"),localStorage.setItem("colourTutorialPlayed",PlayerPrefs.colourTutorialPlayed?"true":"false"),localStorage.setItem("springTutPlayed",PlayerPrefs.springTutPlayed?"true":"false"),localStorage.setItem("payoffPlayed",JSON.stringify(PlayerPrefs.payoffPlayed)),localStorage.setItem("currentPlanet",PlayerPrefs.currentPlanet),localStorage.setItem("partsUnlocked",PlayerPrefs.partsUnlocked.toString()),localStorage.setItem("helpMissionID",PlayerPrefs.helpMissionID.toString()),localStorage.setItem("robotLegs",PlayerPrefs.robotLegs),localStorage.setItem("robotArms",PlayerPrefs.robotArms),localStorage.setItem("robotBody",PlayerPrefs.robotBody),localStorage.setItem("robotHead",PlayerPrefs.robotHead);for(var i=0;i<Constants.Planets.length;i++){var localStorageKey="resources"+Constants.Planets[i],localStorageVal=PlayerPrefs.resources[Constants.Planets[i]];localStorage.setItem(localStorageKey,localStorageVal.toString())}localStorage.setItem("levels",JSON.stringify(PlayerPrefs.levels)),localStorage.setItem("nextLevel",JSON.stringify(PlayerPrefs.nextLevel)),localStorage.setItem("unlockedSkins",JSON.stringify(PlayerPrefs.unlockedSkins)),localStorage.setItem("currentPartString",JSON.stringify(PlayerPrefs.currentPartString))}catch(e){console.error(e)}},PlayerPrefs.validatePrefs=function(){PlayerPrefs.tutStep=PlayerPrefs.tutStep?TutStep.Complete:TutStep.Intro,PlayerPrefs.swapTutorialPlayed||(PlayerPrefs.swapTutorialPlayed=!1),PlayerPrefs.foamerTutorialPlayed||(PlayerPrefs.foamerTutorialPlayed=!1),PlayerPrefs.moveTutorialPlayed||(PlayerPrefs.moveTutorialPlayed=!1),PlayerPrefs.firstColourCrafted||(PlayerPrefs.firstColourCrafted=!1),PlayerPrefs.firstSkin||(PlayerPrefs.firstSkin=null),PlayerPrefs.actionTutorialPlayed||(PlayerPrefs.actionTutorialPlayed=!1),PlayerPrefs.colourTutorialPlayed||(PlayerPrefs.colourTutorialPlayed=!1),PlayerPrefs.springTutPlayed||(PlayerPrefs.springTutPlayed=!1),PlayerPrefs.payoffPlayed||(PlayerPrefs.payoffPlayed=[!1,!1,!1,!1]),PlayerPrefs.currentPlanet||(PlayerPrefs.currentPlanet=Constants.Earth),PlayerPrefs.partsUnlocked||(PlayerPrefs.partsUnlocked=0);for(var i=0;i<Constants.Planets.length;i++)(isNaN(PlayerPrefs.resources[Constants.Planets[i]])||PlayerPrefs.resources[Constants.Planets[i]]<0)&&(PlayerPrefs.resources[Constants.Planets[i]]=0);PlayerPrefs.robotLegs!=Constants.Parts_Wheels&&PlayerPrefs.robotLegs!=Constants.Parts_Tracks&&PlayerPrefs.robotLegs!=Constants.Parts_Rocket&&PlayerPrefs.robotLegs!=Constants.Parts_Springs&&(PlayerPrefs.robotLegs=Constants.Parts_Wheels),PlayerPrefs.robotArms!=Constants.Parts_Pincer&&PlayerPrefs.robotArms!=Constants.Parts_Wings&&PlayerPrefs.robotArms!=Constants.Parts_Drill&&PlayerPrefs.robotArms!=Constants.Parts_Foamer&&(PlayerPrefs.robotArms=Constants.Parts_Pincer),PlayerPrefs.robotBody!=Constants.Parts_Body_Short&&PlayerPrefs.robotBody!=Constants.Parts_Body_Med&&PlayerPrefs.robotBody!=Constants.Parts_Body_Tall&&(PlayerPrefs.robotBody=Constants.Parts_Body_Med),PlayerPrefs.robotHead!=Constants.Parts_Head_Normal&&PlayerPrefs.robotHead!=Constants.Parts_Head_SuperEars&&PlayerPrefs.robotHead!=Constants.Parts_Head_XrayVision&&(PlayerPrefs.robotHead=Constants.Parts_Head_Normal),PlayerPrefs.levels||(PlayerPrefs.levels=[]),PlayerPrefs.helpMissionID||(PlayerPrefs.helpMissionID=0),PlayerPrefs.unlockedSkins||(PlayerPrefs.unlockedSkins={}),PlayerPrefs.currentPartString||(PlayerPrefs.currentPartString={})},PlayerPrefs.clearAndReload=function(){localStorage.clear(),location.reload()},PlayerPrefs.playEndgameVO=!1,PlayerPrefs.currentLevelNumber=0,PlayerPrefs.currentPlanet=Constants.Earth,PlayerPrefs.readyForNextPart=!1,PlayerPrefs.partsUnlocked=0,PlayerPrefs.helpMissionID=0,PlayerPrefs.robotLegs=Constants.Parts_Wheels,PlayerPrefs.robotArms=Constants.Parts_Pincer,PlayerPrefs.robotBody=Constants.Parts_Body_Med,PlayerPrefs.robotHead=Constants.Parts_Head_Normal,PlayerPrefs.currentPartString={},PlayerPrefs.unlockedSkins={},PlayerPrefs.autoCraft=!1,PlayerPrefs.VERSION="1",PlayerPrefs}(),SplashLoader=function(_super){function SplashLoader(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.load=function(callback){_this.completCallback=callback,_this.loader=new PIXI.loaders.Loader;var images=app.config.loading.images.splash;_this.loadAssets(_this.loader,images,_this.onComplete)},_this.reset=function(){_this.loader.reset()},_this.loadAssets=function(loader,assets,loadedCallback){var id,src;void 0===loadedCallback&&(loadedCallback=null),assets.forEach(function(asset){src="string"==typeof asset?(id=asset.split("\\").pop().split("/").pop().split(".")[0],asset):(id=asset.id,asset.src),loader.add(id,app.assetPrefix+src)}),loadedCallback&&loader.onComplete.add(loadedCallback),loader.load()},_this.onComplete=function(loader,resource){for(var key in resource)Textures.add(key,resource[key].texture);_this.completCallback()},_this}return __extends(SplashLoader,_super),SplashLoader}(springroll.EventDispatcher),Timeout=function(delay,voClips){var _this=this;this.count=0,this.teardown=function(){clearTimeout(_this.timeout),document.removeEventListener("pointerdown",_this.pointerdown),document.removeEventListener("keypress",_this.keyPress)},this.setClips=function(voClips){_this.voClips=voClips},this.pointerdown=function(){clearTimeout(_this.timeout),_this.timeout=setTimeout(_this.onTimeout,_this.delay)},this.keyPress=function(){clearTimeout(_this.timeout),_this.timeout=setTimeout(_this.onTimeout,_this.delay)},this.onTimeout=function(){clearTimeout(_this.timeout),app.lostFocus?_this.timeout=setTimeout(_this.onTimeout,_this.delay):!app.voPlayer.playing&&0<_this.voClips.length&&(_this.count++,app.voPlayer.play(_this.voClips[_this.count%_this.voClips.length]),_this.timeout=setTimeout(_this.onTimeout,1.5*_this.delay))},this.delay=delay,this.voClips=voClips,this.timeout=setTimeout(this.onTimeout,delay),document.addEventListener("pointerdown",this.pointerdown),document.addEventListener("keypress",this.keyPress)},UnlockManager=function(){function UnlockManager(){var _this=this;this.reset=function(){_this.availableParts=[],_this.unavailableParts=[],_this.availableParts=[Constants.Parts_Wheels,Constants.Parts_Pincer,Constants.Parts_Body_Med,Constants.Parts_Head_Normal],_this.numberOfDefaultParts=_this.availableParts.length;for(var i=0;i<Constants.UnlockOrder.length;i++)i<PlayerPrefs.partsUnlocked?_this.availableParts.push(Constants.UnlockOrder[i]):_this.unavailableParts.push(Constants.UnlockOrder[i]);PlayerPrefs.readyForNextPart=!1},this.nextAvailablePart=function(){_this.unavailableParts.length<=0&&console.error("No parts available!");var name=_this.unavailableParts[0];return new CraftablePart(name)},this.unlockNextPart=function(){if(_this.unavailableParts[0]){var newPart=_this.unavailableParts[0];_this.unavailableParts.splice(0,1),_this.availableParts.push(newPart),PlayerPrefs.saveParts(_this),PlayerPrefs.saveGameToDisc()}else console.warn("all possible parts depleted!");PlayerPrefs.readyForNextPart=!1},this.isAvailable=function(part){return-1!=_this.availableParts.indexOf(part)},this.reset()}return Object.defineProperty(UnlockManager.prototype,"numberOfPartsUnlocked",{get:function(){return this.availableParts.length-this.numberOfDefaultParts},enumerable:!1,configurable:!0}),UnlockManager}(),PartStatus=function(){function PartStatus(){}return PartStatus.Locked="locked",PartStatus.NoMoreParts="noMoreParts",PartStatus.Available="available",PartStatus}(),Wallet=function(){var _this=this;this.resources={},this.reset=function(){_this.resources={};for(var i=0;i<Constants.Planets.length;i++)_this.resources[Constants.Planets[i]]=0},this.add=function(planet,amount){isNaN(_this.resources[planet])?console.error("unknown wallet state for "+planet):_this.resources[planet]+=amount},this.set=function(planet,amount){isNaN(_this.resources[planet])?console.error("unknown wallet state for "+planet):_this.resources[planet]=amount},this.get=function(planet){return isNaN(_this.resources[planet])?(console.error("unknown wallet state for "+planet),-1):_this.resources[planet]},this.getAll=function(){var allResources=[];return Constants.Planets.forEach(function(planet){allResources.push(_this.resources[planet])}),allResources},this.canBuy=function(cost){for(var i=0;i<cost.length;i++){var planet=Constants.Planets[i];if(cost[i]>app.wallet.get(planet))return!1}return!0},this.buyPart=function(cost){for(var i=0;i<cost.length;i++){var planet=Constants.Planets[i];app.wallet.add(planet,-cost[i])}return!0},this.resources={};for(var i=0;i<Constants.Planets.length;i++){var planet=Constants.Planets[i];this.resources[planet]=PlayerPrefs.resources[planet]}},WorldLoader=function(_super){function WorldLoader(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.load=function(progressCallback,completCallback){_this.imgLoader=new PIXI.loaders.Loader,_this.animLoader=new PIXI.loaders.Loader,_this.particleLoader=new PIXI.loaders.Loader;var images=app.config.loading.images.world,anims=app.config.animations.world,particles=app.config.particles.world,planet=PlayerPrefs.currentPlanet.toLowerCase();images=images.concat(app.config.loading.images.partHud),Device.lowEndDevice?(particles=app.config.particles.worldLowEnd,images=images.concat(app.config.loading.images[planet+"LowEnd"])):(images=images.concat(app.config.loading.images[planet]),anims=anims.concat(app.config.animations.worldHeads)),44==PlayerPrefs.currentLevel.levelNr&&(images=images.concat(app.config.loading.images.convention),anims=anims.concat(app.config.animations.disco),particles=(particles=app.config.particles.world).concat(app.config.particles.disco)),_this.loadAssets(_this.imgLoader,app.assetPrefix,images,_this.imgLoaded),_this.loadAssets(_this.animLoader,"",anims,_this.animLoaded),_this.loadAssets(_this.particleLoader,"",particles,_this.particleLoaded),_this.progressCallback=progressCallback,_this.completCallback=completCallback},_this}return __extends(WorldLoader,_super),WorldLoader}(SceneLoader),AnalyticsUtils=function(){function AnalyticsUtils(){}return AnalyticsUtils.Init=function(){app.display.stage.interactive=!0,app.display.stage.on("pointermove",function(event){AnalyticsUtils.PointerX=event.data.global.x||-1,AnalyticsUtils.PointerY=event.data.global.y||-1})},Object.defineProperty(AnalyticsUtils,"levelID",{get:function(){return PlayerPrefs.currentLevel?PlayerPrefs.currentLevel.levelID:(console.warn("no level id set"),"NA")},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"levelNumber",{get:function(){return PlayerPrefs.currentLevelNumber?PlayerPrefs.currentLevelNumber:(console.warn("no level id set"),0)},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"currentPlanet",{get:function(){return PlayerPrefs.currentPlanet?PlayerPrefs.currentPlanet:(console.warn("current planet not set"),"NA")},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"stageName",{get:function(){return AnalyticsUtils.currentPlanet+"-"+AnalyticsUtils.levelNumber},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"isChallenge",{get:function(){return!!PlayerPrefs.currentLevel&&PlayerPrefs.currentLevel.isChallenge},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"clickPos",{get:function(){return{x:AnalyticsUtils.PointerX,y:AnalyticsUtils.PointerY,stage_width:1280,stage_height:720}},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"stars",{get:function(){return AnalyticsUtils.missionRecord?{collected:AnalyticsUtils.missionRecord.starCount,total:AnalyticsUtils.missionRecord.totalStarCount}:{collected:"0",total:"0"}},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"resources",{get:function(){return AnalyticsUtils.missionRecord?{collected:AnalyticsUtils.missionRecord.resourcesCount,total:AnalyticsUtils.missionRecord.totalResourcesCount}:{collected:"0",total:"0"}},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"progress",{get:function(){var _progress={legs:["Wheels"],arms:["Pincers"],body:["Normal Body"],head:["Normal Head"],resources:app.wallet.resources,paints:[]};return 1<=PlayerPrefs.partsUnlocked&&_progress.legs.push("Springs"),2<=PlayerPrefs.partsUnlocked&&_progress.legs.push("Tracks"),3<=PlayerPrefs.partsUnlocked&&_progress.arms.push("Drill Arms"),4<=PlayerPrefs.partsUnlocked&&_progress.arms.push("Foamer"),5<=PlayerPrefs.partsUnlocked&&_progress.body.push("Short Body"),6<=PlayerPrefs.partsUnlocked&&_progress.head.push("Super Ears"),7<=PlayerPrefs.partsUnlocked&&_progress.legs.push("Rocket"),8<=PlayerPrefs.partsUnlocked&&_progress.arms.push("Boosters"),9<=PlayerPrefs.partsUnlocked&&_progress.head.push("X-ray Vission"),10<=PlayerPrefs.partsUnlocked&&_progress.body.push("Tall Body"),11<=PlayerPrefs.partsUnlocked&&_progress.head.push("Heat Vision"),_progress.paints=AnalyticsUtils.unlockedSkins,_progress},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"unlockedSkins",{get:function(){var skins=[];for(var part in PlayerPrefs.unlockedSkins)for(var skinArr=PlayerPrefs.unlockedSkins[part],i=0;i<skinArr.length;i++)skins.push(part+": "+skinArr[i]);return skins},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"requiredParts",{get:function(){var required={legs:["Wheels"],arms:[],body:[],head:[]};if(PlayerPrefs.currentLevel){var lvlType=PlayerPrefs.currentLevel.levelID.substr(0,1);"b"==lvlType?required.legs.push("Springs"):"c"==lvlType?required.legs.push("Tracks"):"d"==lvlType?required.arms.push("Drill"):"e"==lvlType?required.arms.push("Foamer"):"f"==lvlType?required.body.push("Short Body"):"g"==lvlType?required.head.push("Super Ears"):"h"==lvlType?required.arms.push("Wings"):"i"==lvlType?required.legs.push("Rocket"):"j"==lvlType?required.body.push("Boosters"):"k"==lvlType?required.head.push("Xray"):"m"==lvlType?required.body.push("Tall Body"):"n"==lvlType&&required.head.push("Heat Vision")}else required.legs.push("Wheels");return required},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"requiredPartsArray",{get:function(){var lvlType=PlayerPrefs.currentLevel.levelID.substr(0,1);return"b"==lvlType?["Springs"]:"c"==lvlType?["Tracks"]:"d"==lvlType?["Drill"]:"e"==lvlType?["Foamer"]:"f"==lvlType?["Short Body"]:"g"==lvlType?["Super Ears"]:"h"==lvlType?["Wings"]:"i"==lvlType?["Rocket"]:"j"==lvlType?["Boosters"]:"k"==lvlType?["Xray"]:"m"==lvlType?["Tall Body"]:"n"==lvlType?["Heat Visionody"]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"hasRequiredParts",{get:function(){return!(!PlayerPrefs.currentLevel||!PlayerPrefs.currentLevel.isTutorial)&&PlayerPrefs.helpMissionID>PlayerPrefs.partsUnlocked},enumerable:!1,configurable:!0}),Object.defineProperty(AnalyticsUtils,"obstacleTypes",{get:function(){return["rocky","gaps"]},enumerable:!1,configurable:!0}),AnalyticsUtils.PointerX=-1,AnalyticsUtils.PointerY=-1,AnalyticsUtils.customEndEvent=function(){this._track("endGame",{duration:app.analyticsEmitter.gameTime(),exit_type:"undefined",progress:AnalyticsUtils.progress}),this._history.length=0},AnalyticsUtils.startInstruction=function(levelID,description,identifier,mediaType,totalDuration,stageName,challenge){AnalyticsUtils.sendFeedback("startInstruction",levelID,description,identifier,mediaType,totalDuration,stageName,challenge)},AnalyticsUtils.endInstruction=function(levelID,description,identifier,mediaType,totalDuration,stageName,challenge){AnalyticsUtils.sendFeedback("endInstruction",levelID,description,identifier,mediaType,totalDuration,stageName,challenge)},AnalyticsUtils.startIncorrectFeedback=function(levelID,description,identifier,mediaType,totalDuration,stageName,challenge){AnalyticsUtils.sendFeedback("startIncorrectFeedback",levelID,description,identifier,mediaType,totalDuration,stageName,challenge)},AnalyticsUtils.endIncorrectFeedback=function(levelID,description,identifier,mediaType,totalDuration,stageName,challenge){AnalyticsUtils.sendFeedback("endIncorrectFeedback",levelID,description,identifier,mediaType,totalDuration,stageName,challenge)},AnalyticsUtils.startCorrectFeedback=function(levelID,description,identifier,mediaType,totalDuration,stageName,challenge){AnalyticsUtils.sendFeedback("startCorrectFeedback",levelID,description,identifier,mediaType,totalDuration,stageName,challenge)},AnalyticsUtils.endCorrectFeedback=function(levelID,description,identifier,mediaType,totalDuration,stageName,challenge){AnalyticsUtils.sendFeedback("endCorrectFeedback",levelID,description,identifier,mediaType,totalDuration,stageName,challenge)},AnalyticsUtils.sendFeedback=function(api,levelID,description,identifier,mediaType,totalDuration,stageName,challenge){var feedback={level_id:levelID||"NA",media_type:mediaType,description:description,identifier:identifier,duration:totalDuration,total_duration:totalDuration,stage_name:stageName,challenge:challenge};app.analyticsEmitter._track(api,feedback)},AnalyticsUtils}(),Animations=function(){function Animations(){}return Animations.spineDataArray=[],Animations.add=function(id,spineData){Animations.spineDataArray[id]?console.warn("overwrtting spine data: "+id):Animations.spineDataArray[id]=spineData},Animations.get=function(id){return this.spineDataArray[id]||console.error("spine data does not exist: "+id),this.spineDataArray[id]},Animations.clear=function(){Animations.spineDataArray=[]},Animations}(),Device=function(){function Device(){}return Object.defineProperty(Device,"isTouchDevice",{get:function(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"isDesktop",{get:function(){return!this.isTouchDevice},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"lowEndDevice",{get:function(){try{return!(!Device.isIOS||window.screen.height/window.screen.width!=1024/768||1!=window.devicePixelRatio)||Device.isAndroid&&Device.majorAndroidVersion<5}catch(e){}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"isCordova",{get:function(){try{return Device.windowHasCordova(window)||Device.windowHasCordova(window.parent)}catch(e){return!1}},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"isIE11",{get:function(){return!!window.MSInputMethodContext&&!!document.documentMode},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"isIOS",{get:function(){return!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"isPixel3",{get:function(){var ua=(ua||navigator.userAgent).toLowerCase();return-1<ua.indexOf("pixel 3")},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"majorIOSVersion",{get:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var v=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return parseInt(v[1],10)}return-1},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"isAndroid",{get:function(){var ua=(ua||navigator.userAgent).toLowerCase();return-1<ua.indexOf("android")},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"androidVersion",{get:function(){var ua=(ua||navigator.userAgent).toLowerCase(),match=ua.match(/android\s([0-9\.]*)/);return match?match[1]:-1},enumerable:!1,configurable:!0}),Object.defineProperty(Device,"majorAndroidVersion",{get:function(){return parseInt(Device.androidVersion,10)},enumerable:!1,configurable:!0}),Device.windowHasCordova=function(w){var hasCordova=!1;return w&&(hasCordova=w.hasOwnProperty("cordova")||-1<w.location.search.indexOf("cordova=true")),hasCordova},Device}(),EnlearnUtils=function(){function EnlearnUtils(){}return EnlearnUtils.hasNextStep=function(){return PlayerPrefs.partsUnlocked<Constants.UnlockOrder.length},EnlearnUtils.calulateNextStepType=function(){var nextStep=[this.Ledge1or2Tiles,this.RockyGround,this.DrillObstacle,this.Foamer,this.ShortBody,this.EarObstacle,this.Gap2Tile,this.Ledge3or4Tiles,this.Booster,this.XrayObstacle,this.TallBody,this.HeatObstacle];return nextStep[MathUtils.clamp(PlayerPrefs.partsUnlocked,0,nextStep.length-1)]},EnlearnUtils.calulateAllowedStepTypes=function(){var tierA=[this.CollectResource,this.CreviceCollect],tierB=tierA.concat([this.Ledge1or2Tiles,this.Gap1Tile]),tierC=tierB.concat([this.RockyGround]),tierD=tierC.concat([this.DrillObstacle]),tierE=tierD.concat([this.Ledge3or4Tiles,this.Foamer]),tierF=tierE.concat([this.ShortBody]),tierG=tierF.concat([this.EarObstacle]),tierH=tierG.concat([this.Gap2Tile]),tierI=tierH.concat([]),tierJ=tierI.concat([this.Booster]),tierK=tierJ.concat([this.XrayObstacle]),tierM=tierK.concat([this.TallBody]),tierN=tierM.concat([this.HeatObstacle]),tiers=[tierA,tierB,tierC,tierD,tierE,tierF,tierG,tierH,tierI,tierJ,tierK,tierM,tierN];return tiers[MathUtils.clamp(PlayerPrefs.partsUnlocked,0,tiers.length-1)]},EnlearnUtils.CollectResource="663d6919-2625-4ecb-b1f0-e1f11a9fb9d5",EnlearnUtils.CreviceCollect="a177c211-46d5-4587-913d-efd956eecf44",EnlearnUtils.RockyGround="49c5687b-1028-4fe2-bdc4-0b35585b874a",EnlearnUtils.Ledge1or2Tiles="36d48534-2843-4bda-84e8-aaae96cf0c6c",EnlearnUtils.Ledge3or4Tiles="14075792-870c-4f70-a753-628ce20af9e6",EnlearnUtils.Gap1Tile="b86b0294-e6af-4c7c-a4ae-cb53b15d8f4e",EnlearnUtils.Gap2Tile="b061dca6-f570-499b-ac3f-050800f142d2",EnlearnUtils.DrillObstacle="c84887d0-a141-4edf-8748-2874171d8643",EnlearnUtils.ShortBody="97193e5c-9d1b-4014-b6f2-9e588e44af2d",EnlearnUtils.Booster="81ced3ff-b2dc-426b-993b-a30c877a9dad",EnlearnUtils.Foamer="0415e1a5-314e-49c0-b4c0-b140d1048852",EnlearnUtils.TallBody="61d0a130-b427-461a-8d4b-52a3825efa6c",EnlearnUtils.EarObstacle="60545aff-6b0c-46ee-ab8d-cadec8d16bb4",EnlearnUtils.HeatObstacle="aa17bfc2-5062-4cd7-972b-da7f4e0490ac",EnlearnUtils.XrayObstacle="231416fb-c43f-4956-a9bc-f1050a8dac72",EnlearnUtils.completedObstacles=[],EnlearnUtils.recordProblemStart=function(problem){if(EnlearnUtils.completedObstacles=[],problem)if(app.enlearn){if(problem.problemID){console.log("Enlearn::recordEnlearnStart: "+problem.problemID);var appData={levelNr:problem.levelNr,isTutorial:problem.isTutorial,isDebug:problem.isDebug};app.enlearn.recordProblemStart(problem.problemID,appData),app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"recordProblemStart"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}}else console.warn("enlearn not available");else console.warn("problem is not valid: "+problem)},EnlearnUtils.recordProblemEnd=function(problem,success){problem?app.enlearn?(problem.problemID&&(success&&EnlearnUtils.completeAllMissedObstacles(problem.problemID),setTimeout(function(){app.enlearn.recordProblemEnd(problem.problemID,success),app.analyticsEmitter.SentEnlearnEvent(AnalyticsUtils.levelID,{type:"recordProblemEnd"},AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},100)),EnlearnUtils.completedObstacles=[]):console.warn("enlearn not available"):console.warn("problem is not valid: "+problem)},EnlearnUtils.completeAllMissedObstacles=function(problemID){for(var problem=null,i=0;i<app.config.enlearnEcosystem.problems.length;i++)if(app.config.enlearnEcosystem.problems[i].id==problemID){problem=app.config.enlearnEcosystem.problems[i];break}if(problem)for(i=0;i<problem.steps.length;i++){var obstacleID=problem.steps[i].id;-1==EnlearnUtils.completedObstacles.indexOf(obstacleID)&&app.enlearn.recordStepAttempt(obstacleID,1)}},EnlearnUtils.getScaffoldInfo=function(scaffoldID){if(app.config.enlearnEcosystem)for(var stepTypes=app.config.enlearnEcosystem.stepTypes,i=0;i<stepTypes.length;i++)for(var j=0;j<stepTypes[i].scaffolds.length;j++)if(stepTypes[i].scaffolds[j].id==scaffoldID)return new ScaffoldInfo(stepTypes[i].name,j);return console.error("No scaffold Info found for "+scaffoldID),null},EnlearnUtils.LogTraceMastery=function(){var ecoSystem=app.config.enlearnEcosystem;if(ecoSystem){console.log("Enlearn Obstacle Mastery: ");for(var i=0;i<ecoSystem.traces.length;i++){var trace=ecoSystem.traces[i],masteryState=app.enlearn.debug.getTraceMasteryState(trace.id);console.log("> "+trace.name+": "+masteryState.isMastered+" ("+masteryState.evidenceCount+")")}}},EnlearnUtils}(),HelpMissionUtils=function(){function HelpMissionUtils(){}return HelpMissionUtils.setupRobot=function(missionID){PlayerPrefs.robotArms=Constants.Parts_Pincer,PlayerPrefs.robotHead=Constants.Parts_Head_Normal,PlayerPrefs.robotBody=Constants.Parts_Body_Med,PlayerPrefs.robotLegs=Constants.Parts_Wheels,0==missionID||(1==missionID?PlayerPrefs.robotLegs=Constants.Parts_Springs:2==missionID?PlayerPrefs.robotLegs=Constants.Parts_Tracks:3==missionID?PlayerPrefs.robotArms=Constants.Parts_Drill:4==missionID?(PlayerPrefs.robotLegs=Constants.Parts_Springs,PlayerPrefs.robotArms=Constants.Parts_Foamer):5==missionID?PlayerPrefs.robotBody=Constants.Parts_Body_Short:6==missionID?PlayerPrefs.robotHead=Constants.Parts_Head_SuperEars:7==missionID?(PlayerPrefs.robotLegs=Constants.Parts_Springs,PlayerPrefs.robotArms=Constants.Parts_Wings):8==missionID?(PlayerPrefs.robotLegs=Constants.Parts_Rocket,PlayerPrefs.robotArms=Constants.Parts_Wings):9==missionID?(PlayerPrefs.robotLegs=Constants.Parts_Tracks,PlayerPrefs.robotArms=Constants.Parts_Booster):10==missionID?(PlayerPrefs.robotHead=Constants.Parts_Head_XrayVision,PlayerPrefs.robotArms=Constants.Parts_Drill):11==missionID?PlayerPrefs.robotBody=Constants.Parts_Body_Tall:12==missionID?PlayerPrefs.robotHead=Constants.Parts_Head_HeatVision:console.warn("No parts set for help mission. missionID: "+missionID))},HelpMissionUtils.getIntroVO=function(){var missionID=PlayerPrefs.helpMissionID;return 0==missionID?"":1==missionID?"test-springs":2==missionID?"test-tread":3==missionID?Device.isDesktop?"test-drill-desktop":"test-drill-touch":4==missionID?"":5==missionID?"test-short-body":6==missionID?"test-sonar-head":7==missionID?Device.isDesktop?"test-wings-desktop":"test-wings-touch":8==missionID?"test-rocket-legs":9==missionID?Device.isDesktop?"test-boosters-ice-desktop":"test-boosters-ice-touch":10==missionID?"test-xray-head":11==missionID?"test-tall-body":12==missionID?"test-heat-head":void console.warn("No parts set for help mission. missionID: "+missionID)},HelpMissionUtils}(),MathUtils=function(){function MathUtils(){}return MathUtils.lerp=function(value1,value2,amount){return value1+(value2-value1)*(amount=1<(amount=amount<0?0:amount)?1:amount)},MathUtils.angleLerp=function(a,b,t){var delta=MathUtils.Repeat(b-a,360);return 180<delta&&(delta-=360),a+delta*MathUtils.clamp01(t)},MathUtils.angleClamp=function(value){for(;value<0;)value+=360;for(;360<value;)value-=360;return value},MathUtils.normalize=function(p,len){if(0==p.x&&0==p.y||0==len)return{x:0,y:0};var angle=Math.atan2(p.y,p.x);return{x:Math.cos(angle)*len,y:Math.sin(angle)*len}},MathUtils.Repeat=function(t,length){return MathUtils.clamp(t-Math.floor(t/length)*length,0,length)},MathUtils.inverseLerp=function(start,end,value){return(value-start)/(end-start)},MathUtils.clamp01=function(value){return MathUtils.clamp(value,0,1)},MathUtils.clamp=function(value,min,max){return value<min?min:max<value?max:value},MathUtils.sign=function(value){return 0<value?1:value<0?-1:0},MathUtils.distance=function(a,b){return Math.sqrt(MathUtils.squareDistance(a,b))},MathUtils.squareDistance=function(a,b){var x=b.x-a.x,y=b.y-a.y;return x*x+y*y},MathUtils.randRange=function(min,max){return Math.random()*(max-min)+min},MathUtils}(),Particles=function(){function Particles(){}return Particles.map={},Particles.add=function(id,config){this.map[id]?console.warn("overwritting particles data: "+id):this.map[id]=config},Particles.get=function(id){return this.map[id]||console.error("particle data does not exist: "+id),this.map[id]},Particles.clear=function(){Particles.map={}},Particles}(),Point=function(){function Point(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=x,this.y=y}return Point.FromPoint=function(point){return new Point(point.x,point.y)},Point}();Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(predicate){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=arguments[1],k=0;k<len;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return kValue;k++}},configurable:!0,writable:!0}),Array.prototype.remove||Object.defineProperty(Array.prototype,"remove",{value:function(item){if(null==this)throw new TypeError('"this" is null or not defined');for(var o=Object(this),len=o.length>>>0,k=(arguments[1],0);k<len;){var kValue=o[k];if(kValue==item)return o.splice(k,1),kValue;k++}},configurable:!0,writable:!0}),Uint8Array.prototype.forEach||(Uint8Array.prototype.forEach=Array.prototype.forEach);var SpineData=function(){function SpineData(){}return SpineData.GetBodyTransitionAnims=function(oldBody,newBody){return(oldBody&&"undefined"!=oldBody?oldBody==Constants.Parts_Body_Med?"Medium":oldBody==Constants.Parts_Body_Tall?"Tall":"Small":"Medium")+"To"+(newBody==Constants.Parts_Body_Med?"Medium":newBody==Constants.Parts_Body_Tall?"Tall":"Small")+"Anim"},SpineData.init=function(){(SpineData.Tracks={})[Constants.Head]=SpineData.headAnimTrack,SpineData.Tracks[Constants.Body]=SpineData.bodyAnimTrack,SpineData.Tracks[Constants.Arms]=SpineData.armAnimTrack,SpineData.Tracks[Constants.Legs]=SpineData.legAnimTrack,(SpineData.TransitionAnims={})[Constants.Parts_Wheels]="WheelsFastTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Tracks]="TreadsTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Springs]="SpringTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Rocket]="RocketTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Pincer]="PincerTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Drill]="DrillTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Wings]="WingTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Foamer]="FoamerTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Booster]="BoosterTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Head_Normal]="HeadJetTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Head_SuperEars]="HeadSonarEarTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Head_XrayVision]="HeadXrayTransitionAnim",SpineData.TransitionAnims[Constants.Parts_Head_HeatVision]="HeadThermalTransitionAnim"},SpineData.bodyAnimTrack=0,SpineData.armAnimTrack=1,SpineData.legAnimTrack=2,SpineData.headAnimTrack=3,SpineData}();SpineData.init();var Texts=function(){function Texts(){}return Texts.map={},Texts.add=function(id,config){this.map[id]&&console.error("overwritting text data: "+id),this.map[id]=config},Texts.get=function(id){return this.map[id]||console.error("text data does not exist: "+id),this.map[id]},Texts}(),TileUtils=function(){function TileUtils(){}return TileUtils.isSlope=function(tileID){return tileID===TileID.slopeTopRight||tileID===TileID.slopeTopLeft||tileID===TileID.slopeMidRight||tileID===TileID.slopeMidLeft},TileUtils.isPlatform=function(tileID){return tileID===TileID.platformLeft||tileID===TileID.platformMiddle||tileID===TileID.platformRight||tileID===TileID.platformSingle},TileUtils.isRoughGround=function(tileID){return tileID===TileID.roughGroundLeft||tileID===TileID.roughGroundMid||tileID===TileID.roughGroundRight||tileID===TileID.roughGroundSingle},TileUtils.isDrillable=function(tileID){return tileID===TileID.drillHole||tileID===TileID.drillThrough},TileUtils.isSmallDip=function(tileID){return tileID===TileID.smallDipLeft||tileID===TileID.smallDipMid||tileID===TileID.smallDipRight},TileUtils.isValidRespawnPosition=function(tileID){return-1<TileID.validRespawnTiles.indexOf(tileID)},TileUtils}(),CollectableView=function(_super){function CollectableView(level){var _this=_super.call(this)||this;_this.teardown=function(){_this.unbindResourcesFromModels(),_super.prototype.destroy.call(_this)},_this.addResource=function(resource){var resourceView,texture=this.getTextureForResource(resource);switch(resource.type){case ItemID.HeatResource:resourceView=new HeatResourceView(resource,texture);break;case ItemID.SuperEarCollectable:resourceView=new SuperEarResourceView(resource,texture);break;default:resourceView=new ResourceView(resource,texture)}this.resources.push(resourceView),this.addChild(resourceView)},_this.bindResourcesToModels=function(){_this.resources.forEach(function(r){r.bindToModel()})},_this.unbindResourcesFromModels=function(){_this.resources.forEach(function(r){r.unbindFromModel()})},_this.getTextureForResource=function(resource){if(resource.requiredPart==Constants.Parts_Head_SuperEars)return null;var useGlowingResource=resource.type==ItemID.HeatResource;return ResourceTextures.resourceForCurrentPlanet(useGlowingResource)},_this.removeStar=function(id){for(var i=0;i<this.collectables.length;i++)if(this.collectables[i].id==id)return void this.removeChild(this.collectables[i])},_this.removeResource=function(id){for(var i=0;i<this.resources.length;i++)if(this.resources[i].id==id)return this.resources[i].onCollected(),void this.removeChild(this.resources[i])},_this.removeChildren(),_this.collectables=[];for(var i=0;i<level.pickups.length;i++){var pickupView=new PickupView(level.pickups[i]);_this.collectables.push(pickupView),_this.addChild(pickupView)}_this.resourceModels=level.resources,_this.resources=[];for(i=0;i<level.resources.length;i++)_this.addResource(level.resources[i]);return _this.bindResourcesToModels(),_this}return __extends(CollectableView,_super),CollectableView}(PIXI.Container),DancingRobot=function(_super){function DancingRobot(x,y,bodyImg,armAnchor,yOff,xOff){void 0===armAnchor&&(armAnchor=null),void 0===yOff&&(yOff=null),void 0===xOff&&(xOff=0);var _this=_super.call(this)||this;return _this.teardown=function(){_this.tl&&_this.tl.kill()},_this.dance=function(){_this.tl&&_this.tl.kill(),_this.robot.scale.x=.5<Math.random()?1:-1;var dur=.2+.1*Math.random(),jumpHeight=-(75+50*Math.random());_this.tl=new TimelineMax({onComplete:_this.dance}),_this.tl.to(_this.robot,dur,{y:jumpHeight,ease:Power4.easeOut},0),_this.tl.to(_this.robot,dur,{y:0,ease:Power4.easeIn},dur),_this.tl.to(_this.robot.scale,dur,{y:1.1,ease:Power4.easeOut},0),_this.tl.to(_this.robot.scale,dur,{y:.9,ease:Power4.easeIn},dur),_this.arm&&(_this.tl.to(_this.arm,dur,{rotation:-2,ease:Power4.easeOut},0),_this.tl.to(_this.arm,dur,{rotation:-1,ease:Power4.easeIn},dur)),_this.tl.to(_this,.15,{},2*dur)},_this.x=x,_this.y=y,_this.ground=y,_this.robot=new PIXI.Sprite(Textures.get(bodyImg)),_this.robot.anchor.x=.5,_this.robot.anchor.y=1,_this.addChild(_this.robot),armAnchor&&(_this.arm=new PIXI.Sprite(Textures.get(bodyImg+"_arm")),_this.arm.anchor.x=.5,_this.arm.anchor.y=armAnchor,_this.arm.x=-xOff,_this.arm.y=-yOff,_this.robot.addChild(_this.arm)),_this.dance(),_this}return __extends(DancingRobot,_super),DancingRobot}(PIXI.Container),EditRobotView=function(_super){function EditRobotView(onExitCallback){var _this=_super.call(this)||this;_this.customScale=.75,_this.updateSelectBoxPos=function(btnPosition){_this.selectColourBox.position.x=btnPosition.x-12,_this.selectColourBox.position.y=btnPosition.y-47},_this.setupLockedColours=function(partName){var unlockedColours=SkinColour.getUnlocked(partName),currentPartColour=SkinColour.get(partName);switch(_this.lockSymbols.forEach(function(lockedSymbol){lockedSymbol.visible=!0}),_this.unlockableButtons.forEach(function(button){button.interactive=!1}),unlockedColours.forEach(function(colour){switch(colour){case Constants.SkinBlue:_this.blueBtn.interactive=!0,_this.blueLocked.visible=!1;break;case Constants.SkinRed:_this.redBtn.interactive=!0,_this.redLocked.visible=!1;break;case Constants.SkinGreen:_this.greenBtn.interactive=!0,_this.greenLocked.visible=!1}}),currentPartColour){case Constants.SkinBlue:_this.updateSelectBoxPos(_this.blueBtn);break;case Constants.SkinRed:_this.updateSelectBoxPos(_this.redBtn);break;case Constants.SkinGreen:_this.updateSelectBoxPos(_this.greenBtn);break;case Constants.SkinDefault:_this.updateSelectBoxPos(_this.orangeBtn)}},_this.showPartDescription=function(enable){_this.descriptionBox.visible=enable},_this.addSignals=function(){WorldSignals.updateSelectedColour.add(_this.setupLockedColours),WorldSignals.showEditPartDesc.add(_this.showPartDescription)},_this.resize=function(offset){_this.shouldReadjustHud&&(_this.editPartsHud.x=_this.getBorderPosition())},_this.playButtonSFX=function(sfx){app.sound.play(sfx)},_this.descriptionBox=new PIXI.Container,_this.descriptionBox.x+=70,_this.descriptionBox.y+=88,_this.basePos=new Point(280,45),_this.lockSymbols=[],_this.unlockableButtons=[];var border=new PIXI.Sprite(Textures.get("editRobotBorder"));border.anchor.x=border.anchor.y=.5,border.scale.x=border.scale.y=3*_this.customScale,border.x=750,border.y=330,_this.addChild(border);var description=new PIXI.Sprite(Textures.get("editDescriptionBox"));description.scale.x=description.scale.y=_this.customScale,description.x=780,description.y=180,_this.descriptionBox.addChild(description),_this.descriptionTitle=new PIXI.Text("TEMP",{fontFamily:"Peralta",fontSize:20,fill:"#58a9bf",align:"center"}),_this.descriptionTitle.anchor.x=_this.descriptionTitle.anchor.y=.5,_this.descriptionTitle.x=900,_this.descriptionTitle.y=210,_this.descriptionBox.addChild(_this.descriptionTitle),_this.descriptionText=new PIXI.Text("Expecto Patronum",{fontFamily:"Wellfleet",fontSize:18,fill:"#58a9bf",align:"center",wordWrap:!0,wordWrapWidth:180}),_this.descriptionText.anchor.x=_this.descriptionText.anchor.y=.5,_this.descriptionText.x=900,_this.descriptionText.y=275,_this.descriptionBox.addChild(_this.descriptionText);var armsAvailable=PlayerPrefs.robotBody!=Constants.Parts_Body_Short;return _this.editPartsHud=new RobotPartHud(armsAvailable,onExitCallback),_this.editPartsHud.y=_this.basePos.y,_this.editPartsHud.scale.x=_this.editPartsHud.scale.y=.8,_this.editPartsHud.visible=!0,_this.editPartsHud.x=-500,_this.addChild(_this.editPartsHud),_this.shouldReadjustHud=!1,_this.redBtn=new Button("colourBtnRed",819,448,3),_this.redBtn.anchor.x=_this.redBtn.anchor.x=0,_this.redBtn.scale.x=_this.redBtn.scale.y=.75,_this.unlockableButtons.push(_this.redBtn),_this.descriptionBox.addChild(_this.redBtn),_this.addChild(_this.descriptionBox),_this.orangeBtn=new Button("colourBtnOrange",819,359,3),_this.orangeBtn.anchor.x=_this.orangeBtn.anchor.x=0,_this.orangeBtn.scale.x=_this.orangeBtn.scale.y=.75,_this.descriptionBox.addChild(_this.orangeBtn),_this.blueBtn=new Button("colourBtnBlue",909,448,3),_this.blueBtn.anchor.x=_this.blueBtn.anchor.x=0,_this.blueBtn.scale.x=_this.blueBtn.scale.y=.75,_this.unlockableButtons.push(_this.blueBtn),_this.descriptionBox.addChild(_this.blueBtn),_this.greenBtn=new Button("colourBtnGreen",909,359,3),_this.greenBtn.anchor.x=_this.greenBtn.anchor.x=0,_this.greenBtn.scale.x=_this.greenBtn.scale.y=.75,_this.unlockableButtons.push(_this.greenBtn),_this.descriptionBox.addChild(_this.greenBtn),_this.redLocked=new PIXI.Sprite(Textures.get("colourLocked")),_this.redLocked.scale.x=_this.redLocked.scale.y=_this.customScale,_this.redLocked.x=816,_this.redLocked.y=410,_this.lockSymbols.push(_this.redLocked),_this.descriptionBox.addChild(_this.redLocked),_this.greenLocked=new PIXI.Sprite(Textures.get("colourLocked")),_this.greenLocked.scale.x=_this.greenLocked.scale.y=_this.customScale,_this.greenLocked.x=905,_this.greenLocked.y=323,_this.lockSymbols.push(_this.greenLocked),_this.descriptionBox.addChild(_this.greenLocked),_this.blueLocked=new PIXI.Sprite(Textures.get("colourLocked")),_this.blueLocked.scale.x=_this.blueLocked.scale.y=_this.customScale,_this.blueLocked.x=905,_this.blueLocked.y=410,_this.lockSymbols.push(_this.blueLocked),_this.descriptionBox.addChild(_this.blueLocked),_this.selectColourBox=new PIXI.Sprite(Textures.get("colourSelectBox")),_this.selectColourBox.scale.x=_this.selectColourBox.scale.y=_this.customScale,_this.descriptionBox.addChild(_this.selectColourBox),_this.descriptionBox.visible=!1,_this.addSignals(),_this.offset=-10,_this.resize(0),_this.createTalkingHead(),app.options.debug&&(window.editRobotView=_this),_this}return __extends(EditRobotView,_super),EditRobotView.prototype.updateDescription=function(title,description){this.descriptionTitle.text=title,this.descriptionText.text=description},EditRobotView.prototype.getBorderPosition=function(){return(app.display.sideOffset+this.basePos.x)/1.3},EditRobotView.prototype.showHud=function(){var _this=this,position=this.getBorderPosition();TweenLite.to(this.editPartsHud,.3,{x:position,ease:Power2.easeOut,onComplete:function(){_this.shouldReadjustHud=!0}})},EditRobotView.prototype.hideHud=function(){var _this=this;TweenLite.to(this.editPartsHud,.3,{x:-500,ease:Power2.easeOut,onComplete:function(){_this.editPartsHud.teardown()}})},EditRobotView.prototype.createTalkingHead=function(){Device.lowEndDevice||(this.talkingHead=new TalkingHeadView("talkingHeadMonitorMindy"),this.talkingHead.x=1050,this.talkingHead.y=50,this.talkingHead.scale.x=this.talkingHead.scale.y=.75,this.talkingHead.visible=!1,this.talkingHead.hide(),this.addChild(this.talkingHead))},EditRobotView.prototype.showScreen=function(){app.sound.play("sfx-audio-out"),this.talkingHead&&(this.talkingHead.visible=!0,this.talkingHead.show())},EditRobotView.prototype.hideScreen=function(){app.sound.play("sfx-audio-out"),this.talkingHead&&this.talkingHead.hide()},EditRobotView.prototype.playRobotVO=function(voId){app.voPlayer.play(voId)},EditRobotView.prototype.stopVo=function(){app.voPlayer.stop()},EditRobotView}(PIXI.Container),EnlearnUI=function(_super){function EnlearnUI(){var _this=_super.call(this)||this;return _this.enlearnAttempt=function(success,obsID){_this.enlearnPass.visible=success,_this.enlearnFail.visible=!success,_this.obstacleName.text=obsID,_this.obstacleName.visible=!0,setTimeout(_this.hide,1e3),console.log("enlearnAttempt "+obsID)},_this.hide=function(){_this.enlearnPass.visible=!1,_this.enlearnFail.visible=!1,_this.obstacleName.visible=!1},_this.toggleMasteryDebug=function(){if(!_this.masteryTextA.visible){var names="",stats="";app.config.enlearnEcosystem.traces.forEach(function(trace){var state=app.enlearn.debug.getTraceMasteryState(trace.id),nProb=Math.floor(100*state.stateProbabilities.novice),mProb=Math.floor(100*state.stateProbabilities.master);names+=trace.name+":\n",stats+="Mastered: "+state.isMastered+", EC: "+state.evidenceCount+", NP: "+nProb+", MP: "+mProb+"  \n"}),stats+="*Evidence Count, Novice/Master Probability",_this.masteryTextA.text=names,_this.masteryTextB.text=stats}_this.masteryTextA.visible=!_this.masteryTextA.visible,_this.masteryTextB.visible=_this.masteryTextA.visible,_this.openCloseBtn.alpha=_this.masteryTextA.visible?.7:.1,_this.openCloseBtn.scale.set(_this.masteryTextA.visible?1e4:1)},_this.enlearnFail=new PIXI.Sprite(Textures.get("enlearnFail")),_this.enlearnFail.visible=!1,_this.enlearnFail.x=1070,_this.enlearnFail.y=665,_this.addChild(_this.enlearnFail),_this.enlearnPass=new PIXI.Sprite(Textures.get("enlearnPass")),_this.enlearnPass.visible=!1,_this.enlearnPass.x=_this.enlearnFail.x,_this.enlearnPass.y=_this.enlearnFail.y,_this.addChild(_this.enlearnPass),_this.openCloseBtn=new PIXI.Sprite(Textures.get("square")),_this.openCloseBtn.on("pointertap",_this.toggleMasteryDebug),_this.openCloseBtn.pivot.set(.5),_this.openCloseBtn.interactive=!0,_this.openCloseBtn.alpha=.1,_this.openCloseBtn.x=1070,_this.openCloseBtn.y=665,_this.addChild(_this.openCloseBtn),_this.obstacleName=new PIXI.Text("asdasdasdasdasdas",{fill:"#f4f1f1",fontSize:35}),_this.obstacleName.position.set(1110,630),_this.obstacleName.anchor.x=1,_this.obstacleName.visible=!1,_this.addChild(_this.obstacleName),_this.masteryTextA=new PIXI.Text("",{fontSize:30,align:"right"}),_this.masteryTextA.position.set(440,100),_this.masteryTextA.anchor.x=1,_this.masteryTextA.visible=!1,_this.addChild(_this.masteryTextA),_this.masteryTextB=new PIXI.Text("",{fontSize:30}),_this.masteryTextB.position.set(450,100),_this.masteryTextB.visible=!1,_this.addChild(_this.masteryTextB),_this}return __extends(EnlearnUI,_super),EnlearnUI}(PIXI.Container),JetAnim=function(_super){function JetAnim(x,y){var _this=_super.call(this)||this;return _this.enabled=!1,_this.setAnim=function(clip,loop){void 0===loop&&(loop=!1),_this.jetSpine.state.setAnimation(0,clip,loop)},_this.onVoStart=function(clip){_this.anims[clip]&&(_this.setAnim(_this.anims[clip]),clearTimeout(_this.animTimeout),"onboarding-make-welcome-1"==clip?_this.returnToIdle(3e3):"onboarding-ready-edit"==clip?_this.returnToIdle(4700):"end-payoff-mission-control-2"==clip?_this.returnToIdle(3600):"to-play"==clip?_this.returnToIdle(2400):"to-edit-mode"==clip&&(_this.returnToIdle(5e3),_this.animTimeout=setTimeout(function(){_this.setAnim(_this.anims[clip])},2500)))},_this.returnToIdle=function(delay){setTimeout(function(){_this.setAnim("idle",!0)},delay)},_this.x=x,_this.topY=y,_this.y=_this.bottomY=_this.topY+1e3,_this.scale.x=_this.scale.y=2,_this.anims={},_this.anims["intro-1"]="intro-1",_this.anims["intro-2"]="intro-2",_this.anims["intro-3"]="intro-3",_this.anims["intro-4"]="intro-4_ALT",_this.anims["intro-6"]="intro-6",_this.anims["end-payoff-mission-control-1"]="end-payoff-mission-control-1_1",_this.anims["end-payoff-mission-control-2"]="end-payoff-mission-control-2",_this.anims["new-part-mission-control"]="new-part-mission-control_ALT",_this.anims["onboarding-make-welcome-1"]="onboarding-make-welcome-1",_this.anims["onboarding-ready-edit"]="onboarding-ready-edit",_this.anims["to-play"]="to-play-alt",_this.anims["to-edit-mode"]="to-play-alt",_this.jetSpine=new PIXI.spine.Spine(Animations.get("jet")),_this.setAnim("idle",!0),_this.addChild(_this.jetSpine),_this.enable(),_this}return __extends(JetAnim,_super),JetAnim.prototype.enable=function(){this.enabled||(this.enabled=!0,app.voPlayer.on("start",this.onVoStart),this.setAnim("idle",!0))},JetAnim.prototype.disable=function(){this.enabled&&(this.enabled=!1,app.voPlayer.off("start",this.onVoStart),clearTimeout(this.animTimeout))},JetAnim.prototype.show=function(){TweenLite.to(this,.4,{y:this.topY,ease:Power2.easeOut})},JetAnim.prototype.hide=function(){TweenLite.to(this,.2,{y:this.bottomY}),clearTimeout(this.animTimeout)},JetAnim}(PIXI.Container),DrillCover=function(_super){function DrillCover(texture,coordId,x,y,s){void 0===x&&(x=0),void 0===y&&(y=0),void 0===s&&(s=1);var _this=_super.call(this,texture)||this;return _this.coordId=coordId,_this.x=x,_this.y=y,_this.scale.x=_this.scale.y=s,_this}return __extends(DrillCover,_super),DrillCover}(PIXI.Sprite),DrillTargetView=function(_super){function DrillTargetView(){var _this=_super.call(this,Textures.get("DrillTarget"))||this;return _this.moveTo=function(pos,valid){_this.tl&&_this.tl.kill();var scale=valid?1:.5;_this.tl=new TimelineLite,_this.tl.to(_this.scale,.5,{x:scale,y:scale}),_this.tl.to(_this,.5,{ease:Power4.easeOut,x:pos.x,y:pos.y,alpha:valid?1:.5,rotation:valid?0:Math.PI/4},0),_this.tl.play()},_this.anchor.x=_this.anchor.y=.5,_this.alpha=0,_this}return __extends(DrillTargetView,_super),DrillTargetView}(PIXI.Sprite),FoamGridView=function(_super){function FoamGridView(level){var _this=_super.call(this)||this;return _this.setup=function(){_this.gridContainer=new PIXI.Container,_this.gridContainer.visible=!1,_this.addChild(_this.gridContainer);for(var gridsWide=Math.ceil(_this.levelWidth/_this.gridTileWidth),gridsHigh=Math.ceil(_this.levelHeight/_this.gridTileHeight),i=0;i<gridsHigh;i++){_this.gridYPos=375*i;for(var ii=0;ii<gridsWide;ii++){var grid=new PIXI.Sprite(Textures.get("foamgrid"));grid.x=_this.gridXPos=750*ii,grid.y=_this.gridYPos,_this.gridContainer.addChild(grid)}}},_this.show=function(pos){app.sound.play("sfx-grid",{volume:.3}),_this.gridContainer.x=_this.gridContainer.y=0,_this.gridContainer.alpha=0,_this.gridContainer.visible=!0,TweenLite.to(_this.gridContainer,.2,{alpha:1})},_this.hide=function(){new TimelineLite({onComplete:function(){return _this.gridContainer.visible=!1}}).to(_this.gridContainer,.2,{alpha:0})},_this.levelWidth=level.Width,_this.levelHeight=level.Height,_this.gridTileWidth=_this.gridTileHeight=5,_this.setup(),WorldSignals.showFoamGrid.add(_this.show),WorldSignals.hideFoamGrid.add(_this.hide),_this}return __extends(FoamGridView,_super),FoamGridView}(PIXI.Container),FoamProjectile=function(_super){function FoamProjectile(robotRef){var _this=_super.call(this)||this;return _this.fire=function(target){_this.particle.rotation=Math.atan2(target.y-_this.robotRef.y,target.x-_this.robotRef.x);var origin=new Point(_this.robotRef.x,_this.robotRef.y);_this.robotRef.body.name==Constants.Parts_Body_Med?origin.y-=80:origin.y-=160;var targetDir=new Point(target.x-origin.x,target.y-origin.y);targetDir=MathUtils.normalize(targetDir,110),_this.x=origin.x+targetDir.x,_this.y=origin.y+targetDir.y,_this.particle.playOnce()},_this.robotRef=robotRef,_this.particle=new ParticlesView(Particles.get("Foam"),"FoamFX"),_this.addChild(_this.particle),_this}return __extends(FoamProjectile,_super),FoamProjectile}(PIXI.Container),FoamTileView=function(_super){function FoamTileView(){var _this=_super.call(this,Textures.get("FoamPlatform"))||this;return _this.growAtPos=function(target){_this.x=target.x,_this.y=target.y,_this.scale.x=_this.scale.y=.5,_this.alpha=.5,_this.tl.invalidate().restart(),_this.foamPlatform.playOnce()},_this.anchor.x=_this.anchor.y=.5,_this.x=-200,_this.tl=new TimelineLite,_this.tl.to(_this.scale,.9,{ease:Back.easeOut,x:1,y:1}),_this.tl.to(_this,.9,{alpha:1},0),_this.foamPlatform=new ParticlesView(Particles.get("FoamPlatform"),"FoamFX"),_this.addChild(_this.foamPlatform),_this}return __extends(FoamTileView,_super),FoamTileView}(PIXI.Sprite),GameBackground=function(_super){function GameBackground(level){var _this=_super.call(this)||this;_this.disableUpdate=!1,_this.setup=function(parallaxTarget){_this.parallaxTarget=parallaxTarget;var planetName=PlayerPrefs.currentPlanet;_this.addSky(planetName),_this.addBackgrounds(planetName)},_this.addSky=function(planetName){_this.sky=new PIXI.Sprite(Textures.get(planetName+"_sky")),_this.addChild(_this.sky)},_this.addBackgrounds=function(planetName){_this.backgrounds=[];for(var i=0;i<5;i++){var path=planetName+"_bg"+(i+1);_this.backgrounds[i]=_this.createTilingSprite(path),_this.addChild(_this.backgrounds[i])}_this.updateParallaxing()},_this.createTilingSprite=function(textureName){var sprite=null,texture=Textures.get(textureName);if(texture){var width=_this.levelWidth,height=texture.orig.height;sprite=new PIXI.extras.TilingSprite(texture,width,height)}return sprite};var offsets={};offsets[Constants.Earth]=60,offsets[Constants.Moon]=110,offsets[Constants.Mars]=-75,offsets[Constants.Enceladus]=90,offsets[Constants.Bortron7]=-50,_this.offset=offsets[PlayerPrefs.currentPlanet];var parallax={};return parallax[Constants.Earth]=[[-75,-120],[55,-45],[195,45],[275,75],[325,75]],parallax[Constants.Moon]=[[80,30],[210,110],[350,200],[430,230],[480,230]],parallax[Constants.Mars]=[[80,30],[210,110],[350,200],[430,230],[480,230]],parallax[Constants.Enceladus]=[[-130,-190],[210,110],[350,200],[430,230],[480,230]],parallax[Constants.Bortron7]=[[80,30],[210,110],[350,200],[430,230],[480,230]],_this.parallax=parallax[PlayerPrefs.currentPlanet],_this.levelHeight=level.Height*Constants.TileHeight,_this.levelWidth=level.Width*Constants.TileWidth,_this}return __extends(GameBackground,_super),GameBackground.prototype.updateParallaxing=function(){var _this=this;if(!this.disableUpdate&&this.parallaxTarget){var targetY=-(this.parallaxTarget.y-120);targetY=MathUtils.clamp(targetY/this.levelHeight,0,1),this.backgrounds.forEach(function(element,index){_this.backgrounds[index].y=_this.offset+MathUtils.lerp(_this.parallax[index][0],_this.parallax[index][1],targetY)});var targetX=-(this.parallaxTarget.x-600);targetX=MathUtils.clamp(targetX/this.levelWidth,0,1),this.backgrounds[4].tilePosition.x=MathUtils.lerp(0,-450,targetX),this.backgrounds[3].tilePosition.x=MathUtils.lerp(0,-350,targetX),this.backgrounds[2].tilePosition.x=MathUtils.lerp(0,-250,targetX),this.backgrounds[1].tilePosition.x=MathUtils.lerp(0,-150,targetX),this.backgrounds[0].tilePosition.x=MathUtils.lerp(0,-50,targetX)}},GameBackground}(PIXI.Container),GFXFront=function(_super){function GFXFront(robot){var _this=_super.call(this)||this;return _this.foamTile=function(target){_this.foamProjectile.fire(target)},_this.foamProjectile=new FoamProjectile(robot),_this.addChild(_this.foamProjectile),WorldSignals.foamTile.add(_this.foamTile),_this}return __extends(GFXFront,_super),GFXFront}(PIXI.Container),HeatResourceView=function(_super){function HeatResourceView(resource,texture){var _this=_super.call(this,resource,texture)||this;return _this.bindToModel=function(){_super.prototype.bindToModel.call(_this),_this.model.sfxVolumeChanged.add(_this.sfxVolumeChanged)},_this.unbindFromModel=function(){_this.sfx.stop(),_super.prototype.unbindFromModel.call(_this),_this.model.sfxVolumeChanged.remove(_this.sfxVolumeChanged)},_this.onCollected=function(){_this.sfx.stop()},_this.sfxVolumeChanged=function(sfxVolume,resource){_this.sfx.volume=sfxVolume},_this.blendMode=PIXI.BLEND_MODES.ADD,_this.sfx=app.sound.play("sfx-reveal01",{volume:0,loop:!0}),_this}return __extends(HeatResourceView,_super),HeatResourceView}(ResourceView),IceWallView=function(_super){function IceWallView(coordId,x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this,Textures.get("iceWall"))||this;return _this.coordId=coordId,_this.anchor.y=1,_this.x=x,_this.y=y+Constants.TileHeight,_this}return __extends(IceWallView,_super),IceWallView.prototype.melt=function(){TweenLite.to(this.scale,1.5,{y:0,x:1.2})},IceWallView}(PIXI.Sprite),LevelView=function(_super){function LevelView(level){var _this=_super.call(this)||this;return _this.debugLabels=!1,_this.foamTile=function(target){_this.foamTileView.growAtPos(target)},_this.selectBody=function(newBody){_this.drillTarget.visible=newBody!=Constants.Parts_Body_Short},_this.setDrillTarget=function(point,valid){_this.drillTarget.moveTo(point,valid)},_this.pingSonar=function(point,angle){_this.sonarPing.pingAt(point,angle)},_this.drillTile=function(coordId){app.sound.play("sfx-dirt-dig");for(var i=_this.drillCovers.length-1;0<=i;i--){(drillCover=_this.drillCovers[i]).coordId===coordId&&(_this.removeChild(drillCover),_this.drillCovers.splice(i,1))}for(i=_this.xrayDrillCovers.length-1;0<=i;i--){var drillCover;(drillCover=_this.xrayDrillCovers[i]).coordId===coordId&&(_this.removeChild(drillCover),_this.xrayDrillCovers.splice(i,1))}},_this.meltIceWall=function(coordId){for(var i=_this.iceWalls.length-1;0<=i;i--)_this.iceWalls[i].coordId===coordId&&(_this.iceWalls[i].melt(),_this.iceWalls.splice(i,1))},_this.updateCracks=function(xrayOrigin){for(var i=_this.xrayDrillCovers.length-1;0<=i;i--){var drillCover=_this.xrayDrillCovers[i],dist=MathUtils.distance(xrayOrigin,drillCover);dist=1-MathUtils.inverseLerp(200,450,dist),drillCover.updateCrackVisibility(dist),drillCover.updateGlowSound(2*dist)}},_this.hideCracks=function(xrayOrigin){for(var i=_this.xrayDrillCovers.length-1;0<=i;i--)_this.xrayDrillCovers[i].updateCrackVisibility(0),_this.xrayDrillCovers[i].updateGlowSound(0)},_this.setupLevel=function(){var x,y,nrTiles=_this.level.Width*_this.level.Height;_this.drillCovers=[],_this.xrayDrillCovers=[],_this.iceWalls=[];for(var i=0;i<nrTiles;i++)if(0!==_this.level.colliders[i]){if(x=Math.floor(Constants.TileWidth*(i%_this.level.Width)),y=Math.floor(Constants.TileHeight*Math.floor(i/_this.level.Width)),_this.level.colliders[i]===TileID.drillHole||_this.level.colliders[i]===TileID.drillHoleCoverCracked){var texture=Textures.Tiles[TileID.drillHole-1];_this.addToTileContainer(_this.newSprite(texture,x,y)),texture=Textures.Tiles[TileID.drillHoleCoverCracked-1];var cover=_this.newCover(texture,i,x,y);_this.drillCovers.push(cover),_this.addChild(cover)}else if(_this.level.colliders[i]===TileID.drillThrough||_this.level.colliders[i]===TileID.drillThroughCoverCracked){texture=Textures.Tiles[TileID.drillThrough-1];_this.addToTileContainer(_this.newSprite(texture,x,y)),texture=Textures.Tiles[TileID.drillThroughCoverCracked-1];cover=_this.newCover(texture,i,x,y);_this.drillCovers.push(cover),_this.addChild(cover)}else if(_this.level.colliders[i]===TileID.xrayDrillHole){texture=Textures.Tiles[TileID.drillHole-1];_this.addToTileContainer(_this.newSprite(texture,x,y)),texture=Textures.Tiles[TileID.drillHoleCover-1];cover=_this.newXrayCover(texture,i,x,y);_this.xrayDrillCovers.push(cover),_this.addChild(cover)}else if(_this.level.colliders[i]===TileID.xrayDrillThrough){texture=Textures.Tiles[TileID.drillThrough-1];_this.addToTileContainer(_this.newSprite(texture,x,y)),texture=Textures.Tiles[TileID.drillThroughCover-1];cover=_this.newXrayCover(texture,i,x,y);_this.xrayDrillCovers.push(cover),_this.addChild(cover)}else if(_this.level.colliders[i]===TileID.iceWallBase){var iceWall=new IceWallView(i,x,y);_this.iceWalls.push(iceWall),_this.addChild(iceWall)}else if(_this.level.colliders[i]===TileID.iceWallMid||_this.level.colliders[i]===TileID.iceWallTop);else{texture=Textures.Tiles[_this.level.colliders[i]-1];_this.addToTileContainer(_this.newSprite(texture,x,y))}if(_this.debugLabels){var debugInfo="id: "+i+"\n"+_this.level.colliders[i],text=new PIXI.Text(debugInfo,{fill:16777215,align:"center"});text.x=x+40,text.y=y+5,_this.addToTileContainer(text)}}_this.leftTileContainer.cacheAsBitmap=!0,_this.rightTileContainer.cacheAsBitmap=!0,Device.lowEndDevice&&(_this.leftTileContainer.scale.x=_this.leftTileContainer.scale.y=3,_this.rightTileContainer.scale.x=_this.rightTileContainer.scale.y=3)},_this.level=level,_this.rightTileContainer=new PIXI.Container,_this.addChild(_this.rightTileContainer),_this.leftTileContainer=new PIXI.Container,_this.leftTileContainer.x=1,_this.addChild(_this.leftTileContainer),_this.halfScreenSize=Constants.TileWidth*_this.level.Width/2,_this.setupLevel(),WorldSignals.drillTile.add(_this.drillTile),WorldSignals.meltIceWall.add(_this.meltIceWall),WorldSignals.updateCracks.add(_this.updateCracks),WorldSignals.hideCracks.add(_this.hideCracks),WorldSignals.foamTile.add(_this.foamTile),WorldSignals.setDrillTargetView.add(_this.setDrillTarget),WorldSignals.selectBody.add(_this.selectBody),WorldSignals.pingSonar.add(_this.pingSonar),_this.foamTileView=new FoamTileView,_this.addChild(_this.foamTileView),_this.drillTarget=new DrillTargetView,_this.addChild(_this.drillTarget),_this.sonarPing=new SonarPingView,_this.addChild(_this.sonarPing),_this}return __extends(LevelView,_super),LevelView.prototype.addToTileContainer=function(sprite){sprite.x<this.halfScreenSize?this.leftTileContainer.addChild(sprite):this.rightTileContainer.addChild(sprite)},LevelView.prototype.newSprite=function(texture,x,y){var sprite=new PIXI.Sprite(texture);return Device.lowEndDevice?(sprite.x=x/3,sprite.y=y/3):(sprite.x=x,sprite.y=y),sprite},LevelView.prototype.newCover=function(texture,coordID,x,y){return Device.lowEndDevice?new DrillCover(texture,coordID,x,y,3):new DrillCover(texture,coordID,x,y)},LevelView.prototype.newXrayCover=function(texture,coordID,x,y){return Device.lowEndDevice?new XrayDrillCover(texture,coordID,x,y,3):new XrayDrillCover(texture,coordID,x,y)},LevelView}(PIXI.Container),PickupView=function(_super){function PickupView(pickup){var _this=_super.call(this,Textures.get("star"))||this;return _this.id=pickup.id,_this.anchor.x=.5,_this.anchor.y=.5,_this.x=pickup.x,_this.y=pickup.y,_this}return __extends(PickupView,_super),PickupView}(PIXI.Sprite),SonarPingView=function(_super){function SonarPingView(){var _this=_super.call(this,Textures.get("SonarPing"))||this;return _this.pingAt=function(pos,angle){_this.x=pos.x,_this.y=pos.y,_this.rotation=angle,_this.alpha=1,_this.tl&&_this.tl.kill(),_this.alpha=1,_this.scale.x=_this.scale.y=0,_this.tl=new TimelineLite,_this.tl.to(_this.scale,2,{x:5,y:5},0),_this.tl.to(_this,.2,{alpha:0},.2),_this.tl.play()},_this.anchor.x=_this.anchor.y=.5,_this.alpha=0,_this}return __extends(SonarPingView,_super),SonarPingView}(PIXI.Sprite),StaticGameBackground=function(_super){function StaticGameBackground(level){var _this=_super.call(this)||this;return _this.setup=function(parallaxTarget){var bg=new PIXI.Sprite(Textures.get(PlayerPrefs.currentPlanet+"_staticBg"));bg.scale.x=bg.scale.y=2,_this.addChild(bg)},_this}return __extends(StaticGameBackground,_super),StaticGameBackground.prototype.updateParallaxing=function(){},StaticGameBackground}(PIXI.Container),SuperEarResourceView=function(_super){function SuperEarResourceView(resource,texture){var _this=_super.call(this,resource,texture)||this;return _this.bindToModel=function(){_super.prototype.bindToModel.call(_this),_this.addParticle()},_this.unbindFromModel=function(){_this.stopParticles(),_super.prototype.unbindFromModel.call(_this)},_this.onCollected=function(){_this.stopParticles()},_this.stopParticles=function(){_this.particle.emitter.emit=!1,_this.particle.emitter.autoUpdate=!1,_this.particle.emitter.destroy()},_this}return __extends(SuperEarResourceView,_super),SuperEarResourceView.prototype.addParticle=function(){this.particle=new ParticlesView(Particles.get("Sparkle"),["Sparkle","Sparkle2"]),this.addChild(this.particle),this.particle.emitter.autoUpdate=!0},SuperEarResourceView}(ResourceView),XrayDrillCover=function(_super){function XrayDrillCover(texture,coordId,x,y,s){void 0===x&&(x=0),void 0===y&&(y=0),void 0===s&&(s=1);var _this=_super.call(this,texture)||this;return _this.lastTimePlayed=0,_this.coordId=coordId,_this.x=x,_this.y=y,_this.scale.x=_this.scale.y=s,_this.glowSprite=new PIXI.Sprite(Textures.get("crackedTile")),_this.glowSprite.alpha=0,_this.glowSprite.y=-3,_this.glowSprite.scale.x=_this.glowSprite.scale.y=1/s,_this.addChild(_this.glowSprite),_this}return __extends(XrayDrillCover,_super),XrayDrillCover.prototype.updateCrackVisibility=function(amount){this.glowSprite.alpha=amount},XrayDrillCover.prototype.updateGlowSound=function(volume){var now=(new Date).getTime();1<(now-this.lastTimePlayed)/1300&&.1<volume&&(this.lastTimePlayed=now,app.sound.play("sfx-reveal02",{volume:volume}))},XrayDrillCover}(PIXI.Sprite),LevelPopup=function(_super){function LevelPopup(){var _this=_super.call(this)||this;return _this.challengeData={spineName:"challengePopup",animName:"ChallengeIntroAnim",voName:"select-challenge"},_this.helpData={spineName:"helpPopup",animName:"HelpIntroAnim",voName:"mission-design"},_this.position.set(Constants.ScreenWidth/2,Constants.ScreenHeight/2),PlayerPrefs.currentLevel.isTutorial?_this.playPopUpAnim(_this.helpData):PlayerPrefs.currentLevel.isChallenge&&_this.playPopUpAnim(_this.challengeData),_this}return __extends(LevelPopup,_super),LevelPopup.prototype.playPopUpAnim=function(animData){this.popupAnim=new PIXI.spine.Spine(Animations.get(animData.spineName)),this.addChild(this.popupAnim),this.popupAnim.state.hasAnimation(animData.animName)&&(this.popupAnim.state.setAnimation(0,animData.animName,!1),app.voPlayer.play(animData.voName))},LevelPopup}(PIXI.Container),LoadingView=function(_super){function LoadingView(){var _this=_super.call(this)||this;return _this.glowCenter={x:632,y:585},_this.glowRadius=70,_this.maskRadius=120,_this.glowScaleSin=0,_this.updateProgress=function(p){_this.progress=MathUtils.clamp01(p)},_this.progress=0,_this.smoothProgress=0,_this.update=function(){_this.smoothProgress=MathUtils.lerp(_this.smoothProgress,_this.progress,.1),app.options.debug&&(_this.progressText.text="loading: "+Math.round(100*_this.smoothProgress)+"%");var angle=_this.smoothProgress*Math.PI*2-Math.PI/2,_x=Math.cos(angle),_y=Math.sin(angle);_this.glowBall.x=_this.glowCenter.x+_this.glowRadius*_x,_this.glowBall.y=_this.glowCenter.y+_this.glowRadius*_y,_this.glowScaleSin+=.01*app.time.smoothDelta;var s=1.6+.1*Math.sin(_this.glowScaleSin);_this.glowBall.scale.x=_this.glowBall.scale.y=s;var mr=_this.maskRadius;_x*=mr,_y*=mr,_this.smoothProgress<.25?(_this.loadingBarMask.beginFill(15158332),_this.loadingBarMask.drawPolygon([0,0,0,-mr,_x,_y])):_this.smoothProgress<.5?(_this.loadingBarMask.beginFill(15158332),_this.loadingBarMask.drawPolygon([0,0,0,-mr,mr,-mr,mr,0,_x,_y])):_this.smoothProgress<.75?(_this.loadingBarMask.beginFill(15158332),_this.loadingBarMask.drawPolygon([0,0,0,-mr,mr,-mr,mr,mr,0,mr,_x,_y])):_this.smoothProgress<1?(_this.loadingBarMask.beginFill(15158332),_this.loadingBarMask.drawPolygon([0,0,0,-mr,mr,-mr,mr,mr,-mr,mr,-mr,0,_x,_y])):(_this.loadingBarMask.beginFill(15158332),_this.loadingBarMask.drawRect(-mr,-mr,2*mr,2*mr)),_this.loadingBarMask.endFill(),app.options.debug&&(_this.progressText.text="loading: "+Math.round(100*_this.smoothProgress)+"%")},_this.teardown=function(){app.off("update",_this.update)},_this}return __extends(LoadingView,_super),LoadingView.prototype.init=function(){var bg=new PIXI.Sprite(Textures.get("splashBG"));this.addChild(bg),this.loadingBar=new PIXI.Sprite(Textures.get("loadingBar")),this.loadingBar.x=526,this.loadingBar.y=471,this.addChild(this.loadingBar),this.loadingBarMask=new PIXI.Graphics,this.loadingBarMask.x=this.glowCenter.x,this.loadingBarMask.y=this.glowCenter.y,this.loadingBar.mask=this.loadingBarMask,this.addChild(this.loadingBarMask),this.glowBall=new PIXI.Sprite(Textures.get("spot")),this.glowBall.anchor.x=this.glowBall.anchor.y=.5,this.glowBall.x=650,this.glowBall.y=530,this.addChild(this.glowBall),this.playBtn=new Button("playBtn",639,583,3),this.addChild(this.playBtn),app.options.debug&&(this.progressText=new PIXI.Text("",{fontSize:20,fill:"#ffffff"}),this.progressText.alpha=.5,this.progressText.x=575,this.progressText.y=690,this.addChild(this.progressText)),app.on("update",this.update),this.updateProgress(0),this.interactive=!0},LoadingView.prototype.addBuildInfo=function(info){if(app.options.debug){var version=new PIXI.Text("v "+info.version,{fontSize:20,fill:"#ffffff"});version.alpha=.5,version.x=170,version.y=665,this.addChild(version);var date=new PIXI.Text(info.date,{fontSize:20,fill:"#ffffff"});date.alpha=.5,date.x=170,date.y=690,this.addChild(date),Device.lowEndDevice&&(date.text+="*")}},LoadingView.prototype.removePrompt=function(){this.removeChild(this.playBtn)},LoadingView}(PIXI.Container),MainMenuView=function(_super){function MainMenuView(camShot,firstVisit){var _this=_super.call(this)||this;_this.closeBtnScale=.9,_this.playIntro=function(parent){setTimeout(function(){var intro=new PIXI.spine.Spine(Animations.introAnim.spineData);intro.x=680,intro.y=350,intro.scale.x=intro.scale.y=2,intro.state.setAnimation(0,"animation",!1),intro.state.timeScale=.9,parent.addChild(intro)},1600)},_this.showBackground=function(){TweenLite.killTweensOf(_this.background),TweenLite.to(_this.background,.25,{alpha:1})},_this.hideBackground=function(){TweenLite.killTweensOf(_this.background),TweenLite.to(_this.background,.25,{alpha:0})},_this.addSydneyHead=function(){Device.lowEndDevice||(_this.sydneyHead=new TalkingHeadView("talkingHeadMonitorSydney"),_this.sydneyHead.scale.x=_this.sydneyHead.scale.y=.75,_this.sydneyHead.x=1100,_this.sydneyHead.y=12,_this.addChild(_this.sydneyHead))},_this.resize=function(offset){_this.homeBtn.x=110+app.display.sideOffset},_this.playSFX=function(sfx){app.sound.play(sfx)},_this.hidePlayBtn=function(duration){void 0===duration&&(duration=.3),0<duration?TweenLite.to(_this.playButton,.3,{alpha:0}):_this.playButton.alpha=0},_this.showPlayBtn=function(duration){void 0===duration&&(duration=.3),0<duration?TweenLite.to(_this.playButton,.3,{alpha:1}):_this.playButton.alpha=1},_this.teardown=function(){_this.menuConsole.hideJet(),_this.visible=!1,_this.interactive=!1,_this.interactiveChildren=!1,_this.parent.removeChild(_this)},_this.menuCont=new PIXI.Container,_this.menuCont.x=640,_this.menuCont.y=camShot.y,_this.menuCont.scale.x=_this.menuCont.scale.y=camShot.scale,_this.addChild(_this.menuCont),_this.subMenuCont=new PIXI.Container,_this.subMenuCont.x=-700,_this.subMenuCont.y=-650,_this.menuCont.addChild(_this.subMenuCont),_this.background=new PIXI.Sprite(Textures.get("SpaceBackground")),_this.background.scale.x=_this.background.scale.y=3,_this.background.anchor.x=_this.background.anchor.y=.5,_this.background.x=700,_this.background.y=350,_this.subMenuCont.addChild(_this.background),firstVisit&&_this.playIntro(_this.subMenuCont),_this.playButton=new MenuPlayButton(60,10),_this.playButton.alpha=0,_this.subMenuCont.addChild(_this.playButton);var bg=new PIXI.Sprite(Textures.get("WorkShop"));return bg.scale.x=bg.scale.y=3,bg.anchor.x=bg.anchor.y=.5,_this.menuCont.addChild(bg),_this.menuConsole=new MenuConsole,_this.menuCont.addChild(_this.menuConsole),_this.homeBtn=new Button("menuHome",110,110,3),_this.setHomeButtonVisibility(!1),_this.addChild(_this.homeBtn),_this.addSydneyHead(),app.options.debug&&(_this.debugMenuBtn=new ClickCont(480,-600,100,100,.2,16711680),_this.menuCont.addChild(_this.debugMenuBtn),_this.debugMenuView=new DebugMenuView,_this.addChild(_this.debugMenuView)),_this.resize(0),_this}return __extends(MainMenuView,_super),MainMenuView.prototype.lookAt=function(args,durarion){void 0===durarion&&(durarion=0),0==durarion?(this.menuCont.y=args.y,this.menuCont.scale.x=this.menuCont.scale.y=args.scale):(TweenLite.to(this.menuCont,durarion,{y:args.y}),TweenLite.to(this.menuCont.scale,durarion,{x:args.scale,y:args.scale}))},MainMenuView.prototype.setHomeButtonVisibility=function(showHomeBtn){this.homeBtn.visible=showHomeBtn},MainMenuView.prototype.setCloseButtonVisibility=function(value){app.closeBtn&&(app.closeBtn.style.display=value?"block":"none")},MainMenuView}(PIXI.Container),MenuConsole=function(_super){function MenuConsole(){var _this=_super.call(this)||this;return _this.playSFX=function(sfx){app.lostFocus||app.sound.play(sfx)},_this.consoleLight=new PIXI.Sprite(Textures.get("Console")),_this.consoleDark=new PIXI.Sprite(Textures.get("ConsoleDark")),_this.buttons=[],_this.consoleDark.alpha=1,_this.consoleDark.position.x=-850,_this.consoleDark.position.y=80,_this.consoleDark.scale.x=4,_this.consoleDark.scale.y=4,_this.addChild(_this.consoleDark),_this.consoleLight.position.x=-850,_this.consoleLight.position.y=80,_this.consoleLight.scale.x=4,_this.consoleLight.scale.y=4,_this.addChild(_this.consoleLight),_this.editRobotBtn=new FlashButton("ConsoleEditBtn",Textures.get("ConsoleEditGlow"),469,407),_this.editRobotBtn.scale.x=2,_this.editRobotBtn.scale.y=2,_this.editRobotBtn.alpha=0,_this.editRobotBtn.interactive=!1,_this.buttons.push(_this.editRobotBtn),_this.addChild(_this.editRobotBtn),_this.partsWorkshopBtn=new FlashButton("ConsoleMakeBtn",Textures.get("ConsoleMakeGlow"),33,397),_this.partsWorkshopBtn.scale.x=2,_this.partsWorkshopBtn.scale.y=2,_this.partsWorkshopBtn.alpha=0,_this.partsWorkshopBtn.interactive=!1,_this.buttons.push(_this.partsWorkshopBtn),_this.addChild(_this.partsWorkshopBtn),_this.jetAnim=new JetAnim(-400,1e3),_this.addChild(_this.jetAnim),_this}return __extends(MenuConsole,_super),MenuConsole.prototype.animateMenuConsole=function(showEditRobot){var _this=this,tl=new TimelineLite;tl.to(this.consoleLight,.7,{alpha:1,delay:.5}),tl.add(function(){return _this.playSFX("sfx-button-digital")}),tl.to(this.partsWorkshopBtn,.3,{alpha:1}),showEditRobot&&tl.to(this.editRobotBtn,.3,{alpha:1})},MenuConsole.prototype.showMenuConsole=function(showEditRobot){this.consoleLight.alpha=1,this.partsWorkshopBtn.alpha=1,showEditRobot&&(this.editRobotBtn.alpha=1)},MenuConsole.prototype.showJet=function(){this.jetAnim.show()},MenuConsole.prototype.hideJet=function(){this.jetAnim.hide()},MenuConsole.prototype.showMakeButton=function(){var _this=this,tl=new TimelineLite;tl.to(this.consoleLight,.7,{alpha:1}),tl.add(function(){return _this.playSFX("sfx-button-digital")}),tl.to(this.partsWorkshopBtn,.3,{alpha:1},.5)},MenuConsole.prototype.showEditButton=function(){var _this=this,tl=new TimelineLite;tl.to(this.consoleLight,.7,{alpha:1}),tl.add(function(){return _this.playSFX("sfx-button-digital")}),tl.to(this.editRobotBtn,.3,{alpha:1},.5)},MenuConsole.prototype.hideEditButton=function(){this.editRobotBtn.alpha=0},MenuConsole.prototype.hideMenuConsole=function(){this.consoleLight.alpha=0,this.buttons.forEach(function(button){button.alpha=0})},MenuConsole.prototype.lower=function(){TweenLite.killTweensOf(this.y),TweenLite.to(this,.2,{y:400,ease:Power2.easeOut}),this.jetAnim.disable()},MenuConsole.prototype.raise=function(){TweenLite.killTweensOf(this.y),TweenLite.to(this,.2,{y:0,ease:Power2.easeOut}),this.jetAnim.enable()},MenuConsole.prototype.resetButtonStates=function(){this.editRobotBtn.resetState(),this.partsWorkshopBtn.resetState()},MenuConsole}(PIXI.Container),MenuPlanetView=function(_super){function MenuPlanetView(planetIndex,x,y){var _this=_super.call(this)||this;_this.x=x,_this.y=y,_this.setScale(1.5),_this.planetName=Constants.Planets[planetIndex],_this.unlocked=!1;var textureName="";return textureName=_this.planetName==Constants.Earth?Constants.Earth+"On":_this.planetName+"Off",_this.planetImg=new PIXI.Sprite(Textures.get(textureName)),_this.planetImg.anchor.x=_this.planetImg.anchor.y=.5,_this.addChild(_this.planetImg),_this}return __extends(MenuPlanetView,_super),MenuPlanetView.prototype.updateUnlockedState=function(value){this.unlocked=value;var textureName=this.planetName+(this.unlocked?"On":"Off");this.planetImg.texture=Textures.get(textureName)},MenuPlanetView.prototype.setScale=function(value){this.scale.x=this.scale.y=value},MenuPlanetView}(PIXI.Container),MenuPlayButton=function(_super){function MenuPlayButton(x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this)||this;return _this.x=x,_this.y=y,_this.bg=new PIXI.Sprite(Textures.get("menuPlayBtnBG")),_this.bg.x=40,_this.bg.y=240,_this.bg.scale.x=_this.bg.scale.y=2,_this.addChild(_this.bg),_this.button=new Button("menuPlayBtn",660,280,3),_this.button.scale.x=_this.button.scale.y=2,_this.addChild(_this.button),_this}return __extends(MenuPlayButton,_super),MenuPlayButton}(PIXI.Container),MenuRobotView=function(_super){function MenuRobotView(){var _this=_super.call(this)||this;return _this.jumpTimestamp=0,_this.equipPart=function(partName,partType){if(partType==Constants.Body)_this.equipBody(partName);else{var track=SpineData.Tracks[partType],anim=SpineData.TransitionAnims[partName];track&&anim&&_this.playAnim(track,anim,!1),partType==Constants.Legs?_this.playPartAnim(partName):partType==Constants.Arms&&_this.currentBod!=Constants.Parts_Body_Short&&_this.playPartAnim(partName)}},_this.equipBody=function(newBod){if(_this.currentBod!=newBod){var track=SpineData.Tracks[Constants.Body],anim=SpineData.GetBodyTransitionAnims(_this.currentBod,newBod);_this.currentBod=newBod;try{_this.playAnim(track,anim,!1)}catch(e){console.log(e)}}},_this.updatePartSkin=function(partId,colour){var partType=Constants.PartType[partId];_this.equipPart(partId,partType),setTimeout(function(){for(var textureName="RobotSpine"+colour,slotNames=SkinColour.getSlotsNames(partId),i=0;i<slotNames.length;i++){var slot=_this.findSlotByName(slotNames[i]);slot.currentSprite&&slot.currentSprite.texture&&slot.currentSprite.texture.baseTexture&&(slot.currentSprite.texture.baseTexture=Textures.get(textureName).baseTexture)}},30)},_this.playPartAnim=function(partName){switch(partName){case Constants.Parts_Pincer:return void _this.playAnim(SpineData.armAnimTrack,"PincerGrabAnim",!1);case Constants.Parts_Wings:return void _this.playAnim(SpineData.armAnimTrack,"WingGlideAnim",!1);case Constants.Parts_Booster:return void _this.playAnim(SpineData.armAnimTrack,"BoosterAnim",!1);case Constants.Parts_Drill:var anim=_this.currentBod==Constants.Parts_Body_Tall?"DrillTallAnim":"DrillMediumAnim";return void _this.playAnim(SpineData.armAnimTrack,anim,!1);case Constants.Parts_Foamer:return void _this.playFoamerAnim();case Constants.Parts_Wheels:return void _this.playWheelAnim();case Constants.Parts_Tracks:return void _this.playTrackAnim();case Constants.Parts_Springs:return void _this.playSpringJump();case Constants.Parts_Rocket:return _this.playAnim(SpineData.legAnimTrack,"RocketLaunchAnim",!1),void _this.playRocketJump()}},_this.playFoamerAnim=function(){var armBase=_this.robotSpine.skeleton.findBone("ArmBase"),tl=new TimelineLite;tl.to(armBase,.3,{ease:Power2.easeInOut,rotation:0},0),tl.to(armBase,.3,{ease:Power2.easeInOut,rotation:-90},.4),tl.add(function(){return foam.playOnce()},.35);var foam=new ParticlesView(Particles.get("Foam"),"FoamFX");foam.x=_this.robotSpine.x+80,foam.y=_this.robotSpine.y-(_this.currentBod==Constants.Parts_Body_Tall?175:100),_this.addChild(foam)},_this.playWheelAnim=function(){var leftWheel=_this.robotSpine.skeleton.findBone("WheelsFastLeftBase"),rightWheel=_this.robotSpine.skeleton.findBone("WheelsFastRightBase"),leanBase=_this.robotSpine.skeleton.findBone("BodyLeanBase"),armBase=_this.robotSpine.skeleton.findBone("ArmBase"),t=2.5,rot=leftWheel.rotation-350,tl=new TimelineLite;tl.to(leftWheel,t,{ease:Power2.easeInOut,rotation:rot},0),tl.to(rightWheel,t,{ease:Power2.easeInOut,rotation:rot},0),tl.to(leanBase,t/2,{ease:Power2.easeInOut,rotation:15},0),tl.to(leanBase,t/2,{ease:Power2.easeInOut,rotation:0},t/2),tl.to(armBase,t/2,{ease:Power2.easeOut,rotation:-120},.2),tl.to(armBase,t/2,{ease:Power2.easeOut,rotation:-90},1.45)},_this.playTrackAnim=function(){var leanBase=_this.robotSpine.skeleton.findBone("BodyLeanBase"),armBase=_this.robotSpine.skeleton.findBone("ArmBase"),tracks=[_this.robotSpine.skeleton.findBone("TreadWheel1Base"),_this.robotSpine.skeleton.findBone("TreadWheel2Base"),_this.robotSpine.skeleton.findBone("TreadWheel3Base"),_this.robotSpine.skeleton.findBone("TreadWheel6Base"),_this.robotSpine.skeleton.findBone("TreadWheel7Base")],rot=tracks[0].rotation-100,tl=new TimelineLite;tracks.forEach(function(track){tl.to(track,2,{ease:Power2.easeInOut,rotation:rot},0)}),tl.to(leanBase,1,{ease:Power2.easeInOut,rotation:10},0),tl.to(leanBase,1,{ease:Power2.easeInOut,rotation:0},1),tl.to(armBase,1,{ease:Power2.easeOut,rotation:-110},.2),tl.to(armBase,1,{ease:Power2.easeOut,rotation:-90},1.2),tl.to(_this.robotSpine,.2,{y:-3},.2),tl.to(_this.robotSpine,.2,{y:0},.4),tl.to(_this.robotSpine,.2,{y:-5},.6),tl.to(_this.robotSpine,.2,{y:0},.8),tl.to(_this.robotSpine,.2,{y:-3},1),tl.to(_this.robotSpine,.2,{y:0},1.2);var trackSmoke=new ParticlesView(Particles.get("tracksSmoke"),"TreadSmoke_FX");trackSmoke.x=_this.robotSpine.x-60,trackSmoke.y=_this.robotSpine.y-60,trackSmoke.playOnce(),_this.addChild(trackSmoke)},_this.playSpringJump=function(){var now=(new Date).getTime(),diffInSec=(now-_this.jumpTimestamp)/1e3;if(_this.jumpTimestamp=now,1<diffInSec){var tl=new TimelineLite;tl.to(_this.robotSpine,.5,{ease:Power2.easeOut,y:-70},0),tl.to(_this.robotSpine,.5,{ease:Power2.easeIn,y:0}),_this.robotSpine.scale.y=.9,tl.to(_this.robotSpine.scale,.5,{ease:Power2.easeOut,y:1},0),tl.to(_this.robotSpine.scale,.5,{ease:Power2.easeIn,y:1.1},.5),tl.to(_this.robotSpine.scale,.1,{ease:Power2.easeIn,y:.9},1),tl.to(_this.robotSpine.scale,.1,{ease:Power2.easeIn,y:1},1.1)}},_this.playRocketJump=function(){var now=(new Date).getTime(),diffInSec=(now-_this.jumpTimestamp)/1e3;if(_this.jumpTimestamp=now,1<diffInSec){var tl=new TimelineLite;tl.to(_this.robotSpine,.5,{ease:Power2.easeOut,y:-150},0),tl.to(_this.robotSpine,.5,{ease:Power2.easeIn,y:0}),_this.robotSpine.scale.y=.9,tl.to(_this.robotSpine.scale,.5,{ease:Power2.easeOut,y:1},0),tl.to(_this.robotSpine.scale,.5,{ease:Power2.easeIn,y:1.1},.5),tl.to(_this.robotSpine.scale,.1,{ease:Power2.easeIn,y:.9},1),tl.to(_this.robotSpine.scale,.1,{ease:Power2.easeIn,y:1},1.1)}},_this.findSlotByName=function(name){for(var i=0;i<_this.robotSpine.skeleton.slots.length;i++)if(_this.robotSpine.skeleton.slots[i].data.name==name)return _this.robotSpine.skeleton.slots[i];console.error("could not find slot for "+name)},_this.playAnim=function(track,anim,loop){try{_this.robotSpine.state.setAnimation(track,anim,!1)}catch(e){console.log("anim not found: "+anim)}},_this.robotSpine=new PIXI.spine.Spine(Animations.get("robot")),_this.playAnim(SpineData.bodyAnimTrack,"TallToMediumAnim",!1),_this.addChild(_this.robotSpine),_this}return __extends(MenuRobotView,_super),MenuRobotView}(PIXI.Container),MissionCompleteView=function(_super){function MissionCompleteView(){var _this=_super.call(this)||this;return _this.resourcesRecapViewFinalY=60,_this.startResourcesRecapViewY=-120,_this.progressBarFinalY=120,_this.progressBarStartingY=400,_this.starSpineFinalY=155,_this.starSpineStartingY=400,_this.update=function(delta){_this.starTrailingView.update(delta),_this.nobView.rotation+=delta/1e3*.56},_this.playSFX=function(sfx){app.sound.play(sfx)},_this.disableButtons=function(){_this.nextButton.interactive=!1},_this.startSFX=function(){_this.progressSFX=app.sound.play("sfx-star-meter",{loop:!0})},_this.stopSFX=function(){_this.progressSFX&&_this.progressSFX.stop()},_this.scale.x=_this.scale.y=2,_this.createPlanetView(),_this.createSunspotView(),_this.createResourceView(),_this.createNextButtons(),_this.createTrailingStarsView(),_this.createStarProgressBar(),_this.createStarSpine(),_this.createExplosionStarsView(),_this}return __extends(MissionCompleteView,_super),MissionCompleteView.prototype.init=function(){app.on("update",this.update)},MissionCompleteView.prototype.teardown=function(){app.off("update",this.update),this.starTrailingView&&(this.starTrailingView.emitter.emit=!1,this.starTrailingView.emitter.autoUpdate=!1),this.starExplosionView&&(this.starExplosionView.emitter.emit=!1,this.starExplosionView.emitter.autoUpdate=!1),this.stopSFX()},MissionCompleteView.prototype.createPlanetView=function(){this.planetView=new PIXI.Sprite(null),this.planetView.position.x=350,this.planetView.position.y=195,this.planetView.anchor.x=this.planetView.anchor.y=.5,this.addChild(this.planetView)},MissionCompleteView.prototype.createSunspotView=function(){this.sunspotView=new PIXI.Sprite(Textures.get("sunspot")),this.sunspotView.x=170,this.sunspotView.y=90,this.sunspotView.alpha=0,this.addChild(this.sunspotView)},MissionCompleteView.prototype.setPlanet=function(planetTextureName){this.planetView.texture=Textures.get("Rewards"+planetTextureName),this.planetView.scale.x=this.planetView.scale.y=3},MissionCompleteView.prototype.createNextButtons=function(){this.nextButton=new ClickSprite(Textures.get("NextBtn"),450,200),this.nextButton.alpha=0,this.addChild(this.nextButton)},MissionCompleteView.prototype.createStarProgressBar=function(){this.resultProgressBar=new ProgressBar("StarBar","StarBarFill",this.starTrailingView),this.resultProgressBar.x=205,this.resultProgressBar.y=this.progressBarStartingY,this.addChild(this.resultProgressBar)},MissionCompleteView.prototype.createTrailingStarsView=function(){this.starTrailingView=new ParticlesView(Particles.get("starBarEmitter"),"StarFX"),this.nobView=new PIXI.Sprite(Textures.get("StarBarStar")),this.nobView.anchor.x=this.nobView.anchor.y=.5,this.starTrailingView.addChild(this.nobView),this.addChild(this.starTrailingView)},MissionCompleteView.prototype.createExplosionStarsView=function(){this.starExplosionView=new ParticlesView(Particles.get("starBarBurstEmitter"),"StarFX"),this.starExplosionView.x=500,this.starExplosionView.y=this.starSpineFinalY,this.addChild(this.starExplosionView)},MissionCompleteView.prototype.createStarSpine=function(){this.starSpine=new PIXI.spine.Spine(Animations.get("starOn")),this.starSpine.position.x=500,this.starSpine.position.y=this.starSpineStartingY,this.addChild(this.starSpine)},MissionCompleteView.prototype.createResourceView=function(){this.resourcesRecapView=new ResourcesRecapView,this.resourcesRecapView.scale.x=this.resourcesRecapView.scale.y=.7,this.resourcesRecapView.position.x=238,this.resourcesRecapView.position.y=this.startResourcesRecapViewY,this.addChild(this.resourcesRecapView)},MissionCompleteView.prototype.addResource=function(planetName,amount,isActivated){this.resourcesRecapView.addResources(planetName,amount,isActivated)},MissionCompleteView.prototype.reset=function(){this.nextButton.alpha=0,this.resultProgressBar.resetProgress(),this.starSpine.state.setAnimation(0,"OffButton",!1),this.nobView.rotation=0,this.starExplosionView.disable(),this.starTrailingView.disable(),this.resetProgressBarPosition(),this.resetStarPosition(),this.resetResourceViewPosition(),this.resourcesRecapView.reset()},MissionCompleteView.prototype.resetProgressBarPosition=function(){this.resultProgressBar.y=this.progressBarStartingY},MissionCompleteView.prototype.resetStarPosition=function(){this.starSpine.y=this.starSpineStartingY},MissionCompleteView.prototype.resetResourceViewPosition=function(){this.resourcesRecapView.position.y=this.startResourcesRecapViewY},MissionCompleteView.prototype.showResourcePanel=function(timeline,planetName,startNumber,count,time){var _this=this;timeline.to(this.resourcesRecapView,.3,{y:this.resourcesRecapViewFinalY,ease:Bounce.easeOut},time).add(function(){return _this.incrementAmount(planetName,startNumber,count)},time+.3)},MissionCompleteView.prototype.getProgressAnimationTime=function(starCount,maxStarsCount){return this.resultProgressBar.getAnimationTime(starCount,maxStarsCount)},MissionCompleteView.prototype.fadeIn=function(){TweenLite.to(this,.2,{alpha:1})},MissionCompleteView.prototype.animateProgress=function(timeline,starCount,maxStarsCount,progressBarStartTime,progressBarEndTime){var _this=this;this.startTrailing(timeline,progressBarStartTime),timeline.add(function(){return _this.startSFX()},progressBarStartTime),this.playProgressBarAnimation(timeline,progressBarStartTime,starCount,maxStarsCount),this.stopTrailing(timeline,progressBarEndTime),timeline.add(function(){return _this.stopSFX()},progressBarEndTime)},MissionCompleteView.prototype.showSunspot=function(delay){this.sunspotView.y=250,TweenLite.to(this.sunspotView,.2,{alpha:1,y:100,delay:delay})},MissionCompleteView.prototype.playNextButtonAnimation=function(timeline,time){this.nextButton.interactive=!0,TweenLite.to(this.nextButton,.2,{alpha:1,delay:time})},MissionCompleteView.prototype.startTrailing=function(timeline,startTime){var _this=this;timeline.add(function(){return _this.starTrailingView.enable()},startTime)},MissionCompleteView.prototype.playProgressBarAnimation=function(timeline,progressBarTime,starCount,maxStarsCount){var _this=this;timeline.to(this.resultProgressBar,.3,{y:this.progressBarFinalY,ease:Bounce.easeOut},progressBarTime).to(this.starSpine,.3,{y:this.starSpineFinalY,ease:Bounce.easeOut},progressBarTime).add(function(){return _this.playStarBar(starCount,maxStarsCount)},progressBarTime)},MissionCompleteView.prototype.playStarBar=function(currentResources,maxResources){var ease=new SinEase(this.resultProgressBar.yOffset,this.resultProgressBar.maxValue,this.resultProgressBar.factor);this.resultProgressBar.setProgress(currentResources,maxResources,Power0.easeNone,ease)},MissionCompleteView.prototype.stopTrailing=function(timeline,timePreviousAnimation){var _this=this;timeline.add(function(){return _this.starTrailingView.disable()},timePreviousAnimation)},MissionCompleteView.prototype.playStar=function(timeline,time){var _this=this;timeline.add(function(){return _this.starExplosionView.playOnce()},time).add(function(){return _this.starSpine.state.setAnimation(0,"StarOn",!1)},time)},MissionCompleteView.prototype.incrementAmount=function(planetName,startNumber,count){this.resourcesRecapView.playAnimationIncrement(planetName,startNumber,count)},MissionCompleteView}(PIXI.Container),MissionSelectionView=function(_super){function MissionSelectionView(){var _this=_super.call(this)||this;_this.planetGap=600,_this.enableButtons=function(challengeAvailable){_this.nextPlanetBtn.interactive=!0,_this.previousPlanetBtn.interactive=!0,_this.challengeBtn.interactive=challengeAvailable;for(var i=0;i<_this.levelBtns.length;i++)_this.levelBtns[i].interactive=!0},_this.disableButtons=function(){_this.nextPlanetBtn.interactive=!1,_this.previousPlanetBtn.interactive=!1,_this.challengeBtn.interactive=!1;for(var i=0;i<_this.levelBtns.length;i++)_this.levelBtns[i].interactive=!1},_this.playSFX=function(sfx){app.sound.play(sfx)},_this.updateButtonTextures=function(savedLevels,levelBuffer){for(var i=0;i<_this.levelBtns.length;i++)_this.levelBtns[i].updateBtnState(i+levelBuffer,savedLevels)},_this.setChallengeAvailable=function(challengeAvailable){_this.challengeBtn.updateAvailability(challengeAvailable)},_this.addPlanets=function(){_this.planetViews=[],_this.planetListCont=new PIXI.Container,_this.planetListCont.y=300,_this.addChild(_this.planetListCont),Constants.Planets.forEach(function(planet,index){var _x=200+index*_this.planetGap,menuPlanet=new MenuPlanetView(index,_x,0);_this.planetListCont.addChild(menuPlanet),_this.planetViews.push(menuPlanet)})},_this.scrollToPlanet=function(planetID,instantly){void 0===instantly&&(instantly=!1),_this.updateLabelTexture(planetID);var targetX=planetID*_this.planetGap-500;instantly?_this.planetListCont.x=-targetX:(_this.tl.clear(),_this.scrollAnim(targetX))},_this.updateLabelTexture=function(planetID){var texureName=Constants.Planets[planetID]+"Label";_this.planetLabel.texture=Textures.get(texureName)},_this.hidePlanetLabel=function(planetID){_this.planetLabel.scale.x=0},_this.flashLevelButtons=function(){for(var _loop_3=function(i){_this.levelBtns[i].interactive=!1,setTimeout(function(){_this.addChild(new ButtonHighlight("diamondHighlight",_this.levelBtns[i].x,_this.levelBtns[i].y+95))},140*i)},i=0;i<_this.levelBtns.length;i++)_loop_3(i)},_this.flashChallengeButton=function(){_this.addChild(new ButtonHighlight("diamondHighlightWings",_this.challengeBtn.x,_this.challengeBtn.y+90)),_this.setChallengeAvailable(!0)},_this.planetUnlockAnim=function(index){var planetView=_this.planetViews[index];TweenLite.to(planetView.scale,.5,{x:1.3,y:1.3,onUpdate:function(){var power=(1.5-1.3)/4;power=Math.random()*power-power/2,planetView.rotation=power},onComplete:function(){planetView.rotation=0}}),setTimeout(function(){planetView.setScale(1.5);var unlockAnim=new PlanetUnlockAnim;planetView.addChild(unlockAnim)},600)},_this.tl=new TimelineLite;var orbitLine=new PIXI.Sprite(Textures.get("OrbitLine"));return orbitLine.scale.x=orbitLine.scale.y=3,orbitLine.y=280,orbitLine.x=20,_this.addChild(orbitLine),_this.addPlanets(),_this.planetLabel=new PIXI.Sprite,_this.planetLabel.anchor.x=_this.planetLabel.anchor.y=1,_this.planetLabel.x=650,_this.planetLabel.y=200,_this.addChild(_this.planetLabel),_this.nextPlanetBtn=new PIXI.Graphics,_this.nextPlanetBtn.hitArea=new PIXI.Rectangle(970,30,300,400),_this.nextPlanetBtn.interactive=!0,_this.addChild(_this.nextPlanetBtn),_this.previousPlanetBtn=new PIXI.Graphics,_this.previousPlanetBtn.hitArea=new PIXI.Rectangle(120,30,300,400),_this.previousPlanetBtn.interactive=!0,_this.addChild(_this.previousPlanetBtn),_this.addButtons(),_this}return __extends(MissionSelectionView,_super),MissionSelectionView.prototype.addButtons=function(){this.levelBtns=[],this.buttonCont=new PIXI.Container;for(var i=0;i<Constants.LevelsPerPlanet;i++)this.addLevelBtn(i);this.buttonCont.swapChildren(this.levelBtns[0],this.levelBtns[8]),this.buttonCont.swapChildren(this.levelBtns[1],this.levelBtns[7]),this.buttonCont.swapChildren(this.levelBtns[2],this.levelBtns[6]),this.buttonCont.swapChildren(this.levelBtns[3],this.levelBtns[5]),this.challengeBtn=new ChallengeButton(1053,413),this.buttonCont.addChild(this.challengeBtn),this.addChild(this.buttonCont),this.buttonCont.position.y=90},MissionSelectionView.prototype.addLevelBtn=function(id){var lvlBtn=null,xPos=360+77*id;lvlBtn=new LevelButton(id,xPos,(id+1)%2==0?420:500),this.buttonCont.addChild(lvlBtn),this.levelBtns.push(lvlBtn)},MissionSelectionView.prototype.scrollAnim=function(targetX){var _this=this;this.tl.add("planetAnim",0).to(this.planetListCont.position,.5,{onStart:function(){_this.planetLabel.scale.x=0},ease:Power4.easeOut,x:-targetX},"planetAnim").to(this.planetLabel.scale,.5,{ease:Elastic.easeOut,x:1})},MissionSelectionView}(PIXI.Container),PartsWorkshopView=function(_super){function PartsWorkshopView(){var _this=_super.call(this)||this;_this.jiggleButtons=function(){_this.buttons.forEach(function(element){element.jiggleBtn&&element.jiggleBtn()})},_this.playSFX=function(sfx){app.sound.play(sfx)},_this.scale.x=_this.scale.y=1.25,_this.x=-95,_this.y=-70;var bg=new PIXI.Sprite(Textures.get("BlueBorder"));return bg.scale.x=bg.scale.y=3,bg.x=215,bg.y=102,_this.addChild(bg),_this.resourceIcons=[],_this.buttons=[],_this.addResources(),_this}return __extends(PartsWorkshopView,_super),PartsWorkshopView.prototype.updateResources=function(resources){for(var i=0;i<this.resourceIcons.length;i++)this.resourceIcons[i].setAmount(resources[i])},PartsWorkshopView.prototype.updateCanBuy=function(){this.buttons.forEach(function(element){null!=element.updateCanBuy&&element.updateCanBuy()})},PartsWorkshopView.prototype.clearSlots=function(){var _this=this;this.buttons.forEach(function(element){element.teardown(),_this.removeChild(element)}),this.buttons=[]},PartsWorkshopView.prototype.clearSlot=function(id){var _this=this;if(this.buttons[id]){var btnView_1=this.buttons[id];btnView_1.teardown();var targetY=btnView_1.y+50;TweenLite.to(btnView_1,.2,{alpha:0,y:targetY}),setTimeout(function(){return _this.removeChild(btnView_1)},200),this.buttons.splice(id,1)}},PartsWorkshopView.prototype.addCraftablePart=function(part,callback){if(part){var crafteablePartView=new CraftPartView(part,callback);crafteablePartView.setPos(this.getPosInList(0)),this.addChild(crafteablePartView),this.buttons.push(crafteablePartView)}},PartsWorkshopView.prototype.addCraftableSkins=function(skins,callback){for(var index=this.buttons.length||0,i=0;i<skins.length;i++){var unlockableSKin=new UnlockSkinBox(skins[i],index,callback);if(unlockableSKin.setPos(this.getPosInList(index)),this.addChild(unlockableSKin),this.buttons.push(unlockableSKin),1<++index)return}},PartsWorkshopView.prototype.addSkinUnlockPlaceholder=function(index){var pos=this.getPosInList(index),skinUnlock=new SkinUnlockedBtn(pos.x-13,pos.y-12);this.buttons.push(skinUnlock),this.addChild(skinUnlock),this.playCraftingPayoff(index)},PartsWorkshopView.prototype.playCraftingPayoff=function(index){var partBuiltEmitter=new ParticlesView(Particles.get("partBuiltEmitter"),["ResourceBoltGlow","ResourceCogGlow","ResourceNutGlow"]);partBuiltEmitter.x=780,partBuiltEmitter.y=300+150*index,partBuiltEmitter.playOnce(),this.addChild(partBuiltEmitter)},PartsWorkshopView.prototype.getPosInList=function(index){return{x:228,y:221+162*index}},PartsWorkshopView.prototype.addResources=function(){for(var i=0;i<Constants.Planets.length;i++){var amount=app.wallet.get(Constants.Planets[i]),resourceIcon=new ResourceIcon(i,amount,440+80*i,84);this.addChild(resourceIcon),this.resourceIcons.push(resourceIcon)}},PartsWorkshopView}(PIXI.Container),PlanetUnlockAnim=function(_super){function PlanetUnlockAnim(){var _this=_super.call(this)||this;_this.lifeTime=3500,_this.showPulse=function(){var pulse=new PIXI.Sprite(Textures.get("UnlockPulse"));pulse.blendMode=PIXI.BLEND_MODES.ADD,pulse.anchor.x=pulse.anchor.y=.5,pulse.scale.x=pulse.scale.y=.8,_this.addChild(pulse);var timeline=new TimelineLite;timeline.to(pulse,.6,{alpha:0,ease:Power2.easeOut},0),timeline.to(pulse.scale,.6,{x:1.3,y:1.3,ease:Power2.easeOut},0)},_this.showPulse();var partBuiltEmitter=new ParticlesView(Particles.get("unlockPlanetBurst"),"UnlockStar");return partBuiltEmitter.playOnce(),_this.addChild(partBuiltEmitter),_this}return __extends(PlanetUnlockAnim,_super),PlanetUnlockAnim}(PIXI.Container),ResourcesRecapView=function(_super){function ResourcesRecapView(){var _this=_super.call(this)||this;return _this.resources={},_this}return __extends(ResourcesRecapView,_super),ResourcesRecapView.prototype.addResources=function(planetName,amount,isActivated){var factor=Object.keys(this.resources).length,resourceIcon=new RewardResourceView(planetName,amount,isActivated);resourceIcon.x=(6+resourceIcon.width)*factor,this.addChild(resourceIcon),this.resources[planetName]=resourceIcon},ResourcesRecapView.prototype.playAnimationIncrement=function(planetName,startNumber,count){this.resources[planetName].animateCount(startNumber,count)},ResourcesRecapView.prototype.reset=function(){this.resources={},this.children.forEach(function(child){child.destroy()}),this.removeChildren()},ResourcesRecapView}(PIXI.Container),RewardStarBar=function(_super){function RewardStarBar(){var _this=_super.call(this)||this;return _this.progressBarFinalY=190,_this.progressBarStartingY=400,_this.starSpineFinalY=215,_this.starSpineStartingY=400,_this.resourcesRecapViewFinalY=60,_this.startResourcesRecapViewY=-120,_this}return __extends(RewardStarBar,_super),RewardStarBar}(PIXI.Container),CraftablePart=function(name){this.calcPartCost=function(){var levelsPlayed=Math.max(0,PlayerPrefs.levels.length-2),progress=Math.floor(levelsPlayed/Constants.LevelsPerPlanet);return 0==progress?[3,0,0,0,0]:1==progress?[2,2,0,0,0]:2==progress?[2,2,2,0,0]:3==progress?[0,0,4,2,0]:[0,0,2,2,2]},this.name=name,this.cost=this.calcPartCost(),this.title=Constants.PartTitles[name],this.description=Constants.PartDescription_Short[name],this.type=Constants.PartType[name]},HeatVisionView=function(_super){function HeatVisionView(){var _this=_super.call(this)||this;return _this.setHeadHeight=function(value){TweenLite.killTweensOf(_this),TweenLite.to(_this,.5,{y:value})},_this.show=function(){TweenLite.killTweensOf(_this.scale),TweenLite.fromTo(_this.scale,.75,{x:0,y:0},{x:1,y:1,ease:Back.easeOut})},_this.hide=function(){TweenLite.killTweensOf(_this.scale),TweenLite.to(_this.scale,.5,{x:0,y:0,ease:Power2.easeIn})},_this.createBubble=function(){var bubble=new PIXI.Sprite(Textures.get("ThermalCircle"));return bubble.anchor.set(.5),bubble.blendMode=PIXI.BLEND_MODES.ADD,bubble},_this.scale.x=_this.scale.y=0,_this.addChild(_this.createBubble()),_this}return __extends(HeatVisionView,_super),HeatVisionView}(PIXI.Container),RobotSpine=function(_super){function RobotSpine(robot){var _this=_super.call(this)||this;return _this.armSwingSin=0,_this.armSwing=0,_this.armAnimDuration=0,_this.foamerTargetAngle=0,_this.foamerLerp=0,_this.desiredAngle=0,_this.smoothAngle=0,_this.armAngle=0,_this.smokeTimer=0,_this.changeBody=function(newBody){if(_this.currentBodyType=_this.currentBodyType||Constants.Parts_Body_Med,_this.currentBodyType!=newBody){app.sound.play("sfx-swapbody",{volume:.3});var track=SpineData.Tracks[Constants.Body],anim=SpineData.GetBodyTransitionAnims(_this.currentBodyType,newBody);_this.robotSpine.state.setAnimation(track,anim,!1)}_this.updatePartSkin(_this.robotRef.body.name),_this.currentBodyType=_this.robotRef.body.name},_this.findSlotByName=function(name){for(var i=0;i<_this.robotSpine.skeleton.slots.length;i++)if(_this.robotSpine.skeleton.slots[i].data.name==name)return _this.robotSpine.skeleton.slots[i];console.error("could not find slot for "+name)},_this.updatePartSkin=function(partId){setTimeout(function(){for(var textureName="RobotSpine"+SkinColour.get(partId),slotNames=SkinColour.getSlotsNames(partId),i=0;i<slotNames.length;i++){var slot=_this.findSlotByName(slotNames[i]);slot.currentSprite&&slot.currentSprite.texture&&slot.currentSprite.texture.baseTexture&&(slot.currentSprite.texture.baseTexture=Textures.get(textureName).baseTexture)}},20)},_this.equipPart=function(partName,partType){if(partName){var track=SpineData.Tracks[partType],anim=SpineData.TransitionAnims[partName];_this.robotSpine.state.setAnimation(track,anim,!1),_this.updatePartSkin(partName),partName==Constants.Parts_Tracks&&_this.trackSmoke.playOnce()}},_this.updateWheelRotation=function(delta){if(_this.robotRef.legs.name==Constants.Parts_Wheels){var rot=_this.robotRef.velocity.x*(_this.robotRef.facingRight?1:-1);_this.leftWheel.rotation-=rot,_this.rightWheel.rotation-=rot}else if(_this.robotRef.legs.name==Constants.Parts_Tracks){_this.smokeTimer-=delta,_this.smokeTimer<0&&(_this.smokeTimer=2e3+2e3*Math.random(),_this.trackSmoke.playOnce());var rot_1=_this.robotRef.velocity.x*(_this.robotRef.facingRight?1:-1);_this.trackWheels.forEach(function(trackWheel){trackWheel.rotation-=rot_1})}},_this.updateLean=function(delta){if(_this.robotSpine)if(_this.desiredAngle=Math.abs(_this.robotRef.velocity.x*(.052*-delta+3.85)),_this.smoothAngle=MathUtils.lerp(_this.smoothAngle,_this.desiredAngle,.01*delta),_this.smoothAngle=MathUtils.clamp(_this.smoothAngle,0,40),_this.armAngle=_this.ARM_BASE_ANGLE-2*_this.smoothAngle,_this.robotRef.arms.name==Constants.Parts_Foamer){if(_this.foamerLerp-=.001*delta,_this.foamerLerp<0)_this.armBase.rotation=_this.armAngle;else if(1<_this.foamerLerp)_this.armBase.rotation=_this.foamerTargetAngle;else{var rot=MathUtils.angleLerp(_this.armAngle,_this.foamerTargetAngle,_this.foamerEase(_this.foamerLerp));_this.armBase.rotation=rot}_this.bodyLeanBase.rotation=_this.smoothAngle}else _this.robotRef.legs&&_this.robotRef.legs.name==Constants.Parts_Rocket?(_this.bodyLeanBase.rotation=-1*_this.smoothAngle,_this.armBase.rotation=_this.armAngle):(_this.bodyLeanBase.rotation=_this.smoothAngle,_this.armBase.rotation=_this.armAngle+_this.armSwing)},_this.foamerEase=function(p){return(p=1-(p=MathUtils.clamp01(p)))<1/2.75?1-7.5625*p*p:p<2/2.75?1-(7.5625*(p-=1.5/2.75)*p+.75):p<2.5/2.75?1-(7.5625*(p-=2.25/2.75)*p+.9375):1-(7.5625*(p-=2.625/2.75)*p+.984375)},_this.updateArmSwing=function(delta){0<_this.armAnimDuration?(_this.armAnimDuration-=delta,_this.armSwingSin=0,_this.armSwing=MathUtils.lerp(_this.armSwing,0,.1)):(_this.armSwingSin-=.002*delta,_this.armSwing=15*Math.sin(_this.armSwingSin))},_this.foamTile=function(target){_this.foamerTargetAngle=180*-Math.atan2(target.y-_this.robotRef.y,target.x-_this.robotRef.x)/Math.PI,_this.robotRef.facingRight||(_this.foamerTargetAngle=180-_this.foamerTargetAngle),_this.foamerLerp=1.2},_this.robotRef=robot,_this.setupSpine(),WorldSignals.selectBody.add(_this.changeBody),WorldSignals.selectHead.add(function(partName){return _this.equipPart(partName,Constants.Head)}),WorldSignals.selectArms.add(function(partName){return _this.equipPart(partName,Constants.Arms)}),WorldSignals.selectLegs.add(function(partName){return _this.equipPart(partName,Constants.Legs)}),WorldSignals.foamTile.add(_this.foamTile),_this}return __extends(RobotSpine,_super),RobotSpine.prototype.setupSpine=function(){this.trackSmoke=new ParticlesView(Particles.get("tracksSmoke"),"TreadSmoke_FX"),this.trackSmoke.x=-60,this.trackSmoke.y=-57,this.addChild(this.trackSmoke),this.robotSpine=new PIXI.spine.Spine(Animations.get("robot")),this.robotSpine.state.setAnimation(SpineData.bodyAnimTrack,"TallToMediumAnim",!1),this.addChild(this.robotSpine),this.rootBase=this.robotSpine.skeleton.findBone("RootBase"),this.bodyLeanBase=this.robotSpine.skeleton.findBone("BodyLeanBase"),this.armBase=this.robotSpine.skeleton.findBone("ArmBase"),this.leftWheel=this.robotSpine.skeleton.findBone("WheelsFastLeftBase"),this.rightWheel=this.robotSpine.skeleton.findBone("WheelsFastRightBase"),this.trackWheels=[this.robotSpine.skeleton.findBone("TreadWheel1Base"),this.robotSpine.skeleton.findBone("TreadWheel2Base"),this.robotSpine.skeleton.findBone("TreadWheel3Base"),this.robotSpine.skeleton.findBone("TreadWheel6Base"),this.robotSpine.skeleton.findBone("TreadWheel7Base")],this.ARM_BASE_ANGLE=0|this.armBase.rotation,this.foamerTargetAngle=this.ARM_BASE_ANGLE,this.robotRef.body&&(this.changeBody(this.robotRef.body.name),this.equipPart(this.robotRef.arms.name,Constants.Arms),this.equipPart(this.robotRef.legs.name,Constants.Legs),this.equipPart(this.robotRef.head.name,Constants.Head))},RobotSpine.prototype.grabAnim=function(){this.armAnimDuration=1040,this.robotSpine.state.setAnimation(SpineData.armAnimTrack,"PincerGrabAnim",!1)},RobotSpine.prototype.drillAnim=function(){this.armAnimDuration=1400,this.robotRef.body.name==Constants.Parts_Body_Med?this.robotSpine.state.setAnimation(SpineData.armAnimTrack,"DrillMediumAnim",!1):this.robotRef.body.name==Constants.Parts_Body_Tall&&this.robotSpine.state.setAnimation(SpineData.armAnimTrack,"DrillTallAnim",!1)},RobotSpine.prototype.flapAnim=function(){this.robotSpine.state.setAnimation(SpineData.armAnimTrack,"WingGlideAnim",!1)},RobotSpine.prototype.rocketLaunchAnim=function(){this.robotSpine.state.setAnimation(SpineData.legAnimTrack,"RocketLaunchAnim",!1)},RobotSpine.prototype.rocketLandAnim=function(){this.robotSpine.state.setAnimation(SpineData.legAnimTrack,"RocketLandAnim",!1)},RobotSpine.prototype.boostAnim=function(){this.armAnimDuration=1400,this.robotSpine.state.setAnimation(SpineData.armAnimTrack,"BoosterAnim",!1)},RobotSpine.prototype.deathAnim=function(){this.robotSpine&&(this.robotSpine.tint=11711154,TweenLite.to(this.rootBase,.7,{ease:Bounce.easeOut,rotation:-90,onComplete:this.respawnAnim})),setTimeout(this.respawnAnim,1e3)},RobotSpine.prototype.respawnAnim=function(){TweenLite.killTweensOf(this.rootBase),this.robotSpine&&0!=this.rootBase.rotation&&(this.robotSpine.tint=16777215,this.rootBase.rotation=0)},RobotSpine}(PIXI.Container),RobotView=function(_super){function RobotView(robot){var _this=_super.call(this)||this;_this.updatePosition=function(delta){_this.desiredOffset=IKSolver.getOffset(_this.robotRef,_this.currentTile),_this.targetY=_this.robotRef.y+_this.desiredOffset,_this.onFloor&&(_this.y=MathUtils.lerp(_this.y,_this.robotRef.y+_this.desiredOffset,.01*delta)),_this.x=MathUtils.lerp(_this.x,_this.robotRef.x,.5),_this.y=_this.targetY},_this.updatScale=function(){_this.robotSpine.scale.x=_this.robotRef.facingRight?1:-1,_this.robotSpine.scale.x*=1-_this.robotRef.squash+1,_this.robotSpine.scale.y=_this.robotRef.squash},_this.getHeadHeight=function(bodyName){return bodyName==Constants.Parts_Body_Short?-90:bodyName==Constants.Parts_Body_Tall?-220:-165},_this.changeBody=function(bodyName){_this.heatVisionView.setHeadHeight(_this.getHeadHeight(bodyName))},_this.playAnim=function(animId,value){void 0===value&&(value=0),"death"==animId?_this.robotSpine.deathAnim():"respawn"==animId?_this.robotSpine.respawnAnim():"grab"==animId?_this.robotSpine.grabAnim():"flap"==animId?_this.robotSpine.flapAnim():"drill"==animId?_this.robotSpine.drillAnim():"rocketLaunch"==animId?_this.robotSpine.rocketLaunchAnim():"rocketLand"==animId?_this.robotSpine.rocketLandAnim():"boost"==animId?_this.robotSpine.boostAnim():console.error("unknown anim: ",animId)},_this.robotRef=robot,_this.x=_this.robotRef.x,_this.y=_this.robotRef.y,_this.robotSpine=new RobotSpine(robot),_this.robotSpine.y=20,_this.updateView(0),_this.addChild(_this.robotSpine),_this.heatVisionView=new HeatVisionView,_this.addChild(_this.heatVisionView);var body=robot.body?robot.body.name:Constants.Parts_Body_Med;_this.changeBody(body),robot.head.name==Constants.Parts_Head_HeatVision&&_this.heatVisionView.show(),WorldSignals.playRobotAnim.add(_this.playAnim),WorldSignals.onFloorEnter.add(function(){_this.onFloor=!0,_this.robotSpine.onFloor=!0,_this.debugOrigin.alpha=1}),WorldSignals.onFloorExit.add(function(){_this.onFloor=!1,_this.robotSpine.onFloor=!1,_this.debugOrigin.alpha=.2}),WorldSignals.onTileUpdate.add(function(t){_this.currentTile=t,_this.robotSpine.currentTile=t});var debugOrigin=new PIXI.Sprite(Textures.get("robotOrigin"));return debugOrigin.anchor.x=debugOrigin.anchor.y=.5,debugOrigin.scale.x=debugOrigin.scale.y=.5,_this.debugOrigin=debugOrigin,WorldSignals.showHeatVision.add(_this.heatVisionView.show),WorldSignals.hideHeatVision.add(_this.heatVisionView.hide),WorldSignals.selectBody.add(_this.changeBody),_this}return __extends(RobotView,_super),RobotView.prototype.updateView=function(delta){this.updatePosition(delta),this.updatScale(),this.robotSpine.updateWheelRotation(delta),this.robotSpine.updateLean(delta),this.robotSpine.updateArmSwing(delta)},RobotView}(PIXI.Container),Skin=function(partName,colour){this.calcPartCost=function(){var levelsPlayed=Math.max(0,PlayerPrefs.levels.length-1),progress=Math.floor(levelsPlayed/Constants.LevelsPerPlanet);return 0==progress?[3,0,0,0,0]:1==progress?[2,2,0,0,0]:2==progress?[2,2,2,0,0]:3==progress?[0,0,4,2,0]:[0,0,2,2,2]},this.partName=partName,this.colour=colour,this.cost=this.calcPartCost()},SkinColour=function(){function SkinColour(){}return SkinColour.init=function(currentPartString,unlockedSkins){SkinColour.parts=currentPartString,SkinColour.unlockedSkins=unlockedSkins},SkinColour.set=function(partName,colour){this.parts[partName]=colour},SkinColour.get=function(partName){return this.parts[partName]?this.parts[partName]:Constants.SkinDefault},SkinColour.setUnlocked=function(partName,colour){var unlockedSkins=this.unlockedSkins[partName];unlockedSkins?Array.isArray(unlockedSkins)?-1==unlockedSkins.indexOf(colour)&&unlockedSkins.push(colour):console.error("SkinColour::unlock parts was not a valid array"):unlockedSkins=[colour],this.unlockedSkins[partName]=unlockedSkins,PlayerPrefs.saveSkins()},SkinColour.getUnlocked=function(partName){var unlockedSkins=this.unlockedSkins[partName];return unlockedSkins?Array.isArray(unlockedSkins)?unlockedSkins.concat([Constants.SkinDefault]):void console.error("SkinColour::unlock parts was not a valid array"):[Constants.SkinDefault]},SkinColour.getLocked=function(partName){var allColours=[Constants.SkinRed,Constants.SkinBlue,Constants.SkinGreen],unlockedSkins=this.unlockedSkins[partName];return unlockedSkins?Array.isArray(unlockedSkins)?allColours.filter(function(i){return unlockedSkins.indexOf(i)<0}):void console.error("SkinColour::unlock parts was not a valid array"):allColours},SkinColour.getUnlockableSkinsForPart=function(partName){for(var partSkins=[],lockedColours=SkinColour.getLocked(partName),j=0;j<lockedColours.length;j++){var colour=lockedColours[j];partSkins.push(new Skin(partName,colour))}return partSkins},SkinColour.getUnlockableSkins=function(){for(var availableSkins=[],i=0;i<Constants.DefaultParts.length;i++)availableSkins=availableSkins.concat(SkinColour.getUnlockableSkinsForPart(Constants.DefaultParts[i]));for(i=0;i<PlayerPrefs.partsUnlocked;i++)availableSkins=availableSkins.concat(SkinColour.getUnlockableSkinsForPart(Constants.UnlockOrder[i]));return availableSkins},SkinColour.getSlotsNames=function(partName){return partName==Constants.Parts_Pincer?["ArmSlot","ArmPincerBackSlot","ArmPincerFrontAtt"]:partName==Constants.Parts_Drill?["ArmSlot","DrillLipAtt","DrillSlot","DrillPistonSlot"]:partName==Constants.Parts_Wings?["WingTopSlot"]:partName==Constants.Parts_Foamer?["ArmSlot","FoamerBubblesSlot"]:partName==Constants.Parts_Booster?["ArmSlot","RobotRocketFlameAtt"]:partName==Constants.Parts_Wheels?["WheelsFastBaseSlot","WheelsFastLeftSlot","WheelsFastRightSlot"]:partName==Constants.Parts_Tracks?["TreadSlot","TreadBaseSlot"]:partName==Constants.Parts_Springs?["SpringsSlot","SpringsBaseSlot"]:partName==Constants.Parts_Rocket?["RobotSideRocketSlot","RobotRocketFlameSlot","RobotRocketBaseSlot","RobotFrontRocketSlot","RobotRocketFlameAtt"]:partName==Constants.Parts_Body_Tall?["BodyTallSlot","BodySlot","BodyTopSlot"]:partName==Constants.Parts_Body_Med?["BodySlot","BodyTopSlot"]:partName==Constants.Parts_Body_Short?["BodyTopSlot"]:partName==Constants.Parts_Head_Normal?["HeadSlot"]:partName==Constants.Parts_Head_SuperEars?["HeadSlot"]:partName==Constants.Parts_Head_XrayVision?["HeadSlot"]:partName==Constants.Parts_Head_HeatVision?["HeadSlot"]:void console.error("SkinColour::undefined part ",partName)},SkinColour.parts={},SkinColour.unlockedSkins={},SkinColour}(),SkinUnlockedBtn=function(_super){function SkinUnlockedBtn(x,y){var _this=_super.call(this,Textures.get("SkinUnlocked"))||this;return _this.teardown=function(){app.off("update",_this.update)},_this.update=function(){_this.alpha+=.04},_this.x=x,_this.y=y,_this.anchor.x=_this.anchor.y=0,_this.alpha=0,app.on("update",_this.update),_this}return __extends(SkinUnlockedBtn,_super),SkinUnlockedBtn}(PIXI.Sprite),Button=function(_super){function Button(textureName,x,y,segments,horizontalLayout){void 0===x&&(x=0),void 0===y&&(y=0),void 0===segments&&(segments=4),void 0===horizontalLayout&&(horizontalLayout=!0);var _this=_super.call(this,null)||this;return _this.DEFAULT=0,_this.MOUSE_DOWN=1,_this.MOUSE_OVER=2,_this.isMouseOver=!1,_this.segments=4,_this.horizontalLayout=!0,_this.btnPressed=!1,_this.onButtonUp=function(){_this.setSegment(_this.DEFAULT),_this.btnPressed&&_this.emit("buttonup"),_this.btnPressed=!1},_this.onButtonDown=function(){_this.setSegment(_this.MOUSE_DOWN),_this.emit("buttondown"),_this.btnPressed=!0},_this.onButtonOut=function(){_this.setSegment(_this.DEFAULT),_this.isMouseOver=!1},_this.onButtonOver=function(){_this.setSegment(_this.MOUSE_OVER),_this.isMouseOver=!0},_this.setSegment=function(id){_this.texture=_this.btnTextures[id]},_this.setTexture=function(textureName){var tileWidth,tileHeight;if(_this.texture=Textures.get(textureName),_this.btnTextures=[],_this.horizontalLayout){tileWidth=_this.texture.width/_this.segments,tileHeight=_this.texture.height;for(var i=0;i<3;i++){var tex=new PIXI.Texture(_this.texture,new PIXI.Rectangle(i*tileWidth,0,tileWidth,tileHeight));_this.btnTextures.push(tex)}}else{tileWidth=_this.texture.width,tileHeight=_this.texture.height/_this.segments;for(i=0;i<3;i++){tex=new PIXI.Texture(_this.texture,new PIXI.Rectangle(0,i*tileHeight,tileWidth,tileHeight));_this.btnTextures.push(tex)}}_this.setSegment(_this.DEFAULT)},_this.x=x,_this.y=y,_this.segments=segments,_this.horizontalLayout=horizontalLayout,_this.anchor.x=_this.anchor.y=.5,_this.setTexture(textureName),_this.on("pointerdown",_this.onButtonDown),_this.on("pointerup",_this.onButtonUp),_this.on("pointerupoutside",_this.onButtonUp),_this.on("pointerover",_this.onButtonOver),_this.on("pointerout",_this.onButtonOut),_this.interactive=!0,$(window).on("blur",function(){_this.onButtonUp()}),_this}return __extends(Button,_super),Button.prototype.resetState=function(){this.setSegment(this.DEFAULT)},Button}(PIXI.Sprite),ButtonHighlight=function(_super){function ButtonHighlight(textureName,x,y,initialScale){void 0===x&&(x=0),void 0===y&&(y=0),void 0===initialScale&&(initialScale=1);var _this=_super.call(this,Textures.get(textureName))||this;return _this.progress=0,_this.initialScale=1,_this.lifeTime=500,_this.update=function(){if(!app.lostFocus){_this.progress+=app.time.delta;var p=_this.progress/_this.lifeTime;_this.scale.x=_this.scale.y=MathUtils.lerp(_this.initialScale,1.5*_this.initialScale,p),_this.alpha=MathUtils.lerp(1,0,p),1<p&&(clearInterval(_this.updateInterval),_this.parent.removeChild(_this))}},_this.initialScale=initialScale,_this.blendMode=PIXI.BLEND_MODES.ADD,_this.alpha=0,_this.anchor.x=_this.anchor.y=.5,_this.x=x,_this.y=y,_this.updateInterval=setInterval(_this.update,16),_this}return __extends(ButtonHighlight,_super),ButtonHighlight}(PIXI.Sprite),ButtonInfo=function(){function ButtonInfo(texture,lockedTexture,robotPart){this._texture=texture,this._lockedTexture=lockedTexture,this._robotPart=robotPart}return Object.defineProperty(ButtonInfo.prototype,"texture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(ButtonInfo.prototype,"lockedTexture",{get:function(){return this._lockedTexture},enumerable:!1,configurable:!0}),Object.defineProperty(ButtonInfo.prototype,"robotPart",{get:function(){return this._robotPart},enumerable:!1,configurable:!0}),ButtonInfo}(),ButtonJiggle=function(target){if(0==target.rotation){for(var tl=new TimelineLite,t=.3,r=.4,i=0;i<5;i++)tl.to(target,t,{rotation:r,ease:Power2.easeInOut}),t*=.9,r*=-.8;tl.to(target,t,{rotation:0})}},ChallengeButton=function(_super){function ChallengeButton(x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this,"ChallengeButtonDisabled",x,y,3)||this;return _this.updateAvailability=function(enabled){enabled?(_this.setTexture("ChallengeButtonEnabled"),_this.anchor.x=.505,_this.anchor.y=.58):(_this.setTexture("ChallengeButtonDisabled"),_this.anchor.x=_this.anchor.y=.5)},_this.interactive=!1,_this}return __extends(ChallengeButton,_super),ChallengeButton}(Button),ClickCont=function(_super){function ClickCont(x,y,width,height,alpha,tint){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=100),void 0===height&&(height=100),void 0===alpha&&(alpha=.01),void 0===tint&&(tint=16777215);var _this=_super.call(this)||this;return _this.texWidth=100,_this.interactive=!0,_this.addRect(x,y,width,height,tint),_this.alpha=alpha,_this}return __extends(ClickCont,_super),ClickCont.prototype.addRect=function(x,y,width,height,tint){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=100),void 0===height&&(height=100),void 0===tint&&(tint=16777215);var mainRect=new PIXI.Sprite(Textures.get("square"));mainRect.x=x,mainRect.y=y,mainRect.scale.x=width/this.texWidth,mainRect.scale.y=height/this.texWidth,mainRect.tint=tint,this.addChild(mainRect)},ClickCont}(PIXI.Container),ClickSprite=function(_super){function ClickSprite(texture,x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this,texture)||this;return _this.x=x,_this.y=y,_this.interactive=!0,_this}return __extends(ClickSprite,_super),ClickSprite}(PIXI.Sprite),CraftingCostView=function(_super){function CraftingCostView(cost){var _this=_super.call(this)||this;return _this._calculateCachedBounds=function(){return new PIXI.Rectangle(0,0,1,1)},_this.update(cost),_this}return __extends(CraftingCostView,_super),CraftingCostView.prototype.update=function(cost){var _this=this;this.cacheAsBitmap=!1,this.removeChildren();var count=0;Constants.Planets.forEach(function(planet,index){for(var availableResources=app.wallet.get(planet),i=0;i<cost[index];i++){var pos=_this.iconPos(count),available=i<availableResources,textureName=Constants.Resources[index]+"Small";textureName+=available?"_Icon":"Dark_Icon";var icon=new PIXI.Sprite(Textures.get(textureName));icon.anchor.x=icon.anchor.y=.5,icon.scale.x=icon.scale.y=.9,icon.alpha=available?1:.4,icon.x=pos.x,icon.y=pos.y,_this.addChild(icon),count++}}),this.cacheAsBitmap=!0},CraftingCostView.prototype.iconPos=function(index){return{x:52*Math.floor(index%3),y:60*Math.floor(index/3)}},CraftingCostView}(PIXI.Container),CraftPartView=function(_super){function CraftPartView(part,callback){var _this=_super.call(this,0,callback)||this;_this.updateCanBuy=function(){_this.craftOrMissionBtn&&(_this.craftOrMissionBtn.removeAllListeners(),_this.removeChild(_this.craftOrMissionBtn));var cost=_this.part.cost;_this.craftingCost.update(cost),app.wallet.canBuy(cost)?_this.addCraftBtn():PlayerPrefs.tutStep==TutStep.Complete&&_this.addMissionBtn(cost)},_this.addCraftBtn=function(){_this.craftOrMissionBtn=new Button("BuildBtn",525,84,3),_this.craftOrMissionBtn.on("pointerdown",_this.onCraftPart),_this.addChild(_this.craftOrMissionBtn)},_this.onCraftPart=function(){_this.craftOrMissionBtn.removeAllListeners(),_this.craftingCallback(_this.part,0)},_this.jiggleBtn=function(){_this.craftOrMissionBtn&&new ButtonJiggle(_this.craftOrMissionBtn)},_this.part=part,_this.setImages("BuildBox",part.name+"_"+Constants.SkinDefault+"_Icon",4);var textColour=Constants.Colours[Constants.SkinDefault];return _this.setText(part.title,part.description,textColour),_this.setCost(part.cost),_this.updateCanBuy(),_this.jiggleBtn(),_this}return __extends(CraftPartView,_super),CraftPartView}(BuyBox),DebugMenuView=function(_super){function DebugMenuView(){var _this=_super.call(this)||this;_this.levels=[],_this.completeAllLevels=function(){PlayerPrefs.levels=[{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"a001",problemID:"980bc310-45fa-4ab1-ac4c-bac06e54a22a",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"a003",problemID:"f429abca-3b2f-45bd-bea1-0b5449ca813d",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"a005",problemID:"00cd961a-5d2f-4d5a-9234-d59fc8979d22",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"a007",problemID:"e3527cea-4309-4063-9404-5817718e067b",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"b001",problemID:"887918d1-ea5f-4eb7-a731-c3e14e1a9aa1",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"b002",problemID:"d59f1101-50f9-4b5b-8e3a-f57f699aa90e",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"b004",problemID:"9a1ddc70-1658-457c-bb6b-10280087c01d",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"c001",problemID:"d7731506-07d6-4191-bd2e-b508ea5f445e",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"c002",problemID:"eaf83cc6-7368-4a3a-8585-26420ae8bcec",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"c003",problemID:"d796292b-3dc9-4b8a-9344-09d4a02e2e68",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"c004",problemID:"6a472519-4f34-4bba-b8a9-135f42939cd9",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"d001",problemID:"fed0fa7e-97ed-46e9-bd4a-6cd6df917a35",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"d002",problemID:"f957a91d-98c3-447a-89fd-45b32e491adc",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"d003",problemID:"75c983e8-4abf-4372-8405-89d34f197015",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"e001",problemID:"3644d429-361e-49a5-a6b6-20bb8fe060c0",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"e002",problemID:"27ef0139-55fa-4caa-9a8f-174ab081506f",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"e003",problemID:"3049abd9-0cce-4a56-b4f3-47d367ed1ccc",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"e004",problemID:"6c50fccf-d2aa-4db6-a0e1-b00944b7f062",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"f001",problemID:"57b0f79c-1fb7-45bc-92f9-5f01aa444dd8",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"f002",problemID:"77ae703c-1e83-4f6f-ada6-eb7ee28a168f",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"f003",problemID:"a06bd116-4ba3-49b2-b8b6-3d992b4cc076",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"g001",problemID:"831c92b3-6104-45cb-a210-4e946a517a82",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"g003",problemID:"4bb6dca7-84a7-49fa-ba15-b1c1fe3f880a",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"g004",problemID:"2cec09d3-e88a-4f6b-9d99-1b3df195303a",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"h003",problemID:"95c695be-dac2-4c84-92ee-820f505a5611",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"h004",problemID:"5230d175-c213-4ade-a402-4a9c7ac27f83",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"h005",problemID:"dc7850aa-c87c-46c3-80fa-8a9e139c9822",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"h006",problemID:"794a2012-f7a3-43be-9c32-c1c8d9bc355b",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"i002",problemID:"5e597b94-9d1e-45d7-990e-badc7eded452",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"i003",problemID:"c5b06df2-f026-43de-8a93-940b4df9569e",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"j001",problemID:"9ba334c8-4136-4702-be83-859705c24896",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"j002",problemID:"7444adf8-cb62-4c74-8af4-5ab246b371aa",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"j003",problemID:"a6cfddf4-57eb-43f8-a6f8-cad21d76d10e",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"j004",problemID:"234cf9cc-c771-4df6-81e9-566741b364eb",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"j005",problemID:"d0ded0ec-92ab-4454-906e-bccf7745f505",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"k002",problemID:"83ef6ec8-740b-4b7f-8ee3-8f880715fc97",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"k003",problemID:"19fcaba1-4017-49b1-9aa8-8c0301398cbc",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"k004",problemID:"3f9f7297-5b46-496b-a990-00180ea9a485",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"m002",problemID:"b9cc0b18-14b7-4434-bedd-ca4b4467e2bf",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"m003",problemID:"a2dddea5-ca00-4e53-87d8-bd360855a500",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"m004",problemID:"c02fa9d8-0a41-4829-98f5-e6adea0372e2",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"m005",problemID:"98aec450-2a82-4eeb-9d87-9c0ed39b783e",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"n002",problemID:"a76de6a7-9890-4d0b-b8e9-bb38236d86bd",levelNr:0,fullStars:!0,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"n003",problemID:"56b22902-d8d1-4565-a3a4-7c8ad90f8203",levelNr:0,fullStars:!1,completed:!0,attempt:0},{isTutorial:!1,isChallenge:!1,isDebug:!1,levelID:"n004",problemID:"05c4df8b-4f1c-4e0d-a4af-70dca8575161",levelNr:0,fullStars:!1,completed:!0,attempt:0}]},_this.showLevels=function(index){_this.levels.forEach(function(levelBtn){_this.removeChild(levelBtn)}),_this.levels=[];for(var count=0,j=0;j<LevelLoader.levels[index].length;j++)_this.addLevelBtn(count++,LevelLoader.levels[index][j])},_this.addLevelBtn=function(index,id){var x=560+130*Math.floor(index%4),y=430+70*Math.floor(index/4),levelBtn=new TextBox(id,x,y);levelBtn.on("pointerdown",function(){var problemID=LevelLoader.getProblemFromLevel(id),levelInfo=new LevelInfo(id,problemID,-1);levelInfo.isDebug=!0,LevelLoader.requestLevel(levelInfo,function(){MenuSignals.fadeToGame.dispatch(),GameSignals.gotoWorld.dispatch()})}),_this.levels.push(levelBtn),_this.addChild(levelBtn)},_this.toggleAlwaysProgess=function(){PlayerPrefs.autoCraft=!PlayerPrefs.autoCraft,_this.alwaysProgessBtn.cacheAsBitmap=!1,_this.alwaysProgessBtn.text.text="autocraft: "+(PlayerPrefs.autoCraft?"On":"Off"),_this.alwaysProgessBtn.cacheAsBitmap=!0},_this.unlockParts=function(partId){for(PlayerPrefs.partsUnlocked=0,app.unlockManager.reset();0<partId;)partId--,app.unlockManager.unlockNextPart()},_this.show=function(){_this.visible=!0,_this.dropEnabled=!0},_this.hide=function(){_this.visible=!1,_this.dropEnabled=!1},_this.ondragover=function(evt){_this.dropEnabled&&evt.preventDefault()},_this.ondrop=function(evt){var self=_this;if(_this.dropEnabled&&(evt.preventDefault(),evt.dataTransfer.items))for(var _loop_4=function(i){if("file"===evt.dataTransfer.items[i].kind){var file=evt.dataTransfer.items[i].getAsFile(),fr_1=new FileReader;return fr_1.onload=function(){self.receivedValidTextFile(fr_1.result)},fr_1.readAsText(file),{value:void 0}}},i=0;i<evt.dataTransfer.items.length;i++){var state_1=_loop_4(i);if("object"==typeof state_1)return state_1.value}},_this.receivedValidTextFile=function(file){var lvl=new LevelInfo("debug",null,-1);lvl.isDebug=!0,PlayerPrefs.currentLevel=lvl,PlayerPrefs.currentLevelJson=JSON.parse(file),MenuSignals.fadeToGame.dispatch(),setTimeout(function(){return GameSignals.gotoWorld.dispatch()},300)},_this.hide();_this.background=new PIXI.Graphics,_this.background.beginFill(15478622),_this.background.drawRect(0,0,1280,720),_this.background.beginFill(7739183),_this.background.drawRect(0,0,150,720),_this.background.drawRect(1130,0,150,720),_this.background.interactive=!0,_this.addChild(_this.background),_this.closeButton=new TextBox("CLOSE",170,50),_this.closeButton.on("pointerdown",_this.hide),_this.addChild(_this.closeButton);var clearCache=new TextBox("Clear Cache",170,140);clearCache.on("pointerdown",PlayerPrefs.clearAndReload),_this.addChild(clearCache);var getResources=new TextBox("Add Resources",170,220);getResources.on("pointerdown",function(){for(var i=0;i<Constants.Planets.length;i++)app.wallet.add(Constants.Planets[i],50)}),_this.addChild(getResources);["A","B","C","D","E","F","G","H","I","J","K","M","N"].forEach(function(char,index){var x=560+80*Math.floor(index%7),y=250+80*Math.floor(index/7),letterLevels=new TextBox(" "+char+" ",x,y);letterLevels.on("pointerdown",function(){return _this.showLevels(index)}),_this.addChild(letterLevels)}),_this.alwaysProgessBtn=new TextBox("autocraft: Off",170,290),_this.alwaysProgessBtn.on("pointerdown",_this.toggleAlwaysProgess),_this.addChild(_this.alwaysProgessBtn),_this.toggleAlwaysProgess(),_this.toggleAlwaysProgess();["spring","track","drill","foam","short","ears","wings","rocket","boost","xray","tall","heat"].forEach(function(part,index){var x=180+170*Math.floor(index/6),y=360+60*Math.floor(index%6),partBox=new TextBox(part,x,y,45);_this.addChild(partBox),partBox.on("pointerdown",function(){return _this.unlockParts(index)})}),_this.earthButton=new TextBox("Earth",570,70),_this.earthButton.on("pointerdown",function(){return PlayerPrefs.currentPlanet=Constants.Earth}),_this.addChild(_this.earthButton),_this.moonButton=new TextBox("Moon",740,70),_this.moonButton.on("pointerdown",function(){return PlayerPrefs.currentPlanet=Constants.Moon}),_this.addChild(_this.moonButton),_this.marsButton=new TextBox("Mars",920,70),_this.marsButton.on("pointerdown",function(){return PlayerPrefs.currentPlanet=Constants.Mars}),_this.addChild(_this.marsButton),_this.enceladusButton=new TextBox("Enceladus",570,150),_this.enceladusButton.on("pointerdown",function(){return PlayerPrefs.currentPlanet=Constants.Enceladus}),_this.addChild(_this.enceladusButton),_this.bortron7Button=new TextBox("Bortron 7",860,150),_this.bortron7Button.on("pointerdown",function(){return PlayerPrefs.currentPlanet=Constants.Bortron7}),_this.addChild(_this.bortron7Button);var dropText=new PIXI.Text("<Drop level.json here to test>",{fontSize:40,fill:14930133});dropText.x=530,dropText.y=670,dropText.interactive=!0,_this.addChild(dropText);var partBox=new TextBox("[..]",1050,330);return partBox.on("pointerdown",_this.completeAllLevels),_this.addChild(partBox),document.body.ondragover=document.body.ondragenter=_this.ondragover,document.body.ondrop=_this.ondrop,_this}return __extends(DebugMenuView,_super),DebugMenuView}(PIXI.Container),DesktopControls=function(_super){function DesktopControls(armsEnabled){var _this=_super.call(this)||this;return _this.addInetractivity=function(btn,actionName){btn.on("pointerdown",function(){GameInput.enabled&&(app.sound.play("sfx-button-action",{volume:1}),GameInput[actionName]=!0)}),btn.on("pointerup",function(){return GameInput[actionName]=!1}),btn.on("pointerout",function(){return GameInput[actionName]=!1}),btn.on("pointerupoutside",function(){return GameInput[actionName]=!1})},_this.hide=function(){_this.leftBtn.visible=!1,_this.rightBtn.visible=!1,_this.actionBtn.visible=!1,_this.legsImg.visible=!1},_this.showMovementControlls=function(){var pos=_this.leftBtn.y;_this.leftBtn.y+=150,_this.legsImg.y=_this.rightBtn.y=_this.leftBtn.y,_this.leftBtn.visible=!0,_this.rightBtn.visible=!0,_this.legsImg.visible=!0,TweenLite.to(_this.legsImg,.2,{y:pos}),TweenLite.to(_this.leftBtn,.2,{y:pos}),TweenLite.to(_this.rightBtn,.2,{y:pos})},_this.showActionControlls=function(){var pos=_this.actionBtn.y;_this.actionBtn.y+=150,_this.actionBtn.visible=!0,TweenLite.to(_this.actionBtn,.2,{y:pos})},_this.setActionBtnVisible=function(value){_this.actionBtn.visible=value},_this.updateArmState=function(armsEnabled){_this.actionBtn.visible=armsEnabled},_this.resize=function(offset){},_this.onDwellEnter=function(btnName){_this.enterName=btnName,_this.enterTime=Date.now()},_this.onDwellLeave=function(){_this.enterName&&_this.enterTime&&app.analyticsEmitter.dwellTime(AnalyticsUtils.levelID,Date.now()-_this.enterTime,_this.enterName,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},_this.teardown=function(){_this.actionBtn.removeAllListeners(),_this.rightBtn.removeAllListeners(),_this.leftBtn.removeAllListeners()},_this.actionBtn=new ClickSprite(Textures.get("desktopAction"),300,630),_this.addInetractivity(_this.actionBtn,"doAction"),_this.addChild(_this.actionBtn),_this.legsImg=new PIXI.Sprite(Textures.get("desktopLegs")),_this.legsImg.x=620,_this.legsImg.y=630,_this.addChild(_this.legsImg),_this.leftBtn=new ClickSprite(Textures.get("desktopLeft"),700,630),_this.addInetractivity(_this.leftBtn,"goLeft"),_this.addChild(_this.leftBtn),_this.rightBtn=new ClickSprite(Textures.get("desktopRight"),780,630),_this.addInetractivity(_this.rightBtn,"goRight"),_this.addChild(_this.rightBtn),WorldSignals.setArmsBtnState.add(_this.updateArmState),_this.updateArmState(armsEnabled),_this.resize(0),_this.actionBtn.on("pointerover",function(){return _this.onDwellEnter("actionBtn")}),_this.rightBtn.on("pointerover",function(){return _this.onDwellEnter("rightBtn")}),_this.leftBtn.on("pointerover",function(){return _this.onDwellEnter("left")}),_this.actionBtn.on("pointerout",_this.onDwellLeave),_this.rightBtn.on("pointerout",_this.onDwellLeave),_this.leftBtn.on("pointerout",_this.onDwellLeave),_this}return __extends(DesktopControls,_super),DesktopControls}(PIXI.Container),FlashButton=function(_super){function FlashButton(textureName,flashTexture,x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this,textureName,x,y,3)||this;return _this.isGlowOn=!1,_this.flashUpdate=function(){app.lostFocus||(_this.isMouseOver?(_this.flashTexture.alpha=0,_this.isGlowOn=!1):_this.isGlowOn?TweenLite.to(_this.flashTexture,.4,{alpha:.4,onComplete:function(){_this.isGlowOn=!1}}):TweenLite.to(_this.flashTexture,.4,{alpha:1,onComplete:function(){_this.isGlowOn=!0}}))},_this.flashTexture=new PIXI.Sprite(flashTexture),_this.flashTexture.interactive=!1,_this.flashTexture.anchor={x:.5,y:.5},_this.flashTexture.alpha=0,_this.addChild(_this.flashTexture),_this}return __extends(FlashButton,_super),FlashButton.prototype.setFlash=function(newFlash){newFlash?(clearInterval(this.flashInterval),this.flashInterval=setInterval(this.flashUpdate,600)):(clearInterval(this.flashInterval),this.flashTexture.alpha=0,this.isGlowOn=!1)},FlashButton}(Button),GameUI=function(_super){function GameUI(robot,showPartHUD){var _this=_super.call(this)||this;return _this.addGameHUD=function(robot,showPartHUD){var armsEnabled=!0;robot.body&&robot.body.name==Constants.Parts_Body_Short&&(armsEnabled=!1),_this.basePos=new Point(0,0),showPartHUD?(_this.hud=new RobotPartHud(armsEnabled,WorldSignals.exitBtnDown.dispatch),_this.hud.inGame=!0):_this.hud=new MiniHud(WorldSignals.exitBtnDown.dispatch),_this.addChild(_this.hud),_this.hud.enableHud(),_this.controls=Device.isTouchDevice?new MobileControls(armsEnabled):new DesktopControls(armsEnabled),_this.addChild(_this.controls)},_this.setupDebugUI=function(){_this.setSuccessButton=new ClickCont(400,4,100,100,.01,255),_this.addChild(_this.setSuccessButton),_this.setSuccessButton.on("pointerdown",function(){_this.setSuccessButton.interactive=!1,WorldSignals.completeLevel.dispatch()})},_this.addLevelNumber=function(){var levelID=new PIXI.Text(""+PlayerPrefs.currentLevel.levelID,{fill:16777215});levelID.alpha=.5,levelID.x=370,levelID.y=10,_this.addChild(levelID)},_this.getResourceBoxSpine=function(resourcesNr){return _this.resourceBoxHolder.children.filter(function(child){return child instanceof PIXI.spine.Spine})[resourcesNr-1]},_this.playResourceBoxOpenAnim=function(resourcesNr){var boxAnim=_this.getResourceBoxSpine(resourcesNr);boxAnim.state.hasAnimation("HatchAnim")&&boxAnim.state.setAnimation(0,"HatchAnim",!1)},_this.playResourceMoveToBoxAnim=function(resourcesNr,resourceScreenPos,onCompleteCallback){var resourceContainer=new PIXI.Container;resourceContainer.position.set(resourceScreenPos.x,resourceScreenPos.y),_this.addChild(resourceContainer);var particle=new ParticlesView(Particles.get("ResourcePickup"),"PickupGlow");particle.playOnce(),resourceContainer.addChild(particle);var resourceIcon=new PIXI.Sprite(ResourceTextures.resourceForCurrentPlanet());resourceIcon.anchor.x=resourceIcon.anchor.y=.5,resourceContainer.addChild(resourceIcon);var boxPos=_this.getResourceBoxSpine(resourcesNr).position,targetPos=new Point(boxPos.x+_this.resourceBoxHolder.x,boxPos.y+_this.resourceBoxHolder.y),tl=new TimelineLite({onComplete:function(){particle.destroy(),resourceIcon.destroy(),resourceContainer.destroy(),onCompleteCallback()}});tl.to(resourceIcon.scale,.25,{x:1.5,y:1.5,ease:Back.easeOut}),tl.to(resourceContainer,.75,{x:targetPos.x,y:targetPos.y,ease:Power2.easeInOut},.25),tl.to(resourceIcon.scale,.75,{x:.8,y:.8},.25),tl.to(resourceContainer,.25,{alpha:0},.75)},_this.addResourceToBox=function(resourcesNr){var icon=new PIXI.Sprite(ResourceTextures.resourceForCurrentPlanet());icon.scale.x=icon.scale.y=.8,icon.anchor.x=icon.anchor.y=.5,icon.x=100*resourcesNr,icon.y=50,icon.alpha=0,_this.resourceBoxHolder.addChild(icon),TweenLite.to(icon,.3,{alpha:1})},_this.resize=function(offset){_this.controls.resize(offset),TweenLite.killTweensOf(_this.hud),_this.hud.resize(offset,_this.basePos),_this.worldComsMonitor&&(_this.worldComsMonitor.x=Constants.ScreenWidth-app.display.sideOffset-20)},_this.updateStars=function(stars,maxStars){var p=stars/maxStars*310;TweenLite.to(_this.starbar.scale,.1,{x:p}),TweenLite.to(_this.starbarProgress,.1,{x:516+p}),maxStars<=stars&&setTimeout(function(){app.sound.play("sfx-star-complete",{volume:1}),_this.starbarStar.visible=!0},200)},_this.addResourceBGs=function(nrResources){for(var i=1;i<nrResources+1;i++){var resourceIcon=new PIXI.spine.Spine(Animations.get("resourceCollectionBox"));resourceIcon.x=100*i,resourceIcon.y=50,_this.resourceBoxHolder.addChild(resourceIcon)}},_this.onCollectResource=function(resourcesNr,resourceScreenPos){_this.playResourceBoxOpenAnim(resourcesNr),_this.playResourceMoveToBoxAnim(resourcesNr,resourceScreenPos,function(){_this.addResourceToBox(resourcesNr)})},_this.wiggleHomeBtn=function(){var btn=_this.hud.homeBtn;btn&&(btn.setTexture("BuildBtn"),clearInterval(_this.jiggleInterval),_this.jiggleInterval=setInterval(function(){btn.scale.x,btn.scale.y,btn.scale.x=btn.scale.y=1.5,new ButtonJiggle(btn)},1200))},_this.addGameHUD(robot,showPartHUD),_this.scoreCont=new PIXI.Container,_this.scoreCont.x=-150,_this.addChild(_this.scoreCont),_this.resourceBoxHolder=new PIXI.Container,_this.resourceBoxHolder.x=700,_this.addChild(_this.resourceBoxHolder),_this.createStarbar(),_this.createTalkingHead(),_this.updateStars(0,1),_this.slideInHud(),app.options.debug&&(_this.setupDebugUI(),_this.addLevelNumber()),_this.resize(0),_this}return __extends(GameUI,_super),GameUI.prototype.createStarbar=function(){var starbarBack=new PIXI.Sprite(Textures.get("StarBarGameBack"));starbarBack.x=500,starbarBack.y=40,this.scoreCont.addChild(starbarBack),this.starbar=new PIXI.Sprite(Textures.get("StarBarGame")),this.starbar.scale.x=0,this.starbar.x=516,this.starbar.y=46,this.scoreCont.addChild(this.starbar),this.starbarProgress=new PIXI.Sprite(Textures.get("StarBarGameSpot")),this.starbarProgress.anchor.x=.5,this.starbarProgress.x=this.starbar.x,this.starbarProgress.y=34,this.scoreCont.addChild(this.starbarProgress);var starbarStarGrey=new PIXI.Sprite(Textures.get("StarBarGameButtonOff"));starbarStarGrey.x=810,starbarStarGrey.y=12,this.scoreCont.addChild(starbarStarGrey),this.starbarStar=new PIXI.Sprite(Textures.get("StarBarGameButton")),this.starbarStar.x=starbarStarGrey.x,this.starbarStar.y=starbarStarGrey.y,this.starbarStar.visible=!1,this.scoreCont.addChild(this.starbarStar)},GameUI.prototype.createTalkingHead=function(){Device.lowEndDevice||(this.worldComsMonitor=new WorldComsMonitorView("talkingHeadMonitor",1280,15),this.worldComsMonitor.scale.x=this.worldComsMonitor.scale.y=.75,this.addChild(this.worldComsMonitor))},GameUI.prototype.slideInHud=function(){var toPos=this.hud.x;this.hud.x-=120,TweenLite.to(this.hud,.2,{x:toPos,ease:Power2.easeOut,delay:.5})},GameUI.prototype.HideTopUI=function(){this.starbar.visible=!1,this.starbarStar.visible=!1,this.starbarProgress.visible=!1,this.scoreCont.visible=!1,this.hud.visible=!1},GameUI.prototype.teardown=function(){clearInterval(this.jiggleInterval),this.hud.teardown(),this.controls.teardown()},GameUI}(PIXI.Container),LevelButton=function(_super){function LevelButton(id,x,y){var _this=_super.call(this,"levelSelectButtonDisabled",x,y,3)||this;_this.default="levelSelectButtonDisabled",_this.next="levelSelectButtonNext",_this.complete="LevelSelectButtonDone",_this.completeStar="LevelSelectButtonStar",_this.completeYPosOffset=5,_this.updateBtnState=function(btnId,savedLevels){_this.y=_this.defaultYPos,_this.interactive=!0,btnId==savedLevels.length?_this.setNextState():savedLevels[btnId]?(_this.setCompleteState(),savedLevels[btnId].fullStars?(_this.y+=_this.y<0?_this.completeYPosOffset:-_this.completeYPosOffset,_this.setCompleteStarState()):_this.y=_this.defaultYPos):(_this.interactive=!1,_this.setDefaultState())},_this.setDefaultState=function(){_this.setBtnState(_this.default,"#44f9ee","#3966b6")},_this.setNextState=function(){_this.setBtnState(_this.next,"#44f9ee","#3966b6")},_this.setCompleteState=function(){_this.setBtnState(_this.complete,"#ffc577","#fc624d")},_this.setCompleteStarState=function(){_this.setBtnState(_this.completeStar,"#ffc577","#fc624d")},_this.setBtnState=function(textureName,textFill,textStroke){_this.setTexture(textureName),_this.number.style.fill=textFill,_this.number.style.stroke=textStroke},_this.defaultYPos=y;var points=[new PIXI.Point(0,-75),new PIXI.Point(75,0),new PIXI.Point(0,75),new PIXI.Point(-75,0)];return _this.hitArea=new PIXI.Polygon(points),_this.number=new PIXI.Text((id+1).toString(),{fontFamily:"Peralta",fontSize:40,lineJoin:"round"}),_this.number.anchor.x=_this.number.anchor.y=.5,_this.number.style.strokeThickness=8,_this.addChild(_this.number),_this.interactive=!1,_this}return __extends(LevelButton,_super),LevelButton}(Button),MiniHud=function(_super){function MiniHud(onExitCallback){var _this=_super.call(this)||this;return _this.resize=function(offset,basePos){_this.x=app.display.sideOffset+basePos.x+10,_this.y=basePos.y},_this.homeBtn=new Button("homeBtnComponentBar",100,100,3),_this.homeBtn.visible=!1,_this.homeBtn.scale.x=_this.homeBtn.scale.y=1.3,_this.addChild(_this.homeBtn),setTimeout(function(){_this.homeBtn.visible=!0,_this.homeBtn.on("pointerup",onExitCallback)},500),_this}return __extends(MiniHud,_super),MiniHud.prototype.enableHud=function(){},MiniHud.prototype.disableHud=function(){},MiniHud.prototype.teardown=function(){},MiniHud}(PIXI.Container),MobileControls=function(_super){function MobileControls(armsEnabled){var _this=_super.call(this)||this;_this.hide=function(){_this.forceBtnUp(),_this.leftBtn.visible=!1,_this.rightBtn.visible=!1,_this.actionBtn.visible=!1},_this.showMovementControlls=function(){var pos=_this.leftBtn.y;_this.leftBtn.y+=150,_this.rightBtn.y+=150,_this.leftBtn.visible=!0,_this.rightBtn.visible=!0,TweenLite.to(_this.leftBtn,.2,{y:pos}),TweenLite.to(_this.rightBtn,.2,{y:pos})},_this.showActionControlls=function(){var pos=_this.actionBtn.y;_this.actionBtn.y+=150,_this.actionBtn.visible=!0,TweenLite.to(_this.actionBtn,.2,{y:pos})},_this.setActionBtnVisible=function(value){_this.actionBtn.visible=value},_this.resize=function(offset){_this.leftBtn.x=200+app.display.sideOffset,_this.rightBtn.x=350+app.display.sideOffset,_this.actionBtn.x=1280-app.display.sideOffset-100,_this.forceBtnUp()},_this.updateArmState=function(armsEnabled){_this.actionBtn.visible=armsEnabled},_this.forceBtnUp=function(){_this.leftBtn.onButtonUp(),_this.rightBtn.onButtonUp(),_this.actionBtn.onButtonUp()},_this.teardown=function(){};var leftBtn=new Button("arrowBtn",300,650);leftBtn.on("buttondown",function(){GameInput.enabled&&(app.sound.play("sfx-button-leftright",{volume:1}),GameInput.goLeft=!0)}),leftBtn.on("buttonup",function(){GameInput.enabled&&(GameInput.goLeft=!1)}),_this.addChild(leftBtn),_this.leftBtn=leftBtn;var rightBtn=new Button("arrowBtn",480,650);return rightBtn.on("buttondown",function(){GameInput.enabled&&(app.sound.play("sfx-button-leftright",{volume:1}),GameInput.goRight=!0)}),rightBtn.on("buttonup",function(){GameInput.enabled&&(GameInput.goRight=!1)}),rightBtn.scale.x=-1,_this.addChild(rightBtn),_this.rightBtn=rightBtn,_this.actionBtn=new Button("actionBtn",600,650),_this.actionBtn.on("buttondown",function(){GameInput.enabled&&(app.sound.play("sfx-button-action",{volume:1}),GameInput.doAction=!0)}),_this.actionBtn.on("buttonup",function(){GameInput.enabled&&(GameInput.doAction=!1)}),_this.addChild(_this.actionBtn),WorldSignals.setArmsBtnState.add(_this.updateArmState),_this.updateArmState(armsEnabled),_this.resize(0),_this}return __extends(MobileControls,_super),MobileControls}(PIXI.Container),PartDescriptions=function(){function PartDescriptions(){this.partDescriptions=[],this.partDescriptions.push(new PartDescriptionData(Constants.Parts_Wheels,"Wheels","Fast, but only on flat ground"),new PartDescriptionData(Constants.Parts_Tracks,"Treads","Slow, but can handle rough ground"),new PartDescriptionData(Constants.Parts_Springs,"Springs","Fast, Bounces over obstacles"),new PartDescriptionData(Constants.Parts_Rocket,"Rocket Legs","Slow, but jumps up high ledges"),new PartDescriptionData(Constants.Parts_Pincer,"Pincers","Grab parts in gaps"),new PartDescriptionData(Constants.Parts_Wings,"Wings","After jumping, glide through the air"),new PartDescriptionData(Constants.Parts_Booster,"Booster Arms","Boost forward quickly with wheels"),new PartDescriptionData(Constants.Parts_Drill,"Drill","Drill through cracked ground"),new PartDescriptionData(Constants.Parts_Foamer,"Foamer","Shoot foam to create platforms"),new PartDescriptionData(Constants.Parts_Body_Short,"Short Body","Move through narrow passages"),new PartDescriptionData(Constants.Parts_Body_Med,"Normal Body"," Default height"),new PartDescriptionData(Constants.Parts_Body_Tall,"Tall Body","Can reach parts higher up"),new PartDescriptionData(Constants.Parts_Head_Normal,"Normal Head","Default head"),new PartDescriptionData(Constants.Parts_Head_SuperEars,"Super Ears","Hear hidden sonic resources"),new PartDescriptionData(Constants.Parts_Head_HeatVision,"Heat Vision","See hidden hot resources"),new PartDescriptionData(Constants.Parts_Head_XrayVision,"X-Ray Head","See more destroyable ground"))}return PartDescriptions.prototype.getPartDescInfo=function(robotPart){if(robotPart){var startBtnIndex=this.partDescriptions.map(function(e){return e.partName}).indexOf(robotPart);return[this.partDescriptions[startBtnIndex].title,this.partDescriptions[startBtnIndex].description]}},PartDescriptions}(),PartDescriptionData=function(){function PartDescriptionData(partName,title,description){this._partName=partName,this._title=title,this._description=description}return Object.defineProperty(PartDescriptionData.prototype,"partName",{get:function(){return this._partName},enumerable:!1,configurable:!0}),Object.defineProperty(PartDescriptionData.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(PartDescriptionData.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),PartDescriptionData}(),ParticlesView=function(_super){function ParticlesView(configFile,textureName){var _this=_super.call(this)||this,images=[];return"string"==typeof textureName?images.push(Textures.get(textureName)):Array.isArray(textureName)?textureName.forEach(function(texName){images.push(Textures.get(texName))}):console.error("Unsuported textureName: "+textureName),_this.emitter=new PIXI.particles.Emitter(_this,images,configFile),_this}return __extends(ParticlesView,_super),ParticlesView.prototype.enable=function(){this.emitter.emit=!0},ParticlesView.prototype.disable=function(){this.emitter.emit=!1},ParticlesView.prototype.playOnce=function(){this.emitter.playOnce()},ParticlesView.prototype.update=function(delta){this.emitter.update(delta/1e3)},ParticlesView}(PIXI.Container),ProgressBar=function(_super){function ProgressBar(barViewTextureName,fillingBarViewTextureName,nobImage){void 0===nobImage&&(nobImage=null);var _this=_super.call(this)||this;return _this.verticalMargin=20,_this.maxAnim=1.2,_this.setProgress=function(progress,max,xEase,yEase){void 0===xEase&&(xEase=Power0.easeNone),void 0===yEase&&(yEase=null);var animationTime=this.getAnimationTime(progress,max);TweenLite.to(this.barMask.scale,animationTime,{x:progress/max*1,ease:xEase}),this.nobView&&this.animateNob(progress,max,xEase,yEase)},_this.animateNob=function(progress,max,xEase,yEase){var animationTime=progress/max*_this.maxAnim,maxXValue=_this.backgroundBarView.width;TweenLite.to(_this.nobView,animationTime,{x:progress/max*maxXValue,ease:xEase,onUpdate:_this.updateYNob,onUpdateParams:["{self}",animationTime,maxXValue,yEase]},0)},_this.updateYNob=function(tween,animationTime,maxLength,ease){var progress=tween.progress().toFixed(2),x=tween.target.x,y=null!=ease?ease.compute(x):tween.target.y;tween.target.y=y,.99<=progress&&TweenLite.killTweensOf(tween.target)},_this.createBarBackground(barViewTextureName),_this.createBarFilling(fillingBarViewTextureName),_this.nobView=nobImage,_this.addChild(_this.nobView),_this.createMask(),_this.resetProgress(),_this}return __extends(ProgressBar,_super),Object.defineProperty(ProgressBar.prototype,"yOffset",{get:function(){return this.verticalMargin},enumerable:!1,configurable:!0}),Object.defineProperty(ProgressBar.prototype,"maxValue",{get:function(){return this.fillingBarView.width},enumerable:!1,configurable:!0}),Object.defineProperty(ProgressBar.prototype,"factor",{get:function(){return 10},enumerable:!1,configurable:!0}),ProgressBar.prototype.createBarBackground=function(barViewTextureName){this.backgroundBarView=new PIXI.Sprite(Textures.get(barViewTextureName)),this.addChild(this.backgroundBarView)},ProgressBar.prototype.createBarFilling=function(fillingBarViewTextureName){this.fillingBarView=new PIXI.Sprite(Textures.get(fillingBarViewTextureName)),this.addChild(this.fillingBarView)},ProgressBar.prototype.createMask=function(){this.barMask=new PIXI.Graphics,this.barMask.beginFill(16777215),this.barMask.drawRect(0,0,this.fillingBarView.width,this.fillingBarView.height),this.barMask.endFill(),this.barMask.scale.y=1,this.barMask.scale.x=0,this.fillingBarView.mask=this.barMask,this.addChild(this.barMask)},ProgressBar.prototype.resetProgress=function(){this.nobView&&(this.nobView.y=this.verticalMargin,this.nobView.x=0),this.barMask.scale.x=0},ProgressBar.prototype.getAnimationTime=function(progress,max){return 0==max?0:progress/max*this.maxAnim},ProgressBar}(PIXI.Container),ResourceIcon=function(_super){function ResourceIcon(index,amount,x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this)||this,resourceTexture=Constants.Resources[index]+"_Icon",icon=new PIXI.Sprite(Textures.get(resourceTexture));icon.scale.x=icon.scale.y=.95,icon.x=x,icon.y=y-5,_this.addChild(icon);var textStyle=new PIXI.TextStyle({fontFamily:"Wellfleet",fontSize:40,fill:"#5cb3c8"});return _this.count=new PIXI.Text(amount.toString(),textStyle),_this.count.anchor.x=.5,_this.count.x=icon.x+40,_this.count.y=icon.y+84,_this.addChild(_this.count),_this}return __extends(ResourceIcon,_super),ResourceIcon.prototype.setAmount=function(amount){this.count.text=amount.toString()},ResourceIcon}(PIXI.Container),RewardResourceView=function(_super){function RewardResourceView(planetName,amount,isActivated){var _this=_super.call(this)||this;return _this.createBackground(),isActivated?_this.createResourceImage(RewardResourceView.rewardTextureNames[planetName]):_this.createShadowResourceImage(RewardResourceView.shadowTextureNames[planetName]),_this.createText(),_this.setAmount(amount),_this}return __extends(RewardResourceView,_super),RewardResourceView.prototype.createBackground=function(){var icon=new PIXI.Sprite(Textures.get("ResourceRewardBox"));icon.anchor.x=icon.anchor.y=.5,this.addChild(icon)},RewardResourceView.prototype.createResourceImage=function(textureName){this.resourceSprite=new PIXI.Sprite(Textures.get(textureName)),this.resourceSprite.anchor.x=this.resourceSprite.anchor.y=.5,this.resourceSprite.y=-20,this.addChild(this.resourceSprite)},RewardResourceView.prototype.createShadowResourceImage=function(textureName){var icon=new PIXI.Sprite(Textures.get(textureName));icon.anchor.x=icon.anchor.y=.5,icon.y=-20,this.addChild(icon)},RewardResourceView.prototype.createText=function(){var textStyle=new PIXI.TextStyle({fontFamily:"Wellfleet",fontSize:36,fill:"#60B3C7"});this.text=new PIXI.Text("0",textStyle),this.text.anchor.x=this.text.anchor.y=.5,this.text.y=34,this.addChild(this.text)},RewardResourceView.prototype.setAmount=function(amount){this.text.text=amount.toString()},RewardResourceView.prototype.animateCount=function(startCount,number){var _this=this;if(void 0===startCount&&(startCount=0),this.resourceSprite)for(var timeline=new TimelineLite,_loop_5=function(i){var time=.2*1.75*i;timeline.fromTo(this_1.resourceSprite.scale,.2,{x:1,y:1},{x:1.3,y:1.3,ease:Power4.easeOut,yoyo:!0,repeat:1},time).add(function(){_this.setAmount(startCount+i+1)},time)},this_1=this,i=0;i<number;++i)_loop_5(i)},RewardResourceView.rewardTextureNames={Earth:"RewardBolt",Moon:"RewardNut",Mars:"RewardCog",Enceladus:"RewardSpring",Bortron7:"RewardChip"},RewardResourceView.shadowTextureNames={Earth:"BoltShadow",Moon:"NutShadow",Mars:"CogShadow",Enceladus:"SpringShadow",Bortron7:"ChipShadow"},RewardResourceView}(PIXI.Container),HudArmsMenu=function(_super){function HudArmsMenu(){var _this=_super.call(this,Constants.Arms)||this,btnData=[new ButtonInfo("pincerBtn","lockedPincerBtn",Constants.Parts_Pincer),new ButtonInfo("drillBtn","lockedDrillBtn",Constants.Parts_Drill),new ButtonInfo("foamBtn","lockedFoamBtn",Constants.Parts_Foamer),new ButtonInfo("wingsBtn","lockedWingsBtn",Constants.Parts_Wings),new ButtonInfo("boosterBtn","lockedBoosterBtn",Constants.Parts_Booster)];return _this.addButtons(btnData,WorldSignals.trySelectArms),WorldSignals.selectArms.add(_this.updateGlow),_this.setupGlowAndHighlight("armsBtnGlow"),_this.updateGlow(PlayerPrefs.robotArms),_this}return __extends(HudArmsMenu,_super),HudArmsMenu}(HudBaseMenu),HudBodyMenu=function(_super){function HudBodyMenu(){var _this=_super.call(this,Constants.Body)||this,btnData=[new ButtonInfo("shortBodyBtn","lockedShortBodyBtn",Constants.Parts_Body_Short),new ButtonInfo("medBodyBtn","lockedMedBodyBtn",Constants.Parts_Body_Med),new ButtonInfo("tallBodyBtn","lockedTallBodyBtn",Constants.Parts_Body_Tall)];return _this.addButtons(btnData,WorldSignals.trySelectBody),WorldSignals.selectBody.add(_this.updateGlow),_this.setupGlowAndHighlight("bodyBtnGlow"),_this.updateGlow(PlayerPrefs.robotBody),_this}return __extends(HudBodyMenu,_super),HudBodyMenu}(HudBaseMenu),HudHeadMenu=function(_super){function HudHeadMenu(){var _this=_super.call(this,Constants.Head)||this,headMenuData=[new ButtonInfo("normalHeadBtn","lockedNormalHeadBtn",Constants.Parts_Head_Normal),new ButtonInfo("superEarsBtn","lockedSuperEarsBtn",Constants.Parts_Head_SuperEars),new ButtonInfo("xrayVisionBtn","lockedXrayVisionBtn",Constants.Parts_Head_XrayVision),new ButtonInfo("heatVisionBtn","lockedHeatVisionBtn",Constants.Parts_Head_HeatVision)];return _this.addButtons(headMenuData,WorldSignals.trySelectHead),WorldSignals.selectHead.add(_this.updateGlow),_this.setupGlowAndHighlight("headBtnGlow"),_this.updateGlow(PlayerPrefs.robotHead),_this}return __extends(HudHeadMenu,_super),HudHeadMenu}(HudBaseMenu),HudLegsMenu=function(_super){function HudLegsMenu(){var _this=_super.call(this,Constants.Legs)||this,btnData=[new ButtonInfo("wheelsBtn","lockedWheelsBtn",Constants.Parts_Wheels),new ButtonInfo("springsBtn","lockedSpringsBtn",Constants.Parts_Springs),new ButtonInfo("tracksBtn","lockedTracksBtn",Constants.Parts_Tracks),new ButtonInfo("rocketBtn","lockedRocketBtn",Constants.Parts_Rocket)];return _this.addButtons(btnData,WorldSignals.trySelectLegs),WorldSignals.selectLegs.add(_this.updateGlow),_this.setupGlowAndHighlight("legsBtnGlow"),_this.updateGlow(PlayerPrefs.robotLegs),_this}return __extends(HudLegsMenu,_super),HudLegsMenu}(HudBaseMenu),HudPartBtn=function(_super){function HudPartBtn(btnInfo,pos){var _this=_super.call(this,btnInfo.texture,pos.x,pos.y,3)||this;return _this.anchor.x=_this.anchor.y=0,_this._partName=btnInfo.robotPart,_this}return __extends(HudPartBtn,_super),Object.defineProperty(HudPartBtn.prototype,"partName",{get:function(){return this._partName},enumerable:!1,configurable:!0}),HudPartBtn}(Button),LockedHubPartBtn=function(_super){function LockedHubPartBtn(btnInfo,pos){var _this=_super.call(this,Textures.get(btnInfo.lockedTexture))||this;return _this.x=pos.x,_this.y=pos.y,_this.anchor.x=_this.anchor.y=0,_this._partName=btnInfo.robotPart,_this}return __extends(LockedHubPartBtn,_super),Object.defineProperty(LockedHubPartBtn.prototype,"partName",{get:function(){return this._partName},enumerable:!1,configurable:!0}),LockedHubPartBtn}(PIXI.Sprite),RobotPartHud=function(_super){function RobotPartHud(armsEnabled,onExitCallback){void 0===armsEnabled&&(armsEnabled=!1);var _this=_super.call(this)||this;return _this.inGame=!1,_this.playButtonSFX=function(sfx){app.sound.play(sfx)},_this.enableHud=function(){_this.createMenuLayout(),_this.homeBtn.interactive=!0,_this.legsBtn.interactive=!0,_this.armsBtn.interactive=_this.isArmEnabled,_this.headBtn.interactive=!0,_this.bodyBtn.interactive=!0},_this.disableHud=function(){_this.homeBtn&&(_this.homeBtn.interactive=!1,_this.legsBtn.interactive=!1,_this.armsBtn.interactive=!1,_this.headBtn.interactive=!1,_this.bodyBtn.interactive=!1)},_this.resize=function(offset,basePos){_this.x=app.display.sideOffset+basePos.x+10,_this.y=basePos.y},_this.exitScreen=function(){WorldSignals.showEditPartDesc.dispatch(!1),_this.hideCurrent(_this.onExitCallBack)},_this.hideCurrent=function(callback){void 0===callback&&(callback=function(){}),_this.currentMenu&&_this.currentButton?_this.hideAnim=TweenLite.to(_this.currentMenu,.3,{x:-40,onComplete:function(){_this.currentButton.alpha=0,_this.currentMenu=null,_this.currentButton=null,WorldSignals.showEditPartDesc.dispatch(!1),_this.hideAnim=null,callback()}}):callback()},_this.showMenu=function(menuType){_this.buttonflashAnim&&_this.buttonflashAnim.kill();var now=(new Date).getTime();if(!((now-_this.lastTimeStamp)/1300<.1)){var menu,button,equipedPart;if(_this.lastTimeStamp=now,menuType==Constants.Head)menu=_this.headMenu,button=_this.headBtn,equipedPart=PlayerPrefs.robotHead;else if(menuType==Constants.Body)menu=_this.bodyMenu,button=_this.bodyBtn,equipedPart=PlayerPrefs.robotBody;else if(menuType==Constants.Arms)menu=_this.armsMenu,button=_this.armsBtn,equipedPart=PlayerPrefs.robotArms;else{if(menuType!=Constants.Legs)return void console.error("no menu for type:",menuType);menu=_this.legsMenu,button=_this.legsBtn,equipedPart=PlayerPrefs.robotLegs}if(_this.currentMenu&&_this.currentButton){if(_this.currentMenu==menu)return _this.hideCurrent(),void WorldSignals.setSelectedPart.dispatch("");_this.currentMenu.visible=!1,_this.currentButton.alpha=0}_this.currentButton=button,_this.currentMenu=menu,_this.currentMenu&&_this.currentButton?(WorldSignals.setSelectedPart.dispatch(equipedPart),WorldSignals.updateSelectedColour.dispatch(equipedPart),WorldSignals.updateDescription.dispatch(equipedPart),WorldSignals.showEditPartDesc.dispatch(!0),_this.currentMenu.x=0,TweenLite.to(_this.currentMenu,.3,{x:135}),_this.currentMenu.visible=!0,_this.currentButton.alpha=1):console.error("tried to open menu, but failed: "+menuType),app.analyticsEmitter.ClickedPartCategory(AnalyticsUtils.levelID,AnalyticsUtils.clickPos,menuType,AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)}},_this.setArmsBtnState=function(state){(_this.armsBtn.interactive=state)?(_this.armsBtn.alpha=0,_this.armsBtn.texture=Textures.get("armsBtn")):(_this.armsBtn.alpha=1,_this.armsBtn.texture=Textures.get("armsDisabledBtn"))},_this.teardown=function(){WorldSignals.setArmsBtnState.remove(_this.setArmsBtnState),_this.destroyMenuLayout()},_this.openMenuAndShow=function(menuType,highlighPart){_this.currentMenu&&_this.currentMenu.menuType==menuType||_this.showMenu(menuType),_this.currentMenu&&_this.currentMenu.updateHighlight(highlighPart)},_this.onDwellEnter=function(){_this.enterTime=Date.now()},_this.onDwellLeave=function(){_this.enterTime&&app.analyticsEmitter.dwellTime(AnalyticsUtils.levelID,Date.now()-_this.enterTime,"homeBtn",AnalyticsUtils.stageName,AnalyticsUtils.isChallenge)},_this.showPartScaffold=function(obstacleName){"CreviceCollect"==obstacleName?_this.openMenuAndShow(Constants.Arms,Constants.Parts_Pincer):"RockyGround"==obstacleName?_this.openMenuAndShow(Constants.Legs,Constants.Parts_Tracks):"Ledge1or2Tiles"==obstacleName?_this.openMenuAndShow(Constants.Legs,Constants.Parts_Springs):"Ledge3or4Tiles"==obstacleName?7<PlayerPrefs.partsUnlocked?_this.openMenuAndShow(Constants.Legs,Constants.Parts_Rocket):_this.openMenuAndShow(Constants.Arms,Constants.Parts_Foamer):"Gap1Tile"==obstacleName?_this.openMenuAndShow(Constants.Legs,Constants.Parts_Springs):"Gap2Tile"==obstacleName?_this.openMenuAndShow(Constants.Arms,Constants.Parts_Wings):"DrillObstacle"==obstacleName?_this.openMenuAndShow(Constants.Arms,Constants.Parts_Drill):"ShortBody"==obstacleName?_this.openMenuAndShow(Constants.Body,Constants.Parts_Body_Short):"FoamObstacle"==obstacleName?_this.openMenuAndShow(Constants.Arms,Constants.Parts_Foamer):"TallBody"==obstacleName?_this.openMenuAndShow(Constants.Body,Constants.Parts_Body_Tall):"EarObstacle"==obstacleName?_this.openMenuAndShow(Constants.Head,Constants.Parts_Head_SuperEars):"HeatObstacle"==obstacleName?_this.openMenuAndShow(Constants.Head,Constants.Parts_Head_HeatVision):"XrayObstacle"==obstacleName?(_this.openMenuAndShow(Constants.Head,Constants.Parts_Head_XrayVision),PlayerPrefs.robotHead!=Constants.Parts_Head_XrayVision?_this.openMenuAndShow(Constants.Head,Constants.Parts_Head_XrayVision):PlayerPrefs.robotArms!=Constants.Parts_Drill&&_this.openMenuAndShow(Constants.Arms,Constants.Parts_Drill)):"Booster"==obstacleName?PlayerPrefs.robotArms!=Constants.Parts_Booster?_this.openMenuAndShow(Constants.Arms,Constants.Parts_Booster):PlayerPrefs.robotLegs!=Constants.Parts_Tracks&&_this.openMenuAndShow(Constants.Legs,Constants.Parts_Tracks):console.error("tried to show scaffold for",obstacleName,"but failed.")},_this.flashMenuButtons=function(menuTypes){var buttons=[];menuTypes.forEach(function(type){type==Constants.Head?buttons.push(_this.headBtn):type==Constants.Body?buttons.push(_this.bodyBtn):type==Constants.Arms?buttons.push(_this.armsBtn):type==Constants.Legs&&buttons.push(_this.legsBtn)}),_this.buttonflashAnim=new TimelineMax({repeat:5,onComplete:function(){buttons.forEach(function(button){button.alpha=0})}}),_this.buttonflashAnim.to(buttons,.4,{alpha:1}),_this.buttonflashAnim.to(buttons,.4,{alpha:0})},_this.onExitCallBack=onExitCallback,_this.isArmEnabled=armsEnabled,WorldSignals.flashMenuButtons.add(_this.flashMenuButtons),_this}return __extends(RobotPartHud,_super),RobotPartHud.prototype.createMenuLayout=function(){var _this=this;this.headMenu=new HudHeadMenu,this.addChild(this.headMenu),this.bodyMenu=new HudBodyMenu,this.addChild(this.bodyMenu),this.armsMenu=new HudArmsMenu,this.addChild(this.armsMenu),this.legsMenu=new HudLegsMenu,this.addChild(this.legsMenu),this.mainMenu=new PIXI.Sprite(Textures.get("componentBar")),this.mainMenu.x=-10,this.addChild(this.mainMenu),this.homeBtn=new Button("homeBtnComponentBar",20,37,3),this.homeBtn.anchor.x=this.homeBtn.anchor.y=0,this.homeBtn.on("pointerover",this.onDwellEnter),this.homeBtn.on("pointerout",this.onDwellLeave),this.mainMenu.addChild(this.homeBtn),setTimeout(function(){_this.homeBtn.on("pointerdown",function(){return _this.exitScreen()})},500),this.legsBtn=new ClickSprite(Textures.get("legsBtn"),20,488),this.legsBtn.alpha=0,this.legsBtn.on("pointerdown",function(){_this.showMenu(Constants.Legs),_this.playButtonSFX("sfx-button-2"),app.voPlayer.play("select-legs"),WorldSignals.openLegsMenu.dispatch()}),this.mainMenu.addChild(this.legsBtn),this.armsBtn=new ClickSprite(Textures.get("armsBtn"),20,265),this.armsBtn.alpha=0,this.armsBtn.on("pointerdown",function(){_this.showMenu(Constants.Arms),_this.playButtonSFX("sfx-button-2"),app.voPlayer.play("select-arms")}),this.mainMenu.addChild(this.armsBtn),this.headBtn=new ClickSprite(Textures.get("headBtn"),20,153),this.headBtn.alpha=0,this.headBtn.on("pointerdown",function(){_this.showMenu(Constants.Head),_this.playButtonSFX("sfx-button-2"),app.voPlayer.play("select-head")}),this.mainMenu.addChild(this.headBtn),this.bodyBtn=new ClickSprite(Textures.get("bodyBtn"),20,376),this.bodyBtn.alpha=0,this.bodyBtn.on("pointerdown",function(){_this.showMenu(Constants.Body),_this.playButtonSFX("sfx-button-2"),app.voPlayer.play("select-bodies")}),this.mainMenu.addChild(this.bodyBtn),this.armsMenu.visible=!1,this.legsMenu.visible=!1,this.headMenu.visible=!1,this.bodyMenu.visible=!1,this.disableHud(),this.setArmsBtnState(this.isArmEnabled),WorldSignals.setArmsBtnState.add(this.setArmsBtnState),WorldSignals.showPartScaffold.add(this.showPartScaffold),WorldSignals.setSelectedPart.dispatch(""),this.inGame&&WorldSignals.closeHUDTray.add(this.hideCurrent)},RobotPartHud.prototype.destroyMenuLayout=function(){this.mainMenu&&(this.homeBtn.removeAllListeners(),this.legsBtn.removeAllListeners(),this.armsBtn.removeAllListeners(),this.bodyBtn.removeAllListeners(),this.bodyBtn.off("pointerdown"),this.headMenu.teardown(),this.bodyMenu.teardown(),this.armsMenu.teardown(),this.legsMenu.teardown())},RobotPartHud}(PIXI.Container),SinEase=function(){function SinEase(yOffset,maxValue,factor){void 0===yOffset&&(yOffset=0),void 0===maxValue&&(maxValue=1),void 0===factor&&(factor=1),this.yOffset=0,this.maxValue=1,this.yOffset=yOffset,this.maxValue=maxValue,this.factor=factor}return SinEase.prototype.compute=function(x){var tempx=x*Math.PI/this.maxValue,y=Math.sin(tempx);return this.yOffset-y*this.factor},SinEase}(),ZeroEase=function(){function ZeroEase(){}return ZeroEase.prototype.compute=function(x){return 0},ZeroEase}(),Smoke=function(_super){function Smoke(x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this,Textures.get("smoke"))||this;return _this.update=function(){app.lostFocus||(_this.scale.x=_this.scale.y+=.01,_this.alpha-=.01,_this.x+=.3,_this.y-=.8,_this.alpha<.1&&(_this.parent.removeChild(_this),clearInterval(_this.updateInterval)))},_this.anchor.x=_this.anchor.y=.5,_this.rotation=360*Math.random(),_this.x=x,_this.y=y,_this.updateInterval=setInterval(_this.update,16),_this.scale.x=_this.scale.y=.1,_this.alpha=1,_this}return __extends(Smoke,_super),Smoke}(PIXI.Sprite),StarBurstAnim=function(_super){function StarBurstAnim(angle,radius){var _this=_super.call(this,Textures.get("UnlockStar"))||this;return _this.progress=0,_this.lifeTime=500,_this.update=function(){if(!app.lostFocus){_this.progress+=app.time.delta;var p=_this.progress/_this.lifeTime;_this.y+=.1,_this.scale.x=_this.scale.y=MathUtils.lerp(1,1.5,p),_this.alpha=MathUtils.lerp(1,0,p),1<p&&(clearInterval(_this.updateInterval),_this.parent.removeChild(_this))}},_this.blendMode=PIXI.BLEND_MODES.ADD,_this.anchor.x=_this.anchor.y=.5,_this.x=Math.cos(360*angle)*radius,_this.y=Math.sin(360*angle)*radius,_this.updateInterval=setInterval(_this.update,16),_this}return __extends(StarBurstAnim,_super),StarBurstAnim}(PIXI.Sprite),TalkingHeadView=function(_super){function TalkingHeadView(animationId){var _this=_super.call(this)||this;return _this.visible=!1,_this.createHeadView(animationId),_this.setupMix(),_this}return __extends(TalkingHeadView,_super),TalkingHeadView.prototype.loadSilences=function(){this.silences=this.voStep.silences},TalkingHeadView.prototype.createHeadView=function(animationId){this.headSpine=new PIXI.spine.Spine(Animations.get(animationId)),this.addChild(this.headSpine)},TalkingHeadView.prototype.setupMix=function(){this.headSpine.stateData.setMix("ScreenMoveOn","Idle",.2),this.headSpine.stateData.setMix("Idle","ScreenMoveOff",.2),this.headSpine.stateData.setMix("Talk","Idle",.2),this.headSpine.stateData.setMix("Idle","Talk",.2)},TalkingHeadView.prototype.startTalking=function(){this.headSpine.state.setAnimation(1,"Talk",!0)},TalkingHeadView.prototype.stopTalking=function(){this.headSpine.state.setAnimation(1,"Idle",!0)},TalkingHeadView.prototype.animatePlayVO=function(){var _this=this;this.timeline=[],this.timeline.push(function(){return _this.show()}),this.timeline.push(500),this.timeline.push(function(){return _this.startTalking()}),this.timeline.push(this.voStep.voId),this.timeline.push(function(){return _this.stopTalking()}),this.timeline.push(1e3),this.timeline.push(function(){return _this.hide()}),this.playVO(this.timeline);this.animationTimeline=new TimelineLite,this.silences.forEach(function(silence){_this.animationTimeline.add(function(){_this.stopTalking()},silence.start+.5),_this.animationTimeline.add(function(){_this.startTalking()},silence.end+.5)})},TalkingHeadView.prototype.playVO=function(timeline){app.voPlayer.play(timeline,null,null)},TalkingHeadView.prototype.noTalkingPlayVO=function(voId){this.setVOStep(voId),this.timeline=[],this.timeline.push(this.voStep.voId),this.playVO(this.timeline)},TalkingHeadView.prototype.setVOStep=function(voId){this.voStep=new VoStep(voId)},TalkingHeadView.prototype.stopVO=function(){app.voPlayer.stop(),this.animationTimeline.kill(),this.stopTalking()},TalkingHeadView.prototype.show=function(){this.visible=!0,this.headSpine.state.setAnimation(0,"ScreenMoveOn",!1)},TalkingHeadView.prototype.hide=function(){this.headSpine.state.setAnimation(0,"ScreenMoveOff",!1)},TalkingHeadView}(PIXI.Container),TextBox=function(_super){function TextBox(_txt,x,y,fontSize){void 0===fontSize&&(fontSize=55);var _this=_super.call(this)||this;return _this.defaultFont={fontSize:55,fill:14930133},_this._calculateCachedBounds=function(){return _this.bg.getBounds()},_this.x=x,_this.y=y,_this.defaultFont.fontSize=fontSize,_this.text=new PIXI.Text(_txt,_this.defaultFont),_this.bg=new PIXI.Graphics,_this.bg.beginFill(7739183),_this.bg.drawRect(0,0,_this.text.width,_this.text.height),_this.addChild(_this.bg),_this.addChild(_this.text),_this.interactive=!0,_this.cacheAsBitmap=!0,_this}return __extends(TextBox,_super),TextBox}(PIXI.Container),UnlockPartNoMore=function(_super){function UnlockPartNoMore(x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this)||this;_this.x=x,_this.y=y;var bg=new PIXI.Sprite(Textures.get("square"));bg.tint=11711154,bg.scale.x=5.4,bg.scale.y=1.5,_this.addChild(bg);var partName=new PIXI.Text("All parts unlocked :)",{fontSize:30,fill:"#ffffff"});return partName.x=90,partName.y=55,_this.addChild(partName),_this}return __extends(UnlockPartNoMore,_super),UnlockPartNoMore}(PIXI.Container),UnlockSkinBox=function(_super){function UnlockSkinBox(skin,listIndex,callback){var _this=_super.call(this,listIndex,callback)||this;_this.updateCanBuy=function(){_this.craftOrMissionBtn&&(_this.craftOrMissionBtn.removeAllListeners(),_this.removeChild(_this.craftOrMissionBtn));var cost=_this.skin.cost;_this.craftingCost.update(cost),_this.bought||(app.wallet.canBuy(cost)?_this.addCraftBtn(_this.skin.colour):1<PlayerPrefs.levels.length&&_this.addMissionBtn(cost))},_this.addCraftBtn=function(colour){_this.craftOrMissionBtn=new Button("PaintBtn"+colour,525,84,3),_this.craftOrMissionBtn.on("pointerdown",_this.onCraftSkin),_this.addChild(_this.craftOrMissionBtn)},_this.onCraftSkin=function(){_this.bought=!0,_this.craftOrMissionBtn.interactive=!1,_this.craftingCallback(_this.skin,_this.listIndex)},_this.jiggleBtn=function(){_this.craftOrMissionBtn&&new ButtonJiggle(_this.craftOrMissionBtn)};var bgTexture="PaintBox"+(_this.skin=skin).colour,iconTexture=skin.partName+"_"+skin.colour+"_Icon";_this.setImages(bgTexture,iconTexture,10);var title=Constants.PartTitles[skin.partName],description=Constants.PartDescription_Short[skin.partName],textColour=Constants.Colours[skin.colour];return _this.setText(title,description,textColour),_this.setCost(skin.cost),_this.updateCanBuy(),_this.jiggleBtn(),_this}return __extends(UnlockSkinBox,_super),UnlockSkinBox}(BuyBox),WorldComsMonitorView=function(_super){function WorldComsMonitorView(animationId,x,y){void 0===x&&(x=0),void 0===y&&(y=0);var _this=_super.call(this)||this;return _this.show=function(){_this.hideTL.stop(),_this.showTL.invalidate().restart()},_this.hide=function(){_this.showTL.stop(),_this.hideTL.invalidate().restart()},_this.startTalking=function(){_this.jet.state.setAnimation(0,"Talk",!0),_this.sean.state.setAnimation(0,"Talk",!0)},_this.stopTalking=function(){_this.jet.state.setAnimation(0,"Idle",!0),_this.sean.state.setAnimation(0,"Idle",!0)},_this.setCharacter=function(char){_this.jet.visible="Jet"==char,_this.sean.visible="Jet"!=char,_this.currentChar!=char&&(_this.currentChar=char,clearTimeout(_this.noiseTimeout1),clearTimeout(_this.noiseTimeout2),_this.noise1.visible=!0,_this.noise2.visible=!0,_this.noiseTimeout1=setTimeout(function(){return _this.noise2.visible=!1},150),_this.noiseTimeout2=setTimeout(function(){return _this.noise1.visible=!1},300),app.sound.play("static"))},_this.setupHeadViews(),_this.setupAnimations(),_this.rotation=Math.PI/2,_this.hide(),_this}return __extends(WorldComsMonitorView,_super),WorldComsMonitorView.prototype.setupAnimations=function(){this.showTL=new TimelineLite,this.showTL.to(this,.3,{ease:Back.easeOut,rotation:0,y:15}),this.showTL.stop(),this.hideTL=new TimelineLite,this.hideTL.to(this,.5,{ease:Back.easeOut,rotation:Math.PI/2,y:-20}),this.hideTL.stop()},WorldComsMonitorView.prototype.setupHeadViews=function(){this.jet=new PIXI.spine.Spine(Animations.get("talkingHeadMonitor")),this.jet.stateData.setMix("Talk","Idle",.2),this.jet.stateData.setMix("Idle","Talk",.2),this.jet.state.setAnimation(0,"Idle",!0),this.addChild(this.jet),this.sean=new PIXI.spine.Spine(Animations.get("talkingHeadMonitorSean")),this.sean.stateData.setMix("Talk","Idle",.2),this.sean.stateData.setMix("Idle","Talk",.2),this.sean.state.setAnimation(0,"Idle",!0),this.addChild(this.sean),this.noise1=new PIXI.Sprite(Textures.get("comsMonitorNoise1")),this.noise1.scale.x=this.noise1.scale.y=.85,this.noise1.x=-230,this.noise1.y=35,this.addChild(this.noise1),this.noise2=new PIXI.Sprite(Textures.get("comsMonitorNoise2")),this.noise2.scale.x=this.noise2.scale.y=this.noise1.scale.x,this.noise2.x=this.noise1.x,this.noise2.y=this.noise1.y,this.addChild(this.noise2)},WorldComsMonitorView}(PIXI.Container),ResourceTextures=function(){function ResourceTextures(){}return ResourceTextures.textureNames={Earth:"ResourceBolt",Moon:"ResourceNut",Mars:"ResourceCog",Enceladus:"ResourceSpring",Bortron7:"ResourceChip"},ResourceTextures.glowTextureNames={Earth:"ResourceBoltGlow",Moon:"ResourceNutGlow",Mars:"ResourceCogGlow",Enceladus:"ResourceSpringGlow",Bortron7:"ResourceChipGlow"},ResourceTextures.resourceForCurrentPlanet=function(isGlowing){return void 0===isGlowing&&(isGlowing=!1),ResourceTextures.resourceForPlanet(PlayerPrefs.currentPlanet,isGlowing)},ResourceTextures.resourceForPlanet=function(planetName,isGlowing){void 0===isGlowing&&(isGlowing=!1);var textureNamesForPlanet=ResourceTextures.textureNames;isGlowing&&(textureNamesForPlanet=ResourceTextures.glowTextureNames);var resourceTextureName=textureNamesForPlanet[planetName];return Textures.get(resourceTextureName)},ResourceTextures}(),Textures=function(){function Textures(){}return Object.defineProperty(Textures,"Tiles",{get:function(){return Textures.tiles},enumerable:!1,configurable:!0}),Textures.textures=[],Textures.tiles=[],Textures.clear=function(){Textures.textures=[],Textures.tiles=[]},Textures.add=function(id,texture){Textures.textures[id]?console.warn("overwrtting texture: "+id):Textures.textures[id]=texture},Textures.get=function(id){return Textures.textures[id]||console.error("texture does not exist: "+id),Textures.textures[id]},Textures.initPlanet=function(){var x,y,tileRect;Textures.tiles=[];var atlas=Textures.get("tiles"+PlayerPrefs.currentPlanet);if(Device.lowEndDevice)for(y=0;y<Constants.TerrainAtlasHeight;y++)for(x=0;x<Constants.TerrainAtlasWidth;x++)tileRect=Textures.smallTileRect(x,y),Textures.tiles.push(new PIXI.Texture(atlas,tileRect));else for(y=0;y<Constants.TerrainAtlasHeight;y++)for(x=0;x<Constants.TerrainAtlasWidth;x++)tileRect=Textures.largeTileRect(x,y),Textures.tiles.push(new PIXI.Texture(atlas,tileRect))},Textures.smallTileRect=function(x,y){return new PIXI.Rectangle(50*x,25*y,50,25)},Textures.largeTileRect=function(x,y){return new PIXI.Rectangle(x*Constants.TileWidth,y*Constants.TileHeight,Constants.TileWidth,Constants.TileHeight)},Textures}(),WorldView=function(_super){function WorldView(){var _this=_super.call(this)||this;return _this.setup=function(level,robot,showPartHUD){this.gameBackground=Device.lowEndDevice?new StaticGameBackground(level):new GameBackground(level),this.addChild(this.gameBackground),this.gameBackground.on("pointerdown",WorldSignals.clickGameCont.dispatch),this.gameBackground.interactive=!0,this.gameCont=new PIXI.Container,this.gameCont.on("pointerdown",WorldSignals.clickGameCont.dispatch),this.gameCont.interactive=!0,this.addChild(this.gameCont),this.gameBackground.setup(this.gameCont);var foamGrid=new FoamGridView(level);this.gameCont.addChild(foamGrid),this.collectableView=new CollectableView(level),this.gameCont.addChild(this.collectableView);var levelView=new LevelView(level);this.gameCont.addChild(levelView),this.robotView=new RobotView(robot),this.gameCont.addChild(this.robotView);var gfxFront=new GFXFront(robot);this.gameCont.addChild(gfxFront),this.gameUI=new GameUI(robot,showPartHUD),this.addChild(this.gameUI),(PlayerPrefs.currentLevel.isTutorial||PlayerPrefs.currentLevel.isChallenge)&&(this.levelPopup=new LevelPopup,this.addChild(this.levelPopup)),app.options.debug&&(this.enlearnUI=new EnlearnUI,this.addChild(this.enlearnUI))},_this.update=function(delta){this.robotView.updateView(delta),this.gameBackground.updateParallaxing(delta)},_this.playLvlCompleteSFX=function(){app.sound.play("sfx-success-3",{volume:.3})},_this.playDeathSFX=function(){app.sound.play("sfx-fall-splat",{volume:.3})},_this.playStarCollectSFX=function(){app.sound.play("sfx-star-hit")},_this.playResourceCollectSFX=function(){app.sound.play("sfx-collect-1")},_this.resize=function(offset){_this.gameUI.resize(offset)},_this.removeStar=function(id){_this.collectableView.removeStar(id)},_this.removeResource=function(id){_this.collectableView.removeResource(id)},_this.enlearnAttempt=function(success,obsID){app.options.debug&&_this.enlearnUI.enlearnAttempt(success,obsID)},_this.teardown=function(){_this.gameUI.teardown(),_this.collectableView.teardown(),_this.visible=!1,_this.interactive=!1,_this.interactiveChildren=!1,_this.parent.removeChild(_this)},_this}return __extends(WorldView,_super),WorldView}(PIXI.Container),Main=function(){function Main(){var _this=this;this.preinit=function(){_this.triggerAppResize(),app.analyticsEmitter.endGame=AnalyticsUtils.customEndEvent,app.analyticsEmitter.startInstruction=AnalyticsUtils.startInstruction,app.analyticsEmitter.endInstruction=AnalyticsUtils.endInstruction,app.analyticsEmitter.startIncorrectFeedback=AnalyticsUtils.startIncorrectFeedback,app.analyticsEmitter.endIncorrectFeedback=AnalyticsUtils.endIncorrectFeedback,app.analyticsEmitter.startCorrectFeedback=AnalyticsUtils.startCorrectFeedback,app.analyticsEmitter.endCorrectFeedback=AnalyticsUtils.endCorrectFeedback,Device.isCordova&&setTimeout(_this.skinCordovaCloseBtn,1)},this.skinCordovaCloseBtn=function(){var closeBtn=window.parent.document.querySelector("#close");if(closeBtn){closeBtn.classList.remove("topRight"),closeBtn.classList.add("topLeft"),closeBtn.innerHTML='<img src="./resources/rjg-robot-platformer/assets/images/Close.png">';var btnScale=.9,canvasHeight=$("canvas").height();isNaN(canvasHeight)||(btnScale=canvasHeight/Constants.ScreenHeight*.9),closeBtn.setAttribute("style","-ms-transform: scale("+btnScale+"); -webkit-transform: scale3d("+btnScale+", 1);\n                -moz-transform: scale("+btnScale+"); -o-transform: scale("+btnScale+");\n                transform: scale("+btnScale+");\n                top: -10px; left: -10px;\n                background-color:transparent\n            "),app.closeBtn=closeBtn}},this.init=function(){app.options.debug&&app.analyticsEmitter.enableLogging(),GoogleAnalytics.Init(),AnalyticsUtils.Init(),Device.lowEndDevice&&(app.options.trigger("fps",12),app.options.trigger("raf",!1)),app.assetPrefix="assets/",_this.currentScene=new LoadingMediator(app.display.stage),_this.wireUpPause(),Device.isCordova&&_this.wireUpBackBtn()},this.startGame=function(){_this.currentScene.teardown(),_this.currentScene=new GameMediator(app.display.stage),app.analyticsEmitter.startGame(app.config.spec.version,AnalyticsUtils.progress),GoogleAnalytics.sendStartGame()},this.update=function(delta){app.time.delta=delta,app.time.smoothDelta=MathUtils.lerp(app.time.smoothDelta,delta,.1)},this.resize=function(offset){var sideOffset=(1280-offset)/2;app.display.sideOffset=sideOffset,app.display.stage.children.forEach(function(child){child.x=-sideOffset})},this.triggerAppResize=function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var evt=window.document.createEvent("UIEvents");evt.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(evt)}},this.wireUpPause=function(){app.lostFocus=!1,app.container&&app.container.on("pause",_this.OnContainerPause),$(window).on("focus",function(){_this.setLostFocus(!1)}).on("blur",function(){_this.setLostFocus(!0)})},this.wireUpBackBtn=function(){if(window.parent){window.parent.document.addEventListener("backbutton",function(event){event.preventDefault(),_this.currentScene&&("loading"==_this.currentScene.ID||("world"==_this.currentScene.ID?GameSignals.gotoMainMenu.dispatch(null):"menu"==_this.currentScene.ID&&app.exitApp()))},!1)}},this.exitApp=function(){app.shuttingDown||app.container&&(GoogleAnalytics.sendEndGame(),app.container.send("leaveGame"),app.shuttingDown=!0)},this.OnContainerPause=function(args){"boolean"==typeof args?_this.setLostFocus(args):args&&args.hasOwnProperty("type")&&args.hasOwnProperty("data")&&args&&"pause"==args.type&&_this.setLostFocus(args.data)},this.setLostFocus=function(value){app.lostFocus=value,app.sound.setContextMute("vo",value),app.sound.setContextMute("sfx",value),app.sound.setContextMute("music",value)};var releaseBuild=!springroll.Debug,appConfig={name:"RJG - Robot Platformer",autoPause:!0,preventScrollingKeys:!0,maxWidth:1280,canvasId:"stage",audioTypes:["mp3"],configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",display:springroll.pixi.PixiDisplay,displayOptions:{clearView:!0},isCordova:Device.isCordova,enlearn:{appId:"2b6d36c9",apiKey:"h1nBQgPOjK510Rg3GGoDr80poA8W6EdOaZqfIZCq",appData:{releaseBuild:releaseBuild},client:window.enlearn}};Device.isAndroid&&(Device.majorAndroidVersion<5&&(appConfig.displayOptions.forceContext="canvas2d"),Device.isPixel3&&(appConfig.displayOptions.forceContext="canvas2d")),PlayerPrefs.load(),app=new springroll.Application(appConfig),app.time={delta:0,smoothDelta:0},app.wallet=new Wallet,app.unlockManager=new UnlockManager,app.on("init",this.init),app.on("loadingcomplete",this.startGame),app.on("resize",this.resize),app.on("update",this.update),app.voPlayer.delayedPlay=function(id,delay){setTimeout(function(){app.lostFocus||app.voPlayer.play(id)},delay)},app.rand=this.appRand,app.exitApp=this.exitApp,app.triggerAppResize=this.triggerAppResize,PIXI.settings.PRECISION_FRAGMENT=PIXI.PRECISION.HIGH,this.preinit()}return Main.prototype.appRand=function(){return arguments[Math.floor(Math.random()*arguments.length)]},Main}(),main=new Main;