!function(){"use strict";var a=include("springroll.Application"),b=include("springroll.pixi.PixiDisplay"),c=new a({name:"dino-digger-springroll",canvasId:"stage",configPath:"assets/config/config.json",display:b,displayOptions:{clearView:!0,backgroundColor:9977856},keepFocus:!0});c.on("init",function(){var a=null,b=function(){var a=document.getElementById("stage");c.container.send("resizegame",{width:a.offsetWidth,height:a.offsetHeight})};if(c.on("resize",b),b(),window.PBS&&PBS.KIDS&&PBS.KIDS.KartKingdom)try{c.platypus.kartKingdom=a=new PBS.KIDS.KartKingdom.minigame("b0a041a6-2184-4952-9bc0-9e054d884d31","root",function(){},function(){},function(){})}catch(d){window.console.warn("Error loading Kart Kingdom",d)}a||(c.platypus.kartKingdom=a={isFake:!0,powerUps:{"fossil-boom":0,"fossil-repair":0},hasPowerUp:function(a){return this.powerUps[a]?this.powerUps[a]:0},usePowerUps:function(a,b,c){var d=!1;for(var e in a)this.powerUps[e]>=a[e]&&(this.powerUps[e]-=a[e],d=!0);d?b():c()},levelComplete:function(){},event:function(a){}},window.console.warn("FAKE Kart Kingdom loaded."))}),window.app=c,document.domain.indexOf("pbskids.org")>=0&&(document.domain="pbskids.org")}(),function(){"use strict";var a=function(a,b,c,d,e,f){var g=0,h=0,i=0,j=a.slice();if("horizontal"===f){for(h=e-1;h>=0;h--)for(g=h*d,i=0;(h+1)*d>g;g++,i++)j.splice((h+1)*b+i,0,c[g]);return j}return"vertical"===f?a.concat(c):void 0},b=function(a,b,c,d){var e=0,f=0,g=a.slice(),h=null;for(e=0;e<b.length;e++){h={};for(f in b[e])b[e].hasOwnProperty(f)&&(h[f]=b[e][f]);"horizontal"===d?h.x+=c:"vertical"===d&&(h.y+=c),g.push(h)}return g},c=function(c,d,e){var f=0,g=0;for(c.tilewidth||c.tileheight?c.tilewidth!==d.tilewidth||c.tileheight!==d.tileheight:(c.tilewidth=d.tilewidth,c.tileheight=d.tileheight),"horizontal"===e?0===c.height?c.height=d.height:c.height!==d.height:"vertical"===e&&(0===c.width?c.width=d.width:c.width!==d.width),f=0;f<d.layers.length;f++)if(c.layers[f])c.layers[f].type===d.layers[f].type&&(c.layers[f].data&&d.layers[f].data?"horizontal"===e?(c.layers[f].data=a(c.layers[f].data,c.width,d.layers[f].data,d.width,c.height,e),c.layers[f].width+=d.width):"vertical"===e&&(c.layers[f].data=a(c.layers[f].data,c.height,d.layers[f].data,d.height,c.width,e),c.layers[f].height+=d.height):c.layers[f].objects&&d.layers[f].objects&&("horizontal"===e?c.layers[f].objects=b(c.layers[f].objects,d.layers[f].objects,c.width*c.tilewidth,e):"vertical"===e&&(c.layers[f].objects=b(c.layers[f].objects,d.layers[f].objects,c.height*c.tileheight,e))));else{c.layers[f]={};for(g in d.layers[f])d.layers[f].hasOwnProperty(g)&&(c.layers[f][g]=d.layers[f][g])}"horizontal"===e?c.width+=d.width:"vertical"===e&&(c.height+=d.height);for(f in d)d.hasOwnProperty(f)&&!c[f]&&(c[f]=d[f])},d=function(a){var b=0,d=0,e=platypus.game.settings.levels,f={height:0,width:0,layers:[]},g={height:0,width:0,layers:[]},h=a[b].length;for(b=0;b<a.length;b++){for(h!==a[b].length,f={height:0,width:0,layers:[]},d=0;d<a[b].length;d++)"string"==typeof a[b][d]?c(f,e[a[b][d]],"horizontal"):c(f,a[b][d],"horizontal");c(g,f,"vertical")}return g};return platypus.createComponentClass({id:"digger-level-builder",properties:{useUniques:!0},constructor:function(a){this.levelTemplate=this.owner.levelTemplate||a.levelTemplate,this.levelPieces=this.owner.levelPieces||a.levelPieces,this.levelMessage={level:null,persistentData:null}},events:{"scene-loaded":function(a){var b=null,c=null,e="",f=0,g=0,h=0,i=0,j=0;if(this.levelMessage.persistentData=a,a&&a.levelNumber&&(i=Math.floor(a.levelNumber/2),i>3&&(i=3)),j=Math.floor(Math.random()*this.levelTemplate[i].length),this.levelTemplate=this.levelTemplate[i][j],this.useUniques=a.useUniques||this.useUniques,c=a.levelPieces||this.levelPieces,this.levelPieces={},c)for(e in c)if(c.hasOwnProperty(e))if("string"==typeof c[e])this.levelPieces[e]=c[e];else if(c[e].length)for(this.levelPieces[e]=[],f=0;f<c[e].length;f++)this.levelPieces[e].push(c[e][f]);if(this.levelTemplate)if("string"==typeof this.levelTemplate)this.levelMessage.level=[this.getLevelPiece(this.levelTemplate)];else if(this.levelTemplate.length)for(this.levelMessage.level=[],g=0;g<this.levelTemplate.length;g++)if(b=this.levelTemplate[g],"string"==typeof b)this.levelMessage.level[g]=this.getLevelPiece(b);else if(b.length)for(this.levelMessage.level[g]=[],h=0;h<b.length;h++)this.levelMessage.level[g][h]=this.getLevelPiece(b[h]);this.levelMessage.level&&(this.levelMessage.level=d(this.levelMessage.level),this.owner.triggerEvent("load-level",this.levelMessage))}},methods:{getLevelPiece:function(a){var b=this.levelPieces[a]||a,c=null,d=0;if(b){if("string"==typeof b)return this.useUniques?(c=b,this.levelPieces[a]=null,c):b;if(b.length)return d=Math.floor(Math.random()*b.length),this.useUniques?this.levelPieces[a].splice(d,1)[0]:b[d]}return null},destroy:function(){this.levelMessage.level=null,this.levelMessage.persistentData=null,this.levelMessage=null}},publicMethods:{mergeLevels:function(a){return d(a)}}})}(),function(){"use strict";var a=1200;return platypus.createComponentClass({id:"logic-fossil-box",properties:{drillCost:0,toSpawn:null},publicProperties:{strata:0,fossilType:0,spawnRelativeZ:-1},constructor:function(a){this.breakTimer=0,this.drilled=!1,this.owner.state.strata0||this.owner.state.strata1||this.owner.state.strata2||(this.owner.state.strata0=!0),this.owner.state["T"+Math.floor(3*Math.random())]=!0,this.owner.state.D0=!0,this.owner.state.D1=!1,this.owner.state.D2=!1,this.owner.state.D3=!1,this.owner.state.D4=!1,this.owner.state.D5=!1,this.doneBroked=!1,this.broken=!1,this.affine=null,this.shakeIncrementor=0,this.shakeTime=0,this.xWaveLength=100,this.yWaveLength=200,this.maxWaveLength=Math.max(this.xWaveLength,this.yWaveLength),this.xMagnitude=2,this.yMagnitude=2,this.spawned=null,this.train=null,this.normalZ=this.owner.z,this.boomed=!1},events:{"scene-live":function(){var a=null;this.toSpawn&&(a={x:this.owner.x,y:this.owner.y,z:this.owner.z+this.spawnRelativeZ,state:{strata0:this.owner.state.strata0,strata1:this.owner.state.strata1,strata2:this.owner.state.strata2,type0:this.owner.state.type0,type1:this.owner.state.type1,type2:this.owner.state.type2,type3:this.owner.state.type3},fossilName:this.owner.fossilName},this.spawned=new platypus.Entity(platypus.game.settings.entities[this.toSpawn],{properties:a}),this.owner.parent.addEntity(this.spawned),this.spawned.triggerEvent("announce-self"))},"peer-entity-added":function(a){"train"===a.type&&(this.train=a)},"component-added":function(a){"RenderSprite"===a.type&&(this.affine=a.affine)},"handle-logic":function(b){var c=0;this.doneBroked||(this.broken||(this.drilled||this.boomed?(this.breakTimer+=b.delta,this.shakeTime-this.shakeIncrementor<b.delta&&(this.shakeTime+=this.maxWaveLength),this.owner.z=this.normalZ+1):(this.breakTimer-=b.delta,this.breakTimer<0&&(this.breakTimer=0),this.owner.z=this.normalZ),c=this.boomed?this.breakTimer/(a/4):this.breakTimer/a,0===c?(this.owner.state.D0=!0,this.owner.state.D1=!1,this.owner.state.D2=!1,this.owner.state.D3=!1,this.owner.state.D4=!1,this.xMagnitude=2,this.yMagnitude=2):.2>c?(this.owner.state.D0=!1,this.owner.state.D1=!0,this.owner.state.D2=!1,this.owner.state.D3=!1,this.owner.state.D4=!1,this.xMagnitude=2,this.yMagnitude=2):.4>c?(this.owner.state.D0=!1,this.owner.state.D1=!1,this.owner.state.D2=!0,this.owner.state.D3=!1,this.owner.state.D4=!1,this.xMagnitude=3,this.yMagnitude=3):.6>c?(this.owner.state.D0=!1,this.owner.state.D1=!1,this.owner.state.D2=!1,this.owner.state.D3=!0,this.owner.state.D4=!1,this.xMagnitude=4,this.yMagnitude=4):.8>c?(this.owner.state.D0=!1,this.owner.state.D1=!1,this.owner.state.D2=!1,this.owner.state.D3=!1,this.owner.state.D4=!0,this.xMagnitude=5,this.yMagnitude=5):c>=1&&(this.broken=!0)),this.shakeIncrementor<this.shakeTime?(this.shakeIncrementor+=b.delta,this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime),this.affine.tx=Math.sin(this.shakeIncrementor/this.xWaveLength*(2*Math.PI))*this.xMagnitude,this.affine.ty=Math.sin(this.shakeIncrementor/this.yWaveLength*(2*Math.PI))*this.yMagnitude,this.spawned&&(this.spawned.x=this.owner.x+this.affine.tx,this.spawned.y=this.owner.y+this.affine.ty)):(this.shakeIncrementor=0,this.shakeTime=0,this.broken&&(this.doneBroked=!0,!this.boomed&&this.train&&this.train.triggerEvent("weaken-drill",this.drillCost),this.owner.state.D0=!1,this.owner.state.D1=!1,this.owner.state.D2=!1,this.owner.state.D3=!1,this.owner.state.D4=!1,this.owner.state.D5=!0,this.owner.triggerEvent("collide-off"),this.spawned&&this.spawned.triggerEvent("uncover"),"rock-small"==this.owner.type||"rock-large"==this.owner.type?this.owner.triggerEvent("sfx-rock-break"):"mineral-box"==this.owner.type?this.owner.triggerEvent("sfx-mineral"):this.owner.triggerEvent("sfx-fossil")))),this.drilled=!1},drilled:function(a){this.drilled=!0},"animation-ended":function(a){var b=null;this.owner.state.strata0?b="S0-done":this.owner.state.strata1?b="S1-done":this.owner.state.strata2&&(b="S2-done"),a===b&&this.owner.triggerEvent("destroy-me")},boom:function(a){this.boomed=!0}},methods:{destroy:function(){this.spawned=null,this.affine=null,this.train=null}},publicMethods:{}})}(),function(){"use strict";var a=400,b=100,c=8;return platypus.createComponentClass({id:"logic-fossil-o-meter",properties:{},publicProperties:{},constructor:function(a){this.offsetRange=299,this.fossils=[],this.train=null,this.hotness=0,this.offset=0,this.closeFossilWarned=!1,this.owner.state["how-close-0"]=!1,this.owner.state["how-close-1"]=!1,this.owner.state["how-close-2"]=!1,this.owner.state["how-close-3"]=!1,this.owner.state["how-close-4"]=!1,this.owner.state["how-close-5"]=!1,this.owner.state["how-close-6"]=!1,this.owner.state["how-close-7"]=!1,this.fossilCount=0,this.owner.state.count0=!0,this.owner.state.count1=!1,this.owner.state.count2=!1,this.owner.state.count3=!1,this.owner.state.count4=!1,this.owner.state.count5=!1,this.owner.state.count6=!1,this.owner.state.count7=!1,this.owner.state.count8=!1,this.owner.state.count9=!1,this.owner.state.count10=!1,this.owner.state.count11=!1,this.owner.state.count12=!1,this.owner.state.count13=!1,this.owner.state.count14=!1,this.owner.state.count15=!1,this.owner.state.count16=!1,this.owner.state.count17=!1,this.owner.state.count18=!1,this.owner.state.count19=!1,this.owner.state.count20=!1},events:{"handle-logic":function(d){var e=0,f=null,g=1/0,h=1/0;for(e=0;e<this.fossils.length;e++)f=this.fossils[e],g=Math.pow(f.x-this.train.x,2)+Math.pow(f.y-this.train.y,2),h>g&&(h=g);for(h=Math.max(Math.sqrt(h)-b,0),h=Math.min(h,a),this.hotness=1-h/a,this.hotness-=.04,this.hotness=Math.ceil(this.hotness*c),e=0;c>e;e++)this.hotness>e?this.owner.state["how-close-"+e]=!0:this.owner.state["how-close-"+e]=!1;!this.closeFossilWarned&&this.hotness>=6&&this.owner.triggerEvent("el-close-fossil-warn")},"close-fossil-warning-delivered":function(){this.closeFossilWarned=!0},"train-added":function(a){this.train=a},"fossil-added":function(a){this.fossils.push(a),this.fossilCount++,this.updateCount()},"fossil-removed":function(a){var b=0;for(this.fossilCount--,this.updateCount(),b=0;b<this.fossils.length;b++)if(this.fossils[b]===a)return this.fossils.splice(b,1),createjs.Tween.get(this.owner).to({scaleX:1.2,scaleY:1.2},200,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},200,createjs.Ease.quadIn),void this.owner.triggerEvent("ping")}},methods:{updateCount:function(){var a=0;for(a=0;20>=a;a++)this.owner.state["count"+a]=!1;this.owner.state["count"+this.fossilCount]=!0},destroy:function(){this.train=null,this.fossils=null,this.cover=null}},publicMethods:{}})}(),function(){"use strict";var a=2e3,b=2e4,c=["play-factoid-0","play-factoid-1","play-factoid-2","play-factoid-3","play-factoid-4","play-factoid-5","play-factoid-6","play-factoid-7"],d=["play-fossil-generic-0","play-fossil-generic-1","play-fossil-generic-2","play-fossil-generic-3"],e=["play-mineral-generic-0","play-mineral-generic-1"],f=["play-drill-warn-0","play-drill-warn-1"];return platypus.createComponentClass({id:"logic-game-manager",properties:{},publicProperties:{},constructor:function(a){var b=this;platypus.game.kartKingdom.isFake||(this.showResultsFunc=function(){b.owner.triggerEvent("el-show-results",b.resultsInfo)},platypus.game.kartKingdom.addEventListener(PBS.KIDS.KartKingdom.minigameEvent.LEVEL_COMPLETE_CLOSED,this.showResultsFunc)),this.owner.opacity=0,this.owner.rotation=0,this.fossilCount=0,this.fossilsFound=0,this.resultsInfo={fossils:[],totalInLevel:0,total:0},this.quickIntro=!1,this.fossilCount=0,this.introPlaying=!1,this.audioBusy=!0,this.factoidTime=0,this.betweenTime=0,this.fossilIntroPlayed=!1,this.trogIntroPlayed=!1,this.mineralIntroPlayed=!1,this.fossilGenerics=[],this.factoidGenerics=[],this.mineralGenerics=[],this.drillGenerics=[],this.levelOver=!1,this.drillWarn=!1,this.drillHalfWarn=!1,this.nearestMineral=!1,this.nearestTrog=!1,this.fossilNear=!1,this.trogNear=!1,this.mineralNear=!1,this.arrowKeys=null,this.removeArrowKeys=!1,this.pointer=null,this.circleCenter=null,this.circleLeft=null,this.circleRight=null,this.introRock=!1,this.introHardDirt=!1,this.rockHardDirtPlayed=!1,this.persistent={levelNumber:0,fossilCount:0,mineralCount:0,fossilTypes:{"small-0-0":!1,"small-0-1":!1,"small-0-2":!1,"small-0-3":!1,"small-1-0":!1,"small-1-1":!1,"small-1-2":!1,"small-1-3":!1,"small-2-0":!1,"small-2-1":!1,"small-2-2":!1,"small-2-3":!1,"medium-0-0":!1,"medium-1-0":!1,"medium-2-0":!1,"large-1-0":!1},mineralTypes:{diamond:!1,topaz:!1,ruby:!1},troglobiteTypes:{type0:!1,type1:!1,type2:!1,type3:!1}},this.usedTroglobite=!1},events:{"scene-loaded":function(a){var b=null;if(a){this.persistent.levelNumber=a.levelNumber||0,this.persistent.fossilCount=a.fossilCount||0,this.persistent.mineralCount=a.mineralCount||0;for(b in a.fossilTypes)this.persistent.fossilTypes[b]=a.fossilTypes[b];for(b in a.mineralTypes)this.persistent.mineralTypes[b]=a.mineralTypes[b];for(b in a.troglobiteTypes)this.persistent.troglobiteTypes[b]=a.troglobiteTypes[b]}},"handle-logic":function(a){var c=a.delta;this.levelOver||(this.betweenTime>0&&(this.betweenTime-=c,this.betweenTime<=0&&(this.audioBusy=!1,this.factoidTime=b)),this.factoidTime>0&&(this.factoidTime-=c,this.factoidTime<=0&&this.playGenericSound("factoid")),0!==this.persistent.levelNumber||this.rockHardDirtPlayed||!this.introRock&&!this.introHardDirt?this.drillHalfWarn?this.playGenericSound("drill")&&(this.drillWarn=!1):this.drillWarn?this.playGenericSound("drill")&&(this.drillWarn=!1):0===this.persistent.levelNumber&&this.mineralNear?this.playAudio("play-mineral-intro")&&(this.mineralIntroPlayed=!0,this.nearestMineral.triggerEvent("attach")):0===this.persistent.levelNumber&&this.trogNear&&this.playAudio("play-trog-intro")&&(this.trogIntroPlayed=!0,this.nearestTrog.triggerEvent("attach")):this.introRock?this.playAudio("play-intro-rock")&&(this.rockHardDirtPlayed=!0):this.introHardDirt&&this.playAudio("play-intro-hard-dirt")&&(this.rockHardDirtPlayed=!0),this.mineralNear=!1,this.trogNear=!1,this.introRock=!1,this.introHardDirt=!1),this.arrowKeys&&this.removeArrowKeys&&(this.owner.parent.removeEntity(this.arrowKeys),this.arrowKeys=null)},"start-intro":function(){var a=JSON.parse(window.localStorage.getItem("dt-dig-tutorialComplete"))||!1;this.introPlaying=!0,a?(this.quickIntro=!0,this.owner.triggerEvent("play-intro-quick")):platypus.supports.mobile?this.owner.triggerEvent("play-intro-touch"):this.owner.triggerEvent("play-intro")},"intro-count":function(){this.owner.triggerEvent("play-count-"+this.fossilCount)},"continue-intro":function(){this.quickIntro?this.owner.triggerEvent("play-intro-quick-rest"):this.owner.triggerEvent("play-intro-rest")},"intro-complete":function(){this.introPlaying=!1,this.betweenTime=a,window.localStorage.setItem("dt-dig-tutorialComplete",!0)},"point-fossil-meter":function(){createjs.Tween.get(this.owner).to({opacity:1},400,createjs.Ease.cubicOut),this.owner.x=320,this.owner.y=-205,this.owner.rotation=0},"point-fossil-meter-high":function(){createjs.Tween.get(this.owner).to({opacity:1},400,createjs.Ease.cubicOut),this.owner.x=385,this.owner.y=0,this.owner.rotation=0},"point-fossil-meter-count":function(){createjs.Tween.get(this.owner).to({opacity:1},400,createjs.Ease.cubicOut),this.owner.x=385,this.owner.y=-100,this.owner.rotation=0},"point-drill-meter":function(){createjs.Tween.get(this.owner).to({opacity:1},400,createjs.Ease.cubicOut),this.owner.x=-320,this.owner.y=-205,this.owner.rotation=180},"point-drill-meter-warn":function(){var a=JSON.parse(window.localStorage.getItem("dt-dig-drillWarnArrowShown"))||!1;a||(window.localStorage.setItem("dt-dig-drillWarnArrowShown",!0),this.owner.triggerEvent("point-drill-meter"))},"point-drill-meter-heal":function(){var a=JSON.parse(window.localStorage.getItem("dt-dig-drillHealArrowShown"))||!1;a||(window.localStorage.setItem("dt-dig-drillHealArrowShown",!0),this.owner.triggerEvent("point-drill-meter"))},"close-fossil-warn":function(){this.playAudio("play-fossil-near-1")},"point-warn-fossil-near":function(){var a=JSON.parse(window.localStorage.getItem("dt-dig-fossilNearShown"))||!1;this.owner.triggerEvent("el-close-fossil-warning-delivered"),a||(window.localStorage.setItem("dt-dig-fossilNearShown",!0),this.owner.triggerEvent("point-fossil-meter"))},"hide-pointer":function(){createjs.Tween.get(this.owner).to({opacity:0},400,createjs.Ease.cubicOut)},"fossil-added":function(){this.fossilCount++,this.resultsInfo.totalInLevel++},"fossil-removed":function(a){var b={name:a.fossilName,strata:0},c=null,d=!0;if(this.persistent.fossilTypes[a.fossilName]=!0,!JSON.parse(window.localStorage.getItem("dt-ff-all-fossils-found"))){for(c in this.persistent.fossilTypes)if(!this.persistent.fossilTypes[c]){d=!1;break}d&&(platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),window.localStorage.setItem("dt-ff-all-fossils-found","true"))}this.persistent.fossilCount++,this.persistent.fossilCount%10===0?platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"):this.persistent.fossilCount%5===0&&platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),this.fossilsFound++,this.resultsInfo.total++,a.state.strata0?b.strata=0:a.state.strata1?b.strata=1:a.state.strata2&&(b.strata=2),"fossil-small"===a.type?b.size="small":"fossil-medium"===a.type?b.size="medium":"fossil-large"===a.type&&(b.size="large"),b.audio=a.fossilAudio,this.resultsInfo.fossils.push(b),this.fossilsFound===this.fossilCount?this.owner.triggerEvent("end-level",!0):this.fossilIntroPlayed?a.fossilAudio&&this.playAudio(a.fossilAudio):this.playAudio("play-fossil-intro")&&(this.fossilIntroPlayed=!0)},"mineral-found":function(a){var b=!1,c=Math.floor(3*Math.random()),d=Math.floor(2*Math.random()),e=null,f=!0;if(this.persistent.mineralTypes[a.type]=!0,!JSON.parse(window.localStorage.getItem("dt-ff-all-minerals-found"))){for(e in this.persistent.mineralTypes)if(!this.persistent.mineralTypes[e]){f=!1;break}f&&(platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),window.localStorage.setItem("dt-ff-all-minerals-found","true"))}this.persistent.mineralCount++,this.persistent.mineralCount%5===0&&platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),a.state.type0?c&&(this.playAudio("play-mineral-diamond"),b=!0):a.state.type1&&c&&(this.playAudio("play-mineral-topaz"),b=!0),b||this.playAudio("play-mineral-generic-"+d)},"trog-found":function(a){var b=null,c=!0,d=a.entity,e=0;for(e=0;4>e;e++)if(d.state["type"+e]){this.persistent.troglobiteTypes["type"+e]=!0;break}if(!JSON.parse(window.localStorage.getItem("dt-ff-all-troglobites-found"))){for(b in this.persistent.troglobiteTypes)if(!this.persistent.troglobiteTypes[b]){c=!1;break}c&&(platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),window.localStorage.setItem("dt-ff-all-troglobites-found","true"))}this.playAudio("play-trog-arrow"),this.usedTroglobite=!0},"drill-warning":function(){this.drillWarn=!0},"next-step":function(){this.owner.triggerEvent("new-scene")},"end-level":function(a){var b=JSON.parse(window.localStorage.getItem("dt-ff-highest-level"));this.owner.triggerEvent("stop-audio"),this.levelOver=!0,a?(this.persistent.levelNumber++,this.persistent.levelNumber%3===0&&platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),this.usedTroglobite||platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9"),this.owner.triggerEvent("el-lock-controls"),this.owner.triggerEvent("set-persistent-scene-data",this.persistent),this.owner.triggerEvent("set-scene","scene-level-test"),this.owner.triggerEvent("play-done-got-them-all")):(this.owner.triggerEvent("set-scene","menu"),this.owner.triggerEvent("play-done-drill-dead"),(!b&&this.persistent.levelNumber||this.persistent.levelNumber>b)&&(window.localStorage.setItem("dt-ff-highest-level",JSON.stringify(this.persistent.levelNumber)),platypus.game.kartKingdom.event("d78a830b-b500-4473-a9ef-e168894f2bb9")))},"results-transition":function(){this.owner.triggerEvent("rl-silence-train"),platypus.game.kartKingdom.isFake?this.owner.triggerEvent("el-show-results",this.resultsInfo):platypus.game.kartKingdom.levelComplete()},"audio-complete":function(){this.betweenTime=a},"trog-near":function(a){this.trogIntroPlayed||(this.nearestTrog=a.entity,this.trogNear=!0)},"mineral-near":function(a){this.mineralIntroPlayed||(this.nearestMineral=a.entity,this.mineralNear=!0)},"spawn-floating-mineral":function(a){this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities[a.entType],{properties:a}))},"spawn-kk-repair":function(a){this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["kk-repair"],{properties:a}))},"introduce-rock":function(){this.introRock=!0},"introduce-hard-dirt":function(){this.introHardDirt=!0},"show-arrow-keys":function(){var a={x:0,y:200,z:4e3};this.arrowKeys=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["arrow-keys"],{properties:a}))},"hide-arrow-keys":function(){this.removeArrowKeys=!0},"show-pointers":function(){var a={x:0,y:225,z:4e3,opacity:1},b=this;this.circleCenter=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["touch-circle"],{properties:a})),a.x=-300,a.y=0,a.opacity=0,this.circleLeft=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["touch-circle"],{properties:a})),a.x=300,a.opacity=0,this.circleRight=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["touch-circle"],{properties:a})),a.x=0,a.y=150,a.z+=1,a.opacity=1,this.pointer=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities.pointer,{properties:a})),createjs.Tween.get(this.pointer).wait(100).to({y:225},500,createjs.Ease.cubicOut).wait(500).to({x:-300,y:-75}).wait(100).to({y:0},500,createjs.Ease.cubicOut).wait(500).to({x:300,y:-75}).wait(100).to({y:0},500,createjs.Ease.cubicOut).wait(500).call(function(){b.owner.triggerEvent("hide-pointers")}),createjs.Tween.get(this.circleCenter).wait(600).to({scaleX:1.5,scaleY:1.5,opacity:0},400,createjs.Ease.cubicOut),createjs.Tween.get(this.circleLeft).wait(1100).to({opacity:1}).wait(500).to({scaleX:1.5,scaleY:1.5,opacity:0},400,createjs.Ease.cubicOut),createjs.Tween.get(this.circleRight).wait(2200).to({opacity:1}).wait(500).to({scaleX:1.5,scaleY:1.5,opacity:0},400,createjs.Ease.cubicOut)},"hide-pointers":function(){this.pointer.triggerEvent("destroy-me"),this.circleCenter.triggerEvent("destroy-me"),this.circleLeft.triggerEvent("destroy-me"),this.circleRight.triggerEvent("destroy-me"),this.pointer=null,this.circleCenter=null,this.circleLeft=null,this.circleRight=null}},methods:{playGenericSound:function(a){var b=null;switch(a){case"factoid":b=this.factoidGenerics;break;case"fossil":b=this.fossilGenerics;break;case"mineral":b=this.mineralGenerics;break;case"drill":b=this.drillGenerics}return 0===b.length&&this.refillList(b,a),this.playAudio(b.pop())},refillList:function(a,b){var g=null,h=[],i=0,j=0;switch(b){case"factoid":g=c;break;case"fossil":g=d;break;case"mineral":g=e;break;case"drill":g=f}for(j=0;j<g.length;j++)h.push(j);for(j=0;j<g.length;j++)i=h.splice(Math.floor(Math.random()*h.length),1)[0],a.push(g[i])},playAudio:function(a){return this.audioBusy?!1:(this.factoidTime=0,this.audioBusy=!0,this.owner.triggerEvent(a),!0)},destroy:function(){platypus.game.kartKingdom.isFake||(platypus.game.kartKingdom.removeEventListener(PBS.KIDS.KartKingdom.minigameEvent.LEVEL_COMPLETE_CLOSED,this.showResultsFunc),this.showResultsFunc=null),this.resultsInfo=null,this.arrowKeys=null,this.pointer=null,this.circleCenter=null,this.circleLeft=null,this.circleRight=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-highlight-circle",properties:{showTime:6e3},publicProperties:{},constructor:function(a){this.owner.opacity=0,this.owner.scaleX=.01,this.owner.scaleY=.01,this.started=!1},events:{"handle-logic":function(a){a.delta;this.started||(this.started=!0,createjs.Tween.get(this.owner).to({scaleX:1,scaleY:1,opacity:1},250,createjs.Ease.cubicIn).to({scaleX:1,scaleY:1},this.showTime).to({scaleX:.01,scaleY:.01,opacity:0},250,createjs.Ease.cubicIn))}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=.5,b=60,c=[[0,0,0,1,1,1,0,0,0],[0,0,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,0,0,0]];return platypus.createComponentClass({id:"logic-kk-boom",properties:{},publicProperties:{},constructor:function(a){this.boomed=[],this.firstPass=!0,this.distance=0,this.lifetime=2e3,this.checkedForTargets=!1},events:{adopted:function(){var a=0,b=0,c=0,d=60,e=Math.floor(2*Math.random()*Math.PI),f=Math.PI/3,g=[0,Math.PI,2*Math.PI/3,Math.PI/2],h=0,i=0;for(a=0;4>a;a++)for(c=a*d,e+=f,b=0;a+1>b;b++)h=this.owner.x+Math.cos(e)*c,i=this.owner.y+Math.sin(e)*c,e+=g[a],new springroll.DelayedCall(this.createExplosionFunction(h,i,this),200*a)},"handle-logic":function(b){var c=0,d=0;for(this.distance+=b.delta*a,this.checkedForTargets||this.checkForTargets(),c=this.boomed.length-1;c>=0;c--)d=Math.sqrt(Math.pow(this.owner.x-this.boomed[c].x,2)+Math.pow(this.owner.y-this.boomed[c].y,2)),d<this.distance&&(this.boomed[c].triggerEvent("boom"),this.boomed.splice(c,1));this.lifetime>0&&(this.lifetime-=b.delta,this.lifetime<=0&&this.owner.triggerEvent("destroy-me"))}},methods:{checkForTargets:function(){var a=0,d=0,e=0,f=c.length/2,g=null,h=0,i=0,j=!1;for(this.checkedForTargets=!0,d=0;d<c.length;d++)for(a=0;a<c[d].length;a++)if(c[d][a]&&(h=this.owner.x+b*(a-f),i=this.owner.y+b*(d-f),g=this.owner.parent.checkEarth(h,i))){for(e=0;e<this.boomed.length;e++)if(g===this.boomed[e]){j=!0;break}j||this.boomed.push(g),j=!1}},createExplosionFunction:function(a,b,c){return function(){c.createExplosion(a,b,c)}},createExplosion:function(a,b,c){var d=null;d={x:a,y:b,z:c.owner.z+100},c.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["kk-boom-explosion"],{properties:d}))},destroy:function(){this.boomed=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-kk-button",properties:{powerUpId:"fossil-boom",countMax:9},publicProperties:{},constructor:function(a){this.count=0},events:{"scene-loaded":function(){this.count=platypus.game.kartKingdom.hasPowerUp(this.powerUpId),this.count?this.updateCount():this.owner.opacity=0},"try-use":function(){var a={},b=this.owner;this.count>0&&(a[this.powerUpId]=1,platypus.game.kartKingdom.usePowerUps(a,function(){b.triggerEvent("successfully-used")},function(){}))},"successfully-used":function(){this.count--,this.updateCount(),this.owner.triggerEvent("use-power-up")},"show-results":function(){this.owner.state.visible=!1,this.owner.triggerEvent("disable")}},methods:{updateCount:function(){var a=0;for(a=0;a<=this.countMax;a++)this.owner.state["count-"+a]=!1;this.owner.state["count-more"]=!1,this.count>this.countMax?this.owner.state["count-more"]=!0:(this.owner.state["count-"+this.count]=!0,0===this.count&&(this.owner.opacity=.5))},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-mineral",properties:{},publicProperties:{scaleX:1,scaleY:1},constructor:function(a){this.owner.state.uncovered=!1,this.train=null,this.owner.strengthenBy=0,this.screenRelativeX=0,this.screenRelativeY=0,"diamond"==this.owner.type?this.owner.strengthenBy=.75:"topaz"==this.owner.type?this.owner.strengthenBy=.5:this.owner.strengthenBy=.25},events:{"peer-entity-added":function(a){"train"===a.type&&(this.train=a)},"camera-update":function(a){this.screenRelativeX=this.owner.x-(a.viewport.left+a.viewport.width/2),this.screenRelativeY=this.owner.y-(a.viewport.top+a.viewport.height/2)},uncover:function(){var a=null;this.owner.state.uncovered||(this.owner.state.uncovered=!0,this.owner.triggerEvent("rl-pause-updates"),this.train.triggerEvent("strengthen-drill",this.owner.strengthenBy),this.owner.triggerEvent("el-mineral-found",this.owner),a={entType:this.owner.type+"-floating",x:this.screenRelativeX,y:this.screenRelativeY,z:4e3},this.owner.triggerEvent("rl-spawn-floating-mineral",a),this.owner.triggerEvent("destroy-me"))}},methods:{destroy:function(){this.train=null}},publicMethods:{}})}(),function(){"use strict";var a=500;return platypus.createComponentClass({id:"logic-results",properties:{},publicProperties:{},constructor:function(a){this.screenWait=1e3,this.waitingOnScreen=!1,this.fossilWait=0,this.showFossils=!1,this.fossilInfo=null,this.strataIndex=[0,0,0],this.foundCount=0,this.totalCount=0,this.countDone=!1,this.doneWait=2e3,this.continueGame=!1,this.resultsBlind=null;var b=-115,c=-75;this.fossilPositionsX=[[b,b+50,b-50,b+100,b-100,b+150,b-150],[b,b-50,b+50,b-100,b+100,b-150,b+150],[b,b+50,b-50,b+100,b-100,b+150,b-150]],this.fossilPositionsY=[[c-170,c-90,c-90,c-170,c-170,c-90,c-90],[c-5,c+65,c+65,c-5,c-5,c+65,c+65],[c+150,c+220,c+220,c+150,c+150,c+220,c+220]],this.fossils=[]},events:{"peer-entity-added":function(a){"results-blind"==a.type&&(this.resultsBlind=a)},"scene-loaded":function(a){a&&a.totalScore&&(this.totalCount=a.totalScore)},"handle-logic":function(b){var c=b.delta;this.waitingOnScreen&&this.screenWait>0&&(this.screenWait-=c,this.screenWait<=0&&this.owner.triggerEvent("play-results-intro")),this.showFossils&&!this.countDone&&(this.fossilWait-=c,this.fossilWait<=0&&(this.fossilWait=a,this.showAFossil())),this.countDone&&this.doneWait>0&&(this.doneWait-=c,this.doneWait<=0&&this.owner.triggerEvent("play-results-count"))},"show-results":function(a){this.resultsBlind.triggerEvent("show-sprite"),createjs.Tween.get(this.resultsBlind).to({z:2999},1).to({opacity:.6},1e3),createjs.Tween.get(this.owner).to({y:5},1e3,createjs.Ease.cubicInOut),this.waitingOnScreen=!0,this.fossilInfo=a.fossils,this.owner.state["count-0"]=!0,this.owner.state["total-"+a.totalInLevel]=!0,a.totalInLevel==this.fossilInfo.length&&(this.continueGame=!0)},"start-counting":function(){this.showFossils=!0},"say-count-number":function(){this.owner.triggerEvent("play-count-"+this.foundCount)},"place-stamp":function(){var a=null,b=null;a={x:207,y:50,z:3001},b=new platypus.Entity(platypus.game.settings.entities.stamp,{properties:a}),this.owner.parent.addEntity(b),createjs.Tween.get(b).to({scaleX:.8,scaleY:.8},300,createjs.Ease.elasticOut)},"do-closing":function(){this.continueGame?this.owner.triggerEvent("play-results-continue"):this.owner.triggerEvent("play-results-end")},"show-the-button":function(){var a=null,b=null;a={x:447,y:250,z:3001},b=new platypus.Entity(platypus.game.settings.entities["results-button"],{properties:a}),this.owner.parent.addEntity(b),createjs.Tween.get(b).to({opacity:1},500,createjs.Ease.cubicOut)},"unlock-fossil-buttons":function(){var a=0;for(a=0;a<this.fossils.length;a++)this.fossils[a].state.disabled=!1}},methods:{showAFossil:function(){var a=null,b=null,c={},d=0,e=0,f=null;return 0===this.fossilInfo.length?void(this.countDone=!0):(a=this.fossilInfo.splice(0,1)[0],
c[a.name]=!0,"small"==a.size?(d=.5,e=.5):("medium"==a.size||"large"==a.size)&&(d=.35,e=.35),b={x:this.fossilPositionsX[a.strata][this.strataIndex[a.strata]],y:this.fossilPositionsY[a.strata][this.strataIndex[a.strata]],z:3001,scaleX:d,scaleY:e,state:c,onPress:["stop-audio","stop-other-audio",a.audio]},f=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["results-fossil"],{properties:b})),f.state.disabled=!0,this.fossils.push(f),"small"==a.size?createjs.Tween.get(f).to({scaleX:.6,scaleY:.6},200,createjs.Ease.quadOut).to({scaleX:.5,scaleY:.5},200,createjs.Ease.quadIn):createjs.Tween.get(f).to({scaleX:.45,scaleY:.45},200,createjs.Ease.quadOut).to({scaleX:.35,scaleY:.35},200,createjs.Ease.quadIn),this.strataIndex[a.strata]++,this.owner.state["count-"+this.foundCount]=!1,this.foundCount++,this.owner.state["count-"+this.foundCount]=!0,void this.owner.triggerEvent("sfx-fossil-count"))},destroy:function(){this.resultsBlind=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-seeking-mineral",properties:{},publicProperties:{},constructor:function(a){this.destination={x:-460,y:-205}},events:{load:function(a){var b=this;this.owner.triggerEvent("sfx-mineral"),createjs.Tween.get(this.owner).to({scaleX:1,scaleY:1,x:this.owner.x,y:this.owner.y-100},500,createjs.Ease.cubicOut).to({scaleX:.5,scaleY:.5,x:this.destination.x,y:this.destination.y},1e3,createjs.Ease.cubicIn).call(function(){b.reachedDestination()})}},methods:{reachedDestination:function(){this.owner.triggerEvent("rl-unpause-updates"),this.owner.triggerEvent("destroy-me")},destroy:function(){this.destination=null}},publicMethods:{}})}(),function(){"use strict";var a=.2,b=.12,c=.001,d=60,e=.01;return platypus.createComponentClass({id:"logic-train",properties:{},publicProperties:{rotation:270},constructor:function(b){this.moving=!1,this.destination={x:this.owner.x,y:this.owner.y},this.heading={x:0,y:1},this.nextHeading=null,this.velocity=0,this.maxVelocity=a,this.owner.state.idle=!0,this.owner.state.rocking=!1,this.owner.state.digging=!1,this.owner.state.moving=!1,this.owner.state.good=!0,this.owner.state.medium=!1,this.owner.state.bad=!1,this.owner.state.busted=!1,this.input={left:!1,right:!1,up:!1,down:!1},this.theGround=null,this.dirtToDestroy=null,this.owner.drillStrength=1,this.drillBroken=!1,this.beenWarned=!1,this.owner.scaleX=-1,this.currentAudio="",this.endLevelDelay=2e3,this.screenRelativeX=0,this.screenRelativeY=0;var c=this.owner;platypus.components.HandlerCollision.prototype._checkCamera||(platypus.components.HandlerCollision.prototype._checkCamera=platypus.components.HandlerCollision.prototype.checkCamera),platypus.components.HandlerCollision.prototype.checkCamera=function(){var a={width:90,height:90,top:c.y-45,left:c.x-45,buffer:0};this._checkCamera(a)}},events:{"scene-live":function(){this.owner.triggerEvent("el-train-added",this.owner)},"peer-entity-added":function(a){"collision-layer"===a.type&&(this.theGround=a)},"camera-update":function(a){this.screenRelativeX=this.owner.x-(a.viewport.left+a.viewport.width/2),this.screenRelativeY=this.owner.y-(a.viewport.top+a.viewport.height/2)},"handle-logic":function(f){var g=0,h=0,i=[],j=null,k=[],l=[],m=0,n=0,o=0,p=0;for(m=(this.owner.x-d/2)/d,m%1?(k.push(Math.floor(m)*d+d/2),k.push(Math.ceil(m)*d+d/2)):k.push(this.owner.x),n=(this.owner.y-d/2)/d,n%1?(l.push(Math.floor(n)*d+d/2),l.push(Math.ceil(n)*d+d/2)):l.push(this.owner.y),o=0;o<k.length;o++)for(p=0;p<l.length;p++)j=this.owner.parent.checkEarth(k[o],l[p]),j&&"dirt"===j.type&&(i.push(j),j.state.drilled=!0,this.owner.state.digging=!0,this.maxVelocity=b);if(0===i.length&&(this.owner.state.digging=!1),this.ramming&&(-1===this.heading.x&&!this.input.left||1===this.heading.x&&!this.input.right||-1===this.heading.y&&!this.input.up||1===this.heading.y&&!this.input.down||!this.input.left&&!this.input.right&&!this.input.up&&!this.input.down)&&(this.owner.state.ramming=!1,this.ramming=!1,this.destination.x=this.owner.x,this.destination.y=this.owner.y,this.moving=!1),this.moving&&(this.velocity+=c*f.delta,this.velocity>this.maxVelocity&&(this.velocity=this.maxVelocity),this.owner.x+=this.heading.x*this.velocity*f.delta,this.owner.y+=this.heading.y*this.velocity*f.delta,1===this.heading.x&&this.owner.x>=this.destination.x||-1===this.heading.x&&this.owner.x<=this.destination.x||1===this.heading.y&&this.owner.y>=this.destination.y||-1===this.heading.y&&this.owner.y<=this.destination.y)){this.owner.state.moving=!1,this.moving=!1,g=Math.round(this.owner.x/(d/2))*(d/2),h=Math.round(this.owner.y/(d/2))*(d/2);for(var q=0;q<i.length;q++)i[q].x==g&&i[q].y==h&&(this.dirtToDestroy=i[q],this.owner.triggerEvent("weaken-drill",e))}this.moving||this.drillBroken||(this.input.left&&!this.checkForTile(-1,0)?this.nextHeading="left":this.input.right&&!this.checkForTile(1,0)?this.nextHeading="right":this.input.up&&!this.checkForTile(0,-1)?this.nextHeading="up":this.input.down&&!this.checkForTile(0,1)?this.nextHeading="down":(this.nextHeading=null,this.owner.state.rocking&&(this.owner.state.moving=!1)),null===this.nextHeading?(this.velocity=0,this.owner.x=this.destination.x,this.owner.y=this.destination.y):(("left"===this.nextHeading&&-1!=this.heading.x||"right"===this.nextHeading&&1!=this.heading.x||"up"===this.nextHeading&&-1!=this.heading.y||"down"===this.nextHeading&&1!=this.heading.y)&&(this.owner.x=this.destination.x,this.owner.y=this.destination.y),this.getNewDestination())),this.owner.state.busted?("busted"!=this.currentAudio&&(this.owner.triggerEvent("stop-audio"),this.currentAudio="busted",this.owner.triggerEvent("sfx-train-broke")),this.endLevelDelay>0&&(this.endLevelDelay-=f.delta,this.endLevelDelay<=0&&this.owner.triggerEvent("el-end-level"))):this.owner.state.rocking?"rocking"!=this.currentAudio&&(this.owner.triggerEvent("stop-audio"),this.currentAudio="rocking",this.owner.triggerEvent("sfx-train-rocking")):this.owner.state.digging?"digging"!=this.currentAudio&&(this.owner.triggerEvent("stop-audio"),this.currentAudio="digging",this.owner.triggerEvent("sfx-train-digging")):this.owner.state.moving?"moving"!=this.currentAudio&&(this.owner.triggerEvent("stop-audio"),this.currentAudio="moving",this.owner.triggerEvent("sfx-train-moving")):this.owner.state.idle&&"idle"!=this.currentAudio&&(this.owner.triggerEvent("stop-audio"),this.currentAudio="idle",this.owner.triggerEvent("sfx-train-idle")),this.nextHeading=null,this.ramming=!1,this.owner.state.rocking=!1,this.maxVelocity=a},"handle-post-collision-logic":function(){this.dirtToDestroy&&(this.dirtToDestroy.triggerEvent("destroy-me"),this.dirtToDestroy=null)},west:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!0,this.input.right=!1,this.input.up=!1,this.input.down=!1):this.input.left=!1},east:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!1,this.input.right=!0,this.input.up=!1,this.input.down=!1):this.input.right=!1},north:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!1,this.input.right=!1,this.input.up=!0,this.input.down=!1):this.input.up=!1},south:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!1,this.input.right=!1,this.input.up=!1,this.input.down=!0):this.input.down=!1},northwest:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!0,this.input.right=!1,this.input.up=!0,this.input.down=!1):(this.input.left=!1,this.input.up=!1)},southwest:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!0,this.input.right=!1,this.input.up=!1,this.input.down=!0):(this.input.left=!1,this.input.down=!1)},northeast:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!1,this.input.right=!0,this.input.up=!0,this.input.down=!1):(this.input.up=!1,this.input.right=!1)},southeast:function(a){a.pressed||a.event&&("mousemove"==a.event.type||"mousedown"==a.event.type||"touchstart"==a.event.type||"touchmove"==a.event.type)?(this.input.left=!1,this.input.right=!0,this.input.up=!1,this.input.down=!0):(this.input.down=!1,this.input.right=!1)},"hit-solid":function(a){},"hit-rammable-rock":function(a){this.owner.triggerEvent("el-introduce-rock"),this.owner.state.rocking=!0,this.ramming=!0},"hit-rammable-dirt":function(a){this.owner.triggerEvent("el-introduce-hard-dirt"),this.owner.state.rocking=!0,this.ramming=!0},"weaken-drill":function(a){this.owner.drillStrength-=a,this.owner.drillStrength>.6?(this.owner.state.good=!0,this.owner.state.medium=!1,this.owner.state.bad=!1):this.owner.drillStrength>.25?(this.owner.state.good=!1,this.owner.state.medium=!0,this.owner.state.bad=!1):(this.owner.state.good=!1,this.owner.state.medium=!1,this.owner.state.bad=!0),this.beenWarned&&this.owner.drillStrength>.25?this.beenWarned=!1:!this.beenWarned&&this.owner.drillStrength<=.25?(this.beenWarned=!0,this.owner.triggerEvent("el-drill-warning")):this.owner.drillStrength<=0&&(this.owner.drillStrength=0,this.drillBroken=!0,this.owner.state.busted=!0)},"strengthen-drill":function(a){this.owner.drillStrength+=a,this.owner.drillStrength>=1&&(this.owner.drillStrength=1),this.owner.drillStrength>.6?(this.owner.state.good=!0,this.owner.state.medium=!1,this.owner.state.bad=!1):this.owner.drillStrength>.25?(this.owner.state.good=!1,this.owner.state.medium=!0,this.owner.state.bad=!1):(this.owner.state.good=!1,this.owner.state.medium=!1,this.owner.state.bad=!0)},"lock-controls":function(){this.drillBroken=!0},"spawn-kk-repair-location":function(){var a=null;this.owner.triggerEvent("rl-pause-updates"),this.owner.triggerEvent("strengthen-drill",1),a={x:this.screenRelativeX,y:this.screenRelativeY,z:4e3},this.owner.triggerEvent("rl-spawn-kk-repair",a)},"spawn-kk-boom":function(){var a=null;a={x:this.owner.x,y:this.owner.y,z:this.owner.z},this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["kk-boom"],{properties:a})),this.owner.parent.triggerEvent("shake",{xMagnitude:3,yMagnitude:3,xFrequency:7,yFrequency:6,time:750}),this.owner.triggerEvent("sfx-explosion")},"silence-train":function(){this.owner.triggerEvent("stop-audio")}},methods:{checkForTile:function(a,b){var c=Math.floor(this.owner.x/d)+a,e=Math.floor(this.owner.y/d)+b;return this.theGround.isTile(c,e)},getNewDestination:function(){switch(this.owner.state.moving=!0,this.moving=!0,this.nextHeading){case"right":this.rotation=0,this.owner.scaleX=-1,this.heading.x=1,this.heading.y=0,this.destination.x+=this.heading.x*d,this.destination.y+=this.heading.y*d;break;case"left":this.rotation=0,this.owner.scaleX=1,this.heading.x=-1,this.heading.y=0,this.destination.x+=this.heading.x*d,this.destination.y+=this.heading.y*d;break;case"up":this.rotation=90,this.owner.scaleX=-1,this.heading.x=0,this.heading.y=-1,this.destination.x+=this.heading.x*d,this.destination.y+=this.heading.y*d;break;case"down":this.rotation=270,this.owner.scaleX=-1,this.heading.x=0,this.heading.y=1,this.destination.x+=this.heading.x*d,this.destination.y+=this.heading.y*d;break;default:this.owner.x=this.destination.x,this.owner.y=this.destination.y}},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=3e3,b=3e3;return platypus.createComponentClass({id:"logic-troglobite",properties:{},publicProperties:{opacity:1},constructor:function(c){this.fossils=[],this.owner.state.found=!1,this.tilFadeTimer=a,this.fadeTimer=b},events:{"peer-entity-added":function(a){"train"===a.type&&(this.train=a)},"handle-logic":function(a){this.owner.state.found&&(this.tilFadeTimer>0?this.tilFadeTimer-=a.delta:this.fadeTimer>0&&(this.fadeTimer-=a.delta,this.fadeTimer<=0&&(this.fadeTimer=0,this.owner.triggerEvent("destroy-me"))),this.owner.opacity=this.fadeTimer/b)},"found-me":function(a){var b=0,c=null,d=null;if(!this.owner.state.found)for(this.owner.state.found=!0,this.owner.triggerEvent("collide-off"),this.owner.triggerEvent("sfx-trog"),b=0;b<this.fossils.length;b++)c={x:this.train.x,y:this.train.y,z:this.train.z+b+1,fossilTarget:this.fossils[b],train:this.train},d=new platypus.Entity(platypus.game.settings.entities["troglobite-arrow"],{properties:c}),this.owner.parent.addEntity(d)},"fossil-added":function(a){this.fossils.push(a)},"fossil-removed":function(a){var b=0;for(b=0;b<this.fossils.length;b++)if(this.fossils[b]===a)return void this.fossils.splice(b,1)}},methods:{destroy:function(){this.fossils=null,this.train=null}},publicMethods:{}})}(),function(){"use strict";var a=Math.pow(400,2),b=.15,c=Math.pow(100,2),d=8e3,e=.01;return platypus.createComponentClass({id:"logic-troglobite-arrow",properties:{},publicProperties:{rotation:0,train:null,fossilTarget:null},constructor:function(a){this.owner.state.near=!1,this.owner.opacity=0,this.lifeTimer=d,this.opacityLocked=!1,this.owner.scaleX=.1,this.owner.scaleY=.1},events:{load:function(){createjs.Tween.get(this.owner).to({scaleX:1,scaleY:1},1e3,createjs.Ease.elasticOut)},"handle-logic":function(d){var f=0;this.owner.x=this.train.x,this.owner.y=this.train.y,this.lifeTimer-=d.delta,this.lifeTimer<=0&&(this.lifeTimer=0,this.opacityLocked=!0,this.owner.opacity-=e,this.owner.opacity<=0&&(this.owner.opacity=0,this.owner.triggerEvent("destroy-me"))),this.fossilTarget.destroyed?this.owner.triggerEvent("destroy-me"):(f=Math.pow(this.fossilTarget.y-this.owner.y,2)+Math.pow(this.fossilTarget.x-this.owner.x,2),f>a?this.opacityLocked||(this.owner.opacity=b):(this.opacityLocked||(this.owner.opacity=Math.min(1,1-f/a+b)),c>=f?this.owner.state.near=!0:this.owner.state.near=!1),this.owner.rotation=180*Math.atan2(this.fossilTarget.y-this.owner.y,this.fossilTarget.x-this.owner.x)/Math.PI)}},methods:{destroy:function(){this.train=null,this.fossilTarget=null}},publicMethods:{}})}(),function(){"use strict";var a=1,b=2,c=3,d=4,e=40,f=8,g=4,h=2,i=1,j=15,k=12,l=3,m=60,n={strata0:{large:[],medium:[0],small:[0,1,2,3]},strata1:{large:[0],medium:[0],small:[0,1,2,3]},strata2:{large:[],medium:[0],small:[0,1,2,3]}};return platypus.createComponentClass({id:"level-stuffer",properties:{levelParameterSets:[],strataHeight:10,edgeHeight:2},publicProperties:{},constructor:function(a){this.fossilsPlaced=0,this.worldTilesWide=0,this.worldTilesHigh=0,this.troglobites=[0,1,2,3],this.minerals=[],this.fossilCount=1,this.mineralCount=1,this.troglobiteCount=1,this.rockiness=.3,this.earthContents=[]},events:{"world-loaded":function(a){this.worldTilesWide=a.width/a.tile.width,this.worldTilesHigh=a.height/a.tile.height},"child-entity-added":function(a){"collision-layer"==a.type&&(this.theGround=a)},"scene-loaded":function(e){var n=0,o=0,p=0,q=0,r=[],s=0,t=null,u=null,v=0,w=0,x=null,y=null,z="",A=null,B=null,C=null,D=0,E=0,F=null,G=0,H=0,I=0,J=null,K=0,L=0;for(e&&e.levelNumber&&(H=e.levelNumber,H>=this.levelParameterSets.length&&(H=this.levelParameterSets.length-1)),this.fossilCount=this.levelParameterSets[H].fossilCount,this.mineralCount=this.levelParameterSets[H].mineralCount,this.troglobiteCount=this.levelParameterSets[H].troglobiteCount,this.rockiness=this.levelParameterSets[H].rockiness,o=0;o<this.worldTilesHigh;o++)for(n=0;n<this.worldTilesWide;n++)this.theGround.isTile(n,o)||q++;for(n=0;q>n;n++)r[n]=0;for(this.stuffArray(r),y={},this.refillFossils(y),o=0;o<this.worldTilesHigh;o+=2)for(s=Math.floor((o-2)/this.strataHeight),s=Math.max(s,0),s=Math.min(s,2),n=0;n<this.worldTilesWide;n+=2){if(v=0,w=0,this.theGround.isTile(n,o)||(v|=f,w++),this.theGround.isTile(n+1,o)||(v|=g,w++),this.theGround.isTile(n,o+1)||(v|=h,w++),this.theGround.isTile(n+1,o+1)||(v|=i,w++),F=null,F=this.getStuffing(r,w),v&&this.checkStuffing(F,a))for(A=null,x=null,x=(v&j)===j?["large","medium","small"]:(v&k)===k||(v&l)===l?["medium","small"]:["small"];null===A;){for(p=0;p<x.length;p++)if(z=x[p],y["strata"+s][z].length>0&&(I=Math.floor(Math.random()*y["strata"+s][z].length),A=y["strata"+s][z].splice(I,1)[0]),null!==A){"large"==z?(D=(n+1)*m,E=(o+1)*m,v&=~j):"medium"==z&&(v&k)===k?(D=(n+1)*m,E=(o+.5)*m,v&=~k,L=o):"medium"==z&&(v&l)===l?(D=(n+1)*m,E=(o+1.5)*m,v&=~l,L=o+1):v&f?(D=(n+.5)*m,E=(o+.5)*m,v&=~f,K=n,L=o):v&g?(D=(n+1.5)*m,E=(o+.5)*m,v&=~g,K=n+1,L=o):v&h?(D=(n+.5)*m,E=(o+1.5)*m,v&=~h,K=n,L=o+1):v&i&&(D=(n+1.5)*m,E=(o+1.5)*m,v&=~i,K=n+1,L=o+1),u={strata0:!1,strata1:!1,strata2:!1,type0:!1,type1:!1},u["strata"+s]=!0,u["type"+A]=!0,t={x:D,y:E,z:1001,state:u,fossilName:z+"-"+s+"-"+A},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities["fossil-box-"+z],{properties:t})),"fossil-box-large"===J.type?(this.addToEarth(J,n,o),this.addToEarth(J,n+1,o),this.addToEarth(J,n,o+1),this.addToEarth(J,n+1,o+1)):"fossil-box-medium"===J.type?(this.addToEarth(J,n,L),this.addToEarth(J,n+1,L)):this.addToEarth(J,K,L),this.fossilsPlaced++;break}null===A&&(y={},this.refillFossils(y))}if(this.checkStuffing(F,b)&&(v?(C=this.minerals.splice(Math.floor(Math.random()*this.minerals.length),1)[0],v&f?(D=(n+.5)*m,E=(o+.5)*m,v&=~f,K=n,L=o):v&g?(D=(n+1.5)*m,E=(o+.5)*m,v&=~g,K=n+1,L=o):v&h?(D=(n+.5)*m,E=(o+1.5)*m,v&=~h,K=n,L=o+1):v&i&&(D=(n+1.5)*m,E=(o+1.5)*m,v&=~i,K=n+1,L=o+1),u={strata0:!1,strata1:!1,strata2:!1},u["strata"+s]=!0,t={x:D,y:E,z:1001,state:u,toSpawn:["diamond","topaz","ruby"][C]},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities["mineral-box"],{properties:t})),this.addToEarth(J,K,L)):this.pushStuffing(r,b)),this.checkStuffing(F,c)&&(v?(this.troglobites.length>0&&(B=this.troglobites.splice(Math.floor(Math.random()*this.troglobites.length),1)[0]),v&f?(D=(n+.5)*m,E=(o+.5)*m,v&=~f):v&g?(D=(n+1.5)*m,E=(o+.5)*m,v&=~g):v&h?(D=(n+.5)*m,E=(o+1.5)*m,v&=~h):v&i&&(D=(n+1.5)*m,E=(o+1.5)*m,v&=~i),u={troglobite0:!1,troglobite1:!1,troglobite2:!1,troglobite3:!1},u["type"+B]=!0,t={x:D,y:E,z:1001,state:u},this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities.troglobite,{properties:t}))):this.pushStuffing(r,c)),G=this.checkStuffing(F,d),v&&G)for(;G>0;G--)D=-1,E=-1,z="small",(v&j)===j&&3*Math.random()>2?(D=(n+1)*m,E=(o+1)*m,v&=~j,z="large"):v&f?(D=(n+.5)*m,E=(o+.5)*m,v&=~f,K=n,L=o):v&g?(D=(n+1.5)*m,E=(o+.5)*m,v&=~g,K=n+1,L=o):v&h?(D=(n+.5)*m,E=(o+1.5)*m,v&=~h,K=n,L=o+1):v&i&&(D=(n+1.5)*m,E=(o+1.5)*m,v&=~i,K=n+1,L=o+1),-1!=D&&-1!=E&&(u={strata0:!1,strata1:!1,strata2:!1},u["strata"+s]=!0,t={x:D,y:E,z:1001,state:u},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities["rock-"+z],{properties:t})),"rock-large"===J.type?(this.addToEarth(J,n,o),this.addToEarth(J,n+1,o),this.addToEarth(J,n,o+1),this.addToEarth(J,n+1,o+1)):this.addToEarth(J,K,L));v&&(v&f&&(u={},u["strata"+s]=!0,u["T"+Math.floor(3*Math.random())]=!0,t={x:n*m+m/2,y:o*m+m/2,z:1e3,state:u},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities.dirt,{properties:t})),this.addToEarth(J,n,o)),v&g&&(u={},u["strata"+s]=!0,u["T"+Math.floor(3*Math.random())]=!0,t={x:(n+1)*m+m/2,y:o*m+m/2,z:1e3,state:u},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities.dirt,{properties:t})),this.addToEarth(J,n+1,o)),v&h&&(u={},u["strata"+s]=!0,u["T"+Math.floor(3*Math.random())]=!0,t={x:n*m+m/2,y:(o+1)*m+m/2,z:1e3,state:u},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities.dirt,{properties:t})),this.addToEarth(J,n,o+1)),v&i&&(u={},u["strata"+s]=!0,u["T"+Math.floor(3*Math.random())]=!0,t={x:(n+1)*m+m/2,y:(o+1)*m+m/2,z:1e3,state:u},J=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities.dirt,{properties:t})),this.addToEarth(J,n+1,o+1)))}this.fossilsPlaced<this.fossilCount},tick:function(){var a=0,b=0,c=null;for(b=0;b<this.earthContents.length;b++)if(this.earthContents[b])for(a=0;a<this.earthContents[b].length;a++)c=this.earthContents[b][a],c&&0===c.components.length&&(this.earthContents[b][a]=null)}},methods:{addToEarth:function(a,b,c){this.earthContents[c]||(this.earthContents[c]=[]),this.earthContents[c][b]||(this.earthContents[c][b]=a)},checkStuffing:function(a,b){var c=0,d=0;for(c=0;c<a.length;c++)a[c]==b&&d++;return d},pushStuffing:function(a,b){var c=0;for(c=0;c<a.length;c++)if(0===a[c])return void(a[c]=b)},getStuffing:function(a,b){return a.length<b?void 0:a.splice(0,b)},refillFossils:function(a){var b="",c="",d=0;for(b in n){a[b]={};for(c in n[b])for(a[b][c]=[],d=0;d<n[b][c].length;d++)a[b][c][d]=n[b][c][d]}},stuffArray:function(f){var g=0,h=0,i=0,j=0,k=0,l=0,m=0;j=Math.floor(f.length*this.rockiness),this.spaceEvenly(a,this.fossilCount,f),this.spaceEvenly(c,this.troglobiteCount,f),this.spaceEvenly(b,this.mineralCount,f);for(var n=0;n<this.mineralCount;n++)this.minerals.push(n%3);for(k=Math.floor(f.length/e),l=Math.floor(f.length/k),m=Math.floor(j/k),g=0;k>g;g++)for(h=0;m>h;h++)i=Math.floor(Math.random()*l)+l*g,f[i]||(f[i]=d)},spaceEvenly:function(a,b,c){var d=16,e=c.length-d,f=Math.floor(e/b),g=0,h=0,i=2;for(g=0;b>g;g++){if(h=Math.floor(Math.random()*f),2>h?h=2:h>=f-2&&(h=f-3),h+=d+f*g,c[h])for(h>e/2&&(i=-2);c[h];){if(h+=i,h>=e){h=e-1;break}if(0>h){h=0;break}}c[h]=a}},destroy:function(){}},publicMethods:{checkEarth:function(a,b){var c=0,d=0;return c=Math.round((a-m/2)/m),d=Math.round((b-m/2)/m),this.earthContents[d]&&this.earthContents[d][c]?this.earthContents[d][c]:!1}}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-canvas-button",properties:{onPress:null,onRelease:null,onCancel:null,useOnce:!1},publicProperties:{},constructor:function(a){this.owner.state.disabled=!1,this.owner.state.down=!1,this.cancelled=!1,this.used=!1},events:{"handle-logic":function(a){},mousedown:function(a){a.entity===this.owner&&(this.owner.state.down=!0,this.owner.state.disabled||this.useOnce&&this.used||this.onPress&&(this.owner.trigger(this.onPress),this.used=!0))},pressup:function(a){a.entity===this.owner&&(this.owner.state.disabled||this.useOnce&&this.used||(this.cancelled?this.onCancel&&(this.owner.trigger(this.onCancel),this.used=!0):this.onRelease&&(this.owner.trigger(this.onRelease),this.used=!0)),this.owner.state.down=!1,this.cancelled=!1)},mouseover:function(){this.owner.state.down&&(this.cancelled=!1),document.body.style.cursor="pointer"},mouseout:function(){this.owner.state.down&&(this.cancelled=!0),document.body.style.cursor="default"},disable:function(){this.owner.state.disabled=!0},enable:function(){this.owner.state.disabled=!1},"toggle-disabled":function(){this.owner.state.disabled=!this.owner.state.disabled}},methods:{destroy:function(){this.mouseOverCount=0,document.body.style.cursor="default"}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-dirt",properties:{},publicProperties:{},constructor:function(a){this.boomed=!1},events:{load:function(a){},boom:function(a){this.boomed=!0,a?this.owner.triggerEvent("destroy-me"):this.owner.state.drilled=!0},"animation-ended":function(a){this.boomed&&("S0-T0-drilled"==a||"S0-T1-drilled"==a||"S0-T2-drilled"==a||"S1-T0-drilled"==a||"S1-T1-drilled"==a||"S1-T2-drilled"==a||"S2-T0-drilled"==a||"S2-T1-drilled"==a||"S2-T2-drilled"==a)&&this.owner.triggerEvent("destroy-me")}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=.025,b=5;return platypus.createComponentClass({id:"logic-drill-strength-meter",properties:{minRotation:125,maxRotation:415},publicProperties:{rotation:0},constructor:function(a){this.rotationRange=this.maxRotation-this.minRotation,this.train=null,this.rotation=(this.minRotation+this.maxRotation)/2,this.owner.state.warn=!1,this.paused=!1,this.gameOver=!1},events:{"handle-logic":function(c){var d=0,e=0,f=0;this.paused||(d=this.train.drillStrength*this.rotationRange+this.minRotation,e=d-this.rotation,Math.abs(e)<a?this.rotation=d:(f=e/8,Math.abs(f)>b&&(f=f>0?b:-b),this.rotation+=f),this.gameOver?this.owner.state.warn=!1:this.train.drillStrength<=.25?this.owner.state.warn=!0:this.owner.state.warn=!1)},"train-added":function(a){this.train=a},"pause-updates":function(){this.paused=!0},"unpause-updates":function(){this.paused=!1,createjs.Tween.get(this.owner).to({scaleX:1.2,scaleY:1.2},200,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},200,createjs.Ease.quadIn)},"game-over-meter":function(){this.gameOver=!0}},methods:{destroy:function(){this.train=null}},publicMethods:{}})}(),function(){"use strict";var a=3e3;return platypus.createComponentClass({id:"logic-fossil",properties:{},publicProperties:{scaleX:1,scaleY:1},constructor:function(a){switch(this.uncovered=!1,this.owner.fossilAudio=null,this.owner.fossilName){case"small-0-0":this.owner.fossilAudio="play-fossil-calam";break;case"small-0-1":this.owner.fossilAudio="play-fossil-platy";break;case"small-0-2":this.owner.fossilAudio="play-fossil-medul";break;case"small-0-3":this.owner.fossilAudio="play-fossil-eggs";break;case"small-1-0":this.owner.fossilAudio="play-fossil-ammo";break;case"small-1-1":this.owner.fossilAudio="play-fossil-cook";break;case"small-1-2":this.owner.fossilAudio="play-fossil-shells";break;case"small-1-3":this.owner.fossilAudio="play-fossil-barag";break;case"small-2-0":this.owner.fossilAudio="play-fossil-trilobite";break;case"small-2-1":this.owner.fossilAudio="play-fossil-shells";break;case"small-2-2":this.owner.fossilAudio="play-fossil-ophiura";break;case"small-2-3":this.owner.fossilAudio="play-fossil-shells";break;case"medium-0-0":this.owner.fossilAudio="play-fossil-mega";break;case"medium-1-0":this.owner.fossilAudio="play-fossil-ostra";break;case"medium-2-0":this.owner.fossilAudio="play-fossil-anom";break;case"large-1-0":this.owner.fossilAudio="play-fossil-dunk"}},events:{"announce-self":function(){this.owner.triggerEvent("el-fossil-added",this.owner)},uncover:function(){this.uncovered||(this.uncovered=!0,this.owner.triggerEvent("sfx-fossil"),this.owner.z+=a,createjs.Tween.get(this.owner).to({scaleX:1,scaleY:1},2e3,createjs.Ease.elasticOut),createjs.Tween.get(this.owner).to({y:this.owner.y-100},300,createjs.Ease.cubicOut),this.owner.triggerEvent("el-fossil-removed",this.owner),this.owner.triggerEvent("destroy-me"))}},methods:{destroy:function(){}},publicMethods:{}})}();