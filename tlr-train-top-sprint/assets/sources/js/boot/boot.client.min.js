var rpjs={game:{instance:null,settings:null,channel:null,host:null,service:null,rpnId:null,dd:null},appConfig:{debugSources:false,enableLog:false,enableSMLog:false,bustCache:false,logToDiv:false},info:{isServer:false,browserType:"",browserName:"",browserVersion:0,platformType:"",platformVersion:0,touchDevice:false,iDevice:false,canPlayAudio:false,buildTarget:"",legacyIEFilterDOMPipe:false,supports3dTransform:false},util:{assetMap:null},editor:{instance:null,window:null,isEditing:false,isRunningPIE:false,drawDebug:false,selectedActors:[],affectedActors:[]},profiling:{fps:0,textureMemoryUsage:0,memoryUsage:0,textureCount:0,visualActorCount:0,DOMElementCount:0,DOMActorCount:0,actorCount:0,clippedActorCount:0,culledActorCount:0,activeSoundCount:0},event:null,remoteCalls:null,i18n:null};var RPJS_Loader={};RPJS_Loader.getURLParameter=function getURLParameter(name){name=name.replace(/[\[]/i,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results==null)return null;return results[1]};RPJS_Loader.getURLParameters=function getURLParameters(opt_url){var url=opt_url?opt_url.split("?").pop():window.location.search.substring(1);url=decodeURIComponent(url.replace(/\+/g," "));url=url.split("#")[0];var returnParams={};var param;var params=url.split("&");while(param=params.pop()){param=param.split("=");returnParams[param[0]]=param.length>1?param[1]:""}return returnParams};RPJS_Loader.extractExceptionInfo=function extractExceptionInfo(exception){var isIE7=rpjs.info.browserName=="MSIE"&&rpjs.info.browserVersion<=7;var str=!isIE7?exception.toString():exception.name+": "+exception.message;if(typeof exception=="object"){if("sourceURL"in exception){var sourceUrl=exception["sourceURL"].toString();str+=". Source: "+sourceUrl;if("line"in exception){var line=exception["line"].toString();str+=":"+line+" (Line: "+line+")"}}}return str};RPJS_Loader.isAbsoluteUrl=function isAbsoluteUrl(url){return url.indexOf("http://")==0||url.indexOf("https://")==0||url.indexOf("file://")==0};RPJS_Loader.addUrlParam=function addUrlParam(url,param){var bindsign=url.indexOf("?")==-1?"?":"&";return url+bindsign+param};RPJS_Loader.bustCache=function bustCache(url){return RPJS_Loader.addUrlParam(url,"cacheBuster="+Math.floor(Math.random()*1e7))};RPJS_Loader.prependBaseToUrl=function prependBaseToUrl(url,base){console.assert(!RPJS_Loader.isAbsoluteUrl(url),"The url "+url+" is already absolute!");return base+"/"+url};RPJS_Loader.removeAt=function removeAt(array,index){array.splice(index,1)};RPJS_Loader.removeCyclic=function removeCyclic(array,index){array[index]=array[array.length-1];array.pop()};RPJS_Loader.removeElem=function removeElem(array,elem){for(var i=0;i<array.length;i++){if(array[i]===elem){array.splice(i,1);break}}};RPJS_Loader.removeElemCyclic=function removeElemCyclic(array,elem){for(var i=0;i<array.length;i++){if(array[i]===elem){array[i]=array[array.length-1];array.pop();break}}};RPJS_Loader.getIndexOf=function getIndexOf(array,elem){for(var i=0;i<array.length;i++){if(array[i]===elem){return i}}return-1};RPJS_Loader.getElements=function getElements(elemName,opt_scopeElem){var scope=opt_scopeElem?opt_scopeElem:document;if(elemName.length>0){if(elemName.charAt(0)=="#")return document.getElementById(elemName.substring(1));else if(elemName.charAt(0)==".")return scope.getElementsByClassName(elemName.substring(1));else return scope.getElementsByTagName(elemName)}return undefined};RPJS_Loader.getElement=function getElement(elemName,opt_scopeElem){var elems=RPJS_Loader.getElements(elemName);if(elems!=null){if(elems.length>0)return elems.item(0);else return elems}return undefined};RPJS_Loader.addClass=function addClass(element,className){var classCollection=element.className;if(classCollection.length==0){element.className=className;return}var startPos=classCollection==className?0:-1;if(startPos==-1){startPos=classCollection.indexOf(" "+className);if(startPos==-1)startPos=classCollection.indexOf(className+" ")}if(startPos==-1){element.className=classCollection+" "+className}return element};RPJS_Loader.removeClass=function removeClass(element,className){var classCollection=element.className;if(classCollection.length==0){return}var hasSpace=false;var startPos=classCollection==className?0:-1;if(startPos==-1){hasSpace=true;startPos=classCollection.indexOf(" "+className);if(startPos==-1)startPos=classCollection.indexOf(className+" ")}if(startPos!=-1){element.className=classCollection.substr(0,startPos)+classCollection.substr(startPos+className.length+(hasSpace?1:0))}return element};RPJS_Loader.changeClass=function changeClass(element,oldClassName,newClassName){if(oldClassName==newClassName)return;var classCollection=element.className;if(classCollection.length==0){element.className=newClassName;return}var hasSpace=false;var startPos=classCollection==oldClassName?0:-1;if(startPos==-1){hasSpace=true;startPos=classCollection.indexOf(" "+oldClassName);if(startPos==-1)startPos=classCollection.indexOf(oldClassName+" ")}if(startPos==-1){element.className=classCollection+" "+newClassName}else{element.className=classCollection.substr(0,startPos)+classCollection.substr(startPos+oldClassName.length+(hasSpace?1:0))+" "+newClassName}return element};RPJS_Loader.cloneObject=function cloneObject(obj,opt_dataToExtend){if(obj===null||obj===undefined||typeof obj!="object")return obj;var isArray=RPJS_Loader.isObjectArray(obj);var ret=opt_dataToExtend||(isArray?new Array(obj.length):{});if(isArray){for(var i=0;i<obj.length;i++){if(!RPJS_Loader.isObjectFunction(obj[i]))ret[i]=RPJS_Loader.cloneObject(obj[i])}}else{for(var key in obj){if(!RPJS_Loader.isObjectFunction(obj[key]))ret[key]=RPJS_Loader.cloneObject(obj[key])}}return ret};RPJS_Loader.areObjectsEqual=function areObjectsEqual(object1,object2,opt_nonExactComparison){if(object1==null&&object2==null)return true;if(object1==null!=(object2==null))return false;var valueType=typeof object1;if(valueType!=typeof object2)return false;if(valueType=="object"){var isArray1=RPJS_Loader.isObjectArray(object1);var isArray2=RPJS_Loader.isObjectArray(object2);if(isArray1!=isArray2)return false;if(isArray1){if(object1.length!=object2.length)return false;for(var i=0;i<object1.length;i++){if(!RPJS_Loader.areObjectsEqual(object1[i],object2[i]))return false}}for(var valueField in object1){if(!RPJS_Loader.isObjectFunction(object1[valueField])){if(!(valueField in object2)||!RPJS_Loader.areObjectsEqual(object1[valueField],object2[valueField]))return false}}return true}else{if(opt_nonExactComparison)return object1==object2;else return object1===object2}};RPJS_Loader.getTypeOfObject=function getTypeOfObject(obj){var class2type={"[object Array]":"array","[object Boolean]":"boolean","[object Date]":"date","[object Function]":"function","[object Number]":"number","[object Object]":"object","[object RegExp]":"regexp","[object String]":"string"};return obj==null?String(obj):class2type[Object.prototype.toString.call(obj)]||"object"};RPJS_Loader.isObjectFunction=function isObjectFunction(obj){return RPJS_Loader.getTypeOfObject(obj)==="function"};RPJS_Loader.isObjectArray=function isObjectArray(obj){if(Array.isArray)return Array.isArray(obj);return RPJS_Loader.getTypeOfObject(obj)==="array"};RPJS_Loader.getWindowScopeFor=function getWindowScopeFor(typeName){var p=window;while(p){if(typeName in p||p.parent==p)break;p=p.parent}return p};RPJS_Loader.setTag=function setTag(tagType,attributeKeyValuePairs,opt_destElemType,opt_bReuseOldIfExists,opt_identifierAttributeType,opt_identifierAttributeValue){var tag=undefined;if(document.createElement!=undefined){var elemType=opt_destElemType!=undefined?opt_destElemType:"head";if(opt_bReuseOldIfExists)tag=RPJS_Loader.getTag(tagType,elemType,opt_identifierAttributeType,opt_identifierAttributeValue);if(tag==undefined){tag=document.createElement(tagType);if(opt_identifierAttributeType!=undefined)tag[opt_identifierAttributeType]=opt_identifierAttributeValue;for(var attributeName in attributeKeyValuePairs){var attributeValue=attributeKeyValuePairs[attributeName];tag.setAttribute(attributeName,attributeValue)}var elem=RPJS_Loader.getElement(elemType);if(elem.canHaveChildren===undefined||elem.canHaveChildren===true){elem.appendChild(tag)}else{elem=RPJS_Loader.getElement("head");elem.appendChild(tag)}}else{for(var attributeName in attributeKeyValuePairs){var attributeValue=attributeKeyValuePairs[attributeName];tag.setAttribute(attributeName,attributeValue)}}}return tag};RPJS_Loader.getTag=function getTag(tagType,opt_baseElemType,opt_attributeType,opt_attributeValue){var elemType=opt_baseElemType!=undefined?opt_baseElemType:"head";var headElements=document.getElementsByTagName(elemType).item(0);var tagElems=headElements.getElementsByTagName(tagType);for(var i=0;i<tagElems.length;i++){var elem=tagElems[i];if(opt_attributeType==undefined||RPJS_Loader.removeUrlParams(elem.getAttribute(opt_attributeType))==opt_attributeValue){return elem}}return null};RPJS_Loader.removeTag=function removeTag(tagType,opt_baseElemType,opt_attributeType,opt_attributeValue){var elemType=opt_baseElemType!=undefined?opt_baseElemType:"head";var headElements=document.getElementsByTagName(elemType).item(0);var tagElems=headElements.getElementsByTagName(tagType);for(var i=0;i<tagElems.length;i++){var elem=tagElems[i];if(opt_attributeType==undefined||RPJS_Loader.removeUrlParams(elem.getAttribute(opt_attributeType))==opt_attributeValue){elem.parentNode.removeChild(elem)}}};RPJS_Loader.getEngineRootPath=function getEngineRootPath(){if(window["g_host"]===undefined){if(window.location.protocol.indexOf("file:")===0||window.location.pathname.indexOf("/redfox/")!==0)return"assets"}var engineHost=rpjs.game.settings.engineHostName||window.location.hostname;var engineRootPath=window.location.protocol+"//"+engineHost+rpjs.game.settings.engineRootUrl+"/"+rpjs.game.settings.engineVersion;return engineRootPath};RPJS_Loader.makeUrl=function makeUrl(url,bBustCache,opt_baseUrl){if(opt_baseUrl!=undefined&&!RPJS_Loader.isAbsoluteUrl(url)){url=RPJS_Loader.prependBaseToUrl(url,opt_baseUrl)}if(window.location.protocol&&window.location.protocol.indexOf("file:")==0&&!RPJS_Loader.isAbsoluteUrl(url)){if(url.indexOf("/rpjs")==0){url=rpjs.game.settings.engineUrl+url}else{var segments=window.location.pathname.split("/");url="file://"+segments.slice(0,segments.length-1).join("/")+"/"+url}}if(bBustCache)url=RPJS_Loader.bustCache(url);return url};RPJS_Loader.removeUrlParams=function removeUrlParams(url){var newUrl=url;if(url!=null){var q=url.indexOf("?");if(q!=-1)newUrl=url.substring(0,q)}return newUrl};RPJS_Loader.loadSources=function loadSources(fileList,bBustCache,opt_baseUrl,opt_destElemType,opt_parallel,opt_dontWaitForFinish,opt_cb,opt_progressCb){var files=fileList.slice(0);var errors=[];if(files.length==0){if(opt_cb!=undefined)opt_cb(errors);return}var parallelLoadingLeft=files.length;function SetupCyclicLoading(){if(files.length>0){var file=files[0];files.splice(0,1);var attributes={type:"text/javascript",src:file};attributes.src=RPJS_Loader.makeUrl(attributes.src,bBustCache,opt_baseUrl);var tag=RPJS_Loader.setTag("script",attributes,opt_destElemType);function FileDone(){if(opt_progressCb!=undefined)opt_progressCb(attributes.src);if(!opt_parallel){SetupCyclicLoading(fileList.length-(files.length+1),fileList.length)}else if(!opt_dontWaitForFinish){parallelLoadingLeft--;if(parallelLoadingLeft==0){if(opt_cb!=undefined)opt_cb(errors)}}}function LoadSuccess(){if(tag.onload!==undefined)tag.onload=null;else tag.onreadystatechange=null;if(tag.parentNode){tag.parentNode.removeChild(tag)}FileDone()}function LoadError(){tag.onerror=null;var srcFile=tag.getAttribute("src");console.error("Failed to load source "+srcFile);var failure={path:srcFile,error:"The file "+srcFile+" could not be loaded"};errors.push(failure);if(tag.parentNode){tag.parentNode.removeChild(tag)}FileDone()}if(tag.onload!==undefined||tag.onreadystatechange===undefined){tag.onload=LoadSuccess}else if(tag.onreadystatechange!==undefined){tag.onreadystatechange=function(){if(tag.readyState=="complete"||tag.readyState=="loaded")LoadSuccess()}}tag.onerror=LoadError;if(opt_parallel)SetupCyclicLoading()}else{if(!opt_parallel||opt_dontWaitForFinish){if(opt_cb!=undefined)opt_cb(errors)}}}SetupCyclicLoading()};RPJS_Loader.loadCss=function loadCss(fileList,bBustCache,opt_baseUrl,opt_destElemType){var finished=0;for(var i=0;i<fileList.length;i++){var file=fileList[i];var attributes={type:"text/css",media:"screen",rel:"stylesheet",href:file};attributes.href=RPJS_Loader.makeUrl(attributes.href,bBustCache,opt_baseUrl);var tag=RPJS_Loader.setTag("link",attributes,opt_destElemType)}};RPJS_Loader.loadSourcesEval=function loadSourcesEval(fileList,bBustCache,opt_baseUrl,opt_async,opt_evalAllAtOnce,opt_parallel,opt_cb,opt_progressCb){var files=fileList.slice(0);var errors=[];if(files.length==0){if(opt_cb!=undefined)opt_cb(errors);return}var allCode=[];var parallelLoadingLeft=files.length;function SetupCyclicLoading(){function evalCode(path,code){try{if(window.execScript===undefined)eval.call(window,code);else window.execScript(code)}catch(error){error=RPJS_Loader.extractExceptionInfo(error);console.error("Error while evaluating source "+path+": "+error+"\n"+code);var failure={path:path,error:error};errors.push(failure)}}function evalAllCode(){function getSourceForFile(path){for(var i=0;i<allCode.length;i++){if(allCode[i].path==path)return allCode[i].code}return null}for(var i=0;i<fileList.length;i++){var path=RPJS_Loader.removeUrlParams(RPJS_Loader.makeUrl(fileList[i],bBustCache,opt_baseUrl));var code=getSourceForFile(path);if(code!=null&&code.length>0)evalCode(path,code);else console.error("Could not find source "+path)}allCode.length=0;allCode=null}if(files.length>0){var file=files[0];files.splice(0,1);file=RPJS_Loader.makeUrl(file,false,opt_baseUrl);function FileDone(){if(opt_progressCb!=undefined)opt_progressCb(file);if(!opt_parallel){SetupCyclicLoading()}else{parallelLoadingLeft--;if(parallelLoadingLeft==0){if(opt_evalAllAtOnce){if(allCode.length>0)evalAllCode()}if(opt_cb!=undefined)opt_cb(errors)}}}function LoadSuccess(path,responseText){if(opt_evalAllAtOnce)allCode.push({path:RPJS_Loader.removeUrlParams(path),code:responseText});else evalCode(path,responseText);FileDone()}function LoadError(path){var failure={path:path,error:"The file "+path+" could not be loaded"};errors.push(failure);FileDone()}RPJS_Loader.getFile(file,opt_async,bBustCache,LoadSuccess,LoadError);if(opt_parallel)SetupCyclicLoading()}else{if(!opt_parallel){if(opt_evalAllAtOnce){if(allCode.length>0)evalAllCode()}if(opt_cb!=undefined)opt_cb(errors)}}}SetupCyclicLoading()};RPJS_Loader.unloadSources=function unloadSources(fileList){};RPJS_Loader.unloadCSS=function unloadCSS(fileList){};RPJS_Loader.setBase=function setBase(hrefValue){RPJS_Loader.setTag("base",{href:hrefValue},"head",true)};RPJS_Loader.setMetaTag=function setMetaTag(metaName,metaValue){RPJS_Loader.setTag("meta",{content:metaValue},"head",true,"name",metaName)};RPJS_Loader.setTitle=function setTitle(title){RPJS_Loader.setTag("title",{},"head",true).text=title};RPJS_Loader.getFile=function getFile(path,async,bBustCache,opt_cb,opt_cb_failure){if(path!=null){path=RPJS_Loader.makeUrl(path,bBustCache,undefined);RPJS_Loader._getFile(path,async,bBustCache,opt_cb,opt_cb_failure)}else{if(opt_cb!=undefined)opt_cb(null,null)}};RPJS_Loader._getFile=function _getFile(path,async,bBustCache,opt_cb,opt_cb_failure){var xhr;function onXHRDone(){if(xhr.readyState==4){if(xhr.status==200||xhr.status==0&&xhr.responseText){if(opt_cb!=undefined)opt_cb(path,xhr.responseText)}else{console.error("Failed to get file "+path+", status: "+xhr.status);if(opt_cb_failure!=undefined)opt_cb_failure(path)}}}function doXHR(){xhr=new XMLHttpRequest;if(async)xhr.onreadystatechange=onXHRDone;xhr.open("GET",path,async);if(bBustCache&&xhr.setRequestHeader){var requestHost=(new URI(path)).authority;var isSameDomain=!requestHost||window.location.host==requestHost;if(isSameDomain){xhr.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2005 00:00:00 GMT");xhr.setRequestHeader("If-None-Match","dangerzone")}}xhr.send();if(!async)onXHRDone()}function doXDR(){if(window.XDomainRequest){if(!async){console.warn("Attempting to do a CORS request with XDomainRequest in sequential mode - forcing async as XDomainRequest doesn't support sequential requests")}var xdr=new XDomainRequest;xdr.onprogress=function(){};xdr.onload=function(){if(opt_cb!=undefined)opt_cb(path,xdr.responseText)};xdr.onerror=function(){console.error("Failed to load (error): "+path);if(opt_cb_failure!=undefined)opt_cb_failure(path)};xdr.ontimeout=function(){console.error("Failed to load (timeout): "+path);if(opt_cb_failure!=undefined)opt_cb_failure(path)};xdr.timeout=1e4;xdr.open("GET",path);xdr.send()}else{throw new Error("XDR not supported")}}try{doXHR()}catch(e){console.warn("Failed XHR, trying XDR");doXDR()}};RPJS_Loader.loadDeploymentDescriptor=function loadDeploymentDescriptor(options){var dd=options.dd;if(dd!=null){var engineRootPath=RPJS_Loader.getEngineRootPath();function prependPathToSources(sources,path){for(var i=0;i<sources.length;i++){var basePath=sources[i];if(!RPJS_Loader.isAbsoluteUrl(basePath)){sources[i]=path+"/"+basePath}}}if(dd.engine){prependPathToSources(dd.engine.css,engineRootPath);prependPathToSources(dd.engine.libs,engineRootPath);prependPathToSources(dd.engine.js,engineRootPath)}else{dd.engine={css:[],libs:[],js:[]}}var css=dd.engine.css.concat(dd.game?dd.game.css:[]);var libs=dd.engine.libs.concat(dd.game?dd.game.libs:[]);var js=dd.engine.js.concat(dd.game?dd.game.js:[]);var totalDownloaded=0;var totalFilesToLoad=libs.length+js.length;if(console.group)console.group("Loading sources...");function onProgress(url){totalDownloaded++;var pct=totalDownloaded/totalFilesToLoad;console.log(totalDownloaded+"/"+totalFilesToLoad+" "+Math.round(pct*100)+"% "+url);if(pct===1){if(console.groupEnd)console.groupEnd()}if(options.opt_progressCb!=undefined){options.opt_progressCb(pct)}}RPJS_Loader.loadCss(css,options.bBustCache,options.opt_baseUrl,options.tag);RPJS_Loader.loadSources(libs,options.bBustCache,options.opt_baseUrl,options.tag,false,false,function(errors){var errorsJoined=errors;RPJS_Loader.loadSources(js,options.bBustCache,options.opt_baseUrl,options.tag,false,false,function(errors){errorsJoined=errorsJoined.concat(errors);if(options.opt_cb!=undefined)options.opt_cb(errorsJoined)},onProgress)},onProgress)}else{if(options.opt_cb!=undefined)options.opt_cb(dd)}};RPJS_Loader.loadDeploymentDescriptorEval=function loadDeploymentDescriptorEval(options){var dd=options.dd;if(options.dd!=null){var engineRootPath=RPJS_Loader.getEngineRootPath();function prependPathToSources(sources,path){for(var i=0;i<sources.length;i++){var basePath=sources[i];if(!RPJS_Loader.isAbsoluteUrl(basePath)){sources[i]=path+"/"+basePath}}}if(dd.engine){prependPathToSources(dd.engine.css,engineRootPath);prependPathToSources(dd.engine.libs,engineRootPath);prependPathToSources(dd.engine.js,engineRootPath)}else{dd.engine={css:[],libs:[],js:[]}}var css=dd.engine.css.concat(dd.game?dd.game.css:[]);var libs=dd.engine.libs.concat(dd.game?dd.game.libs:[]);var js=dd.engine.js.concat(dd.game?dd.game.js:[]);var totalDownloaded=0;var totalFilesToLoad=libs.length+js.length;if(console.group)console.group("Loading sources...");function onProgress(url){totalDownloaded++;var pct=totalDownloaded/totalFilesToLoad;console.log(totalDownloaded+"/"+totalFilesToLoad+" "+Math.round(pct*100)+"% "+url);if(pct===1){if(console.groupEnd)console.groupEnd()}if(options.opt_progressCb!=undefined){options.opt_progressCb(pct)}}RPJS_Loader.loadCss(css,options.bBustCache,options.opt_baseUrl,options.tag);RPJS_Loader.loadSources(libs,options.bBustCache,options.opt_baseUrl,options.tag,false,false,function(errors){var errorsJoined=errors;RPJS_Loader.loadSourcesEval(js,options.bBustCache,options.opt_baseUrl,options.opt_async,options.opt_evalAllAtOnce,options.opt_parallel,function(errors){errorsJoined=errorsJoined.concat(errors);if(options.opt_cb!=undefined)options.opt_cb(errorsJoined)},onProgress)},onProgress)}else{if(options.opt_cb!=undefined)options.opt_cb(dd)}};RPJS_Loader.__processEventMap=function __processEventMap(map){function processChildren(children){for(var key in children){if(typeof children[key]=="object"){processChildren(children[key])}else{children[key]=key}}}processChildren(map)};RPJS_Loader.__RPJS_LogFlag={None:0,Log:1<<0,Warn:1<<1,Error:1<<2,Assert:1<<3};RPJS_Loader.__setupConsole=function __setupConsole(logFlags){if(window["console"]==undefined)console={};if(console.trace==undefined){console.trace=function trace(){var stackTrace=printStackTrace().join("\n");console.log("Stack trace:\n"+stackTrace)}}if(logFlags!=RPJS_Loader.__RPJS_LogFlagsAll){console.group=function(){}}else if(console.group==undefined){console.group=function group(name){console.log("Started log group: "+name)}}if(logFlags!=RPJS_Loader.__RPJS_LogFlagsAll){console.groupEnd=function(){}}else if(console.groupEnd==undefined){console.groupEnd=function groupEnd(){console.log("End log group")}}function logWriter(level){if(rpjs.appConfig.logToDiv){return function logger(){var loggingDiv=RPJS_Loader.getElement("#rpjsLoggingDiv");if(loggingDiv){var d=new Date;var text=d.toISOString().split("T")[1].split("Z")[0]+" | "+level+": "+(arguments.length>0?arguments[0]:"");loggingDiv.innerText+=text+"\n"}}}return function empty_logger(){}}function stackTraceWriter(){if(rpjs.appConfig.logToDiv){return function logger(){var loggingDiv=RPJS_Loader.getElement("#rpjsLoggingDiv");if(loggingDiv){loggingDiv.innerText+=printStackTrace().join("\n")+"\n"}}}return function empty_logger(){}}if((logFlags&RPJS_Loader.__RPJS_LogFlag.Log)==0||console.log==undefined||rpjs.appConfig.logToDiv){console.log=logWriter("Log")}if((logFlags&RPJS_Loader.__RPJS_LogFlag.Warn)==0||console.warn==undefined||rpjs.appConfig.logToDiv){console.warn=logWriter("Warn")}if((logFlags&RPJS_Loader.__RPJS_LogFlag.Error)==0||console.error==undefined||rpjs.appConfig.logToDiv){console.error=logWriter("Error")}if((logFlags&RPJS_Loader.__RPJS_LogFlag.Error)==0||console.trace==undefined||rpjs.appConfig.logToDiv){console.trace=stackTraceWriter()}if((logFlags&RPJS_Loader.__RPJS_LogFlag.Assert)==0||console.assert==undefined){if((logFlags&RPJS_Loader.__RPJS_LogFlag.Assert)==0){console.assert=function assert(){}}else{console.assert=function assert(){if(arguments.length>0&&!arguments[0]){var str="Assertion failed: "+(arguments.length>1?arguments[1]:"");console.error(str);console.trace()}}}}else{if(rpjs.info.browserName=="Chrome"||rpjs.info.browserName=="Firefox"){console.assert=function assert(){if(arguments.length>0&&!arguments[0]){var str="Assertion failed: "+(arguments.length>1?arguments[1]:"");console.error(str);console.trace()}}}}};RPJS_Loader.__RPJS_LogFlagsAll=RPJS_Loader.__RPJS_LogFlag.Log|RPJS_Loader.__RPJS_LogFlag.Warn|RPJS_Loader.__RPJS_LogFlag.Error|RPJS_Loader.__RPJS_LogFlag.Assert;function URI(str){if(!str)str="";var parser=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/;var result=str.match(parser);this.scheme=result[1]||null;this.authority=result[2]||null;this.path=result[3]||null;this.query=result[4]||null;this.fragment=result[5]||null}URI.prototype.toString=function(){var str="";if(this.scheme){str+=this.scheme+":"}if(this.authority){str+="//"+this.authority}if(this.path){str+=this.path}if(this.query){str+="?"+this.query}if(this.fragment){str+="#"+this.fragment}return str};(function(){function merge(base,rel_path){var dirname=/^(.*)\//;if(base.authority&&!base.path){return"/"+rel_path}else{return base.path.match(dirname)[0]+rel_path}}var DoubleDot=/\/((?!\.\.\/)[^\/]*)\/\.\.\//;function remove_dot_segments(path){if(!path)return"";var newpath=path.replace(/\/\.\//g,"/");newpath=newpath.replace(/\/\.$/,"/");while(newpath.match(DoubleDot)){newpath=newpath.replace(DoubleDot,"/")}newpath=newpath.replace(/\/([^\/]*)\/\.\.$/,"/");while(newpath.match(/\/\.\.\//)){newpath=newpath.replace(/\/\.\.\//,"/")}return newpath}URI.prototype.resolve=function(base){var target=new URI;if(this.scheme){target.scheme=this.scheme;target.authority=this.authority;target.path=remove_dot_segments(this.path);target.query=this.query}else{if(this.authority){target.authority=this.authority;target.path=remove_dot_segments(this.path);target.query=this.query}else{if(!this.path){target.path=base.path;if(this.query){target.query=this.query}else{target.query=base.query}}else{if(this.path.charAt(0)==="/"){target.path=remove_dot_segments(this.path)}else{target.path=merge(base,this.path);target.path=remove_dot_segments(target.path)}target.query=this.query}target.authority=base.authority}target.scheme=base.scheme}target.fragment=this.fragment;return target}})();var f=void 0,h=!0,i=null,k=!1,m,n=n||{};n.V=function(a){n.m(a)};n.m=function(a,b,c){a=a.split(".");c=c||window;!(a[0]in c)&&c.execScript&&c.execScript("var "+a[0]);for(var g;a.length&&(g=a.shift());)!a.length&&b!==f?c[g]=b:c=c[g]?c[g]:c[g]={}};n.o=function(a,b){n.m(a,b,f)};n.n=function(a,b){o[a]=b};n.N=function(a,b){function c(){}c.prototype=b.prototype;a.d=b.prototype;a.prototype=new c;a.prototype.constructor=a;var g={};p(g,b,a);p(a,g)};
n.J=function(a,b,c){var g=arguments.callee.caller;if(g.d)return g.d.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),d=k,j=a.constructor;j;j=j.d&&j.d.constructor)if(j.prototype[b]===g)d=h;else if(d)return j.prototype[b].apply(a,e);if(a[b]===g)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};function r(a){var b={"[object Array]":"array","[object Boolean]":"boolean","[object Date]":"date","[object Function]":"function","[object Number]":"number","[object Object]":"object","[object RegExp]":"regexp","[object String]":"string"};return a==i?String(a):b[Object.prototype.toString.call(a)]||"object"}var s=Array.isArray||function(a){return"array"===r(a)};
function u(a){if(!a||("object"!==r(a)||a.nodeType||a&&"object"===typeof a&&"setInterval"in a)||a.constructor&&!Object.prototype.hasOwnProperty.call(a,"constructor")&&!Object.prototype.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return k;for(var b in a);return b===f||Object.prototype.hasOwnProperty.call(a,b)}
function p(a,b){var c,g,e,d,j,l=arguments[0]||{},q=1,w=arguments.length,t=k;"boolean"===typeof l&&(t=l,l=arguments[1]||{},q=2);"object"!==typeof l&&"function"!==r(l)&&(l={});w===q&&(l=this,--q);for(;q<w;q++)if((c=arguments[q])!=i)for(g in c)e=l[g],d=c[g],l!==d&&(t&&d&&(u(d)||(j=s(d)))?(j?(j=k,e=e&&s(e)?e:[]):e=e&&u(e)?e:{},l[g]=p(t,e,d)):d!==f&&(l[g]=d));return l};if(window.MSApp){var v=Object.getOwnPropertyDescriptor(HTMLElement.prototype,"innerHTML");Object.defineProperty(HTMLElement.prototype,"innerHTML",{set:function(a){var b=this;window.MSApp.execUnsafeLocalFunction(function(){v.set.call(b,a)})},get:function(){return v.get.call(this)}})}function x(a,b,c){c?(a=b||a,RPJS_SetLoadingLabel(a),alert(a)):window.location="unsupported.html"+window.location.search}n.o("RPJS_FatalError",x);var o={};n.o("RPJS_Boot",o);
o.H=function(a){function b(b){return"0"===c[b]?k:"1"===c[b]?h:a[b]||k}var c=RPJS_Loader.getURLParameters(f);rpjs.appConfig.C=b("debugsources");rpjs.appConfig.bustCache=b("bustcache");rpjs.appConfig.enableLog=b("enablelog");rpjs.appConfig.enableSMLog="debug"===rpjs.game.settings.buildConfigName?b("enablesmlog"):k;rpjs.appConfig.netlog=b("netlog");rpjs.appConfig.logToDiv=b("logtodiv");o.g=b("deferGameBoot")};
o.s=function(){window.JSON||(window.JSON={},window.JSON.parse=function(a){var b;try{b=eval("("+a+")")}catch(c){b={},console.error("Failed to parse the string "+a+" as JSON")}return b},window.JSON.stringify=function(a){var b="{",c=0,g;for(g in a)0<c&&(b+=","),b+='"'+g+'":"'+a[g]+'"',c++;return b+"}"})};
o.r=function(){var a=navigator;rpjs.info.platformType=a.platform;rpjs.info.browserName=a.appName;rpjs.info.browserVersion=parseFloat(a.appVersion);rpjs.info.iDevice=k;rpjs.info.touchDevice=k;if(-1!=a.platform.indexOf("iPhone")){if(rpjs.info.iDevice=h,rpjs.info.touchDevice=h,rpjs.info.platformType="iPhone",/OS (\d+\_\d+)/.test(a.userAgent)){var b=RegExp.$1,b=b.replace("_",".");rpjs.info.platformVersion=parseFloat(b)}}else-1!=a.platform.indexOf("iPod")?(rpjs.info.iDevice=h,rpjs.info.touchDevice=h,rpjs.info.platformType=
"iPod",/OS (\d+\_\d+)/.test(a.userAgent)&&(b=RegExp.$1,b=b.replace("_","."),rpjs.info.platformVersion=parseFloat(b))):-1!=a.platform.indexOf("iPad")?(rpjs.info.iDevice=h,rpjs.info.touchDevice=h,rpjs.info.platformType="iPad",/OS (\d+\_\d+)/.test(a.userAgent)&&(b=RegExp.$1,b=b.replace("_","."),rpjs.info.platformVersion=parseFloat(b))):-1!=a.userAgent.indexOf("Kindle")?(b=-1!=a.userAgent.indexOf("Kindle Fire"),rpjs.info.touchDevice=b,rpjs.info.platformType=b?"Kindle Fire":"Kindle",/Android (\d+\.\d+)/.test(a.userAgent)&&
(rpjs.info.platformVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("Android")?(rpjs.info.touchDevice=h,rpjs.info.platformType="Android",/Android (\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.platformVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("IEMobile")?(rpjs.info.touchDevice=h,rpjs.info.platformType="IEMobile",/IEMobile\/(\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.platformVersion=parseFloat(RegExp.$1))):-1!=a.platform.indexOf("Win")?(rpjs.info.platformType="Win",rpjs.info.platformVersion=
0):-1!=a.platform.indexOf("Mac")?(rpjs.info.platformType="Mac",/OS X (\d+\_\d+)/.test(a.userAgent)&&(b=RegExp.$1,b=b.replace("_","."),rpjs.info.platformVersion=parseFloat(b))):-1!=a.platform.indexOf("Linux")&&(rpjs.info.platformType="Linux",rpjs.info.platformVersion=0);-1!=a.userAgent.indexOf("Firefox")?(rpjs.info.browserName="Firefox",/Firefox[\/\s](\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("MSIE")?(rpjs.info.msTouchDevice=0<a.msMaxTouchPoints,
rpjs.info.browserName="MSIE",/MSIE (\d+\.\d+);/.test(a.userAgent)&&(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("Opera")?(rpjs.info.browserName="Opera",/Opera[\/\s](\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("Chrome")?(rpjs.info.browserName="Chrome",/Chrome[\/\s](\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("CriOS")?(rpjs.info.browserName="Chrome",/CriOS[\/\s](\d+\.\d+)/.test(a.userAgent)&&
(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("Safari")?(rpjs.info.browserName="Safari",/Version[\/\s](\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("Netscape")?(rpjs.info.browserName="Netscape",/Netscape[\/\s](\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.browserVersion=parseFloat(RegExp.$1))):-1!=a.userAgent.indexOf("Konqueror")?(rpjs.info.browserName="Konqueror",/KHTML[\/\s](\d+\.\d+)/.test(a.userAgent)&&(rpjs.info.browserVersion=
parseFloat(RegExp.$1))):rpjs.info.iDevice&&(rpjs.info.browserName="Safari");rpjs.info.browserType=-1!=a.userAgent.indexOf("WebKit")?"WebKit":rpjs.info.browserName;rpjs.info.legacyIEFilterDOMPipe="MSIE"==rpjs.info.browserName&&9>rpjs.info.browserVersion?h:k;a=window.WebKitCSSMatrix||window.MSCSSMatrix||window.MozCSSMatrix||window.OCSSMatrix;rpjs.info.supports3dTransform=a!=f&&(new a).m11!=f?h:k};
o.t=function(){for(var a=0;a<rpjs.game.settings.browserSettings.D.length;a++){var b=rpjs.game.settings.browserSettings.D[a];if((!b.browserType||rpjs.info.browserName==b.browserType)&&(!b.platformType||rpjs.info.platformType==b.platformType)){if(0>b.G)break;return rpjs.info.browserVersion<b.G?"old":"supported"}}return"unsupported"};
o.z=function(){function a(){RPJS_Loader.setMetaTag("viewport","width="+(0==window.orientation||180==window.orientation||!rpjs.info.iDevice?"device-width":"device-height")+", user-scalable="+(rpjs.game.settings.touchSettings.X?"yes":"no")+", initial-scale="+rpjs.game.settings.touchSettings.F+", minimum-scale="+rpjs.game.settings.touchSettings.F+", maximum-scale="+rpjs.game.settings.touchSettings.P)}function b(){a()}"onorientationchange"in window&&(window.onorientationchange=b);a()};
o.q=function(){try{window.onerror!==f&&(window.onerror=function(a,b,e){x("Uncaught exception in "+b+":"+e+" (Line: "+e+"): "+a)});var a=RPJS_Loader.getURLParameter("logtodiv");rpjs.appConfig.logToDiv="1"==a;RPJS_Loader.__setupConsole(RPJS_Loader.__RPJS_LogFlagsAll);RPJS_SetLoadingLabel("Loading game");o.s();RPJS_Loader.getFile("definitions.client.json",k,h,function(a,b){var e=JSON.parse(b);rpjs.game.settings=e.L;rpjs.game.dd=e.dd;rpjs.util.B=e.assetMap;rpjs.util.l=e.l;o.H(e.K);o.r();RPJS_Loader.__setupConsole(rpjs.appConfig.enableLog?
RPJS_Loader.__RPJS_LogFlagsAll:RPJS_Loader.__RPJS_LogFlag.Error|RPJS_Loader.__RPJS_LogFlag.Assert);RPJS_Loader.setTitle(rpjs.game.settings.title+" "+rpjs.game.settings.version);RPJS_Loader.setTag("meta",{name:"description",content:rpjs.game.settings.description});RPJS_Loader.setTag("link",{rel:"icon",type:"image/png",href:"assets/images/icon_16.png"});RPJS_Loader.setTag("link",{rel:"apple-touch-icon",type:"image/png",href:"assets/images/icon_50.png"});e=o.t();if("supported"==e){rpjs.info.touchDevice&&
o.z();var d=window.onresize;window.onresize=function(){d&&"function"==typeof d&&d();rpjs.game.instance&&rpjs.game.instance.__resize()};var j=window.onunload;window.onunload=function(){j&&"function"==typeof j&&j();rpjs.game.instance&&RPJS_Game.destroy()};o.w=h}else"old"==e?(console.error("Too low browser version!"),window.location="lowversion.html"+window.location.search):(console.error("Browser not supported!"),window.location="unsupported.html"+window.location.search)},function(a){x("Failed to get game settings "+
a,"Failed to launch game",h)})}catch(b){x("Fatal error booting game: "+RPJS_Loader.extractExceptionInfo(b),"Failed to launch game")}};n.n("__RPJS_PreEntryPoint",o.q);
o.p=function(a){try{if(o.w===h){RPJS_Loader.getEngineRootPath();var b=0,c=function(a){b=a;RPJS_SetLoadingProgress(b)};window.SM2_DEFER=h;var g=function(d){function c(d){if(!e){e=h;rpjs.info.canPlayAudio=h;if(!d||!d.success)rpjs.info.canPlayAudio=k;window.onerror=i;rpjs.game.settings.useNetwork&&!o.g?(RPJS_SetLoadingLabel("Talking to identity service"),rpjs.game.rpnId=new RPJS_Client_RPN_Id({requireLogin:rpjs.game.settings.Identity.requireLogin,U:function(){RPJS_SetLoadingProgress(b);o.j(a)},T:function(a){x("Failed to log user in to RPN, reason: "+
RPJS_Loader.extractExceptionInfo(a),"Failed to launch game",h)}}),rpjs.game.settings.Identity.requireLogin&&!rpjs.game.rpnId.O()&&RPJS_ShowSpinner()):o.j(a)}}d!=i&&0<d.length&&x("Failed to load "+d.length+" game files","Failed to launch game",h);rpjs.util.assetMap.data=rpjs.util.B;rpjs.event.custom=rpjs.util.l;RPJS_Loader.__processEventMap(rpjs.event);RPJS_InitDefaultSchemaFilters();RPJS_SetLoadingLabel("Setting up libraries");var e=k;"PhoneGap"!=rpjs.info.buildTarget?(d=window.soundManager=new SoundManager,
d.url="1"==RPJS_Loader.getURLParameter("deferGameBoot")?rpjs.game.settings.engineRootUrl+"/"+rpjs.game.settings.engineVersion+"/sources/lib/vendor/soundmanager2/":"assets/sources/lib/vendor/soundmanager2/",d.consoleOnly=h,d.useHTML5Audio=h,d.flashLoadTimeout=2500,d.useHighPerformance=h,d.wmode="transparent",d.debugMode=rpjs.appConfig.enableSMLog,d.preferFlash=rpjs.game.settings.preferFlashForSMAudio,d.flashVersion=rpjs.game.settings.flashSMAudioRequiredVersion,d.audioFormats.mp3.required=rpjs.game.settings.requiredSMAudioCodecs.Q,
d.audioFormats.mp4.required=rpjs.game.settings.requiredSMAudioCodecs.R,d.audioFormats.ogg.required=rpjs.game.settings.requiredSMAudioCodecs.S,d.audioFormats.wav.required=rpjs.game.settings.requiredSMAudioCodecs.Y,d.beginDelayedInit(),d.onready(c),d.ontimeout(c)):c({success:h})};rpjs.appConfig.C?RPJS_Loader.loadDeploymentDescriptor({dd:rpjs.game.dd,tag:"#rpjsSources",bBustCache:rpjs.appConfig.bustCache,opt_cb:g,opt_progressCb:c}):RPJS_Loader.loadDeploymentDescriptorEval({dd:rpjs.game.dd,tag:"#rpjsSources",
bBustCache:rpjs.appConfig.bustCache,opt_async:h,opt_evalAllAtOnce:h,opt_parallel:h,opt_cb:g,opt_progressCb:c})}}catch(e){x("Fatal error booting game: "+RPJS_Loader.extractExceptionInfo(e),"Failed to launch game")}};n.n("__RPJS_EntryPoint",o.p);
o.j=function(a){RPJS_SetLoadingLabel("Creating game");RPJS_ShowSpinner();if(rpjs.info.touchDevice)rpjs.game.settings.pauseUpdateWhenFocusLost=h,"PhoneGap"!=rpjs.info.buildTarget&&(window.onpagehide=function(){rpjs.game.instance&&rpjs.game.instance.__focusLost()},window.onpageshow=function(){rpjs.game.instance&&rpjs.game.instance.__focusGained()});else if("MSIE"==rpjs.info.browserName&&8>=rpjs.info.browserVersion){var b=document.activeElement;document.onfocusout=function(){(b==document.activeElement||
b==document.body||document.activeElement==document.body)&&rpjs.game.instance&&rpjs.game.instance.__focusLost();b=document.activeElement};document.onfocusin=function(){rpjs.game.instance&&rpjs.game.instance.__focusGained()}}else window.onblur=function(){rpjs.game.instance&&rpjs.game.instance.__focusLost()},window.onfocus=function(){rpjs.game.instance&&rpjs.game.instance.__focusGained()};rpjs.game.settings.autoLoadAssets&&RPJS_SetLoadingLabel("Loading assets");RPJS_Game.create({managers:rpjs.game.dd&&
!o.g?rpjs.game.dd.managers:i,autoLoadAssets:rpjs.game.settings.autoLoadAssets,startScene:rpjs.game.settings.startScene!=i&&!o.g?rpjs.game.settings.startScene:i,finishedCallback:function(){RPJS_SetLoadingLabel("Done!");o.A=new y(RPJS_Loader.getElement(rpjs.game.settings.screenElemSelector));o.A.hide();o.I=h;a!=f&&(a(),a=f);window.RPJS_Boot___externalCallback&&(window.RPJS_Boot___externalCallback(),window.RPJS_Boot___externalCallback=f)},failureCallback:function(a){x("Failed to initialize game. Reason: "+
a,"Failed to launch game",h)}})};function y(a,b){this.k=a;this.a=b||window;this.hidden=k;this.height=60;this.e=this.a.document.ontouchstart;if(this.f()){var c=this,g=this.a.onresize;this.a.onresize=function(a){if(!c.c||250<=(new Date).getTime()-c.c)g&&"function"==typeof g&&g(a),c.u()};var e=this.a.onscroll;this.a.onscroll=function(a){e&&"function"==typeof e&&e(a);c.v()}}}m=y.prototype;m.h=function(){return this.a.document.documentElement.clientHeight==this.a.screen.width};
m.u=function(){this.b&&(this.a.clearTimeout(this.b),this.b=i);var a=this;this.b=this.a.setTimeout(function(){a.hidden||a.h()?(a.hidden=k,a.hide()):(a.hidden=h,a.show());a.b=i},500)};m.v=function(){this.hidden&&this.c&&250<=(new Date).getTime()-this.c&&!this.b&&0==(this.a.document.documentElement.scrollTop||this.a.document.body.scrollTop)&&this.show()};
m.show=function(){if(this.hidden&&this.f()){this.hidden=k;this.k.style.height=this.a.document.documentElement.clientHeight-(this.h()?this.height:0)+"px";this.a.scrollTo(0,0);this.i();var a=this;this.a.document.ontouchstart=function(b){a.e&&a.e(b);a.hide()}}};m.hide=function(){!this.hidden&&this.f()&&(this.hidden=h,this.k.style.height=this.a.document.documentElement.clientHeight+(!this.h()?this.height:0)+"px",this.a.scrollTo(0,1),this.i(),this.a.document.ontouchstart=this.e)};
m.f=function(){return rpjs.info.touchDevice&&rpjs.game.settings.touchSettings.M&&!this.a.navigator.W&&"PhoneGap"!==rpjs.info.buildTarget&&"Safari"===rpjs.info.browserName&&("iPhone"===rpjs.info.platformType||"iPod"===rpjs.info.platformType)};m.i=function(){rpjs.game.instance.__resize();this.c=(new Date).getTime()};
