var Utils;(function(Utils){var AssetLoader=(function(){function AssetLoader(_lang,_aFileData,_ctx,_canvasWidth,_canvasHeight,_showBar){var _this=this;if(_showBar===void 0){_showBar=true;}
this.oAssetData={};this.assetsLoaded=0;this.textData={};this.scale=1;this.aPreloaderBar=new Array();this.totalAssets=_aFileData.length;this.loaderSequence=0;for(var i=0;i<_aFileData.length;i++){if(_aFileData[i].file.indexOf(".json")!=-1){this.loadJSON(_aFileData[i]);}
else{this.loadImage(_aFileData[i]);}}
this.showBar=_showBar;if(this.showBar){this.oLoaderAssetsImgData=preAssetLib.getData("loaderAssets");this.oLoaderBgImgData=preAssetLib.getData("loaderBg");this.bouncerY=-200;this.logoY=0;TweenLite.to(this,1,{bouncerY:canvas.height-270-this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bouncer].height,ease:"Cubic.easeIn",onComplete:function(){TweenLite.to(_this,.2,{logoY:25,ease:"Circ.easeOut",onComplete:function(){TweenLite.to(_this,.3,{logoY:0,ease:"Back.easeOut"});}});TweenLite.to(_this,1,{bouncerY:-200,ease:"Cubic.easeOut",onComplete:function(){_this.addSequence();}});}});}}
AssetLoader.prototype.addSequence=function(){if(++this.loaderSequence>=2){this.loadedCallback();}};AssetLoader.prototype.render=function(){ctx.fillStyle="#FFEA00";ctx.fillRect(0,0,canvas.width,canvas.height);if(canvas.width>canvas.height){ctx.fillStyle="#FFD101";ctx.fillRect(canvas.width/2,0,canvas.width/2,canvas.height);}
ctx.drawImage(this.oLoaderBgImgData.img,0,0,this.oLoaderBgImgData.img.width,this.oLoaderBgImgData.img.height,canvas.width/2-(this.oLoaderBgImgData.img.width/2),canvas.height-(this.oLoaderBgImgData.img.height),this.oLoaderBgImgData.img.width,this.oLoaderBgImgData.img.height);var bX=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.logo].x;var bY=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.logo].y;var bWidth=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.logo].width;var bHeight=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.logo].height;ctx.drawImage(this.oLoaderAssetsImgData.img,bX,bY,bWidth,bHeight,canvas.width/2-bWidth/2,canvas.height-313+this.logoY,bWidth,bHeight);var bX=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bouncer].x;var bY=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bouncer].y;var bWidth=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bouncer].width;var bHeight=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bouncer].height;ctx.drawImage(this.oLoaderAssetsImgData.img,bX,bY,bWidth,bHeight,canvas.width/2-bWidth/2,this.bouncerY,bWidth,bHeight);var bX=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bgTop].x;var bY=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bgTop].y;var bWidth=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bgTop].width;var bHeight=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.bgTop].height;ctx.drawImage(this.oLoaderAssetsImgData.img,bX,bY,bWidth,bHeight,canvas.width/2-bWidth/2,canvas.height-bHeight,bWidth,bHeight);var bX=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar0].x;var bY=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar0].y;var bWidth=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar0].width;var bHeight=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar0].height;ctx.drawImage(this.oLoaderAssetsImgData.img,bX,bY,bWidth,bHeight,canvas.width/2-bWidth/2,canvas.height-170,bWidth,bHeight);var bX=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar1].x;var bY=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar1].y;var bWidth=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar1].width;var bHeight=this.oLoaderAssetsImgData.oData.oAtlasData[oImageIds.loaderBar1].height;ctx.drawImage(this.oLoaderAssetsImgData.img,bX,bY,bWidth*Math.max(this.assetsLoaded/this.totalAssets,.01),bHeight,canvas.width/2-bWidth/2,canvas.height-157,bWidth*Math.max(this.assetsLoaded/this.totalAssets,.01),bHeight);};AssetLoader.prototype.displayNumbers=function(){ctx.textAlign="left";ctx.font="bold 40px arial";ctx.fillStyle="#ffffff";ctx.fillText(Math.round((this.assetsLoaded/this.totalAssets)*100)+"%",canvas.width/2+0,canvas.height/2+51);};AssetLoader.prototype.loadExtraAssets=function(_callback,_aFileData){this.showBar=false;this.totalAssets=_aFileData.length;this.assetsLoaded=0;this.loadedCallback=_callback;for(var i=0;i<_aFileData.length;i++){if(_aFileData[i].file.indexOf(".json")!=-1){this.loadJSON(_aFileData[i]);}
else{this.loadImage(_aFileData[i]);}}};AssetLoader.prototype.loadJSON=function(_oData){var _this=this;var xobj=new XMLHttpRequest();xobj.open('GET',_oData.file,true);xobj.onreadystatechange=function(){if(xobj.readyState==4&&xobj.status==200){_this.textData[_oData.id]=JSON.parse(xobj.responseText);++_this.assetsLoaded;_this.checkLoadComplete();}};xobj.send(null);};AssetLoader.prototype.loadImage=function(_oData){var _this=this;var img=new Image();img.onload=function(){_this.oAssetData[_oData.id]={};_this.oAssetData[_oData.id].img=img;_this.oAssetData[_oData.id].oData={};var aSpriteSize=_this.getSpriteSize(_oData.file);if(aSpriteSize[0]!=0){_this.oAssetData[_oData.id].oData.spriteWidth=aSpriteSize[0];_this.oAssetData[_oData.id].oData.spriteHeight=aSpriteSize[1];}
else{_this.oAssetData[_oData.id].oData.spriteWidth=_this.oAssetData[_oData.id].img.width;_this.oAssetData[_oData.id].oData.spriteHeight=_this.oAssetData[_oData.id].img.height;}
if(_oData.oAnims){_this.oAssetData[_oData.id].oData.oAnims=_oData.oAnims;}
if(_oData.oAtlasData){_this.oAssetData[_oData.id].oData.oAtlasData=_oData.oAtlasData;}
else{_this.oAssetData[_oData.id].oData.oAtlasData={none:{x:0,y:0,width:_this.oAssetData[_oData.id].oData.spriteWidth,height:_this.oAssetData[_oData.id].oData.spriteHeight}};}
++_this.assetsLoaded;_this.checkLoadComplete();};img.src=_oData.file;};AssetLoader.prototype.getSpriteSize=function(_file){var aNew=new Array();var sizeY="";var sizeX="";var stage=0;var inc=_file.lastIndexOf(".");var canCont=true;while(canCont){inc--;if(stage==0&&this.isNumber(_file.charAt(inc))){sizeY=_file.charAt(inc)+sizeY;}
else if(stage==0&&sizeY.length>0&&_file.charAt(inc)=="x"){inc--;stage=1;sizeX=_file.charAt(inc)+sizeX;}
else if(stage==1&&this.isNumber(_file.charAt(inc))){sizeX=_file.charAt(inc)+sizeX;}
else if(stage==1&&sizeX.length>0&&_file.charAt(inc)=="_"){canCont=false;aNew=[parseInt(sizeX),parseInt(sizeY)];}
else{canCont=false;aNew=[0,0];}}
return aNew;};AssetLoader.prototype.isNumber=function(n){return!isNaN(parseFloat(n))&&isFinite(n);};AssetLoader.prototype.checkLoadComplete=function(){if(this.assetsLoaded==this.totalAssets){if(this.showBar){this.addSequence();}
else{this.loadedCallback();}}};AssetLoader.prototype.onReady=function(_func){this.loadedCallback=_func;};AssetLoader.prototype.getImg=function(_id){return this.oAssetData[_id].img;};AssetLoader.prototype.getData=function(_id){return this.oAssetData[_id];};return AssetLoader;}());Utils.AssetLoader=AssetLoader;})(Utils||(Utils={}));var Utils;(function(Utils){var AnimSprite=(function(){function AnimSprite(_oImgData,_fps,_radius,_animId){this.x=0;this.y=0;this.rotation=0;this.radius=10;this.removeMe=false;this.frameInc=0;this.animType="loop";this.offsetX=0;this.offsetY=0;this.scaleX=1;this.scaleY=1;this.alpha=1;this.oImgData=_oImgData;this.oAnims=this.oImgData.oData.oAnims;this.fps=_fps;this.radius=_radius;this.animId=_animId;this.centreX=Math.round(this.oImgData.oData.spriteWidth/2);this.centreY=Math.round(this.oImgData.oData.spriteHeight/2);}
AnimSprite.prototype.updateAnimation=function(_delta){this.frameInc+=this.fps*_delta;};AnimSprite.prototype.changeImgData=function(_newImgData,_animId){this.oImgData=_newImgData;this.oAnims=this.oImgData.oData.oAnims;this.animId=_animId;this.centreX=Math.round(this.oImgData.oData.spriteWidth/2);this.centreY=Math.round(this.oImgData.oData.spriteHeight/2);this.resetAnim();};AnimSprite.prototype.resetAnim=function(){this.frameInc=0;};AnimSprite.prototype.setFrame=function(_frameNum){this.fixedFrame=_frameNum;};AnimSprite.prototype.setAnimType=function(_type,_animId,_reset){if(_reset===void 0){_reset=true;}
this.animId=_animId;this.animType=_type;if(_reset){this.resetAnim();}
switch(_type){case "loop":break;case "once":this.maxIdx=this.oAnims[this.animId].length-1;break;}};AnimSprite.prototype.render=function(_ctx){_ctx.save();_ctx.translate(this.x,this.y);_ctx.rotate(this.rotation);_ctx.scale(this.scaleX,this.scaleY);_ctx.globalAlpha=this.alpha;if(this.animId!=null){var max=this.oAnims[this.animId].length;var idx=Math.floor(this.frameInc);this.curFrame=this.oAnims[this.animId][idx%max];var imgX=(this.curFrame*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;if(this.animType=="once"){if(idx>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][max-1];this.animId=null;if(this.animEndedFunc!=null){this.animEndedFunc();}
var imgX=(this.fixedFrame*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;}}}
else{var imgX=(this.fixedFrame*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;}
_ctx.drawImage(this.oImgData.img,imgX,imgY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.centreX+this.offsetX,-this.centreY+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight);_ctx.restore();};AnimSprite.prototype.renderSimple=function(_ctx){if(this.animId!=null){var max=this.oAnims[this.animId].length;var idx=Math.floor(this.frameInc);this.curFrame=this.oAnims[this.animId][idx%max];var imgX=(this.curFrame*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;if(this.animType=="once"){if(idx>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][max-1];this.animId=null;if(this.animEndedFunc!=null){this.animEndedFunc();}
var imgX=(this.fixedFrame*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;}}}
else{var imgX=(this.fixedFrame*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;}
_ctx.drawImage(this.oImgData.img,imgX,imgY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,this.x-(this.centreX-this.offsetX)*this.scaleX,this.y-(this.centreY-this.offsetY)*this.scaleY,this.oImgData.oData.spriteWidth*this.scaleX,this.oImgData.oData.spriteHeight*this.scaleY);};return AnimSprite;}());Utils.AnimSprite=AnimSprite;})(Utils||(Utils={}));var Utils;(function(Utils){var BasicSprite=(function(){function BasicSprite(_oImgData,_radius,_frame){if(_frame===void 0){_frame=0;}
this.x=0;this.y=0;this.rotation=0;this.radius=10;this.removeMe=false;this.offsetX=0;this.offsetY=0;this.scaleX=1;this.scaleY=1;this.oImgData=_oImgData;this.radius=_radius;this.setFrame(_frame);}
BasicSprite.prototype.setFrame=function(_frameNum){this.frameNum=_frameNum;};BasicSprite.prototype.render=function(_ctx){_ctx.save();_ctx.translate(this.x,this.y);_ctx.rotate(this.rotation);_ctx.scale(this.scaleX,this.scaleY);var imgX=(this.frameNum*this.oImgData.oData.spriteWidth)%this.oImgData.img.width;var imgY=Math.floor(this.frameNum/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;_ctx.drawImage(this.oImgData.img,imgX,imgY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.oImgData.oData.spriteWidth/2+this.offsetX,-this.oImgData.oData.spriteHeight/2+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight);_ctx.restore();};return BasicSprite;}());Utils.BasicSprite=BasicSprite;})(Utils||(Utils={}));var Utils;(function(Utils){var UserInput=(function(){function UserInput(_canvas,_isBugBrowser){var _this=this;this.prevHitTime=0;this.pauseIsOn=false;this.isDown=false;this.isBugBrowser=_isBugBrowser;this.keyDownEvtFunc=function(e){_this.keyDown(e);};this.keyUpEvtFunc=function(e){_this.keyUp(e);};_canvas.addEventListener('contextmenu',function(event){return event.preventDefault();});_canvas.addEventListener("touchstart",function(e){for(var i=0;i<e.changedTouches.length;i++){_this.hitDown(e,e.changedTouches[i].pageX,e.changedTouches[i].pageY,e.changedTouches[i].identifier);}},false);_canvas.addEventListener("touchend",function(e){for(var i=0;i<e.changedTouches.length;i++){_this.hitUp(e,e.changedTouches[i].pageX,e.changedTouches[i].pageY,e.changedTouches[i].identifier);}},false);_canvas.addEventListener("touchcancel",function(e){for(var i=0;i<e.changedTouches.length;i++){_this.hitCancel(e,e.changedTouches[i].pageX,e.changedTouches[i].pageY,e.changedTouches[i].identifier);}},false);_canvas.addEventListener("touchmove",function(e){for(var i=0;i<e.changedTouches.length;i++){_this.move(e,e.changedTouches[i].pageX,e.changedTouches[i].pageY,e.changedTouches[i].identifier,true);}},false);_canvas.addEventListener("mousedown",function(e){_this.isDown=true;_this.hitDown(e,e.pageX,e.pageY,1);},false);_canvas.addEventListener("mouseup",function(e){_this.isDown=false;_this.hitUp(e,e.pageX,e.pageY,1);},false);_canvas.addEventListener("mousemove",function(e){_this.move(e,e.pageX,e.pageY,1,_this.isDown);},false);_canvas.addEventListener("mouseout",function(e){if(e.button==2){return;}
clearButtonOvers();_this.isDown=false;_this.hitCancel(e,Math.abs(e.pageX),Math.abs(e.pageY),1);},false);this.aHitAreas=new Array();this.aKeys=new Array();}
UserInput.prototype.hitDown=function(e,_posX,_posY,_identifer){e.preventDefault();e.stopPropagation();if(!hasFocus){visibleResume();}
if(this.pauseIsOn){return;}
var curHitTime=new Date().getTime();_posX*=canvasScale;_posY*=canvasScale;for(var i=0;i<this.aHitAreas.length;i++){if(this.aHitAreas[i].rect){var aX=canvas.width*this.aHitAreas[i].align[0];var aY=canvas.height*this.aHitAreas[i].align[1];if(_posX>aX+this.aHitAreas[i].area[0]&&_posY>aY+this.aHitAreas[i].area[1]&&_posX<aX+this.aHitAreas[i].area[2]&&_posY<aY+this.aHitAreas[i].area[3]){this.aHitAreas[i].aTouchIdentifiers.push(_identifer);this.aHitAreas[i].oData.hasLeft=false;if(!this.aHitAreas[i].oData.isDown){this.aHitAreas[i].oData.isDown=true;this.aHitAreas[i].oData.x=_posX;this.aHitAreas[i].oData.y=_posY;if((curHitTime-this.prevHitTime<500&&(gameState!="game"||this.aHitAreas[i].id=="pause"))&&isBugBrowser){return;}
this.aHitAreas[i].callback(this.aHitAreas[i].id,this.aHitAreas[i].oData);}
break;}}
else{}}
this.prevHitTime=curHitTime;};UserInput.prototype.hitUp=function(e,_posX,_posY,_identifer){if(!ios9FirstTouch){playSound("silence");ios9FirstTouch=true;}
if(this.pauseIsOn){return;}
e.preventDefault();e.stopPropagation();_posX*=canvasScale;_posY*=canvasScale;for(var i=0;i<this.aHitAreas.length;i++){if(this.aHitAreas[i].rect){var aX=canvas.width*this.aHitAreas[i].align[0];var aY=canvas.height*this.aHitAreas[i].align[1];if(_posX>aX+this.aHitAreas[i].area[0]&&_posY>aY+this.aHitAreas[i].area[1]&&_posX<aX+this.aHitAreas[i].area[2]&&_posY<aY+this.aHitAreas[i].area[3]){for(var j=0;j<this.aHitAreas[i].aTouchIdentifiers.length;j++){if(this.aHitAreas[i].aTouchIdentifiers[j]==_identifer){this.aHitAreas[i].aTouchIdentifiers.splice(j,1);j-=1;}}
if(this.aHitAreas[i].aTouchIdentifiers.length==0){this.aHitAreas[i].oData.isDown=false;if(this.aHitAreas[i].oData.multiTouch){this.aHitAreas[i].oData.x=_posX;this.aHitAreas[i].oData.y=_posY;this.aHitAreas[i].callback(this.aHitAreas[i].id,this.aHitAreas[i].oData);}}
break;}}
else{}}};UserInput.prototype.hitCancel=function(e,_posX,_posY,_identifer){e.preventDefault();e.stopPropagation();_posX*=canvasScale;_posY*=canvasScale;for(var i=0;i<this.aHitAreas.length;i++){if(this.aHitAreas[i].oData.isDown){this.aHitAreas[i].oData.isDown=false;this.aHitAreas[i].aTouchIdentifiers=new Array();if(this.aHitAreas[i].oData.multiTouch){this.aHitAreas[i].oData.x=_posX;this.aHitAreas[i].oData.y=_posY;this.aHitAreas[i].callback(this.aHitAreas[i].id,this.aHitAreas[i].oData);}}}};UserInput.prototype.move=function(e,_posX,_posY,_identifer,_isDown){if(this.pauseIsOn){return;}
_posX*=canvasScale;_posY*=canvasScale;this.mouseX=_posX;this.mouseY=_posY;if(_isDown){for(var i=0;i<this.aHitAreas.length;i++){if(this.aHitAreas[i].rect){var aX=canvas.width*this.aHitAreas[i].align[0];var aY=canvas.height*this.aHitAreas[i].align[1];if(_posX>aX+this.aHitAreas[i].area[0]&&_posY>aY+this.aHitAreas[i].area[1]&&_posX<aX+this.aHitAreas[i].area[2]&&_posY<aY+this.aHitAreas[i].area[3]){this.aHitAreas[i].oData.hasLeft=false;if(this.aHitAreas[i].oData.isDraggable&&!this.aHitAreas[i].oData.isDown){this.aHitAreas[i].oData.isDown=true;this.aHitAreas[i].oData.isBeingDragged=true;this.aHitAreas[i].oData.x=_posX;this.aHitAreas[i].oData.y=_posY;this.aHitAreas[i].aTouchIdentifiers.push(_identifer);if(this.aHitAreas[i].oData.multiTouch){this.aHitAreas[i].callback(this.aHitAreas[i].id,this.aHitAreas[i].oData);}}
if(this.aHitAreas[i].oData.isDraggable){this.aHitAreas[i].oData.isBeingDragged=true;this.aHitAreas[i].oData.x=_posX;this.aHitAreas[i].oData.y=_posY;this.aHitAreas[i].callback(this.aHitAreas[i].id,this.aHitAreas[i].oData);if(this.aHitAreas[i]){this.aHitAreas[i].oData.isBeingDragged=false;}}}
else if(this.aHitAreas[i].oData.isDown&&!this.aHitAreas[i].oData.hasLeft){for(var j=0;j<this.aHitAreas[i].aTouchIdentifiers.length;j++){if(this.aHitAreas[i].aTouchIdentifiers[j]==_identifer){this.aHitAreas[i].aTouchIdentifiers.splice(j,1);j-=1;}}
if(this.aHitAreas[i].aTouchIdentifiers.length==0){this.aHitAreas[i].oData.hasLeft=true;if(!this.aHitAreas[i].oData.isBeingDragged){this.aHitAreas[i].oData.isDown=false;}
if(this.aHitAreas[i].oData.multiTouch){this.aHitAreas[i].callback(this.aHitAreas[i].id,this.aHitAreas[i].oData);}}}}}}};UserInput.prototype.keyDown=function(e){for(var i=0;i<this.aKeys.length;i++){if(e.keyCode==this.aKeys[i].keyCode){e.preventDefault();this.aKeys[i].oData.isDown=true;this.aKeys[i].callback(this.aKeys[i].id,this.aKeys[i].oData);}}};UserInput.prototype.keyUp=function(e){for(var i=0;i<this.aKeys.length;i++){if(e.keyCode==this.aKeys[i].keyCode){e.preventDefault();this.aKeys[i].oData.isDown=false;this.aKeys[i].callback(this.aKeys[i].id,this.aKeys[i].oData);}}};UserInput.prototype.checkKeyFocus=function(){window.focus();if(this.aKeys.length>0){window.removeEventListener('keydown',this.keyDownEvtFunc,false);window.removeEventListener('keyup',this.keyUpEvtFunc,false);window.addEventListener('keydown',this.keyDownEvtFunc,false);window.addEventListener('keyup',this.keyUpEvtFunc,false);}};UserInput.prototype.addKey=function(_id,_callback,_oCallbackData,_keyCode){if(_oCallbackData==null){_oCallbackData=new Object();}
this.aKeys.push({id:_id,callback:_callback,oData:_oCallbackData,keyCode:_keyCode});this.checkKeyFocus();};UserInput.prototype.removeKey=function(_id){for(var i=0;i<this.aKeys.length;i++){if(this.aKeys[i].id==_id){this.aKeys.splice(i,1);i-=1;}}};UserInput.prototype.addHitArea=function(_id,_callback,_oCallbackData,_type,_oAreaData,_isUnique){if(_isUnique===void 0){_isUnique=false;}
if(_oCallbackData==null){_oCallbackData=new Object();}
if(_isUnique){this.removeHitArea(_id);}
if(!_oAreaData.scale){_oAreaData.scale=1;}
if(!_oAreaData.align){_oAreaData.align=[0,0];}
var aTouchIdentifiers=new Array();switch(_type){case "image":var aRect;aRect=new Array(_oAreaData.aPos[0]-(_oAreaData.oImgData.oData.oAtlasData[_oAreaData.id].width/2)*_oAreaData.scale,_oAreaData.aPos[1]-(_oAreaData.oImgData.oData.oAtlasData[_oAreaData.id].height/2)*_oAreaData.scale,_oAreaData.aPos[0]+(_oAreaData.oImgData.oData.oAtlasData[_oAreaData.id].width/2)*_oAreaData.scale,_oAreaData.aPos[1]+(_oAreaData.oImgData.oData.oAtlasData[_oAreaData.id].height/2)*_oAreaData.scale);this.aHitAreas.push({id:_id,aTouchIdentifiers:aTouchIdentifiers,callback:_callback,oData:_oCallbackData,rect:true,area:aRect,align:_oAreaData.align});break;case "rect":this.aHitAreas.push({id:_id,aTouchIdentifiers:aTouchIdentifiers,callback:_callback,oData:_oCallbackData,rect:true,area:_oAreaData.aRect,align:_oAreaData.align});break;}};UserInput.prototype.removeHitArea=function(_id){for(var i=0;i<this.aHitAreas.length;i++){if(this.aHitAreas[i].id==_id){this.aHitAreas.splice(i,1);i-=1;}}};UserInput.prototype.resetAll=function(){for(var i=0;i<this.aHitAreas.length;i++){this.aHitAreas[i].oData.isDown=false;this.aHitAreas[i].oData.isBeingDragged=false;this.aHitAreas[i].aTouchIdentifiers=new Array();}
this.isDown=false;};return UserInput;}());Utils.UserInput=UserInput;})(Utils||(Utils={}));var Utils;(function(Utils){var FpsMeter=(function(){function FpsMeter(_canvasHeight){this.updateFreq=10;this.updateInc=0;this.frameAverage=0;this.display=1;this.log="";this.render=function(_ctx){this.frameAverage+=this.delta/this.updateFreq;if(++this.updateInc>=this.updateFreq){this.updateInc=0;this.display=this.frameAverage;this.frameAverage=0;}
_ctx.textAlign="left";ctx.font="10px Helvetica";_ctx.fillStyle="#333333";_ctx.beginPath();_ctx.rect(0,this.canvasHeight-15,40,15);_ctx.closePath();_ctx.fill();_ctx.fillStyle="#ffffff";_ctx.fillText(Math.round(1000/(this.display*1000))+" fps "+this.log,5,this.canvasHeight-5);};this.canvasHeight=_canvasHeight;}
FpsMeter.prototype.update=function(_delta){this.delta=_delta;};return FpsMeter;}());Utils.FpsMeter=FpsMeter;})(Utils||(Utils={}));var Elements;(function(Elements){var Background=(function(){function Background(){this.x=0;this.y=0;this.targY=0;this.incY=0;this.renderState=null;this.changeBg();}
Background.prototype.changeBg=function(){if(gameState=="start"){this.oImgData=assetLib.getData("bg0");}
else{this.oImgData=assetLib.getData("bg1");}};Background.prototype.render=function(){if(canvas.width>canvas.height){ctx.drawImage(this.oImgData.img,0,((1-canvas.height/canvas.width)/2)*this.oImgData.img.height,this.oImgData.img.width,(canvas.height/canvas.width)*this.oImgData.img.height,0,0,canvas.width,canvas.height);}
else{ctx.drawImage(this.oImgData.img,((1-canvas.width/canvas.height)/2)*this.oImgData.img.width,0,(canvas.width/canvas.height)*this.oImgData.img.width,this.oImgData.img.width,0,0,canvas.width,canvas.height);}};return Background;}());Elements.Background=Background;})(Elements||(Elements={}));var Elements;(function(Elements){var Panel=(function(){function Panel(_panelType,_aButs){this.timer=.3;this.endTime=0;this.posY=0;this.numberSpace=17;this.incY=0;this.flareRot=0;this.sectionX=0;this.iconScale=1;this.warnY=-500;this.oUiElementsImgData=assetLib.getData("uiElements");this.oCharIconsImgData=assetLib.getData("charIcons"+charId);this.panelType=_panelType;this.aButs=_aButs;this.oTopFlareImgData=assetLib.getData("flare");}
Panel.prototype.showPopUpWarning=function(){var _this=this;if(this.warnTween){this.warnTween.kill();}
this.warnY=-500;this.warnTween=TweenLite.to(this,.3,{warnY:0,ease:"Quad.easeOut",onComplete:function(){_this.warnTween=TweenLite.to(_this,.3,{delay:3,warnY:-500,ease:"Quad.easeIn"});}});};Panel.prototype.update=function(){this.incY+=10*delta;};Panel.prototype.renderFrame=function(){var bWidth=this.oUiElementsImgData.oData.oAtlasData[oImageIds.corner0].width;var aPos=new Array({x:canvas.width/2,y:0},{x:canvas.width-bWidth,y:0},{x:canvas.width/2,y:canvas.height-bWidth},{x:canvas.width-bWidth,y:canvas.height-bWidth});for(var i=0;i<4;i++){var bX=this.oUiElementsImgData.oData.oAtlasData[oImageIds["corner"+i]].x;var bY=this.oUiElementsImgData.oData.oAtlasData[oImageIds["corner"+i]].y;var bWidth=this.oUiElementsImgData.oData.oAtlasData[oImageIds["corner"+i]].width;var bHeight=this.oUiElementsImgData.oData.oAtlasData[oImageIds["corner"+i]].height;ctx.drawImage(this.oUiElementsImgData.img,bX,bY,bWidth,bHeight,aPos[i].x,aPos[i].y,bWidth,bHeight);}
ctx.fillStyle="#FFFFFF";ctx.fillRect(canvas.width/2,0,canvas.width/2,7.5);ctx.fillStyle="#FFFFFF";ctx.fillRect(canvas.width-7.5,0,7.5,canvas.height);ctx.fillStyle="#FFFFFF";ctx.fillRect(canvas.width/2,canvas.height-7.5,canvas.width/2,7.5);ctx.fillStyle="#FFFFFF";ctx.fillRect(canvas.width/2-10,0,17.5,canvas.height);};Panel.prototype.newSection=function(_dir){if(this.sectionTween){this.sectionTween.kill();}
this.sectionX=_dir*20;this.iconScale=.75;this.sectionTween=TweenLite.to(this,.5,{sectionX:0,iconScale:1,ease:"Back.easeOut"});};Panel.prototype.startTween1=function(){this.posY=500;TweenLite.to(this,.5,{posY:0,ease:"Back.easeOut"});this.butsY=500;TweenLite.to(this,.5,{butsY:0,ease:"Cubic.easeOut"});};Panel.prototype.switchBut=function(_id0,_id1,_id1Over,_aNewAPos,_aNewAlign){if(_aNewAPos===void 0){_aNewAPos=null;}
if(_aNewAlign===void 0){_aNewAlign=null;}
var oButData=null;for(var i=0;i<this.aButs.length;i++){if(this.aButs[i].id==_id0){this.aButs[i].id=_id1;this.aButs[i].idOver=_id1Over;oButData=this.aButs[i];if(_aNewAPos){this.aButs[i].aPos=_aNewAPos;}
if(_aNewAlign){this.aButs[i].align=_aNewAlign;}}}
return oButData;};Panel.prototype.switchSpecificBut=function(_switchId,_id1,_id1Over){var oButData=null;for(var i=0;i<this.aButs.length;i++){if(this.aButs[i].switchId==_switchId){this.aButs[i].id=_id1;this.aButs[i].idOver=_id1Over;oButData=this.aButs[i];}}
return oButData;};Panel.prototype.render=function(_butsOnTop){if(_butsOnTop===void 0){_butsOnTop=true;}
if(!_butsOnTop){this.addButs(ctx);}
switch(gameState){case "rotated":var oRotateIconImgData=assetLib.getData("rotateIcon");ctx.fillStyle="rgba(0, 0, 0, 1)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(oRotateIconImgData.img,canvas.width/2-oRotateIconImgData.img.width/2,canvas.height/2-oRotateIconImgData.img.height/2);break;case "splash":ctx.fillStyle="rgba(0, 0, 0, 0.35)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(this.oSplashLogoImgData.img,canvas.width/2-this.oSplashLogoImgData.img.width/2,canvas.height/2-this.oSplashLogoImgData.img.height/2-this.posY);break;case "start":var bX=this.oUiElementsImgData.oData.oAtlasData[oImageIds.showLogo].x;var bY=this.oUiElementsImgData.oData.oAtlasData[oImageIds.showLogo].y;var bWidth=this.oUiElementsImgData.oData.oAtlasData[oImageIds.showLogo].width;var bHeight=this.oUiElementsImgData.oData.oAtlasData[oImageIds.showLogo].height;ctx.drawImage(this.oUiElementsImgData.img,bX,bY,bWidth,bHeight,canvas.width/2-bWidth/2-this.posY,canvas.height*.25-bHeight,bWidth,bHeight);var tempImgData=assetLib.getData("titleLogo");var tempScale=1;ctx.drawImage(tempImgData.img,0,0,tempImgData.img.width,tempImgData.img.height,canvas.width/2-(tempImgData.img.width/2)*tempScale+this.posY,canvas.height*.27+Math.sin(this.incY*.4)*10,tempImgData.img.width*tempScale,tempImgData.img.height*tempScale);var bX=this.oUiElementsImgData.oData.oAtlasData[oImageIds["boomLogo"]].x;var bY=this.oUiElementsImgData.oData.oAtlasData[oImageIds["boomLogo"]].y;var bWidth=this.oUiElementsImgData.oData.oAtlasData[oImageIds["boomLogo"]].width;var bHeight=this.oUiElementsImgData.oData.oAtlasData[oImageIds["boomLogo"]].height;ctx.drawImage(this.oUiElementsImgData.img,bX,bY,bWidth,bHeight,15-this.posY,canvas.height-90,bWidth,bHeight);break;case "credits":ctx.fillStyle="rgba(0, 0, 0, 0.35)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(this.oSplashLogoImgData.img,canvas.width/2-this.oSplashLogoImgData.img.width/2,canvas.height/2-this.oSplashLogoImgData.img.height/2-this.posY);break;case "game":addText(0,60,250,"center",canvas.width*.25,58-this.butsY,"char"+charId,"#FFFFFF");addText(0,40,250,"center",canvas.width*.25+this.sectionX,canvas.height-40+this.butsY,"section"+character.section,"#FFFFFF");for(var i=0;i<6;i++){var bX=this.oCharIconsImgData.oData.oAtlasData["id"+((character.section*6)+i)].x;var bY=this.oCharIconsImgData.oData.oAtlasData["id"+((character.section*6)+i)].y;var bWidth=this.oCharIconsImgData.oData.oAtlasData["id"+((character.section*6)+i)].width;var bHeight=this.oCharIconsImgData.oData.oAtlasData["id"+((character.section*6)+i)].height;var tempButsY=-this.butsY;if(i>2){tempButsY=this.butsY;}
ctx.drawImage(this.oCharIconsImgData.img,bX,bY,bWidth,bHeight,canvas.width*.25+120*(i%3)-120-(bWidth/2)*this.iconScale-2,(canvas.height*.26)*Math.floor(i/3)+(canvas.height*.37)-(bHeight/2)*this.iconScale-5+tempButsY,bWidth*this.iconScale,bHeight*this.iconScale);}
if(this.warnY>-500){ctx.fillStyle="#89308A";ctx.fillRect(canvas.width/2+85,14+this.warnY,canvas.width/2-100,50);addText(0,25,canvas.width/2-110,"center",canvas.width/2+85+(canvas.width/2-100)/2,46+this.warnY,"popUpWarn","#FFEA01");}
ctx.fillStyle="#FFFFFF";ctx.fillRect(canvas.width/2-2,0,10,canvas.height);break;case "pause":ctx.fillStyle="rgba(0, 0, 0, 0.75)";ctx.fillRect(0,0,canvas.width,canvas.height);break;}
if(_butsOnTop){this.addButs(ctx);}};Panel.prototype.addButs=function(ctx){var aButOver=false;for(var i=0;i<this.aButs.length;i++){if(this.aButs[i].isOver){aButOver=true;break;}}
for(var i=0;i<this.aButs.length;i++){var offsetPosY;var floatY=0;if(this.incY!=0&&this.aButs[i].flash){if(this.aButs[i].isOver){floatY=Math.sin((this.incY+i*2.5)*2)*3;}
else{floatY=Math.sin(this.incY+i*2.5)*3;}}
if(i%2==0){}
if(!this.aButs[i].scale){this.aButs[i].scale=1;}
var bX;var bY;var bWidth;var bHeight;bX=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].id].x;bY=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].id].y;bWidth=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].id].width;bHeight=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].id].height;var aX=(canvas.width*this.aButs[i].align[0]);var aY=(canvas.height*this.aButs[i].align[1]);if(aY+this.aButs[i].aPos[1]>canvas.height/2){offsetPosY=this.butsY;}
else{offsetPosY=-this.butsY;}
this.aButs[i].aOverData=new Array(aX+this.aButs[i].aPos[0]-(bWidth/2)*(this.aButs[i].scale)-floatY/2,aY+this.aButs[i].aPos[1]-(bHeight/2)*(this.aButs[i].scale)+offsetPosY+floatY/2,aX+this.aButs[i].aPos[0]+(bWidth/2)*(this.aButs[i].scale)-floatY/2,aY+this.aButs[i].aPos[1]+(bHeight/2)*(this.aButs[i].scale)+offsetPosY+floatY/2);if(this.aButs[i].isOver&&this.aButs[i].flash){ctx.save();ctx.translate(aX+this.aButs[i].aPos[0],aY+this.aButs[i].aPos[1]);ctx.scale(.5+floatY/100,.5+floatY/100);ctx.globalAlpha=1;ctx.rotate(this.incY/7);ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2);ctx.restore();}
ctx.drawImage(this.aButs[i].oImgData.img,bX,bY,bWidth,bHeight,this.aButs[i].aOverData[0],this.aButs[i].aOverData[1],bWidth*(this.aButs[i].scale)+floatY,bHeight*(this.aButs[i].scale)-floatY);if(this.aButs[i].isOver||this.aButs[i].flash){ctx.save();if(this.aButs[i].isOver){ctx.globalAlpha=1;}
else{if(aButOver){ctx.globalAlpha=Math.max(Math.sin((this.incY+i)/2),0)/2;}
else{ctx.globalAlpha=Math.max(Math.sin((this.incY+i)/2),0);}}
bX=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].idOver].x;bY=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].idOver].y;bWidth=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].idOver].width;bHeight=this.aButs[i].oImgData.oData.oAtlasData[this.aButs[i].idOver].height;ctx.drawImage(this.aButs[i].oImgData.img,bX,bY,bWidth,bHeight,this.aButs[i].aOverData[0],this.aButs[i].aOverData[1],bWidth*(this.aButs[i].scale)+floatY,bHeight*(this.aButs[i].scale)-floatY);ctx.restore();}}};return Panel;}());Elements.Panel=Panel;})(Elements||(Elements={}));var Elements;(function(Elements){var Clouds=(function(){function Clouds(_percX,_dir){this.tot=20;this.radius=60;this.percX=_percX;this.dir=_dir;if(gameState=="start"){this.col="#FFFFFF";}
else{this.col="#AA43AE";}
this.aCircles=new Array();for(var i=0;i<this.tot;i++){this.aCircles.push(this.setCircleData(i));}}
Clouds.prototype.setCircleData=function(_id){var _this=this;var firstTime=true;if(this.aCircles[_id]){firstTime=false;}
var oData={id:_id,scale:0,fixedPointY:(_id/this.tot),x:(Math.random()*50)*-this.dir,y:Math.random()*100-50};if(firstTime){var tempTime=Math.random();oData.scale=(Math.random()*1+1)*tempTime;var tempX=(Math.random()*100+50)*this.dir;var tempY=(Math.random()*100-50);oData.x+=(tempX-oData.x)*(1-tempTime);oData.y+=(tempY-oData.y)*(1-tempTime);TweenLite.to(oData,(Math.random()*1+1)*tempTime,{x:tempX,y:tempY,scale:0,ease:"Quad.easeOut",onComplete:function(){_this.aCircles[_id]=_this.setCircleData(_id);}});}
else{TweenLite.to(oData,.3,{scale:Math.random()*.5+1,ease:"Quad.easeOut",onComplete:function(){TweenLite.to(oData,Math.random()*1+1,{x:(Math.random()*100+50)*_this.dir,y:(Math.random()*100-50),scale:0,ease:"Quad.easeOut",onComplete:function(){_this.aCircles[_id]=_this.setCircleData(_id);}});}});}
return oData;};Clouds.prototype.update=function(){};Clouds.prototype.render=function(){for(var i=0;i<this.aCircles.length;i++){ctx.fillStyle=this.col;ctx.beginPath();ctx.arc(this.percX*canvas.width+this.aCircles[i].x,this.aCircles[i].fixedPointY*canvas.height+this.aCircles[i].y,this.aCircles[i].scale*this.radius,0,2*Math.PI);ctx.fill();}};return Clouds;}());Elements.Clouds=Clouds;})(Elements||(Elements={}));var Elements;(function(Elements){var Firework=(function(){function Firework(_x,_y){this.tot=10;this.radius=60;this.removeMe=false;this.id="firework";this.startX=_x;this.startY=_y;this.col="#FFFFFF";this.aCircles=new Array();for(var i=0;i<this.tot;i++){this.aCircles.push(this.setCircleData(i));}}
Firework.prototype.setCircleData=function(_id){var _this=this;var firstTime=true;var tempAngle=Math.random()*360*radian;var tempDist=Math.random()*100+100;var oData={scale:Math.random()*.5+.5,x:this.startX,y:this.startY,distX:tempDist*Math.cos(tempAngle),distY:tempDist*Math.sin(tempAngle),id:_id,isComplete:false};TweenLite.to(oData,Math.random()*.5+.5,{x:oData.x+oData.distX,y:oData.y+oData.distY,scale:0,ease:"Quad.easeOut",onComplete:function(){_this.aCircles[oData.id].isComplete=true;_this.checkComplete();}});return oData;};Firework.prototype.checkComplete=function(){var tempComplete=true;for(var i=0;i<this.aCircles.length;i++){if(!this.aCircles[i].isComplete){tempComplete=false;}}
if(tempComplete){this.removeMe=true;}};Firework.prototype.update=function(){};Firework.prototype.render=function(){for(var i=0;i<this.aCircles.length;i++){ctx.fillStyle=this.col;ctx.beginPath();ctx.arc(this.aCircles[i].x,this.aCircles[i].y,this.aCircles[i].scale*this.radius,0,2*Math.PI);ctx.fill();}};return Firework;}());Elements.Firework=Firework;})(Elements||(Elements={}));var Elements;(function(Elements){var Snow=(function(){function Snow(){this.tot=30;this.radius=5;this.removeMe=false;this.id="snow";this.col="#FFFFFF";this.aCircles=new Array();for(var i=0;i<this.tot;i++){this.aCircles.push(this.setCircleData(i));}}
Snow.prototype.setCircleData=function(_id){var oData={scale:Math.random()*.5+.5,x:Math.random()*canvas.width/2+canvas.width/2,y:Math.random()*canvas.height,incY:Math.random()*20+20,incX:Math.random()*Math.PI,driftRate:Math.random()*.5+.5,driftWidth:Math.random()*.5+.5};return oData;};Snow.prototype.update=function(){};Snow.prototype.render=function(){for(var i=0;i<this.aCircles.length;i++){this.aCircles[i].incX+=this.aCircles[i].driftRate*delta;this.aCircles[i].y+=this.aCircles[i].incY*delta;this.aCircles[i].x+=Math.sin(this.aCircles[i].incX)*this.aCircles[i].driftWidth;if(this.aCircles[i].y>canvas.height){this.aCircles[i].y=0;}
if(this.aCircles[i].x>canvas.width){this.aCircles[i].x=canvas.width/2;}
else if(this.aCircles[i].x<canvas.width/2){this.aCircles[i].x=canvas.width;}
ctx.fillStyle=this.col;ctx.beginPath();ctx.arc(this.aCircles[i].x,this.aCircles[i].y,this.aCircles[i].scale*this.radius,0,2*Math.PI);ctx.fill();}};return Snow;}());Elements.Snow=Snow;})(Elements||(Elements={}));var Utils;(function(Utils){var TextDisplay=(function(){function TextDisplay(){this.oTextData={};this.inc=0;this.createTextObjects();}
TextDisplay.prototype.createTextObjects=function(){var cnt=0;for(var i in assetLib.textData.langText.text[curLang]){this.oTextData[i]={};this.oTextData[i].aLineData=this.getCharData(assetLib.textData.langText.text[curLang][i]["@text"],assetLib.textData.langText.text[curLang][i]["@fontId"]);this.oTextData[i].aLineWidths=this.getLineWidths(this.oTextData[i].aLineData);this.oTextData[i].blockWidth=this.getBlockWidth(this.oTextData[i].aLineData);this.oTextData[i].blockHeight=this.getBlockHeight(this.oTextData[i].aLineData,assetLib.textData.langText.text[curLang][i]["@fontId"]);this.oTextData[i].lineHeight=parseInt(assetLib.textData["fontData"+assetLib.textData.langText.text[curLang][i]["@fontId"]].text.common["@lineHeight"]);this.oTextData[i].oFontImgData=assetLib.getData("font"+assetLib.textData.langText.text[curLang][i]["@fontId"]);}};TextDisplay.prototype.getLineWidths=function(_aCharData){var lineLength;var aLineWidths=new Array();for(var i=0;i<_aCharData.length;i++){lineLength=0;for(var j=0;j<_aCharData[i].length;j++){lineLength+=parseInt(_aCharData[i][j]["@xadvance"]);if(j==0){lineLength-=parseInt(_aCharData[i][j]["@xoffset"]);}
else if(j==_aCharData[i].length-1){lineLength+=parseInt(_aCharData[i][j]["@xoffset"]);}}
aLineWidths.push(lineLength);}
return aLineWidths;};TextDisplay.prototype.getBlockWidth=function(_aCharData){var lineLength;var longestLineLength=0;for(var i=0;i<_aCharData.length;i++){lineLength=0;for(var j=0;j<_aCharData[i].length;j++){lineLength+=parseInt(_aCharData[i][j]["@xadvance"]);if(j==0){lineLength-=parseInt(_aCharData[i][j]["@xoffset"]);}
else if(j==_aCharData[i].length-1){lineLength+=parseInt(_aCharData[i][j]["@xoffset"]);}}
if(lineLength>longestLineLength){longestLineLength=lineLength;}}
return longestLineLength;};TextDisplay.prototype.getBlockHeight=function(_aCharData,_fontId){return _aCharData.length*parseInt(assetLib.textData["fontData"+_fontId].text.common["@lineHeight"]);};TextDisplay.prototype.getCharData=function(_aLines,_fontId){var aCharData=new Array();for(var k=0;k<_aLines.length;k++){aCharData[k]=new Array();for(var i=0;i<_aLines[k].length;i++){for(var j=0;j<assetLib.textData["fontData"+_fontId].text.chars.char.length;j++){if(_aLines[k][i].charCodeAt(0)==assetLib.textData["fontData"+_fontId].text.chars.char[j]["@id"]){aCharData[k].push(assetLib.textData["fontData"+_fontId].text.chars.char[j]);}}}}
return aCharData;};TextDisplay.prototype.renderText=function(_oTextDisplayData){var aLinesToRender=this.oTextData[_oTextDisplayData.text].aLineData;var oFontImgData=this.oTextData[_oTextDisplayData.text].oFontImgData;var shiftX;var offsetX=0;var offsetY=0;var lineOffsetY=0;var manualScale=1;var animY=0;if(_oTextDisplayData.lineOffsetY){lineOffsetY=_oTextDisplayData.lineOffsetY;}
if(_oTextDisplayData.scale){manualScale=_oTextDisplayData.scale;}
var textScale=1*manualScale;if(_oTextDisplayData.maxWidth&&this.oTextData[_oTextDisplayData.text].blockWidth*manualScale>_oTextDisplayData.maxWidth){textScale=_oTextDisplayData.maxWidth/this.oTextData[_oTextDisplayData.text].blockWidth;}
if(_oTextDisplayData.anim){this.inc+=delta*7;}
for(var i=0;i<aLinesToRender.length;i++){shiftX=0;if(_oTextDisplayData.alignX=="centre"){offsetX=this.oTextData[_oTextDisplayData.text].aLineWidths[i]/2;}
if(_oTextDisplayData.alignY=="centre"){offsetY=this.oTextData[_oTextDisplayData.text].blockHeight/2+(lineOffsetY*(aLinesToRender.length-1))/2;}
for(var j=0;j<aLinesToRender[i].length;j++){var bX=aLinesToRender[i][j]["@x"];var bY=aLinesToRender[i][j]["@y"];var bWidth=aLinesToRender[i][j]["@width"];var bHeight=aLinesToRender[i][j]["@height"];if(_oTextDisplayData.anim){animY=Math.sin(this.inc+j/2)*((bHeight/15)*textScale);}
ctx.drawImage(oFontImgData.img,bX,bY,bWidth,bHeight,_oTextDisplayData.x+(shiftX+parseInt(aLinesToRender[i][j]["@xoffset"])-offsetX)*textScale,_oTextDisplayData.y+(parseInt(aLinesToRender[i][j]["@yoffset"])+(i*this.oTextData[_oTextDisplayData.text].lineHeight)+(i*lineOffsetY)-offsetY)*textScale+animY,bWidth*textScale,bHeight*textScale);shiftX+=parseInt(aLinesToRender[i][j]["@xadvance"]);}}};return TextDisplay;}());Utils.TextDisplay=TextDisplay;})(Utils||(Utils={}));var Elements;(function(Elements){var Character=(function(){function Character(){this.section=4;this.scale=1;this.aCharOffset=new Array({offsetX:-10,offsetY:35},{offsetX:-10,offsetY:30},{offsetX:-10,offsetY:30});this.bgFlash=0;this.oCharImgData=assetLib.getData("char"+charId);this.aOutfit=new Array(-1,-1,-1,-1,-1);}
Character.prototype.newBg=function(){if(this.bgTween){this.bgTween.kill();}
this.bgFlash=1;this.bgTween=TweenLite.to(this,.3,{bgFlash:0,ease:"Quad.easeIn"});};Character.prototype.startTween=function(){TweenLite.to(this,.5,{butsY:0,ease:"Cubic.easeOut"});};Character.prototype.addItem=function(){if(this.changeTween){this.changeTween.kill();}
this.scale=.9;this.changeTween=TweenLite.to(this,1,{scale:1,ease:"Elastic.easeOut"});};Character.prototype.update=function(){};Character.prototype.render=function(){var tempImgData=assetLib.getData("bgC"+this.aOutfit[4]);if(this.aOutfit[4]==-1){tempImgData=assetLib.getData("bg0");}
if(canvas.width/2>canvas.height){ctx.drawImage(tempImgData.img,0,((1-canvas.height/(canvas.width/2)))*tempImgData.img.height,tempImgData.img.width,(canvas.height/(canvas.width/2))*tempImgData.img.height,canvas.width/2,0,canvas.width/2,canvas.height);}
else{ctx.drawImage(tempImgData.img,((1-(canvas.width/2)/canvas.height)/2)*tempImgData.img.width,0,((canvas.width/2)/canvas.height)*tempImgData.img.width,tempImgData.img.height,canvas.width/2,0,canvas.width/2,canvas.height);}
if(this.bgFlash>0){ctx.fillStyle="rgba(255, 255, 255,"+this.bgFlash+")";ctx.fillRect(canvas.width/2,0,canvas.width/2,canvas.height);}
var tempFrame=0;var imgX=(tempFrame*this.oCharImgData.oData.spriteWidth)%this.oCharImgData.img.width;var imgY=Math.floor(tempFrame/(this.oCharImgData.img.width/this.oCharImgData.oData.spriteWidth))*this.oCharImgData.oData.spriteHeight;ctx.drawImage(this.oCharImgData.img,imgX,imgY,this.oCharImgData.oData.spriteWidth,this.oCharImgData.oData.spriteHeight,canvas.width-(this.oCharImgData.oData.spriteWidth*(1+1-this.scale))+this.aCharOffset[charId].offsetX,canvas.height-this.oCharImgData.oData.spriteHeight*this.scale+this.aCharOffset[charId].offsetY,this.oCharImgData.oData.spriteWidth*(1+1-this.scale),this.oCharImgData.oData.spriteHeight*this.scale);if(this.aOutfit[0]!=-1){var tempFrame=this.aOutfit[0]+1;var imgX=(tempFrame*this.oCharImgData.oData.spriteWidth)%this.oCharImgData.img.width;var imgY=Math.floor(tempFrame/(this.oCharImgData.img.width/this.oCharImgData.oData.spriteWidth))*this.oCharImgData.oData.spriteHeight;ctx.drawImage(this.oCharImgData.img,imgX,imgY,this.oCharImgData.oData.spriteWidth,this.oCharImgData.oData.spriteHeight,canvas.width-(this.oCharImgData.oData.spriteWidth*(1+1-this.scale))+this.aCharOffset[charId].offsetX,canvas.height-this.oCharImgData.oData.spriteHeight*this.scale+this.aCharOffset[charId].offsetY,this.oCharImgData.oData.spriteWidth*(1+1-this.scale),this.oCharImgData.oData.spriteHeight*this.scale);}
if(this.aOutfit[1]!=-1){var tempFrame=this.aOutfit[1]+6+1;var imgX=(tempFrame*this.oCharImgData.oData.spriteWidth)%this.oCharImgData.img.width;var imgY=Math.floor(tempFrame/(this.oCharImgData.img.width/this.oCharImgData.oData.spriteWidth))*this.oCharImgData.oData.spriteHeight;ctx.drawImage(this.oCharImgData.img,imgX,imgY,this.oCharImgData.oData.spriteWidth,this.oCharImgData.oData.spriteHeight,canvas.width-(this.oCharImgData.oData.spriteWidth*(1+1-this.scale))+this.aCharOffset[charId].offsetX,canvas.height-this.oCharImgData.oData.spriteHeight*this.scale+this.aCharOffset[charId].offsetY,this.oCharImgData.oData.spriteWidth*(1+1-this.scale),this.oCharImgData.oData.spriteHeight*this.scale);}
if(this.aOutfit[2]!=-1){var tempFrame=this.aOutfit[2]+12+1;var imgX=(tempFrame*this.oCharImgData.oData.spriteWidth)%this.oCharImgData.img.width;var imgY=Math.floor(tempFrame/(this.oCharImgData.img.width/this.oCharImgData.oData.spriteWidth))*this.oCharImgData.oData.spriteHeight;ctx.drawImage(this.oCharImgData.img,imgX,imgY,this.oCharImgData.oData.spriteWidth,this.oCharImgData.oData.spriteHeight,canvas.width-(this.oCharImgData.oData.spriteWidth*(1+1-this.scale))+this.aCharOffset[charId].offsetX,canvas.height-this.oCharImgData.oData.spriteHeight*this.scale+this.aCharOffset[charId].offsetY,this.oCharImgData.oData.spriteWidth*(1+1-this.scale),this.oCharImgData.oData.spriteHeight*this.scale);}
if(this.aOutfit[3]!=-1){var tempFrame=this.aOutfit[3]+18+1;var imgX=(tempFrame*this.oCharImgData.oData.spriteWidth)%this.oCharImgData.img.width;var imgY=Math.floor(tempFrame/(this.oCharImgData.img.width/this.oCharImgData.oData.spriteWidth))*this.oCharImgData.oData.spriteHeight;ctx.drawImage(this.oCharImgData.img,imgX,imgY,this.oCharImgData.oData.spriteWidth,this.oCharImgData.oData.spriteHeight,canvas.width-(this.oCharImgData.oData.spriteWidth*(1+1-this.scale))+this.aCharOffset[charId].offsetX,canvas.height-this.oCharImgData.oData.spriteHeight*this.scale+this.aCharOffset[charId].offsetY,this.oCharImgData.oData.spriteWidth*(1+1-this.scale),this.oCharImgData.oData.spriteHeight*this.scale);}};return Character;}());Elements.Character=Character;})(Elements||(Elements={}));var Utils;(function(Utils){var SaveDataHandler=(function(){function SaveDataHandler(_saveDataId){this.dataGroupNum=2;this.saveDataId=_saveDataId;var testKey='test';var storage;var lc=false;try{storage=window.localStorage;lc=true;}
catch(e){console.log("local storage denied");lc=false;this.canStore=false;}
if(lc){try{storage.setItem(testKey,'1');storage.removeItem(testKey);this.canStore=true;}
catch(error){this.canStore=false;}}
this.clearData();this.setInitialData();}
SaveDataHandler.prototype.clearData=function(){this.aLevelStore=new Array();this.aLevelStore.push(0);this.aLevelStore.push(0);this.aLevelStore.push(0);this.aLevelStore.push(0);this.aLevelStore.push(0);this.aLevelStore.push(0);};SaveDataHandler.prototype.resetData=function(){this.clearData();this.saveData();};SaveDataHandler.prototype.setInitialData=function(){if(this.canStore&&typeof(Storage)!=="undefined"){if(localStorage.getItem(this.saveDataId)!=null&&localStorage.getItem(this.saveDataId)!=""){this.aLevelStore=localStorage.getItem(this.saveDataId).split(",");for(var a in this.aLevelStore){this.aLevelStore[a]=parseInt(this.aLevelStore[a]);}}
else{this.saveData();}}};SaveDataHandler.prototype.setData=function(_levelNum,_aData){for(var i=0;i<_aData.length;i++){if(this.aLevelStore.length==0||this.aLevelStore.length<=_levelNum*this.dataGroupNum+i){for(var j=0;j<((_levelNum*this.dataGroupNum)+i)-this.aLevelStore.length-1;j++){this.aLevelStore.push(0);}
this.aLevelStore.push(_aData[i]);}
else{this.aLevelStore[_levelNum*this.dataGroupNum+i]=_aData[i];}}};SaveDataHandler.prototype.getData=function(_levelNum,_id){return this.aLevelStore[_levelNum*this.dataGroupNum+_id];};SaveDataHandler.prototype.saveData=function(){if(this.canStore&&typeof(Storage)!=="undefined"){var str="";for(var i=0;i<this.aLevelStore.length;i++){str+=this.aLevelStore[i];if(i<this.aLevelStore.length-1){str+=",";}}
localStorage.setItem(this.saveDataId,str);}};return SaveDataHandler;}());Utils.SaveDataHandler=SaveDataHandler;})(Utils||(Utils={}));var requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame||function(callback){window.setTimeout(callback,1000/60,new Date().getTime());};})();var previousTime;var canvas=document.getElementById('canvas');var ctx=canvas.getContext("2d");var maxWidth=800;var minWidth=800;var maxHeight=500;var minHeight=500;var canvasX;var canvasY;var canvasScale;var isRotated=false;var div=document.getElementById('canvas-wrapper');var sound;var music;var audioType=0;var muted=false;var splashTimer=0;var assetLib;var preAssetLib;var isMobile=false;var gameState="loading";var aLangs=new Array("EN");var curLang="";var isBugBrowser=false;var isIE10=false;var delta;var radian=Math.PI/180;var ios9FirstTouch=false;var isRotated=false;var prevGameState;var hasFocus=true;var saveDataHandler=new Utils.SaveDataHandler("gameteamplatev1");if(navigator.userAgent.match(/MSIE\s([\d]+)/)){isIE10=true;}
var deviceAgent=navigator.userAgent.toLowerCase();if(deviceAgent.match(/(iphone|ipod|ipad)/)||deviceAgent.match(/(android)/)||deviceAgent.match(/(iemobile)/)||deviceAgent.match(/iphone/i)||deviceAgent.match(/ipad/i)||deviceAgent.match(/ipod/i)||deviceAgent.match(/blackberry/i)||deviceAgent.match(/bada/i)){isMobile=true;if(deviceAgent.match(/(android)/)&&!/Chrome/.test(navigator.userAgent)){isBugBrowser=true;}}
var userInput=new Utils.UserInput(canvas,isBugBrowser);resizeCanvas();window.onresize=function(){setTimeout(function(){resizeCanvas();},1);};function visibleResume(){if(!hasFocus){if(userInput){userInput.checkKeyFocus();}
if(!muted&&gameState!="pause"&&gameState!="splash"&&gameState!="loading"){Howler.mute(false);playMusic();}}
hasFocus=true;}
function visiblePause(){hasFocus=false;Howler.mute(true);music.pause();}
window.onpageshow=function(){if(!hasFocus){if(userInput){userInput.checkKeyFocus();}
if(!muted&&gameState!="pause"&&gameState!="splash"&&gameState!="loading"){Howler.mute(false);playMusic();}}
hasFocus=true;};window.onpagehide=function(){hasFocus=false;Howler.mute(true);music.pause();};function playMusic(){if(!music.playing()){music.play();}}
window.addEventListener("load",function(){setTimeout(function(){resizeCanvas();},0);window.addEventListener("orientationchange",function(){setTimeout(function(){resizeCanvas();},500);setTimeout(function(){resizeCanvas();},2000);},false);});function isStock(){var matches=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return matches&&parseFloat(matches[1])<537;}
var ua=navigator.userAgent;var isSharpStock=((/SHL24|SH-01F/i).test(ua))&&isStock();var isXperiaAStock=((/SO-04E/i).test(ua))&&isStock();var isFujitsuStock=((/F-01F/i).test(ua))&&isStock();if(!isIE10&&!isSharpStock&&!isXperiaAStock&&!isFujitsuStock&&(typeof window.AudioContext!=='undefined'||typeof window.webkitAudioContext!=='undefined'||navigator.userAgent.indexOf('Android')==-1)){audioType=1;sound=new Howl({src:['audio/sound.mp3'],sprite:{silence:[0,502.87981859410434],click:[1500,556.5532879818593],item0:[3000,674.3764172335602],item1:[4500,627.0748299319724],item2:[6000,674.3764172335602],bg:[7500,1153.2653061224494],start:[10000,1438.7074829931964]}});music=new Howl({src:['audio/music.mp3'],volume:0,loop:true});}
else{audioType=0;}
var panel;var background;var totalScore=0;var levelScore=0;var levelNum=0;var aTutorials=new Array();var panelFrame;var oLogoData={};var oLogoBut;var musicTween;var oImageIds={};var aClouds;var aEffects;var charId=0;var character;function loadLang(_lang){if(_lang===void 0){_lang="en";}
curLang=_lang;loadPreAssets();}
function initSplash(){gameState="splash";if(audioType==1&&!muted){playMusic();if(!hasFocus){music.pause();}}
initStartScreen();resizeCanvas();}
function initStartScreen(){gameState="start";userInput.removeHitArea("moreGames");if(audioType==1){music.fade(music.volume(),.5,500);}
levelScore=0;totalScore=0;levelNum=0;background=new Elements.Background();var oPlay0But={oImgData:assetLib.getData("uiButs"),aPos:[-170,0],align:[.5,.8],id:oImageIds.play0But,idOver:oImageIds.play0ButOver,flash:true};var oPlay1But={oImgData:assetLib.getData("uiButs"),aPos:[0,0],align:[.5,.8],id:oImageIds.play1But,idOver:oImageIds.play1ButOver,flash:true};var oPlay2But={oImgData:assetLib.getData("uiButs"),aPos:[170,0],align:[.5,.8],id:oImageIds.play2But,idOver:oImageIds.play2ButOver,flash:true};userInput.addHitArea("startGame",butEventHandler,{id:0},"image",oPlay0But);userInput.addHitArea("startGame",butEventHandler,{id:1},"image",oPlay1But);userInput.addHitArea("startGame",butEventHandler,{id:2},"image",oPlay2But);var aButs=new Array(oPlay0But,oPlay1But,oPlay2But);addMuteBut(aButs);panel=new Elements.Panel(gameState,aButs);aClouds=new Array();var tc=new Elements.Clouds(0,1);aClouds.push(tc);var tc=new Elements.Clouds(1,-1);aClouds.push(tc);aEffects=new Array();panel.startTween1();previousTime=new Date().getTime();updateStartScreenEvent();}
function addMuteBut(_aButs){if(audioType==1){var mb=oImageIds.muteBut0;var mbOver=oImageIds.muteBut0Over;if(muted){mb=oImageIds.muteBut1;mbOver=oImageIds.muteBut1Over;}
var oMuteBut={oImgData:assetLib.getData("uiButs"),aPos:[40,40],align:[0,0],id:mb,idOver:mbOver};userInput.addHitArea("mute",butEventHandler,null,"image",oMuteBut);for(var i=0;i<_aButs.length;i++){if(_aButs[i].id==oImageIds.muteBut0||_aButs[i].id==oImageIds.muteBut1){return;}}
_aButs.push(oMuteBut);}}
function initCreditsScreen(){gameState="credits";var oBackBut={oImgData:assetLib.getData("uiButs"),aPos:[40,-40],align:[0,1],id:oImageIds.backBut,idOver:oImageIds.backButOver};var oResetBut={oImgData:assetLib.getData("uiButs"),aPos:[-40,-40],align:[1,1],id:oImageIds.resetBut,idOver:oImageIds.resetButOver};userInput.addHitArea("backFromCredits",butEventHandler,null,"image",oBackBut);userInput.addHitArea("resetData",butEventHandler,null,"image",oResetBut);var aButs=new Array(oBackBut,oResetBut);addMuteBut(aButs);panel=new Elements.Panel(gameState,aButs);panel.startTween1();previousTime=new Date().getTime();updateCreditsScreenEvent();}
function initGame(){gameState="game";if(audioType==1){music.fade(music.volume(),.75,1000);}
background=new Elements.Background();var oMenuBut={oImgData:assetLib.getData("uiButs"),aPos:[-40,40],align:[.5,0],id:oImageIds.menuBut,idOver:oImageIds.menuButOver};var oLeftBut={oImgData:assetLib.getData("uiButs"),aPos:[40,-50],align:[0,1],id:oImageIds.leftBut,idOver:oImageIds.leftButOver};var oRightBut={oImgData:assetLib.getData("uiButs"),aPos:[-40,-50],align:[.5,1],id:oImageIds.rightBut,idOver:oImageIds.rightButOver};var oItemBut0={oImgData:assetLib.getData("uiButs"),aPos:[-120,0],align:[.25,.37],id:oImageIds.itemBut,idOver:oImageIds.itemButOver,switchId:0};var oItemBut1={oImgData:assetLib.getData("uiButs"),aPos:[0,0],align:[.25,.37],id:oImageIds.itemBut,idOver:oImageIds.itemButOver,switchId:1};var oItemBut2={oImgData:assetLib.getData("uiButs"),aPos:[120,0],align:[.25,.37],id:oImageIds.itemBut,idOver:oImageIds.itemButOver,switchId:2};var oItemBut3={oImgData:assetLib.getData("uiButs"),aPos:[-120,0],align:[.25,.63],id:oImageIds.itemBut,idOver:oImageIds.itemButOver,switchId:3};var oItemBut4={oImgData:assetLib.getData("uiButs"),aPos:[0,0],align:[.25,.63],id:oImageIds.itemBut,idOver:oImageIds.itemButOver,switchId:4};var oItemBut5={oImgData:assetLib.getData("uiButs"),aPos:[120,0],align:[.25,.63],id:oImageIds.itemBut,idOver:oImageIds.itemButOver,switchId:5};userInput.addHitArea("itemFromGame",butEventHandler,{id:0,offsetX:-120,offsetY:0,posX:.25,posY:.37},"image",oItemBut0);userInput.addHitArea("itemFromGame",butEventHandler,{id:1,offsetX:0,offsetY:0,posX:.25,posY:.37},"image",oItemBut1);userInput.addHitArea("itemFromGame",butEventHandler,{id:2,offsetX:120,offsetY:0,posX:.25,posY:.37},"image",oItemBut2);userInput.addHitArea("itemFromGame",butEventHandler,{id:3,offsetX:-120,offsetY:0,posX:.25,posY:.63},"image",oItemBut3);userInput.addHitArea("itemFromGame",butEventHandler,{id:4,offsetX:0,offsetY:0,posX:.25,posY:.63},"image",oItemBut4);userInput.addHitArea("itemFromGame",butEventHandler,{id:5,offsetX:120,offsetY:0,posX:.25,posY:.63},"image",oItemBut5);userInput.addHitArea("menuFromGame",butEventHandler,null,"image",oMenuBut);userInput.addHitArea("leftFromGame",butEventHandler,null,"image",oLeftBut);userInput.addHitArea("rightFromGame",butEventHandler,null,"image",oRightBut);var aButs=new Array(oMenuBut,oLeftBut,oRightBut,oItemBut0,oItemBut1,oItemBut2,oItemBut3,oItemBut4,oItemBut5);var oCameraBut={oImgData:assetLib.getData("uiButs"),aPos:[47,40],align:[.5,0],id:oImageIds.cameraBut,idOver:oImageIds.cameraButOver};userInput.addHitArea("cameraFromGame",butEventHandler,{id:100},"image",oCameraBut);aButs.push(oCameraBut);addMuteBut(aButs);panel=new Elements.Panel(gameState,aButs);panel.startTween1();aClouds=new Array();var tc=new Elements.Clouds(0,1);aClouds.push(tc);var tc=new Elements.Clouds(.5,-1);aClouds.push(tc);character=new Elements.Character();previousTime=new Date().getTime();updateGameEvent();}
function initPause(){gameState="pause";var oPlayBut={oImgData:assetLib.getData("uiButs"),aPos:[-120,150],align:[.5,.5],id:oImageIds.playBut,idOver:oImageIds.playButOver};var oRestartBut={oImgData:assetLib.getData("uiButs"),aPos:[0,150],align:[.5,.5],id:oImageIds.replayBut,idOver:oImageIds.replayButOver};var oQuitBut={oImgData:assetLib.getData("uiButs"),aPos:[120,150],align:[.5,.5],id:oImageIds.quitBut,idOver:oImageIds.quitButOver};userInput.addHitArea("playFromPause",butEventHandler,null,"image",oPlayBut);userInput.addHitArea("restartFromPause",butEventHandler,null,"image",oRestartBut);userInput.addHitArea("quitFromPause",butEventHandler,null,"image",oQuitBut);var aButs=new Array(oPlayBut,oRestartBut,oQuitBut);panel=new Elements.Panel(gameState,aButs);panel.startTween1();previousTime=new Date().getTime();background=new Elements.Background();updatePauseEvent();}
function resumeGame(){gameState="game";background=new Elements.Background();var oPauseBut={oImgData:assetLib.getData("uiButs"),aPos:[40,40],align:[0,0],id:oImageIds.pauseBut,idOver:oImageIds.pauseButOver};userInput.addHitArea("pause",butEventHandler,null,"image",oPauseBut);var aButs=new Array(oPauseBut);addMuteBut(aButs);panel=new Elements.Panel(gameState,aButs);panel.startTween1();previousTime=new Date().getTime();updateGameEvent();}
function butEventHandler(_id,_oData){if(gameState=="rotated"){return;}
switch(_id){case "langSelect":curLang=_oData.lang;ctx.clearRect(0,0,canvas.width,canvas.height);userInput.removeHitArea("langSelect");preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.jpg"}],ctx,canvas.width,canvas.height,false);preAssetLib.onReady(initLoadAssets);break;case "credits":playSound("click");userInput.removeHitArea("startGame");userInput.removeHitArea("moreGames");userInput.removeHitArea("credits");userInput.removeHitArea("mute");initCreditsScreen();break;case "backFromCredits":playSound("click");userInput.removeHitArea("backFromCredits");userInput.removeHitArea("resetData");userInput.removeHitArea("mute");initStartScreen();break;case "moreGames":case "moreGamesPause":playSound("click");break;case "resetData":playSound("click");userInput.removeHitArea("backFromCredits");userInput.removeHitArea("resetData");userInput.removeHitArea("mute");initStartScreen();break;case "startGame":playSound("click");playSound("start");userInput.removeHitArea("startGame");userInput.removeHitArea("mute");charId=_oData.id;initGame();break;case "leftFromGame":playSound("click");character.section--;if(character.section<0){character.section=4;}
panel.newSection(-1);for(var i=0;i<6;i++){if(character.aOutfit[character.section]==i){panel.switchSpecificBut(i,oImageIds.itemButOn,oImageIds.itemButOnOver);}
else{panel.switchSpecificBut(i,oImageIds.itemBut,oImageIds.itemButOver);}}
addFirework(40,canvas.height-50);break;case "rightFromGame":playSound("click");character.section++;if(character.section>4){character.section=0;}
panel.newSection(1);for(var i=0;i<6;i++){if(character.aOutfit[character.section]==i){panel.switchSpecificBut(i,oImageIds.itemButOn,oImageIds.itemButOnOver);}
else{panel.switchSpecificBut(i,oImageIds.itemBut,oImageIds.itemButOver);}}
addFirework(canvas.width/2-40,canvas.height-50);break;case "cameraFromGame":playSound("click");character.render();for(var i=0;i<aEffects.length;i++){if(aEffects[i].id=="snow"){aEffects[i].update();aEffects[i].render();}}
panel.renderFrame();var tempCanvas=document.createElement('canvas');tempCanvas.width=canvas.width/2;tempCanvas.height=canvas.height;var tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(canvas,-canvas.width/2,0);var dataUrl=tempCanvas.toDataURL('image/jpeg',1.0);try{var isFileSaverSupported=!!new Blob;}
catch(err){panel.showPopUpWarning();console.warn("Clipboard copy error: "+err);}
tempCanvas.toBlob(function(blob){saveAs(blob,assetLib.textData.langText["char"+charId][curLang]+".png");});break;case "itemFromGame":if(character.section==4){playSound("bg");if(_oData.id==2&&character.aOutfit[character.section]!=_oData.id){var tempSnow=new Elements.Snow();aEffects.push(tempSnow);}
else{for(var i=0;i<aEffects.length;i++){if(aEffects[i].id=="snow"){aEffects[i].removeMe=true;}}}}
else{playSound("item"+Math.floor(Math.random()*3));}
if(character.section==0&&_oData.id==0){if(character.aOutfit[character.section]!=-1){panel.switchSpecificBut(character.aOutfit[character.section],oImageIds.itemBut,oImageIds.itemButOver);}
if(character.aOutfit[character.section]!=0&&character.aOutfit[character.section]!=24&&character.aOutfit[character.section]!=25){character.aOutfit[character.section]=0;}
else if(character.aOutfit[character.section]==0){character.aOutfit[character.section]=24;}
else if(character.aOutfit[character.section]==24){character.aOutfit[character.section]=25;}
else if(character.aOutfit[character.section]==25){character.aOutfit[character.section]=-1;panel.switchSpecificBut(_oData.id,oImageIds.itemBut,oImageIds.itemButOver);}}
else if(character.aOutfit[character.section]==_oData.id){character.aOutfit[character.section]=-1;panel.switchSpecificBut(_oData.id,oImageIds.itemBut,oImageIds.itemButOver);}
else{if(character.aOutfit[character.section]!=-1){panel.switchSpecificBut(character.aOutfit[character.section],oImageIds.itemBut,oImageIds.itemButOver);}
character.aOutfit[character.section]=_oData.id;panel.switchSpecificBut(_oData.id,oImageIds.itemButOn,oImageIds.itemButOnOver);}
if(character.section!=4){for(var i=0;i<3;i++){addFirework(canvas.width-(Math.random()*100)-150,canvas.height-50-Math.random()*300);}
character.addItem();}
else{character.newBg();}
addFirework(canvas.width*_oData.posX+_oData.offsetX,canvas.height*_oData.posY+_oData.offsetY);break;case "menuFromGame":playSound("click");userInput.removeHitArea("menuFromGame");userInput.removeHitArea("leftFromGame");userInput.removeHitArea("rightFromGame");userInput.removeHitArea("itemFromGame");initStartScreen();break;case "nextLevel":playSound("click");userInput.removeHitArea("jumpHeight");userInput.removeHitArea("dashLength");userInput.removeHitArea("turnRate");userInput.removeHitArea("nextLevel");levelScore=0;levelNum++;initGame();break;case "retryFromEnd":playSound("click");userInput.removeHitArea("retryFromEnd");userInput.removeHitArea("quitFromEnd");levelScore=0;initGame();break;case "quitFromEnd":playSound("click");userInput.removeHitArea("retryFromEnd");userInput.removeHitArea("quitFromEnd");initStartScreen();break;case "mute":playSound("click");toggleMute();if(muted){panel.switchBut(oImageIds.muteBut0,oImageIds.muteBut1,oImageIds.muteBut1Over);}
else{panel.switchBut(oImageIds.muteBut1,oImageIds.muteBut0,oImageIds.muteBut0Over);}
break;case "pause":playSound("click");if(audioType==1){Howler.mute(true);music.pause();}
else if(audioType==2){music.pause();}
userInput.removeHitArea("pause");userInput.removeHitArea("gameTouch");userInput.removeHitArea("mute");initPause();break;case "playFromPause":playSound("click");if(audioType==1){if(!muted){Howler.mute(false);playMusic();}}
else if(audioType==2){if(!muted){playMusic();}}
userInput.removeHitArea("playFromPause");userInput.removeHitArea("restartFromPause");userInput.removeHitArea("quitFromPause");userInput.removeHitArea("mute");resumeGame();break;case "quitFromPause":playSound("click");if(audioType==1){if(!muted){Howler.mute(false);playMusic();}}
else if(audioType==2){if(!muted){playMusic();}}
userInput.removeHitArea("playFromPause");userInput.removeHitArea("restartFromPause");userInput.removeHitArea("quitFromPause");userInput.removeHitArea("mute");levelScore=0;totalScore=0;initStartScreen();break;case "restartFromPause":break;}}
function addFirework(_x,_y){if(aEffects.length<10){var tempFirework=new Elements.Firework(_x,_y);aEffects.push(tempFirework);}}
function updateScore(_inc){levelScore+=_inc;}
function initLevelComplete(){gameState="levelComplete";if(audioType==1){music.fade(music.volume(),.25,500);}
playSound("levelComplete");totalScore+=levelScore;userInput.removeHitArea("pause");var oPlayBut={oImgData:assetLib.getData("uiButs"),aPos:[0,140],align:[.5,.5],id:oImageIds.quickGameBut,idOver:oImageIds.quickGameButOver,flash:true};userInput.addHitArea("startGame",butEventHandler,null,"image",oPlayBut);var aButs=new Array(oPlayBut);addMuteBut(aButs);panel=new Elements.Panel(gameState,aButs);panel.startTween1();previousTime=new Date().getTime();updateLevelComplete();}
function initGameEndFail(){gameState="gameEndFail";if(audioType==1){music.fade(music.volume(),.25,500);}
playSound("gameFail");userInput.removeHitArea("pause");var oRetryBut={oImgData:assetLib.getData("uiBut"),aPos:[0,0],align:[.5,.6],id:oImageIds.genSmallBut,noMove:true,text:"retry"};var oQuitFromEndBut={oImgData:assetLib.getData("uiBut"),aPos:[0,0],align:[.5,.6],id:oImageIds.genSmallBut,noMove:true,text:"quit"};userInput.addHitArea("retryFromEnd",butEventHandler,null,"image",oRetryBut);userInput.addHitArea("quitFromEnd",butEventHandler,null,"image",oQuitFromEndBut);var aButs=new Array(oRetryBut,oQuitFromEndBut);addMuteBut(aButs);background.render();panel=new Elements.Panel(gameState,aButs);panel.oScoreData={totalScore:levelScore+totalScore};panel.startTween1();previousTime=new Date().getTime();updateGameEndFail();}
function updateGameEvent(){if(gameState!="game"){return;}
delta=getDelta();background.render();for(var i=0;i<aClouds.length;i++){aClouds[i].update();aClouds[i].render();}
character.update();character.render();panel.update();panel.render(false);for(var i=0;i<aEffects.length;i++){aEffects[i].update(delta);aEffects[i].render(ctx);if(aEffects[i].removeMe){aEffects.splice(i,1);i-=1;}}
checkButtonsOver();requestAnimFrame(updateGameEvent);}
function updateCreditsScreenEvent(){if(gameState!="credits"){return;}
delta=getDelta();background.render();panel.update();panel.render();checkButtonsOver();requestAnimFrame(updateCreditsScreenEvent);}
function updateLevelComplete(){if(gameState!="levelComplete"){return;}
delta=getDelta();background.render();panel.update();panel.render();checkButtonsOver();requestAnimFrame(updateLevelComplete);}
function updateGameEndFail(){if(gameState!="gameEndFail"){return;}
delta=getDelta();background.render();panel.update();panel.render();checkButtonsOver();requestAnimFrame(updateGameEndFail);}
function updateSplashScreenEvent(){if(gameState!="splash"){return;}
delta=getDelta();splashTimer+=delta;if(splashTimer>2.5){if(audioType==1&&!muted){playMusic();if(!hasFocus){music.pause();}}
initStartScreen();return;}
background.render();panel.update();panel.render();checkButtonsOver();requestAnimFrame(updateSplashScreenEvent);}
function updateStartScreenEvent(){if(gameState!="start"){return;}
delta=getDelta();background.render();for(var i=0;i<aClouds.length;i++){aClouds[i].update();aClouds[i].render();}
panel.update();panel.render();checkButtonsOver();ctx.fillStyle="#ED0080";ctx.textAlign="right";ctx.font="12px Helvetica";ctx.fillText("v1.1.2",canvas.width-10,canvas.height-10);requestAnimFrame(updateStartScreenEvent);}
function updateLoaderEvent(){if(gameState!="loading"){return;}
delta=getDelta();assetLib.render();requestAnimFrame(updateLoaderEvent);}
function updatePauseEvent(){if(gameState!="pause"){return;}
delta=getDelta();background.render();panel.update();panel.render();checkButtonsOver();requestAnimFrame(updatePauseEvent);}
function updateRotateWarningEvent(){if(gameState!="rotated"){return;}
delta=getDelta();panel.update();panel.render(false);requestAnimFrame(updateRotateWarningEvent);}
function addDirectText(_font,_size,_width,_align,_x,_y,_str,_col){if(_col===void 0){_col="#202020";}
ctx.fillStyle=_col;ctx.textAlign=_align;ctx.font=_size+"px "+assetLib.textData.langText["font"+_font][curLang];ctx.fillText(_str,_x,_y);}
function addText(_font,_size,_width,_align,_x,_y,_str,_col){if(_col===void 0){_col="#202020";}
ctx.fillStyle=_col;ctx.textAlign=_align;if(_width<getTextWidth(_font,_size,_str)){var breakCount=0;_size--;while(_width<getTextWidth(_font,_size,_str)){_size--;if(breakCount>100){break;}}}
if(curLang=="ar"){_y-=_size/15;}
ctx.font=_size+"px "+assetLib.textData.langText["font"+_font][curLang];ctx.fillText(getText(_str),_x,_y);}
function getText(_str){var tempText=assetLib.textData.langText[_str][curLang];if(curLang=="de"){}
return tempText;}
function getTextWidth(_font,_size,_str){ctx.font=_size+"px "+assetLib.textData.langText["font"+_font][curLang];var metrics=ctx.measureText(getText(_str));return metrics.width;}
function getCorrectedTextWidth(_font,_size,_width,_str){if(_width<getTextWidth(_font,_size,_str)){var breakCount=0;_size--;while(_width<getTextWidth(_font,_size,_str)){_size--;if(breakCount>100){break;}}}
ctx.font=_size+"px "+assetLib.textData.langText["font"+_font][curLang];var metrics=ctx.measureText(getText(_str));return metrics.width;}
function checkButtonsOver(){if(isMobile){return;}
for(var i=0;i<panel.aButs.length;i++){panel.aButs[i].isOver=false;if(userInput.mouseX>panel.aButs[i].aOverData[0]&&userInput.mouseX<panel.aButs[i].aOverData[2]&&userInput.mouseY>panel.aButs[i].aOverData[1]&&userInput.mouseY<panel.aButs[i].aOverData[3]){panel.aButs[i].isOver=true;}}}
function clearButtonOvers(){userInput.mouseX=-100;userInput.mouseY=-100;}
function getDelta(){var currentTime=new Date().getTime();var deltaTemp=(currentTime-previousTime)/1000;previousTime=currentTime;if(deltaTemp>.5){deltaTemp=0;}
return deltaTemp;}
function checkSpriteCollision(_s1,_s2){var s1XOffset=_s1.x;var s1YOffset=_s1.y;var s2XOffset=_s2.x;var s2YOffset=_s2.y;var distance_squared=(((s1XOffset-s2XOffset)*(s1XOffset-s2XOffset))+((s1YOffset-s2YOffset)*(s1YOffset-s2YOffset)));var radii_squared=(_s1.radius)*(_s2.radius);if(distance_squared<radii_squared){return true;}
else{return false;}}
function getScaleImageToMax(_oImgData,_aLimit){var newScale;if(_oImgData.isSpriteSheet){if(_aLimit[0]/_oImgData.oData.spriteWidth<_aLimit[1]/_oImgData.oData.spriteHeight){newScale=Math.min(_aLimit[0]/_oImgData.oData.spriteWidth,1);}
else{newScale=Math.min(_aLimit[1]/_oImgData.oData.spriteHeight,1);}}
else{if(_aLimit[0]/_oImgData.img.width<_aLimit[1]/_oImgData.img.height){newScale=Math.min(_aLimit[0]/_oImgData.img.width,1);}
else{newScale=Math.min(_aLimit[1]/_oImgData.img.height,1);}}
return newScale;}
function getCentreFromTopLeft(_aTopLeft,_oImgData,_imgScale){var aCentre=new Array();aCentre.push(_aTopLeft[0]+(_oImgData.oData.spriteWidth/2)*_imgScale);aCentre.push(_aTopLeft[1]+(_oImgData.oData.spriteHeight/2)*_imgScale);return aCentre;}
function loadPreAssets(){preAssetLib=new Utils.AssetLoader(curLang,[{id:"loaderAssets",file:"images/loaderAssets.png",oAtlasData:{id0:{x:0,y:359,width:142,height:108},id1:{x:0,y:0,width:600,height:246},id2:{x:0,y:248,width:352,height:67},id3:{x:0,y:317,width:326,height:40},id4:{x:144,y:359,width:131,height:169}}},{id:"loaderBg",file:"images/loaderBg.jpg"}],ctx,canvas.width,canvas.height,false);oImageIds.logo="id0";oImageIds.bgTop="id1";oImageIds.loaderBar0="id2";oImageIds.loaderBar1="id3";oImageIds.bouncer="id4";preAssetLib.onReady(initLoadAssets);}
function initLangSelect(){var oImgData;var j;var k;var gap=10;var tileWidthNum=0;var tileHeightNum=0;var butScale=1;for(var i=0;i<aLangs.length;i++){oImgData=preAssetLib.getData("lang"+aLangs[i]);if((i+1)*(oImgData.img.width*butScale)+(i+2)*gap<canvas.width){tileWidthNum++;}
else{break;}}
tileHeightNum=Math.ceil(aLangs.length/tileWidthNum);for(var i=0;i<aLangs.length;i++){oImgData=preAssetLib.getData("lang"+aLangs[i]);j=canvas.width/2-(tileWidthNum/2)*(oImgData.img.width*butScale)-((tileWidthNum-1)/2)*gap;j+=(i%tileWidthNum)*((oImgData.img.width*butScale)+gap);k=canvas.height/2-(tileHeightNum/2)*(oImgData.img.height*butScale)-((tileHeightNum-1)/2)*gap;k+=(Math.floor(i/tileWidthNum)%tileHeightNum)*((oImgData.img.height*butScale)+gap);ctx.drawImage(oImgData.img,0,0,oImgData.img.width,oImgData.img.height,j,k,(oImgData.img.width*butScale),(oImgData.img.height*butScale));var oBut={oImgData:oImgData,aPos:[j+(oImgData.img.width*butScale)/2,k+(oImgData.img.height*butScale)/2],scale:butScale,id:"none",noMove:true};userInput.addHitArea("langSelect",butEventHandler,{lang:aLangs[i]},"image",oBut);}}
function initLoadAssets(){loadAssets();}
function loadAssets(){assetLib=new Utils.AssetLoader(curLang,[{id:"bg0",file:"images/bg0.jpg"},{id:"bg1",file:"images/bg1.jpg"},{id:"splashLogo",file:"images/splashLogo.png"},{id:"bgC0",file:"images/bgs/bg0.jpg"},{id:"bgC1",file:"images/bgs/bg1.jpg"},{id:"bgC2",file:"images/bgs/bg2.jpg"},{id:"bgC3",file:"images/bgs/bg3.jpg"},{id:"bgC4",file:"images/bgs/bg4.jpg"},{id:"bgC5",file:"images/bgs/bg5.jpg"},{id:"flare",file:"images/flare.png"},{id:"char0",file:"images/char0_316x437.png"},{id:"char1",file:"images/char1_340x463.png"},{id:"char2",file:"images/char2_338x496.png"},{id:"uiButs",file:"images/uiButs.png",oAtlasData:{id0:{x:0,y:462,width:65,height:68},id1:{x:417,y:70,width:65,height:68},id10:{x:0,y:154,width:149,height:152},id11:{x:0,y:0,width:149,height:152},id12:{x:476,y:430,width:57,height:73},id13:{x:417,y:430,width:57,height:73},id14:{x:417,y:355,width:58,height:73},id15:{x:417,y:280,width:58,height:73},id16:{x:302,y:351,width:113,height:115},id17:{x:302,y:117,width:113,height:115},id18:{x:302,y:234,width:113,height:115},id19:{x:302,y:0,width:113,height:115},id2:{x:417,y:140,width:65,height:68},id20:{x:67,y:462,width:65,height:68},id21:{x:134,y:462,width:65,height:68},id3:{x:417,y:210,width:65,height:68},id4:{x:201,y:462,width:65,height:68},id5:{x:417,y:0,width:65,height:68},id6:{x:151,y:154,width:149,height:152},id7:{x:151,y:308,width:149,height:152},id8:{x:151,y:0,width:149,height:152},id9:{x:0,y:308,width:149,height:152}}},{id:"uiElements",file:"images/uiElements.png",oAtlasData:{id0:{x:0,y:0,width:364,height:100},id1:{x:0,y:102,width:98,height:74},id2:{x:0,y:273,width:45,height:45},id3:{x:47,y:273,width:45,height:45},id4:{x:0,y:225,width:46,height:46},id5:{x:0,y:178,width:46,height:45}}},{id:"charIcons0",file:"images/charIcons0.png",oAtlasData:{id0:{x:345,y:91,width:79,height:88},id1:{x:345,y:361,width:74,height:91},id10:{x:89,y:389,width:86,height:71},id11:{x:262,y:206,width:82,height:65},id12:{x:178,y:158,width:83,height:46},id13:{x:178,y:339,width:80,height:47},id14:{x:0,y:56,width:88,height:47},id15:{x:89,y:285,width:87,height:51},id16:{x:89,y:338,width:87,height:49},id17:{x:0,y:0,width:88,height:54},id18:{x:346,y:273,width:71,height:85},id19:{x:419,y:273,width:64,height:83},id2:{x:262,y:273,width:82,height:86},id20:{x:263,y:361,width:80,height:86},id21:{x:177,y:389,width:84,height:85},id22:{x:263,y:91,width:80,height:48},id23:{x:90,y:0,width:86,height:83},id24:{x:0,y:375,width:87,height:88},id25:{x:89,y:105,width:87,height:88},id26:{x:89,y:195,width:87,height:88},id27:{x:0,y:105,width:87,height:88},id28:{x:0,y:285,width:87,height:88},id29:{x:0,y:195,width:87,height:88},id3:{x:345,y:0,width:79,height:89},id4:{x:263,y:0,width:80,height:89},id5:{x:346,y:181,width:73,height:90},id6:{x:178,y:261,width:82,height:76},id7:{x:178,y:206,width:82,height:53},id8:{x:178,y:79,width:83,height:77},id9:{x:178,y:0,width:83,height:77}}},{id:"charIcons1",file:"images/charIcons1.png",oAtlasData:{id0:{x:415,y:272,width:54,height:82},id1:{x:0,y:183,width:90,height:86},id10:{x:181,y:288,width:86,height:52},id11:{x:357,y:94,width:78,height:88},id12:{x:0,y:80,width:91,height:47},id13:{x:0,y:409,width:88,height:45},id14:{x:0,y:129,width:90,height:52},id15:{x:181,y:234,width:87,height:52},id16:{x:92,y:219,width:85,height:45},id17:{x:181,y:90,width:87,height:52},id18:{x:269,y:374,width:85,height:80},id19:{x:270,y:90,width:85,height:57},id2:{x:269,y:288,width:87,height:84},id20:{x:91,y:271,width:88,height:71},id21:{x:272,y:0,width:79,height:78},id22:{x:0,y:271,width:89,height:78},id23:{x:0,y:351,width:89,height:56},id24:{x:183,y:0,width:87,height:88},id25:{x:92,y:129,width:87,height:88},id26:{x:91,y:344,width:87,height:88},id27:{x:94,y:0,width:87,height:88},id28:{x:181,y:144,width:87,height:88},id29:{x:180,y:344,width:87,height:88},id3:{x:358,y:272,width:55,height:87},id4:{x:270,y:149,width:85,height:50},id5:{x:270,y:201,width:85,height:83},id6:{x:357,y:184,width:76,height:86},id7:{x:0,y:0,width:92,height:78},id8:{x:357,y:0,width:81,height:92},id9:{x:356,y:374,width:81,height:91}}},{id:"charIcons2",file:"images/charIcons2.png",oAtlasData:{id0:{x:366,y:59,width:80,height:83},id1:{x:0,y:129,width:93,height:69},id10:{x:0,y:72,width:94,height:55},id11:{x:94,y:328,width:92,height:54},id12:{x:0,y:384,width:92,height:69},id13:{x:95,y:181,width:91,height:76},id14:{x:187,y:259,width:89,height:67},id15:{x:187,y:384,width:88,height:60},id16:{x:97,y:0,width:89,height:61},id17:{x:95,y:259,width:90,height:63},id18:{x:188,y:121,width:87,height:61},id19:{x:188,y:328,width:85,height:52},id2:{x:0,y:200,width:93,height:70},id20:{x:366,y:0,width:85,height:57},id21:{x:187,y:63,width:88,height:56},id22:{x:95,y:129,width:91,height:50},id23:{x:97,y:63,width:88,height:57},id24:{x:277,y:90,width:87,height:88},id25:{x:277,y:328,width:87,height:88},id26:{x:277,y:0,width:87,height:88},id27:{x:366,y:360,width:87,height:88},id28:{x:366,y:270,width:87,height:88},id29:{x:278,y:180,width:87,height:88},id3:{x:367,y:144,width:78,height:89},id4:{x:0,y:0,width:95,height:70},id5:{x:188,y:184,width:87,height:70},id6:{x:94,y:384,width:91,height:63},id7:{x:188,y:0,width:86,height:55},id8:{x:0,y:272,width:93,height:54},id9:{x:0,y:328,width:92,height:54}}},{id:"langText",file:"json/text.json"},{id:"rotateIcon",file:"images/rotate.png"},{id:"titleLogo",file:"images/title/"+curLang+".png"}],ctx,canvas.width,canvas.height);oImageIds.muteBut0="id0";oImageIds.muteBut0Over="id1";oImageIds.muteBut1="id2";oImageIds.muteBut1Over="id3";oImageIds.menuBut="id4";oImageIds.menuButOver="id5";oImageIds.play0But="id6";oImageIds.play0ButOver="id7";oImageIds.play1But="id8";oImageIds.play1ButOver="id9";oImageIds.play2But="id10";oImageIds.play2ButOver="id11";oImageIds.leftBut="id12";oImageIds.leftButOver="id13";oImageIds.rightBut="id14";oImageIds.rightButOver="id15";oImageIds.itemButOn="id16";oImageIds.itemBut="id17";oImageIds.itemButOver="id18";oImageIds.itemButOnOver="id19";oImageIds.cameraBut="id20";oImageIds.cameraButOver="id21";oImageIds.showLogo="id0";oImageIds.boomLogo="id1";oImageIds.corner0="id2";oImageIds.corner1="id3";oImageIds.corner3="id4";oImageIds.corner2="id5";assetLib.onReady(initSplash);gameState="loading";previousTime=new Date().getTime();updateLoaderEvent();}
function resizeCanvas(){var tempInnerWidth=window.innerWidth;var tempInnerHeight=window.innerHeight;canvas.height=tempInnerHeight;canvas.width=tempInnerWidth;canvas.style.width=tempInnerWidth+"px";canvas.style.height=tempInnerHeight+"px";var maxW;var maxH;var minW;var minH;canvasScale=1;if(tempInnerWidth<tempInnerHeight){if(!isRotated){if(gameState!="loading"){initRotateWarning();}}
maxW=maxHeight;maxH=maxWidth;minW=minHeight;minH=minWidth;}
else{if(isRotated){if(gameState!="loading"){initBackFromRotate();}}
maxW=maxWidth;maxH=maxHeight;minW=minWidth;minH=minHeight;}
if(canvas.width<maxW||canvas.height<maxH){if(canvas.height<minH){canvas.height=minH;canvas.width=minH*(tempInnerWidth/tempInnerHeight);canvasScale=minH/tempInnerHeight;}
if(canvas.width<minW){canvas.width=minW;canvas.height=minW*(tempInnerHeight/tempInnerWidth);canvasScale=minW/tempInnerWidth;}}
else{if(canvas.height-maxH<canvas.width-maxW){if(canvas.height<maxH){canvasScale=1;}
else{canvas.height=maxH;canvas.width=maxH*(tempInnerWidth/tempInnerHeight);canvasScale=maxH/tempInnerHeight;if(canvas.width<minW){canvasScale*=minW/canvas.width;canvas.height*=minW/canvas.width;canvas.width*=minW/canvas.width;}}}
else{if(canvas.width<maxW){canvasScale=1;}
else{canvas.width=maxW;canvas.height=maxW*(tempInnerHeight/tempInnerWidth);canvasScale=maxW/tempInnerWidth;}}}
switch(gameState){case "game":if(isMobile){}
break;case "start":case "credits":case "gameComplete":break;}
this.prevCanvasWidth=tempInnerWidth;this.prevCanvasHeight=tempInnerHeight;window.scrollTo(0,0);}
function initRotateWarning(){isRotated=true;prevGameState=gameState;gameState="rotated";background=new Elements.Background();previousTime=new Date().getTime();resizeCanvas();updateRotateWarningEvent();}
function initBackFromRotate(){isRotated=false;switch(prevGameState){case "start":gameState="start";background.changeBg();previousTime=new Date().getTime();updateStartScreenEvent();break;case "pause":gameState="pause";previousTime=new Date().getTime();updatePauseEvent();break;case "credits":gameState="credits";previousTime=new Date().getTime();updateCreditsScreenEvent();break;case "game":gameState="game";previousTime=new Date().getTime();updateGameEvent();break;}}
function playSound(_id){if(audioType==1){sound.play(_id);}}
function toggleMute(){muted=!muted;if(audioType==1){if(muted){Howler.mute(true);music.pause();}
else{Howler.mute(false);playMusic();if(gameState=="game"){music.volume(.75);}
else{music.volume(.5);}}}
else if(audioType==2){if(muted){music.pause();}
else{playMusic();}}}