(function(){'use strict';function SlingInput(width,height,info){PIXI.Graphics.call(this);this.width=width;this.height=height;this.maxDistance=info.data.sling.maxDistance;this.beginFill(0xffff00,0);this.drawRect(0,0,width,height);this.endFill();this.cacheAsBitmap=true;this.interactive=true;this.initialPos={x:0,y:0};this.finalPos={x:0,y:0};this.arrowRotation=0;this.down=false;this.release=false;this.mousedown=this.onMouseDown.bind(this);this.mouseup=this.onMouseUp.bind(this);this.mousemove=this.onMouseMove.bind(this);this.touchstart=this.onMouseDown.bind(this);this.touchend=this.onMouseUp.bind(this);this.touchmove=this.onMouseMove.bind(this);window.document.onmouseout=this.onMouseUp.bind(this);this.directionVector=WONBATS.Vec2.create(0,0);}
SlingInput.prototype=Object.create(PIXI.Graphics.prototype);SlingInput.prototype.constructor=SlingInput;SlingInput.prototype.onMouseDown=function(mouseData){this.down=true;this.release=false;this.initialPos.x=mouseData.data.global.x;this.initialPos.y=mouseData.data.global.y;this.finalPos.x=mouseData.data.global.x;this.finalPos.y=mouseData.data.global.y;};SlingInput.prototype.onMouseUp=function(mouseData){if(this.down){this.down=false;this.release=true;}};SlingInput.prototype.onMouseMove=function(mouseData){if(this.down){this.finalPos.x=mouseData.data.global.x;this.finalPos.y=mouseData.data.global.y;this.directionVector[0]=-(this.initialPos.x-this.finalPos.x)/this.maxDistance;this.directionVector[1]=(this.initialPos.y-this.finalPos.y)/this.maxDistance;if(game.config.SLING){this.directionVector[0]*=-1;this.directionVector[1]*=-1;}
if(WONBATS.Vec2.getLength(this.directionVector)>1){WONBATS.Vec2.normalize(this.directionVector,this.directionVector);}
var vectorDegree=WONBATS.Vec2.getAngle(this.directionVector)*180/Math.PI;this.currentQuad="";if(vectorDegree>157.5){this.currentQuad="left";}else if(vectorDegree>112.5){this.currentQuad="left_up";}else if(vectorDegree>67.5){this.currentQuad="up";}else if(vectorDegree>22.5){this.currentQuad="up_right";}else if(vectorDegree>-22.5){this.currentQuad="right";}else if(vectorDegree>-67.5){this.currentQuad="right_down";}else if(vectorDegree>-112.5){this.currentQuad="down";}else if(vectorDegree>-157.5){this.currentQuad="down_left";}else{this.currentQuad="left";}
if(this.finalPos.x<=1||this.finalPos.x>=this.width-1||this.finalPos.y<=1||this.finalPos.y>=this.height-1){this.onMouseUp();}}};SlingInput.prototype.getArrowRotation=function(){var diffX=0;var diffY=0;if(game.config.SLING){diffX=this.initialPos.x-this.finalPos.x;diffY=this.initialPos.y-this.finalPos.y;}else{diffX=this.finalPos.x-this.initialPos.x;diffY=this.finalPos.y-this.initialPos.y;}
return Math.atan2(diffY,diffX);};SlingInput.prototype.getScale=function(){var distanceX=(this.initialPos.x-this.finalPos.x);var distanceY=(this.initialPos.y-this.finalPos.y);var distance=Math.sqrt(Math.pow((distanceX),2)+Math.pow((distanceY),2));var scale=(distance/this.maxDistance);scale=Math.clamp(scale,0.1,1);return scale;};SlingInput.prototype.getDirectionVector=function(){return this.directionVector;};SlingInput.prototype.destroy=function(){if(this.graphicsData){PIXI.Graphics.prototype.destroy.call(this);}
this.mousedown=null;this.mouseup=null;this.mousemove=null;this.touchstart=null;this.touchend=null;this.touchmove=null;window.document.onmouseout=null;};WONBATS.SlingInput=SlingInput;}());